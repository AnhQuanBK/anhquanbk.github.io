function _array_like_to_array(e,c){if(null==c||c>e.length)c=e.length;for(var l=0,h=new Array(c);l<c;l++)h[l]=e[l];return h}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function _assert_this_initialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function asyncGeneratorStep(e,c,l,h,d,f,y){try{var _=e[f](y);var v=_.value}catch(e){l(e);return}if(_.done)c(v);else Promise.resolve(v).then(h,d)}function _async_to_generator(e){return function(){var c=this,l=arguments;return new Promise(function(h,d){var f=e.apply(c,l);function _next(e){asyncGeneratorStep(f,h,d,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(f,h,d,_next,_throw,"throw",e)}_next(void 0)})}}function _call_super(e,c,l){return c=_get_prototype_of(c),_possible_constructor_return(e,_is_native_reflect_construct()?Reflect.construct(c,l||[],_get_prototype_of(e).constructor):c.apply(e,l))}function _class_call_check(e,c){if(!(e instanceof c))throw new TypeError("Cannot call a class as a function")}function _construct(){return(_construct=_is_native_reflect_construct()?Reflect.construct:function construct(e,c,l){var h=[null];h.push.apply(h,c);var d=new(Function.bind.apply(e,h));if(l)_set_prototype_of(d,l.prototype);return d}).apply(null,arguments)}function _defineProperties(e,c){for(var l=0;l<c.length;l++){var h=c[l];if(h.enumerable=h.enumerable||false,h.configurable=true,"value"in h)h.writable=true;Object.defineProperty(e,h.key,h)}}function _create_class(e,c,l){if(c)_defineProperties(e.prototype,c);if(l)_defineProperties(e,l);return e}function _define_property(e,c,l){if(c in e)Object.defineProperty(e,c,{value:l,enumerable:true,configurable:true,writable:true});else e[c]=l;return e}function _get(e,c,l){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function get(e,c,l){var h=_super_prop_base(e,c);if(!h)return;var d=Object.getOwnPropertyDescriptor(h,c);if(d.get)return d.get.call(l||e);return d.value})(e,c,l||e)}function _get_prototype_of(e){return(_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,c){if("function"!=typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function");if(e.prototype=Object.create(c&&c.prototype,{constructor:{value:e,writable:true,configurable:true}}),c)_set_prototype_of(e,c)}function _instanceof(e,c){if(null!=c&&"undefined"!=typeof Symbol&&c[Symbol.hasInstance])return!!c[Symbol.hasInstance](e);return e instanceof c}function _is_native_function(e){return -1!==Function.toString.call(e).indexOf("[native code]")}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,c){var l,h,d=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==d)return;var f=[];var y=true;var _=false;try{for(d=d.call(e);!(y=(l=d.next()).done)&&(f.push(l.value),!c||f.length!==c);y=true);}catch(e){_=true,h=e}finally{try{if(!y&&null!=d.return)d.return()}finally{if(_)throw h}}return f}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var c=1;c<arguments.length;c++){var l=null!=arguments[c]?arguments[c]:{};var h=Object.keys(l);if("function"==typeof Object.getOwnPropertySymbols)h=h.concat(Object.getOwnPropertySymbols(l).filter(function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable}));h.forEach(function(c){_define_property(e,c,l[c])})}return e}function ownKeys(e,c){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);if(c)h=h.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable});l.push.apply(l,h)}return l}function _object_spread_props(e,c){if(c=null!=c?c:{},Object.getOwnPropertyDescriptors)Object.defineProperties(e,Object.getOwnPropertyDescriptors(c));else ownKeys(Object(c)).forEach(function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(c,l))});return e}function _possible_constructor_return(e,c){if(c&&("object"===_type_of(c)||"function"==typeof c))return c;return _assert_this_initialized(e)}function _set_prototype_of(e,c){return(_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(e,c){return e.__proto__=c,e})(e,c)}function _sliced_to_array(e,c){return _array_with_holes(e)||_iterable_to_array_limit(e,c)||_unsupported_iterable_to_array(e,c)||_non_iterable_rest()}function _super_prop_base(e,c){while(!Object.prototype.hasOwnProperty.call(e,c))if(null===(e=_get_prototype_of(e)))break;return e}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,c){if(!e)return;if("string"==typeof e)return _array_like_to_array(e,c);var l=Object.prototype.toString.call(e).slice(8,-1);if("Object"===l&&e.constructor)l=e.constructor.name;if("Map"===l||"Set"===l)return Array.from(l);if("Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return _array_like_to_array(e,c)}function _wrap_native_super(e){var c="function"==typeof Map?new Map:void 0;return(_wrap_native_super=function wrapNativeSuper(e){if(null===e||!_is_native_function(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==c){if(c.has(e))return c.get(e);c.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_get_prototype_of(this).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}}),_set_prototype_of(Wrapper,e)})(e)}function _is_native_reflect_construct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_is_native_reflect_construct=function(){return!!e})()}function _ts_generator(e,c){var l,h,d,f={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]},y=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return y.next=verb(0),y.throw=verb(1),y.return=verb(2),"function"==typeof Symbol&&(y[Symbol.iterator]=function(){return this}),y;function verb(e){return function(c){return step([e,c])}}function step(_){if(l)throw new TypeError("Generator is already executing.");while(y&&(y=0,_[0]&&(f=0)),f)try{if(l=1,h&&(d=2&_[0]?h.return:_[0]?h.throw||((d=h.return)&&d.call(h),0):h.next)&&!(d=d.call(h,_[1])).done)return d;if(h=0,d)_=[2&_[0],d.value];switch(_[0]){case 0:case 1:d=_;break;case 4:return f.label++,{value:_[1],done:false};case 5:f.label++,h=_[1],_=[0];continue;case 7:_=f.ops.pop(),f.trys.pop();continue;default:if(!(d=(d=f.trys).length>0&&d[d.length-1])&&(6===_[0]||2===_[0])){f=0;continue}if(3===_[0]&&(!d||_[1]>d[0]&&_[1]<d[3])){f.label=_[1];break}if(6===_[0]&&f.label<d[1]){f.label=d[1],d=_;break}if(d&&f.label<d[2]){f.label=d[2],f.ops.push(_);break}if(d[2])f.ops.pop();f.trys.pop();continue}_=c.call(e,f)}catch(e){_=[6,e],h=0}finally{l=d=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:true}}}var _d=Object.defineProperty;var u=function(e,c,l){return function(e,c,l){return c in e?_d(e,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[c]=l}(e,(void 0===c?"undefined":_type_of(c))!="symbol"?c+"":c,l)};System.register([],function(e,c){"use strict";return{execute:function execute(){var e=function(e){return e.CORE_BOOTING="core-booting",e.REQUEST_CORE_START="core-start",e.CORE_STARTING="core-starting",e.CORE_READY="core-ready",e.GAME_SDK_READY="game-sdk-ready",e.GAME_SDK_STARTED="game-sdk-started",e.CONTEXT_DATA_PROCESSED="context-data-processed",e.CONTEXT_SESSION_TYPE_DETECTED="context-session-type-detected",e.GAME_READY="game-ready",e.BUNDLE_READY="bundle-ready",e.PLAYER_INFO_LOADED="player-info-loaded",e.REQUEST_SHOW_BANNER_ADS="request-show-banner-ads",e.SWITCH_SCENE="switch-scene",e.SCENE_LOADED="scene-loaded",e.PRELOAD_SCENE="preload-scene",e.SCENE_PROGRESS="scene-progress",e.SCENE_LAUNCHED="scene-launched",e.SCENE_RENDERED="scene-rendered",e.MARK_IS_TEST_SCENE="mark-is-test-scene",e.PRELOAD_SCREENS="preload-screens",e.OPENING_SCREEN="opening-screen",e.OPEN_SCREEN="open-screen",e.OPENED_SCREEN="opened-screen",e.CLOSING_SCREEN="closing-screen",e.CLOSE_SCREEN="close-screen",e.CLOSED_SCREEN="closed-screen",e.CORE_PLUGIN_READY="core-plugin-ready",e.MODULE_PLUGIN_READY="module-plugin-ready",e.AD_SHOWING="ad-showing",e.AD_CLOSED="ad-closed",e.AD_FAILED="ad-failed",e.LANGUAGE_CHANGED="language-changed",e.REQUEST_LANGUAGE="request-language",e.REQUEST_HOT_RELOAD="request-hot-reload",e.REQUEST_SAVE_CONFIG="request-save-config",e.REQUEST_UPDATE_CONFIG="request-update-config",e.REMOTE_CONFIG_UPDATED="remote-config-updated",e.VISIBILITY_HIDDEN="visibility-hidden",e.VISIBILITY_VISIBLE="visibility-visible",e.REQUEST_RESIZE_GAME="request-resize-game",e}(e||{}),l=function(e){return e.DRAFT="draft",e.SINGLE="single",e.TOURNAMENT="tournament",e.MATCHING_GROUP="matching-group",e.CHALLENGE_FRIEND="challenge-friend",e}(l||{});var As=function(e,c){var l=[];for(var h=0;h<e;h++)l.push(c(h));return l},Et=function(e){return As(e,function(){})},ws=function(e,c){var l=true,h=false,d=void 0;try{for(var f,y=e[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;if(c(_))return _}}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}},Ds=function(e,c){for(var l=0;l<e.length;l++)if(c(e[l]))return l;return -1},Ea=function(e,c,l){return l.indexOf(e)===c&&null!=e},h={at:function(e,c){if(e)return c<0?e[e.length+c]:e[c]},chunk:function(e,c){return Et(Math.ceil(e.length/c)).map(function(l,h){return e.slice(h*c,h*c+c)})},difference:function(e,c){return e.filter(function(e){return c.indexOf(e)<0})},fillWith:As,length:Et,limit:function(e,c){return e.slice(0,c)},search:ws,searchIndex:Ds,has:function(e,c){return e.indexOf(c)>=0},shuffle:function(e){for(var c=e.length-1;c>0;c--){var l,h=Math.floor(Math.random()*(c+1));l=[e[h],e[c]],e[c]=l[0],e[h]=l[1]}},unique:function(e){return e.filter(Ea)},flatten:function(e){return e.reduce(function(e,c){return e.concat(c)},[])}},xa=function(e,c){var l=new OffscreenCanvas(0,0),h=l.getContext(e,c);return h?{canvas:l,context:h}:null},Ca=function(e,c){var l=document.createElement("canvas"),h=l.getContext(e,c);return h?{canvas:l,context:h}:null},vt=function(e){var c=e.contextType,l=void 0===c?"2d":c,h=e.contextAttributes,d=void 0===h?{}:h,f=e.type,y=void 0===f?"auto":f;var _=null;return"canvas"!==y&&function(){return"OffscreenCanvas"in window&&("undefined"==typeof OffscreenCanvas?"undefined":_type_of(OffscreenCanvas))<"u"}()&&(_=xa(l,d)),_||"offscreen"===y||(_=Ca(l,d)),_},Is=function(e){return!e||""===e||0===e||"number"==typeof e&&isNaN(e)},bt=function(e){return Is(e)?!1!==e&&0!==e:"string"==typeof e||Array.isArray(e)?0===e.length:(void 0===e?"undefined":_type_of(e))=="object"&&null!==e?0===Object.keys(e).length:!1},d="Blossom Master",f={},Ss=function(e){var c;return bt(e)?null!=(c=GameSDK.getSDKName())?c:"Storage":null!=e?e:"Storage"},Es=function(e){var c="".concat(d,"_").concat(e);return f[c]?Promise.resolve(f[c]):new Promise(function(l,h){var y,_=1;var i=function(v){(y=indexedDB.open(d,v)).onerror=function(e){var c=e.target.error;(null==c?void 0:c.name)==="VersionError"?i(++_):h(c)},y.onsuccess=function(e){var h=y.result;f[c]=h,l(h)},y.onupgradeneeded=function(c){var l=c.target.result;_=l.version,l.objectStoreNames.contains(e)||l.createObjectStore(e)}};i(_)})},Ct=function(e){try{return JSON.parse(e)}catch(e){return null}},vs=function(e){try{var c=localStorage.getItem(e);return null===c?null:Ct(c)}catch(e){return null}},_t=function(e){try{return JSON.stringify(e,null,0)}catch(e){return""}},bs=function(e){return Ct(_t(e))},Ra=function(){var e="vibrate"in window.navigator;if(e)try{window.navigator.vibrate(0)}catch(e){return!1}return e},Nt=function(e,c,l){var h,d=!1;return function Nt(){var f=this;for(var y=arguments.length,_=new Array(y),v=0;v<y;v++)_[v]=arguments[v];if(l&&!d){d=!0,e.apply(this,_);return}clearTimeout(h),h=setTimeout(function(){e.apply(f,_)},c)}},pe=function(e){var c=Object.create(null);return function pe(){for(var l=arguments.length,h=new Array(l),d=0;d<l;d++)h[d]=arguments[d];var f="__memoize__".concat(JSON.stringify(h));if(f in c)return c[f];var y=e.apply(this,h);return c[f]=y,y}},Tt=function(e,c,l){var h,d=!1,f=!1;return function Tt(){for(var y=arguments.length,_=new Array(y),v=0;v<y;v++)_[v]=arguments[v];if(l&&!f){f=!0,e.apply(this,_);return}d&&(d=!1,e.apply(this,_)),clearTimeout(h),h=setTimeout(function(){d=!0},c)}},$a=function(e,c){var l,h=!1;try{var d=e.value;e.value=function $a(){for(var e=arguments.length,f=new Array(e),y=0;y<e;y++)f[y]=arguments[y];return _async_to_generator(function(){var e,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:if(v.trys.push([0,4,5,6]),e=d.apply(this,f),!_instanceof(e,Promise))return[3,2];return[4,e];case 1:return y=v.sent(),[3,3];case 2:y=e,v.label=3;case 3:return[2,y];case 4:return _=v.sent(),l=_instanceof(_,Error)?_:new Error(String(_)),[3,6];case 5:return null==c||c(l),h=!0,[7];case 6:return[2]}})}).call(this)}}catch(e){l=_instanceof(e,Error)?e:new Error(String(e))}finally{h||null==c||c(l)}return e},L=function(e){var c=(void 0===e?"undefined":_type_of(e))=="object"||"function"==typeof e,l=Array.isArray(e);return null!==e&&c&&!l},xs=function(e,c){if((void 0===e?"undefined":_type_of(e))!==c)throw new Error("".concat(e," (").concat(void 0===e?"undefined":_type_of(e),") is not type of ").concat(c))},Lt=function(e,c,l){var h;return l||xs(e,c),L(e)&&l?Object.defineProperty(e,l,{get:function get(){return h},set:function set(e){xs(e,c),h=e}}):e},Fa=function(e,c){var l=e.value;return e.value=function Fa(){for(var e=arguments.length,h=new Array(e),d=0;d<e;d++)h[d]=arguments[d];return c.forEach(function(e,c){try{Lt(h[c],e)}catch(e){throw _instanceof(e,Error)?new Error("[Decorator:validateParams] ".concat(e.message)):new Error("[Decorator:validateParams] Invalid parameter type")}}),l.apply(this,h)},e},Ga=function(e,c){var l=true,h=false,d=void 0;try{for(var f,y=c[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;try{return Lt(e,_),!1}catch(e){}}}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}return!0},Ba=function(e,c){var l=e.value;return e.value=function Ba(){for(var e=arguments.length,h=new Array(e),d=0;d<e;d++)h[d]=arguments[d];var f=l.apply(this,h);if(Ga(f,c))throw new Error("[Decorator:validateReturn] ".concat(f," (").concat(void 0===f?"undefined":_type_of(f),") is not type of ").concat(c.join(" | ")));return f},e},y=function(){function K(){_class_call_check(this,K)}return _create_class(K,null,[{key:"isProperty",value:function isProperty(e,c,l){return!!(l&&(_type_of(l.value)<"u"||l.get||l.set))}},{key:"isFunction",value:function isFunction(e,c,l){return!!(l&&("function"==typeof l.value||"function"==typeof l.initializer))}},{key:"locked",value:function locked(e,c,l){return _object_spread_props(_object_spread({},l),{value:function(){throw new Error("Method is locked")}})}},{key:"tryCatch",value:function tryCatch(e){return function(c,l,h){return K.isFunction("tryCatch",l,h)?$a(h,e):h}}},{key:"debounce",value:function debounce(e){return function(c,l,h){if(!K.isFunction("debounce",l,h))return h;var d=h.value;return d?h.value=Nt(d,e):h.initializer&&(d=h.initializer,h.initializer=function(){return Nt(d.call(this),e)}),h}}},{key:"throttle",value:function throttle(e){return function(c,l,h){if(!K.isFunction("throttle",l,h))return h;var d=h.value;return d?h.value=Tt(d,e):h.initializer&&(d=h.initializer,h.initializer=function(){return Tt(d.call(this),e,!0)}),h}}},{key:"memoize",value:function memoize(e,c,l){if(!K.isFunction("memoize",c,l))return l;var h=l.value;return h?l.value=pe(h):l.initializer&&(h=l.initializer,l.initializer=function(){return pe(h.call(this))}),l}},{key:"validateValue",value:function validateValue(e){return function(c,l,h){if(!K.isProperty("validateValue",l,h))return h;try{return Lt(c,e,l)}catch(e){return h}}}}]),K}();u(y,"trace",function(e,c,l){try{var h=null!=l?l:{},d=h.value,f=h.initializer,y=h.get,_=h.set;try{if(!(y||_)){if("function"!=typeof d){if("function"==typeof f){var v=null==f?void 0:f();if("function"!=typeof v){if(!((void 0===v?"undefined":_type_of(v))<"u"))throw new Error("Initializer returned undefined")}}else if(!d)throw new Error("Unsupported decorator")}}}catch(e){}}catch(e){}finally{}return l}),u(y,"validateReturn",function(){for(var e=arguments.length,c=new Array(e),l=0;l<e;l++)c[l]=arguments[l];return function(e,l,h){return y.isFunction("validateReturn",l,h)?Ba(h,c):h}}),u(y,"validateParams",function(){for(var e=arguments.length,c=new Array(e),l=0;l<e;l++)c[l]=arguments[l];return function(e,l,h){return y.isFunction("validateParams",l,h)?Fa(h,c):h}});var _=Object.defineProperty,v=Object.getOwnPropertyDescriptor,Cs=function(e,c,l,h){for(var d,f=v(c,l),y=e.length-1;y>=0;y--)(d=e[y])&&(f=d(c,l,f)||f);return f&&_(c,l,f),f};var Ha=function(){self.onmessage=function(e){}},p=(t5=function(){function Ce1(){_class_call_check(this,Ce1),u(this,"worker",null),this.init()}return _create_class(Ce1,[{key:"init",value:function init(){var e=new Blob(["(".concat(Ha.toString(),")()")],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(e))}}],[{key:"inst",get:function get(){return this._instance||(this._instance=new t5),this._instance}},{key:"postMessage",value:function postMessage(e,c){if(!this.inst.worker)throw new Error("Worker is not initialized");this.inst.worker.postMessage({action:e,payload:c})}}]),Ce1}(),u(t5,"_instance"),t5);Cs([y.tryCatch()],p.prototype,"init"),Cs([y.tryCatch()],p,"postMessage");var Ot=function(e){if(!L(e))return e;for(var c in e)if(function(e){return null==e}(e[c]))delete e[c];else{var l=e[c];L(l)&&(e[c]=Ot(l))}return e},g=Object,$e=function(e,c){if("assign"in g)return g.assign(e,c);for(var l in c)e[l]=c[l];return e},Ns=function(e){return(void 0===e?"undefined":_type_of(e))!="object"||null===e?null:$e(e,{})},Rt=function(e,c){for(var l in c)L(e[l])&&L(c[l])?Rt(e[l],c[l]):$e(e,_define_property({},l,c[l]));return e},m={createCanvas:vt,getLocale:function(){var e=ws(bs(window.navigator.languages)||[],function(e){return e.indexOf("-")>-1});return e&&-1!==e.indexOf("-")?e.replace("-","_"):"en_US"},getLocalStorage:vs,getQueryParams:function(){var e=window.location.search.substring(1);if(!e)return{};var c=e.split("&"),l={};var h=true,d=false,f=void 0;try{for(var y,_=c[Symbol.iterator]();!(h=(y=_.next()).done);h=true){var v=y.value.split("=");l[v[0]]=decodeURIComponent(v[1])}}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}return l},getScreenHeight:function(){var e=document.body,c=document.documentElement,l=e.clientHeight;return Math.max(c.clientHeight,l)||0},getScreenWidth:function(){var e=document.body,c=document.documentElement,l=e.clientWidth;return Math.max(c.clientWidth,l)||0},writeLocalStorage:function(e,c){try{var l=vs(e);var h={};L(l)&&(h=l);var d=Ns(c);if(!L(d))return!1;var f=Ot(d),y=Rt(h,f),_=_t(y);return localStorage.setItem(e,_),!0}catch(e){return!1}},vibrate:function(e){try{return Ra()?(window.navigator.vibrate(0),window.navigator.vibrate(e),!0):!1}catch(e){return!1}},getIndexedDB:function(e,c){return _async_to_generator(function(){var l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),[4,Es(l=Ss(c))];case 1:if(!(h=f.sent()).objectStoreNames.contains(l))return[2,{}];return d=h.transaction(l,"readonly").objectStore(l),[2,new Promise(function(c,l){var h=d.get(e);h.onerror=function(){return l(h.error)},h.onsuccess=function(){return c(h.result)}})];case 2:return f.sent(),[2,{}];case 3:return[2]}})})()},WebWorker:p,setIndexedDB:function(e,c,l){return _async_to_generator(function(){var h,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:if(y.trys.push([0,2,,3]),bt(c))return[2];return[4,Es(h=Ss(l))];case 1:if(!(d=y.sent()).objectStoreNames.contains(h))return[2];return f=d.transaction(h,"readwrite").objectStore(h),[2,new Promise(function(l,h){try{var d=f.put(c,e);d.onsuccess=function(){return l()},d.onerror=function(){return h(d.error)}}catch(e){h(e)}})];case 2:return y.sent(),[3,3];case 3:return[2]}})})()},removeKeyLocalStorage:function(e){localStorage.removeItem(e)}},Ts=function(){var e;return null!=(e=Math.round(window.devicePixelRatio))?e:1},A={getPhysicPixels:function(e){return e*Ts()},isDesktop:function(){return!/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)},isMobile:function(){return/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)},isAndroid:function(){return/Android/i.test(navigator.userAgent)},isIOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},pixelRatio:Ts},Ls=function(e,c){e.__proto__.valueOf=function(){return c},e.__proto__.toString=function(){return"".concat(c)}},Ms=function(e){var c;var l=Object.keys(e);var h=true,d=false,f=void 0;try{for(var y,_=l[Symbol.iterator]();!(h=(y=_.next()).done);h=true)(function(){var l=y.value;var h=null==(c=Object.getOwnPropertyDescriptor(e,l))?void 0:c.value;if(L(h))return Ms(h),"continue";try{Ls(h,h),Object.defineProperty(e,l,{enumerable:!1,configurable:!0,get:function get(){return function(e){return e.constructor(_object_spread_props(_object_spread({},e),{__proto__:e.__proto__}))}(h)},set:function set(e){$e(h,e),Ls(h,e)}})}catch(e){}})()}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}},b={debounce:Nt,throttle:Tt,syncVars:Ms,memoize:pe,retry:function(e,c){try{return e()}catch(e){try{return c()}catch(c){throw e}}},retryAsync:function(e,c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,,7]),[4,e()];case 1:return[2,h.sent()];case 2:l=h.sent(),h.label=3;case 3:return h.trys.push([3,5,,6]),[4,c()];case 4:return[2,h.sent()];case 5:throw h.sent(),l;case 6:return[3,7];case 7:return[2]}})})()},allSettled:function(e){var c=e.map(function(e){return Promise.resolve(e).then(function(e){return{status:"fulfilled",value:e}},function(e){return{status:"rejected",reason:e}})});return Promise.all(c)},any:function(e){return"function"==typeof Promise.any?Promise.any(e):new Promise(function(c,l){var h=[];var d=0;var r=function(d){if(!(d<e.length))if(h.length>0)c(h[0]);else{var f=new Error("All promises were rejected");f.errors=h,l(f)}};e.forEach(function(e,c){e.then(function(e){h[c]=e,r(++d)}).catch(function(e){h[c]=e,r(++d)})})})},accessBlocker:function(e,c){},rng:function(e){var c=e.generate,l=e.generateSeed,h=void 0===l?function(){return 1e6*Math.random()}:l,d=e.seed;var f=void 0===d?Date.now():d;return function(){for(var e=arguments.length,l=new Array(e),d=0;d<e;d++)l[d]=arguments[d];return f=h(f),c.apply(void 0,[f].concat(_to_consumable_array(l)))}},handleAsync:function(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,e];case 1:return[2,[l.sent(),null]];case 2:return[2,[null,_instanceof(c=l.sent(),Error)?c:new Error(String(c))]];case 3:return[2]}})})()},toError:function(e){if(_instanceof(e,Error))return e;if(null!==e&&(void 0===e?"undefined":_type_of(e))=="object"&&"message"in e&&"string"==typeof e.message){var c=new Error(e.message);return"stack"in e&&"string"==typeof e.stack&&(c.stack=e.stack),"name"in e&&"string"==typeof e.name&&(c.name=e.name),"code"in e&&"string"==typeof e.code&&Object.assign(c,{code:e.code}),c}if(null!==e&&(void 0===e?"undefined":_type_of(e))=="object")try{return new Error(JSON.stringify(e,null,2))}catch(c){return new Error("[Object conversion failed] ".concat(String(e)))}return new Error(String(e))}},Os=function(e){var c={};for(var l in e)c[e[l]]=l;return c},D=pe(function(e,c){var l=e.toLowerCase();if("string"==typeof e){var h=c[l];if("string"==typeof h)return h}return"?"}),k=pe(function(e){var c=[],l=/:([A-Z0-9?]+)/gm;var h=null;for(;null!==(h=l.exec(e));)c.push(h[1]);return c}),E=pe(function(e){var c=[],l=/(\d+[A-Z?]|[A-Z?])/gm;var h=null;for(;null!==(h=l.exec(e));)(function(){var e=h[0];if(e.length>=2){var l=e.length,d=e.slice(0,l-1),f=e[l-1],y=Et(+d).map(function(){return f});return c.push.apply(c,_to_consumable_array(y)),"continue"}c.push(e)})();return c}),ye=function(e,c){return L(e)?"function"==typeof Object.hasOwn?Object.hasOwn(e,c):Object.prototype.hasOwnProperty.call(e,c):!1},Rs=function(e){return"string"==typeof e},T=pe(function(e,c){if(!L(c)||!ye(c,e))return"?";var l=c[e];return"string"==typeof l?"".concat(l.toUpperCase()):"?"}),ks=function(e,c,l){var h="";if(!L(e))return h;var d="",f=1;for(var y in e)if(ye(e,y)){var _=e[y];if(L(_)){h+=":".concat(ks(_,c,!0));continue}if(Rs(_)){var v=T(_,c);v===d?(f++,h=h.slice(0,-2)):f=1,h+="".concat(f).concat(v),d=v}}return h.replace(/1([A-Z])/g,"$1")},O={},Xe=function(e){return O[e]||(O[e]={}),O[e]},$s=function(e,c){var l=Xe(c),h=Object.keys(l).length;l[e]=h+1},hr=function(e,c){var l=Object.keys(c);return 0===(l=l.filter(function(c){return e.indexOf(c)>-1&&e!==c})).length?null:l.sort(function(e,c){return c.length-e.length})[0]},fr=function(e){var c={};for(var l in e)c[e[l]]=l;return c},M={decodeMap:function(e,c){var l=Os(c),h={};var d=0,f=0;var y=k(e);var _=true,v=false,p=void 0;try{for(var g,m=y[Symbol.iterator]();!(_=(g=m.next()).done);_=true){var A=g.value;d=0,h[++f]||(h[f]={});var b=E(A);var T=true,O=false,M=void 0;try{for(var R,F=b[Symbol.iterator]();!(T=(R=F.next()).done);T=true){var G=R.value;d++;var B=D(G,l);h[f][d]=B}}catch(e){O=true,M=e}finally{try{if(!T&&null!=F.return)F.return()}finally{if(O)throw M}}}}catch(e){v=true,p=e}finally{try{if(!_&&null!=m.return)m.return()}finally{if(v)throw p}}return h},encodeMap:ks,hashToString:function(e,c){try{if(!e)return"";if(c){var l=atob(e);var h=btoa(c);return l=l.replace(h,"="),atob(l)}return atob(e)}catch(e){return""}},stringToHash:function(e,c){try{if(!e)return"";if(c){var l=btoa(e);var h=btoa(c);return l=l.replace("=",h),btoa(l)}return btoa(e)}catch(e){return""}},lwzCompress:function(e,c,l){var h=arguments.length>2&&void 0!==l?l:1;var d=e[0];var f=[];var y=Xe(h);if(c)for(var _ in c)$s(_,h);for(var v=1;v<e.length;v++){var p=e[v],g="".concat(d).concat(p);d=e[++v],void 0===y[g]&&($s(g,h),y=Xe(h))}d=e[0];var m=1,A=0;for(;m<e.length;){var b=e[m],D="".concat(d).concat(b),k=hr(e.slice(A),y);if(null!==k){f.push(y[k]),m+=k.length-D.length,d="",A=m+1,m++;continue}void 0===y[D]?d=D:(f.push(y[D]),d="",A=m+1),m++}return f},lwzDecompress:function(e,c,l){var h=arguments.length>2&&void 0!==l?l:1;var d="",f="",y=Xe(h);c&&(y=_object_spread({},c,y));var _=fr(y);for(var v in e){var p=e[v];void 0!==_[p]?d=_[p]:d="?",f+=d}return f}};var R=new Image;var F=vt({type:"auto",contextType:"2d",contextAttributes:{willReadFrequently:!0}}),G=vt({contextType:"2d",contextAttributes:{willReadFrequently:!0}}),B=G.canvas,U=G.context,vr=function(e,c){if(isNaN(e)||isNaN(c))throw new Error("width and height must be numbers");return{string:"+",style:"font-size: 1px; padding: ".concat(Math.floor(c/2),"px ").concat(Math.floor(e/2),"px;")}},V={base64ToFile:function(e,c){var l=e.split(","),h=l[0].match(/:(.*?);/);if(!h)return null;var d=h[1],f=atob(l[l.length-1]);var y=f.length;var _=new Uint8Array(y);for(;y--;)_[y]=f.charCodeAt(y);return new File([_],c,{type:d})},blobToDataImage:function(e){return new Promise(function(c,l){var h=new FileReader;h.onloadend=function(){return c(h.result)},h.onerror=l,h.readAsDataURL(e)})},blobToHtmlImage:function(e,c,l){var h=arguments.length>1&&void 0!==c?c:!0,d=arguments.length>2&&void 0!==l?l:!0;return new Promise(function(c){h&&(R=new Image),R.onload=function(){c(R),d&&URL.revokeObjectURL(R.src)},R.onerror=function(){c(null)},R.src=URL.createObjectURL(e)})},blobUrlToFile:function(e,c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){switch(h.label){case 0:return[4,fetch(e).then(function(e){return e.blob()}).catch(function(){return null})];case 1:return[2,(l=h.sent())?new File([l],c):null]}})})()},elementToBase64:function(e,c){var l=arguments.length>1&&void 0!==c?c:"png";return _async_to_generator(function(){var c,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(c=e.width,h=e.height,!c||!h)throw new Error("Element has no width or height");if(!F)throw new Error("Failed to create canvas");if(F.canvas.width=c,F.canvas.height=h,F.context.drawImage(e,0,0,c,h),_instanceof(F.canvas,HTMLCanvasElement))return[2,F.canvas.toDataURL("image/".concat(l),.85)];return[4,F.canvas.convertToBlob({type:"image/".concat(l)})];case 1:return[2,function(e){return _async_to_generator(function(){return _ts_generator(this,function(c){return[2,new Promise(function(c,l){var h=new FileReader;h.onload=function(){return c(h.result)},h.onerror=l,h.readAsDataURL(e)})]})})()}(d.sent())]}})})()},elementToBlob:function(e,c){var l=arguments.length>1&&void 0!==c?c:"png";return _async_to_generator(function(){return _ts_generator(this,function(c){try{return[2,(B.width=e.width,B.height=e.height,U.drawImage(e,0,0,e.width,e.height),_instanceof(B,HTMLCanvasElement)?new Promise(function(e){B.toBlob(function(c){return e(c)},"image/".concat(l),.9)}):B.convertToBlob({type:"image/".concat(l),quality:.9}))]}catch(e){return[2,null]}})})()},fetchImage:function(e){return _async_to_generator(function(){var c,l;return _ts_generator(this,function(h){switch(h.label){case 0:if(!e)throw new Error("url is empty");h.label=1;case 1:return h.trys.push([1,4,,5]),[4,fetch(e)];case 2:if(!(c=h.sent()).ok)throw new Error("Network response was not ok");return[4,c.blob()];case 3:return[2,h.sent()];case 4:throw _instanceof(l=h.sent(),Error)?l:new Error("Failed to fetch image");case 5:return[2]}})})()},loadImage:function(e){return _async_to_generator(function(){return _ts_generator(this,function(c){return[2,new Promise(function(c,l){e||l(new Error("url is empty"));var h=new Image;h.crossOrigin="anonymous",h.onload=function(){c(h)},h.onerror=function(e){l(e)},h.src=e})]})})()},logImage:function(e,c){var l=arguments.length>1&&void 0!==c?c:1;var h=new Image;h.onload=function(){vr(this.width*l,this.height*l)},h.src=e}},W={Mark:(t6=function(){function _e1(){_class_call_check(this,_e1),u(this,"perf",null)}return _create_class(_e1,null,[{key:"inst",get:function get(){return this._inst||(this._inst=new t6),this._inst}},{key:"setService",value:function setService(e){this.inst.perf=null!=e?e:null}},{key:"measure",value:function measure(e){var c;null==(c=this.inst.perf)||c.measure(e)}},{key:"start",value:function start(e){var c;null==(c=this.inst.perf)||c.start(e)}},{key:"stop",value:function stop(e){var c;try{null==(c=this.inst.perf)||c.stop(e)}catch(e){}}},{key:"putMetric",value:function putMetric(e,c,l){var h,d=arguments.length>2&&void 0!==l?l:Date.now();null==(h=this.inst.perf)||h.putMetric(e,c,d)}},{key:"incMetric",value:function incMetric(e,c,l){var h,d=arguments.length>2&&void 0!==l?l:1;null==(h=this.inst.perf)||h.incrementMetric(e,c,d)}},{key:"putAttr",value:function putAttr(e,c,l){var h;var d=l.slice(0,100);null==(h=this.inst.perf)||h.putAttr(e,c,d)}},{key:"rmAttr",value:function rmAttr(e,c){var l;null==(l=this.inst.perf)||l.removeAttr(e,c)}}]),_e1}(),u(t6,"_inst"),t6)},$t=function(e,c){var l=c?Math.random()>.5?1:-1:1;return Math.floor(Math.random()*e)*l},Fs=function(e){if(e.indexOf(".")<0)return e;for(var c=e.length-1;c>=0;c--){if("."===e[c])return e.substring(0,c);if("0"!==e[c])return e.substring(0,c+1)}return e},q={getShortNumber:function(e,c){if("number"!=typeof e)return"0";var l=Math.pow(10,c);var h=e,d=0;for(;h>=l;)h=Math.floor(h/1e3),d++;var f=h.toString(),y=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qad","Qid","Sxd","Spd"][d];return"".concat(f).concat(y)},sign:function(e){return e>0?1:e<0?-1:0===e?0:NaN},padEnd:function(e,c,l){var h=arguments.length>2&&void 0!==l?l:"0";var d=e.toString();var f=d.length;for(var y=0;y<c-f;y++)d+=h;return d},padStart:function(e,c,l){var h=arguments.length>2&&void 0!==l?l:"0";var d=e.toString();var f=d.length;for(var y=0;y<c-f;y++)d=h+d;return d},random:$t,toAbbreviatedString:function(e,c){var l=c||{},h=l.fractionalDigits,d=void 0===h?0:h,f=l.startAbbreviate,y=l.abbreviateStep,_=void 0===y?3:y,v=l.maxLength,p=void 0===v?-1:v,g=l.removeLastZero,m=void 0===g?!0:g,A=l.suffixes,b=void 0===A?["","k","m","b","t","q"]:A,D=-1===p?0x5f5e0ff:p;if(e>=(void 0===f?1e3:f)){var k=Math.floor(e/Math.pow(10,_)),E=Math.floor((k.toString().length-1)/_)+1,T=(e/Math.pow(Math.pow(10,_),E)).toFixed(d),O=D-b[E].length,M=T.substring(0,O);return(m?Fs(M):M)+b[E]}var R=e.toFixed(d),F=D-b[0].length,G=R.substring(0,F);return m?Fs(G):G+b[0]}},Gs=function(e){var c=e.replace(/[-_\s.]+(.)?/g,function(e,c){return c?c.toUpperCase():""});return c.substring(0,1).toLowerCase()+c.substring(1)},Ft=function(e){var c={};for(var l in e){var h=e[l],d=Gs(l);Array.isArray(h)?c[d]=h.map(function(e){return(void 0===e?"undefined":_type_of(e))=="object"?Ft(e):e}):(void 0===h?"undefined":_type_of(h))=="object"?c[d]=Ft(h):c[d]=e[l]}return c},Bs=function(e,c){var l={};for(var h in c)if(ye(c,h))if(L(c[h])&&null!==c[h])if(L(e[h])&&null!==e[h]){if("function"==typeof c[h])continue;var d=Bs(e[h],c[h]);Object.keys(d).length>0&&(l[h]=d)}else ye(e,h)||(l[h]=$e({},c[h]));else ye(e,h)||(l[h]=c[h]);return l},Us=function(e){return["string","number","symbol"].indexOf(void 0===e?"undefined":_type_of(e))>-1},Vs=function(e){return e.replace(/([a-z])([A-Z])/g,"$1_$2").replace(/\s+/g,"_").toLowerCase()},Gt=function(e){var c={};for(var l in e){var h=e[l],d=Vs(l);Array.isArray(h)?c[d]=h.map(function(e){return(void 0===e?"undefined":_type_of(e))=="object"?Gt(e):e}):(void 0===h?"undefined":_type_of(h))=="object"?c[d]=Gt(h):c[d]=e[l]}return c},Y={assign:$e,camelCaseKeys:Ft,clone:Ns,clear:Ot,hasOwn:ye,invert:Os,keyBy:function(e,c){var l={};var h=true,d=false,f=void 0;try{for(var y,_=e[Symbol.iterator]();!(h=(y=_.next()).done);h=true){var v=y.value;var p=v[c];Us(p)&&(l[p]=v)}}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}return l},merge:Rt,snakeCaseKeys:Gt,vals:function(e){return Object.keys(e).map(function(c){return e[c]})},filterDeep:Bs};var $=function(e){function Bt(e){var c,l=arguments.length>0&&void 0!==e?e:"Signal aborted with no reason";return _class_call_check(this,Bt),(c=_call_super(this,Bt,[l])).name="SignalAbortedStopped",c}return _inherits(Bt,e),Bt}(_wrap_native_super(Error));var Z=function(){function Ze(){_class_call_check(this,Ze),u(this,"state",{type:"running"}),u(this,"callbacks",[])}return _create_class(Ze,[{key:"once",value:function once(e){this.callbacks.push(e)}},{key:"off",value:function off(e){this.callbacks=this.callbacks.filter(function(c){return c!==e})}},{key:"abort",value:function abort(e){var c=this.constructReason(e);this.state={type:"stopped",reason:c};var l=true,h=false,d=void 0;try{for(var f,y=this.callbacks[Symbol.iterator]();!(l=(f=y.next()).done);l=true)(0,f.value)(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.callbacks=[]}},{key:"aborted",get:function get(){return"stopped"===this.state.type}},{key:"reason",get:function get(){if("stopped"===this.state.type)return this.state.reason}},{key:"wrap",value:function wrap(e){if(!this.aborted)return e}},{key:"chain",value:function chain(e){var c=this;_instanceof(e,Ze)?e.once(function(e){return c.abort(e)}):e.addEventListener("abort",function(){return c.abort(e.reason)},{once:!0})}},{key:"promise",value:function promise(){var e=this;return this.aborted?Promise.resolve(this.reason):new Promise(function(c){e.once(function(e){return c(e)})})}},{key:"constructReason",value:function constructReason(e){return _instanceof(e,Error)?e:"string"==typeof e?new $(e):new $}}]),Ze}();var ee=function(){function Fr(){_class_call_check(this,Fr),u(this,"signal")}return _create_class(Fr,[{key:"renew",value:function renew(){var e;null==(e=this.signal)||e.abort();var c=new Z;return this.signal=c,c}},{key:"abort",value:function abort(){var e;null==(e=this.signal)||e.abort()}},{key:"promise",value:function promise(){return void 0===this.signal?Promise.resolve(void 0):this.signal.promise()}}]),Fr}();var en=Object.freeze(Object.defineProperty({__proto__:null,Signal:Z,SignalAbortedError:$,SignalController:ee},Symbol.toStringTag,{value:"Module"}));function Ur(e,c){var l=arguments.length>1&&void 0!==c?c:2;var h=[],d=e.split(" "),f=d.length;for(var y=f;y>=1;y--)for(var _=0;_<=f-y;_++){var v=d.slice(_,_+y).join(" ");e.split(v).length-1>=l&&h.indexOf(v)<0&&v.length>1&&h.push(v)}return h.sort(function(e,c){return e.length-c.length})}(function(){var e=("undefined"==typeof document?"undefined":_type_of(document))<"u"&&document.createElement("link").relList;e&&e.supports&&e.supports("modulepreload")})();var ie=function(e,c,l){function r(e){var c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=e,window.dispatchEvent(c),!c.defaultPrevented)throw e}return Promise.resolve().then(function(c){var l=true,h=false,d=void 0;try{for(var f,y=(c||[])[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;"rejected"===_.status&&r(_.reason)}}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}return e().catch(r)})};var er=null;var ea={toCamelCase:Gs,toUpperCamelCase:function(e){var c=e.replace(/[-_\s.]+(.)?/g,function(e,c){return c?c.toUpperCase():""});return c.substring(0,1).toUpperCase()+c.substring(1)},capitalize:function(e){return e&&e[0].toUpperCase()+e.slice(1)},generateObjectId:function(e){var c=arguments.length>0&&void 0!==e?e:16;var t=function(e){return Math.floor(e).toString(c)};return t(Date.now()/1e3)+Array(c+1).join(" ").replace(/./g,function(){return t(Math.random()*c)})},getLanguageCode:function(e){var c=e?e.split("_"):[];var l=c.length>0?c[0]:"en_US";switch(l){case"id":case"in":l="id";break}return l},getShortName:function(e,c){var l=e.split(" "),h=(l.length<=1?_to_consumable_array(l):[l[0],l.pop()]).join(" "),d=h.lastIndexOf(" ")||0,f=d>=0?d:c;return(h.length>c?h.substring(0,f):h).substring(0,c)},hashCode:function(e){var c=0;if(0===e.length)return c;for(var l=0;l<e.length;l++)c=(c<<5)-c+e.charCodeAt(l),c&=c;return c},matchStart:function(e,c){for(var l=0;l<c.length;l++)if(e[l]!==c[l])return!1;return!0},padStart:function(e,c,l){var h=arguments.length>2&&void 0!==l?l:" ";var d=Math.floor(c);if(e.length>=d)return e;var f=d-e.length;var y="";for(var _=0;_<f;_++)y+=h;return y.slice(0,f)+e},params:function(e){return Object.keys(e).reduce(function(c,l){var h=e[l];return void 0!==h&&c.push("".concat(l,"=").concat(h)),c},[]).join("&")},random:function(e,c){var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*#%&!";var h="",d=e;void 0!==c&&(d-=c.length,h+=c);for(var f=0;f<d;f++){var y=Math.floor(Math.random()*l.length);h+=l.charAt(y)}return h},randomColor:function(e){var c=arguments.length>0&&void 0!==e?e:"0x";var l=c;for(var h=0;h<6;h++)l+="0123456789ABCDEF"[Math.floor(16*Math.random())];return l},removeDiacritics:function(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,function(e){return"đ"===e?"d":"D"})},findDuplicateSubstrings:Ur,generateNameAsync:function(){return _async_to_generator(function(){var e,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(d.trys.push([0,3,,4]),!(e=!er))return[3,2];return[4,function(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,ie(function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,c.import("./bundle/names-surnames.js")];case 1:return[2,{default:e.sent().default}]}})})()},void 0,c.meta.url)];case 1:if(!L(e=l.sent().default)||!ye(e,"data")||!Array.isArray(e.data))throw new Error("Invalid names-surnames.json");return er=e.data,[2]}})})()}()];case 1:d.sent(),e=!er,d.label=2;case 2:if(e)throw new Error("Cannot fetch names");return l=er[$t(er.length)],h=er[$t(er.length)],[2,"".concat(l," ").concat(h)];case 3:return d.sent(),[2,"Anonymous"];case 4:return[2]}})})()},toSnakeCase:Vs},es=[60,3600,86400,604800,2592e3,31536e3,1/0],ei=["second","minute","hour","day","week","month","year"],eo={isToday:function(e){var c=new Date(e),l=new Date;return c.getDate()===l.getDate()&&c.getMonth()===l.getMonth()&&c.getFullYear()===l.getFullYear()},sleepAsync:function(e){return new Promise(function(c){return setTimeout(c,e)})},getRelativeTime:function(e,c,l,h){var d=arguments.length>3&&void 0!==h?h:"Soon";try{var f=Math.round((1e3*e-Date.now())/1e3),y=Math.abs(Math.round((1e3*e-Date.now())/1e3)),_=Ds(es,function(e){return e>y}),v=_?es[_-1]:1;return new Intl.RelativeTimeFormat(null!=c?c:"en",null!=l?l:{numeric:"auto"}).format(Math.floor(f/v),ei[_])}catch(e){if(void 0!==d)return"Soon";throw e}},getTimeString:function(e){var c=new Date(e),l=c.getUTCHours(),h=c.getUTCMinutes(),d=c.getUTCSeconds(),f=c.getUTCMilliseconds();var y="".concat(f);return f<10?y="00".concat(f):f<100&&(y="0".concat(f)),"".concat(l<10?"0".concat(l):"".concat(l),":").concat(h<10?"0".concat(h):"".concat(h),":").concat(d<10?"0".concat(d):"".concat(d),":").concat(y)}},js=function(e){return"function"==typeof e},ec={isBoolean:function(e){return"boolean"==typeof e},isDebugger:function(){var e,c;return!!(null!=(c=null==(e=window.game)?void 0:e.player)&&c.getPlayerDataByKey("debug"))},isEmpty:bt,isFalsy:Is,isFunction:js,isNumber:function(e){return"number"==typeof e},isObject:L,isPromise:function(e){return js(e)?_instanceof(e,Promise)||"then"in e&&"function"==typeof e.then?!0:"AsyncFunction"===e.constructor.name:!1},isPropertyKey:Us,isString:Rs,isValueChangeAsync:function(e,c,l){var h,d,f=null!=l?l:{},y=f.timeout,_=void 0===y?1e3:y,v=f.checkInterval,p=void 0===v?16:v;return new Promise(function(l,f){if("function"!=typeof e)throw new Error("Input from must be a function");d=setInterval(function(){e()===("function"==typeof c?c():c)&&(clearTimeout(h),clearInterval(d),l(!0))},p),_>0&&(clearTimeout(h),h=setTimeout(function(){clearInterval(d),f(new Error("Timeout"))},_))})}},eu={Array:h,Browser:m,Decorator:y,Device:A,Function:b,Hash:M,Image:V,Json:{clone:bs,decode:Ct,encode:_t},Mark:W.Mark,Object:Y,Signal:en,String:ea,Number:q,Time:eo,Valid:ec};var eh={AppId:"blossom-master",AppDescription:"Blossom Master: A relaxing puzzle game where you connect colorful flowers, unwind, and enjoy stunning backgrounds!",ApiHost:"https://fbig-singleplay-apps.citigo.site",OtherHost:"https://fbig-leaderboards.citigo.site",Ads:{Enabled:!0,PreloadAds:!0,NotifyPlayerBeforeShow:!1,ShowAdOnLoad:{Enabled:!1,DelaySeconds:0,PlacementId:"interstitial_demo"},DegradationTracking:{ResetTimeMinutes:5,MaxFailedAttempts:8},AdServiceConfigs:{AdSense:{Enabled:!0,UsePreload:!0,DataAdClient:"ca-pub-2993382360222769",DataAdChannel:"9496027312",DataAdBreakTest:!1,DataAdFrequencyHint:30},Savana:{Enabled:!1,UsePreload:!1,DataAdClient:"ca-pub-1234567890",DataAdChannel:"1234567890",DataAdBreakTest:!1,DataAdFrequencyHint:45,BannerAdSlotId:"1234567890"},AppLovin:{Enabled:!1,UsePreload:!1}},InterstitialAdOptions:[{AdService:"platform",PlacementId:"interstitial_demo",SecondsFirstTime:45,SecondsBetweenAds:90,Platform:"ALL"},{AdService:"adsense",PlacementId:"interstitial_adsense",SecondsFirstTime:45,SecondsBetweenAds:90,Platform:"ALL"}],RewardedVideoAdOptions:[{AdService:"platform",PlacementId:"rewarded_video_demo",SecondsFirstTime:0,SecondsBetweenAds:0,Platform:"ALL"},{AdService:"adsense",PlacementId:"rewarded_video_adsense",SecondsFirstTime:0,SecondsBetweenAds:0,Platform:"ALL"}],RewardedInterstitialAdOptions:[],BannerDisplayAdOptions:[{AdService:"platform",PlacementId:"banner_demo",Position:"bottom",BannerHeight:50,SecondsReload:60,Platform:"IOS"},{AdService:"platform",PlacementId:"banner_demo",Position:"bottom",BannerHeight:50,SecondsReload:60,Platform:"ANDROID"},{AdService:"platform",PlacementId:"banner_demo",Position:"bottom",BannerHeight:50,SecondsReload:60,Platform:"ALL"}]},Languages:{DetectPlayerLocale:!0},GameSDKOptions:{AllowWithoutSDK:!0,MSGames:{LoginOnStart:!1,MaxLoginAttemptsPerDay:1,ScheduleNotification:{D1:"Start your week calmly. \uD83D\uDE0C Match blossoms in Blossom Master and melt away the Monday stress!",D2:"Need a peaceful pause? Your beautiful flowers are waiting! \uD83C\uDF37 Dive in now!",D3:"Mid-week recharge! ✨ New challenge awaits in the serene gardens of Blossom Master.",D4:"Plan your connections! \uD83C\uDFAF Sharpen your strategy & enjoy a stunning puzzle break.",D5:"The weekend is here! \uD83C\uDF89 Unwind with Blossom Master. Pure, blooming fun!",D6:"Lazy morning? ☕ Perfect time for Blossom Master levels at your own pace.",D7:"Recharge your mind! Let the relaxing puzzles of Blossom Master soothe your spirit."}},Yandex:{LoginOnStart:!1,MaxLoginAttemptsPerDay:1},TranssionH5:{GaId:"G-XXXXXXXXXX"}},Core:{InitAsync:!1,AverageLoadTime:3,StartSDKAfterLoadGame:!0,FastCheckTournamentContext:!1},GameEngine:{ForceDesktopDPR:2,AutoResizeCanvas:!0,PreferredFPS:{Mobile:60,Desktop:60},DynamicAtlas:{IOS:{Enabled:!0,AutoAtlasSize:!0,MaxAtlasCount:2,MaxAtlasSize:4096,MaxFrameSize:2048},Android:{Enabled:!0,AutoAtlasSize:!0,MaxAtlasCount:2,MaxAtlasSize:4096,MaxFrameSize:2048},Desktop:{Enabled:!0,AutoAtlasSize:!0,MaxAtlasCount:2,MaxAtlasSize:4096,MaxFrameSize:2048},UsePowerOfTwo:!1,TextureBleeding:!0,AllowNonePackable:!1,TextureAtlasOptimize:!0,OnlyOptimizeWhenRenderTooLong:!0},DynamicAssets:{Enabled:!0,Debug:!1,Resolution:{Adjust:2,Original:2},Compression:{PNG:{quality:50,dither:.6,palette:!0,compressionLevel:8},JPEG:{quality:50,mozjpeg:!0},WEBP:{quality:35,lossless:!1,alphaQuality:40,smartSubsample:!0,preset:"drawing"}},IgnoreFiles:["37269e95-7e32-4b0d-9519-93f713f9e413","8831a276-3376-4cba-9575-25e22ccdcf94","17ad5fe74","1de5bed3d"]},HybridFileCache:{Enabled:!1,BuildMode:{Enabled:!1,SupportedExtensions:[".json",".cconb"]},PreviewMode:{Enabled:!1,CacheScene:!1,CachePrefab:!1,CacheUuidExtension:!1,SupportedExtensions:[".json",".cconb"]}}},Gameplay:{StartAdAtLevel:4,MaxRescueCount:1,Tutorial:{Enabled:!0,ForceUseTutorial:!1}},Firebase:{Enabled:!1,Options:{AppId:"",ApiKey:"",ProjectId:"",AuthDomain:"",StorageBucket:"",MeasurementId:"",MessagingSenderId:""},Services:{Analytics:{Enabled:!1},Performance:{Enabled:!1},RemoteConfig:{Enabled:!1}}},Analytics:{GoogleAnalytics:{Enabled:!0,ConsoleLog:!0},ClarityAnalytics:{Enabled:!1,ConsoleLog:!1,ScreenshotCanvas:{Interval:1500,ByEvent:["APP_READY","PAGE_VIEW","BUTTON_CLICK","AD_SHOWING","LEVEL_START","LEVEL_END"]}},FirebaseAnalytics:{Enabled:!1,ConsoleLog:!1},FacebookAnalytics:{Prefix:"fba",Enabled:!0,ConsoleLog:!1}},PerformanceMonitor:{CoreFlows:!0,EngineFlows:!0,FpsTracking:{Enabled:!0,TrackingDuration:60,TrackingInterval:10},LoadResources:!0},RemoteConfig:{Enabled:!1,Options:{ForceReloadGame:!1,FetchIntervalInSeconds:300},ServiceType:"mockup",DefaultConfigId:"default",SupportedDataTypes:["GameCore","Gameplay"],MockupConfig:{Enabled:!0},SelfHostedConfig:{Enabled:!1,AppId:"",ApiKey:"",ApiUrl:""}},Network:{MaximumRequest:6,Timeout:15e3,Retries:3},Leaderboards:{LeaderboardList:[]},Notification:{Enabled:!1,ApiUrl:"https://notifications.sunstudio.io"},DailyRewards:{MaxDays:7,MockTime:0,CheckInterrupt:!1},Mockup:{Ads:{Enabled:!1,ErrorRate:0,GiphyApiKey:"VmjHIRsfrwCAssDS4mDo9DoImxJm1lLM",SafeAreaBottom:0},Match:{Enabled:!1,ErrorRate:5,PlayerInfo:{Id:"player-mock",Name:"Player Mock",Photo:"",Signature:""},OpponentInfo:{Id:"opponent-mock",Name:"Opponent Mock",Photo:"",Signature:""}},GameSDK:{SlowAPI:{Enabled:!1,ErrorRate:5,StartDelay:1e3,InitialDelay:1e3,PlayerDataDelay:1e3},Context:{Enabled:!1},Player:{SubscribeBot:{Enabled:!1,CanSubscribeBot:!0},ConnectedPlayers:{Enabled:!1,ErrorRate:5,RandomDelayMs:1e3,AvatarUrl:"https://picsum.photos/seed/%1/300/300",NumOfPlayers:3}},AddShortcut:{Enabled:!1},Tournament:{Enabled:!1,ErrorRates:5,RandomDelayMs:1e3,NumOfTournament:{Normal:10,HostPage:2}},Payments:{Enabled:!1,ErrorRates:5,RandomDelayMs:1e3,Products:[]}},Profile:{Enabled:!1,ErrorRate:5,RandomDelayMs:1e3,AvatarUrl:"https://picsum.photos/seed/%1/300/300"},Leaderboards:{Enabled:!1,MinScore:10,MaxScore:100,ErrorRate:5,NumOfLeaders:{Min:10,Max:50},DefaultLimit:60,RandomDelayMs:1e3},LoadingScreen:{Enabled:!1}},Debugger:{Console:{Enabled:!1},Profiler:{Enabled:!1},EventLogging:{Enabled:!1},CanvasRecorder:{Enabled:!1,OnlyCore:!1,PanelExpanded:!1,Options:{Type:"png",Quality:.85,RecordFps:60,SyncFps:!0}},MonitorError:{Enabled:!1,ApiKey:"42ae876bf59de4ed39e175d4e4cf8d66",Service:"BugSnag",TrackUser:!0,TrackPerformance:!1,FilterErrors:{Codes:{Accepted:[],Ignored:["USER_INPUT","NETWORK_FAILURE"]},Messages:{Accepted:[],Ignored:["Load image failed"]}},Feedback:!1},ListPlayerDevIds:["7593324287354506","7039880282760641","7464254310262457","6720648958044892"]},AdaptivePerformance:{Enabled:!1,Quality:{Min:1,Max:2,AdjustStep:.1},Options:{FpsThreshold:48,CheckInterval:2e3,AutoUpgradeQuality:!0,OnlyUpdateWhenSwitchScene:!1},TrackingSceneNames:["GameScene"]},FrameCapture:{Enabled:!1,Options:{Quality:.85,RenderType:"jpeg",UseBlobIfPossible:!0,FallbackWithWideframe:"Default"},WideframeConfigs:{ShareScore:{Width:1500,Height:2e3,Wideframe:"./public/wideframes/share-score.png",RenderOptions:{}},ShareLeaderboard:{Width:1500,Height:2e3,Wideframe:"./public/wideframes/share-leaderboard.png",RenderOptions:{}},UpdateChallenge:{Width:952,Height:492,Wideframe:"./public/wideframes/update-challenge.png",RenderOptions:{}},ResultChallenge:{Width:952,Height:492,Wideframe:"./public/wideframes/result-challenge.png",RenderOptions:{}}}}};var ed=Object.preventExtensions({Dtos:{},Utils:Object.freeze(eu),Match:Object.freeze({Modes:Object.freeze(l)}),Events:Object.freeze(e),Configs:Object.seal(eh),Plugins:Object.seal({Ads:null,Audio:null,Analytics:null})});window.GameCore=ed,window.TypeGuard={asConst:function(e){return e},noop:function(){}};var ef=ed.Utils,ey=ef.Valid,e_=ef.Object,ev=ef.String,ep=ef.Json,eg="is invalid",em=function(){function re(e){_class_call_check(this,re),this.defaultData(),this.processData(e)}return _create_class(re,[{key:"processData",value:function processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}},{key:"defaultData",value:function defaultData(){var e=this.constructor.name;this.lazyDefaultData(re.data[e])}},{key:"lazyDefaultData",value:function lazyDefaultData(e){for(var c in ey.isObject(e)||this.exception("data",eg),e)if(e_.hasOwn(e,c)){var l=e[c];e_.assign(this,_define_property({},c,l))}}},{key:"lazyValidateStructure",value:function lazyValidateStructure(e){ey.isObject(e)||this.exception("structure","is not object");var c=this.getKeys();var l=true,h=false,d=void 0;try{for(var f,y=c[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;var v=this[_];void 0===v&&this.exception("structure","has no key ".concat(_)),e_.hasOwn(e,_)||void 0===v||this.setDefaultData(_,e)}}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}}},{key:"setDefaultData",value:function setDefaultData(e,c){ey.isObject(c)||this.exception("data",eg);var l=this[e];void 0===l&&this.exception("default","has no key ".concat(e)),e_.assign(c,_define_property({},e,l))}},{key:"lazyValidateData",value:function lazyValidateData(e){var c=this.getKeys();var l=true,h=false,d=void 0;try{for(var f,y=c[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;var v=e[_],p=ev.removeDiacritics(_).replace(/[^a-zA-Z0-9]/g,""),g="validate".concat(ev.capitalize(p)),m=this[g];if("function"==typeof m)try{m.call(this,v)}catch(c){this.setDefaultData(_,e)}else this.exception("validate","has no function ".concat(g))}}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}}},{key:"lazySetupData",value:function lazySetupData(e){var c=this.getKeys();var l=true,h=false,d=void 0;try{for(var f,y=c[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;var v=e[_];e_.assign(this,_define_property({},_,v))}}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}}},{key:"validate",value:function validate(){this.validateData(this.toObject())}},{key:"exception",value:function exception(e,c){throw new Error("".concat(this.constructor.name,": ").concat(e," ").concat(c))}},{key:"toObject",value:function toObject(){return Object.fromEntries(Object.entries(this).filter(function(e){return"toObject"!==_sliced_to_array(e,1)[0]}))}},{key:"getKeys",value:function getKeys(){return Object.keys(this).filter(function(e){return"toObject"!==e})}}],[{key:"addDefaultData",value:function addDefaultData(e){ey.isObject(e)||this.prototype.exception("default data",eg),e=ep.clone(e);var c=this.name;ey.isObject(re.data[c])||(re.data[c]={}),re.data[c]=e_.merge(re.data[c],e)}},{key:"getDefaultData",value:function getDefaultData(){var e=this.name;return ep.clone(re.data[e])}},{key:"addValidateFunction",value:function addValidateFunction(e,c){ey.isString(e)||this.prototype.exception("validate key",eg),"function"!=typeof c&&this.prototype.exception("validate function",eg);var l="validate".concat(ev.capitalize(e));e_.assign(this.prototype,_define_property({},l,c))}}]),re}();u(em,"data",{}),ed.Dtos={Base:em};var eA={score:"score",settings:"settings",isFirstLogin:"isFirstLogin",gameData:"gameData",missionsData:"missionsData",notificationData:"notificationData",dailyRewardedData:"dailyRewardedData",lastCallSwitchGame:"lastCallSwitchGame",remoteConfig:"remoteConfig"},ew={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{score:0,isFirstLogin:!0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},notificationData:{D1:{arrivalDate:0},D2:{arrivalDate:0},D3:{arrivalDate:0},D4:{arrivalDate:0},D5:{arrivalDate:0},D6:{arrivalDate:0},D7:{arrivalDate:0}},missionsData:{process:{}},lastCallSwitchGame:0}},eb=ed.Utils.Valid,eD=ew.playerId,eS=ew.name,ek=ew.photo,eI=ew.locale,eP="is invalid";var eE=function(e){function et(){return _class_call_check(this,et),_call_super(this,et,arguments)}return _inherits(et,e),_create_class(et,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){eb.isString(e)&&e||this.exception("_id",eP)}},{key:"validatePlayerId",value:function validatePlayerId(e){eb.isString(e)&&e||this.exception("playerId",eP)}},{key:"validateName",value:function validateName(e){eb.isString(e)&&e||this.exception("name",eP)}},{key:"validatePhoto",value:function validatePhoto(e){eb.isString(e)||this.exception("photo",eP)}},{key:"validateLocale",value:function validateLocale(e){eb.isString(e)&&e||this.exception("locale",eP)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(et.prototype),"toObject",this).call(this)}}]),et}(em);eE.addDefaultData({playerId:eD,name:eS,photo:ek,locale:eI});var eC=new eE({playerId:"10",name:"Your Friend"}).toObject();var ex=function(e){function te(e){var c;return _class_call_check(this,te),u(c=_call_super(this,te,[e]),"code"),c.code="CREATE_MATCH_FAILED",c}return _inherits(te,e),te}(_wrap_native_super(Error));var eT=function(e){function I(e){var c;return _class_call_check(this,I),(c=_call_super(this,I,[e])).name="PlayerIdNotValid",c.message=null!=e?e:"Player id is not valid",c}return _inherits(I,e),I}(ex);var eN=ed.Dtos,eL=ed.Utils,eO=eL.Array,eM=eL.Object,eR=eL.Valid,eF=ed.Events;var gi=function gi(e){var c=this;_class_call_check(this,gi),u(this,"game"),u(this,"initContext",function(){var e;var l={contextId:null!=(e=GameSDK.context.getID())?e:"",contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},h=new eN.Context.Info(l).toObject(),d=h.contextId,f=h.contextType,y=h.entryPointData;c.game.context.receiveContext(d,f,y)}),u(this,"initPlayer",function(){return _async_to_generator(function(){var e,c,l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,3,4]),e=this.game.player,c=this.getPlayerInfo(),l=eO.unique(eM.vals(eA)),[4,GameSDK.player.getDataAsync(l)];case 1:return h=f.sent(),d=new eN.Player.Data(h).toObject(),e.receiveData(c,d),[3,4];case 2:return f.sent(),[3,4];case 3:return this.game.event.emit(eF.PLAYER_INFO_LOADED),[7];case 4:return[2]}})}).call(c)}),u(this,"getPlayerInfo",function(){try{var e=GameSDK.player.getID();var c=GameSDK.player.getName();var l=GameSDK.player.getPhoto();var h=GameSDK.getLocale();if(!eR.isString(e))throw new eT;return eR.isString(c)||(c="You"),eR.isString(h)&&h||(h="en"),new eN.Player.Info({playerId:e,name:c,photo:l,locale:h}).toObject()}catch(e){return eC}}),this.game=e};var eG=function(e){function jt(e,c){var l;return _class_call_check(this,jt),u(l=_call_super(this,jt,[e]),"payload"),l.name="BadRequest",l.message=null!=e?e:"This request is bad",l.payload=c,l}return _inherits(jt,e),jt}(_wrap_native_super(Error));var ej=function(e){function Kt(e,c){var l;return _class_call_check(this,Kt),u(l=_call_super(this,Kt,[e]),"payload"),l.name="RequestTimeout",l.message=null!=e?e:"This request is timeout",l.payload=c,l}return _inherits(Kt,e),Kt}(_wrap_native_super(Error));var eB=ed.Utils,eU=ed.Configs,eV=eU.AppId,eH=eU.Network,wi=function(e){if(!e.ok)throw new eG(void 0,{response:e})},zs=function(){var e=window.game.auth.getToken();return{token:e,timeout:eH.Timeout,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},qs=function(e,c,l,h){return function(){return _async_to_generator(function(){var d,f,y,_,v;return _ts_generator(this,function(p){switch(p.label){case 0:if(p.trys.push([0,3,,4]),!eV)throw new eG("AppId is not defined");return d="".concat(e,"/apps/").concat(eV,"/").concat(c),l.signal=(f=new AbortController).signal,y=setTimeout(function(){f.abort()},l.timeout),ed.Utils.Valid.isObject(h)&&(l.body=JSON.stringify(h)),[4,fetch(d,l)];case 1:return _=p.sent(),clearTimeout(y),wi(_),[4,_.json()];case 2:return[2,p.sent()||{}];case 3:if(_instanceof(v=p.sent(),eG))return[2,null];throw _instanceof(v,Object)&&"name"in v&&"AbortError"===v.name?new ej:v;case 4:return[2]}})})()}},zt=function(e,c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,1,,7]),[2,e()];case 1:if(!(_instanceof(l=h.sent(),ej)&&c>0))return[3,6];h.label=2;case 2:return h.trys.push([2,5,,6]),[4,eB.Time.sleepAsync(600)];case 3:return h.sent(),[4,zt(e,c-1)];case 4:return[2,h.sent()];case 5:return h.sent(),[2,{}];case 6:return[2,_instanceof(l,ej)?{}:{}];case 7:return[2]}})})()},Me=function(e,c,l,h){var d=arguments.length>3&&void 0!==h?h:eH.Retries;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,zt(qs(l,e,_object_spread_props(_object_spread({},zs(),c),{method:"GET"})),d)];case 1:return[2,h.sent()];case 2:return h.sent(),[2,{}];case 3:return[2]}})})()},J=function(e,c,l,h,d){var f=arguments.length>4&&void 0!==d?d:eH.Retries;return _async_to_generator(function(){return _ts_generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,zt(qs(h,e,_object_spread_props(_object_spread({},zs(),l),{method:"POST"}),c),f)];case 1:return[2,d.sent()];case 2:return d.sent(),[2,{}];case 3:return[2]}})})()},eK=ed.Configs.Notification.ApiUrl,ez=ed.Utils.Object;var eW=function(){function Si(e){_class_call_check(this,Si),u(this,"game"),u(this,"plugins"),this.game=e,this.plugins={}}return _create_class(Si,[{key:"install",value:function install(e,c,l,h){if("function"!=typeof c)return void GameSDK.getSDKName();var d=new c(this.game);this.plugins[e]=d,l&&Object.defineProperty(this.game,h,{get:function(){return d}}),d.init()}},{key:"get",value:function get(e){return this.plugins[e]}}]),Si}();var eq=function(){function Ei(e){_class_call_check(this,Ei),u(this,"game"),this.game=e}return _create_class(Ei,[{key:"init",value:function init(){}}]),Ei}();var eY={Game:function(){function vi(){_class_call_check(this,vi),u(this,"game"),u(this,"plugins"),u(this,"ads"),u(this,"auth"),u(this,"audio"),u(this,"event"),u(this,"match"),u(this,"player"),u(this,"profile"),u(this,"context"),u(this,"storage"),u(this,"language"),u(this,"missions"),u(this,"analytics"),u(this,"visibility"),u(this,"leaderboard"),u(this,"dailyRewards"),u(this,"remoteConfig"),u(this,"frameCapture"),u(this,"firebase"),u(this,"monitorError"),u(this,"adaptivePerformance"),u(this,"console"),u(this,"profiler"),u(this,"canvasRecorder"),this.game=this,this.plugins=new eW(this.game)}return _create_class(vi,[{key:"boot",value:function boot(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2]})})()}},{key:"start",value:function start(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2]})})()}},{key:"getBuildVersion",value:function getBuildVersion(){return 0}}]),vi}(),Plugins:{BasePlugin:eq}};var eJ=function(e){return e.IDLE="idle",e.LOADING="loading",e.FILLED="filled",e.SHOWING="showing",e}(eJ||{}),eQ=function(e){return e.BANNER="banner",e.INTERSTITIAL="interstitial",e.REWARDED_VIDEO="rewarded_video",e.REWARDED_INTERSTITIAL="rewarded_interstitial",e}(eQ||{});var eX=function(e){function tt(e,c){var l;return _class_call_check(this,tt),u(l=_call_super(this,tt,[c]),"code"),l.code=e,l.message=c,l}return _inherits(tt,e),tt}(_wrap_native_super(Error));var e$=function(e){function Ys(){return _class_call_check(this,Ys),_call_super(this,Ys,arguments)}return _inherits(Ys,e),_create_class(Ys,[{key:"loadAsync",value:function loadAsync(){this.exception("This method is not implemented")}},{key:"showAsync",value:function showAsync(){this.exception("This method is not implemented")}},{key:"hideAsync",value:function hideAsync(){this.exception("Unsupported method")}}]),Ys}(function(){function bi(e,c){_class_call_check(this,bi),u(this,"type"),u(this,"service"),u(this,"placementId"),u(this,"_status"),this.type=e,this._status=eJ.IDLE,this.placementId=c}return _create_class(bi,[{key:"setStatus",value:function setStatus(e){this._status!==e&&(this._status=e)}},{key:"status",get:function get(){return this._status}},{key:"exception",value:function exception(e){throw new eX("AD_INSTANCE_ERROR",e)}}]),bi}());ed.Plugins.Ads={Types:eQ,Status:eJ,AdError:eX,AdInstance:e$};var eZ=ed.Utils,e0=eZ.Array,e2=eZ.Object,e1=eZ.Function;var e3=function(e){function Ci(){var e;return _class_call_check(this,Ci),e=_call_super(this,Ci,arguments),u(e,"enabled"),u(e,"config"),u(e,"platform"),u(e,"lastCallAdShownTime"),u(e,"isAdFullSizeShowed"),u(e,"ads",{}),u(e,"safeAreaBottom"),u(e,"degradationTracking",{failedAttempts:0,lastSuccessTime:0}),e}return _inherits(Ci,e),_create_class(Ci,[{key:"init",value:function init(){var e;this.platform=GameSDK.getPlatform()||"ALL",this.lastCallAdShownTime=(_define_property(e={},eQ.BANNER,0),_define_property(e,eQ.INTERSTITIAL,0),_define_property(e,eQ.REWARDED_VIDEO,0),_define_property(e,eQ.REWARDED_INTERSTITIAL,0),e),this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom(),this.resetDegradationTracking()}},{key:"calculateSafeAreaBottom",value:function calculateSafeAreaBottom(){try{var e=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(e,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch(e){this.safeAreaBottom=0}}},{key:"configure",value:function configure(e){this.config=e,this.enabled=this.config.Enabled}},{key:"checkEnabled",value:function checkEnabled(){if(!this.enabled)throw new eX("ADS_NOT_ENABLED","Ads is't enabled")}},{key:"isAdFullSizeShowing",value:function isAdFullSizeShowing(){return this.isAdFullSizeShowed}},{key:"setAdInstance",value:function setAdInstance(e,c,l,h){if("ALL"!==h&&"ALL"!==this.platform&&h!==this.platform)return;var d="".concat(e,"-").concat(c,"-").concat(h);this.ads[d]||(this.ads[d]={type:e,placementId:c,interval:null,instance:new l(e,c)})}},{key:"loadAdAsync",value:function loadAdAsync(e,c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){switch(h.label){case 0:this.checkEnabled(),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.getAd(e,c).instance.loadAsync()];case 2:return h.sent(),[3,4];case 3:throw l=h.sent(),this.degradationTracking.failedAttempts++,l;case 4:return[2]}})}).call(this)}},{key:"showAdAsync",value:function showAdAsync(e,c){return _async_to_generator(function(){var l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(this.checkEnabled(),!this.canShowAd(e,c))return[2];l=this.game.event,h=this.getAd(e,c),f.label=1;case 1:return f.trys.push([1,3,4,5]),l.emit(ed.Events.AD_SHOWING,{type:e,placementId:c}),this.isAdFullSizeShowed=!0,[4,h.instance.showAsync()];case 2:return f.sent(),this.resetDegradationTracking(),this.lastCallAdShownTime[e]=Date.now()/1e3,[3,5];case 3:throw d=f.sent(),this.degradationTracking.failedAttempts++,d;case 4:return l.emit(ed.Events.AD_CLOSED,{type:e,placementId:c}),this.isAdFullSizeShowed=!1,[7];case 5:return[2]}})}).call(this)}},{key:"getAdStatus",value:function getAdStatus(e,c){this.checkEnabled();try{return this.getAd(e,c).instance.status}catch(e){return!1}}},{key:"getAd",value:function getAd(e,c){var l=null;if(c?l=this.getAdByPlacementId(c,e):l=this.getPriorityAdByType(e),!l)throw new eX("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return l}},{key:"getAdsByType",value:function getAdsByType(e){return e2.vals(this.ads).filter(function(c){return c.type===e})}},{key:"getAdByPlacementId",value:function getAdByPlacementId(e,c){var l=e2.vals(this.ads);return e0.search(l,function(l){return l.placementId===e&&(!c||l.type===c)})||null}},{key:"getPriorityAdByType",value:function getPriorityAdByType(e){var c=this.getAdsByType(e);if(!c.length)return null;return e0.search(c,function(c){return c.type===e})||null}},{key:"canShowAd",value:function canShowAd(e,c){return this.canShowAdByTime(e,c)}},{key:"canShowAdByTime",value:function canShowAdByTime(e,c){try{var l,h=Date.now()/1e3;if(c)l=this.getCommonAdConfig(c);else{var d=this.getPriorityAdByType(e);if(!d)return!1;l=this.getCommonAdConfig(d.placementId)}var f=l.SecondsBetweenAds,y=l.SecondsFirstTime,_=h-this.lastCallAdShownTime[e];return this.lastCallAdShownTime[e]>0?_>f:_>y}catch(e){return!1}}},{key:"canShowBannerAd",value:function canShowBannerAd(e){try{var c=this.getBannerConfig(e).Platform;if("ALL"===c)return!0;var l=GameSDK.getPlatform();return l?l===c:!1}catch(e){return!1}}},{key:"showBannerAdAsync",value:function showBannerAdAsync(e){return _async_to_generator(function(e){var c,l;var h=arguments;return _ts_generator(this,function(d){switch(d.label){case 0:if(c=h.length>1&&void 0!==h[1]?h[1]:!0,this.checkEnabled(),l=this.getAd(eQ.BANNER,e),!this.canShowBannerAd(l.placementId))throw new Error("Banner ad can not be shown");if(this.cleanBannerReloadTimer(l),!c)return[3,2];return[4,this.showBannerAdWithSchedule(l)];case 1:return d.sent(),[3,4];case 2:return[4,this.showBannerAdOnce(l)];case 3:d.sent(),d.label=4;case 4:return[2]}})}).apply(this,arguments)}},{key:"showBannerAdOnce",value:function showBannerAdOnce(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(c=this.game.event,!!this.isAdFullSizeShowing())return[3,8];d.label=1;case 1:return d.trys.push([1,3,,8]),[4,e.instance.showAsync()];case 2:return d.sent(),c.emit(ed.Events.AD_SHOWING,{type:eQ.BANNER,placementId:e.placementId}),[3,8];case 3:if(l=d.sent(),!("AD_NOT_FILLED"!==(h=e1.toError(l)).code))return[3,7];d.label=4;case 4:return d.trys.push([4,6,,7]),[4,e.instance.hideAsync()];case 5:return d.sent(),[3,7];case 6:return d.sent(),[3,7];case 7:return c.emit(ed.Events.AD_FAILED,{type:eQ.BANNER,placementId:e.placementId,error:h}),[3,8];case 8:return[2]}})}).call(this)}},{key:"showBannerAdWithSchedule",value:function showBannerAdWithSchedule(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:return c=this,[4,this.showBannerAdOnce(e)];case 1:if(d.sent(),(l=this.getBannerConfig(e.placementId).SecondsReload)<=0)return[2];return h=function(){return c.showBannerAdWithSchedule(e)},e.interval=setTimeout(h,1e3*l),[2]}})}).call(this)}},{key:"hideBannerAdAsync",value:function hideBannerAdAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return this.checkEnabled(),c=this.getAd(eQ.BANNER,e),this.cleanBannerReloadTimer(c),[4,c.instance.hideAsync()];case 1:return l.sent(),this.game.event.emit(ed.Events.AD_CLOSED,{type:eQ.BANNER,placementId:e}),[2]}})}).call(this)}},{key:"cleanBannerReloadTimer",value:function cleanBannerReloadTimer(e){try{var c=e.interval;if(!c)return;clearInterval(c)}catch(e){}}},{key:"getCommonAdConfig",value:function getCommonAdConfig(e){var c=_to_consumable_array(this.config.InterstitialAdOptions).concat(_to_consumable_array(this.config.RewardedVideoAdOptions),_to_consumable_array(this.config.RewardedInterstitialAdOptions)),l=e0.search(c,function(c){return c.PlacementId===e});if(!l)throw new Error("Ad config with placementId ".concat(e," not found"));return l}},{key:"getBannerConfig",value:function getBannerConfig(e){var c=e0.search(this.config.BannerDisplayAdOptions,function(c){return c.PlacementId===e});if(!c)throw new Error("Banner config with placementId ".concat(e," not found"));return c}},{key:"getBannerHeight",value:function getBannerHeight(e,c,l){var h=arguments.length>2&&void 0!==l?l:!0;this.checkEnabled();var d=this.getBannerConfig(e),f=GameSDK.getBannerHeight(d);return h?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(f+this.safeAreaBottom)*c):f*c}},{key:"getSafeAreaBottom",value:function getSafeAreaBottom(e){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*e}},{key:"resetDegradationTracking",value:function resetDegradationTracking(){this.degradationTracking={failedAttempts:0,lastSuccessTime:Date.now()}}},{key:"isServiceDegraded",value:function isServiceDegraded(){var e=Date.now(),c=this.config.DegradationTracking,l=c.MaxFailedAttempts,h=c.ResetTimeMinutes,d=this.degradationTracking,f=d.lastSuccessTime,y=d.failedAttempts;return e-f>60*h*1e3&&this.resetDegradationTracking(),y>=l}}]),Ci}(eY.Plugins.BasePlugin);var e4={APP_LAUNCH:"app_launch",APP_INITIALIZED:"app_initialized",ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",USE_ITEM:"use_item",EARN_ITEM:"earn_item",GET_FREE_ITEM:"get_free_item",SHARE:"share",INVITE:"invite",MESSAGE:"message",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_INIT:"ad_init",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOWING:"ad_showing",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",SWITCH_GAME_POPUP:"switch_game_popup",SWITCH_GAME:"switch_game"};var e5=function(){function nt(){_class_call_check(this,nt),u(this,"history",[]),u(this,"missing",[]),u(this,"outOfOrder",[]),u(this,"completed",!1),u(this,"failed",!1),u(this,"warned",[]),u(this,"debug",!1)}return _create_class(nt,[{key:"addEvent",value:function addEvent(e,c){if(this.completed||this.failed)return void this.debugLog("Skip event:",e);this.history.push(e),this.validateAndUpdate(e)}},{key:"validateAndUpdate",value:function validateAndUpdate(e){var c=this.validateFunnelState();if(c.hasFailed){this.failed=!0,this.logValidationError();return}c.hasWarnings&&this.handleWarnings(c.warnings),this.checkFunnelCompletion(e)}},{key:"validateFunnelState",value:function validateFunnelState(){var e={hasFailed:!1,hasWarnings:!1,warnings:[]},c=this.getCurrentSteps().filter(function(e){return e.required});for(var l=0;l<c.length;l++){var h=c[l],d=this.history.indexOf(h.name);if(-1===d)return this.missing=[h.name],e.hasFailed=!0,e;if(l>0){var f=c[l-1];if(this.history.indexOf(f.name)>d)return this.missing=[f.name],e.hasFailed=!0,e}}var y=this.validateDependencies();return y.length>0&&(e.hasWarnings=!0,e.warnings=y,this.outOfOrder=y),e}},{key:"getCurrentSteps",value:function getCurrentSteps(){var e=this.history[this.history.length-1],c=this.funnelSteps.findIndex(function(c){return c.name===e});return this.funnelSteps.slice(0,c+1)}},{key:"validateDependencies",value:function validateDependencies(){var e=this;var c=[];return this.history.forEach(function(l,h){var d;var f=e.funnelSteps.find(function(e){return e.name===l});if(!(null!=(d=null==f?void 0:f.dependencies)&&d.length))return;var y=f.dependencies.find(function(c){return!e.history.includes(c)||e.history.indexOf(c)>h});y&&!e.warned.includes(l)&&(c.push({event:l,missingDependency:y}),e.warned.push(l))}),c}},{key:"checkFunnelCompletion",value:function checkFunnelCompletion(e){var c=this;if(e!==this.funnelSteps[this.funnelSteps.length-1].name)return;this.funnelSteps.filter(function(e){return e.required}).every(function(e){return c.history.includes(e.name)})&&(this.completed=!0,this.logCompletion())}},{key:"handleWarnings",value:function handleWarnings(e){var c=true,l=false,h=void 0;try{for(var d,f=e[Symbol.iterator]();!(c=(d=f.next()).done);c=true)d.value}catch(e){l=true,h=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw h}}}},{key:"logValidationError",value:function logValidationError(){}},{key:"logCompletion",value:function logCompletion(){}},{key:"debugLog",value:function debugLog(){for(var e=arguments.length,c=new Array(e),l=0;l<e;l++)c[l]=arguments[l]}},{key:"isFunnelCompleted",value:function isFunnelCompleted(){return this.completed}},{key:"isFunnelFailed",value:function isFunnelFailed(){return this.failed}},{key:"getEventHistory",value:function getEventHistory(){return _to_consumable_array(this.history)}},{key:"getMissingEvents",value:function getMissingEvents(){return _to_consumable_array(this.missing)}},{key:"getOutOfOrderEvents",value:function getOutOfOrderEvents(){return _to_consumable_array(this.outOfOrder)}}]),nt}();var e6=function(e){function _i(){var e;return _class_call_check(this,_i),e=_call_super(this,_i,arguments),u(e,"debug",!1),u(e,"funnelSteps",[{name:e4.AD_INIT,required:!0,payload:{service:"adsense"},description:"Init adsense ad"},{name:e4.AD_LOAD_FAILED,required:!1,payload:{service:e.service},description:"Platform ad load failed (trigger for adsense)"},{name:e4.AD_LOAD,required:!0,payload:{service:"adsense"},description:"Start loading adsense ad"},{name:e4.AD_LOAD_FAILED,required:!1,dependencies:[e4.AD_LOAD],payload:{service:"adsense"},description:"Adsense ad load failed"},{name:e4.AD_SHOWING,required:!0,dependencies:[e4.AD_LOAD],payload:{service:"adsense"},description:"Adsense ad is showing"},{name:e4.AD_SHOW,required:!1,dependencies:[e4.AD_SHOWING],payload:{service:"adsense"},description:"Adsense ad shown successfully"},{name:e4.AD_SHOW_FAILED,required:!1,dependencies:[e4.AD_SHOWING],payload:{service:"adsense"},description:"Adsense ad show failed"},{name:e4.AD_LOAD,required:!1,payload:{service:"adsense"},description:"Preload adsense ad"}]),e}return _inherits(_i,e),_create_class(_i,[{key:"service",get:function get(){var e;return null!=(e=null==GameSDK?void 0:GameSDK.getSDKName())?e:"GameCore"}},{key:"addEvent",value:function addEvent(e,c){((null==c?void 0:c.service)==="adsense"||e===e4.AD_LOAD_FAILED&&(null==c?void 0:c.service)==="platform")&&_get(_get_prototype_of(_i.prototype),"addEvent",this).call(this,e,c)}}]),_i}(e5);var e7=function(e){function Ni(){var e;return _class_call_check(this,Ni),e=_call_super(this,Ni,arguments),u(e,"debug",!1),u(e,"funnelSteps",[{name:e4.APP_LAUNCH,required:!0,description:"Application launched"},{name:e4.APP_INITIALIZED,required:!0,dependencies:[e4.APP_LAUNCH],description:"Application initialized"},{name:e4.ENGINE_READY,required:!0,dependencies:[e4.APP_INITIALIZED],description:"Game engine initialized"},{name:e4.LOAD_START,required:!0,dependencies:[e4.ENGINE_READY],description:"Start loading game assets"},{name:e4.LOAD_COMPLETE,required:!0,dependencies:[e4.LOAD_START],description:"Game assets loaded completely"},{name:e4.APP_READY,required:!0,dependencies:[e4.LOAD_COMPLETE],description:"Game is ready to play"}]),e}return _inherits(Ni,e),Ni}(e5);var e8=function(e){function Ti(){var e;return _class_call_check(this,Ti),e=_call_super(this,Ti,arguments),u(e,"debug",!1),u(e,"funnelSteps",[{name:e4.AD_INIT,required:!0,payload:{service:e.service},description:"Init platform ad"},{name:e4.AD_LOAD,required:!0,payload:{service:e.service},description:"Start loading platform ad"},{name:e4.AD_LOAD_FAILED,required:!1,dependencies:[e4.AD_LOAD],payload:{service:e.service},description:"Platform ad load failed"},{name:e4.AD_SHOWING,required:!0,dependencies:[e4.AD_LOAD],payload:{service:e.service},description:"Platform ad is showing"},{name:e4.AD_SHOW,required:!1,dependencies:[e4.AD_SHOWING],payload:{service:e.service},description:"Platform ad shown successfully"},{name:e4.AD_SHOW_FAILED,required:!1,dependencies:[e4.AD_SHOWING],payload:{service:e.service},description:"Platform ad show failed"},{name:e4.AD_LOAD,required:!1,payload:{service:e.service},description:"Preload platform ad"}]),e}return _inherits(Ti,e),_create_class(Ti,[{key:"service",get:function get(){var e;return null!=(e=null==GameSDK?void 0:GameSDK.getSDKName())?e:"GameCore"}},{key:"addEvent",value:function addEvent(e,c){(null==c?void 0:c.service)===this.service&&_get(_get_prototype_of(Ti.prototype),"addEvent",this).call(this,e,c)}}]),Ti}(e5);var e9=ed.Utils,tr=e9.String,ta=e9.Valid;var ti=function(){function Mi(e,c,l){_class_call_check(this,Mi),u(this,"game"),u(this,"name"),u(this,"color"),u(this,"options"),u(this,"selfLog"),u(this,"currentPath"),this.game=e,this.name=c,this.options=l,this.color=l.color||"#FFF",this.selfLog=l.log,this.currentPath="/"}return _create_class(Mi,[{key:"event",value:function event(e,c){this.logInfo("event",{name:e,payload:c});var l=this.formatEventName(e);this.processEvent(l,c)}},{key:"logInfo",value:function logInfo(e,c){this.selfLog}},{key:"pageview",value:function pageview(e){var c=this.getPageTitle(e);c=this.addGameModeToPageTitle(c),document.title=c,this.event(e4.PAGE_VIEW,{page_path:e,page_title:c})}},{key:"levelStart",value:function levelStart(e,c,l){this.event(e4.LEVEL_START,{level:e,score:c,level_name:this.getLevelName(e),game_mode:l?tr.toUpperCamelCase(l):void 0})}},{key:"levelFail",value:function levelFail(e,c,l){this.event(e4.LEVEL_END,{level:e,score:c,success:!1,level_name:this.getLevelName(e),game_mode:l?tr.toUpperCamelCase(l):void 0})}},{key:"levelRescue",value:function levelRescue(e,c,l){this.event(e4.LEVEL_RESCUE,{level:e,score:c,level_name:this.getLevelName(e),game_mode:l?tr.toUpperCamelCase(l):void 0})}},{key:"levelComplete",value:function levelComplete(e,c,l){this.event(e4.LEVEL_END,{level:e,score:c,success:!0,level_name:this.getLevelName(e),game_mode:l?tr.toUpperCamelCase(l):void 0})}},{key:"initAdEvent",value:function initAdEvent(e){var c=e.adService,l=e.state;this.event(e4.AD_INIT,{ad_service:c,state:l})}},{key:"loadAdEvent",value:function loadAdEvent(e){var c=e.type,l=e.placement,h=e.service;this.event(e4.AD_LOAD,{ad_type:c,screen_name:l,ad_service:h})}},{key:"showAdEvent",value:function showAdEvent(e){var c=e.type,l=e.placement,h=e.service;this.event(e4.AD_SHOW,{ad_type:c,screen_name:l,ad_service:h})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){var c=e.placement,l=e.service;this.loadAdEvent({type:"interstitial",placement:c,service:l})}},{key:"showInterstitialAd",value:function showInterstitialAd(e){var c=e.placement,l=e.service;this.showAdEvent({type:"interstitial",placement:c,service:l})}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){var c=e.placement,l=e.service;this.loadAdEvent({type:"rewarded_video",placement:c,service:l})}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){var c=e.placement,l=e.service;this.showAdEvent({type:"rewarded_video",placement:c,service:l})}},{key:"receiveVideoReward",value:function receiveVideoReward(e){var c=e.placement,l=e.service;this.event(e4.AD_REWARD,{screen_name:c,ad_service:l})}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(e){var c=e.placement,l=e.service;this.loadAdEvent({type:"rewarded_interstitial",placement:c,service:l})}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(e){var c=e.placement,l=e.service;this.showAdEvent({type:"rewarded_interstitial",placement:c,service:l})}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(e){var c=e.placement,l=e.service;this.event(e4.AD_REWARD,{screen_name:c,ad_service:l})}},{key:"loadAdFail",value:function loadAdFail(e){var c=e.type,l=e.placement,h=e.service;this.event(e4.AD_LOAD_FAILED,{ad_type:c,screen_name:l,ad_service:h})}},{key:"showAdFail",value:function showAdFail(e){var c=e.type,l=e.placement,h=e.service;this.event(e4.AD_SHOW_FAILED,{ad_type:c,screen_name:l,ad_service:h})}},{key:"showingAd",value:function showingAd(e){var c=e.type,l=e.placement,h=e.service;this.event(e4.AD_SHOWING,{ad_type:c,screen_name:l,ad_service:h})}},{key:"formatEventName",value:function formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(tr.padStart(e.toString(),5,"0"))}},{key:"getPageTitle",value:function getPageTitle(e){var c=e.split("/").pop();if(!ta.isString(c))return e;var l=c.replace(/([-_\s.])/g," $1");return tr.toUpperCamelCase(l)}},{key:"addGameModeToPageTitle",value:function addGameModeToPageTitle(e){var c=this.game.match.getMatchState().mode;return c||(c="Normal"),"".concat(tr.toUpperCamelCase(c),"::").concat(e)}}]),Mi}();ed.Plugins.Analytics={Events:e4,BaseFunnel:e5,BaseAnalytics:ti};var to=function(e){function Oi(e){var c;return _class_call_check(this,Oi),u(c=_call_super(this,Oi,[e]),"analytics",[]),u(c,"placement","unknown"),u(c,"funnels",[]),u(c,"pageview",function(e){if(!c.isActive())return;c.placement=e;var l=c.getPageByKey(e);var h=true,d=false,f=void 0;try{for(var y,_=c.analytics[Symbol.iterator]();!(h=(y=_.next()).done);h=true)y.value.pageview(l)}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}c.logFunnelEvent(e4.PAGE_VIEW)}),c.initFunnels(),c}return _inherits(Oi,e),_create_class(Oi,[{key:"add",value:function add(e){var c=this.analytics.findIndex(function(c){return c.name===e.name});-1!==c?this.analytics[c]=e:this.analytics.push(e)}},{key:"isActive",value:function isActive(){return this.analytics.length>=1}},{key:"initFunnels",value:function initFunnels(){this.addFunnel(new e7),this.addFunnel(new e6),this.addFunnel(new e8)}},{key:"addFunnel",value:function addFunnel(e){this.funnels.push(e)}},{key:"logFunnelEvent",value:function logFunnelEvent(e,c){var l=true,h=false,d=void 0;try{for(var f,y=this.funnels[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.addEvent(e,c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}}},{key:"event",value:function event(e,c){if(this.isActive()){var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.event(e,c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e,c)}}},{key:"levelStart",value:function levelStart(e,c,l){if(this.isActive()){var h=true,d=false,f=void 0;try{for(var y,_=this.analytics[Symbol.iterator]();!(h=(y=_.next()).done);h=true)y.value.levelStart(e,c,l)}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}this.logFunnelEvent(e4.LEVEL_START,{score:c,mode:l})}}},{key:"levelRescue",value:function levelRescue(e,c,l){if(this.isActive()){var h=true,d=false,f=void 0;try{for(var y,_=this.analytics[Symbol.iterator]();!(h=(y=_.next()).done);h=true)y.value.levelRescue(e,c,l)}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}this.logFunnelEvent(e4.LEVEL_RESCUE,{score:c,mode:l})}}},{key:"levelFail",value:function levelFail(e,c,l){if(this.isActive()){var h=true,d=false,f=void 0;try{for(var y,_=this.analytics[Symbol.iterator]();!(h=(y=_.next()).done);h=true)y.value.levelFail(e,c,l)}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}this.logFunnelEvent(e4.LEVEL_END,{score:c,mode:l})}}},{key:"levelComplete",value:function levelComplete(e,c,l){if(this.isActive()){var h=true,d=false,f=void 0;try{for(var y,_=this.analytics[Symbol.iterator]();!(h=(y=_.next()).done);h=true)y.value.levelComplete(e,c,l)}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}this.logFunnelEvent(e4.LEVEL_END,{score:c,mode:l})}}},{key:"initAdEvent",value:function initAdEvent(e){return _async_to_generator(function(){var c,l,h,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:if(!this.isActive())return[3,2];return[4,this.game.event.waitTo(e4.APP_READY)];case 1:y.sent(),c=true,l=false,h=void 0;try{for(d=this.analytics[Symbol.iterator]();!(c=(f=d.next()).done);c=true)f.value.initAdEvent(e)}catch(e){l=true,h=e}finally{try{if(!c&&null!=d.return)d.return()}finally{if(l)throw h}}y.label=2;case 2:return[2]}})}).call(this)}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.loadInterstitialAd(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_LOAD,c)}},{key:"showInterstitialAd",value:function showInterstitialAd(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.showInterstitialAd(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_SHOW,c)}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.loadRewardedVideoAd(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_LOAD,c)}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.showRewardedVideoAd(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_SHOW,c)}},{key:"receiveVideoReward",value:function receiveVideoReward(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.receiveVideoReward(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_REWARD,c)}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.loadRewardedInterstitialAd(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_LOAD,c)}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.showRewardedInterstitialAd(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_SHOW,c)}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.receiveInterstitialReward(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_REWARD,c)}},{key:"loadAdFail",value:function loadAdFail(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.loadAdFail(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_LOAD_FAILED,c)}},{key:"showAdFail",value:function showAdFail(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.showAdFail(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_SHOW_FAILED,c)}},{key:"showingAd",value:function showingAd(e){if(!this.isActive())return;var c=_object_spread_props(_object_spread({},e),{placement:this.placement});var l=true,h=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.showingAd(c)}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}this.logFunnelEvent(e4.AD_SHOWING,c)}},{key:"getPageByKey",value:function getPageByKey(e){var c=e;if(c.indexOf("_")>-1)return c.replace(/_/g,"-").toLowerCase();var l=c.length-1,h="";for(;l>0;){var d=isNaN(parseInt(h=c.charAt(l),10)),f=h===h.toUpperCase();d&&f&&(c="".concat(c.slice(0,l),"-").concat(c.slice(l))),l--}return c.toLowerCase()}}]),Oi}(eY.Plugins.BasePlugin);var tc=function(){function Ri(e){_class_call_check(this,Ri),u(this,"key"),this.key=e}return _create_class(Ri,[{key:"getKey",value:function getKey(){return this.key}}]),Ri}();var tu=Object.defineProperty,th=Object.getOwnPropertyDescriptor;var td=ed.Utils.Decorator;var tf=function(){function Xs(e){_class_call_check(this,Xs),u(this,"id"),u(this,"isMuteAll"),u(this,"masterVolume"),u(this,"audioClips"),this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}return _create_class(Xs,[{key:"getId",value:function getId(){return this.id}},{key:"getAudioClip",value:function getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}},{key:"setAudioClip",value:function setAudioClip(e,c){this.audioClips[e]=_object_spread({},this.audioClips[e],c)}},{key:"play",value:function play(e,c){return _async_to_generator(function(){var l,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(!(l=this.getAudioClip(e)))return[3,1];return h=l.audioPlayer,this.playWithRealConfig(h,c),[3,3];case 1:return[4,this.loadAndPlay(e,c)];case 2:d.sent(),d.label=3;case 3:return[2]}})}).call(this)}},{key:"loadAndPlay",value:function loadAndPlay(e,c){return _async_to_generator(function(){var l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return[4,this.onLoadAudio(e,c)];case 1:if(!(l=f.sent()))return[2];return d=void 0===(h=(c||{}).volume)?1:h,this.setAudioClip(e,{volume:d,audioPlayer:l}),this.playWithRealConfig(l,c),[2]}})}).call(this)}},{key:"playWithRealConfig",value:function playWithRealConfig(e,c){if(c){var l=c.volume;c.volume=this.masterVolume*(void 0===l?1:l)}e.play(c)}},{key:"pause",value:function pause(e){var c=this.getAudioClip(e);if(!c)return!1;return c.audioPlayer.pause(),!0}},{key:"resume",value:function resume(e){var c=this.getAudioClip(e);if(!c)return!1;return c.audioPlayer.resume(),!0}},{key:"stop",value:function stop(e){var c=this.getAudioClip(e);if(!c)return!1;return c.audioPlayer.stop(),!0}},{key:"stopAll",value:function stopAll(){this.callAudioPlayers("stop")}},{key:"muteAll",value:function muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}},{key:"unmuteAll",value:function unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}},{key:"setVolume",value:function setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}},{key:"getVolume",value:function getVolume(){return this.masterVolume}},{key:"queueAudioPlayer",value:function queueAudioPlayer(e,c){try{var l=e.audioPlayer,h=e.volume;switch(c){case"play":l.play();break;case"pause":l.pause();break;case"resume":l.resume();break;case"stop":l.stop();break;case"mute":l.setVolume(0);break;case"unmute":case"setVolume":l.setVolume(this.masterVolume*(void 0===h?1:h));break;default:throw new Error("Unsupported function: ".concat(c))}}catch(e){}}},{key:"callAudioPlayers",value:function callAudioPlayers(e){var c=ed.Utils.Object.vals(this.audioClips);var l=true,h=false,d=void 0;try{for(var f,y=c[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;this.queueAudioPlayer(_,e)}}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}}}]),Xs}();(function(e,c,l,h){for(var d,f=th(c,l),y=e.length-1;y>=0;y--)(d=e[y])&&(f=d(c,l,f)||f);f&&tu(c,l,f)})([td.tryCatch(),td.validateParams("string")],tf.prototype,"loadAndPlay");var ty=Object.defineProperty,t_=Object.getOwnPropertyDescriptor;ed.Plugins.Audio={BaseAudioPlayer:tc,BaseChannelManager:tf};var tv=ed.Utils.Decorator,tp=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(window.globalAudioContext=null,tp){var tg=function(e){function a(){for(var e,c=arguments.length,l=new Array(c),h=0;h<c;h++)l[h]=arguments[h];return _class_call_check(this,a),e=_call_super(this,a,_to_consumable_array(l)),null===window.globalAudioContext&&(window.globalAudioContext=e),e}return _inherits(a,e),a}(tp);window.AudioContext&&(window.AudioContext=tg),window.webkitAudioContext&&(window.webkitAudioContext=tg),window.mozAudioContext&&(window.mozAudioContext=tg)}var tm=function(e){function tn(){var e;return _class_call_check(this,tn),e=_call_super(this,tn,arguments),u(e,"firstChannelId"),u(e,"channels",{}),e}return _inherits(tn,e),_create_class(tn,[{key:"addChannel",value:function addChannel(e){var c=e.getId();this.channels[c]=e,this.firstChannelId||(this.firstChannelId=c)}},{key:"getChannel",value:function getChannel(e){if(void 0===e)return this.channels[this.firstChannelId];var c=this.channels[e];if(!c)throw new Error("Channel ".concat(e," not found"));return c}},{key:"play",value:function play(e,c,l){return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return[4,this.getChannel(l).play(e,c)];case 1:return h.sent(),[2]}})}).call(this)}},{key:"pause",value:function pause(e,c){try{this.getChannel(c).pause(e)}catch(e){}}},{key:"resume",value:function resume(e,c){try{this.getChannel(c).resume(e)}catch(e){}}},{key:"stop",value:function stop(e,c){try{this.getChannel(c).stop(e)}catch(e){}}},{key:"stopAll",value:function stopAll(e){try{this.getChannel(e).stopAll()}catch(e){}}},{key:"mute",value:function mute(e){try{this.getChannel(e).muteAll()}catch(e){}}},{key:"unmute",value:function unmute(e){try{this.getChannel(e).unmuteAll()}catch(e){}}},{key:"setVolume",value:function setVolume(e,c){try{this.getChannel(c).setVolume(e)}catch(e){}}},{key:"getVolume",value:function getVolume(e){try{return this.getChannel(e).getVolume()}catch(e){return -1}}}]),tn}(eY.Plugins.BasePlugin);(function(e,c,l,h){for(var d,f=t_(c,l),y=e.length-1;y>=0;y--)(d=e[y])&&(f=d(c,l,f)||f);f&&ty(c,l,f)})([tv.tryCatch(),tv.validateParams("string")],tm.prototype,"play");var tA={token:"",isRequesting:!1},tw=ed.Utils.Object;var tb=function(e){function ji(){return _class_call_check(this,ji),_call_super(this,ji,arguments)}return _inherits(ji,e),_create_class(ji,[{key:"init",value:function init(){this.game.storage.addStorage("auth",tA)}},{key:"requestToken",value:function requestToken(){return _async_to_generator(function(){var e,c,l;return _ts_generator(this,function(h){switch(h.label){case 0:e=this.game.storage,h.label=1;case 1:if(h.trys.push([1,3,4,5]),e.getStorageData("auth","isRequesting")||""!==e.getStorageData("auth","token"))return[2];return e.setStorageData("auth","isRequesting",!0),[4,GameSDK.player.getSignedPlayerInfoAsync()];case 2:return c=h.sent().getSignature(),e.setStorageData("auth","token",c),[3,5];case 3:if(l=h.sent(),tw.hasOwn(l,"code")&&"PENDING_REQUEST"===l.code)return[2];return e.setStorageData("auth","token",""),[3,5];case 4:return e.setStorageData("auth","isRequesting",!1),[7];case 5:return[2]}})}).call(this)}},{key:"getToken",value:function getToken(){var e;return null!=(e=this.game.storage.getStorageData("auth","token"))?e:""}}]),ji}(eY.Plugins.BasePlugin);var tD=function(e){return e.SOLO="solo",e.TOURNAMENT="tournament",e.SHARE_INVITE="share_invite",e.MATCHING_GROUP="matching_group_match",e.CHALLENGE_FRIEND="challenge_friend_match",e}(tD||{});var tS=ed.Configs,tk=ed.Utils,tI=tk.Array,tP=tk.Valid,tE=tk.Browser;var tC=function(){function Yi(e){_class_call_check(this,Yi),u(this,"game"),this.game=e}return _create_class(Yi,[{key:"isValidContextType",value:function isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}},{key:"isValidEntryPointData",value:function isValidEntryPointData(e){return tP.isObject(e)}},{key:"isTournamentEntryPoint",value:function isTournamentEntryPoint(e){return tI.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],e)}},{key:"receiveContext",value:function receiveContext(e,c,l){var h=this.game.storage;h.setStorageData("context","contextId",e),this.isValidEntryPointData(l)&&h.setStorageData("context","entryPointData",l),this.isValidContextType(c)&&h.setStorageData("context","contextType",c)}},{key:"detectContextSessionType",value:function detectContextSessionType(){return _async_to_generator(function(){var e,c,l,h,d,f,y,_,v;return _ts_generator(this,function(p){switch(p.label){case 0:if(l=(null!=(c=(e=this.game.storage).getStorageData("context","entryPointData"))?c:{}).type,h=tD.SOLO,d=tD.TOURNAMENT,f=tD.MATCHING_GROUP,y=tD.SHARE_INVITE,_=tD.CHALLENGE_FRIEND,v=h,l===d&&(v=d),l===f&&(v=f),(l===_||l===y)&&(v=_),v!==h)return[3,4];if(!tS.Core.FastCheckTournamentContext)return[3,1];return v=this.fastCheckTournamentContext()||v,[3,3];case 1:return[4,this.outdatedCheckTournamentContext()];case 2:v=p.sent()||v,p.label=3;case 3:p.label=4;case 4:return e.setStorageData("context","sessionContextType",v),[2]}})}).call(this)}},{key:"fastCheckTournamentContext",value:function fastCheckTournamentContext(){var e=tE.getQueryParams().entry_point;return"string"==typeof e&&this.isTournamentEntryPoint(e)?tD.TOURNAMENT:!1}},{key:"outdatedCheckTournamentContext",value:function outdatedCheckTournamentContext(){return _async_to_generator(function(){var e,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(e=this.game.storage,!("getTournamentAsync"in GameSDK))return[2,!1];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,GameSDK.getTournamentAsync()];case 2:return c=l.sent(),[2,(e.setStorageData("context","contextId",c.getContextID()),tD.TOURNAMENT)];case 3:return l.sent(),[2,!1];case 4:return[2]}})}).call(this)}},{key:"detectContextGameMode",value:function detectContextGameMode(){var e=this.game,c=e.player,h=e.storage,d=h.getStorageData("context","entryPointData"),f=h.getStorageData("context","sessionContextType"),y=c.getPlayerId(),_=null!=d?d:{},v=_.matchId,p=_.playerId,g=_.opponentId,m=void 0===g?eC.playerId:g,A=y===p,b=m===eC.playerId||[m,p].indexOf(y)>=0,D=tD.TOURNAMENT,k=tD.MATCHING_GROUP,E=tD.SHARE_INVITE,T=tD.CHALLENGE_FRIEND;var O=l.SINGLE;f===D&&(O=l.TOURNAMENT),f!==E||A||(O=l.CHALLENGE_FRIEND),f===T&&v&&b&&(O=l.CHALLENGE_FRIEND),f===k&&(O=l.MATCHING_GROUP),h.setStorageData("context","contextGameMode",O)}}]),Yi}();var tx=function(e){function sn(e){var c;return _class_call_check(this,sn),(c=_call_super(this,sn,[e])).name="PlayerHasFinishedMatch",c.message=null!=e?e:"Player has finished match",c}return _inherits(sn,e),sn}(_wrap_native_super(Error));var tT=function(e){function Yt(e){var c;return _class_call_check(this,Yt),(c=_call_super(this,Yt,[e])).name="PlayerNotJoinInMatch",c.message=e||"Player is not join in match",c}return _inherits(Yt,e),Yt}(_wrap_native_super(Error));var tN=ed.Events,tL=ed.Plugins.Analytics,tO=ed.Utils.Valid;var tM=function(){function Qi(e){_class_call_check(this,Qi),u(this,"game"),this.game=e}return _create_class(Qi,[{key:"processContextData",value:function processContextData(){return _async_to_generator(function(){var e,c,l,h,d,f,y,_,v,p,g,m,A,b,D,k,E,T,O,M,R,F;return _ts_generator(this,function(G){switch(G.label){case 0:if(e=this,f=(d=this.game).player,y=d.storage,_=d.monitorError,v=null!=(c=y.getStorageData("context","contextId"))?c:"",p=null!=(l=y.getStorageData("context","entryPointData"))?l:{},g=null!=(h=y.getStorageData("context","sessionContextType"))?h:"",m=p.type,A=p.matchId,b=p.playerId,D=p.opponentId,k=p.playerScore,!(E=p.action))return[3,2];return[4,this.processEntryPointAction(E)];case 1:G.sent(),G.label=2;case 2:if(T=f.isFirstSession(),setTimeout(function(){e.logUserAnalytics(T)},1e3),O=tD.TOURNAMENT,M=tD.SHARE_INVITE,R=tD.MATCHING_GROUP,F=tD.CHALLENGE_FRIEND,g!==O)return[3,6];G.label=3;case 3:return G.trys.push([3,5,,6]),[4,this.processTournamentModeAsync(v)];case 4:return G.sent(),[2];case 5:return G.sent(),null==_||_.sendException(new Error("Process Tournament Fail"),{contextId:v,isFirstSession:T,entryPointData:p,playerData:f.getPlayerData()}),[3,6];case 6:if(g!==F)return[3,11];if(!(m===M&&"string"==typeof b))return[3,9];if(!T)return[3,8];return[4,this.processSingleModeAsync(!0)];case 7:return G.sent(),f.loggedIn(),[2];case 8:return this.switchToDashboardScene(),[2];case 9:if(!(m===F&&"string"==typeof A&&"string"==typeof b&&"string"==typeof D))return[3,11];return[4,this.processChallengeFromMessageAsync({contextId:v,matchId:A,playerId:b,opponentId:D})];case 10:return G.sent(),[2];case 11:if(!(g===R&&"string"==typeof b&&"number"==typeof k))return[3,13];return[4,this.processMatchingGroupModeAsync(b,k)];case 12:return G.sent(),[2];case 13:if(!T)return[3,15];return[4,this.processSingleModeAsync(!0)];case 14:return G.sent(),f.loggedIn(),[2];case 15:return this.switchToDashboardScene(),[2]}})}).call(this)}},{key:"logUserAnalytics",value:function logUserAnalytics(e){try{var c=this.game,l=c.player,h=c.analytics;if(e)h.event(tL.Events.NEW_USER);else{var d=l.getPlayerData().gameData.coins;h.event(tL.Events.RETURNING_USER,{coins:d})}}catch(e){}}},{key:"processEntryPointAction",value:function processEntryPointAction(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:switch(l.trys.push([0,7,,8]),c=this.game.player,e){case"reset_data":return[3,1];case"enable_debug":return[3,3];case"set_locale_en":return[3,4];case"set_locale_ru":return[3,5]}return[3,6];case 1:return c.setPlayerDataByName("score",0),c.setGameData({coins:0,level:1}),[4,c.syncProfileToServer()];case 2:return l.sent(),[3,6];case 3:return c.setPlayerDataByName("debug",!0),[3,6];case 4:return this.requestSetLocale("en"),[3,6];case 5:return this.requestSetLocale("ru"),[3,6];case 6:return[3,8];case 7:return l.sent(),[3,8];case 8:return[2]}})}).call(this)}},{key:"requestSetLocale",value:function requestSetLocale(e){this.game.event.emit(tN.REQUEST_LANGUAGE,{locale:e})}},{key:"processTournamentModeAsync",value:function processTournamentModeAsync(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(l=(c=this.game).match,h=c.player.getPlayerId(),tO.isEmpty(e))throw new Error("Cannot get contextId");return[4,l.tournament.continue.processAsync({playerId:h,contextId:e})];case 1:return d.sent(),this.switchToGameScene(),[2]}})}).call(this)}},{key:"processChallengeFromPostAsync",value:function processChallengeFromPostAsync(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(l=(c=this.game).match,(h=c.player.getPlayerId())!==e)return[3,2];return[4,l.single.start.processAsync({playerId:h})];case 1:return d.sent(),[3,6];case 2:return d.trys.push([2,4,,6]),[4,l.challenge.friend.processAsync({playerId:h,opponentId:e})];case 3:return d.sent(),[3,6];case 4:return d.sent(),[4,l.single.start.processAsync({playerId:h})];case 5:return d.sent(),[3,6];case 6:return this.switchToGameScene(),[2]}})}).call(this)}},{key:"processChallengeFromMessageAsync",value:function processChallengeFromMessageAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,7]),[4,this.processContinueChallengeFromMessageAsync(e)];case 1:return l.sent(),[3,7];case 2:if(!_instanceof(c=l.sent(),tx))return[3,4];return[4,this.processAwaitChallengeFromMessageAsync(e)];case 3:return l.sent(),[2];case 4:if(!_instanceof(c,tT))return[3,6];return[4,this.processJoinChallengeFromMessageAsync(e)];case 5:return l.sent(),[2];case 6:return this.switchToDashboardScene(),[3,7];case 7:return[2]}})}).call(this)}},{key:"processContinueChallengeFromMessageAsync",value:function processContinueChallengeFromMessageAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v;return _ts_generator(this,function(p){switch(p.label){case 0:if(c=e.contextId,l=e.matchId,h=e.playerId,d=e.opponentId,y=(f=this.game).match,_=f.player.getPlayerId(),h!==_)return[3,2];return[4,y.challenge.continue.processAsync({contextId:c,matchId:l,playerId:_,opponentId:d})];case 1:return p.sent(),[3,4];case 2:return v=d===eC.playerId,[4,y.challenge.continue.processAsync({contextId:c,matchId:l,playerId:_,opponentId:v?d:h})];case 3:p.sent(),p.label=4;case 4:return this.switchToGameScene(),[2]}})}).call(this)}},{key:"processJoinChallengeFromMessageAsync",value:function processJoinChallengeFromMessageAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return c=e.contextId,l=e.matchId,h=e.playerId,f=(d=this.game).match,y=d.player.getPlayerId(),[4,f.challenge.join.processAsync({contextId:c,matchId:l,playerId:y,opponentId:h})];case 1:return _.sent(),this.switchToGameScene(),[2]}})}).call(this)}},{key:"processAwaitChallengeFromMessageAsync",value:function processAwaitChallengeFromMessageAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:c=e.contextId,l=e.matchId,h=e.playerId,f=(d=this.game).match,y=d.player.getPlayerId(),_.label=1;case 1:return _.trys.push([1,3,,5]),[4,f.challenge.await.processAsync({contextId:c,matchId:l,playerId:y,opponentId:h})];case 2:return _.sent(),this.switchToChallengeResultScene(),[3,5];case 3:return _.sent(),[4,this.processResultChallengeFromMessageAsync(e)];case 4:return _.sent(),[3,5];case 5:return[2]}})}).call(this)}},{key:"processResultChallengeFromMessageAsync",value:function processResultChallengeFromMessageAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:c=e.contextId,l=e.matchId,h=e.playerId,f=(d=this.game).match,y=d.player.getPlayerId(),_.label=1;case 1:return _.trys.push([1,3,,4]),[4,f.challenge.result.processAsync({contextId:c,matchId:l,playerId:y,opponentId:h})];case 2:return _.sent(),this.switchToChallengeResultScene(),[3,4];case 3:return _.sent(),this.switchToDashboardScene(),[3,4];case 4:return[2]}})}).call(this)}},{key:"processMatchingGroupModeAsync",value:function processMatchingGroupModeAsync(e,c){return _async_to_generator(function(){var l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return h=(l=this.game).match,d=l.player,[4,h.group.join.processAsync({playerId:d.getPlayerId(),opponentId:e,opponentScore:c})];case 1:return f.sent(),this.switchToGameScene(),[2]}})}).call(this)}},{key:"processSingleModeAsync",value:function processSingleModeAsync(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(l=(c=this.game).match,h=c.player.getPlayerId(),!e)return[3,2];return[4,l.handler.setMatchCustomData({level:0})];case 1:d.sent(),d.label=2;case 2:return[4,l.single.start.processAsync({playerId:h})];case 3:return d.sent(),this.switchToGameScene(),[2]}})}).call(this)}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){this.game.event.emit(tN.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}},{key:"switchToGameScene",value:function switchToGameScene(){this.game.event.emit(tN.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}},{key:"switchToChallengeResultScene",value:function switchToChallengeResultScene(){this.game.event.emit(tN.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}}]),Qi}();var tR={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},tF=ed.Events;var tG=function(e){function Xi(e){var c;return _class_call_check(this,Xi),u(c=_call_super(this,Xi,[e]),"context"),u(c,"loader"),c.loader=new tM(e),c.context=new tC(e),c}return _inherits(Xi,e),_create_class(Xi,[{key:"init",value:function init(){this.game.storage.addStorage("context",tR)}},{key:"getSessionContextTypes",value:function getSessionContextTypes(){return tD}},{key:"processContextData",value:function processContextData(){return _async_to_generator(function(){var e,c,l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:c=(e=this.game).event,l=e.monitorError,f.label=1;case 1:if(f.trys.push([1,5,,6]),c.getEventEmitCount(tF.CONTEXT_SESSION_TYPE_DETECTED)>0)return[3,3];return[4,c.waitTo(tF.CONTEXT_SESSION_TYPE_DETECTED,3e3)];case 2:f.sent(),f.label=3;case 3:return[4,this.loader.processContextData()];case 4:return f.sent(),c.emit(tF.CONTEXT_DATA_PROCESSED),[3,6];case 5:if(h=f.sent(),this.switchToDashboardScene(),l)d=_instanceof(h,Error)?h:new Error(JSON.stringify(h)),l.sendException(d);return[3,6];case 6:return[2]}})}).call(this)}},{key:"detectContextSessionType",value:function detectContextSessionType(){return _async_to_generator(function(){var e,c,l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:c=(e=this.game).event,l=e.monitorError,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.context.detectContextSessionType()];case 2:return f.sent(),c.emit(tF.CONTEXT_SESSION_TYPE_DETECTED),[3,4];case 3:if(h=f.sent(),l)d=_instanceof(h,Error)?h:new Error(JSON.stringify(h)),l.sendException(d);return[3,4];case 4:return[2]}})}).call(this)}},{key:"detectContextGameMode",value:function detectContextGameMode(){this.context.detectContextGameMode()}},{key:"receiveContext",value:function receiveContext(e,c,l){this.context.receiveContext(e,c,l)}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){this.game.event.emit(tF.SWITCH_SCENE,{sceneName:"DashboardScene"})}}]),Xi}(eY.Plugins.BasePlugin);var tj=ed.Utils.Valid,tB=tR.contextId,tU=tR.contextType,tV=tR.entryPointData,tH="is invalid";var tK=function(e){function rn(){var e;return _class_call_check(this,rn),e=_call_super(this,rn,arguments),u(e,"data"),e}return _inherits(rn,e),_create_class(rn,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateContextId",value:function validateContextId(e){tj.isString(e)||this.exception("contextId",tH)}},{key:"validateContextType",value:function validateContextType(e){tj.isString(e)&&e||this.exception("contextType",tH)}},{key:"validateEntryPointData",value:function validateEntryPointData(e){tj.isObject(e)||this.exception("entryPointData",tH)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(rn.prototype),"toObject",this).call(this)}}]),rn}(em);tK.addDefaultData({contextId:tB,contextType:tU,entryPointData:tV}),ed.Dtos.Context={Info:tK};var tz={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},tW=ed.Utils.Object;var tq=function(){function ao(){_class_call_check(this,ao)}return _create_class(ao,[{key:"getDailyRewardsAsync",value:function getDailyRewardsAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,tW.vals(tz)]})})()}}]),ao}();var tY={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},tJ={dailyRewards:{}},tQ=ed.Configs.DailyRewards,tX=tQ.CheckInterrupt,t$=tQ.MaxDays,tZ=tQ.MockTime,t0=ed.Utils,t2=t0.Array,t1=t0.Valid,t3=tZ>0?tZ:864e5;var t4=function(e){function io(){var e;return _class_call_check(this,io),e=_call_super(this,io,arguments),u(e,"dailyRewardsApi",new tq),e}return _inherits(io,e),_create_class(io,[{key:"init",value:function init(){this.game.storage.addStorage("dailyRewards",tJ)}},{key:"requestDailyRewardsAsync",value:function requestDailyRewardsAsync(){return _async_to_generator(function(){var e,c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:return[4,this.dailyRewardsApi.getDailyRewardsAsync()];case 1:return e=d.sent(),l=(c=this.parseDailyRewards(e)).logs,h=c.rewards,this.setRewardsLog(l),this.setDailyRewards(h),[2]}})}).call(this)}},{key:"getDailyRewards",value:function getDailyRewards(){return this.game.storage.getStorageData("dailyRewards","dailyRewards")||null}},{key:"logLoginReward",value:function logLoginReward(){tX?this.logFromFirstReward():this.logFromLastReward()}},{key:"logFromFirstReward",value:function logFromFirstReward(){var e=this.game.player.getPlayerData().dailyRewardedData;if(!t1.isObject(e))return;var c=e.logDays,l=e.firstReward,h=new Date,d=_to_consumable_array(c);if(0===l){d[0]=!0,t1.isDebugger()||h.setHours(0,0,0,0),this.setRewardsLog({logDays:d,firstReward:h.valueOf(),lastReward:h.valueOf()});return}var f=Math.floor((h.valueOf()-l)/t3);f>=t$||f>=c.length||(d[f]=!0,t1.isDebugger()||h.setHours(0,0,0,0),this.setRewardsLog({logDays:d,lastReward:h.valueOf()}))}},{key:"logFromLastReward",value:function logFromLastReward(){var e=this.game.player.getPlayerData().dailyRewardedData;if(!t1.isObject(e))return;var c=e.logDays,l=e.lastReward,h=new Date,d=_to_consumable_array(c);if(0===l){d[0]=!0,t1.isDebugger()||h.setHours(0,0,0,0),this.setRewardsLog({logDays:d,firstReward:h.valueOf(),lastReward:h.valueOf()});return}if(Math.floor((h.valueOf()-l)/t3)<1)return;var f=t2.searchIndex(d,function(e){return!1===e});void 0!==f&&(d[f]=!0,t1.isDebugger()||h.setHours(0,0,0,0),this.setRewardsLog({logDays:d,lastReward:h.valueOf()}))}},{key:"setRewardsLog",value:function setRewardsLog(e){var c=e.logDays,l=e.firstReward,h=e.lastReward,d=this.game.player,f=d.getPlayerData().dailyRewardedData;t1.isObject(f)&&(this.isSameLog(f,e)||d.setPlayerDataByName("dailyRewardedData",{logDays:void 0!==c?_to_consumable_array(c):_to_consumable_array(f.logDays),firstReward:null!=l?l:f.firstReward,lastReward:null!=h?h:f.lastReward}))}},{key:"isSameLog",value:function isSameLog(e,c){if(void 0!==c.firstReward&&e.firstReward!==c.firstReward||void 0!==c.lastReward&&e.lastReward!==c.lastReward)return!1;if(void 0!==c.logDays){if(e.logDays.length!==c.logDays.length)return!1;for(var l=0;l<c.logDays.length;l++)if(e.logDays[l]!==c.logDays[l])return!1}return!0}},{key:"parseDailyRewards",value:function parseDailyRewards(e){var c=this.game.player.getPlayerData().dailyRewardedData,l=null!=c?c:{},h=l.logDays,d=l.firstReward,f=l.lastReward;if(void 0===h||void 0===d||0===d||void 0===f||0===f||h.length!==e.length){var y=this.getDefaultDailyRewards(e);return{logs:{logDays:y.logDays,firstReward:0,lastReward:0},rewards:y.rewards}}return tX?this.parseFromFirstReward(e,h,d,f):this.parseFromLastReward(e,h,d,f)}},{key:"parseFromFirstReward",value:function parseFromFirstReward(e,c,l,h){var d=Date.now()-l;if(d<0){var f=this.getDefaultDailyRewards(e);return{logs:{logDays:f.logDays,firstReward:0,lastReward:0},rewards:f.rewards}}var y=Math.floor(d/t3),_=y>=t$||y>=c.length,v=void 0!==t2.search(c.slice(0,y),function(e){return!1===e});if(_||v){var p=this.getDefaultDailyRewards(e);return{logs:{logDays:p.logDays,firstReward:0,lastReward:h},rewards:p.rewards}}var g=[],m={};for(var A=0;A<e.length;A++){var b=e[A],D=g.length>y,k=g.length===y,E=c[A];if(D){g.push(!1),m[b.id]=_object_spread_props(_object_spread({},b),{status:tY.WAITING});continue}if(g.push(E),k){m[b.id]=_object_spread_props(_object_spread({},b),{status:E?tY.REWARDED:tY.READY});continue}m[b.id]=_object_spread_props(_object_spread({},b),{status:E?tY.REWARDED:tY.SKIPPED})}return{logs:{logDays:g,firstReward:l,lastReward:h},rewards:m}}},{key:"parseFromLastReward",value:function parseFromLastReward(e,c,l,h){var d=Date.now()-h;if(d<0){var f=this.getDefaultDailyRewards(e);return{logs:{logDays:f.logDays,firstReward:0,lastReward:0},rewards:f.rewards}}var y=Math.floor(d/t3)>=1,_=t2.searchIndex(c,function(e){return!1===e});if(-1===_&&y){var v=this.getDefaultDailyRewards(e);return v.rewards[e[0].id].status=y?tY.READY:tY.WAITING,{logs:{logDays:v.logDays,firstReward:0,lastReward:h},rewards:v.rewards}}var p=[],g={};for(var m=0,A=e.length;m<A;m++){var b=e[m],D=-1!==_&&m>_,k=m===_;if(D){p.push(!1),g[b.id]=_object_spread_props(_object_spread({},b),{status:tY.WAITING});continue}if(k){p.push(!1),g[b.id]=_object_spread_props(_object_spread({},b),{status:y?tY.READY:tY.WAITING});continue}p.push(!0),g[b.id]=_object_spread_props(_object_spread({},b),{status:tY.REWARDED})}return{logs:{logDays:p,firstReward:l,lastReward:h},rewards:g}}},{key:"getDefaultDailyRewards",value:function getDefaultDailyRewards(e){var c=[],l={};var h=true,d=false,f=void 0;try{for(var y,_=e[Symbol.iterator]();!(h=(y=_.next()).done);h=true){var v=y.value;c.push(!1),l[v.id]=_object_spread_props(_object_spread({},v),{status:tY.WAITING})}}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}return l[e[0].id].status=tY.READY,{logDays:c,rewards:l}}},{key:"setDailyRewards",value:function setDailyRewards(e){this.game.storage.setStorageData("dailyRewards","dailyRewards",e)}}]),io}(eY.Plugins.BasePlugin);var t5,t6,t7,t8={exports:{}};var t9=new(function oo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(function co(){return t7||(t7=1,function(e){var c=Object.prototype.hasOwnProperty,l="~";function s(){}function n(e,c,l){this.fn=e,this.context=c,this.once=l||!1}function r(e,c,h,d,f){if("function"!=typeof h)throw new TypeError("The listener must be a function");var y=new n(h,d||e,f),_=l?l+c:c;return e._events[_]?e._events[_].fn?e._events[_]=[e._events[_],y]:e._events[_].push(y):(e._events[_]=y,e._eventsCount++),e}function i(e,c){0===--e._eventsCount?e._events=new s:delete e._events[c]}function o(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(l=!1)),o.prototype.eventNames=function(){var e,h,d=[];if(0===this._eventsCount)return d;for(h in e=this._events)c.call(e,h)&&d.push(l?h.slice(1):h);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(e)):d},o.prototype.listeners=function(e){var c=l?l+e:e,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,y=new Array(f);d<f;d++)y[d]=h[d].fn;return y},o.prototype.listenerCount=function(e){var c=l?l+e:e,h=this._events[c];return h?h.fn?1:h.length:0},o.prototype.emit=function(e,c,h,d,f,y){var _=l?l+e:e;if(!this._events[_])return!1;var v,p,g=this._events[_],m=arguments.length;if(g.fn){switch(g.once&&this.removeListener(e,g.fn,void 0,!0),m){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,h),!0;case 4:return g.fn.call(g.context,c,h,d),!0;case 5:return g.fn.call(g.context,c,h,d,f),!0;case 6:return g.fn.call(g.context,c,h,d,f,y),!0}for(p=1,v=new Array(m-1);p<m;p++)v[p-1]=arguments[p];g.fn.apply(g.context,v)}else{var A,b=g.length;for(p=0;p<b;p++)switch(g[p].once&&this.removeListener(e,g[p].fn,void 0,!0),m){case 1:g[p].fn.call(g[p].context);break;case 2:g[p].fn.call(g[p].context,c);break;case 3:g[p].fn.call(g[p].context,c,h);break;case 4:g[p].fn.call(g[p].context,c,h,d);break;default:if(!v)for(A=1,v=new Array(m-1);A<m;A++)v[A-1]=arguments[A];g[p].fn.apply(g[p].context,v)}}return!0},o.prototype.on=function(e,c,l){return r(this,e,c,l,!1)},o.prototype.once=function(e,c,l){return r(this,e,c,l,!0)},o.prototype.removeListener=function(e,c,h,d){var f=l?l+e:e;if(!this._events[f])return this;if(!c)return i(this,f),this;var y=this._events[f];if(y.fn)y.fn!==c||d&&!y.once||h&&y.context!==h||i(this,f);else{for(var _=0,v=[],p=y.length;_<p;_++)(y[_].fn!==c||d&&!y[_].once||h&&y[_].context!==h)&&v.push(y[_]);v.length?this._events[f]=1===v.length?v[0]:v:i(this,f)}return this},o.prototype.removeAllListeners=function(e){var c;return e?(c=l?l+e:e,this._events[c]&&i(this,c)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=l,o.EventEmitter=o,e.exports=o}(t8)),t8.exports}())),ne={names:[],history:[]};var nn=function(e){function fo(){var e;return _class_call_check(this,fo),e=_call_super(this,fo,arguments),u(e,"enableLog",!1),u(e,"muteEvents",[]),e}return _inherits(fo,e),_create_class(fo,[{key:"init",value:function init(){this.game.storage.addStorage("event",ne)}},{key:"enableLogEvent",value:function enableLogEvent(){this.enableLog=!0}},{key:"on",value:function on(e,c){this.validateCallback(c),this.addEventName(e),this.addHistory(e,"on","listening"),t9.on(e,c)}},{key:"once",value:function once(e,c){this.validateCallback(c),this.addEventName(e),this.addHistory(e,"once","listening"),t9.once(e,c)}},{key:"waitTo",value:function waitTo(e,c){var l=this;return new Promise(function(h,d){var f;var o=function(e){clearTimeout(f),h(e)};l.once(e,o),c&&c>0&&(f=setTimeout(function(){l.off(e,o),d(new Error("Event ".concat(e," timeout")))},c))})}},{key:"catchUp",value:function catchUp(e,c){if(this.validateCallback(c),this.once(e,c),!(this.getEventEmitCount(e)>0))return;var l,h=(null!=(l=this.getLastEventInfo(e))?l:{}).payload;this.emit(e,h)}},{key:"off",value:function off(e,c){this.validateCallback(c),t9.off(e,c),this.addHistory(e,"action","removed")}},{key:"mute",value:function mute(e){this.muteEvents.indexOf(e)>-1||this.muteEvents.push(e)}},{key:"clear",value:function clear(e){t9.removeAllListeners(e),this.addHistory(e,"action","removed")}},{key:"emit",value:function emit(e,c){if(this.muteEvents.indexOf(e)>-1)return;var l=[];c&&(l=[c]),this.addHistory(e,"action","called",c),t9.emit.apply(t9,[e].concat(_to_consumable_array(l)))}},{key:"validateCallback",value:function validateCallback(e){if("function"!=typeof e)throw new Error("Callback must be a function")}},{key:"addEventName",value:function addEventName(e){var c=this.game.storage.getStorageData("event","names");c&&c.indexOf(e)<0&&c.push(e)}},{key:"limitHistory",value:function limitHistory(e){if(e.length<=1e4)return e;return ed.Utils.Array.limit(e,1e4)}},{key:"getEventListeners",value:function getEventListeners(){return Object.keys(t9.eventNames())}},{key:"getHistory",value:function getHistory(){var e;var c=null!=(e=this.game.storage.getStorageData("event","history"))?e:[];return this.limitHistory(c)}},{key:"getEventEmitCount",value:function getEventEmitCount(e){return this.getHistory().filter(function(c){return c.name===e&&"called"===c.status}).length}},{key:"getLastEventInfo",value:function getLastEventInfo(e){var c=this.getHistory();var l=null;for(var h=c.length-1;h>=0;h--)if(c[h].name===e){l=c[h];break}return l}},{key:"getTypeFromHistory",value:function getTypeFromHistory(e){var c,l=this.getLastEventInfo(e);return null!=(c=null==l?void 0:l.type)?c:null}},{key:"getCallsFromHistory",value:function getCallsFromHistory(e){var c,l=this.getLastEventInfo(e);return null!=(c=null==l?void 0:l.called)?c:0}},{key:"addHistory",value:function addHistory(e,c,l,h){var d;var f=null!=(d=this.getTypeFromHistory(e))?d:c,y=this.getCallsFromHistory(e),_="called"===l?y+1:y;this.getHistory().push({type:f,status:l,name:e,called:_,payload:null!=h?h:{}}),this.logEventInfo(e,f,l,_)}},{key:"logEventInfo",value:function logEventInfo(e,c,l,h){this.enableLog&&("listening"===l&&t9.listenerCount(e),"called"===l&&t9.listenerCount(e))}}]),fo}(eY.Plugins.BasePlugin);var nr={},na=Object.freeze(Object.defineProperty({__proto__:null,default:nr},Symbol.toStringTag,{value:"Module"}));var ni=function(e){function un(e,c){_class_call_check(this,un);var l,h=String(e);return u(l=_call_super(this,un,['Text with key "'.concat(h,'" not found in locale "').concat(c,'"')]),"key"),u(l,"locale"),l.name="MissingKeyInLocaleError",l.key=h,l.locale=c,l}return _inherits(un,e),un}(_wrap_native_super(Error));var no=function(e){function po(e){var c;return _class_call_check(this,po),u(c=_call_super(this,po,['Locale "'.concat(e,'" not found')]),"locale"),c.name="LocaleNotFoundError",c.locale=e,c}return _inherits(po,e),po}(_wrap_native_super(Error));var nc=ed.Utils,nu=nc.Object,nh=nc.Function,nf=nc.Browser,ny=nc.Valid,n_=ed.Configs.Languages.DetectPlayerLocale;function ts(e){return ny.isEmpty(e)?null:e}var nv=function(e){function Ao(){var e;return _class_call_check(this,Ao),e=_call_super(this,Ao,arguments),u(e,"locale"),u(e,"fallbackLocale"),u(e,"data",{}),e}return _inherits(Ao,e),_create_class(Ao,[{key:"setFallbackLocale",value:function setFallbackLocale(e){this.fallbackLocale=e}},{key:"hasTextKey",value:function hasTextKey(e,c){var l=null!=c?c:this.getCurrentLocale(),h=this.getLocaleData(l).text;return nu.hasOwn(h,e)}},{key:"hasTextureKey",value:function hasTextureKey(e,c){var l=null!=c?c:this.getCurrentLocale(),h=this.getLocaleData(l).texture;return nu.hasOwn(h,e)}},{key:"add",value:function add(e,c,l){var h=arguments.length>2&&void 0!==l?l:!1;this.data[e]=c,h&&this.setFallbackLocale(e)}},{key:"choose",value:function choose(e){this.locale=e,this.game.event.emit(ed.Events.LANGUAGE_CHANGED,{locale:e})}},{key:"getText",value:function getText(e,c,l,h){var d=arguments.length>3&&void 0!==h?h:!1;try{return this.uncaughtGetText(e,c,l,!d)}catch(c){return String(e)}}},{key:"getTexture",value:function getTexture(e,c,l){var h=arguments.length>2&&void 0!==l?l:!1;return this.uncaughtGetTexture(e,c,!h)}},{key:"uncaughtGetText",value:function uncaughtGetText(e,c,l,h){var d=this;var f=arguments.length>1&&void 0!==c?c:[],y=arguments.length>2?l:void 0,_=arguments.length>3&&void 0!==h?h:!0;if(!_||void 0===this.fallbackLocale){var v=this.getRawText(e,null!=y?y:this.getCurrentLocale());return this.replaceVariables(v,f)}var p=this.fallbackLocale,g=nh.retry(function(){return d.getRawText(e,null!=y?y:d.getCurrentLocale())},function(){return d.getRawText(e,p)});return this.replaceVariables(g,f)}},{key:"getRawText",value:function getRawText(e,c){if(!this.hasTextKey(e,c))throw new ni(e,c);return this.getLocaleData(c).text[e]}},{key:"uncaughtGetTexture",value:function uncaughtGetTexture(e,c,l){var h=this;var d=arguments.length>2&&void 0!==l?l:!0;if(!d||void 0===this.fallbackLocale)return this.getRawTexture(e,null!=c?c:this.getCurrentLocale());var f=this.fallbackLocale;return nh.retry(function(){return h.getRawTexture(e,null!=c?c:h.getCurrentLocale())},function(){return h.getRawTexture(e,f)})}},{key:"getRawTexture",value:function getRawTexture(e,c){if(!this.hasTextureKey(e,c))throw new ni(e,c);return this.getLocaleData(c).texture[e]}},{key:"getCurrentLocale",value:function getCurrentLocale(){var e;return null!=(e=this.locale)?e:"en"}},{key:"getLocaleData",value:function getLocaleData(e){var c=null!=e?e:this.getCurrentLocale();if(!nu.hasOwn(this.data,c))throw new no(c);return this.data[c]}},{key:"replaceVariables",value:function replaceVariables(e,c){var l=c.length;if(0===l)return e;var h=e;for(var d=0;d<l;d++){var f=c[d],y="%{".concat(d,"}");h=h.replace(y,f)}return h}},{key:"getPlayerLanguage",value:function getPlayerLanguage(){var e,c,l,h,d=globalThis.game.player,f=GameSDK.getLocale(),y=ts(null==f?void 0:f.trim().split(/[-_]/)[0]),_=ts(this.getBrowserLanguage());return d.getPlayerDataByKey("isFirstLogin")?null!=(e=null!=y?y:_)?e:"en":null!=(h=null!=(l=null!=(c=ts(d.getPlayerSetting("language")))?c:y)?l:_)?h:"en"}},{key:"getBrowserLanguage",value:function getBrowserLanguage(){var e;if(!1===n_)return"en";var c=nf.getLocale();return null==(e=null==c?void 0:c.trim())?void 0:e.split(/[-_]/)[0]}}]),Ao}(eY.Plugins.BasePlugin);var np={_id:"",name:"",createdBy:"",description:"",expireTime:6048e5,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15},ng=ed.Configs,nm=ed.Utils,nA=nm.Object,nw=nm.String,nb=nm.Valid,nD=ng.OtherHost,nS=ng.Mockup,nk=ng.AppId;var nI=function(){function So(){_class_call_check(this,So),u(this,"mockAPI")}return _create_class(So,[{key:"initMockAPI",value:function initMockAPI(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:if(this.mockAPI)return[2];return[4,ie(function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return na})];case 1:return[2,{default:e.sent().default}]}})})()},void 0,c.meta.url)];case 1:if("function"!=typeof(e=l.sent().default))throw new Error("Cannot load LeaderboardAPIMock");return this.mockAPI=new e,[2]}})}).call(this)}},{key:"getLeadersAsync",value:function getLeadersAsync(e,c,l){return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(h=nw.params(l),!nS.Leaderboards.Enabled)return[3,6];return[4,this.initMockAPI()];case 1:if(f.sent(),!("playerIds"in l))return[3,3];return[4,this.mockAPI.getPlayers(e,l)];case 2:return d=f.sent(),[3,5];case 3:return[4,this.mockAPI.getLeaders(e,l)];case 4:d=f.sent(),f.label=5;case 5:return[3,8];case 6:return[4,Me("".concat(c,"?").concat(h),{},nD)];case 7:d=f.sent(),f.label=8;case 8:return[2,nA.hasOwn(d,"data")&&Array.isArray(d.data)?d.data:[]]}})}).call(this)}},{key:"getLeaderboardAsync",value:function getLeaderboardAsync(e){return _async_to_generator(function(){var c,l;return _ts_generator(this,function(h){switch(h.label){case 0:if(l="leaderboards/".concat(e),!nS.Leaderboards.Enabled)return[3,3];return[4,this.initMockAPI()];case 1:return h.sent(),[4,this.mockAPI.getLeaderboardAsync(e)];case 2:return c=h.sent(),[3,5];case 3:return[4,Me(l,{},nD)];case 4:c=h.sent(),nA.hasOwn(c,"data")&&nb.isObject(c.data)&&(c=c.data),h.label=5;case 5:return[2,c]}})}).call(this)}},{key:"getLeaderboardsAsync",value:function getLeaderboardsAsync(e){return _async_to_generator(function(){var c,l;return _ts_generator(this,function(h){switch(h.label){case 0:if(l=ed.Utils.String.params(e),!nS.Leaderboards.Enabled)return[3,3];return[4,this.initMockAPI()];case 1:return h.sent(),[4,this.mockAPI.getLeaderboardsAsync(e)];case 2:return c=h.sent(),[3,5];case 3:return[4,Me("leaderboards?".concat(l),{},nD)];case 4:c=h.sent(),nA.hasOwn(c,"data")&&Array.isArray(c.data)?c=c.data:c=[],h.label=5;case 5:return[2,c]}})}).call(this)}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(c=e.leaderboardId,l=e.playerId,h=e.score,!nS.Leaderboards.Enabled)return[3,3];return[4,this.initMockAPI()];case 1:return d.sent(),[4,this.mockAPI.setScoreAsync(c,l,h)];case 2:return d.sent(),[3,5];case 3:return[4,J("leaderboards/".concat(c,"/players/").concat(l),{score:h},{},nD)];case 4:d.sent(),d.label=5;case 5:return[2]}})}).call(this)}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:if(l=null!=(c=e._id)?c:nw.generateObjectId(),h=e.numberOfLeaders,d=_object_spread_props(_object_spread({},np,e),{_id:l,appId:nk,numberOfLeaders:h}),f="leaderboards",!nS.Leaderboards.Enabled)return[3,3];return[4,this.initMockAPI()];case 1:return _.sent(),[4,this.mockAPI.createLeaderboard(d)];case 2:return y=_.sent(),[3,5];case 3:return[4,J(f,d,{},nD)];case 4:y=_.sent(),nA.hasOwn(y,"data")&&nb.isObject(y.data)&&(y=y.data),_.label=5;case 5:if(!nA.hasOwn(y,"_id")||y._id!==l)throw new Error("Create leaderboard failed");return[2,l]}})}).call(this)}}]),So}();var nP={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},nE={leaderboards:{}},nC=ed.Utils,nx=nC.Array,nT=nC.Valid,nN=nC.Json,nL=nC.Object;var nO=function(e){function xo(){var e;return _class_call_check(this,xo),e=_call_super(this,xo,arguments),u(e,"lbAPI",new nI),u(e,"configs"),e}return _inherits(xo,e),_create_class(xo,[{key:"init",value:function init(){this.game.storage.addStorage("leaderboard",nE),this.configs={}}},{key:"addLeaderboard",value:function addLeaderboard(e){var c=e.name,l=e.type,h=e.leaderboardId,d=e.autoSortRank;if(this.getLeaderboard(c))return;var f="leaderboards/".concat(h,"/");("global"===l||"tournament"===l)&&(f+="leaders"),"friends"===l&&(f+="players"),this.configs[c]={id:h,name:c,type:l,host:f,autoSortRank:d};var y=nN.clone(nP);this.setLeaderboard(c,_object_spread({},y))}},{key:"requestLeaderboardsAsync",value:function requestLeaderboardsAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.lbAPI.getLeaderboardsAsync(e)];case 1:return[2,c.sent()];case 2:return c.sent(),[2,[]];case 3:return[2]}})}).call(this)}},{key:"requestLeaderboardAsync",value:function requestLeaderboardAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:if(A.trys.push([0,,6,8]),this.validateLeaderboard(e),this.clearLeaderboard(e),this.setLeaderboard(e,{isRequesting:!0}),h=(l=this.configs[e]).id,d=l.type,f=l.host,y=[],"friends"!==d)return[3,2];return v=[(_=this.game.player).getPlayerId()].concat(_to_consumable_array(_.getConnectedPlayerIds(c,0))),this.configs[e].playerIds=_to_consumable_array(v),[4,this.lbAPI.getLeadersAsync(h,f,{playerIds:v})];case 1:return y=A.sent(),[3,4];case 2:return[4,this.lbAPI.getLeadersAsync(h,f,{limit:c,offset:0})];case 3:y=A.sent(),A.label=4;case 4:if(0===y.length)return[2];return[4,this.receiveLeaderboardAsync(e,y)];case 5:return A.sent(),this.setLeaderboard(e,{limit:c,offset:0}),[3,8];case 6:return[4,this.lbAPI.getLeaderboardAsync(this.configs[e].id)];case 7:return g=(p=A.sent())?p.resettable:"",m=p?p.amountPlayer:0,this.setLeaderboard(e,{isRequesting:!1,resettable:g,amountPlayer:m}),[7];case 8:return[2]}})}).call(this)}},{key:"loadMoreLeaderboardAsync",value:function loadMoreLeaderboardAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:if(!((l=this.getLeaderboard(e))&&"friends"!==this.configs[e].type))return[3,4];v.label=1;case 1:return v.trys.push([1,,3,4]),this.setLeaderboard(e,{isRequesting:!0}),d=(h=this.configs[e]).id,f=h.host,y=l.offset+l.limit,[4,this.lbAPI.getLeadersAsync(d,f,{limit:c,offset:y})];case 2:if(0===(_=v.sent()).length)return[2];return this.receiveLeaderboardAsync(e,_),this.setLeaderboard(e,{limit:c,offset:y}),[3,4];case 3:return this.setLeaderboard(e,{isRequesting:!1}),[7];case 4:return[2]}})}).call(this)}},{key:"getLeaderboard",value:function getLeaderboard(e){var c=this.game.storage.getStorageData("leaderboard","leaderboards");return c&&c[e]?c[e]:null}},{key:"getLeadersByPlayerIdsAsync",value:function getLeadersByPlayerIdsAsync(e,c){return _async_to_generator(function(){var l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),this.validateLeaderboard(e),l=this.configs[e].id,h="leaderboards/".concat(l,"/players"),[4,this.lbAPI.getLeadersAsync(l,h,{playerIds:c})];case 1:return[2,0===(d=f.sent()).length?[]:this.toLeaders(d)];case 2:return f.sent(),[2,[]];case 3:return[2]}})}).call(this)}},{key:"getLeaderboardResponseAsync",value:function getLeaderboardResponseAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return[4,this.lbAPI.getLeaderboardAsync(e)];case 1:return[2,c.sent()]}})}).call(this)}},{key:"clearLeaderboard",value:function clearLeaderboard(e){try{this.validateLeaderboard(e);var c=nN.clone(nP);this.setLeaderboard(e,null),this.setLeaderboard(e,_object_spread({},c))}catch(e){}}},{key:"isLeaderboardEmpty",value:function isLeaderboardEmpty(e){var c=this.getLeaderboard(e);if(!c)return!0;return 0===Object.keys(c.leaders).length}},{key:"isExistLeaderboardId",value:function isExistLeaderboardId(e){var c=this.configs;return nL.vals(c).some(function(c){return c.id===e})}},{key:"getLeaderboardName",value:function getLeaderboardName(e){var c=this.configs,l=nx.search(nL.vals(c),function(c){return c.id===e});return l?l.name:null}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e,c,l){return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,3,,4]),GameSDK.extra.isGuest)return[2];return this.validateLeaderboard(e),h=this.configs[e].id,[4,this.getLastScoreOnLeaderboard(e,c)];case 1:if((d=f.sent())&&l<=d)return[2];return[4,this.lbAPI.setLeaderboardScoreAsync({leaderboardId:h,playerId:c,score:l})];case 2:return f.sent(),[3,4];case 3:return f.sent(),[3,4];case 4:return[2]}})}).call(this)}},{key:"getLastScoreOnLeaderboard",value:function getLastScoreOnLeaderboard(e,c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){switch(h.label){case 0:return[4,this.getLeadersByPlayerIdsAsync(e,[c])];case 1:return[2,0===(l=h.sent()).length?null:l[0].score]}})}).call(this)}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){return[2,this.lbAPI.createLeaderboardAsync(e)]})}).call(this)}},{key:"validateLeaderboard",value:function validateLeaderboard(e){var c=this.getLeaderboard(e);if(!nT.isObject(c))throw new Error("Leaderboard with name ".concat(e," not found"))}},{key:"setLeaderboard",value:function setLeaderboard(e,c){if(!c)return;this.game.storage.setStorageData("leaderboard","leaderboards",_define_property({},e,c))}},{key:"receiveLeaderboardAsync",value:function receiveLeaderboardAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:return this.validateLeaderboard(e),[4,this.toLeaders(c)];case 1:return d=m.sent().filter(function(e){return e.name&&e.photo}),y=void 0===(f=(null!=(h=this.getLeaderboard(e))?h:{}).leaders)?{}:f,_=d.filter(function(e){return y[e.playerId]?(y[e.playerId]=e,!1):!0}),v=nL.vals(y),_.length>0&&(l=v).unshift.apply(l,_to_consumable_array(_)),p=v.sort(function(e,c){return e.rank-c.rank}),this.configs[e].autoSortRank&&(p=p.map(function(e,c){return _object_spread_props(_object_spread({},e),{rank:c+1})})),g=nL.keyBy(p,"playerId"),this.setLeaderboard(e,{leaders:g}),[2]}})}).call(this)}},{key:"toLeaders",value:function toLeaders(e){return _async_to_generator(function(){var c,l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return c=this,l=this.game.profile,h=e.map(function(e){return e.playerId}),[4,l.requestProfiles(h)];case 1:return f.sent(),d=l.getProfiles(),[2,e.map(function(e){var l,h=d[e.playerId];if(!h){var f=null!=(l=c.game.language.getText("core.nameless"))?l:"Nameless";return _object_spread_props(_object_spread({},e),{name:f,photo:"default"})}return _object_spread_props(_object_spread({},e),{name:h.name,photo:h.photo})}).map(function(e){return _object_spread_props(_object_spread({},e),{score:parseInt(e.score,10)})})]}})}).call(this)}}]),xo}(eY.Plugins.BasePlugin);var nM=function(){function Co(){_class_call_check(this,Co),u(this,"APIHost")}return _create_class(Co,[{key:"setAPIHost",value:function setAPIHost(e){this.APIHost=e}},{key:"getAPIHost",value:function getAPIHost(){return this.APIHost}}]),Co}();var nR=ed.Utils;var nF=function(e){function _o(){return _class_call_check(this,_o),_call_super(this,_o,arguments)}return _inherits(_o,e),_create_class(_o,[{key:"createSingleMatchAsync",value:function createSingleMatchAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,J("single-matches",e,{},this.getAPIHost())];case 1:return c=l.sent(),[2,this.returnValidMatchData(c)]}})}).call(this)}},{key:"getSingleMatchDetailAsync",value:function getSingleMatchDetailAsync(){return _async_to_generator(function(){var e;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,Me("single-matches/active",{},this.getAPIHost())];case 1:return e=c.sent(),[2,this.returnValidMatchData(e)]}})}).call(this)}},{key:"updateSingleMatchMoveAsync",value:function updateSingleMatchMoveAsync(e,c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){switch(h.label){case 0:return[4,J("single-matches/".concat(e,"/move"),c,{},this.getAPIHost())];case 1:return l=h.sent(),[2,this.returnValidMatchData(l)]}})}).call(this)}},{key:"finishSingleMatchAsync",value:function finishSingleMatchAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,J("single-matches/".concat(e,"/finish"),{},{},this.getAPIHost())];case 1:return c=l.sent(),[2,this.returnValidMatchData(c)]}})}).call(this)}},{key:"createMatchAsync",value:function createMatchAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,J("matches",e,{},this.getAPIHost())];case 1:return c=l.sent(),[2,this.returnValidMatchData(c)]}})}).call(this)}},{key:"joinMatchAsync",value:function joinMatchAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,J("matches/".concat(e,"/join"),{},{},this.getAPIHost())];case 1:return c=l.sent(),[2,this.returnValidMatchData(c)]}})}).call(this)}},{key:"getMatchDetailByIdAsync",value:function getMatchDetailByIdAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,Me("matches/".concat(e),{},this.getAPIHost())];case 1:return c=l.sent(),[2,this.returnValidMatchData(c)]}})}).call(this)}},{key:"finishMatchAsync",value:function finishMatchAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:return l=void 0===(c=e.matchId)?"":c,d=void 0===(h=e.score)?0:h,y=void 0===(f=e.level)?0:f,v=void 0===(_=e.extraData)?{}:_,[4,J("matches/".concat(l,"/finish"),{matchId:l,score:d,level:y,extraData:v},{},this.getAPIHost())];case 1:return p=g.sent(),[2,this.returnValidMatchData(p)]}})}).call(this)}},{key:"returnValidMatchData",value:function returnValidMatchData(e){var c;return nR.Valid.isObject(e)?nR.Object.hasOwn(e,"data")?null!=(c=e.data)?c:{}:{}:{}}}]),_o}(nM);var nG=function(){function No(e){_class_call_check(this,No),u(this,"matchAPI"),this.createAPI(),this.setAPIConfig(e)}return _create_class(No,[{key:"createAPI",value:function createAPI(){this.matchAPI=new nF}},{key:"setAPIConfig",value:function setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}},{key:"setMatchAPIInstance",value:function setMatchAPIInstance(e){this.matchAPI=e}},{key:"getMatchAPI",value:function getMatchAPI(){return this.matchAPI}}]),No}();var nj=function(){function P(e,c){_class_call_check(this,P),u(this,"game"),u(this,"match"),this.game=e,this.match=c}return _create_class(P,[{key:"startLog",value:function startLog(e){}},{key:"endLog",value:function endLog(){}},{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(e){throw new Error("Not implemented")})})()}}]),P}();var nB=function(e){function An(e){var c;return _class_call_check(this,An),(c=_call_super(this,An,[e])).name="LevelNotDefined",c.message=null!=e?e:"Level is not defined",c}return _inherits(An,e),An}(ex);var nU=function(e){function ss(e){var c;return _class_call_check(this,ss),(c=_call_super(this,ss,[e])).name="MatchModeNotDefined",c.message=null!=e?e:"Match id is not defined",c}return _inherits(ss,e),ss}(ex);var nV=ed.Utils.Valid;var nH=function(){function w(e){_class_call_check(this,w),u(this,"game"),u(this,"match"),u(this,"nextHandler"),this.game=e.game,this.match=e.match,this.nextHandler=null}return _create_class(w,[{key:"setNext",value:function setNext(e){return this.nextHandler=e,e}},{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){return this.logData("Before",e),[2]})}).call(this)}},{key:"nextAsync",value:function nextAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:if(this.logData("After",e),!this.nextHandler)return[3,2];return[4,this.nextHandler.processAsync(e)];case 1:c.sent(),c.label=2;case 2:return[2]}})}).call(this)}},{key:"logData",value:function logData(e,c){nV.isDebugger()}}]),w}();var nK=ed.Plugins,nz=ed.Utils,nW=nK.Analytics,nq=nz.String,nY=nz.Valid;var nJ=function(e){function z(){return _class_call_check(this,z),_call_super(this,z,arguments)}return _inherits(z,e),_create_class(z,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(z.prototype),"processAsync",c)})().call(l,e),h=e.mode,d=e.customData.level,this.validateMode(h),this.validateLevel(d),this.game.analytics.event(nW.Events.MATCH_START,{level:d,game_mode:nq.toUpperCamelCase(h),level_name:this.getLevelName(d)}),[4,this.nextAsync(e)];case 1:return f.sent(),[2]}})}).call(this)}},{key:"validateMode",value:function validateMode(e){if(!nY.isString(e))throw new nU}},{key:"validateLevel",value:function validateLevel(e){if(!nY.isNumber(e))throw new nB}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(nq.padStart(e.toString(),5,"0"))}}]),z}(nH);var nQ={OPEN:"open",ACTIVE:"active",FINISHED:"finished"};var nX=function(e){function N(){return _class_call_check(this,N),_call_super(this,N,arguments)}return _inherits(N,e),_create_class(N,[{key:"processAsync",value:function processAsync(e){var c=this;var h=this;return _async_to_generator(function(){var d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return(function(){return _get(_get_prototype_of(N.prototype),"processAsync",c)})().call(h,e),d=e.mode,f=e.status,y=null!=d?d:l.SINGLE,f===nQ.FINISHED&&(y=l.SINGLE),this.contextGameModeDetected(y),[4,this.nextAsync(e)];case 1:return _.sent(),[2]}})}).call(this)}},{key:"contextGameModeDetected",value:function contextGameModeDetected(e){this.game.storage.setStorageData("context","contextGameMode",e)}}]),N}(nH);var n$=function(e){function ns(e){var c;return _class_call_check(this,ns),(c=_call_super(this,ns,[e])).name="GetMatchDetailFailed",c.message=null!=e?e:"Get match detail failed",c}return _inherits(ns,e),ns}(_wrap_native_super(Error));var nZ=function(e){function In(e){var c;return _class_call_check(this,In),(c=_call_super(this,In,[e])).name="MatchAreNotActive",c.message=null!=e?e:"Match are not active",c}return _inherits(In,e),In}(_wrap_native_super(Error));var n0=function(e){function se(e){var c;return _class_call_check(this,se),(c=_call_super(this,se,[e])).name="MatchIdNotValid",c.message=null!=e?e:"Match id is not valid",c}return _inherits(se,e),se}(ex);var n2=function(e){function Ro(e){var c;return _class_call_check(this,Ro),(c=_call_super(this,Ro,[e])).name="OpponentHasFinishedMatch",c.message=e||"Opponent has finished match",c}return _inherits(Ro,e),Ro}(_wrap_native_super(Error));var n1=function(e){function H(e){var c;return _class_call_check(this,H),(c=_call_super(this,H,[e])).name="OpponentIdNotValid",c.message=null!=e?e:"Opponent id is not valid",c}return _inherits(H,e),H}(ex);var n3=function(e){function as(e){var c;return _class_call_check(this,as),(c=_call_super(this,as,[e])).name="PlayerNotCurrentInMatch",c.message=null!=e?e:"The player is not currently in this match",c}return _inherits(as,e),as}(_wrap_native_super(Error));var n4=function(e){function Pn(e){var c;return _class_call_check(this,Pn),(c=_call_super(this,Pn,[e])).name="PlayerNotFinishedMatch",c.message=e||"Player not finished match",c}return _inherits(Pn,e),Pn}(_wrap_native_super(Error));var n5=ed.Dtos,n6=ed.Utils.Object;var n7=function(e){function Fo(){return _class_call_check(this,Fo),_call_super(this,Fo,arguments)}return _inherits(Fo,e),_create_class(Fo,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(Fo.prototype),"processAsync",c)})().call(l,e),this.validateMatchData(e),[4,this.getMatchAsync(e)];case 1:return h=f.sent(),d=new n5.Match.Data(h).toObject(),this.validateAwaitMatchData(e,d),this.updateMatchData(e,d),this.validateMatchStatus(e),this.validatePlayerTurn(e),this.validateOpponentTurn(e),[4,this.nextAsync(e)];case 2:return f.sent(),[2]}})}).call(this)}},{key:"validateMatchData",value:function validateMatchData(e){if("string"!=typeof e.id)throw new n0}},{key:"validateMatchStatus",value:function validateMatchStatus(e){if(e.status!==nQ.ACTIVE)throw new nZ}},{key:"validateAwaitMatchData",value:function validateAwaitMatchData(e,c){var l=e.id,h=e.customData,d=c._id,f=c.whitePlayerId,y=c.blackPlayerId;if("string"!=typeof d||d!==l)throw new n$;var _=h.playerId,v=f===_;if(!v&&y===eC.playerId)throw new tT;if(!v&&y!==_)throw new n3}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var c=e.profiles,l=e.customData.playerId;if("string"!=typeof l)throw new eT;if(!c[l].finished)throw new n4}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var c=e.profiles,l=e.customData.opponentId;if("string"!=typeof l)throw new n1;if(c[l].finished)throw new n2}},{key:"getMatchAsync",value:function getMatchAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){return[2,(c=e.id)?this.match.api.getMatchAPI().getMatchDetailByIdAsync(c):{}]})}).call(this)}},{key:"updateMatchData",value:function updateMatchData(e,c){this.updateMatchGeneral(e,c),this.updatePlayerIds(e,c),this.initializeProfiles(e),this.updateScoresAndStatus(e,c)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,c){var l=c.status,h=c.extraData;e.status=l,e.customData=n6.merge(e.customData,h)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,c){var l=c.whitePlayerId,h=c.blackPlayerId,d=l===e.customData.playerId;e.customData.playerId=d?l:h,e.customData.opponentId=d?h:l}},{key:"initializeProfiles",value:function initializeProfiles(e){var c=e.customData,l=c.playerId,h=c.opponentId;if(!l||!h)return;var d={name:"",photo:"",finished:!1};e.profiles[l]||(e.profiles[l]=_object_spread({id:l},d)),e.profiles[h]||(e.profiles[h]=_object_spread({id:h},d))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,c){var l=e.customData,h=l.playerId,d=l.opponentId;if(!h||!d)return;var f=c.whitePlayerId,y=c.whitePlayerScore,_=c.whitePlayerFinish,v=c.blackPlayerScore,p=c.blackPlayerFinish,g=f===h;e.profiles[h].score=g?y:v,e.profiles[d].score=g?v:y,e.profiles[h].finished=g?_:p,e.profiles[d].finished=g?p:_}}]),Fo}(nH);var n8={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null};var n9=function(e){function j(e,c){var l;return _class_call_check(this,j),u(l=_call_super(this,j,[e]),"payload"),l.payload=c,l}return _inherits(j,e),_create_class(j,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return(function(){return _get(_get_prototype_of(j.prototype),"processAsync",c)})().call(l,e),this.initializeMatch(e),[4,this.nextAsync(e)];case 1:return h.sent(),[2]}})}).call(this)}},{key:"initializeMatch",value:function initializeMatch(e){var c=this.payload,l=c.id,h=c.mode,d=c.customData;e.id=null!=l?l:null,e.mode=h||null,e.status=nQ.OPEN,e.startAt=0,e.finishAt=0,e.profiles={},e.customData=_object_spread({},n8,e.customData,d)}}]),j}(nH);var rt=function(e){function S(e){var c;return _class_call_check(this,S),(c=_call_super(this,S,[e])).name="UnavailableFeature",c.message="Unavailable feature: ".concat(e),c}return _inherits(S,e),S}(_wrap_native_super(Error));var rr=function(e){function Q(e){var c;return _class_call_check(this,Q),(c=_call_super(this,Q,[e])).name="ContextIdNotValid",c.message=null!=e?e:"Context id is not valid",c}return _inherits(Q,e),Q}(ex);var rs=function(e){function x(e){var c;return _class_call_check(this,x),(c=_call_super(this,x,[e])).name="ProfileNotFound",c.message=null!=e?e:"Profile not found",c}return _inherits(x,e),x}(ex);var ri=function(e){function Go(){return _class_call_check(this,Go),_call_super(this,Go,arguments)}return _inherits(Go,e),_create_class(Go,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(Go.prototype),"processAsync",c)})().call(l,e),this.validateData(e),[4,this.createWideframesAwaitingAsync(e)];case 1:return(h=d.sent())&&this.sendMessageAsync(e,h),[4,this.nextAsync(e)];case 2:return d.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.id,l=e.customData,h=l.contextId,d=l.opponentId;if(!c||"string"!=typeof c)throw new n0;if(!h||"string"!=typeof h)throw new rr;if(!d||"string"!=typeof d)throw new n1}},{key:"createWideframesAwaitingAsync",value:function createWideframesAwaitingAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A,b,D;return _ts_generator(this,function(k){switch(k.label){case 0:if(k.trys.push([0,4,,5]),c=this.game.frameCapture,l=e.profiles,d=(h=e.customData).playerId,f=h.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];if(v=y.photo,g=void 0===(p=y.score)?0:p,!y.finished)return[2,null];if(m=_.photo,b=void 0===(A=_.score)?0:A,!_.finished)return[3,1];return D=null,[3,3];case 1:return[4,c.wideframe.renderResultChallenge({playerId:d,playerPhoto:v,playerScore:g,opponentId:f,opponentPhoto:m,opponentScore:b,isPlayerFinished:!0,isOpponentFinished:!1})];case 2:D=k.sent(),k.label=3;case 3:return[2,D];case 4:return k.sent(),[2,null];case 5:return[2]}})}).call(this)}},{key:"sendMessageAsync",value:function sendMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(l=e.id,h=e.profiles,f=(d=e.customData).playerId,y=d.opponentId,!f||"string"!=typeof f)throw new eT;if(!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");if(!(_=h[f]))throw new rs;return v=_.name,p={data:{type:tD.CHALLENGE_FRIEND,matchId:l,playerId:f,opponentId:y},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(v," is waiting for you to finish this game. Play now!"),localizations:{vi_VN:"".concat(v," đang chờ bạn kết th\xfac trận đấu. Chơi ngay!")}},image:c,strategy:"LAST",notification:"PUSH"},[4,GameSDK.extra.updateAsync(p)];case 1:return g.sent(),[2]}})})()}}]),Go}(nH);var ro=function(e){function C(){return _class_call_check(this,C),_call_super(this,C,arguments)}return _inherits(C,e),_create_class(C,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return[4,this.nextAsync(e)];case 1:return c.sent(),[2]}})}).call(this)}},{key:"nextAsync",value:function nextAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:if(!this.nextHandler)return[3,2];return[4,this.nextHandler.processAsync(e)];case 1:c.sent(),c.label=2;case 2:return[2]}})}).call(this)}}]),C}(nH);var ru=ed.Dtos;var rh=function(e){function de(){return _class_call_check(this,de),_call_super(this,de,arguments)}return _inherits(de,e),_create_class(de,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f,y,_,v;return _ts_generator(this,function(p){switch(p.label){case 0:return(function(){return _get(_get_prototype_of(de.prototype),"processAsync",c)})().call(l,e),this.validateData(e),d=(h=e.customData).playerId,f=h.opponentId,y=d,[4,this.getProfile(y)];case 1:if(!(_=p.sent()))throw new rs;if(this.updateMatchProfile(e,y,_),(y=f)===eC.playerId)return[3,3];return[4,this.getProfile(y)];case 2:if(!(v=p.sent()))throw new rs;return this.updateMatchProfile(e,y,v),[3,4];case 3:this.updateMatchProfile(e,y),p.label=4;case 4:return[4,this.nextAsync(e)];case 5:return p.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.customData,l=c.playerId,h=c.opponentId;if(!l||"string"!=typeof l)throw new eT;if(!h||"string"!=typeof h)throw new n1}},{key:"getProfile",value:function getProfile(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,(c=this.game.profile).requestProfiles([e])];case 1:return[2,(l.sent(),c.getProfiles()[e])]}})}).call(this)}},{key:"updateMatchProfile",value:function updateMatchProfile(e,c,l){var h=null!=l?l:eC,d=h.name,f=h.photo,y=new ru.Match.Profile({id:c,name:d,photo:f}).toObject();e.profiles[c]?(e.profiles[c].name=y.name,e.profiles[c].photo=y.photo):e.profiles[c]=y}}]),de}(nH);var rd=function(e){function Uo(){return _class_call_check(this,Uo),_call_super(this,Uo,arguments)}return _inherits(Uo,e),_create_class(Uo,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A;return _ts_generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,,2,3]),this.startLog(e),c=e.matchId,h=e.playerId,d=e.opponentId,f=new ro(this),y=new n9(this,{id:c,mode:l.CHALLENGE_FRIEND,customData:{playerId:h,opponentId:d}}),f.setNext(y),_=new n7(this),y.setNext(_),v=new rh(this),_.setNext(v),p=new ri(this),v.setNext(p),g=new nJ(this),p.setNext(g),m=new nX(this),g.setNext(m),A=this.match.getMatchState(),[4,f.processAsync(A)];case 1:return b.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Uo}(nj);var rf=function(e){function is(e){var c;return _class_call_check(this,is),(c=_call_super(this,is,[e])).name="CreateContextFailed",c.message=null!=e?e:"Create context failed",c}return _inherits(is,e),is}(ex);var ry=ed.Utils,r_=ry.Valid,rv=ry.Object;var rp=function(e){function Vo(e,c){var l;return _class_call_check(this,Vo),u(l=_call_super(this,Vo,[e]),"payload"),l.payload=c,l}return _inherits(Vo,e),_create_class(Vo,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(Vo.prototype),"processAsync",c)})().call(l,e),h=this.payload.opponentId,[4,this.createAsync(h)];case 1:return d=f.sent(),e.customData.contextId=d,[4,this.nextAsync(e)];case 2:return f.sent(),[2]}})}).call(this)}},{key:"createAsync",value:function createAsync(e){return _async_to_generator(function(){var c,l;return _ts_generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,GameSDK.context.createAsync(e)];case 1:return h.sent(),[3,3];case 2:return c=h.sent(),this.validateError(c),[3,3];case 3:if(l=GameSDK.context.getID(),!r_.isString(l))throw new rf;return[2,l]}})}).call(this)}},{key:"validateError",value:function validateError(e){if(!rv.hasOwn(e,"code"))throw e;if("SAME_CONTEXT"!==e.code){if("INVALID_PARAM"===e.code){if(!this.isNotConnectedPlayerError(e))throw e;return}throw e}}},{key:"validateErrorMessage",value:function validateErrorMessage(e){if(!rv.hasOwn(e,"message")||!r_.isString(e.message))throw e}},{key:"isNotConnectedPlayerError",value:function isNotConnectedPlayerError(e){return this.validateErrorMessage(e),e.message.indexOf("is not a connected player of the current player")>-1}}]),Vo}(nH);var rg=function(e){function ct(e){var c;return _class_call_check(this,ct),(c=_call_super(this,ct,[e])).name="MatchAreNotOpen",c.message=null!=e?e:"Match are not open",c}return _inherits(ct,e),ct}(ex);var rm=ed.Dtos,rA=ed.Utils.Object;var rw=function(e){function vn(e,c){var l;return _class_call_check(this,vn),u(l=_call_super(this,vn,[e]),"payload"),l.payload=c,l}return _inherits(vn,e),_create_class(vn,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(vn.prototype),"processAsync",c)})().call(l,e),this.validateData(e),[4,this.createMatchAsync(e)];case 1:return h=f.sent(),d=new rm.Match.Data(h).toObject(),this.updateMatchState(e,d),[4,this.nextAsync(e)];case 2:return f.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.status;if("string"!=typeof e.customData.opponentId)throw new n1;if(c!==nQ.OPEN)throw new rg}},{key:"createMatchAsync",value:function createMatchAsync(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){if(c=e.customData.opponentId,l=this.payload.extraData,!c)return[2,{}];return h={opponentPlayerId:c,extraData:l},[2,this.match.api.getMatchAPI().createMatchAsync(h)]})}).call(this)}},{key:"updateMatchState",value:function updateMatchState(e,c){this.updateMatchGeneral(e,c),this.updatePlayerIds(e,c),this.initializeProfiles(e),this.updateFinishStatus(e,c)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,c){var l=c._id,h=c.extraData;e.id=l||null,e.customData=rA.merge(e.customData,h)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,c){var l=c.whitePlayerId,h=c.blackPlayerId,d=l===e.customData.opponentId;e.customData.playerId=d?h:l,e.customData.opponentId=d?l:h}},{key:"initializeProfiles",value:function initializeProfiles(e){var c=e.customData,l=c.playerId,h=c.opponentId;if(!l||!h)return;var d={name:"",photo:"",finished:!1};e.profiles[l]||(e.profiles[l]=_object_spread({id:l},d)),e.profiles[h]||(e.profiles[h]=_object_spread({id:h},d))}},{key:"updateFinishStatus",value:function updateFinishStatus(e,c){var l=e.customData,h=l.playerId,d=l.opponentId;if(!h||!d)return;var f=c.whitePlayerId,y=c.whitePlayerFinish,_=c.blackPlayerFinish,v=f===e.customData.opponentId;e.profiles[h].finished=v?_:y,e.profiles[d].finished=v?y:_}}]),vn}(nH);var rb=function(e){function X(){return _class_call_check(this,X),_call_super(this,X,arguments)}return _inherits(X,e),_create_class(X,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:if((function(){return _get(_get_prototype_of(X.prototype),"processAsync",c)})().call(l,e),e.status!==nQ.OPEN)throw new rg;return this.startMatch(e),[4,this.nextAsync(e)];case 1:return h.sent(),[2]}})}).call(this)}},{key:"startMatch",value:function startMatch(e){e.status=nQ.ACTIVE,e.startAt=Date.now()}}]),X}(nH);var rD=function(e){function bn(){return _class_call_check(this,bn),_call_super(this,bn,arguments)}return _inherits(bn,e),_create_class(bn,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(bn.prototype),"processAsync",c)})().call(l,e),this.validateData(e),[4,this.createWideframesChallengeAsync(e)];case 1:return(h=d.sent())&&this.sendMessageAsync(e,h),[4,this.nextAsync(e)];case 2:return d.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.id,l=e.customData,h=l.contextId,d=l.opponentId;if(!c||"string"!=typeof c)throw new n0;if(!h||"string"!=typeof h)throw new rr;if(!d||"string"!=typeof d)throw new n1}},{key:"createWideframesChallengeAsync",value:function createWideframesChallengeAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A,b;return _ts_generator(this,function(D){switch(D.label){case 0:if(D.trys.push([0,2,,3]),c=this.game.frameCapture,l=e.profiles,d=(h=e.customData).playerId,f=h.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];return v=y.photo,g=void 0===(p=y.score)?0:p,m=_.photo,b=void 0===(A=_.score)?0:A,[4,c.wideframe.renderResultChallenge({playerId:d,playerPhoto:v,playerScore:g,opponentId:f,opponentPhoto:m,opponentScore:b,isPlayerFinished:!1,isOpponentFinished:!1})];case 1:return[2,D.sent()];case 2:return D.sent(),[2,null];case 3:return[2]}})}).call(this)}},{key:"sendMessageAsync",value:function sendMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v;return _ts_generator(this,function(p){switch(p.label){case 0:if(l=e.id,h=e.profiles,f=(d=e.customData).playerId,y=d.opponentId,!f||"string"!=typeof f)throw new eT;if(!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");return _=h[f].name,v={data:{type:tD.CHALLENGE_FRIEND,matchId:l,playerId:f,opponentId:y},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(_," challenges you"),localizations:{vi_VN:"".concat(_," thử th\xe1ch bạn trong trận đấu n\xe0y. Chơi ngay!")}},image:c,strategy:"IMMEDIATE",notification:"PUSH"},[4,GameSDK.extra.updateAsync(v)];case 1:return p.sent(),[2]}})})()}}]),bn}(nH);var rS=function(e){function Ko(){return _class_call_check(this,Ko),_call_super(this,Ko,arguments)}return _inherits(Ko,e),_create_class(Ko,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A,b,D;return _ts_generator(this,function(k){switch(k.label){case 0:return k.trys.push([0,,2,3]),this.startLog(e),c=e.playerId,h=e.opponentId,d=e.extraData,f=new ro(this),y=new rp(this,{opponentId:h}),f.setNext(y),_=new n9(this,{mode:l.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:h}}),y.setNext(_),v=new rw(this,{extraData:d}),_.setNext(v),p=new rh(this),v.setNext(p),g=new rb(this),p.setNext(g),m=new nJ(this),g.setNext(m),A=new rD(this),m.setNext(A),b=new nX(this),A.setNext(b),D=this.match.getMatchState(),[4,f.processAsync(D)];case 1:return k.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Ko}(nj);var rk=function(e){function os(e){var c;return _class_call_check(this,os),(c=_call_super(this,os,[e])).name="SameContext",c.message=null!=e?e:"Same context",c}return _inherits(os,e),os}(_wrap_native_super(Error));var rI=ed.Utils;var rP=function(e){function lt(e,c){var l;return _class_call_check(this,lt),u(l=_call_super(this,lt,[e]),"payload"),l.payload=c,l}return _inherits(lt,e),_create_class(lt,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(lt.prototype),"processAsync",c)})().call(l,e),h=this.payload.contextId,[4,this.switchAsync(h)];case 1:return d.sent(),e.customData.contextId=h,[4,this.nextAsync(e)];case 2:return d.sent(),[2]}})}).call(this)}},{key:"checkSameContext",value:function checkSameContext(e){var c=GameSDK.context.getID(),l=GameSDK.context.getType();if(c===e||l===e)throw new rk;if("SOLO"===e&&null===c)throw new rk}},{key:"switchAsync",value:function switchAsync(e){return _async_to_generator(function(){var c,l;return _ts_generator(this,function(h){switch(h.label){case 0:c="SOLO"===e,h.label=1;case 1:return h.trys.push([1,3,,4]),this.checkSameContext(e),[4,GameSDK.context.switchAsync(e,c)];case 2:return h.sent(),[3,4];case 3:if(_instanceof(l=h.sent(),rk))return[2];if(!rI.Object.hasOwn(l,"code"))throw l;if(rI.Device.isAndroid()&&c&&"INVALID_PARAM"===l.code)return[2];if("SAME_CONTEXT"!==l.code)throw l;return[3,4];case 4:return[2]}})}).call(this)}}]),lt}(nH);var rE=ed.Dtos,rC=ed.Utils.Object;var rx=function(e){function qo(){return _class_call_check(this,qo),_call_super(this,qo,arguments)}return _inherits(qo,e),_create_class(qo,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(qo.prototype),"processAsync",c)})().call(l,e),this.validateMatchData(e),[4,this.getMatchAsync(e)];case 1:return h=f.sent(),d=new rE.Match.Data(h).toObject(),this.validateContinueMatchData(e,d),this.updateMatchData(e,d),this.validatePlayerTurn(e),[4,this.nextAsync(e)];case 2:return f.sent(),[2]}})}).call(this)}},{key:"validateMatchData",value:function validateMatchData(e){var c=e.id,l=e.status;if("string"!=typeof c)throw new n0;if(l!==nQ.OPEN)throw new rg}},{key:"validateContinueMatchData",value:function validateContinueMatchData(e,c){var l=e.id,h=e.customData,d=c._id,f=c.whitePlayerId,y=c.blackPlayerId;if("string"!=typeof d||d!==l)throw new n$;var _=h.playerId,v=f===_;if(!v&&y===eC.playerId)throw new tT;if(!v&&y!==_)throw new n3}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var c=e.profiles,l=e.customData.playerId;if("string"!=typeof l)throw new eT;if(c[l].finished)throw new tx}},{key:"getMatchAsync",value:function getMatchAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){return[2,(c=e.id)?this.match.api.getMatchAPI().getMatchDetailByIdAsync(c):{}]})}).call(this)}},{key:"updateMatchData",value:function updateMatchData(e,c){this.updateMatchGeneral(e,c),this.updatePlayerIds(e,c),this.initializeProfiles(e),this.updateScoresAndStatus(e,c)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,c){var l=c.extraData;e.customData=rC.merge(e.customData,l)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,c){var l=c.whitePlayerId,h=c.blackPlayerId,d=l===e.customData.playerId;e.customData.playerId=d?l:h,e.customData.opponentId=d?h:l}},{key:"initializeProfiles",value:function initializeProfiles(e){var c=e.customData,l=c.playerId,h=c.opponentId;if(!l||!h)return;var d={name:"",photo:"",finished:!1};e.profiles[l]||(e.profiles[l]=_object_spread({id:l},d)),e.profiles[h]||(e.profiles[h]=_object_spread({id:h},d))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,c){var l=e.customData,h=l.playerId,d=l.opponentId;if(!h||!d)return;var f=c.whitePlayerId,y=c.whitePlayerScore,_=c.whitePlayerFinish,v=c.blackPlayerScore,p=c.blackPlayerFinish,g=f===h;e.profiles[h].score=g?y:v,e.profiles[d].score=g?v:y,e.profiles[h].finished=g?_:p,e.profiles[d].finished=g?p:_}}]),qo}(nH);var rT=function(e){function Yo(e,c){var l;return _class_call_check(this,Yo),u(l=_call_super(this,Yo,[e]),"payload"),l.payload=c,l}return _inherits(Yo,e),_create_class(Yo,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:if((function(){return _get(_get_prototype_of(Yo.prototype),"processAsync",c)})().call(l,e),!this.payload.ignore)return[3,2];return[4,this.nextAsync(e)];case 1:return d.sent(),[2];case 2:return this.validateData(e),[4,this.createWideframesCurrentScoreAsync()];case 3:return(h=d.sent())&&this.sendMessageAsync(e,h),[4,this.nextAsync(e)];case 4:return d.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.id,l=e.customData,h=l.contextId,d=l.opponentId;if(!c||"string"!=typeof c)throw new n0;if(!h||"string"!=typeof h)throw new rr;if(!d||"string"!=typeof d)throw new n1}},{key:"createWideframesCurrentScoreAsync",value:function createWideframesCurrentScoreAsync(){return _async_to_generator(function(){var e,c,l,h,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:return y.trys.push([0,2,,3]),c=(e=this.game).player,l=e.frameCapture,d=(h=c.getPlayer()).playerId,f=h.photo,[4,l.wideframe.renderUpdateChallenge({playerId:d,playerPhoto:f})];case 1:return[2,y.sent()];case 2:return y.sent(),[2,null];case 3:return[2]}})}).call(this)}},{key:"sendMessageAsync",value:function sendMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(l=e.id,h=e.profiles,f=(d=e.customData).playerId,y=d.opponentId,!f||"string"!=typeof f)throw new eT;if(!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");if(!(_=h[f]))throw new rs;if(v=_.name,p={data:{type:tD.CHALLENGE_FRIEND,matchId:l,playerId:f,opponentId:y},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(v," made an update."),localizations:{vi_VN:"".concat(v," đ\xe3 cập nhật trận đấu. Chơi ngay!")}},image:c,strategy:"LAST",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:return g.sent(),[2]}})})()}}]),Yo}(nH);var rN=function(e){function Jo(){return _class_call_check(this,Jo),_call_super(this,Jo,arguments)}return _inherits(Jo,e),_create_class(Jo,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A,b,D,k,E,T;return _ts_generator(this,function(O){switch(O.label){case 0:return O.trys.push([0,,2,3]),this.startLog(e),c=e.contextId,h=e.matchId,d=e.playerId,f=e.opponentId,_=void 0===(y=e.sendUpdateMessage)?!0:y,v=new ro(this),p=new rP(this,{contextId:c}),v.setNext(p),g=new n9(this,{id:h,mode:l.CHALLENGE_FRIEND,customData:{playerId:d,opponentId:f}}),p.setNext(g),m=new rx(this),g.setNext(m),A=new rh(this),m.setNext(A),b=new rb(this),A.setNext(b),D=new rT(this,{ignore:!_}),b.setNext(D),k=new nJ(this),D.setNext(k),E=new nX(this),k.setNext(E),T=this.match.getMatchState(),[4,v.processAsync(T)];case 1:return O.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Jo}(nj);var rL=ed.Plugins,rO=ed.Utils,rM=rL.Analytics,rR=rO.String,rF=rO.Valid;var rG=function(e){function We(){return _class_call_check(this,We),_call_super(this,We,arguments)}return _inherits(We,e),_create_class(We,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:return(function(){return _get(_get_prototype_of(We.prototype),"processAsync",c)})().call(l,e),h=e.customData,d=e.mode,f=e.startAt,y=e.finishAt,_=h.level,this.validateMode(d),this.validateLevel(_),v=this.game.analytics,p=Math.floor((y-f)/1e3),v.event(rM.Events.MATCH_END,{level:_,game_mode:rR.toUpperCamelCase(d),level_name:this.getLevelName(_),time_played:p}),[4,this.nextAsync(e)];case 1:return g.sent(),[2]}})}).call(this)}},{key:"validateMode",value:function validateMode(e){if(!rF.isString(e))throw new nU}},{key:"validateLevel",value:function validateLevel(e){if(!rF.isNumber(e))throw new nB}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(rR.padStart(e.toString(),5,"0"))}}]),We}(nH);var rj=function(e){function Nn(e){var c;return _class_call_check(this,Nn),(c=_call_super(this,Nn,[e])).name="LeaderboardNotExist",c.message=null!=e?e:"Leaderboard not exist in game",c}return _inherits(Nn,e),Nn}(_wrap_native_super(Error));var rB=function(e){function cs(e){var c;return _class_call_check(this,cs),(c=_call_super(this,cs,[e])).name="ScoreNotValid",c.message=null!=e?e:"Score is not valid",c}return _inherits(cs,e),cs}(_wrap_native_super(Error));var rU=ed.Utils.Valid,rV=ed.Configs.Leaderboards.LeaderboardList;var rH=function(e){function dt(e,c){var l;return _class_call_check(this,dt),u(l=_call_super(this,dt,[e]),"payload"),u(l,"skipPostScore"),l.payload={score:0,playerId:""},l.skipPostScore=!!(null!=c&&c.ignore),l}return _inherits(dt,e),_create_class(dt,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f,y,_,v,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:if((function(){return _get(_get_prototype_of(dt.prototype),"processAsync",c)})().call(l,e),!this.skipPostScore)return[3,2];return[4,this.nextAsync(e)];case 1:return m.sent(),[2];case 2:if(this.setupSetScorePayload(e),!("submitGameResultsAsync"in GameSDK.extra))return[3,4];return[4,GameSDK.extra.submitGameResultsAsync(this.payload.score)];case 3:m.sent(),m.label=4;case 4:h=true,d=false,f=void 0;try{for(y=rV[Symbol.iterator]();!(h=(_=y.next()).done);h=true)p=(v=_.value).Id,g=v.Mode,e.mode&&this.isValidMode(g,e.mode)&&this.setLeaderboardScoreAsync(_object_spread({leaderboardId:p},this.payload))}catch(e){d=true,f=e}finally{try{if(!h&&null!=y.return)y.return()}finally{if(d)throw f}}return[4,this.nextAsync(e)];case 5:return m.sent(),[2]}})}).call(this)}},{key:"isValidMode",value:function isValidMode(e,c){return e===c}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){if(c=e.profiles,!(l=e.customData.playerId)||!c[l])throw new rs;if(h=c[l].score,!rU.isNumber(h))throw new rB;return this.payload={score:h,playerId:l},[2]})}).call(this)}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){return _async_to_generator(function(){var c,l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),c=e.playerId,l=e.score,h=e.leaderboardId,!(d=this.game.leaderboard.getLeaderboardName(h)))throw new rj;return[4,this.game.leaderboard.setLeaderboardScoreAsync(d,c,l)];case 1:return f.sent(),[3,3];case 2:return f.sent(),[3,3];case 3:return[2]}})}).call(this)}}]),dt}(nH);var rK=ed.Dtos,rz=ed.Utils,rW=rz.Valid,rq=rz.Object;var rY=function(e){function ze(e,c){var l;return _class_call_check(this,ze),u(l=_call_super(this,ze,[e]),"payload"),l.payload=c,l}return _inherits(ze,e),_create_class(ze,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:if((function(){return _get(_get_prototype_of(ze.prototype),"processAsync",c)})().call(l,e),this.validateMatchData(e),!this.payload.useAPI)return[3,2];return[4,this.finishMatchAsync(e)];case 1:return h=f.sent(),d=new rK.Match.Data(h).toObject(),this.updateMatchFromAPI(e,d),[3,3];case 2:this.updateMatchData(e),f.label=3;case 3:return this.updateMatchState(e),[4,this.nextAsync(e)];case 4:return f.sent(),[2]}})}).call(this)}},{key:"validateMatchData",value:function validateMatchData(e){var c=e.status,l=e.profiles,h=e.customData;if(c!==nQ.ACTIVE)throw new nZ;var d=h.playerId;if(!d||!rq.hasOwn(l,d))throw new n3}},{key:"updateMatchData",value:function updateMatchData(e){var c=e.customData.playerId;if(!rW.isString(c))throw new eT;e.profiles[c].finished=!0}},{key:"updateMatchState",value:function updateMatchState(e){e.status=nQ.FINISHED,e.finishAt=Date.now()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y;return _ts_generator(this,function(_){if(c=e.id,l=e.profiles,d=(h=e.customData).level,f=h.playerId,!rW.isString(f))throw new eT;return y={matchId:null!=c?c:"",score:l[f].score,level:d,extraData:this.payload.extraData},[2,this.match.api.getMatchAPI().finishMatchAsync(y)]})}).call(this)}},{key:"updateMatchFromAPI",value:function updateMatchFromAPI(e,c){var l=e.customData,h=l.playerId,d=l.opponentId;if(!rW.isString(h))throw new eT;if(!rW.isString(d))throw new n1;var f=c.whitePlayerId,y=c.whitePlayerScore,_=c.blackPlayerScore,v=c.whitePlayerFinish,p=c.blackPlayerFinish,g=h===f;e.profiles[h].score=g?y:_,e.profiles[d].score=g?_:y,e.profiles[h].finished=g?v:p,e.profiles[d].finished=g?p:v}}]),ze}(nH);var rJ=function(e){function rc(){return _class_call_check(this,rc),_call_super(this,rc,arguments)}return _inherits(rc,e),_create_class(rc,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(rc.prototype),"processAsync",c)})().call(l,e),this.validateData(e),[4,this.createWideframesResultAsync(e)];case 1:return(h=d.sent())&&this.progressSendFinishedMessage(e,h),[4,this.nextAsync(e)];case 2:return d.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.id,l=e.customData,h=l.contextId,d=l.opponentId;if(!c||"string"!=typeof c)throw new n0;if(!h||"string"!=typeof h)throw new rr;if(!d||"string"!=typeof d)throw new n1}},{key:"createWideframesResultAsync",value:function createWideframesResultAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A,b,D,k;return _ts_generator(this,function(E){switch(E.label){case 0:if(E.trys.push([0,2,,3]),c=this.game.frameCapture,l=e.profiles,d=(h=e.customData).playerId,f=h.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];return v=y.photo,g=void 0===(p=y.score)?0:p,m=y.finished,A=_.photo,D=void 0===(b=_.score)?0:b,k=_.finished,[4,c.wideframe.renderResultChallenge({playerId:d,playerPhoto:v,playerScore:g,opponentId:f,opponentPhoto:A,opponentScore:D,isPlayerFinished:!!m,isOpponentFinished:!!k})];case 1:return[2,E.sent()];case 2:return E.sent(),[2,null];case 3:return[2]}})}).call(this)}},{key:"progressSendFinishedMessage",value:function progressSendFinishedMessage(e,c){var l=e.profiles,h=e.customData,d=h.playerId,f=h.opponentId;if(!d||"string"!=typeof d)throw new eT;if(!f||"string"!=typeof f)throw new n1;if(!l[d]||!l[f])throw new rs;var y=l[d],_=y.score,v=y.finished,p=l[f],g=p.score,m=p.finished;v?this.sendFinishMessageAsync(e,c):m&&(void 0===_?0:_)>(void 0===g?0:g)?this.sendBestScoreMessageAsync(e,c):this.sendPlayTurnMessageAsync(e,c)}},{key:"sendFinishMessageAsync",value:function sendFinishMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(l=e.id,h=e.profiles,f=(d=e.customData).playerId,y=d.opponentId,!f||"string"!=typeof f)throw new eT;if(!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");if(!(_=h[f]))throw new rs;if(v=_.name,p={data:{type:tD.CHALLENGE_FRIEND,matchId:l,playerId:f,opponentId:y,status:nQ.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(v," just finished. Check them now."),localizations:{vi_VN:"".concat(v," vừa ho\xe0n th\xe0nh m\xe0n chơi. Nhấn để xem kết quả trận đấu.")}},image:c,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:return g.sent(),[2]}})})()}},{key:"sendPlayTurnMessageAsync",value:function sendPlayTurnMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:if(l=e.id,h=e.profiles,f=(d=e.customData).playerId,y=d.opponentId,!f||"string"!=typeof f)throw new eT;if(!(_=h[f]))throw new rs;if(v=_.name,p=_.score,g={data:{type:tD.CHALLENGE_FRIEND,matchId:l,playerId:f,opponentId:y,status:nQ.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(v," got ").concat(p," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(v," đ\xe3 đạt ").concat(p," điểm! Nhấn Chơi để so t\xe0i!")}},image:c,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");return[4,GameSDK.extra.updateAsync(g)];case 1:return m.sent(),[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:if(l=e.id,h=e.profiles,f=(d=e.customData).playerId,y=d.opponentId,!f||"string"!=typeof f)throw new eT;if(!(_=h[f]))throw new rs;if(v=_.name,p=_.score,g={data:{type:tD.CHALLENGE_FRIEND,matchId:l,playerId:f,opponentId:y,status:nQ.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(v," beat your high score. Their score: ").concat(p),localizations:{vi_VN:"".concat(v," đ\xe3 vượt qua điểm số của bạn, với ").concat(p," điểm!")}},image:c,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");return[4,GameSDK.extra.updateAsync(g)];case 1:return m.sent(),[2]}})})()}}]),rc}(nH);var rQ=function(e){function qe(e,c){var l;return _class_call_check(this,qe),u(l=_call_super(this,qe,[e]),"ignore"),l.ignore=!!(null!=c&&c.ignore),l}return _inherits(qe,e),_create_class(qe,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return(function(){return _get(_get_prototype_of(qe.prototype),"processAsync",c)})().call(l,e),this.setPlayerBestScore(e),[4,this.nextAsync(e)];case 1:return h.sent(),[2]}})}).call(this)}},{key:"setPlayerBestScore",value:function setPlayerBestScore(e){if(this.ignore)return;var c=e.profiles,l=e.customData.playerId;if(!l||!c[l])throw new rs;var h=this.game.player,d=h.getBestScore()||0,f=c[l].score,y=void 0===f?0:f;y<=d||(h.setBestScore(y),c[l].bestScore=y)}}]),qe}(nH);var rX=function(e){function ic(){return _class_call_check(this,ic),_call_super(this,ic,arguments)}return _inherits(ic,e),_create_class(ic,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:return g.trys.push([0,,2,3]),this.startLog(e),c=(null!=e?e:{}).extraData,l=new ro(this),h=new rY(this,{useAPI:!0,extraData:c}),l.setNext(h),d=new rJ(this),h.setNext(d),f=new rG(this),d.setNext(f),y=new rQ(this),f.setNext(y),_=new rH(this),y.setNext(_),v=new nX(this),_.setNext(v),p=this.match.getMatchState(),[4,l.processAsync(p)];case 1:return g.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),ic}(nj);var r$=function(e){function oc(e){var c;return _class_call_check(this,oc),(c=_call_super(this,oc,[e])).name="ContextAreSolo",c.message=null!=e?e:"Context are solo",c}return _inherits(oc,e),oc}(_wrap_native_super(Error));var rZ=function(e){function cc(e){var c;return _class_call_check(this,cc),(c=_call_super(this,cc,[e])).name="ContextNotChallenge",c.message=null!=e?e:"Context is not a challenge",c}return _inherits(cc,e),cc}(_wrap_native_super(Error));var r0=function(e){function lc(e){var c;return _class_call_check(this,lc),(c=_call_super(this,lc,[e])).name="NetworkFailure",c.message=null!=e?e:"Network failure",c}return _inherits(lc,e),lc}(_wrap_native_super(Error));var r2=ed.Utils,r1=ed.Dtos,r3=r2.Array,r4=r2.Object;var r5=function(e){function Tn(e,c){var l;return _class_call_check(this,Tn),u(l=_call_super(this,Tn,[e]),"payload"),l.payload=c,l}return _inherits(Tn,e),_create_class(Tn,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(Tn.prototype),"processAsync",c)})().call(l,e),this.checkCurrentContext(),[4,this.getOpponentIdFromContextAsync()];case 1:return h=d.sent(),e.customData.opponentId=h,[4,this.nextAsync(e)];case 2:return d.sent(),[2]}})}).call(this)}},{key:"checkCurrentContext",value:function checkCurrentContext(){var e=GameSDK.context.getID();if("string"!=typeof e)throw new rr;if("SOLO"===e)throw new r$}},{key:"getOpponentIdFromContextAsync",value:function getOpponentIdFromContextAsync(){return _async_to_generator(function(){var e,c,l;return _ts_generator(this,function(h){switch(h.label){case 0:return e=this.payload.ignoreId,[4,this.getContextPlayers([e])];case 1:if((c=h.sent()).length>1)throw new rZ;return l=eC,[2,(1===c.length&&(l=c[0]),l.playerId)]}})}).call(this)}},{key:"getContextPlayers",value:function getContextPlayers(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A;return _ts_generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,GameSDK.context.getPlayersAsync()];case 1:c=b.sent(),l=[],h=true,d=false,f=void 0;try{for(y=c[Symbol.iterator]();!(h=(_=y.next()).done);h=true)if(p=(v=_.value).getID(),!(e.indexOf(p)>-1)){if(g=v.getName())m=v.getPhoto(),l.push(new r1.Player.Info({playerId:p,name:g,photo:m}).toObject())}}catch(e){d=true,f=e}finally{try{if(!h&&null!=y.return)y.return()}finally{if(d)throw f}}return[2,r3.unique(l)];case 2:if(A=b.sent(),r4.hasOwn(A,"code")&&"NETWORK_FAILURE"===A.code)throw new r0;return[2,[]];case 3:return[2]}})})()}}]),Tn}(nH);var r6=function(e){function ls(e){var c;return _class_call_check(this,ls),(c=_call_super(this,ls,[e])).name="ContextIsTournament",c.message=null!=e?e:"Context is a tournament",c}return _inherits(ls,e),ls}(_wrap_native_super(Error));var r7=ed.Utils.Object;var r8=function(e){function yc(){return _class_call_check(this,yc),_call_super(this,yc,arguments)}return _inherits(yc,e),_create_class(yc,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(yc.prototype),"processAsync",c)})().call(l,e),[4,this.chooseAsync()];case 1:return h=d.sent(),[4,this.checkContextTournament()];case 2:return d.sent(),e.customData.contextId=h,[4,this.nextAsync(e)];case 3:return d.sent(),[2]}})}).call(this)}},{key:"chooseAsync",value:function chooseAsync(){return _async_to_generator(function(){var e,c;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})];case 1:return l.sent(),[3,3];case 2:if(e=l.sent(),!r7.hasOwn(e,"code")||"SAME_CONTEXT"!==e.code)throw e;return[3,3];case 3:if("string"!=typeof(c=GameSDK.context.getID()))throw new rf;return[2,c]}})})()}},{key:"checkContextTournament",value:function checkContextTournament(){return _async_to_generator(function(){var e,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,4,,5]),!GameSDK.context.getID())return[2];if(!("getTournamentAsync"in GameSDK))return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:return l.sent(),e=new r6,[3,3];case 2:e=new rt("getTournamentAsync"),l.label=3;case 3:throw e;case 4:if(_instanceof(c=l.sent(),r6))throw c;return[3,5];case 5:return[2]}})})()}}]),yc}(nH);var r9=function(e){function gc(){return _class_call_check(this,gc),_call_super(this,gc,arguments)}return _inherits(gc,e),_create_class(gc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A,b,D;return _ts_generator(this,function(k){switch(k.label){case 0:return k.trys.push([0,,2,3]),this.startLog(e),c=e.playerId,h=e.extraData,d=new ro(this),f=new r8(this),d.setNext(f),y=new n9(this,{mode:l.CHALLENGE_FRIEND,customData:{playerId:c}}),f.setNext(y),_=new r5(this,{ignoreId:c}),y.setNext(_),v=new rw(this,{extraData:h}),_.setNext(v),p=new rh(this),v.setNext(p),g=new rb(this),p.setNext(g),m=new nJ(this),g.setNext(m),A=new rD(this),m.setNext(A),b=new nX(this),A.setNext(b),D=this.match.getMatchState(),[4,d.processAsync(D)];case 1:return k.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),gc}(nj);var ae=function(e){function mc(e){var c;return _class_call_check(this,mc),(c=_call_super(this,mc,[e])).name="JoinMatchFailed",c.message=null!=e?e:"Join match failed",c}return _inherits(mc,e),mc}(_wrap_native_super(Error));var at=function(e){function Ac(e){var c;return _class_call_check(this,Ac),(c=_call_super(this,Ac,[e])).name="MatchAreFinished",c.message=null!=e?e:"Match are finished",c}return _inherits(Ac,e),Ac}(_wrap_native_super(Error));var an=function(e){function wc(e){var c;return _class_call_check(this,wc),(c=_call_super(this,wc,[e])).name="OtherPlayerHasJoinedMatch",c.message=null!=e?e:"Other player has joined match",c}return _inherits(wc,e),wc}(_wrap_native_super(Error));var ar=ed.Dtos,aa=ed.Utils.Object;var ai=function(e){function Pc(){return _class_call_check(this,Pc),_call_super(this,Pc,arguments)}return _inherits(Pc,e),_create_class(Pc,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(Pc.prototype),"processAsync",c)})().call(l,e),this.validateMatchData(e),[4,this.joinMatchAsync(e)];case 1:return h=f.sent(),d=new ar.Match.Data(h).toObject(),this.validateJoinMatchData(e,d),this.updateMatchData(e,d),[4,this.nextAsync(e)];case 2:return f.sent(),[2]}})}).call(this)}},{key:"validateMatchData",value:function validateMatchData(e){if(e.status!==nQ.OPEN)throw new rg}},{key:"validateJoinMatchData",value:function validateJoinMatchData(e,c){var l=e.id,h=e.customData,d=c._id,f=c.blackPlayerId,y=c.whitePlayerId,_=c.whitePlayerFinish,v=c.blackPlayerFinish,p=f===h.playerId,g=y===h.opponentId;if("string"!=typeof d||d!==l||!g)throw new ae;if(_&&v)throw new at;if(!p)throw new an}},{key:"joinMatchAsync",value:function joinMatchAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){return[2,(c=e.id)?this.match.api.getMatchAPI().joinMatchAsync(c):{}]})}).call(this)}},{key:"updateMatchData",value:function updateMatchData(e,c){this.updateMatchGeneral(e,c),this.updatePlayerIds(e,c),this.initializeProfiles(e),this.updateScoresAndStatus(e,c)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,c){var l=c.extraData;e.customData=aa.merge(e.customData,l)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,c){var l=c.whitePlayerId,h=c.blackPlayerId,d=l===e.customData.playerId;e.customData.playerId=d?l:h,e.customData.opponentId=d?h:l}},{key:"initializeProfiles",value:function initializeProfiles(e){var c=e.customData,l=c.playerId,h=c.opponentId;if(!l||!h)return;var d={name:"",photo:"",finished:!1};e.profiles[l]||(e.profiles[l]=_object_spread({id:l},d)),e.profiles[h]||(e.profiles[h]=_object_spread({id:h},d))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,c){var l=e.customData,h=l.playerId,d=l.opponentId;if(!h||!d)return;var f=c.whitePlayerId,y=c.whitePlayerScore,_=c.whitePlayerFinish,v=c.blackPlayerScore,p=c.blackPlayerFinish,g=f===e.customData.playerId;e.profiles[h].score=g?y:v,e.profiles[d].score=g?v:y,e.profiles[h].finished=g?_:p,e.profiles[d].finished=g?p:_}}]),Pc}(nH);var ac=function(e){function Sc(){return _class_call_check(this,Sc),_call_super(this,Sc,arguments)}return _inherits(Sc,e),_create_class(Sc,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(Sc.prototype),"processAsync",c)})().call(l,e),this.validateData(e),[4,this.createWideframesAcceptedAsync(e)];case 1:return(h=d.sent())&&this.sendMessageAsync(e,h),[4,this.nextAsync(e)];case 2:return d.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.id,l=e.customData,h=l.contextId,d=l.opponentId;if(!c||"string"!=typeof c)throw new n0;if(!h||"string"!=typeof h)throw new rr;if(!d||"string"!=typeof d)throw new n1}},{key:"createWideframesAcceptedAsync",value:function createWideframesAcceptedAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A,b,D;return _ts_generator(this,function(k){switch(k.label){case 0:if(k.trys.push([0,4,,5]),c=this.game.frameCapture,l=e.profiles,d=(h=e.customData).playerId,f=h.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];if(v=y.photo,g=void 0===(p=y.score)?0:p,y.finished)return[2,null];if(m=_.photo,b=void 0===(A=_.score)?0:A,!_.finished)return[3,2];return[4,c.wideframe.renderResultChallenge({playerId:d,playerPhoto:v,playerScore:g,opponentId:f,opponentPhoto:m,opponentScore:b,isPlayerFinished:!1,isOpponentFinished:!0})];case 1:return D=k.sent(),[3,3];case 2:D=null,k.label=3;case 3:return[2,D];case 4:return k.sent(),[2,null];case 5:return[2]}})}).call(this)}},{key:"sendMessageAsync",value:function sendMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(l=e.id,h=e.profiles,f=(d=e.customData).playerId,y=d.opponentId,!f||"string"!=typeof f)throw new eT;if(!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");if(!(_=h[f]))throw new rs;return v=_.name,p={data:{type:tD.CHALLENGE_FRIEND,matchId:l,playerId:f,opponentId:y},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(v," accepted the challenge."),localizations:{vi_VN:"".concat(v," đ\xe3 chấp nhận tham gia trận đấu.")}},image:c,strategy:"LAST",notification:"PUSH"},[4,GameSDK.extra.updateAsync(p)];case 1:return g.sent(),[2]}})})()}}]),Sc}(nH);var al=function(e){function Ec(){return _class_call_check(this,Ec),_call_super(this,Ec,arguments)}return _inherits(Ec,e),_create_class(Ec,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A,b;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),this.startLog(e),c=e.matchId,h=e.playerId,d=e.opponentId,f=new ro(this),y=new n9(this,{id:c,mode:l.CHALLENGE_FRIEND,customData:{playerId:h,opponentId:d}}),f.setNext(y),_=new ai(this),y.setNext(_),v=new rh(this),_.setNext(v),p=new rb(this),v.setNext(p),g=new ac(this),p.setNext(g),m=new nJ(this),g.setNext(m),A=new nX(this),m.setNext(A),b=this.match.getMatchState(),[4,f.processAsync(b)];case 1:return D.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Ec}(nj);var au={_id:"",status:"",appId:"",createdAt:"",startedAt:null,finishedAt:null,winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1,extraData:{}},ah=ed.Configs.AppId,af=ed.Utils.Valid,ay="is invalid";var a_=function(e){function ds(){return _class_call_check(this,ds),_call_super(this,ds,arguments)}return _inherits(ds,e),_create_class(ds,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){af.isString(e)&&e||this.exception("_id",ay)}},{key:"validateStatus",value:function validateStatus(e){af.isString(e)&&e||this.exception("status",ay)}},{key:"validateAppId",value:function validateAppId(e){af.isString(e)&&e===ah||this.exception("appId",ay)}},{key:"validateCreatedAt",value:function validateCreatedAt(e){af.isString(e)||this.exception("createdAt",ay)}},{key:"validateStartedAt",value:function validateStartedAt(e){null!==e&&(af.isString(e)||this.exception("startedAt",ay))}},{key:"validateFinishedAt",value:function validateFinishedAt(e){null!==e&&(af.isString(e)||this.exception("finishedAt",ay))}},{key:"validateExtraData",value:function validateExtraData(e){null!==e&&(af.isObject(e)||this.exception("extraData",ay))}},{key:"validateWinnerId",value:function validateWinnerId(e){null===e||af.isString(e)&&e||this.exception("winnerId",ay)}},{key:"validateWhitePlayerId",value:function validateWhitePlayerId(e){af.isString(e)&&e||this.exception("whitePlayerId",ay)}},{key:"validateBlackPlayerId",value:function validateBlackPlayerId(e){af.isString(e)&&e||this.exception("blackPlayerId",ay)}},{key:"validateWhitePlayerScore",value:function validateWhitePlayerScore(e){af.isNumber(e)||this.exception("whitePlayerScore",ay)}},{key:"validateBlackPlayerScore",value:function validateBlackPlayerScore(e){af.isNumber(e)||this.exception("blackPlayerScore",ay)}},{key:"validateWhitePlayerFinish",value:function validateWhitePlayerFinish(e){af.isBoolean(e)||this.exception("whitePlayerFinish",ay)}},{key:"validateBlackPlayerFinish",value:function validateBlackPlayerFinish(e){af.isBoolean(e)||this.exception("blackPlayerFinish",ay)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(ds.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return au}}]),ds}(em);a_.addDefaultData(au);var av=function(e){function bc(e){var c;return _class_call_check(this,bc),(c=_call_super(this,bc,[e])).name="MatchAreNotFinished",c.message=e||"Match are not finished",c}return _inherits(bc,e),bc}(_wrap_native_super(Error));var ap=function(e){function xc(e){var c;return _class_call_check(this,xc),(c=_call_super(this,xc,[e])).name="OpponentNotFinishedMatch",c.message=e||"Opponent not finished match",c}return _inherits(xc,e),xc}(_wrap_native_super(Error));var ag=ed.Utils.Object;var am=function(e){function _c(){return _class_call_check(this,_c),_call_super(this,_c,arguments)}return _inherits(_c,e),_create_class(_c,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(_c.prototype),"processAsync",c)})().call(l,e),this.validateMatchData(e),[4,this.getMatchAsync(e)];case 1:return h=new a_(d.sent()).toObject(),this.validateResultMatchData(e,h),this.updateMatchData(e,h),this.validatePlayerTurn(e),this.validateOpponentTurn(e),[4,this.nextAsync(e)];case 2:return d.sent(),[2]}})}).call(this)}},{key:"validateMatchData",value:function validateMatchData(e){if("string"!=typeof e.id)throw new n0}},{key:"validateResultMatchData",value:function validateResultMatchData(e,c){var l=e.id,h=c._id,d=c.whitePlayerFinish,f=c.blackPlayerFinish;if("string"!=typeof h||h!==l)throw new n$;if(!d&&!f)throw new av}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var c=e.profiles,l=e.customData.playerId;if("string"!=typeof l)throw new eT;if(!c[l].finished)throw new n4}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var c=e.profiles,l=e.customData.opponentId;if("string"!=typeof l)throw new n1;if(!c[l].finished)throw new ap}},{key:"getMatchAsync",value:function getMatchAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){return[2,(c=e.id)?this.match.api.getMatchAPI().getMatchDetailByIdAsync(c):null]})}).call(this)}},{key:"updateMatchData",value:function updateMatchData(e,c){this.updateMatchGeneral(e,c),this.updatePlayerIds(e,c),this.initializeProfiles(e),this.updateScoresAndStatus(e,c)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,c){var l=c.extraData;e.status=nQ.FINISHED,e.customData=ag.merge(e.customData,l)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,c){var l=c.whitePlayerId,h=c.blackPlayerId,d=l===e.customData.playerId;e.customData.playerId=d?l:h,e.customData.opponentId=d?h:l}},{key:"initializeProfiles",value:function initializeProfiles(e){var c=e.customData,l=c.playerId,h=c.opponentId;if(!l||!h)return;var d={name:"",photo:"",finished:!0};e.profiles[l]||(e.profiles[l]=_object_spread({id:l},d)),e.profiles[h]||(e.profiles[h]=_object_spread({id:h},d))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,c){var l=e.customData,h=l.playerId,d=l.opponentId;if(!h||!d)return;var f=c.whitePlayerId,y=c.whitePlayerScore,_=c.whitePlayerFinish,v=c.blackPlayerScore,p=c.blackPlayerFinish,g=f===e.customData.playerId;e.profiles[h].score=g?y:v,e.profiles[d].score=g?v:y,e.profiles[h].finished=g?_:p,e.profiles[d].finished=g?p:_}}]),_c}(nH);var aA=function(e){function Nc(){return _class_call_check(this,Nc),_call_super(this,Nc,arguments)}return _inherits(Nc,e),_create_class(Nc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,,2,3]),this.startLog(e),c=e.matchId,h=e.playerId,d=e.opponentId,f=new ro(this),y=new n9(this,{id:c,mode:l.CHALLENGE_FRIEND,customData:{playerId:h,opponentId:d}}),f.setNext(y),_=new am(this),y.setNext(_),v=new rh(this),_.setNext(v),p=new nX(this),v.setNext(p),g=this.match.getMatchState(),[4,f.processAsync(g)];case 1:return m.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Nc}(nj);var aw=function(e){function Tc(){_class_call_check(this,Tc);var e,c=arguments;return u(e=_call_super(this,Tc,_to_consumable_array(c)),"fallbackSingleMode"),u(e,"startFLowChallengeFriend",function(c){return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,e.match.challenge.invite.processAsync(c)];case 1:return[2,(l.sent(),!0)];case 2:return[2,l.sent()];case 3:return[2]}})})()}),u(e,"startFlowTournament",function(c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){switch(h.label){case 0:if(h.trys.push([0,2,,4]),"string"!=typeof(l=GameSDK.context.getID()))throw new rr;return[4,e.match.tournament.continue.processAsync({playerId:c,contextId:l})];case 1:return h.sent(),[3,4];case 2:return h.sent(),[4,e.startFlowSingle(c)];case 3:return h.sent(),[3,4];case 4:return[2]}})})()}),u(e,"startFlowSingle",function(c){return _async_to_generator(function(){return _ts_generator(this,function(l){return[2,e.match.single.start.processAsync({playerId:c})]})})()}),e}return _inherits(Tc,e),_create_class(Tc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,,7,8]),this.startLog(e),c=e.playerId,l=e.extraData,h=e.fallbackSingleMode,this.fallbackSingleMode=h,[4,this.startFLowChallengeFriend({playerId:c,extraData:l})];case 1:if(!0===(d=f.sent()))return[2];if(!_instanceof(d,r6))return[3,3];return[4,this.startFlowTournament(c)];case 2:return f.sent(),[3,6];case 3:if(!this.fallbackSingleMode)return[3,5];return[4,this.startFlowSingle(c)];case 4:return f.sent(),[3,6];case 5:throw d;case 6:return[3,8];case 7:return this.endLog(),[7];case 8:return[2]}})}).call(this)}}]),Tc}(nj);var ab=function(e){function Ye(e){var c;return _class_call_check(this,Ye),(c=_call_super(this,Ye,[e])).name="LeaderboardIdNotValid",c.message=null!=e?e:"Leaderboard id is not valid",c}return _inherits(Ye,e),Ye}(_wrap_native_super(Error));var aD=ed.Utils.Valid;var aS=function(e){function On(e,c){var l;return _class_call_check(this,On),u(l=_call_super(this,On,[e]),"payload"),u(l,"leaderboardPayload"),l.payload=c,l}return _inherits(On,e),_create_class(On,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:if((function(){return _get(_get_prototype_of(On.prototype),"processAsync",c)})().call(l,e),this.setupSetScorePayload(e),!("submitGameResultsAsync"in GameSDK.extra))return[3,2];return[4,GameSDK.extra.submitGameResultsAsync(this.payload.score)];case 1:h.sent(),h.label=2;case 2:return this.setLeaderboardScoreAsync(),[4,this.nextAsync(e)];case 3:return h.sent(),[2]}})}).call(this)}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){return _async_to_generator(function(){var c,l,h,d,f;return _ts_generator(this,function(y){if(c=e.profiles,!(l=e.customData.playerId)||!c[l])throw new rs;if(d=(h=this.payload).score,f=h.leaderboardId,!aD.isNumber(d))throw new rB;if(!aD.isString(f))throw new ab;return this.leaderboardPayload={score:d,playerId:l,leaderboardId:f},[2]})}).call(this)}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(){return _async_to_generator(function(){var e,c,l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),c=(e=this.leaderboardPayload).playerId,l=e.score,h=e.leaderboardId,!(d=this.game.leaderboard.getLeaderboardName(h)))throw new rj;return[4,this.game.leaderboard.setLeaderboardScoreAsync(d,c,l)];case 1:return f.sent(),[3,3];case 2:return f.sent(),[3,3];case 3:return[2]}})}).call(this)}}]),On}(nH);var ak=ed.Utils.Valid;var aI=function(e){function us(e){return _class_call_check(this,us),_call_super(this,us,[e,{score:0,leaderboardId:""}])}return _inherits(us,e),_create_class(us,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f,y,_;return _ts_generator(this,function(v){if(h=e.profiles,f=(d=e.customData).playerId,!(y=d.leaderboardId))throw new ab;if(!f||!h[f])throw new rs;if(_=h[f].score,!ak.isNumber(_))throw new rB;return this.payload.score=_,this.payload.leaderboardId=y,(function(){return _get(_get_prototype_of(us.prototype),"setupSetScorePayload",c)})().call(l,e),[2]})}).call(this)}}]),us}(aS);var aP=function(e){function Mc(){return _class_call_check(this,Mc),_call_super(this,Mc,arguments)}return _inherits(Mc,e),_create_class(Mc,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return(function(){return _get(_get_prototype_of(Mc.prototype),"processAsync",c)})().call(l,e),this.validateData(e),this.progressSendGroupMessage(e),[4,this.nextAsync(e)];case 1:return h.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.id,l=e.customData,h=l.contextId,d=l.opponentId;if(!c||"string"!=typeof c)throw new n0;if(!h||"string"!=typeof h)throw new rr;if(!d||"string"!=typeof d)throw new n1}},{key:"createWideframesResultGroupAsync",value:function createWideframesResultGroupAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A,b;return _ts_generator(this,function(D){switch(D.label){case 0:if(D.trys.push([0,2,,3]),c=this.game.frameCapture,l=e.profiles,d=(h=e.customData).playerId,f=h.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];return v=y.photo,g=void 0===(p=y.score)?0:p,m=_.photo,b=void 0===(A=_.score)?0:A,[4,c.wideframe.renderResultChallenge({playerId:d,playerPhoto:v,playerScore:g,opponentId:f,opponentPhoto:m,opponentScore:b,isPlayerFinished:!0,isOpponentFinished:!0})];case 1:return[2,D.sent()];case 2:return D.sent(),[2,null];case 3:return[2]}})}).call(this)}},{key:"createWideframesBestScoreAsync",value:function createWideframesBestScoreAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(g.trys.push([0,2,,3]),l=(c=this.game).player,h=c.frameCapture,d=e.customData.playerId,y=(f=l.getPlayer()).playerId,_=f.photo,v=f.data,d!==y)return[2,null];return p=(v||{}).score,[4,h.wideframe.renderShareScore({playerId:y,playerPhoto:_,playerScore:p})];case 1:return[2,g.sent()];case 2:return g.sent(),[2,null];case 3:return[2]}})}).call(this)}},{key:"progressSendGroupMessage",value:function progressSendGroupMessage(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:if(c=e.profiles,h=(l=e.customData).playerId,!((d=l.opponentId)&&"string"==typeof d))return[3,2];if(!h||"string"!=typeof h)throw new eT;if(f=c[h],y=c[d],!f||!y)return[2];if(!((void 0===(_=f.score)?0:_)>(void 0===(v=y.score)?0:v)))return[3,2];return[4,this.createWideframesResultGroupAsync(e)];case 1:if(!(p=m.sent()))return[2];return this.sendBestScoreMessageAsync(e,p),[2];case 2:return[4,this.createWideframesBestScoreAsync(e)];case 3:return(g=m.sent())&&this.sendChallengeMessageAsync(e,g),[2]}})}).call(this)}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:if(l=e.profiles,!(h=e.customData.playerId)||"string"!=typeof h)throw new eT;if(!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");if(!(d=l[h]))throw new rs;if(f=d.name,y=d.score,_={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:h,playerName:f,playerScore:y},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:"".concat(f," beats your high score. Their score: ").concat(y,"."),localizations:{vi_VN:"".concat(f," vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?")}},image:c,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");return[4,GameSDK.extra.updateAsync(_)];case 1:return v.sent(),[2]}})}).call(this)}},{key:"sendChallengeMessageAsync",value:function sendChallengeMessageAsync(e,c){return _async_to_generator(function(){var l,h,d,f,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:if(l=e.profiles,!(h=e.customData.playerId)||"string"!=typeof h)throw new eT;if(!(d=l[h]))throw new rs;if(f=d.name,y=d.score,_={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:h,playerName:f,playerScore:y},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(f," got ").concat(y," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(f," đ\xe3 đạt ").concat(y," điểm! Qu\xe1 dễ lu\xf4n. Chơi lại n\xe0o!")}},image:c,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new rt("updateAsync");return[4,GameSDK.extra.updateAsync(_)];case 1:return v.sent(),[2]}})}).call(this)}}]),Mc}(nH);var aE=function(e){function Oc(){return _class_call_check(this,Oc),_call_super(this,Oc,arguments)}return _inherits(Oc,e),_create_class(Oc,[{key:"processAsync",value:function processAsync(){return _async_to_generator(function(){var e,c,l,h,d,f,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:return v.trys.push([0,,2,3]),this.startLog(),e=new ro(this),c=new rY(this,{useAPI:!1}),e.setNext(c),l=new aP(this),c.setNext(l),h=new rG(this),l.setNext(h),d=new rQ(this),h.setNext(d),f=new aI(this),d.setNext(f),y=new nX(this),f.setNext(y),_=this.match.getMatchState(),[4,e.processAsync(_)];case 1:return v.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Oc}(nj);var aC=ed.Dtos;var ax=function(e){function ht(e,c){var l;return _class_call_check(this,ht),u(l=_call_super(this,ht,[e]),"payload"),l.payload=c,l}return _inherits(ht,e),_create_class(ht,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return(function(){return _get(_get_prototype_of(ht.prototype),"processAsync",c)})().call(l,e),this.updateProfileMatchData(e),[4,this.nextAsync(e)];case 1:return h.sent(),[2]}})}).call(this)}},{key:"updateProfileMatchData",value:function updateProfileMatchData(e){var c=this.payload.id,l=e.profiles;if(!l[c])throw new rs;var h=_object_spread({},l[c],this.payload),d=new aC.Match.Profile(h).toObject();l[d.id]=d}}]),ht}(nH);var aT=function(e){function kc(){return _class_call_check(this,kc),_call_super(this,kc,arguments)}return _inherits(kc,e),_create_class(kc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A;return _ts_generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,,2,3]),this.startLog(e),c=e.playerId,h=e.opponentId,d=e.opponentScore,f=new ro(this),y=new n9(this,{id:"7749",mode:l.MATCHING_GROUP,customData:{playerId:c,opponentId:h}}),f.setNext(y),_=new rh(this),y.setNext(_),v=new ax(this,{id:c,score:d}),_.setNext(v),p=new rb(this),v.setNext(p),g=new nJ(this),p.setNext(g),m=new nX(this),g.setNext(m),A=this.match.getMatchState(),[4,f.processAsync(A)];case 1:return b.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),kc}(nj);var aN=function(e){function Rn(e){var c;return _class_call_check(this,Rn),(c=_call_super(this,Rn,[e])).name="MatchGroupNotSupported",c.message=null!=e?e:"Match group is not supported",c}return _inherits(Rn,e),Rn}(_wrap_native_super(Error));var aL=function(e){function $c(e,c){var l;return _class_call_check(this,$c),u(l=_call_super(this,$c,[e]),"payload"),l.payload=c,l}return _inherits($c,e),_create_class($c,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of($c.prototype),"processAsync",c)})().call(l,e),[4,this.checkMatchGroupSupported()];case 1:return d.sent(),[4,this.matchingGroup()];case 2:return h=d.sent(),e.customData.contextId=h,[4,this.nextAsync(e)];case 3:return d.sent(),[2]}})}).call(this)}},{key:"checkMatchGroupSupported",value:function checkMatchGroupSupported(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:if(!("getSupportedAPIs"in GameSDK))throw new rt("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new rt("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new aN;return[4,GameSDK.extra.checkCanPlayerMatchAsync()];case 1:if(!e.sent())throw new aN;return[2]}})})()}},{key:"matchingGroup",value:function matchingGroup(){return _async_to_generator(function(){var e,c,l,h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:if(!("matchPlayerAsync"in GameSDK.extra))throw new rt("matchPlayerAsync");return c=(e=this.payload).matchTag,h=void 0===(l=e.autoSwitch)?!1:l,f=void 0===(d=e.onlyExisting)?!1:d,[4,GameSDK.extra.matchPlayerAsync(c,h,f)];case 1:if(_.sent(),"string"!=typeof(y=GameSDK.context.getID()))throw new rf;return[2,y]}})}).call(this)}}]),$c}(nH);var aO=function(e){function Fc(){return _class_call_check(this,Fc),_call_super(this,Fc,arguments)}return _inherits(Fc,e),_create_class(Fc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A,b;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),this.startLog(e),c=e.matchTag,h=e.playerId,d=e.options,f=new ro(this),y=new aL(this,_object_spread({matchTag:c},d)),f.setNext(y),_=new n9(this,{id:"7749",mode:l.MATCHING_GROUP,customData:{playerId:h}}),y.setNext(_),v=new r5(this,{ignoreId:h}),_.setNext(v),p=new rb(this),v.setNext(p),g=new rh(this),p.setNext(g),m=new nJ(this),g.setNext(m),A=new nX(this),m.setNext(A),b=this.match.getMatchState(),[4,f.processAsync(b)];case 1:return D.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Fc}(nj);var aM=function(e){function Gc(){return _class_call_check(this,Gc),_call_super(this,Gc,arguments)}return _inherits(Gc,e),_create_class(Gc,[{key:"processAsync",value:function processAsync(){return _async_to_generator(function(){var e,c,l,h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return _.trys.push([0,,2,3]),this.startLog(),e=new ro(this),c=new rY(this,{useAPI:!1}),e.setNext(c),l=new rG(this),c.setNext(l),h=new rQ(this),l.setNext(h),d=new rH(this),h.setNext(d),f=new nX(this),d.setNext(f),y=this.match.getMatchState(),[4,e.processAsync(y)];case 1:return _.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Gc}(nj);var aR=function(e){function Bc(e){var c;return _class_call_check(this,Bc),(c=_call_super(this,Bc,[e])).name="ProfileIdNotDefined",c.message=null!=e?e:"Profile id is not defined",c}return _inherits(Bc,e),Bc}(_wrap_native_super(Error));var aF=ed.Dtos;var aG=function(e){function Je(e,c){var l;return _class_call_check(this,Je),u(l=_call_super(this,Je,[e]),"payload"),l.payload=c,l}return _inherits(Je,e),_create_class(Je,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:if((function(){return _get(_get_prototype_of(Je.prototype),"processAsync",c)})().call(l,e),!(h=this.payload.profileId))throw new aR;if(d=this.game.player.getPlayerId(),h!==d)return[3,1];return f=this.getPlayerProfile(),[3,3];case 1:return[4,this.getProfileAsync(h)];case 2:if(!(f=y.sent()))throw new rs;y.label=3;case 3:return this.updateMatchData(f,e),[4,this.nextAsync(e)];case 4:return y.sent(),[2]}})}).call(this)}},{key:"getPlayerProfile",value:function getPlayerProfile(){var e=this.game.player.getPlayer();return{playerId:e.playerId,name:e.name,photo:e.photo,locale:e.locale}}},{key:"getProfileAsync",value:function getProfileAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,(c=this.game.profile).requestProfiles([e])];case 1:return[2,(l.sent(),c.getProfiles()[e])]}})}).call(this)}},{key:"updateMatchData",value:function updateMatchData(e,c){var l=e.playerId,h=e.name,d=e.photo,f=new aF.Match.Profile({id:l,name:h,photo:d}).toObject();c.profiles[l]=f}}]),Je}(nH);var aj=function(e){function Vc(){return _class_call_check(this,Vc),_call_super(this,Vc,arguments)}return _inherits(Vc,e),_create_class(Vc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,,2,3]),this.startLog(e),c=e.playerId,h=new ro(this),d=new rP(this,{contextId:"SOLO"}),h.setNext(d),f=new n9(this,{id:"123456",mode:l.SINGLE,customData:{playerId:c}}),d.setNext(f),y=new rb(this),f.setNext(y),_=new aG(this,{profileId:c}),y.setNext(_),v=new nJ(this),_.setNext(v),p=new nX(this),v.setNext(p),g=this.match.getMatchState(),[4,h.processAsync(g)];case 1:return m.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Vc}(nj);var aB=function(e){function Hc(){return _class_call_check(this,Hc),_call_super(this,Hc,arguments)}return _inherits(Hc,e),_create_class(Hc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A;return _ts_generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,,2,3]),this.startLog(e),h=void 0===(l=(c=null!=e?e:{}).setPlayerBestScore)?!1:l,f=void 0===(d=c.postGlobalLeaderboard)?!1:d,y=new ro(this),_=new rY(this,{useAPI:!1}),y.setNext(_),v=new rG(this),_.setNext(v),p=new rQ(this,{ignore:!h}),v.setNext(p),g=new rH(this,{ignore:!f}),p.setNext(g),m=new nX(this),g.setNext(m),A=this.match.getMatchState(),[4,y.processAsync(A)];case 1:return b.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Hc}(nj);var aU=function(e){function jc(){return _class_call_check(this,jc),_call_super(this,jc,arguments)}return _inherits(jc,e),_create_class(jc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A,b;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),this.startLog(e),c=e.matchId,l=e.playerId,h=e.gameMode,f=void 0===(d=e.extraData)?{}:d,y=new ro(this),_=new rP(this,{contextId:"SOLO"}),y.setNext(_),v=new n9(this,{id:c,mode:h,customData:_object_spread({playerId:l},f)}),_.setNext(v),p=new rb(this),v.setNext(p),g=new aG(this,{profileId:l}),p.setNext(g),m=new nJ(this),g.setNext(m),A=new nX(this),m.setNext(A),b=this.match.getMatchState(),[4,y.processAsync(b)];case 1:return D.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),jc}(nj);var aV=ed.Plugins,aH=ed.Utils,aK=aV.Analytics,az=aH.String,aW=aH.Valid;var aq=function(e){function kn(){return _class_call_check(this,kn),_call_super(this,kn,arguments)}return _inherits(kn,e),_create_class(kn,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:return(function(){return _get(_get_prototype_of(kn.prototype),"processAsync",c)})().call(l,e),h=e.mode,d=e.customData,this.validateMode(h),f=this.game.analytics,y=d.tournamentId,_=d.leaderboardId,f.event(aK.Events.TOURNAMENT_START,{success:!0,game_mode:az.toUpperCamelCase(h),tournament_id:y,leaderboard_id:_}),[4,this.nextAsync(e)];case 1:return v.sent(),[2]}})}).call(this)}},{key:"validateMode",value:function validateMode(e){if(!aW.isString(e))throw new nU}}]),kn}(nH);var aY=function(e){function $n(e){var c;return _class_call_check(this,$n),(c=_call_super(this,$n,[e])).name="TournamentIdNotValid",c.message=null!=e?e:"Tournament id is not valid",c}return _inherits($n,e),$n}(_wrap_native_super(Error));var aJ=ed.Utils.Valid;var aQ=function(e){function Jc(e,c){var l;return _class_call_check(this,Jc),u(l=_call_super(this,Jc,[e]),"payload"),l.payload=c,l}return _inherits(Jc,e),_create_class(Jc,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return(function(){return _get(_get_prototype_of(Jc.prototype),"processAsync",c)})().call(l,e),h=this.payload.contextId,this.validateContextId(h),[4,GameSDK.getTournamentAsync()];case 1:return f=(d=_.sent()).getID().toString(),this.validateTournamentId(f),y=JSON.parse(d.getPayload()||"{}").leaderboardId,this.validateLeaderboardId(y),e.customData.contextId=h,e.customData.tournamentId=f,e.customData.leaderboardId=y,[4,this.nextAsync(e)];case 2:return _.sent(),[2]}})}).call(this)}},{key:"validateContextId",value:function validateContextId(e){if(!aJ.isString(e))throw new rr}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!aJ.isString(e))throw new aY}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!aJ.isString(e)||""===e)throw new ab}}]),Jc}(nH);var aX=function(e){function Qc(){return _class_call_check(this,Qc),_call_super(this,Qc,arguments)}return _inherits(Qc,e),_create_class(Qc,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A;return _ts_generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,,2,3]),this.startLog(e),c=e.playerId,h=e.contextId,d=new ro(this),f=new aQ(this,{contextId:h}),d.setNext(f),y=new n9(this,{id:"1997",mode:l.TOURNAMENT,customData:{playerId:c}}),f.setNext(y),_=new rb(this),y.setNext(_),v=new aG(this,{profileId:c}),_.setNext(v),p=new nJ(this),v.setNext(p),g=new aq(this),p.setNext(g),m=new nX(this),p.setNext(m),A=this.match.getMatchState(),[4,d.processAsync(A)];case 1:return b.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),Qc}(nj);var a$=ed.Plugins.Analytics;var aZ=function(e){function el(){return _class_call_check(this,el),_call_super(this,el,arguments)}return _inherits(el,e),_create_class(el,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return(function(){return _get(_get_prototype_of(el.prototype),"processAsync",c)})().call(l,e),h=e.customData,d=this.game.analytics,f=h.tournamentId,y=h.leaderboardId,d.event(a$.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:f,leaderboard_id:y}),[4,this.nextAsync(e)];case 1:return _.sent(),[2]}})}).call(this)}}]),el}(nH);var a0=function(e){function tl(e,c){var l;return _class_call_check(this,tl),u(l=_call_super(this,tl,[e]),"payload"),l.payload=c,l}return _inherits(tl,e),_create_class(tl,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return(function(){return _get(_get_prototype_of(tl.prototype),"processAsync",c)})().call(l,e),[4,this.createTournamentAsync()];case 1:return h.sent(),[4,this.updateMatchStateAsync(e)];case 2:return h.sent(),[4,this.nextAsync(e)];case 3:return h.sent(),[2]}})}).call(this)}},{key:"createTournamentAsync",value:function createTournamentAsync(){return _async_to_generator(function(){var e,c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:return c=(e=this.payload).name,l=e.score,h=e.customData,[4,GameSDK.tournament.createAsync({initialScore:l,config:{title:c,tournamentTitle:c},data:h})];case 1:return d.sent(),[2]}})}).call(this)}},{key:"updateMatchStateAsync",value:function updateMatchStateAsync(e){return _async_to_generator(function(){var c,l,h,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),!("getTournamentAsync"in GameSDK))throw new rt("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 1:return l=(c=f.sent()).getContextID(),h=c.getID().toString(),d=this.payload.playerId,e.customData.playerId=d,e.customData.contextId=l,e.customData.tournamentId=h,[3,3];case 2:if(_instanceof(f.sent(),rt))return[2];return[3,3];case 3:return[2]}})}).call(this)}}]),tl}(nH);var a2=ed.Utils.Valid;var a1=function(e){function sl(e,c){var l;return _class_call_check(this,sl),u(l=_call_super(this,sl,[e]),"payload"),u(l,"leaderboardPayload"),l.payload=c,l}return _inherits(sl,e),_create_class(sl,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return(function(){return _get(_get_prototype_of(sl.prototype),"processAsync",c)})().call(l,e),this.validatePayload(),[4,this.setupCreatePayload(e)];case 1:return h.sent(),[4,this.createLeaderboardAsync(e)];case 2:return h.sent(),[4,this.nextAsync(e)];case 3:return h.sent(),[2]}})}).call(this)}},{key:"validatePayload",value:function validatePayload(){var e=this.payload.leaderboardId;if(!a2.isString(e))throw new ab}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!a2.isString(e))throw new eT}},{key:"setupCreatePayload",value:function setupCreatePayload(e){return _async_to_generator(function(){var c,l,h,d,f;return _ts_generator(this,function(y){return c=e.customData.playerId,this.validatePlayerId(c),h=(l=this.payload).name,d=l.leaderboardId,f=l.customData,this.leaderboardPayload={_id:d,name:null!=h?h:"",createdBy:c,description:JSON.stringify(f)},[2]})}).call(this)}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload)];case 1:return c=l.sent(),e.customData.leaderboardId=c,[2]}})}).call(this)}}]),sl}(nH);var a3=function(e){function nl(){return _class_call_check(this,nl),_call_super(this,nl,arguments)}return _inherits(nl,e),_create_class(nl,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A,b,D;return _ts_generator(this,function(k){switch(k.label){case 0:return k.trys.push([0,,2,3]),this.startLog(e),c=e.playerId,l=e.name,h=e.score,d=e.leaderboardId,f=e.payload,y=new ro(this),_=new rP(this,{contextId:"SOLO"}),y.setNext(_),v=new a0(this,{name:l,score:h,playerId:c,customData:f}),_.setNext(v),p=new aG(this,{profileId:c}),v.setNext(p),g=new ax(this,{id:c,score:h}),p.setNext(g),m=new a1(this,{name:l,customData:f,leaderboardId:d}),g.setNext(m),A=new aI(this),m.setNext(A),b=new aZ(this),A.setNext(b),D=this.match.getMatchState(),[4,y.processAsync(D)];case 1:return k.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),nl}(nj);var a4=ed.Plugins.Analytics,a5=ed.Utils.Valid;var a6=function(e){function rl(e,c){var l;return _class_call_check(this,rl),u(l=_call_super(this,rl,[e]),"payload"),l.payload=c,l}return _inherits(rl,e),_create_class(rl,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return(function(){return _get(_get_prototype_of(rl.prototype),"processAsync",c)})().call(l,e),this.validateData(e),[4,this.postScoreTournamentAsync(e)];case 1:return h.sent(),[4,this.nextAsync(e)];case 2:return h.sent(),[2]}})}).call(this)}},{key:"validateData",value:function validateData(e){var c=e.profiles,l=e.customData.playerId;if(this.validatePlayerId(l),!c[l])throw new rs}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!a5.isString(e))throw new eT}},{key:"getPlayerProfile",value:function getPlayerProfile(e){var c=e.profiles,l=e.customData.playerId;return this.validatePlayerId(l),c[l]}},{key:"isNewBestScore",value:function isNewBestScore(e){var c=this.getPlayerProfile(e),l=c.score,h=c.bestScore;return(void 0===l?0:l)>(void 0===h?0:h)}},{key:"postScoreTournamentAsync",value:function postScoreTournamentAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:c=window.game.analytics,h=void 0===(l=this.getPlayerProfile(e).score)?0:l,d=null,f=!1,y=this.payload.checkBestScore,_=this.isNewBestScore(e),v.label=1;case 1:if(v.trys.push([1,7,8,9]),!("getTournamentAsync"in GameSDK))throw new rt("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 2:if(v.sent(),!(!y||_))return[3,4];return d=a4.Events.TOURNAMENT_SHARE,[4,GameSDK.tournament.shareAsync({score:h})];case 3:return v.sent(),[3,6];case 4:return d=a4.Events.TOURNAMENT_POST_SCORE,[4,GameSDK.tournament.postScoreAsync(h)];case 5:v.sent(),v.label=6;case 6:return f=!0,[3,9];case 7:return v.sent(),[3,9];case 8:return d&&c.event(d,{success:f}),[7];case 9:return[2]}})}).call(this)}}]),rl}(nH);var a7=function(e){function il(){return _class_call_check(this,il),_call_super(this,il,arguments)}return _inherits(il,e),_create_class(il,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,l,h,d,f,y,_,v,p,g,m,A,b,D;return _ts_generator(this,function(k){switch(k.label){case 0:return k.trys.push([0,,2,3]),this.startLog(e),c=e.playerId,l=e.bestScore,d=void 0===(h=e.checkBestScore)?!1:h,f=new ro(this),y=new rY(this,{useAPI:!1}),f.setNext(y),_=new ax(this,{id:c,bestScore:l}),y.setNext(_),v=new a6(this,{checkBestScore:d}),_.setNext(v),p=new rG(this),v.setNext(p),g=new rQ(this),p.setNext(g),m=new aI(this),g.setNext(m),A=new rH(this),m.setNext(A),b=new nX(this),A.setNext(b),D=this.match.getMatchState(),[4,f.processAsync(D)];case 1:return k.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),il}(nj);var a8=ed.Utils,a9=a8.Valid,st=a8.Object;var sr=function(e){function cl(e,c){var l;return _class_call_check(this,cl),u(l=_call_super(this,cl,[e]),"payload"),l.payload=c,l}return _inherits(cl,e),_create_class(cl,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return(function(){return _get(_get_prototype_of(cl.prototype),"processAsync",c)})().call(l,e),h=this.payload.tournamentId,this.validateTournamentId(h),[4,this.joinTournamentAsync(h)];case 1:return _.sent(),[4,GameSDK.getTournamentAsync()];case 2:return f=(d=_.sent()).getContextID(),this.validateContextId(f),y=JSON.parse(d.getPayload()||"{}").leaderboardId,this.validateLeaderboardId(y),e.customData.contextId=f,e.customData.tournamentId=h,e.customData.leaderboardId=y,[4,this.nextAsync(e)];case 3:return _.sent(),[2]}})}).call(this)}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!a9.isString(e))throw new aY}},{key:"validateContextId",value:function validateContextId(e){if(!a9.isString(e))throw new rr}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!a9.isString(e)||""===e)throw new ab}},{key:"joinTournamentAsync",value:function joinTournamentAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:if(!("tournament"in GameSDK))throw new rt("tournament");l.label=1;case 1:return l.trys.push([1,3,,4]),[4,GameSDK.tournament.joinAsync(e)];case 2:return l.sent(),[3,4];case 3:if(c=l.sent(),!st.hasOwn(c,"code")||"SAME_CONTEXT"!==c.code)throw c;return[3,4];case 4:return[2]}})})()}}]),cl}(nH);var sa=function(e){function ll(){return _class_call_check(this,ll),_call_super(this,ll,arguments)}return _inherits(ll,e),_create_class(ll,[{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){var c,h,d,f,y,_,v,p,g,m,A;return _ts_generator(this,function(b){switch(b.label){case 0:return b.trys.push([0,,2,3]),this.startLog(e),c=e.playerId,h=e.tournamentId,d=new ro(this),f=new sr(this,{tournamentId:h}),d.setNext(f),y=new n9(this,{id:"1997",mode:l.TOURNAMENT,customData:{playerId:c}}),f.setNext(y),_=new rb(this),y.setNext(_),v=new aG(this,{profileId:c}),_.setNext(v),p=new nJ(this),v.setNext(p),g=new aq(this),p.setNext(g),m=new nX(this),g.setNext(m),A=this.match.getMatchState(),[4,d.processAsync(A)];case 1:return b.sent(),[3,3];case 2:return this.endLog(),[7];case 3:return[2]}})}).call(this)}}]),ll}(nj);var si=ed.Dtos,so=ed.Utils.Object;var sc=function(e){function fl(){return _class_call_check(this,fl),_call_super(this,fl,arguments)}return _inherits(fl,e),_create_class(fl,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){var h;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(fl.prototype),"processAsync",c)})().call(l,e),[4,this.getMatchCustomData(e)];case 1:return h=d.sent(),this.updateMatchCustomData(e,h),[4,this.nextAsync(e)];case 2:return d.sent(),[2]}})}).call(this)}},{key:"getMatchCustomData",value:function getMatchCustomData(e){return _async_to_generator(function(){var c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:if(!(c=e.id))return[2,{}];return[4,this.match.api.getMatchAPI().getMatchDetailByIdAsync(c)];case 1:return[2,null!=(h=null==(l=d.sent())?void 0:l.extraData)?h:{}]}})}).call(this)}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e,c){var l=so.merge(e.customData,c);e.customData=new si.Match.CustomData(l).toObject()}}]),fl}(nH);var su=ed.Dtos,sh=ed.Utils.Object;var sf=function(e){function ml(e,c){var l;return _class_call_check(this,ml),u(l=_call_super(this,ml,[e]),"payload"),l.payload=c,l}return _inherits(ml,e),_create_class(ml,[{key:"processAsync",value:function processAsync(e){var c=this;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(h){switch(h.label){case 0:return(function(){return _get(_get_prototype_of(ml.prototype),"processAsync",c)})().call(l,e),this.updateMatchCustomData(e),[4,this.nextAsync(e)];case 1:return h.sent(),[2]}})}).call(this)}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e){var c=sh.merge(e.customData,this.payload);e.customData=new su.Match.CustomData(c).toObject()}}]),ml}(nH);var sy={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:_object_spread({},n8)},s_=ed.Configs;var sv=function(e){function wl(){var e;return _class_call_check(this,wl),e=_call_super(this,wl,arguments),u(e,"base"),u(e,"group"),u(e,"single"),u(e,"context"),u(e,"strategy"),u(e,"challenge"),u(e,"tournament"),u(e,"api"),u(e,"handler"),u(e,"useCPUProfile"),e}return _inherits(wl,e),_create_class(wl,[{key:"init",value:function init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}},{key:"setUseCPUProfile",value:function setUseCPUProfile(e){this.useCPUProfile=e}},{key:"createMatchData",value:function createMatchData(){this.game.storage.addStorage("match",sy)}},{key:"getMatchState",value:function getMatchState(){return this.game.storage.getStorage("match")}},{key:"createBaseConcrete",value:function createBaseConcrete(){this.base=new nj(this.game,this)}},{key:"createConcreteFlows",value:function createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createContextFlows(),this.createStrategyFlows(),this.createChallengeFlows(),this.createTournamentFlows()}},{key:"createConcreteHandlers",value:function createConcreteHandlers(){var e=this;this.handler={setProfileData:function(c){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:return e=new ax(this.base,c),[4,this.processHandlerAsync(e)];case 1:return l.sent(),[2]}})}).call(e)},setMatchCustomData:function(c){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:return e=new sf(this.base,c),[4,this.processHandlerAsync(e)];case 1:return l.sent(),[2]}})}).call(e)},getMatchCustomData:function(){return _async_to_generator(function(){var e;return _ts_generator(this,function(c){switch(c.label){case 0:return e=new sc(this.base),[4,this.processHandlerAsync(e)];case 1:return c.sent(),[2]}})}).call(e)},setLeaderboardScore:function(c){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:return e=new aS(this.base,c),[4,this.processHandlerAsync(e)];case 1:return l.sent(),[2]}})}).call(e)}}}},{key:"createAPIHandler",value:function createAPIHandler(){var e={appId:s_.AppId,matchAPIHost:s_.ApiHost};this.api=new nG(e)}},{key:"createGroupFlows",value:function createGroupFlows(){this.group={join:new aT(this.game,this),start:new aO(this.game,this),finish:new aE(this.game,this)}}},{key:"createSingleFlows",value:function createSingleFlows(){this.single={start:new aj(this.game,this),finish:new aM(this.game,this)}}},{key:"createStrategyFlows",value:function createStrategyFlows(){this.strategy={start:new aU(this.game,this),finish:new aB(this.game,this)}}},{key:"createContextFlows",value:function createContextFlows(){this.context={choose:new aw(this.game,this)}}},{key:"createChallengeFlows",value:function createChallengeFlows(){this.challenge={invite:new r9(this.game,this),friend:new rS(this.game,this),join:new al(this.game,this),await:new rd(this.game,this),result:new aA(this.game,this),finish:new rX(this.game,this),continue:new rN(this.game,this)}}},{key:"createTournamentFlows",value:function createTournamentFlows(){this.tournament={join:new sa(this.game,this),create:new a3(this.game,this),finish:new a7(this.game,this),continue:new aX(this.game,this)}}},{key:"processHandlerAsync",value:function processHandlerAsync(e){var c=this.getMatchState();return e.processAsync(c)}}]),wl}(eY.Plugins.BasePlugin);var sp=ed.Utils.Valid,sg="is invalid";var sm=function(e){function Un(){return _class_call_check(this,Un),_call_super(this,Un,arguments)}return _inherits(Un,e),_create_class(Un,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!sp.isNumber(e)||e<0)&&this.exception("level",sg)}},{key:"validateRescued",value:function validateRescued(e){(!sp.isNumber(e)||e<0)&&this.exception("rescued",sg)}},{key:"validateContextId",value:function validateContextId(e){sp.isString(e)||this.exception("contextId",sg)}},{key:"validatePlayerId",value:function validatePlayerId(e){sp.isString(e)||this.exception("playerId",sg)}},{key:"validateOpponentId",value:function validateOpponentId(e){sp.isString(e)||null===e||this.exception("opponentId",sg)}},{key:"validateTournamentId",value:function validateTournamentId(e){sp.isString(e)||null===e||this.exception("tournamentId",sg)}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){sp.isString(e)||null===e||this.exception("leaderboardId",sg)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Un.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return em.getDefaultData()}}]),Un}(em);sm.addDefaultData(n8);var sA=ed.Utils.Valid,sw="is invalid";var sb=function(e){function Vn(){return _class_call_check(this,Vn),_call_super(this,Vn,arguments)}return _inherits(Vn,e),_create_class(Vn,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){sA.isString(e)&&e||this.exception("id",sw)}},{key:"validateName",value:function validateName(e){sA.isString(e)&&e||this.exception("name",sw)}},{key:"validatePhoto",value:function validatePhoto(e){sA.isString(e)||this.exception("photo",sw)}},{key:"validateScore",value:function validateScore(e){(!sA.isNumber(e)||e<0)&&this.exception("score",sw)}},{key:"validateBestScore",value:function validateBestScore(e){(!sA.isNumber(e)||e<0)&&this.exception("bestScore",sw)}},{key:"validateFinished",value:function validateFinished(e){sA.isBoolean(e)||this.exception("finished",sw)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Vn.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return em.getDefaultData()}}]),Vn}(em);sb.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1}),ed.Dtos.Match={Data:a_,Profile:sb,CustomData:sm};var sD=[{id:"finish-level",title:"Finish 1 level",require:{level:1},reward:{coin:300},duration:864e5}];var sS=function(){function Il(){_class_call_check(this,Il)}return _create_class(Il,[{key:"getMissionsAsync",value:function getMissionsAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,_to_consumable_array(sD)]})})()}}]),Il}();var sk={tasks:[],process:{}},sI=ed.Utils,sP=sI.Json,sE=sI.Valid,sC=sI.Object;var sx=function(e){function Sl(){var e;return _class_call_check(this,Sl),e=_call_super(this,Sl,arguments),u(e,"api"),e}return _inherits(Sl,e),_create_class(Sl,[{key:"init",value:function init(){this.game.storage.addStorage("missions",sk,!0),this.api=new sS}},{key:"requestMissions",value:function requestMissions(){return _async_to_generator(function(){var e,c,l,h,d,f,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:return[4,this.api.getMissionsAsync()];case 1:e=v.sent(),c=Date.now(),l=true,h=false,d=void 0;try{for(f=e[Symbol.iterator]();!(l=(y=f.next()).done);l=true)(_=y.value).expirationTime=c+_.duration}catch(e){h=true,d=e}finally{try{if(!l&&null!=f.return)f.return()}finally{if(h)throw d}}return this.receivePlayerMissionData(e),[2]}})}).call(this)}},{key:"addMission",value:function addMission(e){var c,l=this.game.storage,h=e.id,d=e.duration;e.expirationTime||(e.expirationTime=Date.now()+d);var f=null!=(c=l.getStorageData("missions","tasks"))?c:[],y=f.findIndex(function(e){return e.id===h});if(-1!==y){var _=sC.merge(f[y],e);f[y]=_}else f.push(e);var v=_to_consumable_array(f);l.setStorageData("missions","tasks",v),this.addProcessLog(e),l.updateToWebStorage("missions")}},{key:"addProcessLog",value:function addProcessLog(e){var c,l=this.game.storage,h=e.id,d=e.require,f={},y=Object.keys(d);var _=true,v=false,p=void 0;try{for(var g,m=y[Symbol.iterator]();!(_=(g=m.next()).done);_=true)f[g.value]=0}catch(e){v=true,p=e}finally{try{if(!_&&null!=m.return)m.return()}finally{if(v)throw p}}var A=null!=(c=l.getStorageData("missions","process"))?c:{};A[h]={require:f,rewarded:!1},l.setStorageData("missions","process",A)}},{key:"removeMission",value:function removeMission(e){var c=this.game.storage,l=c.getStorageData("missions","tasks");if(!l)return;var h=l.filter(function(c){return c.id!==e});c.setStorageData("missions","tasks",h),this.removeProcessLog(e),c.updateToWebStorage("missions")}},{key:"removeProcessLog",value:function removeProcessLog(e){var c;var l=this.game.storage,h=null!=(c=l.getStorageData("missions","process"))?c:{};if(h[e]){var d=h[e].require,f=Object.keys(d);var y=true,_=false,v=void 0;try{for(var p,g=f[Symbol.iterator]();!(y=(p=g.next()).done);y=true)d[p.value]=0}catch(e){_=true,v=e}finally{try{if(!y&&null!=g.return)g.return()}finally{if(_)throw v}}h[e]={require:d,rewarded:!1}}l.setStorageData("missions","process",h)}},{key:"receivePlayerMissionData",value:function receivePlayerMissionData(e){var c;var l=this.game.storage,h=null!=(c=l.getStorageData("missions","tasks"))?c:[],d=this.filterMissionByExpirationTime(h),f=this.combineMissions(e,d);l.setStorageData("missions","tasks",f);var y=this.filterExistingSavedProcess(d);this.receiveProcessLogs(f,y),l.updateToWebStorage("missions")}},{key:"filterExistingSavedProcess",value:function filterExistingSavedProcess(e){var c=(this.game.player.getPlayerDataByKey("missionsData")||{}).process,l=void 0===c?{}:c,h=e.map(function(e){return e.id}),d=Object.keys(l).filter(function(e){return!h.includes(e)}),f={};var y=true,_=false,v=void 0;try{for(var p,g=d[Symbol.iterator]();!(y=(p=g.next()).done);y=true){var m=p.value;f[m]=l[m]}}catch(e){_=true,v=e}finally{try{if(!y&&null!=g.return)g.return()}finally{if(_)throw v}}return f}},{key:"filterMissionByExpirationTime",value:function filterMissionByExpirationTime(e){var c=Date.now();return e.filter(function(e){var l=e.expirationTime;return l?c<l:!1})}},{key:"combineMissions",value:function combineMissions(e,c){var l=c.map(function(e){return e.id}),h=e.filter(function(e){var c=e.id;return!l.includes(c)});return _to_consumable_array(c).concat(_to_consumable_array(h))}},{key:"receiveProcessLogs",value:function receiveProcessLogs(e,c){var l={};var h=true,d=false,f=void 0;try{for(var y,_=e[Symbol.iterator]();!(h=(y=_.next()).done);h=true){var v=y.value;var p=v.id,g=v.require;if(sC.hasOwn(c,p)){l[p]=sP.clone(c[p]);return}var m={},A=Object.keys(g);var b=true,D=false,k=void 0;try{for(var E,T=A[Symbol.iterator]();!(b=(E=T.next()).done);b=true)m[E.value]=0}catch(e){D=true,k=e}finally{try{if(!b&&null!=T.return)T.return()}finally{if(D)throw k}}l[p]={require:m,rewarded:!1}}}catch(e){d=true,f=e}finally{try{if(!h&&null!=_.return)_.return()}finally{if(d)throw f}}this.game.player.setPlayerDataByName("missionsData",{logTasks:l}),this.updateMissionProcess(l)}},{key:"updateMissionProcess",value:function updateMissionProcess(e){var c=this.game.storage;c.setStorageData("missions","process",e),c.updateToWebStorage("missions")}},{key:"getPlayerMissionProcess",value:function getPlayerMissionProcess(){var e=(this.game.player.getPlayerDataByKey("missionsData")||{}).process;return sP.clone(e)}},{key:"addMissionValue",value:function addMissionValue(e){var c=e.id,l=e.type,h=e.value,d=this.getPlayerMissionProcess();if(!sE.isObject(d))return;var f=Object.keys(d).filter(function(e){return e.includes(c)});var y=true,_=false,v=void 0;try{for(var p,g=f[Symbol.iterator]();!(y=(p=g.next()).done);y=true){var m=d[p.value];!m||m.rewarded||(m.require[l]+=h)}}catch(e){_=true,v=e}finally{try{if(!y&&null!=g.return)g.return()}finally{if(_)throw v}}this.updateMissionProcess(d),this.updatePlayerMissionProcess()}},{key:"setMissionRewardClaimed",value:function setMissionRewardClaimed(e){var c=this.getPlayerMissionProcess();if(!sE.isObject(c))return;sC.hasOwn(c,e)&&(c[e].rewarded=!0,this.updateMissionProcess(c),this.updatePlayerMissionProcess())}},{key:"updatePlayerMissionProcess",value:function updatePlayerMissionProcess(){var e=this.game.player,c=this.game.storage.getStorageData("missions","process"),l=this.getPlayerMissionProcess(),h=sC.merge(l,c);e.setPlayerDataByName("missionsData",{process:h})}}]),Sl}(eY.Plugins.BasePlugin);var sT=ed.Utils.Object,sN=ed.Configs.ApiHost,vl=function(){var e=GameSDK.getSDKName();var c="players";switch(e){case"MsGames":c+="?platform=ms-games";break;case"Yandex":c+="?platform=yandex";break}return c},sL=ed.Utils,sO=sL.Array,sM=sL.Object,sR=sL.Valid,sF=ed.Configs.AppId;var sG=function(e){function Nl(){var e;return _class_call_check(this,Nl),e=_call_super(this,Nl,arguments),u(e,"isLoggedIn",!1),e}return _inherits(Nl,e),_create_class(Nl,[{key:"init",value:function init(){this.game.storage.addStorage("player",ew)}},{key:"saveToCloud",value:function saveToCloud(){return _async_to_generator(function(){var e;return _ts_generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),e=this.getPlayerData(),[4,GameSDK.player.setDataAsync(e)];case 1:return c.sent(),[3,3];case 2:return c.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"receiveData",value:function receiveData(e,c){var l=this.game.storage,h=e.playerId,d=e.name,f=e.photo,y=e.locale;l.setStorageData("player","playerId",h),l.setStorageData("player","name",d),l.setStorageData("player","photo",f),l.setStorageData("player","locale",y),c&&(this.setPlayerData(c),this.isLoggedIn=!c.isFirstLogin)}},{key:"syncProfileToServer",value:function syncProfileToServer(){return _async_to_generator(function(){var e,c,l,h,d,f,y,_;return _ts_generator(this,function(v){switch(v.label){case 0:if(GameSDK.extra.isGuest)throw new Error("Guest player cannot sync profile to server");if(e=this.game.storage,l=(c=this.getPlayer()).playerId,h=c.name,d=c.photo,f=c.locale,y=this.getPlayerASID(),!(!sR.isString(y)&&"getASIDAsync"in GameSDK.player))return[3,2];return[4,GameSDK.player.getASIDAsync()];case 1:y=null!=(_=v.sent())?_:y,e.setStorageData("player","ASID","".concat(y)),v.label=2;case 2:return[4,function(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:if(!sN)return[2,{}];return[4,J(vl(),e,{},sN,10)];case 1:return c=l.sent(),[2,sT.hasOwn(c,"data")?c.data||{}:{}]}})})()}({appId:sF,ASID:y,playerId:l,name:h,photo:d,locale:f})];case 3:return v.sent(),[2]}})}).call(this)}},{key:"setPlayerDataByName",value:function setPlayerDataByName(e,c){this.setPlayerData(_define_property({},e,c))}},{key:"setPlayerData",value:function setPlayerData(e){this.game.storage.setStorageData("player","data",e),this.saveToCloud()}},{key:"setBestScore",value:function setBestScore(e){this.setPlayerDataByName("score",e)}},{key:"setSetting",value:function setSetting(e,c){this.setPlayerDataByName("settings",_define_property({},e,c))}},{key:"setGameData",value:function setGameData(e){var c;var l=null!=(c=this.getGameData())?c:{},h=sM.merge(l,e);this.setPlayerDataByName("gameData",h)}},{key:"requestConnectedPlayers",value:function requestConnectedPlayers(){return _async_to_generator(function(){var e,c,l,h;return _ts_generator(this,function(d){switch(d.label){case 0:return e=this.game.storage,[4,GameSDK.player.getConnectedPlayersAsync()];case 1:if(c=d.sent().map(function(e){var c=e.getID(),l=e.getName(),h=e.getPhoto();return c&&l&&h?new eE({playerId:c,name:l,photo:h}).toObject():null}),(l=sO.unique(c)).length<1)return[2];return h=sM.keyBy(l,"playerId"),e.setStorageData("player","connectedPlayers",h),[2]}})}).call(this)}},{key:"getPlayer",value:function getPlayer(){return this.game.storage.getStorage("player")}},{key:"getPlayerId",value:function getPlayerId(){var e;return null!=(e=this.game.storage.getStorageData("player","playerId"))?e:""}},{key:"getPlayerASID",value:function getPlayerASID(){var e;return null!=(e=this.game.storage.getStorageData("player","ASID"))?e:null}},{key:"getPlayerLocale",value:function getPlayerLocale(){var e;return null!=(e=this.game.storage.getStorageData("player","locale"))?e:""}},{key:"getPlayerData",value:function getPlayerData(){var e;return null!=(e=this.game.storage.getStorageData("player","data"))?e:ew.data}},{key:"getPlayerDataByKey",value:function getPlayerDataByKey(e){var c=this.getPlayerData();return sM.hasOwn(c,e)?c[e]:null}},{key:"getGameData",value:function getGameData(){return this.getPlayerDataByKey("gameData")}},{key:"getPlayerSetting",value:function getPlayerSetting(e){var c=this.getPlayerSettings();return sM.hasOwn(c,e)?c[e]:null}},{key:"getPlayerSettings",value:function getPlayerSettings(){return this.getPlayerData().settings}},{key:"isFirstLogin",value:function isFirstLogin(){var e;return null!=(e=this.getPlayerDataByKey("isFirstLogin"))?e:ew.data.isFirstLogin}},{key:"isFirstSession",value:function isFirstSession(){return this.isFirstLogin()||!this.isLoggedIn}},{key:"loggedIn",value:function loggedIn(){this.setPlayerDataByName("isFirstLogin",!1),this.isLoggedIn=!0}},{key:"getBestScore",value:function getBestScore(){return this.getPlayerData().score}},{key:"getConnectedPlayers",value:function getConnectedPlayers(){var e;return null!=(e=this.game.storage.getStorageData("player","connectedPlayers"))?e:{}}},{key:"getConnectedPlayerIds",value:function getConnectedPlayerIds(e,c){return Object.keys(this.getConnectedPlayers()).slice(c,c+e)}},{key:"getNotificationData",value:function getNotificationData(){var e;return null!=(e=this.getPlayerDataByKey("notificationData"))?e:ew.data.notificationData}}]),Nl}(eY.Plugins.BasePlugin);var sj=ed.Dtos,sB=ed.Utils.Valid,sU=ew.data,sV=sU.score,sH=sU.settings,sK=sU.gameData,sz=sU.isFirstLogin,sW=sU.missionsData,sq=sU.notificationData,sY=sU.dailyRewardedData,sJ=sU.lastCallSwitchGame,sQ="is invalid";var sX=function(e){function zn(){return _class_call_check(this,zn),_call_super(this,zn,arguments)}return _inherits(zn,e),_create_class(zn,[{key:"processData",value:function processData(e){this.validateStructure(e),e.settings=new sj.Player.Settings(e.settings).toObject(),e.gameData=new sj.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}},{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateScore",value:function validateScore(e){(!sB.isNumber(e)||e<0)&&this.exception("score",sQ)}},{key:"validateSettings",value:function validateSettings(e){sB.isObject(e)||this.exception("settings",sQ)}},{key:"validateMissionsData",value:function validateMissionsData(e){sB.isObject(e)||this.exception("missionsData",sQ),"process"in e&&sB.isObject(e.process)||this.exception("missionsData.process",sQ)}},{key:"validateNotificationData",value:function validateNotificationData(e){sB.isObject(e)||this.exception("notificationData",sQ),"D1"in e&&sB.isObject(e.D1)||this.exception("notificationData.D1",sQ),"D2"in e&&sB.isObject(e.D2)||this.exception("notificationData.D2",sQ),"D3"in e&&sB.isObject(e.D3)||this.exception("notificationData.D3",sQ),"D4"in e&&sB.isObject(e.D4)||this.exception("notificationData.D4",sQ),"D5"in e&&sB.isObject(e.D5)||this.exception("notificationData.D5",sQ),"D6"in e&&sB.isObject(e.D6)||this.exception("notificationData.D6",sQ),"D7"in e&&sB.isObject(e.D7)||this.exception("notificationData.D7",sQ)}},{key:"validateGameData",value:function validateGameData(e){sB.isObject(e)||this.exception("gameData",sQ)}},{key:"validateIsFirstLogin",value:function validateIsFirstLogin(e){sB.isBoolean(e)||this.exception("isFirstLogin",sQ)}},{key:"validateDailyRewardedData",value:function validateDailyRewardedData(e){sB.isObject(e)||this.exception("dailyRewardedData",sQ)}},{key:"validateLastCallSwitchGame",value:function validateLastCallSwitchGame(e){sB.isNumber(e)||this.exception("lastCallSwitchGame",sQ),e<0&&this.exception("lastCallSwitchGame",sQ)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(zn.prototype),"toObject",this).call(this)}}]),zn}(em);sX.addDefaultData({score:sV,settings:sH,gameData:sK,isFirstLogin:sz,missionsData:sW,notificationData:sq,dailyRewardedData:sY,lastCallSwitchGame:sJ});var s$=ed.Utils.Valid,sZ=ew.data.gameData,s0=sZ.level,s2=sZ.coins;var s1=function(e){function Yn(){return _class_call_check(this,Yn),_call_super(this,Yn,arguments)}return _inherits(Yn,e),_create_class(Yn,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!s$.isNumber(e)||e<0)&&this.exception("level","is invalid")}},{key:"validateCoins",value:function validateCoins(e){(!s$.isNumber(e)||e<0)&&this.exception("coins","is invalid")}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Yn.prototype),"toObject",this).call(this)}}]),Yn}(em);s1.addDefaultData({level:s0,coins:s2});var s3=ed.Utils.Valid,s4=ew.data.settings,s5=s4.sound,s6=s4.music,s7=s4.vibrate,s8=s4.language,s9="is invalid";var it=function(e){function Jn(){return _class_call_check(this,Jn),_call_super(this,Jn,arguments)}return _inherits(Jn,e),_create_class(Jn,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateSound",value:function validateSound(e){s3.isBoolean(e)||this.exception("sound",s9)}},{key:"validateMusic",value:function validateMusic(e){s3.isBoolean(e)||this.exception("music",s9)}},{key:"validateVibrate",value:function validateVibrate(e){s3.isBoolean(e)||this.exception("vibrate",s9)}},{key:"validateLanguage",value:function validateLanguage(e){s3.isString(e)&&e||this.exception("language",s9)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Jn.prototype),"toObject",this).call(this)}}]),Jn}(em);it.addDefaultData({sound:s5,music:s6,vibrate:s7,language:s8}),ed.Dtos.Player={Info:eE,Data:sX,Settings:it,GameData:s1};var ir=ed.Configs,ia=ed.Utils,ii=ia.Object,iu=ia.String,ih=ir.ApiHost,iy=ir.Mockup;var i_=function(){function Jl(){_class_call_check(this,Jl),u(this,"mockAPI")}return _create_class(Jl,[{key:"initMockAPI",value:function initMockAPI(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:if(this.mockAPI)return[2];return[4,ie(function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return na})];case 1:return[2,{default:e.sent().default}]}})})()},void 0,c.meta.url)];case 1:if("function"!=typeof(e=l.sent().default))throw new Error("Cannot load ProfileAPIMock");return this.mockAPI=new e,[2]}})}).call(this)}},{key:"getPlayersAsync",value:function getPlayersAsync(e){return _async_to_generator(function(){var c,l;return _ts_generator(this,function(h){switch(h.label){case 0:if(c=iu.params(e),!iy.Profile.Enabled)return[3,3];return[4,this.initMockAPI()];case 1:return h.sent(),[4,this.mockAPI.getPlayersAsync(e)];case 2:return l=h.sent(),[3,5];case 3:if(!ih)return[2,[]];return[4,Me("players?".concat(c),{},ih)];case 4:l=h.sent(),h.label=5;case 5:return[2,ii.hasOwn(l,"data")&&Array.isArray(l.data)?l.data:[]]}})}).call(this)}}]),Jl}();var iv={profiles:{},profileIds:[]},ip=ed.Utils,ig=ed.Dtos,im=ip.Array,iA=ip.Valid,iw=ip.Object,ib=ip.Function;var iD=function(e){function sd(){var e;return _class_call_check(this,sd),e=_call_super(this,sd,arguments),u(e,"profileAPI",new i_),e}return _inherits(sd,e),_create_class(sd,[{key:"init",value:function init(){this.game.storage.addStorage("profile",iv)}},{key:"requestProfiles",value:function requestProfiles(e){return _async_to_generator(function(){var c,l,h,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:if(c=this,l=this.getProfileIds(),(h=im.difference(e,l)).length<1)return[2];return d=im.chunk(h,400).map(function(e){return c.profileAPI.getPlayersAsync({playerIds:e})}),[4,ib.allSettled(d)];case 1:if(f=_.sent().reduce(function(e,c){return"fulfilled"===c.status?e.concat(c.value):e},[]),!this.validateProfilesResponse(f))return[2];return y=this.convertToProfiles(f),this.setProfiles(y),[2]}})}).call(this)}},{key:"getProfile",value:function getProfile(e){var c;return null!=(c=this.getProfiles()[e])?c:null}},{key:"getProfiles",value:function getProfiles(){var e;return null!=(e=this.game.storage.getStorageData("profile","profiles"))?e:iv.profiles}},{key:"setProfiles",value:function setProfiles(e){var c=this.game.storage;c.setStorageData("profile","profiles",e),c.setStorageData("profile","profileIds",Object.keys(e))}},{key:"getProfileIds",value:function getProfileIds(){var e;return null!=(e=this.game.storage.getStorageData("profile","profileIds"))?e:[]}},{key:"validateProfilesResponse",value:function validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}},{key:"convertToProfiles",value:function convertToProfiles(e){var c={};var l=true,h=false,d=void 0;try{for(var f,y=e[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;iw.hasOwn(_,"playerId")&&iA.isString(_.playerId)&&(c[_.playerId]=new ig.Player.Info(_).toObject())}}catch(e){h=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(h)throw d}}return c}}]),sd}(eY.Plugins.BasePlugin);var iS="Blossom Master",ik=ed.Utils,iI=ik.Object,iP=ik.Valid,iE=ik.Browser;var iC=function(e){function nd(e){var c;return _class_call_check(this,nd),u(c=_call_super(this,nd,[e]),"storages"),u(c,"storageLocalKeys",{}),c.storages={},c}return _inherits(nd,e),_create_class(nd,[{key:"addStorage",value:function addStorage(e,c){return _async_to_generator(function(e,c){var l;var h=arguments;return _ts_generator(this,function(d){switch(d.label){case 0:if(l=h.length>2&&void 0!==h[2]?h[2]:!1,this.storages[e]=c,!l)return[3,2];return[4,this.initFromWebStorage(e,c)];case 1:d.sent(),d.label=2;case 2:return[2]}})}).apply(this,arguments)}},{key:"initFromWebStorage",value:function initFromWebStorage(e,c){return _async_to_generator(function(){var l,h,d,f,y,_,v,p;return _ts_generator(this,function(g){switch(g.label){case 0:return this.storageLocalKeys[e]=!0,[4,iE.getIndexedDB("".concat(iS,"_S_").concat(e))];case 1:if(l=g.sent(),!iP.isObject(l))return[2];h=Object.keys(c),d=true,f=false,y=void 0;try{for(_=h[Symbol.iterator]();!(d=(v=_.next()).done);d=true)p=v.value,iI.hasOwn(l,p)&&_type_of(c[p])==_type_of(l[p])&&this.setStorageData(e,p,l[p])}catch(e){f=true,y=e}finally{try{if(!d&&null!=_.return)_.return()}finally{if(f)throw y}}return[2]}})}).call(this)}},{key:"initStorageData",value:function initStorageData(e,c,l){this.storages[e][c]=l}},{key:"setStorageData",value:function setStorageData(e,c,l){var h;if(iP.isObject(l)){var d=this.getStorageData(e,c);h=iI.merge(d,l)}else h=l;this.storages[e][c]=h}},{key:"getStorageData",value:function getStorageData(e,c){return this.getStorage(e)[c]}},{key:"getStorage",value:function getStorage(e){return this.storages[e]}},{key:"updateToWebStorage",value:function updateToWebStorage(e){return _async_to_generator(function(){return _ts_generator(this,function(c){if(this.storageLocalKeys[e])return[2,this.saveToWebStorage(e)];return[2]})}).call(this)}},{key:"saveToWebStorage",value:function saveToWebStorage(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){return c=this.getStorage(e),[2,iE.setIndexedDB("".concat(iS,"_S_").concat(e),c)]})}).call(this)}}]),nd}(eY.Plugins.BasePlugin);var ix=function(e){function ad(){var e;return _class_call_check(this,ad),e=_call_super(this,ad,arguments),u(e,"isVisible",!0),u(e,"browserPrefixes",["moz","ms","o","","webkit"]),u(e,"handleVisibilityChange",function(c){if("boolean"==typeof c)return c?e.onVisibleEvent():void 0;var l=e.getBrowserPrefix();document[e.getHiddenPropertyName(l)]&&e.onHiddenEvent()}),e}return _inherits(ad,e),_create_class(ad,[{key:"init",value:function init(){var e=this;var c=this.getBrowserPrefix(),l=this.getVisibilityEvent(c);document.addEventListener(l,this.handleVisibilityChange,!1),document.addEventListener("focus",function(){e.handleVisibilityChange(!0)},!1),document.addEventListener("blur",function(){e.handleVisibilityChange(!1)},!1),window.addEventListener("focus",function(){e.handleVisibilityChange(!0)},!1),window.addEventListener("blur",function(){e.handleVisibilityChange(!1)},!1)}},{key:"isGameVisible",value:function isGameVisible(){return this.isVisible}},{key:"getHiddenPropertyName",value:function getHiddenPropertyName(e){return e?e+"Hidden":"hidden"}},{key:"getVisibilityEvent",value:function getVisibilityEvent(e){return(e||"")+"visibilitychange"}},{key:"getBrowserPrefix",value:function getBrowserPrefix(){for(var e=0;e<this.browserPrefixes.length;e++)if(this.getHiddenPropertyName(this.browserPrefixes[e])in document)return this.browserPrefixes[e];return""}},{key:"onVisibleEvent",value:function onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(ed.Events.VISIBILITY_VISIBLE))}},{key:"onHiddenEvent",value:function onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(ed.Events.VISIBILITY_HIDDEN))}}]),ad}(eY.Plugins.BasePlugin);var iT=ed.Utils.Object,iN=ed.Plugins.Ads,iL=iN.Status,iO=iN.Types,iM=iN.AdError;var iR=function(e){function ra(e,c){var l;return _class_call_check(this,ra),u(l=_call_super(this,ra,[e,c]),"service"),u(l,"instance"),u(l,"instanceQueue",[]),l.service=GameSDK.getSDKName(),l.instance=null,l}return _inherits(ra,e),_create_class(ra,[{key:"setInstance",value:function setInstance(e){e||this.setStatus(iL.IDLE),this.instance=e}},{key:"loadAsync",value:function loadAsync(){return _async_to_generator(function(){var e,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(!!(this.instance&&this.status===iL.FILLED))return[3,5];if(this.status!==iL.IDLE)throw new iM("AD_NOT_READY","Ad is not ready.");l.label=1;case 1:return l.trys.push([1,4,,5]),[4,this.createInstanceByType(this.type)];case 2:if(e=l.sent(),this.setInstance(e),null===this.instance)throw new iM("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");return this.setStatus(iL.LOADING),[4,this.instance.loadAsync()];case 3:return l.sent(),this.setStatus(iL.FILLED),this.logAdLoad(),[3,5];case 4:throw c=l.sent(),this.setStatus(iL.IDLE),_instanceof(c,Object)&&"code"in c&&"INVALID_PARAM"===c.code&&this.setInstance(null),this.instance&&this.pushInstanceToQueue(this.instance),self.game.analytics.loadAdFail({type:this.type,service:this.service}),c;case 5:return[2]}})}).call(this)}},{key:"showAsync",value:function showAsync(){return _async_to_generator(function(){var e,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(this.status!==iL.FILLED)throw new iM("AD_NOT_FILLED","Ad is not filled.");if(null===this.instance)throw new iM("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");e=!1,l.label=1;case 1:return l.trys.push([1,3,4,5]),this.setStatus(iL.SHOWING),self.game.analytics.showingAd({type:this.type,service:this.service}),[4,this.instance.showAsync()];case 2:return l.sent(),e=!0,this.setInstance(null),[3,5];case 3:throw c=l.sent(),iT.hasOwn(c,"code")&&("AD_NOT_LOADED"===c.code&&this.setStatus(iL.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf("".concat(c.code))>-1&&this.setInstance(null),"USER_INPUT"===c.code&&(e=!0)),this.status===iL.SHOWING&&this.setInstance(null),c;case 4:return e?this.logAdShown():self.game.analytics.showAdFail({type:this.type,service:this.service}),[7];case 5:return[2]}})}).call(this)}},{key:"createInstanceByType",value:function createInstanceByType(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this.getAdInstanceByType(e)];case 1:return[2,l.sent()];case 2:return c=l.sent(),[2,iT.hasOwn(c,"code")&&"ADS_TOO_MANY_INSTANCES"===c.code?this.getAdInstanceFailed():null];case 3:return[2]}})}).call(this)}},{key:"getAdInstanceByType",value:function getAdInstanceByType(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:switch(e){case iO.REWARDED_VIDEO:return[3,1];case iO.INTERSTITIAL:return[3,3];case iO.REWARDED_INTERSTITIAL:return[3,5]}return[3,7];case 1:return[4,GameSDK.getRewardedVideoAsync(this.placementId)];case 2:return[2,c.sent()];case 3:return[4,GameSDK.getInterstitialAdAsync(this.placementId)];case 4:return[2,c.sent()];case 5:return[4,GameSDK.getRewardedInterstitialAsync(this.placementId)];case 6:return[2,c.sent()];case 7:return[2,null];case 8:return[2]}})}).call(this)}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(){if(!("canBeLoadedAd"in GameSDK.extra))return this.instanceQueue.shift()||null;var e=true,c=false,l=void 0;try{for(var h,d=this.instanceQueue[Symbol.iterator]();!(e=(h=d.next()).done);e=true){var f=h.value;if(GameSDK.extra.canBeLoadedAd(f))return this.instanceQueue.splice(this.instanceQueue.indexOf(f),1),f}}catch(e){c=true,l=e}finally{try{if(!e&&null!=d.return)d.return()}finally{if(c)throw l}}return null}},{key:"logAdLoad",value:function logAdLoad(){switch(this.type){case iO.INTERSTITIAL:self.game.analytics.loadInterstitialAd({service:this.service});break;case iO.REWARDED_VIDEO:self.game.analytics.loadRewardedVideoAd({service:this.service});break;case iO.REWARDED_INTERSTITIAL:self.game.analytics.loadRewardedInterstitialAd({service:this.service});break}}},{key:"logAdShown",value:function logAdShown(){switch(this.type){case iO.INTERSTITIAL:self.game.analytics.showInterstitialAd({service:this.service});break;case iO.REWARDED_VIDEO:self.game.analytics.showRewardedVideoAd({service:this.service});break;case iO.REWARDED_INTERSTITIAL:self.game.analytics.showRewardedInterstitialAd({service:this.service});break}}},{key:"pushInstanceToQueue",value:function pushInstanceToQueue(e){this.instanceQueue.push(e)}}]),ra}(iN.AdInstance);var iF=ed.Plugins.Ads.Types;var iG=function(e){function id(e,c){var l;return _class_call_check(this,id),(l=_call_super(this,id,[e,c])).service="adsense",l}return _inherits(id,e),_create_class(id,[{key:"createInstanceByType",value:function createInstanceByType(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){try{if(!(c=window.GoogleAds))return[2,null];switch(e){case iF.BANNER:return[2,c.getBannerAdAsync(this.placementId)];case iF.REWARDED_VIDEO:return[2,c.getRewardedVideoAsync(this.placementId)];case iF.INTERSTITIAL:return[2,c.getInterstitialAdAsync(this.placementId)];case iF.REWARDED_INTERSTITIAL:return[2,c.getRewardedInterstitialAsync(this.placementId)];default:return[2,null]}}catch(e){return[2,null]}})}).call(this)}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(){return null}}]),id}(iR);var ij=function(e){function od(){return _class_call_check(this,od),_call_super(this,od,arguments)}return _inherits(od,e),_create_class(od,[{key:"loadAsync",value:function loadAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return this.exception("Unsupported method"),[2]})}).call(this)}},{key:"showAsync",value:function showAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return this.exception("This method is not implemented"),[2]})}).call(this)}},{key:"hideAsync",value:function hideAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return this.exception("This method is not implemented"),[2]})}).call(this)}}]),od}(e$);var iB=ed.Plugins.Ads.Status;var iU=function(e){function cd(){return _class_call_check(this,cd),_call_super(this,cd,arguments)}return _inherits(cd,e),_create_class(cd,[{key:"showAsync",value:function showAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,GameSDK.loadBannerAdAsync(this.placementId)];case 1:return e.sent(),this.setStatus(iB.SHOWING),[2]}})}).call(this)}},{key:"hideAsync",value:function hideAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,GameSDK.hideBannerAdAsync(this.placementId)];case 1:return e.sent(),this.setStatus(iB.IDLE),[2]}})}).call(this)}}]),cd}(ij);var iV=ed.Utils.Array,iH={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed"},iK={NOT_STARTED:"not-started",IN_PROGRESS:"in-progress",COMPLETED:"completed",FAILED:"failed"},iz=["reward"],iW=["next","preroll","browse","pause","start"],iq=["auto","banner","rectangle","vertical"];var iY=function(){function ld(e){_class_call_check(this,ld),u(this,"initStatus",iH.IDLE),u(this,"preloadStatus",iK.NOT_STARTED),u(this,"game"),u(this,"adBreak"),u(this,"adConfig"),u(this,"config"),u(this,"serviceName","adsense"),u(this,"rewardedType","reward"),u(this,"interstitialType","next"),u(this,"bannerFormatType","auto"),this.game=e}return _create_class(ld,[{key:"setInitStatus",value:function setInitStatus(e){var c,l;this.initStatus!==e&&(null==(l=null==(c=this.game)?void 0:c.analytics)||l.initAdEvent({adService:this.serviceName,state:e}),this.initStatus=e)}},{key:"getInitStatus",value:function getInitStatus(){return this.initStatus}},{key:"getRewardedVideoAsync",value:function getRewardedVideoAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return[4,this.ensureInitialized()];case 1:return[2,(c.sent(),this.createAdInstance(this.rewardedType,e))]}})}).call(this)}},{key:"getInterstitialAdAsync",value:function getInterstitialAdAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return[4,this.ensureInitialized()];case 1:return[2,(c.sent(),this.createAdInstance(this.interstitialType,e))]}})}).call(this)}},{key:"getRewardedInterstitialAsync",value:function getRewardedInterstitialAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return[4,this.ensureInitialized()];case 1:return[2,(c.sent(),this.createAdInstance(this.rewardedType,e))]}})}).call(this)}},{key:"getBannerAdAsync",value:function getBannerAdAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return[4,this.ensureInitialized()];case 1:return[2,(c.sent(),this.createAdInstance(this.bannerFormatType,e))]}})}).call(this)}},{key:"setRewardType",value:function setRewardType(e){iV.has(iz,e)&&(this.rewardedType=e)}},{key:"setInterstitialType",value:function setInterstitialType(e){iV.has(iW,e)&&(this.interstitialType=e)}},{key:"setBannerFormatType",value:function setBannerFormatType(e){iV.has(iq,e)&&(this.bannerFormatType=e)}},{key:"initAsync",value:function initAsync(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:switch(l.trys.push([0,2,,3]),this.initStatus){case iH.LOADED:return[2];case iH.LOADING:return[2]}if(!this.validateConfig(e))throw new Error("Invalid Google Ads configuration");return this.setInitStatus(iH.LOADING),this.config=e,[4,this.loadScriptElementAsync()];case 1:return l.sent(),[3,3];case 2:throw c=l.sent(),this.setInitStatus(iH.FAILED),c;case 3:return[2]}})}).call(this)}},{key:"validateConfig",value:function validateConfig(e){if(!e)return!1;var c=e.dataAdClient,l=e.dataAdHost;if(!c&&!l)return!1;if(e.dataAdFrequencyHint){var h=Number(e.dataAdFrequencyHint);if(isNaN(h)||h<=0)return!1}return!0}},{key:"loadScriptElementAsync",value:function loadScriptElementAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),[4,this.injectMainScript()];case 1:return e.sent(),[4,this.configureGoogleAds()];case 2:if(e.sent(),!this.config.usePreload)return[3,4];return[4,this.preloadAdConfig()];case 3:e.sent(),e.label=4;case 4:return[3,6];case 5:throw e.sent();case 6:return[2]}})}).call(this)}},{key:"injectMainScript",value:function injectMainScript(){return _async_to_generator(function(){var e;return _ts_generator(this,function(c){return e=this,[2,new Promise(function(c,l){try{var h=document.createElement("script");e.configureScriptAttributes(h),h.onload=function(){e.setInitStatus(iH.LOADED),c()},h.onerror=function(c){e.setInitStatus(iH.FAILED),l(new Error("Failed to load ".concat(e.serviceName," Ads script: ").concat(c)))},document.head.appendChild(h)}catch(e){l(e)}})]})}).call(this)}},{key:"configureGoogleAds",value:function configureGoogleAds(){return _async_to_generator(function(){return _ts_generator(this,function(e){try{window.adsbygoogle=window.adsbygoogle||[],window.adBreak=function(e){return adsbygoogle.push(e)},window.adConfig=function(e){return adsbygoogle.push(e)},this.adBreak=window.adBreak,this.adConfig=window.adConfig}catch(e){throw e}return[2]})}).call(this)}},{key:"configureScriptAttributes",value:function configureScriptAttributes(e){var c=this.config,l=c.dataAdClient,h=c.dataAdHost,d=c.dataAdChannel,f=c.dataAdBreakTest,y=c.dataAdFrequencyHint;e.async=!0,e.crossOrigin="anonymous";var _="";y&&e.setAttribute("data-ad-frequency-hint","".concat(y,"s")),l&&(e.setAttribute("data-ad-client",l),_+="?client=".concat(l)),d&&e.setAttribute("data-ad-channel",d),h&&(e.setAttribute("data-ad-host",h),_+="&host=".concat(h)),f&&e.setAttribute("data-adbreak-test","on"),e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js".concat(_)}},{key:"ensureInitialized",value:function ensureInitialized(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:if(this.initStatus!==iH.LOADED)throw new Error("Google Ads not initialized. Call initAsync first.");return[4,this.ensurePreloaded()];case 1:return e.sent(),[2]}})}).call(this)}},{key:"ensurePreloaded",value:function ensurePreloaded(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:if(!(this.preloadStatus!==iK.COMPLETED))return[3,2];return[4,this.preloadAdPlacement()];case 1:e.sent(),e.label=2;case 2:return[2]}})}).call(this)}},{key:"createAdInstance",value:function createAdInstance(e,c){var l=this;var h=iV.has(iq,e);return{getPlacementID:function(){return c},loadAsync:function(){return _async_to_generator(function(){var l,d,f,y,_;return _ts_generator(this,function(v){if(!h)return[2,this.preloadAdPlacement()];return l=e,f=(d=this.config).dataAdClient,y=d.dataAdChannel,_=d.dataAdBreakTest,[2,this.setupBannerAdElement({type:l,placementId:c,dataAdClient:f,dataAdChannel:y,dataAdBreakTest:_})]})}).call(l)},showAsync:function(){return l.showAd(e,c)},hideAsync:function(){return l.hideAd(e,c)}}}},{key:"showAd",value:function showAd(e,c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){return l=this,[2,new Promise(function(h,d){try{if(iV.has(iq,e))return;var f=l.createAdBreakConfig({type:e,placementId:c,resolve:h,reject:d});l.adBreak(f)}catch(e){d(e)}})]})}).call(this)}},{key:"hideAd",value:function hideAd(e,c){return _async_to_generator(function(){var l;return _ts_generator(this,function(h){if(!iV.has(iq,e)||0===document.getElementsByClassName("adsbygoogle").length)return[2];return(l=this.getBannerAdElement(c))&&l.remove(),[2]})}).call(this)}},{key:"getBannerAdElement",value:function getBannerAdElement(e){return Array.from(document.getElementsByClassName("adsbygoogle")).find(function(c){return c.getAttribute("data-placement-id")===e})||null}},{key:"setupBannerAdElement",value:function setupBannerAdElement(e){return _async_to_generator(function(){var c,l,h,d,f,y,_;return _ts_generator(this,function(v){if(c=e.type,l=e.placementId,h=e.dataAdClient,d=e.dataAdChannel,f=e.dataAdBreakTest,this.getBannerAdElement(l))return[2];return(y=document.createElement("ins")).className="adsbygoogle",y.style.display="inline-block",y.style.width="100%",y.style.height="51px",y.setAttribute("data-placement-id",l),y.setAttribute("data-ad-client",h),y.setAttribute("data-ad-slot",null!=d?d:""),y.setAttribute("data-ad-format",c),y.setAttribute("data-ad-test",f?"on":"off"),y.setAttribute("data-full-width-responsive","true"),(_=document.createElement("script")).innerHTML="(adsbygoogle = window.adsbygoogle || []).push({});",y.appendChild(_),document.body.insertAdjacentElement("beforeend",y),[2]})}).call(this)}},{key:"createAdBreakConfig",value:function createAdBreakConfig(e){var c=this.createBaseAdBreakConfig({placementId:e.placementId}),l=e.type;if(iV.has(iW,l))return this.createInterstitialAdBreakConfig(c,e);if(iV.has(iz,l))return this.createRewardAdBreakConfig(c,e);throw new Error("Ad type: ".concat(l," is not supported."))}},{key:"createBaseAdBreakConfig",value:function createBaseAdBreakConfig(e){return{name:e.placementId,beforeAd:function(){},adBreakDone:function(e){}}}},{key:"createInterstitialAdBreakConfig",value:function createInterstitialAdBreakConfig(e,c){var l=this;var h=c.resolve,d=c.reject;return _object_spread_props(_object_spread({},e),{type:this.interstitialType,adBreakDone:function(c){var f;null==(f=e.adBreakDone)||f.call(e,c),l.handleAdBreakDone({info:c,resolve:h,reject:d})}})}},{key:"createRewardAdBreakConfig",value:function createRewardAdBreakConfig(e,c){var l=c.resolve,h=c.reject;return _object_spread_props(_object_spread({},e),{type:this.rewardedType,beforeReward:function(e){e()},adDismissed:function(){h(new Error("USER_INPUT"))},adViewed:function(){l()}})}},{key:"handleAdBreakDone",value:function handleAdBreakDone(e){var c=e.info,l=e.resolve,h=e.reject;switch(c.breakStatus){case"viewed":l();break;case"frequencyCapped":h(new Error("AD_FREQUENCY_CAPPED"));break;default:h(new Error(c.breakStatus))}}},{key:"preloadAdPlacement",value:function preloadAdPlacement(){return _async_to_generator(function(){return _ts_generator(this,function(e){if(this.initStatus!==iH.LOADED)throw new Error("".concat(this.serviceName," Ads not initiated."));return[2,this.preloadAdConfig()]})}).call(this)}},{key:"getPreloadStatus",value:function getPreloadStatus(){return this.preloadStatus}},{key:"preloadAdConfig",value:function preloadAdConfig(){return _async_to_generator(function(){var e;return _ts_generator(this,function(c){if(e=this,this.preloadStatus!==iK.COMPLETED&&this.preloadStatus!==iK.IN_PROGRESS)return[2,(this.preloadStatus=iK.IN_PROGRESS,new Promise(function(c,l){var h=setTimeout(function(){e.preloadStatus===iK.IN_PROGRESS&&(e.preloadStatus=iK.FAILED,l(new Error("Failed to preload ad config in time.")))},5e3);e.adConfig({preloadAdBreaks:"on",onReady:function(){clearTimeout(h),e.preloadStatus=iK.COMPLETED,c()}})}))];return[2]})}).call(this)}}]),ld}();var iJ={},iQ=ed.Plugins.Analytics,iX=iQ.BaseAnalytics,i$=iQ.Events,iZ=[i$.BUTTON_CLICK,i$.SCREEN_OPEN],i0=ed.Utils.Array;var i2=function(e){function fd(e,c){var l;return _class_call_check(this,fd),u(l=_call_super(this,fd,[e,"FacebookAnalytics",_object_spread_props(_object_spread({},c),{color:"#0F52BA"})]),"prefix"),l.prefix=c.prefix,l}return _inherits(fd,e),_create_class(fd,[{key:"processEvent",value:function processEvent(e,c){if("logEvent"in GameSDK.extra&&!i0.has(iZ,e))try{var l=this.addPrefixToEventName(e);GameSDK.extra.logEvent(l,1,c)}catch(e){}}},{key:"addPrefixToEventName",value:function addPrefixToEventName(e){return"".concat(this.prefix,"_").concat(e)}}]),fd}(iX);var i1=ed.Plugins.Analytics,i3=i1.BaseAnalytics,i4=i1.Events,i5=[i4.SCREEN_OPEN,i4.ENGINE_READY],i6=ed.Utils.Array;var i7=function(e){function ps(e,c){return _class_call_check(this,ps),_call_super(this,ps,[e,"GoogleAnalytics",_object_spread_props(_object_spread({},c),{color:"#E35335"})])}return _inherits(ps,e),_create_class(ps,[{key:"processEvent",value:function processEvent(e,c){i6.has(i5,e)||(this.customEvent(e,c),gtag("event",e,c))}},{key:"customEvent",value:function customEvent(e,c){switch(e){case i4.AD_SHOW:case i4.AD_SHOW_FAILED:case i4.AD_SHOWING:case i4.USE_ITEM:case i4.EARN_ITEM:this.addLevelName(c);break}}},{key:"addLevelName",value:function addLevelName(e){if(!e||!(null!=game&&game.match))return;var c=game.match.getMatchState().customData.level;!c||c<0||(e.level_name=this.getLevelName(c))}}]),ps}(i3);var i8=ed.Dtos,i9=ed.Events,oe=ed.Configs,ot=oe.AppId,or=oe.Ads,oa=oe.Analytics,oi=oe.Debugger,ol=oe.Firebase,ou=oe.Notification,oh=oe.RemoteConfig,of=oe.PerformanceMonitor,oy=oe.AdaptivePerformance,o_=ed.Plugins.Ads.Types,ov=ed.Utils,op=ov.Device,og=ov.Object,om=ov.Json,oA=ov.String,ow=ov.Valid,ob=ov.Mark;var oD=function(l){function Ed(){_class_call_check(this,Ed);var c,l=arguments;return u(c=_call_super(this,Ed,_to_consumable_array(l)),"markName","Core Initialize"),u(c,"modulePlugins",[]),u(c,"processContextSession",function(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:return ob.putAttr(c.markName,"Step","Process Context Payload"),[4,c.context.detectContextSessionType()];case 1:return l.sent(),c.context.detectContextGameMode(),e=c.storage.getStorageData("context","sessionContextType")||"unknown",ob.putAttr(c.markName,"Context Mode",e),ob.stop(c.markName),[2]}})})()}),u(c,"addDevPlugins",function(){var e;var l=oi.ListPlayerDevIds,h=null==(e=null==GameSDK?void 0:GameSDK.player)?void 0:e.getID();!h||l.indexOf(h)<0||(c.addConsolePlugin(),c.addProfilerPlugin())}),u(c,"handleProtectGameInstance",function(){c.event.getEventEmitCount(e.MODULE_PLUGIN_READY)<c.modulePlugins.length||(window.game=Object.freeze(window.game))}),u(c,"initCanvasRecorderPlugin",function(){if(!c.canvasRecorder)return;var e=oi.CanvasRecorder,l=e.Options,h=l.Type,d=l.Quality,f=l.RecordFps,y=l.SyncFps;c.canvasRecorder.configure({type:h,quality:d,syncFps:y,recordFps:f}),c.canvasRecorder.setPanelExpanded(e.PanelExpanded);var _=document.querySelector("canvas");_&&c.canvasRecorder.setCanvas(_)}),u(c,"initMonitorErrorPlugin",function(){var e;if(!c.monitorError)return;var l=oi.MonitorError,h=oi.ListPlayerDevIds,d=l.ApiKey,f=l.Service,y=l.Feedback,_=l.TrackUser,v=l.FilterErrors,p=GameSDK.player.getID(),g=GameSDK.player.getName();p&&h.indexOf(p)>=0||(null==(e=window.disableSimpleTrackErrors)||e.call(window),c.monitorError.configure({apiKey:d,service:f,feedback:y,trackUser:_,releaseStage:"production",buildVersion:"".concat("1")}),c.monitorError.setUser({id:p,name:g}),c.monitorError.addFilterErrors(v),c.monitorError.initFeedbackTrackErrors(),c.updateMonitorErrorUserAndMetadata(),c.processErrorsQueue())}),u(c,"updateMonitorErrorUserAndMetadata",function(){c.event.catchUp(i9.PLAYER_INFO_LOADED,c.processWhenPlayerInfoLoaded)}),u(c,"processErrorsQueue",function(){if(c.monitorError&&window.__errorQueue){var e=true,l=false,h=void 0;try{for(var d,f=window.__errorQueue[Symbol.iterator]();!(e=(d=f.next()).done);e=true){var y=d.value;if(_instanceof(y,Error))c.monitorError.sendException(y);else{var _=y||{message:"",code:"Unknown",stack:"Unknown stack"},v=_.message,p=_.code,g=_.stack,m=new Error(v||p);m.stack=g,c.monitorError.sendException(m)}}}catch(e){l=true,h=e}finally{try{if(!e&&null!=f.return)f.return()}finally{if(l)throw h}}window.__errorQueue=null}}),u(c,"processWhenPlayerInfoLoaded",function(){if(!c.monitorError)return;var e=c.player.getPlayer(),l=e.playerId,h=e.name;c.monitorError.setUser({id:l,name:h}),c.monitorError.addMetadata({isFirstSession:c.player.isFirstSession()})}),u(c,"handleSaveRemoteConfig",function(e){try{var l=_define_property({},e.type,e);c.player.setPlayerDataByName("remoteConfig",l)}catch(e){}}),u(c,"handleUpdateGameCoreConfig",function(l){try{var h=l.id,d=l.type;if("GameCore"!==d)return;ed.Configs=og.merge(ed.Configs,l.config);var f=ed.Configs.Ads;c.ads.configure(f),c.event.emit(e.REMOTE_CONFIG_UPDATED,{id:h,type:d})}catch(e){}}),u(c,"handleStorageCurrentRemoteConfig",function(){var e=c.player.getPlayerDataByKey("remoteConfig");if(e){for(var l in e)if(og.hasOwn(e,l)){var h=e[l],d=om.clone(h),f=new i8.RemoteConfig.Data(d).toObject();c.remoteConfig.setRemoteConfig(f),c.remoteConfig.processUpdateConfig(f.id,f.type)}}}),u(c,"initAdaptivePerformancePlugin",function(){if(!c.adaptivePerformance)return;var e=om.clone(oy);c.adaptivePerformance.configure(e)}),u(c,"processAfterSyncProfile",function(){ou.Enabled&&c.updatePlayerProfileToNotificationService()}),c}return _inherits(Ed,l),_create_class(Ed,[{key:"getBuildVersion",value:function getBuildVersion(){return parseInt("".concat("1"))||0}},{key:"boot",value:function boot(){var e=this;var c=this;return _async_to_generator(function(){return _ts_generator(this,function(l){return(function(){return _get(_get_prototype_of(Ed.prototype),"boot",e)})().call(c),this.addPlugins(),this.initEventPlugin(),this.event.emit(i9.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),ob.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initClarityAnalytics(),this.initFirebaseAnalytics(),this.initYandexAnalytics(),this.initXiaomiAnalytics(),this.initFacebookAnalytics(),this.initTranssionH5Analytics(),ob.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),ob.putAttr(this.markName,"Step","Load Lazy Plugins"),ow.isDebugger()||this.event.on(i9.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addCanvasRecorderPlugin().then(this.initCanvasRecorderPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),ob.putAttr(this.markName,"Step","Load Dev Plugins"),this.event.catchUp(i9.GAME_SDK_READY,this.addDevPlugins),[2]})}).call(this)}},{key:"start",value:function start(){var e=this;var c=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Ed.prototype),"start",e)})().call(c),ob.putAttr(this.markName,"Step","Core Start"),this.event.emit(i9.CORE_STARTING),ob.putAttr(this.markName,"Step","Request Token"),[4,this.auth.requestToken()];case 1:return l.sent(),ob.putAttr(this.markName,"Step","Init States"),[4,this.initState()];case 2:if(l.sent(),ob.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),!("FacebookInstant"===GameSDK.getSDKName()&&op.isIOS()))return[3,3];return this.event.catchUp(i9.GAME_SDK_STARTED,this.processContextSession),[3,5];case 3:return[4,this.processContextSession()];case 4:l.sent(),l.label=5;case 5:return ob.putAttr(this.markName,"Step","Core Ready"),ob.putAttr(this.markName,"Success","true"),this.event.emit(i9.CORE_READY),[2]}})}).call(this)}},{key:"addPlugins",value:function addPlugins(){this.installPlugin("Storage",iC),this.installPlugin("Event",nn),this.installPlugin("Ads",e3),this.installPlugin("Auth",tb),this.installPlugin("Audio",tm),this.installPlugin("Match",sv),this.installPlugin("Player",sG),this.installPlugin("Profile",iD),this.installPlugin("Context",tG),this.installPlugin("Language",nv),this.installPlugin("Missions",sx),this.installPlugin("Analytics",to),this.installPlugin("Visibility",ix),this.installPlugin("Leaderboard",nO),this.installPlugin("DailyRewards",t4),this.installPlugin("FrameCapture",nr),this.installPlugin("RemoteConfig",nr),"Proxy"in window&&this.installPlugin("Firebase",nr)}},{key:"installPlugin",value:function installPlugin(e,c,l){var h=arguments.length>2&&void 0!==l?l:!1;var d=oA.toCamelCase(oA.capitalize(e));this.plugins.install(e,c,!0,d),"Storage"!==e&&(h?this.emitModulePluginReady(e):this.emitCorePluginReady(e))}},{key:"addMonitorPlugin",value:function addMonitorPlugin(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!oi.MonitorError.Enabled)return[2];return this.modulePlugins.push("MonitorError"),[4,ie(function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return na})];case 1:return[2,{default:e.sent().default}]}})})()},void 0,c.meta.url)];case 1:if("function"!=typeof(e=l.sent().default))return[2];return this.installPlugin("MonitorError",e,!0),[3,3];case 2:return l.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"addCanvasRecorderPlugin",value:function addCanvasRecorderPlugin(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!oi.CanvasRecorder.Enabled)return[2];return this.modulePlugins.push("CanvasRecorder"),[4,ie(function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return na})];case 1:return[2,{default:e.sent().default}]}})})()},void 0,c.meta.url)];case 1:if("function"!=typeof(e=l.sent().default))throw new Error("CanvasRecorderPlugin is not a function");return this.installPlugin("CanvasRecorder",e,!0),[3,3];case 2:return l.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"addAdaptivePerformancePlugin",value:function addAdaptivePerformancePlugin(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!oy.Enabled)return[2];return this.modulePlugins.push("AdaptivePerformance"),[4,ie(function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return na})];case 1:return[2,{default:e.sent().default}]}})})()},void 0,c.meta.url)];case 1:if("function"!=typeof(e=l.sent().default))return[2];return this.installPlugin("AdaptivePerformance",e,!0),[3,3];case 2:return l.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"addConsolePlugin",value:function addConsolePlugin(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!oi.Console.Enabled)return[2];return this.modulePlugins.push("Console"),[4,ie(function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return na})];case 1:return[2,{default:e.sent().default}]}})})()},void 0,c.meta.url)];case 1:if("function"!=typeof(e=l.sent().default))throw new Error("ConsolePlugin is not a function");return this.installPlugin("Console",e,!0),this.initConsolePlugin(),[3,3];case 2:return l.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"addProfilerPlugin",value:function addProfilerPlugin(){return _async_to_generator(function(){var e;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!oi.Profiler.Enabled)return[2];return this.modulePlugins.push("Profiler"),[4,ie(function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return na})];case 1:return[2,{default:e.sent().default}]}})})()},void 0,c.meta.url)];case 1:if("function"!=typeof(e=l.sent().default))throw new Error("ProfilerPlugin is not a function");return this.installPlugin("Profiler",e,!0),this.initProfilerPlugin(),[3,3];case 2:return l.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"emitCorePluginReady",value:function emitCorePluginReady(c){this.event.emit(e.CORE_PLUGIN_READY,{name:c})}},{key:"emitModulePluginReady",value:function emitModulePluginReady(c){this.event.emit(e.MODULE_PLUGIN_READY,{name:c})}},{key:"initEventPlugin",value:function initEventPlugin(){oi.EventLogging.Enabled&&this.event.enableLogEvent()}},{key:"initMatchPlugin",value:function initMatchPlugin(){this.match.setUseCPUProfile(!1)}},{key:"initAds",value:function initAds(){this.ads.configure(or),this.initGoogleAds(),this.initTranssionH5Ads(),this.initAdInstance(),or.Enabled&&this.analytics.initAdEvent({adService:"platform",state:"loaded"})}},{key:"initGoogleAds",value:function initGoogleAds(){return _async_to_generator(function(){var e,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!or.Enabled)return[2];if(!(e=or.AdServiceConfigs.AdSense).Enabled)return[2];return[4,(c=new iY(this)).initAsync({usePreload:e.UsePreload,dataAdHost:e.DataAdHost,dataAdClient:e.DataAdClient,dataAdChannel:e.DataAdChannel,dataAdBreakTest:e.DataAdBreakTest,dataAdFrequencyHint:e.DataAdFrequencyHint})];case 1:return l.sent(),window.GoogleAds=c,[3,3];case 2:return l.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"initTranssionH5Ads",value:function initTranssionH5Ads(){return _async_to_generator(function(){var e,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!or.Enabled)return[2];if(!(e=or.AdServiceConfigs.Savana).Enabled)return[2];return[4,(c=new iJ(this)).initAsync({usePreload:e.UsePreload,dataAdHost:e.DataAdHost,dataAdClient:e.DataAdClient,dataAdChannel:e.DataAdChannel,dataAdBreakTest:e.DataAdBreakTest,dataAdFrequencyHint:e.DataAdFrequencyHint})];case 1:return l.sent(),window.TranssionH5Ads=c,[3,3];case 2:return l.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"getAdInstanceByService",value:function getAdInstanceByService(e,c){var l=arguments.length>1&&void 0!==c?c:!1;var h=or.AdServiceConfigs,d=h.AdSense,f=h.Savana;switch(e){case"adsense":if(d.Enabled)return iG;break;case"applovin":break;case"savana":if(f.Enabled)return iJ;break;default:return l?iU:iR}return null}},{key:"initAdInstance",value:function initAdInstance(){var e=true,c=false,l=void 0;try{for(var h,d=or.InterstitialAdOptions[Symbol.iterator]();!(e=(h=d.next()).done);e=true){var f=h.value;var y=f.PlacementId,_=f.AdService,v=f.Platform,p=void 0===v?"ALL":v,g=this.getAdInstanceByService(_);g&&this.ads.setAdInstance(o_.INTERSTITIAL,y,g,p)}}catch(e){c=true,l=e}finally{try{if(!e&&null!=d.return)d.return()}finally{if(c)throw l}}var m=true,A=false,b=void 0;try{for(var D,k=or.RewardedVideoAdOptions[Symbol.iterator]();!(m=(D=k.next()).done);m=true){var E=D.value;var T=E.PlacementId,O=E.AdService,M=E.Platform,R=void 0===M?"ALL":M,F=this.getAdInstanceByService(O);F&&this.ads.setAdInstance(o_.REWARDED_VIDEO,T,F,R)}}catch(e){A=true,b=e}finally{try{if(!m&&null!=k.return)k.return()}finally{if(A)throw b}}var G=true,B=false,U=void 0;try{for(var V,W=or.RewardedInterstitialAdOptions[Symbol.iterator]();!(G=(V=W.next()).done);G=true){var q=V.value;var Y=q.PlacementId,$=q.AdService,Z=q.Platform,ee=void 0===Z?"ALL":Z,en=this.getAdInstanceByService($);en&&this.ads.setAdInstance(o_.REWARDED_INTERSTITIAL,Y,en,ee)}}catch(e){B=true,U=e}finally{try{if(!G&&null!=W.return)W.return()}finally{if(B)throw U}}var er=true,ea=false,es=void 0;try{for(var ei,eo=or.BannerDisplayAdOptions[Symbol.iterator]();!(er=(ei=eo.next()).done);er=true){var ec=ei.value;var eu=ec.PlacementId,eh=ec.AdService,ed=ec.Platform,ef=void 0===ed?"ALL":ed,ey=this.getAdInstanceByService(eh,!0);ey&&this.ads.setAdInstance(o_.BANNER,eu,ey,ef)}}catch(e){ea=true,es=e}finally{try{if(!er&&null!=eo.return)eo.return()}finally{if(ea)throw es}}}},{key:"initState",value:function initState(){return _async_to_generator(function(){var e;return _ts_generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),(e=new gi(this)).initContext(),[4,e.initPlayer()];case 1:return c.sent(),[3,3];case 2:return c.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"initConsolePlugin",value:function initConsolePlugin(){this.console&&this.console.configure()}},{key:"initProfilerPlugin",value:function initProfilerPlugin(){this.profiler&&this.profiler.configure()}},{key:"initRemoteConfig",value:function initRemoteConfig(){if(!oh.Enabled)return;var c=om.clone(oh);this.remoteConfig.configure(c),this.event.on(e.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(e.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.catchUp(e.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}},{key:"initFirebasePlugin",value:function initFirebasePlugin(){if(!ol.Enabled||!this.firebase)return;var e=om.clone(ol);this.firebase.configure(e),ob.setService(this.firebase.services.performance)}},{key:"initMarkCoreInitialize",value:function initMarkCoreInitialize(){of.CoreFlows&&(ob.measure(this.markName),ob.putAttr(this.markName,"Build","".concat("1")),ob.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),ob.putAttr(this.markName,"Platform",GameSDK.getPlatform()),ob.putAttr(this.markName,"Success","false"),ob.start(this.markName))}},{key:"processPlayerProfile",value:function processPlayerProfile(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.player.syncProfileToServer()];case 1:return e.sent(),this.processAfterSyncProfile(),[3,3];case 2:return e.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"updatePlayerProfileToNotificationService",value:function updatePlayerProfileToNotificationService(){return _async_to_generator(function(){var e,c,l;return _ts_generator(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),c=(e=this.player.getPlayer()).ASID,l=e.playerId,[4,function(e){return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:if(!ez.hasOwn(e,"playerId"))throw new Error("Missing playerId");return c=e.playerId,[4,J("players/".concat(c),e,{},eK,10)];case 1:return l.sent(),[2]}})})()}({appId:ot,ASID:c,playerId:l,name:e.name,photo:e.photo,locale:e.locale})];case 1:return h.sent(),[3,3];case 2:return h.sent(),[3,3];case 3:return[2]}})}).call(this)}},{key:"initGoogleAnalytics",value:function initGoogleAnalytics(){var e;var c=null!=(e=oa.GoogleAnalytics)?e:{},l=c.Enabled,h=c.ConsoleLog;l&&"function"==typeof i7&&_instanceof(i7.prototype,Object)&&this.analytics.add(new i7(this.game,{log:!!h}))}},{key:"initClarityAnalytics",value:function initClarityAnalytics(){var e;var c=null!=(e=oa.ClarityAnalytics)?e:{},l=c.Enabled,h=c.ConsoleLog;if(!l||"function"!=typeof iJ||!_instanceof(iJ.prototype,Object))return;var d=new iJ(this.game,{log:!!h}),f=this.player.getPlayer().playerId;d.setUser(f,GameSDK.extra.isGuest),this.analytics.add(d)}},{key:"initFirebaseAnalytics",value:function initFirebaseAnalytics(){var e,c=this;var l=null!=(e=oa.FirebaseAnalytics)?e:{},h=l.Enabled,d=l.ConsoleLog;if(!h||"function"!=typeof iJ||!_instanceof(iJ.prototype,Object))return;var f=new iJ(this.game,{log:!!d});this.analytics.add(f);var y="no_entry";GameSDK.getEntryPointAsync().then(function(e){y=e}).catch(function(e){}).finally(function(){var e=c.player.getPlayer(),l=e.playerId,h=e.locale,d=GameSDK.getEntryPointData()||{},_=d.fbig_ad_id,v=d.fbig_adset_id,p=d.fbig_campaign_id,g=d.fb_instant_game_adset_id,m=d.fb_instant_game_ad_id,A=d.fb_instant_game_campaign_id;f.setUser(l,{locale:h,ad_id:_||m,adset_id:v||g,campaign_id:p||A,traffic_source:y})})}},{key:"initYandexAnalytics",value:function initYandexAnalytics(){"Yandex"===GameSDK.getSDKName()&&this.analytics.add(new iJ(this.game))}},{key:"initXiaomiAnalytics",value:function initXiaomiAnalytics(){"Xiaomi"===GameSDK.getSDKName()&&this.analytics.add(new iJ(this.game))}},{key:"initFacebookAnalytics",value:function initFacebookAnalytics(){var e;var c=GameSDK.getSDKName(),l=null!=(e=oa.FacebookAnalytics)?e:{},h=l.Enabled,d=l.Prefix,f=l.ConsoleLog;h&&"FacebookInstant"===c&&"string"==typeof d&&this.analytics.add(new i2(this.game,{prefix:d,log:!!f}))}},{key:"initTranssionH5Analytics",value:function initTranssionH5Analytics(){"TranssionH5"===GameSDK.getSDKName()&&this.analytics.add(new iJ(this.game))}}]),Ed}(eY.Game);var oS=ed.Configs.GameEngine.ForceDesktopDPR,ok=ed.Utils.Device,oI=ed.Events,ya=function(){if(!window.__sdkInitiated)return void game.event.catchUp(oI.GAME_SDK_READY,ya);window.game.start(),window.__sdkLoadingCount<25&&(window.__sdkLoadingCount=25)},xd=function(e){var c=setInterval(function(){if(!window.__sdkInitiated)return;clearInterval(c),window.__sdkLoadingCount<10&&(window.__sdkLoadingCount=10),e.event.emit(oI.GAME_SDK_READY)},5)};!1!==oS&&ok.isDesktop()&&"number"==typeof oS&&oS>0&&(window.devicePixelRatio=oS),window.originalRequestAnimationFrame=window.requestAnimationFrame,window.isCustomRequestAnimationFrame=!0,window.requestAnimationFrame=function(e){return window.isCustomRequestAnimationFrame?(setTimeout(e,1e3/60),0):window.originalRequestAnimationFrame(e)},function(){_async_to_generator(function(){var e;return _ts_generator(this,function(c){switch(c.label){case 0:return e=new oD,window.game=e,window.__sdkLoadingCount<20&&(window.__sdkLoadingCount=20),window.__gameCoreStart=!0,[4,e.boot()];case 1:return c.sent(),e.event.catchUp(oI.REQUEST_CORE_START,ya),xd(e),[2]}})})()}()}}});