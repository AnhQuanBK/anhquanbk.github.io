function _instanceof(a,o){if(null!=o&&"undefined"!=typeof Symbol&&o[Symbol.hasInstance])return!!o[Symbol.hasInstance](a);return a instanceof o}function _ts_generator(a,o){var C,A,P,I={label:0,sent:function(){if(1&P[0])throw P[1];return P[1]},trys:[],ops:[]},B=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return B.next=verb(0),B.throw=verb(1),B.return=verb(2),"function"==typeof Symbol&&(B[Symbol.iterator]=function(){return this}),B;function verb(a){return function(o){return step([a,o])}}function step(R){if(C)throw new TypeError("Generator is already executing.");while(B&&(B=0,R[0]&&(I=0)),I)try{if(C=1,A&&(P=2&R[0]?A.return:R[0]?A.throw||((P=A.return)&&P.call(A),0):A.next)&&!(P=P.call(A,R[1])).done)return P;if(A=0,P)R=[2&R[0],P.value];switch(R[0]){case 0:case 1:P=R;break;case 4:return I.label++,{value:R[1],done:false};case 5:I.label++,A=R[1],R=[0];continue;case 7:R=I.ops.pop(),I.trys.pop();continue;default:if(!(P=(P=I.trys).length>0&&P[P.length-1])&&(6===R[0]||2===R[0])){I=0;continue}if(3===R[0]&&(!P||R[1]>P[0]&&R[1]<P[3])){I.label=R[1];break}if(6===R[0]&&I.label<P[1]){I.label=P[1],P=R;break}if(P&&I.label<P[2]){I.label=P[2],I.ops.push(R);break}if(P[2])I.ops.pop();I.trys.pop();continue}R=o.call(a,I)}catch(a){R=[6,a],A=0}finally{C=P=0}if(5&R[0])throw R[1];return{value:R[0]?R[1]:void 0,done:true}}}function _ts_values(a){var o="function"==typeof Symbol&&Symbol.iterator,C=o&&a[o],A=0;if(C)return C.call(a);if(a&&"number"==typeof a.length)return{next:function(){if(a&&A>=a.length)a=void 0;return{value:a&&a[A++],done:!a}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}System.register("chunks:///main.js",["./rollupPluginModLoBabelHelpers-41cf6f9b.js","cc","./BubbleOut-d5a26b13.js","./AnalyticsUtils-9a227e15.js","./GlowDot-a2a2ca3d.js","./InvalidCheck-eedc91c6.js","./cjs-loader-b56ba787.js"],function(){var a,o,C,A,P,I,B,R,E,L,O,N,F,D,M,x,z,q,U,H,W,V,K,Y,j,X,J,Z,Q,$,ee,et,en,ei,er,ea,eo,es,el,eu,ec,eh,ep,ed,ef,ey,ev,em,eg,eb,ek,ew,eS,eT,eC,eA,e_,eP,eI,eB,eR,eE,eL,eO,eN,eF,eD,eM,ex,ez,eG,eq,eU,eH,eW,eV,eK,eY,ej,eX,eJ,eZ,eQ,e$,e0,e1,e2,e3,e4,e5,e6,e7,e8,e9,te,tt,tn,ti,tr,ta,to,ts,tl,tu,tc,th,tp,td,tf,ty,tv,tm,tg,tb,tk,tw,tS,tT,tC,tA,t_,tP,tI,tB,tR,tE,tL,tO,tN,tF,tD,tM,tx,tz,tG,tq,tU,tH,tW,tV,tK,tY,tj,tX,tJ,tZ,tQ,t$,t0,t1,t2,t3,t4,t5,t6,t7,t8,t9,ne,nt,nn,ni,nr,na,no,ns,nl;return{setters:[function(U){a=U.f,o=U.c,C=U.a,A=U.b,P=U.n,I=U.l,B=U.g,R=U.i,E=U.h,L=U._,O=U.d,N=U.e,F=U.o,D=U.p,M=U.q,x=U.k,z=U.j,q=U.m},function(a){U=a.cclegacy,H=a.Vec2,W=a.Sprite,V=a.math,K=a.Color,Y=a.tween,j=a.EventTarget,X=a.Mat4,J=a.v2,Z=a.Quat,Q=a.v3,$=a._decorator,ee=a.Node,et=a.SpriteFrame,en=a.UITransform,ei=a.Vec3,er=a.Label,ea=a.UIOpacity,eo=a.Component,es=a.Animation,el=a.CCString,eu=a.CCInteger,ec=a.AudioSource,eh=a.director,ep=a.game,ed=a.EventHandler,ef=a.Button,ey=a.Input,ev=a.CCBoolean,em=a.Tween,eg=a.EventTouch,eb=a.Layout,ek=a.CCFloat,ew=a.Graphics,eS=a.Size,eT=a.DirectorEvent,eC=a.NodeEventType,eA=a.Director,e_=a.sys,eP=a.view,eI=a.repeat,eB=a.js,eR=a.misc,eE=a.MeshRenderData,eL=a.Enum,eO=a.lerp,eN=a.approx,eF=a.EPSILON,eD=a.RealCurve,eM=a.Gradient,ex=a.bits,ez=a.random,eG=a.randomRange,eq=a.randomRangeInt,eU=a.pseudoRandom,eH=a.toRadian,eW=a.CCClass,eV=a.ParticleSystem2D,eK=a.UIRenderer,eY=a.Prefab,ej=a.instantiate,eX=a.Widget,eJ=a.ScrollView,eZ=a.ccenum,eQ=a.Font,e$=a.Layers,e0=a.MotionStreak,e1=a.sp,e2=a.Mask,e3=a.easing,e4=a.Material,e5=a.assetManager,e6=a.Texture2D,e7=a.View,e8=a.find,e9=a.Canvas},function(a){te=a._,tt=a.c,tn=a.b,ti=a.a,tr=a.d,ta=a.e},function(a){to=a.R,ts=a.i,tl=a.G,tu=a.a,tc=a.C,th=a.f,tp=a.c,td=a.h,tf=a.A,ty=a.b,tv=a.j,tm=a.k,tg=a.l,tb=a.M,tk=a.m,tw=a.n,tS=a.o,tT=a.p,tC=a.q,tA=a.r,t_=a.S,tP=a.g,tI=a.s,tB=a.t,tR=a.u,tE=a.v,tL=a.w,tO=a.d,tN=a.T,tF=a.x,tD=a.y,tM=a.z,tx=a.B,tz=a.D,tG=a.E,tq=a.F,tU=a.H,tH=a.I,tW=a.P,tV=a.J,tK=a.K,tY=a.N},function(a){tj=a.C,tX=a.S,tJ=a.a,tZ=a.b,tQ=a.B,t$=a.R,t0=a.T,t1=a.c,t2=a.G,t3=a.I,t4=a.L,t5=a.d,t6=a.F,t7=a.e,t8=a.D,t9=a.f,ne=a.g,nt=a.h,nn=a.i},function(a){ni=a.e,nr=a.c,na=a.E,no=a.R,ns=a.S,nl=a.d},null],execute:function(){U._RF.push({},"010305153ROeK+NmH/Ont0b","PhaserCurve",void 0);var nu=function(){function n(a,C,A,P,I,B,R,E){var L=arguments.length>1&&void 0!==C?C:5,O=arguments.length>2&&void 0!==A?A:100,N=arguments.length>3&&void 0!==P?P:[],F=!(arguments.length>4&&void 0!==I)||I,D=!(arguments.length>5&&void 0!==B)||B,M=arguments.length>6&&void 0!==R?R:new H,x=arguments.length>7&&void 0!==E?E:new H;o(this,n),this.type=a,this.defaultDivisions=L,this.arcLengthDivisions=O,this.cacheArcLengths=N,this.needsUpdate=F,this.active=D,this._tmpVec2A=M,this._tmpVec2B=x}return a(n,[{key:"getLength",value:function(){var a=this.getLengths();return a[a.length-1]}},{key:"getLengths",value:function(a){if(void 0===a&&(a=this.arcLengthDivisions),this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var o,C=[],A=this.getPoint(0,this._tmpVec2A),P=0;C.push(0);for(var I=1;I<=a;I++)o=this.getPoint(I/a,this._tmpVec2B),C.push(P+=H.distance(o,A)),A.set(o);return this.cacheArcLengths=C,C}},{key:"getPointAt",value:function(a,o){var C=this.getUtoTmapping(a);return this.getPoint(C,o)}},{key:"getPoints",value:function(a,o,C){void 0===C&&(C=[]),a||(a=o?this.getLength()/o:this.defaultDivisions);for(var A=0;A<=a;A++)C.push(this.getPoint(A/a));return C}},{key:"getUtoTmapping",value:function(a,o,C){var A,P=this.getLengths(C),I=0,B=P.length;A=o?Math.min(o,P[B-1]):a*P[B-1];for(var R,E=0,L=B-1;E<=L;)if((R=P[I=Math.floor(E+(L-E)/2)]-A)<0)E=I+1;else{if(!(R>0)){L=I;break}L=I-1}if(P[I=L]===A)return I/(B-1);var O=P[I];return(I+(A-O)/(P[I+1]-O))/(B-1)}}]),n}();function ln(a,o,C,A,P){return function(a,o){var C=1-a;return C*C*C*o}(a,o)+function(a,o){var C=1-a;return 3*C*C*a*o}(a,C)+function(a,o){return 3*(1-a)*a*a*o}(a,A)+function(a,o){return a*a*a*o}(a,P)}U._RF.pop(),U._RF.push({},"2a9e91RwmVNPaeQswNyQ0BQ","CubicBezierInterpolation",void 0),U._RF.pop(),U._RF.push({},"9811dY1w+REyogEYY2Rl+O/","CubicBezierCurve",void 0);var nc=function(P){C(r,P);var I=A(r);function r(a,C,A,P){var B;return o(this,r),(B=I.call(this,"CubicBezierCurve")).p0=void 0,B.p1=void 0,B.p2=void 0,B.p3=void 0,Array.isArray(a)&&(P=new H(a[6],a[7]),A=new H(a[4],a[5]),C=new H(a[2],a[3]),a=new H(a[0],a[1])),B.p0=a,B.p1=C,B.p2=A,B.p3=P,B}return a(r,[{key:"getStartPoint",value:function(a){return void 0===a&&(a=new H),a.set(this.p0)}},{key:"getResolution",value:function(a){return a}},{key:"getPoint",value:function(a,o){void 0===o&&(o=new H);var C=this.p0,A=this.p1,P=this.p2,I=this.p3;return o.set(ln(a,C.x,A.x,P.x,I.x),ln(a,C.y,A.y,P.y,I.y))}}],[{key:"fromJSON",value:function(a){var o=a.points;return new r(new H(o[0],o[1]),new H(o[2],o[3]),new H(o[4],o[5]),new H(o[6],o[7]))}}]),r}(nu);U._RF.pop(),U._RF.push({},"28d94p/XslPhZ+9+FZZ6Xi6","MovePathTo",void 0);var nh=function(){function n(a,C,A,P){var I=arguments.length>2&&void 0!==A&&A,B=arguments.length>3&&void 0!==P?P:new H(a,C);o(this,n),this.active=I,this.p0=B}return a(n,[{key:"getPoint",value:function(a,o){return void 0===o&&(o=new H),o.set(this.p0)}},{key:"getPointAt",value:function(a,o){return this.getPoint(a,o)}},{key:"getResolution",value:function(){return 1}},{key:"getLength",value:function(){return 0}},{key:"toJSON",value:function(){return{type:"MovePathTo",points:[this.p0.x,this.p0.y]}}}]),n}();U._RF.pop(),U._RF.push({},"ec027Z8/BJCc7yMKkRJwJMZ","PhaserPath",void 0);var np=function(){function n(a,C,A,I,B,R,E,L,O){var N=arguments.length>0&&void 0!==a?a:0,F=arguments.length>1&&void 0!==C?C:0,D=arguments.length>2&&void 0!==A?A:"",M=arguments.length>3&&void 0!==I?I:[],x=arguments.length>4&&void 0!==B?B:[],z=arguments.length>5&&void 0!==R&&R,q=arguments.length>6&&void 0!==E?E:new H,U=arguments.length>7&&void 0!==L?L:new H,W=arguments.length>8&&void 0!==O?O:new H;o(this,n),this.x=N,this.y=F,this.name=D,this.curves=M,this.cacheLengths=x,this.autoClose=z,this.startPoint=q,this._tmpVec2A=U,this._tmpVec2B=W,"object"===P(N)?this.fromJSON(N):this.startPoint.set(N,F)}return a(n,[{key:"fromJSON",value:function(a){this.curves=[],this.cacheLengths=[],this.startPoint.set(a.x,a.y),this.autoClose=a.autoClose;for(var o=0;o<a.curves.length;o++){var C=a.curves[o];switch(C.type){case"LineCurve":break;case"EllipseCurve":break;case"SplineCurve":break;case"CubicBezierCurve":this.add(nc.fromJSON(C));break;case"QuadraticBezierCurve":}}return this}},{key:"moveTo",value:function(a,o){return _instanceof(a,H)?this.add(new nh(a.x,a.y)):this.add(new nh(a,o))}},{key:"add",value:function(a){return this.curves.push(a),this}},{key:"cubicBezierTo",value:function(a,o,C,A,P,I){var B,R,E,L=this.getEndPoint();return _instanceof(a,H)&&_instanceof(o,H)&&_instanceof(C,H)?(B=a,R=o,E=C):(B=new H(C,A),R=new H(P,I),E=new H(a,o)),this.add(new nc(L,B,R,E))}},{key:"getEndPoint",value:function(a){return void 0===a&&(a=new H),this.curves.length>0?this.curves[this.curves.length-1].getPoint(1,a):a.set(this.startPoint),a}},{key:"getCurveLengths",value:function(){if(this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],o=0,C=0;C<this.curves.length;C++)a.push(o+=this.curves[C].getLength());return this.cacheLengths=a,a}},{key:"getLength",value:function(){var a=this.getCurveLengths();return a[a.length-1]}},{key:"getPoint",value:function(a,o){void 0===o&&(o=new H);for(var C=a*this.getLength(),A=this.getCurveLengths(),P=0;P<A.length;){if(A[P]>=C){var I=A[P]-C,B=this.curves[P],R=B.getLength(),E=0===R?0:1-I/R;return B.getPointAt(E,o)}P++}return null}}]),n}();function hn(a){var o=a.target;return I(I(I(I(I(I(I(I({},function(a,o){var C=arguments.length>1&&void 0!==o?o:[];if(0===C.length)return{tintR:[],tintG:[],tintB:[],alpha:[]};function n(a){var o=parseInt(a=a.replace(/^#/,""),16);return{r:o>>24&255,g:o>>16&255,b:o>>8&255,a:255&o}}var A=a.getComponent(W);if(!A)throw new Error("The gameObject ".concat(a.name," doesn't have a Sprite component or UIOpacity component"));for(var P=A.color,B=P.r,R=P.g,E=P.b,L=P.a,O=[],N=[],F=[],D=[],M=0;M<C.length;M++){var x=C[M],z=L,q=B,U=R,H=E;if(x.color){var V=n(x.color);z=V.a,q=V.r,U=V.g,H=V.b}var K={curve:"linear",c2:0,c3:1,c4:1},Y={curve:"linear",c2:0,c3:1,c4:1},j={curve:"linear",c2:0,c3:1,c4:1},X={curve:"linear",c2:0,c3:1,c4:1};if(Array.isArray(x.curve)){C.length;var J=C[M+1],Z=L,Q=B,$=R,ee=E;if(J.color){var et=n(J.color);Z=et.a,Q=et.r,$=et.g,ee=et.b}var en=x.time||0,ei=J.time||1,er=q,ea=Q,eo=U,es=$,el=H,eu=ee,ec=z,eh=Z;K=yn(x.curve,0,en,ei,er,ea),Y=yn(x.curve,1,en,ei,eo,es),j=yn(x.curve,2,en,ei,el,eu),X=yn(x.curve,3,en,ei,ec,eh)}else Y=K=I(I(I({},K),x),{},{curve:void 0!==x.curve?x.curve:K.curve}),j=K,X=K;D.push(I(I({time:0,v:z},x),X)),O.push(I(I({time:0,v:q},x),K)),N.push(I(I({time:0,v:U},x),Y)),F.push(I(I({time:0,v:H},x),j))}return pn(D),{tintR:O,tintG:N,tintB:F,alpha:D}}(o,a.color||a.rgba)),function(a,o){for(var C=arguments.length>1&&void 0!==o?o:[],A=a.scale.x,P=a.scale.y,B=[],R=[],E=0;E<C.length;E++){var L=C[E],O={curve:"linear",c2:0,c3:1,c4:1},N={curve:"linear",c2:0,c3:1,c4:1};if(Array.isArray(L.curve)){C.length;var F=C[E+1],D=L.time||0,M=F.time||1,x=L.x||0,z=F.x||0,q=L.y||0,U=F.y||0;O=yn(L.curve,0,D,M,x,z),N=yn(L.curve,1,D,M,q,U)}else N=O=I(I(I({},O),L),{},{curve:void 0!==L.curve?L.curve:O.curve});B.push(I(I({time:0,v:void 0===L.x?A:L.x*A},L),O)),R.push(I(I({time:0,v:void 0===L.y?P:L.y*P},L),N))}return pn(B),pn(R),{scaleX:B,scaleY:R}}(o,a.scale)),function(a,o,C){for(var A=arguments.length>1&&void 0!==o?o:[],P=arguments.length>2?C:void 0,B=a.position.x,R=a.position.y,E=[],L=[],O=(null==P?void 0:P.translate)||"default",N=0;N<A.length;N++){var F=A[N],D={curve:"linear",c2:0,c3:1,c4:1},M={curve:"linear",c2:0,c3:1,c4:1};if(Array.isArray(F.curve)){A.length;var x=A[N+1],z=F.time||0,q=x.time||1,U=F.x||0,H=x.x||0,W=F.y||0,V=x.y||0;D=yn(F.curve,0,z,q,U,H),M=yn(F.curve,1,z,q,W,V)}else M=D=I(I(I({},D),F),{},{curve:void 0!==F.curve?F.curve:D.curve});switch(O){case"default":E.push(I(I({time:0,v:void 0===F.x?B:+F.x+B},F),D)),L.push(I(I({time:0,v:void 0===F.y?R:+F.y+R},F),M));break;case"correctPosition":E.push(I(I({time:0,v:void 0===F.x?B:F.x},F),D)),L.push(I(I({time:0,v:void 0===F.y?R:F.y},F),M))}}return pn(E),pn(L),{x:E,y:L}}(o,a.translate,a.mode)),function(a,o){for(var C=arguments.length>1&&void 0!==o?o:[],A=a.angle,P=[],B=0;B<C.length;B++){var R=C[B],E={curve:"linear",c2:0,c3:1,c4:1};if(Array.isArray(R.curve)){C.length;var L=C[B+1],O=R.time||0,N=L.time||1,F=R.angle||R.value||0,D=L.angle||L.value||0;E=yn(R.curve,0,O,N,F,D)}else E=I(I(I({},E),R),{},{curve:void 0!==R.curve?R.curve:E.curve});P.push(I(I({time:0,v:void 0===R.angle?void 0===R.value?A:R.value:R.angle},R),E))}return pn(P),{angle:P}}(o,a.rotate)),function(a,o){if(0===(arguments.length>1&&void 0!==o?o:[]).length)return{deform:[]};var C=[];return dn(C),{deform:C}}(o,a.deform)),function(a,o){return(arguments.length>1&&void 0!==o?o:[]).length,{shearX:[],shearY:[]}}(o,a.shear)),function(a,o){for(var C=arguments.length>1&&void 0!==o?o:[],A=[],P=0;P<C.length;P++){var B=C[P],R={curve:"linear",c2:0,c3:1,c4:1};if(Array.isArray(B.curve)){C.length;var E=C[P+1],L=B.time||0,O=E.time||1;R=yn(B.curve,0,L,O,0,1)}else R=I(I(I({},R),B),{},{curve:void 0!==B.curve?B.curve:R.curve});A.push(I(I({time:0,v:void 0===B.position?0:B.position},B),R))}return pn(A),{position:A}}(o,a.position)),function(a,o){var C=arguments.length>1&&void 0!==o?o:[],A=a.getComponent(W);if(A){if(!A.spriteFrame)throw new Error("The gameObject ".concat(a.name," doesn't have a spriteFrame"));for(var P=A.spriteFrame.name,B=Number(P.match(/\d+/))||1,R=[],E=0;E<C.length;E++){var L,O=C[E],N=Number(null==(L=O.name)?void 0:L.match(/\d+/))||B;R.push(I(I({time:0,v:N},O),{},{curve:"stepped",c2:0,c3:1,c4:1}))}return pn(R),{attachment:R}}return{attachment:[]}}(o,a.attachment))}function pn(a){for(var o=a.length-1;o>0;o--){var C=a[o],A=a[o-1];if(C.v!==A.v||"stepped"!==A.curve&&"linear"!==A.curve)break;a.pop()}return a}function dn(a){for(var o=a.length-1;o>0;o--){var C=a[o],A=a[o-1];if(!function(a,o){if(a.length!==o.length)return!1;for(var C=0;C<a.length;C++)if(a[C]!==o[C])return!1;return!0}(C.v,A.v)||"stepped"!==A.curve&&"linear"!==A.curve)break;a.pop()}return 1===a.length&&a.pop(),a}function yn(a,o,C,A,P,I){return{curve:(a[4*o+0]-C)/(A-C)||0,c2:(a[4*o+1]-P)/(I-P)||0,c3:(a[4*o+2]-C)/(A-C)||1,c4:(a[4*o+3]-P)/(I-P)||1}}function fn(a){return function(o){var C,A,P=o/1e3;if(P<a[0].time)return a[0].v;for(var I=0;I<a.length-1;I++)if(P>=a[I].time&&P<=a[I+1].time){C=a[I],A=a[I+1];break}if(C&&A){if("stepped"===C.curve)return C.v;var B=(P-C.time)/(A.time-C.time),R="linear"===C.curve?B:te(V.clamp01(C.curve),C.c2,V.clamp01(C.c3),C.c4)(B),E=A.v,L=C.v,O=E-L;return O<-180?O+=360:O>180&&(O-=360),L+O*R}return a[a.length-1].v}}function vn(a){return function(o){var C,A,P=o/1e3;if(P<a[0].time)return a[0].v;for(var I=0;I<a.length-1;I++)if(P>=a[I].time&&P<=a[I+1].time){C=a[I],A=a[I+1];break}if(C&&A){if("stepped"===C.curve)return C.v;var B=(P-C.time)/(A.time-C.time),R="linear"===C.curve?B:te(V.clamp01(C.curve),C.c2,V.clamp01(C.c3),C.c4)(B);return C.v+(A.v-C.v)*R}return a[a.length-1].v}}U._RF.pop(),U._RF.push({},"25a19IfGc5IbLM6GQIHVubT","ColorToRGBA",void 0),U._RF.pop(),U._RF.push({},"9b1afLlCwdNnp7qYhwHUUiA","GetColor",void 0),U._RF.pop(),U._RF.push({},"a6366Zs6XFE476j2MX+nCZP","IntegerToRGB",void 0),U._RF.pop(),U._RF.push({},"0576f/SZ2VKQL7EaXWAGt2r","phaserProp",void 0),U._RF.pop(),U._RF.push({},"0398c0vx5lEGrxGAMRawyGo","SpineAnimationGraphToTweenAnimationGraph",void 0),U._RF.pop(),U._RF.push({},"53094U2B2lIMaYV4G3Nn6kH","TweenKeyFrameAngleCurve",void 0),U._RF.pop(),U._RF.push({},"092fcs7fpRMYK40Y6lF9G1j","TweenKeyFrameColorCurve",void 0),U._RF.pop(),U._RF.push({},"d427b7PjL9Bw6BKm7GjI5Op","TweenKeyFrameCurve",void 0),U._RF.pop(),U._RF.push({},"a15d4DgbpNDcooa+/Q9gvQw","TweenKeysFrameCurve",void 0),U._RF.pop(),U._RF.push({},"08fd5LVGzpL3ojvUwwrB5xC","TweenUpdateBehaviours",void 0);var nd={tintR:[],tintG:[],tintB:[],alpha:[],scaleX:[],scaleY:[],x:[],y:[],angle:[],deform:[],shearX:[],shearY:[],position:[],attachment:[]},nf=function(){function n(a,C){o(this,n),this.gameObject=void 0,this.tweenAnimationGraph=void 0,this.minTime=-1,this.maxTime=-1,this.gameObject=a,this.tweenAnimationGraph=C||nd}return a(n,[{key:"start",value:function(){}},{key:"update",value:function(a){}},{key:"complete",value:function(){}},{key:"applyMinMaxTime",value:function(a){if(1===a.length)return this.minTime=0,void(this.maxTime=0);for(var o=0;o<a.length;o++){var C=a[o];(void 0===this.minTime||this.minTime>C.time)&&(this.minTime=C.time),(void 0===this.maxTime||this.maxTime<C.time)&&(this.maxTime=C.time)}}}]),n}();U._RF.pop(),U._RF.push({},"9fcf0Yyz+tFQaXXoUYW9EWA","TweenAlphaUpdateBehaviour",void 0),U._RF.pop(),U._RF.push({},"11728Q+Zg5Ifb0wsEs7KQFi","TweenAngleUpdateBehaviour",void 0);var ny=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curve=void 0,A.curve=fn(C.angle),A.applyMinMaxTime(C.angle),A}return a(r,[{key:"update",value:function(a){var o=this.curve(a);this.gameObject.angle=o}}]),r}(nf);U._RF.pop(),U._RF.push({},"89752pInaRIdLzFUPduDTHR","TweenAttachmentUpdateBehaviour",void 0);var nv=function(P){C(s,P);var I,R=A(s);function s(a,C){var A;return o(this,s),(A=R.call(this,a,C)).curve=void 0,A.curve=vn(C.attachment),A.applyMinMaxTime(C.attachment),A}return a(s,[{key:"update",value:(I=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(o=Math.ceil(this.curve(a)),!((C=this.gameObject.getComponent(W))&&C.spriteFrame))return[3,2];return A=C.spriteFrame.name.split("-")[0],[4,to.loadSpriteFrameAsync("".concat(A,"'-'").concat(o))];case 1:C.spriteFrame=P.sent(),P.label=2;case 2:return[2]}})}),function(a){return I.apply(this,arguments)})}]),s}(nf);U._RF.pop(),U._RF.push({},"a5847ulNdZOAYJLUQn/qAnN","TweenDeformUpdateBehaviour",void 0);var nm=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curve=void 0,A.curve=function(a,o){return function(o){var C,A,P=o/1e3;if(P<a[0].time)return a[0].v;for(var I=0;I<a.length-1;I++)if(P>=a[I].time&&P<=a[I+1].time){C=a[I],A=a[I+1];break}if(C&&A){if("stepped"===C.curve)return C.v;for(var B=(P-C.time)/(A.time-C.time),R="linear"===C.curve?B:te(V.clamp01(C.curve),C.c2,V.clamp01(C.c3),C.c4)(B),E=[],L=0;L<C.v.length;L++){var O=C.v[L]+(A.v[L]-C.v[L])*R;E.push(O)}return E}return a[a.length-1].v}}(C.deform),A.applyMinMaxTime(C.deform),A}return a(r,[{key:"update",value:function(a){throw new Error("Method not implemented.")}}]),r}(nf);U._RF.pop(),U._RF.push({},"1b1bcEaZl1FYbxhwX6O4w6i","TweenEventUpdateBehaviour",void 0);var ng=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a.gameObject)).lastT=void 0,A.eventKeyFrames=void 0,A.currentIndex=0,A.animation=void 0,A.eventKeyFrames=C,A.animation=a,A.applyMinMaxTimeEvent(C),A}return a(r,[{key:"start",value:function(){this.lastT=void 0,this.currentIndex=0}},{key:"update",value:function(a){void 0===this.lastT&&(this.lastT=a,a+=1e-8);for(var o=this.currentIndex;o<this.eventKeyFrames.length;o++){var C=this.eventKeyFrames[o],A=1e3*C.time;this.lastT<=A&&a>A&&(this.animation.events.emit(C.eventName),this.animation.parent&&this.animation.parent.emitEvent(C.eventName),this.currentIndex=o+1)}this.lastT=a}},{key:"complete",value:function(){if(this.currentIndex<this.eventKeyFrames.length)for(var a=this.currentIndex;a<this.eventKeyFrames.length;a++){var o=this.eventKeyFrames[a];this.animation.events.emit(o.eventName),this.animation.parent&&this.animation.parent.emitEvent(o.eventName),this.currentIndex=a+1}}},{key:"applyMinMaxTimeEvent",value:function(a){for(var o=0;o<a.length;o++){var C=a[o];(void 0===this.minTime||this.minTime>C.time)&&(this.minTime=C.time),(void 0===this.maxTime||this.maxTime<C.time)&&(this.maxTime=C.time)}}}]),r}(nf);U._RF.pop(),U._RF.push({},"fbcf1wPLFFJxqEh1AJoc6qv","TweenPathPositionUpdateBehaviour",void 0);var nb=function(P){C(r,P);var I=A(r);function r(a,C,A){var P;return o(this,r),(P=I.call(this,a,C)).curve=void 0,P.path=void 0,P.path=A,P.curve=vn(C.position),P.applyMinMaxTime(C.position),P}return a(r,[{key:"update",value:function(a){var o=this.curve(a),C=this.path.getPoint(o);if(!C)throw new Error("Path position is out of bounds");var A=this.gameObject.getPosition();this.gameObject.setPosition(C.x,C.y,A.z)}}]),r}(nf);U._RF.pop(),U._RF.push({},"824ffcp/UFFcZsduH+j7eZU","TweenScaleXUpdateBehaviour",void 0);var nk=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curve=void 0,A.curve=vn(C.scaleX),A.applyMinMaxTime(C.scaleX),A}return a(r,[{key:"update",value:function(a){var o=this.curve(a),C=this.gameObject.getScale(),A=C.y,P=C.z;this.gameObject.setScale(o,A,P)}}]),r}(nf);U._RF.pop(),U._RF.push({},"b4fa9Kap/lMYJON3ruXonwR","TweenScaleYUpdateBehaviour",void 0);var nw=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curve=void 0,A.curve=vn(C.scaleY),A.applyMinMaxTime(C.scaleY),A}return a(r,[{key:"update",value:function(a){var o=this.curve(a),C=this.gameObject.getScale(),A=C.x,P=C.z;this.gameObject.setScale(A,o,P)}}]),r}(nf);U._RF.pop(),U._RF.push({},"e83882waAJDD7ZHpnczn1YY","TweenShearXUpdateBehaviour",void 0);var nS=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curve=void 0,A.curve=fn(C.shearX),A.applyMinMaxTime(C.shearX),A}return a(r,[{key:"update",value:function(a){throw new Error("Method only suupport > 3.8.6")}}]),r}(nf);U._RF.pop(),U._RF.push({},"c9507x8vbJFH7UiAteSFNoJ","TweenShearYUpdateBehaviour",void 0);var nT=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curve=void 0,A.curve=fn(C.shearY),A.applyMinMaxTime(C.shearY),A}return a(r,[{key:"update",value:function(a){throw new Error("Method only suupport > 3.8.6")}}]),r}(nf);U._RF.pop(),U._RF.push({},"a53c7LUHehE2Zup7Z8a2lay","TweenTintUpdateBehaviour",void 0);var nC=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curveR=void 0,A.curveG=void 0,A.curveB=void 0,A.curveA=void 0,A.curveR=vn(C.tintR),A.curveG=vn(C.tintG),A.curveB=vn(C.tintB),A.curveA=vn(C.alpha),A.applyMinMaxTime(C.tintR),A.applyMinMaxTime(C.tintG),A.applyMinMaxTime(C.tintB),A.applyMinMaxTime(C.alpha),A}return a(r,[{key:"update",value:function(a){var o=this.gameObject.getComponent(W);if(o){var C=this.curveR(a),A=this.curveG(a),P=this.curveB(a),I=this.curveA(a);o.color=new K(C,A,P,I)}}}]),r}(nf);U._RF.pop(),U._RF.push({},"400bbsnYHlGY6tIioy3C6Sn","TweenTranslateXUpdateBehaviour",void 0);var nA=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curve=void 0,A.curve=vn(C.x),A.applyMinMaxTime(C.x),A}return a(r,[{key:"update",value:function(a){var o=this.curve(a),C=this.gameObject.getPosition();C.x=o,this.gameObject.setPosition(C)}}]),r}(nf);U._RF.pop(),U._RF.push({},"b1535fTDPRKN7lUJ3zzDqkx","TweenTranslateYUpdateBehaviour",void 0);var n_=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a,C)).curve=void 0,A.curve=vn(C.y),A.applyMinMaxTime(C.y),A}return a(r,[{key:"update",value:function(a){var o=this.curve(a),C=this.gameObject.getPosition();C.y=o,this.gameObject.setPosition(C)}}]),r}(nf);U._RF.pop(),U._RF.push({},"d1906EFVrlMIJNsk5yn5R0w","UISpineGameObjectAnimation",void 0);var nP=function(){function n(a){o(this,n),this.events=new j,this.parent=void 0,this.gameObject=void 0,this.spineGraph=void 0,this.tweenGraph=void 0,this.updateBehaviours=[],this.tween=void 0,this.completeTweenCallback=void 0,this.duration=0,this.timeScale=1,this.delay=0;var C=a.target;this.gameObject=C,this.spineGraph=a,this.tweenGraph=hn(a),this.addBehaviours(),this.setDelay(this.spineGraph.delay)}return a(n,[{key:"isPlaying",get:function(){return!!this.tween}},{key:"addBehaviours",value:function(){var a=this.gameObject,o=this.tweenGraph;this.tweenGraph.angle.length>=1&&this.updateBehaviours.push(new ny(a,o)),this.tweenGraph.scaleX.length>=1&&this.updateBehaviours.push(new nk(a,o)),this.tweenGraph.scaleY.length>=1&&this.updateBehaviours.push(new nw(a,o)),(this.tweenGraph.tintR.length>=1||this.tweenGraph.tintG.length>=1||this.tweenGraph.tintB.length>=1||this.tweenGraph.alpha.length>=1)&&this.updateBehaviours.push(new nC(a,o)),this.tweenGraph.x.length>=1&&this.updateBehaviours.push(new nA(a,o)),this.tweenGraph.y.length>=1&&this.updateBehaviours.push(new n_(a,o)),this.tweenGraph.deform.length>=1&&this.updateBehaviours.push(new nm(a,o)),this.spineGraph.event&&this.spineGraph.event.length>=1&&this.updateBehaviours.push(new ng(this,this.spineGraph.event)),this.tweenGraph.shearX.length>=1&&this.updateBehaviours.push(new nS(a,o)),this.tweenGraph.shearY.length>=1&&this.updateBehaviours.push(new nT(a,o)),this.tweenGraph.position.length>=1&&this.spineGraph.path&&this.updateBehaviours.push(new nb(a,o,this.spineGraph.path)),this.tweenGraph.attachment.length>=1&&this.updateBehaviours.push(new nv(a,o)),this.duration=1e3*Math.max.apply(Math,R(this.updateBehaviours.map(function(a){return a.maxTime})))}},{key:"start",value:function(){var a=this;return new Promise(function(o){a.stop();var C=a.delay||0;a.events.emit("start");for(var A=0;A<a.updateBehaviours.length;A++)a.updateBehaviours[A].start(),a.updateBehaviours[A].update(-C);var P=!1;a.completeTweenCallback=function(){a.events.emit("complete"),a.tween=void 0;for(var C=0;C<a.updateBehaviours.length;C++)a.updateBehaviours[C].complete();o()};var I=Y({temp:0}).to((a.duration+C)/1e3,{temp:1},{progress:function(o,A,I,B){var R,E,L=B*(a.duration+C)-C;!P&&L>=0&&(a.events.emit("startDelay"),a.parent&&a.parent.emitEvent("startDelay"),P=!0);for(var O=0;O<a.updateBehaviours.length;O++)a.updateBehaviours[O].update(L);return null==(R=(E=a.spineGraph).onUpdate)||R.call(E,L),I},onComplete:function(){var o;null==(o=a.completeTweenCallback)||o.call(a)}});void 0!==a.spineGraph.loop&&I.repeat(a.spineGraph.loop),I.start(),a.timeScale,a.tween=I})}},{key:"stop",value:function(){var a;this.tween&&(this.events.emit("stop"),this.tween.stop(),null==(a=this.completeTweenCallback)||a.call(this),this.tween=void 0)}},{key:"seek",value:function(a){for(var o=this.updateBehaviours.filter(function(a){return!_instanceof(a,ng)}),C=0;C<o.length;C++)this.updateBehaviours[C].update(a)}},{key:"setTimeScale",value:function(a){var o=arguments.length>0&&void 0!==a?a:1;this.timeScale=o,this.timeScale}},{key:"setDelay",value:function(a){this.delay=a||0}}]),n}();U._RF.pop(),U._RF.push({},"cad10Nll/dDm7i5oHf55k+4","UISpineAnimation",void 0);var nI=function(){function n(a){o(this,n),this.events=new j,this.parent=void 0,this.children=[],this.timeScale=1,this.loop=0,this.tweenLoopAnimation=void 0,this.completeTweenCallback=void 0,this.createAnimation(a)}return a(n,[{key:"duration",get:function(){return Math.max.apply(Math,R(this.children.map(function(a){return a.duration})))}},{key:"isPlaying",get:function(){return this.children.some(function(a){return a.isPlaying})}},{key:"createAnimation",value:function(a){for(var o=0;o<a.length;o++){var C=a[o].target;Array.isArray(C)||(C=[C]);for(var A=0;A<C.length;A++){var P=a[o].delay||0;"function"==typeof P&&(P=P(C[A],"",0,A,C.length)),this.addAnimation(new nP(I(I({},a[o]),{},{target:C[A],delay:P})))}}}},{key:"addAnimationGraph",value:function(a){this.createAnimation(a)}},{key:"addAnimation",value:function(a){var o=this;this.children.push(a),this.children=this.children.filter(function(a,C){return o.children.indexOf(a)===C}),a.parent=this}},{key:"removeAnimation",value:function(a){this.children=this.children.filter(function(o){return o!==a}),a.parent=void 0}},{key:"start",value:function(){var a,o,C=this;return null==(a=this.tweenLoopAnimation)||a.stop(),null==(o=this.completeTweenCallback)||o.call(this),0===this.loop?this.startAnimation():new Promise(function(a){C.completeTweenCallback=a;var o={a:0};C.tweenLoopAnimation=Y(o).repeat(C.loop+1,Y(o).call(function(){C.startAnimation()}).to(C.duration/1e3,{a:1})).call(function(){var a;null==(a=C.completeTweenCallback)||a.call(C)}).start()})}},{key:"startAnimation",value:function(){var a=this;return 0===this.children.length?Promise.resolve():new Promise(function(o){a.events.emit("start"),Promise.all(a.children.map(function(o){return o.setTimeScale(a.timeScale),o.start()})).then(function(){a.events.emit("complete"),o()})})}},{key:"stop",value:function(){this.events.emit("stop");var a,o=E(this.children);try{for(o.s();!(a=o.n()).done;)a.value.stop()}catch(a){o.e(a)}finally{o.f()}}},{key:"emitEvent",value:function(a){for(var o,C,A=arguments.length,P=new Array(A>1?A-1:0),I=1;I<A;I++)P[I-1]=arguments[I];(o=this.events).emit.apply(o,[a].concat(P)),this.parent&&(C=this.parent).emitEvent.apply(C,[a].concat(P))}},{key:"seek",value:function(a){var o,C=E(this.children);try{for(C.s();!(o=C.n()).done;)o.value.seek(a)}catch(a){C.e(a)}finally{C.f()}}},{key:"seekPercent",value:function(a){var o=this.duration*a;this.seek(o)}},{key:"setTimeScale",value:function(a){var o=arguments.length>0&&void 0!==a?a:1;this.timeScale=o}},{key:"setDelay",value:function(a){var o,C=E(this.children);try{for(C.s();!(o=C.n()).done;)o.value.setDelay(a)}catch(a){C.e(a)}finally{C.f()}}},{key:"setLoop",value:function(a){this.loop=a}}]),n}();function On(a,o){return Math.atan2(o.y-a.y,o.x-a.x)}nI.WORLD_SCALE=1/2.88,U._RF.pop(),U._RF.push({},"6d698ZQXkFO35nrOWaKiSHw","UISpineMesh",void 0),U._RF.pop(),U._RF.push({},"3585am98V1O740oxg7OHiPr","UISpinePath",void 0);var nB,nR,nE,nL,nO,nN,nF,nD,nM,nx,nz=function(P){C(l,P);var B=A(l);function l(a){var C;return o(this,l),(C=B.call(this)).matrix=void 0,C.config=void 0,C.matrix=new X,C.resetFromJSON(a),C}return a(l,[{key:"setStartEndPoint",value:function(a,o){this.config.startPoint=a,this.config.endPoint=o,this.resetFromJSON(this.config)}},{key:"resetFromJSON",value:function(a){this.config=I({},a);var o=a.vertices||[],C=a.isClose||!1,A=a.flipX,P=void 0!==A&&A,B=a.flipY,R=void 0!==B&&B;if(!(o.length<6)){var E=o.map(function(a,o){return o%2==0?P?-a:a:R?-a:a}),L=E.length,O=J(E[2],E[3]),N=J(E[L-2-2],E[L-1-2]),F=a.startPoint?J(a.startPoint[0],a.startPoint[1]):O,D=a.endPoint?J(a.endPoint[0],a.endPoint[1]):N,M=H.distance(F,D),x=H.distance(O,N),z=(J(F.x-O.x,F.y-O.y),On(F,D)-On(O,N)),q=M/x;X.fromRTS(this.matrix,Z.fromEuler(new Z,0,0,V.toDegree(z)),Q(F.x,F.y,0),Q(q,q,1));for(var U=[],W=0;W<L;W+=2){var K=E[W]-O.x,Y=E[W+1]-O.y,j=Q();H.transformMat4(j,Q(K,Y,1),this.matrix),U.push(j.x,j.y)}this.moveTo(F.x,F.y);for(var $=4;$<L-6;$+=6)this.cubicBezierTo(U[$+4],U[$+5],U[$],U[$+1],U[$+2],U[$+3]);return C&&this.cubicBezierTo(F.x,F.y,U[L-2],U[L-1],U[0],U[1]),this}}},{key:"deform",value:function(a){var o=this.config.vertices.map(function(o,C){return o+(a[C]||0)});this.curves=[],this.cacheLengths=[],this.resetFromJSON(I(I({},this.config),{},{vertices:o}))}}]),l}(np);U._RF.pop(),U._RF.push({},"454bdd3U5VCDqUKkqD73RAy","MiniItem",void 0);var nG,nq,nU,nH,nW,nV,nK,nY,nj,nX=$.ccclass,nJ=$.property,nZ={position:[{time:.5,curve:.25,c3:.75},{time:.6667,position:.4663,curve:.131,c2:.11,c3:.982,c4:.73},{time:.7833,position:1}],color:[{color:"ffffff00",curve:.156,c2:.76,c3:.75},{time:.2333,color:"ffffffff",curve:"stepped"},{time:.7667,color:"ffffffff"}],rotate:[{angle:26.11,curve:0,c2:.6,c3:.682,c4:.83},{time:.4,angle:-8.57,curve:.25,c3:.75},{time:.6667}],scale:[{x:0,y:0,curve:.049,c2:.82,c3:.75},{time:.2333,x:1.497,y:1.497,curve:.241,c2:.02,c4:.86},{time:.5,x:.861,y:.861,curve:.25,c3:.75},{time:.65,x:1.261,y:1.261},{time:.7667,x:.552,y:.552}]};nB=nX("MiniItem"),nR=nJ(ee),nE=nJ(ee),nL=nJ(ee),nO=nJ(et),nB((nF=L((nN=function(P){C(u,P);var R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"icon",nF,N(a)),O(a,"amountText",nD,N(a)),O(a,"countText",nM,N(a)),O(a,"iconFrame",nx,N(a)),a.animIconPool=[],a.iconOriginScaleX=1,a.iconOriginScaleY=1,a.toLeft=!0,a}return a(u,[{key:"__preload",value:function(){tj.lazyValidateProperties(this)}},{key:"runIncreaseAnim",value:(R=B(function(a,o){var C,A,P,I,B,R;return _ts_generator(this,function(E){switch(E.label){case 0:return C=this,A=Number(this.amountText.getComponent(er).string),P=this.node.scale.x,I=this.node.scale.y,B=!0,R=Y(this.node).to(.1,{scale:new ei(1.1*P,I,1)}).to(.1,{scale:new ei(P,1.1*I,1)}).union().reverseTime().repeatForever(),[4,this.runMultipleIconsAnimation(a-A,o,function(){var a=C.amountText.getComponent(er);a.string="".concat(Number(a.string)+1),B&&(R.start(),B=!1)})];case 1:return E.sent(),[4,ts.waitTweenAsync(.3)];case 2:return[2,(E.sent(),R.stop(),new Promise(function(a){Y(C.icon).to(.1,{scale:new ei(C.iconOriginScaleX,C.iconOriginScaleY,1)}).call(function(){a()}).start()}))]}})}),function(a,o){return R.apply(this,arguments)})},{key:"runMultipleIconsAnimation",value:function(a,o,C){var A=this,P=arguments.length>0&&void 0!==a?a:1,B=arguments.length>1&&void 0!==o?o:0,R=arguments.length>2?C:void 0;if(P<1){for(var E=0;E<P;E++)null==R||R();return Promise.resolve()}var L=this.requestAnimIcons(P),O=this.node.getWorldPosition(),N=O.x,F=O.y,D=this.node.parent.getComponent(en).convertToNodeSpaceAR(new ei(N,F,0)),M=D.x,x=D.y,z=this.toLeft?-1:1,q={x:M+50*z,y:x},U={x:M+80*z,y:x},H=this.node.getWorldPosition(),W=H.x,V=H.y,K=this.node.parent.getComponent(en).convertToNodeSpaceAR(new ei(W,V,0)),Y=K.x,j=K.y;return new Promise(function(a){P>0?(A.countText.getComponent(er).string="x"+P,A.runCountTextAnimation(U,600,B)):A.countText.active=!1,P>L.length&&(P=L.length);for(var l=function(o){var C={x:q.x+o*z*5,y:q.y+5*o};L[o].setPosition(C.x,C.y,1),L[o].active=!0,L[o].getComponent(ea).opacity=0,L[o].setScale(A.iconOriginScaleX,A.iconOriginScaleY,1);var E=new nz({vertices:[-211.5,40.29,-186.35,97.94,-156.05,167.39,-78.09,171.9,-28.95,87.7,2.75,33.38],startPoint:[C.x,C.y],endPoint:[Y+10*z,j]}),O=new nI([I(I({},nZ),{},{target:L[o],delay:1e3*B+75*o,path:E})]);0===o&&O.events.on("startDelay",function(){}),o===P-1&&O.events.on("complete",function(){a()}),O.events.on("complete",function(){null==R||R(),L[o].active=!1,L[o].setScale(A.iconOriginScaleX,A.iconOriginScaleY,1)}),O.start()},o=P-1;o>=0;o--)l(o)})}},{key:"requestAnimIcons",value:function(a){var o=this.animIconPool;if(o.length<a)for(var C=o.length;C<a;C++){var A=new ee;A.addComponent(W).spriteFrame=this.iconFrame,A.active=!1,A.addComponent(ea),o.push(A),this.node.parent.addChild(A)}return o}},{key:"runCountTextAnimation",value:function(a,o,C){var A=this,P=this.countText.scale.clone(),I=this.countText.getComponent(ea),B=Y(I).to(o/1e3,{opacity:0},{easing:"backOut"}),R=Y(this.countText).to(o/1e3,{position:new ei(a.x,a.y+40,0)},{easing:"backOut"}).call(function(){A.countText.setScale(P),A.countText.active=!1});Y(I).delay(C).to(.4,{opacity:1},{easing:"backOut"}).start(),Y(this.countText).delay(C).call(function(){A.countText.active=!0,A.countText.setPosition(a.x,a.y)}).to(.4,{scale:new ei(1.5*P.x,1.5*P.y,P.z)},{easing:"backOut"}).delay(.4).call(function(){B.start(),R.start()}).start()}}]),u}(eo)).prototype,"icon",[nR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nD=L(nN.prototype,"amountText",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nM=L(nN.prototype,"countText",[nL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=L(nN.prototype,"iconFrame",[nO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nN)),U._RF.pop(),U._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);var nQ,n$,n0,n1,n2,n3=$.ccclass,n4=$.property;nG=n3("BubbleAnimation"),nq=n4(es),nU=tj.required,nH=n4(el),nW=n4(eu),nG((nK=L((nV=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"animation",nK,N(a)),O(a,"clipName",nY,N(a)),O(a,"repeat",nj,N(a)),a.currentRepeat=-1,a}return a(r,[{key:"__preload",value:function(){this.animation=this.getComponent(es),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"play",value:function(){var a=this;this.animation&&this.animation.clips.find(function(o){return(null==o?void 0:o.name)===a.clipName})&&(this.currentRepeat=-1,this.animation.play(this.clipName))}},{key:"onBubbleAnimationLoop",value:function(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}]),r}(eo)).prototype,"animation",[nq,nU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nY=L(nV.prototype,"clipName",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),nj=L(nV.prototype,"repeat",[nW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -1}}),nV)),U._RF.pop(),U._RF.push({},"46d08zYzORB84VFdKEFYGgv","FadeWithMaskAnimation",void 0);var n5=$.ccclass,n6=$.property,n7=(nQ=n5("FadeWithMaskAnimation"),n$=n6([ea]),n0=tj.required(ni(ea)),nQ((n2=L((n1=function(P){C(y,P);var I,R,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"fadeUIOpacity",n2,N(a)),a}return a(y,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,y)}},{key:"prepareFadeIn",value:function(a){var o,C=E(this.fadeUIOpacity);try{for(C.s();!(o=C.n()).done;)o.value.opacity=a}catch(a){C.e(a)}finally{C.f()}}},{key:"fadeInAsync",value:(F=B(function(a){var o,C,A,P,I,B,R,L,O,N,F,D,M,x;return _ts_generator(this,function(z){switch(z.label){case 0:A=void 0===(C=a.from)?0:C,I=void 0===(P=a.to)?255:P,R=void 0===(B=a.duration)?1:B,O=void 0===(L=a.delay)?0:L,F=void 0===(N=a.easingFunc)?"linear":N,D=[],M=E(this.fadeUIOpacity);try{for(M.s();!(o=M.n()).done;)x=o.value,D.push(this.fadeInElement({uiOpacity:x,from:A,to:I,duration:R,delay:O,easingFunc:F}))}catch(a){M.e(a)}finally{M.f()}return[4,Promise.all(D)];case 1:return z.sent(),[2]}})}),function(a){return F.apply(this,arguments)})},{key:"fadeInElement",value:(L=B(function(a){var o,C,A,P,I,B,R,E,L,O,N,F;return _ts_generator(this,function(D){switch(D.label){case 0:return o=a.uiOpacity,A=void 0===(C=a.from)?0:C,I=void 0===(P=a.to)?255:P,R=void 0===(B=a.duration)?1:B,L=void 0===(E=a.delay)?0:E,N=void 0===(O=a.easingFunc)?"linear":O,o.opacity=A,F=Y(o).delay(L).to(R,{opacity:I},{easing:N}),[4,ts.runTweenAsync(F)];case 1:return D.sent(),[2]}})}),function(a){return L.apply(this,arguments)})},{key:"fadeOutAsync",value:(R=B(function(a){var o,C,A,P,I,B,R,L,O,N,F,D,M,x;return _ts_generator(this,function(z){switch(z.label){case 0:A=void 0===(C=a.from)?255:C,I=void 0===(P=a.to)?0:P,R=void 0===(B=a.duration)?1:B,O=void 0===(L=a.delay)?0:L,F=void 0===(N=a.easingFunc)?"linear":N,D=[],M=E(this.fadeUIOpacity);try{for(M.s();!(o=M.n()).done;)x=o.value,D.push(this.fadeOutElement({uiOpacity:x,from:A,to:I,duration:R,delay:O,easingFunc:F}))}catch(a){M.e(a)}finally{M.f()}return[4,Promise.all(D)];case 1:return z.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"fadeOutElement",value:(I=B(function(a){var o,C,A,P,I,B,R,E,L,O,N,F;return _ts_generator(this,function(D){switch(D.label){case 0:return o=a.uiOpacity,A=void 0===(C=a.from)?255:C,I=void 0===(P=a.to)?0:P,R=void 0===(B=a.duration)?1:B,L=void 0===(E=a.delay)?0:E,N=void 0===(O=a.easingFunc)?"linear":O,o.opacity=A,F=Y(o).delay(L).to(R,{opacity:I},{easing:N}),[4,ts.runTweenAsync(F)];case 1:return D.sent(),[2]}})}),function(a){return I.apply(this,arguments)})}]),y}(eo)).prototype,"fadeUIOpacity",[n$,n0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n1))||n1);U._RF.pop(),U._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var n8,n9,ie=function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a)).audioSource=void 0,A.audioSource=C,A}return a(r,[{key:"play",value:function(a){if(a){var o=a.volume,C=a.loop;this.audioSource.volume=void 0===o?1:o,this.audioSource.loop=void 0!==C&&C}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===ec.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(a){this.audioSource.volume=a}},{key:"getVolume",value:function(){return this.audioSource.volume}},{key:"getAudioSource",value:function(){return this.audioSource}}]),r}(GameCore.Plugins.Audio.BaseAudioPlayer);U._RF.pop(),U._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var it,ii,ir,ia,io,is,il=GameCore,iu=il.Plugins.Audio.BaseChannelManager,ic=il.Utils,ih=ic.Array,id=(n8=ic.Decorator.tryCatch(),L((n9=function(P){C(s,P);var I,R=A(s);function s(a,C){var A;return o(this,s),(A=R.call(this,C)).node=void 0,A.allowMultipleTracking={},A.handleLoadedAudio=function(a,o){var C=A.node.addComponent(ec);return C.clip=o,C.playOnAwake=!1,new ie(a,C)},A.node=a,A}return a(s,[{key:"playing",value:function(a){var o,C=null==(o=this.getAudioClip(a))?void 0:o.audioPlayer;return!!(C&&_instanceof(C,ie))&&C.getAudioSource().state===ec.AudioState.PLAYING}},{key:"onLoadAudio",value:(I=B(function(a,o){var C;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,to.loadAudioAsync(a)];case 1:return[2,(C=o.sent())&&this.node.isValid?this.handleLoadedAudio(a,C):null]}})}),function(a,o){return I.apply(this,arguments)})},{key:"playWithRealConfig",value:function(a,o){if(this.isCanPlay(o)){if(o){var C=o.volume,A=o.allowMultiple;if(o.volume=this.getVolume()*(void 0===C?1:C),void 0!==A&&A){var P=a.getAudioSource().clip;if(!P)return;return void this.requestDuplicateAudioPlayer(a.getKey(),P,o).play(o)}}a.play(o)}}},{key:"isCanPlay",value:function(a){var o=this;if(a){var C=a.checkList;if((void 0===C?[]:C).some(function(a){var C=o.getAudioClip(a);if(C){var A=C.audioPlayer;if(A&&_instanceof(A,ie))return A.getAudioSource().state===ec.AudioState.PLAYING}return!1}))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(a,o,C){var A=this.getDuplicateAudioFromPool(a);if(A){if(C){var P=A.key,I=C.volume;this.setAudioClip(P,{volume:void 0===I?1:I})}return A.audioPlayer}var B=this.allowMultipleTracking[a];if(!B)throw new Error("Allow multiple tracking is not found");var R="".concat(a,"_").concat(B.currentPostFix),E=this.handleLoadedAudio(R,o);return B.list.push({audioPlayer:E,key:R}),B.currentPostFix+=1,this.setAudioClip(R,{audioPlayer:E,volume:1}),E}},{key:"getDuplicateAudioFromPool",value:function(a){if(this.allowMultipleTracking[a]){var o=this.allowMultipleTracking[a].list,C=ih.search(o,function(a){return a.audioPlayer.getAudioSource().state!==ec.AudioState.PLAYING});if(C)return C}else this.allowMultipleTracking[a]={currentPostFix:1,list:[]};return null}}]),s}(iu)).prototype,"onLoadAudio",[n8],Object.getOwnPropertyDescriptor(n9.prototype,"onLoadAudio"),n9.prototype),n9);U._RF.pop(),U._RF.push({},"b172dwBSpVDEpXY7Xyi/cHN","MultiMusicManager",void 0);var iy,iv,im,ig,ib=$.ccclass,ik=$.property,iw=globalThis.game,iS=iw.audio,iT=iw.player;it=ib("MultiMusicManager"),ii=ik(el),ir=ik(el),it((io=L((ia=function(P){C(l,P);var B=A(l);function l(){var a;o(this,l);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=B.call.apply(B,[this].concat(A)),O(a,"previousChannelId",io,N(a)),O(a,"currentChannelId",is,N(a)),a.previousChannel=void 0,a.currentChannel=void 0,a.channels=new Map,a.fadeQueue={},a.volume=1,a}return a(l,[{key:"__preload",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){eh.addPersistRootNode(this.node)}},{key:"play",value:function(a,o){var C=a,A=I({volume:this.volume},o||{});if(A.volume!==this.volume&&(A.volume*=this.volume),void 0===C){if(!this.currentChannel)return;C=this.currentChannel.getId()}var P=this.channels.get(C);if(!P){var B=new id(this.node,C);iS.addChannel(B),this.channels.set(C,B),P=B}if(P){if(P===this.currentChannel)return void P.resume(C);this.previousChannel=this.currentChannel,this.currentChannel&&this.fadePlay(this.currentChannel,this.currentChannel.getVolume(),0,1),this.currentChannel=P,this.currentChannel.stopAll(),this.currentChannel.play(C,{volume:1,loop:!0}),this.fadePlay(this.currentChannel,0,A.volume,1)}}},{key:"fadePlay",value:function(a,o,C,A){var P=a.getId(),I=this.fadeQueue[P];I&&(I.stop(),delete this.fadeQueue[P]);var B=Y({volume:o}).to(A,{volume:C},{onUpdate:function(o,C){var A;a.setVolume(null!=(A=null==o?void 0:o.volume)?A:0)}}).call(function(){a.setVolume(C)});B.start(),this.fadeQueue[P]=B}},{key:"isMusicEnable",value:function(){return!!iT.getPlayerSetting("music")}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(a){this.volume=a}},{key:"pause",value:function(){if(this.currentChannel){var a=this.currentChannel.getId();this.currentChannel.pause(a)}if(this.previousChannel){var o=this.previousChannel.getId();this.previousChannel.pause(o)}}},{key:"resume",value:function(){if(this.currentChannel){var a=this.currentChannel.getId();this.currentChannel.resume(a)}}},{key:"stop",value:function(){if(this.currentChannel){var a=this.currentChannel.getId();this.currentChannel.stop(a)}}},{key:"mute",value:function(a){this.currentChannel&&(a?this.currentChannel.muteAll():this.currentChannel.unmuteAll())}}]),l}(eo)).prototype,"previousChannelId",[ii],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"previous_music"}}),is=L(ia.prototype,"currentChannelId",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"current_music"}}),ia)),U._RF.pop(),U._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var iC,iA,i_,iP,iI=$.ccclass,iB=$.property,iR=globalThis.game,iE=iR.audio,iL=iR.player;iy=iI("Music"),iv=iB(el),iy((ig=L((im=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"channelId",ig,N(a)),a.channel=null,a}return a(r,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new id(this.node,this.channelId),iE.addChannel(this.channel)}},{key:"makePersistent",value:function(){eh.addPersistRootNode(this.node)}},{key:"playing",value:function(a){var o,C;return null!=(o=null==(C=this.channel)?void 0:C.playing(a))&&o}},{key:"play",value:function(a,o){if(this.isMusicEnable()){var C=null!=o?o:{};C.loop||(C.loop=!0),iE.play(a,C,this.channelId)}}},{key:"isMusicEnable",value:function(){return!!iL.getPlayerSetting("music")}},{key:"setVolume",value:function(a){iE.setVolume(a,this.channelId)}},{key:"getVolume",value:function(){return iE.getVolume(this.channelId)}},{key:"pause",value:function(a){iE.pause(a,this.channelId)}},{key:"resume",value:function(a){this.isMusicEnable()&&iE.resume(a,this.channelId)}},{key:"stop",value:function(a){iE.stop(a,this.channelId)}},{key:"mute",value:function(a){a?iE.mute(this.channelId):iE.unmute(this.channelId)}}]),r}(eo)).prototype,"channelId",[iv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),im)),U._RF.pop(),U._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var iO,iN,iF,iD,iM,ix,iz=$.ccclass,iG=$.property,iq=globalThis.game,iU=iq.audio,iH=iq.player;iC=iz("Sound"),iA=iG(el),iC((iP=L((i_=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"channelId",iP,N(a)),a.channel=null,a}return a(r,[{key:"__preload",value:function(){this.channel=new id(this.node,this.channelId),iU.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){eh.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){eh.removePersistRootNode(this.node)}},{key:"play",value:function(a,o){this.isSoundEnable()&&iU.play(a,o,this.channelId)}},{key:"isSoundEnable",value:function(){return!!iH.getPlayerSetting("sound")}},{key:"setVolume",value:function(a){iU.setVolume(a,this.channelId)}},{key:"pause",value:function(a){iU.pause(a,this.channelId)}},{key:"resume",value:function(a){this.isSoundEnable()&&iU.resume(a,this.channelId)}},{key:"stop",value:function(a){iU.stop(a,this.channelId)}},{key:"stopAll",value:function(){iU.stopAll(this.channelId)}},{key:"mute",value:function(a){a?iU.mute(this.channelId):iU.unmute(this.channelId)}}]),r}(eo)).prototype,"channelId",[iA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),i_)),U._RF.pop(),U._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var iW=$.ccclass,iV=tu.Layout;iO=iW("Background"),iN=tj.required(),iF=tj.required(),iO((iM=L((iD=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"sprite",iM,N(a)),O(a,"blockLines",ix,N(a)),a.handleSpriteTypeWhenLayoutChanged=function(o){o===iV.Landscape?(a.setBackgroundType(W.Type.TILED),a.setActiveBlockLines(!0)):(a.setBackgroundType(W.Type.SIMPLE),a.setActiveBlockLines(!1))},a}return a(r,[{key:"__preload",value:function(){this.sprite=this.getComponent(W),this.blockLines=this.getComponentsInChildren(W),tj.validateRequiredProperties(this),this.listenGameEvents()}},{key:"start",value:function(){this.handleSpriteTypeWhenLayoutChanged(iV.Landscape)}},{key:"listenGameEvents",value:function(){ep.on(tl.LAYOUT_CHANGED,this.handleSpriteTypeWhenLayoutChanged,this)}},{key:"setBackgroundType",value:function(a){this.sprite&&(this.sprite.type=a)}},{key:"setActiveBlockLines",value:function(a){var o=this;this.blockLines&&this.blockLines.forEach(function(C){C.node!==o.node&&(C.node.active=a)})}}]),r}(eo)).prototype,"sprite",[iN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=L(iD.prototype,"blockLines",[iF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iD)),U._RF.pop(),U._RF.push({},"6ca4ed2aINDB4yr+3glu5e0","ButtonPlusEvents",void 0);var iK,iY,ij,iX,iJ,iZ,iQ,i$,i0,i1,i2,i3,i4,i5,i6,i7,i8,i9,re,rt,rn,ri,rr,ra,ro,rs,rl,ru,rc,rh="TRANSITION_DOWN",rp="TRANSITION_HOVER",rd="TRANSITION_RESET",rf="CLICK_START",ry="CLICK",rv="CLICK_END",rm="CLICK_CANCEL";U._RF.pop(),U._RF.push({},"56710cJAPhPd4KK3hV3y8m6","ButtonPlus",void 0);var rg,rb,rk,rw,rS,rT,rC,rA,r_,rP,rI,rB=$.ccclass,rR=$.property,rE=$.disallowMultiple,rL=$.menu,rO=(iK=rB("ButtonPlus"),iY=rL("GameCore/ButtonPlus/ButtonPlus"),ij=rR(ed),iX=rR(ed),iJ=rR(ed),iZ=rR({override:!0,visible:!1}),iQ=rR({override:!0,visible:!1}),i$=rR({override:!0,visible:!1}),i0=rR({override:!0,visible:!1}),i1=rR({override:!0,visible:!1}),i2=rR({override:!0,visible:!1}),i3=rR({override:!0,visible:!1}),i4=rR({override:!0,visible:!1}),i5=rR({override:!0,visible:!1}),i6=rR({override:!0,visible:!1}),i7=rR({override:!0,visible:!1}),i8=rR({visible:function(){return this.makeSound},type:tX}),i9=rR({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),re=rR({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),iK(rt=rE(rt=iY((ri=L((rn=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"onClickStartEvents",ri,N(a)),O(a,"onClickEndEvents",rr,N(a)),O(a,"onClickCancelEvents",ra,N(a)),O(a,"makeSound",ro,N(a)),O(a,"soundKey",rs,N(a)),O(a,"disableSpamClick",rl,N(a)),O(a,"disableSpamDelay",ru,N(a)),O(a,"performBoundsCheckOnClickCancel",rc,N(a)),a.currentClickBoundingBox=null,a.hasDown=!1,a.hasUp=!1,a.hasFinishClickCycle=!1,a.hasBeenDisabled=!1,a.onTouchStart=function(o){a.interactable&&(a.hasDown||(a.currentClickBoundingBox=tc.getBoundingBoxToWorld(a.node),a.handleDown(o)))},a.onTouchEnd=function(o){a.scheduleOnce(function(){a.interactable&&a.hasDown&&(a.hasUp||a.handleUp(o))},0)},a.onTouchCancel=function(o){if(a.interactable&&a.hasDown&&!a.hasUp){if(a.performBoundsCheckOnClickCancel){var C,A,P=o.getUILocation();if(null!=(C=null==(A=a.currentClickBoundingBox)?void 0:A.contains(P))&&C)return void a.handleUp(o)}a.hasUp=!0,a.hasFinishClickCycle=!0,a.handleResetButtonState(),a.emitClickCancelEvents(o),a.emitClickEndEvents(o)}},a.onMouseEnter=function(o){a.interactable&&(a.hasDown||(a.hasFinishClickCycle=!1,a.emitTransitionEvent(rp)))},a.onMouseLeave=function(o){a.interactable&&(a.hasDown||a.hasUp||a.hasFinishClickCycle||a.handleResetButtonState())},a.handleResetButtonState=function(){a.hasDown=!1,a.hasUp=!1,a.emitTransitionEvent(rd)},a}return a(r,[{key:"transition",get:function(){return ef.Transition.NONE},set:function(a){F(D(r.prototype),"transition",ef.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return M(D(r.prototype),"normalColor",this)},set:function(a){F(D(r.prototype),"normalColor",a,this,!0)}},{key:"pressedColor",get:function(){return M(D(r.prototype),"pressedColor",this)},set:function(a){F(D(r.prototype),"pressedColor",a,this,!0)}},{key:"hoverColor",get:function(){return M(D(r.prototype),"hoverColor",this)},set:function(a){F(D(r.prototype),"hoverColor",a,this,!0)}},{key:"disabledColor",get:function(){return M(D(r.prototype),"disabledColor",this)},set:function(a){F(D(r.prototype),"disabledColor",a,this,!0)}},{key:"normalSprite",get:function(){return M(D(r.prototype),"normalSprite",this)},set:function(a){F(D(r.prototype),"normalSprite",a,this,!0)}},{key:"pressedSprite",get:function(){return M(D(r.prototype),"pressedSprite",this)},set:function(a){F(D(r.prototype),"pressedSprite",a,this,!0)}},{key:"hoverSprite",get:function(){return M(D(r.prototype),"hoverSprite",this)},set:function(a){F(D(r.prototype),"hoverSprite",a,this,!0)}},{key:"disabledSprite",get:function(){return M(D(r.prototype),"disabledSprite",this)},set:function(a){F(D(r.prototype),"disabledSprite",a,this,!0)}},{key:"duration",get:function(){return M(D(r.prototype),"duration",this)},set:function(a){F(D(r.prototype),"duration",a,this,!0)}},{key:"zoomScale",get:function(){return M(D(r.prototype),"zoomScale",this)},set:function(a){F(D(r.prototype),"zoomScale",a,this,!0)}},{key:"__preload",value:function(){M(D(r.prototype),"__preload",this).call(this)}},{key:"onDestroy",value:function(){var a;null==(a=M(D(r.prototype),"onDestroy",this))||a.call(this)}},{key:"onEnable",value:function(){var a;null==(a=M(D(r.prototype),"onEnable",this))||a.call(this),this.hasBeenDisabled=!this.interactable,this.node.off(ey.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(ee.EventType.TOUCH_START,this.onTouchStart),this.node.on(ee.EventType.TOUCH_END,this.onTouchEnd),this.node.on(ee.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(ee.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ee.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var a;null==(a=M(D(r.prototype),"onDisable",this))||a.call(this),this.node.off(ee.EventType.TOUCH_START,this.onTouchStart),this.node.off(ee.EventType.TOUCH_END,this.onTouchEnd),this.node.off(ee.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(ee.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ee.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"_updateState",value:function(){M(D(r.prototype),"_updateState",this).call(this),this.patchEmitTransitionDisabled()}},{key:"patchEmitTransitionDisabled",value:function(){var a=3===this._getButtonState();this.hasBeenDisabled!==a&&(a?this.emitTransitionEvent("TRANSITION_DISABLED"):this.emitTransitionEvent(rd),this.hasBeenDisabled=a)}},{key:"handleDown",value:function(a){this.hasDown=!0,this.makeSound&&th.playSound(tJ[this.soundKey]),this.emitTransitionEvent(rh),this.emitClickStartEvents(a)}},{key:"emitClickStartEvents",value:function(a){var o,C=E(this.onClickStartEvents);try{for(C.s();!(o=C.n()).done;){var A=o.value;A.emit([a,A.customEventData])}}catch(a){C.e(a)}finally{C.f()}this.node.emit(rf)}},{key:"emitClickEndEvents",value:function(a){var o,C=E(this.onClickEndEvents);try{for(C.s();!(o=C.n()).done;){var A=o.value;A.emit([a,A.customEventData])}}catch(a){C.e(a)}finally{C.f()}this.node.emit(rv)}},{key:"emitClickCancelEvents",value:function(a){var o,C=E(this.onClickCancelEvents);try{for(C.s();!(o=C.n()).done;){var A=o.value;A.emit([a,A.customEventData])}}catch(a){C.e(a)}finally{C.f()}this.node.emit(rm)}},{key:"handleUp",value:function(a){this.hasUp=!0,this.hasFinishClickCycle=!0,this.emitTransitionEvent(rd),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(a),this.emitClickEndEvents(a)}},{key:"emitButtonEvents",value:function(a){if(this.interactable){var o,C=E(this.clickEvents);try{for(C.s();!(o=C.n()).done;){var A=o.value;A.emit([a,A.customEventData])}}catch(a){C.e(a)}finally{C.f()}this.node.emit(ry)}}},{key:"emitTransitionEvent",value:function(a){this.node.emit(a)}},{key:"fakeClick",value:function(){var a=this;this.emitTransitionEvent(rh),this.scheduleOnce(function(){a.emitTransitionEvent(rd)},0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}},{key:"setInteractable",value:function(a,o){var C=!(arguments.length>0&&void 0!==a)||a,A=!(arguments.length>1&&void 0!==o)||o;this.interactable=C,A&&(this.enabled=C)}}]),r}(ef)).prototype,"onClickStartEvents",[ij],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rr=L(rn.prototype,"onClickEndEvents",[iX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ra=L(rn.prototype,"onClickCancelEvents",[iJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),L(rn.prototype,"transition",[iZ],Object.getOwnPropertyDescriptor(rn.prototype,"transition"),rn.prototype),L(rn.prototype,"normalColor",[iQ],Object.getOwnPropertyDescriptor(rn.prototype,"normalColor"),rn.prototype),L(rn.prototype,"pressedColor",[i$],Object.getOwnPropertyDescriptor(rn.prototype,"pressedColor"),rn.prototype),L(rn.prototype,"hoverColor",[i0],Object.getOwnPropertyDescriptor(rn.prototype,"hoverColor"),rn.prototype),L(rn.prototype,"disabledColor",[i1],Object.getOwnPropertyDescriptor(rn.prototype,"disabledColor"),rn.prototype),L(rn.prototype,"normalSprite",[i2],Object.getOwnPropertyDescriptor(rn.prototype,"normalSprite"),rn.prototype),L(rn.prototype,"pressedSprite",[i3],Object.getOwnPropertyDescriptor(rn.prototype,"pressedSprite"),rn.prototype),L(rn.prototype,"hoverSprite",[i4],Object.getOwnPropertyDescriptor(rn.prototype,"hoverSprite"),rn.prototype),L(rn.prototype,"disabledSprite",[i5],Object.getOwnPropertyDescriptor(rn.prototype,"disabledSprite"),rn.prototype),L(rn.prototype,"duration",[i6],Object.getOwnPropertyDescriptor(rn.prototype,"duration"),rn.prototype),L(rn.prototype,"zoomScale",[i7],Object.getOwnPropertyDescriptor(rn.prototype,"zoomScale"),rn.prototype),ro=L(rn.prototype,"makeSound",[rR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rs=L(rn.prototype,"soundKey",[i8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tX[tZ.BUTTON_CLICK]}}),rl=L(rn.prototype,"disableSpamClick",[i9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ru=L(rn.prototype,"disableSpamDelay",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),rc=L(rn.prototype,"performBoundsCheckOnClickCancel",[rR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rt=rn))||rt)||rt)||rt);U._RF.pop(),U._RF.push({},"b7001YamGNLeauE1hUAtFfj","ButtonPlusAnalytics",void 0);var rN,rF,rD,rM,rx,rz,rG,rq,rU,rH,rW,rV,rK,rY,rj,rX,rJ,rZ,rQ,r$,r0=$.ccclass,r1=$.property,r2=$.disallowMultiple,r3=$.requireComponent,r4=$.menu,r5=GameCore.Plugins.Analytics.Events,r6=globalThis.game.analytics;rg=r0("ButtonPlusAnalytics"),rb=r3(rO),rk=r4("GameCore/ButtonPlus/ButtonPlusAnalytics"),rw=tj.required,rS=r1(rO),rT=r1({visible:function(){return this.useCustomButtonName}}),rg(rC=r2(rC=rb(rC=rk((r_=L((rA=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"button",r_,N(a)),O(a,"useCustomButtonName",rP,N(a)),O(a,"customButtonName",rI,N(a)),a}return a(r,[{key:"onEnable",value:function(){this.button.node.on(ry,this.onClick,this)}},{key:"onDisable",value:function(){this.button.node.off(rh,this.onClick,this)}},{key:"onClick",value:function(){r6.event(r5.BUTTON_CLICK,{button_name:this.useCustomButtonName?this.customButtonName:this.node.name,screen_name:tp.getCurrentPage()})}}]),r}(eo)).prototype,"button",[rw,rS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rP=L(rA.prototype,"useCustomButtonName",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rI=L(rA.prototype,"customButtonName",[rT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rC=rA))||rC)||rC)||rC),U._RF.pop(),U._RF.push({},"a89b3F866FGO68YNa+5Tsqh","ButtonPlusScale",void 0);var r7=$.ccclass,r8=$.property,r9=$.disallowMultiple,ae=$.requireComponent,at=$.menu,an=GameCore.Utils.Signal;rN=r7("ButtonPlusScale"),rF=ae(rO),rD=at("GameCore/ButtonPlus/ButtonPlusScale"),rM=tj.required,rx=r8(rO),rz=r8({group:{name:"Normal",style:"section"},displayName:"Scale"}),rG=r8({group:{name:"Normal",style:"section"},displayName:"Duration"}),rq=r8({group:{name:"Hover",style:"section"},displayName:"Scale"}),rU=r8({group:{name:"Hover",style:"section"},displayName:"Duration"}),rH=r8({group:{name:"Click",style:"section"},displayName:"Scale"}),rW=r8({group:{name:"Click",style:"section"},displayName:"Duration"}),rN(rV=r9(rV=rF(rV=rD((rY=L((rK=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"button",rY,N(a)),O(a,"normalScale",rj,N(a)),O(a,"normalDuration",rX,N(a)),O(a,"hoverScale",rJ,N(a)),O(a,"hoverDuration",rZ,N(a)),O(a,"clickScale",rQ,N(a)),O(a,"clickDuration",r$,N(a)),a.animStateController=new an.SignalController,a}return a(r,[{key:"start",value:function(){this.button.node.setScale(this.normalScale)}},{key:"onEnable",value:function(){this.button.node.on(rh,this.onTransitionDown,this),this.button.node.on(rp,this.onTransitionHover,this),this.button.node.on(rd,this.onTransitionReset,this)}},{key:"onDisable",value:function(){this.button.node.off(rh,this.onTransitionDown,this),this.button.node.off(rp,this.onTransitionHover,this),this.button.node.off(rd,this.onTransitionReset,this)}},{key:"onTransitionDown",value:function(){ts.runTweenAsync(Y(this.button.node).to(this.clickDuration,{scale:this.clickScale},{easing:"cubicOut"}),this.animStateController.renew())}},{key:"onTransitionHover",value:function(){ts.runTweenAsync(Y(this.button.node).to(this.hoverDuration,{scale:this.hoverScale},{easing:"backOut"}),this.animStateController.renew())}},{key:"onTransitionReset",value:function(){ts.runTweenAsync(Y(this.button.node).to(this.normalDuration,{scale:this.normalScale},{easing:"cubicOut"}),this.animStateController.renew())}}]),r}(eo)).prototype,"button",[rM,rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rj=L(rK.prototype,"normalScale",[rz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(1,1,1)}}),rX=L(rK.prototype,"normalDuration",[rG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .2}}),rJ=L(rK.prototype,"hoverScale",[rq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(1.1,1.1,1.1)}}),rZ=L(rK.prototype,"hoverDuration",[rU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .2}}),rQ=L(rK.prototype,"clickScale",[rH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(.9,.9,.9)}}),r$=L(rK.prototype,"clickDuration",[rW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .2}}),rV=rK))||rV)||rV)||rV),U._RF.pop(),U._RF.push({},"8da82t0ygpD67a+mCLT0Qs7","ButtonName",void 0);var ai,ar,aa,ao,as,al,au,ac,ah,ad,af,ay,av,am,ag,ab,ak,aw,aS,aT,aC,aA,a_,aP={CloseButton:"NMM_CLOSE",ContinueNMMButton:"NMM_CONTINUE",WatchAdButton:"NMM_WATCH_AD",SettingButton:"DB_SETTING",ThemeButton:"DB_THEME",PlayTournamentButton:"DB_TOURNAMENT",PlayLevelButton:"DB_LEVEL",DailyChallengeButton:"DB_DAILY_CHALLENGE",PlayWithFriendButton:"DB_PLAY_WITH_FRIEND",DB_GIFT:"DB_GIFT",DB_LEADERBOARD:"DB_LEADERBOARD",CoinPanel:"DB_SHOP",PlayButton:"DB_LEVEL",TournamentButton:"DB_TOURNAMENT",VSFriendsButton:"DB_PLAY_WITH_FRIEND",ShopButton:"DB_SHOP",DailyMissionButton:"DB_DAILY_MISSION",GlobalLeaderboardButton:"DB_GLOBAL_LEADERBOARD",DailyRewardButton:"DB_DAILY_REWARD",SettingsMusic:"SETTINGS_MUSIC",SettingsSound:"SETTINGS_SOUND",SettingsVibration:"SETTINGS_VIBRATION",SETTINGS_HINT:"SETTINGS_HINT",SettingsInvite:"SETTINGS_INVITE",SETTINGS_FANPAGE:"SETTINGS_FANPAGE",SettingsBg:"SETTINGS_BG",SettingsClose:"SETTINGS_CLOSE",SettingsLanguage:"SETTINGS_LANGUAGE",SettingsTutorial:"SETTINGS_TUTORIAL",SettingsFanpage:"SETTINGS_FANPAGE",SettingsJoinGroup:"SETTINGS_JOIN_GROUP",Replay:"SETTINGS_REPLAY",ShopCloseButton:"SHOP_CLOSE_BTN",SuperBundleShopBtn:"SUPER_BUNDLE_SHOP_BTN",MegaBundleShopBtn:"MEGA_BUNDLE_SHOP_BTN",Plus240RubiesShopBtn:"PLUS_240_RUBIES_SHOP_BTN",Plus720RubiesShopBtn:"PLUS_720_RUBIES_SHOP_BTN",Plus1500RubiesShopBtn:"PLUS_1500_RUBIES_SHOP_BTN",Plus2800RubiesShopBtn:"PLUS_2800_RUBIES_SHOP_BTN",Plus6200RubiesShopBtn:"PLUS_6200_RUBIES_SHOP_BTN",Plus300RubiesAndRemoveAdsShopBtn:"PLUS_300_RUBIES_AND_REMOVE_ADS_SHOP_BTN",BackButtonShop:"SHOP_BACK",ShopAds:"SHOP_ADS_1",ShopAds2:"SHOP_ADS_2",SHOP_IAP:"SHOP_IAP",UndoButton:"ITEM_UNDO",MagicwandButton:"ITEM_MAGIC_WAND",ShuffleButton:"ITEM_SHUFFLE",BackButton:"MAP_BACK",MapBack:"MAP_BACK",BackButtonGP:"GP_BACK",SettingButtonGP:"GP_SETTINGS",RewardWatchAd:"RW_WATCH_AD",RewardClose:"RW_CLOSE",RewardBg:"RW_BG",NextLevelButton:"RESULT_LEVEL",CollectButton:"RESULT_COLLECT",MapButtonResult:"RESULT_MAP",NextButtonResult:"RESULT_NEXT_LEVEL",ShareButton:"RESULT_SHARE",AdButton:"RESULT_WATCH_AD",FindOpponentButton:"PWF_FIND_OPPONENT",PWFBackButton:"PWF_BACK",NewMatchButton:"RESULT_PWF_NEW_MATCH",ResultPWFMapButton:"RESULT_PWF_MAP",LBInfoButton:"LB_INFO",LBCloseButton:"LB_CLOSE",RTInfoButton:"RT_INFO",RTCloseButton:"RT_CLOSE",ContinueButton:"RT_CONTINUE",TapZoneButton:"TT_TAP_TO_CONTINUE",DMCloseButton:"DM_CLOSE",GoButton:"DM_GO",ClaimButton:"DM_CLAIM",DailyMissionsBackground:"DM_TOUCH_ZONE_CLOSE",RWTBtnCollect:"RWT_COLLECT",TransitionBtn:"FTI_CONTINUE",CloseBtn:"FTI_CLOSE",CloseGLButton:"GL_CLOSE",StartButtonTourInfo:"TOURNAMENT_INFO_START_BTN",CollectDRButton:"DR_COLLECT",TutOk:"TUT_OK",RubyBarButton:"RUBY_BAR_BTN",SelectLanguageClose:"SELECT_LANGUAGE_CLOSE",BrCountryBtn:"SELECT_LANGUAGE_BR_BTN",EnCountryBtn:"SELECT_LANGUAGE_EN_BTN",EXTRA_SLOT_BTN:"EXTRA_SLOT_BTN",BackButtonDaily:"DAILY_CHALLENGE_BACK",RESULT_CHALLENGE_NEW_GAME:"RESULT_CHALLENGE_NEW_GAME",ResultChallengeBg:"RESULT_CHALLENGE_BG",TOURNAMENT_BACK:"TOURNAMENT_BACK",WorldTournamentBg:"WORLD_TOURNAMENT_BG",BtnShare:"WORLD_TOURNAMENT_SHARE",BtnCollect:"CHAPTER_COMPLETE_COLLECT",ResultDailyContinueButton:"RESULT_DAILY_CONTINUE",WatchAdsButton:"WATCH_ADS_FREE_RUBIES",FreeRubiesCloseBtn:"FREE_RUBIES_CLOSE"};U._RF.pop(),U._RF.push({},"4b299Dv1kVGcqQmJC9yBPAV","ButtonReleased",void 0);var aI,aB,aR,aE,aL,aO=$.ccclass,aN=$.requireComponent,aF=$.property,aD=$.disallowMultiple,aM=$.executionOrder,ax=globalThis.game.analytics,az=(ai=aO("ButtonReleased"),ar=aN([es,ef]),aa=aM(120),ao=aF(el),as=aF(el),al=aF(ev),au=aF({visible:function(){return this.useSound},type:tX}),ac=aF({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),ah=aF({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),ad=tj.required,af=tj.required,ay=aF(ev),ai(av=aD(av=ar(av=aa((ag=L((am=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"downClipName",ag,N(a)),O(a,"upClipName",ab,N(a)),O(a,"useSound",ak,N(a)),a.animationUp=void 0,O(a,"soundKey",aw,N(a)),O(a,"disableSpamClick",aS,N(a)),O(a,"disableSpamDelay",aT,N(a)),O(a,"buttonComponent",aC,N(a)),O(a,"animationComponent",aA,N(a)),a.currentClickBoundingBox=null,a.hasDown=!1,a.hasUp=!1,O(a,"logEvent",a_,N(a)),a.handleTouchStart=void 0,a.handleTouchEnd=void 0,a.onTouchStart=function(o){var C;if(a.buttonComponent.interactable&&!a.hasDown&&(em.stopAllByTarget(a.node),a.currentClickBoundingBox=tc.getBoundingBoxToWorld(a.node),a.hasDown=!0,a.runAnimation(a.downClipName),null==(C=a.handleTouchStart)||C.call(a),a.useSound&&a.soundKey)){var A=tJ[a.soundKey];if(!A)return;th.playSound(A)}},a.onTouchEnd=function(o){var C;a.buttonComponent.interactable&&a.hasDown&&(a.hasUp||(a.handleUp(o),null==(C=a.handleTouchEnd)||C.call(a)))},a.onTouchCancel=function(o){var C,A,P;if(a.buttonComponent.interactable&&a.hasDown&&!a.hasUp){var I=o.getUILocation(),B=null!=(C=null==(A=a.currentClickBoundingBox)?void 0:A.contains(I))&&C;null==(P=a.handleTouchEnd)||P.call(a),_instanceof(o,eg)&&B?a.handleUp(o):(a.hasUp=!0,a.runAnimation(a.upClipName),a.animationComponent.once(es.EventType.FINISHED,function(){var o,C;a.handleResetButtonState(),null==(o=a.animationUp)||o.stop(),null==(C=a.animationUp)||C.start()}))}},a.handleResetButtonState=function(){var o;if(a.hasDown=!1,a.hasUp=!1,a.buttonComponent){var C=a.buttonComponent.node.scale.x,A=a.buttonComponent.node.scale.z;null==(o=a.buttonComponent)||o.node.setScale(new ei(C,1,A))}},a}return a(r,[{key:"setHandleTouchStartFunc",value:function(a){this.handleTouchStart=a}},{key:"setHandleTouchEndFunc",value:function(a){this.handleTouchEnd=a}},{key:"__preload",value:function(){this.buttonComponent=this.getComponent(ef),this.animationComponent=this.getComponent(es),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"onEnable",value:function(){this.animationComponent.clips.length<2||(this.node.off(ey.EventType.TOUCH_END,this.buttonComponent._onTouchEnded,this.buttonComponent),this.node.off(ey.EventType.TOUCH_START),this.node.off(ey.EventType.TOUCH_CANCEL),this.node.on(ee.EventType.TOUCH_START,this.onTouchStart),this.node.on(ee.EventType.TOUCH_END,this.onTouchEnd),this.node.on(ee.EventType.TOUCH_CANCEL,this.onTouchCancel))}},{key:"onDisable",value:function(){this.node.off(ee.EventType.TOUCH_START,this.onTouchStart),this.node.off(ee.EventType.TOUCH_END,this.onTouchEnd),this.node.off(ee.EventType.TOUCH_CANCEL,this.onTouchCancel),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleUp",value:function(a){var o=this;if(this.hasUp=!0,this.logEvent){var C=aP[this.node.name];ax.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:C,screen_name:tp.getCurrentPage()})}this.node.emit(ef.EventType.CLICK,this.buttonComponent,a);var A=this.buttonComponent.clickEvents;if(A.length>0){var P,I=E(A);try{for(I.s();!(P=I.n()).done;){var B=P.value;B.emit([a,B.customEventData])}}catch(a){I.e(a)}finally{I.f()}}this.runAnimation(this.upClipName),this.animationComponent.once(es.EventType.FINISHED,function(){var a,C;o.disableSpamClick?o.scheduleOnce(o.handleResetButtonState,o.disableSpamDelay):o.handleResetButtonState(),o.buttonComponent&&!o.buttonComponent.interactable||(null==(a=o.animationUp)||a.stop(),null==(C=o.animationUp)||C.start())})}},{key:"runAnimation",value:function(a){if(!this.isAnimationExist(a))throw new Error("".concat(this.node.name,": Animation component must have ").concat(a," clip"));this.animationComponent.play(a)}},{key:"isAnimationExist",value:function(a){return this.animationComponent.clips.some(function(o){return!(!o||o.name!==a)})}}]),r}(eo)).prototype,"downClipName",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"ButtonDown"}}),ab=L(am.prototype,"upClipName",[as],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"ButtonUp"}}),ak=L(am.prototype,"useSound",[al],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aw=L(am.prototype,"soundKey",[au],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tX[tZ.BUTTON_CLICK]}}),aS=L(am.prototype,"disableSpamClick",[ac],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),aT=L(am.prototype,"disableSpamDelay",[ah],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),aC=L(am.prototype,"buttonComponent",[ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aA=L(am.prototype,"animationComponent",[af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a_=L(am.prototype,"logEvent",[ay],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),av=am))||av)||av)||av)||av);U._RF.pop(),U._RF.push({},"097b7IBTpxIH6UKvS3hQuEd","IconButton",void 0);var aG,aq,aU,aH,aW,aV,aK,aY,aj=$.ccclass,aX=$.property;aI=aj("IconButton"),aB=aX(W),aR=tj.required,aI((aL=L((aE=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"icon",aL,N(a)),a}return a(r,[{key:"__preload",value:function(){var a;null==(a=M(D(r.prototype),"__preload",this))||a.call(this),tj.validateRequiredProperties(this,r)}}]),r}(ef)).prototype,"icon",[aB,aR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aE)),U._RF.pop(),U._RF.push({},"36c21AprRdChpu8H94usYLK","IconButtonWithBG",void 0);var aJ,aZ,aQ,a$,a0,a1,a2,a3,a4,a5,a6=$.ccclass,a7=$.property;aG=a6("IconButtonWithBG"),aq=a7(W),aU=tj.required,aH=a7(W),aW=tj.required,aG((aK=L((aV=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"background",aK,N(a)),O(a,"icon",aY,N(a)),a}return a(r,[{key:"__preload",value:function(){var a;null==(a=M(D(r.prototype),"__preload",this))||a.call(this),tj.validateRequiredProperties(this,r)}}]),r}(ef)).prototype,"background",[aq,aU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aY=L(aV.prototype,"icon",[aH,aW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aV)),U._RF.pop(),U._RF.push({},"d4b4c4wS79I+6krkEMnKSIR","IconLabelContainer",void 0);var a8,a9,oe,ot,on,oi,or,oa,oo,os,ol,ou=$.ccclass,oc=$.requireComponent,oh=$.property,op=(aJ=ou("IconLabelContainer"),aZ=oc([en]),aQ=oh(W),a$=tj.required,a0=oh(er),a1=tj.required,aJ(a2=aZ((a4=L((a3=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"icon",a4,N(a)),O(a,"label",a5,N(a)),a}return a(r,[{key:"__preload",value:function(){var a=this,o=this.getComponent(en),C=this.getWidth(this),A=this.getWidth(this.icon),P=C-A-this.getWidth(this.label);this.label.node.on(tl.LOCALIZE_APPLIED,function(){a.scheduleOnce(function(){var C=a.getWidth(a.label);null==o||o.setContentSize(A+P+C,o.height)},0)}),tj.validateRequiredProperties(this,r)}},{key:"getWidth",value:function(a){var o,C;return null!=(o=null==(C=a.getComponent(en))?void 0:C.width)?o:0}}]),r}(eo)).prototype,"icon",[aQ,a$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a5=L(a3.prototype,"label",[a0,a1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a2=a3))||a2)||a2);U._RF.pop(),U._RF.push({},"9b7c2EXVpFPuqFjCLopdfVI","IconLabelButtonWithContainer",void 0);var od,of,oy,ov,om,og,ob,ok,ow,oS,oT,oC=$.ccclass,oA=$.property;a8=oC("IconLabelButtonWithContainer"),a9=oA(op),oe=tj.required,ot=oA(W),on=tj.required,oi=oA(er),or=tj.required,a8((oo=L((oa=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"iconLabelContainer",oo,N(a)),O(a,"icon",os,N(a)),O(a,"label",ol,N(a)),a}return a(r,[{key:"__preload",value:function(){var a;null==(a=M(D(r.prototype),"__preload",this))||a.call(this),tj.validateRequiredProperties(this,r)}}]),r}(ef)).prototype,"iconLabelContainer",[a9,oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),os=L(oa.prototype,"icon",[ot,on],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ol=L(oa.prototype,"label",[oi,or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oa)),U._RF.pop(),U._RF.push({},"cbf27lVdM5IArg//xc5+b1W","IconLabelButtonWithLayout",void 0);var o_,oP,oI,oB,oR,oE=$.ccclass,oL=$.property;od=oE("IconLabelButtonWithLayout"),of=oL(eb),oy=tj.required,ov=oL(W),om=tj.required,og=oL(er),ob=tj.required,od((ow=L((ok=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"layout",ow,N(a)),O(a,"icon",oS,N(a)),O(a,"label",oT,N(a)),a}return a(r,[{key:"__preload",value:function(){var a;null==(a=M(D(r.prototype),"__preload",this))||a.call(this),tj.validateRequiredProperties(this,r)}}]),r}(ef)).prototype,"layout",[of,oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oS=L(ok.prototype,"icon",[ov,om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oT=L(ok.prototype,"label",[og,ob],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ok)),U._RF.pop(),U._RF.push({},"8fdb9RITT1FG7rAlFiC3rd0","LabelButton",void 0);var oO,oN,oF,oD,oM,ox,oz,oG,oq=$.ccclass,oU=$.property;o_=oq("LabelButton"),oP=oU(er),oI=tj.required,o_((oR=L((oB=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"label",oR,N(a)),a}return a(r,[{key:"__preload",value:function(){var a;null==(a=M(D(r.prototype),"__preload",this))||a.call(this),tj.validateRequiredProperties(this,r)}}]),r}(ef)).prototype,"label",[oP,oI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oB)),U._RF.pop(),U._RF.push({},"fc571pccApIa5JKMKM2nNQa","MenuButton",void 0);var oH,oW,oV,oK,oY,oj=$.ccclass,oX=$.property;oO=oj("MenuButton"),oN=oX(W),oF=tj.required,oD=oX(er),oM=tj.required,oO((oz=L((ox=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"icon",oz,N(a)),O(a,"label",oG,N(a)),a}return a(r,[{key:"__preload",value:function(){var a;null==(a=M(D(r.prototype),"__preload",this))||a.call(this),tj.validateRequiredProperties(this,r)}}]),r}(ef)).prototype,"icon",[oN,oF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oG=L(ox.prototype,"label",[oD,oM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ox)),U._RF.pop(),U._RF.push({},"1cb250iKvJJAoY6X9+hjtGw","SpriteButton",void 0);var oJ,oZ,oQ,o$,o0,o1,o2,o3,o4=$.ccclass,o5=$.property;oH=o4("SpriteButton"),oW=o5(W),oV=tj.required,oH((oY=L((oK=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"sprite",oY,N(a)),a}return a(r,[{key:"__preload",value:function(){var a;null==(a=M(D(r.prototype),"__preload",this))||a.call(this),tj.validateRequiredProperties(this,r)}}]),r}(ef)).prototype,"sprite",[oW,oV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oK)),U._RF.pop(),U._RF.push({},"3c0fe02qSlP2JTLrR2Vhh9T","ControllableHitArea",void 0);var o6=$.ccclass,o7=$.property,o8=$.requireComponent;oJ=o6("ControllableHitArea"),oZ=o8(en),oQ=o7(en),o$=o7(ek),oJ(o0=oZ((o2=L((o1=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"iconTransform",o2,N(a)),O(a,"hitAreaIncreasePercent",o3,N(a)),a.uiTransform=void 0,a}return a(r,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(en),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"onLoad",value:function(){var a=this.iconTransform.contentSize,o=a.width,C=a.height;o+=o*this.hitAreaIncreasePercent,C+=C*this.hitAreaIncreasePercent,this.uiTransform.setContentSize(o,C)}}]),r}(eo)).prototype,"iconTransform",[oQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o3=L(o1.prototype,"hitAreaIncreasePercent",[o$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),o0=o1))||o0),U._RF.pop(),U._RF.push({},"68696npReFODYXk/lYtT8Cf","CursorUtils",void 0);var o9,se,st,sn,si,sr,sa=function(){function n(){o(this,n),this.canvas=null,this.originalCursor=null,this.activeCount=0}return a(n,[{key:"getCanvas",value:function(){return this.canvas?this.canvas:"undefined"==typeof document?null:(this.canvas=document.querySelector("canvas"),this.canvas)}}],[{key:"inst",get:function(){return this._instance||(this._instance=new n,this.init()),this._instance}},{key:"init",value:function(){var a;this.inst.canvas=document.querySelector("canvas");var o=null!=(a=this.inst.canvas)?a:document.body;try{this.inst.originalCursor=window.getComputedStyle(o).cursor||""}catch(a){this.inst.originalCursor=""}}},{key:"setCursor",value:function(a){var o=arguments.length>0&&void 0!==a?a:"pointer";o!==this.inst.originalCursor&&this.inst.activeCount++;var C=this.inst.getCanvas();C?C.style.cursor=o:"undefined"!=typeof document&&(document.body.style.cursor=o)}},{key:"restoreCursor",value:function(){if(this.inst.activeCount=Math.max(0,this.inst.activeCount-1),0===this.inst.activeCount){var a,o=null!=(a=this.inst.originalCursor)?a:"",C=this.inst.getCanvas();C?C.style.cursor=o:"undefined"!=typeof document&&(document.body.style.cursor=o)}}}]),n}();sa._instance=void 0,U._RF.pop(),U._RF.push({},"d7f56UfbU9N7ra1+NIei9CY","CursorToggler",void 0);var so,ss,sl,su,sc,sh,sp,sd,sf=$.ccclass,sy=$.property,sv=GameCore.Utils.Device;o9=sf("CursorToggler"),se=sy(ef),st=sy({tooltip:'Cursor CSS value for web. Example: "pointer" or "url(/cur.png) 8 8, pointer"'}),o9((si=L((sn=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"button",si,N(a)),O(a,"cursorValue",sr,N(a)),a.enabledForDesktop=!1,a}return a(r,[{key:"preload",value:function(){this.button||(this.button=this.getComponent(ef)),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"onLoad",value:function(){var a;null!=sv&&null!=(a=sv.isDesktop)&&a.call(sv)&&"undefined"!=typeof document?this.enabledForDesktop=!0:this.enabledForDesktop=!1}},{key:"onEnable",value:function(){this.enabledForDesktop&&(this.node.on(ee.EventType.MOUSE_ENTER,this.onEnter,this),this.node.on(ee.EventType.MOUSE_LEAVE,this.onLeave,this))}},{key:"onDisable",value:function(){this.enabledForDesktop&&(this.node.off(ee.EventType.MOUSE_ENTER,this.onEnter,this),this.node.off(ee.EventType.MOUSE_LEAVE,this.onLeave,this),sa.restoreCursor())}},{key:"onDestroy",value:function(){this.enabledForDesktop&&(this.node.off(ee.EventType.MOUSE_ENTER,this.onEnter,this),this.node.off(ee.EventType.MOUSE_LEAVE,this.onLeave,this),sa.restoreCursor())}},{key:"onEnter",value:function(){this.enabledForDesktop&&this.button&&this.button.interactable&&sa.setCursor(this.cursorValue)}},{key:"onLeave",value:function(){this.enabledForDesktop&&sa.restoreCursor()}}]),r}(eo)).prototype,"button",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sr=L(sn.prototype,"cursorValue",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"pointer"}}),sn)),U._RF.pop(),U._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var sm,sg=$.ccclass,sb=$.requireComponent,sk=$.property;so=sg("OpacityToggler"),ss=sb([ea]),sl=tj.required,so(su=ss((sh=L((sc=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"activeValue",sh,N(a)),O(a,"inActiveValue",sp,N(a)),O(a,"opacityComponent",sd,N(a)),a}return a(r,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(ea),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"changeState",value:function(a){var o=arguments.length>0&&void 0!==a&&a;this.opacityComponent.opacity=o?this.activeValue:this.inActiveValue}}]),r}(eo)).prototype,"activeValue",[sk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),sp=L(sc.prototype,"inActiveValue",[sk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),sd=L(sc.prototype,"opacityComponent",[sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),su=sc))||su),U._RF.pop(),U._RF.push({},"19f01Few+JFaJ0WJwTzZbEK","BorderDebugGraphics",void 0);var sw,sS,sT=$.ccclass,sC=$.executeInEditMode;sT("BorderDebugGraphics")(sm=sC(sm=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).config={lineW:10,color:"#FF0000"},a}return a(r,[{key:"start",value:function(){if(10===this.lineWidth&&(this.lineWidth=this.config.lineW),this.strokeColor.equals(new K(0,0,0,255))){var a=new K;K.fromHEX(a,this.config.color),this.strokeColor=a}}},{key:"update",value:function(a){try{var o=this.node.parent;this.clear();var C=o.getComponent(en),A=C.anchorPoint;this.rect(-C.width*A.x,-C.height*A.y,C.width,C.height),this.stroke()}catch(a){}}}]),r}(ew))||sm),U._RF.pop(),U._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var sA,s_,sP,sI,sB,sR,sE,sL,sO,sN,sF,sD,sM,sx,sz,sG,sq,sU,sH,sW,sV,sK,sY,sj,sX,sJ,sZ=$.ccclass,sQ=$.property,s$=$.requireComponent,s0=$.disallowMultiple,s1=$.executeInEditMode,s2=tu.DesignSize,s3=s2.Portrait,s4=s2.Landscape;sZ("DebugResolution")(sw=s0(sw=s$([ew])(sw=s1(!0)(((sS=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).graphics=void 0,a.handleLayoutChange=function(){var o;null==(o=a.graphics)||o.clear(),a.start()},a}return a(r,[{key:"drawPortrait",get:function(){return r._drawPortrait},set:function(a){a!==r._drawPortrait&&(a?this.drawPortraitResolution():this.graphics.clear(),r._drawPortrait=a,r._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return r._drawLandscape},set:function(a){a!==r._drawLandscape&&(a?this.drawLandscapeResolution():this.graphics.clear(),r._drawLandscape=a,r._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(ew),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){ep.on(tl.LAYOUT_CHANGED,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var a=this.graphics;if(a){var o=s3.WIDTH,C=s3.HEIGHT;a.strokeColor=K.GREEN,a.rect(-o/2,-C/2,o,C),a.stroke()}}},{key:"drawLandscapeResolution",value:function(){var a=this.graphics;if(a){var o=s4.WIDTH,C=s4.HEIGHT;a.strokeColor=K.CYAN,a.rect(-o/2,-C/2,o,C),a.stroke()}}}]),r}(eo))._drawPortrait=!0,sS._drawLandscape=!0,L(sS.prototype,"drawPortrait",[sQ],Object.getOwnPropertyDescriptor(sS.prototype,"drawPortrait"),sS.prototype),L(sS.prototype,"drawLandscape",[sQ],Object.getOwnPropertyDescriptor(sS.prototype,"drawLandscape"),sS.prototype),sw=sS))||sw)||sw)||sw),U._RF.pop(),U._RF.push({},"72cefam3/RNTLyVL1fZX6wh","DesignAutoAlignLayout",void 0);var s5,s6,s7,s8,s9,le,lt,li,lr=$.ccclass,la=$.executeInEditMode,lo=$.type,ls=$.property,ll=$.executionOrder,lu=$.requireComponent,lc=(sA=lr("ChildZonePayload"),s_=ls({readonly:!0}),sP=ls({readonly:!0}),sA((sB=L((sI=a(function e(){o(this,e),O(this,"uiTransform",sB,this),O(this,"topGap",sR,this)})).prototype,"uiTransform",[s_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sR=L(sI.prototype,"topGap",[sP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sI))||sI),lh=(sE=lr("SerializedInitPayload"),sL=ls({readonly:!0}),sO=ls({readonly:!0}),sN=ls({type:[lc],readonly:!0}),sE((sD=L((sF=function(){function n(){o(this,n),O(this,"height",sD,this),O(this,"childrenTotalHeight",sM,this),O(this,"childrenZonePayloads",sx,this)}return a(n,[{key:"initPayload",get:function(){return{height:this.height,childrenTotalHeight:this.childrenTotalHeight,childrenZonePayloads:this.childrenZonePayloads}},set:function(a){var o=a.height,C=a.childrenTotalHeight,A=a.childrenZonePayloads;this.height=o,this.childrenTotalHeight=C,this.childrenZonePayloads=A.map(function(a){var o=a.uiTransform,C=a.topGap,A=new lc;return A.uiTransform=o,A.topGap=C,A})}}]),n}()).prototype,"height",[sL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sM=L(sF.prototype,"childrenTotalHeight",[sO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sx=L(sF.prototype,"childrenZonePayloads",[sN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sF))||sF);sz=lr("DesignAutoAlignLayout"),sG=ll(110),sq=lu(en),sU=lo(ev),sH=ls({tooltip:"If true, the gaps will increase when the parent height increases. If false, the gaps will only decrease."}),sW=ls({visible:!1}),sV=ls({readonly:!0}),sz(sK=sG(sK=sq(sK=la((L((sY=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"allowGapExpansion",sj,N(a)),O(a,"shouldExecuteInEditMode",sX,N(a)),a.uiTransform=void 0,a.nodeEventListeners={},a.childrenEventListeners=[],a.initPayload={childrenZonePayloads:[],height:0,childrenTotalHeight:0},a.layoutDirty=!0,a.childrenDirty=!1,a.init=!1,O(a,"serializedInitPayload",sJ,N(a)),a.updateLayout=function(o){var C=arguments.length>0&&void 0!==o&&o;(a.layoutDirty&&a.canExecute||C)&&(a.doLayout(),a.layoutDirty=!1)},a.doLayoutDirty=function(){a.canExecute&&(a.layoutDirty=!0)},a.childrenChanged=function(){a.canExecute&&(a.childrenDirty=!0,a.doLayoutDirty())},a.transformDirty=function(){a.canExecute&&a.doLayoutDirty()},a.handleUpdateInitPayloads=function(){var o=N(a).serializedInitPayload;a.initPayload=o.initPayload,a.init=!0,a.childrenDirty=!1},a}return a(r,[{key:"executeInEditMode",get:function(){return this.shouldExecuteInEditMode},set:function(a){!this.shouldExecuteInEditMode&&a&&this.handleUpdateInitPayloads(),this.shouldExecuteInEditMode=a}},{key:"canExecute",get:function(){return!0}},{key:"height",get:function(){return this.uiTransform.height},set:function(a){this.uiTransform.height=a}},{key:"__preload",value:function(){this.uiTransform=this.node.getComponent(en)}},{key:"onEnable",value:function(){this.addEventListeners();var a=this.uiTransform;a.contentSize.equals(eS.ZERO)&&a.setContentSize(300,200),this.childrenChanged()}},{key:"onDisable",value:function(){this.initPayload={childrenZonePayloads:[],height:0,childrenTotalHeight:0},this.removeEventListeners()}},{key:"addEventListeners",value:function(){var a;eh.on(eT.AFTER_UPDATE,this.updateLayout),this.nodeEventListeners=(x(a={},eC.SIZE_CHANGED,this.childrenChanged),x(a,"childrenSiblingOrderChanged",this.updateLayout),a);for(var o=0,C=Object.entries(this.nodeEventListeners);o<C.length;o++){var A=z(C[o],2),P=A[0],I=A[1];this.node.on(P,I)}this.addChildrenEventListeners()}},{key:"removeEventListeners",value:function(){eh.off(eT.AFTER_UPDATE,this.updateLayout);for(var a=0,o=Object.entries(this.nodeEventListeners);a<o.length;a++){var C=z(o[a],2),A=C[0],P=C[1];this.node.off(A,P)}this.nodeEventListeners={},this.removeChildrenEventListeners()}},{key:"addChildrenEventListeners",value:function(){var a=this;this.childrenEventListeners=this.node.children.map(function(o){for(var C,A=(x(C={},eC.SIZE_CHANGED,a.doLayoutDirty),x(C,eC.TRANSFORM_CHANGED,a.transformDirty),x(C,eC.ANCHOR_CHANGED,a.doLayoutDirty),x(C,eC.ACTIVE_IN_HIERARCHY_CHANGED,a.childrenChanged),C),P=0,I=Object.entries(A);P<I.length;P++){var B=z(I[P],2),R=B[0],E=B[1];o.on(R,E)}return[o,A]})}},{key:"removeChildrenEventListeners",value:function(){var a,o=E(this.childrenEventListeners);try{for(o.s();!(a=o.n()).done;)for(var C=z(a.value,2),A=C[0],P=C[1],I=0,B=Object.entries(P);I<B.length;I++){var R=z(B[I],2),L=R[0],O=R[1];A.off(L,O)}}catch(a){o.e(a)}finally{o.f()}this.childrenEventListeners=[]}},{key:"computeInitPayloads",value:function(){var a=this,o=this.height,C=R(this.node.children);C.sort(function(a,o){return o.position.y-a.position.y});var A=o/2,P=C.filter(function(a){return a.activeInHierarchy}).map(function(a){return a.getComponent(en)}).filter(function(a){return!!a});return{height:o,childrenTotalHeight:P.reduce(function(a,o){return a+o.height},0),childrenZonePayloads:P.map(function(o,C,P){return{uiTransform:o,topGap:(0===C?A:a.getBottomY(P[C-1]))-a.getTopY(o)}})}}},{key:"doLayout",value:function(){this.init&&!this.childrenDirty||this.handleUpdateInitPayloads();var a=this.initPayload,o=a.childrenZonePayloads,C=a.height,A=a.childrenTotalHeight,P=this.allowGapExpansion;this.height=V.clamp(this.height,A,P?1/0:C);for(var I=this.height-C,B=C-A,R=V.clamp(I/B+1,0,P?1/0:1),E=0;E<o.length;E++){for(var L=0,O=0;O<E;O++){var N=o[O],F=N.uiTransform,D=N.topGap;L+=F.height+D*R}var M=o[E],x=M.uiTransform;L+=M.topGap*R,this.alignToTop(x,L)}}},{key:"alignToTop",value:function(a,o){a.node.setPosition(a.node.position.x,this.height/2-a.height/2-o)}},{key:"getTopY",value:function(a){return a.node.position.y+a.height/2}},{key:"getBottomY",value:function(a){return a.node.position.y-a.height/2}}]),r}(eo)).prototype,"executeInEditMode",[sU],Object.getOwnPropertyDescriptor(sY.prototype,"executeInEditMode"),sY.prototype),sj=L(sY.prototype,"allowGapExpansion",[sH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sX=L(sY.prototype,"shouldExecuteInEditMode",[sW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sJ=L(sY.prototype,"serializedInitPayload",[sV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lh}}),sK=sY))||sK)||sK)||sK),U._RF.pop(),U._RF.push({},"a70f045JspPqbUIgnmrRCDn","Item",void 0);var lp=$.ccclass,ld=$.property;s5=lp("Item"),s6=ld(ea),s7=tj.required,s8=ld(er),s9=tj.required,s5((lt=L((le=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"labelOpacity",lt,N(a)),O(a,"labelText",li,N(a)),a}return a(r,[{key:"__preload",value:function(){var a,o=this;null==(a=this.indexChangeCallbacks)||a.push(function(a){o.updateInfo(a)}),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.node.on(ef.EventType.CLICK,this.onButtonClicked,this),this.node.on(ee.EventType.MOUSE_ENTER,this.onMouseEnter,this),this.node.on(ee.EventType.MOUSE_LEAVE,this.onMouseLeave,this)}},{key:"onDestroy",value:function(){this.node.off(ef.EventType.CLICK,this.onButtonClicked,this),this.node.off(ee.EventType.MOUSE_ENTER,this.onMouseEnter,this),this.node.off(ee.EventType.MOUSE_LEAVE,this.onMouseLeave,this)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"updateInfo",value:function(a){this.labelText.string=this.scroller.getItemAt(a)}},{key:"onButtonClicked",value:function(a,o){(null==o?void 0:o.type)===ee.EventType.TOUCH_CANCEL&&o.simulate||this.scroller.emitClickEvent(this.index)}},{key:"onMouseEnter",value:function(a){this.labelOpacity.opacity=100}},{key:"onMouseLeave",value:function(a){this.labelOpacity.opacity=0}}]),r}(tQ)).prototype,"labelOpacity",[s6,s7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),li=L(le.prototype,"labelText",[s8,s9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),le)),U._RF.pop(),U._RF.push({},"0405b+DQy1IALb/j8jx5Lpc","PerfCounter",void 0);var lf,ly,lv,lm,lg,lb,lk,lw,lS,lT,lC,lA,l_,lP,lI,lB,lR,lE,lL,lO,lN,lF,lD,lM,lx,lz,lG,lq,lU=function(){function n(){o(this,n),this.time=0,this._value=0,this.time=0,this._value=0}return a(n,[{key:"value",get:function(){return this._value}},{key:"start",value:function(a){var o=arguments.length>0&&void 0!==a?a:0;this.time=o}},{key:"end",value:function(a){var o=arguments.length>0&&void 0!==a?a:0;this._value=o-this.time}}]),n}();U._RF.pop(),U._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var lH,lW,lV,lK,lY=$.ccclass,lj=$.executionOrder,lX=$.property,lJ=GameCore,lQ=lJ.Utils,l$=lQ.Valid,l0=lQ.Array,l1=lQ.Device,l2=lJ.Configs.Debugger.ListPlayerDevIds,l3=globalThis.game.player,l4=K.RED,l5=K.BLACK,l6=K.MAGENTA;lf=lY("GameStats"),ly=lj(-1e3),lv=lX(er),lm=tj.required,lg=lX(er),lb=tj.required,lk=lX(er),lw=tj.required,lS=lX(er),lT=tj.required,lC=lX(er),lA=tj.required,l_=lX(er),lP=tj.required,lI=lX(er),lB=tj.required,lR=lX(er),lE=tj.required,lf(lL=ly((lN=L((lO=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"fpsLabel",lN,N(a)),O(a,"drawCountLabel",lF,N(a)),O(a,"logicTimeLabel",lD,N(a)),O(a,"physicTimeLabel",lM,N(a)),O(a,"renderTimeLabel",lx,N(a)),O(a,"objectMemoryUsageLabel",lz,N(a)),O(a,"textureMemoryUsageLabel",lG,N(a)),O(a,"devicePixelRatioLabel",lq,N(a)),a.logicTimeCounter=void 0,a.physicTimeCounter=void 0,a.renderTimeCounter=void 0,a.bg=void 0,a.refreshInterval=.5,a.handleMouseDown=function(){a.bg.enabled=!a.bg.enabled},a.updateStats=function(){a.updateFps(),a.updateDrawCalls(),a.updateLogicTime(),a.updatePhysicTime(),a.updateRenderTime(),a.updateObjectMemoryUsage(),a.updateTextureMemoryUsage(),a.updateDevicePixelRatio()},a}return a(r,[{key:"__preload",value:function(){this.bg=this.getComponent(W),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"listenInputEvents",value:function(){this.node.on(ey.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,this.canDisplayStats()&&(this.node.active=!0,this.logicTimeCounter=new lU,this.physicTimeCounter=new lU,this.renderTimeCounter=new lU,eh.on(eA.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),eh.on(eA.EVENT_AFTER_UPDATE,this.afterUpdate,this),eh.on(eA.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),eh.on(eA.EVENT_AFTER_PHYSICS,this.afterPhysics,this),eh.on(eA.EVENT_BEFORE_DRAW,this.beforeDraw,this),eh.on(eA.EVENT_AFTER_RENDER,this.afterRender,this),this.startUpdateStats())}},{key:"onDestroy",value:function(){this.canDisplayStats()&&(eh.off(eA.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),eh.off(eA.EVENT_AFTER_UPDATE,this.afterUpdate,this),eh.off(eA.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),eh.off(eA.EVENT_AFTER_PHYSICS,this.afterPhysics,this),eh.off(eA.EVENT_BEFORE_DRAW,this.beforeDraw,this),eh.off(eA.EVENT_AFTER_RENDER,this.afterRender,this))}},{key:"canDisplayStats",value:function(){return l$.isDebugger()||l0.has(l2,l3.getPlayerId())}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var a=this.getFps();this.updateFpsColor(a),this.fpsLabel.string="FPS: ".concat(a)}},{key:"updateFpsColor",value:function(a){this.fpsLabel.color=a<30?l4:a<48?l6:l5}},{key:"updateDrawCalls",value:function(){var a=this.getDrawCalls();this.updateDrawCallsColor(a),this.drawCountLabel.string="Draw Calls: ".concat(a)}},{key:"updateDrawCallsColor",value:function(a){var o=e_.os===e_.OS.IOS;this.drawCountLabel.color=a>(o?80:25)?l4:a>(o?60:15)?l6:l5}},{key:"updateLogicTime",value:function(){var a=this.getLogicTime();this.updateLogicTimeColor(a),this.logicTimeLabel.string="Logic Time: ".concat(a.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(a){this.logicTimeLabel.color=a>10?l4:a>5?l6:l5}},{key:"updatePhysicTime",value:function(){var a=this.getPhysicTime();this.updatePhysicTimeColor(a),this.physicTimeLabel.string="Physic Time: ".concat(a.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(a){this.physicTimeLabel.color=a>10?l4:a>5?l6:l5}},{key:"updateRenderTime",value:function(){var a=this.getRenderTime();this.updateRenderTimeColor(a),this.renderTimeLabel.string="Render Time: ".concat(a.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(a){this.renderTimeLabel.color=a>10?l4:a>5?l6:l5}},{key:"updateObjectMemoryUsage",value:function(){var a=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(a),this.objectMemoryUsageLabel.string="Object Mem: ".concat(a.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(a){this.objectMemoryUsageLabel.color=a>40?l4:a>25?l6:l5}},{key:"updateTextureMemoryUsage",value:function(){var a=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(a),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(a.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(a){this.textureMemoryUsageLabel.color=a>50?l4:a>35?l6:l5}},{key:"updateDevicePixelRatio",value:function(){var a=l1.pixelRatio();this.updateDevicePixelRatioColor(a),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(a)}},{key:"updateDevicePixelRatioColor",value:function(a){this.devicePixelRatioLabel.color=a>2?l4:a<=1?l6:l5}},{key:"getFps",value:function(){if(!eh.root)return 0;return Math.floor(eh.root.fps)||0}},{key:"getDrawCalls",value:function(){return eh.root&&eh.root.device.numDrawCalls||0}},{key:"getLogicTime",value:function(){return Math.floor(1e3*this.logicTimeCounter.value)/1e3||0}},{key:"getPhysicTime",value:function(){return Math.floor(1e3*this.physicTimeCounter.value)/1e3||0}},{key:"getRenderTime",value:function(){return Math.floor(1e3*this.renderTimeCounter.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){return eh.root&&eh.root.device.memoryStatus.bufferSize/1048576||0}},{key:"getTextureMemoryUsage",value:function(){return eh.root&&eh.root.device.memoryStatus.textureSize/1048576||0}},{key:"beforeUpdate",value:function(){var a=performance.now();this.logicTimeCounter.start(a)}},{key:"afterUpdate",value:function(){var a=performance.now();this.logicTimeCounter.end(a)}},{key:"beforePhysics",value:function(){var a=performance.now();this.physicTimeCounter.start(a)}},{key:"afterPhysics",value:function(){var a=performance.now();this.physicTimeCounter.end(a)}},{key:"beforeDraw",value:function(){var a=performance.now();this.renderTimeCounter.start(a)}},{key:"afterRender",value:function(){var a=performance.now();this.renderTimeCounter.end(a)}}]),r}(eo)).prototype,"fpsLabel",[lv,lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lF=L(lO.prototype,"drawCountLabel",[lg,lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lD=L(lO.prototype,"logicTimeLabel",[lk,lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lM=L(lO.prototype,"physicTimeLabel",[lS,lT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lx=L(lO.prototype,"renderTimeLabel",[lC,lA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lz=L(lO.prototype,"objectMemoryUsageLabel",[l_,lP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lG=L(lO.prototype,"textureMemoryUsageLabel",[lI,lB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lq=L(lO.prototype,"devicePixelRatioLabel",[lR,lE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lL=lO))||lL),U._RF.pop(),U._RF.push({},"32161i45TpLyYjOr+nb9ZX7","LandscapeContainer",void 0);var l7,l8,l9,ue,ut,un,ui,ur,ua,uo=$.ccclass,us=($.property,lH=uo("LandscapeContainer"),lW=tj.required,lH((lK=L((lV=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"uiTransform",lK,N(a)),a.handleWhenResized=function(){var o=Math.min(eP.getVisibleSize().width,2483),C=a.uiTransform.contentSize.height;a.uiTransform.setContentSize(o,C)},a}return a(r,[{key:"__preload",value:function(){this.initComponents(),this.listenGameEvents()}},{key:"start",value:function(){this.handleWhenResized()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"listenGameEvents",value:function(){nr.isPortrait()||ep.on(tl.VIEW_RESIZED,this.handleWhenResized)}},{key:"initComponents",value:function(){this.uiTransform=this.getComponent(en),this.validateRequiredComponents()}}]),r}(eo)).prototype,"uiTransform",[lW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lV))||lV);U._RF.pop(),U._RF.push({},"2aaacRpk+tH+ocw0E3qy2sd","ProgressBar",void 0);var ul,uu,uc,uh,up,ud,uf,uy,uv,um,ug=$.ccclass,ub=$.property,uk=(l7=ug("ProgressBar"),l8=ub(eu),l9=ub(eu),ue=ub(en),ut=tj.required,l7((ui=L((un=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"minInnerWidth",ui,N(a)),O(a,"maxInnerWidth",ur,N(a)),O(a,"innerUITransform",ua,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"setProgress",value:function(a){var o=this.innerUITransform,C=this.minInnerWidth,A=this.maxInnerWidth,P=a.numerator,I=a.denominator;o.width=C+(A-C)*V.clamp01(P/I)}}]),r}(eo)).prototype,"minInnerWidth",[l8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ur=L(un.prototype,"maxInnerWidth",[l9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ua=L(un.prototype,"innerUITransform",[ue,ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),un))||un);U._RF.pop(),U._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var uw=$.ccclass,uS=$.property,uT=(ul=uw("Burst"),uu=uS(ek),uc=uS(eu),uh=uS(ek),up=uS(eu),ul((uf=L((ud=function(){function n(){o(this,n),O(this,"time",uf,this),O(this,"repeatCount",uy,this),O(this,"repeatInterval",uv,this),O(this,"count",um,this),this.remainingCount=void 0,this.curTime=void 0,this.remainingCount=0,this.curTime=0}return a(n,[{key:"update",value:function(a,o){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var C=eI(a.time-a.startDelay.evaluate(0,1),a.duration)-o;C=C>0?C:0;var A=eI(a.time-a.startDelay.evaluate(0,1),a.duration);this.curTime>=C&&this.curTime<A&&(a.emit(this.count,o-(A-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),n}()).prototype,"time",[uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uy=L(ud.prototype,"repeatCount",[uc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),uv=L(ud.prototype,"repeatInterval",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),um=L(ud.prototype,"count",[up],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ud))||ud);U._RF.pop(),U._RF.push({},"370cbFjxn9GKJzqbTOhQZiA","ParticleSimulator",void 0);var uC,uA,u_,uP,uI,uB,uR,uE,uL,uO,uN,uF,uD,uM,ux,uz,uG=new ei(0,0,0),uq=function(){function n(){o(this,n),this.pos=new ei(0,0,0),this.color=new K(255,255,255,255),this.startColor=void 0,this.size=new ei(0,0,0),this.startSize=new ei(0,0,0),this.rotation=new ei(0,0,0),this.startLifetime=0,this.remainingLifetime=0,this.randomSeed=0,this.velocity=new ei(0,0),this.width=0,this.height=0}return a(n,[{key:"init",value:function(){this.pos.set(uG),this.remainingLifetime=0,this.startLifetime=0,this.startSize.set(uG),this.startColor=K.WHITE.clone(),this.velocity.set(uG),this.randomSeed=0}}]),n}(),uU=new(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"get",value:function(){return this._get()||new uq}}]),r}(eB.Pool))(function(a){a.pos.set(uG),a.color._val=0xffffffff,a.size.set(uG),a.rotation.set(uG)},1024),uH=function(){function n(a){o(this,n),this.particles=[],this.active=!1,this.uvFilled=0,this.renderData=new eE,this.sys=void 0,this.sys=a,this.particles=[],this.active=!1,this.uvFilled=0}return a(n,[{key:"stop",value:function(){this.active=!1}},{key:"reset",value:function(){this.active=!0;var a,o=this.particles,C=E(o);try{for(C.s();!(a=C.n()).done;){var A=a.value;uU.put(A)}}catch(a){C.e(a)}finally{C.f()}o.length=0,this.renderData.resize(0,0)}},{key:"emitParticle",value:function(){var a=uU.get();return this.particles.push(a),a}},{key:"updateUVs",value:function(a){var o=this.renderData;if(o&&this.sys){var C=o.vData,A=this.sys.spriteFrame;if(!A)return;for(var P=A.uv,I=a?0:this.uvFilled,B=this.particles.length,R=I;R<B;R++){var E=9*R*4;C[E+3]=P[0],C[E+4]=P[1],C[E+12]=P[2],C[E+13]=P[3],C[E+21]=P[4],C[E+22]=P[5],C[E+30]=P[6],C[E+31]=P[7]}this.uvFilled=B}}},{key:"updateParticleBuffer",value:function(a,o,C,A){var P=C.vData,I=o.x,B=o.y,R=o.z,E=a.width*a.size.x/2,L=a.height*a.size.y/2,O=a.rotation.x||0,N=a.rotation.y||0,F=a.rotation.z||0;if(0===O&&0===N&&0===F)P[A]=I-E,P[A+1]=B-L,P[A+2]=R,P[A+9]=I+E,P[A+10]=B-L,P[A+11]=R,P[A+18]=I-E,P[A+19]=B+L,P[A+20]=R,P[A+27]=I+E,P[A+28]=B+L,P[A+29]=R;else{var T=function(a,o,C){var A=o*z-C*q,P=o*q+C*z,I=a*U+P*H;return new ei(I*W-A*V,I*V+A*W,P*U-a*H)};var D=-eR.degreesToRadians(O),M=-eR.degreesToRadians(N),x=-eR.degreesToRadians(F),z=Math.cos(D),q=Math.sin(D),U=Math.cos(M),H=Math.sin(M),W=Math.cos(x),V=Math.sin(x);var Y=[T(-E,-L,0),T(E,-L,0),T(-E,L,0),T(E,L,0)];P[A]=Y[0].x+I,P[A+1]=Y[0].y+B,P[A+2]=Y[0].z+R,P[A+9]=Y[1].x+I,P[A+10]=Y[1].y+B,P[A+11]=Y[1].z+R,P[A+18]=Y[2].x+I,P[A+19]=Y[2].y+B,P[A+20]=Y[2].z+R,P[A+27]=Y[3].x+I,P[A+28]=Y[3].y+B,P[A+29]=Y[3].z+R}K.toArray(P,a.color,A+5),K.toArray(P,a.color,A+14),K.toArray(P,a.color,A+23),K.toArray(P,a.color,A+32)}},{key:"step",value:function(a){var o=this.sys.node,C=this.particles;o.updateWorldTransform(),this.active&&this.sys.emitting(a);var A=this.renderData,P=C.length;A.reset(),this.requestData(4*P,6*P),P>this.uvFilled&&this.updateUVs();for(var I=0;I<C.length;){var B=C[I];if(B)if(B.remainingLifetime-=a,B.remainingLifetime>0){var R=9*I*4;this.updateParticleBuffer(B,B.pos,A,R),++I}else{var E=C[I];I!==C.length-1&&(C[I]=C[C.length-1]),uU.put(E),C.length--,A.resize(A.vertexCount-4,A.indexCount-6)}}this.renderData.material=this.sys.getRenderMaterial(0),this.renderData.frame=this.sys.spriteFrame,A.setRenderDrawInfoAttributes()}},{key:"requestData",value:function(a,o){var C=this.renderData.indexCount;this.renderData.request(a,o);for(var A=this.renderData.indexCount/6,P=this.renderData.iData,I=C;I<A;I++){var B=4*I;P[C++]=B,P[C++]=B+1,P[C++]=B+2,P[C++]=B+1,P[C++]=B+3,P[C++]=B+2}}},{key:"initDrawInfo",value:function(){this.renderData.setRenderDrawInfoAttributes()}}]),n}();U._RF.pop(),U._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var uW,uV,uK,uY,uj,uX,uJ,uZ,uQ,u$,u0,u1,u2,u3,u4,u5,u6=$.ccclass,u7=$.property,u8=eL({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),u9=(uC=u6("CurveRange"),uA=u7({type:eL(u8)}),u_=u7({visible:function(){return this.mode===u8.Constant}}),uP=u7({visible:function(){return this.mode===u8.Curve}}),uI=u7({visible:function(){return this.mode===u8.TwoCurves}}),uB=u7({visible:function(){return this.mode===u8.TwoCurves}}),uR=u7({visible:function(){return this.mode===u8.TwoConstants}}),uE=u7({visible:function(){return this.mode===u8.TwoConstants}}),uC((uO=L((uL=function(){function n(){o(this,n),O(this,"mode",uO,this),O(this,"constant",uN,this),O(this,"spline",uF,this),O(this,"splineMin",uD,this),O(this,"splineMax",uM,this),O(this,"constantMin",ux,this),O(this,"constantMax",uz,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return a(n,[{key:"evaluate",value:function(a,o){switch(this.mode){case u8.Curve:return this.spline.evaluate(a);case u8.TwoCurves:return eO(this.splineMin.evaluate(a),this.splineMax.evaluate(a),o);case u8.TwoConstants:return eO(this.constantMin,this.constantMax,o);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case u8.Curve:return 1;case u8.TwoConstants:return this.constantMax;case u8.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case u8.Curve:return eN(1,0,eF);case u8.TwoConstants:return eN(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,eF);case u8.TwoCurves:return eN(1,0,eF);default:return eN(this.constant,0,eF)}}}]),n}()).prototype,"mode",[uA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u8.Constant}}),uN=L(uL.prototype,"constant",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uF=L(uL.prototype,"spline",[uP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eD}}),uD=L(uL.prototype,"splineMin",[uI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eD}}),uM=L(uL.prototype,"splineMax",[uB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eD}}),ux=L(uL.prototype,"constantMin",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uz=L(uL.prototype,"constantMax",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uL))||uL);U._RF.pop(),U._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var ce=$.ccclass,ct=$.property,cn=eL({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),ci=new K,cr=new K,ca=(uW=ce("GradientRange"),uV=ct({type:eL(cn)}),uK=ct({visible:function(){return this.mode===cn.Color}}),uY=ct({visible:function(){return this.mode===cn.TwoColors}}),uj=ct({visible:function(){return this.mode===cn.TwoColors}}),uX=ct({visible:function(){return this.mode===cn.Gradient||this.mode===cn.RandomColor}}),uJ=ct({visible:function(){return this.mode===cn.TwoGradients}}),uZ=ct({visible:function(){return this.mode===cn.TwoGradients}}),uW((u$=L((uQ=function(){function n(){o(this,n),O(this,"mode",u$,this),O(this,"color",u0,this),O(this,"colorMin",u1,this),O(this,"colorMax",u2,this),O(this,"gradient",u3,this),O(this,"gradientMin",u4,this),O(this,"gradientMax",u5,this),this._color=K.WHITE.clone()}return a(n,[{key:"evaluate",value:function(a,o){switch(this.mode){case cn.Color:return this.color;case cn.TwoColors:return K.lerp(this._color,this.colorMin,this.colorMax,o),this._color;case cn.RandomColor:return this.gradient.getRandomColor(this._color);case cn.Gradient:return this.gradient.evaluateFast(this._color,a);case cn.TwoGradients:return K.lerp(this._color,this.gradientMin.evaluateFast(ci,a),this.gradientMax.evaluateFast(cr,a),o),this._color;default:return this.color}}}]),n}()).prototype,"mode",[uV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cn.Color}}),u0=L(uQ.prototype,"color",[uK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return K.WHITE.clone()}}),u1=L(uQ.prototype,"colorMin",[uY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return K.WHITE.clone()}}),u2=L(uQ.prototype,"colorMax",[uj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return K.WHITE.clone()}}),u3=L(uQ.prototype,"gradient",[uX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),u4=L(uQ.prototype,"gradientMin",[uJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),u5=L(uQ.prototype,"gradientMax",[uZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),uQ))||uQ);function ip(a,o,C,A){!function(a,o){H.set(a,Math.cos(o),Math.sin(o))}(a,A),a.z=0,ei.multiplyScalar(a,a,o+(C-o)*ez())}function ap(a){switch(a.mode){case u8.TwoCurves:case u8.TwoConstants:return!0;default:return!1}}U._RF.pop(),U._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),U._RF.pop(),U._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0),U._RF.pop(),U._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var co,cs,cl,cu,cc,ch,cp,cd,cf,cy,cv,cm,cg,cb,ck=$.ccclass,cw=$.property,cS=(co=ck("ColorOvertimeModule"),cs=cw({type:ev}),cl=cw({type:ca}),co((cc=L((cu=function(){function n(){o(this,n),O(this,"enable",cc,this),O(this,"color",ch,this)}return a(n,[{key:"update",value:function(a){if(this.enable){a.color.set(a.startColor);var o=function(a){switch(a.mode){case cn.TwoGradients:case cn.TwoColors:return!0;default:return!1}}(this.color)?eU(a.randomSeed+91041):0;a.color.multiply(this.color.evaluate(1-a.remainingLifetime/a.startLifetime,o))}}}]),n}()).prototype,"enable",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=L(cu.prototype,"color",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ca}}),cu))||cu);U._RF.pop(),U._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var cT,cC,cA,c_,cP,cI,cB,cR,cE,cL,cO,cN,cF=$.ccclass,cD=$.property,cM=(cp=cF("LimitVelocityOvertimeModule"),cd=cD({type:ev}),cf=cD({type:u9}),cy=cD({type:u9}),cp((cm=L((cv=function(){function n(){o(this,n),O(this,"enable",cm,this),O(this,"limit",cg,this),O(this,"dampen",cb,this),this.limit.constant=500,this.dampen.constant=.2}return a(n,[{key:"update",value:function(a,o){if(this.enable){var C=1-a.remainingLifetime/a.startLifetime,A=a.velocity.clone().normalize(),P=ap(this.limit)?eU(a.randomSeed+23541):0,I=ap(this.dampen)?eU(a.randomSeed+23541+1):0,B=a.velocity.length(),R=this.limit.evaluate(C,P),E=this.dampen.evaluate(C,I);a.velocity=A.multiplyScalar(this.dampenBeyondLimit(B,R,E,o))}}},{key:"dampenBeyondLimit",value:function(a,o,C,A){if(a<=o)return a;var P=1-Math.exp(-C*A);return V.lerp(a,o,P)}}]),n}()).prototype,"enable",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cg=L(cv.prototype,"limit",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),cb=L(cv.prototype,"dampen",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),cv))||cv);U._RF.pop(),U._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var cx,cz,cG,cq,cU,cH,cW,cV,cK,cY,cj,cX,cJ,cZ,cQ,c$,c0,c1,c2,c3,c4,c5,c6=$.ccclass,c7=$.property,c8=(cT=c6("RotationOvertimeModule"),cC=c7({type:ev}),cA=c7(ev),c_=c7({type:u9,visible:function(){return this.separateAxes}}),cP=c7({type:u9,visible:function(){return this.separateAxes}}),cI=c7({type:u9}),cT((cR=L((cB=function(){function n(){o(this,n),O(this,"enable",cR,this),O(this,"separateAxes",cE,this),O(this,"x",cL,this),O(this,"y",cO,this),O(this,"z",cN,this)}return a(n,[{key:"update",value:function(a,o){if(this.enable){var C=1-a.remainingLifetime/a.startLifetime,A=a.randomSeed+125292,P=ap(this.z)?eU(A):0,I=this.z.evaluate(C,P)*o,B=0,R=0;if(this.separateAxes){var E=ap(this.x)?eU(A):0,L=ap(this.y)?eU(A):0;B=this.x.evaluate(C,E)*o,R=this.y.evaluate(C,L)*o}a.rotation.add3f(B,R,I)}}}]),n}()).prototype,"enable",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cE=L(cB.prototype,"separateAxes",[cA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cL=L(cB.prototype,"x",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),cO=L(cB.prototype,"y",[cP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),cN=L(cB.prototype,"z",[cI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),cB))||cB);U._RF.pop(),U._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var c9,he,ht,hi,hr,ha,ho,hs,hl,hu,hc,hh,hp=$.ccclass,hd=$.property,hf=eL({Circle:0,Rectangle:1}),hy=eL({Base:0,Edge:1}),xd=function(){return this.shape===hf.Circle},zd=function(){return this.shape===hf.Rectangle},hv=[0,0],hm=(cx=hp("ShapeModule"),cz=hd({type:eL(hf)}),cG=hd({type:eL(hy),visible:zd}),cq=hd({}),cU=hd({}),cH=hd({}),cW=hd({range:[0,360],visible:xd}),cV=hd({range:[-360,360],visible:xd}),cK=hd({min:0,visible:xd}),cY=hd({range:[0,1],step:.01,visible:xd}),cj=hd({visible:zd}),cx((cJ=L((cX=function(){function n(){o(this,n),O(this,"shape",cJ,this),O(this,"emitFrom",cZ,this),O(this,"position",cQ,this),O(this,"rotation",c$,this),O(this,"scale",c0,this),O(this,"arc",c1,this),O(this,"angle",c2,this),O(this,"radius",c3,this),O(this,"radiusThickness",c4,this),O(this,"rectangleThickness",c5,this)}return a(n,[{key:"emit",value:function(a){switch(this.shape){case hf.Circle:this.circleEmit(this.radius,this.radiusThickness,eH(this.generateArcAngle()),a);break;case hf.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,a)}}},{key:"circleEmit",value:function(a,o,C,A){var P=A.pos;ip(P,a*(1-o),a,C+eH(this.angle)),A.velocity=P.clone().normalize()}},{key:"rectangleEmit",value:function(a,o,C){var A,P=C.pos;switch(a){case hy.Base:H.set(P,eG(-o.x,o.x),eG(-o.y,o.y));break;case hy.Edge:hv[0]=eG(-1,1),hv[1]=(0===(A=eG(-1,1))&&A++,ex.sign(A)),function(a){for(var o=0;o<a.length;o++){var C=o+eq(0,a.length-o),A=a[C];a[C]=a[o],a[o]=A}}(hv),this.applyRectThickness(hv,o),H.set(P,hv[0],hv[1])}C.velocity=P.clone().normalize()}},{key:"generateArcAngle",value:function(){return eG(0,this.arc)}},{key:"applyRectThickness",value:function(a,o){o.x>0&&(a[0]*=o.x),o.y>0&&(a[1]*=o.y)}},{key:"gizmo",value:function(a){switch(a.strokeColor.fromHEX("#46C4FFB0"),a.fillColor.fromHEX("#46C4FF77"),a.lineWidth=8,this.shape){case hf.Circle:this.gizmoCircle(a);break;case hf.Rectangle:this.gizmoRectangle(a)}}},{key:"gizmoCircle",value:function(a){a.clear();var o=this.angle,C=this.angle+this.arc;if(this.createArcPath(a,this.radius,o,C),this.createArcPath(a,this.radius*(1-this.radiusThickness),o,C),this.arc<360&&this.radius>0){var A=this.radius*Math.cos(eH(this.angle)),P=this.radius*Math.sin(eH(this.angle)),I=this.radius*Math.cos(eH(this.arc+this.angle)),B=this.radius*Math.sin(eH(this.arc+this.angle));a.moveTo(A,P),a.lineTo(0,0),a.moveTo(I,B),a.lineTo(0,0)}a.stroke()}},{key:"gizmoRectangle",value:function(a){a.clear();var o=this.rectangleThickness.x,C=this.rectangleThickness.y;a.moveTo(o,C),a.lineTo(-o,C),a.lineTo(-o,-C),a.lineTo(o,-C),a.close(),a.stroke()}},{key:"createArcPath",value:function(a,o,C,A){if(!(o<=0))for(var P=(A-C)/48,I=0;I<=48;I++){var B=C+I*P,R=o*Math.cos(eH(B)),E=o*Math.sin(eH(B));0===I?a.moveTo(R,E):a.lineTo(R,E)}}}]),n}()).prototype,"shape",[cz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hf.Circle}}),cZ=L(cX.prototype,"emitFrom",[cG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hy.Base}}),cQ=L(cX.prototype,"position",[cq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(0,0,0)}}),c$=L(cX.prototype,"rotation",[cU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(0,0,0)}}),c0=L(cX.prototype,"scale",[cH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(1,1,1)}}),c1=L(cX.prototype,"arc",[cW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),c2=L(cX.prototype,"angle",[cV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),c3=L(cX.prototype,"radius",[cK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),c4=L(cX.prototype,"radiusThickness",[cY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),c5=L(cX.prototype,"rectangleThickness",[cj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new H(20,50)}}),cX))||cX);U._RF.pop(),U._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var hg,hb,hk,hw,hS,hT,hC,hA,h_=$.ccclass,hP=$.property,hI=(c9=h_("SizeOvertimeModule"),he=hP({type:ev}),ht=hP(ev),hi=hP({type:u9,visible:function(){return!this.separateAxes}}),hr=hP({type:u9,visible:function(){return this.separateAxes}}),ha=hP({type:u9,visible:function(){return this.separateAxes}}),c9((hs=L((ho=function(){function n(){o(this,n),O(this,"enable",hs,this),O(this,"separateAxes",hl,this),O(this,"size",hu,this),O(this,"x",hc,this),O(this,"y",hh,this),this.size.constant=1,this.x.constant=1,this.y.constant=1}return a(n,[{key:"update",value:function(a){if(this.enable){var o=1-a.remainingLifetime/a.startLifetime,C=a.randomSeed+39825;if(this.separateAxes){var A=ap(this.x)?eU(C):0,P=ap(this.y)?eU(C):0;a.size.x=a.startSize.x*this.x.evaluate(o,A),a.size.y=a.startSize.y*this.y.evaluate(o,P)}else{var I=ap(this.size)?eU(C):0,B=this.size.evaluate(o,I);ei.multiplyScalar(a.size,a.startSize,B)}}}}]),n}()).prototype,"enable",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hl=L(ho.prototype,"separateAxes",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hu=L(ho.prototype,"size",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),hc=L(ho.prototype,"x",[hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),hh=L(ho.prototype,"y",[ha],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),ho))||ho);U._RF.pop(),U._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var hB,hR,hE,hL,hO,hN,hF,hD,hM,hx,hz,hG,hq,hU,hH,hW,hV,hK,hY,hj,hX,hJ,hZ,hQ,h$,h0,h1,h2,h3,h4,h5,h6,h7,h8,h9,pe,pt,pi,pr,pa,po,ps,pl,pu,pc,ph,pp,pd,pf,py,pv,pm,pg,pb,pk,pw,pS,pC,pA,p_,pP,pI=$.ccclass,pB=$.property,pR=(hg=pI("VelocityOvertimeModule"),hb=pB({type:ev}),hk=pB({type:u9}),hw=pB({type:u9}),hg((hT=L((hS=function(){function n(){o(this,n),O(this,"enable",hT,this),O(this,"x",hC,this),O(this,"y",hA,this),this._temp_v3=new ei,this.x.constant=0,this.y.constant=0}return a(n,[{key:"update",value:function(a,o){if(this.enable){var C=1-a.remainingLifetime/a.startLifetime,A=ap(this.x)?eU(a.randomSeed+197866):0,P=ap(this.y)?eU(a.randomSeed+156497):0,I=ei.set(this._temp_v3,this.x.evaluate(C,A),this.y.evaluate(C,P),0);a.velocity.add(I.multiplyScalar(o))}}}]),n}()).prototype,"enable",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hC=L(hS.prototype,"x",[hk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),hA=L(hS.prototype,"y",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),hS))||hS);U._RF.pop(),U._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var pE,pL,pO,pN,pF,pD,pM,px,pz,pG,pq=$.ccclass,pU=$.property,pH=$.executeInEditMode,pW=$.disallowMultiple,pV=$.playOnFocus,pK=eW.Attr.setClassAttr,pY=eL({World:0,Local:1}),pj=(hB=pq("ParticleSystem"),hR=pH(!0),hE=pW(!0),hL=pV(!0),hO=pU({}),hN=pU({formerlySerializedAs:"preview"}),hF=pU(ev),hD=pU({type:eL(pY)}),hM=pU({formerlySerializedAs:"simulationSpace"}),hx=pU(ek),hz=pU(ev),hG=pU({type:u9}),hq=pU({type:u9}),hU=pU(ca),hH=pU(ev),hW=pU({type:u9,formerlySerializedAs:"startSize"}),hV=pU({type:u9,visible:function(){return this.startSize2D}}),hK=pU({type:u9}),hY=pU(ev),hj=pU({type:u9,visible:function(){return this.startRotation3D}}),hX=pU({type:u9,visible:function(){return this.startRotation3D}}),hJ=pU({type:u9,formerlySerializedAs:"startRotation"}),hZ=pU({type:u9}),hQ=pU({type:u9}),h$=pU({type:hm}),h0=pU({type:pR}),h1=pU({type:hI}),h2=pU({type:c8}),h3=pU({type:cS}),h4=pU({type:cM}),h5=pU(uT),h6=pU({serializable:!0}),h7=pU({type:et}),hB(h8=hR(h8=hE(h8=hL((L((h9=function(P){C(r,P);var I=A(r);function r(){var a;return o(this,r),a=I.call(this),O(a,"_preview",pe,N(a)),O(a,"playOnAwake",pt,N(a)),O(a,"_simulationSpace",pi,N(a)),O(a,"duration",pr,N(a)),O(a,"loop",pa,N(a)),O(a,"startDelay",po,N(a)),O(a,"startLifetime",ps,N(a)),O(a,"startColor",pl,N(a)),O(a,"startSize2D",pu,N(a)),O(a,"startSizeX",pc,N(a)),O(a,"startSizeY",ph,N(a)),O(a,"startSpeed",pp,N(a)),O(a,"startRotation3D",pd,N(a)),O(a,"startRotationX",pf,N(a)),O(a,"startRotationY",py,N(a)),O(a,"startRotationZ",pv,N(a)),O(a,"gravityModifier",pm,N(a)),O(a,"rateOverTime",pg,N(a)),O(a,"shapeModule",pb,N(a)),O(a,"velocityOvertimeModule",pk,N(a)),O(a,"sizeOvertimeModule",pw,N(a)),O(a,"rotationOvertimeModule",pS,N(a)),O(a,"colorOvertimeModule",pC,N(a)),O(a,"limitVelocityOvertimeModule",pA,N(a)),O(a,"bursts",p_,N(a)),O(a,"_spriteFrame",pP,N(a)),a._renderSpriteFrame=null,a._simulator=void 0,a.time=0,a.emitRateTimeCounter=0,a.isPlaying=!1,a.isStopped=!0,a.isEmitting=!1,a.startLifetime.constant=5,a.startSizeX.constant=1,a.startSpeed.constant=5,a.rateOverTime.constant=10,a.initProperties(),a}return a(r,[{key:"preview",get:function(){return this._preview},set:function(a){this._preview=a,a?this._startPreview():this._stopPreview()}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(a){this._simulationSpace=a,this._updateMaterial(),this._updateSimulationSpace()}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(a){this._renderSpriteFrame!==a&&(this._renderSpriteFrame=a,a&&!a._uuid||(this._spriteFrame=a),this._applySpriteFrame())}},{key:"assembler",get:function(){return this._assembler}},{key:"onEnable",value:function(){M(D(r.prototype),"onEnable",this).call(this),this._updateMaterial(),this._updateSimulationSpace()}},{key:"onDestroy",value:function(){M(D(r.prototype),"onDestroy",this).call(this)}},{key:"initProperties",value:function(){this._simulator=new uH(this)}},{key:"onFocusInEditor",value:function(){this._startPreview()}},{key:"onLostFocusInEditor",value:function(){this._stopPreview()}},{key:"_startPreview",value:function(){this._preview&&this.play()}},{key:"_stopPreview",value:function(){this._preview||(this.play(),this.stop())}},{key:"__preload",value:function(){M(D(r.prototype),"__preload",this).call(this),this.spriteFrame&&!this._renderSpriteFrame&&this._applySpriteFrame(),this.playOnAwake&&this.play()}},{key:"start",value:function(){this.node.position=new ei(this.node.position.x,this.node.position.y,100)}},{key:"play",value:function(){this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isStopped=!1,this.isEmitting=!0,this._simulator.reset(),this.markForUpdateRenderData()}},{key:"stop",value:function(){this.isPlaying&&(this.isPlaying=!1),this.isEmitting&&(this.isEmitting=!1),this.isStopped=!0,this._simulator.reset(),this._simulator.stop()}},{key:"_flushAssembler",value:function(){var a=eV.Assembler.getAssembler(this);this._assembler!==a&&(this._assembler=a),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this),this._simulator.renderData.particleInitRenderDrawInfo(this.renderEntity),this._simulator.initDrawInfo())}},{key:"_applySpriteFrame",value:function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator&&this._simulator.updateUVs(!0),this._updateMaterial(),this.isStopped=!1,this.markForUpdateRenderData()):this.stop()}},{key:"_updateMaterial",value:function(){if(this._customMaterial){this.setSharedMaterial(this._customMaterial,0);var a=this.getRenderMaterial(0).passes[0].blendState.targets[0];a&&(this._dstBlendFactor=a.blendDst,this._srcBlendFactor=a.blendSrc)}var o=this.getMaterialInstance(0);o&&o.recompileShaders({USE_LOCAL:this.simulationSpace===pY.Local}),o&&o.passes.length>0&&this._updateBlendFunc()}},{key:"_finishedSimulation",value:function(){this.stop(),this.markForUpdateRenderData()}},{key:"_canRender",value:function(){return M(D(r.prototype),"_canRender",this).call(this)&&!this.isStopped&&null!==this._renderSpriteFrame&&void 0!==this._renderSpriteFrame}},{key:"_render",value:function(a){this.simulationSpace===pY.Local?a.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):this.simulationSpace===pY.World&&a.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)}},{key:"_updateSimulationSpace",value:function(){this.simulationSpace===pY.Local?(this._renderEntity.setRenderTransform(this.node),this._renderEntity.setUseLocal(!0)):this.simulationSpace===pY.World&&(this._renderEntity.setRenderTransform(null),this._renderEntity.setUseLocal(!1))}},{key:"lateUpdate",value:function(a){this.isPlaying&&(this.time+=a,this._simulator.step(a))}},{key:"emitting",value:function(a){var o=this,C=this.startDelay.evaluate(0,1);if(this.time>C&&this.time>this.duration+C&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*a,this.emitRateTimeCounter>1){var A=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=A,this.emit(A,a)}var P,I=E(this.bursts);try{for(I.s();!(P=I.n()).done;)P.value.update(this,a)}catch(a){I.e(a)}finally{I.f()}}var B=this.gravityModifier.evaluate(this.time/this.duration,1);0!==this._simulator.particles.length||this.isEmitting||!this.isPlaying?this._simulator.particles.forEach(function(C,A){o.sizeOvertimeModule.update(C),o.rotationOvertimeModule.update(C,a),o.colorOvertimeModule.update(C),o.velocityOvertimeModule.update(C,a),o.applyGravityModifier(C,B),o.limitVelocityOvertimeModule.update(C,a),C.pos.add(C.velocity.clone().multiplyScalar(a))}):this._finishedSimulation()}},{key:"emit",value:function(a,o){if(null!==this.spriteFrame)for(var C=this.time%this.duration/this.duration,A=0;A<a;A++){var P=this._simulator.emitParticle();if(P.init(),this.shapeModule.emit(P),this.simulationSpace===pY.World){var I=this.node.worldMatrix;P.pos.x+=I.m12,P.pos.y+=I.m13}var B=this.startSpeed.evaluate(C,this.rand());P.velocity.multiplyScalar(B);var R=this.spriteFrame.originalSize;P.width=R.width,P.height=R.height;var E=this.startSizeX.evaluate(C,this.rand()),L=this.startSize2D?new ei(E,this.startSizeY.evaluate(C,this.rand()),1):new ei(E,E,1);P.startSize=L.clone(),P.size=L.clone();var O=this.startRotationZ.evaluate(C,this.rand());P.rotation=this.startRotation3D?new ei(this.startRotationX.evaluate(C,this.rand()),this.startRotationY.evaluate(C,this.rand()),O):new ei(0,0,O),P.startColor=this.startColor.evaluate(C,this.rand()).clone(),P.color=P.startColor.clone(),P.startLifetime=this.startLifetime.evaluate(C,this.rand())+o,P.remainingLifetime=P.startLifetime,P.randomSeed=eq(0,233280)}}},{key:"applyGravityModifier",value:function(a,o){a.velocity.add(new ei(0,-9.8*o,0))}},{key:"rand",value:function(){return eU(eq(0,ex.INT_MAX))}}]),r}(eK)).prototype,"preview",[hO],Object.getOwnPropertyDescriptor(h9.prototype,"preview"),h9.prototype),pe=L(h9.prototype,"_preview",[hN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pt=L(h9.prototype,"playOnAwake",[hF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),L(h9.prototype,"simulationSpace",[hD],Object.getOwnPropertyDescriptor(h9.prototype,"simulationSpace"),h9.prototype),pi=L(h9.prototype,"_simulationSpace",[hM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pY.Local}}),pr=L(h9.prototype,"duration",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),pa=L(h9.prototype,"loop",[hz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),po=L(h9.prototype,"startDelay",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),ps=L(h9.prototype,"startLifetime",[hq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),pl=L(h9.prototype,"startColor",[hU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ca}}),pu=L(h9.prototype,"startSize2D",[hH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pc=L(h9.prototype,"startSizeX",[hW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),ph=L(h9.prototype,"startSizeY",[hV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),pp=L(h9.prototype,"startSpeed",[hK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),pd=L(h9.prototype,"startRotation3D",[hY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pf=L(h9.prototype,"startRotationX",[hj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),py=L(h9.prototype,"startRotationY",[hX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),pv=L(h9.prototype,"startRotationZ",[hJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),pm=L(h9.prototype,"gravityModifier",[hZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),pg=L(h9.prototype,"rateOverTime",[hQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u9}}),pb=L(h9.prototype,"shapeModule",[h$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hm}}),pk=L(h9.prototype,"velocityOvertimeModule",[h0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pR}}),pw=L(h9.prototype,"sizeOvertimeModule",[h1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hI}}),pS=L(h9.prototype,"rotationOvertimeModule",[h2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new c8}}),pC=L(h9.prototype,"colorOvertimeModule",[h3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new cS}}),pA=L(h9.prototype,"limitVelocityOvertimeModule",[h4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new cM}}),p_=L(h9.prototype,"bursts",[pU,h5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pP=L(h9.prototype,"_spriteFrame",[h6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L(h9.prototype,"spriteFrame",[h7],Object.getOwnPropertyDescriptor(h9.prototype,"spriteFrame"),h9.prototype),h8=h9))||h8)||h8)||h8)||h8);pK(pj,"color","visible",!1),U._RF.pop(),U._RF.push({},"aaca8H7JchM8rKFpo1dTb5T","BowlCurrencyHandler",void 0);var pX,pJ,pZ,pQ,p$,p0,p1,p2,p3,p4,p5=$.ccclass,p6=$.property,p7=(pE=p5("BowlCurrencyHandler"),pL=p6(ee),pO=tj.required,pN=p6(pj),pF=tj.required,pD=tj.required,pE((px=L((pM=function(){var C;function n(){o(this,n),O(this,"bowl",px,this),O(this,"flyBowlParticle",pz,this),O(this,"container",pG,this)}return a(n,[{key:"init",value:function(a){this.container=a,this.bowl.setScale(new ei(0,0,1)),tj.validateRequiredProperties(this,n)}},{key:"prepareAnim",value:function(a){this.bowl.setWorldPosition(a),this.bowl.setScale(new ei(1,1,1))}},{key:"hideBowl",value:function(){this.bowl.setScale(new ei(0,0,1))}},{key:"playBowlCurrencyFlyToBarAnim",value:(C=B(function(a){var o,C,A,P,I,R,E,L,O,N,F,D,M,x,z,q;return _ts_generator(this,function(U){switch(U.label){case 0:return o=this,C=a.addCoinCount,A=a.worldDestinationPosition,P=a.onComplete,I=a.vibrate,R=a.playBubbleCurrencyBarAnim,E=a.addAmountToCurrencyBarWithAnimation,L=td.gameScene.rubyBarComp.getOffsetBetweenWidgetTopAndBottom(),O=new ei,this.container.inverseTransformPoint(O,A),O.add(new ei(0,L,0)),this.bowl.active=!0,N=new ei(.3,.3,.3),this.bowl.angle=0,F=Y(this.bowl).to(.3,{scale:N.clone().multiplyScalar(1.75)},{easing:"cubicInOut"}).delay(.5),[4,ts.runTweenAsync(F)];case 1:return U.sent(),D=new ei(this.bowl.position.x+.3*(O.x-this.bowl.position.x)+400,this.bowl.position.y+200,0),M=new ei(this.bowl.position.x+.7*(O.x-this.bowl.position.x)+400,O.y+100,0),this.toggleFlowSmokeEffect(!0),z=Y({t:0}).to(.416,{t:1},{easing:"sineInOut",onUpdate:(x=B(function(a){var C,A,P;return _ts_generator(this,function(I){return A=null!=(C=null==a?void 0:a.t)?C:0,P=ts.calculateBezierPoint(A,o.bowl.position,D,M,O),o.bowl.setPosition(P),[2]})}),function(a){return x.apply(this,arguments)})}),q=Y(this.bowl).to(.416,{scale:new ei(0,0,0).multiplyScalar(.75)},{easing:"sineIn"}),[4,Promise.all([ts.runTweenAsync(z),ts.runTweenAsync(q)])];case 2:return U.sent(),E(C),I(50),th.playSound(tZ.COINS_ADD,{volume:.3}),R(),this.toggleFlowSmokeEffect(!1),this.bowl.active=!1,[4,null==P?void 0:P(O)];case 3:return U.sent(),[2]}})}),function(a){return C.apply(this,arguments)})},{key:"toggleFlowSmokeEffect",value:function(a){a?this.flyBowlParticle.play():this.flyBowlParticle.stop()}}]),n}()).prototype,"bowl",[pL,pO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pz=L(pM.prototype,"flyBowlParticle",[pN,pF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pG=L(pM.prototype,"container",[pD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pM))||pM);U._RF.pop(),U._RF.push({},"27ace/UBCFJB4z108Nxju4I","CurrencyFlyHandler",void 0);var p8,p9,de,dt,di,dr,da,ds,dl,du,dc,dh,dp,dd,df,dy,dv,dm,dg,db,dk,dw,dS,dT,dC,dA,d_,dP,dI,dB,dR,dE,dL,dO,dN,dF,dD=$.ccclass,dM=$.property,dx=(pX=dD("CurrencyFlyHandler"),pJ=dM(eY),pZ=tj.required,pQ=tj.required,p$=dM(eY),p0=tj.required,pX((p2=L((p1=function(){var C,A,P,I;function n(){o(this,n),O(this,"currencyPrefab",p2,this),O(this,"container",p3,this),O(this,"floatingTextPrefab",p4,this),this.instantiatedTexts=[],this.instantiatedCurrencies=[],this.showingItems=[]}return a(n,[{key:"init",value:function(a,o){var C=arguments.length>1&&void 0!==o?o:[];this.container=a,this.showingItems=C,tj.validateRequiredProperties(this,n)}},{key:"spawnCurrency",value:function(){var a=this.instantiatedCurrencies.find(function(a){return!a.active});if(a)return a.active=!0,a;var o=ej(this.currencyPrefab);return this.instantiatedCurrencies.push(o),this.container.addChild(o),(o.getComponent(ea)||o.addComponent(ea)).opacity=0,this.fadeInCurrency(o),o}},{key:"fadeInCurrency",value:function(a){var o=a.getComponent(ea);o&&Y(o).to(.5,{opacity:255},{easing:"quadOut"}).start()}},{key:"hideCurrency",value:function(a){a.active=!1,this.instantiatedCurrencies.includes(a)||(this.instantiatedCurrencies.push(a),this.container.addChild(a))}},{key:"spawnFloatingText",value:function(){var a=this.instantiatedTexts.find(function(a){return!a.active});if(a)return a.active=!0,a;var o=ej(this.floatingTextPrefab);return this.instantiatedTexts.push(o),this.container.addChild(o),o}},{key:"hideFloatingText",value:function(a){a.active=!1,this.instantiatedTexts.includes(a)||(this.instantiatedTexts.push(a),this.container.addChild(a))}},{key:"playCurrencyAnimation",value:(I=B(function(a){var o,C,A,P,I,R,E,L,O,N,F,D,M,x,z,q,U,H;return _ts_generator(this,function(W){switch(W.label){case 0:return A=this,P=a.animationElementCount,I=a.addCoinCount,R=a.worldDestinationPosition,E=a.vibrate,L=a.playScaleUpCurrencyBarAnim,O=a.playScaleDownCurrencyBarAnim,N=a.playBubbleCurrencyBarAnim,F=a.addAmountToCurrencyBarWithAnimation,D=a.playBoosterBurstEffect,th.playSound(tZ.COIN_APPEAR),M=null!=(o=null==(C=this.showingItems.find(function(a){return a.isRuby()}))?void 0:C.node.position)?o:ei.ZERO,x=new ei,this.container.inverseTransformPoint(x,R),z=Array.from({length:P},function(){var a=A.spawnCurrency();return a.setPosition(M),a}),(q=this.spawnFloatingText()).setPosition(M),L(),this.showFloatingText(q,I),U=!1,H=z.map(function(){var a=B(function(a,o){var C,P,B,R,L,O,M,z,q,H;return _ts_generator(this,function(W){switch(W.label){case 0:return[4,A.playIndividualRubyAnimation(a,o)];case 1:return W.sent(),C=a.position.clone(),P=.5+.15*Math.random(),B=(C.x+x.x)/2,R=(C.y+x.y)/2,L=100+50*Math.random(),O=new ei(C.x+.4*(B-C.x),C.y+.7*L,0),M=new ei(B+.6*(x.x-B),R+.3*L,0),z=a.getComponent(ea),q=Y({t:0}).to(P,{t:1},{easing:"sineIn",onUpdate:function(o){var A,P=null!=(A=null==o?void 0:o.t)?A:0,I=ts.calculateBezierPoint(P,C,O,M,x);if(a.setPosition(I),z&&P>.7)z.opacity=255*(1-(P-.7)/.3*.5)}}),H=Y(a).to(P,{scale:new ei(.6,.6,1)},{easing:"sineIn"}),[4,Promise.all([ts.runTweenAsync(q),ts.runTweenAsync(H)])];case 2:return W.sent(),A.hideCurrency(a),null==D||D(x),E(50),th.playSound(tZ.COINS_ADD,{volume:.3}),N(),U||(U=!0,F(I)),[2]}})});return function(o,C){return a.apply(this,arguments)}}()),[4,Promise.all(H)];case 1:return W.sent(),[4,O()];case 2:return W.sent(),[2]}})}),function(a){return I.apply(this,arguments)})},{key:"playIndividualRubyAnimation",value:(P=B(function(a,o){var C,A,P,I,B,R,E,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:return(C=a.getComponent(ea))&&(C.opacity=0),a.setScale(.1,.1,1),A=.036*o,P=.04*Math.random(),[4,ts.waitTweenAsync(A+P)];case 1:if(F.sent(),B=Math.PI/180*(30*o+30*Math.random()),R=65+65*Math.random(),E=a.position.clone().add3f(Math.cos(B)*R,Math.sin(B)*R,0),L=Y(a).to(.2,{position:E},{easing:"cubicOut"}),O=Y(a).to(.2,{scale:new ei(1,1,1)},{easing:"backOut"}),C)N=Y(C).to(.12,{opacity:255},{easing:"cubicOut"}),I=ts.runTweenAsync(N);else I=Promise.resolve();return[4,Promise.all([ts.runTweenAsync(L),ts.runTweenAsync(O),I])];case 2:return F.sent(),[4,this.playRubyFloatingAnimation(a)];case 3:return F.sent(),[2]}})}),function(a,o){return P.apply(this,arguments)})},{key:"playRubyFloatingAnimation",value:(A=B(function(a){var o,C,A,P,I,B,R,E,L,O;return _ts_generator(this,function(N){switch(N.label){case 0:return o=a.position.clone(),C=50+50*Math.random(),A=60*(Math.random()-.5),P=.3+.3*Math.random(),I=60*(Math.random()-.5),B=.05+.05*Math.random(),R=Y(a).to(P,{position:o.clone().add3f(.3*A,.8*-C,0)},{easing:"sineOut"}).to(.5*P,{position:o.clone().add3f(.7*A,.2*-C,0)},{easing:"sineInOut"}),E=Y(a).to(.5*P,{angle:.7*I},{easing:"sineInOut"}).to(.5*P,{angle:I},{easing:"sineInOut"}),L=a.scale.clone(),O=Y(a).to(.4*P,{scale:L.clone().multiplyScalar(1+B)},{easing:"sineInOut"}).to(.6*P,{scale:L.clone().multiplyScalar(1-.5*B)},{easing:"sineInOut"}),[4,Promise.all([ts.runTweenAsync(R),ts.runTweenAsync(E),ts.runTweenAsync(O)])];case 1:return N.sent(),[2]}})}),function(a){return A.apply(this,arguments)})},{key:"showFloatingText",value:(C=B(function(a,o){var C,A,P,I,B,R,E,L;return _ts_generator(this,function(O){switch(O.label){case 0:return C=this,A=a.getComponent(er)||a.addComponent(er),P=a.position.clone(),A&&(A.string="+".concat(o)),a.active=!0,a.setScale(.2,.2,.2),(I=a.getComponent(ea)||a.addComponent(ea)).opacity=0,B=Y(I).to(.6,{opacity:255},{easing:"sineIn"}),R=Y(a).to(.4,{scale:new ei(1,1,1)},{easing:"backOut"}),ts.runTweenAsync(R),E=Y(a).to(1.2,{position:a.position.clone().add(new ei(0,150,0))},{easing:"sineOut"}).call(function(){a.setPosition(P),C.hideFloatingText(a)}),L=Y(I).to(.6,{opacity:0},{easing:"sineOut"}),ts.runTweenAsync(B),[4,ts.runTweenAsync(R)];case 1:return O.sent(),ts.runTweenAsync(E),[4,ts.waitTweenAsync(.6)];case 2:return O.sent(),ts.runTweenAsync(L),[2]}})}),function(a,o){return C.apply(this,arguments)})}]),n}()).prototype,"currencyPrefab",[pJ,pZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p3=L(p1.prototype,"container",[pQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p4=L(p1.prototype,"floatingTextPrefab",[p$,p0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p1))||p1);U._RF.pop(),U._RF.push({},"de767UN21BI3p9ZuZMc2KFu","Item",void 0);var dz,dG,dq,dU,dH,dW,dV,dK=$.ccclass,dY=$.property,dj=$.requireComponent,dX=["basket1","basket2","gemGroup"],dJ=["undo","magicWand","shuffle"],dZ=(p8=dK("Item"),p9=dj(W),de=dj(en),dt=dj(ea),di=dY(er),dr=tj.required,da=dY(en),ds=tj.required,dl=dY(W),du=tj.required,dc=dY(et),dh=tj.required,dp=dY(et),dd=tj.required,df=dY(et),dy=tj.required,dv=dY(et),dm=tj.required,dg=dY(et),db=tj.required,dk=dY(et),dw=tj.required,dS=dY(et),dT=tj.required,p8(dC=p9(dC=de(dC=dt((d_=L((dA=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"quantityLabel",d_,N(a)),O(a,"uiTransform",dP,N(a)),O(a,"sprite",dI,N(a)),O(a,"basketOneSpriteFrame",dB,N(a)),O(a,"basketTwoSpriteFrame",dR,N(a)),O(a,"gemGroupSpriteFrame",dE,N(a)),O(a,"undoSpriteFrame",dL,N(a)),O(a,"magicWandSpriteFrame",dO,N(a)),O(a,"shuffleSpriteFrame",dN,N(a)),O(a,"removeAdsSpriteFrame",dF,N(a)),a.config=void 0,a}return a(u,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,u)}},{key:"setConfig",value:function(a){var o=a.type,C=a.quantity;this.config=a;var A=this.quantityLabel,P=this.uiTransform,I=this.sprite,B=this.getSpriteFrameByType(o),R=B.rect,E=R.width,L=R.height;I.spriteFrame=B,P.setContentSize(E,L),"removeAds"!==o?(A.node.active=!0,A.string="x".concat(C)):A.node.active=!1}},{key:"isRuby",value:function(){var a,o=null==(a=this.config)?void 0:a.type;return!!o&&dX.includes(o)}},{key:"isBooster",value:function(){var a,o=null==(a=this.config)?void 0:a.type;return!!o&&dJ.includes(o)}},{key:"getType",value:function(){var a;return null==(a=this.config)?void 0:a.type}},{key:"getSpriteFrameByType",value:function(a){switch(a){case"basket1":return this.basketOneSpriteFrame;case"basket2":return this.basketTwoSpriteFrame;case"gemGroup":return this.gemGroupSpriteFrame;case"undo":return this.undoSpriteFrame;case"magicWand":return this.magicWandSpriteFrame;case"shuffle":return this.shuffleSpriteFrame;case"removeAds":return this.removeAdsSpriteFrame}}},{key:"prepareFadeIn",value:function(){this.setColorAlpha(this.sprite,0),this.setColorAlpha(this.quantityLabel,255),this.node.setScale(ei.ZERO)}},{key:"fadeIn",value:(R=B(function(){var a,o,C;return _ts_generator(this,function(A){return a=this,o=ts.makeTweenCounter({from:0,to:255,duration:.3,easing:"cubicOut",onUpdate:function(o){a.setColorAlpha(a.sprite,o)}}),C=Y(this.node).to(.3,{scale:ei.ONE},{easing:"backOut"}),[2,Promise.all([ts.runTweenAsync(o),ts.runTweenAsync(C)])]})}),function(){return R.apply(this,arguments)})},{key:"fadeOut",value:(I=B(function(a){var o,C,A;return _ts_generator(this,function(P){return o=this,C="quantity"===a?this.quantityLabel:this.sprite,A=ts.makeTweenCounter({from:255,to:0,duration:.3,easing:"cubicIn",onUpdate:function(a){o.setColorAlpha(C,a)}}),[2,ts.runTweenAsync(A)]})}),function(a){return I.apply(this,arguments)})},{key:"setColorAlpha",value:function(a,o){var C=a.color.clone();C.a=V.clamp(o,0,255),a.color=C}}]),u}(eo)).prototype,"quantityLabel",[di,dr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dP=L(dA.prototype,"uiTransform",[da,ds],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dI=L(dA.prototype,"sprite",[dl,du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dB=L(dA.prototype,"basketOneSpriteFrame",[dc,dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dR=L(dA.prototype,"basketTwoSpriteFrame",[dp,dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dE=L(dA.prototype,"gemGroupSpriteFrame",[df,dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dL=L(dA.prototype,"undoSpriteFrame",[dv,dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dO=L(dA.prototype,"magicWandSpriteFrame",[dg,db],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dN=L(dA.prototype,"shuffleSpriteFrame",[dk,dw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dF=L(dA.prototype,"removeAdsSpriteFrame",[dS,dT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dC=dA))||dC)||dC)||dC)||dC);U._RF.pop(),U._RF.push({},"67d86plMy5JQKFoENNxunKE","ItemFlyHandler",void 0);var dQ,d$,d0,d1,d2,d3=["undo","shuffle","magicWand"],d4=$.ccclass,d5=$.property,d6=(dz=d4("ItemFlyHandler"),dG=d5(eY),dq=tj.required,dU=tj.required,dz((dW=L((dH=function(){var C,A,P;function n(){o(this,n),O(this,"itemPrefab",dW,this),O(this,"container",dV,this),this.showingItems=[],this.instantiatedItems=[]}return a(n,[{key:"init",value:function(a,o){this.container=a,this.showingItems=o,tj.validateRequiredProperties(this,n)}},{key:"spawnItem",value:function(){var a=this.instantiatedItems.find(function(a){return!a.node.active});if(a)return a.node.active=!0,a;var o=ej(this.itemPrefab).getComponent(dZ);return o&&(this.instantiatedItems.push(o),this.container.addChild(o.node)),o}},{key:"playBoosterItemFlyingAnimations",value:(P=B(function(a){var o,C,A,P;return _ts_generator(this,function(I){if(o=this,C=a.destinationComps,A=a.onEachItemComplete,C)return P=this.showingItems.map(function(a){var o=a.getType();return o?d3.includes(o)?{item:a,destinationComponent:C[o]}:void 0:null}).filter(function(a){return!!a}).map(function(){var a=B(function(a,C){var P,I,B,R,E,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:if(P=a.item,I=a.destinationComponent,B=P.node.scale.clone(),!I)return[3,3];return R=new ei,o.container.inverseTransformPoint(R,I.node.worldPosition),L=Math.PI/2-Math.atan2(-(E=R.clone().subtract(P.node.position)).y,E.x),O=V.toDegree(L),N=Y(P.node).delay(.2*C).to(.2,{scale:B.clone().multiplyScalar(1.75),angle:-15},{easing:"sineInOut"}),[4,ts.runTweenAsync(N)];case 1:return F.sent(),[4,Promise.all([Y(P.node).to(.416,{position:R},{easing:"sineIn"}),Y(P.node).to(.416,{scale:B.clone().multiplyScalar(.75)},{easing:"sineInOut"}),Y(P.node).to(.416,{angle:O},{easing:"sineInOut"})].map(function(a){return ts.runTweenAsync(a)}))];case 2:F.sent(),null==A||A(I,R),th.playSound(tZ.CLAIM_REWARD,{allowMultiple:!0}),o.hideItem(P),F.label=3;case 3:return[2]}})});return function(o,C){return a.apply(this,arguments)}}()),[2,Promise.all(P)];return[2]})}),function(a){return P.apply(this,arguments)})},{key:"hideItem",value:function(a){a.node.active=!1,this.instantiatedItems.includes(a)||(this.instantiatedItems.push(a),this.container.addChild(a.node))}},{key:"fadeInItems",value:(A=B(function(){return _ts_generator(this,function(a){return[2,Promise.all(this.showingItems.map(function(){var a=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,a.fadeIn()];case 1:return o.sent(),[2]}})});return function(o){return a.apply(this,arguments)}}()))]})}),function(){return A.apply(this,arguments)})},{key:"fadeOutItems",value:(C=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,Promise.all(this.showingItems.map(function(){var o=B(function(o){return _ts_generator(this,function(C){switch(C.label){case 0:if(o.isBooster())return[2,o.fadeOut("quantity")];return[4,o.fadeOut("all")];case 1:return C.sent(),a.hideItem(o),[2]}})});return function(a){return o.apply(this,arguments)}}()))]})}),function(){return C.apply(this,arguments)})}]),n}()).prototype,"itemPrefab",[dG,dq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dV=L(dH.prototype,"container",[dU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dH))||dH);U._RF.pop(),U._RF.push({},"bc81dVZqZpHmYaICfQy4Gio","BoosterBurstVFX",void 0);var d7,d8,d9,fe,ft,fi=$.ccclass,fr=$.property,fa=(dQ=fi("BoosterBurstVFX"),d$=fr([eV]),d0=tj.required(ni(eV)),dQ((d2=L((d1=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"effects",d2,N(a)),a.onCompleteCallback=null,a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"playVfx",value:function(a){this.onCompleteCallback=null!=a?a:null,this.node.active=!0,this.resetVFX(),this.checkAllParticlesStopped()}},{key:"resetVFX",value:function(){var a,o=E(this.effects);try{for(o.s();!(a=o.n()).done;)a.value.resetSystem()}catch(a){o.e(a)}finally{o.f()}}},{key:"checkAllParticlesStopped",value:function(){this.effects.every(function(a){return a.stopped})?this.onAllParticlesStopped():(this.unschedule(this.checkAllParticlesStopped),this.scheduleOnce(this.checkAllParticlesStopped,.1))}},{key:"onAllParticlesStopped",value:function(){this.onCompleteCallback&&(this.onCompleteCallback(),this.onCompleteCallback=null),this.node.active=!1}}]),r}(eo)).prototype,"effects",[d$,d0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),d1))||d1);U._RF.pop(),U._RF.push({},"49514Fk06VDFJHu+2pg145J","RubiesBurstVFX",void 0);var fo,fs,fl,fu,fc,fh,fp,fd,ff,fy,fv,fm,fg,fb=$.ccclass,fk=$.property,fw=(d7=fb("RubiesBurstVFX"),d8=fk([eV]),d9=tj.required(ni(eV)),d7((ft=L((fe=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"effects",ft,N(a)),a.onCompleteCallback=null,a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"playVfx",value:function(a){this.onCompleteCallback=null!=a?a:null,this.node.active=!0,this.resetVFX(),this.checkAllParticlesStopped()}},{key:"resetVFX",value:function(){var a,o=E(this.effects);try{for(o.s();!(a=o.n()).done;)a.value.resetSystem()}catch(a){o.e(a)}finally{o.f()}}},{key:"checkAllParticlesStopped",value:function(){this.effects.every(function(a){return a.stopped})?this.onAllParticlesStopped():(this.unschedule(this.checkAllParticlesStopped),this.scheduleOnce(this.checkAllParticlesStopped,.1))}},{key:"onAllParticlesStopped",value:function(){this.onCompleteCallback&&(this.onCompleteCallback(),this.onCompleteCallback=null),this.node.active=!1}}]),r}(eo)).prototype,"effects",[d8,d9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fe))||fe);U._RF.pop(),U._RF.push({},"c6a253mgE5Fg4qrEv2hKl4m","PurchaseEffectHandler",void 0);var fS,fT,fC,fA,f_,fP,fI,fB,fR=$.ccclass,fE=$.property,fL=(fo=fR("PurchaseEffectHandler"),fs=fE(eY),fl=tj.required,fu=fE(eY),fc=tj.required,fh=fE(eY),fp=tj.required,fd=tj.required,fo((fy=L((ff=function(){function n(){o(this,n),O(this,"rubiesBurstParticlePrefab",fy,this),O(this,"glowParticlePrefab",fv,this),O(this,"boosterBurstParticlePrefab",fm,this),O(this,"container",fg,this),this.boosterBurstPool=[],this.rubiesBurstPool=[],this.glowNodes=[]}return a(n,[{key:"init",value:function(a){this.container=a,tj.validateRequiredProperties(this,n)}},{key:"playBoosterBurstEffect",value:function(a){var o=this;return new Promise(function(C){var A=o.boosterBurstPool.find(function(a){return!a.node.active});if(!A){var P,I=ej(o.boosterBurstParticlePrefab);(A=null!=(P=I.getComponent(fa))?P:void 0)&&(o.boosterBurstPool.push(A),o.container.addChild(I),A.node.active=!1)}A?(A.node.setPosition(a),A.playVfx(function(){C()})):C()})}},{key:"playRubiesBurstEffect",value:function(a){var o=this;return new Promise(function(C){var A=o.rubiesBurstPool.find(function(a){return!a.node.active});if(!A){var P,I=ej(o.rubiesBurstParticlePrefab);(A=null!=(P=I.getComponent(fw))?P:void 0)&&(o.rubiesBurstPool.push(A),o.container.addChild(I),A.node.active=!1)}A?(A.node.setPosition(a),A.playVfx(function(){C()})):C()})}},{key:"attachGlowEffectToItem",value:function(a){var o=ej(this.glowParticlePrefab);o.setPosition(a.position),o.setScale(new ei(2,1.75,1)),this.container.insertChild(o,1),this.glowNodes.push(o)}},{key:"removeGlowEffects",value:function(){var a,o=E(this.glowNodes);try{for(o.s();!(a=o.n()).done;){var C=a.value;null!=C&&C.isValid&&C.destroy()}}catch(a){o.e(a)}finally{o.f()}this.glowNodes=[]}}]),n}()).prototype,"rubiesBurstParticlePrefab",[fs,fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fv=L(ff.prototype,"glowParticlePrefab",[fu,fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=L(ff.prototype,"boosterBurstParticlePrefab",[fh,fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fg=L(ff.prototype,"container",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ff))||ff);U._RF.pop(),U._RF.push({},"72d21k0tOZCYYG/k5exRigi","CollectButton",void 0);var fO,fN,fF,fD,fM,fx,fz,fG,fq,fU,fH,fW,fV,fK,fY,fj,fX=$.ccclass,fJ=$.property,fZ=(fS=fX("CollectButton"),fT=fJ(ea),fC=tj.required,fA=fJ(ef),f_=tj.required,fS((fI=L((fP=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"uiOpacity",fI,N(a)),O(a,"collectButton",fB,N(a)),a.pulseTween=void 0,a.onceClick=void 0,a}return a(u,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,u)}},{key:"onLoad",value:function(){this.registryButtonEvents()}},{key:"registryButtonEvents",value:function(){this.node.on(ef.EventType.CLICK,this.handleClick,this)}},{key:"handleClick",value:function(){this.onceClick&&(this.onceClick(),this.onceClick=void 0)}},{key:"fadeIn",value:(R=B(function(){var a,o,C;var A=arguments;return _ts_generator(this,function(P){return a=this,o=A.length>0&&void 0!==A[0]?A[0]:.233,C=Y(this.uiOpacity).to(o,{opacity:255},{easing:"cubicOut"}),[2,new Promise(function(o){C.call(function(){a.startPulseAnimation(),o()}).start()})]})}),function(){return R.apply(this,arguments)})},{key:"fadeOut",value:(I=B(function(){var a,o;var C=arguments;return _ts_generator(this,function(A){return a=C.length>0&&void 0!==C[0]?C[0]:.3,this.stopPulseAnimation(),o=Y(this.uiOpacity).to(a,{opacity:0},{easing:"cubicIn"}),[2,new Promise(function(a){o.call(function(){return a()}).start()})]})}),function(){return I.apply(this,arguments)})},{key:"startPulseAnimation",value:function(){this.stopPulseAnimation(),this.pulseTween=Y(this.node).to(1,{scale:new ei(1.1,1.1,1.1)},{easing:"sineInOut"}).to(1,{scale:new ei(1,1,1)},{easing:"sineInOut"}).union().repeatForever().start(),this.node.on(ey.EventType.TOUCH_CANCEL,this.onTouchCancel,this)}},{key:"stopPulseAnimation",value:function(){this.pulseTween&&(this.pulseTween.stop(),this.pulseTween=void 0),this.node.off(ey.EventType.TOUCH_CANCEL,this.onTouchCancel,this)}},{key:"onTouchCancel",value:function(){var a=this;this.pulseTween&&this.pulseTween.stop(),Y(this.node).to(.1,{scale:new ei(1,1,1)},{easing:"sineIn"}).call(function(){return a.startPulseAnimation()}).start()}},{key:"setOpacity",value:function(a){this.uiOpacity.opacity=a}},{key:"onDestroy",value:function(){this.stopPulseAnimation()}},{key:"toggleInteractable",value:function(a){this.collectButton.interactable=a}}]),u}(eo)).prototype,"uiOpacity",[fT,fC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fB=L(fP.prototype,"collectButton",[fA,f_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fP))||fP);U._RF.pop(),U._RF.push({},"2e985N+ePBHZZE9RwhrH7Pi","PurchaseAnimationContainer",void 0);var fQ,f$,f0,f1,f2=$.ccclass,f3=$.property,f4={super:"basket1",mega:"basket2",normal:"gemGroup"},f5=(fO=f2("PurchaseAnimationContainer"),fN=f3(W),fF=tj.required,fD=f3(fZ),fM=tj.required,fx=f3(dx),fz=f3(d6),fG=f3(p7),fq=f3(fL),fO((fH=L((fU=function(P){C(v,P);var I,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"background",fH,N(a)),O(a,"collectButton",fW,N(a)),O(a,"currencyHandler",fV,N(a)),O(a,"itemFlyHandler",fK,N(a)),O(a,"bowlRubiesHandler",fY,N(a)),O(a,"effectHandler",fj,N(a)),a.showingItems=[],a}return a(v,[{key:"initHandlers",value:function(){this.currencyHandler.init(this.node,this.showingItems),this.itemFlyHandler.init(this.node,this.showingItems),this.bowlRubiesHandler.init(this.node),this.effectHandler.init(this.node)}},{key:"__preload",value:function(){this.setBackgroundSpriteColorAlpha(0),this.collectButton.setOpacity(0),tj.validateRequiredProperties(this,v)}},{key:"onLoad",value:function(){var a=tf.getBannerAdWorldHeight(),o=this.collectButton.getComponent(eX);o&&a>0&&(o.bottom+=a)}},{key:"runAnimations",value:(M=B(function(a){var o,C,A,P,I,B,R,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:if(o=a.data,C=a.currencyFlyConfig,A=a.delay,P=a.itemsFlyConfig,B=void 0!==(I=a.shouldHideCollectButtonBeforeItemsFly)&&I,this.updateData(o),this.prepareFadeIn(),!(A>0))return[3,2];return[4,ts.waitTweenAsync(A)];case 1:F.sent(),F.label=2;case 2:if(this.node.active=!0,void 0===P.destinationComps){P.destinationComps={},L=E(d3);try{for(L.s();!(R=L.n()).done;)O=R.value,N=String(O),P.destinationComps[N]=this.collectButton}catch(a){L.e(a)}finally{L.f()}}return this.registerCollectButtonEvent(P,C,B),[4,Promise.all([this.fadeInBackground(),this.itemFlyHandler.fadeInItems(),this.collectButton.fadeIn()])];case 3:return F.sent(),[2]}})}),function(a){return M.apply(this,arguments)})},{key:"playBoosterBurstEffectAt",value:function(a){this.effectHandler.playBoosterBurstEffect(a)}},{key:"registerCollectButtonEvent",value:function(a,o,C){var A=this;this.collectButton.onceClick=B(function(){return _ts_generator(this,function(P){switch(P.label){case 0:if(A.effectHandler.removeGlowEffects(),A.collectButton.toggleInteractable(!1),!C)return[3,4];return[4,Promise.all([A.fadeOutBackground(),A.itemFlyHandler.fadeOutItems()])];case 1:return P.sent(),[4,Promise.all([A.itemFlyHandler.playBoosterItemFlyingAnimations(a),A.currencyHandler.playCurrencyAnimation(o)])];case 2:return P.sent(),[4,A.collectButton.fadeOut()];case 3:return P.sent(),[3,7];case 4:return[4,Promise.all([A.fadeOutBackground(),A.itemFlyHandler.fadeOutItems(),A.collectButton.fadeOut()])];case 5:return P.sent(),[4,Promise.all([A.currencyHandler.playCurrencyAnimation(o),A.itemFlyHandler.playBoosterItemFlyingAnimations(a)])];case 6:P.sent(),P.label=7;case 7:return A.collectButton.toggleInteractable(!0),A.node.active=!1,[2]}})})}},{key:"updateData",value:function(a){var o,C,A=this,P=a.packType,I=a.coins,B=a.removeAds,L=a.magicWand,O=a.undo,N=a.shuffle,F=[{type:f4[P],quantity:I},{type:"undo",quantity:O},{type:"magicWand",quantity:L},{type:"shuffle",quantity:N},{type:"removeAds",quantity:B?1:0}],D=E(this.showingItems);try{for(D.s();!(C=D.n()).done;){var M=C.value;this.itemFlyHandler.hideItem(M)}}catch(a){D.e(a)}finally{D.f()}var x=F.filter(function(a){return a.quantity>0}).map(function(a){var o=A.itemFlyHandler.spawnItem();return null==o||o.setConfig(a),o}).filter(function(a){return!!a}).map(function(a,o,C){return a.node.setPosition(250*(o-(C.length-1)/2),0,0),a.node.angle=0,A.effectHandler.attachGlowEffectToItem(a.node),a});this.showingItems.length=0,(o=this.showingItems).push.apply(o,R(x))}},{key:"prepareFadeIn",value:function(){this.setBackgroundSpriteColorAlpha(0);var a,o=E(this.showingItems);try{for(o.s();!(a=o.n()).done;)a.value.prepareFadeIn()}catch(a){o.e(a)}finally{o.f()}this.collectButton.setOpacity(0),this.bowlRubiesHandler.hideBowl()}},{key:"runAnimationGetRuby",value:(D=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return this.node.active=!0,[4,this.currencyHandler.playCurrencyAnimation(a)];case 1:return o.sent(),this.node.active=!1,[2]}})}),function(a){return D.apply(this,arguments)})},{key:"runAnimationGetRubyByFreeRubiesScreen",value:(F=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return o=this,C=a.startPosition,this.node.active=!0,this.showingItems.length=0,this.bowlRubiesHandler.prepareAnim(C),a.onComplete=function(){var a=B(function(a){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,Promise.all([o.effectHandler.playBoosterBurstEffect(a),o.effectHandler.playRubiesBurstEffect(a)])];case 1:return C.sent(),[2]}})});return function(o){return a.apply(this,arguments)}}(),[4,this.bowlRubiesHandler.playBowlCurrencyFlyToBarAnim(a)];case 1:return A.sent(),this.node.active=!1,[2]}})}),function(a){return F.apply(this,arguments)})},{key:"fadeInBackground",value:(L=B(function(){var a,o;return _ts_generator(this,function(C){return a=this,o=ts.makeTweenCounter({from:0,to:175,duration:.3,easing:"cubicOut",onUpdate:function(o){a.setBackgroundSpriteColorAlpha(o)}}),[2,ts.runTweenAsync(o)]})}),function(){return L.apply(this,arguments)})},{key:"fadeOutBackground",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){return a=this,o=ts.makeTweenCounter({from:this.background.color.a,to:0,duration:.3,easing:"cubicIn",onUpdate:function(o){a.setBackgroundSpriteColorAlpha(o)}}),[2,ts.runTweenAsync(o)]})}),function(){return I.apply(this,arguments)})},{key:"setBackgroundSpriteColorAlpha",value:function(a){var o=this.background.color.clone();o.a=a,this.background.color=o}}]),v}(eo)).prototype,"background",[fN,fF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fW=L(fU.prototype,"collectButton",[fD,fM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fV=L(fU.prototype,"currencyHandler",[fx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dx}}),fK=L(fU.prototype,"itemFlyHandler",[fz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d6}}),fY=L(fU.prototype,"bowlRubiesHandler",[fG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p7}}),fj=L(fU.prototype,"effectHandler",[fq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fL}}),fU))||fU);U._RF.pop(),U._RF.push({},"e92cbHmqHtCHqcr1jUTnVtO","ExampleBlock",void 0);var f6=$.ccclass,f7=$.property;fQ=f6("ExampleBlock"),f$=f7(er),fQ((f1=L((f0=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"label",f1,N(a)),a}return a(r,[{key:"__preload",value:function(){var a,o,C,A=this;null==(a=this.indexChangeCallbacks)||a.push(function(a){A.label.string="Block ".concat(a)}),null==(o=this.showCallbacks)||o.push(function(){}),null==(C=this.hideCallbacks)||C.push(function(){})}}]),r}(tQ)).prototype,"label",[f$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f0)),U._RF.pop(),U._RF.push({},"8581a+TxhhCfoe5DrPbPmt0","ExampleReuseScroller",void 0),(0,$.ccclass)("ExampleReuseScroller")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"start",value:function(){this.config.children.count=1e3,this.config.depthSort={reverse:!0,startDepth:1},this.init()}}]),r}(t$)),U._RF.pop(),U._RF.push({},"5ace3kRZV5OYrbUqvqO7dHL","RubyBar",void 0);var f8,f9,ye,yt,yi,yr,ya,yo,ys,yl,yu,yc,yh,yp,yd,yf,yy,yv,ym,yg,yb,yk,yw,yS,yT,yC,yA,y_,yP,yI,yB,yR,yE,yL,yO,yN,yF,yD,yM,yx,yz,yG,yq,yU,yH,yW=$.ccclass,yV=$.property,yK=$.requireComponent,yY={default:0,"challenge-friend":0},yj={show:0,hide:0},yX=(f8=yW("RubyBar"),f9=yK(en),ye=yK(eX),yt=yV(ef),yi=tj.required,yr=yV(W),ya=tj.required,yo=yV(W),ys=tj.required,yl=yV(er),yu=tj.required,yc=tj.required,yh=tj.required,yp=tj.required,f8(yd=f9(yd=ye((yy=L((yf=function(P){C(v,P);var I,R,E,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"button",yy,N(a)),O(a,"icon",yv,N(a)),O(a,"plusIcon",ym,N(a)),O(a,"label",yg,N(a)),O(a,"widget",yb,N(a)),O(a,"uiTransform",yk,N(a)),O(a,"labelUITransform",yw,N(a)),a.rubyAmount=0,a.originalWidth=0,a.singleDigitWidth=0,a.spaceBetweenDigits=0,a.isPlayingBubbleAnimation=!1,a.widgetRightType="default",a.showHideTween=void 0,a.widthUpdateAnimationData=void 0,a.rubyAmountUpdateAnimationData=void 0,a.canUpdateRubyAmountAfterSetGameData=!0,a.showHidePlusIconTween=void 0,a.defaultWidth=0,a.offsetBetweenWidgetTopAndBottom=0,a.handleButtonClick=B(function(){return _ts_generator(this,function(a){return[2,td.gameScene.shop.handleOpenShopScreenAsync()]})}),a}return a(v,[{key:"getOffsetBetweenWidgetTopAndBottom",value:function(){return this.offsetBetweenWidgetTopAndBottom}},{key:"getWorldIconPosition",value:function(){return this.icon.node.getWorldPosition()}},{key:"getSize",value:function(){return{width:this.uiTransform.width,height:this.uiTransform.height}}},{key:"getDefaultWidth",value:function(){return this.defaultWidth}},{key:"getRubyAmount",value:function(){return this.rubyAmount}},{key:"setCanUpdateRubyAmountAfterSetGameData",value:function(a){this.canUpdateRubyAmountAfterSetGameData=a}},{key:"__preload",value:function(){var a=this;this.widget=this.getComponent(eX),this.uiTransform=this.getComponent(en),yY.default=this.widget.right,yY["challenge-friend"]=this.widget.right,yj.show=this.widget.top,yj.hide=-this.uiTransform.height-5,this.offsetBetweenWidgetTopAndBottom=yj.hide-yj.show,this.labelUITransform=this.label.getComponent(en),this.originalWidth=this.uiTransform.width;var o=this.computeSingleDigitWidthAndSpaceBetweenDigits(),C=o.singleDigitWidth,A=o.spaceBetweenDigits;this.singleDigitWidth=C,this.spaceBetweenDigits=A,this.computeDefaultWidth();var P=td.gameScene.gamePlay.gameDataManager,I=P.getCoins();this.setRubyAmountWithoutAnimation(I),tj.validateRequiredProperties(this,v),P.setCBAfterSetGameData(function(){if(a.canUpdateRubyAmountAfterSetGameData){var o=P.getCoins();a.setRubyAmountWithAnimation(o)}}),this.widget.top=yj.hide}},{key:"computeDefaultWidth",value:function(){this.defaultWidth=this.computeUITransformWidth(1e3)}},{key:"onLoad",value:function(){this.registerEvents()}},{key:"registerEvents",value:function(){this.button.node.on(ef.EventType.CLICK,this.handleButtonClick)}},{key:"showPlusIcon",value:(M=B(function(){var a,o;return _ts_generator(this,function(C){return null==(a=this.showHidePlusIconTween)||a.stop(),o=Y(this.plusIcon.node).to(.2,{scale:ei.ONE},{easing:"backOut"}),[2,(this.showHidePlusIconTween=o,ts.runTweenAsync(o))]})}),function(){return M.apply(this,arguments)})},{key:"hidePlusIcon",value:(D=B(function(){var a,o;return _ts_generator(this,function(C){return null==(a=this.showHidePlusIconTween)||a.stop(),o=Y(this.plusIcon.node).to(.2,{scale:ei.ZERO},{easing:"backIn"}),[2,(this.showHidePlusIconTween=o,ts.runTweenAsync(o))]})}),function(){return D.apply(this,arguments)})},{key:"playBubbleAnimation",value:function(){var a=this;if(!this.isPlayingBubbleAnimation){this.isPlayingBubbleAnimation=!0;var o=this.icon.node,C=Y(o).to(.1,{scale:new ei(1.1,1.1,1)}),A=Y(o).to(.1,{scale:ei.ONE});Y(o).sequence(C,A).repeat(1).call(function(){a.isPlayingBubbleAnimation=!1}).start()}}},{key:"playScaleUpAnimation",value:(F=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.node).to(.3,{scale:new ei(1.05,1.05,1)},{easing:"cubicOut"}),[2,ts.runTweenAsync(a)]})}),function(){return F.apply(this,arguments)})},{key:"playScaleDownAnimation",value:(L=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.node).to(.3,{scale:ei.ONE},{easing:"cubicIn"}),[2,ts.runTweenAsync(a)]})}),function(){return L.apply(this,arguments)})},{key:"setWidgetRightType",value:function(a){this.widgetRightType!==a&&(this.widgetRightType=a,this.widget.right=yY[a])}},{key:"runWidgetRightTypeUpdateAnimation",value:(E=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:if(!(this.widgetRightType!==a))return[3,3];return this.widgetRightType=a,[4,this.runHideAnimationAsync()];case 1:return o.sent(),this.widget.right=yY[a],[4,this.runShowAnimationAsync()];case 2:o.sent(),o.label=3;case 3:return[2]}})}),function(a){return E.apply(this,arguments)})},{key:"runHideAnimationAsync",value:(R=B(function(){var a,o,C,A,P,I;var B=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:return A=void 0===(C=(o=B.length>0&&void 0!==B[0]?B[0]:{}).delay)?0:C,I=void 0!==(P=o.shouldHideByInactive)&&P,null==(a=this.showHideTween)||a.stop(),this.showHideTween=Y(this.widget).delay(A).to(.2,{top:yj.hide},{easing:"backIn"}),[4,ts.runTweenAsync(this.showHideTween)];case 1:return R.sent(),I&&(this.node.active=!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"runShowAnimationAsync",value:(I=B(function(){var a,o;var C=arguments;return _ts_generator(this,function(A){if(o=C.length>0&&void 0!==C[0]?C[0]:0,null==(a=this.showHideTween)||a.stop(),td.gameScene.shop.canShowShopAndRubyBar())return[2,(this.node.active||(this.node.active=!0),this.showHideTween=Y(this.widget).delay(o).to(.2,{top:yj.show},{easing:"backOut"}),ts.runTweenAsync(this.showHideTween))];return this.showHideTween=void 0,[2]})}),function(){return I.apply(this,arguments)})},{key:"computeSingleDigitWidthAndSpaceBetweenDigits",value:function(){var a=0..toString(),o=this.label,C=this.labelUITransform,A=o.string;o.string=a;var P=C.width;o.string=a+a;var I=C.width-P;return o.string=A,{singleDigitWidth:P,spaceBetweenDigits:I}}},{key:"addRubyAmountWithAnimation",value:function(a){var o=this.rubyAmount+a;this.setRubyAmountWithAnimation(o)}},{key:"setRubyAmountWithoutAnimation",value:function(a){this.rubyAmount=a,this.label.string=a.toString();var o=this.computeUITransformWidth(a),C=this.label.getComponent(eX);if(o<this.defaultWidth)this.uiTransform.width=this.defaultWidth,C.left=123-10*(a.toString().length-1);else this.uiTransform.width=o,C.left=86}},{key:"setRubyAmountWithAnimation",value:function(a){var o=this.computeUITransformWidth(a),C=this.label.getComponent(eX);if(o<this.defaultWidth)C.left=123-10*(a.toString().length-1),o=this.defaultWidth;else C.left=86;this.runRubyAmountUpdateAnimation(a),this.runWidthUpdateAnimation(o)}},{key:"computeUITransformWidth",value:function(a){var o=this.computeLabelWidth(a),C=this.computeLabelWidth(0);return this.originalWidth+(o-C)}},{key:"computeLabelWidth",value:function(a){var o=a.toString();return this.singleDigitWidth*o.length+this.spaceBetweenDigits*(o.length-1)}},{key:"runWidthUpdateAnimation",value:function(a){var o,C,A=this;if((null==(o=this.widthUpdateAnimationData)?void 0:o.value)!==a){null==(C=this.widthUpdateAnimationData)||C.anim.stop();var P=this.uiTransform,I=Y(P).to(.5,{width:a},{easing:P.width<a?"backOut":"backIn"}).call(function(){A.widthUpdateAnimationData=void 0}).start();this.widthUpdateAnimationData={value:a,anim:I}}}},{key:"runRubyAmountUpdateAnimation",value:function(a){var o,C,A=this;if((null==(o=this.rubyAmountUpdateAnimationData)?void 0:o.value)!==a){null==(C=this.rubyAmountUpdateAnimationData)||C.anim.stop();var P=ts.makeTweenCounter({from:this.rubyAmount,to:a,duration:.5,easing:"linear",onUpdate:function(a){var o=Math.floor(a);A.rubyAmount=o,A.label.string=o.toString()}}).call(function(){A.rubyAmount=a,A.rubyAmountUpdateAnimationData=void 0}).start();this.rubyAmountUpdateAnimationData={value:a,anim:P}}}},{key:"getUITransform",value:function(){return this.uiTransform}}]),v}(eo)).prototype,"button",[yt,yi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yv=L(yf.prototype,"icon",[yr,ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym=L(yf.prototype,"plusIcon",[yo,ys],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yg=L(yf.prototype,"label",[yl,yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yb=L(yf.prototype,"widget",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yk=L(yf.prototype,"uiTransform",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yw=L(yf.prototype,"labelUITransform",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd=yf))||yd)||yd)||yd);U._RF.pop(),U._RF.push({},"c84ecgkkvpHl6qlwVwmwAmT","VelocityScroller",void 0);var yJ,yZ=$.ccclass,yQ=$.property,y$="scroll-update-continuous",y0="scroll-update-discrete",y1=(yS=yZ("VelocityScroller"),yT=yQ(ek),yC=yQ(ek),yA=yQ(ek),y_=yQ(ek),yP=yQ(ek),yI=yQ(ee),yB=tj.required,yR=yQ(en),yE=tj.required,yL=tj.required,yO=tj.required,yS((yF=L((yN=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"acceleration",yF,N(a)),O(a,"scrollingSpeed",yD,N(a)),O(a,"mouseScrollingSpeed",yM,N(a)),O(a,"maxBounceHeight",yx,N(a)),O(a,"outRangeDecayFactor",yz,N(a)),O(a,"content",yG,N(a)),O(a,"viewPort",yq,N(a)),O(a,"contentUITransform",yU,N(a)),O(a,"scrollerUITransform",yH,N(a)),a.lastTouchPos=new H,a.lastTouchMovePos=new H,a.velocity=new H,a.isTouching=!1,a.isStartFromBottom=!0,a.isFreeControl=!1,a.bottomBorder=0,a.topBorder=0,a.startTime=0,a.prevContentPosY=0,a.prevContentPosY2=0,a.originalContentHeight=0,a.originalViewPortHeight=0,a.originalTopBorder=0,a.originalBottomBorder=0,a}return a(r,[{key:"__preload",value:function(){this.registerEvents(),this.initializeComponents(),this.initData()}},{key:"registerEvents",value:function(){ep.on(tl.VIEW_RESIZED,this.handleScrollerWhenResize,this),this.node.on(ee.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(ee.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(ee.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(ee.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.node.on(ee.EventType.MOUSE_WHEEL,this.onMouseScrolling,this)}},{key:"handleScrollerWhenResize",value:function(){this.setUpBorders()}},{key:"addBorderAmount",value:function(a){this.isStartFromBottom?this.bottomBorder=this.originalBottomBorder-a:(this.topBorder=this.originalTopBorder+a,this.bottomBorder=this.originalBottomBorder+a)}},{key:"initData",value:function(){this.originalViewPortHeight=this.scrollerUITransform.height,this.originalContentHeight=this.contentUITransform.height}},{key:"setFreeControl",value:function(a){this.isFreeControl=a}},{key:"initScroller",value:function(a){var o=a.isStartFromBottom,C=a.isAddedHeight,A=a.height;this.isStartFromBottom=o,this.contentUITransform.height=C?this.originalContentHeight+A:A,this.setUpBorders()}},{key:"addHeightToViewport",value:function(a){this.scrollerUITransform.height=this.originalViewPortHeight+a}},{key:"setUpBorders",value:function(){var a=this.viewPort.node.position.y,o=this.contentUITransform.contentSize.height;this.isStartFromBottom?(this.topBorder=a+this.maxBounceHeight,this.bottomBorder=-(o-Math.abs(a))-this.maxBounceHeight):(this.topBorder=o-Math.abs(a)+this.maxBounceHeight,this.bottomBorder=a-this.maxBounceHeight),this.originalTopBorder=this.topBorder,this.originalBottomBorder=this.bottomBorder}},{key:"initializeComponents",value:function(){this.scrollerUITransform=this.getComponent(en),this.contentUITransform=this.content.getComponent(en),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"onTouchStart",value:function(a){this.isFreeControl||(this.isTouching=!0,this.lastTouchPos=a.getLocation().clone(),this.lastTouchMovePos=a.getLocation().clone(),this.startTime=Date.now())}},{key:"onTouchMove",value:function(a){if(!this.isFreeControl){var o=a.getLocation().clone(),C=o.y-this.lastTouchMovePos.y,A=this.content.position,P=A.x,I=A.y,B=A.z;this.isOutRange()&&(C*=this.outRangeDecayFactor);var R=this.clampTargetY(I+C);this.content.setPosition(P,R,B),this.lastTouchMovePos.set(o.clone())}}},{key:"onTouchEnd",value:function(a){if(!this.isFreeControl&&(this.isTouching=!1,!((Date.now()-this.startTime)/1e3>.2))){var o=a.getLocation().clone(),C=o.y-this.lastTouchPos.y,A=this.velocity.y;this.lastTouchPos.set(o.clone()),this.velocity.set(0,A+C)}}},{key:"onMouseScrolling",value:function(a){if(!this.isFreeControl){var o=a.getScrollY()*this.mouseScrollingSpeed,C=this.velocity.y;this.velocity.set(0,C-o)}}},{key:"update",value:function(a){this.updateScroller(a),this.tryToUpdateContinuousScroller(),this.tryToUpdateDiscreteScroller()}},{key:"tryToUpdateDiscreteScroller",value:function(){this.canDiscreteUpdate()&&this.node.emit(y0)}},{key:"tryToUpdateContinuousScroller",value:function(){this.canContinuousUpdate()&&this.node.emit(y$)}},{key:"canDiscreteUpdate",value:function(){if(!this.content)return!1;var a=this.content.position.y;return!(Math.abs(a-this.prevContentPosY)<=10)&&(this.prevContentPosY=a,!0)}},{key:"canContinuousUpdate",value:function(){if(!this.content)return!1;var a=this.content.position.y;return!(Math.abs(a-this.prevContentPosY2)<=10)&&(this.prevContentPosY2=a,!0)}},{key:"updateScroller",value:function(a){if(!this.isFreeControl&&!this.tryToBounceBack(a)){var o=this.content.position,C=o.x,A=o.y,P=o.z,I=this.velocity.y,B=A+I*this.scrollingSpeed*a,R=this.getVelocityOverTime(I,a);this.velocity.set(0,R),B>this.topBorder&&(B=this.topBorder,this.velocity.set(0,0)),B<this.bottomBorder&&(B=this.bottomBorder,this.velocity.set(0,0)),B=this.handleClampTargetY(B),this.content.setPosition(C,B,P)}}},{key:"handleClampTargetY",value:function(a){if(this.isOutRange()){var o=this.velocity.y;this.velocity.set(0,o*this.outRangeDecayFactor)}return this.clampTargetY(a)}},{key:"clampTargetY",value:function(a){return a>this.topBorder?(this.velocity.set(0,0),this.topBorder):a<this.bottomBorder?(this.velocity.set(0,0),this.bottomBorder):a}},{key:"tryToBounceBack",value:function(a){var o=this.content.position.y;if(this.isTouching)return!1;var C=this.topBorder-this.maxBounceHeight,A=this.bottomBorder+this.maxBounceHeight;return o>C?(this.moveContentToRealBorder(C,a),this.velocity.set(0,0),!0):o<A&&(this.moveContentToRealBorder(A,a),this.velocity.set(0,0),!0)}},{key:"isOutRange",value:function(){var a=this.content.position.y,o=this.topBorder-this.maxBounceHeight,C=this.bottomBorder+this.maxBounceHeight;return a>o||a<C}},{key:"getVelocityOverTime",value:function(a,o){var C=Math.sign(a),A=Math.abs(a);return A*=Math.exp(this.acceleration*o),this.compareWithSmallestNumber(A)?0:C*A}},{key:"moveContentToRealBorder",value:function(a,o){var C=this.content.position,A=C.x,P=C.y,I=C.z,B=P+(a-P)*this.scrollingSpeed*o;this.compareWithSmallestNumber(B-P)?this.content.setPosition(A,a,I):this.content.setPosition(A,B,I)}},{key:"compareWithSmallestNumber",value:function(a){return Math.abs(a)<.1}},{key:"scrollWithOffset",value:function(a){var o=this.content.position.y+a;this.scrollToTargetY(o)}},{key:"scrollToTargetY",value:function(a){var o=this.content.position,C=o.x,A=o.z,P=a,I=this.topBorder-this.maxBounceHeight,B=this.bottomBorder+this.maxBounceHeight;a>I&&!this.isFreeControl&&(P=I),a<B&&!this.isFreeControl&&(P=B),this.content.setPosition(C,P,A)}},{key:"clampToBottomBorder",value:function(a){return Math.max(a,this.bottomBorder+this.maxBounceHeight)}},{key:"reduceContentHeight",value:function(a){this.contentUITransform.height-=a,this.topBorder-=a}},{key:"addContentHeight",value:function(a){this.contentUITransform.height+=a,this.topBorder+=a}}]),r}(eo)).prototype,"acceleration",[yT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -5}}),yD=L(yN.prototype,"scrollingSpeed",[yC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),yM=L(yN.prototype,"mouseScrollingSpeed",[yA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .2}}),yx=L(yN.prototype,"maxBounceHeight",[y_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 250}}),yz=L(yN.prototype,"outRangeDecayFactor",[yP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .34}}),yG=L(yN.prototype,"content",[yI,yB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yq=L(yN.prototype,"viewPort",[yR,yE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yU=L(yN.prototype,"contentUITransform",[yL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yH=L(yN.prototype,"scrollerUITransform",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yN))||yN);U._RF.pop(),U._RF.push({},"cbb040O6r1E+Ya9pFo++LKi","FakeItem",void 0);var y2,y3=(0,$.ccclass)("FakeItem")(yJ=function(){function n(){o(this,n),this.idx=-1,this.realItem=void 0,this.position=void 0,this.active=!0}return a(n,[{key:"getIdx",value:function(){return this.idx}},{key:"getActive",value:function(){return this.active}},{key:"getRealItem",value:function(){return this.realItem}},{key:"getPosition",value:function(){return this.position}},{key:"setIdx",value:function(a){this.idx=a}},{key:"setRealItem",value:function(a){this.realItem=a}},{key:"setPosition",value:function(a){this.position=a}},{key:"setActive",value:function(a){this.active=a}},{key:"copyFrom",value:function(a){this.active=a.getActive()}},{key:"toggleRealItem",value:function(a){this.realItem.node.active=a}},{key:"isVisible",value:function(){var a=this.realItem.node.getPosition().y;return Math.abs(this.position.y-a)<.1}}]),n}())||yJ;U._RF.pop(),U._RF.push({},"e5ccdo8rdROT7cRjZAjWhAs","RealItem",void 0);var y4,y5,y6,y7,y8,y9,ve,vt,vi,vr,va,vo,vs,vl,vu,vc,vh,vp,vd,vf,vy,vv,vm,vg,vb,vk,vw,vS,vT,vC,vA,v_,vP,vI,vB,vR=(0,$.ccclass)("RealItem")(y2=function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r)}(eo))||y2;U._RF.pop(),U._RF.push({},"0e723I37ElBFq2zY3jU+cqK","ReusableScroller",void 0);var vE=$.ccclass,vL=$.property,vO=(y4=vE("ReusableScroller"),y5=vL(en),y6=tj.required,y7=vL(eY),y8=tj.required,y9=vL(ee),ve=tj.required,vt=vL(ev),vi=vL(ev),vr=vL(eu),va=vL(eu),vo=vL(ek),vs=vL(ek),vl=vL(ek),vu=vL(ek),vc=vL(ek),vh=vL(ek),vp=vL(ev),vd=tj.required,y4((vy=L((vf=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"viewUITransform",vy,N(a)),O(a,"itemPrefab",vv,N(a)),O(a,"content",vm,N(a)),O(a,"isVertical",vg,N(a)),O(a,"isStartFromBottom",vb,N(a)),O(a,"maxRealItems",vk,N(a)),O(a,"borderItems",vw,N(a)),O(a,"distanceBetweenItems",vS,N(a)),O(a,"itemHeight",vT,N(a)),O(a,"offsetHeader",vC,N(a)),O(a,"offsetBottom",vA,N(a)),O(a,"navigationTopBorder",v_,N(a)),O(a,"navigationBottomBorder",vP,N(a)),O(a,"isDebug",vI,N(a)),a.realItems=[],a.fakeItems=[],O(a,"scroller",vB,N(a)),a.graph=void 0,a.shouldUpdateItems=!0,a.originalContentPosY=0,a.originalOffsetHeader=0,a}return a(r,[{key:"setOffsetHeader",value:function(a){this.offsetHeader=a}},{key:"setOffsetBottom",value:function(a){this.offsetBottom=a}},{key:"addOffsetHeader",value:function(a){this.originalOffsetHeader+=a}},{key:"addOffsetBottom",value:function(a){this.offsetBottom+=a}},{key:"getFakeItem",value:function(a){return this.fakeItems[a]}},{key:"__preload",value:function(){this.initData(),this.initComponents(),this.registerEvents()}},{key:"initData",value:function(){this.originalOffsetHeader=this.offsetHeader}},{key:"initComponents",value:function(){this.scroller=this.node.getComponent(y1),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"registerEvents",value:function(){ep.on(tl.VIEW_RESIZED,this.handleScrollerWhenResize,this),this.scroller&&(this.scroller.node.on(y0,this.handleDiscreteScroll,this),this.scroller.node.on(y$,this.handleContinuousScroll,this))}},{key:"handleScrollerWhenResize",value:function(){var a=Math.ceil(this.viewUITransform.contentSize.height/(this.itemHeight+this.distanceBetweenItems)),o=this.maxRealItems-this.borderItems;if(!(a<=o)){this.maxRealItems=a+this.borderItems;for(var C=a-o+1,A=0;A<C;A++){var P=this.createRealItem();this.realItems.push(P);var I=this.distanceBetweenItems+this.itemHeight,B=new ei(0,this.originalContentPosY+-1*(A*I+this.offsetBottom),0);P.node.setPosition(B),P.node.active=!1}for(var R=0;R<this.fakeItems.length;R++){var E=this.fakeItems[R],L=this.realItems[R%this.maxRealItems];E.setRealItem(L)}this.refreshScroller()}}},{key:"onLoad",value:function(){this.originalContentPosY=this.content.position.y}},{key:"reloadMaxRealItems",value:function(){var a=Math.ceil(this.viewUITransform.contentSize.height/(this.itemHeight+this.distanceBetweenItems));this.maxRealItems=a+this.borderItems}},{key:"createRealItems",value:function(){var a=this.isStartFromBottom?1:-1,o=a*this.itemHeight/2;if(!(this.maxRealItems-this.realItems.length<=0))for(var C=this.realItems.length;C<this.maxRealItems;C++){var A=this.createRealItem();this.realItems.push(A);var P=this.distanceBetweenItems+this.itemHeight,I=new ei(0,o+(C*P+this.offsetBottom)*a,0);A.node.setPosition(I),A.node.active=!1}}},{key:"createDebugger",value:function(){this.graph=this.content.addComponent(ew)}},{key:"createRealItem",value:function(){var a=ej(this.itemPrefab);return this.content.addChild(a),a.getComponent(vR)}},{key:"loadScroller",value:function(a){this.offsetHeader=this.originalOffsetHeader,this.reloadMaxRealItems(),this.createRealItems(),this.fakeItems=[];var o=this.content.position,C=o.x,A=o.z;this.content.setPosition(C,this.originalContentPosY,A),this.createFakeItems(a),this.isDebug&&this.createDebugger()}},{key:"createFakeItems",value:function(a){var o=this.isStartFromBottom?1:-1,C=o*this.itemHeight/2,A=a.length;this.toggleRealItems(A>0);for(var P=0;P<A;P++){var I=this.createFakeItem(a[P]),B=this.distanceBetweenItems+this.itemHeight,R=new ei(0,C+(P*B+this.offsetBottom)*o,0);I.setPosition(R),I.setRealItem(this.realItems[P%this.maxRealItems]),this.fakeItems.push(I)}if(A<this.maxRealItems)for(var E=A;E<this.maxRealItems;E++)this.realItems[E].node.active=!1;var L=-1,O=A<this.maxRealItems-this.borderItems;L=O?this.offsetHeader:A*(this.itemHeight+this.distanceBetweenItems)+this.offsetHeader+this.offsetBottom,this.scroller.initScroller({isStartFromBottom:this.isStartFromBottom,isAddedHeight:O,height:L}),this.refreshScroller()}},{key:"createFakeItem",value:function(a){var o=new y3;return o.setIdx(a.idx),o}},{key:"updateFakeItems",value:function(a){for(var o=0;o<a.length;o++)this.fakeItems[o].setIdx(a[o].idx)}},{key:"toggleRealItems",value:function(a){var o,C=E(this.realItems);try{for(C.s();!(o=C.n()).done;)o.value.node.active=a}catch(a){C.e(a)}finally{C.f()}}},{key:"handleDiscreteScroll",value:function(){if(this.shouldUpdateItems){var a=this.getVisibleFakeItems();this.updateScrollItems(a),this.drawDebugLines()}}},{key:"refreshScroller",value:function(){this.handleDiscreteScroll()}},{key:"drawDebugLines",value:function(){if(this.graph){this.graph.clear();var a=this.getVisibleTopBorder(),o=this.getVisibleBottomBorder();this.graph.strokeColor.fromHEX("#FF0000"),this.graph.moveTo(-1e3,a),this.graph.lineTo(1e3,a),this.graph.stroke(),this.graph.strokeColor.fromHEX("#00FF00"),this.graph.moveTo(-1e3,o),this.graph.lineTo(1e3,o),this.graph.stroke()}}},{key:"getVisibleFakeItems",value:function(){var a,o=[],C=this.getVisibleTopBorder(),A=this.getVisibleBottomBorder(),P=E(this.fakeItems);try{for(P.s();!(a=P.n()).done;){var I=a.value,B=I.getPosition().y;B>C||B<A||o.push(I)}}catch(a){P.e(a)}finally{P.f()}return o}},{key:"updateScrollItems",value:function(a){var o,C=E(a);try{for(C.s();!(o=C.n()).done;){var A=o.value;this.updateRealItem(A)}}catch(a){C.e(a)}finally{C.f()}}},{key:"updateRealItem",value:function(a){var o=a.getPosition(),C=a.getRealItem();C.node.active=a.getActive(),C.node.setPosition(o)}},{key:"getVisibleTopBorder",value:function(){var a=this.content.position.y,o=this.viewUITransform.contentSize.height,C=this.itemHeight+this.distanceBetweenItems;return Math.ceil(o/C)*C-a-this.navigationTopBorder}},{key:"getVisibleBottomBorder",value:function(){var a=this.content.position.y,o=this.viewUITransform.contentSize.height,C=this.itemHeight+this.distanceBetweenItems;return-a-Math.ceil(o/C)*C+this.viewUITransform.node.position.y+this.navigationBottomBorder}},{key:"moveToIdx",value:function(a){if(!(a<0||a>=this.fakeItems.length)){var o=(this.getVisibleTopBorder()+this.getVisibleBottomBorder())/2-this.fakeItems[a].getPosition().y;this.scroller.scrollWithOffset(o)}}},{key:"swapItems",value:function(a,o){if(!(a<0||a>=this.fakeItems.length||o<0||o>=this.fakeItems.length)){var C=this.fakeItems[a];this.fakeItems[a]=this.fakeItems[o],this.fakeItems[o]=C}}},{key:"getItemFits",value:function(){return Math.floor(this.viewUITransform.contentSize.height/(this.itemHeight+this.distanceBetweenItems))}},{key:"handleContinuousScroll",value:function(){}},{key:"debugScroller",value:function(){var a,o=E(this.fakeItems);try{for(o.s();!(a=o.n()).done;)a.value}catch(a){o.e(a)}finally{o.f()}}}]),r}(eo)).prototype,"viewUITransform",[y5,y6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vv=L(vf.prototype,"itemPrefab",[y7,y8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=L(vf.prototype,"content",[y9,ve],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vg=L(vf.prototype,"isVertical",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),vb=L(vf.prototype,"isStartFromBottom",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),vk=L(vf.prototype,"maxRealItems",[vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),vw=L(vf.prototype,"borderItems",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),vS=L(vf.prototype,"distanceBetweenItems",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),vT=L(vf.prototype,"itemHeight",[vs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),vC=L(vf.prototype,"offsetHeader",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),vA=L(vf.prototype,"offsetBottom",[vu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),v_=L(vf.prototype,"navigationTopBorder",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),vP=L(vf.prototype,"navigationBottomBorder",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),vI=L(vf.prototype,"isDebug",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vB=L(vf.prototype,"scroller",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vf))||vf);U._RF.pop(),U._RF.push({},"cca6d1OQ/5ClJGijj6z9ZQ6","Scroller",void 0);var vN,vF,vD,vM,vx="scrolling-discrete";U._RF.pop(),U._RF.push({},"4eeb7YVCOVDOrfdBAN4b6J9","SmoothScroller",void 0);var vz,vG,vq,vU,vH,vW,vV,vK,vY,vj,vX,vJ,vZ,vQ,v$,v0,v1,v2,v3,v4,v5,v6,v7=$.ccclass,v8=function(a){return a.SCROLL_ENDED="scroll-ended",a.SCROLLING="scrolling",a.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",a}({}),v9=(vN=v7("SmoothScroller"),vF=tj.required,vN((vM=L((vD=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=R.call.apply(R,[this].concat(A))).headerBorder=0,a.bottomHeader=1139999,a.lastTouchPos=new H,a.currentTouchPos=new H,a.bounceTween=null,a.prevContentPosY=0,a.prevContentPosY2=0,O(a,"contentUITransform",vM,N(a)),a}return a(s,[{key:"__preload",value:function(){this.initComponents()}},{key:"initComponents",value:function(){this.content&&(this.contentUITransform=this.content.getComponent(en),this.validateRequiredComponents())}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,s)}},{key:"onLoad",value:function(){this.node.on(ee.EventType.TOUCH_MOVE,this.onTouchMove,this)}},{key:"update",value:function(a){M(D(s.prototype),"update",this).call(this,a),this.updateContent()}},{key:"updateContent",value:function(){this.canDiscreteUpdate()&&this.node.emit(vx),this.canContinuousUpdate()&&this.node.emit("scrolling-continuous")}},{key:"_handleMoveLogic",value:function(a){this._getLocalAxisAlignDelta(this._deltaPos,a),this._deltaAmount.add(this._deltaPos),this.updateDeltaPos()}},{key:"updateDeltaPos",value:function(){var a=this.getScrollOffset(),o=eP.getVisibleSize().height,C=this.contentUITransform.height-.9*o,A=this._deltaPos.y;if(a.y<.1*-o&&A<0){var P=this._deltaPos,I=P.x,B=P.z;this._deltaAmount.set(I,0,B)}if(a.y>C&&A>0){var R=Math.min(0,this._deltaPos.y+30),E=this._deltaPos,L=E.x,O=E.z;this._deltaAmount.set(L,R,O)}}},{key:"canDiscreteUpdate",value:function(){if(!this.content)return!1;var a=this.content.position.y;return!(Math.abs(a-this.prevContentPosY)<=200)&&(this.prevContentPosY=a,!0)}},{key:"canContinuousUpdate",value:function(){if(!this.content)return!1;var a=this.content.position.y;return!(Math.abs(a-this.prevContentPosY2)<=10)&&(this.prevContentPosY2=a,!0)}},{key:"_onMouseWheel",value:function(a,o){var C=this;if(this.content){var A=-a.getScrollY(),P=this.getMaxScrollOffset(),I=this.getScrollOffset();I.y=V.clamp(I.y+2*A,0,P.y);var B=this.content.position,R=B.x,E=B.y;if(E<=this.headerBorder&&I.y<=0){if(null!=this.bounceTween)return;this.bounceTween=Y(this.content).to(.1,{position:new ei(R,E-10)},{easing:"sineOut"}).call(function(){C.resetBounceTween()}).start()}else if(E>=this.bottomHeader&&I.y>=P.y){if(null!=this.bounceTween)return;this.bounceTween=Y(this.content).to(.1,{position:new ei(R,E+10)},{easing:"sineOut"}).call(function(){C.resetBounceTween()}).start()}this.scrollToOffset(I,3.6)}}},{key:"resetBounceTween",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,ts.waitTweenAsync(.3)];case 1:return a.sent(),this.bounceTween=null,[2]}})}),function(){return I.apply(this,arguments)})},{key:"onTouchMove",value:function(a){this.content&&(this.currentTouchPos.set(a.getLocationX(),a.getLocationY()),this.lastTouchPos.set(a.getLocationX(),a.getLocationY()))}},{key:"_processAutoScrolling",value:function(a){var o=this._isNecessaryAutoScrollBrake(),C=o?.05:1;this._autoScrollAccumulatedTime+=1/C*a;var A=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(A=1-Math.pow(2,-30*A));var P=this._autoScrollTargetDelta.clone();P.multiplyScalar(A);var I=this._autoScrollStartPosition.clone();I.add(P);var B=Math.abs(A-1)<=1e-4;if(Math.abs(A-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(v8.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var R=I.clone();R.subtract(this._autoScrollBrakingStartPosition),o&&R.multiplyScalar(C),I.set(this._autoScrollBrakingStartPosition),I.add(R)}else{var E=I.clone();E.subtract(this.getContentPosition());var L=this._getHowMuchOutOfBoundary(E);L.equals(ei.ZERO,1e-4)||(I.add(L),B=!0)}B&&(this._autoScrolling=!1);var O=I.clone();O.subtract(this.getContentPosition()),this._clampDelta(O),this._moveContent(O,B),this._dispatchEvent(v8.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(v8.SCROLL_ENDED))}}]),s}(eJ)).prototype,"contentUITransform",[vF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vD))||vD);U._RF.pop(),U._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var me,mt,mn,mi,mr,ma,mo,ms,ml,mu,mc,mh,mp,md,mf,my,mv,mm,mg,mb,mk,mw,mS,mT,mC,mA,m_,mP,mI,mB,mR,mE,mL,mO,mN,mF,mD,mM=$.ccclass,mx=$.property,mz=$.requireComponent,mG=globalThis.game.analytics,mq=(vz=mM("SwitchButton"),vG=mz([ef]),vq=mx(ev),vU=mx(ee),vH=tj.required,vW=mx(ee),vV=tj.required,vK=mx(ev),vY=mx(ee),vj=tj.required,vX=mx(ee),vJ=tj.required,vZ=mx({visible:function(){return this.useSound},type:tX}),vz(vQ=vG((v0=L((v$=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"enable",v0,N(a)),O(a,"nodeOn",v1,N(a)),O(a,"nodeOff",v2,N(a)),O(a,"useSound",v3,N(a)),a.originXOn=0,a.originXOff=0,O(a,"switchFrameOn",v4,N(a)),O(a,"switchFrameOff",v5,N(a)),O(a,"soundKey",v6,N(a)),a.slideAnimation=null,a}return a(p,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.originXOn=this.nodeOn.position.x,this.originXOff=this.nodeOff.position.x}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,p)}},{key:"switch",value:(E=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.node.active)return[2,!1];if(mG.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{enable:!this.enable,button_name:aP[this.node.name],screen_name:tp.getCurrentPage()}),this.useSound&&this.soundKey)(a=tJ[this.soundKey])&&th.playSound(a);if(!(o=this.updateStatus(!this.enable)))return[3,2];return[4,this.runSlideAnimation(this.originXOn,this.nodeOn)];case 1:return C.sent(),[3,4];case 2:return[4,this.runSlideAnimation(this.originXOff,this.nodeOff)];case 3:C.sent(),C.label=4;case 4:return[2,o]}})}),function(){return E.apply(this,arguments)})},{key:"setEnabled",value:(R=B(function(a){return _ts_generator(this,function(o){return this.node.active&&this.updateStatus(a),[2]})}),function(a){return R.apply(this,arguments)})},{key:"updateStatus",value:function(a){this.enable=a;var o=this.originXOn,C=this.originXOff;return a?this.nodeOff.position=new ei(o,this.nodeOff.position.y,1):this.nodeOn.position=new ei(C,this.nodeOn.position.y,1),this.nodeOn.active=a,this.nodeOff.active=!a,this.switchFrameOn.active=a,this.switchFrameOff.active=!a,a}},{key:"runSlideAnimation",value:(I=B(function(a,o){var C;return _ts_generator(this,function(A){return C=this,[2,(this.slideAnimation&&this.slideAnimation.stop(),new Promise(function(A){C.slideAnimation=Y(o).to(.3,{position:new ei(a,o.position.y,1)},{easing:"cubicInOut"}).call(function(){A()}).start()}))]})}),function(a,o){return I.apply(this,arguments)})}]),p}(eo)).prototype,"enable",[vq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),v1=L(v$.prototype,"nodeOn",[vU,vH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=L(v$.prototype,"nodeOff",[vW,vV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v3=L(v$.prototype,"useSound",[vK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),v4=L(v$.prototype,"switchFrameOn",[vY,vj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v5=L(v$.prototype,"switchFrameOff",[vX,vJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v6=L(v$.prototype,"soundKey",[vZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tX[tZ.SWITCH]}}),vQ=v$))||vQ)||vQ);U._RF.pop(),U._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var mU=$.ccclass,mH=$.property,mW=$.executeInEditMode,mV=$.disallowMultiple,mK=GameCore,mY=mK.Utils,mj=mY.Signal,mX=(mY.Function,mY.Array),mJ=mK.Events,mZ=globalThis.game,mQ=mZ.language,m$=mZ.event,m0=function(a){return a[a.Text=0]="Text",a[a.Texture=1]="Texture",a}({});eZ(m0);var m1,m2,m3,m4,m5,m6,m7,m8,m9,ge,gt,gn,gi,gr,ga,go,gs="localize-params-updated",gl=(me=mU("LocalizeParams"),mt=mH({visible:!1}),mn=mH(el),me((mr=L((mi=function(){function n(){o(this,n),O(this,"_text",mr,this)}return a(n,[{key:"text",get:function(){return this._text},set:function(a){this._text=a,ep.emit(gs,{text:a,param:this})}}]),n}()).prototype,"_text",[mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),L(mi.prototype,"text",[mn],Object.getOwnPropertyDescriptor(mi.prototype,"text"),mi.prototype),mi))||mi),gu=(ma=mU("Localize"),mo=mW(!0),ms=mH({visible:!1}),ml=mH({type:el,visible:function(){return this.l10nType===m0.Texture}}),mu=mH({visible:!1}),mc=mH({type:eL(m0)}),mh=mH({type:er,visible:function(){return this.l10nType===m0.Text}}),mp=mH({type:[gl],visible:function(){return this.l10nType===m0.Text}}),md=mH({type:W,visible:function(){return this.l10nType===m0.Texture}}),mf=mH({visible:function(){return this.l10nType===m0.Texture}}),my=mH({visible:!1}),mv=mH({type:el}),mm=tj.onlyRunInLifeCycleAsync,mg=tj.onlyRunInLifeCycleAsync,mb=tj.onlyRunInLifeCycleAsync,mk=tj.onlyRunInLifeCycle,mw=tj.onlyRunInLifeCycleAsync,mS=tj.onlyRunInLifeCycleAsync,mT=tj.onlyRunInLifeCycleAsync,mC=tj.onlyRunInLifeCycleAsync,mA=tj.onlyRunInLifeCycle,m_=tj.onlyRunInLifeCycleAsync,ma(mP=mV(mP=mo((mB=L((mI=function(P){C(k,P);var I,R,E,L,F,D,M,x,z,q,U,H=A(k);function k(){var a;o(this,k);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=H.call.apply(H,[this].concat(A))).localized=!1,O(a,"_defaultLocale",mB,N(a)),O(a,"skipFontChange",mR,N(a)),O(a,"_l10nType",mE,N(a)),O(a,"label",mL,N(a)),O(a,"params",mO,N(a)),O(a,"sprite",mN,N(a)),O(a,"packable",mF,N(a)),O(a,"_key",mD,N(a)),a.updateSignalController=new mj.SignalController,a.onLocalizeParamsUpdated=function(o){var C=o.param;mX.has(a.params,C)&&a.updateLocalization()},a.updateLocalization=function(){return a.updateLocalizationComp()},a}return a(k,[{key:"defaultLocale",get:function(){return this._defaultLocale},set:function(a){!function(a){return mX.has(ty,a)}(a)||(this._defaultLocale=a)}},{key:"l10nType",get:function(){return this._l10nType},set:function(a){this._l10nType=a,a===m0.Texture&&(this.label=void 0,this.params=[]),a===m0.Text&&(this.sprite=void 0,this.packable=!0)}},{key:"key",get:function(){return this._key},set:function(a){try{if(!this.isValidKey(a))return;this._key=a,this.updateLocalization()}catch(a){}}},{key:"setParams",value:function(a){for(;this.params.length<a.length;)this.params.push(new gl);for(var o=0,C=this.params.length;o<C;o++){var A,P=this.params[o];P.text=null!=(A=a[o])?A:P.text}}},{key:"waitUntilLocalized",value:function(){var a=this;return this.localized?Promise.resolve():new Promise(function(o){return a.node.once(tl.LOCALIZE_APPLIED,o)})}},{key:"__preload",value:function(){}},{key:"isValidKey",value:function(a){return!!this.isTextKey(a)||!!this.isTextureKey(a)}},{key:"isTextKey",value:function(a){try{return this.l10nType===m0.Text&&mQ.hasTextKey(a)}catch(a){return!1}}},{key:"isTextureKey",value:function(a){try{return this.l10nType===m0.Texture&&mQ.hasTextureKey(a)}catch(a){return!1}}},{key:"onEnable",value:function(){this.listenEvent(),this.updateLocalization()}},{key:"onDisable",value:function(){this.unlistenEvent(),this.updateSignalController.abort()}},{key:"start",value:function(){this.initLocalization()}},{key:"listenEvent",value:function(){m$.on(mJ.LANGUAGE_CHANGED,this.updateLocalization),ep.on(gs,this.onLocalizeParamsUpdated)}},{key:"unlistenEvent",value:function(){m$.off(mJ.LANGUAGE_CHANGED,this.updateLocalization),ep.off(gs,this.onLocalizeParamsUpdated)}},{key:"initLocalization",value:function(){return this.updateLocalizationComp(!0)}},{key:"updateLocalizationComp",value:(U=B(function(){var a,o,C;var A=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:if(a=A.length>0&&void 0!==A[0]&&A[0],!(this.enabledInHierarchy&&void 0!==this.key))return[3,8];o=this.updateSignalController.renew(),P.label=1;case 1:if(P.trys.push([1,7,,8]),this.localized=!1,!this.isTextKey(this.key))return[3,3];return[4,this.updateTextLocalization(this.key,o)];case 2:return P.sent(),[3,6];case 3:if(!this.isTextureKey(this.key))throw new Error("Key ".concat(this.key," not found in locales"));if(C=mQ.getCurrentLocale(),!na&&a&&C===this.defaultLocale)return[3,5];return[4,this.updateTextureLocalization(this.key,o)];case 4:P.sent(),P.label=5;case 5:P.label=6;case 6:if(o.aborted)return[2];return this.localized=!0,ep.emit(tl.LOCALIZE_APPLIED,{localize:this,key:this.key}),this.node.emit(tl.LOCALIZE_APPLIED,{localize:this,key:this.key}),[3,8];case 7:return P.sent(),[3,8];case 8:return[2]}})}),function(){return U.apply(this,arguments)})},{key:"updateTextLocalization",value:(q=B(function(a,o){var C,A,P;return _ts_generator(this,function(o){if(C=mQ.getCurrentLocale(),A=mQ.getText(a,this.params.map(function(a){return a.text}),C),void 0===(P=this.label))throw new Error("Text localize component <".concat(this.node.name,"> has no label"));return P.string=A,[2]})}),function(a,o){return q.apply(this,arguments)})},{key:"setTextFont",value:(z=B(function(a,o,C){return _ts_generator(this,function(A){switch(A.label){case 0:return[4,this.setTextFontRuntime(a,o,C)];case 1:return A.sent(),[2]}})}),function(a,o,C){return z.apply(this,arguments)})},{key:"setTextFontRuntime",value:(x=B(function(a,o,C){var A;return _ts_generator(this,function(P){switch(P.label){case 0:return[4,to.loadFontAsync(o)];case 1:return A=P.sent(),C.aborted||null!==A&&this.setLabelFontInLifeCycle(a,A),[2]}})}),function(a,o,C){return x.apply(this,arguments)})},{key:"setLabelFontInLifeCycle",value:function(a,o){a.font=o}},{key:"setTextFontEditor",value:(M=B(function(a,o,C){var A,P,I,B,R,E,L;return _ts_generator(this,function(O){switch(O.label){case 0:return I=this,[4,this.requestFontUuid(o)];case 1:if(!(null!==(B=O.sent())))return[3,4];return[4,null==(A=C.wrap(function(){return I.requestNodeInfo(a.node.uuid)}))?void 0:A()];case 2:if(!(void 0!==(R=O.sent())))return[3,4];return E=mX.searchIndex(R.__comps__,function(a){return"cc.Label"===a.type}),L="__comps__.".concat(E,".font"),[4,null==(P=C.wrap(function(){return I.requestUpdateLabelFont(a.node.uuid,L,B)}))?void 0:P()];case 3:O.sent(),O.label=4;case 4:return[2]}})}),function(a,o,C){return M.apply(this,arguments)})},{key:"requestFontUuid",value:(D=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,Editor.Message.request("asset-db","query-uuid","db://assets/loadable/".concat(tv[a]))];case 1:return[2,o.sent()]}})}),function(a){return D.apply(this,arguments)})},{key:"requestNodeInfo",value:function(a){return Editor.Message.request("scene","query-node",a)}},{key:"requestUpdateLabelFont",value:(F=B(function(a,o,C){return _ts_generator(this,function(A){switch(A.label){case 0:return[4,Editor.Message.request("scene","set-property",{uuid:a,path:o,dump:{type:"cc.Font",value:{uuid:C}}})];case 1:return A.sent(),[2]}})}),function(a,o,C){return F.apply(this,arguments)})},{key:"updateTextureLocalization",value:(L=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:if(void 0===this.sprite)throw new Error("Texture localize component <".concat(this.node.name,"> has no sprite"));return C=mQ.getTexture(a),[4,this.setSpriteRuntime(this.sprite,C,o)];case 1:return A.sent(),[2]}})}),function(a,o){return L.apply(this,arguments)})},{key:"setSpriteRuntime",value:(E=B(function(a,o,C){var A;return _ts_generator(this,function(P){switch(P.label){case 0:return[4,to.loadSpriteFrameAsync("".concat(o,"/spriteFrame"),this.packable)];case 1:return A=P.sent(),C.aborted||null!==A&&this.setSprite(a,A),[2]}})}),function(a,o,C){return E.apply(this,arguments)})},{key:"setSprite",value:function(a,o){a.spriteFrame=o}},{key:"setSpriteEditor",value:(R=B(function(a,o,C){var A,P,I,B,R,E,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:return I=this,[4,this.requestSpriteFrameInfo(o)];case 1:if(!(0!==(B=F.sent()).length))return[3,6];if(!(B.length>1))return[3,2];return R=B.slice(0,5).map(function(a){return a.path}),"".concat(R.join(",")).concat(R.length<B.length?"...":""),[3,5];case 2:return[4,null==(A=C.wrap(function(){return I.requestNodeInfo(a.node.uuid)}))?void 0:A()];case 3:if(!(void 0!==(E=F.sent())))return[3,5];return L=B[0].uuid,O=mX.searchIndex(E.__comps__,function(a){return"cc.Sprite"===a.type}),N="__comps__.".concat(O,".spriteFrame"),[4,null==(P=C.wrap(function(){return I.requestUpdateSpriteSpriteFrame(a.node.uuid,N,L)}))?void 0:P()];case 4:F.sent(),F.label=5;case 5:return[3,7];case 6:F.label=7;case 7:return[2]}})}),function(a,o,C){return R.apply(this,arguments)})},{key:"requestSpriteFrameInfo",value:function(a){return Editor.Message.request("asset-db","query-assets",{pattern:"db://assets/loadable/".concat(a,"*"),ccType:"cc.SpriteFrame"})}},{key:"requestUpdateSpriteSpriteFrame",value:(I=B(function(a,o,C){return _ts_generator(this,function(A){switch(A.label){case 0:return[4,Editor.Message.request("scene","set-property",{uuid:a,path:o,dump:{type:"cc.SpriteFrame",value:{uuid:C}}})];case 1:return A.sent(),[2]}})}),function(a,o,C){return I.apply(this,arguments)})}]),k}(eo)).prototype,"_defaultLocale",[ms],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"en"}}),mR=L(mI.prototype,"skipFontChange",[mH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L(mI.prototype,"defaultLocale",[ml],Object.getOwnPropertyDescriptor(mI.prototype,"defaultLocale"),mI.prototype),mE=L(mI.prototype,"_l10nType",[mu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m0.Text}}),L(mI.prototype,"l10nType",[mc],Object.getOwnPropertyDescriptor(mI.prototype,"l10nType"),mI.prototype),mL=L(mI.prototype,"label",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mO=L(mI.prototype,"params",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mN=L(mI.prototype,"sprite",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mF=L(mI.prototype,"packable",[mf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),mD=L(mI.prototype,"_key",[my],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L(mI.prototype,"key",[mv],Object.getOwnPropertyDescriptor(mI.prototype,"key"),mI.prototype),L(mI.prototype,"updateTextLocalization",[mm],Object.getOwnPropertyDescriptor(mI.prototype,"updateTextLocalization"),mI.prototype),L(mI.prototype,"setTextFont",[mg],Object.getOwnPropertyDescriptor(mI.prototype,"setTextFont"),mI.prototype),L(mI.prototype,"setTextFontRuntime",[mb],Object.getOwnPropertyDescriptor(mI.prototype,"setTextFontRuntime"),mI.prototype),L(mI.prototype,"setLabelFontInLifeCycle",[mk],Object.getOwnPropertyDescriptor(mI.prototype,"setLabelFontInLifeCycle"),mI.prototype),L(mI.prototype,"setTextFontEditor",[mw],Object.getOwnPropertyDescriptor(mI.prototype,"setTextFontEditor"),mI.prototype),L(mI.prototype,"requestUpdateLabelFont",[mS],Object.getOwnPropertyDescriptor(mI.prototype,"requestUpdateLabelFont"),mI.prototype),L(mI.prototype,"updateTextureLocalization",[mT],Object.getOwnPropertyDescriptor(mI.prototype,"updateTextureLocalization"),mI.prototype),L(mI.prototype,"setSpriteRuntime",[mC],Object.getOwnPropertyDescriptor(mI.prototype,"setSpriteRuntime"),mI.prototype),L(mI.prototype,"setSprite",[mA],Object.getOwnPropertyDescriptor(mI.prototype,"setSprite"),mI.prototype),L(mI.prototype,"setSpriteEditor",[m_],Object.getOwnPropertyDescriptor(mI.prototype,"setSpriteEditor"),mI.prototype),mP=mI))||mP)||mP)||mP);U._RF.pop(),U._RF.push({},"58e17jb3n9LP6677b7ocHg+","LocalizePreloader",void 0);var gc,gh,gp,gd,gf,gy,gv,gm,gg,gb,gk,gw,gS,gT,gC,gA,g_=$.ccclass,gP=$.property,gI=GameCore.Utils,gB=gI.Array,gR=gI.Valid,gE=globalThis.game.language,gL=(m1=g_("LocalizeTextureKey"),m2=gP({visible:!1}),m3=gP(el),m1((m5=L((m4=function(){function n(){o(this,n),O(this,"_key",m5,this)}return a(n,[{key:"key",get:function(){return this._key},set:function(a){gE.hasTextureKey(a)&&(this._key=a)}}]),n}()).prototype,"_key",[m2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),L(m4.prototype,"key",[m3],Object.getOwnPropertyDescriptor(m4.prototype,"key"),m4.prototype),m4))||m4),gO=(m6=g_("SupportedLocaleKey"),m7=gP({visible:!1}),m8=gP(el),m6((ge=L((m9=function(){function n(){o(this,n),O(this,"_key",ge,this)}return a(n,[{key:"key",get:function(){return this._key},set:function(a){gB.has(ty,a)&&(this._key=a)}}]),n}()).prototype,"_key",[m7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),L(m9.prototype,"key",[m8],Object.getOwnPropertyDescriptor(m9.prototype,"key"),m9.prototype),m9))||m9);gt=g_("LocalizePreloader"),gn=gP([gL]),gi=gP({type:gO,tooltip:"Preload only for these locales"}),gt((ga=L((gr=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"keys",ga,N(a)),O(a,"locales",go,N(a)),a}return a(r,[{key:"__preload",value:function(){this.preloadTextures()}},{key:"preloadTextures",value:function(){var a=gE.getCurrentLocale(),o=this.locales.map(function(a){return a.key});if(gB.has(o,a)){var C,A=[],P=E(this.keys);try{for(P.s();!(C=P.n()).done;){var I=C.value;if(!1!==gE.hasTextureKey(I.key)){var B=gE.getTexture(I.key),R="".concat(B,"/spriteFrame");A.push(R)}}}catch(a){P.e(a)}finally{P.f()}to.loadSpriteFramesAsync(A)}else gR.isDebugger()}}]),r}(eo)).prototype,"keys",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),go=L(gr.prototype,"locales",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gr)),U._RF.pop(),U._RF.push({},"0fd01MYjfdD+4IeN6PtQl3m","LocalizedLayout",void 0);var gN,gF,gD,gM,gx,gz,gG,gq,gU,gH,gW,gV,gK,gY,gj,gX,gJ,gZ,gQ=$.ccclass,g$=$.property,g0=$.executeInEditMode,g1=$.disallowMultiple,g2=$.requireComponent;gc=gQ("LocalizedLayout"),gh=g0(!0),gp=g2(en),gd=g$(gu),gf=tj.required(),gy=g$(en),gv=g$({visible:!1}),gm=g$({visible:!1}),gg=g$({type:ek,group:"Padding"}),gb=g$({type:ek,group:"Padding"}),gc(gk=g1(gk=gh(gk=gp((gS=L((gw=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"label",gS,N(a)),O(a,"layout",gT,N(a)),O(a,"_horizontal",gC,N(a)),O(a,"_vertical",gA,N(a)),a.updateContentSize=function(){var o;if(void 0!==a.label){var C=null==(o=a.label.getComponent(en))?void 0:o.contentSize;if(void 0!==C){a.layout.setContentSize(C.width+a.horizontal,C.height+a.vertical);var A,P=a.node.getComponentsInChildren(eX),I=E(P);try{for(I.s();!(A=I.n()).done;)A.value.updateAlignment()}catch(a){I.e(a)}finally{I.f()}}}},a}return a(r,[{key:"horizontal",get:function(){return this._horizontal},set:function(a){this._horizontal=a,this.updateContentSize()}},{key:"vertical",get:function(){return this._vertical},set:function(a){this._vertical=a,this.updateContentSize()}},{key:"__preload",value:function(){this.layout=this.getComponent(en),tj.validateRequiredProperties(this)}},{key:"start",value:function(){this.updateContentSize()}},{key:"onEnable",value:function(){this.listenEvent()}},{key:"onDisable",value:function(){this.unlistenEvent()}},{key:"listenEvent",value:function(){var a;null==(a=this.label)||a.node.on(tl.LOCALIZE_APPLIED,this.updateContentSize)}},{key:"unlistenEvent",value:function(){var a;null==(a=this.label)||a.node.off(tl.LOCALIZE_APPLIED,this.updateContentSize)}}]),r}(eo)).prototype,"label",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gT=L(gw.prototype,"layout",[gf,gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gC=L(gw.prototype,"_horizontal",[gv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gA=L(gw.prototype,"_vertical",[gm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),L(gw.prototype,"horizontal",[gg],Object.getOwnPropertyDescriptor(gw.prototype,"horizontal"),gw.prototype),L(gw.prototype,"vertical",[gb],Object.getOwnPropertyDescriptor(gw.prototype,"vertical"),gw.prototype),gk=gw))||gk)||gk)||gk),U._RF.pop(),U._RF.push({},"409c7rhcDlKvJjOYRCep+vC","SunLabel",void 0);var g3=$.ccclass,g4=$.property,g5=$.requireComponent,g6=$.executeInEditMode,g7=eL({White:0,Black:1,Purple581DBB:2,PurpleB562FF:3,Blue1638A5:4}),g8=(x(gN={},g7.White,[255,255,255,255]),x(gN,g7.Black,[0,0,0,255]),x(gN,g7.Purple581DBB,[88,29,187,255]),x(gN,g7.PurpleB562FF,[181,98,255,255]),x(gN,g7.Blue1638A5,[22,56,165,255]),gN),g9=eL({Default:"Default",GloryBold:"Glory-Bold",GloryExtraBold:"Glory-ExtraBold",GloryMedium:"Glory-Medium",GloryRegular:"Glory-Regular"});function pT(a){var o,C,A=(x(o={},g9.Default,null),x(o,g9.GloryBold,null),x(o,g9.GloryExtraBold,null),x(o,g9.GloryMedium,null),x(o,g9.GloryRegular,null),o),P=E(null!=a?a:[]);try{for(P.s();!(C=P.n()).done;){var I=C.value,B=null==I?void 0:I.name;B&&(B!==g9.GloryBold&&B!==g9.GloryExtraBold&&B!==g9.GloryMedium&&B!==g9.GloryRegular||(A[B]=I))}}catch(a){P.e(a)}finally{P.f()}return A}gF=g3("SunLabel"),gD=g5(gu),gM=g6(!0),gx=g4({visible:!1}),gz=g4({type:g7}),gG=g4({visible:!1}),gq=g4({type:g9}),gU=g4({visible:!1}),gH=g4({type:[eQ]}),gW=g4({visible:!1}),gV=g4(ev),gF(gK=gD(gK=gM((gj=L((gY=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"_colorPreset",gj,N(a)),O(a,"_gameFont",gX,N(a)),O(a,"_gameFonts",gJ,N(a)),a._mappingGameFontsCache=null,O(a,"_shrinkToFit",gZ,N(a)),a}return a(r,[{key:"colorPreset",get:function(){return this._colorPreset},set:function(a){this._colorPreset!==a&&(this._colorPreset=a,this.refreshAppearance())}},{key:"gameFont",get:function(){return this._gameFont},set:function(a){this._gameFont!==a&&(this._gameFont=a,this.refreshAppearance())}},{key:"gameFonts",get:function(){return this._gameFonts},set:function(a){this._gameFonts=null!=a?a:[],this._mappingGameFontsCache=pT(this._gameFonts),this.refreshAppearance()}},{key:"mappingGameFonts",get:function(){return this._mappingGameFontsCache||(this._mappingGameFontsCache=pT(this._gameFonts)),this._mappingGameFontsCache}},{key:"shrinkToFit",get:function(){return this._shrinkToFit},set:function(a){this._shrinkToFit!==a&&(this._shrinkToFit=a,this.refreshAppearance())}},{key:"onLoad",value:function(){this.refreshAppearance()}},{key:"setTextWithLocalize",value:function(a){var o=globalThis.game.language.getText(a);this.string=o}},{key:"setFontSize",value:function(a){this.fontSize=a}},{key:"enableShrinkToFit",value:function(a){this._shrinkToFit!==a?this.shrinkToFit=a:this.applyShrinkToFitState()}},{key:"setColor",value:function(a){this.color=a}},{key:"setGameFont",value:function(a){var o=this.mappingGameFonts[a];this.font!==o&&(this.font=o)}},{key:"getPresetColor",value:function(a){var o=g8[a];if(!o)return K.WHITE;var C=z(o,4),A=C[0],P=C[1],I=C[2],B=C[3];return new K(A,P,I,B)}},{key:"refreshAppearance",value:function(){this.applyShrinkToFitState();var a=this.getPresetColor(this._colorPreset);this.setColor(a),this.setGameFont(this._gameFont)}},{key:"applyShrinkToFitState",value:function(){this.overflow=this._shrinkToFit?er.Overflow.SHRINK:er.Overflow.NONE,this._shrinkToFit&&(this.enableWrapText=!1)}}]),r}(er)).prototype,"_colorPreset",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return g7.White}}),L(gY.prototype,"colorPreset",[gz],Object.getOwnPropertyDescriptor(gY.prototype,"colorPreset"),gY.prototype),gX=L(gY.prototype,"_gameFont",[gG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return g9.Default}}),L(gY.prototype,"gameFont",[gq],Object.getOwnPropertyDescriptor(gY.prototype,"gameFont"),gY.prototype),gJ=L(gY.prototype,"_gameFonts",[gU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),L(gY.prototype,"gameFonts",[gH],Object.getOwnPropertyDescriptor(gY.prototype,"gameFonts"),gY.prototype),gZ=L(gY.prototype,"_shrinkToFit",[gW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L(gY.prototype,"shrinkToFit",[gV],Object.getOwnPropertyDescriptor(gY.prototype,"shrinkToFit"),gY.prototype),gK=gY))||gK)||gK),U._RF.pop(),U._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var be,bt,bn,bi,br,ba,bo,bs,bl,bu,bc,bh,bp,bd,bf,by,bv,bm,bg,bb,bk,bw,bS,bT,bC,bA,b_,bP,bI,bB,bR,bE,bL,bO,bN,bF,bD,bM,bx,bz,bG,bq,bU,bH,bW,bV,bK,bY,bj=$.ccclass,bX=$.executionOrder,bJ=$.property,bZ=GameCore.Utils,bQ=bZ.Decorator,b$=bZ.Array,b0="Batch By Name",b1="Batch Label",b2="Batch Sprite";be=bj("BatchNodes"),bt=bX(99999),bn=bJ({group:{name:b0}}),bi=bJ({type:[eu],group:{name:b0}}),br=bJ({type:[el],group:{name:b0}}),ba=bJ({group:{name:b1}}),bo=bJ({group:{name:b1}}),bs=bJ({group:{name:b1}}),bl=bJ({group:{name:b2}}),bu=bJ({group:{name:b2}}),bc=bJ({readonly:!0}),bh=bJ({readonly:!0}),bp=bJ({readonly:!0}),bd=bQ.debounce(1e3),be(bf=bt((bv=L((by=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"batchByName",bv,N(a)),O(a,"depthNames",bm,N(a)),O(a,"listName",bg,N(a)),O(a,"batchLabel",bb,N(a)),O(a,"depthLabel",bk,N(a)),O(a,"typeLabel",bw,N(a)),O(a,"batchSprite",bS,N(a)),O(a,"depthSprite",bT,N(a)),O(a,"batchAllNodes",bC,N(a)),O(a,"batchDepth",bA,N(a)),O(a,"checkOverlap",b_,N(a)),a.batchNode={},a.labelChildren=[],a.spriteChildren=[],a.allChildren=[],a.nameChildren=[],a.originalParents={},a.isInited=!1,O(a,"handleNodeChange",bP,N(a)),a.onAfterUpdate=function(){a.isInited&&a.hierarchyChildren()},a.onAfterRender=function(){a.isInited&&a.restoreOriginalChildren()},a}return a(r,[{key:"__preload",value:function(){this.enabled&&(eh.on(eA.EVENT_AFTER_UPDATE,this.onAfterUpdate),eh.on(eA.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){eh.off(eA.EVENT_AFTER_UPDATE,this.onAfterUpdate),eh.off(eA.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(eh.on(eA.EVENT_AFTER_UPDATE,this.onAfterUpdate),eh.on(eA.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(a){a.once(ee.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),eh.off(eA.EVENT_AFTER_UPDATE,this.onAfterUpdate),eh.off(eA.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(a){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(a),this.createGlobalNodes(a),this.createGlobalNameNodes(a),this.createGlobalLabelNode(a),this.createGlobalSpriteNode(a),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var a,o,C,A=this;null==(a=this.batchNode.node)||a.setSiblingIndex(0),null==(o=this.batchNode.label)||o.setSiblingIndex(this.depthLabel),null==(C=this.batchNode.sprite)||C.setSiblingIndex(this.depthSprite),this.listName.forEach(function(a,o){var C,P=A.depthNames[o];void 0!==P&&(null==(C=A.batchNode[a])||C.setSiblingIndex(P))})}},{key:"createGlobalNodes",value:function(a){if(this.batchAllNodes){var o=new ee("GlobalBatchNode");o.active=!0,this.batchNode.node=o,a.addChild(o)}}},{key:"createGlobalNameNodes",value:function(a){if(this.batchByName){var o,C=E(this.listName);try{for(C.s();!(o=C.n()).done;){var A=o.value;if(!this.batchNode[A]){var P=new ee(A);P.active=!0,this.batchNode[A]=P,a.addChild(P)}}}catch(a){C.e(a)}finally{C.f()}}}},{key:"createGlobalLabelNode",value:function(a){if(this.batchLabel){var o=new ee("GlobalLabelNode");o.active=!0,this.batchNode.label=o,a.addChild(o)}}},{key:"createGlobalSpriteNode",value:function(a){if(this.batchSprite){var o=new ee("GlobalSpriteNode");o.active=!0,this.batchNode.sprite=o,a.addChild(o)}}},{key:"saveOriginalParents",value:function(){var a,o=[].concat(R(this.labelChildren),R(this.spriteChildren)),C=this.nameChildren,A=E(o);try{for(A.s();!(a=A.n()).done;){var P=a.value;P.node.parent&&(this.handleActiveChange(P.node),this.originalParents[P.uuid]=P.node.parent)}}catch(a){A.e(a)}finally{A.f()}var I,B=E(C);try{for(B.s();!(I=B.n()).done;){var L=I.value;L.parent&&(this.handleActiveChange(L),this.originalParents[L.uuid]=L.parent)}}catch(a){B.e(a)}finally{B.f()}}},{key:"saveOriginalChildren",value:function(a){var o,C=a.children,A=E(C);try{for(A.s();!(o=A.n()).done;){var P=o.value;this.saveLabelChildren(P),this.saveSpriteChildren(P),this.saveNodeChildrenByName(P),this.saveNodeChildrenByType(P)}}catch(a){A.e(a)}finally{A.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(a){var o;if(this.batchLabel){var C=a.getComponentsInChildren(er),A={none:er.CacheMode.NONE,char:er.CacheMode.CHAR,bitmap:er.CacheMode.BITMAP}[this.typeLabel];A&&(C=C.filter(function(a){return a.cacheMode===A})),0!==C.length&&(o=this.labelChildren).push.apply(o,R(C))}}},{key:"saveSpriteChildren",value:function(a){var o;if(this.batchSprite){var C=a.getComponentsInChildren(W);0!==C.length&&(o=this.spriteChildren).push.apply(o,R(C))}}},{key:"saveNodeChildrenByName",value:function(a){if(this.batchByName){var o,C=E(a.children);try{for(C.s();!(o=C.n()).done;){var A=o.value;b$.has(this.listName,A.name)?this.nameChildren.push(A):this.saveNodeChildrenByName(A)}}catch(a){C.e(a)}finally{C.f()}}}},{key:"saveNodeChildrenByType",value:function(a,o){var C,A=arguments.length>1&&void 0!==o?o:0;if(this.batchAllNodes){var P=a.getComponentsInChildren(eo);if((C=this.allChildren).push.apply(C,R(P)),!(this.batchDepth<1||A>=this.batchDepth)){var I,B=E(this.allChildren);try{for(B.s();!(I=B.n()).done;){var L=I.value;this.saveNodeChildrenByType(L.node,this.batchDepth)}}catch(a){B.e(a)}finally{B.f()}}}}},{key:"hierarchyChildren",value:function(){var a,t=function(a,o){a.node.isValid&&a.node.activeInHierarchy&&o&&!a.node.isChildOf(o)&&(a.node.setParent(o,!0),a.node.layer=e$.Enum.UI_2D)},o=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],C=E(this.labelChildren);try{for(C.s();!(a=C.n()).done;)t(a.value,this.batchNode.label)}catch(a){C.e(a)}finally{C.f()}var A,P=E(this.spriteChildren);try{for(P.s();!(A=P.n()).done;)t(A.value,this.batchNode.sprite)}catch(a){P.e(a)}finally{P.f()}var I,B=E(this.allChildren);try{for(B.s();!(I=B.n()).done;)t(I.value,this.batchNode.node)}catch(a){B.e(a)}finally{B.f()}this.allChildren.sort(function(a,o){return a.constructor.name.localeCompare(o.constructor.name)}),this.labelChildren.sort(function(a,o){return a.cacheMode-o.cacheMode});var R,L=E(this.nameChildren);try{for(L.s();!(R=L.n()).done;){var O=R.value;if(O.isValid&&O.activeInHierarchy&&O.isTransformDirty()){var N=O.getComponent(ea);if(!(N&&N.opacity<1||b$.has(o,O.name))){var F=this.batchNode[O.name];F&&(O.isChildOf(F)||(O.setParent(F,!0),O.layer=e$.Enum.UI_2D))}}}}catch(a){L.e(a)}finally{L.f()}}},{key:"restoreOriginalChildren",value:function(){var a=[].concat(R(this.labelChildren),R(this.spriteChildren));if(a.length>0){var o,C=E(a);try{for(C.s();!(o=C.n()).done;){var A=o.value,P=this.originalParents[A.uuid];P&&(A.node.isChildOf(P)||A.node.setParent(P,!0))}}catch(a){C.e(a)}finally{C.f()}}var I,B=E(this.nameChildren);try{for(B.s();!(I=B.n()).done;){var L=I.value,O=this.originalParents[L.uuid];O&&(L.isChildOf(O)||L.setParent(O,!0))}}catch(a){B.e(a)}finally{B.f()}}}]),r}(eo)).prototype,"batchByName",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bm=L(by.prototype,"depthNames",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bg=L(by.prototype,"listName",[br],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bb=L(by.prototype,"batchLabel",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bk=L(by.prototype,"depthLabel",[bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bw=L(by.prototype,"typeLabel",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),bS=L(by.prototype,"batchSprite",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bT=L(by.prototype,"depthSprite",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bC=L(by.prototype,"batchAllNodes",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bA=L(by.prototype,"batchDepth",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b_=L(by.prototype,"checkOverlap",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bP=L(by.prototype,"handleNodeChange",[bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var a=this;return function(){a.isInited&&a.setupBatchNodes(a.node)}}}),bf=by))||bf),U._RF.pop(),U._RF.push({},"1ecebJCOPhK9L6AO92sjHzD","BatchNodesV2",void 0);var b3,b4=$.ccclass,b5=$.executionOrder,b6=$.property,b7=GameCore.Utils,b8=b7.Array,b9=b7.Object,ke=(bI=b4("BatchNodesV2"),bB=b5(99999),bR=b6({group:"Batch Settings"}),bE=b6({type:[el],group:"Batch Settings",visible:function(){return this.batchByName}}),bL=b6({type:[eu],group:"Batch Settings",visible:function(){return this.batchByName}}),bO=b6({group:"Label Settings"}),bN=b6({group:"Label Settings",visible:function(){return this.batchLabel}}),bF=b6({group:"Label Settings",visible:function(){return this.batchLabel}}),bD=b6({group:"Sprite Settings"}),bM=b6({group:"Sprite Settings",visible:function(){return this.batchSprite}}),bI(bx=bB((bG=L((bz=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"batchByName",bG,N(a)),O(a,"listName",bq,N(a)),O(a,"depthNames",bU,N(a)),O(a,"batchLabel",bH,N(a)),O(a,"typeLabel",bW,N(a)),O(a,"depthLabel",bV,N(a)),O(a,"batchSprite",bK,N(a)),O(a,"depthSprite",bY,N(a)),a.batchNodes={},a.originalParents={},a.labelNodes=[],a.spriteNodes=[],a.namedNodes={},a.isInitialized=!1,a.labelNodesByType={bitmap:[],char:[],none:[]},a.isEventListenerSetup=!1,a.onAfterUpdate=function(){a.isInitialized&&a.batchActiveNodes()},a.onAfterRender=function(){a.isInitialized&&a.restoreNodes()},a}return a(r,[{key:"depthLabelBitmap",get:function(){return this.depthLabel}},{key:"depthLabelChar",get:function(){return this.depthLabel+1}},{key:"depthLabelNone",get:function(){return this.depthLabel+2}},{key:"onLoad",value:function(){this.enabled&&this.initializeDataStructures()}},{key:"start",value:function(){this.enabled&&this.initialize()}},{key:"onEnable",value:function(){this.isEventListenerSetup||(this.setupEventListeners(),this.isEventListenerSetup=!0)}},{key:"onDisable",value:function(){this.isEventListenerSetup&&(this.removeEventListeners(),this.isEventListenerSetup=!1),this.restoreNodes()}},{key:"onDestroy",value:function(){this.removeEventListeners(),this.restoreNodes(),this.clearData()}},{key:"initializeDataStructures",value:function(){this.batchNodes={},this.originalParents={},this.labelNodes=[],this.spriteNodes=[],this.namedNodes={},this.labelNodesByType={bitmap:[],char:[],none:[]}}},{key:"initialize",value:function(){this.isInitialized||(this.createBatchContainers(),this.scanNodes(this.node),this.sortBatchNodes(),this.isInitialized=!0)}},{key:"clearData",value:function(){this.batchNodes={},this.originalParents={},this.labelNodes=[],this.spriteNodes=[],this.namedNodes={},this.labelNodesByType={bitmap:[],char:[],none:[]},this.isInitialized=!1}},{key:"categorizeNode",value:function(a){if(a.parent){if(this.originalParents[a.uuid]=a.parent,this.batchLabel){var o=a.getComponent(er);o&&("all"===this.typeLabel?o.cacheMode===er.CacheMode.BITMAP?this.labelNodesByType.bitmap.push(a):o.cacheMode===er.CacheMode.CHAR?this.labelNodesByType.char.push(a):this.labelNodesByType.none.push(a):this.isValidLabel(o)&&this.labelNodes.push(a))}if(this.batchSprite)a.getComponent(W)&&this.spriteNodes.push(a);if(this.batchByName){var C=a.name;this.listName.includes(C)&&(this.namedNodes[C]||(this.namedNodes[C]=[]),this.namedNodes[C].push(a))}}}},{key:"isValidLabel",value:function(a){var o={none:er.CacheMode.NONE,char:er.CacheMode.CHAR,bitmap:er.CacheMode.BITMAP};return a.cacheMode===o[this.typeLabel]}},{key:"sortBatchNodes",value:function(){if(this.batchLabel)if("all"===this.typeLabel){var a,o,C;null==(a=this.batchNodes.label_bitmap)||a.setSiblingIndex(this.depthLabelBitmap),null==(o=this.batchNodes.label_char)||o.setSiblingIndex(this.depthLabelChar),null==(C=this.batchNodes.label_none)||C.setSiblingIndex(this.depthLabelNone)}else{var A,P={bitmap:this.depthLabelBitmap,char:this.depthLabelChar,none:this.depthLabelNone}[this.typeLabel]||this.depthLabelChar;null==(A=this.batchNodes.label)||A.setSiblingIndex(P)}this.batchNodes.sprite&&this.batchNodes.sprite.setSiblingIndex(this.depthSprite);for(var I=0;I<this.listName.length;I++){var B=this.listName[I];if(B){var R=this.depthNames[I]||0,E=this.batchNodes[B];E&&E.setSiblingIndex(R)}}}},{key:"batchNodeArray",value:function(a,o){for(var C=0;C<a.length;C++){var A=a[C];null!=A&&A.isValid&&A.activeInHierarchy&&A.parent!==o&&(this.isBatchContainer(A)||A.isTransformDirty()&&this.isParentChainActive(A)&&(A.setParent(o,!0),A.layer=e$.Enum.UI_2D))}}},{key:"isBatchContainer",value:function(a){var o=b9.vals(this.batchNodes);return b8.has(o,a)}},{key:"isParentChainActive",value:function(a){for(var o=a,C=this.node;o&&o!==C;){if(!o.active||!o.isValid)return!1;o=o.parent}return o===C}},{key:"restoreNodes",value:function(){var a=this,t=function(o){var C=a.originalParents[o.uuid];null!=C&&C.isValid&&o.parent!==C&&a.isParentChainActive(C)&&o.setParent(C,!0)};if(this.batchLabel)if("all"===this.typeLabel)for(var o in this.labelNodesByType)for(var C=this.labelNodesByType[o],A=0;A<C.length;A++){var P=C[A];P&&t(P)}else for(var I=0;I<this.labelNodes.length;I++){var B=this.labelNodes[I];B&&t(B)}if(this.batchSprite)for(var R=0;R<this.spriteNodes.length;R++){var E=this.spriteNodes[R];E&&t(E)}if(this.batchByName)for(var L in this.namedNodes){var O=this.namedNodes[L];if(O)for(var N=0;N<O.length;N++){var F=O[N];F&&t(F)}}}},{key:"setupEventListeners",value:function(){eh.on(eA.EVENT_AFTER_UPDATE,this.onAfterUpdate),eh.on(eA.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"removeEventListeners",value:function(){eh.off(eA.EVENT_AFTER_UPDATE,this.onAfterUpdate),eh.off(eA.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"createBatchContainers",value:function(){if(this.batchLabel)if("all"===this.typeLabel)for(var a=0,o=["bitmap","char","none"];a<o.length;a++){var C=o[a],A=new ee("BatchLabel_".concat(C));A.layer=e$.Enum.UI_2D,this.node.addChild(A),this.batchNodes["label_".concat(C)]=A}else{var P=new ee("BatchLabel");P.layer=e$.Enum.UI_2D,this.node.addChild(P),this.batchNodes.label=P}if(this.batchSprite){var I=new ee("BatchSprite");I.layer=e$.Enum.UI_2D,this.node.addChild(I),this.batchNodes.sprite=I}if(this.batchByName)for(var B=0;B<this.listName.length;B++){var R=this.listName[B];if(R){var E=new ee("Batch_".concat(R));E.layer=e$.Enum.UI_2D,this.node.addChild(E),this.batchNodes[R]=E,this.namedNodes[R]=[]}}}},{key:"scanNodes",value:function(a){for(var o=a.children,C=0;C<o.length;C++){var A=o[C];A&&(this.categorizeNode(A),A.children.length>0&&this.scanNodes(A))}}},{key:"batchActiveNodes",value:function(){if(this.batchLabel&&("all"===this.typeLabel?(this.batchNodesByType(this.labelNodesByType.bitmap,"label_bitmap"),this.batchNodesByType(this.labelNodesByType.char,"label_char"),this.batchNodesByType(this.labelNodesByType.none,"label_none")):this.batchNodesByType(this.labelNodes,"label")),this.batchSprite&&this.batchNodesByType(this.spriteNodes,"sprite"),this.batchByName)for(var a in this.namedNodes){var o=this.namedNodes[a];if(o){var C=this.batchNodes[a];C&&this.batchNodeArray(o,C)}}}},{key:"batchNodesByType",value:function(a,o){var C=this.batchNodes[o];C&&this.batchNodeArray(a,C)}}]),r}(eo)).prototype,"batchByName",[bR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bq=L(bz.prototype,"listName",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bU=L(bz.prototype,"depthNames",[bL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bH=L(bz.prototype,"batchLabel",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bW=L(bz.prototype,"typeLabel",[bN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),bV=L(bz.prototype,"depthLabel",[bF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bK=L(bz.prototype,"batchSprite",[bD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bY=L(bz.prototype,"depthSprite",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bx=bz))||bx)||bx);U._RF.pop(),U._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var kt=$.ccclass,kn=GameCore.Utils,ki=globalThis.game.player,kr=kt("Vibrate")(b3=function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"vibrate",value:function(a){if(this.isVibrateEnable()&&!kn.Browser.vibrate(a)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync()}}},{key:"isVibrateEnable",value:function(){return!!ki.getPlayerSetting("vibrate")}}]),r}(eo))||b3;U._RF.pop(),U._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0),U._RF.pop(),U._RF.push({},"09d2cgEagJDkr0d7iOwT3BW","FontSupporter",void 0),U._RF.pop(),U._RF.push({},"5ce2asyusBBnqnf7DQcMeQ9","SpineKeys",void 0);var ka,ko,ks,kl,ku,kc,kh,kp,kd="spines/",kf={NO_MORE_MOVE_RIBBON:"".concat(kd,"NoMoreMoveRibbon"),WONDERFUL_RIBBON:"".concat(kd,"WonderfulRibbon")};U._RF.pop(),U._RF.push({},"f2134AVhktCQLHh8jp96V/y","VibrateStyle",void 0),U._RF.pop(),U._RF.push({},"fb3f8J/GVhNerzJMrf55hBP","WelcomeTournamentBlock",void 0);var ky,kv,km,kg,kb,kk,kw,kS,kT=$.ccclass,kC=$.property,kA=(ka=kT("WelcomeTournamentBlock"),ko=kC(ee),ks=kC(ee),kl=tj.required,ka((kc=L((ku=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"titleEn",kc,N(a)),O(a,"titleBr",kh,N(a)),O(a,"uiOpacity",kp,N(a)),a.originalBlockPos=null,a}return a(p,[{key:"__preload",value:function(){this.initComponents(),this.initData()}},{key:"initComponents",value:function(){this.uiOpacity=this.getComponent(ea),this.validateRequiredComponents()}},{key:"initData",value:function(){this.originalBlockPos=this.node.position.clone()}},{key:"onLoad",value:function(){this.node.active=!1}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,p)}},{key:"playPopUpAnim",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.node.active=!0,this.prepareFadeIn(),th.playSound(tZ.POPUP_SHOW),[4,this.fadeIn()];case 1:return a.sent(),[4,ts.waitTweenAsync(1.45)];case 2:return a.sent(),th.playSound(tZ.POPUP_OFF),[4,this.fadeOut()];case 3:return a.sent(),this.node.active=!1,[2]}})}),function(){return E.apply(this,arguments)})},{key:"prepareFadeIn",value:function(){if(this.originalBlockPos){var a=this.originalBlockPos,o=a.x,C=a.y,A=a.z;this.node.setPosition(o,C-200,A),this.node.scale=new ei(0,0,0),this.uiOpacity.opacity=0,this.handleLanguage()}}},{key:"handleLanguage",value:function(){"br"===globalThis.game.language.getCurrentLocale()?(this.titleEn.active=!1,this.titleBr.active=!0):(this.titleBr.active=!1,this.titleEn.active=!0)}},{key:"fadeIn",value:(R=B(function(){var a,o,C,A,P,I,B;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.originalBlockPos)return[3,2];return o=(a=this.originalBlockPos).x,C=a.y,A=a.z,P=Y(this.node).to(.25,{position:new ei(o,C,A)},{easing:"backOut"}),I=Y(this.node).to(.25,{scale:new ei(1,1,1)},{easing:"cubicOut"}),B=Y(this.uiOpacity).to(.12,{opacity:255}),[4,Promise.all([ts.runTweenAsync(P),ts.runTweenAsync(B),ts.runTweenAsync(I)])];case 1:R.sent(),R.label=2;case 2:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"fadeOut",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.uiOpacity).to(.25,{opacity:0}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),p}(eo)).prototype,"titleEn",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=L(ku.prototype,"titleBr",[ks],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kp=L(ku.prototype,"uiOpacity",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ku))||ku);U._RF.pop(),U._RF.push({},"6d070ZLZdZNLriiNU1KsHwS","SparkleEffect",void 0);var k_,kP,kI,kB,kR,kE,kL,kO,kN,kF,kD,kM,kx,kz,kG,kq,kU,kH,kW,kV,kK,kY,kj,kX=$.ccclass,kJ=$.property,kZ=(ky=kX("SparkleEffect"),kv=kJ(eV),km=tj.required,kg=kJ(eV),kb=tj.required,ky((kw=L((kk=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"clusterEffect",kw,N(a)),O(a,"randomEffect",kS,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"play",value:function(){this.clusterEffect.resetSystem(),this.randomEffect.resetSystem()}},{key:"stop",value:function(){this.clusterEffect.stopSystem(),this.randomEffect.stopSystem()}}]),r}(eo)).prototype,"clusterEffect",[kv,km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kS=L(kk.prototype,"randomEffect",[kg,kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kk))||kk);U._RF.pop(),U._RF.push({},"6a1fbBZYuhMxpvT3veHs5x4","CoinPanel",void 0);var kQ,k$,k0,k1,k2=$.ccclass,k3=$.property;k_=k2("CoinPanel"),kP=tj.required,kI=k3(er),kB=tj.required,kR=k3(ee),kE=tj.required,kL=k3(ee),kO=tj.required,kN=k3(ee),kF=tj.required,kD=k3(en),kM=tj.required,kx=k3(ee),kz=tj.required,kG=k3(kZ),k_((kU=L((kq=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"coinLabel",kU,N(a)),O(a,"coinIcon",kH,N(a)),O(a,"plusIcon",kW,N(a)),O(a,"leftBar",kV,N(a)),O(a,"middleBar",kK,N(a)),O(a,"coinCollect",kY,N(a)),O(a,"sparkleEffect",kj,N(a)),a.plusIconAnimationIsPlaying=!1,a.plusIconTween=null,a.bubbleCoinAnimationIsPlaying=!1,a.bubbleCoinAnimation=null,a.distancePerText=5,a.previousLength=4,a}return a(s,[{key:"preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"getCoinIcon",value:function(){return this.coinIcon}},{key:"onEnable",value:function(){this.enablePlusIconAsync(!0)}},{key:"getCoinCollect",value:function(){return this.coinCollect}},{key:"updateCoinAmount",value:function(a,o){var C=this;o>0&&this.sparkleEffect.play(),Y({score:a}).to(1.15,{score:a+o},{easing:"linear",progress:function(A,P,I,B){var R=Math.floor(o*B);return C.setCoinLabel(a+R),I}}).call(function(){C.sparkleEffect.stop()}).start()}},{key:"setCoinLabel",value:function(a){this.coinLabel.string="".concat(a);var o=this.coinLabel.string.length;if(o!==this.previousLength){var C=this.middleBar.width+1.5*this.distancePerText*(o-this.previousLength);Y(this.middleBar).to(.4,{width:C},{easing:"smooth"}).start();var A=this.leftBar.position,P=A.x,I=A.y,B=A.z,R=P-(this.distancePerText+10)*(o-this.previousLength);Y(this.leftBar).to(.4,{position:new ei(R,I,B)},{easing:"smooth"}).start(),this.previousLength=o}}},{key:"enablePlusIconAsync",value:(I=B(function(a){var o;return _ts_generator(this,function(C){if(null==(o=this.plusIconTween)||o.stop(),a||this.stopAnimationPlusIcon(),a)this.playPlusIconAnim(.5);else Y(this.plusIcon).to(.2,{scale:new ei(1e-4,1e-4,1e-4)},{easing:"quartOut"}).start();return[2]})}),function(a){return I.apply(this,arguments)})},{key:"playPlusIconAnim",value:function(a){var o=arguments.length>0&&void 0!==a?a:0;if(!this.plusIconAnimationIsPlaying){this.plusIconAnimationIsPlaying=!0;var C=Y(this.plusIcon).to(.4,{scale:new ei(1.1,1.1,1.1)},{easing:"quartOut"}).delay(.2).to(.4,{scale:new ei(1,1,1)},{easing:"quadOut"}).delay(.2).union().repeatForever();this.scheduleOnce(function(){C.start()},o)}}},{key:"stopAnimationPlusIcon",value:function(){this.plusIconAnimationIsPlaying=!1,em.stopAllByTarget(this.plusIcon),this.plusIcon.setScale(new ei(1,1,1))}},{key:"playBubbleCoinAnimation",value:function(){var a=this;if(!this.bubbleCoinAnimationIsPlaying){this.bubbleCoinAnimationIsPlaying=!0;var o=Y(this.coinIcon).to(.1,{scale:new ei(1.1,1.1,1)}),C=Y(this.coinIcon).to(.1,{scale:new ei(1,1,1)});this.bubbleCoinAnimation=Y(this.coinIcon).sequence(o,C).repeat(1).call(function(){a.bubbleCoinAnimationIsPlaying=!1}).start()}}},{key:"stopBubbleCoinAnimation",value:function(){this.bubbleCoinAnimation&&(this.bubbleCoinAnimation.stop(),this.bubbleCoinAnimation=null),Y(this.coinIcon).to(.1,{scale:new ei(1,1,1)}).start()}},{key:"playCoinPanelScaleUpAnim",value:function(){Y(this.node).to(.2,{scale:new ei(1.1,1.1,1)}).start()}},{key:"playCoinPanelScaleDownAnim",value:function(){Y(this.node).to(.2,{scale:new ei(1,1,1)}).start()}},{key:"toggleInteractive",value:function(a){var o=this.getComponent(ef);o&&(o.interactable=a)}}]),s}(eo)).prototype,"coinLabel",[kP,kI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kH=L(kq.prototype,"coinIcon",[kB,kR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kW=L(kq.prototype,"plusIcon",[kE,kL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kV=L(kq.prototype,"leftBar",[kO,kN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kK=L(kq.prototype,"middleBar",[kF,kD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kY=L(kq.prototype,"coinCollect",[kM,kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kj=L(kq.prototype,"sparkleEffect",[kz,kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kq)),U._RF.pop(),U._RF.push({},"10007SeATRBMKHcMe6rD76B","EmissionGoldTileParticle",void 0);var k4,k5,k6,k7,k8,k9,we,wt,wn=$.ccclass,wi=$.property,wr=(kQ=wn("EmissionGoldTileParticle"),k$=wi(eV),kQ((k1=L((k0=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"cometParticle",k1,N(a)),a}return a(r,[{key:"play",value:function(){this.cometParticle.resetSystem(),this.scheduleOnce(this.checkParticleStopped,2)}},{key:"stop",value:function(){this.cometParticle.stopSystem()}},{key:"setStartSize",value:function(a){this.cometParticle.startSize=a,this.cometParticle.speed=50}},{key:"checkParticleStopped",value:function(){this.cometParticle.stopped?this.onAllParticlesStopped():this.scheduleOnce(this.checkParticleStopped,2)}},{key:"onAllParticlesStopped",value:function(){this.node.active=!1,this.cometParticle.startSize=200,this.cometParticle.speed=200}}]),r}(eo)).prototype,"cometParticle",[k$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0))||k0);U._RF.pop(),U._RF.push({},"ea1ca6rxRdMBr2EM8cRBhBn","FlyGoldTileParticle",void 0);var wa,wo,ws,wl,wu,wc,wh=$.ccclass,wp=$.property,wd=(k4=wh("FlyGoldTileParticle"),k5=wp(eV),k6=wp(eV),k7=wp(e0),k4((k9=L((k8=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"cometParticle",k9,N(a)),O(a,"brightParticle",we,N(a)),O(a,"yellowTrailParticle",wt,N(a)),a}return a(r,[{key:"play",value:function(){this.cometParticle.resetSystem(),this.brightParticle.resetSystem()}},{key:"stop",value:function(){this.cometParticle.stopSystem(),this.brightParticle.stopSystem(),this.scheduleOnce(this.returnParticleToPool,1.5)}},{key:"returnParticleToPool",value:function(){this.yellowTrailParticle.reset(),this.node.active=!1}}]),r}(eo)).prototype,"cometParticle",[k5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),we=L(k8.prototype,"brightParticle",[k6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wt=L(k8.prototype,"yellowTrailParticle",[k7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k8))||k8);U._RF.pop(),U._RF.push({},"da9860NOHdN8qV/bCMQFg0R","GoldTileParticlePool",void 0);var wf,wy,wv,wm,wg,wb,wk,ww,wS=$.ccclass,wT=$.property,wC=(wa=wS("GoldTileParticlePool"),wo=wT(eY),ws=wT(eY),wa((wu=L((wl=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"emissionGoldTileParticle",wu,N(a)),O(a,"flyGoldTileParticle",wc,N(a)),a.emissionGoldTileParticlePool=[],a.flyGoldTileParticlePool=[],a}return a(r,[{key:"getEmissionGoldTileParticle",value:function(){var a,o=E(this.emissionGoldTileParticlePool);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.node.active)return C.node.active=!0,C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.emissionGoldTileParticle).getComponent(wr);return this.emissionGoldTileParticlePool.push(A),A}},{key:"getFlyGoldTileParticle",value:function(){var a,o=E(this.flyGoldTileParticlePool);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.node.active)return C.node.active=!0,C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.flyGoldTileParticle).getComponent(wd);return this.flyGoldTileParticlePool.push(A),A}}]),r}(eo)).prototype,"emissionGoldTileParticle",[wo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wc=L(wl.prototype,"flyGoldTileParticle",[ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl))||wl);U._RF.pop(),U._RF.push({},"ab194b9W2hBqKg/Nnd//l31","GoldTilePool",void 0);var wA,w_,wP,wI,wB,wR,wE,wL,wO,wN,wF,wD,wM,wx,wz,wG=$.ccclass,wq=$.property,wU=(wf=wG("GoldTilePool"),wy=wq(eY),wv=tj.required,wm=wq(eY),wg=tj.required,wf((wk=L((wb=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"goldTilePrefab",wk,N(a)),O(a,"goldTileParticlePool",ww,N(a)),a.goldTileParticlePoolInstance=null,a.pool=[],a}return a(r,[{key:"__preload",value:function(){this.goldTileParticlePoolInstance=ej(this.goldTileParticlePool).getComponent(wC),tj.validateRequiredProperties(this,r)}},{key:"start",value:function(){for(var a=0;a<3;a++){var o=this.getGoldTile();this.returnGoldTile(o)}}},{key:"getGoldTile",value:function(){if(this.pool.length>0){var a=this.pool.pop();return a.active=!0,a}var o=ej(this.goldTilePrefab);return o.active=!0,o}},{key:"returnGoldTile",value:function(a){a.removeFromParent(),this.resetGoldTile(a),a.active=!1,this.pool.push(a)}},{key:"resetGoldTile",value:function(a){a.angle=0,a.scale=new ei(0,0,1),em.stopAllByTarget(a)}},{key:"getGoldTileParticlePool",value:function(){return this.goldTileParticlePoolInstance}}]),r}(eo)).prototype,"goldTilePrefab",[wy,wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ww=L(wb.prototype,"goldTileParticlePool",[wm,wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wb))||wb);U._RF.pop(),U._RF.push({},"c8978weiYZLJJRFU0th21/Q","TileWithIcon",void 0);var wH=$.ccclass,wW=$.requireComponent,wV=$.property,wK=(wA=wH("TileWithIcon"),w_=wW(en),wP=wV(W),wI=tj.required,wB=wV(W),wR=tj.required,wE=wV(W),wL=tj.required,wO=tj.required,wA(wN=w_((wD=L((wF=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"background",wD,N(a)),O(a,"icon",wM,N(a)),O(a,"overlay",wx,N(a)),O(a,"uiTransform",wz,N(a)),a.overlayTween=null,a}return a(r,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(en),tj.validateRequiredProperties(this,r)}},{key:"updateScaleToFitSize",value:function(a){var o=this.uiTransform.contentSize;this.node.setScale(a.width/o.width,a.height/o.height)}},{key:"setIcon",value:function(a){var o=this.icon;o.spriteFrame=a;var C=td.gameScene.gamePlay.tileIconPositionManager.getIconPosition(a);o.node.setPosition(C.x,C.y)}},{key:"clearIcon",value:function(){this.icon.spriteFrame=null}},{key:"fadeOverlay",value:function(a){var o=arguments.length>0&&void 0!==a?a:{},C=o.opacity,A=o.duration;if(this.overlay.node.active){this.overlayTween&&(this.overlayTween.stop(),this.overlayTween=null);var P=this.overlay.color.clone();P.a=void 0===C?0:C,this.overlayTween=Y(this.overlay).to(void 0===A?.3:A,{color:P}).start()}}},{key:"disableOverlay",value:function(){this.overlay.node.active=!1}}]),r}(eo)).prototype,"background",[wP,wI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wM=L(wF.prototype,"icon",[wB,wR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wx=L(wF.prototype,"overlay",[wE,wL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wz=L(wF.prototype,"uiTransform",[wO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wN=wF))||wN)||wN);U._RF.pop(),U._RF.push({},"0b9e6xcw/ZIY6hPAasyDwv7","TileFallTween",void 0);var wY=function(){var C,A,P,R,E,L;function n(a){o(this,n),this.tile=void 0,this.isScale=!1,this.listDictTween={},this.listDictTweenMoveTileAtRack={},this.tile=a}return a(n,[{key:"moveTileToRack",value:(L=B(function(a,o,C,A){var P,I,R,E,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:I=this,this.stop(),F.label=1;case 1:if(F.trys.push([1,6,,7]),!!this.isScale)return[3,4];if(!(((P=.14*Math.abs(1.25-this.tile.node.scale.x)/.5)<0?0:P>.14?.14:P)>0)||!(A>0))return[3,3];if(!this.tile.isRotated)R=o.x<a.x?5:-5,this.runTween({duration:.05,props:{angle:R},startTime:A,timeScale:2}).catch(function(a){}),this.tile.isRotated=!0;return E=this.runTween({duration:.05,props:{scale:new ei(1.25,1.25)},easing:"cubicInOut",startTime:A,timeScale:2}),this.tile.willCloseAfterPlayingMoveToRack&&this.tile.tweenScalePromises.push(E),[4,E];case 2:F.sent(),F.label=3;case 3:L=this.tile.currentSize.x,O=1.05*t0.SIZE.WIDTH/L,Y(this.tile.node).to(.25,{scale:new ei(O,O)},{easing:"quartOut"}).call(B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!I.tile.willCloseAfterPlayingMoveToRack)return[3,2];return[4,I.tile.handleCloseTile()];case 1:a.sent(),I.tile.willCloseAfterPlayingMoveToRack=!1,a.label=2;case 2:return[2]}})})).start(),this.isScale=!0,F.label=4;case 4:return[4,Promise.all([this.runTween({duration:.25,props:{position:new ei(a.x,a.y)},easing:"expoOut"}),this.runTween({duration:.05,props:{angle:0},easing:"quadOut"})])];case 5:return F.sent(),C(),N=[-4,2,0],o.x<a.x&&(N=[4,-2,0]),this.runRotateTween(N),[3,7];case 6:return F.sent(),[3,7];case 7:return[2]}})}),function(a,o,C,A){return L.apply(this,arguments)})},{key:"moveTileAtRack",value:(E=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:this.stopMoveTileAtRack(),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.runTweenMoveTileAtRack({duration:.2,props:{position:new ei(a.x,a.y)},easing:"quadOut"})];case 2:return o.sent(),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})}),function(a){return E.apply(this,arguments)})},{key:"rotateTile",value:(R=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=this,[4,new Promise(function(C){Y(o.tile.node).to(.05,{angle:a},{easing:"quartOut"}).call(C).start()})];case 1:return C.sent(),[4,new Promise(function(C){Y(o.tile.node).to(.15,{angle:-a/10},{easing:"quartOut"}).call(C).start()})];case 2:return C.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"runRotateTween",value:(P=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=this,[4,new Promise(function(C){Y(o.tile.node).to(.08,{angle:a[0]}).call(C).start()})];case 1:return C.sent(),[4,new Promise(function(C){Y(o.tile.node).to(.08,{angle:a[1]}).call(C).start()})];case 2:return C.sent(),[4,new Promise(function(C){Y(o.tile.node).to(.04,{angle:a[2]}).call(C).start()})];case 3:return C.sent(),[2]}})}),function(a){return P.apply(this,arguments)})},{key:"runTween",value:(A=B(function(a){var o,C,A,P;return _ts_generator(this,function(B){switch(B.label){case 0:return C=(o=ts.makeTweenPromise(I(I({},a),{},{node:this.tile.node}))).tween,A=o.promise,P=o.id,this.listDictTween[P]=C,[4,A];case 1:return B.sent(),delete this.listDictTween[P],[2]}})}),function(a){return A.apply(this,arguments)})},{key:"runTweenMoveTileAtRack",value:(C=B(function(a){var o,C,A,P;return _ts_generator(this,function(B){switch(B.label){case 0:return C=(o=ts.makeTweenPromise(I(I({},a),{},{node:this.tile.node}))).tween,A=o.promise,P=o.id,this.listDictTweenMoveTileAtRack[P]=C,[4,A];case 1:return B.sent(),delete this.listDictTweenMoveTileAtRack[P],[2]}})}),function(a){return C.apply(this,arguments)})},{key:"stop",value:function(){for(var a in this.listDictTween)this.listDictTween[a].stop();this.listDictTween={}}},{key:"stopMoveTileAtRack",value:function(){for(var a in this.listDictTweenMoveTileAtRack)this.listDictTweenMoveTileAtRack[a].stop();this.listDictTweenMoveTileAtRack={}}},{key:"refreshScale",value:function(){this.tile.node.scale=new ei(1,1,1)}}]),n}();U._RF.pop(),U._RF.push({},"ab3d7Z05b1Mgb+TC2TRn/YQ","TileInitTween",void 0);var wj=function(){var C,A;function n(a){o(this,n),this.tile=void 0,this.currentScale=new ei(0,0,0),this.tile=a}return a(n,[{key:"closeTile",value:(A=B(function(){var a,o,C;var A=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:return a=A.length>0&&void 0!==A[0]?A[0]:.075,o=A.length>1&&void 0!==A[1]?A[1]:0,this.currentScale=this.tile.node.scale.clone(),this.tile.state=t1.PRELOADING,C=Y(this.tile.node).delay(o).to(a,{scale:new ei(0,0,0)},{easing:"cubicIn"}),[4,ts.runTweenAsync(C)];case 1:return P.sent(),[2]}})}),function(){return A.apply(this,arguments)})},{key:"playScaleUpToCurrentAnimation",value:(C=B(function(){var a,o,C,A;var P=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:if(a=P.length>0&&void 0!==P[0]?P[0]:.12,o=P.length>1&&void 0!==P[1]?P[1]:0,!(C=this.tile.node.getComponent(ea)))return[3,2];return this.currentScale.equals(ei.ZERO)&&(this.currentScale=ei.ONE.clone()),C.opacity=255,this.tile.node.scale=new ei(0,0,0),A=Y(this.tile.node).delay(o).to(a,{scale:this.currentScale},{easing:"circOut"}),[4,ts.runTweenAsync(A)];case 1:I.sent(),I.label=2;case 2:return[2]}})}),function(){return C.apply(this,arguments)})}]),n}();U._RF.pop(),U._RF.push({},"547b3BuoIVEiYpaspT8DpzO","TilePointerTween",void 0);var wX=function(){var C,A,P,R;function n(a){o(this,n),this.moveAndWaveHoldTween=null,this.tile=void 0,this.listDictTween={},this.tile=a}return a(n,[{key:"tweenPointerUpOutSide",value:(R=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.stop(),a=1,o=.7,(C=Math.random())>.8?(a=1.05,o=.9):C>.6?(a=1.05,o=1.2):C>.4?(a=.7,o=1):C>.2&&(a=.8,o=.8),A.label=1;case 1:return A.trys.push([1,5,,6]),[4,this.runTween({duration:.1,props:{scale:new ei(1,1,1)},easing:"sineOut"})];case 2:return A.sent(),[4,this.runTween({duration:.06,props:{scale:new ei(a,o,1)},easing:"cubicOut"})];case 3:return A.sent(),[4,this.runTween({duration:.14,props:{scale:new ei(1,1,1)},easing:"cubicOut"})];case 4:return A.sent(),[3,6];case 5:return A.sent(),[3,6];case 6:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"runScale",value:(P=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return A.trys.push([0,4,,5]),[4,this.runTween({duration:.25,props:{scale:new ei(t0.ANIMATION_CONFIGS.HOLD.SCALE,t0.ANIMATION_CONFIGS.HOLD.SCALE,1)},easing:"cubicInOut"},"scaleUp")];case 1:return A.sent(),a=t0.ANIMATION_CONFIGS.HOLD.SCALE,o=.95*t0.ANIMATION_CONFIGS.HOLD.SCALE,(C=Math.random())>.7?(a=1.05*t0.ANIMATION_CONFIGS.HOLD.SCALE,o=.9*t0.ANIMATION_CONFIGS.HOLD.SCALE):C>.5?(a=t0.ANIMATION_CONFIGS.HOLD.SCALE,o=1.05*t0.ANIMATION_CONFIGS.HOLD.SCALE):C>.3&&(a=t0.ANIMATION_CONFIGS.HOLD.SCALE,o=t0.ANIMATION_CONFIGS.HOLD.SCALE),[4,this.runTween({duration:.05,props:{scale:new ei(a,o,1)},easing:"cubicOut"})];case 2:return A.sent(),[4,this.runTween({duration:.09,props:{scale:new ei(t0.ANIMATION_CONFIGS.HOLD.SCALE,t0.ANIMATION_CONFIGS.HOLD.SCALE,1)},easing:"cubicIn"})];case 3:return A.sent(),[3,5];case 4:return A.sent(),[3,5];case 5:return[2]}})}),function(){return P.apply(this,arguments)})},{key:"tweenPointerDown",value:function(){this.stop();var a=this.runScale();this.tile.tweenScalePromises.push(a),this.waveAndMoveHold()}},{key:"waveAndMoveHold",value:function(){this.moveAndWaveHoldTween=Y(this.tile.node).parallel(Y(this.tile.node).sequence(this.createPositionTween(t0.ANIMATION_CONFIGS.HOLD.POSITION_TIME,new H(this.tile.node.position.x,this.tile.node.position.y+t0.ANIMATION_CONFIGS.HOLD.DISTANCE_MOVE_Y)),this.createPositionTween(t0.ANIMATION_CONFIGS.HOLD.POSITION_TIME,new H(this.tile.node.position.x,this.tile.node.position.y))),Y(this.tile.node).sequence(this.createAngleTween(t0.ANIMATION_CONFIGS.HOLD.WAVE_TIME/2,0,t0.ANIMATION_CONFIGS.HOLD.ANGLE),this.createAngleTween(1.4,0,-t0.ANIMATION_CONFIGS.HOLD.ANGLE),this.createAngleTween(t0.ANIMATION_CONFIGS.HOLD.WAVE_TIME/2,0,0))).repeatForever().start()}},{key:"playShakeAnim",value:(A=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:this.stop(),a.label=1;case 1:return a.trys.push([1,7,,8]),[4,this.runTween({duration:.03,props:{position:new ei(this.tile.worldPos.x-8,this.tile.worldPos.y,1)},easing:"sineInOut"})];case 2:return a.sent(),[4,this.runTween({duration:.07,props:{position:new ei(this.tile.worldPos.x+6,this.tile.worldPos.y,1)},easing:"sineInOut"})];case 3:return a.sent(),[4,this.runTween({duration:.17,props:{position:new ei(this.tile.worldPos.x-4,this.tile.worldPos.y,1)},easing:"sineInOut"})];case 4:return a.sent(),[4,this.runTween({duration:.13,props:{position:new ei(this.tile.worldPos.x+2,this.tile.worldPos.y,1)},easing:"sineInOut"})];case 5:return a.sent(),[4,this.runTween({duration:.1,props:{position:new ei(this.tile.worldPos.x,this.tile.worldPos.y,1)},easing:"sineInOut"})];case 6:return a.sent(),[3,8];case 7:return a.sent(),[3,8];case 8:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"createPositionTween",value:function(a,o){return Y(this.tile.node).to(a,{position:new ei(o.x,o.y)},{easing:"sineInOut"})}},{key:"createAngleTween",value:function(a,o,C){return Y(this.tile.node).to(a,{angle:C})}},{key:"refreshState",value:function(){this.tile.node.angle=0,this.tile.node.position=new ei(this.tile.worldPos.x,this.tile.worldPos.y),this.tile.node.angle=0}},{key:"runTween",value:(C=B(function(a,o){var C,A,P,B;return _ts_generator(this,function(R){switch(R.label){case 0:return A=(C=ts.makeTweenPromise(I(I({},a),{},{node:this.tile.node}))).tween,P=C.promise,B=C.id,this.listDictTween[B]=A,A.name=o,[4,P];case 1:return R.sent(),delete this.listDictTween[B],[2]}})}),function(a,o){return C.apply(this,arguments)})},{key:"stop",value:function(a){var o,C=(a||{}).refreshState;(void 0===C||C)&&this.refreshState(),null==(o=this.moveAndWaveHoldTween)||o.stop();var A=0;for(var P in this.listDictTween){if("scaleUp"===this.listDictTween[P].name)try{A=this.listDictTween[P]._finalAction._elapsed}catch(a){}this.listDictTween[P].stop(),delete this.listDictTween[P]}return A}}]),n}();U._RF.pop(),U._RF.push({},"a65aeGCfdBML4RaMWbeoHQp","TileRemoveTween",void 0);var wJ=function(){var C,A,P;function n(a){o(this,n),this.tile=void 0,this.listDictTween={},this.tile=a}return a(n,[{key:"removeTileFromRack",value:(P=B(function(a,o,C){var A,P;return _ts_generator(this,function(I){switch(I.label){case 0:this.stop(),I.label=1;case 1:return I.trys.push([1,5,,6]),this.tile.state=t1.DESTROYING,[4,ts.waitTweenAsync(C)];case 2:return I.sent(),A=83.98/68.86,[4,this.runTween({duration:.034,props:{scale:new ei(this.tile.node.scale.x*A,this.tile.node.scale.y*A)},easing:"linear"})];case 3:return I.sent(),Y(this.tile.node).delay(.14).call(function(){o(),td.gameScene.gamePlay.vibrate.vibrate(50)}).start(),P=Y(this.tile.node).delay(.033).to(.267,{scale:new ei(0,0,0)},{easing:tt(.81,.06,.54,.79)}).call(function(){a()}),[4,ts.runTweenAsync(P)];case 4:return I.sent(),[3,6];case 5:return I.sent(),[3,6];case 6:return[2]}})}),function(a,o,C){return P.apply(this,arguments)})},{key:"moveTweenFinal",value:(A=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:return C.trys.push([0,3,,4]),[4,this.runTween({duration:.336,props:{position:new ei(a.x,a.y)},easing:"quartOut"})];case 1:return C.sent(),[4,this.runTween({duration:.26,props:{position:new ei(o.x,o.y)},easing:"quartIn"})];case 2:return C.sent(),[3,4];case 3:return C.sent(),[3,4];case 4:return[2]}})}),function(a,o){return A.apply(this,arguments)})},{key:"runTween",value:(C=B(function(a){var o,C,A,P;return _ts_generator(this,function(B){switch(B.label){case 0:return C=(o=ts.makeTweenPromise(I(I({},a),{},{node:this.tile.node}))).tween,A=o.promise,P=o.id,this.listDictTween[P]=C,[4,A];case 1:return B.sent(),delete this.listDictTween[P],[2]}})}),function(a){return C.apply(this,arguments)})},{key:"stop",value:function(){for(var a in this.listDictTween)this.listDictTween[a].stop();this.listDictTween={}}}]),n}();U._RF.pop(),U._RF.push({},"4681fmjkk5LRYxhsjXwdQBu","TileSpecialMatch3",void 0);var wZ,wQ,w$,w0,w1,w2,w3,w4,w5,w6,w7,w8,w9,Se,St,Sn,Si,Sr,Sa,So,Ss,Sl,Su,Sc,Sh,Sp,Sd,Sf,Sy=function(){var C,A,P,R,E,L,O;function n(a){o(this,n),this.tile=void 0,this.listDictTween={},this.tile=a}return a(n,[{key:"playRotationTween",value:(O=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.runTween({duration:.378,props:{angle:-360},easing:"quadOut"})];case 1:return a.sent(),this.tile.node.angle=0,[3,3];case 2:return a.sent(),[3,3];case 3:return[2]}})}),function(){return O.apply(this,arguments)})},{key:"moveVerticalTween",value:(L=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:o=(null==(a=this.tile.node.getComponent(en))?void 0:a.contentSize.height)*this.tile.node.scale.y*3,C.label=1;case 1:return C.trys.push([1,4,,5]),[4,this.runTween({duration:.336,props:{position:new ei(this.tile.node.position.x,this.tile.node.position.y-o)},easing:"quadOut"})];case 2:return C.sent(),[4,this.runTween({duration:.26,props:{position:new ei(this.tile.node.position.x,this.tile.node.position.y+o)},easing:"quadIn"})];case 3:return C.sent(),[3,5];case 4:return C.sent(),[3,5];case 5:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"playJumpTween",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,Promise.all([this.playRotationTween(),this.moveVerticalTween()])];case 1:return a.sent(),[3,3];case 2:return a.sent(),[3,3];case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"playSlidingTween",value:(R=B(function(a,o){var C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return B.trys.push([0,3,,4]),A=(221-(C=(1===a?0:39)/1e3))/1e3,this.playScaleXIncreasingAnimation().catch(function(a){}),[4,this.movingRightTween(C,A)];case 1:return B.sent(),I=(467-(P=39*a/1e3))/1e3,this.playScaleXDecreasingAnimation().catch(function(a){}),[4,this.movingLeftTween(P,I,o)];case 2:return B.sent(),[3,4];case 3:return B.sent(),[3,4];case 4:return[2]}})}),function(a,o){return R.apply(this,arguments)})},{key:"movingRightTween",value:function(a,o){return this.runTween({duration:o,props:{position:new ei(this.tile.node.position.x+60,this.tile.node.position.y)},easing:"cubicOut",timeDelay:a})}},{key:"movingLeftTween",value:function(a,o,C){return this.runTween({duration:o,props:{position:new ei(C,this.tile.node.position.y)},easing:"cubicOut",timeDelay:a})}},{key:"playScaleXIncreasingAnimation",value:(P=B(function(){var a;return _ts_generator(this,function(o){return a=this.tile.node.scale.x,[2,this.runTween({duration:.144,props:{scale:new ei(1.2*a,this.tile.node.scale.y)},easing:"sineOut"})]})}),function(){return P.apply(this,arguments)})},{key:"playScaleXDecreasingAnimation",value:(A=B(function(){var a;return _ts_generator(this,function(o){return a=this.tile.node.scale.x,[2,this.runTween({duration:.084,props:{scale:new ei(a/1.2,this.tile.node.scale.y)},easing:"sineOut"})]})}),function(){return A.apply(this,arguments)})},{key:"runTween",value:(C=B(function(a){var o,C,A,P;return _ts_generator(this,function(B){switch(B.label){case 0:return C=(o=ts.makeTweenPromise(I(I({},a),{},{node:this.tile.node}))).tween,A=o.promise,P=o.id,this.listDictTween[P]=C,[4,A];case 1:return B.sent(),delete this.listDictTween[P],[2]}})}),function(a){return C.apply(this,arguments)})}]),n}();U._RF.pop(),U._RF.push({},"cf7d2e1EExO/LW5yR5ISk7S","Tile",void 0);var Sv,Sm,Sg,Sb,Sk,Sw=$.ccclass,SS=$.property,ST=(wZ=Sw("Tile"),wQ=SS(en),w$=tj.required,w0=SS(wK),w1=tj.required,w2=SS(en),w3=tj.required,w4=SS(en),w5=tj.required,w6=tj.required,w7=tj.required,w8=tj.required,w9=tj.required,Se=tj.required,St=tj.required,Sn=tj.required,wZ(((Sf=function(P){C(m,P);var I,R,E,L,F,D,M,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=z.call.apply(z,[this].concat(A)),O(a,"backGlow",Si,N(a)),O(a,"backgroundWithIcon",Sr,N(a)),O(a,"frontGlow",Sa,N(a)),O(a,"magicGlow",So,N(a)),O(a,"backGlowOpacity",Ss,N(a)),O(a,"magicGlowOpacity",Sl,N(a)),O(a,"tileInitTween",Su,N(a)),O(a,"tilePointerTween",Sc,N(a)),O(a,"tileFallTween",Sh,N(a)),O(a,"tileRemoveTween",Sp,N(a)),O(a,"tileSpecialMatch3",Sd,N(a)),a.id=-1,a.gridPos=new H(0,0),a.worldPos=new H(0,0),a.currentSize=new H(0,0),a.state=t1.PRELOADING,a.isActive=!0,a.isCleanData=!1,a.readyToRemove=!1,a.isRotated=!1,a.isHandleFinalAnim=!1,a.indexInContainer=-1,a.depth=0,a.layer=0,a.uiTransform=void 0,a.tileClickedEmitter=null,a.tileStarParticle=null,a.tileBurstLandingParticle=null,a.inputHandler=void 0,a.tweenScalePromises=[],a.willCloseAfterPlayingMoveToRack=!1,a}return a(m,[{key:"__preload",value:function(){var a=this;this.uiTransform=this.node.getComponent(en),this.node.scene.on(t2.ALL_TILE_READY,function(){a.switchToReadyState()},this),this.node.scene.on(t2.BACK_TO_DASHBOARD_FROM_GAMEPLAY,function(){a.state===t1.MOVING_TO_CONTAINER&&(a.willCloseAfterPlayingMoveToRack=!0)},this),this._init(),this.validateRequiredComponents()}},{key:"_init",value:function(){this.node.scale=new ei(0,0,0),this.tileInitTween=new wj(this),this.tilePointerTween=new wX(this),this.tileFallTween=new wY(this),this.tileRemoveTween=new wJ(this),this.tileSpecialMatch3=new Sy(this),this.backGlowOpacity=this.backGlow.getComponent(ea),this.backGlowOpacity.opacity=0,this.magicGlowOpacity=this.magicGlow.getComponent(ea),this.magicGlowOpacity.opacity=0,this.inputHandler=this.node.getComponent(t3)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,m)}},{key:"onLoad",value:function(){}},{key:"returnToPool",value:function(){this.isCleanData||this.node.scene.emit(t2.TILE_DESTROYED,this),this.resetState(),td.gameScene.gamePlay.gameObjects.tilePool.returnTile(this.node)}},{key:"setSize",value:function(a,o){m.tileSize.set(a,o),this.uiTransform.setContentSize(a,o),this.frontGlow.setContentSize(a,o),this.backGlow.setContentSize(1.07*a,1.07*o),this.magicGlow.setContentSize(1.25*a,1.25*o),this.updateBackgroundWithIconScale()}},{key:"updateBackgroundWithIconScale",value:function(){this.backgroundWithIcon.updateScaleToFitSize(this.uiTransform.contentSize)}},{key:"setInitSize",value:function(a,o){this.setSize(a,o),this.currentSize=new H(a,o)}},{key:"getSize",value:function(){return this.uiTransform.contentSize}},{key:"addOffset",value:function(a,o){var C=this.node.position,A=C.x,P=C.y,I=C.z;this.node.position=new ei(A+a,P+o,I)}},{key:"setDepth",value:function(a){this.depth=a}},{key:"getDepth",value:function(){return this.depth}},{key:"setLayer",value:function(a){this.layer=a}},{key:"getLayer",value:function(){return this.layer}},{key:"handleInitializeTile",value:function(){this.toggleActive(this.isActive)}},{key:"setItemSprite",value:function(a){this.backgroundWithIcon.setIcon(a)}},{key:"toggleActive",value:function(a,o){var C=arguments.length>1&&void 0!==o?o:.5;this.isActive=a,a?this.fadeToLightColor(C):this.fadeToDarkColor(C)}},{key:"handleTileClicked",value:function(a){var o=a.useMagicWand,C=a.scaleUpElapse;if(this.isActive&&this.node){this.inputHandler.unListenEvents(),this.node.scene.emit(t2.TILE_CLICKED,this,void 0!==o&&o,C);var A=td.gameScene.gamePlay.tileManager;1===td.levelManager.getLevel()&&A.setUpTutorialHand()}}},{key:"setActive",value:function(a){this.isActive=a}},{key:"swapTileData",value:function(a){var o=this.gridPos,C=this.worldPos,A=this.getDepth(),P=this.getLayer();this.gridPos=a.gridPos,this.worldPos=a.worldPos,this.depth=a.getDepth(),this.layer=a.getLayer(),a.gridPos=o,a.worldPos=C,a.setDepth(A),a.setLayer(P)}},{key:"playReachDestinationUndoAnim",value:(x=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return a=t0.ANIMATION_CONFIGS.UNDO.TIME,o=this.createScaleTween(a,1,1),C=this.createScaleTween(a,1.2,.98),A=this.createScaleTween(a,.98,1.2),P=this.createScaleTween(a,1.1,.9),this.showBurstLandingEffect(),[4,ts.runTweenAsync(C)];case 1:return I.sent(),[4,ts.runTweenAsync(A)];case 2:return I.sent(),[4,ts.runTweenAsync(P)];case 3:return I.sent(),[4,ts.runTweenAsync(o)];case 4:return I.sent(),[2]}})}),function(){return x.apply(this,arguments)})},{key:"createScaleTween",value:function(a,o,C,A,P){var I=arguments.length>3&&void 0!==A?A:"smooth",B=arguments.length>4&&void 0!==P?P:0;return Y(this.node).delay(B).to(a,{scale:new ei(o,C,1)},{easing:I})}},{key:"playMagicWandAnim",value:function(){var a=this;th.playSound(tZ.TILE_TAP);var o=t0.ANIMATION_CONFIGS.HOLD.SCALE,C=this.createScaleTween(.1,o,o,"smooth"),A=Y(this.magicGlowOpacity).to(.05,{opacity:255},{easing:"sineOut"}),P=Y(this.magicGlowOpacity).to(.05,{opacity:0},{easing:"sineOut"});A.start(),C.call(function(){a.handleTileClicked({useMagicWand:!0}),P.start()}).start()}},{key:"playShuffleAnim",value:(M=B(function(a){var o,C,A,P,I,B,R,E,L,O,N,F,D,M,x,z,q,U,H,W,V;return _ts_generator(this,function(K){switch(K.label){case 0:if(o=a.maxRow,C=a.maxCol,A=a.minRow,P=a.minCol,I=a.bonusSpace,B=a.maxScale,R=a.offsetHeight,E=this.worldPos.x,L=this.worldPos.y,O=this.gridPos.y,N=this.gridPos.x,!this.uiTransform)return[3,3];return F=(o+A)/2,D=E+(N-(C+P)/2)*(this.uiTransform.width*(B-1)+I),M=L+(F-O)*(this.uiTransform.height*(B-1)+I+R),x=E,z=L,q=t0.ANIMATION_CONFIGS.SHUFFLE.SECOND_SCALE,U=this.createScaleTween(.15,1,1,"sineInOut"),H=this.createScaleTween(.15,q,q,"sineInOut",.25).call(function(){U.start()}),W=Y(this.node).to(.5,{position:new ei(D,M)},{easing:"quartOut"}),V=Y(this.node).delay(.2).to(.3,{scale:new ei(B,B)},{easing:"quartOut"}),[4,Promise.all([ts.runTweenAsync(W),ts.runTweenAsync(V)])];case 1:return K.sent(),H.start(),[4,ts.runTweenAsync(Y(this.node).to(.2,{position:new ei(x,z),scale:new ei(.95,.95,1)},{easing:"quartIn"}))];case 2:K.sent(),this.showStarParticleEffect(),this.toggleActive(this.isActive,.2),K.label=3;case 3:return[2]}})}),function(a){return M.apply(this,arguments)})},{key:"createFinishShuffleAnim",value:(D=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return a=t0.ANIMATION_CONFIGS.SHUFFLE.SECOND_SCALE,o=this.createScaleTween(.15,1,1,"sineInOut"),C=this.createScaleTween(.15,a,a,"sineInOut"),A=this.createScaleTween(.15,1,1,"sineInOut"),[4,ts.runTweenAsync(o)];case 1:return P.sent(),[4,ts.runTweenAsync(C)];case 2:return P.sent(),[4,ts.runTweenAsync(A)];case 3:return P.sent(),[2]}})}),function(){return D.apply(this,arguments)})},{key:"fadeToLightColor",value:function(a){var o=arguments.length>0&&void 0!==a?a:.3;this.backgroundWithIcon.fadeOverlay({opacity:0,duration:o})}},{key:"fadeToDarkColor",value:function(a){var o=arguments.length>0&&void 0!==a?a:.3;this.backgroundWithIcon.fadeOverlay({opacity:89.25,duration:o})}},{key:"moveTileToWorldPosition",value:(F=B(function(a){var o,C;var A=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:return o=A.length>1&&void 0!==A[1]?A[1]:.2,this.node.scale=new ei(1,1,1),this.tileFallTween.isScale=!1,this.state=t1.MOVING_BACK_TO_BOARD,C=Y(this.node).to(o,{position:new ei(this.worldPos.x,this.worldPos.y)},{easing:"smooth"}),[4,ts.runTweenAsync(C)];case 1:return P.sent(),a(),[2]}})}),function(a){return F.apply(this,arguments)})},{key:"debugTile",value:function(){this.state,t1.PRELOADING,this.state,t1.ALREADY,this.state,t1.MOVING_TO_CONTAINER,this.state,t1.AT_CONTAINER}},{key:"showEmitterParticleEffect",value:(L=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=td.gameScene.gamePlay,this.tileClickedEmitter=a.vfxManager.getEmitterTile(),this.tileClickedEmitter.node.parent!==this.node&&(this.tileClickedEmitter.node.parent=this.node),this.tileClickedEmitter.node.setSiblingIndex(this.node.getSiblingIndex()+1),this.tileClickedEmitter.node.position=ei.ZERO,[4,this.tileClickedEmitter.show()];case 1:return o.sent(),this.tileClickedEmitter=null,[2]}})}),function(){return L.apply(this,arguments)})},{key:"showStarParticleEffect",value:(E=B(function(){var a,o;return _ts_generator(this,function(C){return a=td.gameScene.gamePlay,this.tileStarParticle=a.vfxManager.getStarTileVFX(),o=this.node.getWorldPosition(),this.tileStarParticle.node.setSiblingIndex(this.node.getSiblingIndex()+1),this.tileStarParticle.node.setWorldPosition(o),this.tileStarParticle.playVfx(),this.tileStarParticle=null,[2]})}),function(){return E.apply(this,arguments)})},{key:"showBurstLandingEffect",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=td.gameScene.gamePlay,this.tileBurstLandingParticle=a.vfxManager.getBurstLandingVFX(),this.tileBurstLandingParticle.node.parent!==this.node&&(this.tileBurstLandingParticle.node.parent=this.node),this.tileBurstLandingParticle.node.setSiblingIndex(0),this.tileBurstLandingParticle.node.position=new ei(0,0,this.tileBurstLandingParticle.node.position.z),this.tileBurstLandingParticle.playVfx(),[2]})}),function(){return R.apply(this,arguments)})},{key:"resetState",value:function(){this.node.scale=new ei(0,0,0),this.backGlowOpacity.opacity=0,this.magicGlowOpacity.opacity=0,this.id=-1,this.gridPos=new H(0,0),this.worldPos=new H(0,0),this.currentSize=new H(0,0),this.state=t1.PRELOADING,this.isActive=!0,this.isCleanData=!1,this.readyToRemove=!1,this.isRotated=!1,this.isHandleFinalAnim=!1,this.indexInContainer=-1,this.depth=0,this.layer=0,this.tileFallTween.isScale=!1,this.tileInitTween.currentScale=new ei(0,0,0),this.tileClickedEmitter&&this.tileClickedEmitter.stopAllParticles(),this.tileStarParticle&&this.tileStarParticle.stopAllParticles(),this.tileBurstLandingParticle&&this.tileBurstLandingParticle.stopAllParticles(),this.tileClickedEmitter=null,this.tileStarParticle=null,this.tileBurstLandingParticle=null,em.stopAllByTarget(this.node)}},{key:"switchToReadyState",value:function(){this.state=t1.ALREADY,this.inputHandler.listenEvents()}},{key:"toggleBackground",value:function(a){this.backgroundWithIcon.background.enabled=a}},{key:"handleCloseTile",value:(I=B(function(){var a,o;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:return a=C.length>0&&void 0!==C[0]?C[0]:.075,o=C.length>1&&void 0!==C[1]?C[1]:0,[4,Promise.all(this.tweenScalePromises)];case 1:return A.sent(),this.tweenScalePromises=[],[4,this.tileInitTween.closeTile(a,o)];case 2:return A.sent(),[2]}})}),function(){return I.apply(this,arguments)})}],[{key:"TILE_SIZE",get:function(){return this.tileSize}}]),m}(eo)).tileSize=new H(0,0),Si=L(Sf.prototype,"backGlow",[wQ,w$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sr=L(Sf.prototype,"backgroundWithIcon",[w0,w1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sa=L(Sf.prototype,"frontGlow",[w2,w3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),So=L(Sf.prototype,"magicGlow",[w4,w5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ss=L(Sf.prototype,"backGlowOpacity",[w6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sl=L(Sf.prototype,"magicGlowOpacity",[w7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Su=L(Sf.prototype,"tileInitTween",[w8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sc=L(Sf.prototype,"tilePointerTween",[w9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=L(Sf.prototype,"tileFallTween",[Se],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sp=L(Sf.prototype,"tileRemoveTween",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd=L(Sf.prototype,"tileSpecialMatch3",[Sn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sf))||Sf);U._RF.pop(),U._RF.push({},"c738e+QNMpLKoDl3F0qcJNx","TilePool",void 0);var SC=$.ccclass,SA=$.property,S_=(Sv=SC("TilePool"),Sm=SA(eY),Sg=tj.required,Sv((Sk=L((Sb=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"tilePrefab",Sk,N(a)),a.pool=[],a.preInstantiateCount=50,a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"start",value:function(){this.preInstantiateTiles()}},{key:"getTile",value:function(){if(this.pool.length>0){var a=this.pool.pop();a.active=!0;var o=a.getComponent(ST);return o&&(o.isActive=!0),a}var C=ej(this.tilePrefab);return C.active=!0,C}},{key:"returnTile",value:function(a){this.resetTile(a),a.active=!1,this.pool.push(a)}},{key:"resetTile",value:function(a){em.stopAllByTarget(a),a.angle=0}},{key:"preInstantiateTiles",value:function(){for(var a=0;a<this.preInstantiateCount;a++){var o=ej(this.tilePrefab);o.active=!1,this.pool.push(o)}}}]),r}(eo)).prototype,"tilePrefab",[Sm,Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb))||Sb);U._RF.pop(),U._RF.push({},"7afacLLLehG7JGzeyuPT5rD","AlignTile",void 0);var SP=159/143;U._RF.pop(),U._RF.push({},"c588b2ySTtBkILmXpWOjeB2","AlignTileManager",void 0);var SI,SB,SR,SE,SL,SO,SN,SF,SD,SM,Sx=function(){function n(a){o(this,n),this.gameScene=void 0,this.bottomBorder=0,this.topBorder=0,this.tileSize={width:0,height:0},this.tilePaddingLRX=0,this.tilePaddingTBY=0,this.minGridPosX=0,this.maxGridPosX=0,this.minGridPosY=0,this.maxGridPosY=0,this.gameScene=a}return a(n,[{key:"useParams",value:function(a,o,C,A){var P=this.gameScene.gamePlay;this.topBorder=P.gameUI.header.height+P.tileContainer.height,this.bottomBorder=P.gameUI.footer.height+tf.getBannerAdWorldHeight(),this.minGridPosX=a,this.maxGridPosX=o,this.minGridPosY=C,this.maxGridPosY=A;var I=this.calculateTileSize(a,o,C,A);this.tileSize={width:I.width,height:I.height},this.tilePaddingLRX=I.paddingXLeftRight,this.tilePaddingTBY=I.paddingYTopBot}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getTopBotBorder",value:function(){return{top:this.topBorder,bottom:this.bottomBorder}}},{key:"getTilePosition",value:function(a,o){var C=this.tileSize.width+this.tilePaddingLRX,A=this.tileSize.height+this.tilePaddingTBY;this.tilePaddingLRX<0&&(C=this.tileSize.width+this.tilePaddingLRX/2),this.tilePaddingTBY<0&&(A=this.tileSize.height+this.tilePaddingTBY/2);var P=(this.minGridPosY+this.maxGridPosY)/2;return{x:a*C-(this.minGridPosX+this.maxGridPosX)/2*C,y:-o*A+P*A+0}}},{key:"getAvailableTileSizeW",value:function(a){var o=a.boardMaxCoordX,C=a.boardMaxCoordY,A=a.expectedBoardW,P=a.expectedBoardH,I=Math.abs(-.48),B=144.33,R=144.33,E=-0,L=144.33*SP/1.48*-.48,O=(o+1)*144.33,N=144.33*SP*(C+1);N=144.33*SP*(C+1)+(C+2)*-L/2;var F=A/(o+1),D=-0*F,M=(F-D)*SP/1.48;R>F&&(B=(R=F)-D,E=D,L=-.48*M,O=(o+1)*R,N=(C+1)*M);var x=P/(C+1+(C+2)*I/2),z=-.48*x,q=(x-z)/SP,U=q/1;return R>U&&(B=q,O=(o+1)*(R=U)+(o+2)*-(E=-0*R)/2,N=(C+1)*x+(C+2)*-(L=z)/2),{size:B,paddingXLeftRight:E,paddingYTopBot:L,realBoardWidth:O,realBoardHeight:N}}},{key:"getCurrentExpectedBoardHeight",value:function(){var a=this.gameScene.gamePlay;return eP.getVisibleSize().height-a.gameUI.footer.height-this.gameScene.gamePlay.tileContainer.height-tf.getBannerAdWorldHeight()-a.gameUI.header.height}},{key:"getExpectedBoardAndRackHeight",value:function(){var a=this.gameScene.gamePlay;return eP.getVisibleSize().height-a.gameUI.footer.height-tf.getBannerAdWorldHeight()-a.gameUI.header.height}},{key:"calculateTileSize",value:function(a,o,C,A){var P=this.gameScene.gamePlay.gameUI,I=P.header,B=P.footer;B.resizeFooter(1),this.gameScene.gamePlay.tileContainer.alignTileContainer();var R=this.getCurrentExpectedBoardHeight(),E=eP.getVisibleSize().width-12,L=this.getAvailableTileSizeW({boardMaxCoordX:o-a,boardMaxCoordY:A-C,expectedBoardW:E,expectedBoardH:R}),O=L.size,N=L.paddingXLeftRight,F=L.paddingYTopBot;return L.realBoardWidth,L.realBoardHeight,this.bottomBorder=B.height+tf.getBannerAdWorldHeight(),I.challengeBlock.setBlockSize(),{width:O,height:O*SP,paddingXLeftRight:N,paddingYTopBot:F}}}]),n}();U._RF.pop(),U._RF.push({},"cd2ba2gVJ1P87laj7G+ata0","GameObjects",void 0);var Sz,SG,Sq,SU,SH,SW=$.ccclass,SV=$.property,SK=(SI=SW("GameObjects"),SB=tj.required,SR=SV(S_),SE=tj.required,SL=SV(wU),SO=tj.required,SI((SF=L((SN=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"tilePool",SF,N(a)),O(a,"goldTilePool",SD,N(a)),O(a,"alignManager",SM,N(a)),a.tileCounter=0,a.minColTiles=0,a.maxColTiles=0,a.minRowTiles=0,a.maxRowTiles=0,a.tiles=[],a}return a(r,[{key:"__preload",value:function(){this.initManagers(),tj.validateRequiredProperties(this,r)}},{key:"initManagers",value:function(){this.alignManager=new Sx(td.gameScene)}},{key:"getExpectedBoardAndRackHeight",value:function(){return this.alignManager.getExpectedBoardAndRackHeight()}},{key:"spawnObjects",value:function(a){this.sortDataAndCreateTiles(a)}},{key:"sortDataAndCreateTiles",value:function(a){this.minColTiles=Number.MAX_VALUE,this.maxColTiles=5e-324,this.minRowTiles=Number.MAX_VALUE,this.maxRowTiles=5e-324,td.gameScene.gamePlay.loader.shuffleTiles();var o,C=new Map,A=0,P=-1,I=E(a);try{for(I.s();!(o=I.n()).done;){var B,R=o.value,L=E(R.layers);try{for(L.s();!(B=L.n()).done;){var O,N=B.value,F=E(N.tiles);try{for(F.s();!(O=F.n()).done;){var D=O.value;D.x<this.minColTiles&&(this.minColTiles=D.x),D.x>this.maxColTiles&&(this.maxColTiles=D.x),D.y<this.minRowTiles&&(this.minRowTiles=D.y),D.y>this.maxRowTiles&&(this.maxRowTiles=D.y);var M=C.get(A);if(void 0===M){var x=[D];C.set(A,x)}else M.push(D)}}catch(a){F.e(a)}finally{F.f()}A>P&&(P=A),A++}}catch(a){L.e(a)}finally{L.f()}A=0}}catch(a){I.e(a)}finally{I.f()}this.alignManager.useParams(this.minColTiles,this.maxColTiles,this.minRowTiles,this.maxRowTiles);var z=this.node.getComponent(eX);if(z){var q=this.alignManager.getTopBotBorder(),U=q.top,H=q.bottom;z.top=U,z.bottom=H}for(var W=0,V=0;V<=P;V++){var K=C.get(V);if(K){K.sort(function(a,o){return a.y===o.y?o.x-a.x:o.y-a.y});for(var Y=K.length-1;Y>=0;Y--){var j=K[Y];this.spawnTile(j,W,V),W++}}}}},{key:"spawnTile",value:function(a,o,C){var A=this.alignManager.getTileSize(),P=this.alignManager.getTilePosition(a.x,a.y),I=P.x,B=P.y,R=new H(I,B),E=this.createTileInstance();if(E){E.setPosition(R.x,R.y,0);var L=E.getComponent(ST);if(L){L.toggleBackground(!0);var O=null;(O=td.gameScene.gamePlay.isTutorialLevel()?td.gameScene.gamePlay.loader.getOriginalTileIcon(a.skinIdx):td.gameScene.gamePlay.loader.getTileIcon(a.skinIdx))&&L.setItemSprite(O),L.id=a.skinIdx,L.gridPos=new H(a.x,a.y),L.worldPos=R,L.setLayer(C),L.setDepth(o),L.setInitSize(A.width,A.height),this.tileCounter--,this.tiles.push(L),this.node.scene.emit(t2.TILE_CREATED,{tile:L,layerCounter:C})}}}},{key:"createTileInstance",value:function(){var a=this.tilePool.getTile();return _instanceof(a,ee)?(a.parent!==this.node?this.node.addChild(a):a.setSiblingIndex(this.node.children.length-1),a):null}},{key:"createGoldTileInstance",value:function(){var a=this.goldTilePool.getGoldTile();return _instanceof(a,ee)?(this.node.addChild(a),a):null}}]),r}(eo)).prototype,"tilePool",[SB,SR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SD=L(SN.prototype,"goldTilePool",[SE,SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SM=L(SN.prototype,"alignManager",[SO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SN))||SN);U._RF.pop(),U._RF.push({},"8d626EshYNLsJ/mPE1B+cUE","TileIconPositionManager",void 0);var SY,Sj=$.ccclass,SX=$.property,SJ={30:[0,13],29:[-1.5,11],28:[3.5,12],27:[.5,13.5],26:[-5,12],25:[.5,14],24:[.5,13],23:[.5,12],22:[.5,13.5],21:[0,13],20:[0,14],19:[.5,14],18:[-3,13.5],17:[.5,13.5],16:[1,14.5],15:[1,13],14:[1,12],13:[.5,13],12:[0,13.5],11:[.5,11],10:[0,14],9:[1,12],8:[.5,9.5],7:[1,13.5],6:[-1,13],5:[.5,13],4:[.5,14],3:[.5,13.5],2:[-1,12],1:[-.5,11.5]},SZ=(Sz=Sj("TileIconPositionManager"),SG=tj.required(function(a){return!Array.isArray(a)||a.some(function(a){return!_instanceof(a,et)})}),Sq=SX([et]),Sz((SH=L((SU=function(){function n(){o(this,n),O(this,"spriteFrames",SH,this)}return a(n,[{key:"getIconPosition",value:function(a){var o=this.spriteFrames.indexOf(a);if(-1===o)return new H;var C=SJ["".concat(o+1)];if(!C)return new H;var A=z(C,2),P=A[0],I=A[1];return new H(P,I)}}]),n}()).prototype,"spriteFrames",[SG,Sq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SU))||SU);U._RF.pop(),U._RF.push({},"68f3dBU2ehLtJiN/ZD0GYWg","TimerHandler",void 0);var SQ=(0,$.ccclass)("TimerHandler")(SY=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=R.call.apply(R,[this].concat(A))).leaderboardTimer=-1,a.isLBCountDownStarted=!1,a.leaderboardTimerCallback=null,a}return a(s,[{key:"startLeaderboardCountDown",value:(I=B(function(){var a,o,C,A;var P=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:if(a=this,C=void 0!==(o=(P.length>0&&void 0!==P[0]?P[0]:{}).forceStart)&&o,this.isLBCountDownStarted){if(!C)return[2];this.stopLeaderboardTimer()}return this.isLBCountDownStarted=!0,A=this,[4,td.tournamentManager.getRemainingTimeLeaderBoard()];case 1:return A.leaderboardTimer=I.sent(),this.node.scene.emit(t2.LEADER_BOARD_TIMER_COUNT_DOWN,this.leaderboardTimer),this.leaderboardTimer<=0?this.stopLeaderboardTimer():(this.leaderboardTimerCallback=function(){a.addLeaderboardTimer(-1),a.node.scene.emit(t2.LEADER_BOARD_TIMER_COUNT_DOWN,a.leaderboardTimer)},this.schedule(this.leaderboardTimerCallback,1)),[2]}})}),function(){return I.apply(this,arguments)})},{key:"addLeaderboardTimer",value:function(a){this.leaderboardTimer+=a,this.leaderboardTimer>0||this.stopLeaderboardTimer()}},{key:"stopLeaderboardTimer",value:function(){this.isLBCountDownStarted=!1,this.unschedule(this.leaderboardTimerCallback)}},{key:"getLeaderboardTimer",value:function(){return this.leaderboardTimer}}]),s}(eo))||SY;U._RF.pop(),U._RF.push({},"26ee10kCUFP57/FOyEFCui/","TournamentStack",void 0);var S$,S0,S1,S2,S3,S4,S5,S6,S7=function(){function n(){o(this,n),this.tournamentStack=[]}return a(n,[{key:"pushTournament",value:function(a){this.tournamentStack.push(a)}},{key:"popTournament",value:function(){return this.tournamentStack.pop()}},{key:"addToFirstTournament",value:function(a){this.tournamentStack.unshift(a)}},{key:"getTournamentStackLength",value:function(){return this.tournamentStack.length}},{key:"getLastTournament",value:function(){return this.tournamentStack[this.tournamentStack.length-1]}}]),n}();U._RF.pop(),U._RF.push({},"bc59avgdUZE0YNYMzlyu31O","GameLoader",void 0);var S8=$.ccclass,S9=$.property,Te=(S$=S8("GameLoader"),S0=S9([et]),S1=tj.required(ni(et)),S2=S9(et),S3=tj.required,S$((S5=L((S4=function(){var C,A,P;function n(){var a=this;o(this,n),O(this,"tileIcons",S5,this),O(this,"goldTileIcon",S6,this),this.originalTileIcons=[],this.stampCardsPromise=[],this.stampCards=new Map,this.photoCards=new Map,this.spineMap=new Map,this.loadSpinePrefabAsync=B(function(){var o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:for(C in o=[],kf)o.push(C);A=0,B.label=1;case 1:if(!(A<o.length))return[3,4];return P=kf[o[A]],[4,to.loadPrefabAsync(P)];case 2:(I=B.sent())&&a.spineMap.set(P,I),B.label=3;case 3:return A++,[3,1];case 4:return[2]}})})}return a(n,[{key:"init",value:function(){this.originalTileIcons=R(this.tileIcons),tj.validateRequiredProperties(this,n)}},{key:"getSpinePrefab",value:function(a){var o=this.spineMap.get(a);if(o)return o}},{key:"loadPhotoCardsAsync",value:(P=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:o="".concat(no.THEME_CARD_PREFIX).concat(a,"/spriteFrame"),A.label=1;case 1:return A.trys.push([1,3,,4]),[4,to.loadSpriteFrameAsync(o)];case 2:return[2,((C=A.sent())&&this.photoCards.set(a,C),!!C)];case 3:return A.sent(),[2,!1];case 4:return[2]}})}),function(a){return P.apply(this,arguments)})},{key:"loadAllStampCardAsync",value:function(){for(var a=this,t=function(o){var C="".concat(no.THEME_STAMP_PREFIX,"background_").concat(o,"/spriteFrame");try{var A=to.loadSpriteFrameAsync(C).then(function(C){return C&&a.stampCards.set("frame-bg-".concat(o),C),C});a.stampCardsPromise.push(A)}catch(a){}},o=1;o<=25;o++)t(o)}},{key:"loadStampFrameAsync",value:(A=B(function(a){var o;return _ts_generator(this,function(C){return o=this.getIndexOfCard(a),[2,this.stampCardsPromise[o]]})}),function(a){return A.apply(this,arguments)})},{key:"getIndexOfCard",value:function(a){var o=a.split("-");return parseInt(o[o.length-1])-1}},{key:"checkIsAlreadyStamp",value:function(a){return this.stampCards.has(a)}},{key:"checkIsAlreadyPhoto",value:function(a){return this.photoCards.has(a)}},{key:"getStampFrame",value:function(a){return this.stampCards.get(a)}},{key:"getPhotoFrame",value:function(a){return this.photoCards.get(a)}},{key:"loadAllTiles",value:(C=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:a=1,C.label=1;case 1:if(!(a<t0.MAX_TILES))return[3,6];C.label=2;case 2:return C.trys.push([2,4,,5]),[4,to.loadSpriteFrameAsync("".concat(no.TILE_PREFIX).concat(a,"/spriteFrame"))];case 3:return o=C.sent(),this.tileIcons.push(o),[3,5];case 4:return C.sent(),[3,5];case 5:return a++,[3,1];case 6:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"shuffleTiles",value:function(){this.tileIcons=nr.shuffleArray(this.tileIcons)}},{key:"getTileIcon",value:function(a){return this.tileIcons[a]}},{key:"getOriginalTileIcon",value:function(a){return this.originalTileIcons[a]}},{key:"getGoldTileIcon",value:function(){return this.goldTileIcon}},{key:"getTileIconLength",value:function(){return this.tileIcons.length}}]),n}()).prototype,"tileIcons",[S0,S1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),S6=L(S4.prototype,"goldTileIcon",[S2,S3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S4))||S4);U._RF.pop(),U._RF.push({},"8f587x6mzNKpIM1Bgs56WBG","BaseLeaderboardLoader",void 0);var Tt=GameCore.Configs.Mockup,Tn=globalThis.game.player,Ti=function(){var C,A,P,I,E,L;function n(){o(this,n),this.currentPlayerEntry=null,this.leaderboard=null,this.allowLoadNewData=!0,this.rankingLeaders=null,this.tryToCreateMockupLeaderboard()}return a(n,[{key:"tryToCreateMockupLeaderboard",value:(L=B(function(){return _ts_generator(this,function(a){return Tt.Leaderboards.Enabled,[2]})}),function(){return L.apply(this,arguments)})},{key:"getAllowLoadNewData",value:function(){return this.allowLoadNewData}},{key:"getCurrentPlayerEntry",value:function(){return this.currentPlayerEntry}},{key:"getLeaderboard",value:function(){return this.leaderboard}},{key:"getRankingLeaders",value:function(){return this.rankingLeaders}},{key:"setAllowLoadNewData",value:function(a){this.allowLoadNewData=a}},{key:"preloadLeaderboardData",value:(E=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:if(!this.allowLoadNewData)return[3,2];return[4,Promise.all([this.loadLeaderboard(a),this.loadCurrentPlayerEntry(a)])];case 1:o.sent(),this.allowLoadNewData=!1,o.label=2;case 2:return[2]}})}),function(a){return E.apply(this,arguments)})},{key:"loadCurrentPlayerEntry",value:(I=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(o=this,void 0!==a)return[3,2];return[4,td.tournamentManager.getPlayerLeaderBoardAsync()];case 1:return C=A.sent(),[3,4];case 2:return[4,tm.getPlayerLeaderBoardAsync(a)];case 3:C=A.sent(),A.label=4;case 4:return[2,(o.currentPlayerEntry=C,this.currentPlayerEntry)]}})}),function(a){return I.apply(this,arguments)})},{key:"loadLeaderboard",value:(P=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(o=this,void 0!==a)return[3,2];return[4,td.tournamentManager.getTopLeaderPayloadsAsync()];case 1:return C=A.sent(),[3,4];case 2:return[4,tm.getTopLeaderPayloadsAsync(a)];case 3:C=A.sent(),A.label=4;case 4:return[2,(o.leaderboard=C,this.leaderboard.slice(0,tg.MAX_LEADERS),this.leaderboard.sort(function(a,o){return a.rank-o.rank}),this.leaderboard)]}})}),function(a){return P.apply(this,arguments)})},{key:"setPlayerScore",value:(A=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,tb.setLBScoreWithoutJoiningTournament({score:o,leaderboardId:a})];case 1:return[2,C.sent()]}})}),function(a,o){return A.apply(this,arguments)})},{key:"fetchLeaderboard",value:(C=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){if(a=this.getCurrentPlayerEntry(),!(o=this.getLeaderboard()))return[2,(this.rankingLeaders=null,!1)];return C=Tn.getPlayer(),a||(a={playerId:C.playerId,name:C.name,photo:C.photo,score:tg.DEFAULT_SCORE,rank:tg.DEFAULT_RANK}),A=tg.BIGGER.MIN_RANK,o[o.length-1]&&(A=o[o.length-1].rank+1),P=this.createUnknownPlayerEntry(A,tg.MAX_UNKNOWN_LEADERS),o.push.apply(o,R(P)),-1===o.findIndex(function(o){return o.playerId===a.playerId})&&o.push(a),I=o.map(this.castToRankingScrollerData),[2,(this.rankingLeaders=I,!0)]})}),function(){return C.apply(this,arguments)})},{key:"createUnknownPlayerEntry",value:function(a,o){for(var C=[],A=a;A<=o;A++)C.push({playerId:"",name:"???",photo:"",score:-1,rank:A});return C}},{key:"castToRankingScrollerData",value:function(a){return{playerId:a.playerId,name:a.name,photo:a.photo,score:a.score,rank:a.rank,active:!0,idx:a.rank-1}}}]),n}();U._RF.pop(),U._RF.push({},"899e6JTULpI1bEWZ4MaTHfj","GlobalLeaderboardLoader",void 0);var Tr=GameCore.Configs.Leaderboards.LeaderboardList,Ta=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=E.call.apply(E,[this].concat(A))).globalLeaderboardId=void 0,a}return a(u,[{key:"getGlobalLeaderboardId",value:function(){return this.globalLeaderboardId}},{key:"initGlobalLeaderboard",value:function(){if(0!==Tr.length){var a=Tr.length-1,o=Tr[a];this.globalLeaderboardId=o.Id}}},{key:"preloadLeaderboardData",value:(R=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=this.globalLeaderboardId||a,[4,M(D(u.prototype),"preloadLeaderboardData",this).call(this,o)];case 1:return C.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"saveGlobalPlayerScore",value:(I=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.globalLeaderboardId)return[3,2];return[4,M(D(u.prototype),"setPlayerScore",this).call(this,this.globalLeaderboardId,a)];case 1:return o=C.sent(),[3,3];case 2:o=Promise.resolve(!1),C.label=3;case 3:return[2,o]}})}),function(a){return I.apply(this,arguments)})}]),u}(Ti);U._RF.pop(),U._RF.push({},"0f081wKzzhLrZpb5OIxrC9R","ResultTournamentLoader",void 0);var To=globalThis.game.leaderboard,Ts=globalThis.game.player,Tl=function(P){C(f,P);var I,L,O,N,F=A(f);function f(){var a;o(this,f);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=F.call.apply(F,[this].concat(A))).newPlayerEntry=null,a.currentScore=-1,a.currentRank=-1,a.newScore=0,a}return a(f,[{key:"getNewPlayerEntry",value:function(){return this.newPlayerEntry}},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getCurrentRank",value:function(){return this.currentRank}},{key:"getNewScore",value:function(){return this.newScore}},{key:"loadNewPlayerEntry",value:(N=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=this,[4,td.tournamentManager.getPlayerLeaderBoardAsync()];case 1:return[2,(a.newPlayerEntry=o.sent(),this.newPlayerEntry)]}})}),function(){return N.apply(this,arguments)})},{key:"loadLeaderboard",value:(O=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(o=tg.MAX_LEADERS,C=this,void 0!==a)return[3,2];return[4,td.tournamentManager.getTopLeaderPayloadsAsync(o)];case 1:return A=P.sent(),[3,4];case 2:return[4,tm.getTopLeaderPayloadsAsync(a,o)];case 3:A=P.sent(),P.label=4;case 4:return[2,(C.leaderboard=A,this.leaderboard&&this.leaderboard.sort(function(a,o){return a.rank-o.rank}),this.leaderboard)]}})}),function(a){return O.apply(this,arguments)})},{key:"updatePlayerEntry",value:function(a,o){this.currentPlayerEntry&&(this.currentPlayerEntry.rank=a,this.currentPlayerEntry.score=o)}},{key:"saveNewPlayerScore",value:(L=B(function(){var a,o,C,A,P,I,B,R,E;return _ts_generator(this,function(L){if(o=(a=td.gameScene.gamePlay).gameUI.header,!this.isValidPlayerToSaveScore())return[2,!1];if(a.canShowResultTournamentScreen()){if(P=td.gameScene.gamePlay.isFinishedNewLevel(),I=(null==(C=this.currentPlayerEntry)?void 0:C.score)||0,B=(null==(A=this.currentPlayerEntry)?void 0:A.rank)||tg.DEFAULT_RANK,R=td.tournamentManager.getSelectedLeaderboardId(),!P)return[2,(this.setScoresAndRankData(I,I,B),!1)];if(E=I+o.tournamentChallengeBlock.getScore(),R)return[2,this.updateScoreByLeaderboardId(R,I,E,B)]}return[2,(this.setScoresAndRankData(0,-1,-1),!1)]})}),function(){return L.apply(this,arguments)})},{key:"updateScoreByLeaderboardId",value:(I=B(function(a,o,C,A){var P;return _ts_generator(this,function(I){switch(I.label){case 0:if(!To.getLeaderboardName(a))return[2,(this.setScoresAndRankData(0,-1,-1),!1)];return[4,M(D(f.prototype),"setPlayerScore",this).call(this,a,C)];case 1:return P=I.sent(),[2,(this.setScoresAndRankData(o,C,A),this.allowLoadNewData=!0,P)]}})}),function(a,o,C,A){return I.apply(this,arguments)})},{key:"isValidPlayerToSaveScore",value:function(){return"0000"!==Ts.getPlayerId()}},{key:"setScoresAndRankData",value:function(a,o,C){this.currentScore=a,this.newScore=o,this.currentRank=C}},{key:"fetchLeaderboard",value:function(){if(null===this.getLeaderboard())return Promise.resolve(!1);var a=this.getCurrentPlayerEntry(),o=this.getUpdatedRankLeaders(this.newPlayerEntry),C=td.gameScene.gamePlay.gameUI.header;a||(a=this.createDefaultPlayerEntry());var A=tm.createFakeLeaders({playerFromRank:this.getPlayerFromRank(a.rank),playerFromScore:a.score,topLeaders:o});if(!A)return Promise.resolve(!1);var P=C.tournamentChallengeBlock.getScore();this.setScoresAndRankData(a.score,a.score+P,a.rank),a.score=this.newScore;var I=this.calculateNewRank(this.newScore,A);return this.newPlayerEntry={playerId:a.playerId,name:a.name,photo:a.photo,score:this.newScore,rank:I},this.rankingLeaders=A.map(this.castToRankingScrollerData),Promise.resolve(!0)}},{key:"getUpdatedRankLeaders",value:function(a){var o=R(this.getLeaderboard()||[]);return this.appendUnknownPlayers(o),this.isValidToAddNewEntry(a,o)&&o.push(a),o.sort(function(a,o){return o.score-a.score}),o.forEach(function(a,o){a.rank=o+1}),o}},{key:"appendUnknownPlayers",value:function(a){if(a){var o=a.length+1,C=this.createUnknownPlayerEntry(o,tg.MAX_UNKNOWN_LEADERS);a.push.apply(a,R(C))}}},{key:"isValidToAddNewEntry",value:function(a,o){if(!a)return!1;if(0===o.length)return!0;var C=o[o.length-1];return a.score>C.score&&!this.isExistLeader(a.playerId,o)}},{key:"isExistLeader",value:function(a,o){return o.some(function(o){return o.playerId===a})}},{key:"getPlayerFromRank",value:function(a){var o=this.getLeaderboard();return o?o.length<tg.MAX_LEADERS?tg.MAX_LEADERS+1:a:tg.MAX_LEADERS+1}},{key:"createDefaultPlayerEntry",value:function(){return{playerId:Ts.getPlayerId(),name:Ts.getPlayer().name,photo:Ts.getPlayer().photo,score:this.newScore,rank:tg.INIT_RANK}}},{key:"calculateNewRank",value:function(a,o){var C,A=o[0],P=o[o.length-1],I=A.rank,B=!1,R=E(o);try{for(R.s();!(C=R.n()).done;){if(a>C.value.score){B=!0;break}I++}}catch(a){R.e(a)}finally{R.f()}return B||(I=a>A.score?A.rank:P.rank),I}}]),f}(Ti);U._RF.pop(),U._RF.push({},"590b7F8wEdI3o3vDivy4N1R","Progress",void 0),U._RF.pop(),U._RF.push({},"b60e0alT1pGHJ8FYWfzj4hf","Score",void 0),U._RF.pop(),U._RF.push({},"416792+Hv1PyKIa94KrtWE2","Screen",void 0),U._RF.pop(),U._RF.push({},"bf1b4zNMJhBvKqNEjIykNIJ","UI",void 0),U._RF.pop(),U._RF.push({},"be2cb9n2RBHLIkSTThS8Nb9","gameConstants",void 0),U._RF.pop(),U._RF.push({},"fae8fCTxYJJb57OVOXJd1KK","shopPack",void 0);var Tu,Tc,Th,Tp,Td=[{type:"super",productId:"superbundle_pack",rewards:{coins:1200,items:{magicWand:3,undo:3,shuffle:3}},price:2.99},{type:"mega",productId:"meagabundle_pack",rewards:{coins:3e3,items:{magicWand:6,undo:6,shuffle:6}},price:5.99},{type:"normal",productId:"remove_ads_plus_300rubies",rewards:{coins:300,removeAds:!0},price:4.99},{type:"normal",isRubyBundle:!0,productId:"plus_240rubies",rewards:{coins:240},price:.99},{type:"normal",isRubyBundle:!0,productId:"plus_720rubies",rewards:{coins:720},price:1.99},{type:"normal",isRubyBundle:!0,productId:"plus_1500rubies",rewards:{coins:1500},price:2.99},{type:"normal",isRubyBundle:!0,productId:"plus_2800rubies",rewards:{coins:2800},price:4.99},{type:"normal",isRubyBundle:!0,productId:"plus_6200rubies",rewards:{coins:6200},price:9.99}];U._RF.pop(),U._RF.push({},"b9a39dkqMZKNYbN9Oa6uG/6","CoinEffect",void 0);var Tf,Ty,Tv,Tm,Tg,Tb,Tk,Tw=$.ccclass,TS=$.property;Tu=Tw("CoinEffect"),Tc=TS(eV),Tu((Tp=L((Th=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"emitter",Tp,N(a)),a}return a(r,[{key:"onEnable",value:function(){this.playVfx()}},{key:"onDisable",value:function(){this.stopVfx()}},{key:"playVfx",value:function(){this.emitter.resetSystem()}},{key:"stopVfx",value:function(){this.emitter.stopSystem()}}]),r}(eo)).prototype,"emitter",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Th)),U._RF.pop(),U._RF.push({},"727bd6ox11K4o1tVV1IBxXG","TournamentChallengeBlock",void 0);var TT=$.ccclass,TC=$.property,TA=(Tf=TT("TournamentChallengeBlock"),Ty=TC(er),Tv=tj.required,Tm=tj.required,Tf((Tb=L((Tg=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"scoreText",Tb,N(a)),O(a,"uiOpacity",Tk,N(a)),a.scoreTile=0,a}return a(u,[{key:"__preload",value:function(){this.uiOpacity=this.node.getComponent(ea),this.uiOpacity&&(this.uiOpacity.opacity=0),tj.validateRequiredProperties(this,u)}},{key:"setScoreText",value:function(a){this.scoreText.string="".concat(a,"/6")}},{key:"fadeIn",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){Y(a.uiOpacity).delay(.2).to(.3,{opacity:255}).call(function(){o()}).start()})]})}),function(){return R.apply(this,arguments)})},{key:"fadeOut",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){Y(a.uiOpacity).delay(.15).to(.1,{opacity:0}).call(function(){o()}).start()})]})}),function(){return I.apply(this,arguments)})},{key:"updateScore",value:function(){this.scoreTile+=1}},{key:"getScore",value:function(){return this.scoreTile}},{key:"resetScore",value:function(){this.scoreTile=0,this.setScoreText(this.scoreTile)}}]),u}(eo)).prototype,"scoreText",[Ty,Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tk=L(Tg.prototype,"uiOpacity",[Tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tg))||Tg);U._RF.pop(),U._RF.push({},"3ef4bSfuQpG4r/OqP8lRHMR","GoldTileTween",void 0);var T_,TP=function(){var C,A,P,I,R;function n(){o(this,n)}return a(n,[{key:"playCollectAnim",value:(R=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,this.playScaleUpAndDownAnim(a)];case 1:return C.sent(),this.playRotateAnim(a),this.playScaleAnim(a),[4,ts.waitTweenAsync(.07)];case 2:return C.sent(),[4,this.playArcAnim(a,o)];case 3:return C.sent(),[2]}})}),function(a,o){return R.apply(this,arguments)})},{key:"playScaleUpAndDownAnim",value:(I=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!a.getComponent(ea))return[3,3];return this.instantiateAndPlayEmissionParticle(a,a.position),o=.14*Math.abs(1.5-a.scale.x)/.5,C=Math.max(0,Math.min(.14,o)),[4,ts.runTweenAsync(Y(a).to(C,{scale:new ei(1.5,1.5,1.5)},{easing:"backInOut"}))];case 1:return A.sent(),[4,ts.runTweenAsync(Y(a).to(.3,{scale:new ei(1,1,1)},{easing:"backOut"}))];case 2:A.sent(),A.label=3;case 3:return[2]}})}),function(a){return I.apply(this,arguments)})},{key:"playArcAnim",value:(P=B(function(a,o){var C,A,P,I,R,E,L,O,N,F,D,M,x;return _ts_generator(this,function(z){switch(z.label){case 0:if(A=this,I=(P=td.gameScene.gamePlay.gameUI.header.tournamentChallengeBlock).getComponent(TA),!(R=null==(C=a.parent)?void 0:C.getComponent(en)))return[3,2];if(E=P.node.worldPosition,!(L=R.convertToNodeSpaceAR(E)))return[3,2];return O=a.position.clone(),N=new ei(L.x-55,L.y,0),F=this.calculateArcControlPoint(O,N),(D=this.instantiateAndPlayFlyParticle(a,O)).setParent(a.parent),D.setSiblingIndex(1e4),x=Y({t:0}).to(.28,{t:1},{easing:"sineInOut",onUpdate:(M=B(function(C){var B,R,E;return _ts_generator(this,function(L){return E=function(a,o,C,A){var P=(1-a)*(1-a)*o.x+2*(1-a)*a*C.x+a*a*A.x,I=(1-a)*(1-a)*o.y+2*(1-a)*a*C.y+a*a*A.y;return new ei(P,I,0)}(R=null!=(B=null==C?void 0:C.t)?B:0,O,F,N),a.setPosition(E),D.setPosition(E),R>=1&&A.handleArcArrive(a,D,o,P.node,I),[2]})}),function(a){return M.apply(this,arguments)})}),[4,ts.runTweenAsync(x)];case 1:z.sent(),z.label=2;case 2:return[2]}})}),function(a,o){return P.apply(this,arguments)})},{key:"playRotateAnim",value:function(a){ts.runTweenAsync(Y(a).to(.35,{angle:360},{easing:"sineInOut"}))}},{key:"playScaleAnim",value:function(a){ts.runTweenAsync(Y(a).to(.35,{scale:new ei(.2,.2,1)},{easing:"sineInOut"}))}},{key:"instantiateAndPlayFlyParticle",value:function(a,o){var C=td.gameScene.gamePlay.gameObjects.goldTilePool.getGoldTileParticlePool().getFlyGoldTileParticle().node;C.setParent(a),C.setPosition(o);var A=C.getComponent(wd);return A&&A.play(),C}},{key:"calculateArcControlPoint",value:function(a,o){var C=o.x-a.x,A=o.y-a.y,P=Math.sqrt(C*C+A*A)||1,I=(a.x+o.x)/2+A/P*250,B=(a.y+o.y)/2+-C/P*250;return new ei(I,B,0)}},{key:"handleArcArrive",value:(A=B(function(a,o,C,A,P){var I,B,R;return _ts_generator(this,function(E){switch(E.label){case 0:if((I=o.getComponent(wd))&&I.stop(),this.instantiateAndPlayEmissionParticle(a,a.position,100),P&&P.setScoreText(C),!(B=A.getChildByName("counter-block")))return[3,3];if(!(R=B.getChildByName("icon-gold-tile")))return[3,2];return em.stopAllByTarget(R),[4,this.animateIconGoldTile(R)];case 1:E.sent(),E.label=2;case 2:E.label=3;case 3:return[2]}})}),function(a,o,C,P,I){return A.apply(this,arguments)})},{key:"instantiateAndPlayEmissionParticle",value:function(a,o,C){var A=td.gameScene.gamePlay.gameObjects.goldTilePool.getGoldTileParticlePool().getEmissionGoldTileParticle().node;A.setParent(a.parent),A.setSiblingIndex(1e4),A.setPosition(o);var P=A.getComponent(wr);P&&(P.play(),C&&P.setStartSize(C))}},{key:"animateIconGoldTile",value:(C=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(o=Y(a).to(.18,{scale:new ei(1.3,1.3,1.3)},{easing:"backIn"}),C=Y(a).to(.18,{scale:new ei(1,1,1)},{easing:"backInOut"}),a.scale.x>=1.3)return[3,2];return[4,ts.runTweenAsync(o)];case 1:A.sent(),A.label=2;case 2:return[4,ts.runTweenAsync(C)];case 3:return A.sent(),[2]}})}),function(a){return C.apply(this,arguments)})}]),n}();U._RF.pop(),U._RF.push({},"8ebf0xBA1dFLpYCG86HjVRN","GoldTile",void 0);var TI,TB,TR,TE,TL,TO,TN,TF,TD,TM,Tx,Tz,TG,Tq,TU=(0,$.ccclass)("GoldTile")(T_=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=R.call.apply(R,[this].concat(A))).goldTileTween=new TP,a}return a(s,[{key:"playCollectAnim",value:(I=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,this.goldTileTween.playCollectAnim(this.node,a)];case 1:return o.sent(),[2]}})}),function(a){return I.apply(this,arguments)})},{key:"setSize",value:function(a,o){this.node.getComponent(en).setContentSize(a,o)}}]),s}(eo))||T_;U._RF.pop(),U._RF.push({},"4e762dtcDlLrI0qpTwXzvEb","BaseItemSpineUIWidget",void 0);var TH,TW,TV,TK,TY,Tj=$.ccclass,TX=$.property,TJ=(TI=Tj("BaseItemSpineUIWidget"),TB=TX(ee),TR=tj.required,TE=TX(ee),TL=tj.required,TO=TX(ee),TN=tj.required,TF=TX(ee),TD=tj.required,TI((Tx=L((TM=function(){function n(){o(this,n),O(this,"buttonNode",Tx,this),O(this,"buttonImageNode",Tz,this),O(this,"iconContainer",TG,this),O(this,"iconAddImageNode",Tq,this),this.pressDownAnim=void 0,this.pressUpAnim=void 0,this.originalNodesData={}}return a(n,[{key:"init",value:function(){this.initData(),this.initAnimConfigs(),tj.validateRequiredProperties(this,n)}},{key:"initData",value:function(){this.cloneData(this.buttonNode),this.cloneData(this.buttonImageNode),this.cloneData(this.iconContainer),this.cloneData(this.iconAddImageNode)}},{key:"cloneData",value:function(a){var o={position:a.position.clone(),scale:a.scale.clone(),rotation:a.rotation.clone()},C=a.getComponent(ea);C&&(o.opacity=C.opacity);var A=a.getComponent(W);A&&(o.color=A.color.clone()),this.originalNodesData[a.name]=o}},{key:"initAnimConfigs",value:function(){this.initPressDownAnim(),this.initPressUpAnim()}},{key:"initPressDownAnim",value:function(){}},{key:"initPressUpAnim",value:function(){}},{key:"playPressDownAnim",value:function(){this.pressDownAnim&&(this.resetNodes(),this.pressDownAnim.start())}},{key:"playPressUpAnim",value:function(){this.pressUpAnim&&(this.resetNodes(),this.pressUpAnim.start())}},{key:"playIdleAnim",value:function(){}},{key:"stopAnims",value:function(){this.pressDownAnim&&this.pressDownAnim.stop(),this.pressUpAnim&&this.pressUpAnim.stop()}},{key:"resetNodes",value:function(){this.resetNode(this.buttonNode),this.resetNode(this.buttonImageNode),this.resetNode(this.iconContainer),this.resetNode(this.iconAddImageNode)}},{key:"resetNode",value:function(a){var o=this.originalNodesData[a.name];if(o){a.position=o.position.clone(),a.scale=o.scale.clone(),a.rotation=o.rotation.clone();var C=a.getComponent(ea);C&&o.opacity&&(C.opacity=o.opacity);var A=a.getComponent(W);A&&o.color&&(A.color=o.color.clone())}}}]),n}()).prototype,"buttonNode",[TB,TR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tz=L(TM.prototype,"buttonImageNode",[TE,TL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TG=L(TM.prototype,"iconContainer",[TO,TN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tq=L(TM.prototype,"iconAddImageNode",[TF,TD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TM))||TM);U._RF.pop(),U._RF.push({},"8d004uFtndH96ZBOOK0u5KH","LockAppearance",void 0);var TZ,TQ,T$,T0,T1=$.ccclass,T2=$.property,T3=(TH=T1("LockAppearance"),TW=T2(er),TV=tj.required,TH((TY=L((TK=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"levelLabel",TY,N(a)),a.currentPlayGameFontSize=0,a}return a(r,[{key:"__preload",value:function(){this.currentPlayGameFontSize=this.levelLabel.fontSize}},{key:"setLevelLabel",value:function(a){var o=globalThis.game.language.getText("LEVEL_X",["".concat(a)]);o.length>8&&(this.levelLabel.fontSize=this.currentPlayGameFontSize-9*(o.length-8)),this.levelLabel.string=o}}]),r}(eo)).prototype,"levelLabel",[TW,TV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TK))||TK);U._RF.pop(),U._RF.push({},"55e3fHkziJBoKJSLN/Xvrg8","RubyTag",void 0);var T4,T5,T6,T7,T8,T9,Ce,Ct,Cn,Ci,Cr,Ca,Co,Cs,Cl,Cu,Cc,Ch,Cp,Cd,Cf=$.ccclass,Cy=$.property,Cv=(TZ=Cf("RubyTag"),TQ=Cy(er),TZ((T0=L((T$=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"label",T0,N(a)),a}return a(r,[{key:"setCost",value:function(a){this.label.string=a.toString()}}]),r}(eo)).prototype,"label",[TQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T$))||T$);U._RF.pop(),U._RF.push({},"17e8fOypVZDbY/nSxNgoxrZ","UnlockAppearance",void 0);var Cm,Cg,Cb,Ck,Cw,CS,CT,CC,CA,C_,CP,CI,CB=$.ccclass,CR=$.property,CE=(T4=CB("UnlockAppearance"),T5=CR(ee),T6=tj.required,T7=CR(ee),T8=tj.required,T9=CR(ee),Ce=tj.required,Ct=CR(er),Cn=tj.required,Ci=CR(ee),Cr=tj.required,Ca=CR(Cv),Co=tj.required,T4((Cl=L((Cs=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"iconItemNode",Cl,N(a)),O(a,"adNode",Cu,N(a)),O(a,"amountNode",Cc,N(a)),O(a,"amountLabel",Ch,N(a)),O(a,"receiveAmountNode",Cp,N(a)),O(a,"rubyTag",Cd,N(a)),a.fadeTween=null,a}return a(s,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"getIconItemNode",value:function(){return this.iconItemNode}},{key:"setAmountLabel",value:function(a){this.amountLabel.string=a.toString()}},{key:"rubyTagNode",get:function(){return this.rubyTag.node}},{key:"setNodeActiveStates",value:function(a){for(var o in a)this[o].active=a[o]}},{key:"setIconItemNodePosition",value:function(a,o){this.iconItemNode.setPosition(a,o,0)}},{key:"setIconItemSize",value:function(a,o){var C=this.iconItemNode.getComponent(en);C&&C.setContentSize(a,o)}},{key:"playOpacityAnim",value:(I=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(o=this.node.getComponent(ea)))return[3,2];return this.fadeTween&&this.fadeTween.stop(),this.fadeTween=Y(o).to(.1,{opacity:a}),[4,ts.runTweenAsync(this.fadeTween)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(a){return I.apply(this,arguments)})}]),s}(eo)).prototype,"iconItemNode",[T5,T6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cu=L(Cs.prototype,"adNode",[T7,T8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cc=L(Cs.prototype,"amountNode",[T9,Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=L(Cs.prototype,"amountLabel",[Ct,Cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cp=L(Cs.prototype,"receiveAmountNode",[Ci,Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd=L(Cs.prototype,"rubyTag",[Ca,Co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cs))||Cs);U._RF.pop(),U._RF.push({},"6d3cakR+lxB8oyBG6sfNndi","BaseItem",void 0);var CL,CO,CN,CF,CD,CM,Cx,Cz,CG,Cq,CU,CH,CW,CV,CK,CY,Cj,CX=$.ccclass,CZ=$.property,CQ={ad:{amountNode:!1,adNode:!0,receiveAmountNode:!1,rubyTagNode:!1},coin:{amountNode:!1,adNode:!1,receiveAmountNode:!1,rubyTagNode:!0},owned:{amountNode:!0,adNode:!1,receiveAmountNode:!1,rubyTagNode:!1},locked:{amountNode:!1,adNode:!1,receiveAmountNode:!1,rubyTagNode:!1}},C$=(Cm=CX("BaseItem"),Cg=CZ(eu),Cb=CZ(CE),Ck=tj.required,Cw=CZ(T3),CS=tj.required,CT=CZ(TJ),Cm((CA=L((CC=function(P){C(p,P);var R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"cost",CA,N(a)),O(a,"unlockAppearance",C_,N(a)),O(a,"lockAppearance",CP,N(a)),O(a,"itemSpineAnim",CI,N(a)),a.isClickedWatchAd=!1,a.tileManager=void 0,a.tileContainer=void 0,a.buttonReleasedComp=void 0,a.itemsMappingForAnalytics={magicWand:tk.MAGIC,shuffle:tk.SHUFFLE,undo:tk.UNDO,return:"",extraSlot:""},a}return a(p,[{key:"itemDataName",get:function(){return"return"}},{key:"playIdleAnim",value:function(){this.itemSpineAnim.playIdleAnim()}},{key:"stopAndResetAnims",value:function(){this.itemSpineAnim.stopAnims(),this.itemSpineAnim.resetNodes()}},{key:"__preload",value:function(){this.initComponents(),this.registerEvents()}},{key:"initComponents",value:function(){this.tileManager=td.gameScene.gamePlay.tileManager,this.tileContainer=td.gameScene.gamePlay.tileContainer,this.unlockAppearance.rubyTag.setCost(this.cost),this.buttonReleasedComp=this.getComponent(az),this.itemSpineAnim.init(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,p)}},{key:"registerEvents",value:function(){var a=this;this.buttonReleasedComp.setHandleTouchStartFunc(function(){a.itemSpineAnim.stopAnims(),a.itemSpineAnim.playPressDownAnim()}),this.buttonReleasedComp.setHandleTouchEndFunc(function(){a.itemSpineAnim.playPressUpAnim()})}},{key:"shouldLockItem",value:function(){return!this.hasEnoughCoinAmount()&&this.isClickedWatchAd&&0===this.getItemAmount()}},{key:"toggleEnable",value:function(a){this.unlockAppearance.playOpacityAnim(a?255:150)}},{key:"changeAppearance",value:function(a){this.toggleLockAppearance("locked"===a),this.unlockAppearance.setNodeActiveStates(CQ[a]),this.setZoomIcon(a)}},{key:"toggleLockAppearance",value:function(a){this.lockAppearance.node.active=a,this.unlockAppearance.node.active=!a}},{key:"setZoomIcon",value:function(a){}},{key:"useItem",value:(E=B(function(){return _ts_generator(this,function(a){return[2]})}),function(){return E.apply(this,arguments)})},{key:"useItemWithoutPaying",value:(R=B(function(){return _ts_generator(this,function(a){return[2]})}),function(){return R.apply(this,arguments)})},{key:"addItemAmount",value:function(a){var o=this.getItemAmount();o+=a,this.saveItemAmount(o)}},{key:"saveItemAmount",value:function(a){var o=td.gameScene.gamePlay,C=td.gameScene.gamePlay.gameDataManager.getItems(),A=this.itemDataName;o.gameDataManager.setGameData({items:I(I({},C),{},x({},A,a))})}},{key:"getItemAmount",value:function(){return td.gameScene.gamePlay.gameDataManager.getItems()[this.itemDataName]}},{key:"hasEnoughItemAmount",value:function(){return this.getItemAmount()>0}},{key:"hasEnoughCoinAmount",value:function(){return td.gameScene.gamePlay.gameDataManager.getCoins()>=this.cost}},{key:"buyItem",value:function(){td.gameScene.gamePlay.addCoinData(-this.cost)}},{key:"checkBeforeUseItem",value:function(){if(!this.isItemLevelAcquired())return!1;var a=this.itemsMappingForAnalytics[this.itemDataName];if(!this.hasEnoughItemAmount()){if(this.hasEnoughCoinAmount())return this.buyItem(),this.addItemAmount(1),this.sendBuyItemAnalyticsEvent(a),!0;if(this.isClickedWatchAd)return!1;var o=this.itemDataName;return td.gameScene.gamePlay.handleOpenAdScreen(this,o),!1}return this.sendUseItemAnalyticsEvent(a),!0}},{key:"updateItemUI",value:function(){if(this.isItemLevelAcquired()){var a=this.getItemAmount();if(0===a){if(this.hasEnoughCoinAmount())return void this.changeAppearance("coin");if(!this.isClickedWatchAd)return void this.changeAppearance("ad")}this.changeAppearance("owned"),this.unlockAppearance.setAmountLabel(a)}else{this.changeAppearance("locked");var o=this.getUnlockLevel();this.lockAppearance.setLevelLabel(o)}}},{key:"sendUseItemAnalyticsEvent",value:function(a){var o=td.gameScene.gamePlay.gameDataManager.getLevel(),C=td.levelManager.getLevel();-1!==tw[a]&&tS({maxPlayerLevel:o,level:C,resourceTransaction:[{resourceTypeName:a,resourceChange:-1}],transactionType:"UseItem",transactionCount:1})}},{key:"sendBuyItemAnalyticsEvent",value:function(a){var o=td.gameScene.gamePlay.gameDataManager.getLevel(),C=td.levelManager.getLevel(),A=tw[tk.RUBY];if(-1!==tw[a]&&-1!==A){var P="Buy";switch(a){case tk.MAGIC:P+="MagicItem";break;case tk.SHUFFLE:P+="ShuffleItem";break;case tk.UNDO:P+="UndoItem"}tS({maxPlayerLevel:o,level:C,resourceTransaction:[{resourceTypeName:tk.RUBY,resourceChange:-150},{resourceTypeName:a,resourceChange:1},{resourceTypeName:a,resourceChange:-1}],transactionType:P,transactionCount:1})}}},{key:"updateUsingBoosterDailyMissions",value:function(){td.gameScene.gamePlay.updateDailyMissionCount({useBoosters:function(a){return a+1}})}},{key:"getUnlockLevel",value:function(){return 2}},{key:"isItemLevelAcquired",value:function(){return td.levelManager.getLevel()>=this.getUnlockLevel()}},{key:"playButtonPulseScaleAnimation",value:function(){var a=this;this.node.scale=new ei(1,1,1),Y(this.node).to(.15,{scale:new ei(1.1,.9,1)},{easing:"sineOut"}).to(.15,{scale:new ei(.9,1.1,1)},{easing:"sineIn"}).to(.15,{scale:new ei(1,1,1)},{easing:"sineOut"}).call(function(){a.node.scale=new ei(1,1,1)}).start()}}]),p}(eo)).prototype,"cost",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),C_=L(CC.prototype,"unlockAppearance",[Cb,Ck],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CP=L(CC.prototype,"lockAppearance",[Cw,CS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CI=L(CC.prototype,"itemSpineAnim",[CT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new TJ}}),CC))||CC);U._RF.pop(),U._RF.push({},"6ff11rLH/BNBJl+HsXStztN","MagicItemSpineUIWidget",void 0);var C0,C1,C2,C3,C4=$.ccclass,C5=$.property,C6=(CL=C4("MagicItemSpineUIWidget"),CO=C5(ee),CN=tj.required,CF=C5(ee),CD=tj.required,CM=C5([ee]),Cx=tj.required,Cz=C5([ee]),CG=tj.required,Cq=C5([ee]),CU=tj.required,CL((CW=L((CH=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"iconAddImageNode2",CW,N(a)),O(a,"bVFX",CV,N(a)),O(a,"dots",CK,N(a)),O(a,"dotSprites",CY,N(a)),O(a,"starToWhites",Cj,N(a)),a.magicIdleAnim=void 0,a}return a(r,[{key:"initData",value:function(){M(D(r.prototype),"initData",this).call(this),this.cloneData(this.iconAddImageNode2),this.cloneData(this.bVFX);var a,o=E(this.dots);try{for(o.s();!(a=o.n()).done;){var C=a.value;this.cloneData(C)}}catch(a){o.e(a)}finally{o.f()}var A,P=E(this.dotSprites);try{for(P.s();!(A=P.n()).done;){var I=A.value;this.cloneData(I)}}catch(a){P.e(a)}finally{P.f()}var B,R=E(this.starToWhites);try{for(R.s();!(B=R.n()).done;){var L=B.value;this.cloneData(L)}}catch(a){R.e(a)}finally{R.f()}tj.validateRequiredProperties(this,r)}},{key:"initAnimConfigs",value:function(){M(D(r.prototype),"initAnimConfigs",this).call(this),this.initMagicIdleAnim()}},{key:"initPressDownAnim",value:function(){this.pressDownAnim=new nI([{target:this.iconAddImageNode,color:[{color:"ffffff00",curve:.358,c3:.667,c4:.44},{time:.05,color:"ffffff0f"}]},{target:this.iconAddImageNode2,color:[{color:"ffffff00",curve:.358,c3:.667,c4:.44},{time:.05,color:"ffffff0f"}]},{target:this.buttonNode,translate:[{curve:.281,c2:.61,c3:.75},{time:.05,y:-2.78}],scale:[{curve:.281,c2:.61,c3:.75},{time:.05,x:.944,y:.944}]},{target:this.iconContainer,scale:[{curve:.25,c3:.527},{time:.0333,x:.878,y:.878}]}])}},{key:"initPressUpAnim",value:function(){this.pressUpAnim=new nI([{target:this.iconAddImageNode,color:[{color:"ffffff0f",curve:.291,c2:.43,c3:.589},{time:.0833,color:"ffffff2c"},{time:.6167,color:"ffffff00"}]},{target:this.iconAddImageNode2,color:[{color:"ffffff0f",curve:.291,c2:.43,c3:.589},{time:.0833,color:"ffffff2c"},{time:.6167,color:"ffffff00"}]},{target:this.buttonNode,translate:[{y:-2.78,curve:.25,c3:.75},{time:.15}],scale:[{x:.944,y:.944,curve:.25,c3:.75},{time:.15,x:1.02,y:1.02,curve:.25,c3:.75},{time:.2833}]},{target:this.iconContainer,scale:[{x:.878,y:.878,curve:.365,c3:.527},{time:.2,x:1.06,y:1.06,curve:.442,c2:.01,c3:.75},{time:.4,x:.98,y:.98,curve:.25,c3:.75},{time:.6,x:1.02,y:1.02,curve:.25,c3:.75},{time:.7833}]}])}},{key:"initMagicIdleAnim",value:function(){this.magicIdleAnim=new nI([{target:this.bVFX,color:[{time:.2167,color:"ffffff00",curve:.004,c2:.81,c3:.75},{time:.3,color:"ffb2f881",curve:.496,c2:.04,c3:.619},{time:.8333,color:"ffffff00"}]},{target:this.dotSprites[0],color:[{time:.25,color:"ffffff00"},{time:.3333,color:"ffffffff"},{time:.6667,color:"ffffff00"}]},{target:this.dotSprites[1],color:[{time:.2167,color:"ffffff00"},{time:.3167,color:"ffffffff"},{time:.75,color:"ffffff00"}]},{target:this.dotSprites[2],color:[{time:.4167,color:"ffffff00"},{time:.5,color:"ffffffff"},{time:.9,color:"ffffff00"}]},{target:this.dotSprites[3],color:[{time:.25,color:"ffffff00"},{time:.3667,color:"ffffffff"},{time:.75,color:"ffffff00"}]},{target:this.dotSprites[4],color:[{time:.3167,color:"ffffff00"},{time:.4,color:"ffffffff"},{time:.7833,color:"ffffff00"}]},{target:this.dotSprites[5],color:[{time:.2167,color:"ffffff00"},{time:.3,color:"ffffffff"},{time:.6667,color:"ffffff00"}]},{target:this.dotSprites[6],color:[{time:.3,color:"ffffff00"},{time:.3833,color:"ffffffff"},{time:.7167,color:"ffffff00"}]},{target:this.dotSprites[7],color:[{time:.3833,color:"ffffff00"},{time:.4833,color:"ffffffff"},{time:.8833,color:"ffffff00"}]},{target:this.dotSprites[8],color:[{time:.25,color:"ffffff00"},{time:.35,color:"ffffffff"},{time:.7167,color:"ffffff00"}]},{target:this.dotSprites[9],color:[{time:.4667,color:"ffffff00"},{time:.5667,color:"ffffffff"},{time:.9167,color:"ffffff00"}]},{target:this.starToWhites[0],color:[{time:.25,color:"ffffff00"},{time:.3333,color:"ffffffff"},{time:.6667,color:"ffffff00"}]},{target:this.starToWhites[1],color:[{time:.2167,color:"ffffff00"},{time:.3167,color:"ffffffff"},{time:.75,color:"ffffff00"}]},{target:this.starToWhites[2],color:[{time:.4167,color:"ffffff00"},{time:.5,color:"ffffffff"},{time:.9,color:"ffffff00"}]},{target:this.starToWhites[3],color:[{time:.25,color:"ffffff00"},{time:.3667,color:"ffffffff"},{time:.75,color:"ffffff00"}]},{target:this.starToWhites[4],color:[{time:.3167,color:"ffffff00"},{time:.4,color:"ffffffff"},{time:.7833,color:"ffffff00"}]},{target:this.starToWhites[5],color:[{time:.2167,color:"ffffff00"},{time:.3,color:"ffffffff"},{time:.6667,color:"ffffff00"}]},{target:this.starToWhites[6],color:[{time:.3,color:"ffffff00"},{time:.3833,color:"ffffffff"},{time:.7167,color:"ffffff00"}]},{target:this.starToWhites[7],color:[{time:.3833,color:"ffffff00"},{time:.4833,color:"ffffffff"},{time:.8833,color:"ffffff00"}]},{target:this.starToWhites[8],color:[{time:.25,color:"ffffff00"},{time:.35,color:"ffffffff"},{time:.7167,color:"ffffff00"}]},{target:this.starToWhites[9],color:[{time:.4667,color:"ffffff00"},{time:.5667,color:"ffffffff"},{time:.9167,color:"ffffff00"}]},{target:this.iconContainer,color:[{color:"ffffffff"},{time:.1667,color:"f4e3faff"},{time:.4167,color:"ffffffff"}]},{target:this.iconAddImageNode,color:[{time:.1667,color:"ffffff00",curve:.25,c3:.75},{time:.4167,color:"ffffff25",curve:"stepped"},{time:.6667,color:"ffffff25",curve:.25,c3:.75},{time:1.0833,color:"ffffff00"}]},{target:this.iconAddImageNode2,color:[{color:"baacff00"},{time:.1667,color:"baacff00",curve:.25,c3:.75},{time:.4167,color:"b9acff63"},{time:.6667,color:"b9acff63"},{time:1.0833,color:"ffffff00"}]},{target:this.iconContainer,rotate:[{curve:.25,c3:.75},{time:.1667,angle:3.64,curve:.404,c3:.604,c4:.99},{time:.25,angle:-4.52,curve:.404,c3:.604,c4:.99},{time:.3333,angle:6.58,curve:.404,c3:.604,c4:.99},{time:.4167,angle:-4.52,curve:.404,c3:.604,c4:.99},{time:.5,angle:6.58,curve:.404,c3:.604,c4:.99},{time:.5833,angle:-4.52,curve:.404,c3:.604,c4:.99},{time:.6667,angle:6.58,curve:.404,c3:.604,c4:.99},{time:.75,angle:-4.52,curve:.404,c3:.604,c4:.99},{time:.8667,angle:3.06,curve:.404,c3:.604,c4:.99},{time:1.0167,angle:-.96,curve:.25,c3:.75},{time:1.1667}]},{target:this.iconContainer,scale:[{curve:.119,c2:.23,c3:.627},{time:.1167,x:.7,y:.7,curve:.358,c2:.11,c3:.142,c4:.93},{time:.5833,x:1.08,y:1.08,curve:.765,c2:.12,c3:.504,c4:.96},{time:1.0833,x:.955,y:.955,curve:.25,c3:.75},{time:1.25}]},{target:this.dots[0],translate:[{time:.25,curve:0,c2:.68,c3:.75},{time:.6667,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.25,x:0,y:0},{time:.3333,x:.643,y:.643},{time:.6667,x:0,y:0}]},{target:this.dots[1],translate:[{time:.2167,curve:0,c2:.68,c3:.75},{time:.75,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.2167,x:0,y:0},{time:.3167,x:.643,y:.643},{time:.75,x:0,y:0}]},{target:this.dots[2],translate:[{time:.4167,curve:0,c2:.68,c3:.75},{time:.9,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.4167,x:0,y:0},{time:.5,x:.643,y:.643},{time:.9,x:0,y:0}]},{target:this.dots[3],translate:[{time:.25,curve:0,c2:.68,c3:.75},{time:.75,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.25,x:0,y:0},{time:.3667,x:.643,y:.643},{time:.75,x:0,y:0}]},{target:this.dots[4],translate:[{time:.3167,curve:0,c2:.68,c3:.75},{time:.7833,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.3167,x:0,y:0},{time:.4,x:.643,y:.643},{time:.7833,x:0,y:0}]},{target:this.dots[5],translate:[{time:.2167,curve:.096,c2:.75,c3:.75},{time:.6667,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.2167,x:0,y:0},{time:.3,x:.643,y:.643},{time:.6667,x:0,y:0}]},{target:this.dots[6],translate:[{time:.3,curve:0,c2:.68,c3:.75},{time:.7167,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.3,x:0,y:0},{time:.3833,x:.643,y:.643},{time:.7167,x:0,y:0}]},{target:this.dots[7],translate:[{time:.3833,curve:0,c2:.68,c3:.75},{time:.8833,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.3833,x:0,y:0},{time:.4833,x:.643,y:.643},{time:.8833,x:0,y:0}]},{target:this.dots[8],translate:[{time:.25,curve:0,c2:.68,c3:.75},{time:.7167,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.25,x:0,y:0},{time:.35,x:.643,y:.643},{time:.7167,x:0,y:0}]},{target:this.dots[9],translate:[{time:.4667,curve:0,c2:.68,c3:.75},{time:.9167,x:72.08}],scale:[{x:0,y:0,curve:"stepped"},{time:.4667,x:0,y:0},{time:.5667,x:.643,y:.643},{time:.9167,x:0,y:0}]},{target:this.bVFX,scale:[{time:.2167,curve:0,c2:.78,c3:.75},{time:1,x:3.907,y:3.907}]}])}},{key:"playPressDownAnim",value:function(){var a;null==(a=this.magicIdleAnim)||a.stop(),M(D(r.prototype),"playPressDownAnim",this).call(this)}},{key:"playPressUpAnim",value:function(){var a;null==(a=this.magicIdleAnim)||a.stop(),M(D(r.prototype),"playPressUpAnim",this).call(this)}},{key:"playIdleAnim",value:function(){var a,o;this.magicIdleAnim&&(null!=(a=this.pressDownAnim)&&a.isPlaying||null!=(o=this.pressUpAnim)&&o.isPlaying||this.magicIdleAnim.start())}},{key:"stopAnims",value:function(){M(D(r.prototype),"stopAnims",this).call(this),this.magicIdleAnim&&this.magicIdleAnim.stop()}},{key:"resetNodes",value:function(){M(D(r.prototype),"resetNodes",this).call(this),this.resetNode(this.iconAddImageNode2),this.resetNode(this.bVFX);var a,o=E(this.dots);try{for(o.s();!(a=o.n()).done;){var C=a.value;this.resetNode(C)}}catch(a){o.e(a)}finally{o.f()}var A,P=E(this.dotSprites);try{for(P.s();!(A=P.n()).done;){var I=A.value;this.resetNode(I)}}catch(a){P.e(a)}finally{P.f()}var B,R=E(this.starToWhites);try{for(R.s();!(B=R.n()).done;){var L=B.value;this.resetNode(L)}}catch(a){R.e(a)}finally{R.f()}}}]),r}(TJ)).prototype,"iconAddImageNode2",[CO,CN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CV=L(CH.prototype,"bVFX",[CF,CD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CK=L(CH.prototype,"dots",[CM,Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),CY=L(CH.prototype,"dotSprites",[Cz,CG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cj=L(CH.prototype,"starToWhites",[Cq,CU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),CH))||CH);U._RF.pop(),U._RF.push({},"8e3a5BaNjVIp6IbYOxgcunD","MagicWandItem",void 0);var C7,C8,C9,Ae,At,An,Ai,Ar,Aa,Ao,As,Al=$.ccclass,Au=$.property;C0=Al("MagicWandItem"),C1=Au({type:C6,override:!0}),C0((C3=L((C2=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"itemSpineAnim",C3,N(a)),a}return a(p,[{key:"itemDataName",get:function(){return"magicWand"}},{key:"setZoomIcon",value:function(a){}},{key:"useItem",value:(E=B(function(){var a;var o=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:if(a=o.length>0&&void 0!==o[0]&&o[0],!this.checkBeforeUseItem())return[3,2];return this.addItemAmount(-1),tT(this.itemDataName),[4,this.playMagicWand(a)];case 1:C.sent(),this.updateUsingBoosterDailyMissions(),C.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"useItemWithoutPaying",value:(R=B(function(){var a;var o=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:return a=o.length>0&&void 0!==o[0]&&o[0],[4,this.playMagicWand(a)];case 1:return C.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"playMagicWand",value:(I=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return this.tileManager.stopAllTileAnimations(),td.gameScene.toggleBlockInputContainer(!0),o=this.tileContainer.getSuitableTile(),td.gameScene.gamePlay.itemManager.toggleItems(!1),[4,this.tileManager.handleMagicStick(o)];case 1:return C.sent(),td.gameScene.toggleBlockInputContainer(a),[2]}})}),function(a){return I.apply(this,arguments)})},{key:"getUnlockLevel",value:function(){return 4}}]),p}(C$)).prototype,"itemSpineAnim",[C1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new C6}}),C2)),U._RF.pop(),U._RF.push({},"a4ec7l11uNNALvzk4EK5XLN","ShuffleItemSpineUIWidget",void 0);var Ac,Ah,Ap,Ad,Af=$.ccclass,Ay=$.property,Av=(C7=Af("ShuffleItemSpineUIWidget"),C8=Ay(ee),C9=tj.required,Ae=Ay(ee),At=tj.required,An=Ay(ee),Ai=tj.required,C7((Aa=L((Ar=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"iconAddImageNode2",Aa,N(a)),O(a,"shuffleTopNode",Ao,N(a)),O(a,"shuffleBottomNode",As,N(a)),a.shuffleIdleAnim=void 0,a}return a(r,[{key:"initData",value:function(){M(D(r.prototype),"initData",this).call(this),this.cloneData(this.iconAddImageNode2),this.cloneData(this.shuffleTopNode),this.cloneData(this.shuffleBottomNode),tj.validateRequiredProperties(this,r)}},{key:"initAnimConfigs",value:function(){M(D(r.prototype),"initAnimConfigs",this).call(this),this.initShuffleIdleAnim()}},{key:"initPressDownAnim",value:function(){this.pressDownAnim=new nI([{target:this.iconAddImageNode,color:[{color:"ffffff00",curve:.358,c3:.667,c4:.44},{time:.05,color:"ffffff0f"}]},{target:this.iconAddImageNode2,color:[{color:"ffffff00",curve:.358,c3:.667,c4:.44},{time:.05,color:"ffffff0f"}]},{target:this.buttonNode,translate:[{curve:.281,c2:.61,c3:.75},{time:.05,y:-2.78}],scale:[{curve:.281,c2:.61,c3:.75},{time:.05,x:.944,y:.944}]},{target:this.iconContainer,scale:[{curve:.25,c3:.527},{time:.0333,x:.878,y:.878}]}])}},{key:"initPressUpAnim",value:function(){this.pressUpAnim=new nI([{target:this.iconAddImageNode,color:[{color:"ffffff0f",curve:.291,c2:.43,c3:.589},{time:.0833,color:"ffffff2c"},{time:.6167,color:"ffffff00"}]},{target:this.iconAddImageNode2,color:[{color:"ffffff0f",curve:.291,c2:.43,c3:.589},{time:.0833,color:"ffffff2c"},{time:.6167,color:"ffffff00"}]},{target:this.buttonNode,translate:[{y:-2.78,curve:.25,c3:.75},{time:.15}],scale:[{x:.944,y:.944,curve:.25,c3:.75},{time:.15,x:1.02,y:1.02,curve:.25,c3:.75},{time:.2833}]},{target:this.iconContainer,scale:[{x:.878,y:.878,curve:.365,c3:.527},{time:.2,x:1.06,y:1.06,curve:.442,c2:.01,c3:.75},{time:.4,x:.98,y:.98,curve:.25,c3:.75},{time:.6,x:1.02,y:1.02,curve:.25,c3:.75},{time:.7833}]}])}},{key:"initShuffleIdleAnim",value:function(){this.shuffleIdleAnim=new nI([{target:this.iconAddImageNode,color:[{color:"ffffff00",curve:.45,c3:.581,c4:.97},{time:.4167,color:"ffffff5c",curve:.381,c3:.888,c4:.91},{time:1.2167,color:"ffffff00"}]},{target:this.iconAddImageNode2,color:[{color:"ffffff00",curve:.45,c3:.581,c4:.97},{time:.4167,color:"ffffff5c",curve:.381,c3:.888,c4:.91},{time:1.2167,color:"ffffff00"}]},{target:this.iconContainer,rotate:[{curve:.25,c3:.75},{time:.25,angle:-13.21,curve:.142,c2:.85,c3:.75},{time:.4167,angle:11.83,curve:.504,c3:.904,c4:.9},{time:.6667,angle:1.96,curve:.081,c2:.59,c3:.75},{time:.8333,angle:11.83,curve:.658,c2:.04,c3:.596,c4:.98},{time:1.2167,angle:-3.39,curve:.25,c3:.75},{time:1.3833}],translate:[{time:.25,curve:.119,c2:.8,c3:.75},{time:.4167,x:4.43,y:2.53,curve:.658,c2:.01,c3:.888,c4:.92},{time:.6667,x:3.16,y:1.27,curve:0,c2:.62,c3:.75},{time:.8333,x:4.43,y:2.53,curve:.658,c2:.04,c3:.596,c4:.98},{time:1.2167}],scale:[{curve:.25,c3:.75},{time:.25,x:.8,y:.8,curve:.104,c2:.82,c3:.75},{time:.4167,x:1.1,y:1.1,curve:.396,c3:.812,c4:.92},{time:.6667,x:1.05,y:1.05,curve:.15,c2:.78,c3:.75},{time:.8333,x:1.1,y:1.1,curve:.658,c2:.04,c3:.596,c4:.98},{time:1.2167,x:.98,y:.98,curve:.25,c3:.75},{time:1.3833}]},{target:this.shuffleTopNode,translate:[{curve:.25,c3:.75},{time:.25,x:8.67,y:-.42,curve:.073,c2:.77,c3:.75},{time:.4167,x:-16.19,y:6.57,curve:.388,c3:.912,c4:.89},{time:.6667,x:-1.7,y:-2.23,curve:.019,c2:.7,c3:.75},{time:.8333,x:-13.94,y:7.16,curve:.658,c2:.04,c3:.596,c4:.98},{time:1.2167,x:2.46,y:-3.47,curve:.25,c3:.75},{time:1.3833}],scale:[{},{time:.25,x:.9,y:.9,curve:.035,c2:.81,c3:.75},{time:.4167,x:1.04,y:1.04,curve:.427,c3:.896,c4:.91},{time:.6667,curve:.158,c2:.81,c3:.75},{time:.8333,x:1.04,y:1.04,curve:.658,c2:.04,c3:.596,c4:.98},{time:1.2167,x:.98,y:.98},{time:1.3833}]},{target:this.shuffleBottomNode,translate:[{curve:.25,c3:.75},{time:.25,x:-5.15,y:3.69,curve:0,c2:.76,c3:.75},{time:.4167,x:5.49,y:-6.37,curve:.458,c2:.02,c3:.927,c4:.94},{time:.6667,x:-3.88,y:1.14,curve:.123,c2:.87,c3:.75},{time:.8333,x:4.47,y:-6.16,curve:.658,c2:.04,c3:.596,c4:.98},{time:1.1667,x:-2.54,y:3.27,curve:.25,c3:.75},{time:1.3333}],scale:[{},{time:.25,x:.9,y:.9,curve:.035,c2:.81,c3:.75},{time:.4167,x:1.04,y:1.04,curve:.427,c3:.896,c4:.91},{time:.6667,curve:.158,c2:.81,c3:.75},{time:.8333,x:1.04,y:1.04,curve:.658,c2:.04,c3:.596,c4:.98},{time:1.1667,x:.98,y:.98},{time:1.3333}]}])}},{key:"playPressDownAnim",value:function(){var a;null==(a=this.shuffleIdleAnim)||a.stop(),M(D(r.prototype),"playPressDownAnim",this).call(this)}},{key:"playPressUpAnim",value:function(){var a;null==(a=this.shuffleIdleAnim)||a.stop(),M(D(r.prototype),"playPressUpAnim",this).call(this)}},{key:"playIdleAnim",value:function(){var a,o;this.shuffleIdleAnim&&(null!=(a=this.pressDownAnim)&&a.isPlaying||null!=(o=this.pressUpAnim)&&o.isPlaying||this.shuffleIdleAnim.start())}},{key:"stopAnims",value:function(){M(D(r.prototype),"stopAnims",this).call(this),this.shuffleIdleAnim&&this.shuffleIdleAnim.stop()}},{key:"resetNodes",value:function(){M(D(r.prototype),"resetNodes",this).call(this),this.resetNode(this.iconAddImageNode2),this.resetNode(this.shuffleBottomNode),this.resetNode(this.shuffleTopNode)}}]),r}(TJ)).prototype,"iconAddImageNode2",[C8,C9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao=L(Ar.prototype,"shuffleTopNode",[Ae,At],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),As=L(Ar.prototype,"shuffleBottomNode",[An,Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ar))||Ar);U._RF.pop(),U._RF.push({},"33d05eCLT1MCq/O2s6KrosX","ShuffleItem",void 0);var Am,Ag=$.ccclass,Ab=$.property;Ac=Ag("ShuffleItem"),Ah=Ab({type:Av,override:!0}),Ac((Ad=L((Ap=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"itemSpineAnim",Ad,N(a)),a}return a(p,[{key:"itemDataName",get:function(){return"shuffle"}},{key:"useItem",value:(E=B(function(){var a;var o=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:if(a=o.length>0&&void 0!==o[0]&&o[0],!this.checkBeforeUseItem())return[3,5];if(!(this.tileManager.getLeftTiles().length-this.tileContainer.getRealTilesLength()<=1))return[3,1];return[3,4];case 1:return this.addItemAmount(-1),tT(this.itemDataName),td.gameScene.toggleBlockInputContainer(!0),td.gameScene.gamePlay.itemManager.toggleItems(!1),[4,this.playShuffle(a)];case 2:return C.sent(),[4,ts.waitTweenAsync(.3)];case 3:C.sent(),td.gameScene.gamePlay.itemManager.updateItemStates(),td.gameScene.toggleBlockInputContainer(!1),this.updateUsingBoosterDailyMissions(),C.label=4;case 4:C.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"useItemWithoutPaying",value:(R=B(function(){var a;var o=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:return a=o.length>0&&void 0!==o[0]&&o[0],[4,this.playShuffle(a)];case 1:return C.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"playShuffle",value:(I=B(function(a){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.SHUFFLE_START),this.tileManager.stopAllTileAnimations(),[4,this.tileManager.handleShuffle()];case 1:return a.sent(),[2]}})}),function(a){return I.apply(this,arguments)})},{key:"getUnlockLevel",value:function(){return 3}}]),p}(C$)).prototype,"itemSpineAnim",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Av}}),Ap)),U._RF.pop(),U._RF.push({},"217206AtoFLFKTUXYnC8b5B","UndoItemSpineUIWidget",void 0);var Ak,Aw,AS,AT,AC=$.ccclass,AA=($.property,AC("UndoItemSpineUIWidget")(Am=function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initPressDownAnim",value:function(){this.pressDownAnim=new nI([{target:this.buttonImageNode,color:[{color:"ffffffff"},{time:.05,color:"f6f3f9ff"}]},{target:this.iconAddImageNode,color:[{color:"ffffff00",curve:.358,c3:.667,c4:.44},{time:.05,color:"ffffff0f"}]},{target:this.iconContainer,scale:[{curve:.25,c3:.527},{time:.0333,x:.878,y:.878}]},{target:this.buttonNode,translate:[{curve:.281,c2:.61,c3:.75},{time:.05,y:-2.78}],scale:[{curve:.281,c2:.61,c3:.75},{time:.05,x:.944,y:.944}]}])}},{key:"initPressUpAnim",value:function(){this.pressUpAnim=new nI([{target:this.buttonImageNode,color:[{color:"f6f3f9ff"},{time:.15,color:"ffffffff"}]},{target:this.iconAddImageNode,color:[{color:"ffffff0f",curve:.291,c2:.43,c3:.589},{time:.0833,color:"ffffff2c"},{time:.6167,color:"ffffff00"}]},{target:this.buttonNode,translate:[{y:-2.78,curve:.25,c3:.75},{time:.15}],scale:[{x:.944,y:.944,curve:.25,c3:.75},{time:.15,x:1.02,y:1.02,curve:.25,c3:.75},{time:.2833}]},{target:this.iconContainer,scale:[{x:.878,y:.878,curve:.365,c3:.527},{time:.2,x:1.06,y:1.06,curve:.442,c2:.01,c3:.75},{time:.4,x:.98,y:.98,curve:.25,c3:.75},{time:.6167,x:1.02,y:1.02,curve:.25,c3:.75},{time:.7833}]}])}}]),r}(TJ))||Am);U._RF.pop(),U._RF.push({},"f660dH3OS5A6pW7ea4e7Dm5","UndoItem",void 0);var A_,AP,AI,AB,AR,AE,AL,AO,AN=$.ccclass,AF=$.property;Ak=AN("UndoItem"),Aw=AF({type:AA,override:!0}),Ak((AT=L((AS=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"itemSpineAnim",AT,N(a)),a}return a(p,[{key:"itemDataName",get:function(){return"undo"}},{key:"useItem",value:(E=B(function(){var a,o;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:if(a=C.length>0&&void 0!==C[0]&&C[0],!this.checkBeforeUseItem())return[3,4];if(!(o=this.tileContainer.getAndRemoveTheLastTile()))return[3,3];return this.addItemAmount(-1),tT(this.itemDataName),td.gameScene.toggleBlockInputContainer(!0),td.gameScene.gamePlay.itemManager.toggleItems(!1),[4,this.playUndo(o,a)];case 1:return A.sent(),[4,ts.waitTweenAsync(.3)];case 2:A.sent(),td.gameScene.gamePlay.itemManager.updateItemStates(),td.gameScene.toggleBlockInputContainer(!1),this.updateUsingBoosterDailyMissions(),A.label=3;case 3:A.label=4;case 4:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"useItemWithoutPaying",value:(R=B(function(){var a,o;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:if(a=C.length>0&&void 0!==C[0]&&C[0],!(o=this.tileContainer.getAndRemoveTheLastTile()))return[3,2];return[4,this.playUndo(o,a)];case 1:A.sent(),A.label=2;case 2:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"playUndo",value:(I=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:if(a.indexInContainer=-1,a.tileFallTween.stopMoveTileAtRack(),td.gameScene.node.scene.emit(t2.TILE_RELEASE,a),!a.node)return[3,3];return a.node.parent=td.gameScene.gamePlay.gameObjects.node,[4,a.moveTileToWorldPosition(function(){},.1)];case 1:return C.sent(),[4,this.tileManager.handleTileReachDesUndo(a)];case 2:return C.sent(),[3,4];case 3:td.gameScene.toggleBlockInputContainer(o),C.label=4;case 4:return[2]}})}),function(a,o){return I.apply(this,arguments)})},{key:"getUnlockLevel",value:function(){return 2}}]),p}(C$)).prototype,"itemSpineAnim",[Aw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new AA}}),AS)),U._RF.pop(),U._RF.push({},"9e98cYl/clH6ZCequECM3fZ","ItemAnimController",void 0);var AD,AM,Ax,Az,AG,Aq,AU,AH=$.ccclass,AW=$.property,AV=(A_=AH("ItemAnimController"),AP=AW(C$),AI=tj.required,AB=AW(C$),AR=tj.required,A_((AL=L((AE=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"magicItem",AL,N(a)),O(a,"shuffleItem",AO,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"stopAndResetItemAnims",value:function(){this.unscheduleAllCallbacks(),this.magicItem.stopAndResetAnims(),this.shuffleItem.stopAndResetAnims()}},{key:"tryToPlayIdleAnim",value:function(){var a=this;this.unscheduleAllCallbacks(),this.scheduleOnce(function(){a.playInfiniteIdleAnims()},5)}},{key:"playInfiniteIdleAnims",value:function(){var a=this;this.playIdleAnims(),this.schedule(function(){a.playIdleAnims()},1.5)}},{key:"playIdleAnims",value:function(){var a=[];this.magicItem.shouldLockItem()||a.push(this.magicItem),this.shuffleItem.shouldLockItem()||a.push(this.shuffleItem),0!==a.length&&a[Math.floor(Math.random()*a.length)].playIdleAnim()}}]),r}(eo)).prototype,"magicItem",[AP,AI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AO=L(AE.prototype,"shuffleItem",[AB,AR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE))||AE);U._RF.pop(),U._RF.push({},"080c9InBepF9LwB4JBfqaOU","RibbonPurple",void 0);var AK,AY,Aj,AX,AJ,AZ,AQ,A$,A0,A1=$.ccclass,A2=$.property,A3=(AD=A1("RibbonPurple"),AM=A2(ee),Ax=tj.required,Az=tj.required,AD((Aq=L((AG=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"textureBrazil",Aq,N(a)),O(a,"spine",AU,N(a)),a}return a(r,[{key:"__preload",value:function(){this.spine=this.node.getComponent(e1.Skeleton),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"prepareFadeIn",value:function(){this.spine.clearTracks(),this.spine.setToSetupPose()}},{key:"fadeIn",value:function(){if("br"===globalThis.game.language.getCurrentLocale()){var a="NoMoreMoveRibbon"===this.node.name?"txt":"win_txt";this.spine.setAttachment(a,""),this.textureBrazil.active=!0}else this.textureBrazil.active=!1;this.spine.setAnimation(0,"show",!1),this.spine.setAnimation(1,"idle",!0)}},{key:"fadeOut",value:function(){if(this.spine.clearTracks(),"br"===globalThis.game.language.getCurrentLocale()){var a="NoMoreMoveRibbon"===this.node.name?"txt":"win_txt";this.spine.setAttachment(a,""),this.textureBrazil.active=!0}else this.textureBrazil.active=!1;this.spine.setAnimation(0,"hide",!1)}}]),r}(eo)).prototype,"textureBrazil",[AM,Ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AU=L(AG.prototype,"spine",[Az],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AG))||AG);U._RF.pop(),U._RF.push({},"83c59lK3IVPo4esGQOOCnqi","ProgressRoad",void 0);var A4,A5,A6,A7,A8,A9=$.ccclass,_e=$.property,_t=(AK=A9("ProgressRoad"),AY=_e({min:0,max:1,slide:!0}),Aj=tj.required,AX=tj.required,AJ=tj.required,AK((L((AZ=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A)))._progress=.5,O(a,"mask",AQ,N(a)),O(a,"graphics",A$,N(a)),O(a,"uiTransform",A0,N(a)),a}return a(r,[{key:"progressValue",get:function(){return this._progress},set:function(a){this._progress=a,this.initComponentsAndData(),this.setProgress(a)}},{key:"__preload",value:function(){this.initComponentsAndData()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"toggleMask",value:function(a){this.graphics.enabled=a,this.mask.enabled=a}},{key:"initComponentsAndData",value:function(){this.mask=this.getComponent(e2),this.graphics=this.getComponent(ew),this.uiTransform=this.getComponent(en),this.validateRequiredComponents()}},{key:"setUpRoad",value:function(){this.graphics.lineWidth=10,this.graphics.clear()}},{key:"updateGraphic",value:function(){this.graphics.stroke(),this.graphics.fill()}},{key:"setProgress",value:function(a){if(this.mask.enabled){this.setUpRoad();var o=a,C=this.uiTransform.contentSize,A=C.width,P=C.height,I=new H(-A/2+.8*A,-P/2),B=new H(-A/2+.8*A,P/2),R=new H(-A/2+.2*A,P/2);if(o>0){var E=Math.min(o,.2);o-=E,this.runOneHalfThree(I,E/.2)}if(o>0){var L=Math.min(o,.6);o-=L,this.runTwoHalfThree(B,L/.6)}if(o>0){var O=Math.min(o,.2);o-=O,this.runThreeHalfThree(R,O/.2)}this.updateGraphic()}}},{key:"runOneHalfThree",value:function(a,o){var C=this.uiTransform.contentSize,A=C.width,P=C.height,I=Math.atan(P/(.2*A))/Math.PI*180,B=Math.min(90*o,I),R=new H(A/2,-P/2),E=new H(A/2,P/2),L=this.findIntersection(a,B,R,E);if(this.addFace(a,R,L),o>I/90){var O=new H(A/2,P/2),N=new H(a.x,P/2),F=this.findIntersection(a,90*o,O,N);this.addFace(a,O,F)}}},{key:"runTwoHalfThree",value:function(a,o){var C=this.uiTransform.contentSize,A=C.width,P=C.height,I=a.x-o*A*.6,B=a.y,R=Math.min(1,o);R/=1;var E=a.x-R*A*.6,L=-P/2;this.addFace(a,new H(a.x,-P/2),new H(E,L)),this.addFace(a,new H(E,L),new H(I,B))}},{key:"runThreeHalfThree",value:function(a,o){var C=this.uiTransform.contentSize,A=C.width,P=C.height,I=Math.atan(.2*A/P)/Math.PI*180,B=-90-Math.min(90*o,I),R=new H(a.x,-P/2),E=new H(-A/2,-P/2),L=this.findIntersection(a,B,R,E);if(this.addFace(a,new H(a.x,-P/2),L),o>I/90){var O=new H(-A/2,-P/2),N=new H(-A/2,P/2),F=this.findIntersection(a,-90-90*o,O,N);this.addFace(a,new H(-A/2,-P/2),F)}}},{key:"addFace",value:function(a,o,C){this.graphics.moveTo(a.x,a.y),this.graphics.lineTo(o.x,o.y),this.graphics.lineTo(C.x,C.y)}},{key:"findIntersection",value:function(a,o,C,A){var P=Math.PI/180*o,I=Math.tan(P),B=a.y-I*a.x,R=(A.y-C.y)/(A.x-C.x),E=C.y-R*C.x;if(I===R)return H.ZERO;var L=C.x;A.x!==C.x&&(L=(E-B)/(I-R));var O=A.y;return A.y!==C.y&&(O=I*L+B),new H(L,O)}}]),r}(eo)).prototype,"progressValue",[AY],Object.getOwnPropertyDescriptor(AZ.prototype,"progressValue"),AZ.prototype),AQ=L(AZ.prototype,"mask",[Aj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A$=L(AZ.prototype,"graphics",[AX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A0=L(AZ.prototype,"uiTransform",[AJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AZ))||AZ);U._RF.pop(),U._RF.push({},"158822wkFNLW6T+fiqXxZvx","Rack",void 0);var _n,_i=$.ccclass,_r=$.property,_a=(A4=_i("Rack"),A5=tj.required(ni(ee)),A6=_r([ee]),A4((A8=L((A7=function(P){C(d,P);var I,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"slots",A8,N(a)),a}return a(d,[{key:"__preload",value:function(){var a,o=E(this.slots);try{for(o.s();!(a=o.n()).done;){var C=a.value;C.setPosition(C.position.x,130-this.node.position.y)}}catch(a){o.e(a)}finally{o.f()}tj.validateRequiredProperties(this,d)}},{key:"fadeOut",value:(L=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return o=this.slots.map(function(a,o){return Y(a).delay(.05*o).to(.2,{scale:ei.ZERO},{easing:"backIn"})}),C=(a=Y({})).parallel.apply(a,R(o)),[4,ts.runTweenAsync(C)];case 1:return A.sent(),this.disableUIRenderer(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"fadeIn",value:(I=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return this.enableUIRenderer(),o=this.slots.map(function(a,o){return Y(a).delay(.3+.05*o).to(.2,{scale:ei.ONE},{easing:"backOut"})}),C=(a=Y({})).parallel.apply(a,R(o)),[4,ts.runTweenAsync(C)];case 1:return A.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"fadeInInstantly",value:function(){this.enableUIRenderer();var a,o=E(this.slots);try{for(o.s();!(a=o.n()).done;)a.value.setScale(ei.ONE)}catch(a){o.e(a)}finally{o.f()}}},{key:"fadeOutInstantly",value:function(){this.disableUIRenderer();var a,o=E(this.slots);try{for(o.s();!(a=o.n()).done;)a.value.setScale(ei.ZERO)}catch(a){o.e(a)}finally{o.f()}}},{key:"disableUIRenderer",value:function(){var a,o=E(this.slots);try{for(o.s();!(a=o.n()).done;){var C=a.value.getComponent(ea);C&&(C.opacity=0)}}catch(a){o.e(a)}finally{o.f()}}},{key:"enableUIRenderer",value:function(){var a,o=E(this.slots);try{for(o.s();!(a=o.n()).done;){var C=a.value.getComponent(ea);C&&(C.opacity=255)}}catch(a){o.e(a)}finally{o.f()}}},{key:"getSlotX",value:function(a){var o=this.slots;if(0<=a&&a<o.length)return o[a].position.x;var C=z(o,2),A=C[0],P=C[1].position.x-A.position.x;return A.position.x+a*P}},{key:"getSlotCount",value:function(){return this.slots.length}}]),d}(eo)).prototype,"slots",[A5,A6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A7))||A7);U._RF.pop(),U._RF.push({},"3dfe28SJbxBJLD0wJvX0yVw","TileContainerAnimation",void 0);var _o=(0,$.ccclass)("TileContainerAnimation")(_n=function(){var C;function n(a){o(this,n),this.tileContainerNode=void 0,this.containerTween=null,this.countDownTween=null,this.tileContainerNode=a}return a(n,[{key:"handlePlayTileContainerAnim",value:(C=B(function(){var a;return _ts_generator(this,function(o){return a=this,this.countDownTween&&this.countDownTween.stop(),this.countDownTween=Y({value:3.2}).to(3.2,{value:0},{easing:"smooth",onComplete:function(){a.stopTileContainerAnim(),a.playTileContainerAnim()}}).start(),[2]})}),function(){return C.apply(this,arguments)})},{key:"playTileContainerAnim",value:function(){var a=Y(this.tileContainerNode).to(.4,{scale:new ei(1.05,1.05,1.05)},{easing:"cubicOut"}),o=Y(this.tileContainerNode).to(.15,{scale:new ei(1,1,1)},{easing:"cubicInOut"}),C=Y(this.tileContainerNode).to(.35,{scale:new ei(1.05,1.05,1.05)},{easing:"cubicOut"}),A=Y(this.tileContainerNode).to(.3,{scale:new ei(1,1,1)},{easing:"cubicInOut"});this.containerTween=Y(this.tileContainerNode).sequence(a,o,C,A,Y().delay(2)).repeatForever().start()}},{key:"stopTileContainerAnim",value:function(){em.stopAllByTarget(this.tileContainerNode),this.countDownTween&&this.countDownTween.stop(),this.containerTween&&this.containerTween.stop(),1!==this.tileContainerNode.scale.x&&Y(this.tileContainerNode).to(.3,{scale:new ei(1,1,1)},{easing:"cubicOut"}).start()}}]),n}())||_n;U._RF.pop(),U._RF.push({},"56b970soYZFr5O5s8XN+FfJ","BaseHandler",void 0);var _s=a(function e(a){o(this,e),this.tileLogic=void 0,this.tileLogic=a});U._RF.pop(),U._RF.push({},"e1676VXD/1D47Zahd+a1Q1+","AddTileHandler",void 0);var _l=function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"findAndMarkPotentialMatches",value:function(a){for(var o=this.tileLogic.getTiles(),C=o.length,A=[],P=0;P<o.length;P++){var I=o[P];I.id!==a.id||I.readyToRemove||(A.push(I),I.readyToRemove=!0,C=P+1)}return A.push(a),a.readyToRemove=!0,{potentialMatch:A,insertionIndex:C}}},{key:"processPotentialMatch",value:function(a,o){if(a.length<3){var C,A=E(a);try{for(A.s();!(C=A.n()).done;)C.value.readyToRemove=!1}catch(a){A.e(a)}finally{A.f()}}else this.tileLogic.pushArrayMatchedTiles(a),this.tileLogic.countMatchedTiles+=1,this.tileLogic.countMatchedTiles===this.tileLogic.numberOfMatchedTiles&&(this.tileLogic.finalTile=o)}},{key:"handleAddTile",value:function(a){this.tileLogic.lastTileClickedInContainer=a,this.tileLogic.stackTiles.push(a);var o=this.findAndMarkPotentialMatches(a),C=o.potentialMatch,A=o.insertionIndex;return this.tileLogic.tiles.splice(A,0,a),this.tileLogic.addRealTilesLength(1),this.tileLogic.tileContainer.node.scene.emit(t2.TILE_OUT_OF_BOARD),this.processPotentialMatch(C,a),this.tileLogic.arrayMatchedTiles.length>0}}]),r}(_s);U._RF.pop(),U._RF.push({},"35f1dXXRvNJA7SXsauXaVrJ","UpdateTilesStateHandler",void 0);var _u=function(P){C(m,P);var I,R,L,O,N,F,D,M,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=z.call.apply(z,[this].concat(A))).startIdxForSound=-1,a.explosionTilesPromises=[],a.currentAbortController=null,a.shouldPlayFinalPromiseResolve=function(){},a.shouldPlayFinalPromise=new Promise(function(o){a.shouldPlayFinalPromiseResolve=o}),a}return a(m,[{key:"resetState",value:function(){var a,o=this;this.explosionTilesPromises=[],null==(a=this.currentAbortController)||a.abort(),this.currentAbortController=null,this.shouldPlayFinalPromiseResolve=function(){},this.shouldPlayFinalPromise=new Promise(function(a){o.shouldPlayFinalPromiseResolve=a})}},{key:"computeRackTargetPosition",value:function(a,o){var C=this.tileLogic.tileContainer.rack.getSlotX(a),A=130;if(o.node.parent!==this.tileLogic.tileContainer.node){var P,I=this.tileLogic.tileContainer.node.worldPosition.y+130,B=new ei(0,0,0);null==(P=o.node.parent)||P.inverseTransformPoint(B,new ei(0,I,0)),A=B.y}return new ei(C,A)}},{key:"getTileOriginWorldPosition",value:function(a){var o=a.worldPos,C=o.x,A=o.y;return new ei(C,A)}},{key:"updateTilesState",value:(x=B(function(){var a,o,C,A,P,I,B,R;var E=arguments;return _ts_generator(this,function(L){for(a=E.length>0&&void 0!==E[0]?E[0]:0,o=this.tileLogic.getTiles(),C=td.gameScene.gamePlay,A=this.startNewAbortController().controller,P=0;P<o.length;P++){if(A.signal.aborted)break;if((I=o[P]).worldPos&&I.indexInContainer!==P)if(I.indexInContainer=P,B=this.computeRackTargetPosition(P,I),R=this.getTileOriginWorldPosition(I),I.state!==t1.AT_CONTAINER&&I.state!==t1.DESTROYING)if(I!==this.tileLogic.getFinalTile())C.gameUI.footer.setCanClick(!1),I.tileFallTween.moveTileToRack(B,R,this.handleMatchTiles.bind(this,I),a).then(function(){C.gameUI.footer.setCanClick(!0)});else this.handleMoveTileToRackFinal(I,B,R,a);else{if(I.isHandleFinalAnim)continue;I.tileFallTween.moveTileAtRack(B)}}return[2]})}),function(){return x.apply(this,arguments)})},{key:"handleMoveTileToRackFinal",value:(M=B(function(a,o,C,A){return _ts_generator(this,function(P){switch(P.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,a.tileFallTween.moveTileToRack(o,C,this.prepareToPlayFinalMatch.bind(this,a),A)];case 1:return P.sent(),this.tileLogic.tileContainer.updateRackAnimState(),ts.waitTweenAsync(.5),[2]}})}),function(a,o,C,A){return M.apply(this,arguments)})},{key:"prepareToPlayFinalMatch",value:(D=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:if(this.changeTileStateToAtContainer(a),!(1!==td.levelManager.getLevel()))return[3,2];return[4,this.shouldPlayFinalPromise];case 1:o.sent(),o.label=2;case 2:return this.handleMatchTilesFinal(),[2]}})}),function(a){return D.apply(this,arguments)})},{key:"removeMatchedTilesWithAudio",value:(F=B(function(a){var o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:for(o=[],this.startIdxForSound=(this.startIdxForSound+1)%2,C=a[1].node.worldPosition,A=0;A<a.length;A++)th.playSound(m.SOUND[this.startIdxForSound+A]),P=a[A].tileRemoveTween.removeTileFromRack(this.tileLogic.handleReturnTileToPool.bind(this.tileLogic,a[A]),this.tileLogic.showExplosionEffect.bind(this.tileLogic,a[A]),.1*A),o.push(P),this.explosionTilesPromises.push(P);return[4,Promise.all(o)];case 1:return[2,(I.sent(),this.tileLogic.tileContainer.getTileManager().allTileAmount-3===this.explosionTilesPromises.length&&this.shouldPlayFinalPromiseResolve(),C)]}})}),function(a){return F.apply(this,arguments)})},{key:"handleMatchTiles",value:(N=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(td.gameScene.gamePlay.logStepProgress(),this.changeTileStateToAtContainer(a),!(o=this.tileLogic.getMatchedTilesFor(a)))return[3,5];if(!o.includes(this.tileLogic.getFinalTile()))return[3,1];return this.tileLogic.pushArrayMatchedTiles(o),[3,4];case 1:return this.tileLogic.addRealTilesLength(-3),this.tileLogic.updateCollectedTilesDailyMissions(),[4,this.removeMatchedTilesWithAudio(o)];case 2:return C=A.sent(),this.updateScoreForMode(C),[4,this.updateTilesState()];case 3:A.sent(),td.gameScene.gamePlay.itemManager.updateItemStates(),A.label=4;case 4:return[3,6];case 5:a===this.tileLogic.lastTileClickedInContainer&&this.tileLogic.tileContainer.updateRackAnimState(),A.label=6;case 6:return[2]}})}),function(a){return N.apply(this,arguments)})},{key:"alignTilesForFinalMatch",value:(O=B(function(){var a,o,C,A,P,I,B;return _ts_generator(this,function(R){switch(R.label){case 0:for(a=[],o=this.tileLogic.arrayMatchedTiles[0],C=0;C<3;C++)if(A=this.tileLogic.tileContainer.rack.getSlotX(C),Math.abs(o[C].node.position.x-A)>.1)o[C].isHandleFinalAnim=!0,P=this.tileLogic.tileContainer.rack.getSlotX(C),I=(o[C].node.parent===this.tileLogic.tileContainer.node?0:this.tileLogic.tileContainer.node.position.y)+130,B=o[C].tileFallTween.moveTileAtRack(new ei(P,I)),a.push(B);return[4,Promise.all(a)];case 1:return R.sent(),[2]}})}),function(){return O.apply(this,arguments)})},{key:"playFinalTilesTweens",value:(L=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:for(a=this.tileLogic.arrayMatchedTiles[0],o=[],C=a[0].tileSpecialMatch3.playJumpTween().then(function(){td.gameScene.gamePlay.vibrate.vibrate(50)}),o.push(C),A=1;A<3;A++)P=a[A].tileSpecialMatch3.playSlidingTween(A,this.tileLogic.tileContainer.rack.getSlotX(0)),o.push(P);return[4,Promise.all(o)];case 1:return I.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"playAllMatchSounds",value:function(){th.playSound(tZ.MATCH_1),th.playSound(tZ.MATCH_2),th.playSound(tZ.MATCH_3),th.playSound(tZ.MATCH_4),th.playSound(tZ.MATCH_5)}},{key:"removeAllButFirstTile",value:function(){var a,o=this.tileLogic.getTiles().slice(1),C=E(o);try{for(C.s();!(a=C.n()).done;){var A=a.value;this.tileLogic.handleReturnTileToPool(A)}}catch(a){C.e(a)}finally{C.f()}}},{key:"removeFirstTileWithFx",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,(a=this.tileLogic.getTiles()[0]).tileRemoveTween.removeTileFromRack(this.tileLogic.handleReturnTileToPool.bind(this.tileLogic,a),this.tileLogic.showExplosionEffect.bind(this.tileLogic,a),0)];case 1:return o.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"handleMatchTilesFinal",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(td.gameScene.gamePlay.logStepProgress(),!!this.tileLogic.isHandleFinalTile)return[3,4];return this.tileLogic.isHandleFinalTile=!0,td.gameScene.toggleBlockInputContainer(!0),[4,this.alignTilesForFinalMatch()];case 1:return o.sent(),this.tileLogic.sortFinalTilesInRack(),[4,this.playFinalTilesTweens()];case 2:return o.sent(),this.playAllMatchSounds(),this.tileLogic.addRealTilesLength(-3),this.tileLogic.tileContainer.updateRackAnimState(),this.tileLogic.updateCollectedTilesDailyMissions(),a=this.tileLogic.getTiles()[1].node.worldPosition,this.removeAllButFirstTile(),[4,this.removeFirstTileWithFx()];case 3:o.sent(),td.gameScene.gamePlay.gameUI.footer.toggleItems(!1),this.updateScoreForMode(a),o.label=4;case 4:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateScoreForMode",value:function(a){var o=td.gameScene.gamePlay.gameUI.header;switch(window.game.match.getMatchState().mode){case"challenge-friend":o.challengeBlock.updateScoreWhenMatch3(a)}}},{key:"changeTileStateToAtContainer",value:function(a){a.state=t1.AT_CONTAINER,this.tileLogic.updateTileParentToRackNode(a)}},{key:"startNewAbortController",value:function(){var a;null==(a=this.currentAbortController)||a.abort();var o=new AbortController;return this.currentAbortController=o,{controller:o}}}]),m}(_s);_u.SOUND=[tZ.MATCH_1,tZ.MATCH_2,tZ.MATCH_3,tZ.MATCH_4,tZ.MATCH_5],U._RF.pop(),U._RF.push({},"f9d48u9v2xAoacDQT9X7Q5t","TileContainerLogic",void 0);var _c,_h,_p,_d,_f,_y,_v,_m,_g,_b,_k,_w=function(){var C;function n(a){o(this,n),this.tiles=[],this.stackTiles=[],this.arrayMatchedTiles=[],this.finalTile=null,this.lastTileClickedInContainer=null,this.realTilesLength=0,this.countMatchedTiles=0,this.numberOfMatchedTiles=0,this.isHelped=!1,this.isHandleFinalTile=!1,this.tileContainer=void 0,this.addTileHandler=void 0,this.updateTilesStateHandler=void 0,this.tileContainer=a,this.addTileHandler=new _l(this),this.updateTilesStateHandler=new _u(this)}return a(n,[{key:"getTiles",value:function(){return this.tiles}},{key:"getStackTiles",value:function(){return this.stackTiles}},{key:"getRealTilesLength",value:function(){return this.realTilesLength}},{key:"getFinalTile",value:function(){return this.finalTile}},{key:"addRealTilesLength",value:function(a){this.realTilesLength+=a}},{key:"onAllTileReady",value:function(a){this.finalTile=null,this.countMatchedTiles=0,this.realTilesLength=0,this.numberOfMatchedTiles=a/3,this.isHandleFinalTile=!1}},{key:"reset",value:function(){this.tiles=[],this.stackTiles=[],this.arrayMatchedTiles=[],this.realTilesLength=0,this.updateTilesStateHandler.resetState()}},{key:"getAndRemoveTheLastTile",value:function(){if(this.stackTiles.length>0){for(var a=this.stackTiles.length-1;a>=0;){var o=this.stackTiles[a];if(o.state===t1.AT_CONTAINER&&!this.isTileInMatchedArray(o))break;a--}if(a<0)return;var C=this.stackTiles[a],A=this.tiles.indexOf(C);if(-1===A)return;if(this.tiles[A].state!==t1.AT_CONTAINER)return;return this.tiles.splice(A,1),this.addRealTilesLength(-1),this.stackTiles.splice(a,1),C}}},{key:"getSuitableTile",value:function(){for(var a=[],o=new Map,C=0,A=this.tiles.length-1;A>=0;A--){var P,I=this.tiles[A];I.state!==t1.AT_CONTAINER&&I.state!==t1.MOVING_TO_CONTAINER||this.isTileInMatchedArray(I)||(o.has(I.id)||o.set(I.id,[]),null==(P=o.get(I.id))||P.push(I),C=Math.max(C,o.get(I.id).length))}var B,L=E(o);try{for(L.s();!(B=L.n()).done;){var O=z(B.value,2),N=(O[0],O[1]);if(N.length===C){a.push.apply(a,R(N));break}}}catch(a){L.e(a)}finally{L.f()}return a}},{key:"removeTileStack",value:function(a){this.stackTiles.splice(this.stackTiles.indexOf(a),1)}},{key:"isLoseGame",value:function(){return this.realTilesLength>=this.tileContainer.rack.getSlotCount()&&!this.isHelped}},{key:"pushArrayMatchedTiles",value:function(a){this.arrayMatchedTiles.push(a)}},{key:"isTileInMatchedArray",value:function(a){var o,C=E(this.arrayMatchedTiles);try{for(C.s();!(o=C.n()).done;)if(o.value.includes(a))return!0}catch(a){C.e(a)}finally{C.f()}return!1}},{key:"addTileForTutorial",value:function(a){this.tiles.push(a),this.stackTiles.push(a)}},{key:"removeTile",value:function(a){var o=this.tiles.indexOf(a);o>-1&&this.tiles.splice(o,1)}},{key:"getMatchedTilesFor",value:function(a){for(var o=0;o<this.arrayMatchedTiles.length;o++){var C=this.arrayMatchedTiles[o];if(C.includes(a))return C.indexOf(a)!==C.length-1?null:(this.arrayMatchedTiles.splice(o,1),C)}return null}},{key:"handleAddTile",value:function(a,o){var C=arguments.length>1&&void 0!==o?o:0;this.addTileHandler.handleAddTile(a)||this.checkedLoseGame(),this.updateTilesState(C)}},{key:"updateTilesState",value:function(a){var o=arguments.length>0&&void 0!==a?a:0;return this.updateTilesStateHandler.updateTilesState(o)}},{key:"checkedLoseGame",value:(C=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.isLoseGame())return[3,3];return td.gameScene.toggleBlockInputContainer(!0),this.tileContainer.getContainerAnim().stopTileContainerAnim(),[4,ts.waitTweenAsync(.4)];case 1:return a.sent(),this.tileContainer.disableContainerAnim(),[4,td.gameScene.gamePlay.handleGameOver()];case 2:a.sent(),td.gameScene.toggleBlockInputContainer(!1),a.label=3;case 3:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"updateTileParentToRackNode",value:function(a){if(void 0!==a&&a.node.parent!==this.tileContainer.node){var o=a.node.getWorldPosition();a.node.parent=this.tileContainer.node,a.node.worldPosition=o}}},{key:"sortFinalTilesInRack",value:function(){for(var a=this.arrayMatchedTiles[0].length,o=0;o<3;o++){var C=this.arrayMatchedTiles[0][o].node;C&&C.setSiblingIndex(a-o)}this.tileContainer.rack.node.setSiblingIndex(0)}},{key:"handleReturnTileToPool",value:function(a){this.removeTileStack(a),this.removeTile(a),a.returnToPool()}},{key:"showExplosionEffect",value:function(a){var o=td.gameScene.gamePlay,C=o.vfxManager.getExplosionTileWithMatVFX(),A=o.vfxManager.getExplosionTileWithoutMatVFX(),P=a.node.getWorldPosition();C.node.worldPosition=P,A.node.worldPosition=P,C.node.setSiblingIndex(1e3),A.node.setSiblingIndex(1e3),C.playVfx(),A.playVfx()}},{key:"setUpLevelTutorial",value:function(a){for(var o=0;o<a.length;o++)if(a[o].node){var C=this.tileContainer.rack.getSlotX(o);a[o].node.setParent(this.tileContainer.node);var A=a[o].currentSize.x,P=1.05*t0.SIZE.WIDTH/A;a[o].tileInitTween.currentScale=new ei(P,P),a[o].node.setPosition(new ei(C,130)),this.addTileForTutorial(a[o])}}},{key:"updateCollectedTilesDailyMissions",value:function(){td.gameScene.gamePlay.updateDailyMissionCount({collectTiles:function(a){return a+3}})}}]),n}();U._RF.pop(),U._RF.push({},"ce7dcXwOfNOabYy7jhTv9Qc","TileContainer",void 0);var _S,_T,_C,_A,__,_P=$.ccclass,_I=$.property,_B=(_c=_P("TileContainer"),_h=_I(_a),_p=tj.required,_d=tj.required,_f=tj.required,_y=tj.required,_c((_m=L((_v=function(P){C(p,P);var I,R,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"rack",_m,N(a)),O(a,"tileContainerLogic",_g,N(a)),O(a,"tileManager",_b,N(a)),O(a,"containerAnim",_k,N(a)),a.height=0,a}return a(p,[{key:"updateRackAnimState",value:function(){this.containerAnim.stopTileContainerAnim(),this.tileContainerLogic.getRealTilesLength()>=5&&this.containerAnim.handlePlayTileContainerAnim()}},{key:"getRealTilesLength",value:function(){return this.tileContainerLogic.getRealTilesLength()}},{key:"getTilesOnRack",value:function(){return this.tileContainerLogic.getTiles()}},{key:"__preload",value:function(){this.init(),this.node.scene.on(t2.TILE_CLICKED,this.handleTileClicked,this),this.node.scene.on(t2.TILE_CREATED,this.reset,this),this.node.scene.on(t2.ALL_TILE_READY,this.onAllTileReady,this),this.validateRequiredComponents()}},{key:"disableContainerAnim",value:function(){this.containerAnim.stopTileContainerAnim()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,p)}},{key:"init",value:function(){var a;this.height=(null==(a=this.node.getComponent(en))?void 0:a.height)||0,this.tileManager=td.gameScene.gamePlay.tileManager,this.containerAnim=new _o(this.node),this.tileContainerLogic=new _w(this),this.alignTileContainer()}},{key:"alignTileContainer",value:function(){var a=tf.getBannerAdWorldHeight(),o=this.node.getComponent(eX);o&&(o.bottom=a+td.gameScene.gamePlay.gameUI.footer.height)}},{key:"onAllTileReady",value:function(){this.tileContainerLogic.onAllTileReady(this.tileManager.getLengthLeftTiles())}},{key:"reset",value:function(){this.tileContainerLogic.reset()}},{key:"getTileManager",value:function(){return this.tileManager}},{key:"getContainerAnim",value:function(){return this.containerAnim}},{key:"getStackLength",value:function(){return this.tileContainerLogic.getStackTiles().length}},{key:"getAndRemoveTheLastTile",value:function(){var a=this.tileContainerLogic.getAndRemoveTheLastTile();return a&&(this.updateRackAnimState(),this.tileContainerLogic.updateTilesState()),a}},{key:"getSuitableTile",value:function(){return this.tileContainerLogic.getSuitableTile()}},{key:"reopenTiles",value:(R=B(function(){var a,o,C;return _ts_generator(this,function(A){o=E(this.tileContainerLogic.getTiles());try{for(o.s();!(a=o.n()).done;)(C=a.value).tileInitTween.playScaleUpToCurrentAnimation(),C.state=t1.AT_CONTAINER}catch(a){o.e(a)}finally{o.f()}return this.tileContainerLogic.getRealTilesLength()>=5&&this.containerAnim.handlePlayTileContainerAnim(),[2]})}),function(){return R.apply(this,arguments)})},{key:"closeTiles",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(!(this.tileContainerLogic.getTiles()&&0!==this.tileContainerLogic.getTiles().length))return[3,2];o=[],C=E(this.tileContainerLogic.getTiles());try{for(C.s();!(a=C.n()).done;)(A=a.value).state!==t1.DESTROYING&&o.push(A.handleCloseTile())}catch(a){C.e(a)}finally{C.f()}return this.containerAnim.stopTileContainerAnim(),[4,Promise.all(o)];case 1:P.sent(),this.closeTilesImmediately(),P.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"closeTilesImmediately",value:function(){if(this.tileContainerLogic.getTiles()&&0!==this.tileContainerLogic.getTiles().length){var a,o=E(this.tileContainerLogic.getTiles());try{for(o.s();!(a=o.n()).done;){var C=a.value.getComponent(ea);C&&(C.opacity=0)}}catch(a){o.e(a)}finally{o.f()}}}},{key:"resetTilesOpacity",value:function(){var a,o=E(this.tileContainerLogic.getTiles());try{for(o.s();!(a=o.n()).done;){var C=a.value.getComponent(ea);C&&(C.opacity=255)}}catch(a){o.e(a)}finally{o.f()}}},{key:"handleTileClicked",value:function(a,o,C){var A=arguments.length>1&&void 0!==o&&o,P=arguments.length>2&&void 0!==C?C:0;a.isActive&&(this.tileContainerLogic.getTiles().includes(a)||(this.containerAnim.stopTileContainerAnim(),this.tileContainerLogic.isHelped=A,this.tileManager.handleGoldTileClicked(a),this.node.scene.emit(t2.TILE_START_MOVE,a),this.handleAddTile(a,P),A||td.gameScene.gamePlay.itemManager.updateItemStates(),td.gameScene.gamePlay.gameUI.footer.playItemsIdleAnim()))}},{key:"handleAddTile",value:function(a,o){this.tileContainerLogic.handleAddTile(a,o)}},{key:"isLoseGame",value:function(){return this.tileContainerLogic.isLoseGame()}}]),p}(eo)).prototype,"rack",[_h,_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g=L(_v.prototype,"tileContainerLogic",[_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_b=L(_v.prototype,"tileManager",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_k=L(_v.prototype,"containerAnim",[_y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_v))||_v);U._RF.pop(),U._RF.push({},"50399dXy8FNFb/ZbiQuuG3u","MiniTile",void 0);var _R,_E=$.ccclass,_L=$.property,_O=(_S=_E("MiniTile"),_T=_L(wK),_C=tj.required,_S((__=L((_A=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"backgroundWithIcon",__,N(a)),a.iconIdx="",a}return a(r,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.backgroundWithIcon.disableOverlay()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"setIcon",value:function(a){this.iconIdx=a.name,this.backgroundWithIcon.setIcon(a)}},{key:"resetProperties",value:function(){this.backgroundWithIcon.clearIcon(),this.iconIdx="",this.node.scale=new ei(1,1,1)}}]),r}(eo)).prototype,"backgroundWithIcon",[_T,_C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_A))||_A);U._RF.pop(),U._RF.push({},"d0c64IPrYhBd5x7i6I7ym7i","TutorialHandGamePlay",void 0);var _N,_F,_D,_M,_x,_z,_G,_q,_U,_H,_W,_V,_K,_Y,_j=(0,$.ccclass)("TutorialHandGamePlay")(_R=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).tweenTutorialHand=null,a}return a(r,[{key:"playAnimationTutorialHand",value:function(){this.node.active=!0;var a=this.node.getComponent(ea);a&&(a.opacity=0,Y(a).to(.2,{opacity:255}).start()),this.tweenTutorialHand=Y(this.node).to(.6,{scale:new ei(1.12,1.12)},{easing:tn}).to(.6,{scale:new ei(1,1)},{easing:tn}).union().repeatForever().start()}},{key:"stopAnimationTutorialHand",value:function(){var a,o=this;if(this.node.active){null==(a=this.tweenTutorialHand)||a.stop();var C=this.node.getComponent(ea);C&&Y(C).to(.2,{opacity:0}).call(function(){o.node.active=!1,o.node.setScale(1,1,1)}).start()}}}]),r}(eo))||_R;U._RF.pop(),U._RF.push({},"81d55Ak4NdOLZBB7+aAxtUE","MultipleColorConfetti",void 0);var _X,_J=$.ccclass,_Z=$.property,_Q=(_N=_J("MultipleColorConfetti"),_F=_Z(eV),_D=tj.required,_M=_Z(eV),_x=tj.required,_z=_Z(eV),_G=tj.required,_q=_Z(eV),_U=tj.required,_N((_W=L((_H=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"smallParticle1",_W,N(a)),O(a,"smallParticle2",_V,N(a)),O(a,"smallParticle3",_K,N(a)),O(a,"smallParticle4",_Y,N(a)),a}return a(s,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"playEffect",value:(I=B(function(){return _ts_generator(this,function(a){return this.smallParticle1.resetSystem(),this.smallParticle2.resetSystem(),this.smallParticle3.resetSystem(),this.smallParticle4.resetSystem(),this.smallParticle1.addParticle(),this.smallParticle2.addParticle(),this.smallParticle3.addParticle(),this.smallParticle4.addParticle(),[2]})}),function(){return I.apply(this,arguments)})},{key:"stopEffect",value:function(){this.smallParticle1.stopSystem(),this.smallParticle2.stopSystem(),this.smallParticle3.stopSystem(),this.smallParticle4.stopSystem()}}]),s}(eo)).prototype,"smallParticle1",[_F,_D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_V=L(_H.prototype,"smallParticle2",[_M,_x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_K=L(_H.prototype,"smallParticle3",[_z,_G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_Y=L(_H.prototype,"smallParticle4",[_q,_U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_H))||_H);U._RF.pop(),U._RF.push({},"21a9aAlkBtGxKLqip8g0o6l","ParticleSystem2DExtra",void 0);var _$=$.ccclass,_0=$.disallowMultiple,_1=$.executeInEditMode,_2=$.requireComponent,_3=_$("ParticleSystem2DExtra")(_X=_1(!0)(_X=_0(!0)(_X=_2(eV)(_X=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).particleSystem=void 0,a.emitParticle=function(o){return function(C){o(C);var A=a.particleSystem._simulator.particles.length,P=a.particleSystem._simulator.particles[A-1];a.initParticle(P)}},a.step=function(o){return function(C){for(var A=a.particleSystem._simulator.particles,P=0;P<A.length;P++){var I=A[P];a.updateParticle(I,C)}o(C)}},a}return a(r,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(eV),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var a=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(a);var o=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(o)}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}}]),r}(eo))||_X)||_X)||_X)||_X;U._RF.pop(),U._RF.push({},"cdb4e8A9S1GoY9dts4LiDjA","MultipleColorConfettiParticle",void 0),(0,$.ccclass)("MultipleColorConfettiParticle")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.8,2)*a.size,a.life=a.timeToLive,a.cycleDuration=a.life,this.setRandomColor(a),this.initScale(a)}},{key:"setRandomColor",value:function(a){var o=[0xd53434,0xf253a3,0xf39e02,5559120,7130857],C=o[Math.floor(V.randomRange(0,o.length))];a.color.r=C>>16&255,a.color.g=C>>8&255,a.color.b=255&C,a.color.a=255}},{key:"initScale",value:function(a){a.size=a.maxSize}},{key:"updateParticle",value:function(a,o){}}]),r}(_3)),U._RF.pop(),U._RF.push({},"f8219fPNHdFp7wYhFvX+Ev2","Confetti",void 0);var _4,_5,_6,_7,_8,_9,Pe,Pt,Pn=$.ccclass,Pi=$.property;_4=Pn("Confetti"),_5=Pi(eV),_6=tj.required,_7=Pi(eV),_8=tj.required,_4((Pe=L((_9=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"startEffect",Pe,N(a)),O(a,"whiteStarEffect",Pt,N(a)),a}return a(s,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"playEffect",value:(I=B(function(){var a=arguments;return _ts_generator(this,function(o){switch(o.label){case 0:if(a.length>0&&void 0!==a[0]&&a[0])return[3,2];return[4,ts.waitTweenAsync(.5)];case 1:o.sent(),o.label=2;case 2:return this.startEffect.resetSystem(),this.whiteStarEffect.resetSystem(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"stopEffect",value:function(){this.startEffect.stopSystem(),this.whiteStarEffect.stopSystem()}}]),s}(eo)).prototype,"startEffect",[_5,_6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt=L(_9.prototype,"whiteStarEffect",[_7,_8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_9)),U._RF.pop(),U._RF.push({},"c07dfulyGRIDoPly76Qsa61","ExplodedInStarEffect",void 0),(0,$.ccclass)("ExplodedInStarEffect")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).timeToStop=.45,a.rectangleSize=new H(1e3,500),a.minSpeed=350,a.maxSpeed=450,a}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(1,1.5)*a.size,a.elapsedTime=0,a.size=0,a.deltaSize=0,a.cycleDuration=V.randomRange(.4,.6),a.life=a.timeToLive,a.speed=V.randomRange(this.minSpeed,this.maxSpeed),this.setInitPosition(a.pos)}},{key:"updateParticle",value:function(a,o){a.elapsedTime>=this.timeToStop?this.updateScaleDown(a):(a.elapsedTime+=o,this.updateParticlePosition(a,o),this.updateScaleUp(a))}},{key:"setInitPosition",value:function(a){var o=this.rectangleSize.x,C=this.rectangleSize.y,A=a.x,P=a.y;return a.x=A+V.randomRange(-o/2,o/2),a.y=P+V.randomRange(-C/2,C/2),a}},{key:"updateParticlePosition",value:function(a,o){var C=new H(0,0).subtract(a.pos).normalize();a.pos.add(C.multiplyScalar(a.speed*o))}},{key:"updateScaleUp",value:function(a){var o=1-(a.life-a.timeToLive)%a.cycleDuration/a.cycleDuration;a.size=a.maxSize*Math.sin(o*Math.PI)}},{key:"updateScaleDown",value:function(a){var o=(a.life-a.timeToLive)/a.life;a.size=a.maxSize*(1-o)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"fcf68TqIKxC45UF376mULhk","ExplodedOutStarEffect",void 0),(0,$.ccclass)("ExplodedOutStarEffect")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).rectangleSize=new H(500,200),a.timeToStop=.3,a.maxSpeed=700,a.minSpeed=300,a}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.2,1)*a.size,a.elapsedTime=0,a.speed=V.randomRange(this.minSpeed,this.maxSpeed),a.size=0,a.deltaSize=0,a.currentTime=0,a.cycleDuration=V.randomRange(.4,.6),a.life=a.timeToLive,this.setInitPosition(a.pos),this.setDirection(a)}},{key:"setInitPosition",value:function(a){var o=this.node.position.x,C=this.node.position.y,A=this.rectangleSize.x/2,P=this.rectangleSize.y/2,I=o+V.randomRange(-A,A),B=C+V.randomRange(-P,P);return a.x=I,a.y=B,a}},{key:"setDirection",value:function(a){var o=this.node.position.x,C=this.node.position.y,A=new H(a.pos.x-o,a.pos.y-C).normalize();a.dir=A}},{key:"updateParticle",value:function(a,o){a.elapsedTime>=this.timeToStop?this.updateScaleDown(a):(this.updateScaleUp(a),this.updatePosition(a,o))}},{key:"updateScaleUp",value:function(a){var o=(a.life-a.timeToLive)/a.life;a.size=a.maxSize*o}},{key:"updateScaleDown",value:function(a){var o=(a.life-a.timeToLive)/a.life;a.size=a.maxSize*(1-o)}},{key:"updatePosition",value:function(a,o){a.elapsedTime+=o;var C=a.speed*o,A=a.pos.x+C*a.dir.x,P=a.pos.y+C*a.dir.y;a.pos.set(A,P)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"6f3d9E3f+5DsLAAB8d7Ngqa","StarExplosionsEffect",void 0);var Pr,Pa,Po,Ps,Pl,Pu,Pc,Ph,Pp,Pd,Pf,Py,Pv,Pm=$.ccclass,Pg=$.property;Pr=Pm("StarExplosionsEffect"),Pa=Pg(eV),Po=tj.required,Ps=Pg(eV),Pl=tj.required,Pr((Pc=L((Pu=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"explodedInEffect",Pc,N(a)),O(a,"explodedOutEffect",Ph,N(a)),a}return a(s,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"playExplodedInEffect",value:function(){this.explodedInEffect.resetSystem(),this.explodedInEffect.addParticle()}},{key:"playExplodedOutEffect",value:function(){this.explodedOutEffect.resetSystem(),this.explodedOutEffect.addParticle()}},{key:"playEffects",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.explodedInEffect.node.active=!0,this.explodedOutEffect.node.active=!0,this.playExplodedInEffect(),[4,ts.waitTweenAsync(.2)];case 1:return a.sent(),this.playExplodedOutEffect(),[4,ts.waitTweenAsync(.7)];case 2:return a.sent(),this.explodedInEffect.node.active=!1,this.explodedOutEffect.node.active=!1,[2]}})}),function(){return I.apply(this,arguments)})}]),s}(eo)).prototype,"explodedInEffect",[Pa,Po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ph=L(Pu.prototype,"explodedOutEffect",[Ps,Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pu)),U._RF.pop(),U._RF.push({},"b08eew/wCdEsbcWE2v+vkEM","FairyFlyEffect",void 0);var Pb=$.ccclass,Pk=$.property,Pw=(Pp=Pb("FairyFlyEffect"),Pd=tj.required(ni(pj)),Pf=Pk([pj]),Pp((Pv=L((Py=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"freeFly",Pv,N(a)),a.isPlaying=!1,a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"isEffectPlaying",value:function(){return this.isPlaying}},{key:"playEffect",value:function(){this.isPlaying=!0;var a,o=E(this.freeFly);try{for(o.s();!(a=o.n()).done;)a.value.play()}catch(a){o.e(a)}finally{o.f()}}},{key:"stopEffect",value:function(){this.isPlaying=!1;var a,o=E(this.freeFly);try{for(o.s();!(a=o.n()).done;)a.value.stop()}catch(a){o.e(a)}finally{o.f()}}}]),r}(eo)).prototype,"freeFly",[Pd,Pf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Py))||Py);U._RF.pop(),U._RF.push({},"ee0390l1VVOor58CP7q6RQN","SparkleRandomEffect",void 0),(0,$.ccclass)("SparkleRandomEffect")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.size=0,a.deltaSize=0,a.cycleDuration=V.randomRange(.4,.6),a.life=a.timeToLive,this.setInitPosition(a.pos)}},{key:"setInitPosition",value:function(a){var o=a.x,C=a.y;return a.x=o+V.randomRange(-35,35),a.y=C+V.randomRange(-35,35),a}},{key:"updateParticle",value:function(a,o){this.updateScale(a)}},{key:"updateScale",value:function(a){var o=(a.life-a.timeToLive)/a.life;a.size=a.maxSize*(1-o)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"dfddbQcC+FEdbz+y+BoupeK","SwitchActiveEffect",void 0);var PS,PT,PC,PA,P_,PP,PI,PB,PR,PE,PL,PO,PN=$.ccclass,PF=$.property,PD=(PS=PN("SwitchActiveEffect"),PT=PF(pj),PC=tj.required,PA=PF(pj),P_=tj.required,PS((PI=L((PP=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"bigCircle",PI,N(a)),O(a,"smallCircle",PB,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"playEffect",value:function(){this.bigCircle.play(),this.smallCircle.play()}},{key:"stopEffect",value:function(){this.bigCircle.stop(),this.smallCircle.stop()}}]),r}(eo)).prototype,"bigCircle",[PT,PC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PB=L(PP.prototype,"smallCircle",[PA,P_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PP))||PP);U._RF.pop(),U._RF.push({},"d0f2a18ROdJ2Y6WK6puQ5ve","YellowStarFlyUpParticle",void 0);var PM=$.ccclass,Px=$.property;PR=PM("YellowStarFlyUpParticle"),PE=Px(ek),PR((PO=L((PL=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"changeSizeSpeed",PO,N(a)),a}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.8,1)*a.size,a.size=0,a.deltaSize=0,a.life=a.timeToLive,a.cycleDuration=a.life}},{key:"updateParticle",value:function(a,o){this.updateScale(a)}},{key:"updateScale",value:function(a){var o=Math.sin((a.life-a.timeToLive)/a.life*Math.PI*this.changeSizeSpeed);a.size=a.maxSize*o}}]),r}(_3)).prototype,"changeSizeSpeed",[PE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),PL)),U._RF.pop(),U._RF.push({},"e33d0d4FuNOe7+HU0WJIdTD","CheatLogicHandler",void 0),$.ccclass,$.property;var Pz=function(){function n(){o(this,n),this.cheatLive=["music","sound","music","sound","music","hold2s","closeOutside"],this.cheatAction=[]}return a(n,[{key:"pushCheatAction",value:function(a){this.cheatAction.push(a)}},{key:"resetCheatAction",value:function(){this.cheatAction=[]}},{key:"isOnCheatMode",value:function(){return this.cheatAction.toString()===this.cheatLive.toString()}},{key:"canPushActionHold2s",value:function(){return this.cheatLive.slice(0,-2).toString()===this.cheatAction.toString()}}]),n}();U._RF.pop(),U._RF.push({},"da9b2mVGW1LLqVA/oTBcVv8","StepLogHandler",void 0);var PG,Pq,PU,PH,PW,PV,PK,PY,Pj=globalThis.game.analytics,PX=[0,1,25,50,75,100],PJ=function(){function n(){o(this,n),this.level=0,this.currentEvent="level_progress",this.currentIdx=0}return a(n,[{key:"logStep",value:function(a,o){if(!(a<=PX[this.currentIdx]||this.currentIdx===PX.length-1))for(;a>=PX[this.currentIdx+1]&&this.currentIdx+1<PX.length;)this.currentIdx++,Pj.event(this.currentEvent,{step:PX[this.currentIdx],level:this.level,is_skip_log:o})}},{key:"logAllRemainingSteps",value:function(){for(var a=this.currentIdx+1;a<PX.length;a++)Pj.event(this.currentEvent,{step:PX[a],level:this.level,is_skip_log:!0});this.currentIdx=PX.length-1}},{key:"reset",value:function(a){this.level=a,this.currentIdx=0,this.currentEvent="level_progress"}}]),n}();U._RF.pop(),U._RF.push({},"94823KkHrpAH7XUVoKj1OyM","BackgroundManager",void 0);var PZ,PQ,P$,P0,P1=$.ccclass,P2=$.property,P3=(PG=P1("BackgroundManager"),Pq=P2(ee),PU=tj.required,PH=P2(et),PW=tj.required,PG((PK=L((PV=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"bg",PK,N(a)),O(a,"blueImage",PY,N(a)),a.backgroundDict=new Map,a}return a(p,[{key:"getBackground",value:function(a){var o;return null!=(o=this.backgroundDict.get(a))?o:this.blueImage}},{key:"loadCurrentBackground",value:(E=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(this.backgroundDict.get(a))return[2,Promise.resolve()];if(o=a.split("_"),C="bg-".concat(o[1]),nr.isPortrait()&&(C+="-portrait"),A=to.getExistingSpriteFrame("".concat(no.BG_PREFIX).concat(C,"/spriteFrame")))return[3,2];return[4,to.loadSpriteFrameAsync("".concat(no.BG_PREFIX).concat(C,"/spriteFrame"),!1)];case 1:A=P.sent(),P.label=2;case 2:if(!A)return[2,Promise.resolve()];return this.backgroundDict.set(a,A),[2]}})}),function(a){return E.apply(this,arguments)})},{key:"loadBackgroundData",value:(R=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(o=td.mapDataManager.getBackgroundCardPayLoadOfLevel(a)))return[3,2];return[4,this.loadCurrentBackground(o.gameplayBackgroundKey)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(a){return R.apply(this,arguments)})},{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"onLoad",value:function(){var a=nr.isPortrait(),o=this.bg.getComponent(eX);o&&(o.isAlignLeft=a,o.isAlignRight=a,o.isAlignHorizontalCenter=a)}},{key:"loadBgData",value:function(){var a=td.mapDataManager.getNextBackgroundCardPayLoad();a&&this.loadCurrentBackground(a.gameplayBackgroundKey)}},{key:"getCurrentLevelGameBg",value:function(){var a=this.bg.getComponent(W);return a?a.spriteFrame:null}},{key:"setBgBaseOn",value:(I=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(o=this.bg.getComponent(W)))return[2,Promise.resolve()];return[4,this.loadCurrentBackground(a.gameplayBackgroundKey)];case 1:return C.sent(),o.spriteFrame=this.getBackground(a.gameplayBackgroundKey),this.updateBgSize(),[2]}})}),function(a){return I.apply(this,arguments)})},{key:"updateBgSize",value:function(){var a=eP.getVisibleSize().width,o=this.bg.getComponent(en);if(o){var C=o.contentSize.height;if(nr.isPortrait())o.setContentSize(a,C);else{var A=Math.max(a,4e3);o.setContentSize(A,C)}}}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,p)}},{key:"getCurrentBackground",value:function(){var a=this.bg.getComponent(W);return a?a.spriteFrame:null}},{key:"getUITransform",value:function(){return this.bg.getComponent(en)||null}}]),p}(eo)).prototype,"bg",[Pq,PU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PY=L(PV.prototype,"blueImage",[PH,PW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PV))||PV);U._RF.pop(),U._RF.push({},"f483bSELq9K+bqV4abSX/Hy","CoinManager",void 0);var P4,P5,P6,P7,P8,P9=$.ccclass,Ie=$.property;PZ=P9("CoinManager"),PQ=Ie(eY),PZ((P0=L((P$=function(P){C(p,P);var I,R,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"coinPrefab",P0,N(a)),a.coins=[],a}return a(p,[{key:"__preload",value:function(){}},{key:"spawnCoin",value:(R=B(function(a,o){var C,A,P;var I=arguments;return _ts_generator(this,function(B){switch(B.label){case 0:for(C=I.length>2&&void 0!==I[2]&&I[2],A=I.length>3&&void 0!==I[3]&&I[3],P=0;P<o;P++)this.getReadyCoin().setPosition(new ei(a.x,a.y,0));return[4,this.playCoinAnim(C,A)];case 1:return B.sent(),[2]}})}),function(a,o){return R.apply(this,arguments)})},{key:"playCoinAnim",value:(I=B(function(a,o){var C,A,P,I,B,R,L,O,N,F,D,M,x,z,q,U,H,W,V,K,j;return _ts_generator(this,function(o){switch(o.label){case 0:for(a&&td.gameScene.toggleBlockInputContainer(!0),C=[],th.playSound(tZ.COIN_APPEAR),A=0;A<this.coins.length;A++)if((P=this.coins[A]).active)B=(I=P.position).x,R=I.y,L=I.z,O=new ei(B+15*(20*Math.random()-10),R+15*(20*Math.random()-10)-20,L),N=Math.random()*(.25-.2)+.2,F=Y(P).to(N,{position:O},{easing:"sineOut"}),C.push(ts.runTweenAsync(F));return[4,Promise.all(C)];case 1:o.sent(),M=(D=this.getDestination()).x,x=D.y,this.coins.sort(function(a,o){return ei.distance(a.position,new ei(M,x,a.position.z))-ei.distance(o.position,new ei(M,x,o.position.z))}),q=E(this.coins);try{for(q.s();!(z=q.n()).done;)H=(U=z.value).getWorldPosition(),U.setWorldPosition(H)}catch(a){q.e(a)}finally{q.f()}for(W=td.gameScene.gamePlay.vibrate,V=0;V<this.coins.length;V++)if((K=this.coins[V]).active)j=new ei(M,x,K.position.z),Y(K).to(.05+.085*(V+1),{position:j},{easing:"sineOut"}).call(function(){W.vibrate(50),th.playSound(tZ.COINS_ADD,{volume:.3})}).start();return[4,ts.waitTweenAsync(.75)];case 2:return o.sent(),a&&this.scheduleOnce(function(){td.gameScene.toggleBlockInputContainer(!1)},.7),[2]}})}),function(a,o){return I.apply(this,arguments)})},{key:"getReadyCoin",value:function(){var a,o=E(this.coins);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.active)return td.gameScene.node.addChild(C),C.active=!0,C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.coinPrefab);return td.gameScene.node.addChild(A),this.coins.push(A),A}},{key:"getDestination",value:function(){return new ei(0,0,0)}}]),p}(eo)).prototype,"coinPrefab",[PQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P$)),U._RF.pop(),U._RF.push({},"ca842nPk3lKNYbtaLxSos5e","ScoreTextAnim",void 0);var It,In,Ii,Ir,Ia,Io=$.ccclass,Is=$.property,Il=(P4=Io("ScoreTextAnim"),P5=Is(er),P6=tj.required,P4((P8=L((P7=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"scoreLabel",P8,N(a)),a}return a(u,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,u)}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.node.scale=new ei(0,0,0);var a=this.node.getComponent(ea);a&&(a.opacity=0)}},{key:"setScore",value:function(a){this.scoreLabel.string=a}},{key:"runTweenMoveScore",value:(R=B(function(a){var o,C,A,P,I;return _ts_generator(this,function(B){if(o=this,C=this.node.getComponent(ea))return A=Y(this.node).to(.5,{scale:new ei(.5,.5,.5)}),P=Y(C).to(.5,{opacity:127}),I=Y(this.node).to(.5,{worldPosition:a}),[2,new Promise(function(a){C&&Y(C).to(.15,{opacity:255}).start(),Y(o.node).to(.15,{scale:new ei(1,1,1)}).call(function(){A.start(),P.start(),I.call(function(){o.resetState(),a()}).start()}).start()})];return[2]})}),function(a){return R.apply(this,arguments)})},{key:"runAnim",value:(I=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:return C="+".concat(a.toString()),this.setScore(C),[4,this.runTweenMoveScore(o)];case 1:return A.sent(),[2]}})}),function(a,o){return I.apply(this,arguments)})},{key:"resetState",value:function(){this.node.scale=new ei(0,0,0);var a=this.node.getComponent(ea);a&&(a.opacity=0),this.node.active=!1}}]),u}(eo)).prototype,"scoreLabel",[P5,P6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P7))||P7);U._RF.pop(),U._RF.push({},"71950SvwE1Hm6dOBP05fguc","ScoreTextAnimPool",void 0);var Iu,Ic,Ih,Ip,Id,If=$.ccclass,Iy=$.property,Iv=(It=If("ScoreTextAnimPool"),In=Iy(ee),Ii=tj.required,It((Ia=L((Ir=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"scoreTextAnimPrefab",Ia,N(a)),a.scoreTextAnimPool=[],a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"getScoreTextAnimNode",value:function(){for(var a=0;a<this.scoreTextAnimPool.length;a++)if(!this.scoreTextAnimPool[a].active)return this.scoreTextAnimPool[a];var o=ej(this.scoreTextAnimPrefab);return o.parent=this.node,this.scoreTextAnimPool.push(o),o}}]),r}(eo)).prototype,"scoreTextAnimPrefab",[In,Ii],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ir))||Ir);U._RF.pop(),U._RF.push({},"98df1dLtHBGpZugQjMIEgSa","EffectManager",void 0);var Im,Ig,Ib,Ik,Iw,IS=$.ccclass,IT=$.property,IC=(Iu=IS("EffectManager"),Ic=IT(Iv),Ih=tj.required,Iu((Id=L((Ip=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"scoreTextAnimPool",Id,N(a)),a}return a(s,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"getScoreTextAnimNode",value:function(){return this.scoreTextAnimPool.getScoreTextAnimNode()}},{key:"handleRunScoreTextAnim",value:(I=B(function(a,o){var C,A,P,I,B,R,E;return _ts_generator(this,function(L){switch(L.label){case 0:if(C=this.getScoreTextAnimNode(),A=td.gameScene.gamePlay.gameUI.header,C.active=!0,!(P=C.getComponent(Il)))return[3,2];return I=o.x,B=o.y,R=o.z,P.node.setWorldPosition(new ei(I,B+80,R)),E=A.challengeBlock.getYourScoreTextWorldPosition(),[4,P.runAnim(a,E)];case 1:L.sent(),L.label=2;case 2:return[2]}})}),function(a,o){return I.apply(this,arguments)})}]),s}(eo)).prototype,"scoreTextAnimPool",[Ic,Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ip))||Ip);U._RF.pop(),U._RF.push({},"ee1dfKzKNNOAKsI1fsIT+5l","GameDataManager",void 0);var IA,I_,IP,II,IB,IR,IE,IL=globalThis.game.player,IO=GameCore.Utils.Json.clone,IN=(Im=tj.required,Ig=tj.required,Ik=L((Ib=function(){function n(){o(this,n),O(this,"defaultData",Ik,this),O(this,"gameData",Iw,this),this.onAfterSetGameData=[]}return a(n,[{key:"init",value:function(){var a,o,C=null!=(a=IL.getGameData())?a:{},A=C.level,P=void 0===A?1:A,I=C.coins,B=C.currentMaxLevel,R=C.items,E=C.dailyChallenge,L=void 0===E?{timeCompleted:0,daysCompleted:0,isTodayCompleted:!1}:E,O=C.timeWatchAdsSuccess,N=C.collectedChapterEndLevel,F=(C.dashboardAnimLevel,C.removeAds),D=C.tournamentsJoined,M=C.isUnlockTourFeature,x=C.dailyMissions,z=C.lastClaimDailyReward,q=IL.getBestScore();P=Math.min(P,t4.MAX_LEVEL),o=Math.max(P,1),this.defaultData={level:P,isFromLoader:!1,coins:void 0===I?10:I,wisdomScore:q,currentMaxLevel:void 0===B?0:B,items:void 0===R?{undo:0,shuffle:0,magicWand:0,return:0,extraSlot:0}:R,dailyChallenge:{timeCompleted:L.timeCompleted,daysCompleted:L.daysCompleted,isTodayCompleted:L.isTodayCompleted},timeWatchAdsSuccess:void 0===O?{rewardScreen:0,shopScreen:{}}:O,collectedChapterEndLevel:void 0===N?0:N,dashboardAnimLevel:o,removeAds:void 0===F?{endTime:0}:F,tournamentsJoined:void 0===D?[]:D,isUnlockTourFeature:void 0!==M&&M,dailyMissions:void 0===x?{timeJoined:0,passLevels:{count:0,isClaimed:!1},useBoosters:{count:0,isClaimed:!1},collectTiles:{count:0,isClaimed:!1},passLevelsInARow:{count:0,isClaimed:!1}}:x,bestEndlessScore:0,levelData:[],pointer:void 0,lastClaimDailyReward:void 0===z?0:z},this.setGameData(this.defaultData),tj.validateRequiredProperties(this,n)}},{key:"getCoins",value:function(){return this.gameData.coins}},{key:"getLevel",value:function(){return this.gameData.level}},{key:"getCurrentMaxLevel",value:function(){return this.gameData.currentMaxLevel}},{key:"getItems",value:function(){return IO(this.gameData.items)}},{key:"getCollectedChapterEndLevel",value:function(){return this.gameData.collectedChapterEndLevel}},{key:"getDashboardAnimLevel",value:function(){return this.gameData.dashboardAnimLevel}},{key:"isUnlockTourFeature",value:function(){return this.gameData.isUnlockTourFeature}},{key:"updateDailyMissionCount",value:function(a){var o=this.getMultiData(["dailyMissions"]).dailyMissions,C=Object.keys(a).map(function(C){var A=a[C];if(A){var P=o[C],I=P.count;if(!P.isClaimed){var B=A(I);if(B!==I)return{mission:C,newCount:B}}}}).filter(function(a){return!!a});if(0!==C.length){var A,P=I({},o),B=E(C);try{for(B.s();!(A=B.n()).done;){var R=A.value,L=R.mission,O=R.newCount;P=I(I({},P),{},x({},L,{count:O,isClaimed:!1}))}}catch(a){B.e(a)}finally{B.f()}this.setGameData({dailyMissions:P})}}},{key:"tryToResetDailyMissionsGameData",value:function(){var a=this.gameData.dailyMissions.timeJoined;0!==a&&GameCore.Utils.Time.isToday(a)||this.setGameData({dailyMissions:{timeJoined:Date.now(),passLevels:{count:0,isClaimed:!1},useBoosters:{count:0,isClaimed:!1},collectTiles:{count:0,isClaimed:!1},passLevelsInARow:{count:0,isClaimed:!1}}})}},{key:"getMultiData",value:function(a){var o,C={},A=E(a);try{for(A.s();!(o=A.n()).done;){var P=o.value;C[P]=IO(this.gameData[P])}}catch(a){A.e(a)}finally{A.f()}return C}},{key:"setGameData",value:function(a){if(a){this.gameData=I(I({},this.gameData),a),game.player.setGameData(this.gameData);var o,C=E(this.onAfterSetGameData);try{for(C.s();!(o=C.n()).done;)(0,o.value)()}catch(a){C.e(a)}finally{C.f()}}}},{key:"setCBAfterSetGameData",value:function(a){this.onAfterSetGameData.push(a)}}]),n}()).prototype,"defaultData",[Im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iw=L(Ib.prototype,"gameData",[Ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ib);U._RF.pop(),U._RF.push({},"5c75ddCpiJIDIEjtw0wVo90","ItemManager",void 0);var IF,ID,IM,Ix,Iz,IG,Iq,IU,IH,IW,IV=(IA=tj.required,I_=tj.required,IP=tj.required,IB=L((II=function(){var C;function n(){o(this,n),O(this,"tileContainer",IB,this),O(this,"tileManager",IR,this),O(this,"footer",IE,this),this.rescued=!1,this.initComponents()}return a(n,[{key:"initComponents",value:function(){this.tileContainer=td.gameScene.gamePlay.tileContainer,this.tileManager=td.gameScene.gamePlay.tileManager,this.footer=td.gameScene.gamePlay.gameUI.footer,tj.validateRequiredProperties(this,n)}},{key:"updateItemStates",value:function(){var a=this.tileContainer.getRealTilesLength(),o=this.tileManager.getLeftTiles().length-a>1;this.footer.toggleUndoButton(a>0),this.footer.toggleShuffleButton(o),this.footer.toggleMagicWandButton(!0)}},{key:"toggleItems",value:function(a){this.footer.toggleItems(a)}},{key:"handleRescue",value:(C=B(function(){var a,o,C,A,P,I,B,R,E;var L=arguments;return _ts_generator(this,function(O){switch(O.label){case 0:o=void 0!==(a=(L.length>0&&void 0!==L[0]?L[0]:{}).buyWithRuby)&&a,td.gameScene.toggleBlockInputContainer(!0),o||this.setRescued(!0),A=(C=td.gameScene.gamePlay).tileManager,P=C.tileContainer,I=td.levelManager.getLevel(),tC(I),tA(I),A.resetTilesOpacity(),P.resetTilesOpacity(),B=Math.min(this.tileContainer.getStackLength(),5),R=td.gameScene.gamePlay.gameUI.footer,E=0,O.label=1;case 1:if(!(E<B))return[3,4];return R.undoItem.useItemWithoutPaying(!0),[4,ts.waitTweenAsync(.27)];case 2:O.sent(),O.label=3;case 3:return E++,[3,1];case 4:return[4,ts.waitTweenAsync(.2)];case 5:return O.sent(),[4,R.shuffleItem.useItemWithoutPaying()];case 6:return O.sent(),td.gameScene.gamePlay.gameUI.header.challengeBlock.resumeTimer(),td.gameScene.toggleBlockInputContainer(!1),this.updateItemStates(),[2]}})}),function(){return C.apply(this,arguments)})},{key:"canShowRescueButton",value:function(){return!this.rescued}},{key:"setRescued",value:function(a){this.rescued=a}},{key:"getRescued",value:function(){return this.rescued}}]),n}()).prototype,"tileContainer",[IA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IR=L(II.prototype,"tileManager",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IE=L(II.prototype,"footer",[IP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),II);U._RF.pop(),U._RF.push({},"36cbeorkRdOj6na0TAIFcx+","TileManager",void 0);var IK,IY,Ij,IX,IJ,IZ,IQ,I$,I0,I1,I2,I3=$.ccclass,I4=$.property,I5=Object.values(t5),I6=(IF=I3("TileManager"),ID=I4(SK),IM=tj.required,Ix=I4(_j),Iz=tj.required,IG=tj.required,IF((IU=L((Iq=function(){var C,A,P,I,L,N,F,D,M,x;function n(){o(this,n),O(this,"parentNode",IU,this),O(this,"tutorialHand",IH,this),O(this,"node",IW,this),this.boardMap={},this.maxLayer=0,this.leftTiles=[],this.magicStickTiles=[],this.numberOfTilesOnBoard=0,this.allTileAmount=0,this.tileTutorial=void 0,this.goldTiles=[]}return a(n,[{key:"getLeftTiles",value:function(){return this.leftTiles}},{key:"initComponents",value:function(a){this.node=a,this.listenEvents(),tj.validateRequiredProperties(this,n)}},{key:"listenEvents",value:function(){this.node.scene.on(t2.TILE_CREATED,this.handleTileLayers,this),this.node.scene.on(t2.TILE_CLICKED,this.handleTileClicked,this),this.node.scene.on(t2.TILE_START_MOVE,this.updateTileStateImmediate,this),this.node.scene.on(t2.TILE_DESTROYED,this.handleTileDestroyed,this),this.node.scene.on(t2.TILE_START_SORT,this.sortOrderTiles,this),this.node.scene.on(t2.TILE_RELEASE,this.handleReleaseTile,this),this.node.scene.on(t2.TILE_OUT_OF_BOARD,this.handleTileOutBoard,this)}},{key:"handleReleaseTile",value:function(a){a.node.setParent(this.parentNode.node,!0),this.parentNode&&a.node.setSiblingIndex(this.parentNode.node.children.length+1)}},{key:"handleTileOutBoard",value:function(){this.numberOfTilesOnBoard--}},{key:"handleTileDestroyed",value:(x=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(-1!==(o=this.leftTiles.indexOf(a))&&this.leftTiles.splice(o,1),0!==this.leftTiles.length)return[3,3];return[4,ts.waitTweenAsync(1)];case 1:return C.sent(),th.playSound(tZ.WIN),[4,td.gameScene.gamePlay.handleGameWin()];case 2:C.sent(),C.label=3;case 3:return[2]}})}),function(a){return x.apply(this,arguments)})},{key:"handleTilesCreated",value:(M=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return this.updateTilesState(),th.playSound(tZ.TILES_LOADING,{volume:.7}),td.gameScene.toggleBlockInputContainer(!0),a=this.getAllTiles(),[4,this.playOpenTilesAnim({tiles:a})];case 1:return o.sent(),this.initializeManagedTiles(a),this.allTileAmount=this.leftTiles.length,this.numberOfTilesOnBoard=this.leftTiles.length,this.node.scene.emit(t2.ALL_TILE_READY),[2]}})}),function(){return M.apply(this,arguments)})},{key:"reopenTiles",value:(D=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return th.playSound(tZ.TILES_LOADING,{volume:.7}),a=this.getAllTiles(),[4,this.playOpenTilesAnim({isReopenTile:!0,tiles:a})];case 1:return o.sent(),this.initializeManagedTiles(a),this.updateTileToReadyState(a),[2]}})}),function(){return D.apply(this,arguments)})},{key:"updateTileToReadyState",value:function(a){var o,C=E(a);try{for(C.s();!(o=C.n()).done;)o.value.switchToReadyState()}catch(a){C.e(a)}finally{C.f()}td.gameScene.gamePlay.handleAllTileReady()}},{key:"playOpenTilesAnim",value:(F=B(function(){var a,o,C,A,P,I,B,R,L,O,N,F,D,M,x;var z=arguments;return _ts_generator(this,function(q){switch(q.label){case 0:if(C=void 0!==(o=(a=z.length>0&&void 0!==z[0]?z[0]:{}).isReopenTile)&&o,P=void 0===(A=a.tiles)?[]:A,!(0!==(I=this.maxLayer+1)))return[3,2];B=t0.ANIMATION_CONFIGS.OPEN_DURATION.TOTAL/I,R=t0.ANIMATION_CONFIGS.OPEN_DURATION.INIT_DELAY,L=[],O=td.gameScene.gamePlay,!C&&O.getIsPlayingTournament()&&this.chooseRandomGoldTiles(),F=E(P);try{for(F.s();!(N=F.n()).done;)M=N.value,x=B*M.getLayer()+R,M.fadeToLightColor(0),L.push(null==(D=M.tileInitTween)?void 0:D.playScaleUpToCurrentAnimation(B,x))}catch(a){F.e(a)}finally{F.f()}return[4,Promise.all(L)];case 1:q.sent(),q.label=2;case 2:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"initializeManagedTiles",value:function(a){var o,C=E(a);try{for(C.s();!(o=C.n()).done;)o.value.handleInitializeTile()}catch(a){C.e(a)}finally{C.f()}}},{key:"closeTiles",value:(N=B(function(){var a,o,C,A,P,I,B,R,L;return _ts_generator(this,function(O){switch(O.label){case 0:if(!(this.boardMap&&0!==Object.keys(this.boardMap).length))return[3,2];if(!(0!==(a=this.maxLayer+1)))return[3,2];C=t0.ANIMATION_CONFIGS.CLOSE_DURATION.TOTAL/a,A=t0.ANIMATION_CONFIGS.CLOSE_DURATION.INIT_DELAY,P=[],I=this.getAllTiles(),B=E(I);try{for(B.s();!(o=B.n()).done;)R=o.value,L=C*(this.maxLayer-R.getLayer())+A,P.push(R.handleCloseTile(C,L))}catch(a){B.e(a)}finally{B.f()}return[4,Promise.all(P)];case 1:O.sent(),O.label=2;case 2:return[2]}})}),function(){return N.apply(this,arguments)})},{key:"closeTilesImmediately",value:function(){if(this.boardMap&&0!==Object.keys(this.boardMap).length&&0!==this.maxLayer+1){var a,o=this.getAllTiles(),C=E(o);try{for(C.s();!(a=C.n()).done;){var A=a.value.getComponent(ea);A&&(A.opacity=0)}}catch(a){C.e(a)}finally{C.f()}}}},{key:"resetTilesOpacity",value:function(){var a,o=this.getAllTiles(),C=E(o);try{for(C.s();!(a=C.n()).done;){var A=a.value.getComponent(ea);A&&(A.opacity=255)}}catch(a){C.e(a)}finally{C.f()}}},{key:"handleTileLayers",value:function(a){var o=a.layerCounter,C=a.tile;void 0!==o&&C&&(this.leftTiles.includes(C)||this.leftTiles.push(C),o>this.maxLayer&&(this.maxLayer=o),this.addTileMap(C,o),C.setActive(!0))}},{key:"addTileMap",value:function(a,o){var C=a.gridPos,A=C.x,P=C.y;this.boardMap["".concat(o)]=this.boardMap["".concat(o)]||{},this.boardMap["".concat(o)]["".concat(P)]=this.boardMap["".concat(o)]["".concat(P)]||{},this.boardMap["".concat(o)]["".concat(P)]["".concat(A)]=a}},{key:"handleTileClicked",value:function(a){this.deleteTile(a)}},{key:"updateTileStateImmediate",value:function(a){this.updateTilesState(!0,a)}},{key:"sortOrderTiles",value:function(a){var o=arguments.length>0&&void 0!==a?a:this.parentNode;if(o){var C,A=o.node.children,P=[],I=E(A);try{for(I.s();!(C=I.n()).done;){var B=C.value.getComponent(ST);B&&B.state!==t1.MOVING_BACK_TO_BOARD&&P.push(B)}}catch(a){I.e(a)}finally{I.f()}P.sort(function(a,o){return a.getDepth()-o.getDepth()});for(var R=0;R<P.length;R++)P[R].node.setSiblingIndex(R)}}},{key:"updateTilesState",value:function(a,o){var C=this,A=arguments.length>0&&void 0!==a&&a,P=arguments.length>1?o:void 0;if(P){var I,B=this.getLowerTileViews(P),R=E(B);try{for(R.s();!(I=R.n()).done;){var L=I.value,O=this.existUpperTilesTileMap(L);L.setActive(!O),A&&L.toggleActive(!O)}}catch(a){R.e(a)}finally{R.f()}}else this.traverseAllTiles(function(a){var o=!1;a.getLayer()<C.maxLayer&&(o=C.existUpperTilesTileMap(a)),a.setActive(!o),A&&a.toggleActive(!o)})}},{key:"getLowerTileViews",value:function(a){for(var o=[],C=a.getLayer()-1;C>=0;C--){for(var A=0,P=0;P<I5.length;P++){var I,B=I5[P],R=a.gridPos.x+B.x,E=a.gridPos.y+B.y;if(this.isTileMapExist(R,E,C)){var L=null==(I=this.boardMap[C])||null==(I=I[E])?void 0:I[R];L&&(o.push(L),this.isCornerOffset(B)&&A++)}}if(A===t6.length)break}return o}},{key:"existUpperTilesTileMap",value:function(a){for(var o=a.gridPos,C=a.getLayer()+1;C<=this.maxLayer;C++)for(var A=0;A<I5.length;A++){var P=I5[A],I=o.x+P.x,B=o.y+P.y;if(this.isTileMapExist(I,B,C))return!0}return!1}},{key:"isCornerOffset",value:function(a){return t6.some(function(o){return o.x===a.x&&o.y===a.y})}},{key:"isTileMapExist",value:function(a,o,C){var A,P=a.toString(),I=o.toString(),B=C.toString();return null==(A=this.boardMap[B])||null==(A=A[I])?void 0:A[P]}},{key:"deleteTile",value:function(a){var o=this.getPosition(a),C=o.x,A=o.y,P=o.z;delete this.boardMap[P][A][C]}},{key:"addTile",value:function(a){var o=this.getPosition(a),C=o.x,A=o.y,P=o.z;this.boardMap[P][A][C]=a}},{key:"getPosition",value:function(a){return{x:a.gridPos.x.toString(),y:a.gridPos.y.toString(),z:a.getLayer().toString()}}},{key:"clearTiles",value:function(a){var o,C=arguments.length>0&&void 0!==a?a:{canTriggerLinkedEvent:!0},A=C.canTriggerLinkedEvent,P=E(this.leftTiles);try{for(P.s();!(o=P.n()).done;){var I=o.value;I&&(I.isCleanData=!A,I.returnToPool())}}catch(a){P.e(a)}finally{P.f()}this.boardMap={},this.leftTiles=[],this.maxLayer=0}},{key:"handleTileReachDesUndo",value:(L=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=this,this.addTile(a),this.updateTilesState(!0,a),a.state=t1.MOVING_BACK_TO_BOARD,th.playSound(tZ.TILE_DROP,{allowMultiple:!0}),[4,a.playReachDestinationUndoAnim().then(function(){a.switchToReadyState(),o.sortOrderTiles()})];case 1:return C.sent(),this.numberOfTilesOnBoard++,[2]}})}),function(a){return L.apply(this,arguments)})},{key:"handleMagicStick",value:(I=B(function(a){var o,C,A,P,I,B,R,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:if(this.magicStickTiles.length>0)return[3,10];if(this.magicStickTiles=a.slice(),o=[],C=-1,a.length>0)C=a[0].id;else{if(!(A=this.findTileHasLargestCount()))return[2];C=A.id,this.magicStickTiles.push(A)}I=this.getAllTiles(),B=E(I),F.label=1;case 1:F.trys.push([1,6,7,8]),B.s(),F.label=2;case 2:if(!!(P=B.n()).done)return[3,5];if(R=P.value,!(this.isTileValidForMagicWand(R)&&(R.isActive&&R.id===C&&!this.magicStickTiles.includes(R)?this.magicStickTiles.push(R):R.id!==C||this.magicStickTiles.includes(R)||o.push(R),3===this.magicStickTiles.length)))return[3,4];return[4,this.moveTileToRack()];case 3:return[2,void F.sent()];case 4:return[3,2];case 5:return[3,8];case 6:return L=F.sent(),B.e(L),[3,8];case 7:return B.f(),[7];case 8:for(O=0,N=this.magicStickTiles.length;N<3;N++)this.magicStickTiles.push(o[O]),O++;return[4,this.moveTileToRack()];case 9:F.sent(),F.label=10;case 10:return[2]}})}),function(a){return I.apply(this,arguments)})},{key:"findTileHasLargestCount",value:function(){var a,o=new Map,C=E(this.leftTiles);try{for(C.s();!(a=C.n()).done;){var A,P=a.value;if(this.isTileValidForMagicWand(P)){if(P.isActive)if(o.has(P.id))null==(A=o.get(P.id))||A.push(P);else o.set(P.id,[P])}}}catch(a){C.e(a)}finally{C.f()}var I,B=-1,R=void 0,L=E(o);try{for(L.s();!(I=L.n()).done;){var O=z(I.value,2),N=(O[0],O[1]);B<N.length&&(B=N.length,R=N[0])}}catch(a){L.e(a)}finally{L.f()}return R}},{key:"isTileValidForMagicWand",value:function(a){return a&&a.state!==t1.DESTROYING&&a.state!==t1.MOVING_TO_CONTAINER&&a.state!==t1.MOVING_BACK_TO_BOARD}},{key:"moveTileToRack",value:(P=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:for(a=0;a<this.magicStickTiles.length;a++)(o=this.magicStickTiles[a])&&(o.toggleActive(!0,.1),this.deleteTile(o));C=0,B.label=1;case 1:if(!(C<this.magicStickTiles.length))return[3,4];if(!((A=this.magicStickTiles[C])&&A.state!==t1.AT_CONTAINER&&A.state!==t1.MOVING_TO_CONTAINER))return[3,3];if(P=A.node.parent)I=P.children.length,A.node.setSiblingIndex(I+1);return A.playMagicWandAnim(),[4,ts.waitTweenAsync(t0.TILE_DELAY_MAGIC_STICK)];case 2:B.sent(),B.label=3;case 3:return C++,[3,1];case 4:return[4,ts.waitTweenAsync(t0.TILE_DELAY_MAGIC_STICK*this.magicStickTiles.length)];case 5:return B.sent(),td.gameScene.gamePlay.vibrate.vibrate(50),this.magicStickTiles=[],[4,ts.waitTweenAsync(.3)];case 6:return B.sent(),3!==this.leftTiles.length&&(td.gameScene.gamePlay.itemManager.updateItemStates(),td.gameScene.gamePlay.logStepProgress()),[2]}})}),function(){return P.apply(this,arguments)})},{key:"handleShuffle",value:(A=B(function(){var a,o,C,A,P,I,B,R;return _ts_generator(this,function(E){switch(E.label){case 0:for(o=(a=this.getAllTiles()).slice(),o=this.shuffleArray(o),C=this.getShuffleConfig(),A=[],P={maxRow:C.maxRowTiles,maxCol:C.maxColTiles,minRow:C.minRowTiles,minCol:C.minColTiles,bonusSpace:C.bonusSpace,maxScale:C.maxScale,offsetHeight:C.offsetHeight},I=0;I<a.length;I++)B=a[I],R=o[I],B.fadeToLightColor(.5),R.fadeToLightColor(.5),this.swapTiles(B,R),A.push(B.playShuffleAnim(P)),A.push(R.playShuffleAnim(P)),B.indexInContainer=-1,R.indexInContainer=-1;return this.sortOrderTiles(),this.updateTilesState(),[4,Promise.all(A)];case 1:return E.sent(),th.playSound(tZ.TILE_DROP,{allowMultiple:!0}),[2]}})}),function(){return A.apply(this,arguments)})},{key:"getShuffleConfig",value:function(){for(var a=td.gameScene.gamePlay.gameObjects,o=eP.getVisibleSize().width,C=a.maxRowTiles,A=a.maxColTiles,P=a.minRowTiles,I=a.minColTiles,B=ST.TILE_SIZE.x,R=ST.TILE_SIZE.y,E=1.2,L=C-P+1,O=o-L*(B+2)*E-10;O<0&&!((E=parseFloat((E-.01).toFixed(2)))<=1);)O=o-L*(B+2)*E-10;var N=a.getExpectedBoardAndRackHeight(),F=C-P+1;return{maxRowTiles:C,maxColTiles:A,minRowTiles:P,minColTiles:I,bonusSpace:2,maxScale:E,offsetHeight:Math.min((N-F*(R+-.48*R))/2/F,20)}}},{key:"getAllTiles",value:function(){var a,o=[],_$n=function(a,o){return Number(a)-Number(o)},C=E(Object.keys(this.boardMap).sort(_$n));try{for(C.s();!(a=C.n()).done;){var A,P=a.value,I=E(Object.keys(this.boardMap[P]).sort(_$n));try{for(I.s();!(A=I.n()).done;){var B,R=A.value,L=E(Object.keys(this.boardMap[P][R]).sort(_$n));try{for(L.s();!(B=L.n()).done;){var O=B.value,N=this.boardMap[P][R][O];o.push(N)}}catch(a){L.e(a)}finally{L.f()}}}catch(a){I.e(a)}finally{I.f()}}}catch(a){C.e(a)}finally{C.f()}return o}},{key:"traverseAllTiles",value:function(a){var o,_$n=function(a,o){return Number(a)-Number(o)},C=E(Object.keys(this.boardMap).sort(_$n));try{for(C.s();!(o=C.n()).done;){var A,P=o.value,I=E(Object.keys(this.boardMap[P]).sort(_$n));try{for(I.s();!(A=I.n()).done;){var B,R=A.value,L=E(Object.keys(this.boardMap[P][R]).sort(_$n));try{for(L.s();!(B=L.n()).done;){var O=B.value;a(this.boardMap[P][R][O])}}catch(a){L.e(a)}finally{L.f()}}}catch(a){I.e(a)}finally{I.f()}}}catch(a){C.e(a)}finally{C.f()}}},{key:"swapTiles",value:function(a,o){var C=this.getPosition(a),A=C.x,P=C.y,I=C.z,B=this.getPosition(o),R=B.x,E=B.y,L=B.z;this.boardMap[I][P][A]=o,this.boardMap[L][E][R]=a,a.swapTileData(o)}},{key:"shuffleArray",value:function(a){var o=a.slice();if(a.length<=1)return o;do for(var C=o.length-1;C>0;C--){var A=Math.floor(Math.random()*(C+1)),P=[o[A],o[C]];o[C]=P[0],o[A]=P[1]}while(this.isEqualArray(a,o));return o}},{key:"isEqualArray",value:function(a,o){if(a.length!==o.length)return!1;for(var C=0;C<a.length;C++)if(a[C]===o[C])return!0;return!1}},{key:"getLengthLeftTiles",value:function(){return this.leftTiles.length}},{key:"getTileTutorial",value:function(a){var o,C,A=arguments.length>0&&void 0!==a?a:0,P=[{tX:"-2",tY:"0",tZ:"0"},{tX:"0",tY:"0",tZ:"0"},{tX:"2",tY:"0",tZ:"0"}][A],I=P.tX,B=P.tY,R=P.tZ;if(null==(o=this.boardMap[R])||null==(o=o[B])||!o[I]){if(2===A)return;return this.getTileTutorial(A+1)}return null==(C=this.boardMap[R])||null==(C=C[B])?void 0:C[I]}},{key:"resetTileTutorial",value:function(){this.tileTutorial=void 0}},{key:"setUpTutorialHand",value:function(){var a=this.getTileTutorial();this.tileTutorial!==a&&(a?(this.tileTutorial=a,this.tutorialHand.node.setPosition(a.node.position),this.tutorialHand.node.setSiblingIndex(1e4),this.tutorialHand.playAnimationTutorialHand()):this.tutorialHand.stopAnimationTutorialHand())}},{key:"chooseRandomGoldTiles",value:function(){var a,o=this.getAllTiles(),C={},A=E(o);try{for(A.s();!(a=A.n()).done;){var P=a.value;C[P.id]||(C[P.id]=[]),C[P.id].push(P)}}catch(a){A.e(a)}finally{A.f()}for(var I in C)C[I].sort(function(){return Math.random()-.5});var B=Object.values(C).sort(function(){return Math.random()-.5}),L=[];for(var O in B)if(B[O].length>=6){L.push.apply(L,R(B[O].slice(0,6)));break}if(L.length<6){var N=[];for(var F in C)C[F].length>=3&&N.push(C[F].slice(0,3));N.length>=2&&L.push.apply(L,R(N[0]).concat(R(N[1])))}for(var D=0;D<L.length;D++){var M=L[D];this.goldTiles.push(M),M.id=33;var x=td.gameScene.gamePlay.loader.getGoldTileIcon();M.toggleBackground(!1),x&&M.setItemSprite(x)}}},{key:"resetGoldTiles",value:function(){this.goldTiles=[]}},{key:"checkIsGoldTile",value:function(a){return this.goldTiles.includes(a)}},{key:"handleGoldTileClicked",value:(C=B(function(a){var o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(!this.checkIsGoldTile(a))return[3,2];if((o=td.gameScene.gamePlay.gameUI.header).tournamentChallengeBlock.updateScore(),!(C=this.parentNode.createGoldTileInstance()))return[3,2];if(C.setPosition(a.node.position),!(A=C.getComponent(TU)))return[3,2];return A.setSize(a.currentSize.x,a.currentSize.y),A.node.setSiblingIndex(1e4),A.node.setScale(a.node.scale),this.goldTiles.splice(this.goldTiles.indexOf(a),1),P=o.tournamentChallengeBlock.getScore(),[4,A.playCollectAnim(P)];case 1:I.sent(),P>=6?th.playSound(tZ.ALL_MISSION_DONE,{volume:.55}):th.playSound(tZ.MISSION_COMPLETED,{volume:.55,allowMultiple:!0}),td.gameScene.gamePlay.vibrate.vibrate(50),td.gameScene.gamePlay.gameObjects.goldTilePool.returnGoldTile(C),I.label=2;case 2:return[2]}})}),function(a){return C.apply(this,arguments)})},{key:"getBoardMap",value:function(){return this.boardMap}},{key:"stopAllTileAnimations",value:function(){this.traverseAllTiles(function(a){a.tilePointerTween.stop()})}}]),n}()).prototype,"parentNode",[ID,IM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IH=L(Iq.prototype,"tutorialHand",[Ix,Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IW=L(Iq.prototype,"node",[IG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iq))||Iq);U._RF.pop(),U._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var I7,I8=$.ccclass,I9=$.property,Be=$.disallowMultiple,Bt=GameCore.Events,Bn=globalThis.game.event,Bi=(IK=I8("BaseScreen"),IY=I9(ee),Ij=tj.required,IX=I9(ee),IJ=tj.required,IZ=tj.required,IK(IQ=Be((I0=L((I$=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"container",I0,N(a)),O(a,"backgroundMask",I1,N(a)),O(a,"animation",I2,N(a)),a.data={},a}return a(r,[{key:"__preload",value:function(){this.animation=this.getComponent(es),this.validateRequiredComponents()}},{key:"initializeNodes",value:function(){var a=this.getMaskOpacity(),o=this.getContainerOpacity();a&&o&&(a.opacity=0,o.opacity=0)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this)}},{key:"open",value:function(a){var o=this;a&&(this.data=a),this.animation.once(es.EventType.PLAY,function(){o.show()}),Bn.emit(Bt.OPENED_SCREEN,{screenName:this.node.name,screenData:this.data}),this.runAnimation("OpenScreen")}},{key:"close",value:function(){var a=this;this.node.active&&(this.animation.once(es.EventType.FINISHED,function(){Bn.emit(Bt.CLOSED_SCREEN,{screenName:a.node.name}),a.hide()}),this.runAnimation("CloseScreen"))}},{key:"runAnimation",value:function(a){if(!this.isAnimationExist(a))throw new Error("".concat(this.node.name,": Animation component must have ").concat(a," clip"));this.animation.play(a)}},{key:"isAnimationExist",value:function(a){return this.animation.clips.some(function(o){return!(!o||o.name!==a)})}},{key:"getMaskOpacity",value:function(){return this.backgroundMask.getComponent(ea)||null}},{key:"getContainerOpacity",value:function(){return this.container.getComponent(ea)||null}},{key:"show",value:function(){this.node.active=!0}},{key:"hide",value:function(){this.node.active=!1}}]),r}(eo)).prototype,"container",[IY,Ij],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I1=L(I$.prototype,"backgroundMask",[IX,IJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I2=L(I$.prototype,"animation",[IZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IQ=I$))||IQ)||IQ);U._RF.pop(),U._RF.push({},"17f98PO2x5LEptPQQJA88TN","GlowDot",void 0);var Br,Ba,Bo,Bs,Bl,Bu,Bc,Bh,Bp,Bd,Bf,By,Bv,Bm,Bg=(0,$.ccclass)("GlowDot")(I7=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).dotsChild=[],a.dotsTween=[],a}return a(r,[{key:"__preload",value:function(){this.init()}},{key:"init",value:function(){for(var a=0;a<this.node.children.length;a++)this.dotsChild.push(this.node.children[a])}},{key:"prepareGlow",value:function(){for(var a=0;a<this.dotsChild.length;a++){this.dotsChild[a].scale=new ei(0,0,0);var o=this.dotsChild[a].getComponent(ea);o&&(o.opacity=0)}}},{key:"runGlow",value:function(){for(var a=0;a<this.dotsChild.length;a++){var o=this.dotsChild[a],C=(1e3*Math.random()+1e3)/1e3,A=1e3*Math.random()/1e3,P=o.getComponent(ea);if(P){var I=Y(o).delay(A).to(C,{scale:new ei(1,1,1)},{easing:"sineInOut"}).to(C,{scale:new ei(0,0,0)},{easing:"sineInOut"}).union().repeatForever().start(),B=Y(P).delay(A).to(C,{opacity:255},{easing:"sineInOut"}).to(C,{opacity:0},{easing:"sineInOut"}).union().repeatForever().start();this.dotsTween.push(I,B)}}}},{key:"stopGlow",value:function(){for(var a=0;a<this.dotsTween.length;a++)this.dotsTween[a].stop()}}]),r}(eo))||I7;U._RF.pop(),U._RF.push({},"aedfas0cHlKz6QlJPIe7Vz5","ContainerNoMoreMove",void 0);var Bb,Bk,Bw,BS,BT,BC,BA,B_,BP,BI,BB,BR,BE,BL,BO,BN,BF,BD,BM,Bx,Bz=$.ccclass,BG=$.property,Bq=(Br=Bz("ContainerNoMoreMove"),Ba=BG(ef),Bo=BG(ef),Bs=BG(ef),Bl=BG(ef),Bu=BG(Bg),Bc=BG(ee),Br((Bp=L((Bh=function(P){C(v,P);var I,R,E,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"closeButton",Bp,N(a)),O(a,"continueButton",Bd,N(a)),O(a,"watchAdButton",Bf,N(a)),O(a,"replayButton",By,N(a)),a.watchAdButtonTween=null,a.uiOpacity=void 0,O(a,"glowDot",Bv,N(a)),O(a,"groupItems",Bm,N(a)),a.tweens=[],a}return a(v,[{key:"__preload",value:function(){this.initComponents(),this.setUpBubbleButton()}},{key:"initComponents",value:function(){this.uiOpacity=this.node.getComponent(ea),this.validateRequiredComponents()}},{key:"setUpBubbleButton",value:function(){this.watchAdButtonTween=ti(this.watchAdButton.node);var a=this.watchAdButton.node.getComponent(az);a&&this.watchAdButtonTween&&(a.animationUp=this.watchAdButtonTween)}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"onClickCloseButton",set:function(a){this.closeButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickContinueButton",set:function(a){this.continueButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickWatchAdButton",set:function(a){this.watchAdButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickReplayButton",set:function(a){this.replayButton.node.on(ef.EventType.CLICK,a,this)}},{key:"prepareFadeIn",value:function(){this.stopAdButtonAnim(),this.uiOpacity.opacity=100,this.node.scale=new ei(.5,.5,1),this.continueButton.node.scale=ei.ZERO,this.watchAdButton.node.scale=ei.ZERO,this.replayButton.node.scale=ei.ZERO,this.setNodeOpacity(this.continueButton.node,255),this.setNodeOpacity(this.watchAdButton.node,255),this.setNodeOpacity(this.replayButton.node,255)}},{key:"setupButtonsBasedOnRuby",value:(M=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return this.watchAdButton.node.active=!0,this.continueButton.node.active=a,this.replayButton.node.active=!a,[4,this.playShowLevelButtonAnim()];case 1:return o.sent(),[2]}})}),function(a){return M.apply(this,arguments)})},{key:"fadeIn",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.glowDot.prepareGlow(),[4,this.playFadeInContainerAnim()];case 1:return a.sent(),[4,this.playShowLevelButtonAnim()];case 2:return a.sent(),this.glowDot.runGlow(),this.runAdButtonBubbleAnim(),this.runShakeAnimation(),[2]}})}),function(){return D.apply(this,arguments)})},{key:"prepareFadeOut",value:function(){this.setNodeOpacity(this.watchAdButton.node,150),this.setNodeOpacity(this.continueButton.node,150),this.setNodeOpacity(this.replayButton.node,150)}},{key:"fadeOut",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.playFadeOutContainerAnim()];case 1:return a.sent(),this.glowDot.stopGlow(),this.stopShakeAnimation(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"runAdButtonBubbleAnim",value:function(){this.watchAdButtonTween&&this.watchAdButtonTween.start()}},{key:"stopAdButtonAnim",value:function(){this.watchAdButtonTween&&(this.watchAdButtonTween.stop(),this.watchAdButton.node.setScale(1,1,1))}},{key:"toggleAdFunction",value:function(a){this.watchAdButton.node.active=a}},{key:"playFadeInContainerAnim",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return Y(this.uiOpacity).to(.25,{opacity:255},{easing:"smooth"}).start(),Y(this.node).to(.3,{scale:new ei(1,1,1)},{easing:"backOut"}).start(),[4,ts.waitTweenAsync(.1)];case 1:return a.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"playFadeOutContainerAnim",value:(E=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=Y(this.node).to(.3,{scale:new ei(.5,.5,.5)},{easing:"backIn"}),o=Y(this.uiOpacity).to(.25,{opacity:0},{easing:"smooth"}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:return C.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"playShowLevelButtonAnim",value:(R=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(a=[],this.continueButton.node.active)o=Y(this.continueButton.node).to(.25,{scale:new ei(1,1,1)},{easing:"backOut"}),a.push(ts.runTweenAsync(o));if(this.watchAdButton.node.active)C=Y(this.watchAdButton.node).to(.25,{scale:new ei(1,1,1)},{easing:"backOut"}),a.push(ts.runTweenAsync(C));if(this.replayButton.node.active)A=Y(this.replayButton.node).to(.25,{scale:new ei(1,1,1)},{easing:"backOut"}),a.push(ts.runTweenAsync(A));return[4,Promise.all(a)];case 1:return P.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"setNodeOpacity",value:function(a,o){var C=a.getComponent(ea);C&&(C.opacity=o)}},{key:"runShakeAnimation",value:(I=B(function(){var a,o,C;function i(a){return Y(a).to(C,{angle:15}).to(C,{angle:-30}).to(C,{angle:30}).to(C,{angle:-15}).to(C,{angle:0}).delay(3).union().repeatForever().start()}return _ts_generator(this,function(A){if(a=this.groupItems.getChildByName("Undo"),o=this.groupItems.getChildByName("Shuffle"),a&&o)C=.125,this.tweens.push(i(a)),this.tweens.push(i(o));return[2]})}),function(){return I.apply(this,arguments)})},{key:"stopShakeAnimation",value:function(){var a=this.groupItems.getChildByName("Undo"),o=this.groupItems.getChildByName("Shuffle");if(a&&o){a.angle=0,o.angle=0;for(var C=0;C<this.tweens.length;C++)this.tweens[C].stop()}}}]),v}(eo)).prototype,"closeButton",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=L(Bh.prototype,"continueButton",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bf=L(Bh.prototype,"watchAdButton",[Bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=L(Bh.prototype,"replayButton",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv=L(Bh.prototype,"glowDot",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bm=L(Bh.prototype,"groupItems",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bh))||Bh);U._RF.pop(),U._RF.push({},"86312KxAYtBSaIZlKgtoEaM","NoMoreMoveScreen",void 0);var BU,BH,BW,BV,BK,BY,Bj,BX,BJ,BZ,BQ,B$=$.ccclass,B0=$.property,B1=GameCore,B2=B1.Events,B3=B1.Utils,B4=globalThis.game.event,B5="NO_MORE_MOVES_SCREEN",B6=(Bb=B$("NoMoreMoveScreen"),Bk=B0(ef),Bw=tj.required,BS=B0(Bq),BT=tj.required,BC=B0(ee),BA=tj.required,B_=B0(ee),BP=tj.required,BI=tj.required,BB=tj.required,BR=tj.required,Bb((BL=L((BE=function(P){C(v,P);var I,R,E,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"touchZone",BL,N(a)),O(a,"container",BO,N(a)),O(a,"background",BN,N(a)),O(a,"purpleBackground",BF,N(a)),O(a,"baseScreen",BD,N(a)),O(a,"bgUIOpacity",BM,N(a)),O(a,"purpleBgUIOpacity",Bx,N(a)),a.watchedFullAd=!1,a.enableCloseOnTouch=!0,a.isPressedHome=!1,a.handleOpeningScreen=function(o){a.validateEventPayload(o)&&(a.updateScreenData(o),a.prepareFadeIn(),a.watchedFullAd=!1)},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(v,[{key:"__preload",value:function(){this.listenScreenEvents(),this.registryButtonEvents(),this.baseScreen=this.node.getComponent("BaseScreen"),this.baseScreen.open=this.open.bind(this),this.baseScreen.close=this.close.bind(this),this.bgUIOpacity=this.background.getComponent(ea),this.purpleBgUIOpacity=this.purpleBackground.getComponent(ea),this.validateRequiredComponents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onEnable",value:function(){var a=td.gameScene.background.getCurrentBackground(),o=this.background.getComponent(W);a&&o&&(o.spriteFrame=a)}},{key:"open",value:(M=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return a&&(this.baseScreen.data=a),o=this.canAffordRevive(),this.container.setupButtonsBasedOnRuby(o),th.playSound(tZ.FAIL),[4,Promise.all([this.fadeInBg(),this.container.fadeIn()])];case 1:return C.sent(),this.isPressedHome=!1,B4.emit(B2.OPENED_SCREEN,{screenName:this.node.name,screenData:this.baseScreen.data}),B4.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(a){return M.apply(this,arguments)})},{key:"close",value:(D=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(!this.node.active)return[3,2];return this.watchedFullAd||this.resetPassLevelInRowDailyMissions(),this.container.prepareFadeOut(),(a=[]).push(this.container.fadeOut()),a.push(this.fadeOutBg()),this.isPressedHome&&(th.playMusic(tZ.DASHBOARD_MUSIC),a.push(td.gameScene.gamePlay.switchFromNMMToDashboard())),[4,Promise.all(a)];case 1:o.sent(),B4.emit(B2.CLOSED_SCREEN,{screenName:this.node.name}),this.node.active=!1,B4.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),o.label=2;case 2:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"prepareFadeIn",value:function(){this.bgUIOpacity.opacity=0,this.purpleBgUIOpacity.opacity=0,this.container.prepareFadeIn()}},{key:"fadeOutBg",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=Y(this.bgUIOpacity).to(.25,{opacity:0}),o=Y(this.purpleBgUIOpacity).to(.25,{opacity:0}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:return C.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"fadeInBg",value:(L=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=Y(this.bgUIOpacity).to(.25,{opacity:255}),o=Y(this.purpleBgUIOpacity).to(.25,{opacity:175}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:return C.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"registryButtonEvents",value:function(){var a=this;this.container.onClickContinueButton=function(){a.handleClickedContinue()},this.container.onClickWatchAdButton=function(){a.handleClickedWatchAd()},this.container.onClickCloseButton=function(){a.handleClickedRetry()},this.container.onClickReplayButton=function(){a.handleClickedRetry()}}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,v)}},{key:"listenScreenEvents",value:function(){B4.on(B2.OPENING_SCREEN,this.handleOpeningScreen),B4.on(B2.CLOSING_SCREEN,this.handleClosingScreen),this.node.scene.on(t2.CLAIM_COIN_SUCCEEDED,this.setupContinueButton,this)}},{key:"unListenScreenEvents",value:function(){B4.off(B2.OPENING_SCREEN,this.handleOpeningScreen),B4.off(B2.CLOSING_SCREEN,this.handleClosingScreen),this.node.scene.off(t2.CLAIM_COIN_SUCCEEDED,this.setupContinueButton,this)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"updateScreenData",value:function(a){var o=a.screenData;B3.Valid.isObject(o)&&(o.duration&&o.duration>0&&this.scheduleOnce(function(){t_.closeScreen(tP.NO_MORE_MOVE_SCREEN)},o.duration),!1===o.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0)}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),this.container.fadeOut()}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}},{key:"handleClickedRetry",value:(E=B(function(){var a,o,C,A,P,I,B,R;return _ts_generator(this,function(E){switch(E.label){case 0:if(td.gameScene.toggleBlockInputContainer(!0),td.gameScene.setIsFirstWin(!1),td.gameScene.restartLevel(),a=window.game.match.getMatchState().mode,C=(o=td.gameScene.gamePlay.tileManager).allTileAmount,A=o.numberOfTilesOnBoard,P=td.levelManager.getLevel(),(I=td.gameScene.gamePlay).stepLogHandler.logAllRemainingSteps(),tB(P,!1,C-A),B=I.gameDataManager.getLevel(),!("single"!==a))return[3,2];return[4,tf.showInterstitialAdAsync2(B5,{forLevel:B})];case 1:E.sent(),E.label=2;case 2:return td.gameScene.gamePlay.tileManager.clearTiles({canTriggerLinkedEvent:!1}),R=td.gameScene.gamePlay.gameUI.header,[4,t_.closeScreenAsync(tP.NO_MORE_MOVE_SCREEN)];case 3:switch(E.sent(),this.baseScreen.runAnimation("CloseScreen"),a){case"challenge-friend":R.clearChallengeBlockScore()}return[4,td.gameScene.gamePlay.handleGameRetry()];case 4:return E.sent(),td.gameScene.uiManager.setCurrentScreen(null),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedContinue",value:(R=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return a=td.gameScene.gamePlay,o=td.gameScene.uiManager,C=a.gameDataManager.getMultiData(["coins"]),C.coins-=300,a.gameDataManager.setGameData(C),td.gameScene.rubyBarComp.setRubyAmountWithAnimation(C.coins),td.gameScene.toggleBlockInputContainer(!0),[4,Promise.all([t_.closeScreenAsync(tP.NO_MORE_MOVE_SCREEN),a.gameUI.fadeInGameScreen({reOpenTiles:!1,rackFadeInInstantly:!0}),a.itemManager.handleRescue({buyWithRuby:!0})])];case 1:return A.sent(),this.baseScreen.runAnimation("CloseScreen"),this.addItemsAfterWatchAdOrBuyWithRuby(),o.setCurrentScreen(null),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"handleClickedWatchAd",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,tf.showRewardVideoAdAsync2(B5)];case 1:if(!o.sent())return[3,3];return this.watchedFullAd=!0,td.gameScene.toggleBlockInputContainer(!0),a=td.gameScene.gamePlay,[4,Promise.all([t_.closeScreenAsync(tP.NO_MORE_MOVE_SCREEN),a.gameUI.fadeInGameScreen({reOpenTiles:!1,rackFadeInInstantly:!0}),td.gameScene.gamePlay.itemManager.handleRescue()])];case 2:return o.sent(),this.baseScreen.runAnimation("CloseScreen"),this.addItemsAfterWatchAdOrBuyWithRuby(),td.gameScene.uiManager.setCurrentScreen(null),td.gameScene.toggleBlockInputContainer(!1),[3,4];case 3:this.container.runAdButtonBubbleAnim(),o.label=4;case 4:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"resetPassLevelInRowDailyMissions",value:function(){td.gameScene.gamePlay.updateDailyMissionCount({passLevelsInARow:function(){return 0}})}},{key:"addItemsAfterWatchAdOrBuyWithRuby",value:function(){var a=td.gameScene.gamePlay.gameDataManager,o=a.getItems();o.undo+=1,o.shuffle+=1,a.setGameData({items:o})}},{key:"setupContinueButton",value:function(){if(this.node.active){var a=this.canAffordRevive();this.container.setupButtonsBasedOnRuby(a)}}},{key:"canAffordRevive",value:function(){var a=td.gameScene.gamePlay.gameDataManager,o=a.getCoins(),C=a.getLevel();return o>=300&&C>=t4.LEVEL_OPEN_COIN_PANEL}}]),v}(eo)).prototype,"touchZone",[Bk,Bw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=L(BE.prototype,"container",[BS,BT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BN=L(BE.prototype,"background",[BC,BA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BF=L(BE.prototype,"purpleBackground",[B_,BP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=L(BE.prototype,"baseScreen",[BI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=L(BE.prototype,"bgUIOpacity",[BB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bx=L(BE.prototype,"purpleBgUIOpacity",[BR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE))||BE);U._RF.pop(),U._RF.push({},"04563jgqHdAKYgvhNPwV0JS","LeafRise",void 0);var B7=$.ccclass,B8=$.property,B9=(BU=B7("LeafRise"),BH=B8(pj),BW=tj.required,BV=B8(pj),BK=tj.required,BY=B8(pj),Bj=tj.required,BU((BJ=L((BX=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"RightLeaf",BJ,N(a)),O(a,"LeftLeaf",BZ,N(a)),O(a,"BrightEmitters",BQ,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"playParticle",value:function(){this.RightLeaf.play(),this.LeftLeaf.play(),this.BrightEmitters.play()}},{key:"stopParticle",value:function(){this.RightLeaf.stop(),this.LeftLeaf.stop(),this.BrightEmitters.stop()}}]),r}(eo)).prototype,"RightLeaf",[BH,BW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BZ=L(BX.prototype,"LeftLeaf",[BV,BK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BQ=L(BX.prototype,"BrightEmitters",[BY,Bj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BX))||BX);U._RF.pop(),U._RF.push({},"289a5e1LmpHoLivf5/k78gO","TimeUtils",void 0);var Re,Rt,Rn,Ri,Rr,Ra,Ro,Rs=function(){function n(){o(this,n)}return a(n,null,[{key:"getStandardTimeFormat",value:function(a){var o=n.defaultFormat;if(a<=0)return o;var C=a,A=Math.floor(C/3600);var P=Math.floor((C%=3600)/60);C%=60;var I=A.toString().padStart(2,"0"),B=P.toString().padStart(2,"0"),R=C.toString().padStart(2,"0");return"".concat(I,":").concat(B,":").concat(R)}}]),n}();Rs.defaultFormat="00:00:00",U._RF.pop(),U._RF.push({},"25d7atiqSNO3qgRiQjBQlTz","LevelBlockComponent",void 0);var Rl,Ru,Rc,Rh,Rp,Rd,Rf,Ry,Rv,Rm,Rg=$.ccclass,Rb=$.property,Rk=(Re=Rg("LevelBlockComponent"),Rt=Rb(ee),Rn=tj.required,Ri=tj.required,Re((Ra=L((Rr=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"clickableNode",Ra,N(a)),O(a,"levelBlockParent",Ro,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"setLevelBlockParent",value:function(a){this.levelBlockParent&&this.unRegisterEvents(),this.levelBlockParent=a,this.registerEvents()}},{key:"registerEvents",value:function(){this.clickableNode.on(ee.EventType.TOUCH_START,this.onTouchStart,this),this.clickableNode.on(ee.EventType.TOUCH_END,this.onTouchEnd,this),this.clickableNode.on(ee.EventType.TOUCH_CANCEL,this.onTouchCancel,this)}},{key:"unRegisterEvents",value:function(){this.clickableNode.off(ee.EventType.TOUCH_START,this.onTouchStart,this),this.clickableNode.off(ee.EventType.TOUCH_END,this.onTouchEnd,this),this.clickableNode.off(ee.EventType.TOUCH_CANCEL,this.onTouchCancel,this)}},{key:"onTouchStart",value:function(a){this.levelBlockParent.emit(ee.EventType.TOUCH_START,a)}},{key:"onTouchEnd",value:function(a){this.levelBlockParent.emit(ee.EventType.TOUCH_END,a)}},{key:"onTouchCancel",value:function(a){this.levelBlockParent.emit(ee.EventType.TOUCH_CANCEL,a)}}]),r}(eo)).prototype,"clickableNode",[Rt,Rn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=L(Rr.prototype,"levelBlockParent",[Ri],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rr))||Rr);U._RF.pop(),U._RF.push({},"659ab8K0WlCpbh06HONJ4qP","GiftGlowBlock",void 0);var Rw,RS,RT,RC,RA,R_=$.ccclass,RP=$.property,RI=(Rl=R_("GiftGlowBlock"),Ru=RP(ee),Rc=tj.required,Rh=RP(Pw),Rp=tj.required,Rd=tj.required,Rl((Ry=L((Rf=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"giftBlock",Ry,N(a)),O(a,"fairyFlyEffect",Rv,N(a)),O(a,"uiTransform",Rm,N(a)),a.waveTween=null,a.giftAppearTween=null,a.originalGiftBlockPosition=null,a}return a(s,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(en),this.setOriginalGiftBlockPosition(),tj.validateRequiredProperties(this,s)}},{key:"setOriginalGiftBlockPosition",value:function(){this.originalGiftBlockPosition||(this.originalGiftBlockPosition=this.giftBlock.position.clone())}},{key:"prepareGiftBlock",value:function(){this.node.active=!0,this.stopAnims(),this.node.setPosition(0,46.04),this.node.removeFromParent()}},{key:"playAppearAnimation",value:(I=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(a=this,!(!this.giftAppearTween&&(this.setOriginalGiftBlockPosition(),this.originalGiftBlockPosition)))return[3,2];return C=(o=this.originalGiftBlockPosition).x,A=o.y,P=o.z,this.giftBlock.setPosition(C,A-90,P),this.giftBlock.setScale(0,0,0),this.giftAppearTween=Y(this.giftBlock).to(.5,{scale:new ei(1,1,1),position:new ei(C,A,P)},{easing:"cubicOut"}).call(function(){a.playWaveAnimation(),a.fairyFlyEffect.isEffectPlaying()||a.fairyFlyEffect.playEffect()}),[4,ts.runTweenAsync(this.giftAppearTween)];case 1:I.sent(),I.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"playWaveAnimation",value:function(){if(!this.waveTween&&this.originalGiftBlockPosition){var a=this.originalGiftBlockPosition,o=a.x,C=a.y,A=a.z,P=Y(this.giftBlock).to(1.1,{position:new ei(o,C+7,A)},{easing:tn}),I=Y(this.giftBlock).to(1.1,{position:new ei(o,C-7,A)},{easing:tn});this.waveTween=Y(this.giftBlock).sequence(I,Y().delay(.2),P).repeatForever().start()}}},{key:"stopAnims",value:function(){var a,o;null==(a=this.waveTween)||a.stop(),null==(o=this.giftAppearTween)||o.stop(),this.fairyFlyEffect.stopEffect(),this.waveTween=null,this.giftAppearTween=null}},{key:"isVisible",value:function(){var a=this.giftBlock.getWorldPosition().y,o=eP.getVisibleSize().height,C=this.uiTransform.contentSize.height,A=tf.getBannerAdWorldHeight();return a<o+C/2&&a>0-C/2+A}}]),s}(Rk)).prototype,"giftBlock",[Ru,Rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rv=L(Rf.prototype,"fairyFlyEffect",[Rh,Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rm=L(Rf.prototype,"uiTransform",[Rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf))||Rf);U._RF.pop(),U._RF.push({},"2b7f7FtltVHaIXoSYvYuiKM","GiftBlockPool",void 0);var RB,RR,RE,RL,RO,RN,RF,RD,RM,Rx,Rz,RG,Rq=$.ccclass,RU=$.property,RH=(Rw=Rq("GiftBlockPool"),RS=RU(eY),RT=tj.required,Rw((RA=L((RC=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"giftBlockPrefab",RA,N(a)),a.giftBlocks=[],a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"getAvailableGiftBlock",value:function(){var a=this.giftBlocks.find(function(a){return!a.node.active});return a?a.node.active=!0:(a=this.createGiftBlock(),this.giftBlocks.push(a)),a}},{key:"releaseGiftBlock",value:function(a){a.node.active=!1}},{key:"createGiftBlock",value:function(){var a=ej(this.giftBlockPrefab).getComponent(RI);if(!a)throw new Error("GiftGlowBlock component is not defined");return a}},{key:"getActiveGiftBlocks",value:function(){return this.giftBlocks.filter(function(a){return a.node.active})}},{key:"handleActiveGifts",value:function(a){var o,C=E(this.giftBlocks);try{for(C.s();!(o=C.n()).done;){var A=o.value;A.node.active&&a(A)}}catch(a){C.e(a)}finally{C.f()}}}]),r}(eo)).prototype,"giftBlockPrefab",[RS,RT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RC))||RC);U._RF.pop(),U._RF.push({},"8a9df0UnatOEYGLvGFIs3E5","Stamp",void 0);var RW,RV,RK,RY,Rj,RX=$.ccclass,RJ=$.property,RQ=(RB=RX("Stamp"),RR=RJ(W),RE=tj.required,RL=RJ(ee),RO=tj.required,RN=tj.required,RF=tj.required,RB((RM=L((RD=function(P){C(d,P);var I,R,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"stampSprite",RM,N(a)),O(a,"stampLoading",Rx,N(a)),O(a,"textStamp",Rz,N(a)),O(a,"uiTransform",RG,N(a)),a.waveTween=null,a.stampAppearTween=null,a.originalStampPosition=new ei,a.dotStamp=[],a.originalDotStampPosition=[],a.dotStampTweens=[],a.textTween=void 0,a.previousReject=void 0,a}return a(d,[{key:"__preload",value:function(){this.originalStampPosition=this.node.position.clone(),this.uiTransform=this.getComponent(en),this.setUpLoadingStampNode(),tj.validateRequiredProperties(this,d)}},{key:"setUpLoadingStampNode",value:function(){if(this.stampLoading)for(var a=0;a<this.stampLoading.children.length;a++)if(this.stampLoading.children[a].name.includes("dot")){var o=this.stampLoading.children[a];this.dotStamp.push(o),this.originalDotStampPosition.push(o.position.clone())}else this.textStamp=this.stampLoading.children[a]}},{key:"resetLoadingStampNode",value:function(){this.stopDotStampAnimation(),this.stopTextLoadingAnimation();for(var a=0;a<this.dotStamp.length;a++)this.dotStamp[a].setPosition(this.originalDotStampPosition[a])}},{key:"resetToOriginalPosition",value:function(){var a=this.originalStampPosition,o=a.x,C=a.y,A=a.z;this.node.setPosition(o,C,A)}},{key:"playAppearAnimation",value:(L=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(a=this,!!this.stampAppearTween)return[3,2];return C=(o=this.originalStampPosition).x,A=o.y,P=o.z,this.node.setPosition(C,A-70,P),this.node.scale=ei.ZERO,this.stampAppearTween=Y(this.node).to(.5,{scale:new ei(1,1,1),position:new ei(C,A,P)},{easing:"cubicOut"}).call(function(){a.playWaveAnimation()}),[4,ts.runTweenAsync(this.stampAppearTween)];case 1:I.sent(),I.label=2;case 2:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"playWaveAnimation",value:function(){if(!this.waveTween){var a=this.originalStampPosition,o=a.x,C=a.y,A=a.z,P=Y(this.node).to(1.1,{position:new ei(o,C+7,A)},{easing:tn}),I=Y(this.node).to(1.1,{position:new ei(o,C-7,A)},{easing:tn});this.waveTween=Y(this.node).sequence(I,Y().delay(.2),P).repeatForever().start()}}},{key:"stopAnims",value:function(a){var o,C,A=arguments.length>0&&void 0!==a?a:{},P=A.resetAppear;null==(o=this.waveTween)||o.stop(),null==(C=this.stampAppearTween)||C.stop(),this.waveTween=null,(void 0===P||P)&&(this.stampAppearTween=null)}},{key:"setBackgroundStamp",value:function(a){this.stampSprite.spriteFrame=a}},{key:"toggleChildrenStampBlock",value:function(a){var o,C=this.node.children,A=E(C);try{for(A.s();!(o=A.n()).done;)o.value.active=a}catch(a){A.e(a)}finally{A.f()}}},{key:"playLoadingAnimation",value:function(){this.resetLoadingStampNode(),this.playDotStampAnimation(),this.playTextLoadingAnimation()}},{key:"stopLoadingAnimation",value:function(){var a=this;this.resetLoadingStampNode();var o=this.stampLoading.getComponent(ea);o&&(Y(o).to(.5,{opacity:0},{easing:"cubicOut"}).call(function(){a.setActiveStateStampLoading(!1)}).start(),this.stopDotStampAnimation(),this.stopTextLoadingAnimation())}},{key:"playDotStampAnimation",value:function(){for(var a=this,o=0;o<this.dotStamp.length;o++)(function(){var C=a.dotStamp[o],A=C.position.clone(),P=A.x,I=A.y,B=A.z,R=Y(C).delay(.2*o).to(1,{position:new ei(P,I+3,B)},{easing:"cubicOut"}).call(function(){var o=Y(C).to(.5,{position:new ei(P,I-3,B)},{easing:"cubicOut"}).to(.5,{position:new ei(P,I+3,B)},{easing:"cubicOut"}).union().repeatForever().start();a.dotStampTweens.push(o),a.dotStampTweens.push(R)}).start()})()}},{key:"playTextLoadingAnimation",value:function(){var a=this.textStamp.getComponent(ea);a&&(this.textTween=Y(a).delay(.2).to(.85,{opacity:127},{easing:tn}).to(.85,{opacity:255},{easing:tn}).union().repeatForever().start())}},{key:"stopDotStampAnimation",value:function(){var a,o=E(this.dotStampTweens);try{for(o.s();!(a=o.n()).done;)a.value.stop()}catch(a){o.e(a)}finally{o.f()}this.dotStampTweens=[]}},{key:"stopTextLoadingAnimation",value:function(){var a=this.textStamp.getComponent(ea);a&&(a.opacity=255,this.textTween&&this.textTween.stop())}},{key:"setActiveStateStampLoading",value:function(a){this.stampLoading.active=a}},{key:"handleLoadAndSetStampThemeAsync",value:(R=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:o=td.gameScene.gamePlay.loader,this.previousReject&&this.previousReject("Unload Stamp Theme"),P.label=1;case 1:if(P.trys.push([1,4,,5]),this.setActiveStateStampLoading(!1),!!o.checkIsAlreadyStamp(a))return[3,3];return this.setActiveStateStampLoading(!0),this.playLoadingAnimation(),[4,this.loadStampSpriteFrameAsync(a)];case 2:return P.sent(),[2,null===(C=o.getStampFrame(a))?void 0:(this.setBackgroundStamp(C),void this.stopLoadingAnimation())];case 3:return A=o.getStampFrame(a),this.setBackgroundStamp(A),[3,5];case 4:return P.sent(),[3,5];case 5:return[2]}})}),function(a){return R.apply(this,arguments)})},{key:"loadStampSpriteFrameAsync",value:(I=B(function(a){var o,C;return _ts_generator(this,function(A){return o=this,C=td.gameScene.gamePlay.loader,[2,new Promise(function(A,P){o.previousReject=P,C.loadStampFrameAsync(a).then(function(){return A()})})]})}),function(a){return I.apply(this,arguments)})},{key:"isVisible",value:function(){var a=this.node.getWorldPosition().y,o=eP.getVisibleSize().height,C=this.uiTransform.contentSize.height,A=tf.getBannerAdWorldHeight();return a<o+C/2&&a>-A}}]),d}(Rk)).prototype,"stampSprite",[RR,RE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rx=L(RD.prototype,"stampLoading",[RL,RO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rz=L(RD.prototype,"textStamp",[RN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RG=L(RD.prototype,"uiTransform",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RD))||RD);U._RF.pop(),U._RF.push({},"1e94elnHuBEGL7WG18omJU9","StampPool",void 0);var R$,R0,R1,R2,R3,R4,R5,R6,R7=$.ccclass,R8=$.property,R9=(RW=R7("StampPool"),RV=R8(eY),RK=tj.required,RW((Rj=L((RY=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"stampPrefab",Rj,N(a)),a.stamps=[],a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"getStamp",value:function(){var a=this.stamps.find(function(a){return!a.node.active});return a?a.node.active=!0:(a=this.createStamp(),this.stamps.push(a)),a}},{key:"releaseStamp",value:function(a){a.node.active=!1}},{key:"createStamp",value:function(){var a=ej(this.stampPrefab).getComponent(RQ);if(!a)throw new Error("Stamp component is not defined");return a}},{key:"getActiveStamps",value:function(){return this.stamps.filter(function(a){return a.node.active})}},{key:"handleActiveStamps",value:function(a){var o,C=E(this.stamps);try{for(C.s();!(o=C.n()).done;){var A=o.value;A.node.active&&a(A)}}catch(a){C.e(a)}finally{C.f()}}}]),r}(eo)).prototype,"stampPrefab",[RV,RK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RY))||RY);U._RF.pop(),U._RF.push({},"7a430eak/5BI4BdyAwGAPaP","DynamicItemDisplay",void 0);var Ee,Et,En,Ei,Er,Ea,Eo,Es,El=$.ccclass,Eu=$.property,Ec=(R$=El("DynamicItemDisplay"),R0=Eu([ee]),R1=tj.required(ni(ee)),R2=Eu([ee]),R3=tj.required(ni(ee)),R$((R5=L((R4=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"leftItems",R5,N(a)),O(a,"rightItems",R6,N(a)),a.originalTopLefts=[],a.originalTopRights=[],a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"onLoad",value:function(){var a,o=E(this.leftItems);try{for(o.s();!(a=o.n()).done;){var C=a.value.getComponent(eX);C&&this.originalTopLefts.push(C.top)}}catch(a){o.e(a)}finally{o.f()}var A,P=E(this.rightItems);try{for(P.s();!(A=P.n()).done;){var I=A.value.getComponent(eX);I&&this.originalTopRights.push(I.top)}}catch(a){P.e(a)}finally{P.f()}}},{key:"alignItems",value:function(){this.alignSideItems(this.leftItems,this.originalTopLefts),this.alignSideItems(this.rightItems,this.originalTopRights)}},{key:"alignSideItems",value:function(a,o){for(var C=[],A=0;A<a.length;A++){var P=a[A];P.active&&C.push(P)}for(var I=0;I<C.length;I++){var B=C[I],R=o[I];this.moveItem(B,R)}}},{key:"moveItem",value:function(a,o){var C=a.getComponent(eX);C&&(C.top=o)}}]),r}(eo)).prototype,"leftItems",[R0,R1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),R6=L(R4.prototype,"rightItems",[R2,R3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),R4))||R4);U._RF.pop(),U._RF.push({},"ab297QlPQJAZIGzdDi11VOR","TournamentButtonInfo",void 0);var Eh=$.ccclass,Ep=$.property,Ed=(Ee=Eh("TournamentButtonInfo"),Et=Ep(er),En=tj.required,Ei=Ep(er),Er=tj.required,Ee((Eo=L((Ea=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"rankLabel",Eo,N(a)),O(a,"tournamentLabel",Es,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"setTournamentLabelText",value:function(a){this.tournamentLabel.string=a}},{key:"setRankLabelText",value:function(a){var o=Math.max(4,40-8*(a.length-1));this.rankLabel.fontSize=o,this.rankLabel.string=a}}]),r}(eo)).prototype,"rankLabel",[Et,En],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Es=L(Ea.prototype,"tournamentLabel",[Ei,Er],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ea))||Ea);U._RF.pop(),U._RF.push({},"41ddcx7oA9LlZHpq5YVC4NX","constants",void 0);for(var Ef=[[.44,.6,1],[.4,.555,1]],Ey=[[0,.1,.2,1],[0,.09,.2,1]],Ev=[],Em=0;Em<2;Em++){var Eg,Eb=E(Ef);try{for(Eb.s();!(Eg=Eb.n()).done;)(function(){var a,o=Eg.value,C=null!=(a=Ev[Ev.length-1])?a:0,A=o.map(function(a){return a+C});Ev.push.apply(Ev,R(A))})()}catch(a){Eb.e(a)}finally{Eb.f()}}U._RF.pop(),U._RF.push({},"dd0deOGogpHLaURdVWyvY0e","LevelBlock",void 0);var Ek,Ew,ES,ET,EC,EA,E_,EP,EI,EB,ER,EE,EL,EO,EN,EF,ED,EM,Ex,Ez,EG,Eq,EU,EH,EW,EV,EK=$.ccclass,EY=$.property,Ej=(Ek=EK("LevelBlock"),Ew=EY(er),ES=tj.required,ET=EY([et]),EC=tj.required(ni(et)),EA=EY(ee),E_=tj.required,EP=EY(ee),EI=tj.required,EB=tj.required,ER=tj.required,Ek((EL=L((EE=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"levelLabel",EL,N(a)),O(a,"levelBlockSpriteFrames",EO,N(a)),O(a,"icon",EN,N(a)),O(a,"animBlock",EF,N(a)),O(a,"iconSprite",ED,N(a)),O(a,"iconUITransform",EM,N(a)),a.giftGlowBlock=null,a.stampBlock=null,a.originalFontSize=0,a.level=0,a.levelType="normal",a}return a(r,[{key:"container",get:function(){return td.gameScene.uiManager.getDashboardScreen().getContainer()}},{key:"getIcon",value:function(){return this.icon}},{key:"getLevel",value:function(){return this.level}},{key:"__preload",value:function(){this.initComponents(),this.setUpData()}},{key:"onEnable",value:function(){this.registerEvents()}},{key:"onDisable",value:function(){this.unRegisterEvents()}},{key:"initComponents",value:function(){this.iconSprite=this.icon.getComponent(W),this.iconUITransform=this.icon.getComponent(en),this.validateRequiredComponents()}},{key:"setUpData",value:function(){this.originalFontSize=this.levelLabel.fontSize}},{key:"getAnimBlock",value:function(){return this.animBlock}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"registerEvents",value:function(){this.node.on(ef.EventType.CLICK,this.onButtonClicked,this)}},{key:"unRegisterEvents",value:function(){this.node.off(ef.EventType.CLICK,this.onButtonClicked,this)}},{key:"onButtonClicked",value:function(a,o){if((null==o?void 0:o.type)!==ee.EventType.TOUCH_CANCEL||!o.simulate){var C=td.gameScene.uiManager.getDashboardScreen();"normal"===this.levelType||"achieve"===this.levelType?(td.gameScene.restartLevel(),C.handleClickPlayGame(this.level)):"active"!==this.levelType&&"active-achieve"!==this.levelType||C.handleClickPlayGame(this.level)}}},{key:"toggleLevel",value:function(a){"active-achieve"===a?this.iconSprite.spriteFrame=this.levelBlockSpriteFrames[0]:"inactive"===a?this.iconSprite.spriteFrame=this.levelBlockSpriteFrames[1]:"normal"===a?this.iconSprite.spriteFrame=this.levelBlockSpriteFrames[2]:"achieve"===a||"inactive-achieve"===a?this.iconSprite.spriteFrame=this.levelBlockSpriteFrames[3]:"active"===a&&(this.iconSprite.spriteFrame=this.levelBlockSpriteFrames[4]),this.levelType=a,this.setLevelIcon(a)}},{key:"setLevelIcon",value:function(a){if("active"===a){var o=(new K).fromHEX("#FFFFFF");this.levelLabel.color=o,this.icon.setPosition(0,-7.591),this.iconUITransform.setContentSize(201.74,178.7),this.levelLabel.node.setPosition(0,26)}else if("active-achieve"===a){var C=(new K).fromHEX("#FFFFFF");this.levelLabel.color=C,this.iconUITransform.setContentSize(166,148),this.levelLabel.node.setPosition(0,18)}else if("achieve"===a||"inactive-achieve"===a){var A=(new K).fromHEX("#662f08");this.levelLabel.color=A,this.iconUITransform.setContentSize(166,148),this.levelLabel.node.setPosition(0,16.743)}else{var P=(new K).fromHEX("#5400C0");this.levelLabel.color=P,this.icon.setPosition(0,0),this.iconUITransform.setContentSize(115.2,114.13),this.levelLabel.node.setPosition(0,14.743)}}},{key:"setLevelLabel",value:function(a){if(a!==this.level){var o=a.toString();o.length>=4&&(this.levelLabel.fontSize=this.originalFontSize-4.5*(o.length-3)),this.levelLabel.string=a.toString()}}},{key:"setLevel",value:function(a){this.level=a}},{key:"toggleGiftBlock",value:function(a){this.giftGlowBlock&&(this.giftGlowBlock.node.active=a,a||(this.giftGlowBlock=null))}},{key:"showGift",value:function(){var a=this.container.getGiftBlockPool().getAvailableGiftBlock();this.setGiftBlock(a)}},{key:"setGiftBlock",value:function(a){this.giftGlowBlock=a,this.giftGlowBlock.node.setPosition(0,46.04),a.node.parent!==this.node&&this.addChild(a)}},{key:"hideGift",value:function(){this.giftGlowBlock&&(this.container.getGiftBlockPool().releaseGiftBlock(this.giftGlowBlock),this.giftGlowBlock=null)}},{key:"showStamp",value:function(){var a=this.container.getStampPool().getStamp();this.setStampBlock(a),this.loadStampFrame()}},{key:"setStampBlock",value:function(a){this.stampBlock=a,a.node.parent!==this.node&&this.addChild(a)}},{key:"loadStampFrame",value:function(){if(this.stampBlock){var a=td.mapDataManager.getBgKeyForSpecialLevel(this.level);if(a){var o=a.split("_"),C="frame-bg-".concat(o[1]);this.stampBlock.handleLoadAndSetStampThemeAsync(C)}}}},{key:"hideStamp",value:function(){this.stampBlock&&(this.container.getStampPool().releaseStamp(this.stampBlock),this.stampBlock=null)}},{key:"hasGiftBlock",value:function(){return null!==this.giftGlowBlock}},{key:"getGiftBlock",value:function(){return this.giftGlowBlock}},{key:"toggleStampBlock",value:function(a){this.stampBlock&&(this.stampBlock.node.active=a,a||(this.stampBlock=null))}},{key:"getStampBlock",value:function(){return this.stampBlock}},{key:"isInStartViewRange",value:function(){var a=this.node.worldPosition.y;a+=50;var o=eP.getVisibleSize().height;return a>=o&&a<=1.15*o||a>=0&&a<.3*o}},{key:"isOutViewRange",value:function(){var a=this.node.worldPosition.y,o=eP.getVisibleSize().height;return(a+=50)<-tf.getBannerAdWorldHeight()||a>o}},{key:"addChild",value:function(a){a.setLevelBlockParent(this.node),this.node.addChild(a.node)}}]),r}(eo)).prototype,"levelLabel",[Ew,ES],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EO=L(EE.prototype,"levelBlockSpriteFrames",[ET,EC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),EN=L(EE.prototype,"icon",[EA,E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EF=L(EE.prototype,"animBlock",[EP,EI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ED=L(EE.prototype,"iconSprite",[EB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EM=L(EE.prototype,"iconUITransform",[ER],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE))||EE);U._RF.pop(),U._RF.push({},"87aa8gVlgpPFYT0qIXarvHO","LevelGreenBlock",void 0);var EX,EJ,EZ,EQ,E$,E0,E1,E2,E3,E4,E5=$.ccclass,E6=$.property,E7=[{value:-4,duration:.2,ease:e3.linear},{value:14,duration:.2,ease:te(.51,.25,0,1)},{delay:.105,value:-6,duration:.23,ease:te(.89,-.02,.49,.81)},{value:0,duration:.113,ease:te(.68,-.01,.47,.87)}],E8=[{value:.8152,duration:.45,ease:te(.71,.85,.49,.21)},{value:1.1,duration:.05,ease:te(.79,.59,.22,.54)},{value:.95,duration:.2,ease:te(.39,.87,.31,.78)},{value:1,duration:.15,ease:e3.backOut}],E9=(Ex=E5("LevelGreenBlock"),Ez=E6([ee]),EG=tj.required(ni(ee)),Eq=E6(ee),EU=tj.required,Ex((EW=L((EH=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"glows",EW,N(a)),O(a,"glowBottom",EV,N(a)),a.animBlockObj=void 0,a.originalY=void 0,a.originalScaleY=void 0,a.currentJumpTween=null,a.firstGlowTween=null,a.secondGlowTween=null,a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"setUp",value:function(a){this.originalY=a.position.y,this.originalScaleY=a.scale.y,this.animBlockObj=a}},{key:"playAnims",value:function(){this.resetTweenData(),this.playJumpAnim(),this.glowBottom.active=!0}},{key:"stopAnims",value:function(){var a,o;this.stopJumpAnim(),null==(a=this.firstGlowTween)||a.stop(),null==(o=this.secondGlowTween)||o.stop(),this.resetGreenGlowData(),this.glowBottom.active=!1}},{key:"playLevelGreenGlowAnim",value:function(){this.resetGreenGlowData();var a=this.createScaleUpTween(this.glows[0],1.4,.6),o=this.createFadeOutTween(this.glows[0],.65),C=this.createScaleUpTween(this.glows[1],1.2,.6),A=this.createFadeOutTween(this.glows[1],.65);o&&A&&(this.firstGlowTween=Y(this.glows[0]).parallel(a,o),this.secondGlowTween=Y(this.glows[1]).delay(.2).parallel(C,A),this.firstGlowTween.start(),this.secondGlowTween.start())}},{key:"resetTweenData",value:function(){this.resetGreenGlowData(),this.resetJumpData()}},{key:"resetGreenGlowData",value:function(){var a,o=E(this.glows);try{for(o.s();!(a=o.n()).done;){var C=a.value;C.scale=new ei(0,0,1);var A=C.getComponent(ea);A&&(A.opacity=255)}}catch(a){o.e(a)}finally{o.f()}}},{key:"createScaleUpTween",value:function(a,o,C){var A=new ei(o,o,1);return Y(a).to(C,{scale:A})}},{key:"createFadeOutTween",value:function(a,o){var C=a.getComponent(ea);return C?Y(C).to(o,{opacity:0}):null}},{key:"playJumpAnim",value:function(){if(!this.currentJumpTween&&this.animBlockObj){var a=this.tweenPositionY(),o=this.tweenScaleY();a&&o&&(this.currentJumpTween=Y(this.animBlockObj).parallel(a,o,Y(this.animBlockObj).delay(3)).repeatForever().start())}}},{key:"stopJumpAnim",value:function(){this.currentJumpTween&&(this.currentJumpTween.stop(),this.currentJumpTween=null,this.resetJumpData())}},{key:"resetJumpData",value:function(){if(this.animBlockObj){var a=this.animBlockObj.position.x;this.animBlockObj.setPosition(a,this.originalY);var o=this.animBlockObj.scale.x;this.animBlockObj.scale=new ei(o,this.originalScaleY,1)}}},{key:"tweenPositionY",value:function(){var a;if(!this.animBlockObj)return null;for(var o=[],C=0;C<E7.length;C++){var A=E7[C],P=A.value,I=A.duration,B=A.ease,R=A.delay,E=Y(this.animBlockObj).delay(R||0).to(I,{position:new ei(this.animBlockObj.position.x,P+this.originalY,this.animBlockObj.position.z)},{easing:B});o.push(E)}return(a=Y(this.animBlockObj)).sequence.apply(a,o)}},{key:"tweenScaleY",value:function(){var a,o=this;if(!this.animBlockObj)return null;for(var C=[],A=0;A<E8.length;A++){var P=E8[A],I=P.value,B=P.duration,R=P.ease,E=Y(this.animBlockObj).to(B,{scale:new ei(this.animBlockObj.scale.x,I*this.originalScaleY,this.animBlockObj.scale.z)},{easing:R});C.push(E)}return C[C.length-3].call(function(){o.playLevelGreenGlowAnim()}),(a=Y(this.animBlockObj)).sequence.apply(a,C)}}]),r}(eo)).prototype,"glows",[Ez,EG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),EV=L(EH.prototype,"glowBottom",[Eq,EU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EH))||EH);U._RF.pop(),U._RF.push({},"c7badPbkSdJ0oxi3SLIhf53","RoadContainer",void 0);var Le,Lt=$.ccclass,Ln=$.property,Li=te(.67,0,.32,1.05),Lr=(EX=Lt("RoadContainer"),EJ=Ln(W),EZ=tj.required,EQ=Ln(_t),E$=tj.required,E0=tj.required,EX((E2=L((E1=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"fullRoadSprite",E2,N(a)),O(a,"fullProgressRoad",E3,N(a)),O(a,"uiTransform",E4,N(a)),a.height=void 0,a.useAnim=!1,a}return a(r,[{key:"getHeight",value:function(){return this.height}},{key:"__preload",value:function(){this.setUpRoadContainer()}},{key:"setUpRoadContainer",value:function(){this.uiTransform=this.node.getComponent(en),this.validateRequiredComponents(),this.height=this.uiTransform.contentSize.height}},{key:"setRoadState",value:function(a){this.useAnim=a.useAnim,this.fullProgressRoad.toggleMask(a.useAnim),a.useAnim?this.fullRoadSprite.type=W.Type.SIMPLE:(this.fullRoadSprite.type=W.Type.FILLED,this.fullRoadSprite.fillType=W.FillType.RADIAL,this.fullRoadSprite.fillStart=0)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"updateFullHeight",value:function(a){var o=arguments.length>0&&void 0!==a?a:this.height,C=o;isNaN(C)&&(this.setUpRoadContainer(),C=0);var A=Li(C/this.height);this.fullProgressRoad.setProgress(A)}},{key:"updateRoad",value:function(a){this.fullRoadSprite.fillRange=a}}]),r}(eo)).prototype,"fullRoadSprite",[EJ,EZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E3=L(E1.prototype,"fullProgressRoad",[EQ,E$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E4=L(E1.prototype,"uiTransform",[E0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E1))||E1);U._RF.pop(),U._RF.push({},"a1afbRoo61A14+llmPiKGr+","SwitchActiveAnimator",void 0);var La,Lo,Ls,Ll,Lu,Lc,Lh,Lp,Ld,Lf,Ly,Lv,Lm,Lg,Lb,Lk,Lw,LS,LT,LC,LA,L_,LP,LI,LB,LR,LE,LL,LO,LN,LF=$.ccclass,LD=[{value:72,duration:(.467-.3)/3,ease:e3.cubicOut},{value:90,duration:2*(.467-.3)/3,ease:e3.cubicIn}],LM=[{value:337.2,duration:.467-.3,ease:e3.sineInOut}],Lx=[{value:315.7,duration:.066,ease:e3.sineOut},{value:315.7,duration:.567-.533,ease:e3.linear},{value:318.7,duration:.633-.567,ease:e3.sineOut},{value:315.7,duration:.733-.633,ease:e3.sineIn}],Lz=LF("SwitchActiveAnimator")(Le=function(P){C(h,P);var I,R,L,O=A(h);function h(){var a;o(this,h);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=O.call.apply(O,[this].concat(A))).gameObject=null,a.originalY=0,a.originalScale=ei.ZERO,a.currentSwitchActiveTween=null,a}return a(h,[{key:"setGameObject",value:function(a){this.gameObject=a,this.originalY=a.position.y,this.originalScale=a.scale.clone()}},{key:"play",value:(L=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return this.stop(),[4,Promise.all([this.tweenY(LM),this.tweenScale(LD)])];case 1:return o.sent(),null==a||a(),[4,this.tweenY(Lx)];case 2:return o.sent(),[2]}})}),function(a){return L.apply(this,arguments)})},{key:"stop",value:function(){if(this.currentSwitchActiveTween&&this.currentSwitchActiveTween.stop(),this.gameObject){var a=this.gameObject.position,o=a.x,C=a.z;this.gameObject.setPosition(o,this.originalY,C),this.gameObject.scale=this.originalScale.clone()}}},{key:"tweenY",value:(R=B(function(a){var o,C,A,P,I,B,R,L,O,N,F,D,M,x;return _ts_generator(this,function(z){switch(z.label){case 0:if(!this.gameObject)return[2,null];A=[],I=(P=this.gameObject.position).x,B=P.z,R=E(a);try{for(R.s();!(C=R.n()).done;)O=(L=C.value).value,N=L.duration,F=L.ease,D=L.delay,M=Y(this.gameObject).delay(D||0).to(N,{position:new ei(I,O-315.7+this.originalY,B)},{easing:F}),A.push(M)}catch(a){R.e(a)}finally{R.f()}return x=(o=Y(this.gameObject)).sequence.apply(o,A),[4,ts.runTweenAsync(x)];case 1:return z.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"tweenScale",value:(I=B(function(a){var o,C,A,P,I,B,R,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:if(!this.gameObject)return[2,null];A=[],P=E(a);try{for(P.s();!(C=P.n()).done;)B=(I=C.value).value,R=I.duration,L=I.ease,O=Y(this.gameObject).to(R,{scale:this.originalScale.clone().multiplyScalar(B/90)},{easing:L}),A.push(O)}catch(a){P.e(a)}finally{P.f()}return N=(o=Y(this.gameObject)).sequence.apply(o,A),[4,ts.runTweenAsync(N)];case 1:return F.sent(),[2]}})}),function(a){return I.apply(this,arguments)})}]),h}(eo))||Le;U._RF.pop(),U._RF.push({},"81641zMfvBPdYZCFD0PCaoL","ScrollerItem",void 0);var LG,Lq,LU,LH,LW,LV,LK,LY,Lj=$.ccclass,LX=$.property,LJ=(La=Lj("ScrollerItem"),Lo=LX(W),Ls=tj.required,Ll=LX([Ej]),Lu=tj.required(ni(Ej)),Lc=LX([Lr]),Lh=tj.required(ni(Lr)),Lp=LX(ee),Ld=tj.required,Lf=LX(ee),Ly=tj.required,Lv=LX(E9),Lm=tj.required,Lg=LX(Lz),Lb=tj.required,Lk=LX(PD),Lw=tj.required,LS=tj.required,LT=tj.required,La((LA=L((LC=function(P){C(p,P);var I,R,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"background",LA,N(a)),O(a,"levelBlocks",L_,N(a)),O(a,"bigRoadContainers",LP,N(a)),O(a,"church",LI,N(a)),O(a,"mill",LB,N(a)),O(a,"levelGreenBlock",LR,N(a)),O(a,"switchActiveAnimator",LE,N(a)),O(a,"switchActiveEffect",LL,N(a)),O(a,"uiTransform",LO,N(a)),O(a,"bgUITransform",LN,N(a)),a.currentLevelBlock=void 0,a.bigRoadContainerFullHeights=[],a.smallRoadContainerFullHeights=[],a.startLevel=0,a.endLevel=0,a.canRunRoadRevealAnim=!1,a.isTurningIntoActiveBlock=!1,a}return a(p,[{key:"getLevelBlockPayload",value:function(){return{startLevel:this.startLevel,endLevel:this.endLevel}}},{key:"__preload",value:function(){this.initComponents(),this.registerEvents()}},{key:"initComponents",value:function(){this.uiTransform=this.node.getComponent(en),this.bgUITransform=this.background.getComponent(en),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,p)}},{key:"registerEvents",value:function(){var a,o=this;null==(a=this.indexChangeCallbacks)||a.push(function(a){o.updateInfo(a)})}},{key:"onLoad",value:function(){var a=nr.isPortrait()?1080:4054;this.bgUITransform.width=a}},{key:"updateInfo",value:function(a){this.updateBg(a),this.updateMillAndChurch(a),this.updateLevelBlockLabelsAndPaths(a)}},{key:"updateBg",value:function(a){var o=a%2==0?this.scroller.getTopBg():this.scroller.getBottomBg();this.background.spriteFrame=o}},{key:"updateMillAndChurch",value:function(a){var o=a%2!=0;this.toggleMill(o),this.toggleChurch(!o)}},{key:"updateLevelBlockLabelsAndPaths",value:function(a){var o=this;this.startLevel=12*(a-1)+1;var C=td.gameScene.gamePlay.gameDataManager.getLevel(),A=this.startLevel;this.currentLevelBlock=void 0,this.hideAllGiftBlocks(),this.hideAllStampBlocks(),this.levelGreenBlock.stopAnims();for(var P=td.gameScene.gamePlay,I=0;I<this.levelBlocks.length;I++){var B=this.levelBlocks[I];if(A>t4.MAX_LEVEL||A<1)B.node.active=!1;else{B.node.active=!0,B.setLevelLabel(A),B.setLevel(A);var R=A===t4.MAX_LEVEL&&P.canShowStampAtFinalLevel(),E=null!==td.mapDataManager.getBgKeyForSpecialLevel(A),L=E&&A>=C;R&&(L=!1),L&&B.showGift();var O=E&&(A<C||R);if(O&&B.showStamp(),R&&this.levelGreenBlock.stopAnims(),O)B.toggleLevel("achieve");else if(L&&A>C)B.toggleLevel("inactive-achieve");else if(A<C)B.toggleLevel("normal");else if(A===C){if(this.canRunRoadRevealAnim){var N=L?"inactive-achieve":"inactive";B.toggleLevel(N)}else if(!this.isTurningIntoActiveBlock){var F=L?"active-achieve":"active";B.toggleLevel(F),this.playGreenBlockAnim(B)}this.currentLevelBlock=B}else A>C&&B.toggleLevel("inactive");A++}}this.endLevel=A-1;var D=td.levelManager.getLevel(),M=D;td.mapDataManager.isSpecialLevel(D)||(M=Math.min(D+1,t4.MAX_LEVEL));var x=this.canRunRoadRevealAnim?M:C;return this.bigRoadContainerFullHeights=this.bigRoadContainers.map(function(a,A){if(C>o.startLevel-1+3*(A+1)){var P=a.getHeight();return o.canRunRoadRevealAnim||(a.setRoadState({useAnim:!1}),a.updateRoad(1)),P}var I=o.startLevel+3*A;if(C<I)return o.canRunRoadRevealAnim||(a.setRoadState({useAnim:!1}),a.updateRoad(0)),0;var B=x-I,R=Ef[A%2][B]*a.getHeight();if(!o.canRunRoadRevealAnim){var E=Ey[A%2][B+1];a.setRoadState({useAnim:!1}),a.updateRoad(E)}return R}),this.smallRoadContainerFullHeights=this.bigRoadContainers.map(function(a,C){var A=o.startLevel-1+3*(C+1);if(M>A)return a.getHeight();var P=o.startLevel+3*C;if(M<P)return 0;var I=M-P;return I<0?0:Ef[C%2][I]*a.getHeight()}),void 0!==this.currentLevelBlock}},{key:"hideAllGiftBlocks",value:function(){var a,o=E(this.levelBlocks);try{for(o.s();!(a=o.n()).done;)a.value.hideGift()}catch(a){o.e(a)}finally{o.f()}}},{key:"hideAllStampBlocks",value:function(){var a,o=E(this.levelBlocks);try{for(o.s();!(a=o.n()).done;)a.value.hideStamp()}catch(a){o.e(a)}finally{o.f()}}},{key:"prepareRoadRevealAnimation",value:function(a){var o=a.fromButtonIndex,C=a.isFromBottomEdge;if(C||this.levelBlocks[o]){var A,P=[],I=0,B=E(this.bigRoadContainerFullHeights);try{for(B.s();!(A=B.n()).done;){var R,L=A.value,O=null!=(R=P[P.length-1])?R:0;P.push(O+L)}}catch(a){B.e(a)}finally{B.f()}C||(I=Math.floor(o/3)),this.bigRoadContainers.forEach(function(a,A){if(C)return a.setRoadState({useAnim:!1}),void a.updateRoad(0);if(A>I)return a.setRoadState({useAnim:!1}),void a.updateRoad(0);if(A<I)return a.setRoadState({useAnim:!1}),void a.updateRoad(1);var P=o%3-1,B=0;P>=0&&(B=Ef[A%2][P]*a.getHeight()),a.setRoadState({useAnim:!0}),a.updateFullHeight(B)})}}},{key:"runRoadRevealAnimation",value:(R=B(function(a){var o,C,A,P,I,B,R,L,O,N,F,D,M,x,z,q,U,H,W,V,K,j,X,J,Z,Q,$,ee,et,en;return _ts_generator(this,function(ei){switch(ei.label){case 0:if(o=this,C=a.fromButtonIndex,A=a.isFromBottomEdge,P=a.fullHeightType,!(A||this.levelBlocks[C]))return[3,4];B=[],R=0,L=0,O=0,N="big"===P?this.bigRoadContainerFullHeights:this.smallRoadContainerFullHeights,F=E(N);try{for(F.s();!(I=F.n()).done;)M=I.value,x=null!=(D=B[B.length-1])?D:0,B.push(M+x),R+=M}catch(a){F.e(a)}finally{F.f()}return A||(L=Math.floor(C/3),O=Ev[C]*this.bigRoadContainers[L].getHeight()),z=this.uiTransform.contentSize.height,q=Math.abs(R-O)/(z/5),U=0,W=Y(H={value:O}).to(q,{value:R},{progress:function(a,C,A,P){var I,R=P*(C-O)+O;if(R>B[L]){var E=o.bigRoadContainers[L];E.setRoadState({useAnim:!1}),E.updateRoad(1),L++}var N=o.bigRoadContainers[L];if(!N)return 0;var F=null!=(I=B[L-1])?I:0;return N.setRoadState({useAnim:!0}),U=R-F,N.updateFullHeight(U),A}}),K=(V=td.gameScene.gamePlay).gameDataManager.getLevel(),j=V.gameDataManager.getDashboardAnimLevel(),X=td.levelManager.getLevel(),J="small"===P?X:K,Z=Math.min(this.endLevel,J),Q=Math.max(j,this.startLevel-1),$=this.scroller.calculateScrollerIdx(Q),ee=this.scroller.calculateScrollerIdx(Z),H.value=$,R=ee,et=Y(H).to(q,{value:R},{progress:function(a,C,A,P){return o.scroller.moveToIndex(P*(C-$)+$),A}}),[4,Promise.all([ts.runTweenAsync(W),ts.runTweenAsync(et)])];case 1:if(ei.sent(),en=this.bigRoadContainers[L],U>=en.getHeight()&&(en.setRoadState({useAnim:!1}),en.updateRoad(1)),!("small"!==P))return[3,3];return[4,this.tryToPlayTransitionActiveLevelBlockAnim()];case 2:ei.sent(),ei.label=3;case 3:ei.label=4;case 4:return[2]}})}),function(a){return R.apply(this,arguments)})},{key:"prepareTransitionActiveLevelBlockAnim",value:function(){this.currentLevelBlock&&(this.levelGreenBlock.stopAnims(),this.isTurningIntoActiveBlock=!0,this.setCurrentToUnlockLevelBlock())}},{key:"setCurrentToUnlockLevelBlock",value:function(){if(this.currentLevelBlock){var a=this.currentLevelBlock.hasGiftBlock()?"inactive-achieve":"inactive";this.currentLevelBlock.toggleLevel(a)}}},{key:"tryToPlayTransitionActiveLevelBlockAnim",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(a=this,!this.currentLevelBlock)return[3,3];return this.switchActiveAnimator.setGameObject(this.currentLevelBlock.node),o=this.currentLevelBlock.getLevel(),[4,this.switchActiveAnimator.play(function(){if(a.currentLevelBlock){var C=td.mapDataManager.isSpecialLevel(o)?"active-achieve":"active";a.currentLevelBlock.toggleLevel(C);var A=a.currentLevelBlock.node.worldPosition,P=A.x,I=A.y,B=A.z;a.switchActiveEffect.node.setWorldPosition(P,I,B),a.switchActiveEffect.playEffect(),th.playSound(tZ.UNLOCK_LEVEL,{volume:.436})}})];case 1:return C.sent(),this.switchActiveAnimator.stop(),[4,ts.waitTweenAsync(.75)];case 2:C.sent(),this.playGreenBlockAnim(this.currentLevelBlock),this.isTurningIntoActiveBlock=!1,C.label=3;case 3:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"playGreenBlockAnim",value:function(a){var o=a.getAnimBlock();a.node.addChild(this.levelGreenBlock.node),this.levelGreenBlock.setUp(o),this.levelGreenBlock.node.setSiblingIndex(0),this.levelGreenBlock.playAnims()}},{key:"hideAllRoads",value:function(){var a,o=E(this.bigRoadContainers);try{for(o.s();!(a=o.n()).done;){var C=a.value;C.setRoadState({useAnim:!1}),C.updateRoad(0)}}catch(a){o.e(a)}finally{o.f()}}},{key:"showAllRoads",value:function(){for(var a=0;a<this.bigRoadContainers.length;a++){var o=this.bigRoadContainers[a];o.setRoadState({useAnim:!1}),o.updateRoad(1)}}},{key:"toggleChurch",value:function(a){this.church.active=a}},{key:"toggleMill",value:function(a){this.mill.active=a}},{key:"getLevelBlock",value:function(a){return this.levelBlocks.find(function(o){return o.getLevel()===a})}}]),p}(tQ)).prototype,"background",[Lo,Ls],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=L(LC.prototype,"levelBlocks",[Ll,Lu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LP=L(LC.prototype,"bigRoadContainers",[Lc,Lh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LI=L(LC.prototype,"church",[Lp,Ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LB=L(LC.prototype,"mill",[Lf,Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LR=L(LC.prototype,"levelGreenBlock",[Lv,Lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LE=L(LC.prototype,"switchActiveAnimator",[Lg,Lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LL=L(LC.prototype,"switchActiveEffect",[Lk,Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LO=L(LC.prototype,"uiTransform",[LS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LN=L(LC.prototype,"bgUITransform",[LT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LC))||LC);U._RF.pop(),U._RF.push({},"e625b5eYAtCXLc6pHzv4leE","ScrollerDashboard",void 0);var LZ,LQ,L$,L0,L1,L2,L3,L4,L5,L6,L7,L8,L9,Oe,Ot,Oi,Or,Oa,Oo,Os,Ol,Ou,Oc,Oh,Op,Od,Of,Oy,Ov,Om,Og,Ob,Ok,Ow,OS,OT,OC,OA,O_,OP,OI,OB,OR,OE,OL,OO,ON,OF,OD,OM,Ox,Oz,OG,Oq,OU,OH=$.ccclass,OW=$.property,OV=(LG=OH("ScrollerDashboard"),Lq=OW(et),LU=tj.required,LH=OW(et),LW=tj.required,LG((LK=L((LV=function(P){C(u,P);var I,R=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"topBG",LK,N(a)),O(a,"bottomBG",LY,N(a)),a.updateAfterScroll=function(){a.tryToShowGiftAndStampsAnim()},a}return a(u,[{key:"__preload",value:function(){M(D(u.prototype),"__preload",this).call(this),tj.validateRequiredProperties(this,u)}},{key:"container",get:function(){return td.gameScene.uiManager.getDashboardScreen().getContainer()}},{key:"getTopBg",value:function(){return this.topBG}},{key:"getBottomBg",value:function(){return this.bottomBG}},{key:"getScrollerItems",value:function(){for(var a=this.getIndexToBlocks(),o=[],C=0,A=Object.values(a);C<A.length;C++){var P=A[C].getComponentInChildren(LJ);P&&o.push(P)}return o}},{key:"getLevelBlock",value:function(a){var o,C=this.getScrollerItems(),A=E(C);try{for(A.s();!(o=A.n()).done;){var P=o.value.getLevelBlock(a);if(P)return P}}catch(a){A.e(a)}finally{A.f()}}},{key:"refresh",value:function(){for(var a=this.getIndexToBlocks(),o=0,C=Object.values(a);o<C.length;o++){var A=C[o],P=A.index;A.index=P}}},{key:"start",value:function(){this.config.children.count=this.getMaxChildren(),this.config.children.size.height=2160,this.config.children.anchor="bottom",this.config.padding=0,this.config.margin.top=-972,this.config.margin.bottom=-1512,this.init()}},{key:"getMaxChildren",value:function(){return t4.MAX_LEVEL/12+2}},{key:"tryToShowGiftAndStampsAnim",value:function(){var a=this.container.getStampPool(),o=this.container.getGiftBlockPool();a.handleActiveStamps(function(a){a.isVisible()?a.playAppearAnimation():a.stopAnims()}),o.handleActiveGifts(function(a){a.isVisible()?a.playAppearAnimation():a.stopAnims()})}},{key:"moveToLevelBlock",value:function(a){var o=this.calculateScrollerIdx(a);this.moveToIndex(o)}},{key:"calculateScrollerIdx",value:function(a){var o=a/12,C=Math.floor(o);return 1+C+(o-(C+.5))}},{key:"prepareRoadRevealAnimation",value:function(a){if(!(a>=td.gameScene.gamePlay.gameDataManager.getLevel())){var o=this.findItem(a);if(o){var C=o.index,A=Math.max(0,C-1),P=Math.min(this.getMaxChildren(),C+1),I=o.getLevelBlockPayload().startLevel,B=this.getBlock(A);if(B&&B.showAllRoads(),o.prepareRoadRevealAnimation({fromButtonIndex:a-I+1,isFromBottomEdge:!1,fullHeightType:"big"}),o.prepareTransitionActiveLevelBlockAnim(),C+1!==this.getMaxChildren()){var R=this.getBlock(P);R&&(R.hideAllRoads(),R.prepareTransitionActiveLevelBlockAnim())}}}}},{key:"runRoadRevealAnimation",value:(I=B(function(a){var o,C,A,P,I,B,R,E,L,O;return _ts_generator(this,function(N){switch(N.label){case 0:if(o=a.fromLevel,C=a.toLevel,A=a.shouldRunChapterEndFirst,o>=C)return[3,5];P=o,I=o,B=!0,N.label=1;case 1:if(!B)return[3,5];if(!(R=this.findItem(P)))return[2];if(L=(E=R.getLevelBlockPayload()).startLevel,O=E.endLevel,!(L<=P&&O>=P))return[3,3];return[4,R.runRoadRevealAnimation({fromButtonIndex:P-L,isFromBottomEdge:P===L&&I<P,fullHeightType:A?"small":"big"})];case 2:N.sent(),P=O+1,B=(I=O)<C,N.label=3;case 3:N.label=4;case 4:return[3,1];case 5:return[2]}})}),function(a){return I.apply(this,arguments)})},{key:"findItem",value:function(a){var o,C=this.getScrollerItems(),A=E(C);try{for(A.s();!(o=A.n()).done;){var P=o.value,I=P.getLevelBlockPayload(),B=I.startLevel,R=I.endLevel;if(B<=a&&R>=a)return P}}catch(a){A.e(a)}finally{A.f()}return null}},{key:"getBlock",value:function(a){var o=M(D(u.prototype),"getBlockAt",this).call(this,a);return o?o.getComponentInChildren(LJ):null}}]),u}(t$)).prototype,"topBG",[Lq,LU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LY=L(LV.prototype,"bottomBG",[LH,LW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LV))||LV);U._RF.pop(),U._RF.push({},"7b5ffAbjUlGp6SCCd1513lw","DashboardContainer",void 0);var OK,OY,Oj,OX,OJ,OZ,OQ,O$,O0,O1,O2,O3,O4=$.ccclass,O5=$.property,O6=(LZ=O4("DashboardContainer"),LQ=O5(ef),L$=tj.required,L0=O5(ef),L1=tj.required,L2=O5(R9),L3=tj.required,L4=O5(RH),L5=tj.required,L6=O5(er),L7=tj.required,L8=O5(ee),L9=tj.required,Oe=O5(ee),Ot=tj.required,Oi=O5(ef),Or=tj.required,Oa=O5(ef),Oo=tj.required,Os=O5(ef),Ol=tj.required,Ou=O5(ef),Oc=tj.required,Oh=O5(ef),Op=tj.required,Od=O5(ef),Of=tj.required,Oy=O5(ef),Ov=tj.required,Om=O5(ee),Og=tj.required,Ob=O5(OV),Ok=tj.required,Ow=O5(B9),OS=tj.required,OT=tj.required,LZ((OA=L((OC=function(P){C(v,P);var I,R,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"playGameButton",OA,N(a)),O(a,"settingButton",O_,N(a)),O(a,"stampPool",OP,N(a)),O(a,"giftBlockPool",OI,N(a)),O(a,"playGameButtonLabel",OB,N(a)),O(a,"bottomButtonsContainer",OR,N(a)),O(a,"mapOverlay",OE,N(a)),O(a,"tournamentButton",OL,N(a)),O(a,"playWithFriendsButton",OO,N(a)),O(a,"dailyMissionButton",ON,N(a)),O(a,"shopButton",OF,N(a)),O(a,"globalLeaderboardButton",OD,N(a)),O(a,"dailyRewardButton",OM,N(a)),O(a,"dailyChallengeButton",Ox,N(a)),O(a,"headerButton",Oz,N(a)),O(a,"scrollerDashboard",OG,N(a)),O(a,"leafRiseParticle",Oq,N(a)),O(a,"tournamentButtonInfo",OU,N(a)),a.playGameButtonBubbleTween=null,a.currentPlayGameFontSize=0,a.headerButtonOriginalPositions={},a.headerButtonHiddenPositions={},a.headerButtonUIOpacities={},a.previousHandleResizedFunc=null,a.headerButtonLandscapeContainer=null,a.dynamicItemDisplay=null,a.handleViewResized=function(){var o;null==(o=a.previousHandleResizedFunc)||o.call(a),a.updateHeaderButtonData(),a.updateBottomButtonsWhenResized()},a}return a(v,[{key:"getStampPool",value:function(){return this.stampPool}},{key:"getGiftBlockPool",value:function(){return this.giftBlockPool}},{key:"getScroller",value:function(){return this.scrollerDashboard}},{key:"toggleTournamentButton",value:function(a){this.tournamentButton.node.active=!1}},{key:"toggleShopButton",value:function(a){this.shopButton.node.active=!1}},{key:"toggleChallengeFriendsButton",value:function(a){this.playWithFriendsButton.node.active=!1}},{key:"toggleGlobalLeaderboardButton",value:function(a){this.globalLeaderboardButton.node.active=!1}},{key:"toggleMissionButton",value:function(a){this.dailyMissionButton.node.active=a}},{key:"toggleDailyRewardButton",value:function(a){this.dailyRewardButton.node.active=a}},{key:"onClickPlayGameButton",set:function(a){this.playGameButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickSettingButton",set:function(a){this.settingButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickTournamentButton",set:function(a){this.tournamentButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickPlayWithFriendsButton",set:function(a){this.playWithFriendsButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickDailyMissionButton",set:function(a){this.dailyMissionButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickShopButton",set:function(a){this.shopButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickGlobalLeaderboardButton",set:function(a){this.globalLeaderboardButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickDailyRewardButton",set:function(a){this.dailyRewardButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickDailyChallengeButton",set:function(a){this.dailyChallengeButton.node.on(ef.EventType.CLICK,a)}},{key:"dashboardScreen",get:function(){var a;return null==(a=this.node.parent)?void 0:a.getComponent("DashboardScreen")}},{key:"__preload",value:function(){this.setUpBubbleButtons(),this.initComponents(),this.currentPlayGameFontSize=this.playGameButtonLabel.fontSize,this.listenGameEvents()}},{key:"listenGameEvents",value:function(){nr.isPortrait()||this.headerButtonLandscapeContainer&&(this.previousHandleResizedFunc=this.headerButtonLandscapeContainer.handleWhenResized,this.headerButtonLandscapeContainer.handleWhenResized=this.handleViewResized.bind(this))}},{key:"updateHeaderButtonData",value:(M=B(function(){var a,o,C,A,P,I,B,R,L,O,N;return _ts_generator(this,function(F){a=this.getHeaderButtonPropNames(),o=Math.min(o=eP.getVisibleSize().width,2483),A=E(a);try{for(A.s();!(C=A.n()).done;)B=(I=this[P=C.value].node).getComponent(eX),R=I.position.clone(),B&&B.updateAlignment(),O=(L=I.position.clone()).x>0?1:-1,L.x=(o/2-128.528)*O,(N=this.headerButtonHiddenPositions[P])&&(R.y===N.y||R.y===L.y)&&(L.y=N.y-100),this.headerButtonOriginalPositions[P]=L,this.headerButtonUIOpacities[P]=I.getComponent(ea),this.headerButtonHiddenPositions[P]=L.clone().add(new ei(100*O,100,0))}catch(a){A.e(a)}finally{A.f()}return[2]})}),function(){return M.apply(this,arguments)})},{key:"clearHeaderButtonData",value:function(){this.headerButtonOriginalPositions={},this.headerButtonHiddenPositions={}}},{key:"initComponents",value:function(){this.tournamentButtonInfo=this.tournamentButton.getComponent(Ed),this.headerButtonLandscapeContainer=this.headerButton.getComponent(us),this.dynamicItemDisplay=this.headerButton.getComponent(Ec),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,v)}},{key:"getHeaderButtonPropNames",value:function(){return["tournamentButton","playWithFriendsButton","dailyMissionButton","shopButton","globalLeaderboardButton","dailyRewardButton"]}},{key:"onLoad",value:function(){this.alignElements(),this.handleViewResized(),this.prepareHeaderButtons(),this.setRankLabel("")}},{key:"alignElements",value:function(){this.updateBottomButtonsWhenResized(),this.updateHeaderButtonsForRubyBar()}},{key:"updateBottomButtonsWhenResized",value:function(){var a=0;try{a=tf.getBannerAdWorldHeight()}catch(a){}var o=this.bottomButtonsContainer.getComponent(eX);o&&a&&(o.bottom=62+a)}},{key:"updateHeaderButtonsForRubyBar",value:function(){var a,o=null==(a=this.playWithFriendsButton.node.parent)?void 0:a.getComponent(eX);o&&(o.top+=td.gameScene.shop.getRubyBarZoneHeight())}},{key:"setUpBubbleButtons",value:function(){this.playGameButtonBubbleTween=ti(this.playGameButton.node);var a=this.playGameButton.getComponent(az);a&&(a.animationUp=this.playGameButtonBubbleTween)}},{key:"setPlayLevelButtonLabel",value:function(a){var o=globalThis.game.language.getText("LEVEL_X",["".concat(a)]);o.length>8&&(this.playGameButtonLabel.fontSize=this.currentPlayGameFontSize-9*(o.length-8)),this.playGameButtonLabel.string=o}},{key:"runPlayGameButtonAnimation",value:function(){this.playGameButtonBubbleTween&&this.playGameButtonBubbleTween.start()}},{key:"stopPlayGameButtonAnimation",value:function(){this.playGameButtonBubbleTween&&(this.playGameButtonBubbleTween.stop(),this.playGameButton.node.setScale(1,1,1))}},{key:"runPlayButtonCollectItemAnimation",value:function(){var a=this;this.stopPlayGameButtonAnimation(),Y(this.playGameButton.node).to(.1,{scale:new ei(1.05,1,1)},{easing:"sineIn"}).to(.1,{scale:new ei(.95,1,1)},{easing:"sineIn"}).to(.1,{scale:new ei(1,1,1)},{easing:"sineIn"}).call(function(){return a.runPlayGameButtonAnimation()}).start()}},{key:"fadeIn",value:(D=B(function(a){var o,C,A,P,I,R,E,L,O,N,F,D;return _ts_generator(this,function(M){switch(M.label){case 0:if(C=void 0===(o=a.delayMask)||o,A=Y(this.playGameButton.node).to(.3,{scale:ei.ONE},{easing:"cubicOut"}),P=Y(this.dailyChallengeButton.node).to(.3,{scale:ei.ONE},{easing:"cubicOut"}),I=this.createOpacityNodeAnim(this.playGameButton.node,255,.3,e3.cubicOut),R=this.createOpacityNodeAnim(this.dailyChallengeButton.node,255,.3,e3.cubicOut),E=Y(this.settingButton.node).to(.3,{scale:ei.ONE},{easing:"cubicOut"}),L=this.createOpacityNodeAnim(this.settingButton.node,255,.3,e3.cubicOut),O=this.createOpacityNodeAnim(this.mapOverlay,255,.3,e3.cubicOut),!(I&&L&&O&&R))return[3,2];return N=C?.25:0,F=this.waitInPromise(N,B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,ts.runTweenAsync(O)];case 1:return a.sent(),[2]}})})),(D=[]).push(ts.runTweenAsync(A)),D.push(ts.runTweenAsync(P)),D.push(ts.runTweenAsync(I)),D.push(ts.runTweenAsync(R)),D.push(ts.runTweenAsync(E),ts.runTweenAsync(L),this.fadeInHeaderButtons(),F),[4,Promise.all(D)];case 1:M.sent(),this.runPlayGameButtonAnimation(),M.label=2;case 2:return[2]}})}),function(a){return D.apply(this,arguments)})},{key:"fadeInHeaderButtons",value:(F=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,Promise.all(this.getHeaderButtonPropNames().map(function(){var o=B(function(o){return _ts_generator(this,function(C){return[2,Promise.all([Y(a.headerButtonUIOpacities[o]).to(.3,{opacity:255}),Y(a[o].node).to(.3,{position:a.headerButtonOriginalPositions[o],scale:ei.ONE},{easing:"backOut"})].map(function(a){return ts.runTweenAsync(a)}))]})});return function(a){return o.apply(this,arguments)}}()))]})}),function(){return F.apply(this,arguments)})},{key:"fadeOutPlayGameAndSettingButtons",value:(L=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(a=this.createOpacityNodeAnim(this.playGameButton.node,0,.2,e3.linear),o=this.createOpacityNodeAnim(this.dailyChallengeButton.node,0,.2,e3.linear),C=this.createOpacityNodeAnim(this.settingButton.node,0,.2,e3.linear),!(a&&C&&o))return[3,3];if(!(A=this.createOpacityNodeAnim(this.mapOverlay,0,.2,e3.linear)))return[3,2];return[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o),ts.runTweenAsync(C),ts.runTweenAsync(A),this.fadeOutHeaderButtons()])];case 1:P.sent(),P.label=2;case 2:P.label=3;case 3:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"fadeOutHeaderButtons",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,Promise.all(this.getHeaderButtonPropNames().map(function(){var o=B(function(o){return _ts_generator(this,function(C){return[2,Promise.all([Y(a.headerButtonUIOpacities[o]).to(.2,{opacity:0}),Y(a[o].node).to(.2,{position:a.headerButtonHiddenPositions[o],scale:ei.ZERO},{easing:"backIn"})].map(function(a){return ts.runTweenAsync(a)}))]})});return function(a){return o.apply(this,arguments)}}()))]})}),function(){return R.apply(this,arguments)})},{key:"stopGiftBlockAndStampEffects",value:function(){var a,o=this.giftBlockPool.getActiveGiftBlocks(),C=E(o);try{for(C.s();!(a=C.n()).done;)a.value.stopAnims()}catch(a){C.e(a)}finally{C.f()}var A,P=this.stampPool.getActiveStamps(),I=E(P);try{for(I.s();!(A=I.n()).done;)A.value.stopAnims()}catch(a){I.e(a)}finally{I.f()}}},{key:"prepareFadeIn",value:function(){this.stopPlayGameButtonAnimation(),this.setNodeUIOpacity(this.playGameButton.node,0),this.setNodeUIOpacity(this.dailyChallengeButton.node,0),this.setNodeUIOpacity(this.settingButton.node,0),this.setNodeUIOpacity(this.mapOverlay,0),this.playGameButton.node.setScale(0,0,0),this.dailyChallengeButton.node.setScale(0,0,0),this.settingButton.node.setScale(0,0,0),this.prepareHeaderButtons()}},{key:"prepareHeaderButtons",value:function(){var a,o=E(this.getHeaderButtonPropNames());try{for(o.s();!(a=o.n()).done;){var C=a.value,A=this[C].node;A.setPosition(this.headerButtonHiddenPositions[C]),A.setScale(ei.ZERO),this.headerButtonUIOpacities[C].opacity=0}}catch(a){o.e(a)}finally{o.f()}}},{key:"createOpacityNodeAnim",value:function(a,o,C,A){var P=a.getComponent(ea);return P?Y(P).to(C,{opacity:o},{easing:A}):null}},{key:"setNodeUIOpacity",value:function(a,o){var C=a.getComponent(ea);C&&(C.opacity=o)}},{key:"waitInPromise",value:(I=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,ts.waitTweenAsync(a)];case 1:return C.sent(),o(),[2]}})}),function(a,o){return I.apply(this,arguments)})},{key:"setTournamentLabel",value:function(a){if(this.canShowTourText(a)){var o=globalThis.game.language.getText("Tournament");this.tournamentButtonInfo.setTournamentLabelText(o)}else{var C=Rs.getStandardTimeFormat(a);this.tournamentButtonInfo.setTournamentLabelText(C)}}},{key:"canShowTourText",value:function(a){return a<=0||!td.gameScene.tournament.isJoinedCurTour()}},{key:"setRankLabel",value:function(a){this.tournamentButtonInfo.setRankLabelText(a)}},{key:"updateItemsAlignment",value:function(){this.dynamicItemDisplay&&(this.clearHeaderButtonData(),this.dynamicItemDisplay.alignItems())}},{key:"turnOnAllHeaderButtons",value:function(){this.toggleChallengeFriendsButton(!0),this.toggleGlobalLeaderboardButton(!0),this.toggleShopButton(!0),this.toggleTournamentButton(!0),this.toggleDailyRewardButton(!0)}},{key:"playLeafRiseEffect",value:function(){this.leafRiseParticle.playParticle()}},{key:"stopLeafRiseEffect",value:function(){this.leafRiseParticle.stopParticle()}},{key:"setTournamentLocalizedText",value:function(){var a=globalThis.game.language.getText("Tournament");this.tournamentButtonInfo.setTournamentLabelText(a)}}]),v}(eo)).prototype,"playGameButton",[LQ,L$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O_=L(OC.prototype,"settingButton",[L0,L1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OP=L(OC.prototype,"stampPool",[L2,L3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OI=L(OC.prototype,"giftBlockPool",[L4,L5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OB=L(OC.prototype,"playGameButtonLabel",[L6,L7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OR=L(OC.prototype,"bottomButtonsContainer",[L8,L9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OE=L(OC.prototype,"mapOverlay",[Oe,Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OL=L(OC.prototype,"tournamentButton",[Oi,Or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OO=L(OC.prototype,"playWithFriendsButton",[Oa,Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ON=L(OC.prototype,"dailyMissionButton",[Os,Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OF=L(OC.prototype,"shopButton",[Ou,Oc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OD=L(OC.prototype,"globalLeaderboardButton",[Oh,Op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OM=L(OC.prototype,"dailyRewardButton",[Od,Of],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox=L(OC.prototype,"dailyChallengeButton",[Oy,Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oz=L(OC.prototype,"headerButton",[Om,Og],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OG=L(OC.prototype,"scrollerDashboard",[Ob,Ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oq=L(OC.prototype,"leafRiseParticle",[Ow,OS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OU=L(OC.prototype,"tournamentButtonInfo",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OC))||OC);U._RF.pop(),U._RF.push({},"32384LIH2tC06etA8kgHurP","DashboardScreen",void 0);var O7,O8=$.ccclass,O9=$.disallowMultiple,Ne=$.requireComponent,Nt=$.property,Nn=GameCore.Events,Ni=globalThis.game.event,Nr=(OK=O8("DashboardScreen"),OY=Ne(Bi),Oj=Nt(O6),OX=tj.required,OJ=Nt(ea),OZ=tj.required,OQ=tj.required,OK(O$=O9(O$=OY((O1=L((O0=function(P){C(_,P);var I,R,E,L,F,D,M,x,z,q,U,H,W,V,K,j,X,J,Z,Q,$,ee,et=A(_);function _(){var a;o(this,_);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=et.call.apply(et,[this].concat(A)),O(a,"container",O1,N(a)),O(a,"blackMaskOpacity",O2,N(a)),O(a,"screen",O3,N(a)),a.isEnterFirstTime=!0,a.shouldRunRoadRevealAnim=!1,a.giftBlockOfChapterEnd=null,a.shouldHideAllButtons=!1,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("ScrollerDashboardScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},a.loadAndSetPlayerRankInfo())},a.handleClosingScreen=function(){var o=B(function(o){return _ts_generator(this,function(C){return a.validateEventPayload(o)&&a.unscheduleAllCallbacks(),[2]})});return function(a){return o.apply(this,arguments)}}(),a}return a(_,[{key:"getContainer",value:function(){return this.container}},{key:"screenData",get:function(){return this.screen.data}},{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents(),td.gameScene.gamePlay.loader.loadAllStampCardAsync()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,_)}},{key:"onLoad",value:function(){this.registryEvents()}},{key:"registryEvents",value:function(){var a=this;this.container.onClickPlayGameButton=function(){var o=td.gameScene.gamePlay.gameDataManager.getLevel();a.handleClickPlayGame(o)},this.container.onClickSettingButton=function(){a.handleClickSetting()},this.container.onClickTournamentButton=function(){a.handleClickTournamentButton()},this.container.onClickPlayWithFriendsButton=function(){a.handleClickPlayWithFriendsButton()},this.container.onClickDailyMissionButton=function(){a.handleClickDailyMissionButton()},this.container.onClickShopButton=function(){a.handleClickShopButton()},this.container.onClickGlobalLeaderboardButton=function(){a.handleClickGlobalLeaderboardButton()},this.container.onClickDailyRewardButton=function(){a.handleClickDailyRewardButton()},this.container.onClickDailyChallengeButton=function(){a.handleClickDailyChallengeButton()}}},{key:"handleWhenSucceedAddLB",value:function(){var a=td.gameScene.gamePlay.canUnlockTournamentFeature();this.container.toggleTournamentButton(a),this.loadAndSetPlayerRankInfo(),td.gameScene.tournament.isJoinedCurTour()&&td.gameScene.gamePlay.timerHandler.startLeaderboardCountDown()}},{key:"listenScreenEvents",value:function(){Ni.on(Nn.OPENING_SCREEN,this.handleOpeningScreen),Ni.on(Nn.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Ni.off(Nn.OPENING_SCREEN,this.handleOpeningScreen),Ni.off(Nn.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"checkCanShowActionButtons",value:function(){var a=this.screenData;this.container.toggleTournamentButton(a.unlockTournament),this.container.toggleChallengeFriendsButton(a.unlockPWF),this.container.toggleShopButton(a.unlockShop),this.container.toggleMissionButton(a.unlockMission),this.container.toggleGlobalLeaderboardButton(a.unlockGlobalLb),this.container.toggleDailyRewardButton(a.unlockDailyReward),this.container.updateItemsAlignment()}},{key:"open",value:(ee=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(this.checkCanShowActionButtons(),this.prepareOpenScreen(),!this.enabled)return[3,4];return a=td.gameScene.gamePlay.gameDataManager.getLevel(),o=[],td.levelManager.preloadLevelDataAsync(a),td.gameScene.toggleGamePlayScreen(!1),this.container.playLeafRiseEffect(),C=this.handleTournamentRewardOrCountDown(),o.push(C),this.shouldHideAllButtons||(o.push(this.container.fadeIn({delayMask:!this.isEnterFirstTime})),o.push(td.gameScene.rubyBarComp.runShowAnimationAsync())),this.isEnterFirstTime&&(o.push(this.playFadeOutBlackMaskAnim()),td.gameScene.toggleBlockInputContainer(!0)),[4,Promise.all(o)];case 1:return A.sent(),th.playSound(tZ.DASHBOARD_OPEN,{volume:.2}),[4,this.tryToRunRoadRevealAnimation()];case 2:return A.sent(),[4,this.tryToOpenChapterCompleteScreen()];case 3:A.sent(),this.isEnterFirstTime&&(this.isEnterFirstTime=!1,td.gameScene.toggleBlockInputContainer(!1)),Ni.emit(Nn.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),Ni.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),A.label=4;case 4:return[2]}})}),function(){return ee.apply(this,arguments)})},{key:"handleTournamentRewardOrCountDown",value:($=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!(a=td.gameScene.gamePlay.tournamentStack.getLastTournament()))return[3,2];if(o=td.gameScene.gamePlay.checkCanClaimRewardTournament(a),C=this.screenData.isGetReward,!("processing-claim-reward"===o&&!C))return[3,2];return[4,td.gameScene.gamePlay.claimRewardTournament(a.leaderboardId)];case 1:if(A.sent())return[2];td.gameScene.gamePlay.timerHandler.startLeaderboardCountDown(),A.label=2;case 2:return[2]}})}),function(){return $.apply(this,arguments)})},{key:"close",value:(Q=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.fadeOutScreen()];case 1:return a.sent(),this.container.turnOnAllHeaderButtons(),this.container.stopLeafRiseEffect(),this.node.active=!1,Ni.emit(Nn.CLOSED_SCREEN,{screenName:this.node.name}),Ni.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return Q.apply(this,arguments)})},{key:"tryToHideLatestStamp",value:function(){var a=this.getTheLatestLevelBlock();if(a){var o=a.getStampBlock();o&&(a.getLevel()===t4.MAX_LEVEL&&this.screenData.isPlayedFinalLevel||(this.setGiftForLevelBlock(a),o.toggleChildrenStampBlock(!1)))}}},{key:"setGiftForLevelBlock",value:function(a){var o=this.container.getGiftBlockPool().getAvailableGiftBlock();o.prepareGiftBlock(),a.node.addChild(o.node),this.giftBlockOfChapterEnd=o.node}},{key:"fadeOutScreen",value:(Z=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(a=this.node.getComponent(ea)))return[3,2];return a.opacity=255,o=Y(a).to(.5,{opacity:0}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return Z.apply(this,arguments)})},{key:"tryToOpenChapterCompleteScreen",value:(J=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(!this.screenData.isGetReward)return[3,4];return[4,ts.waitTweenAsync(1)];case 1:return o.sent(),[4,Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),this.container.fadeOutPlayGameAndSettingButtons()])];case 2:return o.sent(),this.giftBlockOfChapterEnd&&(this.giftBlockOfChapterEnd.active=!1),a=td.gameScene.gamePlay.gameDataManager.getLevel(),[4,t_.openScreenAsync(tP.CHAPTER_COMPLETE_SCREEN,{level:a})];case 3:o.sent(),this.screenData.isGetReward=void 0,o.label=4;case 4:return[2]}})}),function(){return J.apply(this,arguments)})},{key:"runRoadRevealLeftAnim",value:(X=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if((o=(a=td.gameScene.gamePlay).gameDataManager.getDashboardAnimLevel())>=(C=a.gameDataManager.getLevel()))return[3,2];return(A=this.container.getScroller()).refresh(),A.prepareRoadRevealAnimation(o),[4,A.runRoadRevealAnimation({fromLevel:o,toLevel:C,shouldRunChapterEndFirst:!1})];case 1:P.sent(),this.shouldRunRoadRevealAnim=!1,a.gameDataManager.setGameData({dashboardAnimLevel:C}),P.label=2;case 2:return[2]}})}),function(){return X.apply(this,arguments)})},{key:"tryToRunRoadRevealAnimation",value:(j=B(function(){var a,o,C,A,P,I,B,R,E;return _ts_generator(this,function(L){switch(L.label){case 0:if(!this.shouldRunRoadRevealAnim)return[3,2];if(o=null!=(a=this.screenData.isGetReward)&&a,C=td.gameScene.gamePlay,A=this.container.getScroller(),P=C.gameDataManager.getLevel(),I=C.gameDataManager.getDashboardAnimLevel(),!!td.mapDataManager.isSpecialLevel(I))return[3,2];return B=P-1,P===t4.MAX_LEVEL&&(B=P),R=o?B:P,[4,A.runRoadRevealAnimation({fromLevel:I,toLevel:R,shouldRunChapterEndFirst:o})];case 1:if(L.sent(),o)E=td.levelManager.getLevel(),C.gameDataManager.setGameData({dashboardAnimLevel:E});else this.shouldRunRoadRevealAnim=!1,C.gameDataManager.setGameData({dashboardAnimLevel:P});L.label=2;case 2:return[2]}})}),function(){return j.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"getTheLatestLevelBlock",value:function(a){var o=arguments.length>0&&void 0!==a?a:{ignoreIfNotGetReward:!1},C=this.screen.data.isGetReward,A=this.container.getScroller();if(void 0!==C||o.ignoreIfNotGetReward){var P=td.levelManager.getLevel();return A.getLevelBlock(P)}}},{key:"prepareOpenScreen",value:function(){if(this.enabled){var a=this.node.getComponent(ea);if(a){a.opacity=255;var o=td.gameScene.gamePlay,C=o.gameDataManager.getLevel(),A=o.gameDataManager.getDashboardAnimLevel(),P=td.levelManager.getLevel(),I=this.container.getScroller();P!==C&&td.gameScene.restartLevel(),this.container.setPlayLevelButtonLabel(C),this.container.setTournamentLocalizedText(),this.container.updateHeaderButtonData(),this.container.prepareFadeIn(),I.refresh(),I.moveToLevelBlock(A),this.tryToHideLatestStamp(),this.shouldRunRoadRevealAnim=C>A,this.shouldRunRoadRevealAnim&&I.prepareRoadRevealAnimation(A),td.gameScene.rubyBarComp.runWidgetRightTypeUpdateAnimation("default"),this.screenData.isGetReward&&(this.shouldHideAllButtons=!0)}}}},{key:"playFadeOutBlackMaskAnim",value:(K=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=this,this.blackMaskOpacity.node.active=!0,this.blackMaskOpacity.opacity=255,o=Y(this.blackMaskOpacity).to(.35,{opacity:0}).call(function(){a.blackMaskOpacity.node.active=!1}),[4,ts.runTweenAsync(o)];case 1:return C.sent(),[2]}})}),function(){return K.apply(this,arguments)})},{key:"handleClickPlayGame",value:(V=B(function(a){var o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return o=td.gameScene.gamePlay,td.gameScene.toggleGamePlayScreen(!0),td.gameScene.toggleBlockInputContainer(!0),tR(a),tE(a),tL(a),A=(C=o.gameUI).header,P=C.footer,tp.trackCurrentPage("GameScene",!0),P.toggleItems(!1),[4,o.loadLevelResourcesAsync(a)];case 1:if(!I.sent())return[3,4];return Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),this.container.fadeOutPlayGameAndSettingButtons()]),[4,t_.closeScreenAsync(tP.DASHBOARD_SCREEN)];case 2:return I.sent(),[4,td.gameScene.gamePlay.handleOpenLevel(a)];case 3:return I.sent(),A.challengeBlock.setActive(!1),td.gameScene.uiManager.setCurrentScreen(null),th.playMusic(tZ.BACKGROUND_MUSIC),td.gameScene.toggleBlockInputContainer(!1),[3,5];case 4:td.gameScene.toggleBlockInputContainer(!1),I.label=5;case 5:return[2]}})}),function(a){return V.apply(this,arguments)})},{key:"handleClickSetting",value:(W=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,td.gameScene.waitUntilResourcesScreenLoaded(tP.SETTINGS_SCREEN)];case 1:return o.sent(),a=td.gameScene.uiManager,[4,Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),this.container.fadeOutPlayGameAndSettingButtons()])];case 2:return o.sent(),[4,a.openSettingScreenAsync()];case 3:return o.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return W.apply(this,arguments)})},{key:"playFadeInButtons",value:(H=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(!!this.shouldHideAllButtons)return[3,2];return a=td.gameScene.gamePlay.gameDataManager.getLevel(),this.container.setPlayLevelButtonLabel(a),this.container.prepareFadeIn(),[4,this.container.fadeIn({delayMask:!1})];case 1:o.sent(),o.label=2;case 2:return[2]}})}),function(){return H.apply(this,arguments)})},{key:"handleClickTournamentButton",value:(U=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(td.gameScene.toggleBlockInputContainer(!0),a=td.gameScene.tournament.isFromTournamentPost(),o=td.gameScene.tournament.isInTournamentContext(),C=td.gameScene.tournament.isJoinedCurTour(),A=null!==td.tournamentManager.getSelectedLeaderboardId(),!o&&!A)return[2,(td.gameScene.showLoadingScreen(3,t7.NO_TOURNAMENT_RIGHT_NOW,!1),void td.gameScene.toggleBlockInputContainer(!1))];return[4,Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),this.container.fadeOutPlayGameAndSettingButtons()])];case 1:if(P.sent(),!(o||a||C))return[3,3];return[4,Promise.all([td.gameScene.uiManager.openLeaderboardScreenAsync(),t_.closeScreenAsync(tP.DASHBOARD_SCREEN)])];case 2:return P.sent(),[3,5];case 3:return td.gameScene.gamePlay.timerHandler.startLeaderboardCountDown(),[4,t_.openScreenAsync(tP.TOURNAMENT_INFO_SCREEN)];case 4:P.sent(),P.label=5;case 5:return td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return U.apply(this,arguments)})},{key:"handleClickPlayWithFriendsButton",value:(q=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,td.gameScene.waitUntilResourcesScreenLoaded(tP.CHALLENGE_FRIENDS_SCREEN)];case 1:return o.sent(),a=td.gameScene.uiManager,td.gameScene.loadScreenPrefabAsync(tP.BATTLE_SCREEN),[4,Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),this.container.fadeOutPlayGameAndSettingButtons()])];case 2:return o.sent(),[4,a.openChallengeFriendScreenAsync()];case 3:return o.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return q.apply(this,arguments)})},{key:"handleClickDailyMissionButton",value:(z=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return(a=td.gameScene).toggleBlockInputContainer(!0),[4,td.gameScene.waitUntilResourcesScreenLoaded(tP.DAILY_MISSIONS_SCREEN)];case 1:return C.sent(),o=td.gameScene.gamePlay.gameDataManager.getLevel(),[4,Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),this.container.fadeOutPlayGameAndSettingButtons()])];case 2:return C.sent(),[4,t_.openScreenAsync(tP.DAILY_MISSIONS_SCREEN,{level:o})];case 3:return C.sent(),a.toggleBlockInputContainer(!1),[2]}})}),function(){return z.apply(this,arguments)})},{key:"handleClickShopButton",value:(x=B(function(){return _ts_generator(this,function(a){return[2,td.gameScene.shop.handleOpenShopScreenAsync()]})}),function(){return x.apply(this,arguments)})},{key:"handleClickGlobalLeaderboardButton",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,td.gameScene.waitUntilResourcesScreenLoaded(tP.GLOBAL_LEADERBOARD_SCREEN)];case 1:return a.sent(),[4,Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),this.container.fadeOutPlayGameAndSettingButtons()])];case 2:return a.sent(),[4,Promise.all([td.gameScene.uiManager.openGlobalLeaderboardScreenAsync(),t_.closeScreenAsync(tP.DASHBOARD_SCREEN)])];case 3:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return M.apply(this,arguments)})},{key:"handleClickDailyRewardButton",value:(D=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),o=(a=td.gameScene.gamePlay).gameDataManager.getLevel(),[4,Promise.all([td.gameScene.waitUntilResourcesScreenLoaded(tP.DAILY_REWARD_SCREEN),a.setBackgroundFor({level:o})])];case 1:return C.sent(),td.gameScene.closeLoadingScreen(),[4,Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),this.container.fadeOutPlayGameAndSettingButtons()])];case 2:return C.sent(),[4,Promise.all([t_.openScreenAsync(tP.DAILY_REWARD_SCREEN),t_.closeScreenAsync(tP.DASHBOARD_SCREEN)])];case 3:return C.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return D.apply(this,arguments)})},{key:"loadAndSetPlayerRankInfo",value:(F=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(a=td.gameScene.gamePlay.resultTournamentLoader,!(o=td.tournamentManager.getSelectedLeaderboardId()))return[3,3];if(C=a.getCurrentPlayerEntry())return[3,2];return[4,a.loadCurrentPlayerEntry(o)];case 1:C=I.sent(),I.label=2;case 2:if(C)P=(A=C.rank)<=9?A.toString():"9+",this.container.setRankLabel(P);else this.container.setRankLabel("");return[3,4];case 3:this.container.setRankLabel(""),I.label=4;case 4:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"updateTournamentTimer",value:function(a){if(this.container.setTournamentLabel(a),a<=0){var o=td.tournamentManager.getSelectedLeaderboardId(),C=td.gameScene.gamePlay.gameDataManager.getMultiData(["tournamentsJoined"]).tournamentsJoined;if(!o)return;var A=C.find(function(a){return a.leaderboardId===o});if(!A)return;var P={leaderboardId:A.leaderboardId,expiredTimeLeaderboard:A.expiredTimeLeaderboard,isRewardGiven:A.isRewardGiven};return"DashBoardScreen"===tp.getCurrentPage()?void("processing-claim-reward"===td.gameScene.gamePlay.checkCanClaimRewardTournament(P)&&td.gameScene.gamePlay.claimRewardTournament(P.leaderboardId)):void td.gameScene.gamePlay.tournamentStack.pushTournament(P)}}},{key:"fadeOutContainer",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.container.fadeOutPlayGameAndSettingButtons()];case 1:return a.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"playAfterReceivingGiftAnim",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.shouldHideAllButtons=!1,[4,Promise.all([this.playFadeInButtons(),td.gameScene.rubyBarComp.runShowAnimationAsync()])];case 1:return a.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"getPlayGameButton",value:function(){return this.container.playGameButton}},{key:"runPlayButtonCollectItemAnimation",value:function(){return this.container.runPlayButtonCollectItemAnimation()}},{key:"handleClickDailyChallengeButton",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),a=td.gameScene.gamePlay.loader,Ni.catchUp(tl.WASM_MODULE_LOADED,a.loadSpinePrefabAsync),[4,td.gameScene.gamePlay.startDailyChallengeGameAsync()];case 1:return o.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"toggleDailyRewardButton",value:function(a){this.container.toggleDailyRewardButton(a)}},{key:"toggleTournamentButton",value:function(a){this.container.toggleTournamentButton(a)}},{key:"handleSetLevelInDevTool",value:(I=B(function(a){return _ts_generator(this,function(o){return this.container.setPlayLevelButtonLabel(a),this.container.getScroller().moveToLevelBlock(a),[2]})}),function(a){return I.apply(this,arguments)})}]),_}(eo)).prototype,"container",[Oj,OX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O2=L(O0.prototype,"blackMaskOpacity",[OJ,OZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O3=L(O0.prototype,"screen",[OQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O$=O0))||O$)||O$)||O$);U._RF.pop(),U._RF.push({},"c851drAvE5F8oo6TFm6AHpK","UIManager",void 0);var Na,No,Ns,Nl,Nu,Nc=globalThis.game,Nh=Nc.event,Np=Nc.player,Nd=GameCore.Events,Nf=$.ccclass,Ny=($.property,Nf("UIManager")(O7=function(P){C(g,P);var I,R,E,L,O,N,F,D,M,z,q=A(g);function g(){var a;o(this,g);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=q.call.apply(q,[this].concat(A))).dashboardScreen=void 0,a.resultScreen=void 0,a.noMoreMoveScreen=void 0,a.screensMap=new Map,a.currentScreen=null,a.handleOpeningScreen=function(o){var C;if(o.screenName!==tO[tP.SETTINGS_SCREEN]){var A=(x(C={},tO[tP.DASHBOARD_SCREEN],Nr),x(C,tO[tP.NO_MORE_MOVE_SCREEN],B6),C)[o.screenName];if(A){var P=a.getScreenBy(A);switch(a.currentScreen=P.node,o.screenName){case tO[tP.DASHBOARD_SCREEN]:a.dashboardScreen=P.node;break;case tO[tP.RESULT_SCREEN]:a.resultScreen=P.node;break;case tO[tP.NO_MORE_MOVE_SCREEN]:a.noMoreMoveScreen=P.node}}}},a.handleScreenReturn=B(function(){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(a.currentScreen!==a.dashboardScreen)return[3,3];if(!(null!=(o=a.dashboardScreen.getComponent(Nr))&&o.node.active))return[3,2];return[4,o.playFadeInButtons()];case 1:C.sent(),C.label=2;case 2:C.label=3;case 3:return a.node.scene.emit(t2.FADED_IN_DASHBOARD_DONE),[2]}})}),a}return a(g,[{key:"getScreen",value:function(a,o){var C=this.screensMap.get(a);if(C)return C.getComponent(o)}},{key:"__preload",value:function(){var a;this.validateRequiredComponents(),this.registerEvents();var o=null==(a=eh.getScene())?void 0:a.getComponentInChildren("GameScreen");this.currentScreen=o}},{key:"registerEvents",value:function(){Nh.on(Nd.OPENING_SCREEN,this.handleOpeningScreen),this.node.on(eC.CHILD_ADDED,this.onChildAdded,this),this.node.on(eC.CHILD_REMOVED,this.onChildRemoved,this)}},{key:"onDestroy",value:function(){Nh.off(Nd.OPENING_SCREEN,this.handleOpeningScreen),this.node.on(eC.CHILD_ADDED,this.onChildAdded,this),this.node.on(eC.CHILD_REMOVED,this.onChildRemoved,this)}},{key:"onChildAdded",value:function(a){var o=a.getComponent(Bi);o&&this.screensMap.set(a.name,o)}},{key:"onChildRemoved",value:function(a){a&&a.getComponent(Bi)&&this.screensMap.delete(a.name)}},{key:"getCurrentScreen",value:function(){return this.currentScreen}},{key:"setCurrentScreen",value:function(a){this.currentScreen=a}},{key:"tryToCloseDashboardScreen",value:(z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!(null!==this.currentScreen&&this.currentScreen.getComponent(Nr)))return[3,2];return[4,t_.closeScreenAsync(tP.DASHBOARD_SCREEN)];case 1:a.sent(),th.playMusic(tZ.BACKGROUND_MUSIC),a.label=2;case 2:return[2]}})}),function(){return z.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"getScreenBy",value:function(a){var o,C=null==(o=eh.getScene())?void 0:o.getComponentInChildren(a);if(!C)throw new Error("".concat(a.name," is not defined"));return C}},{key:"getDashboardScreen",value:function(){return this.dashboardScreen?this.dashboardScreen.getComponent(Nr):null}},{key:"openDashboardScreenAsync",value:(M=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return t8.tryUpdateData(),C=(o=td.gameScene.gamePlay).gameDataManager.getLevel(),A={isGetReward:null==a?void 0:a.isGetReward,isPlayedFinalLevel:o.isPlayedFinalLevel,unlockTournament:o.canUnlockTournamentFeature(),unlockShop:td.gameScene.shop.canShowShopAndRubyBar(),unlockPWF:C>1,unlockGlobalLb:!0,unlockMission:!0,unlockDailyReward:t8.canClaimReward()},[4,t_.openScreenAsync(tP.DASHBOARD_SCREEN,A)];case 1:return P.sent(),[2]}})}),function(a){return M.apply(this,arguments)})},{key:"openLeaderboardScreenAsync",value:(D=B(function(a){var o,C,A,P,I,B,R;return _ts_generator(this,function(E){switch(E.label){case 0:return C=td.gameScene.gamePlay.resultTournamentLoader,A=null==a?void 0:a.leaderboardId,P=C.getCurrentPlayerEntry(),I=C.getLeaderboard(),B=C.getAllowLoadNewData(),R={leaderboardId:A,shouldOpenPopupJoinTournament:null==(o=null==a?void 0:a.shouldOpenPopupJoinTournament)||o,currentPlayer:P,leaders:I,allowLoadNewData:B},[4,t_.openScreenAsync(tP.LEADERBOARD_SCREEN,R)];case 1:return E.sent(),[2]}})}),function(a){return D.apply(this,arguments)})},{key:"openGlobalLeaderboardScreenAsync",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return o={leaderboardId:(a=td.gameScene.gamePlay.globalLeaderboardLoader).getGlobalLeaderboardId(),currentPlayer:a.getCurrentPlayerEntry(),leaders:a.getLeaderboard(),allowLoadNewData:a.getAllowLoadNewData()},[4,t_.openScreenAsync(tP.GLOBAL_LEADERBOARD_SCREEN,o)];case 1:return C.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"openResultTournamentScreenAsync",value:(N=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return o={leaders:(a=td.gameScene.gamePlay.resultTournamentLoader).getRankingLeaders(),currentRank:a.getCurrentRank(),newScore:a.getNewScore(),playerEntry:a.getNewPlayerEntry(),allowLoadNewData:a.getAllowLoadNewData()},[4,t_.openScreenAsync(tP.RESULT_TOURNAMENT_SCREEN,o)];case 1:return C.sent(),[2]}})}),function(){return N.apply(this,arguments)})},{key:"openChallengeFriendScreenAsync",value:(O=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a={playerLevel:td.gameScene.gamePlay.gameDataManager.getLevel(),playerPhoto:Np.getPlayer().photo},[4,t_.openScreenAsync(tP.CHALLENGE_FRIENDS_SCREEN,a)];case 1:return o.sent(),[2]}})}),function(){return O.apply(this,arguments)})},{key:"openResultChallengeFriendScreenAsync",value:(L=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o={playerLevel:td.gameScene.gamePlay.gameDataManager.getLevel(),playingLevel:td.levelManager.getLevel(),newestScore:null!=a?a:0,resultInfo:tb.getResultStatus()},[4,t_.openScreenAsync(tP.RESULT_CHALLENGE_FRIENDS_SCREEN,o)];case 1:return C.sent(),[2]}})}),function(a){return L.apply(this,arguments)})},{key:"openSettingScreenAsync",value:(E=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return a=td.gameScene.gamePlay,o=Np.getPlayerSettings().music,C=Np.getPlayerSettings().sound,A=Np.getPlayerSettings().vibrate,I={music:o,sound:C,vibrate:A,tutorialLevel:t4.MIN_LEVEL,playerLevel:a.gameDataManager.getLevel(),playerId:(P=Np.getPlayer()).playerId,playerName:P.name,playerPhoto:P.photo},[4,t_.openScreenAsync(tP.SETTINGS_SCREEN,I)];case 1:return B.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"openResultScreenAsync",value:(R=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(a=td.gameScene.gamePlay,!(o=td.levelManager.getLevel()))return[3,6];if(C={canShowButtons:!a.canShowChapterCompleteScreen(),level:o,playerLevel:a.gameDataManager.getLevel(),stampName:td.mapDataManager.getCurrentCardName()},"daily-challenge"!==game.match.getMatchState().mode)return[3,3];return[4,td.gameScene.waitUntilResourcesScreenLoaded(tP.RESULT_DAILY_SCREEN)];case 1:return A.sent(),[4,t_.openScreenAsync(tP.RESULT_DAILY_SCREEN,C)];case 2:return[2,void A.sent()];case 3:return[4,td.gameScene.waitUntilResourcesScreenLoaded(tP.RESULT_SCREEN)];case 4:return A.sent(),[4,t_.openScreenAsync(tP.RESULT_SCREEN,C)];case 5:A.sent(),A.label=6;case 6:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"openNoMoreMoveScreenAsync",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a={level:td.levelManager.getLevel(),stampName:td.mapDataManager.getCurrentCardName()},[4,t_.openScreenAsync(tP.NO_MORE_MOVE_SCREEN,a)];case 1:return o.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),g}(eo))||O7);U._RF.pop(),U._RF.push({},"03129KnrZpAl4ddHKo6IvJQ","BurstLandingParticle",void 0);var Nv,Nm,Ng,Nb,Nk,Nw,NS,NT,NC,NA,N_,NP=$.ccclass,NI=$.property,NB=(Na=NP("BurstLandingParticle"),No=NI(eV),Ns=tj.required,Na((Nu=L((Nl=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"dustParticle",Nu,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"playVfx",value:function(){this.node.active=!0,this.resetVfx(),this.dustParticle.addParticle(),this.checkAllParticlesStopped()}},{key:"resetVfx",value:function(){this.dustParticle.resetSystem()}},{key:"stopVfx",value:function(){this.dustParticle.stopSystem()}},{key:"checkAllParticlesStopped",value:function(){this.dustParticle.stopped?this.stopAllParticles():this.scheduleOnce(this.checkAllParticlesStopped,.8)}},{key:"stopAllParticles",value:function(){this.dustParticle.stopSystemAndClearAllParticles(),this.node.parent=null,this.node.active=!1}}]),r}(eo)).prototype,"dustParticle",[No,Ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nl))||Nl);U._RF.pop(),U._RF.push({},"1eb90seTgdE0KXdsb49Aath","EmitterTile",void 0);var NR,NE,NL,NO,NN,NF=$.ccclass,ND=$.property,NM=(Nv=NF("EmitterTile"),Nm=ND(eV),Ng=tj.required,Nb=ND(eV),Nk=tj.required,Nw=ND(eV),NS=tj.required,Nv((NC=L((NT=function(P){C(y,P);var I,R,E,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"soapBubble",NC,N(a)),O(a,"brightParticle",NA,N(a)),O(a,"brightDustFlying",N_,N(a)),a}return a(y,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,y)}},{key:"runSoapBubble",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.soapBubble.resetSystem(),this.soapBubble.addParticle(),[4,ts.waitTweenAsync(1)];case 1:return a.sent(),this.soapBubble.stopSystem(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"runBrightParticle",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.brightParticle.resetSystem(),this.brightParticle.addParticle(),[4,ts.waitTweenAsync(.2)];case 1:return a.sent(),this.brightParticle.stopSystem(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"runBrightDustFlying",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.brightDustFlying.resetSystem(),this.brightDustFlying.addParticle(),[4,ts.waitTweenAsync(.2)];case 1:return a.sent(),this.brightDustFlying.stopSystem(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"waitFinish",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!(this.soapBubble.particleCount>0||this.brightParticle.particleCount>0))return[3,3];return[4,ts.waitTweenAsync(.1)];case 1:a.sent(),a.label=2;case 2:return[3,0];case 3:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"show",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.node.active=!0,[4,Promise.all([this.runSoapBubble(),this.runBrightParticle(),this.runBrightDustFlying()])];case 1:return a.sent(),[4,this.waitFinish()];case 2:return a.sent(),this.waitForAllParticlesToStop(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"waitForAllParticlesToStop",value:function(){this.brightDustFlying.stopped&&this.soapBubble.stopped&&this.brightParticle.stopped?this.stopAllParticles():this.scheduleOnce(this.waitForAllParticlesToStop,.3)}},{key:"stopAllParticles",value:function(){this.brightDustFlying.stopSystemAndClearAllParticles(),this.soapBubble.stopSystemAndClearAllParticles(),this.brightParticle.stopSystemAndClearAllParticles(),this.node.active=!1}}]),y}(eo)).prototype,"soapBubble",[Nm,Ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NA=L(NT.prototype,"brightParticle",[Nb,Nk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_=L(NT.prototype,"brightDustFlying",[Nw,NS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NT))||NT);U._RF.pop(),U._RF.push({},"6aae01iBeFIY47ASHxauT29","ExplosionTileVFX",void 0);var Nx,Nz,NG,Nq,NU,NH=$.ccclass,NW=$.property,NV=(NR=NH("ExplosionTileVFX"),NE=NW([eV]),NL=tj.required(ni(eV)),NR((NN=L((NO=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"effects",NN,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"playVfx",value:function(){this.node.active=!0,this.resetVFX(),this.addParticles(),this.checkAllParticlesStopped()}},{key:"resetVFX",value:function(){var a,o=E(this.effects);try{for(o.s();!(a=o.n()).done;)a.value.resetSystem()}catch(a){o.e(a)}finally{o.f()}}},{key:"addParticles",value:function(){var a,o=E(this.effects);try{for(o.s();!(a=o.n()).done;)a.value.addParticle()}catch(a){o.e(a)}finally{o.f()}}},{key:"stopVfx",value:function(){var a,o=E(this.effects);try{for(o.s();!(a=o.n()).done;)a.value.stopSystem()}catch(a){o.e(a)}finally{o.f()}}},{key:"checkAllParticlesStopped",value:function(){this.effects.every(function(a){return a.stopped})?this.onAllParticlesStopped():this.scheduleOnce(this.checkAllParticlesStopped,1.5)}},{key:"onAllParticlesStopped",value:function(){this.node.active=!1}}]),r}(eo)).prototype,"effects",[NE,NL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),NO))||NO);U._RF.pop(),U._RF.push({},"e6f0eyvREZOsIBbu5+6q4ko","StarTileParticle",void 0);var NK,NY,Nj,NX,NJ,NZ,NQ,N$,N0,N1,N2,N3,N4,N5,N6,N7,N8,N9,Fe,Ft,Fn,Fi,Fr,Fa,Fo,Fs,Fl=$.ccclass,Fu=$.property,Fc=(Nx=Fl("StarTileParticle"),Nz=Fu(eV),NG=tj.required,Nx((NU=L((Nq=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"starParticle",NU,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"playVfx",value:function(){this.node.active=!0,this.resetVfx(),this.starParticle.addParticle(),this.checkAllParticlesStopped()}},{key:"resetVfx",value:function(){this.starParticle.resetSystem()}},{key:"stopVfx",value:function(){this.starParticle.stopSystem()}},{key:"checkAllParticlesStopped",value:function(){this.starParticle.stopped?this.stopAllParticles():this.scheduleOnce(this.checkAllParticlesStopped,.8)}},{key:"stopAllParticles",value:function(){this.starParticle.stopSystemAndClearAllParticles(),this.node.active=!1}}]),r}(eo)).prototype,"starParticle",[Nz,NG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nq))||Nq);U._RF.pop(),U._RF.push({},"3fc24ZveCBOx6BrZ37xATK2","VFXManager",void 0);var Fh,Fp=$.ccclass,Fd=$.property,Ff=(NK=Fp("VFXManager"),NY=Fd(ee),Nj=tj.required,NX=Fd(ee),NJ=tj.required,NZ=Fd(ee),NQ=tj.required,N$=Fd(eY),N0=tj.required,N1=Fd(eY),N2=tj.required,N3=Fd(eY),N4=tj.required,N5=Fd(eY),N6=tj.required,N7=Fd(eY),N8=tj.required,NK((Fe=L((N9=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"starTileParent",Fe,N(a)),O(a,"explosionWithMatParent",Ft,N(a)),O(a,"explosionWithoutMatParent",Fn,N(a)),O(a,"explosionTileVFXWithMatPrefab",Fi,N(a)),O(a,"explosionTileVFXWithoutMatPrefab",Fr,N(a)),O(a,"emitterTilePrefab",Fa,N(a)),O(a,"starTilePrefab",Fo,N(a)),O(a,"burstLandingPrefab",Fs,N(a)),a.explosionTilesWithMatPool=[],a.starTilesPool=[],a.explosionTilesWithoutMatPool=[],a.emitterTilesPool=[],a.burstLandingTilesPool=[],a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"start",value:function(){for(var a=0;a<10;a++)this.getEmitterTile().node.active=!1,this.getExplosionTileWithMatVFX().node.active=!1,this.getExplosionTileWithoutMatVFX().node.active=!1,this.getStarTileVFX().node.active=!1,this.getBurstLandingVFX().node.active=!1}},{key:"getEmitterTile",value:function(){var a,o=E(this.emitterTilesPool);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.node.active)return C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.emitterTilePrefab).getComponent(NM);return this.emitterTilesPool.push(A),A}},{key:"getExplosionTileWithMatVFX",value:function(){var a,o=E(this.explosionTilesWithMatPool);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.node.active)return C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.explosionTileVFXWithMatPrefab);A.setParent(this.explosionWithMatParent);var P=A.getComponent(NV);return this.explosionTilesWithMatPool.push(P),P}},{key:"getExplosionTileWithoutMatVFX",value:function(){var a,o=E(this.explosionTilesWithoutMatPool);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.node.active)return C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.explosionTileVFXWithoutMatPrefab);A.setParent(this.explosionWithoutMatParent);var P=A.getComponent(NV);return this.explosionTilesWithoutMatPool.push(P),P}},{key:"getStarTileVFX",value:function(){var a,o=E(this.starTilesPool);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.node.active)return C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.starTilePrefab);A.setParent(this.starTileParent);var P=A.getComponent(Fc);return this.starTilesPool.push(P),P}},{key:"getBurstLandingVFX",value:function(){var a,o=E(this.burstLandingTilesPool);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(C.node){if(!C.node.active)return C}else{var A=this.burstLandingTilesPool.indexOf(C);this.burstLandingTilesPool.splice(A,1)}}}catch(a){o.e(a)}finally{o.f()}var P=ej(this.burstLandingPrefab).getComponent(NB);return this.burstLandingTilesPool.push(P),P}}]),r}(eo)).prototype,"starTileParent",[NY,Nj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ft=L(N9.prototype,"explosionWithMatParent",[NX,NJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fn=L(N9.prototype,"explosionWithoutMatParent",[NZ,NQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fi=L(N9.prototype,"explosionTileVFXWithMatPrefab",[N$,N0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fr=L(N9.prototype,"explosionTileVFXWithoutMatPrefab",[N1,N2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=L(N9.prototype,"emitterTilePrefab",[N3,N4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fo=L(N9.prototype,"starTilePrefab",[N5,N6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fs=L(N9.prototype,"burstLandingPrefab",[N7,N8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N9))||N9);U._RF.pop(),U._RF.push({},"f65adw8zB5LlptNzx0Mx5eu","ParticlesOptimizer",void 0);var Fy=(0,$.ccclass)("ParticlesOptimizer")(Fh=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).particleSystem=void 0,a.simulatorsPool=[],a}return a(r,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(eV)}},{key:"playEffect",value:function(a){a.node,a.canFollow}}]),r}(eo))||Fh;U._RF.pop(),U._RF.push({},"51d2ceSg6hGFabfiFBT3Wmd","ParticlesOptimizerController",void 0),(0,$.ccclass)("ParticlesOptimizerController")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).particles=null,a}return a(r,[{key:"__preload",value:function(){this.particles=this.getComponentsInChildren(Fy)}},{key:"playEffect",value:function(a){var o=a.node,C=a.canFollow;if(this.particles){var A,P=E(this.particles);try{for(P.s();!(A=P.n()).done;)A.value.playEffect({node:o,canFollow:C})}catch(a){P.e(a)}finally{P.f()}}}}]),r}(eo)),U._RF.pop(),U._RF.push({},"b2105Or3thDfocmVaS1PLz7","DustParticle",void 0),(0,$.ccclass)("DustParticle")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).timeToStop=.1,a}return a(r,[{key:"initParticle",value:function(a){a.maxSize=a.size,a.elapsedTime=0,a.speed=10,a.size=0,a.deltaSize=0,a.currentTime=0,a.cycleDuration=.5,a.life=a.timeToLive,this.setInitPosition(a.pos),this.setDirection(a)}},{key:"setInitPosition",value:function(a){var o=this.node.position.x,C=this.node.position.y;return a.x=o,a.y=C,a}},{key:"setDirection",value:function(a){var o=this.node.position.x,C=this.node.position.y,A=new H(a.pos.x-o,a.pos.y-C).normalize();a.dir=A}},{key:"updateParticle",value:function(a,o){a.elapsedTime>=this.timeToStop?this.updateScaleDown(a):(this.updateScaleUp(a),this.updatePosition(a,o))}},{key:"updateScaleUp",value:function(a){var o=(a.life-a.timeToLive)/a.life;a.size=a.maxSize*o}},{key:"updateScaleDown",value:function(a){var o=(a.life-a.timeToLive)/a.life;a.size=a.maxSize*(1-o)}},{key:"updatePosition",value:function(a,o){a.elapsedTime+=o;var C=a.speed*o,A=a.pos.x+C*a.dir.x,P=a.pos.y+C*a.dir.y;a.pos.set(A,P)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"e7459PvJdBPhaKnd5XrSjS6","BrightDustFlyingParticle",void 0),(0,$.ccclass)("BrightDustFlyingParticle")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).customAlpha=0,a.colors=["#206cff","#4bbcf6"],a}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.deltaSize=0,a.life=a.timeToLive,a.cycleDuration=a.life,this.setInitPosition(a.pos),this.randomColor(a),this.setAlpha(a)}},{key:"updateParticle",value:function(a,o){this.updateAlpha(a)}},{key:"setInitPosition",value:function(a){var o=t0.SIZE_AT_CONTAINER.WIDTH,C=t0.SIZE_AT_CONTAINER.HEIGHT,A=a.x,P=a.y;return a.x=A+V.randomRange(-o/4,o/2),a.y=P+V.randomRange(-C/2,C/8),a}},{key:"setAlpha",value:function(a){a.color.a=0,this.customAlpha=V.randomRange(255,255)}},{key:"updateAlpha",value:function(a){var o=1-(a.life-a.timeToLive)%a.cycleDuration/a.cycleDuration;a.color.a=this.customAlpha*Math.sin(o*Math.PI)}},{key:"randomColor",value:function(a){var o=this.colors[Math.floor(Math.random()*this.colors.length)];a.color=new K(o)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"b3806A2aadFVoBmeNwHrtA4","BrightParticle",void 0),(0,$.ccclass)("BrightParticle")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.size=0,a.deltaSize=0,a.life=a.timeToLive,a.cycleDuration=a.life,this.setInitPosition(a.pos)}},{key:"updateParticle",value:function(a,o){this.updateScale(a)}},{key:"setInitPosition",value:function(a){var o=t0.SIZE_AT_CONTAINER.WIDTH,C=t0.SIZE_AT_CONTAINER.HEIGHT,A=a.x,P=a.y;return a.x=A+V.randomRange(-o/2,o/2),a.y=P+V.randomRange(-C/2,C/4),a}},{key:"updateScale",value:function(a){var o=1-(a.life-a.timeToLive)%a.cycleDuration/a.cycleDuration;a.size=a.maxSize*Math.sin(o*Math.PI)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"ef9c3m5CDtEgr9t8UgXifjt","SoapBubbleParticle",void 0),(0,$.ccclass)("SoapBubbleParticle")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.size=0,a.deltaSize=0,a.life=a.timeToLive,a.cycleDuration=a.life,this.setInitPosition(a.pos,a)}},{key:"updateParticle",value:function(a,o){this.updateScale(a)}},{key:"setInitPosition",value:function(a,o){var C=t0.SIZE_AT_CONTAINER.WIDTH,A=t0.SIZE_AT_CONTAINER.HEIGHT,P=a.x,I=a.y;return a.x=P+V.randomRange(-C/3,C/1.5),a.y=I+V.randomRange(-A/3,A/1.5),this.setDirection(o,-C/3,C,a.x),a}},{key:"setDirection",value:function(a,o,C,A){a.dir.x=A<o+C/2?V.randomRange(-10,-20):V.randomRange(10,20)}},{key:"updateScale",value:function(a){var o=1-(a.life-a.timeToLive)%a.cycleDuration/a.cycleDuration;a.size=a.maxSize*Math.sin(o*Math.PI)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"3dd00QfZqlISoCP3fZQzVav","GreenSmokeParticle",void 0),(0,$.ccclass)("GreenSmokeParticle")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,this.modifySpeed(a),this.setInitPosition(a.pos)}},{key:"updateParticle",value:function(a,o){}},{key:"setInitPosition",value:function(a){var o=t0.SIZE_AT_CONTAINER.WIDTH,C=t0.SIZE_AT_CONTAINER.HEIGHT,A=a.x,P=a.y;return a.x=A+V.randomRange(A-o/4,o/2),a.y=P+V.randomRange(P-C/4,C/4),a}},{key:"modifySpeed",value:function(a){var o=Math.atan2(0-a.pos.y,0-a.pos.x),C=V.randomRange(40,50);a.dir=new H(-C*Math.cos(o),-C*Math.sin(o))}}]),r}(_3)),U._RF.pop(),U._RF.push({},"02bc92bALlOkYTYnqsWZzOX","OrangeStarParticle",void 0),(0,$.ccclass)("OrangeStarParticle")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).colors=["#ffff00","#ffa500"],a}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.life=a.timeToLive,this.setInitPosition(a.pos),this.modifySpeed(a),this.randomColor(a)}},{key:"updateParticle",value:function(a,o){}},{key:"getRandomPointOnEdge",value:function(a,o,C,A){var P=0,I=0;switch(Math.floor(4*Math.random())+1){case 1:P=Math.random()*(C-a)+a,I=o;break;case 2:P=Math.random()*(C-a)+a,I=A;break;case 3:P=a,I=Math.random()*(A-o)+o;break;case 4:P=C,I=Math.random()*(A-o)+o}return{x:P,y:I}}},{key:"setInitPosition",value:function(a){var o=t0.SIZE_AT_CONTAINER.WIDTH,C=t0.SIZE_AT_CONTAINER.HEIGHT,A=a.x,P=a.y,I=this.getRandomPointOnEdge(A-o/3,P-C/3,o/1.5,C/1.5);a.x=I.x,a.y=I.y;var B=Math.atan2(0-a.y,0-a.x),R=V.randomRange(38,42),E=0-R*Math.cos(B),L=0-R*Math.sin(B);return a.x=E,a.y=L,a}},{key:"modifySpeed",value:function(a){var o=Math.atan2(0-a.pos.y,0-a.pos.x),C=V.randomRange(40,50);a.dir=new H(-C*Math.cos(o),-C*Math.sin(o))}},{key:"randomColor",value:function(a){var o=this.colors[Math.floor(Math.random()*this.colors.length)];a.color=new K(o)}},{key:"_finishedSimulation",value:function(){}}]),r}(_3)),U._RF.pop(),U._RF.push({},"a4d88/h9ldM64c8+xUKNoOb","TwinkleStarParticle",void 0),(0,$.ccclass)("TwinkleStarParticle")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.size=0,a.deltaSize=0,a.cycleDuration=V.randomRange(.4,.6),a.life=a.timeToLive,this.setInitPosition(a.pos)}},{key:"updateParticle",value:function(a,o){this.updateScale(a)}},{key:"setInitPosition",value:function(a){var o=t0.SIZE_AT_CONTAINER.WIDTH,C=t0.SIZE_AT_CONTAINER.HEIGHT,A=a.x,P=a.y;return a.x=A+V.randomRange(A-o/3,o/1.5),a.y=P+V.randomRange(P-C/3,C/1.5),a}},{key:"updateScale",value:function(a){var o=1-(a.life-a.timeToLive)%a.cycleDuration/a.cycleDuration;a.size=a.maxSize*Math.sin(o*Math.PI)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"1e4ccCobxRCoImOTqPAPo45","WhiteStarParticle",void 0),(0,$.ccclass)("WhiteStarParticle")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.life=a.timeToLive,this.setInitPosition(a.pos),this.modifySpeed(a),this.modifyRotation(a),this.modifyStartScale(a)}},{key:"updateParticle",value:function(a,o){this.updateVelocityWithAcceleration(a,o)}},{key:"getRandomPointOnEdge",value:function(a,o,C,A){var P=0,I=0;switch(Math.floor(4*Math.random())+1){case 1:P=Math.random()*(C-a)+a,I=o;break;case 2:P=Math.random()*(C-a)+a,I=A;break;case 3:P=a,I=Math.random()*(A-o)+o;break;case 4:P=C,I=Math.random()*(A-o)+o}return{x:P,y:I}}},{key:"setInitPosition",value:function(a){var o=t0.SIZE_AT_CONTAINER.WIDTH,C=t0.SIZE_AT_CONTAINER.HEIGHT,A=a.x,P=a.y,I=this.getRandomPointOnEdge(A-o/2,P-C/2,o,C);a.x=I.x,a.y=I.y;var B=Math.atan2(0-a.y,0-a.x),R=V.randomRange(44,60),E=0-R*Math.cos(B),L=0-R*Math.sin(B);return a.x=E,a.y=L,a}},{key:"modifyStartScale",value:function(a){a.deltaSize=(V.randomRange(.6,1)-a.size)/a.life}},{key:"modifySpeed",value:function(a){var o=Math.atan2(0-a.pos.y,0-a.pos.x),C=V.randomRange(0,140);a.dir=new H(-C*Math.cos(o),-C*Math.sin(o))}},{key:"modifyRotation",value:function(a){var o=V.randomRange(-45,45),C=o+o/Math.abs(o)*100;a.rotation=o,a.deltaRotation=(C-o)/a.life}},{key:"updateVelocityWithAcceleration",value:function(a,o){a.dir.x+=40*o,a.dir.y+=40*o,a.dir=new H(a.dir.x,a.dir.y)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"bd3d8K4xwpNvrxOD3jL9mjB","FadeShrinkParticle",void 0),(0,$.ccclass)("FadeShrinkParticle")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).customAlpha=0,a}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.deltaSize=0,a.life=a.timeToLive,a.cycleDuration=a.life,this.setAlpha(a)}},{key:"setAlpha",value:function(a){a.color.a=0,this.customAlpha=V.randomRange(255,255)}},{key:"updateParticle",value:function(a,o){this.updateAlpha(a),this.updateScaleDown(a)}},{key:"updateAlpha",value:function(a){var o=1-(a.life-a.timeToLive)%a.cycleDuration/a.cycleDuration;a.color.a=this.customAlpha*Math.sin(o*Math.PI)}},{key:"updateScaleDown",value:function(a){var o=(a.life-a.timeToLive)/a.life;a.size=a.maxSize*(1-o)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"dc482e9uphM/KCuCnetXFNV","CometStarParticle",void 0),(0,$.ccclass)("CometStarParticle")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).timeToStop=.45,a.rectangleSize=new H(30,30),a.minSpeed=350,a.maxSpeed=450,a}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(1,1.5)*a.size,a.elapsedTime=0,a.size=0,a.deltaSize=0,a.cycleDuration=V.randomRange(.4,.6),a.life=a.timeToLive,a.speed=V.randomRange(this.minSpeed,this.maxSpeed),this.setInitPosition(a.pos)}},{key:"updateParticle",value:function(a,o){a.elapsedTime>=this.timeToStop?this.updateScaleDown(a):(a.elapsedTime+=o,this.updateScaleUp(a))}},{key:"setInitPosition",value:function(a){var o=this.rectangleSize.x,C=this.rectangleSize.y,A=a.x,P=a.y;return a.x=A+V.randomRange(-o/2,o/2),a.y=P+V.randomRange(-C/2,C/2),a}},{key:"updateScaleUp",value:function(a){var o=1-(a.life-a.timeToLive)%a.cycleDuration/a.cycleDuration;a.size=a.maxSize*Math.sin(o*Math.PI)}},{key:"updateScaleDown",value:function(a){var o=(a.life-a.timeToLive)/a.life;a.size=a.maxSize*(1-o)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"9f60eNuED9N9K+Sr3aGnWk/","StarSparkleEffect",void 0);var Fv,Fm,Fg,Fb,Fk,Fw,FS,FT,FC,FA,F_,FP,FI,FB,FR=$.ccclass,FE=$.property,FL=(Fv=FR("StarSparkleEffect"),Fm=FE(eV),Fg=tj.required,Fb=FE(eV),Fk=tj.required,Fv((FS=L((Fw=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"leftStarEffect",FS,N(a)),O(a,"rightStarEffect",FT,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"playEffect",value:function(){this.leftStarEffect.resetSystem(),this.rightStarEffect.resetSystem()}},{key:"stopEffect",value:function(){this.leftStarEffect.stopSystem(),this.rightStarEffect.stopSystem()}}]),r}(eo)).prototype,"leftStarEffect",[Fm,Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FT=L(Fw.prototype,"rightStarEffect",[Fb,Fk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fw))||Fw);U._RF.pop(),U._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var FO=$.ccclass,FN=$.property;FC=FO("RendererModule"),FA=FN(e4),F_=FN(et),FC((FI=L((FP=a(function e(){o(this,e),O(this,"material",FI,this),O(this,"spriteFrame",FB,this)})).prototype,"material",[FA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FB=L(FP.prototype,"spriteFrame",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FP)),U._RF.pop(),U._RF.push({},"9a5a3MgLaRAKbHluGCPsA8j","ExampleParticleSystem2DExtra",void 0),(0,$.ccclass)("ExampleParticleSystem2DExtra")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"initParticle",value:function(a){a.maxSize=V.randomRange(.25,1)*a.size,a.size=0,a.deltaSize=0,a.cycleDuration=V.randomRange(.4,.6),a.life=a.timeToLive,this.setInitPosition(a.pos)}},{key:"updateParticle",value:function(a,o){this.updateScale(a)}},{key:"setInitPosition",value:function(a){var o=a.x,C=a.y;return a.x=o+V.randomRange(-350,350),a.y=C+V.randomRange(-350,350),a}},{key:"updateScale",value:function(a){var o=1-(a.life-a.timeToLive)%a.cycleDuration/a.cycleDuration;a.size=a.maxSize*Math.sin(o*Math.PI)}}]),r}(_3)),U._RF.pop(),U._RF.push({},"6adb6Vsx2BIsYfe4A3i4ArN","custom",void 0),(0,$.ccclass)("CustomSpine")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).spine=null,a.anims=null,a.customEnd=function(o){var C;var A=null==(C=a.spine)?void 0:C.skeletonData;if(A)A.getRuntimeData()},a}return a(r,[{key:"__preload",value:function(){var a,o;this.spine=null!=(a=this.node.getComponent(e1.Skeleton))?a:null,this.anims=null!=(o=this.node.getComponent(es))?o:null,tj.lazyValidateProperties(this)}},{key:"onLoad",value:function(){var a;null==(a=this.anims)||a.play("custom")}},{key:"start",value:function(){}}]),r}(eo)),U._RF.pop(),U._RF.push({},"68708eRgkRKTYtjEWSs0hVr","BundleSizeUtils",void 0);var FF,FD,FM,Fx,Fz,FG,Fq,FU,FH,FW,FV,FK,FY,Fj,FX,FJ,FZ,FQ,F$,F0,F1,F2,F3=function(){function n(){o(this,n)}return a(n,null,[{key:"inst",get:function(){return this._instance||(this._instance=new n),this._instance}},{key:"measureBundlesSize",value:function(){var a=GameSDK.getSDKName(),o=this.getTargetSubstring(a);var C=this.collectEntriesAndAggregate(["resource","navigation"],o),A=C.totalsByInitiator,P=C.isImage32,I=this.computeTotals(A),B=I.totalRequests,R=I.totalSizeKb;this.persistResultsToLocalStorage(P,R,B),this.logSummary(A,R,B)}},{key:"getTargetSubstring",value:function(a){var o;return null!=(o=({GameCore:"web-mobile/localhost",FacebookInstant:"br-compress-instant-bundle"})[a])?o:""}},{key:"collectEntriesAndAggregate",value:function(a,o){var C,A=new Set,P={},I=!1,B=E(a);try{for(B.s();!(C=B.n()).done;){var R,L=C.value,O=performance.getEntriesByType(L),N=E(O);try{for(N.s();!(R=N.n()).done;){var F=R.value;try{var D=F.name;if(!this.shouldTrackEntry(D,o))continue;!I&&this.isImage32Name(D)&&(I=!0),this.accumulateEntry(F,A,P)}catch(a){}}}catch(a){N.e(a)}finally{N.f()}}}catch(a){B.e(a)}finally{B.f()}return{totalsByInitiator:P,isImage32:I}}},{key:"shouldTrackEntry",value:function(a,o){return!!a&&(!o||a.includes(o))}},{key:"isImage32Name",value:function(a){return!!a&&(a.includes("native32")||a.includes("quality"))}},{key:"accumulateEntry",value:function(a,o,C){var A=a.name;if(A&&(_instanceof(a,PerformanceResourceTiming)||_instanceof(a,PerformanceNavigationTiming))){var P,I,B,R,E="".concat(A,"|").concat(a.startTime);if(!o.has(E))o.add(E),P=a.initiatorType||"other",I=a.encodedBodySize||0,B=a.decodedBodySize||0,R=a.transferSize||0,C[P]||(C[P]={count:0,encoded:0,decoded:0,transfer:0}),C[P].count+=1,C[P].encoded+=I,C[P].decoded+=B,C[P].transfer+=R}}},{key:"computeTotals",value:function(a){var o=Object.values(a),C=o.reduce(function(a,o){return a+o.transfer},0);return{totalTransferBytes:C,totalRequests:o.reduce(function(a,o){return a+o.count},0),totalSizeKb:C/1e3}}},{key:"persistResultsToLocalStorage",value:function(a,o,C){if(a){var A=localStorage.getItem("bundlesSize32"),P=JSON.parse(A||"{}");return P.native32||(P.native32={totalSize:0,totalRequests:0,timeMeasured:""}),P.native32.totalSize=Math.round(o),P.native32.totalRequests=C,P.native32.timeMeasured=(new Date).toLocaleString(),A=P,void GameCore.Utils.Browser.writeLocalStorage("bundlesSize32",P)}var I=localStorage.getItem("bundlesSize"),B=JSON.parse(I||"{}");B.native||(B.native={totalSize:0,totalRequests:0,timeMeasured:""}),B.native.totalSize=Math.round(o),B.native.totalRequests=C,B.native.timeMeasured=(new Date).toLocaleString(),I=B,GameCore.Utils.Browser.writeLocalStorage("bundlesSize",B)}},{key:"logSummary",value:function(a,o,C){["%c\uD83D\uDCCA [Detail]","Total size of the bundles: ".concat(o," kB"),"Total requests: ".concat(C," requests"),"Time: ".concat((new Date).toLocaleString())].join("\n")}}]),n}();F3._instance=void 0,U._RF.pop(),U._RF.push({},"8149eZzc79CMq80klkV2JWS","Footer",void 0);var F4=$.ccclass,F5=$.property,F6={0:-350,1:0,2:350},F7={0:-242.401,1:0,2:245.3},F8=(FF=F4("Footer"),FD=F5(ef),FM=tj.required,Fx=F5(ef),Fz=tj.required,FG=F5(ef),Fq=tj.required,FU=F5(ee),FH=tj.required,FW=tj.required,FV=tj.required,FK=tj.required,FY=tj.required,FF((FX=L((Fj=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"undoButton",FX,N(a)),O(a,"helpButton",FJ,N(a)),O(a,"shuffleButton",FZ,N(a)),O(a,"itemContainer",FQ,N(a)),O(a,"undoItem",F$,N(a)),O(a,"magicWandItem",F0,N(a)),O(a,"shuffleItem",F1,N(a)),O(a,"itemAnimController",F2,N(a)),a.undoButtonTween=null,a.helpButtonTween=null,a.shuffleButtonTween=null,a.canClick=!0,a.height=0,a}return a(u,[{key:"items",get:function(){return[this.undoItem,this.magicWandItem,this.shuffleItem]}},{key:"rack",get:function(){return td.gameScene.gamePlay.tileContainer.rack}},{key:"setCanClick",value:function(a){this.canClick=a}},{key:"stopAndResetAllItemAnims",value:function(){this.itemAnimController.stopAndResetItemAnims()}},{key:"playItemsIdleAnim",value:function(){this.itemAnimController.tryToPlayIdleAnim()}},{key:"__preload",value:function(){this.initComponents(),this.initData()}},{key:"initComponents",value:function(){this.undoItem=this.undoButton.getComponent(C$),this.magicWandItem=this.helpButton.getComponent(C$),this.shuffleItem=this.shuffleButton.getComponent(C$),this.itemAnimController=this.itemContainer.getComponent(AV),this.undoItem.node.on(ef.EventType.CLICK,this.handleUndoClicked,this),this.helpButton.node.on(ef.EventType.CLICK,this.handleMagicStickClicked,this),this.shuffleButton.node.on(ef.EventType.CLICK,this.handleShuffleClicked,this),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,u)}},{key:"initData",value:function(){var a;this.height=(null==(a=this.node.getComponent(en))?void 0:a.height)||0,this.hideItemButtons(),this.rack.fadeOutInstantly()}},{key:"hideItemButtons",value:function(){this.undoButton.node.scale=new ei(0,0,1),this.helpButton.node.scale=new ei(0,0,1),this.shuffleButton.node.scale=new ei(0,0,1)}},{key:"onLoad",value:function(){var a=tf.getBannerAdWorldHeight(),o=this.node.getComponent(eX);o&&a&&(o.bottom+=a)}},{key:"handleUndoClicked",value:function(){this.canClick&&(this.undoItem.useItem(),this.playItemsIdleAnim())}},{key:"handleMagicStickClicked",value:function(){this.canClick&&(this.magicWandItem.useItem(),this.playItemsIdleAnim())}},{key:"handleShuffleClicked",value:function(){this.canClick&&(this.shuffleItem.useItem(),this.playItemsIdleAnim())}},{key:"playShowFooterAnim",value:(R=B(function(){var a,o,C,A;var P=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:return o=void 0!==(a=(P.length>0&&void 0!==P[0]?P[0]:{}).rackFadeInInstantly)&&a,(C=this.getComponent(ea))&&(C.opacity=255),this.stopButtonsTween(),this.hideItemButtons(),this.undoButtonTween=this.createScaleInTween(this.undoButton.node,.25,.23),this.helpButtonTween=this.createScaleInTween(this.helpButton.node,.25,.26),this.shuffleButtonTween=this.createScaleInTween(this.shuffleButton.node,.25,.2),[4,Promise.all([ts.runTweenAsync(this.undoButtonTween),ts.runTweenAsync(this.helpButtonTween),ts.runTweenAsync(this.shuffleButtonTween),o?this.rack.fadeInInstantly():this.rack.fadeIn()])];case 1:return I.sent(),(A=this.node.getComponent(ke))&&(A.enabled=!0),[2]}})}),function(){return R.apply(this,arguments)})},{key:"playHideFooterAnim",value:(I=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return o=a.fadeOutRackInstantly,this.stopButtonsTween(),this.undoButtonTween=this.createScaleOutTween(this.undoButton.node,.22,0),this.helpButtonTween=this.createScaleOutTween(this.helpButton.node,.24,.05),this.shuffleButtonTween=this.createScaleOutTween(this.shuffleButton.node,.22,0),[4,Promise.all([ts.runTweenAsync(this.undoButtonTween),ts.runTweenAsync(this.helpButtonTween),ts.runTweenAsync(this.shuffleButtonTween),o?this.rack.fadeOutInstantly():this.rack.fadeOut()])];case 1:return P.sent(),(C=this.getComponent(ea))&&(C.opacity=0),(A=this.node.getComponent(ke))&&(A.enabled=!1),[2]}})}),function(a){return I.apply(this,arguments)})},{key:"createScaleInTween",value:function(a,o,C,A){var P=arguments.length>1&&void 0!==o?o:.3,I=arguments.length>2&&void 0!==C?C:0,B=arguments.length>3&&void 0!==A?A:1;return Y(a).delay(I).to(P,{scale:new ei(B,B,1)},{easing:"backOut"})}},{key:"createScaleOutTween",value:function(a,o,C,A){var P=arguments.length>1&&void 0!==o?o:.3,I=arguments.length>2&&void 0!==C?C:0,B=arguments.length>3&&void 0!==A?A:.001;return Y(a).to(P,{scale:new ei(B,B,1)},{easing:"cubicIn"}).delay(I)}},{key:"stopButtonsTween",value:function(){var a,o,C;null==(a=this.undoButtonTween)||a.stop(),null==(o=this.helpButtonTween)||o.stop(),null==(C=this.shuffleButtonTween)||C.stop(),em.stopAllByTarget(this.undoButton.node),em.stopAllByTarget(this.helpButton.node),em.stopAllByTarget(this.shuffleButton.node)}},{key:"toggleItems",value:function(a){this.toggleUndoButton(a),this.toggleMagicWandButton(a),this.toggleShuffleButton(a)}},{key:"toggleUndoButton",value:function(a){var o=a;this.shouldLockItem(this.undoItem)&&(o=!1),this.undoButton.interactable=o,this.undoItem.toggleEnable(o)}},{key:"toggleShuffleButton",value:function(a){var o=a;this.shouldLockItem(this.shuffleItem)&&(o=!1),this.shuffleButton.interactable=o,this.shuffleItem.toggleEnable(o)}},{key:"toggleMagicWandButton",value:function(a){var o=a;this.shouldLockItem(this.magicWandItem)&&(o=!1),this.helpButton.interactable=o,this.magicWandItem.toggleEnable(o)}},{key:"shouldLockItem",value:function(a){return a.shouldLockItem()||!a.isItemLevelAcquired()}},{key:"updateItemsUI",value:function(){this.undoItem.updateItemUI(),this.magicWandItem.updateItemUI(),this.shuffleItem.updateItemUI()}},{key:"resetWatchAdItems",value:function(){this.undoItem.isClickedWatchAd=!1,this.magicWandItem.isClickedWatchAd=!1,this.shuffleItem.isClickedWatchAd=!1}},{key:"toggleItemButtons",value:function(a){this.undoButton.node.active=a,this.helpButton.node.active=a,this.shuffleButton.node.active=a}},{key:"resizeFooter",value:function(a){this.itemContainer.scale=new ei(a,a,a),this.height=267.057101*a;var o=this.node.getComponent(eX),C=tf.getBannerAdWorldHeight();o&&(o.bottom=C-267.057101*(1-a)/2);for(var A=0;A<this.itemContainer.children.length;A++){var P=this.itemContainer.children[A],I=1===a?F7[A]:F6[A];P.setPosition(I,0,0)}}}]),u}(eo)).prototype,"undoButton",[FD,FM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FJ=L(Fj.prototype,"helpButton",[Fx,Fz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FZ=L(Fj.prototype,"shuffleButton",[FG,Fq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FQ=L(Fj.prototype,"itemContainer",[FU,FH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F$=L(Fj.prototype,"undoItem",[FW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0=L(Fj.prototype,"magicWandItem",[FV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F1=L(Fj.prototype,"shuffleItem",[FK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F2=L(Fj.prototype,"itemAnimController",[FY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fj))||Fj);U._RF.pop(),U._RF.push({},"3c18bBh7gNGEaVwa8EkLmcO","LanguageUtils",void 0);var F9,De,Dt,Dn,Di,Dr,Da,Do,Ds,Dl,Du,Dc,Dh,Dp,Dd,Df={en:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],br:["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"]},Dy=function(){function n(){o(this,n)}return a(n,[{key:"getMonthsByLocale",value:function(){return Df[globalThis.game.language.getCurrentLocale()]}}],[{key:"inst",get:function(){return this._instance||(this._instance=new n),this._instance}}]),n}();Dy._instance=void 0,U._RF.pop(),U._RF.push({},"ab2037eQzFFDIXvIKRixgtB","HeaderButton",void 0);var Dv,Dm,Dg,Db,Dk,Dw,DS,DT,DC=$.ccclass,DA=$.requireComponent,D_=$.property,DP=(F9=DC("HeaderButton"),De=DA(eX),Dt=DA(en),Dn=DA(ea),Di=D_(ef),Dr=tj.required,Da=tj.required,Do=tj.required,Ds=tj.required,F9(Dl=De(Dl=Dt(Dl=Dn((Dc=L((Du=function(P){C(f,P);var I,R,E,L,F,D,M=A(f);function f(){var a;o(this,f);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=M.call.apply(M,[this].concat(A)),O(a,"button",Dc,N(a)),O(a,"uiTransform",Dh,N(a)),O(a,"widget",Dp,N(a)),O(a,"uiOpacity",Dd,N(a)),a.widgetShowHideTween=void 0,a.uiOpacityShowHideTween=void 0,a.widgetShowProps={left:0,top:0},a.widgetHideProps={left:0,top:0},a}return a(f,[{key:"__preload",value:function(){var a=this.getComponent(eX),o=this.getComponent(en),C=this.getComponent(ea),A=a.left,P=a.top;this.widget=a,this.uiTransform=o,this.uiOpacity=C,this.widgetShowProps={left:A,top:P},this.widgetHideProps={left:A,top:P},tj.validateRequiredProperties(this,f)}},{key:"onClick",set:function(a){this.button.node.on(ef.EventType.CLICK,a,this)}},{key:"hide",value:function(){var a=this.widget,o=this.uiOpacity,C=(this.node,this.widgetHideProps);a.left=C.left,a.top=C.top,o.opacity=0}},{key:"runShowAnimationAsync",value:(D=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.runWidgetShowAnimationAsync(),this.runUIOpacityShowAnimationAsync()])]})}),function(){return D.apply(this,arguments)})},{key:"runWidgetShowAnimationAsync",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){return null==(a=this.widgetShowHideTween)||a.stop(),o=Y(this.widget).to(.2,this.widgetShowProps,{easing:"backOut"}),[2,(this.widgetShowHideTween=o,ts.runTweenAsync(o))]})}),function(){return F.apply(this,arguments)})},{key:"runUIOpacityShowAnimationAsync",value:(L=B(function(){var a,o;return _ts_generator(this,function(C){return null==(a=this.uiOpacityShowHideTween)||a.stop(),o=Y(this.uiOpacity).to(.2,{opacity:255},{easing:"backOut"}),[2,(this.uiOpacityShowHideTween=o,ts.runTweenAsync(o))]})}),function(){return L.apply(this,arguments)})},{key:"runHideAnimationAsync",value:(E=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.runWidgetHideAnimationAsync(),this.runUIOpacityHideAnimationAsync()])]})}),function(){return E.apply(this,arguments)})},{key:"runWidgetHideAnimationAsync",value:(R=B(function(){var a,o;return _ts_generator(this,function(C){return null==(a=this.widgetShowHideTween)||a.stop(),o=Y(this.widget).to(.2,this.widgetHideProps,{easing:"backIn"}),[2,(this.widgetShowHideTween=o,ts.runTweenAsync(o))]})}),function(){return R.apply(this,arguments)})},{key:"runUIOpacityHideAnimationAsync",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){return null==(a=this.uiOpacityShowHideTween)||a.stop(),o=Y(this.uiOpacity).to(.2,{opacity:0},{easing:"backIn"}),[2,(this.uiOpacityShowHideTween=o,ts.runTweenAsync(o))]})}),function(){return I.apply(this,arguments)})}]),f}(eo)).prototype,"button",[Di,Dr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=L(Du.prototype,"uiTransform",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=L(Du.prototype,"widget",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd=L(Du.prototype,"uiOpacity",[Ds],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl=Du))||Dl)||Dl)||Dl)||Dl);U._RF.pop(),U._RF.push({},"9e3d7ezxrZFcJ/ftBeV2X35","ButtonBlock",void 0);var DI=$.ccclass,DB=$.property,DR=(Dv=DI("ButtonBlock"),Dm=DB(DP),Dg=tj.required,Db=DB(DP),Dk=tj.required,Dv((DS=L((Dw=function(P){C(p,P);var I,R,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"backButton",DS,N(a)),O(a,"settingsButton",DT,N(a)),a}return a(p,[{key:"__preload",value:function(){M(D(p.prototype),"__preload",this).call(this),tj.validateRequiredProperties(this,p)}},{key:"buttons",get:function(){return[this.backButton,this.settingsButton]}},{key:"onLoad",value:function(){var a,o=E(this.buttons);try{for(o.s();!(a=o.n()).done;){var C=a.value;C.widgetHideProps.top=-C.uiTransform.height}}catch(a){o.e(a)}finally{o.f()}this.registerButtonEvents()}},{key:"registerButtonEvents",value:function(){var a=this,o=td.gameScene,C=this.backButton,A=this.settingsButton,P=o.uiManager;C.onClick=B(function(){return _ts_generator(this,function(a){return[2,o.transition.processBackToDashboardFromGameplay({closeSettingsScreen:!1})]})}),A.onClick=B(function(){return _ts_generator(this,function(C){switch(C.label){case 0:return o.toggleBlockInputContainer(!0),[4,Promise.all([a.runHideAnimationAsync(),o.rubyBarComp.runHideAnimationAsync()])];case 1:return C.sent(),[4,P.openSettingScreenAsync()];case 2:return C.sent(),o.toggleBlockInputContainer(!1),[2]}})})}},{key:"start",value:function(){M(D(p.prototype),"start",this).call(this);var a,o=E(this.buttons);try{for(o.s();!(a=o.n()).done;)a.value.hide()}catch(a){o.e(a)}finally{o.f()}}},{key:"runShowAnimationAsync",value:(R=B(function(){var a,o,C;return _ts_generator(this,function(A){return a=this.backButton,o=this.settingsButton,C=[a],[2,(td.gameScene.gamePlay.gameDataManager.getLevel()>=t4.LEVEL_OPEN_SETTINGS&&C.push(o),Promise.all(C.map(function(a){return a.runShowAnimationAsync()})))]})}),function(){return R.apply(this,arguments)})},{key:"runHideAnimationAsync",value:(I=B(function(){return _ts_generator(this,function(a){return[2,Promise.all(this.buttons.map(function(a){return a.runHideAnimationAsync()}))]})}),function(){return I.apply(this,arguments)})}]),p}(us)).prototype,"backButton",[Dm,Dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DT=L(Dw.prototype,"settingsButton",[Db,Dk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dw))||Dw);U._RF.pop(),U._RF.push({},"2c6a7E8a2ZMALc+FjmBKGXn","ItemUtils",void 0);var DE,DL,DO,DN,DF,DD,DM,Dx,Dz,DG,Dq,DU,DH,DW,DV,DK,DY,Dj,DX,DJ,DQ,D$,D0,D1,D2,D3,D4=function(){var C,A;function n(){o(this,n)}return a(n,null,[{key:"loadProfilePhoto",value:(A=B(function(a,o){var C,A,P,I;var B=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:if(C=B.length>2&&void 0!==B[2]?B[2]:new H(125,125),!(A=o.getComponent(W)))return[2,null];if(""===a)return[2,(A.spriteFrame=null,null)];return[4,this.loadProfilePhotoAsync(a)];case 1:return P=R.sent(),[2,((I=o.getComponent(en))&&I.setContentSize(C.x,C.y),P)]}})}),function(a,o){return A.apply(this,arguments)})},{key:"loadProfilePhotoAsync",value:(C=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(""===a)return[2,null];P.label=1;case 1:return P.trys.push([1,3,,4]),[4,new Promise(function(o,C){e5.loadRemote(a,{ext:".jpg"},function(a,A){a?C(a):o(A)})})];case 2:return o=P.sent(),C=new et,[2,((A=new e6).image=o,C.texture=A,C)];case 3:return P.sent(),[2,null];case 4:return[2]}})}),function(a){return C.apply(this,arguments)})},{key:"castToDPSupportedFontStr",value:function(a){if(""===a)return a;var o,C="",A=E(a);try{for(A.s();!(o=A.n()).done;){var P=o.value;"abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890.,:;'\"(!?) +-*/=\xc2\xca\xd4\xe2\xea\xf4\xc1\xc0\xc3\xc9\xc8\xcd\xcc\xd3\xd2\xd5\xda\xd9\xdd\xe1\xe0\xe3\xe9\xe8\xed\xec\xf3\xf2\xf5\xfa\xf9\xfd".includes(P)?C+=P:C+=""}}catch(a){A.e(a)}finally{A.f()}return C}},{key:"getShortName",value:function(a,o){var C=a.split(" "),A=(C.length<=1?R(C):[C[0],C.pop()]).join(" "),P=A.lastIndexOf(" ")||0,I=P>=0?P:o;return(A.length>o?A.substring(0,I):A).substring(0,o)}},{key:"capitalizeFirstLetter",value:function(a){return a?a.charAt(0).toUpperCase()+a.slice(1):a}},{key:"containsNumber",value:function(a){return/\d/.test(a)}},{key:"getAutoResizedFontSize",value:function(a){var o=a.text,C=a.originalSize,A=a.maxLength,P=a.minSize,I=a.shrinkFactor;if(o.length<=A)return C;return Math.max(C-(o.length-A)*I,P)}},{key:"updateLabelFontSizeBaseOnWidth",value:function(a,o,C,A){a.updateRenderData(!0);var P=o.contentSize.width;if(!(P<=C))a.fontSize=Math.floor(C/P*A)}}]),n}();U._RF.pop(),U._RF.push({},"a236e9NrzRESK7TewiGaCyn","ChallengeBlock",void 0);var D5,D6,D7,D8,D9,Me,Mt,Mn,Mi,Mr,Ma,Mo,Ms,Ml,Mu,Mc,Mh,Mp,Md,Mf,My=$.ccclass,Mv=$.property,Mm=globalThis.game.player,Mg=(DE=My("ChallengeBlock"),DL=Mv(ee),DO=tj.required,DN=Mv(ee),DF=tj.required,DD=Mv(ee),DM=tj.required,Dx=Mv(er),Dz=tj.required,DG=Mv(er),Dq=tj.required,DU=Mv(W),DH=tj.required,DW=Mv(W),DV=tj.required,DK=Mv(et),DY=tj.required,DE((DX=L((Dj=function(P){C(d,P);var I,R,E,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"yourBlock",DX,N(a)),O(a,"opponentBlock",DJ,N(a)),O(a,"scoreBlock",DQ,N(a)),O(a,"scoreText",D$,N(a)),O(a,"opponentScoreText",D0,N(a)),O(a,"myAvatar",D1,N(a)),O(a,"opponentAvatar",D2,N(a)),O(a,"defaultPhotoSpriteFrame",D3,N(a)),a.startTime=0,a.pauseTime=0,a.seconds=0,a.previousScore=0,a.score=0,a.tweenPromiseAddScore=void 0,a}return a(d,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,d)}},{key:"setActive",value:function(a){this.node.active=a}},{key:"setScoreText",value:function(a){this.scoreText.string=a.toString()}},{key:"setOpponentScoreText",value:function(a){this.opponentScoreText.string=a.toString()}},{key:"runMatch3Timer",value:function(){var a=this;this.startTime=performance.now(),this.score=0,this.unscheduleAllCallbacks(),this.schedule(function(){a.updateTime()},.1)}},{key:"updateTime",value:function(){var a=performance.now()-this.startTime;this.seconds=Math.floor(a/1e3)}},{key:"resetTexts",value:function(){this.scoreText.string="0"}},{key:"unScheduleTimer",value:function(){this.unscheduleAllCallbacks()}},{key:"pauseTimer",value:function(){this.pauseTime=performance.now(),this.unscheduleAllCallbacks()}},{key:"resumeTimer",value:function(){var a=this;this.startTime=performance.now()-(this.pauseTime-this.startTime),this.unscheduleAllCallbacks(),this.schedule(function(){a.updateTime()},.1)}},{key:"updateScoreWhenMatch3",value:(L=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return this.previousScore=this.score,o=0,C=[100,90,80,70,60,50],this.startTime=performance.now(),this.seconds<=2?(this.score+=C[0],o=C[0]):this.seconds<=4?(this.score+=C[1],o=C[1]):this.seconds<=8?(this.score+=C[2],o=C[2]):this.seconds<=16?(this.score+=C[3],o=C[3]):this.seconds<=20?(this.score+=C[4],o=C[4]):(this.score+=C[5],o=C[5]),[4,td.gameScene.gamePlay.effectManager.handleRunScoreTextAnim(o,a)];case 1:return A.sent(),this.runTweenAddScore(),[2]}})}),function(a){return L.apply(this,arguments)})},{key:"runTweenAddScore",value:(E=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(a=this,!this.tweenPromiseAddScore)return[3,2];return[4,this.tweenPromiseAddScore];case 1:A.sent(),A.label=2;case 2:return o=this.score,C={previousScore:this.previousScore},this.tweenPromiseAddScore=new Promise(function(A){Y(C).to(.1,{previousScore:o},{easing:"sineOut",progress:function(C,A,P,I){var B=Math.floor(o*I);return a.setScoreText(B),P}}).call(function(){A()}).start()}),[2]}})}),function(){return E.apply(this,arguments)})},{key:"getScore",value:function(){return this.score}},{key:"setScore",value:function(a){this.score=a,this.setScoreText(a)}},{key:"setDataStatus",value:function(){var a=tb.getResultStatus();if(a){var o=a.opponentPhoto,C=Mm.getPlayer().photo;this.setYourAvatar(C),this.setOpponentAvatar(o),this.setScoreText(a.playerScore),this.setOpponentScoreText(a.opponentScore)}}},{key:"clearOpponentInfo",value:function(){this.setOpponentAvatar(""),this.setOpponentScoreText(0)}},{key:"setYourAvatar",value:function(a){var o=this,C=this.myAvatar.getComponent(en);C&&(""!==a&&D4.loadProfilePhotoAsync(a).then(function(a){o.myAvatar.spriteFrame=a,C.setContentSize(136,135)}),this.myAvatar.spriteFrame=this.defaultPhotoSpriteFrame,C.setContentSize(136,135))}},{key:"setOpponentAvatar",value:function(a){var o=this,C=this.opponentAvatar.getComponent(en);C&&(""!==a&&D4.loadProfilePhotoAsync(a).then(function(a){o.opponentAvatar.spriteFrame=a||o.defaultPhotoSpriteFrame,C.setContentSize(136,135)}),this.opponentAvatar.spriteFrame=this.defaultPhotoSpriteFrame,C.setContentSize(136,135))}},{key:"setBlockSize",value:function(){this.playShowChallengeBlocksAnim()}},{key:"prepareShowChallengeBlocksAnim",value:function(){this.yourBlock.setScale(0,0,1),this.opponentBlock.setScale(0,0,1),this.scoreBlock.setScale(0,0,1)}},{key:"playShowChallengeBlocksAnim",value:(R=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return a=Y(this.yourBlock).to(.2,{scale:new ei(1,1,1)},{easing:"backOut"}),o=Y(this.opponentBlock).to(.2,{scale:new ei(1,1,1)},{easing:"backOut"}),C=Y(this.scoreBlock).to(.2,{scale:new ei(.8,.8,1)},{easing:"backOut"}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o),ts.runTweenAsync(C)])];case 1:return A.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"playHideChallengeBlocksAnim",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.yourBlock,this.opponentBlock,this.scoreBlock].map(function(){var a=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=Y(a).to(.2,{scale:new ei(0,0,1)},{easing:"backIn"}),[4,ts.runTweenAsync(o)];case 1:return C.sent(),[2]}})});return function(o){return a.apply(this,arguments)}}()))];case 1:return a.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"getYourScoreTextWorldPosition",value:function(){return this.scoreText.node.getWorldPosition()}}]),d}(eo)).prototype,"yourBlock",[DL,DO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DJ=L(Dj.prototype,"opponentBlock",[DN,DF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DQ=L(Dj.prototype,"scoreBlock",[DD,DM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D$=L(Dj.prototype,"scoreText",[Dx,Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D0=L(Dj.prototype,"opponentScoreText",[DG,Dq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D1=L(Dj.prototype,"myAvatar",[DU,DH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D2=L(Dj.prototype,"opponentAvatar",[DW,DV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D3=L(Dj.prototype,"defaultPhotoSpriteFrame",[DK,DY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dj))||Dj);U._RF.pop(),U._RF.push({},"28b28AVgCZIvbcVglsvnrDw","Header",void 0);var Mb,Mk,Mw,MS,MT,MC,MA,M_,MP,MI,MB,MR=$.ccclass,ME=$.property,ML=(D5=MR("Header"),D6=ME(er),D7=tj.required,D8=ME(ev),D9=tj.required,Me=ME(Mg),Mt=tj.required,Mn=ME(TA),Mi=tj.required,Mr=ME(DR),Ma=tj.required,Mo=ME(ee),Ms=tj.required,D5((Mu=L((Ml=function(P){C(m,P);var I,R,E,L,F,D,M,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=z.call.apply(z,[this].concat(A)),O(a,"levelText",Mu,N(a)),O(a,"isDebugWin",Mc,N(a)),O(a,"challengeBlock",Mh,N(a)),O(a,"tournamentChallengeBlock",Mp,N(a)),O(a,"buttonBlock",Md,N(a)),O(a,"dailyChallengeBlock",Mf,N(a)),a.typeText=null,a.canDebug=!0,a.height=0,a}return a(m,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents()}},{key:"initComponents",value:function(){var a;this.height=(null==(a=this.getComponent(en))?void 0:a.height)||0}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,m)}},{key:"setCanDebug",value:function(a){this.canDebug=a}},{key:"getCanDebug",value:function(){return this.canDebug}},{key:"enableChallengeBlock",value:function(){this.challengeBlock.setActive(!0),this.challengeBlock.setScoreText(0),this.challengeBlock.setOpponentScoreText(0),this.challengeBlock.setOpponentAvatar(""),this.challengeBlock.prepareShowChallengeBlocksAnim()}},{key:"disableChallengeBlock",value:function(){this.challengeBlock.setActive(!1),this.challengeBlock.resetTexts(),this.challengeBlock.unScheduleTimer()}},{key:"updateChallengeBlockData",value:function(){this.challengeBlock.setDataStatus()}},{key:"clearChallengeBlockScore",value:function(){this.challengeBlock.setScore(0)}},{key:"setLevelText",value:function(a){this.levelText.string=globalThis.game.language.getText("levelX",["".concat(a)])}},{key:"setTypeText",value:function(a){this.typeText&&(this.typeText.string=a)}},{key:"handleClickedNextLevel",value:(x=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.canDebug)return[3,4];if(!this.isDebugWin)return[3,1];return td.gameScene.gamePlay.handleGameWin(),[3,3];case 1:return td.gameScene.toggleBlockInputContainer(!0),[4,td.gameScene.gamePlay.loadNextLevel()];case 2:a.sent(),td.gameScene.toggleBlockInputContainer(!1),a.label=3;case 3:a.label=4;case 4:return[2]}})}),function(){return x.apply(this,arguments)})},{key:"handleClickedPreviousLevel",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.canDebug)return[3,2];return td.gameScene.toggleBlockInputContainer(!0),[4,td.gameScene.gamePlay.loadPrevLevel()];case 1:a.sent(),td.gameScene.toggleBlockInputContainer(!1),a.label=2;case 2:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"handleResetLevel",value:function(){this.canDebug&&td.gameScene.gamePlay.handleGameOver()}},{key:"prepareTextsAnim",value:function(){var a=window.game.match.getMatchState().mode,o=td.gameScene.gamePlay.getIsPlayingTournament();this.levelText.node.active="challenge-friend"!==a&&"daily-challenge"!==a&&!o}},{key:"playShowTextsAnim",value:(D=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.prepareTextsAnim(),!(a=this.levelText.getComponent(ea)))return[3,2];return em.stopAllByTarget(a),a.opacity=0,o=Y(a).to(.6,{opacity:255},{easing:"smooth"}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"playHideTextsAnim",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.prepareTextsAnim(),!(a=this.levelText.getComponent(ea)))return[3,2];return em.stopAllByTarget(a),a.opacity=255,o=Y(a).to(.3,{opacity:0},{easing:"smooth"}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"showButtonsAsync",value:(L=B(function(){return _ts_generator(this,function(a){return[2,this.buttonBlock.runShowAnimationAsync()]})}),function(){return L.apply(this,arguments)})},{key:"hideButtonsAsync",value:(E=B(function(){return _ts_generator(this,function(a){return[2,this.buttonBlock.runHideAnimationAsync()]})}),function(){return E.apply(this,arguments)})},{key:"showDailyChallengeBlockAnim",value:(R=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.updateTextDate(),!(a=this.dailyChallengeBlock.getComponent(ea)))return[3,2];return a.opacity=0,o=Y(a).to(.3,{opacity:255},{easing:"smooth"}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"hideDailyChallengeBlockAnim",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(a=this.dailyChallengeBlock.getComponent(ea)))return[3,2];return a.opacity=255,o=Y(a).to(.3,{opacity:0},{easing:"smooth"}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateTextDate",value:function(){var a=Dy.inst.getMonthsByLocale(),o=new Date,C="".concat(a[o.getMonth()]," ").concat(String(o.getDate()).padStart(2,"0"),", ").concat(o.getFullYear());this.setDayText(C)}},{key:"setDayText",value:function(a){var o=this.dailyChallengeBlock.getChildByName("DateText");if(o){var C=o.getComponent(er);C&&(C.string=a)}}}]),m}(eo)).prototype,"levelText",[D6,D7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mc=L(Ml.prototype,"isDebugWin",[D8,D9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mh=L(Ml.prototype,"challengeBlock",[Me,Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mp=L(Ml.prototype,"tournamentChallengeBlock",[Mn,Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md=L(Ml.prototype,"buttonBlock",[Mr,Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mf=L(Ml.prototype,"dailyChallengeBlock",[Mo,Ms],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ml))||Ml);U._RF.pop(),U._RF.push({},"62dceGbes9I8owLJJkFtCYi","GameUI",void 0);var MO,MN,MF,MD,MM,Mx,Mz,MG,Mq,MU,MH,MW,MV,MK,MY,Mj,MX,MZ,MQ,M$,M0,M1,M2,M3,M4,M5,M6,M7,M8,M9,xe,xt,xn,xi,xr,xa,xo,xs,xl=$.ccclass,xu=$.property,xc=(Mb=xl("GameUI"),Mk=tj.required,Mw=xu(ML),MS=tj.required,MT=xu(F8),MC=tj.required,MA=xu(kA),Mb((MP=L((M_=function(){var C,A,P,I,R,E;function n(){o(this,n),O(this,"header",MP,this),O(this,"footer",MI,this),O(this,"welcomeTournamentBlock",MB,this),this.enableCloseOnTouch=!0,this.preHeightHeader=0}return a(n,[{key:"init",value:function(){tj.validateRequiredProperties(this,n)}},{key:"getPreHeightHeader",value:function(){return this.preHeightHeader}},{key:"getCurrentHeightHeader",value:function(){return this.header.node.position.y}},{key:"handleLevelInfoLoaded",value:function(a){this.header.setTypeText(a.title)}},{key:"setLevelText",value:function(a){this.header.setLevelText(a)}},{key:"playShowGameUIAnim",value:(E=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if("daily-challenge"!==(a=window.game.match.getMatchState().mode)&&"challenge-friend"===a)return[3,2];return[4,this.footer.playShowFooterAnim()];case 1:o.sent(),o.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"toggleHeaderAndFooter",value:function(a){this.header.node.active=a,this.footer.node.active=a}},{key:"openWelcomeTournamentBlock",value:function(){return this.welcomeTournamentBlock.playPopUpAnim()}},{key:"fadeOutGameScreen",value:(R=B(function(a){var o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return A=void 0!==(C=(o=a||{}).shouldRunImmediately)&&C,P=o.shouldHideRubyBar,I=[],void 0!==P&&P&&I.push(td.gameScene.rubyBarComp.runHideAnimationAsync()),this.handleFadeOutHeader(),this.handleFadeOutFooter({fadeOutRackInstantly:A}),I.push(this.handleFadeOutTiles({immediately:A})),[4,Promise.all(I)];case 1:return B.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"handleFadeOutHeader",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){return a=window.game.match.getMatchState().mode,[2,((o=[]).push(this.header.hideButtonsAsync()),"challenge-friend"===a?o.push(this.header.challengeBlock.playHideChallengeBlocksAnim()):"daily-challenge"===a?o.push(this.header.hideDailyChallengeBlockAnim()):td.gameScene.gamePlay.getIsPlayingTournament()?o.push(this.header.tournamentChallengeBlock.fadeOut()):o.push(this.header.playHideTextsAnim()),Promise.all(o))]})}),function(){return I.apply(this,arguments)})},{key:"handleFadeOutFooter",value:(P=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return C=void 0!==(o=(a||{}).fadeOutRackInstantly)&&o,[4,this.footer.playHideFooterAnim({fadeOutRackInstantly:C})];case 1:return A.sent(),[2]}})}),function(a){return P.apply(this,arguments)})},{key:"handleFadeOutTiles",value:(A=B(function(a){var o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:if(C=void 0!==(o=(a||{}).immediately)&&o,P=(A=td.gameScene.gamePlay).tileManager,I=A.tileContainer,!C)return[3,1];return P.closeTilesImmediately(),I.closeTilesImmediately(),I.disableContainerAnim(),[3,3];case 1:return[4,Promise.all([P.closeTiles(),I.closeTiles()])];case 2:B.sent(),B.label=3;case 3:return[2]}})}),function(a){return A.apply(this,arguments)})},{key:"fadeInGameScreen",value:(C=B(function(a){var o,C,A,P,I,B,R,E,L,O;return _ts_generator(this,function(N){switch(N.label){case 0:if(C=(o=td.gameScene.gamePlay).tileManager,A=o.tileContainer,B=void 0===(I=(P=a||{}).reOpenTiles)||I,E=void 0!==(R=P.rackFadeInInstantly)&&R,L=[],"daily-challenge"===(O=window.game.match.getMatchState().mode)?this.header.showDailyChallengeBlockAnim():o.getIsPlayingTournament()?this.header.tournamentChallengeBlock.fadeIn():"challenge-friend"===O&&this.header.challengeBlock.playShowChallengeBlocksAnim(),L.push(this.header.playShowTextsAnim(),this.header.showButtonsAsync(),this.footer.playShowFooterAnim({rackFadeInInstantly:E}),td.gameScene.rubyBarComp.runShowAnimationAsync()),!B)return[3,3];return L.push(C.reopenTiles()),[4,Promise.all(L)];case 1:return N.sent(),[4,A.reopenTiles()];case 2:N.sent(),N.label=3;case 3:return[4,Promise.all(L)];case 4:return N.sent(),[2]}})}),function(a){return C.apply(this,arguments)})}]),n}()).prototype,"header",[Mk,Mw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MI=L(M_.prototype,"footer",[MS,MT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MB=L(M_.prototype,"welcomeTournamentBlock",[MC,MA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_))||M_);U._RF.pop(),U._RF.push({},"702fbtEafNPB5a0bJ77QXE8","Gameplay",void 0);var xh=$.ccclass,xp=$.property,xf=GameCore.Configs.Mockup,xy=globalThis.game.leaderboard,xv=(MO=xh("GamePlay"),MN=tj.required,MF=xp(SK),MD=tj.required,MM=xp(_B),Mx=tj.required,Mz=xp(kr),MG=tj.required,Mq=xp(Ff),MU=tj.required,MH=xp(SQ),MW=tj.required,MV=xp(IC),MK=xp(xc),MY=xp(SZ),Mj=xp(Te),MX=xp(I6),MZ=tj.required,MQ=tj.required,M$=tj.required,M0=tj.required,M1=tj.required,MO((M3=L((M2=function(P){C(G,P);var I,E,L,F,D,M,x,z,q,U,H,W,V,K,Y,j,X,J,Z,Q,$,ee,et,en,ei,er,ea,eo,es,el,eu=A(G);function G(){var a;o(this,G);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=eu.call.apply(eu,[this].concat(A)),O(a,"gameObjects",M3,N(a)),O(a,"tileContainer",M4,N(a)),O(a,"vibrate",M5,N(a)),O(a,"vfxManager",M6,N(a)),O(a,"timerHandler",M7,N(a)),O(a,"effectManager",M8,N(a)),O(a,"gameUI",M9,N(a)),O(a,"tileIconPositionManager",xe,N(a)),O(a,"loader",xt,N(a)),O(a,"tileManager",xn,N(a)),O(a,"_itemManager",xi,N(a)),O(a,"_resultTournamentLoader",xr,N(a)),O(a,"_globalLeaderboardLoader",xa,N(a)),O(a,"gameDataManager",xo,N(a)),O(a,"tournamentStack",xs,N(a)),a.canUpdateItemsAmountAfterSetGameData=!0,a.isOpenedWelComeTournamentBlock=!1,a.countLevelPlayed=0,a.isPlayedFinalLevel=!1,a.shouldResetLevel=!0,a.isPlayingOldLevel=!1,a._stepLogHandler=void 0,a.isPlayingTournament=!1,a.handleLevelLoaded=function(){var o=B(function(o){var C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return C=o.json,a.gameDataManager.setGameData({levelData:[C[0]]}),a.tileManager.clearTiles({canTriggerLinkedEvent:!1}),a.gameObjects.spawnObjects(C),[4,a.tileManager.handleTilesCreated()];case 1:return I.sent(),[4,a.handleAllTileReady()];case 2:if(I.sent(),a.handleLoadLevelInfo(),window.game.match.getMatchState().customData.level=td.levelManager.getLevel(),A=td.levelManager.getLevel())td.levelManager.preloadLevelDataAsync(A+1),P=window.game.match.getMatchState().mode,1===a.gameDataManager.getLevel()&&"challenge-friend"!==P&&a.shouldResetLevel&&(a.gameDataManager.setGameData({currentMaxLevel:1}),a.shouldResetLevel=!1,tR(A),tE(A),tL(A));return a.gameUI.footer.resetWatchAdItems(),a.updateItemsUI(),[2]}})});return function(a){return o.apply(this,arguments)}}(),a.updateItemsUI=function(){a.gameUI.footer.updateItemsUI()},a}return a(G,[{key:"itemManager",get:function(){return{updateItemStates:this._itemManager.updateItemStates.bind(this._itemManager),toggleItems:this._itemManager.toggleItems.bind(this._itemManager),handleRescue:this._itemManager.handleRescue.bind(this._itemManager),setRescued:this._itemManager.setRescued.bind(this._itemManager),canShowRescueButton:this._itemManager.canShowRescueButton.bind(this._itemManager),getRescued:this._itemManager.getRescued.bind(this._itemManager)}}},{key:"resultTournamentLoader",get:function(){return{updatePlayerEntry:this._resultTournamentLoader.updatePlayerEntry.bind(this._resultTournamentLoader),loadNewPlayerEntry:this._resultTournamentLoader.loadNewPlayerEntry.bind(this._resultTournamentLoader),getCurrentPlayerEntry:this._resultTournamentLoader.getCurrentPlayerEntry.bind(this._resultTournamentLoader),getNewPlayerEntry:this._resultTournamentLoader.getNewPlayerEntry.bind(this._resultTournamentLoader),getLeaderboard:this._resultTournamentLoader.getLeaderboard.bind(this._resultTournamentLoader),getCurrentScore:this._resultTournamentLoader.getCurrentScore.bind(this._resultTournamentLoader),getCurrentRank:this._resultTournamentLoader.getCurrentRank.bind(this._resultTournamentLoader),getNewScore:this._resultTournamentLoader.getNewScore.bind(this._resultTournamentLoader),getAllowLoadNewData:this._resultTournamentLoader.getAllowLoadNewData.bind(this._resultTournamentLoader),preloadLeaderboardData:this._resultTournamentLoader.preloadLeaderboardData.bind(this._resultTournamentLoader),loadCurrentPlayerEntry:this._resultTournamentLoader.loadCurrentPlayerEntry.bind(this._resultTournamentLoader),setAllowLoadNewData:this._resultTournamentLoader.setAllowLoadNewData.bind(this._resultTournamentLoader),getRankingLeaders:this._resultTournamentLoader.getRankingLeaders.bind(this._resultTournamentLoader),isValidPlayerToSaveScore:this._resultTournamentLoader.isValidPlayerToSaveScore.bind(this._resultTournamentLoader),fetchLeaderboard:this._resultTournamentLoader.fetchLeaderboard.bind(this._resultTournamentLoader),updateScoreByLeaderboardId:this._resultTournamentLoader.updateScoreByLeaderboardId.bind(this._resultTournamentLoader)}}},{key:"globalLeaderboardLoader",get:function(){return{getGlobalLeaderboardId:this._globalLeaderboardLoader.getGlobalLeaderboardId.bind(this._globalLeaderboardLoader),getCurrentPlayerEntry:this._globalLeaderboardLoader.getCurrentPlayerEntry.bind(this._globalLeaderboardLoader),getLeaderboard:this._globalLeaderboardLoader.getLeaderboard.bind(this._globalLeaderboardLoader),getAllowLoadNewData:this._globalLeaderboardLoader.getAllowLoadNewData.bind(this._globalLeaderboardLoader),preloadLeaderboardData:this._globalLeaderboardLoader.preloadLeaderboardData.bind(this._globalLeaderboardLoader),initGlobalLeaderboard:this._globalLeaderboardLoader.initGlobalLeaderboard.bind(this._globalLeaderboardLoader),setAllowLoadNewData:this._globalLeaderboardLoader.setAllowLoadNewData.bind(this._globalLeaderboardLoader),fetchLeaderboard:this._globalLeaderboardLoader.fetchLeaderboard.bind(this._globalLeaderboardLoader)}}},{key:"stepLogHandler",get:function(){return{reset:this._stepLogHandler.reset.bind(this._stepLogHandler),logAllRemainingSteps:this._stepLogHandler.logAllRemainingSteps.bind(this._stepLogHandler)}}},{key:"__preload",value:function(){var a=this;this._stepLogHandler=new PJ,this._itemManager=new IV,this._resultTournamentLoader=new Tl,this._globalLeaderboardLoader=new Ta,this.gameDataManager=new IN,this.tournamentStack=new S7,this.gameDataManager.init(),this.gameDataManager.setCBAfterSetGameData(function(){a.canUpdateItemsAmountAfterSetGameData&&a.updateItemsUI()}),this.loader.init(),this.gameUI.init(),this.tileManager.initComponents(this.node),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,G)}},{key:"start",value:function(){this.initData(),this.listenEvents()}},{key:"initData",value:function(){var a=this.gameDataManager.getLevel(),o=this.gameDataManager.getCurrentMaxLevel();td.gameScene.background.loadBackgroundData(a),this.addCoinData(0),this.isPlayedFinalLevel=o===t4.MAX_LEVEL,td.levelManager.setLevel(a),this.isPlayingOldLevel=!1}},{key:"loadAllSounds",value:(el=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:for(o in a=[],tZ)a.push(o);C=0,P.label=1;case 1:if(!(C<a.length))return[3,5];if((A=tZ[a[C]]).includes("old"))return[3,3];return[4,to.loadAudioAsync(A)];case 2:P.sent(),P.label=3;case 3:P.label=4;case 4:return C++,[3,1];case 5:return[2]}})}),function(){return el.apply(this,arguments)})},{key:"listenEvents",value:function(){this.node.scene.on(t2.GAME_WIN,this.handleGameWin,this)}},{key:"resetSingleMode",value:function(){this.shouldResetLevel=!0,this.tileContainer.node.active=!0,this.gameUI.toggleHeaderAndFooter(!0)}},{key:"setBackgroundFor",value:(es=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(o=a.level,td.mapDataManager.setCurrentData(o),!(C=td.mapDataManager.getCurrentBackgroundCardPayload()))return[2,Promise.resolve()];return[4,td.gameScene.background.setBgBaseOn(C)];case 1:return A.sent(),[2]}})}),function(a){return es.apply(this,arguments)})},{key:"canShowChapterCompleteScreen",value:function(){var a=td.levelManager.getLevel();return!!td.mapDataManager.isSpecialLevel(a)&&a>this.gameDataManager.getCollectedChapterEndLevel()}},{key:"canShowStampAtFinalLevel",value:function(){var a=this.gameDataManager.getLevel();if(!td.mapDataManager.isSpecialLevel(a))return!1;var o=this.gameDataManager.getCollectedChapterEndLevel();return this.isPlayedFinalLevel||a===o}},{key:"handleLoadLevelInfo",value:function(){var a=td.mapDataManager.getCurrentBackgroundCardPayload();a&&this.gameUI.handleLevelInfoLoaded(a)}},{key:"handleAllTileReady",value:(eo=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:if(a=window.game.match.getMatchState().mode,1!==td.levelManager.getLevel())return[3,3];if(!("challenge-friend"!==a&&"daily-challenge"!==a))return[3,2];return tF(),tD(1),A=(C=(o=td.gameScene).gamePlay).tileManager,P=C.gameUI,o.toggleBlockInputContainer(!0),[4,Promise.all([P.header.showButtonsAsync(),o.rubyBarComp.runShowAnimationAsync()])];case 1:B.sent(),o.toggleBlockInputContainer(!1),A.setUpTutorialHand(),B.label=2;case 2:return[3,4];case 3:this.itemManager.updateItemStates(),B.label=4;case 4:switch(this.gameUI.header.setCanDebug(!0),a){case"challenge-friend":this._stepLogHandler.reset(window.levelCustom),this.logStepProgress(!0);break;case"daily-challenge":I=tM(),this._stepLogHandler.reset(I),this.logStepProgress(!0);break;default:this._stepLogHandler.reset(td.levelManager.getLevel()),this.logStepProgress(!0)}return[2]}})}),function(){return eo.apply(this,arguments)})},{key:"switchFromNMMToDashboard",value:(ea=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.shouldResetLevel=!0,[4,this.gameUI.fadeOutGameScreen({shouldHideRubyBar:!0})];case 1:return a.sent(),[4,Promise.all([this.openDashboardScreen(),td.gameScene.transition.processFadeOutTopBGGame()])];case 2:return a.sent(),[2]}})}),function(){return ea.apply(this,arguments)})},{key:"loadNextLevel",value:(er=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.tileContainer.reset(),td.gameScene.background.loadBgData(),this.updateToNextLevel(),[4,this.startGameAsync()];case 1:return a.sent(),[2]}})}),function(){return er.apply(this,arguments)})},{key:"saveWinLevel",value:function(){var a=td.levelManager.getLevel();if(a===this.gameDataManager.getLevel()){var o=Math.min(a+1,t4.MAX_LEVEL);o>=t4.TOURNAMENT_LEVEL_START&&!this.gameDataManager.isUnlockTourFeature()&&this.gameDataManager.setGameData({isUnlockTourFeature:!0}),this.gameDataManager.setGameData({level:o}),this.saveGlobalLeaderboardScore(o)}}},{key:"saveGlobalLeaderboardScore",value:(ei=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,this._globalLeaderboardLoader.saveGlobalPlayerScore(a)];case 1:return o.sent(),this._globalLeaderboardLoader.setAllowLoadNewData(!0),this._globalLeaderboardLoader.preloadLeaderboardData(),[2]}})}),function(a){return ei.apply(this,arguments)})},{key:"updateToNextLevel",value:function(){var a=td.levelManager.getLevel();++a===t4.MAX_LEVEL+1&&(a=t4.MAX_LEVEL),td.levelManager.setLevel(a),this.gameDataManager.getLevel()<a&&this.gameDataManager.setGameData({level:a})}},{key:"loadPrevLevel",value:(en=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return this.tileContainer.reset(),a=td.levelManager.getLevel(),--a==t4.MIN_LEVEL-1&&(a=t4.MIN_LEVEL),td.levelManager.setLevel(a),[4,this.startGameAsync()];case 1:return o.sent(),[2]}})}),function(){return en.apply(this,arguments)})},{key:"addCoinData",value:function(a){var o=this.gameDataManager.getCoins();this.node.scene.emit(t2.COIN_UPDATED,o,a),o+=a,this.gameDataManager.setGameData({coins:o})}},{key:"canShowResultTournamentScreen",value:function(){return this.isPlayingTournament}},{key:"canPlayTournamentLevel",value:function(){var a=td.tournamentManager.checkIsLeaderboardExpired(),o=td.gameScene.tournament.isJoinedCurTour(),C=window.game.match.getMatchState().mode;return this.canUnlockTournamentFeature()&&!this.isPlayingOldLevel&&!this.isPlayedFinalLevel&&o&&!a&&"challenge-friend"!==C&&"daily-challenge"!==C}},{key:"canUnlockTournamentFeature",value:function(){var a=this.gameDataManager.isUnlockTourFeature(),o=null!==td.tournamentManager.getSelectedLeaderboardId();return a&&o&&!this.isTutorialLevel()}},{key:"canShowGlobalLeaderboard",value:function(){return null!==this._globalLeaderboardLoader.getGlobalLeaderboardId()}},{key:"openCurrentLevel",value:(et=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.shouldResetLevel)return[3,2];return this.shouldResetLevel=!1,[4,this.startGameAsync()];case 1:return a.sent(),[3,4];case 2:return this.gameUI.footer.stopAndResetAllItemAnims(),[4,this.gameUI.fadeInGameScreen({reOpenTiles:!0})];case 3:a.sent(),this.gameUI.footer.playItemsIdleAnim(),a.label=4;case 4:return[2]}})}),function(){return et.apply(this,arguments)})},{key:"handleOpenLevel",value:(ee=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(o=this.gameDataManager.getLevel(),td.levelManager.setLevel(a),a!==o)return[3,2];return this.gameUI.setLevelText(a),[4,this.openCurrentLevel()];case 1:return C.sent(),[3,4];case 2:return this.shouldResetLevel=!0,[4,this.startGameAsync()];case 3:C.sent(),C.label=4;case 4:return[2]}})}),function(a){return ee.apply(this,arguments)})},{key:"startGameAsync",value:($=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(a=td.levelManager.getLevel(),o=this.gameDataManager.getLevel(),this.isPlayingOldLevel=o>a,"challenge-friend"!==(C=window.game.match.getMatchState().mode)&&"daily-challenge"!==C||(a=window.levelCustom),!a)throw new Error("Level is not defined");return a<t4.MIN_LEVEL&&(a=t4.MIN_LEVEL),a>t4.MAX_LEVEL&&(a=t4.MAX_LEVEL),this.handleShowShortcut(),td.mapDataManager.setCurrentData(a),this.isPlayingTournament=this.canPlayTournamentLevel(),this.gameUI.footer.stopAndResetAllItemAnims(),this.gameUI.fadeInGameScreen({reOpenTiles:!1}),this.isPlayingTournament&&(this.gameUI.header.tournamentChallengeBlock.resetScore(),this.resultTournamentLoader.setAllowLoadNewData(!0),this.resultTournamentLoader.preloadLeaderboardData()),this.tileManager.resetGoldTiles(),this.handleLoadLevelInfo(),this.gameUI.setLevelText(a),td.levelManager.setLevel(a),this.gameUI.footer.resetWatchAdItems(),this.updateItemsUI(),[4,td.levelManager.preloadLevelDataAsync(a)];case 1:if(A=I.sent(),!(P=td.levelManager.getLevelData(a)))return[3,3];return[4,this.handleLevelLoaded({json:P})];case 2:return I.sent(),[3,5];case 3:return[4,this.handleLevelLoaded({json:A})];case 4:I.sent(),I.label=5;case 5:if(!(!this.isOpenedWelComeTournamentBlock&&this.isPlayingTournament))return[3,7];return[4,this.gameUI.openWelcomeTournamentBlock()];case 6:I.sent(),this.isOpenedWelComeTournamentBlock=!0,I.label=7;case 7:return this.gameUI.footer.playItemsIdleAnim(),[2]}})}),function(){return $.apply(this,arguments)})},{key:"handleShowShortcut",value:function(){this.countLevelPlayed===t4.LEVEL_POP_UP_SHORTCUT&&this.attemptCallCreateShortcut(),this.countLevelPlayed++}},{key:"tryToOpenShortcutAndSubscribeBot",value:function(){var a=this.gameDataManager.getLevel();a>=t4.LEVEL_SUBSCRIBE_BOT&&this.attemptSubscribeBotAsync(),a>=t4.LEVEL_POP_UP_SHORTCUT&&this.attemptCallCreateShortcut()}},{key:"attemptCallCreateShortcut",value:function(){"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(a){})}},{key:"attemptSubscribeBotAsync",value:function(){return new Promise(function(a){"subscribeBotAsync"in GameSDK.extra?GameSDK.extra.subscribeBotAsync().then(function(){a()}):a()})}},{key:"openDashboardScreen",value:(Q=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,td.gameScene.waitUntilResourcesScreenLoaded(tP.DASHBOARD_SCREEN)];case 1:return a.sent(),[4,td.gameScene.uiManager.openDashboardScreenAsync()];case 2:return a.sent(),[2]}})}),function(){return Q.apply(this,arguments)})},{key:"handleGameOver",value:(Z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return tx(),"challenge-friend"===window.game.match.getMatchState().mode&&this.gameUI.header.challengeBlock.pauseTimer(),this.gameUI.fadeOutGameScreen({shouldRunImmediately:!0,shouldHideRubyBar:!1}),[4,td.gameScene.waitUntilResourcesScreenLoaded(tP.NO_MORE_MOVE_SCREEN)];case 1:return a.sent(),[4,td.gameScene.uiManager.openNoMoreMoveScreenAsync()];case 2:return a.sent(),[2]}})}),function(){return Z.apply(this,arguments)})},{key:"handleGameRetry",value:(J=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return(a=td.gameScene.gamePlay.gameUI.footer).toggleItems(!1),C="daily-challenge"===(o=window.game.match.getMatchState().mode)?tM():"challenge-friend"===o?window.levelCustom:td.levelManager.getLevel(),"challenge-friend"===o&&(a.playShowFooterAnim(),this.gameUI.header.challengeBlock.runMatch3Timer()),[4,this.startGameAsync()];case 1:return A.sent(),tE(C),tL(C),this._stepLogHandler.reset(C),[2]}})}),function(){return J.apply(this,arguments)})},{key:"handleGameWin",value:(X=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),this.tileManager.clearTiles({canTriggerLinkedEvent:!1}),[4,this.gameUI.fadeOutGameScreen({shouldHideRubyBar:!0})];case 1:return A.sent(),this.itemManager.setRescued(!1),[4,ts.waitTweenAsync(.5)];case 2:switch(A.sent(),a=this.tileManager.allTileAmount,tz(),tB(td.levelManager.getLevel(),!0,a),o=window.game.match.getMatchState().mode,C=this.gameUI.header.challengeBlock.getScore(),th.playMusic(tZ.WIN_MUSIC),"single"!==o&&null!==o&&tG(td.levelManager.getLevel()),o){case"challenge-friend":return[3,3];case"daily-challenge":return[3,5]}return[3,7];case 3:return[4,this.handleFriendModeWin(C)];case 4:return A.sent(),[3,9];case 5:return[4,this.handleDailyChallengeModeWin()];case 6:return A.sent(),[3,9];case 7:return[4,this.handleDefaultWin()];case 8:A.sent(),A.label=9;case 9:return td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return X.apply(this,arguments)})},{key:"handleFriendModeWin",value:(j=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),o=this.gameDataManager.getLevel(),[4,this.handleFinishChallenge(a)];case 1:return C.sent(),this.gameUI.header.challengeBlock.setActive(!1),[4,tf.showInterstitialAdAsync2(tO[tP.RESULT_CHALLENGE_FRIENDS_SCREEN],{forLevel:o})];case 2:return C.sent(),this.gameUI.header.challengeBlock.resetTexts(),this.gameUI.header.challengeBlock.unscheduleAllCallbacks(),[4,td.gameScene.uiManager.openResultChallengeFriendScreenAsync(a)];case 3:return C.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(a){return j.apply(this,arguments)})},{key:"handleDefaultWin",value:(Y=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(this.saveWinLevel(),!this.isPlayingTournament)return[3,2];return[4,this.handleOpenResultTournamentScreen()];case 1:return a.sent(),[3,4];case 2:return[4,this.playEndGame()];case 3:a.sent(),a.label=4;case 4:return[2]}})}),function(){return Y.apply(this,arguments)})},{key:"handleDailyChallengeModeWin",value:(K=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,td.gameScene.uiManager.openResultScreenAsync()];case 1:return a.sent(),[2]}})}),function(){return K.apply(this,arguments)})},{key:"playEndGame",value:(V=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=this.gameDataManager.getCurrentMaxLevel(),this.isPlayedFinalLevel=a===t4.MAX_LEVEL,o=this.gameDataManager.getLevel(),[4,tf.showInterstitialAdAsync2(tO[tP.RESULT_SCREEN],{forLevel:o-1})];case 1:return C.sent(),th.playSound(tZ.ACHIEVE,{volume:.45}),[4,td.gameScene.uiManager.openResultScreenAsync()];case 2:return C.sent(),this.checkPlayedFinalLevel(),[2]}})}),function(){return V.apply(this,arguments)})},{key:"handleOpenResultTournamentScreen",value:(W=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return td.gameScene.showLoadingScreen(0,t7.LOADING,!0),this._resultTournamentLoader.saveNewPlayerScore(),[4,this._resultTournamentLoader.fetchLeaderboard()];case 1:if(a=o.sent(),td.gameScene.closeLoadingScreen(),!!a)return[3,3];return td.gameScene.showLoadingScreen(3,t7.FAILED_TO_LOAD_LEADERBOARD,!1),[4,this.playEndGame()];case 2:return[2,void o.sent()];case 3:return td.gameScene.toggleBlockInputContainer(!0),[4,td.gameScene.uiManager.openResultTournamentScreenAsync()];case 4:return o.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return W.apply(this,arguments)})},{key:"handleFinishChallenge",value:(H=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return P.trys.push([0,2,,3]),o=game.player.getPlayerId(),C=game.match.getMatchState().profiles,A={level:window.levelCustom},C[o]&&(C[o].score=a),[4,tb.processFinishMatchWithoutLogMatchFinish(function(){return game.match.challenge.finish.processAsync({player:game.player.getPlayerId(),extraData:A})})];case 1:return P.sent(),[3,3];case 2:return P.sent(),[3,3];case 3:return[2]}})}),function(a){return H.apply(this,arguments)})},{key:"handleOpenAdScreen",value:(U=B(function(a,o){var C,A,P,I,B;return _ts_generator(this,function(R){switch(R.label){case 0:if(!(P=A=({undo:{adName:"ITEM_UNDO",resource:tk.UNDO,component:this.gameUI.footer.undoItem},shuffle:{adName:"ITEM_SHUFFLE",resource:tk.SHUFFLE,component:this.gameUI.footer.shuffleItem},magicWand:{adName:"ITEM_MAGIC_WAND",resource:tk.MAGIC,component:this.gameUI.footer.magicWandItem}})[o]))return[3,2];return[4,tf.showRewardVideoAdAsync2(A.adName)];case 1:P=R.sent(),R.label=2;case 2:if(P)(I=this.gameDataManager.getItems())[B=o]=(null!=(C=I[B])?C:0)+1,this.gameDataManager.setGameData({items:I}),this.sendEconomyTransactionEventWhenWatchAd(A.resource),a.isClickedWatchAd=!0,A.component.useItem();return[2]}})}),function(a,o){return U.apply(this,arguments)})},{key:"sendEconomyTransactionEventWhenWatchAd",value:function(a){-1!==tw[a]&&tS({resourceTransaction:[{resourceChange:1,resourceTypeName:a}],transactionCount:1,transactionType:"WatchAd",maxPlayerLevel:this.gameDataManager.getLevel(),level:td.levelManager.getLevel()})}},{key:"checkPlayedFinalLevel",value:function(){var a=td.levelManager.getLevel();a!==t4.MAX_LEVEL||this.isPlayedFinalLevel||(this.isPlayedFinalLevel=!0,this.gameDataManager.setGameData({currentMaxLevel:a}))}},{key:"isTutorialLevel",value:function(){return td.levelManager.isTutorialLevel()}},{key:"isFinishedNewLevel",value:function(){var a=td.levelManager.getLevel(),o=this.gameDataManager.getLevel();return o===t4.MAX_LEVEL&&!this.isPlayedFinalLevel||o-a==1}},{key:"loadLevelAsync",value:(q=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:return C.trys.push([0,2,,4]),[4,td.levelManager.preloadLevelDataAsync(o)];case 1:return C.sent(),[3,4];case 2:if(C.sent(),0===a)return[2];return[4,this.loadLevelAsync(a-1,o)];case 3:return C.sent(),[3,4];case 4:return[2]}})}),function(a,o){return q.apply(this,arguments)})},{key:"updateCustomLevel",value:(z=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=window.levelCustom,[4,Promise.all([this.setBackgroundFor({level:a}),this.loadLevelAsync(3,a)])];case 1:return o.sent(),[2]}})}),function(){return z.apply(this,arguments)})},{key:"startPlayWithFriendAsync",value:(x=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(td.levelManager.setLevel(window.levelCustom),a=tb.getResultStatus(),o=this.gameUI.header.challengeBlock,!("waiting"!==(null==a?void 0:a.status)&&!xf.Match.Enabled))return[3,2];return td.gameScene.toggleBlockInputContainer(!0),o.setActive(!1),this.tileContainer.node.active=!1,C=td.gameScene.uiManager,td.gameScene.rubyBarComp.runHideAnimationAsync(),[4,C.openResultChallengeFriendScreenAsync()];case 1:return[2,(I.sent(),void td.gameScene.toggleBlockInputContainer(!1))];case 2:if(tb.checkedPlayerFinishedMatch())return td.gameScene.toggleBlockInputContainer(!0),o.setActive(!1),this.tileContainer.node.active=!1,A=td.gameScene.uiManager,[2,(td.gameScene.rubyBarComp.runHideAnimationAsync(),A.openResultChallengeFriendScreenAsync(),void td.gameScene.toggleBlockInputContainer(!1))];return P=[],tR(window.levelCustom),tE(window.levelCustom),tL(window.levelCustom),P.push(t_.openScreenAndWaitForClose(tP.BATTLE_SCREEN),this.startGameAsync()),[4,Promise.all(P)];case 3:return I.sent(),this.gameUI.header.challengeBlock.runMatch3Timer(),[2]}})}),function(){return x.apply(this,arguments)})},{key:"startTournamentGameAsync",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.isTutorialLevel()&&this.itemManager.toggleItems(!1),[4,this.startGameAsync()];case 1:return a.sent(),[2]}})}),function(){return M.apply(this,arguments)})},{key:"startDailyChallengeGameAsync",value:(D=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=this.gameUI.footer,[4,tb.processStartMatchWithoutLogMatchStart(function(){return tb.startMatchAsync("daily-challenge")})];case 1:return C.sent(),[4,this.loadLevelDailyChallengeWithRetryAsync()];case 2:if(!C.sent())return[3,5];return td.gameScene.toggleGamePlayScreen(!0),o=tM(),window.levelCustom=o,tR(o),tE(o),td.gameScene.uiManager.setCurrentScreen(null),a.toggleItems(!1),td.gameScene.uiManager.getDashboardScreen(),[4,Promise.all([t_.closeScreenAsync(tP.DASHBOARD_SCREEN),td.gameScene.rubyBarComp.runHideAnimationAsync()])];case 3:return C.sent(),th.playMusic(tZ.BACKGROUND_MUSIC),[4,this.startGameAsync()];case 4:C.sent(),C.label=5;case 5:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"logStepProgress",value:function(a){var o=arguments.length>0&&void 0!==a&&a,C=this.tileManager.allTileAmount,A=Math.floor(100*(1-this.tileManager.numberOfTilesOnBoard/C));this._stepLogHandler.logStep(A,o),GameCore.Utils.Valid.isDebugger()}},{key:"handlePlayLevelTutorial",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.levelManager.setLevel(1),[4,this.startGameAsync()];case 1:return a.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"loadLevelResourcesAsync",value:(L=B(function(a){var o,C;var A=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:if(o=A.length>1&&void 0!==A[1]?A[1]:1e4,!td.levelManager.hasLevelData(a))return[3,4];P.label=1;case 1:return P.trys.push([1,3,,4]),[4,nr.withTimeout(this.setBackgroundFor({level:a}),o)];case 2:return[2,(P.sent(),!0)];case 3:return P.sent(),[2,!0];case 4:return P.trys.push([4,6,,7]),td.gameScene.showLoadingScreen(o/1e3,t7.RETRIEVING_PUZZLE_DATA,!0,-150),[4,Promise.all([nr.withTimeout(td.levelManager.preloadLevelDataAsync(a),o),nr.withTimeout(this.setBackgroundFor({level:a}),o)])];case 5:if(P.sent(),!td.levelManager.hasLevelData(a))throw new Error("Failed");return[2,(td.gameScene.closeLoadingScreen(),!0)];case 6:return _instanceof(C=P.sent(),Error)&&C.message,[3,7];case 7:return[2,(td.gameScene.showLoadingScreen(3,t7.OOP_SOMETHING_WENT_WRONG,!1),!1)]}})}),function(a){return L.apply(this,arguments)})},{key:"checkCanClaimRewardTournament",value:function(a){to.loadPrefabAsync("screens/".concat(tO[tP.FINISH_TOURNAMENT_INFO_SCREEN])),to.loadPrefabAsync("screens/".concat(tO[tP.REWARD_TOURNAMENT_SCREEN])),to.loadPrefabAsync("screens/".concat(tO[tP.LEADERBOARD_SCREEN]));var o=Date.now(),C=tN.getTournamentPreExpiryOffsetMs();return o<1e3*a.expiredTimeLeaderboard-C?"not-over-expired-time":a.isRewardGiven?"already-claimed-reward":1e3*a.expiredTimeLeaderboard-Date.now()<=0?"over-14-days-allow-claim-reward":"processing-claim-reward"}},{key:"claimRewardTournament",value:(E=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return xy.addLeaderboard({name:a,type:"global",autoSortRank:!0,leaderboardId:a}),this.resultTournamentLoader.setAllowLoadNewData(!0),[4,this.resultTournamentLoader.preloadLeaderboardData(a)];case 1:if(A.sent(),!(o=this.resultTournamentLoader.getCurrentPlayerEntry()))return[2,!1];return C={leaderboardId:a,playerRank:o.rank},[4,to.loadPrefabAsync("screens/".concat(tO[tP.FINISH_TOURNAMENT_INFO_SCREEN]))];case 2:return A.sent(),[4,t_.openScreenAsync(tP.FINISH_TOURNAMENT_INFO_SCREEN,C)];case 3:return[2,(A.sent(),!0)]}})}),function(a){return E.apply(this,arguments)})},{key:"updateDailyMissionCount",value:function(){for(var a=arguments.length,o=new Array(a),C=0;C<a;C++)o[C]=arguments[C];var A=o[0],P=o.slice(1),I=this.gameDataManager,B=I.getMultiData(["dailyMissions"]).dailyMissions,E={},L={passLevels:"PASS_LEVELS",useBoosters:"USE_BOOSTERS",collectTiles:"COLLECT_TILES",passLevelsInARow:"PASS_LEVELS_IN_A_ROW"};for(var O in A){var N=t9[L[O]];B[O].count>=N||(E[O]=A[O])}var F=[E].concat(R(P));I.updateDailyMissionCount.apply(I,R(F))}},{key:"getIsPlayingTournament",value:function(){return this.isPlayingTournament}},{key:"loadLevelDailyChallengeWithRetryAsync",value:(I=B(function(){var a,o,C,A,P,I;var R=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:if(a=this,o=R.length>0&&void 0!==R[0]?R[0]:1e3,C=R.length>1&&void 0!==R[1]?R[1]:500,A=function(){var o=B(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,td.gameScene.background.loadBackgroundData(P)];case 1:return o.sent(),[4,a.setBackgroundFor({level:P})];case 2:return o.sent(),[2]}})});return function(){return o.apply(this,arguments)}}(),P=tM(),!(td.levelManager.hasLevelDailyChallengeData()&&td.levelManager.getLevel()===P))return[3,2];return[4,A()];case 1:return[2,(E.sent(),!0)];case 2:return I=1,o>0&&(I+=o),td.gameScene.showLoadingScreen(0,t7.RETRIEVING_PUZZLE_DATA,!0,-150),[4,A()];case 3:E.sent(),E.label=4;case 4:if(!(I>0))return[3,12];E.label=5;case 5:return E.trys.push([5,7,,8]),[4,td.levelManager.loadDataLevelDailyChallengeAsync()];case 6:if(E.sent(),!td.levelManager.hasLevelDailyChallengeData())throw new Error("Failed");return[2,(td.gameScene.closeLoadingScreen(),!0)];case 7:return E.sent(),I--,[3,8];case 8:if(!(I>0))return[3,10];return[4,new Promise(function(a){return setTimeout(a,C)})];case 9:E.sent(),E.label=10;case 10:E.label=11;case 11:return[3,4];case 12:return[2,(td.gameScene.showLoadingScreen(3,t7.OOP_SOMETHING_WENT_WRONG,!1),!1)]}})}),function(){return I.apply(this,arguments)})},{key:"requestResetLevel",value:function(){this.shouldResetLevel=!0}},{key:"cancelResetLevel",value:function(){this.shouldResetLevel=!1}}]),G}(eo)).prototype,"gameObjects",[MN,MF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M4=L(M2.prototype,"tileContainer",[MD,MM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M5=L(M2.prototype,"vibrate",[Mx,Mz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M6=L(M2.prototype,"vfxManager",[MG,Mq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M7=L(M2.prototype,"timerHandler",[MU,MH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M8=L(M2.prototype,"effectManager",[MW,MV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M9=L(M2.prototype,"gameUI",[MK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new xc}}),xe=L(M2.prototype,"tileIconPositionManager",[MY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new SZ}}),xt=L(M2.prototype,"loader",[Mj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Te}}),xn=L(M2.prototype,"tileManager",[MX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new I6}}),xi=L(M2.prototype,"_itemManager",[MZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xr=L(M2.prototype,"_resultTournamentLoader",[MQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xa=L(M2.prototype,"_globalLeaderboardLoader",[M$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=L(M2.prototype,"gameDataManager",[M0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xs=L(M2.prototype,"tournamentStack",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M2))||M2);U._RF.pop(),U._RF.push({},"fc408dnsmFEdJkOpfoZmCM1","BannerAdController",void 0);var xm=GameCore.Plugins.Ads.Types,xg=globalThis.game,xb=xg.event,xk=xg.analytics,xw=tu.DesignSize.Portrait,xS=GameCore.Plugins.Analytics.Events,xT=function(){function n(a){var C=this;o(this,n),this.gameScene=void 0,this.handleBannerAdWhenResize=function(){C.checkBottomBannerAdSize(),C.setMaxSizeSideBannerAd()},this.gameScene=a,this.registerEvents()}return a(n,[{key:"registerEvents",value:function(){var a=this;xb.on(GameCore.Events.AD_SHOWING,function(o){return a.trackBannerAdAnalytics(xS.AD_SHOW,o)}),xb.on(GameCore.Events.AD_FAILED,function(o){return a.trackBannerAdAnalytics(xS.AD_SHOW_FAILED,o)})}},{key:"trackBannerAdAnalytics",value:function(a,o){o.type===xm.BANNER&&xk.event(a,{ad_type:"banner"})}},{key:"checkBottomBannerAdSize",value:function(){var a=e7.instance.getVisibleSize(),o=tc.worldSizeToCssSize(a.height*tq.MAX_BOTTOM_BANNER_RATIO);GameCore.Configs.Ads.BannerDisplayAdOptions.forEach(function(a){var C=a.PlacementId,A=a.Position,P=a.BannerHeight;"bottom"===A&&(P>o?tf.hideBannerAd(C):tf.showBannerAd(C))})}},{key:"setMaxSizeSideBannerAd",value:function(){var a=GameSDK.extra;if("setSideBannerAdRemainSize"in a){var o=e7.instance.getVisibleSize(),C=xw.WIDTH+24,A=(o.width-C)/2,P=tc.worldSizeToCssSize(A);a.setSideBannerAdRemainSize(P)}}}]),n}();U._RF.pop(),U._RF.push({},"0203fF1BYtCKrPZJ22ARCfb","GamePlayTransitionController",void 0);var xC=function(){var C,A,P,I,R,E,L,O;function n(a,C){o(this,n),this.gameScene=void 0,this.view=void 0,this.gameScene=a,this.view=C}return a(n,[{key:"processBackToDashboardFromGameplay",value:(O=B(function(){var a,o,C,A,P;var I=arguments;return _ts_generator(this,function(B){switch(B.label){case 0:return o=void 0===(a=(I.length>0&&void 0!==I[0]?I[0]:{}).closeSettingsScreen)||a,this.view.toggleBlockInputContainer(!0),[4,this.gameScene.waitUntilResourcesScreenLoaded(tP.DASHBOARD_SCREEN)];case 1:return B.sent(),this.gameScene.node.scene.emit(t2.BACK_TO_DASHBOARD_FROM_GAMEPLAY),C=this.gameScene.gamePlay,P=(A=td.levelManager.getLevel())!==C.gameDataManager.getLevel(),this.prepareBackToDashboard(A),this.cleanupTutorialIfNeeded(),[4,this.fadeOutGameAndSettings(o)];case 2:return B.sent(),P&&this.gameScene.restartLevel(),this.gameScene.rubyBarComp.setWidgetRightType("default"),[4,ts.waitTweenAsync(.1)];case 3:return B.sent(),this.view.updateTopBackgroundGame(),[4,this.openDashboardAndHandleMode()];case 4:return B.sent(),this.view.toggleBlockInputContainer(!1),[2]}})}),function(){return O.apply(this,arguments)})},{key:"prepareBackToDashboard",value:(L=B(function(a){return _ts_generator(this,function(o){return tU(a),tG(a),th.playMusic(tZ.DASHBOARD_MUSIC),[2]})}),function(a){return L.apply(this,arguments)})},{key:"cleanupTutorialIfNeeded",value:(E=B(function(){var a,o;return _ts_generator(this,function(C){if((a=this.gameScene.gamePlay).isTutorialLevel())(o=a.tileManager).resetTileTutorial(),o.tutorialHand.stopAnimationTutorialHand();return[2]})}),function(){return E.apply(this,arguments)})},{key:"fadeOutGameAndSettings",value:(R=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=[this.gameScene.gamePlay.gameUI.fadeOutGameScreen({shouldHideRubyBar:!0})],a&&o.push(t_.closeScreenAsync(tP.SETTINGS_SCREEN)),[4,Promise.all(o)];case 1:return C.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"openDashboardAndHandleMode",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=this.gameScene.gamePlay.gameUI.header,o=window.game.match.getMatchState().mode,[4,Promise.all([this.gameScene.uiManager.openDashboardScreenAsync(),this.view.playFadeOutTopBackgroundGame()])];case 1:if(C.sent(),!("single"!==o&&"tournament"!==o&&null!==o))return[3,3];return"challenge-friend"===o&&a.disableChallengeBlock(),[4,tb.processStartMatchWithoutLogMatchStart(function(){return tb.startMatchAsync("single")})];case 2:C.sent(),this.gameScene.gamePlay.resetSingleMode(),C.label=3;case 3:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"processBackToDashboardFromPWFGamePlay",value:(P=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(null!==this.gameScene.uiManager.getCurrentScreen())return[3,2];return[4,this.processBackToDashboard()];case 1:a.sent(),a.label=2;case 2:return[2]}})}),function(){return P.apply(this,arguments)})},{key:"processBackToDashboard",value:(A=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.view.updateTopBackgroundGame(),[4,this.gameScene.waitUntilResourcesScreenLoaded(tP.DASHBOARD_SCREEN)];case 1:return a.sent(),[4,Promise.all([td.gameScene.uiManager.openDashboardScreenAsync(),this.view.playFadeOutTopBackgroundGame()])];case 2:return a.sent(),[2]}})}),function(){return A.apply(this,arguments)})},{key:"processFadeOutTopBGGame",value:(C=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.view.updateTopBackgroundGame(),[4,this.view.playFadeOutTopBackgroundGame()];case 1:return a.sent(),[2]}})}),function(){return C.apply(this,arguments)})}]),n}();U._RF.pop(),U._RF.push({},"f32f7PxgNJJcbzWOSDlXe6F","PWFController",void 0);var xA,x_=["challenge-friend"],xP=function(){var C,A,P,I;function n(a,C){o(this,n),this.gameScene=void 0,this.view=void 0,this.gamePlay=void 0,this.gameScene=a,this.view=C,this.gamePlay=a.gamePlay}return a(n,[{key:"start",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=this.gamePlay.gameUI.header,this.gameScene.toggleBlockInputContainer(!0),th.playMusic(tZ.BACKGROUND_MUSIC),[4,this.updateLevelCustom()];case 1:if(o.sent(),!!window.levelCustom)return[3,4];return[4,this.handleWhenPlayChallengeFriendFailed()];case 2:return o.sent(),[4,this.gameScene.startSingleGamePlay()];case 3:return[2,void o.sent()];case 4:return[4,Promise.all([this.gamePlay.updateCustomLevel(),this.gameScene.loadScreenPrefabAsync(tP.BATTLE_SCREEN)])];case 5:return o.sent(),a.enableChallengeBlock(),a.updateChallengeBlockData(),this.view.hideBlackBackground(),[4,this.gamePlay.startPlayWithFriendAsync()];case 6:return o.sent(),this.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateLevelCustom",value:(P=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(o=(a=window.game.match.getMatchState()).mode,C=a.id,!(o&&C&&x_.includes(o)))return[3,2];return[4,window.game.match.api.getMatchAPI().getMatchDetailByIdAsync(C)];case 1:if((A=I.sent().extraData)&&_instanceof(A,Object)&&"level"in A)"number"==typeof(P=A.level)&&(window.levelCustom=P);I.label=2;case 2:return[2]}})}),function(){return P.apply(this,arguments)})},{key:"handleWhenPlayChallengeFriendFailed",value:(A=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,tb.processStartMatchWithoutLogMatchStart(function(){return tb.startMatchAsync("single")})];case 1:return a.sent(),[4,this.notifyPlayer()];case 2:return a.sent(),this.view.hideBlackBackground(),[2]}})}),function(){return A.apply(this,arguments)})},{key:"notifyPlayer",value:(C=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(a=tO[tP.LOADING_SCREEN],to.getExistingPrefab("screens/".concat(a)))return[3,2];return[4,to.loadPrefabAsync("screens/".concat(a))];case 1:o.sent(),o.label=2;case 2:return this.view.showLoadingScreen(3,t7.FAILED_TO_PLAY_WITH_YOUR_FRIEND,!1),[2]}})}),function(){return C.apply(this,arguments)})}]),n}();U._RF.pop(),U._RF.push({},"7747503qIRD4KzBiG3YRUcL","PaymentUtils",void 0);var xI=(0,$.ccclass)("PaymentUtils")(((xA=function(P){C(c,P);var I,R,E,L=A(c);function c(){return o(this,c),L.apply(this,arguments)}return a(c,[{key:"getCatalogAsync",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,GameSDK.payments.getCatalogAsync()];case 1:return[2,a.sent()];case 2:return a.sent(),[2,null];case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"purchaseAsync",value:(R=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:return C={productID:a},o&&(C.developerPayload=o),[4,GameSDK.payments.purchaseAsync(C)];case 1:return[2,A.sent()]}})}),function(a,o){return R.apply(this,arguments)})},{key:"consumePurchaseAsync",value:(I=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,GameSDK.payments.consumePurchaseAsync(o)];case 1:return C.sent(),this.grantPurchaseRewards(a),[2]}})}),function(a,o){return I.apply(this,arguments)})},{key:"findProductConfig",value:function(a){return Td.find(function(o){return o.productId===a})}},{key:"grantPurchaseRewards",value:function(a){var o=this.findProductConfig(a);if(o){var C=o.rewards;if(C){var A,P=td.gameScene.gamePlay.gameDataManager.getMultiData(["coins","items","removeAds"]);if(C.coins&&(P.coins+=C.coins),C.items){C.items.magicWand&&(P.items.magicWand+=C.items.magicWand),C.items.undo&&(P.items.undo+=C.items.undo),C.items.shuffle&&(P.items.shuffle+=C.items.shuffle);var I=null==(A=eh.getScene())?void 0:A.getComponentInChildren("ShopScreen");I&&I.shopContainer.updateItemAmountsInMiniItems()}if(C.removeAds)P.removeAds.endTime=Date.now()+2592e6,GameCore.Configs.Ads.BannerDisplayAdOptions.forEach(function(a){var o=a.PlacementId;tf.hideBannerAd(o)});td.gameScene.gamePlay.gameDataManager.setGameData(P)}}}}],[{key:"inst",get:function(){return this._instance||(this._instance=new c),this._instance}}]),c}(eo))._instance=void 0,xA))||xA;U._RF.pop(),U._RF.push({},"983cbdUgAlNLKh561ISkqw2","ShopController",void 0);var xB=function(){var C,A,P,I,R,L;function n(a,C){o(this,n),this.gameScene=void 0,this.view=void 0,this.gamePlay=void 0,this.canOpenShopScreen=!0,this.gameScene=a,this.view=C,this.gamePlay=a.gamePlay,this.registerEvents()}return a(n,[{key:"runAnimationGetRuby",value:(L=B(function(a){var o,C,A,P,I,R,E,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:if(I=this,R=a.animElementCount,E=a.totalRubies,O=void 0!==(L=a.withRubyBarAnimation)&&L,N=this.gameScene.gamePlay,this.view.rubyBarComponent.setCanUpdateRubyAmountAfterSetGameData(!1),N.addCoinData(E),!O)return[3,2];return[4,this.view.rubyBarComponent.runShowAnimationAsync()];case 1:F.sent(),F.label=2;case 2:return[4,this.view.purchaseAnimationContainerComponent.runAnimationGetRuby({animationElementCount:R,addCoinCount:E,worldDestinationPosition:this.view.rubyBarComponent.getWorldIconPosition(),vibrate:function(a){N.vibrate.vibrate(a)},playScaleUpCurrencyBarAnim:(P=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,I.view.rubyBarComponent.playScaleUpAnimation()];case 1:return a.sent(),[2]}})}),function(){return P.apply(this,arguments)}),playScaleDownCurrencyBarAnim:(A=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,I.view.rubyBarComponent.playScaleDownAnimation()];case 1:return a.sent(),[2]}})}),function(){return A.apply(this,arguments)}),playBubbleCurrencyBarAnim:(C=B(function(){return _ts_generator(this,function(a){return I.view.rubyBarComponent.playBubbleAnimation(),[2]})}),function(){return C.apply(this,arguments)}),addAmountToCurrencyBarWithAnimation:(o=B(function(a){return _ts_generator(this,function(o){return I.view.rubyBarComponent.addRubyAmountWithAnimation(a),[2]})}),function(a){return o.apply(this,arguments)})})];case 3:if(F.sent(),!O)return[3,5];return[4,this.view.rubyBarComponent.runHideAnimationAsync()];case 4:F.sent(),F.label=5;case 5:return this.view.rubyBarComponent.setCanUpdateRubyAmountAfterSetGameData(!0),[2]}})}),function(a){return L.apply(this,arguments)})},{key:"registerEvents",value:function(){var a,o=this;try{GameSDK.payments.onReady(function(){o.fetchUnconsumedPurchasesAsync()})}catch(o){null==(a=window.game.monitorError)||a.sendException(new Error("GameSDK payments onReady failed"),{gameSDK:window.__sdkInitiated})}}},{key:"fetchUnconsumedPurchasesAsync",value:(R=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:if(!(void 0!==(a=this.gamePlay)))return[3,13];this.view.rubyBarComponent.setCanUpdateRubyAmountAfterSetGameData(!1),a.canUpdateItemsAmountAfterSetGameData=!1,B.label=1;case 1:return B.trys.push([1,11,,12]),[4,GameSDK.payments.getPurchasesAsync()];case 2:o=B.sent(),A=E(o),B.label=3;case 3:B.trys.push([3,8,9,10]),A.s(),B.label=4;case 4:if(!!(C=A.n()).done)return[3,7];return P=C.value,[4,this.runPurchaseAsync(P)];case 5:B.sent(),B.label=6;case 6:return[3,4];case 7:return[3,10];case 8:return I=B.sent(),A.e(I),[3,10];case 9:return A.f(),[7];case 10:return[3,12];case 11:return B.sent(),[3,12];case 12:this.view.rubyBarComponent.setCanUpdateRubyAmountAfterSetGameData(!0),a.canUpdateItemsAmountAfterSetGameData=!0,B.label=13;case 13:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"runPurchaseAsync",value:(I=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return o=a.productID,C=a.purchaseToken,A=this.gamePlay.gameDataManager.getCoins(),[4,xI.inst.consumePurchaseAsync(o,C)];case 1:return P.sent(),[4,this.handlePurchasePackAsync({productId:o,oldCoins:A})];case 2:return P.sent(),[2]}})}),function(a){return I.apply(this,arguments)})},{key:"handlePurchasePackAsync",value:(P=B(function(a){var o,C,A,P,I,B,R,E,L,O,N,F,D,M,x,z,q,U;return _ts_generator(this,function(H){switch(H.label){case 0:if(C=void 0===(o=a.productId)?"":o,P=void 0===(A=a.oldCoins)?0:A,!(I=Td.find(function(a){return a.productId===C})))return[3,3];if(E=void 0===(R=(B=I.rewards).coins)?0:R,O=void 0!==(L=B.removeAds)&&L,[E,O,M=void 0===(D=(F=null!=(N=B.items)?N:{}).magicWand)?0:D,z=void 0===(x=F.undo)?0:x,U=void 0===(q=F.shuffle)?0:q].every(function(a){return!a}))return[3,2];return this.gameScene.toggleBlockInputContainer(!0),[4,this.view.runPurchaseAnimation({delay:0,oldCoins:P,coins:E,removeAds:O,magicWand:M,undo:z,shuffle:U,packType:I.type})];case 1:H.sent(),this.gameScene.node.scene.emit(t2.CLAIM_COIN_SUCCEEDED),this.gameScene.toggleBlockInputContainer(!1),H.label=2;case 2:H.label=3;case 3:return[2]}})}),function(a){return P.apply(this,arguments)})},{key:"canShowShopAndRubyBar",value:function(){return td.gameScene.gamePlay.gameDataManager.getLevel()>=t4.LEVEL_OPEN_COIN_PANEL}},{key:"handleOpenShopScreenAsync",value:(A=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.canOpenShopScreen)return[3,4];return this.canOpenShopScreen=!1,this.gameScene.toggleBlockInputContainer(!0),[4,this.gameScene.waitUntilResourcesScreenLoaded(tP.SHOP_SCREEN)];case 1:return a.sent(),[4,Promise.all([this.view.rubyBarComponent.hidePlusIcon(),this.view.rubyBarComponent.runHideAnimationAsync()])];case 2:return a.sent(),[4,Promise.all([t_.openScreenAsync(tP.SHOP_SCREEN)])];case 3:a.sent(),this.gameScene.toggleBlockInputContainer(!1),a.label=4;case 4:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"handleCloseShopScreenAsync",value:(C=B(function(){var a,o,C;var A=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:return o=(a=A.length>0&&void 0!==A[0]?A[0]:{canBlockInput:!0,canOpenFreeRuby:!1}).canBlockInput,C=a.canOpenFreeRuby,o&&this.gameScene.toggleBlockInputContainer(!0),[4,Promise.all([t_.closeScreenAsync(tP.SHOP_SCREEN)])];case 1:return P.sent(),[4,this.view.rubyBarComponent.runShowAnimationAsync()];case 2:if(P.sent(),this.view.rubyBarComponent.showPlusIcon(),this.canOpenShopScreen=!0,!C)return[3,4];return[4,t_.openScreenAsync(tP.FREE_RUBIES_SCREEN)];case 3:P.sent(),P.label=4;case 4:return o&&this.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return C.apply(this,arguments)})}]),n}();U._RF.pop(),U._RF.push({},"532a9A9fJtDqIBE1gM8RB+m","TournamentController",void 0);var xR,xE,xL,xO,xN,xF,xD,xM,xx,xz,xG,xq,xU,xH,xW,xV,xK,xY=GameCore.Configs.Mockup,xj=function(){var C,A,P,E,L,O,N,F,D,M,x,z,q,U,H,W,V,K,Y;function n(a,C){o(this,n),this.gameScene=void 0,this.view=void 0,this.node=void 0,this.gamePlay=void 0,this.isFromTourPost=!1,this.isInTourCtx=!1,this.gameScene=a,this.view=C,this.node=a.node,this.gamePlay=a.gamePlay}return a(n,[{key:"isFromTournamentPost",value:function(){return this.isFromTourPost}},{key:"isInTournamentCtx",value:function(){return this.isInTourCtx}},{key:"removeTournamentsOver21Days",value:function(){var a=this.gamePlay.gameDataManager,o=a.getMultiData(["tournamentsJoined"]).tournamentsJoined,C=Date.now(),A=o.filter(function(a){return!(C>1e3*a.expiredTimeLeaderboard)});a.setGameData({tournamentsJoined:A})}},{key:"start",value:(Y=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.gameScene.toggleBlockInputContainer(!0),th.playMusic(tZ.BACKGROUND_MUSIC),window.levelCustom=this.gamePlay.gameDataManager.getLevel(),[4,this.gamePlay.updateCustomLevel()];case 1:return a.sent(),[4,this.handlePlayGameFromTourPost()];case 2:return a.sent(),this.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return Y.apply(this,arguments)})},{key:"setUpTourData",value:function(){this.fetchTournamentDataAsync(),this.handleAddTournamentStack()}},{key:"fetchTournamentDataAsync",value:(K=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,td.tournamentManager.tryToJoinTourWithoutContext()];case 1:return"succeeded"===a.sent()&&this.node.scene.emit(t2.ADD_LEADER_BOARD_SUCCEEDED),[2]}})}),function(){return K.apply(this,arguments)})},{key:"handleAddTournamentStack",value:function(){var a=this.gamePlay.gameDataManager.getMultiData(["tournamentsJoined"]).tournamentsJoined;if(0!==a.length){a.length>=2&&this.addClaimableTournamentsToStack(a);var o=a[0],C=24*(tg.MAX_DAY_LB-tg.MAX_DAY_TOURNAMENT)*36e5;1e3*o.expiredTimeLeaderboard-C-Date.now()>=0||this.gamePlay.tournamentStack.pushTournament({leaderboardId:o.leaderboardId,expiredTimeLeaderboard:o.expiredTimeLeaderboard,isRewardGiven:o.isRewardGiven})}}},{key:"addClaimableTournamentsToStack",value:function(a){for(var o=1;o<a.length;o++){var C=a[o],A=tN.getTournamentPreExpiryOffsetMs(),P=1e3*C.expiredTimeLeaderboard-A,I=1e3*C.expiredTimeLeaderboard,B=Date.now();B<P||B>I||C.isRewardGiven||this.gamePlay.tournamentStack.addToFirstTournament({leaderboardId:C.leaderboardId,expiredTimeLeaderboard:C.expiredTimeLeaderboard,isRewardGiven:C.isRewardGiven})}}},{key:"tryToJoinTournamentAsync",value:(V=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(this.isInTourCtx)return[2,!0];return this.view.showLoadingScreen(0,t7.JOINING_TOURNAMENT,!0),[4,this.getSelectedLeaderboard()];case 1:if(!(a=P.sent()))return[2,(this.view.showLoadingScreen(3,t7.NO_TOURNAMENT_RIGHT_NOW,!1),!1)];return[4,this.tryJoinSelectedLBAsync(a)];case 2:if("failed"!==(o=P.sent()))return[3,3];return this.view.showLoadingScreen(3,t7.SORRY_YOU_CANNOT_JOIN_AT_THIS_TIME,!1),C=!1,[3,7];case 3:if("user-closed-popup"!==o)return[3,4];return this.view.closeLoadingScreen(),A=!1,[3,6];case 4:return[4,this.joinTournamentBase(a)];case 5:P.sent(),this.view.closeLoadingScreen(),this.isInTourCtx=!0,A=!0,P.label=6;case 6:C=A,P.label=7;case 7:return[2,C]}})}),function(){return V.apply(this,arguments)})},{key:"getSelectedLeaderboard",value:(W=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return[4,tN.requestValidTournamentLeaderboardsAsync()];case 1:if(0!==(a=A.sent()).length)return o=td.tournamentManager.getSelectedLeaderboardId(),[2,((C=a.find(function(a){return a._id===o}))||(C=a[0]),C)];return[2]}})}),function(){return W.apply(this,arguments)})},{key:"tryJoinSelectedLBAsync",value:(H=B(function(a){return _ts_generator(this,function(o){return[2,xY.Leaderboards.Enabled?"succeeded":td.tournamentManager.handleJoinTournamentAPIAsync(a)]})}),function(a){return H.apply(this,arguments)})},{key:"joinTournamentBase",value:(U=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return(o=this.gamePlay.resultTournamentLoader).setAllowLoadNewData(!0),td.tournamentManager.tryToJoinTourWithoutContext(a._id),this.saveJoinedTournament(),[4,o.preloadLeaderboardData(a._id)];case 1:return C.sent(),[4,this.gamePlay.timerHandler.startLeaderboardCountDown({forceStart:!0})];case 2:return C.sent(),[2]}})}),function(a){return U.apply(this,arguments)})},{key:"handlePlayGameFromTourPost",value:(q=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(C.trys.push([0,4,,6]),this.isFromTourPost=!0,a=this.getLeaderboardIdFromMatch(),!!(o=this.getJoiningTourBase(a)))return[3,2];return[4,this.handleNoJoiningTournament(a)];case 1:return[2,void C.sent()];case 2:return[4,this.handleExistingTournament(o,a)];case 3:return C.sent(),[3,6];case 4:return C.sent(),[4,this.gameScene.startSingleGamePlay()];case 5:return C.sent(),[3,6];case 6:return[2]}})}),function(){return q.apply(this,arguments)})},{key:"getLeaderboardIdFromMatch",value:function(){var a=(window.game.match.getMatchState().customData||{}).leaderboardId;if(!a)throw new Error("No leaderboardId in customData from tournament post");return a}},{key:"getJoiningTourBase",value:function(a){return this.gamePlay.gameDataManager.getMultiData(["tournamentsJoined"]).tournamentsJoined.find(function(o){return o.leaderboardId===a})}},{key:"handleNoJoiningTournament",value:(z=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,td.tournamentManager.tryToJoinTourWithoutContext(a)];case 1:if(!("succeeded"!==o.sent()))return[3,3];return[4,this.handleExpiredTournament()];case 2:return[2,void o.sent()];case 3:return[4,this.playTourGame()];case 4:return o.sent(),[2]}})}),function(a){return z.apply(this,arguments)})},{key:"handleExpiredTournament",value:(x=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.gameScene.startSingleGamePlay()];case 1:if(a.sent(),this.gamePlay.gameDataManager.getMultiData(["level"]).level<=1)return[3,3];return[4,t_.openScreenAsync(tP.FINISH_TOURNAMENT_INFO_SCREEN)];case 2:a.sent(),a.label=3;case 3:return[2]}})}),function(){return x.apply(this,arguments)})},{key:"handleExistingTournament",value:(M=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:switch(C=I({},a),this.gamePlay.checkCanClaimRewardTournament(C)){case"not-over-expired-time":return[3,1];case"processing-claim-reward":return[3,4]}return[3,7];case 1:return[4,td.tournamentManager.tryToJoinTourWithoutContext(o)];case 2:return A.sent(),[4,this.playTourGame()];case 3:return A.sent(),[3,9];case 4:return[4,this.gameScene.startSingleGamePlay()];case 5:return A.sent(),[4,this.gamePlay.claimRewardTournament(C.leaderboardId)];case 6:return A.sent(),[3,9];case 7:return[4,this.gameScene.startSingleGamePlay()];case 8:A.sent(),A.label=9;case 9:return[2]}})}),function(a,o){return M.apply(this,arguments)})},{key:"playTourGame",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.view.hideBlackBackground(),this.saveJoinedTournament(),[4,this.startGameplayAndSyncDataTournament()];case 1:return a.sent(),[2]}})}),function(){return D.apply(this,arguments)})},{key:"saveJoinedTournament",value:function(){var a=td.tournamentManager.getSelectedLeaderboardId();if(a){this.gamePlay.gameDataManager.setGameData({isUnlockTourFeature:!0});var o=this.getJoiningTourBase(a);o?this.moveTournamentToTop(o):this.addNewTournament(a)}}},{key:"moveTournamentToTop",value:function(a){var o=this.gamePlay.gameDataManager,C=o.getMultiData(["tournamentsJoined"]).tournamentsJoined,A=C.findIndex(function(o){return o.leaderboardId===a.leaderboardId});if(A>0){var P=R(C),I=[P[A],P[0]];P[0]=I[0],P[A]=I[1],o.setGameData({tournamentsJoined:P})}}},{key:"addNewTournament",value:function(a){var o=td.tournamentManager.getSelectedLeaderboardResponse();if(o){if(GameCore.Utils.Object.hasOwn(o,"expireAt")){var C=o.expireAt;if("string"==typeof C){var A=Math.round(new Date(C).getTime()/1e3),P=this.gamePlay.gameDataManager,I=P.getMultiData(["tournamentsJoined"]).tournamentsJoined,B=R(I);P.setGameData({tournamentsJoined:[{leaderboardId:a,expiredTimeLeaderboard:A,isRewardGiven:!1}].concat(R(B))})}}}}},{key:"startGameplayAndSyncDataTournament",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.node.scene.emit(t2.ADD_LEADER_BOARD_SUCCEEDED),this.gamePlay.timerHandler.startLeaderboardCountDown(),this.gamePlay.cancelResetLevel(),[4,this.gamePlay.startTournamentGameAsync()];case 1:return a.sent(),this.tryToAddTournamentJoinedData({forceMoveToTop:!0}),[2]}})}),function(){return F.apply(this,arguments)})},{key:"tryToAddTournamentJoinedData",value:(N=B(function(){var a,o,C,A;var P=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:if(o=void 0!==(a=(P.length>0&&void 0!==P[0]?P[0]:{}).forceMoveToTop)&&a,!(C=td.tournamentManager.getSelectedLeaderboardId()))return[3,3];if(!((A=this.getJoiningTourBase(C))&&o))return[3,1];return this.moveTournamentToTop(A),[3,3];case 1:return this.addNewTournament(C),[4,this.gamePlay.resultTournamentLoader.preloadLeaderboardData(C)];case 2:I.sent(),I.label=3;case 3:return[2]}})}),function(){return N.apply(this,arguments)})},{key:"joinTournamentFromPWF",value:(O=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return this.view.showLoadingScreen(0,t7.JOINING_TOURNAMENT,!0),a=td.tournamentManager.getSelectedLeaderboardId(),[4,this.tryToJoinTourFromPWF()];case 1:if(!C.sent())return[2,!1];return[2,!!(o=td.tournamentManager.getSelectedLeaderboardId())&&(this.isInTourCtx=!0,this.ensureTournamentInJoinedList(o),this.updateLBData(a,o),this.gamePlay.timerHandler.startLeaderboardCountDown({forceStart:!0}),this.view.closeLoadingScreen(),!0)]}})}),function(){return O.apply(this,arguments)})},{key:"tryToJoinTourFromPWF",value:(L=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!(o=!!(a=window.game.match.getMatchState().customData.leaderboardId)))return[3,2];return C="succeeded",[4,td.tournamentManager.tryToJoinTourWithoutContext(a)];case 1:o=C===A.sent(),A.label=2;case 2:return[2,o&&(this.node.scene.emit(t2.ADD_LEADER_BOARD_SUCCEEDED),!0)]}})}),function(){return L.apply(this,arguments)})},{key:"ensureTournamentInJoinedList",value:function(a){if(0!==a.length){var o=this.getJoiningTourBase(a);o?this.moveTournamentToTop(o):this.addNewTournament(a)}}},{key:"updateLBData",value:(E=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:if(C=this.gamePlay.resultTournamentLoader,!(a!==o))return[3,2];return C.setAllowLoadNewData(!0),[4,C.preloadLeaderboardData(o)];case 1:A.sent(),A.label=2;case 2:return[2]}})}),function(a,o){return E.apply(this,arguments)})},{key:"removeTourFromData",value:function(a){var o=this.gamePlay.gameDataManager,C=o.getMultiData(["tournamentsJoined"]).tournamentsJoined.filter(function(o){return o.leaderboardId!==a});o.setGameData({tournamentsJoined:C})}},{key:"tryToPlayNewTournament",value:(P=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,td.tournamentManager.tryToJoinTourWithoutContext()];case 1:if("succeeded"!==o.sent())return[3,3];return a=this.gamePlay.resultTournamentLoader,this.gamePlay.timerHandler.startLeaderboardCountDown(),a.setAllowLoadNewData(!0),[4,a.preloadLeaderboardData()];case 2:return o.sent(),[3,4];case 3:o.label=4;case 4:return[2]}})}),function(){return P.apply(this,arguments)})},{key:"isJoinedCurTour",value:function(){var a=td.tournamentManager.getSelectedLeaderboardId();return!!a&&!!this.getJoiningTourBase(a)}},{key:"tryToReturnSingleMode",value:(A=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(o=window.game.match.getMatchState().mode,this.removeTourFromData(a),"tournament"!==o)return[3,2];return this.view.showLoadingScreen(0,t7.LOADING,!0),[4,tb.startMatchAsync("single")];case 1:C.sent(),this.isInTourCtx=!1,this.view.closeLoadingScreen(),C.label=2;case 2:return[2]}})}),function(a){return A.apply(this,arguments)})},{key:"tryToOpenPopupJoinTourAsync",value:(C=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.isInTourCtx)return[2,!0];if(xY.Leaderboards.Enabled)return[2,!0];if(!(a=td.tournamentManager.getSelectedLeaderboardResponse()))return[2,!1];return[4,td.tournamentManager.handleJoinTournamentAPIAsync(a)];case 1:return[2,"failed"===(o=C.sent())?(this.view.showLoadingScreen(3,t7.SORRY_YOU_CANNOT_JOIN_AT_THIS_TIME,!1),!1):"user-closed-popup"!==o&&(this.isInTourCtx=!0,!0)]}})}),function(){return C.apply(this,arguments)})}]),n}();U._RF.pop(),U._RF.push({},"f088cMqlhhI15xEssi0Fwgy","GameSceneView",void 0);var xX,xJ,xZ,xQ,x$,x0,x1,x2,x3,x4,x5,x6=$.ccclass,x7=$.property,x8=(xR=x6("GameSceneView"),xE=x7(ee),xL=tj.required,xO=x7(ee),xN=tj.required,xF=x7(ne),xD=tj.required,xM=x7(P3),xx=tj.required,xz=x7(ee),xG=tj.required,xR((xU=L((xq=function(){var C;function n(){o(this,n),O(this,"blackBg",xU,this),O(this,"blockInputContainer",xH,this),O(this,"loadingScreen",xW,this),O(this,"backgroundManager",xV,this),O(this,"topGameBg",xK,this)}return a(n,[{key:"init",value:function(){tj.validateRequiredProperties(this,n)}},{key:"backgroundManagerComponent",get:function(){return this.backgroundManager}},{key:"createBackgroundBorderLandscape",value:function(a){var o=to.getExistingPrefab("".concat(no.BG_BORDER_LANDSCAPE,"BackgroundBorderLandscape"));if(o){var C=ej(o);C.active=!0;var A=a.children.length;A>1?a.insertChild(C,A-1):a.addChild(C)}}},{key:"hideBlackBackground",value:function(){var a=this;requestAnimationFrame(function(){a.blackBg.active=!1})}},{key:"toggleBlockInputContainer",value:function(a){this.blockInputContainer.active=a}},{key:"toggleGamePlayScreen",value:function(a){this.backgroundManager.node.active=a}},{key:"showLoadingScreen",value:function(a,o,C,A){var P=arguments.length>0&&void 0!==a?a:0,I=arguments.length>1&&void 0!==o?o:"",B=arguments.length>2&&void 0!==C&&C,R=arguments.length>3&&void 0!==A?A:0;this.loadingScreen.updateScreenData({screenName:tO[tP.LOADING_SCREEN],screenData:{duration:P,message:I,loading:B,offsetText:R}}),this.loadingScreen.open()}},{key:"closeLoadingScreen",value:function(){this.loadingScreen.close()}},{key:"updateTopBackgroundGame",value:function(){var a=this.topGameBg.getComponent(W);if(a)a.spriteFrame=this.backgroundManager.getCurrentLevelGameBg()}},{key:"playFadeOutTopBackgroundGame",value:(C=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(this.resizeTopBackgroundGame(),!((a=this.topGameBg.getComponent(W))&&a.spriteFrame))return[3,2];if(!(o=a.getComponent(ea)))return[3,2];return this.topGameBg.active=!0,o.opacity=255,C=Y(o).to(.256,{opacity:0}),[4,ts.runTweenAsync(C)];case 1:A.sent(),this.topGameBg.active=!1,A.label=2;case 2:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"resizeTopBackgroundGame",value:function(){var a=this.backgroundManager.getUITransform();if(a){var o=this.topGameBg.getComponent(en);if(o){var C=a.width,A=a.height;o.setContentSize(C,A)}}}}]),n}()).prototype,"blackBg",[xE,xL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xH=L(xq.prototype,"blockInputContainer",[xO,xN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xW=L(xq.prototype,"loadingScreen",[xF,xD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xV=L(xq.prototype,"backgroundManager",[xM,xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xK=L(xq.prototype,"topGameBg",[xz,xG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xq))||xq);U._RF.pop(),U._RF.push({},"2ee43+s9QlF4YuS8zXfm4ae","ShopView",void 0);var x9,ze,zt,zn,zi,zr,za,zo,zs,zl,zu,zc,zh,zp,zf,zy,zv,zm,zg,zb,zk,zw,zS,zT,zC,zA=$.ccclass,z_=$.property,zP=(xX=zA("ShopView"),xJ=z_(yX),xZ=tj.required,xQ=z_(en),x$=tj.required,x0=z_(f5),x1=tj.required,xX((x3=L((x2=function(){var C,A;function n(){o(this,n),O(this,"rubyBar",x3,this),O(this,"rubyBarZone",x4,this),O(this,"purchaseAnimationContainer",x5,this)}return a(n,[{key:"rubyBarComponent",get:function(){return this.rubyBar}},{key:"purchaseAnimationContainerComponent",get:function(){return this.purchaseAnimationContainer}},{key:"init",value:function(){this.purchaseAnimationContainer.initHandlers(),this.purchaseAnimationContainer.node.active=!1,tj.validateRequiredProperties(this,n)}},{key:"runPurchaseAnimation",value:(A=B(function(a){var o,C,A,P,I,R,L,O,N,F,D,M,x,z,q,U,H,W,V,K,Y,j,X,J,Z;return _ts_generator(this,function(Q){switch(Q.label){case 0:if(o=this,C=a.delay,A=a.oldCoins,P=a.coins,I=a.removeAds,R=a.magicWand,L=a.undo,O=a.shuffle,N=a.packType,F=td.gameScene.uiManager.getScreen(tO[tP.DASHBOARD_SCREEN],Nr),D=td.gameScene.uiManager.getScreen(tO[tP.NO_MORE_MOVE_SCREEN],B6),this.rubyBar.setRubyAmountWithoutAnimation(A),th.playSound(tZ.REWARD_APPEAR),U=null==D?void 0:D.node.active,H=null==F?void 0:F.node.active,W=void 0,H){W={},K=E(d3);try{for(K.s();!(V=K.n()).done;)Y=V.value,W[String(Y)]=F.getPlayGameButton()}catch(a){K.e(a)}finally{K.f()}}else if(U);else{W={},X=td.gameScene.gamePlay.gameUI.footer,J=E(X.items);try{for(J.s();!(j=J.n()).done;)W[(Z=j.value).itemDataName]=Z}catch(a){J.e(a)}finally{J.f()}}return[4,this.purchaseAnimationContainer.runAnimations({delay:C,data:{packType:N,coins:P,magicWand:R,undo:L,shuffle:O,removeAds:I},currencyFlyConfig:{animationElementCount:10,addCoinCount:P,worldDestinationPosition:this.rubyBar.getWorldIconPosition(),vibrate:function(a){td.gameScene.gamePlay.vibrate.vibrate(a)},playScaleUpCurrencyBarAnim:(q=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,o.rubyBar.playScaleUpAnimation()];case 1:return a.sent(),[2]}})}),function(){return q.apply(this,arguments)}),playScaleDownCurrencyBarAnim:(z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,o.rubyBar.playScaleDownAnimation()];case 1:return a.sent(),[2]}})}),function(){return z.apply(this,arguments)}),playBubbleCurrencyBarAnim:(x=B(function(){return _ts_generator(this,function(a){return o.rubyBar.playBubbleAnimation(),[2]})}),function(){return x.apply(this,arguments)}),addAmountToCurrencyBarWithAnimation:(M=B(function(a){return _ts_generator(this,function(C){return o.rubyBar.addRubyAmountWithAnimation(a),[2]})}),function(a){return M.apply(this,arguments)}),playBoosterBurstEffect:function(a){o.purchaseAnimationContainer.playBoosterBurstEffectAt(a)}},itemsFlyConfig:{destinationComps:W,onEachItemComplete:function(a,C){if(o.purchaseAnimationContainer.playBoosterBurstEffectAt(C),H)null==F||F.runPlayButtonCollectItemAnimation();else{var A=a.getComponent(C$);if(!A)return;A.playButtonPulseScaleAnimation(),A.updateItemUI()}}},shouldHideCollectButtonBeforeItemsFly:U})];case 1:return Q.sent(),[2]}})}),function(a){return A.apply(this,arguments)})},{key:"runAnimationGetRubyByFreeRubiesScreen",value:(C=B(function(a,o){var C,A,P,I;return _ts_generator(this,function(R){switch(R.label){case 0:return P=this,I={addCoinCount:o,startPosition:a,worldDestinationPosition:this.rubyBar.getWorldIconPosition(),vibrate:function(a){td.gameScene.gamePlay.vibrate.vibrate(a)},playBubbleCurrencyBarAnim:(A=B(function(){return _ts_generator(this,function(a){return P.rubyBar.playBubbleAnimation(),[2]})}),function(){return A.apply(this,arguments)}),addAmountToCurrencyBarWithAnimation:(C=B(function(a){return _ts_generator(this,function(o){return P.rubyBar.addRubyAmountWithAnimation(a),[2]})}),function(a){return C.apply(this,arguments)})},[4,this.purchaseAnimationContainer.runAnimationGetRubyByFreeRubiesScreen(I)];case 1:return R.sent(),[2]}})}),function(a,o){return C.apply(this,arguments)})},{key:"getRubyBarZoneHeight",value:function(){return this.rubyBarZone.height}}]),n}()).prototype,"rubyBar",[xJ,xZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x4=L(x2.prototype,"rubyBarZone",[xQ,x$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x5=L(x2.prototype,"purchaseAnimationContainer",[x0,x1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x2))||x2);U._RF.pop(),U._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var zI,zB,zR,zE,zL,zO,zN,zF=$.ccclass,zD=$.disallowMultiple,zM=$.property,zx=globalThis.game,zz=zx.audio,zG=zx.event,zq=tu.Layout;x9=zF("GameScene"),ze=zM(xv),zt=tj.required,zn=zM(Ny),zi=tj.required,zr=zM(x8),za=tj.required,zo=zM(zP),zs=tj.required,zl=tj.required,zu=tj.required,zc=tj.required,zh=tj.required,zp=tj.required,x9(zf=zD((zv=L((zy=function(P){C(v,P);var I,R,E,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"gamePlay",zv,N(a)),O(a,"uiManager",zm,N(a)),O(a,"gameSceneView",zg,N(a)),O(a,"shopView",zb,N(a)),O(a,"tourController",zk,N(a)),O(a,"pwfController",zw,N(a)),O(a,"shopController",zS,N(a)),O(a,"bannerAdController",zT,N(a)),O(a,"gamePlayTransitionController",zC,N(a)),a.isCreateDevTool=!1,a.isFirstSession=!1,a.isFirstWin=!0,a.handleGameMaskWhenLayoutChanged=function(a){var o=e8("Canvas/Game/GameObjects");if(o){var C=o.getComponent(e2);C&&(C.enabled=a===zq.Landscape)}},a}return a(v,[{key:"setIsFirstWin",value:function(a){this.isFirstWin=a}},{key:"getIsFirstWin",value:function(){return this.isFirstWin}},{key:"toggleBlockInputContainer",value:function(a){this.gameSceneView.toggleBlockInputContainer(a)}},{key:"toggleGamePlayScreen",value:function(a){this.gameSceneView.toggleGamePlayScreen(a)}},{key:"restartLevel",value:function(){this.gamePlay.itemManager.setRescued(!1)}},{key:"showLoadingScreen",value:function(a,o,C,A){var P=arguments.length>0&&void 0!==a?a:0,I=arguments.length>1&&void 0!==o?o:"",B=arguments.length>2&&void 0!==C&&C,R=arguments.length>3&&void 0!==A?A:0;this.gameSceneView.showLoadingScreen(P,I,B,R)}},{key:"closeLoadingScreen",value:function(){this.gameSceneView.closeLoadingScreen()}},{key:"rubyBarComp",get:function(){return this.shopView.rubyBarComponent}},{key:"background",get:function(){return this.gameSceneView.backgroundManagerComponent}},{key:"waitUntilResourcesScreenLoaded",value:(M=B(function(){var a;var o=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:return a=o.length>0&&void 0!==o[0]?o[0]:tP.DASHBOARD_SCREEN,this.gameSceneView.showLoadingScreen(0,t7.LOADING,!0),[4,this.loadScreenPrefabAsync(a)];case 1:return C.sent(),this.gameSceneView.closeLoadingScreen(),[2]}})}),function(){return M.apply(this,arguments)})},{key:"loadScreenPrefabAsync",value:(D=B(function(){var a;var o=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:if(a=o.length>0&&void 0!==o[0]?o[0]:tP.DASHBOARD_SCREEN,to.getExistingPrefab("screens/".concat(tO[a])))return[3,2];return[4,to.loadPrefabAsync("screens/".concat(tO[a]))];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"shop",get:function(){return{runAnimationGetRuby:this.shopController.runAnimationGetRuby.bind(this.shopController),canShowShopAndRubyBar:this.shopController.canShowShopAndRubyBar.bind(this.shopController),handleOpenShopScreenAsync:this.shopController.handleOpenShopScreenAsync.bind(this.shopController),handleCloseShopScreenAsync:this.shopController.handleCloseShopScreenAsync.bind(this.shopController),handlePurchasePackAsync:this.shopController.handlePurchasePackAsync.bind(this.shopController),getRubyBarZoneHeight:this.shopView.getRubyBarZoneHeight.bind(this.shopView),runAnimationGetRubyByFreeRubiesScreen:this.shopView.runAnimationGetRubyByFreeRubiesScreen.bind(this.shopView)}}},{key:"tournament",get:function(){return{tryToReturnSingleMode:this.tourController.tryToReturnSingleMode.bind(this.tourController),isFromTournamentPost:this.tourController.isFromTournamentPost.bind(this.tourController),isInTournamentContext:this.tourController.isInTournamentCtx.bind(this.tourController),isJoinedCurTour:this.tourController.isJoinedCurTour.bind(this.tourController),tryToJoinTournamentAsync:this.tourController.tryToJoinTournamentAsync.bind(this.tourController),joinTournamentFromPWF:this.tourController.joinTournamentFromPWF.bind(this.tourController),tryToPlayNewTournament:this.tourController.tryToPlayNewTournament.bind(this.tourController),tryToOpenPopupJoinTourAsync:this.tourController.tryToOpenPopupJoinTourAsync.bind(this.tourController)}}},{key:"transition",get:function(){return{processBackToDashboardFromGameplay:this.gamePlayTransitionController.processBackToDashboardFromGameplay.bind(this.gamePlayTransitionController),processBackToDashboardFromPWFGamePlay:this.gamePlayTransitionController.processBackToDashboardFromPWFGamePlay.bind(this.gamePlayTransitionController),processBackToDashboard:this.gamePlayTransitionController.processBackToDashboard.bind(this.gamePlayTransitionController),processFadeOutTopBGGame:this.gamePlayTransitionController.processFadeOutTopBGGame.bind(this.gamePlayTransitionController)}}},{key:"__preload",value:function(){this.listenGameEvents(),this.initViews(),this.initControllers(),this.checkAndShowDevToolOrNot(),tj.validateRequiredProperties(this,v)}},{key:"checkAndShowDevToolOrNot",value:(F=B(function(){var a,o,C,A,P,I,B;var R=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:if(a=R.length>0&&void 0!==R[0]?R[0]:{},!!this.isCreateDevTool)return[3,3];if(o="dev-tool/DevToolManager",C=GameCore.Utils.Valid.isDebugger(),P=void 0!==(A=a.forceOpen)&&A,!(C||P))return[3,3];if(to.getExistingPrefab(o))return[3,2];return[4,to.loadPrefabAsync(o)];case 1:E.sent(),E.label=2;case 2:if(I=to.getExistingPrefab(o))B=ej(I),this.node.addChild(B),this.isCreateDevTool=!0;E.label=3;case 3:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"listenGameEvents",value:function(){var a=this;ep.on(tl.LAYOUT_CHANGED,this.handleGameMaskWhenLayoutChanged),zG.catchUp(tl.IS_FIRST_SESSION,function(){a.setIsFirstSession(!0)})}},{key:"setIsFirstSession",value:function(a){this.isFirstSession=a}},{key:"initViews",value:function(){this.gameSceneView.init(),this.shopView.init()}},{key:"initControllers",value:function(){this.tourController=new xj(this,this.gameSceneView),this.pwfController=new xP(this,this.gameSceneView),this.shopController=new xB(this,this.shopView),this.bannerAdController=new xT(this),this.gamePlayTransitionController=new xC(this,this.gameSceneView)}},{key:"onLoad",value:function(){nr.isPortrait()||this.gameSceneView.createBackgroundBorderLandscape(this.node),this.bannerAdController.handleBannerAdWhenResize()}},{key:"start",value:function(){this.preStartGame(),this.startGamePlay()}},{key:"preStartGame",value:function(){var a=this.gamePlay;this.updateVolumeBackgroundMusic(),this.shopView.rubyBarComponent.runWidgetRightTypeUpdateAnimation("default"),a.loadAllSounds(),a.gameDataManager.tryToResetDailyMissionsGameData(),a.globalLeaderboardLoader.initGlobalLeaderboard(),this.tourController.removeTournamentsOver21Days(),this.gamePlay.attemptSubscribeBotAsync(),this.canUnlockTournamentFeature()&&a.gameDataManager.setGameData({isUnlockTourFeature:!0})}},{key:"updateVolumeBackgroundMusic",value:function(){zz.setVolume(1,"global_music")}},{key:"canUnlockTournamentFeature",value:function(){var a=this.gamePlay;return a.gameDataManager.getLevel()>=t4.TOURNAMENT_LEVEL_START&&!a.gameDataManager.isUnlockTourFeature()}},{key:"startGamePlay",value:(L=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:switch(a=window.game.match.getMatchState().mode,GameCore.Utils.Valid.isDebugger()&&F3.measureBundlesSize(),a){case"challenge-friend":return[3,1];case"tournament":return[3,3]}return[3,5];case 1:return this.tourController.setUpTourData(),[4,this.pwfController.start()];case 2:return o.sent(),[3,7];case 3:return[4,this.tourController.start()];case 4:return o.sent(),[3,7];case 5:return this.tourController.setUpTourData(),[4,this.startSingleGamePlay()];case 6:o.sent(),o.label=7;case 7:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"startSingleGamePlay",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(this.gameSceneView.hideBlackBackground(),1!==this.gamePlay.gameDataManager.getLevel())return[3,2];return[4,this.playLevelOne()];case 1:return a.sent(),[3,4];case 2:return[4,this.showDashboardAsync()];case 3:a.sent(),a.label=4;case 4:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"playLevelOne",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.toggleBlockInputContainer(!0),this.gamePlay.itemManager.toggleItems(!1),[4,this.gamePlay.setBackgroundFor({level:1})];case 1:return a.sent(),[4,this.gamePlay.startGameAsync()];case 2:return a.sent(),th.playMusic(tZ.BACKGROUND_MUSIC),this.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"showDashboardAsync",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playMusic(tZ.DASHBOARD_MUSIC),[4,this.gamePlay.openDashboardScreen()];case 1:return a.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),v}(eo)).prototype,"gamePlay",[ze,zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zm=L(zy.prototype,"uiManager",[zn,zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zg=L(zy.prototype,"gameSceneView",[zr,za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new x8}}),zb=L(zy.prototype,"shopView",[zo,zs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zP}}),zk=L(zy.prototype,"tourController",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zw=L(zy.prototype,"pwfController",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zS=L(zy.prototype,"shopController",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=L(zy.prototype,"bannerAdController",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zC=L(zy.prototype,"gamePlayTransitionController",[zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf=zy))||zf),U._RF.pop(),U._RF.push({},"65c50gbLK5PkqKR9sfiblaS","DailyChallengeBlock",void 0);var zU,zH=$.ccclass,zW=$.property;zI=zH("DailyChallengeBlock"),zB=zW(er),zR=tj.required,zE=tj.required,zI((zO=L((zL=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"dayText",zO,N(a)),O(a,"uiOpacity",zN,N(a)),a}return a(u,[{key:"__preload",value:function(){this.uiOpacity=this.node.getComponent(ea),this.uiOpacity&&(this.uiOpacity.opacity=0),this.updateTextDate(),tj.validateRequiredProperties(this,u)}},{key:"updateTextDate",value:function(){var a=new Date,o="".concat(["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][a.getMonth()]," ").concat(String(a.getDate()).padStart(2,"0"),", ").concat(a.getFullYear());this.setDayText(o)}},{key:"setActive",value:function(a){this.node.active=a}},{key:"setDayText",value:function(a){this.dayText.string=a}},{key:"fadeIn",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){Y(a.uiOpacity).delay(.2).to(.3,{opacity:255}).call(function(){o()}).start()})]})}),function(){return R.apply(this,arguments)})},{key:"fadeOut",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){Y(a.uiOpacity).delay(.15).to(.1,{opacity:0}).call(function(){o()}).start()})]})}),function(){return I.apply(this,arguments)})}]),u}(eo)).prototype,"dayText",[zB,zR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zN=L(zL.prototype,"uiOpacity",[zE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zL)),U._RF.pop(),U._RF.push({},"2b2ebUm0nFD64V/fcD8RPF/","TestLayoutScene",void 0);var zV,zK,zY,zj,zX=$.ccclass,zJ=$.disallowMultiple;zX("TestLayoutScene")(zU=zJ(zU=function(P){C(r,P);var I=A(r);function r(){var a;return o(this,r),(a=I.call(this)).handleLayoutChange=function(){t_.showNotificationScreen("Layout changed")},ns.markIsTestScene(nl.TEST_LAYOUT_SCENE),a}return a(r,[{key:"start",value:function(){this.isValid&&this.listenGameEvents()}},{key:"listenGameEvents",value:function(){ep.on(tl.LAYOUT_CHANGED,this.handleLayoutChange)}},{key:"switchScene",value:function(){ns.switchScene(nl.DASHBOARD_SCENE)}}]),r}(eo))||zU),U._RF.pop(),U._RF.push({},"c0a5fPghzxBxpXiudxt+Qd4","TestParticleSystemScene",void 0);var zZ,zQ=$.ccclass,z$=$.property;zV=zQ("TestParticleSystemScene"),zK=z$(pj),zV((zj=L((zY=function(P){C(r,P);var I=A(r);function r(){var a;return o(this,r),a=I.call(this),O(a,"starParticleSystem",zj,N(a)),ns.markIsTestScene(nl.TEST_PARTICLE_SYSTEM_SCENE),a}return a(r,[{key:"start",value:function(){var a=this;this.isValid&&this.scheduleOnce(function(){a.starParticleSystem.play()},1)}}]),r}(eo)).prototype,"starParticleSystem",[zK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zY)),U._RF.pop(),U._RF.push({},"7dc71c6qMBI/ZZfA4rG4nFv","TestPerformanceScene",void 0);var z0,z1=$.ccclass,z2=$.disallowMultiple;z1("TestPerformanceScene")(zZ=z2(zZ=function(P){C(r,P);var I=A(r);function r(){var a;return o(this,r),a=I.call(this),ns.markIsTestScene(nl.TEST_PERFORMANCE_SCENE),a}return a(r,[{key:"start",value:function(){this.isValid&&this.listenEvents()}},{key:"listenEvents",value:function(){}}]),r}(eo))||zZ),U._RF.pop(),U._RF.push({},"0a4aeK2lAdAjq0xWi6SCbV+","TestScene",void 0);var z3=$.ccclass,z4=$.disallowMultiple,z5=GameCore.Events,z6=globalThis.game.event;z3("TestScene")(z0=z4(z0=function(P){C(r,P);var I=A(r);function r(){var a;return o(this,r),a=I.call(this),ns.markIsTestScene(nl.TEST_SCENE),a}return a(r,[{key:"start",value:function(){this.isValid&&(this.listenScreenEvents(),t_.openScreen(tP.LOADING_SCREEN,{duration:.5}))}},{key:"listenScreenEvents",value:function(){z6.once(z5.CLOSED_SCREEN,function(a){a.screenName,tO[tP.LOADING_SCREEN]})}}]),r}(eo))||z0),U._RF.pop(),U._RF.push({},"b16e7w74XVALY8Zco6TJYe7","AdsFlows",void 0);var z7=$.ccclass,z8=GameCore.Plugins.Ads.Types;z7("AdsFlows")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"preloadAds",value:function(){tf.preloadAds()}},{key:"checkServiceDegraded",value:function(){var a=tf.isServiceDegraded();t_.showNotificationScreen("Service degraded: ".concat(a?"true":"false"))}},{key:"loadInterstitialAd",value:function(){tf.preloadAdsByType(z8.INTERSTITIAL)}},{key:"loadRewardedVideoAd",value:function(){tf.preloadAdsByType(z8.REWARDED_VIDEO)}},{key:"loadRewardedInterstitialAd",value:function(){tf.preloadAdsByType(z8.REWARDED_INTERSTITIAL)}},{key:"showInterstitialAd",value:function(){tf.showInterstitialAdAsync({contextType:"browse"})}},{key:"showRewardedVideoAd",value:function(){tf.showRewardVideoAdAsync("",{contextType:"reward",forceLoad:!0})}},{key:"showRewardedInterstitialAd",value:function(){tf.showRewardedInterstitialAdAsync({contextType:"reward",forceLoad:!0})}},{key:"showBannerAd",value:function(){tf.showBannerAds()}},{key:"hideBannerAd",value:function(){tf.hideBannerAds()}},{key:"showAdsenseInterstitialAd",value:function(){tf.showInterstitialAdAsync({adService:"adsense"})}},{key:"showAdsenseRewardedVideoAd",value:function(){tf.showRewardVideoAdAsync("",{adService:"adsense",forceLoad:!0})}},{key:"showAdsenseRewardedInterstitialAd",value:function(){tf.showRewardedInterstitialAdAsync({adService:"adsense",forceLoad:!0})}}]),r}(eo)),U._RF.pop(),U._RF.push({},"56a103phldKO7/xShKcD3bI","AnimationDemo",void 0),(0,$.ccclass)("AnimationDemo")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"onLoad",value:function(){}},{key:"switchToTestTransitionScene",value:function(){ns.switchScene("TestTransitionScene")}}]),r}(eo)),U._RF.pop(),U._RF.push({},"a3b8adQtftPmKSSoumHWY1e","AudioDemo",void 0),(0,$.ccclass)("AudioDemo")(function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).musicComp=void 0,a.isMusicMute=!1,a.soundComp=void 0,a.isSoundMute=!1,a.listSounds=[],a}return a(r,[{key:"onLoad",value:function(){var a,o;this.musicComp=null==(a=e8("Music"))?void 0:a.getComponent("Music"),this.soundComp=null==(o=e8("Sound"))?void 0:o.getComponent("Sound"),this.validateRequiredComponents(),this.listSounds=[tZ.BEE_FLYING,tZ.BEE_STING_DOGE,tZ.BG_MUSIC,tZ.BUTTON_CLICK,tZ.COLLECTING_COINS,tZ.DOGE_DIES,tZ.DOGE_HURT,tZ.END_DRAW,tZ.HAND_CLAP,tZ.LEVEL_FAIL,tZ.LEVEL_PASS,tZ.LOST_STAR_IN_GAMEPLAY,tZ.RAISE_STAR,tZ.SPAWN_COINS,tZ.STAR_RAISE,tZ.TOUCH_START,tZ.BEE_BULLET_EXPLODE]}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"playBackgroundMusic",value:function(){this.musicComp.play(tZ.BG_MUSIC)}},{key:"pauseBackgroundMusic",value:function(){this.musicComp.pause(tZ.BG_MUSIC)}},{key:"stopBackgroundMusic",value:function(){this.musicComp.stop(tZ.BG_MUSIC)}},{key:"randomMusicChannelVolume",value:function(){var a=Math.random();this.musicComp.setVolume(a)}},{key:"toggleMuteMusicChannel",value:function(){this.isMusicMute?(this.musicComp.mute(!1),this.isMusicMute=!1):(this.musicComp.mute(!0),this.isMusicMute=!0)}},{key:"playRandomSound",value:function(){var a=Math.floor(Math.random()*this.listSounds.length),o=this.listSounds[a];o&&this.soundComp.play(o)}},{key:"toggleMuteSoundChannel",value:function(){this.isSoundMute?(this.soundComp.mute(!1),this.isSoundMute=!1):(this.soundComp.mute(!0),this.isSoundMute=!0)}},{key:"randomSoundChannelVolume",value:function(){var a=Math.random();this.soundComp.setVolume(a)}}]),r}(eo)),U._RF.pop(),U._RF.push({},"9e6b330nHBK2oNz8N9/lpDx","FlowChallenge",void 0);var z9,Ge,Gt,Gn,Gi,Gr,Ga,Go,Gs,Gl,Gu,Gc=$.ccclass,Gh=GameCore.Utils,Gp=Gh.Decorator,Gd=Gh.String,Gf=Gh.Number,Gy=globalThis.game,Gv=Gy.match,Gm=Gy.player,CJ=function(a){t_.closeLoadingScreen(),_instanceof(a,Error)&&t_.showNotificationScreen(a.message)};z9=Gc("FlowChallenge"),Ge=Gp.tryCatch(CJ),Gt=Gp.tryCatch(CJ),Gn=Gp.tryCatch(CJ),Gi=Gp.tryCatch(CJ),Gr=Gp.tryCatch(CJ),z9((L((Ga=function(P){C(p,P);var I,R,E,L,O,N=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=N.call.apply(N,[this].concat(A))).playerId="",a.matchId="",a.contextId="",a.opponentId="",a}return a(p,[{key:"onLoad",value:function(){this.playerId=Gm.getPlayerId(),this.matchId=Gd.generateObjectId(),this.contextId=Gd.generateObjectId(),this.opponentId=Gd.generateObjectId()}},{key:"inviteFriends",value:(O=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return t_.showLoadingScreen(0),[4,Gv.challenge.invite.processAsync({playerId:this.playerId,extraData:{rescued:0}})];case 1:return a.sent(),[2]}})}),function(){return O.apply(this,arguments)})},{key:"challengeFriend",value:(L=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a={playerId:this.playerId,opponentId:this.opponentId},t_.showLoadingScreen(0),[4,Gv.challenge.friend.processAsync(a)];case 1:return o.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"joinChallenge",value:(E=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return o=Gv.getMatchState(),C={playerId:this.playerId,contextId:Gd.generateObjectId(),matchId:null!=(a=o.id)?a:this.matchId,opponentId:this.opponentId},t_.showLoadingScreen(0),[4,Gv.challenge.join.processAsync(C)];case 1:return A.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"continueChallenge",value:(R=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return o=Gv.getMatchState(),C={playerId:this.playerId,matchId:null!=(a=o.id)?a:this.matchId,contextId:this.contextId,opponentId:this.opponentId},t_.showLoadingScreen(0),[4,Gv.challenge.continue.processAsync(C)];case 1:return A.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"finishChallenge",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return t_.showLoadingScreen(0),[4,Gv.challenge.finish.processAsync({playerId:this.playerId,playerScore:Gf.random(99999)})];case 1:return a.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),p}(eo)).prototype,"inviteFriends",[Ge],Object.getOwnPropertyDescriptor(Ga.prototype,"inviteFriends"),Ga.prototype),L(Ga.prototype,"challengeFriend",[Gt],Object.getOwnPropertyDescriptor(Ga.prototype,"challengeFriend"),Ga.prototype),L(Ga.prototype,"joinChallenge",[Gn],Object.getOwnPropertyDescriptor(Ga.prototype,"joinChallenge"),Ga.prototype),L(Ga.prototype,"continueChallenge",[Gi],Object.getOwnPropertyDescriptor(Ga.prototype,"continueChallenge"),Ga.prototype),L(Ga.prototype,"finishChallenge",[Gr],Object.getOwnPropertyDescriptor(Ga.prototype,"finishChallenge"),Ga.prototype),Ga)),U._RF.pop(),U._RF.push({},"f3decJ3ZlRLt6CDMHpl1XCe","FlowContext",void 0);var Gg,Gb,Gk,Gw,GS,GT=$.ccclass,GC=GameCore.Utils.Decorator,GA=globalThis.game,G_=GA.match,GP=GA.player,GI=GA.context,MJ=function(a){t_.closeLoadingScreen(),_instanceof(a,Error)&&t_.showNotificationScreen(a.message)};Go=GT("FlowContext"),Gs=GC.tryCatch(MJ),Gl=GC.tryCatch(MJ),Go((L((Gu=function(P){C(c,P);var R,E,L=A(c);function c(){var a;o(this,c);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=L.call.apply(L,[this].concat(A))).playerId="",a.changeContext=function(){var a=B(function(a,o,C){return _ts_generator(this,function(A){switch(A.label){case 0:return GI.receiveContext(a,o,C),[4,GI.detectContextSessionType()];case 1:return A.sent(),game.context.detectContextGameMode(),[2]}})});return function(o,C,A){return a.apply(this,arguments)}}(),a}return a(c,[{key:"onLoad",value:function(){this.playerId=GP.getPlayerId()}},{key:"chooseFriends",value:(E=B(function(a,o){var C;return _ts_generator(this,function(a){switch(a.label){case 0:return C=JSON.parse(o),t_.showLoadingScreen(0),[4,G_.context.choose.processAsync(I(I({},C),{},{playerId:this.playerId}))];case 1:return a.sent(),[2]}})}),function(a,o){return E.apply(this,arguments)})},{key:"processContextData",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return t_.showLoadingScreen(0),[4,GI.processContextData()];case 1:return a.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"setSingleContext",value:function(){this.changeContext("","SOLO",{})}},{key:"setTournamentContext",value:function(){this.changeUrl("/?context_source_id=123&context_type=GENERIC&tournament=true"),this.changeContext("mocked-context-id-tournament","THREAD",{})}},{key:"setShareInviteContext",value:function(){var a={type:GI.getSessionContextTypes().SHARE_INVITE,playerId:"4766619483409000",playerName:"Player",playerPhoto:""};this.changeContext("mocked-context-id-share-invite","THREAD",a)}},{key:"setMatchingGroupContext",value:function(){var a={type:GI.getSessionContextTypes().MATCHING_GROUP,playerId:"4766619483409000",playerName:"Player",playerPhoto:"",playerScore:100};this.changeContext("mocked-context-id-matching-group","GROUP",a)}},{key:"setChallengeFriendContext",value:function(){var a={type:GI.getSessionContextTypes().CHALLENGE_FRIEND,playerId:"4766619483409000",playerName:"Player",playerPhoto:""};this.changeContext("mocked-context-id-challenge-friend","THREAD",a)}},{key:"changeUrl",value:function(a){window.history.pushState({},"",a)}}]),c}(eo)).prototype,"chooseFriends",[Gs],Object.getOwnPropertyDescriptor(Gu.prototype,"chooseFriends"),Gu.prototype),L(Gu.prototype,"processContextData",[Gl],Object.getOwnPropertyDescriptor(Gu.prototype,"processContextData"),Gu.prototype),Gu)),U._RF.pop(),U._RF.push({},"36562c8k/RF2p/1aLUWFaf8","FlowGroup",void 0);var GB,GR,GE,GL,GO=$.ccclass,GN=GameCore.Utils.Decorator,GF=globalThis.game,GD=GF.match,GM=GF.player,jJ=function(a){t_.closeLoadingScreen(),_instanceof(a,Error)&&t_.showNotificationScreen(a.message)};Gg=GO("FlowGroup"),Gb=GN.tryCatch(jJ),Gk=GN.tryCatch(jJ),Gw=GN.tryCatch(jJ),Gg((L((GS=function(P){C(h,P);var R,E,L,O=A(h);function h(){var a;o(this,h);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=O.call.apply(O,[this].concat(A))).playerId="",a}return a(h,[{key:"onLoad",value:function(){this.playerId=GM.getPlayerId()}},{key:"startGroup",value:(L=B(function(a,o){var C;return _ts_generator(this,function(a){switch(a.label){case 0:return C=JSON.parse(o),t_.showLoadingScreen(0),[4,GD.group.start.processAsync(I(I({},C),{},{matchTag:"test",playerId:this.playerId}))];case 1:return a.sent(),[2]}})}),function(a,o){return L.apply(this,arguments)})},{key:"joinGroup",value:(E=B(function(a,o){var C;return _ts_generator(this,function(a){switch(a.label){case 0:return C=JSON.parse(o),t_.showLoadingScreen(0),[4,GD.group.join.processAsync(I(I({},C),{},{playerId:this.playerId}))];case 1:return a.sent(),[2]}})}),function(a,o){return E.apply(this,arguments)})},{key:"finishGroup",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return t_.showLoadingScreen(0),GM.setPlayerDataByName("score",Math.floor(2*Math.random())),[4,GD.group.finish.processAsync()];case 1:return a.sent(),[2]}})}),function(){return R.apply(this,arguments)})}]),h}(eo)).prototype,"startGroup",[Gb],Object.getOwnPropertyDescriptor(GS.prototype,"startGroup"),GS.prototype),L(GS.prototype,"joinGroup",[Gk],Object.getOwnPropertyDescriptor(GS.prototype,"joinGroup"),GS.prototype),L(GS.prototype,"finishGroup",[Gw],Object.getOwnPropertyDescriptor(GS.prototype,"finishGroup"),GS.prototype),GS)),U._RF.pop(),U._RF.push({},"46e6dOzDGJMa48+tVKTAEIT","FlowSingle",void 0);var Gx,Gz,GG,Gq,GU=$.ccclass,GH=GameCore.Utils,GW=GH.Decorator,GV=GH.Number,GK=globalThis.game,GY=GK.match,Gj=GK.player,lZ=function(a){t_.closeLoadingScreen(),_instanceof(a,Error)&&t_.showNotificationScreen(a.message)};GB=GU("FlowSingle"),GR=GW.tryCatch(lZ),GE=GW.tryCatch(lZ),GB((L((GL=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=E.call.apply(E,[this].concat(A))).playerId="",a}return a(u,[{key:"onLoad",value:function(){this.playerId=Gj.getPlayerId()}},{key:"startSingle",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return t_.showLoadingScreen(0),[4,GY.single.start.processAsync({playerId:this.playerId})];case 1:return a.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"finishSingle",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return Gj.setPlayerDataByName("score",GV.random(1e3)),[4,GY.single.finish.processAsync()];case 1:return a.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eo)).prototype,"startSingle",[GR],Object.getOwnPropertyDescriptor(GL.prototype,"startSingle"),GL.prototype),L(GL.prototype,"finishSingle",[GE],Object.getOwnPropertyDescriptor(GL.prototype,"finishSingle"),GL.prototype),GL)),U._RF.pop(),U._RF.push({},"e2458xYf5xBG6uFEvkD4R6s","FlowStratery",void 0);var GX,GJ,GZ,GQ,G$,G0,G1,G2,G3,G4,G5=$.ccclass,G6=GameCore,G7=G6.Utils,G8=G7.Decorator,G9=G7.String,qe=G7.Number,qt=G6.Dtos.Match.CustomData,qn=globalThis.game,qi=qn.match,qr=qn.player,RZ=function(a){t_.closeLoadingScreen(),_instanceof(a,Error)&&t_.showNotificationScreen(a.message)};Gx=G5("FlowStrategy"),Gz=G8.tryCatch(RZ),GG=G8.tryCatch(RZ),Gx((L((Gq=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=E.call.apply(E,[this].concat(A))).playerId="",a}return a(u,[{key:"onLoad",value:function(){this.playerId=qr.getPlayerId(),this.initDtosDefaultData()}},{key:"initDtosDefaultData",value:function(){qt.addDefaultData({maxTime:0}),qt.addValidateFunction("maxTime",function(a){if(a<0)throw new Error("maxTime must be greater than 0")})}},{key:"startStrategy",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return t_.showLoadingScreen(0),[4,qi.strategy.start.processAsync({matchId:G9.generateObjectId(),gameMode:"endless",playerId:this.playerId})];case 1:return a.sent(),[4,qi.handler.setMatchCustomData({maxTime:600})];case 2:return a.sent(),[4,qi.handler.setProfileData({id:this.playerId,wish:0})];case 3:return a.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"finishStrategy",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,qi.handler.setProfileData({id:this.playerId,wish:qe.random(9999)})];case 1:return a.sent(),[4,qi.strategy.finish.processAsync({setPlayerBestScore:!1,postGlobalLeaderboard:!1})];case 2:return a.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eo)).prototype,"startStrategy",[Gz],Object.getOwnPropertyDescriptor(Gq.prototype,"startStrategy"),Gq.prototype),L(Gq.prototype,"finishStrategy",[GG],Object.getOwnPropertyDescriptor(Gq.prototype,"finishStrategy"),Gq.prototype),Gq)),U._RF.pop(),U._RF.push({},"943b1Zkv9BAaZVhinus8Bkv","FlowTournament",void 0);var qa=$.ccclass,qo=GameCore.Utils.Decorator,qs=globalThis.game,ql=qs.match,qu=qs.player,DZ=function(a){t_.closeLoadingScreen(),_instanceof(a,Error)&&t_.showNotificationScreen(a.message)};GX=qa("FlowTournament"),GJ=qo.tryCatch(DZ),GZ=qo.tryCatch(DZ),GQ=qo.tryCatch(DZ),G$=qo.tryCatch(DZ),G0=qo.tryCatch(DZ),G1=qo.tryCatch(DZ),G2=qo.tryCatch(DZ),G3=qo.tryCatch(DZ),GX((L((G4=function(P){C(f,P);var I,R,E,L,O,N,F,D,M=A(f);function f(){var a;o(this,f);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=M.call.apply(M,[this].concat(A))).playerId="",a}return a(f,[{key:"onLoad",value:function(){this.playerId=qu.getPlayerId()}},{key:"joinTournament",value:(D=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return t_.showLoadingScreen(0),[4,GameSDK.getTournamentAsync()];case 1:return a=o.sent().getID().toString(),[4,ql.tournament.join.processAsync({tournamentId:a,playerId:this.playerId})];case 2:return o.sent(),[2]}})}),function(){return D.apply(this,arguments)})},{key:"continueTournament",value:(F=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return t_.showLoadingScreen(0),[4,GameSDK.getTournamentAsync()];case 1:return a=o.sent().getContextID(),[4,ql.tournament.continue.processAsync({contextId:a,playerId:this.playerId})];case 2:return o.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"finishTournament",value:(N=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return t_.showLoadingScreen(0),qu.setPlayerDataByName("score",Math.floor(2*Math.random())),[4,ql.single.finish.processAsync()];case 1:return a.sent(),[2]}})}),function(){return N.apply(this,arguments)})},{key:"createTournament",value:(O=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return t_.showLoadingScreen(0),a=GameCore.Utils.String.generateObjectId(),[4,GameSDK.tournament.createAsync({initialScore:0,config:{title:"Tournament title",tournamentTitle:"Tournament title"},data:{playerId:this.playerId,playerName:"playerName",leaderboardId:a}})];case 1:return o.sent(),[2]}})}),function(){return O.apply(this,arguments)})},{key:"postScoreTournament",value:(L=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=Number(a.string),t_.showLoadingScreen(0),[4,GameSDK.tournament.postScoreAsync(o)];case 1:return C.sent(),[2]}})}),function(a){return L.apply(this,arguments)})},{key:"shareTournament",value:(E=B(function(a,o){var C;return _ts_generator(this,function(a){switch(a.label){case 0:return C=JSON.parse(o),t_.showLoadingScreen(0),[4,GameSDK.tournament.shareAsync(C)];case 1:return a.sent(),[2]}})}),function(a,o){return E.apply(this,arguments)})},{key:"getTournamentsAsync",value:(R=B(function(){return _ts_generator(this,function(a){return t_.showLoadingScreen(0),GameSDK.tournament.getTournamentsAsync(),[2]})}),function(){return R.apply(this,arguments)})},{key:"getTournamentAsync",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return t_.showLoadingScreen(0),[4,GameSDK.getTournamentAsync()];case 1:return a.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),f}(eo)).prototype,"joinTournament",[GJ],Object.getOwnPropertyDescriptor(G4.prototype,"joinTournament"),G4.prototype),L(G4.prototype,"continueTournament",[GZ],Object.getOwnPropertyDescriptor(G4.prototype,"continueTournament"),G4.prototype),L(G4.prototype,"finishTournament",[GQ],Object.getOwnPropertyDescriptor(G4.prototype,"finishTournament"),G4.prototype),L(G4.prototype,"createTournament",[G$],Object.getOwnPropertyDescriptor(G4.prototype,"createTournament"),G4.prototype),L(G4.prototype,"postScoreTournament",[G0],Object.getOwnPropertyDescriptor(G4.prototype,"postScoreTournament"),G4.prototype),L(G4.prototype,"shareTournament",[G1],Object.getOwnPropertyDescriptor(G4.prototype,"shareTournament"),G4.prototype),L(G4.prototype,"getTournamentsAsync",[G2],Object.getOwnPropertyDescriptor(G4.prototype,"getTournamentsAsync"),G4.prototype),L(G4.prototype,"getTournamentAsync",[G3],Object.getOwnPropertyDescriptor(G4.prototype,"getTournamentAsync"),G4.prototype),G4)),U._RF.pop(),U._RF.push({},"d78a7DHN+5P/YjKftUFEZcU","JavaAds",void 0),(0,$.ccclass)("JavaAds")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"__preload",value:function(){this.setupAds()}},{key:"setupAds",value:function(){}},{key:"onLoad",value:function(){}},{key:"start",value:function(){}}]),r}(eo)),U._RF.pop(),U._RF.push({},"e8e10DJmXdH8Jw30JCMjJqd","ScreensFlows",void 0),(0,$.ccclass)("ScreensFlows")(function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=E.call.apply(E,[this].concat(A))).screenActions=[function(){return a.showLoadingScreen()},function(){return a.showNotificationScreen()},function(){return a.showWinningScreen()},function(){return a.showCongratulationScreen()},function(){return a.showLoseScreen()},function(){return a.showSettingsScreen()}],a}return a(u,[{key:"preloadScreens",value:function(){t_.preloadScreens()}},{key:"getRandomDelay",value:function(a,o){var C=arguments.length>0&&void 0!==a?a:100,A=arguments.length>1&&void 0!==o?o:1e3;return Math.floor(Math.random()*(A-C+1))+C}},{key:"executeRandomScreenAction",value:(R=B(function(){var a,o;return _ts_generator(this,function(C){return a=Math.floor(Math.random()*this.screenActions.length),(o=this.screenActions[a])&&o(),[2]})}),function(){return R.apply(this,arguments)})},{key:"spamScreens",value:(I=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:a=this,o=function(){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=a.getRandomDelay(200,800),[4,new Promise(function(a){return setTimeout(a,o)})];case 1:return C.sent(),[4,a.executeRandomScreenAction()];case 2:return C.sent(),[2]}})},C=0,A.label=1;case 1:if(!(C<10))return[3,4];return[5,_ts_values(o())];case 2:A.sent(),A.label=3;case 3:return C++,[3,1];case 4:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"showNotificationScreen",value:function(){t_.showNotificationScreen("Hey!")}},{key:"closeNotificationScreen",value:function(){t_.closeNotificationScreen()}},{key:"showLoadingScreen",value:function(){t_.showLoadingScreen(5)}},{key:"closeLoadingScreen",value:function(){t_.closeLoadingScreen()}},{key:"showWinningScreen",value:function(){}},{key:"closeWinningScreen",value:function(){}},{key:"showLoseScreen",value:function(){}},{key:"closeLoseScreen",value:function(){}},{key:"showSettingsScreen",value:function(){t_.openScreen(tP.SETTINGS_SCREEN)}},{key:"closeSettingsScreen",value:function(){t_.closeScreen(tP.SETTINGS_SCREEN)}},{key:"showCongratulationScreen",value:function(){}},{key:"closeCongratulationScreen",value:function(){}}]),u}(eo)),U._RF.pop(),U._RF.push({},"abf91gNohBK7arKnziqu2PF","AnimationDemo2",void 0),(0,$.ccclass)("AnimationDemo2")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"onLoad",value:function(){}},{key:"switchToTestScene",value:function(){ns.switchScene("TestScene")}}]),r}(eo)),U._RF.pop(),U._RF.push({},"56b92F9LoxNs5aCgvw+tkq6","LoadingSceneTransition",void 0);var qc,qh,qp,qd,qf,qy,qv,qm,qg,qb,qk,qw,qS,qT,qC,qA,q_,qP,qI,qB,qR,qE,qL,qO,qN,qF,qD,qM,qx,qz,qG,qq,qU,qH,qW,qV,qK,qY,qj,qX,qJ,qZ,qQ,q$=$.ccclass,q0=$.requireComponent,q1=$.property;qc=q$("LoadingSceneTransition"),qh=q0([e9]),qp=q1([ee]),qc(qd=qh((qy=L((qf=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"targets",qy,N(a)),a.realTargets=[],a}return a(r,[{key:"start",value:function(){for(var a=this,o=0;o<this.targets.length;o++){var C=this.targets[o];if(C){var A=ej(C);A.setParent(this.node),A.active=!1,this.realTargets.push(A)}}eh.addPersistRootNode(this.node),eh.once(eA.EVENT_BEFORE_SCENE_LAUNCH,function(){a.playFadeOutAnimationClip()})}},{key:"playFadeOutAnimationClip",value:function(){var a=this,o=0;if(this.realTargets&&0!==this.realTargets.length){var C,A=E(this.realTargets);try{for(A.s();!(C=A.n()).done;){var P=C.value;P.active=!0;var I=P.getComponent(es);if(I)I.clips.some(function(a){return"FadeOut"===(null==a?void 0:a.name)})?(I.play("FadeOut"),I.once(es.EventType.FINISHED,function(){++o===a.realTargets.length&&a.node.destroy()})):this.node.destroy()}}catch(a){A.e(a)}finally{A.f()}}}}]),r}(eo)).prototype,"targets",[qp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qd=qf))||qd),U._RF.pop(),U._RF.push({},"1ad570+5dtKarOz4tDw3VQK","ContainerBattle",void 0);var q2,q3,q4,q5,q6,q7,q8,q9,Ue,Ut=$.ccclass,Un=$.property,Ui=(qv=Ut("ContainerBattle"),qm=Un(ee),qg=tj.required,qb=Un(ee),qk=tj.required,qw=Un(W),qS=tj.required,qT=Un(W),qC=tj.required,qA=Un(er),q_=tj.required,qP=Un(er),qI=tj.required,qB=Un(W),qR=tj.required,qE=Un(W),qL=tj.required,qO=Un(et),qN=tj.required,qF=tj.required,qD=tj.required,qM=tj.required,qx=tj.required,qv((qG=L((qz=function(P){C(g,P);var I,R,E,L,F,D,M,x,z,q=A(g);function g(){var a;o(this,g);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=q.call.apply(q,[this].concat(A)),O(a,"opponentBlock",qG,N(a)),O(a,"yourBlock",qq,N(a)),O(a,"opponentSprite",qU,N(a)),O(a,"yourSprite",qH,N(a)),O(a,"yourName",qW,N(a)),O(a,"opponentName",qV,N(a)),O(a,"maskSprite",qK,N(a)),O(a,"vsIcon",qY,N(a)),O(a,"defaultAvatar",qj,N(a)),O(a,"opponentFadeAnim",qX,N(a)),O(a,"yourFadeAnim",qJ,N(a)),O(a,"opponentAvatarTransform",qZ,N(a)),O(a,"yourAvatarTransform",qQ,N(a)),a.originalOpponentBlockPos=null,a.originalYourBlockPos=null,a}return a(g,[{key:"__preload",value:function(){this.initComponents(),this.initData(),this.preparePlayAnim()}},{key:"initComponents",value:function(){this.opponentFadeAnim=this.opponentBlock.getComponent(n7),this.yourFadeAnim=this.yourBlock.getComponent(n7),this.yourAvatarTransform=this.yourSprite.getComponent(en),this.opponentAvatarTransform=this.opponentSprite.getComponent(en),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,g)}},{key:"initData",value:function(){this.originalOpponentBlockPos||(this.originalOpponentBlockPos=this.opponentBlock.position.clone()),this.originalYourBlockPos||(this.originalYourBlockPos=this.yourBlock.position.clone())}},{key:"startBattle",value:(z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.setDataStatus(),this.preparePlayAnim(),[4,this.playAnim()];case 1:return a.sent(),[2]}})}),function(){return z.apply(this,arguments)})},{key:"setDataStatus",value:function(){var a=this,o=tb.getResultStatus();if(o){var C=o.playerName,A=o.playerPhoto,P=o.opponentName,I=o.opponentPhoto;this.yourName.string=C,this.opponentName.string=P,""===A?this.setYourAvatar(this.defaultAvatar):D4.loadProfilePhotoAsync(A).then(function(o){a.setYourAvatar(null!=o?o:a.defaultAvatar)}),""===I?this.setOpponentAvatar(this.defaultAvatar):D4.loadProfilePhotoAsync(I).then(function(o){a.setOpponentAvatar(null!=o?o:a.defaultAvatar)})}}},{key:"setYourAvatar",value:function(a){this.yourSprite.spriteFrame=a,this.yourAvatarTransform.setContentSize(136,135)}},{key:"setOpponentAvatar",value:function(a){this.opponentSprite.spriteFrame=a,this.opponentAvatarTransform.setContentSize(136,135)}},{key:"preparePlayAnim",value:function(){if(this.originalOpponentBlockPos&&this.originalYourBlockPos){var a=this.originalYourBlockPos,o=a.x,C=a.y,A=a.z,P=this.originalOpponentBlockPos,I=P.x,B=P.y,R=P.z,E=this.maskSprite.color,L=E.r,O=E.g,N=E.b;this.yourBlock.setPosition(o,C,A),this.opponentBlock.setPosition(I,B,R),this.vsIcon.node.scale=ei.ZERO,this.maskSprite.color=new K(L,O,N,0),this.yourFadeAnim.prepareFadeIn(0),this.opponentFadeAnim.prepareFadeIn(0)}}},{key:"playAnim",value:(x=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.playFadeInOutMaskAnim(),this.playMoveBlocksAnim(),this.playVSIconAnim()])];case 1:return a.sent(),[2]}})}),function(){return x.apply(this,arguments)})},{key:"playMoveBlocksAnim",value:(M=B(function(){var a,o,C,A,P,I,B,R,E,L,O,N,F,D,M,x,z;return _ts_generator(this,function(q){switch(q.label){case 0:if(!(this.originalOpponentBlockPos&&this.originalYourBlockPos))return[3,5];return o=(a=this.originalYourBlockPos).x,C=a.y,A=a.z,I=(P=this.originalOpponentBlockPos).x,B=P.y,R=P.z,L=I+(E=[450,100,700])[0],O=o-E[0],N=Y(this.opponentBlock).to(.1667,{position:new ei(L,B,R)}),L+=E[1],F=Y(this.opponentBlock).to(.5,{position:new ei(L,B,R)}),L+=E[2],D=Y(this.opponentBlock).to(.3,{position:new ei(L,B,R)}),M=Y(this.yourBlock).to(.1667,{position:new ei(O,C,A)}),O-=E[1],x=Y(this.yourBlock).to(.5,{position:new ei(O,C,A)}),O-=E[2],z=Y(this.yourBlock).to(.3,{position:new ei(O,C,A)}),[4,ts.waitTweenAsync(.2)];case 1:return q.sent(),[4,Promise.all([this.playFadeInBlocksAnim(),ts.runTweenAsync(N),ts.runTweenAsync(M)])];case 2:return q.sent(),[4,Promise.all([ts.runTweenAsync(x),ts.runTweenAsync(F)])];case 3:return q.sent(),[4,Promise.all([this.playFadeOutBlocksAnim(),ts.runTweenAsync(D),ts.runTweenAsync(z)])];case 4:q.sent(),q.label=5;case 5:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"playFadeInBlocksAnim",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.yourFadeAnim.fadeInAsync({from:0,to:255,duration:.2}),this.opponentFadeAnim.fadeInAsync({from:0,to:255,duration:.2})])];case 1:return a.sent(),[2]}})}),function(){return D.apply(this,arguments)})},{key:"playFadeOutBlocksAnim",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.yourFadeAnim.fadeOutAsync({from:255,to:0,duration:.45}),this.opponentFadeAnim.fadeOutAsync({from:255,to:0,duration:.45})])];case 1:return a.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"playFadeInOutMaskAnim",value:(L=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return o=(a=this.maskSprite.color).r,C=a.g,A=a.b,P=Y(this.maskSprite).to(.9,{color:new K(o,C,A,200)}),I=Y(this.maskSprite).to(.1,{color:new K(o,C,A,0)}),[4,ts.runTweenAsync(P)];case 1:return B.sent(),[4,ts.runTweenAsync(I)];case 2:return B.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"playVSIconAnim",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.playScaleVSIconAnim(),this.playFadeInOutVSIconAnim()])];case 1:return a.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"playScaleVSIconAnim",value:(R=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return a=Y(this.vsIcon.node).delay(.2).to(.2,{scale:new ei(1.2,1.2,1)},{easing:tt(.08,.389,.156,1.2)}),o=Y(this.vsIcon.node).delay(.4).to(.2,{scale:new ei(.93,.93,1)},{easing:tt(.267,1.2,.333,.93)}),C=Y(this.vsIcon.node).delay(1).to(.066,{scale:new ei(.86,.86,1)}),A=Y(this.vsIcon.node).delay(1.0667).to(.167,{scale:new ei(1.711,1.711,1)},{easing:tt(.922,.86,1.016,1.603)}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o),ts.runTweenAsync(C),ts.runTweenAsync(A)])];case 1:return P.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"playFadeInOutVSIconAnim",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=Y(this.vsIcon).delay(.2).to(.3,{color:new K(255,255,255,255)},{easing:tt(.111,1,.156,1)}),o=Y(this.vsIcon).delay(1.0667).to(.2,{color:new K(255,255,255,0)},{easing:tt(.922,1,.978,1)}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:return C.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),g}(eo)).prototype,"opponentBlock",[qm,qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qq=L(qz.prototype,"yourBlock",[qb,qk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qU=L(qz.prototype,"opponentSprite",[qw,qS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qH=L(qz.prototype,"yourSprite",[qT,qC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qW=L(qz.prototype,"yourName",[qA,q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qV=L(qz.prototype,"opponentName",[qP,qI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qK=L(qz.prototype,"maskSprite",[qB,qR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qY=L(qz.prototype,"vsIcon",[qE,qL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qj=L(qz.prototype,"defaultAvatar",[qO,qN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qX=L(qz.prototype,"opponentFadeAnim",[qF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qJ=L(qz.prototype,"yourFadeAnim",[qD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qZ=L(qz.prototype,"opponentAvatarTransform",[qM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qQ=L(qz.prototype,"yourAvatarTransform",[qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz))||qz);U._RF.pop(),U._RF.push({},"fa5c1fJQX9DmroGlOpehs03","BattleScreen",void 0);var Ur,Ua,Uo,Us,Ul,Uu,Uc,Uh,Up,Ud,Uf,Uy,Uv,Um,Ug,Ub,Uk,Uw,US,UT,UC,UA,U_,UP,UI,UB,UR,UE,UL,UO,UN,UF,UD,UM,Ux,Uz,UG,Uq,UU,UH,UW,UV,UK,UY=$.ccclass,Uj=$.disallowMultiple,UX=$.requireComponent,UJ=$.property,UZ=GameCore.Events,UQ=globalThis.game.event;q2=UY("BattleScreen"),q3=UX(Bi),q4=UJ(Ui),q5=tj.required,q6=tj.required,q2(q7=Uj(q7=q3((q9=L((q8=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"container",q9,N(a)),O(a,"screen",Ue,N(a)),a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("BattleScreen: screen not found");a.validateEventPayload(o)},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(s,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,s)}},{key:"listenScreenEvents",value:function(){UQ.on(UZ.OPENING_SCREEN,this.handleOpeningScreen),UQ.on(UZ.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){UQ.off(UZ.OPENING_SCREEN,this.handleOpeningScreen),UQ.off(UZ.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"open",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.enabled)return[3,2];return[4,this.container.startBattle()];case 1:a.sent(),UQ.emit(UZ.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),UQ.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),t_.closeScreen(tP.BATTLE_SCREEN),a.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}}]),s}(eo)).prototype,"container",[q4,q5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ue=L(q8.prototype,"screen",[q6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q7=q8))||q7)||q7),U._RF.pop(),U._RF.push({},"e3e88Oh0WVGv5FAALaVKrEA","VersusContainer",void 0);var U$,U0,U1,U2,U3,U4,U5,U6,U7,U8,U9,He,Ht,Hn,Hi,Hr,Ha=$.ccclass,Ho=$.property,Hs=(Ur=Ha("VersusContainer"),Ua=Ho(ee),Uo=tj.required,Us=Ho(ee),Ul=tj.required,Uu=Ho(ee),Uc=tj.required,Uh=Ho(W),Up=tj.required,Ud=Ho(W),Uf=tj.required,Uy=Ho(er),Uv=tj.required,Um=Ho(er),Ug=tj.required,Ub=Ho(et),Uk=tj.required,Uw=Ho(et),US=tj.required,UT=tj.required,UC=tj.required,UA=tj.required,U_=tj.required,UP=tj.required,UI=tj.required,UB=tj.required,Ur((UE=L((UR=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"yourNode",UE,N(a)),O(a,"opponentNode",UL,N(a)),O(a,"vsNode",UO,N(a)),O(a,"yourPhoto",UN,N(a)),O(a,"opponentPhoto",UF,N(a)),O(a,"yourName",UD,N(a)),O(a,"opponentName",UM,N(a)),O(a,"defaultPhotoSpriteFrame",Ux,N(a)),O(a,"defaultOpponentPhotoSpriteFrame",Uz,N(a)),O(a,"yourPhotoUITransform",UG,N(a)),O(a,"opponentPhotoUITransform",Uq,N(a)),O(a,"opponentNameDefaultPosition",UU,N(a)),O(a,"originalYourNodePosition",UH,N(a)),O(a,"originalOpponentNodePosition",UW,N(a)),O(a,"yourFadeAnim",UV,N(a)),O(a,"opponentFadeAnim",UK,N(a)),a.tweenVsPulsate=void 0,a}return a(p,[{key:"getOpponentNode",value:function(){return this.opponentNode}},{key:"getYourNode",value:function(){return this.yourNode}},{key:"__preload",value:function(){this.originalYourNodePosition=this.yourNode.position.clone(),this.originalOpponentNodePosition=this.opponentNode.position.clone(),this.opponentNameDefaultPosition=this.opponentName.node.position.clone(),this.yourPhotoUITransform=this.yourPhoto.getComponent(en),this.opponentPhotoUITransform=this.opponentPhoto.getComponent(en),this.yourFadeAnim=this.yourNode.getComponent(n7),this.opponentFadeAnim=this.opponentNode.getComponent(n7),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this)}},{key:"setYourName",value:function(a){this.yourName.string=a}},{key:"setOpponentName",value:function(a){var o=this.opponentNameDefaultPosition,C=o.x,A=o.y,P=o.z;""===a?(this.opponentName.fontSize=97.8,this.opponentName.lineHeight=68.4,this.opponentName.string="...",this.opponentName.node.setPosition(C,A,P)):(this.opponentName.fontSize=68.4,this.opponentName.lineHeight=55.1,this.opponentName.string=a,this.opponentName.node.setPosition(C,-160.499,P))}},{key:"setYourPhotoSpriteFrame",value:function(a){this.yourPhoto.spriteFrame=null===a?this.defaultPhotoSpriteFrame:a,this.yourPhotoUITransform.setContentSize(215,215)}},{key:"setOpponentPhotoSpriteFrame",value:function(a){this.opponentPhoto.spriteFrame=null===a?this.defaultOpponentPhotoSpriteFrame:a,this.opponentPhotoUITransform.setContentSize(215,215)}},{key:"prepareAnim",value:function(){var a=this.originalYourNodePosition,o=a.x,C=a.y,A=a.z,P=this.originalOpponentNodePosition,I=P.x,B=P.y,R=P.z;this.yourNode.setPosition(o-400,C,A),this.opponentNode.setPosition(I+400,B,R),this.yourFadeAnim.prepareFadeIn(255),this.opponentFadeAnim.prepareFadeIn(255)}},{key:"prepareVsAnim",value:function(){this.tweenVsPulsate.stop(),this.vsNode.setScale(new ei(0,0,0))}},{key:"playFadeInAnims",value:(E=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=Y(this.yourNode).to(.2,{position:this.originalYourNodePosition},{easing:"backOut"}),o=Y(this.opponentNode).to(.2,{position:this.originalOpponentNodePosition},{easing:"backOut"}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:return C.sent(),this.runVsPulsateAnimation(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"playFadeOutAnims",value:(R=B(function(){var a,o,C,A,P,I,B,R,E,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:return o=(a=this.originalYourNodePosition).x,C=a.y,A=a.z,I=(P=this.originalOpponentNodePosition).x,B=P.y,R=P.z,E=Y(this.yourNode).to(.2,{position:new ei(o-400,C,A)},{easing:"backIn"}),L=Y(this.opponentNode).to(.2,{position:new ei(I+400,B,R)},{easing:"backIn"}),O=this.yourFadeAnim.fadeOutAsync({from:255,to:0,duration:.4}),N=this.opponentFadeAnim.fadeOutAsync({from:255,to:0,duration:.4}),[4,Promise.all([ts.runTweenAsync(E),ts.runTweenAsync(L)])];case 1:return F.sent(),[4,Promise.all([O,N])];case 2:return F.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"playVsAnim",value:(I=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return this.vsNode.setScale(new ei(3,3,3)),a=Y(this.vsNode).to(.2,{scale:new ei(.95,.95,.95)},{easing:"quartOut"}),o=Y(this.vsNode).to(.1,{scale:new ei(1,1,1)},{easing:"quartIn"}),C=Y(this.vsNode).sequence(a,o),[4,ts.runTweenAsync(C)];case 1:return A.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"runVsPulsateAnimation",value:function(){this.tweenVsPulsate&&this.tweenVsPulsate.stop();var a=new ei(1,1,1);a.x=105.2*a.x/95.11,a.y=105.2*a.y/95.11,a.z=105.2*a.z/95.11,this.tweenVsPulsate=Y(this.vsNode).to(.834,{scale:new ei(a.x,a.y,a.z)},{easing:tn}).to(.834,{scale:new ei(1,1,1)},{easing:tn}).union().repeatForever().start()}}]),p}(eo)).prototype,"yourNode",[Ua,Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UL=L(UR.prototype,"opponentNode",[Us,Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UO=L(UR.prototype,"vsNode",[Uu,Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UN=L(UR.prototype,"yourPhoto",[Uh,Up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UF=L(UR.prototype,"opponentPhoto",[Ud,Uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UD=L(UR.prototype,"yourName",[Uy,Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UM=L(UR.prototype,"opponentName",[Um,Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ux=L(UR.prototype,"defaultPhotoSpriteFrame",[Ub,Uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uz=L(UR.prototype,"defaultOpponentPhotoSpriteFrame",[Uw,US],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UG=L(UR.prototype,"yourPhotoUITransform",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uq=L(UR.prototype,"opponentPhotoUITransform",[UC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UU=L(UR.prototype,"opponentNameDefaultPosition",[UA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UH=L(UR.prototype,"originalYourNodePosition",[U_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UW=L(UR.prototype,"originalOpponentNodePosition",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UV=L(UR.prototype,"yourFadeAnim",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UK=L(UR.prototype,"opponentFadeAnim",[UB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UR))||UR);U._RF.pop(),U._RF.push({},"f0062s+P2tJ6r4NXUkdNyHE","ContainerChallengeFriend",void 0);var Hl,Hu,Hc,Hh,Hp,Hd,Hf,Hy,Hv,Hm,Hg,Hb,Hk=$.ccclass,Hw=$.property,HS=GameCore.Configs.Mockup,HT=(U$=Hk("ContainerChallengeFriend"),U0=Hw(Hs),U1=tj.required,U2=Hw(ef),U3=tj.required,U4=Hw(ef),U5=tj.required,U6=Hw(ee),U7=tj.required,U8=tj.required,U$((He=L((U9=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"versusContainer",He,N(a)),O(a,"findOpponentButton",Ht,N(a)),O(a,"backButton",Hn,N(a)),O(a,"footer",Hi,N(a)),O(a,"containerUIOpacity",Hr,N(a)),a}return a(p,[{key:"onClickOpponentButton",set:function(a){this.findOpponentButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickBackButton",set:function(a){this.backButton.node.on(ef.EventType.CLICK,a)}},{key:"__preload",value:function(){this.containerUIOpacity=this.getComponent(ea),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,p)}},{key:"prepareContainer",value:function(){this.containerUIOpacity.opacity=0,this.versusContainer.setOpponentName(""),this.versusContainer.prepareAnim(),this.toggleFooterButtons(!0)}},{key:"toggleVersusContainer",value:function(a){this.versusContainer.node.active=a}},{key:"updatePlayersInfo",value:function(){var a=tb.getResultStatus();if(HS.Match.Enabled&&(a={playerName:HS.Match.PlayerInfo.Name,opponentName:HS.Match.OpponentInfo.Name,opponentPhoto:HS.Match.OpponentInfo.Photo,opponentScore:0,playerScore:0,status:"waiting",playerPhoto:HS.Match.PlayerInfo.Photo}),a){var o=a,C=o.playerName,A=o.opponentName,P=o.opponentPhoto;this.versusContainer.setYourName(C),this.versusContainer.setOpponentName(A),this.setOpponentAvatar(P)}}},{key:"clearOpponentInfo",value:function(){this.versusContainer.setOpponentName(""),this.versusContainer.setOpponentPhotoSpriteFrame(null)}},{key:"setYourAvatar",value:function(a){var o=this;this.versusContainer.setYourPhotoSpriteFrame(null),D4.loadProfilePhotoAsync(a).then(function(a){o.versusContainer.setYourPhotoSpriteFrame(a)})}},{key:"setOpponentAvatar",value:function(a){var o=this;this.versusContainer.setOpponentPhotoSpriteFrame(null),D4.loadProfilePhotoAsync(a).then(function(a){o.versusContainer.setOpponentPhotoSpriteFrame(a)})}},{key:"toggleFooterButtons",value:function(a){this.findOpponentButton.node.active=a,this.backButton.node.active=a}},{key:"playFadeInAnim",value:(E=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.containerUIOpacity).to(.2,{opacity:255}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[4,this.versusContainer.playFadeInAnims()];case 2:return o.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"playFadeOutAnim",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.containerUIOpacity).to(.2,{opacity:0}),[4,this.versusContainer.playFadeOutAnims()];case 1:return o.sent(),[4,ts.runTweenAsync(a)];case 2:return o.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"prepareOpponentFoundAnim",value:function(){this.versusContainer.prepareVsAnim()}},{key:"playOpponentFoundAnim",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.versusContainer.playVsAnim()];case 1:return a.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),p}(eo)).prototype,"versusContainer",[U0,U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=L(U9.prototype,"findOpponentButton",[U2,U3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hn=L(U9.prototype,"backButton",[U4,U5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hi=L(U9.prototype,"footer",[U6,U7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hr=L(U9.prototype,"containerUIOpacity",[U8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U9))||U9);U._RF.pop(),U._RF.push({},"6d398FNiFBH267e1K1m1IFK","ChallengeFriendsScreen",void 0);var HC,HA,H_,HP,HI,HB,HR,HE,HL,HO,HN,HF=$.ccclass,HD=$.property,HM=$.disallowMultiple,Hx=$.requireComponent,Hz=GameCore.Events,HG=globalThis.game,Hq=HG.event,HU=(HG.player,GameCore.Configs.Mockup);Hl=HF("ChallengeFriendsScreen"),Hu=Hx(Bi),Hc=HD(HT),Hh=tj.required,Hp=HD(ea),Hd=tj.required,Hf=tj.required,Hl(Hy=HM(Hy=Hu((Hm=L((Hv=function(P){C(v,P);var I,R,E,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"container",Hm,N(a)),O(a,"maskBGOpacity",Hg,N(a)),O(a,"screen",Hb,N(a)),a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("ChallengeFriendsScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},a.prepareOpen(o))},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(v,[{key:"screenData",get:function(){return this.screen.data}},{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,v)}},{key:"onLoad",value:function(){this.registryEvents(),this.updateContainerWidget()}},{key:"registryEvents",value:function(){var a=this;this.container.onClickOpponentButton=function(){a.handleFindOpponentButtonClick()},this.container.onClickBackButton=function(){a.handleBackButtonClick()}}},{key:"updateContainerWidget",value:function(){try{var a=tf.getBannerAdWorldHeight();if(a<=0)return;var o=this.container.getComponent(eX);if(!o)return;o.bottom+=a,o.updateAlignment()}catch(a){return}}},{key:"listenScreenEvents",value:function(){Hq.on(Hz.OPENING_SCREEN,this.handleOpeningScreen),Hq.on(Hz.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Hq.off(Hz.OPENING_SCREEN,this.handleOpeningScreen),Hq.off(Hz.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"prepareOpen",value:function(a){this.container.prepareContainer(),this.container.toggleVersusContainer(!0);var o=a.screenData.playerPhoto;this.container.setYourAvatar(o)}},{key:"open",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.enabled)return[3,2];return[4,Promise.all([this.fadeMaskBgAsync(204,.3),this.container.playFadeInAnim()])];case 1:a.sent(),Hq.emit(Hz.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),Hq.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),a.label=2;case 2:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"close",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.container.playFadeOutAnim()])];case 1:return a.sent(),[4,this.fadeMaskBgAsync(0,.3)];case 2:return a.sent(),this.container.clearOpponentInfo(),this.node.active=!1,Hq.emit(Hz.CLOSED_SCREEN,{screenName:this.node.name}),Hq.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return D.apply(this,arguments)})},{key:"fadeMaskBgAsync",value:function(a,o){var C=Y(this.maskBGOpacity).to(o,{opacity:a});return ts.runTweenAsync(C)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"handleChallengeAPIsAsync",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:a=game.player.getPlayerId(),o={level:window.levelCustom},C.label=1;case 1:if(C.trys.push([1,7,,8]),!HU.Match.Enabled)return[3,4];return[4,ts.waitTweenAsync(2)];case 2:return C.sent(),[4,tb.startMatchAsync("challenge-friend")];case 3:return C.sent(),[3,6];case 4:return[4,tb.processStartMatchWithoutLogMatchStart(function(){return game.match.context.choose.processAsync({playerId:a,extraData:o,fallbackSingleMode:!1})})];case 5:if(C.sent(),"tournament"===game.match.getMatchState().mode)return[2,"tournament-succeeded"];C.label=6;case 6:return game.match.handler.setMatchCustomData({level:window.levelCustom}),[3,8];case 7:return C.sent(),[2,"failed"];case 8:return[2,"pwf-succeeded"]}})}),function(){return F.apply(this,arguments)})},{key:"handleFindOpponentButtonClick",value:(L=B(function(){var a,o,C,A,P,I,R;return _ts_generator(this,function(E){switch(E.label){case 0:return a=this,td.gameScene.toggleBlockInputContainer(!0),td.gameScene.showLoadingScreen(0,t7.LOADING,!0),C=(o=td.gameScene).gamePlay,A=o.uiManager,P=this.screenData.playerLevel,I=C.gameUI.header,window.levelCustom=P,[4,this.handleChallengeAPIsAsync()];case 1:return R=E.sent(),[4,Promise.all([td.gameScene.background.loadBackgroundData(P),td.gameScene.loadScreenPrefabAsync(tP.BATTLE_SCREEN)])];case 2:if(E.sent(),td.gameScene.closeLoadingScreen(),"failed"===R)return[3,9];if("tournament-succeeded"!==R)return[3,4];return this.setMatchModeOnDev("tournament"),[4,this.handleJoinTournamentButtonClick()];case 3:return[2,(E.sent(),void td.gameScene.toggleBlockInputContainer(!1))];case 4:return this.setMatchModeOnDev("challenge-friend"),this.container.prepareOpponentFoundAnim(),this.container.updatePlayersInfo(),td.gameScene.toggleGamePlayScreen(!0),I.enableChallengeBlock(),[4,C.updateCustomLevel()];case 5:return E.sent(),[4,C.loadLevelResourcesAsync(P)];case 6:return E.sent(),I.updateChallengeBlockData(),[4,Promise.all([(function(){var o=B(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,a.container.playOpponentFoundAnim()];case 1:return o.sent(),[4,t_.closeScreenAsync(tP.CHALLENGE_FRIENDS_SCREEN)];case 2:return o.sent(),[4,A.tryToCloseDashboardScreen()];case 3:return o.sent(),[2]}})});return function(){return o.apply(this,arguments)}})()(),td.gameScene.rubyBarComp.runHideAnimationAsync()])];case 7:return E.sent(),td.gameScene.rubyBarComp.setWidgetRightType("challenge-friend"),[4,Promise.all([C.startPlayWithFriendAsync(),td.gameScene.rubyBarComp.runShowAnimationAsync()])];case 8:return E.sent(),A.setCurrentScreen(null),td.gameScene.toggleBlockInputContainer(!1),[3,10];case 9:td.gameScene.toggleBlockInputContainer(!1),E.label=10;case 10:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"setMatchModeOnDev",value:function(a){GameCore.Utils.Valid.isDebugger()&&(window.game.storage.storages.match.mode=a)}},{key:"handleJoinTournamentButtonClick",value:(E=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return o=(a=td.gameScene).gamePlay,C=a.uiManager,A=this.screenData.playerLevel,[4,td.gameScene.tournament.joinTournamentFromPWF()];case 1:if(!P.sent())return[3,5];return td.gameScene.toggleGamePlayScreen(!0),td.levelManager.setLevel(A),[4,t_.closeScreenAsync(tP.CHALLENGE_FRIENDS_SCREEN)];case 2:return P.sent(),[4,Promise.all([C.tryToCloseDashboardScreen(),o.loadLevelResourcesAsync(A)])];case 3:return P.sent(),[4,Promise.all([o.startTournamentGameAsync(),td.gameScene.rubyBarComp.runShowAnimationAsync()])];case 4:return P.sent(),[3,6];case 5:td.gameScene.showLoadingScreen(3,t7.FAILED_TO_JOIN_TOURNAMENT,!1),P.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleBackButtonClick",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(td.gameScene.toggleBlockInputContainer(!0),this.container.clearOpponentInfo(),"challenge-friend"!==window.game.match.getMatchState().mode)return[3,2];return td.gameScene.rubyBarComp.setWidgetRightType("default"),[4,tb.processStartMatchWithoutLogMatchStart(function(){return tb.startMatchAsync("single")})];case 1:a.sent(),td.gameScene.gamePlay.resetSingleMode(),a.label=2;case 2:return[4,Promise.all([t_.closeScreenAsync(tP.CHALLENGE_FRIENDS_SCREEN)])];case 3:return a.sent(),[4,Promise.all([td.gameScene.rubyBarComp.runShowAnimationAsync(),this.fadeInDashboard()])];case 4:return a.sent(),[4,td.gameScene.transition.processBackToDashboardFromPWFGamePlay()];case 5:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"fadeInDashboard",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.node.scene.once(t2.FADED_IN_DASHBOARD_DONE,o),td.gameScene.uiManager.handleScreenReturn()})]})}),function(){return I.apply(this,arguments)})}]),v}(eo)).prototype,"container",[Hc,Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hg=L(Hv.prototype,"maskBGOpacity",[Hp,Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hb=L(Hv.prototype,"screen",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hy=Hv))||Hy)||Hy),U._RF.pop(),U._RF.push({},"a9536b20v1IY6hl6nKyDRjz","GiftBlockAnimator",void 0);var HH,HW,HV,HK,HY,Hj,HX,HJ,HZ,HQ,H$,H0,H1,H2,H3,H4,H5,H6,H7,H8,H9,We,Wt,Wn=$.ccclass,Wi=$.property,Wr=(HC=Wn("GiftBlockAnimator"),HA=Wi(ee),H_=tj.required,HP=Wi(ee),HI=tj.required,HB=Wi(ee),HR=tj.required,HC((HL=L((HE=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"giftBlock",HL,N(a)),O(a,"giftBottom",HO,N(a)),O(a,"giftOpenedBottom",HN,N(a)),a}return a(u,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,u)}},{key:"playAnimation",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(this.showBottomBlock({isOpened:!1}),!(a=this.giftBlock.getComponent(es)))return[3,2];return[4,ts.runAnimationAsync(a,"GiftBlock")];case 1:o.sent(),o.label=2;case 2:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"onGiftOpened",value:function(){th.playSound(tZ.GIFT_OPEN,{volume:.7}),td.gameScene.gamePlay.vibrate.vibrate(50),this.showBottomBlock({isOpened:!0})}},{key:"showBottomBlock",value:function(a){var o=a.isOpened,C=void 0!==o&&o;this.giftBottom.active=!C,this.giftOpenedBottom.active=C}},{key:"playCloseGiftBlockAnimation",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.giftBlock).to(.5,{scale:ei.ZERO},{easing:"backIn"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eo)).prototype,"giftBlock",[HA,H_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HO=L(HE.prototype,"giftBottom",[HP,HI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HN=L(HE.prototype,"giftOpenedBottom",[HB,HR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HE))||HE);U._RF.pop(),U._RF.push({},"77737t2KbpN24omjqKvqAXw","ItemRewardBlock",void 0);var Wa,Wo,Ws,Wl,Wu,Wc=$.ccclass,Wh=$.property,Wp=(HH=Wc("ItemRewardBlock"),HW=Wh([et]),HV=tj.required(ni(et)),HK=Wh(W),HY=tj.required,Hj=Wh(pj),HX=tj.required,HJ=Wh(pj),HZ=tj.required,HQ=Wh(pj),H$=tj.required,H0=Wh(ee),H1=tj.required,H2=Wh(ee),H3=tj.required,HH((H5=L((H4=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"itemSpriteFrames",H5,N(a)),O(a,"iconSprite",H6,N(a)),O(a,"followSmokeEffect",H7,N(a)),O(a,"glowEffect",H8,N(a)),O(a,"squareGlowEffect",H9,N(a)),O(a,"itemSquareGlow",We,N(a)),O(a,"itemGlow",Wt,N(a)),a}return a(s,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"setSpriteFrame",value:function(a){"undo"===a?this.iconSprite.spriteFrame=this.itemSpriteFrames[0]:"magicWand"===a?this.iconSprite.spriteFrame=this.itemSpriteFrames[1]:"shuffle"===a&&(this.iconSprite.spriteFrame=this.itemSpriteFrames[2])}},{key:"toggleFlowSmokeEffect",value:function(a){a?this.followSmokeEffect.play():this.followSmokeEffect.stop()}},{key:"playSquareGlowEffect",value:function(){this.squareGlowEffect.play()}},{key:"toggleGlowEffect",value:function(a){a?this.glowEffect.play():this.glowEffect.stop()}},{key:"playGlowAnimation",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return this.itemGlow.scale=ei.ZERO,this.setNodeOpacity(this.itemGlow,255),this.itemSquareGlow.scale=ei.ZERO,this.setNodeOpacity(this.itemSquareGlow,255),a=Y(this.itemGlow).to(.3,{scale:new ei(1.5,1.5,1.5)},{easing:"sineInOut"}),o=Y(this.itemSquareGlow).to(.3,{scale:new ei(1.5,1.5,1.5)},{easing:"sineInOut"}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:if(P.sent(),C=this.createOpacityAnimation(this.itemGlow,0,.2,e3.sineInOut),A=this.createOpacityAnimation(this.itemSquareGlow,0,.2,e3.sineInOut),!(C&&A))return[3,3];return[4,Promise.all([ts.runTweenAsync(C),ts.runTweenAsync(A)])];case 2:P.sent(),P.label=3;case 3:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"setNodeOpacity",value:function(a,o){var C=a.getComponent(ea);C&&(C.opacity=o)}},{key:"createOpacityAnimation",value:function(a,o,C,A){var P=a.getComponent(ea);if(P)return Y(P).to(C,{opacity:o},{easing:A})}}]),s}(eo)).prototype,"itemSpriteFrames",[HW,HV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),H6=L(H4.prototype,"iconSprite",[HK,HY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H7=L(H4.prototype,"followSmokeEffect",[Hj,HX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H8=L(H4.prototype,"glowEffect",[HJ,HZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H9=L(H4.prototype,"squareGlowEffect",[HQ,H$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We=L(H4.prototype,"itemSquareGlow",[H0,H1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wt=L(H4.prototype,"itemGlow",[H2,H3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H4))||H4);U._RF.pop(),U._RF.push({},"be144tdeG9GUK3jK6MeSgC+","ItemRewardManager",void 0);var Wd,Wf,Wy,Wv,Wm,Wg,Wb,Wk,Ww,WS,WT,WC,WA,W_,WP,WI,WB,WR,WE,WL,WO,WN,WF,WD,WM,Wx,Wz,WG,Wq,WU=$.ccclass,WH=$.property,WW=(Wa=WU("ItemRewardManager"),Wo=WH(eY),Ws=tj.required,Wa((Wu=L((Wl=function(P){C(y,P);var I,R,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"itemRewardPrefab",Wu,N(a)),a.itemRewards=[],a}return a(y,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,y)}},{key:"getItemRewardBlock",value:function(){var a,o=E(this.itemRewards);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.node.active)return C.toggleFlowSmokeEffect(!0),C.toggleGlowEffect(!1),C.node.active=!0,C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.itemRewardPrefab).getComponent(Wp);return A?(A.toggleFlowSmokeEffect(!1),this.itemRewards.push(A),A.node.setParent(this.node),A):null}},{key:"hideAllItemRewards",value:function(){var a,o=E(this.itemRewards);try{for(o.s();!(a=o.n()).done;){var C=a.value;C.toggleFlowSmokeEffect(!1),C.node.active=!1}}catch(a){o.e(a)}finally{o.f()}}},{key:"createItemReward",value:function(a,o){var C=this.getItemRewardBlock();if(!C)return null;C.node.setPosition(o),C.setSpriteFrame(a);var A=C.getComponent(ea);return A&&(A.opacity=0),C}},{key:"playAllItemsAnimation",value:(F=B(function(a){var o,C,A,P,I,B,R,L,O;return _ts_generator(this,function(N){switch(N.label){case 0:C=-((o=a.length)-1)/2*350,A=[],P=0,N.label=1;case 1:if(!(P<o))return[3,4];return th.playSound(tZ.FAIRY_DUST),A.push(this.playFirstItemAnimation(a[P],P,C)),(I=a[P].getComponent(ea))&&(I.opacity=255),[4,ts.waitTweenAsync(.4)];case 2:N.sent(),N.label=3;case 3:return P++,[3,1];case 4:return[4,Promise.all(A)];case 5:N.sent(),A=[],B=o-1,N.label=6;case 6:if(!(B>=0))return[3,9];return R=a[B].node,A.push(this.playSecondItemAnimation(R,B,o)),[4,ts.waitTweenAsync(.1)];case 7:N.sent(),N.label=8;case 8:return B--,[3,6];case 9:return[4,Promise.all(A)];case 10:N.sent(),O=E(a);try{for(O.s();!(L=O.n()).done;)L.value.toggleGlowEffect(!0)}catch(a){O.e(a)}finally{O.f()}return[2]}})}),function(a){return F.apply(this,arguments)})},{key:"playFirstItemAnimation",value:(L=B(function(a,o,C){var A,P,I,B,R,E,L;return _ts_generator(this,function(O){switch(O.label){case 0:if(A=C+20*o,(P=a.node).setScale(new ei(.75,.75,.75)),!a.getComponent(ea))return[3,5];return this.playItemScaleUpDownAnimation(a),I=P.getPosition().x,B=Y(P).to(.2,{position:new ei(I,180,0)}),[4,ts.runTweenAsync(B)];case 1:return O.sent(),a.playSquareGlowEffect(),[4,ts.waitTweenAsync(.1)];case 2:return O.sent(),R=Y(P).to(.4,{position:new ei(I,360,0)}),[4,ts.runTweenAsync(R)];case 3:return O.sent(),a.playSquareGlowEffect(),E=P.getPosition().y,L=Y(P).to(.4,{position:new ei(A,E,0)}),[4,ts.runTweenAsync(L)];case 4:O.sent(),a.playSquareGlowEffect(),O.label=5;case 5:return[2]}})}),function(a,o,C){return L.apply(this,arguments)})},{key:"playItemScaleUpDownAnimation",value:(R=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return o=a.node,C=Y(o).to(.4,{scale:new ei(1,1,1)}),a.playGlowAnimation(),[4,ts.runTweenAsync(C)];case 1:return P.sent(),A=Y(o).to(.4,{scale:new ei(.75,.75,.75)}),[4,ts.runTweenAsync(A)];case 2:return P.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"playSecondItemAnimation",value:(I=B(function(a,o,C){var A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return A=350*(o-(C-1)/2),P=Y(a).to(.3,{position:new ei(A,310,0),scale:new ei(1,1,1)}),[4,ts.runTweenAsync(P)];case 1:return I.sent(),[2]}})}),function(a,o,C){return I.apply(this,arguments)})}]),y}(eo)).prototype,"itemRewardPrefab",[Wo,Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl))||Wl);U._RF.pop(),U._RF.push({},"69b09XQJohNOKiWazlZWv32","ChapterCompleteAnimation",void 0);var WV,WK,WY,Wj,WX,WJ,WZ,WQ,W$,W0,W1,W2,W3,W4,W5,W6,W7,W8=$.ccclass,W9=$.property,Ve=(Wd=W8("ChapterCompleteAnimation"),Wf=W9(Wr),Wy=tj.required,Wv=W9(WW),Wm=tj.required,Wg=W9(ee),Wb=tj.required,Wk=W9(ee),Ww=tj.required,WS=W9(ee),WT=tj.required,WC=W9(pj),WA=tj.required,W_=W9(pj),WP=tj.required,WI=W9(pj),WB=tj.required,WR=W9(ee),WE=tj.required,Wd((WO=L((WL=function(P){C(k,P);var I,E,L,F,D,M,x,z,q,U=A(k);function k(){var a;o(this,k);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=U.call.apply(U,[this].concat(A)),O(a,"giftBlockAnimator",WO,N(a)),O(a,"itemRewardManager",WN,N(a)),O(a,"textReceive",WF,N(a)),O(a,"textTitle",WD,N(a)),O(a,"textReward",WM,N(a)),O(a,"circleGlow",Wx,N(a)),O(a,"smallSpakleEffect",Wz,N(a)),O(a,"spakleEffect",WG,N(a)),O(a,"collectButton",Wq,N(a)),a.originalTextReceiveY=0,a.originalTextTitleY=0,a.originalTextRewardY=0,a.effectPath=[],a.effectPath2=[],a.effectPath3=[],a}return a(k,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,k)}},{key:"setUpData",value:function(){this.originalTextReceiveY=this.textReceive.getPosition().y,this.originalTextTitleY=this.textTitle.getPosition().y,this.originalTextRewardY=this.textReward.getPosition().y,this.circleGlow.stop(),this.createCircleEffectPath(0,75),this.createCircleEffectPath2(0,75),this.createCircleEffectPath3(0,75)}},{key:"hideAllItemRewards",value:function(){this.itemRewardManager.hideAllItemRewards()}},{key:"prepareAnims",value:function(){this.setOpacity(this.textReceive,0),this.setOpacity(this.textTitle,0),this.setOpacity(this.textReward,0),this.setYPosition(this.textReceive,this.originalTextReceiveY),this.setYPosition(this.textTitle,this.originalTextTitleY),this.setYPosition(this.textReward,this.originalTextRewardY)}},{key:"playAnims",value:(q=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.giftBlockAnimator.playAnimation(),this.playCircleEffectAnims(),this.playTextReceiveAnimation()])];case 1:return a.sent(),[4,this.handleGiftOpened()];case 2:return a.sent(),[2]}})}),function(){return q.apply(this,arguments)})},{key:"playCircleEffectAnims",value:(z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.circleGlow.stop(),[4,ts.waitTweenAsync(.25)];case 1:return a.sent(),this.circleGlow.play(),this.playCurveEffect(),[4,ts.waitTweenAsync(.2)];case 2:return a.sent(),this.playCurveEffect2(),[4,ts.waitTweenAsync(.28)];case 3:return a.sent(),this.playCurveEffect3(),[2]}})}),function(){return z.apply(this,arguments)})},{key:"playCurveEffect",value:(x=B(function(){var a,o,C;return _ts_generator(this,function(A){return o=this,C=this.circleGlow.node.getPosition().z,(a=Y(this.effectPath)).sequence.apply(a,R(this.effectPath.map(function(a,A){return Y(o.circleGlow.node).to(.01,{position:new ei(a.x,a.y,C)},{easing:e3.linear})}))).start(),[2]})}),function(){return x.apply(this,arguments)})},{key:"playCurveEffect2",value:(M=B(function(){var a,o,C;return _ts_generator(this,function(A){return o=this,C=this.circleGlow.node.getPosition().z,(a=Y(this.effectPath2)).sequence.apply(a,R(this.effectPath2.map(function(a,A){return Y(o.circleGlow.node).to(.01,{position:new ei(a.x,a.y,C)},{easing:e3.linear})}))).start(),[2]})}),function(){return M.apply(this,arguments)})},{key:"playCurveEffect3",value:(D=B(function(){var a,o,C;return _ts_generator(this,function(A){return o=this,C=this.circleGlow.node.getPosition().z,(a=Y(this.effectPath3)).sequence.apply(a,R(this.effectPath3.map(function(a,A){return Y(o.circleGlow.node).to(.01,{position:new ei(a.x,a.y,C)},{easing:e3.linear})}))).start(),[2]})}),function(){return D.apply(this,arguments)})},{key:"createCircleEffectPath",value:function(a,o){if(!(this.effectPath.length>0)){for(var C=.55*Math.PI,A=0;A<16;A++){C-=Math.PI/13;var P=a+504*Math.cos(-C),I=o+504*Math.sin(-C);C>.8&&(P-=125,I-=100),this.effectPath.push(new H(P,I))}this.effectPath.reverse()}}},{key:"createCircleEffectPath2",value:function(a,o){if(!(this.effectPath2.length>0)){for(var C=1.54*Math.PI,A=0;A<17;A++){C-=Math.PI/16;var P=a+504*Math.cos(-C),I=o+504*Math.sin(-C);this.effectPath2.push(new H(P,I))}this.effectPath2.reverse()}}},{key:"createCircleEffectPath3",value:function(a,o){if(!(this.effectPath3.length>0)){for(var C=2.3*Math.PI,A=0;A<11;A++){C-=Math.PI/16;var P=a+504*Math.cos(-C),I=o+504*Math.sin(-C);this.effectPath3.push(new H(P,I))}this.effectPath3.reverse()}}},{key:"handleGiftOpened",value:(F=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(this.smallSpakleEffect.play(),a=this.giftBlockAnimator.node.getPosition().clone(),this.spakleEffect.node.setPosition(a),this.spakleEffect.play(),o=this.itemRewardManager.createItemReward("undo",new ei(0,-100,0)),C=this.itemRewardManager.createItemReward("magicWand",new ei(0,-100,0)),A=this.itemRewardManager.createItemReward("shuffle",new ei(0,-100,0)),!(o&&A&&C))return[3,3];return P=[o,C,A],[4,Promise.all([this.playTextAnimationsAfterClickCollect(),this.itemRewardManager.playAllItemsAnimation(P)])];case 1:return I.sent(),[4,this.giftBlockAnimator.playCloseGiftBlockAnimation()];case 2:I.sent(),this.fadeInCollectButton(),I.label=3;case 3:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"setOpacity",value:function(a,o){var C=a.getComponent(ea);C&&(C.opacity=o)}},{key:"setYPosition",value:function(a,o){var C=a.getPosition(),A=C.x,P=C.z;a.setPosition(A,o,P)}},{key:"playTextReceiveAnimation",value:(L=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return[4,ts.waitTweenAsync(.4)];case 1:if(P.sent(),a=this.createOpacityTween(this.textReceive,255,.1),o=this.createMoveTween(this.textReceive,new ei(0,-40,0),.1,e3.sineInOut),!a)return[3,6];return[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 2:return P.sent(),C=this.createMoveTween(this.textReceive,new ei(0,125,0),.25,e3.backInOut),[4,ts.runTweenAsync(C)];case 3:return P.sent(),[4,ts.waitTweenAsync(.2)];case 4:return P.sent(),A=this.createMoveTween(this.textReceive,new ei(0,-30,0),.5,e3.backOut),[4,ts.runTweenAsync(A)];case 5:P.sent(),P.label=6;case 6:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"playTextAnimationsAfterClickCollect",value:(E=B(function(){var a,o,C,A,P,I,B,R,E,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:if(!(a=this.createOpacityTween(this.textReceive,0,.125)))return[3,7];return[4,ts.runTweenAsync(a)];case 1:if(F.sent(),o=this.createMoveTween(this.textTitle,new ei(0,20,0),.125,e3.linear),C=this.createOpacityTween(this.textTitle,255,.125),A=this.createMoveTween(this.textReward,new ei(0,20,0),.125,e3.linear),P=this.createOpacityTween(this.textReward,255,.125),!(C&&P))return[3,7];return[4,Promise.all([ts.runTweenAsync(o),ts.runTweenAsync(C),ts.runTweenAsync(A),ts.runTweenAsync(P)])];case 2:return F.sent(),[4,ts.waitTweenAsync(1.1)];case 3:if(F.sent(),I=this.createScaleTween(this.textReward,1.1,1,e3.sineOut),B=this.createMoveTween(this.textTitle,new ei(0,-2,0),.5,e3.sineOut),!(R=this.createOpacityTween(this.textTitle,127.5,.5)))return[3,7];return[4,Promise.all([ts.runTweenAsync(I),ts.runTweenAsync(B),ts.runTweenAsync(R)])];case 4:if(F.sent(),E=this.createMoveTween(this.textReward,new ei(0,-27,0),.5,e3.backOut),L=this.createScaleTween(this.textReward,1,.5,e3.backOut),O=this.createMoveTween(this.textTitle,new ei(0,-27,0),.5,e3.backOut),!(N=this.createOpacityTween(this.textTitle,255,.5)))return[3,6];return[4,Promise.all([ts.runTweenAsync(E),ts.runTweenAsync(L),ts.runTweenAsync(O),ts.runTweenAsync(N)])];case 5:F.sent(),F.label=6;case 6:F.label=7;case 7:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"fadeInCollectButton",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(!(a=this.createOpacityTween(this.collectButton,255,.233)))return[3,2];return[4,ts.runTweenAsync(a)];case 1:o.sent(),o.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"createOpacityTween",value:function(a,o,C){var A=a.getComponent(ea);return A?Y(A).to(C,{opacity:o}):null}},{key:"createMoveTween",value:function(a,o,C,A){var P=a.getPosition(),I=P.x,B=P.y,R=P.z;return Y(a).to(C,{position:new ei(I+o.x,B+o.y,R)},{easing:A})}},{key:"createScaleTween",value:function(a,o,C,A){return Y(a).to(C,{scale:new ei(o,o,o)},{easing:A})}}]),k}(eo)).prototype,"giftBlockAnimator",[Wf,Wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WN=L(WL.prototype,"itemRewardManager",[Wv,Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=L(WL.prototype,"textReceive",[Wg,Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WD=L(WL.prototype,"textTitle",[Wk,Ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=L(WL.prototype,"textReward",[WS,WT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wx=L(WL.prototype,"circleGlow",[WC,WA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=L(WL.prototype,"smallSpakleEffect",[W_,WP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WG=L(WL.prototype,"spakleEffect",[WI,WB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wq=L(WL.prototype,"collectButton",[WR,WE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WL))||WL);U._RF.pop(),U._RF.push({},"19eaeexCO1BwpLXmN3p5YYD","ChapterCompleteScreen",void 0);var Vt,Vn,Vi,Vr,Va,Vo,Vs=$.ccclass,Vl=$.property,Vu=$.disallowMultiple,Vc=$.requireComponent,Vh=GameCore.Events,Vp=globalThis.game,Vd=Vp.event,Vf=Vp.event;WV=Vs("ChapterCompleteScreen"),WK=Vc(Bi),WY=Vl(ef),Wj=tj.required,WX=Vl(W),WJ=tj.required,WZ=Vl(Ve),WQ=tj.required,W$=tj.required,W0=tj.required,WV(W1=Vu(W1=WK((W3=L((W2=function(P){C(m,P);var I,R,E,L,F,D,M,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=z.call.apply(z,[this].concat(A)),O(a,"collectButton",W3,N(a)),O(a,"gamePlayBg",W4,N(a)),O(a,"chapterCompleteAnimation",W5,N(a)),O(a,"screen",W6,N(a)),O(a,"screenOpacity",W7,N(a)),a.collectButtonBubbleTween=null,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("ChapterCompleteScreen: screen not found");a.validateEventPayload(o)&&(a.toggleButtonsInteractable(!0),a.updateGamePlayBg(),a.prepareOpenScreen(),a.chapterCompleteAnimation.prepareAnims())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(m,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.listenScreenEvents(),this.registryButtonEvents(),this.setUpScreen(),this.validateRequiredComponents(),this.setUpBubbleButtons()}},{key:"setUpScreen",value:function(){this.chapterCompleteAnimation.setUpData(),this.screenOpacity=this.getComponent(ea)}},{key:"onLoad",value:function(){var a=this.screen.container.getComponent(eX);if(a)try{var o=tf.getBannerAdWorldHeight();if(o<=0)return;a.bottom+=o,a.updateAlignment()}catch(a){return}}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,m)}},{key:"listenScreenEvents",value:function(){Vd.on(Vh.OPENING_SCREEN,this.handleOpeningScreen),Vd.on(Vh.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Vd.off(Vh.OPENING_SCREEN,this.handleOpeningScreen),Vd.off(Vh.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"registryButtonEvents",value:function(){this.collectButton.node.on(ef.EventType.CLICK,this.handleClickedCollectBtn,this)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"open",value:(x=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.FAIRY_DUST),[4,this.chapterCompleteAnimation.playAnims()];case 1:return a.sent(),Vd.emit(Vh.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),Vf.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return x.apply(this,arguments)})},{key:"close",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.toggleButtonsInteractable(!1),[4,this.fadeOutScreen()];case 1:return a.sent(),[4,t_.openScreenAsync(tP.STAMP_SCREEN)];case 2:return a.sent(),[4,t_.closeScreenAsync(tP.STAMP_SCREEN)];case 3:return a.sent(),[4,this.runRoadRevealLeftAnim()];case 4:return a.sent(),[4,this.tryToOpenTournamentInfoScreen()];case 5:return a.sent(),[4,this.playAfterReceivingGiftAnim()];case 6:return a.sent(),this.node.active=!1,Vd.emit(Vh.CLOSED_SCREEN,{screenName:this.node.name}),Vd.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return M.apply(this,arguments)})},{key:"runRoadRevealLeftAnim",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,td.gameScene.uiManager.getDashboardScreen().runRoadRevealLeftAnim()];case 1:return a.sent(),[2]}})}),function(){return D.apply(this,arguments)})},{key:"tryToOpenTournamentInfoScreen",value:(F=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(C=(o=(a=td.gameScene.gamePlay).gameDataManager).getLevel(),o.isUnlockTourFeature())return[3,3];if(C!==t4.TOURNAMENT_LEVEL_START)return[3,2];return o.setGameData({isUnlockTourFeature:!0}),a.timerHandler.startLeaderboardCountDown(),[4,t_.openScreenAsync(tP.TOURNAMENT_INFO_SCREEN)];case 1:A.sent(),A.label=2;case 2:A.label=3;case 3:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"playAfterReceivingGiftAnim",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,td.gameScene.uiManager.getDashboardScreen().playAfterReceivingGiftAnim()];case 1:return a.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"toggleButtonsInteractable",value:function(a){this.collectButton.interactable=a}},{key:"handleClickedCollectBtn",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),this.chapterCompleteAnimation.hideAllItemRewards(),[4,Promise.all([t_.closeScreenAsync(tP.CHAPTER_COMPLETE_SCREEN),this.fadeInDashboard()])];case 1:return a.sent(),th.playMusic(tZ.DASHBOARD_MUSIC),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return E.apply(this,arguments)})},{key:"prepareOpenScreen",value:function(){this.stopCollectButtonAnimation(),this.screenOpacity.opacity=255,this.resetCollectButton(),this.resetContainer(),this.runCollectButtonAnimation()}},{key:"updateGamePlayBg",value:function(){var a=td.gameScene.background.getCurrentBackground();a&&(this.gamePlayBg.spriteFrame=a),this.resizeGamePlayBg()}},{key:"resizeGamePlayBg",value:function(){if(!nr.isPortrait()){var a=td.gameScene.background.getUITransform();if(a){var o=this.gamePlayBg.getComponent(en);if(o){var C=a.width,A=a.height;o.setContentSize(C,A)}}}}},{key:"resetCollectButton",value:function(){var a=this.collectButton.getComponent(ea);a&&(a.opacity=0)}},{key:"resetContainer",value:function(){this.screen.container.scale=ei.ONE;var a=this.screen.container.getComponent(ea);a&&(a.opacity=256)}},{key:"runCollectButtonAnimation",value:function(){this.collectButtonBubbleTween&&this.collectButtonBubbleTween.start()}},{key:"stopCollectButtonAnimation",value:function(){this.collectButtonBubbleTween&&(this.collectButtonBubbleTween.stop(),this.collectButton.node.setScale(1,1,1))}},{key:"setUpBubbleButtons",value:function(){this.collectButtonBubbleTween=ti(this.collectButton.node);var a=this.collectButton.getComponent(az);a&&(a.animationUp=this.collectButtonBubbleTween)}},{key:"fadeOutScreen",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.screenOpacity).to(.25,{opacity:0}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"fadeInDashboard",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.node.scene.once(t2.FADED_IN_DASHBOARD_DONE,o),td.gameScene.uiManager.handleScreenReturn()})]})}),function(){return I.apply(this,arguments)})}]),m}(eo)).prototype,"collectButton",[WY,Wj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W4=L(W2.prototype,"gamePlayBg",[WX,WJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W5=L(W2.prototype,"chapterCompleteAnimation",[WZ,WQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W6=L(W2.prototype,"screen",[W$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W7=L(W2.prototype,"screenOpacity",[W0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=W2))||W1)||W1),U._RF.pop(),U._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var Vy,Vv,Vm,Vg,Vb,Vk=$.ccclass,Vw=$.requireComponent;Vt=Vk("BackgroundMask"),Vn=Vw([ea]),Vi=tj.required,Vt(Vr=Vn((Vo=L((Va=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"opacity",Vo,N(a)),a}return a(r,[{key:"onLoad",value:function(){var a=this.getComponent(ea);a&&(this.opacity=a,tj.validateRequiredProperties(this,r),this.updateMaskAlpha())}},{key:"updateMaskAlpha",value:function(){var a,o=this.opacity.opacity/255*.8;(a=document.getElementById("app-mask"))&&(a.style.background="rgb(0 0 0 / ".concat(o,")"))}}]),r}(eo)).prototype,"opacity",[Vi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vr=Va))||Vr),U._RF.pop(),U._RF.push({},"d562cAXnG1PQ6vXfOEq2wVu","Screens",void 0);var VS,VT,VC,VA,V_,VP=$.ccclass,VI=$.property,VB=$.executeInEditMode;Vy=VP("Screens"),Vv=VI({type:eL(tP)}),Vy(Vm=VB((Vb=L((Vg=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"screenKeys",Vb,N(a)),a}return a(r,[{key:"onEnable",value:function(){}},{key:"onDisable",value:function(){}},{key:"onChildrenChanged",value:function(){}}]),r}(eo)).prototype,"screenKeys",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vm=Vg))||Vm),U._RF.pop(),U._RF.push({},"a80a4wzFZBIZIGhCTjLWumm","ProgressBarDailyMission",void 0);var VR=$.ccclass,VE=$.property,VL=(VS=VR("ProgressBarDailyMission"),VT=VE(er),VC=tj.required,VS((V_=L((VA=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"progressLabel",V_,N(a)),a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"setProgress",value:function(a){M(D(r.prototype),"setProgress",this).call(this,a);var o=this.progressLabel,C=a.numerator,A=a.denominator;o.string="".concat(Math.floor(C),"/").concat(A)}}]),r}(uk)).prototype,"progressLabel",[VT,VC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VA))||VA);U._RF.pop(),U._RF.push({},"410ecfxuepEoqT1vQKccjic","CountDownToMidnight",void 0);var VO,VN,VF,VD,VM,Vx,Vz,VG,Vq,VU,VH,VW,VV,VK,VY,Vj,VX,VJ,VZ,VQ,V$,V0,V1=function(){function n(){o(this,n),this.intervalId=void 0}return a(n,[{key:"start",value:function(a){var o=this;if(void 0===this.intervalId){var C=new Date;C.setHours(24,0,0,0);var i=function(){var A=new Date,P=C.getTime()-A.getTime();if(P<=0)return o.stop(),void a("End");var I=Math.floor(P/1e3%60),B=Math.floor(P/6e4%60),R=Math.floor(P/36e5%24);a("".concat(R.toString().padStart(2,"0"),":").concat(B.toString().padStart(2,"0"),":").concat(I.toString().padStart(2,"0")))};i(),this.intervalId=setInterval(i,1e3)}}},{key:"stop",value:function(){void 0!==this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}}]),n}();U._RF.pop(),U._RF.push({},"c8a6dFsZJlJFrEE1DjY5iO1","BigMissionBlock",void 0);var V2,V3,V4,V5,V6,V7,V8,V9,Ke,Kt,Kn,Ki=$.ccclass,Kr=$.property,Ka=new V1,Ko="All daily tasks completed",Ks=(VO=Ki("BigMissionBlock"),VN=Kr(er),VF=tj.required,VD=Kr(er),VM=tj.required,Vx=Kr(VL),Vz=tj.required,VG=Kr(W),Vq=tj.required,VU=Kr(W),VH=tj.required,VW=Kr(W),VV=tj.required,VK=tj.required,VO((Vj=L((VY=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"timerLabel",Vj,N(a)),O(a,"titleLabel",VX,N(a)),O(a,"progressBar",VJ,N(a)),O(a,"grayedOutBox",VZ,N(a)),O(a,"normalBox",VQ,N(a)),O(a,"check",V$,N(a)),O(a,"titleLabelUIOpacity",V0,N(a)),a}return a(p,[{key:"__preload",value:function(){this.titleLabelUIOpacity=this.titleLabel.getComponent(ea),tj.validateRequiredProperties(this,p)}},{key:"onLoad",value:function(){}},{key:"start",value:function(){}},{key:"setPayload",value:function(a){var o=a.progress,C=o.numerator,A=o.denominator,P=a.check,I=1===C/A;this.titleLabel.string=I?globalThis.game.language.getText(Ko):globalThis.game.language.getText("Complete all daily tasks"),this.progressBar.setProgress({numerator:C,denominator:A}),this.showNormalBox(I,P)}},{key:"showNormalBox",value:function(a,o){var C=arguments.length>1&&void 0!==o&&o;a?(this.grayedOutBox.node.active=!1,this.normalBox.node.active=!0,this.check.node.active=C):(this.grayedOutBox.node.active=!0,this.normalBox.node.active=!1,this.check.node.active=!1)}},{key:"startCountDown",value:function(){var a=this;Ka.start(function(o){a.timerLabel.string=o})}},{key:"stopCountDown",value:function(){Ka.stop()}},{key:"runAllDailyTasksCompletedAnimation",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.prepareAllDailyTasksCompletedAnimation(),[4,this.switchTitleLabel()];case 1:return a.sent(),[4,this.showCheck()];case 2:return a.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"prepareAllDailyTasksCompletedAnimation",value:function(){var a=this.check.node;a.active=!0,a.setScale(ei.ZERO),this.titleLabelUIOpacity.opacity=255}},{key:"switchTitleLabel",value:(R=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(a=this.titleLabel,o=this.titleLabelUIOpacity,!(a.string!==Ko))return[3,2];return this.showNormalBox(!0,!0),C=Y(o).to(.2,{opacity:0}),[4,ts.runTweenAsync(C)];case 1:return P.sent(),a.string=Ko,A=Y(o).to(.2,{opacity:255}),[2,ts.runTweenAsync(A)];case 2:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"showCheck",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.check.node).to(.2,{scale:ei.ONE},{easing:"backOut"}),[2,ts.runTweenAsync(a)]})}),function(){return I.apply(this,arguments)})}]),p}(eo)).prototype,"timerLabel",[VN,VF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VX=L(VY.prototype,"titleLabel",[VD,VM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VJ=L(VY.prototype,"progressBar",[Vx,Vz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VZ=L(VY.prototype,"grayedOutBox",[VG,Vq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VQ=L(VY.prototype,"normalBox",[VU,VH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V$=L(VY.prototype,"check",[VW,VV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V0=L(VY.prototype,"titleLabelUIOpacity",[VK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VY))||VY);U._RF.pop(),U._RF.push({},"5a6d19x4BRE3bfcnoXtfML5","RewardItem",void 0);var Kl,Ku,Kc,Kh,Kp,Kd,Kf,Ky,Kv,Km,Kg,Kb,Kk,Kw,KS,KT,KC,KA,K_,KP,KI,KB,KR,KE,KL,KO,KN,KF,KD,KM,Kx,Kz,KG,Kq,KU,KH,KW,KV,KK,KY,Kj,KX,KJ,KZ,KQ,K$,K0,K1=$.ccclass,K2=$.property,K3=(V2=K1("RewardItem"),V3=K2(ea),V4=tj.required,V5=K2(W),V6=tj.required,V7=K2(er),V8=tj.required,V2((Ke=L((V9=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"uiOpacity",Ke,N(a)),O(a,"icon",Kt,N(a)),O(a,"countLabel",Kn,N(a)),a}return a(s,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"fadeOut",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.uiOpacity).to(.3,{opacity:0},{easing:"cubicIn"}),[2,ts.runTweenAsync(a)]})}),function(){return I.apply(this,arguments)})}]),s}(eo)).prototype,"uiOpacity",[V3,V4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kt=L(V9.prototype,"icon",[V5,V6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kn=L(V9.prototype,"countLabel",[V7,V8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V9))||V9);U._RF.pop(),U._RF.push({},"84d26ApvmJCHZx/cm7DvMe+","SmallMissionBlock",void 0);var K4,K5,K6,K7,K8,K9,Ye,Yt,Yn,Yi,Yr,Ya,Yo,Ys,Yl,Yu,Yc,Yh,Yp,Yd,Yf=$.ccclass,Yy=$.property,Yv=(Kl=Yf("SmallMissionRewardIcons"),Ku=Yy(et),Kc=tj.required,Kh=Yy(et),Kp=tj.required,Kd=Yy(et),Kf=tj.required,Kl((Kv=L((Ky=function(){function n(){o(this,n),O(this,"undo",Kv,this),O(this,"magic-wand",Km,this),O(this,"shuffle",Kg,this)}return a(n,[{key:"init",value:function(){tj.validateRequiredProperties(this,n)}}]),n}()).prototype,"undo",[Ku,Kc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km=L(Ky.prototype,"magic-wand",[Kh,Kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kg=L(Ky.prototype,"shuffle",[Kd,Kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky))||Ky),Ym=(Kb=Yf("SmallMissionBlock"),Kk=Yy(Yv),Kw=Yy(W),KS=tj.required,KT=Yy(er),KC=tj.required,KA=Yy(VL),K_=tj.required,KP=Yy(ee),KI=tj.required,KB=Yy(ea),KR=tj.required,KE=Yy(K3),KL=tj.required,KO=Yy(ef),KN=tj.required,KF=Yy(ef),KD=tj.required,KM=Yy(W),Kx=tj.required,Kz=Yy(ee),KG=tj.required,Kq=tj.required,Kb((KH=L((KU=function(P){C(g,P);var I,R,E,L,F,D,M,x,z,q=A(g);function g(){var a;o(this,g);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=q.call.apply(q,[this].concat(A)),O(a,"rewardIcons",KH,N(a)),O(a,"icon",KW,N(a)),O(a,"missionLabel",KV,N(a)),O(a,"progressBar",KK,N(a)),O(a,"rewardLabel",KY,N(a)),O(a,"rewardLabelUIOpacity",Kj,N(a)),O(a,"rewardItem",KX,N(a)),O(a,"goButton",KJ,N(a)),O(a,"claimButton",KZ,N(a)),O(a,"check",KQ,N(a)),O(a,"inactiveBg",K$,N(a)),O(a,"defaultLabel",K0,N(a)),a}return a(g,[{key:"__preload",value:function(){this.defaultLabel=this.missionLabel.string,tj.validateRequiredProperties(this,g)}},{key:"onLoad",value:function(){}},{key:"setPayload",value:function(a){var o=a.progress,C=o.numerator,A=o.denominator,P=a.reward,I=P.type,B=P.count,R=P.isClaimed,E=this.progressBar,L=this.goButton,O=this.claimButton,N=this.check,F=this.rewardLabelUIOpacity,D=this.rewardItem,M=D.icon,x=D.countLabel,z=D.uiOpacity,q=D.node,U=R?1:C/A;E.setProgress({numerator:C,denominator:A}),M.spriteFrame=this.rewardIcons[I],x.string="x".concat(B);var H=this.missionLabel.node.position,W=H.x,V=H.z;R?(L.node.active=!1,O.node.active=!1,N.node.active=!0,q.active=!1,this.inactiveBg.active=!0,this.progressBar.node.active=!1,this.rewardLabel.active=!1,this.missionLabel.node.setPosition(W,0,V),z.opacity=0):(U<1?(L.node.active=!0,O.node.active=!1):(L.node.active=!1,O.node.active=!0),N.node.active=!1,q.active=!0,this.inactiveBg.active=!1,this.progressBar.node.active=!0,this.rewardLabel.active=!0,this.missionLabel.node.setPosition(W,38.6,V),F.opacity=255,z.opacity=255);for(var K=0,Y=[O,N];K<Y.length;K++)Y[K].node.setScale(ei.ONE)}},{key:"runClaimAnimation",value:(z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.prepareClaimAnimation(),[4,this.fadeOutRewardLabel()];case 1:return a.sent(),[4,Promise.all([this.moveUpRewardItem(),this.hideRewardComponents(),this.hideClaimButton(),this.moveMissionLabelDown(),this.fadeInactiveBg(),this.fadeOutProgressBar()])];case 2:return a.sent(),th.playSound(tZ.CLAIM_REWARD),td.gameScene.gamePlay.vibrate.vibrate(50),[4,this.showCheck()];case 3:return a.sent(),[2]}})}),function(){return z.apply(this,arguments)})},{key:"prepareClaimAnimation",value:function(){var a=this.claimButton,o=this.check,C=this.rewardLabelUIOpacity,A=this.rewardItem;a.node.setScale(ei.ONE),o.node.setScale(ei.ZERO),o.node.active=!0;for(var P=0,I=[C,A.uiOpacity];P<I.length;P++)I[P].opacity=255;this.inactiveBg.active=!0;var B=this.inactiveBg.getComponent(W);if(B){var R=B.color,E=R.r,L=R.g,O=R.b;B.color=new K(E,L,O,0)}}},{key:"hideClaimButton",value:(x=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.claimButton.node).to(.3,{scale:ei.ZERO},{easing:"cubicIn"}),[2,ts.runTweenAsync(a)]})}),function(){return x.apply(this,arguments)})},{key:"hideRewardComponents",value:(M=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.rewardItem.fadeOut()])]})}),function(){return M.apply(this,arguments)})},{key:"moveUpRewardItem",value:(D=B(function(){var a,o;return _ts_generator(this,function(C){return a=this.rewardItem.node.position.clone().add(new ei(0,47,0)),o=Y(this.rewardItem.node).to(.3,{position:a},{easing:"quadInOut"}),[2,ts.runTweenAsync(o)]})}),function(){return D.apply(this,arguments)})},{key:"fadeOutRewardLabel",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){return a=Y(this.rewardLabelUIOpacity).to(.3,{opacity:0},{easing:"backIn"}),o=Y(this.rewardLabel).to(.3,{scale:ei.ZERO},{easing:"backIn"}),[2,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])]})}),function(){return F.apply(this,arguments)})},{key:"showCheck",value:(L=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.check.node).to(.2,{scale:ei.ONE},{easing:"backOut"}),[2,ts.runTweenAsync(a)]})}),function(){return L.apply(this,arguments)})},{key:"fadeInactiveBg",value:(E=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){if(a=this.inactiveBg.getComponent(W))return C=(o=a.color).r,A=o.g,P=o.b,I=Y(a).to(.2,{color:new K(C,A,P,255)}),[2,ts.runTweenAsync(I)];return[2]})}),function(){return E.apply(this,arguments)})},{key:"moveMissionLabelDown",value:(R=B(function(){var a,o,C,A;return _ts_generator(this,function(P){return o=(a=this.missionLabel.node.position).x,C=a.z,A=Y(this.missionLabel.node).to(.2,{position:new ei(o,0,C)}),[2,ts.runTweenAsync(A)]})}),function(){return R.apply(this,arguments)})},{key:"fadeOutProgressBar",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){if(a=this.progressBar.getComponent(ea))return o=Y(a).to(.2,{opacity:0}),[2,ts.runTweenAsync(o)];return[2]})}),function(){return I.apply(this,arguments)})},{key:"updateMissionLabelBasedOnLocale",value:function(){switch(this.defaultLabel){case"Pass levels":this.missionLabel.string=globalThis.game.language.getText("Pass levels");break;case"Use boosters":this.missionLabel.string=globalThis.game.language.getText("Use boosters");break;case"Collect tiles":this.missionLabel.string=globalThis.game.language.getText("Collect tiles");break;case"Pass levels in a row":this.missionLabel.string=globalThis.game.language.getText("Pass levels in a row")}}},{key:"onClickGoButton",set:function(a){this.goButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickClaimButton",set:function(a){var o=this;this.claimButton.node.on(ef.EventType.CLICK,function(){a(),o.claimButton.interactable=!1},this)}}]),g}(eo)).prototype,"rewardIcons",[Kk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Yv}}),KW=L(KU.prototype,"icon",[Kw,KS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KV=L(KU.prototype,"missionLabel",[KT,KC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KK=L(KU.prototype,"progressBar",[KA,K_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KY=L(KU.prototype,"rewardLabel",[KP,KI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kj=L(KU.prototype,"rewardLabelUIOpacity",[KB,KR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KX=L(KU.prototype,"rewardItem",[KE,KL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KJ=L(KU.prototype,"goButton",[KO,KN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KZ=L(KU.prototype,"claimButton",[KF,KD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KQ=L(KU.prototype,"check",[KM,Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K$=L(KU.prototype,"inactiveBg",[Kz,KG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K0=L(KU.prototype,"defaultLabel",[Kq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KU))||KU);U._RF.pop(),U._RF.push({},"f0f89KLvE1JN578NvKI4t2K","DailyMissionsContainer",void 0);var Yg=$.ccclass,Yb=$.property,Yk=(K4=Yg("DailyMissionsContainer"),K5=Yb(ef),K6=tj.required,K7=Yb(Ks),K8=tj.required,K9=Yb(Ym),Ye=tj.required,Yt=Yb(Ym),Yn=tj.required,Yi=Yb(Ym),Yr=tj.required,Ya=Yb(Ym),Yo=tj.required,K4((Yl=L((Ys=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"closeButton",Yl,N(a)),O(a,"bigMissionBlock",Yu,N(a)),O(a,"passLevelsBlock",Yc,N(a)),O(a,"useBoostersBlock",Yh,N(a)),O(a,"collectTilesBlock",Yp,N(a)),O(a,"passLevelsInARowBlock",Yd,N(a)),a.bigMissionBlockPayload={},a.tweenProgressBigMissionBlock=null,a.tempProgress=0,a}return a(p,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,p)}},{key:"onClickCloseButton",set:function(a){this.closeButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickButtons",set:function(a){for(var o in a){var C=a[o],A=C.goButton,P=C.claimButton;this[o].onClickGoButton=A,this[o].onClickClaimButton=P}}},{key:"prepareOpen",value:function(a){var o=this.bigMissionBlock;o.startCountDown(),this.updateMissionLabelBasedOnLocale();var C=this.getMissionTypeToSmallBlock();this.bigMissionBlockPayload={progress:{numerator:0,denominator:0},check:!0};for(var A=0,P=Object.entries(a);A<P.length;A++){var I=z(P[A],2),B=I[0],R=I[1];C[B].setPayload(R);var E=R.progress,L=R.reward;this.bigMissionBlockPayload.progress.denominator++,E.numerator===E.denominator&&R.reward.isClaimed&&this.bigMissionBlockPayload.progress.numerator++,L.isClaimed||(this.bigMissionBlockPayload.check=!1)}o.setPayload(this.bigMissionBlockPayload)}},{key:"runClaimAnimation",value:(E=B(function(a){return _ts_generator(this,function(o){return[2,this.getMissionTypeToSmallBlock()[a].runClaimAnimation()]})}),function(a){return E.apply(this,arguments)})},{key:"runAllDailyTasksCompletedAnimation",value:(R=B(function(){return _ts_generator(this,function(a){return[2,(th.playSound(tZ.ALL_MISSION_DONE,{volume:.5}),td.gameScene.gamePlay.vibrate.vibrate(50),this.bigMissionBlock.runAllDailyTasksCompletedAnimation())]})}),function(){return R.apply(this,arguments)})},{key:"runClaimSubMissionAnimation",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){return C=(o=this.bigMissionBlockPayload.progress).numerator,A=o.denominator,this.bigMissionBlockPayload.progress.numerator++,null!=(a=this.tweenProgressBigMissionBlock)&&a.running||(this.tempProgress=C),this.runAnimBigMissionBlockProgress(C,A),[2]})}),function(){return I.apply(this,arguments)})},{key:"runAnimBigMissionBlockProgress",value:function(a,o){var C,A=this,P={progress:this.tempProgress};return null==(C=this.tweenProgressBigMissionBlock)||C.stop(),new Promise(function(C){A.tweenProgressBigMissionBlock=Y(P).to(.33,{progress:a+1},{onUpdate:function(a,C){var P,I;A.bigMissionBlock.progressBar.setProgress({numerator:null!=(P=null==a?void 0:a.progress)?P:0,denominator:o}),A.tempProgress=null!=(I=null==a?void 0:a.progress)?I:0}}).call(function(){C()}).start()})}},{key:"getMissionTypeToSmallBlock",value:function(){return{"pass-levels":this.passLevelsBlock,"use-boosters":this.useBoostersBlock,"collect-tiles":this.collectTilesBlock,"pass-levels-in-a-row":this.passLevelsInARowBlock}}},{key:"close",value:function(){this.bigMissionBlock.stopCountDown()}},{key:"updateMissionLabelBasedOnLocale",value:function(){this.passLevelsBlock.updateMissionLabelBasedOnLocale(),this.useBoostersBlock.updateMissionLabelBasedOnLocale(),this.collectTilesBlock.updateMissionLabelBasedOnLocale(),this.passLevelsInARowBlock.updateMissionLabelBasedOnLocale()}},{key:"setBigMissionBlockPayload",value:function(a){this.bigMissionBlockPayload={progress:{numerator:a.progress.numerator,denominator:a.progress.denominator},check:a.check},this.bigMissionBlock.setPayload(this.bigMissionBlockPayload)}}]),p}(eo)).prototype,"closeButton",[K5,K6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=L(Ys.prototype,"bigMissionBlock",[K7,K8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yc=L(Ys.prototype,"passLevelsBlock",[K9,Ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yh=L(Ys.prototype,"useBoostersBlock",[Yt,Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp=L(Ys.prototype,"collectTilesBlock",[Yi,Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yd=L(Ys.prototype,"passLevelsInARowBlock",[Ya,Yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys))||Ys);U._RF.pop(),U._RF.push({},"aa33fPI1GJGV5uUVh9GS/q4","DailyMissionsScreenDataManager",void 0);var Yw,YS,YT,YC,YA,Y_,YP,YI,YB,YR,YE,YL,YO,YN,YF,YD,YM,Yx,Yz,YG={"pass-levels":"passLevels","use-boosters":"useBoosters","collect-tiles":"collectTiles","pass-levels-in-a-row":"passLevelsInARow"},Yq={undo:"undo","magic-wand":"magicWand",shuffle:"shuffle"},YU=function(){function n(){o(this,n),this.payload={"pass-levels":{progress:{numerator:0,denominator:t9.PASS_LEVELS},reward:{type:"undo",count:1,isClaimed:!1}},"use-boosters":{progress:{numerator:0,denominator:t9.USE_BOOSTERS},reward:{type:"magic-wand",count:1,isClaimed:!1}},"collect-tiles":{progress:{numerator:0,denominator:t9.COLLECT_TILES},reward:{type:"shuffle",count:1,isClaimed:!1}},"pass-levels-in-a-row":{progress:{numerator:0,denominator:t9.PASS_LEVELS_IN_A_ROW},reward:{type:"magic-wand",count:1,isClaimed:!1}}}}return a(n,[{key:"gameDataManager",get:function(){return td.gameScene.gamePlay.gameDataManager}},{key:"updatePayloadFromGameData",value:function(){for(var a=this.gameDataManager.getMultiData(["dailyMissions"]).dailyMissions,o=a.passLevels,C=a.useBoosters,A=a.collectTiles,P=a.passLevelsInARow,I=0,B=[["pass-levels",void 0===o?{count:0,isClaimed:!1}:o],["use-boosters",void 0===C?{count:0,isClaimed:!1}:C],["collect-tiles",void 0===A?{count:0,isClaimed:!1}:A],["pass-levels-in-a-row",void 0===P?{count:0,isClaimed:!1}:P]];I<B.length;I++){var R=z(B[I],2),E=R[0],L=R[1],O=L.count,N=L.isClaimed,F=this.payload[E],D=V.clamp(O,0,F.progress.denominator);F.progress.numerator=D,F.reward.isClaimed=N}}},{key:"getPayload",value:function(){return JSON.parse(JSON.stringify(this.payload))}},{key:"claimReward",value:function(a){this.payload[a].reward.isClaimed=!0}},{key:"updateClaimedMissionToGameData",value:function(a){var o=this.gameDataManager,C=o.getMultiData(["dailyMissions","items"]),A=C.dailyMissions,P=C.items,B=YG[a],R=A[B],E=R.count;if(!R.isClaimed){var L=this.payload[a].reward,O=Yq[L.type];switch(L.type){case"magic-wand":this.sendAnalyticsEvent(tk.MAGIC);break;case"undo":this.sendAnalyticsEvent(tk.UNDO);break;case"shuffle":this.sendAnalyticsEvent(tk.SHUFFLE)}o.setGameData({items:I(I({},P),{},x({},O,P[O]+L.count)),dailyMissions:I(I({},A),{},x({},B,{count:E,isClaimed:!0}))})}}},{key:"areAllMissionsClaimed",value:function(){return Object.values(this.payload).every(function(a){return a.reward.isClaimed})}},{key:"sendAnalyticsEvent",value:function(a){var o=td.gameScene.gamePlay.gameDataManager.getLevel(),C=td.levelManager.getLevel();-1!==tw[a]&&tS({maxPlayerLevel:o,level:C,resourceTransaction:[{resourceTypeName:a,resourceChange:1}],transactionType:"ClaimDailyMission",transactionCount:1})}}]),n}();U._RF.pop(),U._RF.push({},"9e231UXYRpAH6yV2Tkc0Cp6","DailyMissionsScreen",void 0);var YH,YW,YV,YK,YY,Yj,YX,YJ,YZ,YQ,Y$,Y0,Y1,Y2,Y3,Y4,Y5,Y6,Y7,Y8,Y9,je,jt,jn,ji,jr,ja,jo,js,jl=$.ccclass,ju=$.property,jc=GameCore.Events,jh=globalThis.game,jp=jh.event,jd=jh.analytics;Yw=jl("DailyMissionsScreen"),YS=ju(ef),YT=tj.required,YC=ju(ee),YA=tj.required,Y_=ju(Bg),YP=tj.required,YI=tj.required,YB=tj.required,YR=tj.required,YE=tj.required,Yw((YO=L((YL=function(P){C(S,P);var I,R,E,L,F,D,M,x,z,q,U,H,W=A(S);function S(){var a;o(this,S);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=W.call.apply(W,[this].concat(A)),O(a,"touchZone",YO,N(a)),O(a,"popupClickZone",YN,N(a)),O(a,"glowDot",YF,N(a)),O(a,"screen",YD,N(a)),O(a,"uiOpacity",YM,N(a)),O(a,"containerUIOpacity",Yx,N(a)),O(a,"dailyMissionContainer",Yz,N(a)),a.dataManager=new YU,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("DailyMissionsScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},a.prepareOpen())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(S,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.uiOpacity=this.getComponent(ea);var a=this.screen.container;this.containerUIOpacity=a.getComponent(ea),this.dailyMissionContainer=a.getComponent(Yk),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,S)}},{key:"onLoad",value:function(){this.registryEvents(),this.updateContainerWidget()}},{key:"registryEvents",value:function(){var a=this,o=this.touchZone,C=this.dailyMissionContainer;o.node.on(ee.EventType.TOUCH_END,this.handleCancelBtnClickForTouchZone,this),C.onClickCloseButton=function(){a.handleClickCloseButton()},C.onClickButtons={passLevelsBlock:{goButton:function(){return a.handleClickGoButton("pass-levels")},claimButton:function(){return a.handleClaimMission("pass-levels")}},useBoostersBlock:{goButton:function(){return a.handleClickGoButton("use-boosters")},claimButton:function(){return a.handleClaimMission("use-boosters")}},collectTilesBlock:{goButton:function(){return a.handleClickGoButton("collect-tiles")},claimButton:function(){return a.handleClaimMission("collect-tiles")}},passLevelsInARowBlock:{goButton:function(){return a.handleClickGoButton("pass-levels-in-a-row")},claimButton:function(){return a.handleClaimMission("pass-levels-in-a-row")}}}}},{key:"handleClickCloseButton",value:(H=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,t_.closeScreenAsync(tP.DAILY_MISSIONS_SCREEN)];case 1:return a.sent(),[4,Promise.all([this.fadeInDashboard(),td.gameScene.rubyBarComp.runShowAnimationAsync()])];case 2:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return H.apply(this,arguments)})},{key:"updateContainerWidget",value:function(){try{var a=tf.getBannerAdWorldHeight();if(a<=0)return;var o=this.dailyMissionContainer.getComponent(eX);if(!o)return;o.bottom+=a,o.updateAlignment()}catch(a){return}}},{key:"listenScreenEvents",value:function(){jp.on(jc.OPENING_SCREEN,this.handleOpeningScreen),jp.on(jc.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){jp.off(jc.OPENING_SCREEN,this.handleOpeningScreen),jp.off(jc.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"prepareOpen",value:function(){var a=this.dataManager;this.tryToResetDailyMissionsGameData(),a.updatePayloadFromGameData();var o=a.getPayload();this.screen.container.scale=new ei(.5,.5),this.uiOpacity.opacity=0,this.containerUIOpacity.opacity=255,this.dailyMissionContainer.prepareOpen(o),this.glowDot.prepareGlow()}},{key:"open",value:(U=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.enabled)return[3,2];return th.playSound(tZ.POPUP_SHOW),this.glowDot.runGlow(),[4,this.fadeIn()];case 1:a.sent(),jp.emit(jc.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),jp.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),a.label=2;case 2:return[2]}})}),function(){return U.apply(this,arguments)})},{key:"close",value:(q=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.fadeOut()];case 1:return a.sent(),this.glowDot.stopGlow(),this.dailyMissionContainer.close(),this.tryToResetDailyMissionsGameData(),this.node.active=!1,jp.emit(jc.CLOSED_SCREEN,{screenName:this.node.name}),jp.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return q.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"handleCancelBtnClickForTouchZone",value:function(a){var o=a.getUILocation();tc.getBoundingBoxToWorld(this.popupClickZone).contains(o)||(this.handleClickCloseButton(),jd.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:aP[this.touchZone.node.name],screen_name:tp.getCurrentPage()}))}},{key:"handleClickGoButton",value:(z=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(C=(o=td.gameScene).uiManager.getDashboardScreen(),!(A=this.screen.data.level))return[3,3];return jd.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:"".concat(aP.GoButton,"_").concat(a.toUpperCase()),screen_name:tp.getCurrentPage()}),o.toggleBlockInputContainer(!0),[4,t_.closeScreenAsync(tP.DAILY_MISSIONS_SCREEN)];case 1:return P.sent(),[4,null==C?void 0:C.handleClickPlayGame(A)];case 2:P.sent(),o.toggleBlockInputContainer(!1),P.label=3;case 3:return[2]}})}),function(a){return z.apply(this,arguments)})},{key:"handleClaimMission",value:(x=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return o=this.dailyMissionContainer,C=this.dataManager,jd.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:"".concat(aP.ClaimButton,"_").concat(a.toUpperCase()),screen_name:tp.getCurrentPage()}),[4,Promise.all([o.runClaimAnimation(a),o.runClaimSubMissionAnimation()])];case 1:if(A.sent(),C.claimReward(a),C.updateClaimedMissionToGameData(a),!C.areAllMissionsClaimed())return[3,3];return[4,o.runAllDailyTasksCompletedAnimation()];case 2:A.sent(),A.label=3;case 3:return[2]}})}),function(a){return x.apply(this,arguments)})},{key:"fadeIn",value:(M=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.runScreenEntranceAnimation(),this.runPopupEntranceAnimation()])]})}),function(){return M.apply(this,arguments)})},{key:"runScreenEntranceAnimation",value:(D=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.uiOpacity).to(.25,{opacity:255}),[2,ts.runTweenAsync(a)]})}),function(){return D.apply(this,arguments)})},{key:"runPopupEntranceAnimation",value:(F=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.screen.container).to(.3,{scale:ei.ONE},{easing:"backOut"}),[2,ts.runTweenAsync(a)]})}),function(){return F.apply(this,arguments)})},{key:"fadeOut",value:(L=B(function(){return _ts_generator(this,function(a){return[2,(th.playSound(tZ.POPUP_OFF),Promise.all([this.runScreenExitAnimation(),this.runPopupExitAnimation()]))]})}),function(){return L.apply(this,arguments)})},{key:"runPopupExitAnimation",value:(E=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.screen.container).to(.3,{scale:new ei(.5,.5)},{easing:"backIn"}),[2,ts.runTweenAsync(a)]})}),function(){return E.apply(this,arguments)})},{key:"runScreenExitAnimation",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.uiOpacity).to(.25,{opacity:0}),[2,ts.runTweenAsync(a)]})}),function(){return R.apply(this,arguments)})},{key:"tryToResetDailyMissionsGameData",value:function(){td.gameScene.gamePlay.gameDataManager.tryToResetDailyMissionsGameData()}},{key:"fadeInDashboard",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.node.scene.once(t2.FADED_IN_DASHBOARD_DONE,o),td.gameScene.uiManager.handleScreenReturn()})]})}),function(){return I.apply(this,arguments)})},{key:"getDailyMissionContainer",value:function(){return this.dailyMissionContainer}},{key:"getDataManager",value:function(){return this.dataManager}}]),S}(eo)).prototype,"touchZone",[YS,YT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YN=L(YL.prototype,"popupClickZone",[YC,YA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YF=L(YL.prototype,"glowDot",[Y_,YP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YD=L(YL.prototype,"screen",[YI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YM=L(YL.prototype,"uiOpacity",[YB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yx=L(YL.prototype,"containerUIOpacity",[YR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yz=L(YL.prototype,"dailyMissionContainer",[YE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YL)),U._RF.pop(),U._RF.push({},"1a312n0ddVBj4c7lFiKnJU9","OpenableGift",void 0);var jf,jy,jv,jm,jg,jb,jk=$.ccclass,jw=$.property,jS=(YH=jk("OpenableGift"),YW=jw(ee),YV=tj.required,YK=jw(W),YY=tj.required,Yj=tj.required,YX=jw(W),YJ=tj.required,YZ=tj.required,YQ=jw(W),Y$=tj.required,Y0=tj.required,Y1=jw(et),Y2=tj.required(ni(et)),Y3=jw(et),Y4=tj.required(ni(et)),Y5=jw(pj),Y6=tj.required,YH((Y8=L((Y7=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"giftNode",Y8,N(a)),O(a,"giftTop",Y9,N(a)),O(a,"giftTopOpacity",je,N(a)),O(a,"giftBottom",jt,N(a)),O(a,"giftBottomOpacity",jn,N(a)),O(a,"glow",ji,N(a)),O(a,"glowOpacity",jr,N(a)),O(a,"giftTopSpriteFrames",ja,N(a)),O(a,"giftBottomSpriteFrames",jo,N(a)),O(a,"shootingWhiteStarEffect",js,N(a)),a.giftNodeBasePosition=void 0,a.giftTopBasePosition=void 0,a.giftBottomBasePosition=void 0,a}return a(s,[{key:"onLoad",value:function(){this.giftNodeBasePosition={x:this.giftNode.position.x,y:this.giftNode.position.y},this.giftTopBasePosition={x:this.giftTop.node.position.x,y:this.giftTop.node.position.y},this.giftBottomBasePosition={x:this.giftBottom.node.position.x,y:this.giftBottom.node.position.y},this.glowOpacity=this.glow.getComponent(ea),this.giftTopOpacity=this.giftTop.getComponent(ea),this.giftBottomOpacity=this.giftBottom.getComponent(ea),this.reset(),tj.validateRequiredProperties(this,s)}},{key:"hide",value:function(){this.giftBottomOpacity.opacity=0,this.giftTopOpacity.opacity=0,this.glowOpacity.opacity=0}},{key:"prepareAnim",value:function(){if(this.giftTopOpacity.opacity=255,this.giftBottomOpacity.opacity=255,this.giftNodeBasePosition&&this.giftTopBasePosition&&this.giftBottomBasePosition){var a=this.giftNodeBasePosition,o=a.x,C=a.y,A=this.giftTopBasePosition,P=A.x,I=A.y,B=this.giftBottomBasePosition,R=B.x,E=B.y;this.giftNode.setPosition(new ei(o,C,0)),this.giftTop.node.setPosition(new ei(P,I,0)),this.giftTop.node.angle=0,this.giftBottom.node.setPosition(new ei(R,E,0)),this.giftBottom.node.angle=0}}},{key:"runGiftAnimation",value:(I=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:return this.updateGiftSprite(a),this.reset(),[4,this.runOpenGiftAnimation(o)];case 1:return C.sent(),[2]}})}),function(a,o){return I.apply(this,arguments)})},{key:"runOpenGiftAnimation",value:function(a){var o=this;if(!this.giftTopBasePosition||!this.giftBottomBasePosition)return Promise.resolve();var C=this.giftTopBasePosition,A=C.x,P=C.y,I=this.giftBottomBasePosition,B=I.x,R=I.y;return this.giftTop.node.setPosition(new ei(A,P,0)),this.giftBottom.node.setPosition(new ei(B,R,0)),this.shootingWhiteStarEffect.play(),th.playSound(tZ.GIFT_OPEN,{volume:.5}),new Promise(function(C){var I=Y().to(.25,{opacity:255});o.scheduleOnce(function(){Y(o.glowOpacity).then(I).start(),a(),C()},.25);var B={value:0},R=Q(A,P,0),E=Q(230,600,0),L=Q(500,300,0);Y(B).to(.75,{value:1},{easing:"sineInOut",onUpdate:function(){var a=B.value,C=1-a,A=C*C*R.x+2*C*a*E.x+a*a*L.x,P=C*C*R.y+2*C*a*E.y+a*a*L.y;o.giftTop.node.setPosition(A,P,0)}}).start(),Y(o.giftTop.node).to(.75,{angle:-135}).start(),Y(o.giftTopOpacity).to(.5,{opacity:255}).to(.25,{opacity:0}).start(),Y(o.giftBottomOpacity).to(.5,{opacity:255}).to(.5,{opacity:0}).start(),Y(o.glowOpacity).to(.5,{opacity:255}).to(.5,{opacity:0}).start()})}},{key:"reset",value:function(){this.giftNodeBasePosition&&this.giftTopBasePosition&&this.giftBottomBasePosition&&(this.giftNode.setPosition(new ei(this.giftNodeBasePosition.x,this.giftNodeBasePosition.y,0)),this.giftTop.node.setPosition(new ei(this.giftTopBasePosition.x,this.giftTopBasePosition.y,0)),this.giftBottom.node.setPosition(new ei(this.giftBottomBasePosition.x,this.giftBottomBasePosition.y,0)),this.glowOpacity.opacity=0,this.giftTopOpacity.opacity=255,this.giftBottomOpacity.opacity=255,this.giftTop.node.angle=0)}},{key:"updateGiftSprite",value:function(a){a<0||a>=this.giftTopSpriteFrames.length||(this.giftTop.spriteFrame=this.giftTopSpriteFrames[a],this.giftBottom.spriteFrame=this.giftBottomSpriteFrames[a])}}]),s}(eo)).prototype,"giftNode",[YW,YV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y9=L(Y7.prototype,"giftTop",[YK,YY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),je=L(Y7.prototype,"giftTopOpacity",[Yj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt=L(Y7.prototype,"giftBottom",[YX,YJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jn=L(Y7.prototype,"giftBottomOpacity",[YZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ji=L(Y7.prototype,"glow",[YQ,Y$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jr=L(Y7.prototype,"glowOpacity",[Y0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ja=L(Y7.prototype,"giftTopSpriteFrames",[Y1,Y2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jo=L(Y7.prototype,"giftBottomSpriteFrames",[Y3,Y4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),js=L(Y7.prototype,"shootingWhiteStarEffect",[Y5,Y6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y7))||Y7);U._RF.pop(),U._RF.push({},"d9f22/vYphES5JqexxDpR43","RewardItem",void 0);var jT,jC,jA,j_,jP,jI,jB=$.ccclass,jR=$.property,jE=(jf=jB("RewardItem"),jy=jR(W),jv=jR(er),jf((jg=L((jm=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"itemSprite",jg,N(a)),O(a,"amountLabel",jb,N(a)),a.originalPosition=void 0,a}return a(s,[{key:"getOriginalPosition",value:function(){return this.originalPosition}},{key:"__preload",value:function(){this.originalPosition=this.node.position.clone()}},{key:"setRewardItem",value:function(a,o){this.itemSprite.spriteFrame=a,this.amountLabel.string="x".concat(o.toString())}},{key:"playAppearAnim",value:(I=B(function(a,o){var C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:if(!this.originalPosition)return[3,2];return this.node.position=this.originalPosition.clone(),this.node.scale=new ei(.2,.2,.2),C=Y(this.node).to(.46,{position:Q(a,o,0)},{easing:"cubicOut"}),A=Y(this.node).to(.22,{scale:new ei(1.2,1.2,1.2)},{easing:"cubicOut"}),P=Y(this.node).to(.2,{scale:new ei(1,1,1)},{easing:"cubicOut"}),I=Y(this.node).sequence(A,P),[4,Promise.all([ts.runTweenAsync(C),ts.runTweenAsync(I)])];case 1:B.sent(),B.label=2;case 2:return[2]}})}),function(a,o){return I.apply(this,arguments)})}]),s}(eo)).prototype,"itemSprite",[jy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jb=L(jm.prototype,"amountLabel",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jm))||jm);U._RF.pop(),U._RF.push({},"d8c7elO0Z5KcJjkOLt6IsLl","RewardItemController",void 0);var jL,jO,jN,jF,jD,jM,jx,jz,jG,jq,jU,jH,jW,jV,jK,jY,jj,jX,jZ,jQ,j$,j0,j1,j2,j3,j4,j5,j6,j7,j8,j9,Xe,Xt,Xn=$.ccclass,Xi=$.property,Xr=(jT=Xn("RewardItemController"),jC=Xi(eY),jA=Xi([et]),jT((jP=L((j_=function(P){C(u,P);var I,R=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"rewardItemPrefab",jP,N(a)),O(a,"itemSpriteFrames",jI,N(a)),a.rewardItems=[],a}return a(u,[{key:"releaseAllRewardItem",value:function(){var a,o=E(this.rewardItems);try{for(o.s();!(a=o.n()).done;)a.value.active=!1}catch(a){o.e(a)}finally{o.f()}}},{key:"runRewardItemAnimation",value:(I=B(function(a){var o,C,A,P,I,B,R,L,O,N,F,D;return _ts_generator(this,function(M){switch(M.label){case 0:A=-(C=a.length-1)/2*300,P=[],I=E(a);try{for(I.s();!(o=I.n()).done;)if(B=o.value,R=this.getAvailableItem(),this.setItemSprite(R,B.name,B.count),L=R.getComponent(jE)){if(O=L.getOriginalPosition())N=O.y,F=300*C+A,D=N+350,P.push(L.playAppearAnim(F,D)),C--}}catch(a){I.e(a)}finally{I.f()}return[4,Promise.all(P)];case 1:return M.sent(),[2]}})}),function(a){return I.apply(this,arguments)})},{key:"getAvailableItem",value:function(){var a,o=E(this.rewardItems);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.active)return C.active=!0,C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.rewardItemPrefab);return A.setParent(this.node),this.rewardItems.push(A),A}},{key:"setItemSprite",value:function(a,o,C){var A=a.getComponent(jE);A&&(o===tk.SHUFFLE?A.setRewardItem(this.itemSpriteFrames[0],C):o===tk.UNDO?A.setRewardItem(this.itemSpriteFrames[1],C):o===tk.MAGIC&&A.setRewardItem(this.itemSpriteFrames[2],C))}}]),u}(eo)).prototype,"rewardItemPrefab",[jC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jI=L(j_.prototype,"itemSpriteFrames",[jA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j_))||j_);U._RF.pop(),U._RF.push({},"e4fe1PXlDpD2IlCxF3MrEBB","ContainerDailyReward",void 0);var Xa,Xo,Xs,Xl,Xu,Xc,Xh,Xp,Xd,Xf,Xy,Xv,Xm=$.ccclass,Xg=$.property,Xb=Q(-18.421,19.81,0),Xk=(jL=Xm("ContainerDailyReward"),jO=Xg(ee),jN=tj.required,jF=Xg(ee),jD=tj.required,jM=Xg(ef),jx=tj.required,jz=Xg(ef),jG=tj.required,jq=Xg(ef),jU=tj.required,jH=Xg([eV]),jW=tj.required(ni(eV)),jV=Xg(jS),jK=tj.required,jY=Xg(Xr),jj=tj.required,jX=Xg(ef),jZ=tj.required,jQ=tj.required,j$=tj.required,jL((j1=L((j0=function(P){C(S,P);var I,R,L,F,D,M,x,z,q,U,H,W=A(S);function S(){var a;o(this,S);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=W.call.apply(W,[this].concat(A)),O(a,"dailyGift",j1,N(a)),O(a,"pickYourDailyGift",j2,N(a)),O(a,"firstGift",j3,N(a)),O(a,"secondGift",j4,N(a)),O(a,"thirdGift",j5,N(a)),O(a,"emitWhiteStarEffects",j6,N(a)),O(a,"gift",j7,N(a)),O(a,"rewardItemController",j8,N(a)),O(a,"collectButton",j9,N(a)),O(a,"uiOpacity",Xe,N(a)),O(a,"containerWidget",Xt,N(a)),a.originalDailyGiftPos=void 0,a.originalPickGiftPos=void 0,a.gifts=[],a.originalGiftPositions=[],a.handleViewResized=function(){a.containerWidget.updateAlignment()},a}return a(S,[{key:"onClickFirstGift",set:function(a){this.firstGift.node.on(ef.EventType.CLICK,a)}},{key:"onClickSecondGift",set:function(a){this.secondGift.node.on(ef.EventType.CLICK,a)}},{key:"onClickThirdGift",set:function(a){this.thirdGift.node.on(ef.EventType.CLICK,a)}},{key:"onClickCollectButton",set:function(a){this.collectButton.node.on(ef.EventType.CLICK,a)}},{key:"__preload",value:function(){this.initComponents(),this.initData(),this.listenGameEvents()}},{key:"initComponents",value:function(){this.uiOpacity=this.getComponent(ea),this.containerWidget=this.getComponent(eX),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,S)}},{key:"initData",value:function(){this.originalDailyGiftPos=this.dailyGift.position.clone(),this.originalPickGiftPos=this.pickYourDailyGift.position.clone(),this.gifts.push(this.firstGift.node),this.gifts.push(this.secondGift.node),this.gifts.push(this.thirdGift.node),this.originalGiftPositions.push(this.firstGift.node.position.clone()),this.originalGiftPositions.push(this.secondGift.node.position.clone()),this.originalGiftPositions.push(this.thirdGift.node.position.clone()),this.firstGift.node.scale=ei.ZERO,this.secondGift.node.scale=ei.ZERO,this.thirdGift.node.scale=ei.ZERO}},{key:"listenGameEvents",value:function(){nr.isPortrait()||ep.on(tl.VIEW_RESIZED,this.handleViewResized,this)}},{key:"onLoad",value:function(){var a=this.containerWidget;try{var o=tf.getBannerAdWorldHeight();if(o<=0)return;a.bottom+=o,a.updateAlignment()}catch(a){return}}},{key:"reset",value:function(){this.rewardItemController.releaseAllRewardItem()}},{key:"prepareAnim",value:function(){this.uiOpacity.opacity=0,this.gift.hide();for(var a=0;a<this.gifts.length;a++){var o=this.gifts[a],C=this.originalGiftPositions[a],A=C.x,P=C.y,I=C.z;o.setScale(0,0,0),o.setPosition(A,P,I),o.active=!0}if(this.playWhiteStarGiftEffects(),this.collectButton.node.setScale(0,0,0),this.originalDailyGiftPos&&this.originalPickGiftPos){var B=this.originalDailyGiftPos,R=B.x,E=B.y,L=B.z,O=this.originalPickGiftPos,N=O.x,F=O.y,D=O.z;this.dailyGift.scale=ei.ZERO,this.dailyGift.setPosition(R,E-200,L),this.pickYourDailyGift.scale=ei.ZERO,this.pickYourDailyGift.setPosition(N,F-200,D)}}},{key:"playWhiteStarGiftEffects",value:function(){var a,o=E(this.emitWhiteStarEffects);try{for(o.s();!(a=o.n()).done;)a.value.resetSystem()}catch(a){o.e(a)}finally{o.f()}}},{key:"fadeIn",value:(H=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.uiOpacity).to(.3,{opacity:255}),[4,Promise.all([ts.runTweenAsync(a),this.fadeInHeader(),this.fadeInGifts()])];case 1:return o.sent(),[2]}})}),function(){return H.apply(this,arguments)})},{key:"fadeInHeader",value:(U=B(function(){var a,o,C,A,P,I,B,R,E,L;return _ts_generator(this,function(O){switch(O.label){case 0:if(!(this.originalPickGiftPos&&this.originalDailyGiftPos))return[3,2];return o=(a=this.originalDailyGiftPos).x,C=a.y,A=a.z,I=(P=this.originalPickGiftPos).x,B=P.y,R=P.z,E=Y(this.dailyGift).to(.45,{position:Q(o,C,A),scale:ei.ONE},{easing:"backOut"}),L=Y(this.pickYourDailyGift).to(.45,{position:Q(I,B,R),scale:ei.ONE},{easing:"backOut"}),[4,Promise.all([ts.runTweenAsync(E),ts.runTweenAsync(L)])];case 1:O.sent(),O.label=2;case 2:return[2]}})}),function(){return U.apply(this,arguments)})},{key:"fadeInGifts",value:(q=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:o=[],C=E(this.gifts);try{for(C.s();!(a=C.n()).done;)A=a.value,o.push(this.fadeInGift(A))}catch(a){C.e(a)}finally{C.f()}return[4,Promise.all(o)];case 1:return P.sent(),[2]}})}),function(){return q.apply(this,arguments)})},{key:"fadeInGift",value:(z=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=Y(a).to(.3,{scale:ei.ONE},{easing:"backOut"}),[4,ts.runTweenAsync(o)];case 1:return C.sent(),[2]}})}),function(a){return z.apply(this,arguments)})},{key:"playOpenGiftAnim",value:(x=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return o=this,C=a.giftId,A=a.items,this.stopWhiteStarEffects(),[4,Promise.all([this.fadeOutLeftGiftsAnim(C),this.moveGiftToCenterAnim(C)])];case 1:return P.sent(),[4,this.runShakeAnimation(C)];case 2:return P.sent(),[4,this.moveGiftDownAnim(C)];case 3:return P.sent(),this.gift.prepareAnim(),[4,this.gift.runGiftAnimation(C,B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.gamePlay.vibrate.vibrate(50),[4,o.rewardItemController.runRewardItemAnimation(A)];case 1:return a.sent(),[4,o.fadeInFooter()];case 2:return a.sent(),[2]}})}))];case 4:return P.sent(),[2]}})}),function(a){return x.apply(this,arguments)})},{key:"stopWhiteStarEffects",value:function(){var a,o=E(this.emitWhiteStarEffects);try{for(o.s();!(a=o.n()).done;)a.value.stopSystem()}catch(a){o.e(a)}finally{o.f()}}},{key:"runShakeAnimation",value:(M=B(function(a){var o;return _ts_generator(this,function(C){return th.playSound(tZ.GIFT_SHAKE,{volume:.35}),o=this.gifts[a],[2,new Promise(function(a){var C=Y().by(.125,{angle:15}).by(.125,{angle:-30}).by(.125,{angle:30}).by(.125,{angle:-15}).by(.125,{angle:0});Y(o).then(C).call(function(){a()}).start()})]})}),function(a){return M.apply(this,arguments)})},{key:"fadeOutLeftGiftsAnim",value:(D=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:for(o=[],C=0;C<this.gifts.length;C++)A=this.gifts[C],C!==a&&o.push(this.fadeOutGiftAnim(A));return[4,Promise.all(o)];case 1:return P.sent(),[2]}})}),function(a){return D.apply(this,arguments)})},{key:"fadeOutGiftAnim",value:(F=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=Y(a).to(.3,{scale:ei.ZERO},{easing:"sineInOut"}),[4,ts.runTweenAsync(o)];case 1:return C.sent(),a.active=!1,[2]}})}),function(a){return F.apply(this,arguments)})},{key:"moveGiftToCenterAnim",value:(L=B(function(a){var o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return o=Xb.x,C=Xb.y,A=Xb.z,P=this.gifts[a],I=Y(P).to(.3,{position:new ei(o,C,A)},{easing:"sineInOut"}),[4,ts.runTweenAsync(I)];case 1:return B.sent(),[2]}})}),function(a){return L.apply(this,arguments)})},{key:"moveGiftDownAnim",value:(R=B(function(a){var o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return o=Xb.x,C=Xb.y,A=Xb.z,P=this.gifts[a],I=Y(P).to(.3,{position:new ei(o,C-200,A)},{easing:"sineInOut"}),[4,ts.runTweenAsync(I)];case 1:return B.sent(),P.active=!1,[2]}})}),function(a){return R.apply(this,arguments)})},{key:"fadeInFooter",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.collectButton.node).to(.45,{scale:ei.ONE},{easing:"backOut"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),S}(eo)).prototype,"dailyGift",[jO,jN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j2=L(j0.prototype,"pickYourDailyGift",[jF,jD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j3=L(j0.prototype,"firstGift",[jM,jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j4=L(j0.prototype,"secondGift",[jz,jG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j5=L(j0.prototype,"thirdGift",[jq,jU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j6=L(j0.prototype,"emitWhiteStarEffects",[jH,jW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j7=L(j0.prototype,"gift",[jV,jK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j8=L(j0.prototype,"rewardItemController",[jY,jj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j9=L(j0.prototype,"collectButton",[jX,jZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe=L(j0.prototype,"uiOpacity",[jQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=L(j0.prototype,"containerWidget",[j$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j0))||j0);U._RF.pop(),U._RF.push({},"c8c4e044IBNp4g0/R+OFrGK","DailyRewardScreen",void 0);var Xw,XS=$.ccclass,XT=$.property,XC=$.disallowMultiple,XA=$.requireComponent,X_=GameCore.Events,XP=globalThis.game.event;Xa=XS("DailyRewardScreen"),Xo=XA(Bi),Xs=XT(Xk),Xl=tj.required,Xu=XT(W),Xc=tj.required,Xh=tj.required,Xa(Xp=XC(Xp=Xo((Xf=L((Xd=function(P){C(v,P);var I,R,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"container",Xf,N(a)),O(a,"background",Xy,N(a)),O(a,"screen",Xv,N(a)),a.items=[],a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("DailyRewardScreen: screen not found");a.validateEventPayload(o)&&a.prepareScreen()},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(v,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,v)}},{key:"listenScreenEvents",value:function(){XP.on(X_.OPENING_SCREEN,this.handleOpeningScreen),XP.on(X_.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"unListenScreenEvents",value:function(){XP.off(X_.OPENING_SCREEN,this.handleOpeningScreen),XP.off(X_.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"onLoad",value:function(){this.registerEvents()}},{key:"registerEvents",value:function(){var a=this;this.container.onClickFirstGift=function(){a.handleClaimReward(0)},this.container.onClickSecondGift=function(){a.handleClaimReward(1)},this.container.onClickThirdGift=function(){a.handleClaimReward(2)},this.container.onClickCollectButton=function(){a.handleClickCollectButton()}}},{key:"handleClaimReward",value:(M=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:if(td.gameScene.toggleBlockInputContainer(!0),!(o=t8.getDailyReward()))return[3,2];switch(this.items.length=0,o.type){case"shuffle":this.items.push({name:tk.SHUFFLE,count:o.value});break;case"undo":this.items.push({name:tk.UNDO,count:o.value});break;case"magic":this.items.push({name:tk.MAGIC,count:o.value});break;default:return[2,void 0]}return[4,this.container.playOpenGiftAnim({giftId:a,items:this.items})];case 1:C.sent(),td.gameScene.toggleBlockInputContainer(!1),C.label=2;case 2:return[2]}})}),function(a){return M.apply(this,arguments)})},{key:"handleClickCollectButton",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),this.storeItemsToGameData(1),t8.logLoginReward(),[4,t_.closeScreenAsync(tP.DAILY_REWARD_SCREEN)];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return D.apply(this,arguments)})},{key:"storeItemsToGameData",value:function(a){var o=td.gameScene.gamePlay.gameDataManager.getItems(),C=this.getItemCount(tk.UNDO)*a,A=this.getItemCount(tk.MAGIC)*a,P=this.getItemCount(tk.SHUFFLE)*a;this.sendAnalytics({undo:C,magicWand:A,shuffle:P}),td.gameScene.gamePlay.gameDataManager.setGameData({items:{undo:o.undo+C,return:o.return,shuffle:o.shuffle+P,extraSlot:o.extraSlot,magicWand:o.magicWand+A}})}},{key:"getItemCount",value:function(a){var o,C=E(this.items);try{for(C.s();!(o=C.n()).done;){var A=o.value;if(A.name===a)return A.count}}catch(a){C.e(a)}finally{C.f()}return 0}},{key:"sendAnalytics",value:function(a){for(var o=a.undo,C=a.magicWand,A=a.shuffle,P=[],I=td.gameScene.gamePlay.gameDataManager.getLevel(),B=0,R=[{typeName:tk.MAGIC,amount:C},{typeName:tk.UNDO,amount:o},{typeName:tk.SHUFFLE,amount:A}];B<R.length;B++){var E=R[B],L=E.typeName,O=E.amount;O>0&&P.push({resourceTypeName:L,resourceChange:O})}tS({maxPlayerLevel:I,resourceTransaction:P,transactionCount:1,transactionType:"daily_reward"})}},{key:"fadeOutScreen",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(a=this.node.getComponent(ea)))return[3,2];return o=Y(a).to(.24,{opacity:0}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"prepareScreen",value:function(){this.prepareBackground(),this.container.prepareAnim()}},{key:"prepareBackground",value:function(){this.background.spriteFrame=td.gameScene.background.getCurrentLevelGameBg(),this.resizeGamePlayBg()}},{key:"resizeGamePlayBg",value:function(){if(!nr.isPortrait()){var a=td.gameScene.background.getUITransform();if(a){var o=this.background.getComponent(en);if(o){var C=a.width,A=a.height;o.setContentSize(C,A)}}}}},{key:"open",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.enabled)return[3,2];return[4,Promise.all([this.fadeInScreen(),this.container.fadeIn()])];case 1:a.sent(),XP.emit(X_.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),XP.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),a.label=2;case 2:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"fadeInScreen",value:(R=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(a=this.node.getComponent(ea)))return[3,2];return o=Y(a).to(.24,{opacity:255}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"close",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([td.gameScene.uiManager.openDashboardScreenAsync(),this.fadeOutScreen()])];case 1:return a.sent(),this.container.reset(),this.node.active=!1,XP.emit(X_.CLOSED_SCREEN,{screenName:this.node.name}),XP.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return I.apply(this,arguments)})},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}}]),v}(eo)).prototype,"container",[Xs,Xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xy=L(Xd.prototype,"background",[Xu,Xc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv=L(Xd.prototype,"screen",[Xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=Xd))||Xp)||Xp),U._RF.pop(),U._RF.push({},"3eb49ayI8FDv4gY8oro3pUo","HoverenableGift",void 0),(0,$.ccclass)("HoverenableGift")(((Xw=function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"__preload",value:function(){this.node.on(rp,this.onMouseEnter,this),this.node.on(rd,this.onMouseLeave,this),this.node.on(rf,this.onMouseClick,this),this.node.on(rv,this.onMouseRelease,this),this.node.on(rm,this.onMouseRelease,this)}},{key:"onMouseEnter",value:function(){r.isHoverDisabled||Y(this.node).to(.15,{scale:Q(1.15,1.15,1.15)}).start()}},{key:"onMouseLeave",value:function(){r.isHoverDisabled||Y(this.node).to(.15,{scale:Q(1,1,1)}).start()}},{key:"onMouseClick",value:function(){r.isHoverDisabled=!0,Y(this.node).to(.1,{scale:Q(.9,.9,.9)}).start()}},{key:"onMouseRelease",value:function(){r.isHoverDisabled=!1,Y(this.node).to(.1,{scale:Q(1,1,1)}).start()}}]),r}(eo)).isHoverDisabled=!1,Xw)),U._RF.pop(),U._RF.push({},"ddaa0h4ZvBGuaKlaRx9oLrQ","FinishTournamentInfoScreen",void 0);var XI,XB,XR,XE,XL,XO,XN,XF,XD,XM,Xx,Xz,XG,Xq,XU,XH,XW,XV,XK,XY,Xj,XX,XJ,XZ,XQ,X$,X0,X1,X2,X3,X4,X5,X6,X7,X8,X9,Je,Jt,Jn,Ji,Jr,Ja,Jo,Js,Jl,Ju,Jc,Jh,Jp,Jd,Jf=$.ccclass,Jy=$.property,Jv=GameCore.Events,Jm=globalThis.game.event;XI=Jf("FinishTournamentInfoScreen"),XB=Jy(ef),XR=tj.required,XE=Jy(ef),XL=tj.required,XO=Jy(ee),XN=tj.required,XF=Jy(er),XD=tj.required,XM=Jy(er),Xx=tj.required,Xz=Jy(nt),XG=tj.required,Xq=tj.required,XI((XH=L((XU=function(P){C(y,P);var I,R,E,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"transitionBtn",XH,N(a)),O(a,"closeBtn",XW,N(a)),O(a,"popupContainer",XV,N(a)),O(a,"descriptionLabel",XK,N(a)),O(a,"transitionBtnText",XY,N(a)),O(a,"glowDot",Xj,N(a)),O(a,"screen",XX,N(a)),a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("FinishTournamentInfoScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{})},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(y,[{key:"__preload",value:function(){this.listenScreenEvents(),this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.registryButtonEvents(),this.popupContainer.scale=new ei(0,0,0)}},{key:"onLoad",value:function(){this.updateContainerWidget()}},{key:"updateContainerWidget",value:function(){try{var a=tf.getBannerAdWorldHeight();if(a<=0)return;var o=this.popupContainer.getComponent(eX);if(!o)return;o.bottom+=a,o.updateAlignment()}catch(a){return}}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"start",value:function(){var a=this.popupContainer.getComponent(ea);a&&(a.opacity=255)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,y)}},{key:"listenScreenEvents",value:function(){Jm.on(Jv.OPENING_SCREEN,this.handleOpeningScreen),Jm.on(Jv.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Jm.off(Jv.OPENING_SCREEN,this.handleOpeningScreen),Jm.off(Jv.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"registryButtonEvents",value:function(){this.transitionBtn.node.on(ef.EventType.CLICK,this.handleTransitionClick,this),this.closeBtn.node.on(ef.EventType.CLICK,this.handleTransitionClick,this)}},{key:"open",value:(F=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return(o=this.glowDot).prepareGlow(),A=void 0===(C=this.screen.data.playerRank)?0:C,P=null==(a=eh.getScene())?void 0:a.getComponentInChildren("DashboardScreen"),[4,Promise.all([td.gameScene.rubyBarComp.runHideAnimationAsync(),P.fadeOutContainer()])];case 1:return I.sent(),o.runGlow(),this.setTextBasedOnRank(A),[4,this.tweenScaleUpPopup()];case 2:return I.sent(),Jm.emit(Jv.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),Jm.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return F.apply(this,arguments)})},{key:"close",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.POPUP_OFF),this.glowDot.stopGlow(),[4,this.tweenScaleDownPopup()];case 1:return a.sent(),this.node.active=!1,Jm.emit(Jv.CLOSED_SCREEN,{screenName:this.node.name}),Jm.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return L.apply(this,arguments)})},{key:"tweenScaleUpPopup",value:(E=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.screen.runAnimation("OpenScreen"),Y(a.popupContainer).to(.2,{scale:new ei(1,1,1)},{easing:"backOut"}).call(function(){o()}).start()})]})}),function(){return E.apply(this,arguments)})},{key:"tweenScaleDownPopup",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.screen.runAnimation("CloseScreen"),Y(a.popupContainer).to(.2,{scale:new ei(0,0,0)},{easing:"sineIn"}).call(function(){o()}).start()})]})}),function(){return R.apply(this,arguments)})},{key:"handleTransitionClick",value:(I=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:if(o=(a=this.screen.data).leaderboardId,C=a.playerRank,!!o)return[3,3];return P=null==(A=eh.getScene())?void 0:A.getComponentInChildren("DashboardScreen"),td.gameScene.showLoadingScreen(0,t7.LOADING,!0),[4,td.gameScene.tournament.tryToPlayNewTournament()];case 1:return B.sent(),td.gameScene.closeLoadingScreen(),[4,Promise.all([t_.closeScreenAsync(tP.FINISH_TOURNAMENT_INFO_SCREEN),td.gameScene.rubyBarComp.runShowAnimationAsync(),P.playFadeInButtons()])];case 2:return[2,void B.sent()];case 3:return[4,t_.closeScreenAsync(tP.FINISH_TOURNAMENT_INFO_SCREEN)];case 4:return B.sent(),[4,to.loadPrefabAsync("screens/".concat(tO[tP.LEADERBOARD_SCREEN]))];case 5:return B.sent(),[4,Promise.all([t_.closeScreenAsync(tP.DASHBOARD_SCREEN),td.gameScene.uiManager.openLeaderboardScreenAsync({leaderboardId:o,shouldOpenPopupJoinTournament:!1})])];case 6:return B.sent(),[4,td.gameScene.tournament.tryToReturnSingleMode(o)];case 7:if(B.sent(),!(C<1)&&!(C>7))return[3,8];return td.gameScene.gamePlay.tournamentStack.popTournament(),[3,11];case 8:return I={playerRank:C},[4,to.loadPrefabAsync("screens/".concat(tO[tP.REWARD_TOURNAMENT_SCREEN]))];case 9:return B.sent(),[4,t_.openScreenAsync(tP.REWARD_TOURNAMENT_SCREEN,I)];case 10:B.sent(),td.gameScene.gamePlay.tournamentStack.popTournament(),B.label=11;case 11:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"setTextBasedOnRank",value:function(a){this.setTextInButton(a),this.setDescriptionText(a)}},{key:"setDescriptionText",value:function(a){if(a>7||a<1)this.descriptionLabel.string=globalThis.game.language.getText("The tournament is over");else{var o="";o="br"===globalThis.game.language.getCurrentLocale()?"".concat(nn.PREFIX_TOUR_REWARD_BR," ").concat(a).concat(nn.ORDINAL_BR).concat(nn.POSTFIX_TOUR_REWARD_BR):"".concat(nn.PREFIX_TOUR_REWARD_EN," ").concat(a).concat(1===a?"st":2===a?"nd":3===a?"rd":"th").concat(nn.POSTFIX_TOUR_REWARD_EN),this.descriptionLabel.string=o}}},{key:"setTextInButton",value:function(a){this.transitionBtnText.string=a>7||a<1?globalThis.game.language.getText("CONTINUE"):globalThis.game.language.getText("CLAIM")}}]),y}(eo)).prototype,"transitionBtn",[XB,XR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XW=L(XU.prototype,"closeBtn",[XE,XL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XV=L(XU.prototype,"popupContainer",[XO,XN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XK=L(XU.prototype,"descriptionLabel",[XF,XD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XY=L(XU.prototype,"transitionBtnText",[XM,Xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xj=L(XU.prototype,"glowDot",[Xz,XG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XX=L(XU.prototype,"screen",[Xq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XU)),U._RF.pop(),U._RF.push({},"846e477jpdNu58jvr16MmRn","BaseLeaderboardItem",void 0);var Jg,Jb=$.ccclass,Jk=$.property,Jw=(XJ=Jb("BaseLeaderboardItem"),XZ=Jk(er),XQ=tj.required,X$=Jk(er),X0=tj.required,X1=Jk(er),X2=tj.required,X3=Jk(W),X4=tj.required,X5=Jk([ee]),X6=tj.required(ni(ee)),X7=Jk(et),X8=tj.required,X9=Jk(ek),Je=tj.required,Jt=tj.required,Jn=tj.required,XJ((Jr=L((Ji=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"indexLabel",Jr,N(a)),O(a,"nameLabel",Ja,N(a)),O(a,"scoreLabel",Jo,N(a)),O(a,"photoSprite",Js,N(a)),O(a,"backgroundNodes",Jl,N(a)),O(a,"defaultAvatar",Ju,N(a)),O(a,"maxNameWidth",Jc,N(a)),O(a,"photoUITransform",Jh,N(a)),O(a,"nameUITransform",Jp,N(a)),O(a,"uiOpacity",Jd,N(a)),a.currentName="",a.originalScoreLabelPosition=null,a.originalRankLabelSize=0,a.originalNameLabelSize=0,a}return a(u,[{key:"__preload",value:function(){this.initComponents(),this.initData()}},{key:"initComponents",value:function(){this.uiOpacity=this.node.getComponent(ea),this.photoUITransform=this.photoSprite.node.getComponent(en),this.nameUITransform=this.nameLabel.node.getComponent(en),this.validateRequiredComponents()}},{key:"initData",value:function(){this.originalScoreLabelPosition||(this.originalScoreLabelPosition=this.scoreLabel.node.position.clone(),this.originalRankLabelSize=this.indexLabel.fontSize,this.originalNameLabelSize=this.nameLabel.fontSize)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,u)}},{key:"setMyRank",value:function(a){a?(this.showBackgroundByIndex(1),this.indexLabel.color=new K("#972b00"),this.nameLabel.color=new K("#972b00"),this.scoreLabel.color=new K("#972b00")):(this.showBackgroundByIndex(0),this.indexLabel.color=new K("#33705A"),this.nameLabel.color=new K("#33705A"),this.scoreLabel.color=new K("#33705A"))}},{key:"showBackgroundByIndex",value:function(a){this.backgroundNodes.forEach(function(o,C){o.active=C===a})}},{key:"setRankIndexLabel",value:function(a){var o=tg.DEFAULT_RANK-1,C="".concat(o.toString(),"+"),A=a>o?C:a.toString();this.indexLabel.string=A;var P=D4.getAutoResizedFontSize({text:A,originalSize:this.originalRankLabelSize,maxLength:2,minSize:10,shrinkFactor:10});this.indexLabel.fontSize=P}},{key:"setName",value:function(a){var o=D4.getShortName(a,7);this.currentName!==o&&(this.currentName=o,this.nameLabel.string=o,D4.updateLabelFontSizeBaseOnWidth(this.nameLabel,this.nameUITransform,this.maxNameWidth,this.originalNameLabelSize))}},{key:"setScore",value:function(a){-1!==a?(this.scoreLabel.string=a.toString(),this.alignScoreToCenter()):this.scoreLabel.string="???"}},{key:"alignScoreToCenter",value:function(){if(this.initData(),this.originalScoreLabelPosition){var a=this.scoreLabel.string.length,o=this.originalScoreLabelPosition,C=o.x,A=o.y,P=o.z,I=tg.TEXT_ALIGNMENT.MAX_SCORE_TEXT_LENGTH,B=tg.TEXT_ALIGNMENT.OFFSET_PER_CHARACTER,R=C;I-a>0&&(R=C-(I-a)*B),this.scoreLabel.node.setPosition(R,A,P)}}},{key:"loadAndSetPhoto",value:(R=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:return[4,D4.loadProfilePhotoAsync(a)];case 1:return[2,((C=A.sent())?(this.photoSprite.spriteFrame=C,this.photoUITransform.setContentSize(o.x,o.y)):(this.photoSprite.spriteFrame=this.defaultAvatar,this.photoUITransform.setContentSize(o.x,o.y)),C)]}})}),function(a,o){return R.apply(this,arguments)})},{key:"setSpriteFramePhoto",value:function(a){this.photoSprite.spriteFrame=null===a?this.defaultAvatar:a,this.photoUITransform.setContentSize(120,124)}},{key:"prepareFadeIn",value:function(){this.uiOpacity.opacity=0,this.node.scale=new ei(.5,.5,.5)}},{key:"playFadeInAnim",value:(I=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return a=Y(this.node).to(.2,{scale:new ei(1.03,1.03,1.03)},{easing:"sineOut"}),o=Y(this.node).to(.1,{scale:new ei(1,1,1)},{easing:"sineIn"}),C=Y(this.uiOpacity).to(.23,{opacity:255}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(C)])];case 1:return A.sent(),[4,ts.runTweenAsync(o)];case 2:return A.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),u}(vR)).prototype,"indexLabel",[XZ,XQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ja=L(Ji.prototype,"nameLabel",[X$,X0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jo=L(Ji.prototype,"scoreLabel",[X1,X2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Js=L(Ji.prototype,"photoSprite",[X3,X4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jl=L(Ji.prototype,"backgroundNodes",[X5,X6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ju=L(Ji.prototype,"defaultAvatar",[X7,X8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jc=L(Ji.prototype,"maxNameWidth",[X9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 210}}),Jh=L(Ji.prototype,"photoUITransform",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jp=L(Ji.prototype,"nameUITransform",[Jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=L(Ji.prototype,"uiOpacity",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ji))||Ji);U._RF.pop(),U._RF.push({},"04b9eHyJa5Fe7hcugGhbEGG","FakeLeaderboardItem",void 0);var JS,JT,JC,JA,J_,JP=(0,$.ccclass)("FakeLeaderboardItem")(Jg=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=I.call.apply(I,[this].concat(A))).playerId=void 0,a.photo=void 0,a.name=void 0,a.score=void 0,a.spriteFramePhoto=null,a.isLoadingPhoto=!1,a}return a(r,[{key:"setData",value:function(a,o,C,A){this.playerId=a,this.photo=o,this.name=C,this.score=A}},{key:"setSpriteFramePhoto",value:function(a){this.spriteFramePhoto=a}},{key:"setLoadingPhoto",value:function(a){this.isLoadingPhoto=a}},{key:"getSpriteFramePhoto",value:function(){return this.spriteFramePhoto}},{key:"getPhoto",value:function(){return this.photo}},{key:"getName",value:function(){return this.name}},{key:"getScore",value:function(){return this.score}},{key:"getPlayerId",value:function(){return this.playerId}},{key:"getIsLoadingPhoto",value:function(){return this.isLoadingPhoto}}]),r}(y3))||Jg;U._RF.pop(),U._RF.push({},"1a614N5vOtGCZ/k+uECO/GW","LeaderboardItem",void 0);var JI,JB=$.ccclass,JR=$.property,JE=(JS=JB("LeaderboardItem"),JT=JR(ee),JC=tj.required,JS((J_=L((JA=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"giftNode",J_,N(a)),a}return a(r,[{key:"__preload",value:function(){M(D(r.prototype),"__preload",this).call(this),tj.validateRequiredProperties(this,r)}},{key:"toggleGift",value:function(a){this.giftNode&&(this.giftNode.active=a)}}]),r}(Jw)).prototype,"giftNode",[JT,JC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JA))||JA);U._RF.pop(),U._RF.push({},"8cad14m6gJN8L82Vj0Mb/Rn","LeaderboardScroller",void 0);var JL,JO,JN,JF,JD,JM,Jx,Jz,JG,Jq,JU,JH,JW,JV,JK,JY,Jj,JX,JJ,JZ,JQ,J$,J0=$.ccclass,J1=globalThis.game.player,J2=J0("LeaderboardScroller")(JI=function(P){C(u,P);var I,R=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=R.call.apply(R,[this].concat(A))).cachePhotos=new Map,a}return a(u,[{key:"prepareFadeIn",value:function(){var a,o=E(this.realItems);try{for(o.s();!(a=o.n()).done;){var C=a.value;_instanceof(C,Jw)&&C.prepareFadeIn()}}catch(a){o.e(a)}finally{o.f()}}},{key:"playFadeInAnim",value:(I=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:o=[],C=E(this.fakeItems),B.label=1;case 1:B.trys.push([1,6,7,8]),C.s(),B.label=2;case 2:if(!!(a=C.n()).done)return[3,5];if(!((A=a.value).isVisible()&&_instanceof(A,JP)))return[3,4];return[4,ts.waitTweenAsync(.05)];case 3:B.sent(),(P=A.getRealItem())&&_instanceof(P,Jw)&&o.push(P.playFadeInAnim()),B.label=4;case 4:return[3,2];case 5:return[3,8];case 6:return I=B.sent(),C.e(I),[3,8];case 7:return C.f(),[7];case 8:return[4,Promise.all(o)];case 9:return B.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"createFakeItem",value:function(a){var o=new JP;return o.setIdx(a.idx),o.setData(a.playerId,a.photo,a.name,a.score),o}},{key:"updateRealItem",value:function(a){if(M(D(u.prototype),"updateRealItem",this).call(this,a),_instanceof(a,JP)){var o=a.getRealItem();if(_instanceof(o,Jw)){var C=a.getIdx(),A=a.getName(),P=a.getPhoto(),I=a.getScore(),B=a.getSpriteFramePhoto();o.setRankIndexLabel(C),o.setName(A),o.setScore(I),""===P?o.setSpriteFramePhoto(null):B?o.setSpriteFramePhoto(B):this.setPhotoFromCacheOrLoad(a);var R=J1.getPlayerId()===a.getPlayerId();o.setMyRank(R);var E=C>=tg.GIFTS.GREEN_GIFT_MIN_RANK&&C<=tg.GIFTS.GREEN_GIFT_MAX_RANK;_instanceof(o,JE)&&o.toggleGift(E)}}}},{key:"setPhotoFromCacheOrLoad",value:function(a){var o=this,C=a.getRealItem(),A=a.getPhoto();if(_instanceof(C,Jw)){var P=this.cachePhotos.get(A);P?(a.setSpriteFramePhoto(P),C.setSpriteFramePhoto(P)):a.getIsLoadingPhoto()?C.setSpriteFramePhoto(null):(a.setLoadingPhoto(!0),D4.loadProfilePhotoAsync(A).then(function(P){a.getPhoto()===A?(P&&o.cachePhotos.set(A,P),a.setSpriteFramePhoto(P),a.isVisible()&&C.setSpriteFramePhoto(P)):a.setLoadingPhoto(!1)}))}}}]),u}(vO))||JI;U._RF.pop(),U._RF.push({},"15738RtFD5L2Z18erscybCW","BaseMyLeaderboardItem",void 0);var J3,J4,J5,J6,J7,J8,J9,Ze=$.ccclass,Zt=$.property,Zn=(globalThis.game.player,JL=Ze("BaseMyLeaderboardItem"),JO=Zt(er),JN=tj.required,JF=Zt(er),JD=tj.required,JM=Zt(er),Jx=tj.required,Jz=Zt(W),JG=tj.required,Jq=Zt([ee]),JU=tj.required(ni(ee)),JH=Zt(et),JW=tj.required,JV=tj.required,JL((JY=L((JK=function(P){C(u,P);var I,R=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"indexLabel",JY,N(a)),O(a,"nameLabel",Jj,N(a)),O(a,"scoreLabel",JX,N(a)),O(a,"photoSprite",JJ,N(a)),O(a,"placeNodes",JZ,N(a)),O(a,"defaultAvatar",JQ,N(a)),O(a,"photoUITransform",J$,N(a)),a.currentName="",a.originalScoreLabelPosition=null,a.originalRankLabelSize=0,a}return a(u,[{key:"getCurrentAvatar",value:function(){return this.photoSprite.spriteFrame}},{key:"__preload",value:function(){this.initComponents(),this.initData()}},{key:"initComponents",value:function(){this.photoUITransform=this.photoSprite.node.getComponent(en),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,u)}},{key:"initData",value:function(){this.originalScoreLabelPosition||(this.originalScoreLabelPosition=this.scoreLabel.node.position.clone(),this.originalRankLabelSize=this.indexLabel.fontSize)}},{key:"setRankIndexLabel",value:function(a){var o=a.toString(),C=tg.DEFAULT_RANK-1;-1===a?o="?":a>C&&(o="".concat(C.toString(),"+")),this.indexLabel.string=o;var A=D4.getAutoResizedFontSize({text:o,originalSize:this.originalRankLabelSize,maxLength:2,minSize:10,shrinkFactor:10});this.indexLabel.fontSize=A}},{key:"setName",value:function(a){var o=D4.getShortName(a,7);this.currentName!==o&&(this.currentName=o,this.nameLabel.string=o)}},{key:"setScore",value:function(a){var o=a.toString();-1===a&&(o="???"),this.scoreLabel.string=o,this.alignScoreToCenter()}},{key:"alignScoreToCenter",value:function(){if(this.initData(),this.originalScoreLabelPosition){var a=this.scoreLabel.string.length,o=this.originalScoreLabelPosition,C=o.x,A=o.y,P=o.z,I=tg.TEXT_ALIGNMENT.MAX_SCORE_TEXT_LENGTH,B=tg.TEXT_ALIGNMENT.OFFSET_PER_CHARACTER,R=C;I-a>0&&(R=C-(I-a)*B),this.scoreLabel.node.setPosition(R,A,P)}}},{key:"setRank",value:function(a){var o=a.toString(),C=tg.DEFAULT_RANK-1;-1===a?o="?":a>C&&(o="".concat(C.toString(),"+")),this.indexLabel.string=o;var A=D4.getAutoResizedFontSize({text:o,originalSize:this.originalRankLabelSize,maxLength:2,minSize:10,shrinkFactor:10});this.indexLabel.fontSize=A}},{key:"setRankLabelString",value:function(a){this.indexLabel.string=a}},{key:"loadAndSetPhoto",value:(I=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:return[4,D4.loadProfilePhotoAsync(a)];case 1:return[2,((C=A.sent())?(this.photoSprite.spriteFrame=C,this.photoUITransform.setContentSize(o.x,o.y)):(this.photoSprite.spriteFrame=this.defaultAvatar,this.photoUITransform.setContentSize(o.x,o.y)),C)]}})}),function(a,o){return I.apply(this,arguments)})},{key:"setTopPlace",value:function(a){this.toggleAllPlaceNodes(!1),this.indexLabel.node.active=a>3,a>3||(this.placeNodes[a-1].active=!0)}},{key:"toggleAllPlaceNodes",value:function(a){var o,C=E(this.placeNodes);try{for(C.s();!(o=C.n()).done;)o.value.active=a}catch(a){C.e(a)}finally{C.f()}}}]),u}(eo)).prototype,"indexLabel",[JO,JN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jj=L(JK.prototype,"nameLabel",[JF,JD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JX=L(JK.prototype,"scoreLabel",[JM,Jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JJ=L(JK.prototype,"photoSprite",[Jz,JG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JZ=L(JK.prototype,"placeNodes",[Jq,JU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JQ=L(JK.prototype,"defaultAvatar",[JH,JW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J$=L(JK.prototype,"photoUITransform",[JV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JK))||JK);U._RF.pop(),U._RF.push({},"83d0337OP5AKp7h+zYRc1aZ","Loader",void 0);var Zi,Zr,Za,Zo,Zs,Zl,Zu,Zc,Zh,Zp,Zd,Zf,Zy,Zv,Zm,Zg,Zb,Zk,Zw,ZS,ZT=$.ccclass,ZC=$.property,ZA=(J3=ZT("Loader"),J4=ZC(ee),J5=tj.required,J6=tj.required,J3((J8=L((J7=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"loading",J8,N(a)),O(a,"loadingOpacity",J9,N(a)),a.loadingTween=null,a}return a(u,[{key:"__preload",value:function(){this.loadingOpacity=this.loading.getComponent(ea),tj.validateRequiredProperties(this,u)}},{key:"onLoad",value:function(){this.loadingOpacity.opacity=0,this.loading.angle=0}},{key:"showLoadingAsync",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return this.loading.scale=new ei(1,1,1),a=Y(this.loadingOpacity).to(.2,{opacity:255}),this.runLoadingAnimation(),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"hideLoadingAsync",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.loading).parallel(Y().to(.3,{scale:new ei(0,0,1)},{easing:"backIn"}),Y(this.loadingOpacity).to(.3,{opacity:0})),[4,ts.runTweenAsync(a)];case 1:return o.sent(),this.stopLoadingAnimation(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"runLoadingAnimation",value:function(){var a=this;this.stopLoadingAnimation(),this.loadingTween=Y(this.loading).to(2.5,{angle:-360}).call(function(){a.loading.angle=0}).union().repeatForever().start()}},{key:"stopLoadingAnimation",value:function(){var a;null==(a=this.loadingTween)||a.stop(),this.loadingTween=null}}]),u}(eo)).prototype,"loading",[J4,J5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J9=L(J7.prototype,"loadingOpacity",[J6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J7))||J7);U._RF.pop(),U._RF.push({},"027fbYUvaNIuL2ughIWiFB6","TopTier",void 0);var Z_,ZP,ZI,ZB,ZR,ZE=$.ccclass,ZL=$.property,ZO=(Zi=ZE("TopTier"),Zr=ZL(W),Za=tj.required,Zo=ZL(er),Zs=tj.required,Zl=ZL(er),Zu=tj.required,Zc=ZL(et),Zh=tj.required,Zp=tj.required,Zd=tj.required,Zf=tj.required,Zi((Zv=L((Zy=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"avatar",Zv,N(a)),O(a,"nameLabel",Zm,N(a)),O(a,"scoreLabel",Zg,N(a)),O(a,"defaultAvatar",Zb,N(a)),O(a,"avatarUITransform",Zk,N(a)),O(a,"nameUITransform",Zw,N(a)),O(a,"uiOpacity",ZS,N(a)),a.originalPosition=ei.ZERO,a.originalScoreLabelPosition=null,a.originalNameLabelSize=0,a}return a(s,[{key:"__preload",value:function(){this.initComponents(),this.initData()}},{key:"initComponents",value:function(){this.avatarUITransform=this.avatar.node.getComponent(en),this.uiOpacity=this.node.getComponent(ea),this.nameUITransform=this.nameLabel.node.getComponent(en),this.originalPosition=this.node.position.clone(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,s)}},{key:"initData",value:function(){this.originalScoreLabelPosition||(this.originalScoreLabelPosition=this.scoreLabel.node.position.clone(),this.originalNameLabelSize=this.nameLabel.fontSize)}},{key:"updateTopTier",value:function(a,o,C){var A=this,P=D4.getShortName(""===a?"???":a,7);this.nameLabel.string=P,this.scoreLabel.string=""===o?"???":o,this.alignScoreToCenter(),D4.updateLabelFontSizeBaseOnWidth(this.nameLabel,this.nameUITransform,300,this.originalNameLabelSize),D4.loadProfilePhotoAsync(C).then(function(a){a?(A.avatar.spriteFrame=a,A.avatarUITransform.setContentSize(120,124)):A.avatar.spriteFrame=A.defaultAvatar}).catch(function(){A.avatar.spriteFrame=A.defaultAvatar})}},{key:"alignScoreToCenter",value:function(){if(this.initData(),this.originalScoreLabelPosition){var a=this.scoreLabel.string.length,o=this.originalScoreLabelPosition,C=o.x,A=o.y,P=o.z,I=tg.TEXT_ALIGNMENT.MAX_SCORE_TEXT_LENGTH,B=tg.TEXT_ALIGNMENT.OFFSET_PER_CHARACTER,R=C;I-a>0&&(R=C-(I-a)*B),this.scoreLabel.node.setPosition(R,A,P)}}},{key:"prepareFadeIn",value:function(){var a=this.originalPosition,o=a.x,C=a.y,A=a.z;this.node.position=new ei(o,C-295,A),this.node.scale=new ei(.3,.3,.3),this.uiOpacity.opacity=0}},{key:"playFadeInAnim",value:(I=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return a=Y(this.node).to(.35,{scale:new ei(1,1,1)},{easing:"cubicOut"}),o=Y(this.uiOpacity).to(.35,{opacity:255}),C=Y(this.node).to(.35,{position:this.originalPosition},{easing:this.customBackOut}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o),ts.runTweenAsync(C)])];case 1:return A.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"customBackOut",value:function(a){var o=a-1;return o*o*(2.7*o+1.7)+1}}]),s}(eo)).prototype,"avatar",[Zr,Za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zm=L(Zy.prototype,"nameLabel",[Zo,Zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg=L(Zy.prototype,"scoreLabel",[Zl,Zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zb=L(Zy.prototype,"defaultAvatar",[Zc,Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zk=L(Zy.prototype,"avatarUITransform",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zw=L(Zy.prototype,"nameUITransform",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZS=L(Zy.prototype,"uiOpacity",[Zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zy))||Zy);U._RF.pop(),U._RF.push({},"3635dZe9VlDTpg6YlsWLw2y","TopTierController",void 0);var ZN,ZF,ZD,ZM,Zx,Zz,ZG,Zq,ZU,ZH,ZW,ZV,ZK,ZY,Zj,ZX,ZJ,ZZ,ZQ,Z$,Z0,Z1,Z2,Z3,Z4,Z5=$.ccclass,Z6=$.property,Z7=(Z_=Z5("TopTierController"),ZP=Z6([ZO]),ZI=tj.required(ni(ZO)),Z_((ZR=L((ZB=function(P){C(u,P);var I,R=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"topTiers",ZR,N(a)),a}return a(u,[{key:"updateTopTier",value:function(a,o,C,A){if(!(a>4||a<1)){var P=a-1;this.topTiers[P]&&this.topTiers[P].updateTopTier(o,C,A)}}},{key:"prepareFadeIn",value:function(){var a,o=E(this.topTiers);try{for(o.s();!(a=o.n()).done;)a.value.prepareFadeIn()}catch(a){o.e(a)}finally{o.f()}}},{key:"playFadeInAnim",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:o=[],C=E(this.topTiers);try{for(C.s();!(a=C.n()).done;)A=a.value,o.push(A.playFadeInAnim())}catch(a){C.e(a)}finally{C.f()}return[4,Promise.all(o)];case 1:return P.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eo)).prototype,"topTiers",[ZP,ZI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZB))||ZB);U._RF.pop(),U._RF.push({},"421cb0COCZDRqFNi07PB/tX","ContainerGlobalLeaderboard",void 0);var Z8,Z9,Qe,Qt,Qn,Qi,Qr,Qa,Qo,Qs=$.ccclass,Ql=$.property,Qu=(ZN=Qs("ContainerGlobalLeaderboard"),ZF=Ql(ee),ZD=tj.required,ZM=Ql(Z7),Zx=tj.required,Zz=Ql(J2),ZG=tj.required,Zq=Ql(Zn),ZU=tj.required,ZH=Ql(ef),ZW=tj.required,ZV=Ql(ee),ZK=tj.required,ZY=Ql(ZA),Zj=tj.required,ZX=tj.required,ZN((ZZ=L((ZJ=function(P){C(d,P);var I,R,E,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"footer",ZZ,N(a)),O(a,"topTierController",ZQ,N(a)),O(a,"scroller",Z$,N(a)),O(a,"myLeaderboardItem",Z0,N(a)),O(a,"closeButton",Z1,N(a)),O(a,"leaderboardIsEmptyNode",Z2,N(a)),O(a,"loader",Z3,N(a)),O(a,"myLeaderboardItemOpacity",Z4,N(a)),a.originalMyLeaderboardItemPos=null,a}return a(d,[{key:"__preload",value:function(){this.initComponents(),this.registerEvents(),this.setUp()}},{key:"initComponents",value:function(){this.myLeaderboardItemOpacity=this.myLeaderboardItem.getComponent(ea),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this)}},{key:"registerEvents",value:function(){ep.on(tl.VIEW_RESIZED,this.alignFooter,this)}},{key:"setUp",value:function(){this.originalMyLeaderboardItemPos=this.myLeaderboardItem.node.position.clone(),this.toggleLeaderboardIsEmptyNode(!1)}},{key:"onLoad",value:function(){this.alignFooter();var a=tf.getBannerAdWorldHeight();this.scroller.addOffsetHeader(a)}},{key:"alignFooter",value:function(){this.alignMyLeaderboardItem(),this.updateSizeFooter()}},{key:"alignMyLeaderboardItem",value:function(){var a=tf.getBannerAdWorldHeight();if(this.originalMyLeaderboardItemPos){var o=this.originalMyLeaderboardItemPos,C=o.x,A=o.y,P=o.z;this.myLeaderboardItem.node.setPosition(C,A+a,P)}}},{key:"updateSizeFooter",value:function(){var a=tf.getBannerAdWorldHeight(),o=this.footer.getComponent(en);if(o){var C=o.width;o.setContentSize(C,a+100)}}},{key:"updateTopTiers",value:function(a){if(a&&0!==a.length){for(var o=0;o<a.length;o++){var C=a[o];this.topTierController.updateTopTier(C.rank,C.name,C.score.toString(),C.photo)}for(var A=a.length;A<3;A++)this.topTierController.updateTopTier(A+1,"","","")}else for(var P=0;P<3;P++)this.topTierController.updateTopTier(P+1,"","","")}},{key:"loadScroller",value:function(a){this.scroller.loadScroller(a)}},{key:"updateMyLeaderboardItem",value:function(a,o,C,A){this.myLeaderboardItem.setName(o),this.myLeaderboardItem.setScore(C),this.myLeaderboardItem.loadAndSetPhoto(A,new H(120,124)),-1===a?(this.myLeaderboardItem.setTopPlace(4),this.myLeaderboardItem.setRankLabelString("?")):(this.myLeaderboardItem.setRank(a),this.myLeaderboardItem.setTopPlace(a))}},{key:"prepareScroller",value:function(){this.scroller.toggleRealItems(!1)}},{key:"moveToRank",value:function(a){this.scroller.moveToIdx(a)}},{key:"refreshScroller",value:function(){this.scroller.refreshScroller()}},{key:"prepareFadeIn",value:function(){this.updateTopTiers(null),this.updateMyLeaderboardItem(-1,"???",-1,""),this.prepareScroller(),this.myLeaderboardItemOpacity.opacity=0,this.topTierController.prepareFadeIn(),this.toggleLeaderboardIsEmptyNode(!1)}},{key:"prepareScrollerItems",value:function(){this.scroller.prepareFadeIn()}},{key:"playFadeInAnim",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.topTierController.playFadeInAnim()];case 1:return a.sent(),[4,Promise.all([this.scroller.playFadeInAnim(),this.playFadeInMyLeaderboardItem()])];case 2:return a.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"playFadeInMyLeaderboardItem",value:(E=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.myLeaderboardItemOpacity).to(.2,{opacity:255},{easing:"sineOut"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"onClickCloseButton",set:function(a){this.closeButton.node.on(ef.EventType.CLICK,a)}},{key:"toggleLeaderboardIsEmptyNode",value:function(a){this.leaderboardIsEmptyNode.active=a}},{key:"showLoadingAsync",value:(R=B(function(){return _ts_generator(this,function(a){return this.loader.showLoadingAsync(),[2]})}),function(){return R.apply(this,arguments)})},{key:"hideLoadingAsync",value:(I=B(function(){return _ts_generator(this,function(a){return this.loader.hideLoadingAsync(),[2]})}),function(){return I.apply(this,arguments)})}]),d}(eo)).prototype,"footer",[ZF,ZD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZQ=L(ZJ.prototype,"topTierController",[ZM,Zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z$=L(ZJ.prototype,"scroller",[Zz,ZG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z0=L(ZJ.prototype,"myLeaderboardItem",[Zq,ZU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z1=L(ZJ.prototype,"closeButton",[ZH,ZW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z2=L(ZJ.prototype,"leaderboardIsEmptyNode",[ZV,ZK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z3=L(ZJ.prototype,"loader",[ZY,Zj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z4=L(ZJ.prototype,"myLeaderboardItemOpacity",[ZX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZJ))||ZJ);U._RF.pop(),U._RF.push({},"39243x7iEhP4btzEKnJMSam","GlobalLeaderboardScreen",void 0);var Qc,Qh,Qp,Qd,Qf,Qy=$.ccclass,Qv=$.disallowMultiple,Qm=$.requireComponent,Qg=$.property,Qb=GameCore,Qk=Qb.Events,Qw=Qb.Utils.Signal,QS=GameCore.Configs.Mockup,QT=globalThis.game,QC=QT.event,QA=QT.player;Z8=Qy("GlobalLeaderboardScreen"),Z9=Qm(Bi),Qe=Qg(Qu),Qt=tj.required,Qn=tj.required,Z8(Qi=Qv(Qi=Z9((Qa=L((Qr=function(P){C(m,P);var I,E,L,F,D,M,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=z.call.apply(z,[this].concat(A)),O(a,"container",Qa,N(a)),O(a,"screen",Qo,N(a)),a.lbSignalController=new Qw.SignalController,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("LeaderboardScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},a.prepareOpen())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(m,[{key:"screenData",get:function(){return this.screen.data}},{key:"setLeadersData",value:function(a,o){this.screen.data={currentPlayer:a,leaders:o}}},{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,m)}},{key:"onLoad",value:function(){this.registryEvents()}},{key:"registryEvents",value:function(){var a=this;this.container.onClickCloseButton=function(){a.handleClickCloseButton()}}},{key:"listenScreenEvents",value:function(){QC.on(Qk.OPENING_SCREEN,this.handleOpeningScreen),QC.on(Qk.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){QC.off(Qk.OPENING_SCREEN,this.handleOpeningScreen),QC.off(Qk.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"prepareOpen",value:function(){this.container.prepareFadeIn();var a=this.node.getComponent(ea);a&&(a.opacity=255)}},{key:"open",value:(x=B(function(){return _ts_generator(this,function(a){return this.enabled&&(this.loadAndDisplayLeaderboard(),QC.emit(Qk.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),QC.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name})),[2]})}),function(){return x.apply(this,arguments)})},{key:"loadAndDisplayLeaderboard",value:(M=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return this.screenData.allowLoadNewData&&this.container.showLoadingAsync(),[4,this.fetchLeaderboard()];case 1:return"aborted"!==(a=o.sent())&&(this.container.prepareScrollerItems(),a||this.displayNoLeaderboard(),this.container.toggleLeaderboardIsEmptyNode(!a),this.container.hideLoadingAsync(),this.scrollToCurrentPlayerRank(),this.container.playFadeInAnim()),[2]}})}),function(){return M.apply(this,arguments)})},{key:"fetchLeaderboard",value:(D=B(function(){var a,o,C,A,P,I,B,E,L,O,N,F,D,M,x,z,q,U;return _ts_generator(this,function(H){switch(H.label){case 0:if(o=(a=this.screenData).allowLoadNewData,!a.leaderboardId)return[2,!1];if(C=this.lbSignalController.renew(),!o)return[3,2];return[4,Promise.race([C.promise(),this.tryToFetchLeaderboardData()])];case 1:H.sent(),H.label=2;case 2:if(C.aborted)return[2,"aborted"];if(P=(A=this.screenData).currentPlayer,!(I=A.leaders)||0===I.length)return[2,!1];if(!this.enabled)return[2,!1];if(B=I,QS.Leaderboards.Enabled&&(B=I.sort(function(a,o){return a.rank-o.rank})).length>tg.MAX_LEADERS&&(B=B.slice(0,tg.MAX_LEADERS)),E=B.slice(0,3),O=(L=B.slice(3))[L.length-1],N=tg.SMALLER.MIN_RANK,O&&(N=L[L.length-1].rank+1),F=this.createUnknownPlayerEntry(N,tg.MAX_UNKNOWN_LEADERS),L.push.apply(L,R(F)),D=L.map(this.castToRankingScrollerData()),this.container.updateTopTiers(E),this.container.loadScroller(D),x=(M=QA.getPlayer()).name,z=M.photo,q=QA.getPlayerId(),P)this.isNewPlayerInLeaderboard()?this.container.updateMyLeaderboardItem(-1,P.name,0,P.photo):this.container.updateMyLeaderboardItem(P.rank,P.name,P.score,P.photo);else(U=I.find(function(a){return a.playerId===q}))?this.container.updateMyLeaderboardItem(U.rank,U.name,U.score,U.photo):this.container.updateMyLeaderboardItem(-1,x,-1,z);return[2,!0]}})}),function(){return D.apply(this,arguments)})},{key:"castToRankingScrollerData",value:function(){return function(a){return{playerId:a.playerId,name:a.name,photo:a.photo,score:a.score,idx:a.rank,rank:a.rank}}}},{key:"displayNoLeaderboard",value:function(){this.container.loadScroller([]),this.container.updateTopTiers([]);var a=QA.getPlayer(),o=a.name,C=a.photo;this.container.updateMyLeaderboardItem(-1,o,-1,C)}},{key:"tryToFetchLeaderboardData",value:(F=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(a=td.gameScene.gamePlay.globalLeaderboardLoader,C=(o=this.screenData).currentPlayer,A=o.leaders,C&&A)return[3,2];return[4,a.preloadLeaderboardData()];case 1:P.sent(),this.setLeadersData(a.getCurrentPlayerEntry(),a.getLeaderboard()),P.label=2;case 2:return A&&C||a.setAllowLoadNewData(!0),[2]}})}),function(){return F.apply(this,arguments)})},{key:"createUnknownPlayerEntry",value:function(a,o){for(var C=[],A=a;A<=o;A++)C.push({playerId:"",name:"???",photo:"",score:-1,rank:A});return C}},{key:"isNewPlayerInLeaderboard",value:function(){var a=this.screenData,o=a.currentPlayer,C=a.leaders;return!C||!!o&&o.rank===tg.DEFAULT_RANK&&!C.find(function(a){return a.playerId===o.playerId})}},{key:"scrollToCurrentPlayerRank",value:function(){var a=this.screenData,o=a.currentPlayer,C=a.leaders;if(o){var A=o.rank,P=tg.SMALLER.MIN_RANK,I=tg.SMALLER.MAX_RANK;if(A>=P&&A<=I)this.container.moveToRank(A-P),this.container.refreshScroller();else this.container.moveToRank(0)}else if(C){var B=QA.getPlayerId(),R=C.findIndex(function(a){return a.playerId===B})-3;R<0?this.container.moveToRank(0):this.container.moveToRank(R)}else this.container.moveToRank(0)}},{key:"close",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.fadeOutScreen()];case 1:return a.sent(),this.node.active=!1,QC.emit(Qk.CLOSED_SCREEN,{screenName:this.node.name}),QC.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return L.apply(this,arguments)})},{key:"fadeOutScreen",value:(E=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(a=this.node.getComponent(ea)))return[3,2];return o=Y(a).to(.24,{opacity:0}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"handleClickCloseButton",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),this.lbSignalController.abort(),[4,Promise.all([td.gameScene.uiManager.openDashboardScreenAsync(),t_.closeScreenAsync(tP.GLOBAL_LEADERBOARD_SCREEN)])];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return I.apply(this,arguments)})}]),m}(eo)).prototype,"container",[Qe,Qt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qo=L(Qr.prototype,"screen",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qi=Qr))||Qi)||Qi),U._RF.pop(),U._RF.push({},"31b762XomZHRrmbGgyw3GPl","MyLeaderboardItemWithGifts",void 0);var Q_,QP,QI,QB,QR,QE,QL,QO,QN,QF,QD,QM,Qx,Qz,QG,Qq,QU,QH,QW,QV,QK,QY,Qj,QX,QJ,QZ,QQ,Q$,Q0,Q1,Q2,Q3,Q4,Q5,Q6=$.ccclass,Q7=$.property,Q8=(Qc=Q6("MyLeaderboardItemWithGifts"),Qh=Q7([ee]),Qp=tj.required(ni(ee)),Qc((Qf=L((Qd=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"giftNodes",Qf,N(a)),a}return a(r,[{key:"__preload",value:function(){M(D(r.prototype),"__preload",this).call(this),tj.validateRequiredProperties(this,r)}},{key:"setTopGift",value:function(a){if(0!==this.giftNodes.length){if(this.toggleAllGifts(!1),a<=3)this.giftNodes[a-1].active=!0;else if(a>=tg.GIFTS.GREEN_GIFT_MIN_RANK&&a<=tg.GIFTS.GREEN_GIFT_MAX_RANK)this.giftNodes[3].active=!0}}},{key:"toggleAllGifts",value:function(a){var o,C=E(this.giftNodes);try{for(C.s();!(o=C.n()).done;)o.value.active=a}catch(a){C.e(a)}finally{C.f()}}}]),r}(Zn)).prototype,"giftNodes",[Qh,Qp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qd))||Qd);U._RF.pop(),U._RF.push({},"ac96bHKnidAAoawXT9hXv0H","ContainerLeaderboard",void 0);var Q9,$e,$t,$n,$i,$r,$a,$o,$s,$l=$.ccclass,$u=$.property,$c=(Q_=$l("ContainerLeaderboard"),QP=$u(er),QI=tj.required,QB=$u(ee),QR=tj.required,QE=$u(Z7),QL=tj.required,QO=$u(J2),QN=tj.required,QF=$u(Q8),QD=tj.required,QM=$u(ef),Qx=tj.required,Qz=$u(ef),QG=tj.required,Qq=$u(ee),QU=tj.required,QH=$u(ZA),QW=tj.required,QV=$u(ee),QK=tj.required,QY=tj.required,Q_((QX=L((Qj=function(P){C(d,P);var I,R,E,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"timerLabel",QX,N(a)),O(a,"footer",QJ,N(a)),O(a,"topTierController",QZ,N(a)),O(a,"scroller",QQ,N(a)),O(a,"myLeaderboardItem",Q$,N(a)),O(a,"closeButton",Q0,N(a)),O(a,"infoButton",Q1,N(a)),O(a,"leaderboardIsEmptyNode",Q2,N(a)),O(a,"loader",Q3,N(a)),O(a,"footerElementsContainer",Q4,N(a)),O(a,"myLeaderboardItemOpacity",Q5,N(a)),a.originalTimerFontSize=0,a.originalFooterElementsContainerPos=null,a}return a(d,[{key:"__preload",value:function(){this.initComponents(),this.registerEvents(),this.setUp()}},{key:"initComponents",value:function(){this.myLeaderboardItemOpacity=this.myLeaderboardItem.getComponent(ea),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,d)}},{key:"registerEvents",value:function(){var a=this;ep.on(tl.VIEW_RESIZED,function(){a.alignFooter(),a.updateSizeFooter()},this)}},{key:"setUp",value:function(){this.originalTimerFontSize=this.timerLabel.fontSize,this.originalFooterElementsContainerPos=this.footerElementsContainer.position.clone(),this.toggleLeaderboardIsEmptyNode(!1)}},{key:"onLoad",value:function(){this.alignScroller(),this.alignFooter(),this.updateSizeFooter()}},{key:"alignScroller",value:function(){var a=tf.getBannerAdWorldHeight();this.scroller.addOffsetHeader(a)}},{key:"alignFooter",value:function(){var a=tf.getBannerAdWorldHeight();if(this.originalFooterElementsContainerPos){var o=this.originalFooterElementsContainerPos,C=o.x,A=o.y,P=o.z;this.footerElementsContainer.setPosition(C,A+a,P)}}},{key:"updateSizeFooter",value:function(){var a=tf.getBannerAdWorldHeight(),o=this.footer.getComponent(en);if(o){var C=o.width;o.setContentSize(C,a+100)}}},{key:"updateTopTiers",value:function(a){if(a&&0!==a.length){for(var o=0;o<a.length;o++){var C=a[o];this.topTierController.updateTopTier(C.rank,C.name,C.score.toString(),C.photo)}for(var A=a.length;A<3;A++)this.topTierController.updateTopTier(A+1,"","","")}else for(var P=0;P<3;P++)this.topTierController.updateTopTier(P+1,"","","")}},{key:"loadScroller",value:function(a){this.scroller.loadScroller(a)}},{key:"updateMyLeaderboardItem",value:function(a,o,C,A){this.myLeaderboardItem.setName(o),this.myLeaderboardItem.setScore(C),this.myLeaderboardItem.loadAndSetPhoto(A,new H(120,124)),-1===a?(this.myLeaderboardItem.setTopPlace(4),this.myLeaderboardItem.setRankLabelString("?"),this.myLeaderboardItem.toggleAllGifts(!1)):(this.myLeaderboardItem.setRank(a),this.myLeaderboardItem.setTopGift(a),this.myLeaderboardItem.setTopPlace(a))}},{key:"setTimerLabelStr",value:function(a){this.timerLabel.string=a;var o=D4.getAutoResizedFontSize({text:a,originalSize:this.originalTimerFontSize,maxLength:8,minSize:3,shrinkFactor:3});this.timerLabel.fontSize=o}},{key:"prepareScroller",value:function(){this.scroller.toggleRealItems(!1)}},{key:"moveToRank",value:function(a){this.scroller.moveToIdx(a)}},{key:"refreshScroller",value:function(){this.scroller.refreshScroller()}},{key:"prepareFadeIn",value:function(){this.updateTopTiers(null),this.updateMyLeaderboardItem(-1,"???",-1,""),this.prepareScroller(),this.myLeaderboardItemOpacity.opacity=0,this.topTierController.prepareFadeIn(),this.toggleLeaderboardIsEmptyNode(!1)}},{key:"prepareScrollerItems",value:function(){this.scroller.prepareFadeIn()}},{key:"playFadeInAnim",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.topTierController.playFadeInAnim()];case 1:return a.sent(),[4,Promise.all([this.scroller.playFadeInAnim(),this.playFadeInMyLeaderboardItem()])];case 2:return a.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"playFadeInMyLeaderboardItem",value:(E=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.myLeaderboardItemOpacity).to(.2,{opacity:255},{easing:"sineOut"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"onClickInfoButton",set:function(a){this.infoButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickCloseButton",set:function(a){this.closeButton.node.on(ef.EventType.CLICK,a)}},{key:"toggleLeaderboardIsEmptyNode",value:function(a){this.leaderboardIsEmptyNode.active=a}},{key:"showLoadingAsync",value:(R=B(function(){return _ts_generator(this,function(a){return this.loader.showLoadingAsync(),[2]})}),function(){return R.apply(this,arguments)})},{key:"hideLoadingAsync",value:(I=B(function(){return _ts_generator(this,function(a){return this.loader.hideLoadingAsync(),[2]})}),function(){return I.apply(this,arguments)})}]),d}(eo)).prototype,"timerLabel",[QP,QI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QJ=L(Qj.prototype,"footer",[QB,QR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QZ=L(Qj.prototype,"topTierController",[QE,QL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QQ=L(Qj.prototype,"scroller",[QO,QN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q$=L(Qj.prototype,"myLeaderboardItem",[QF,QD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q0=L(Qj.prototype,"closeButton",[QM,Qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q1=L(Qj.prototype,"infoButton",[Qz,QG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q2=L(Qj.prototype,"leaderboardIsEmptyNode",[Qq,QU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q3=L(Qj.prototype,"loader",[QH,QW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q4=L(Qj.prototype,"footerElementsContainer",[QV,QK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q5=L(Qj.prototype,"myLeaderboardItemOpacity",[QY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qj))||Qj);U._RF.pop(),U._RF.push({},"7017437v2hHH5+Ozw5IuJoy","LeaderboardScreen",void 0);var $h=$.ccclass,$p=$.disallowMultiple,$d=$.requireComponent,$f=$.property,$y=GameCore,$v=$y.Events,$m=$y.Utils.Signal,$g=globalThis.game,$b=$g.event,$k=$g.player;GameCore.Configs.Mockup,Q9=$h("LeaderboardScreen"),$e=$d(Bi),$t=$f($c),$n=tj.required,$i=tj.required,Q9($r=$p($r=$e(($o=L(($a=function(P){C(b,P);var I,E,L,F,D,M,x,z,q,U=A(b);function b(){var a;o(this,b);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=U.call.apply(U,[this].concat(A)),O(a,"container",$o,N(a)),O(a,"screen",$s,N(a)),a.lbSignalController=new $m.SignalController,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("LeaderboardScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},a.prepareOpen())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(b,[{key:"screenData",get:function(){return this.screen.data}},{key:"setLeadersData",value:function(a,o){this.screen.data={currentPlayer:a,leaders:o}}},{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,b)}},{key:"onLoad",value:function(){this.registryEvents()}},{key:"registryEvents",value:function(){var a=this;this.node.scene.on(t2.LEADER_BOARD_TIMER_COUNT_DOWN,this.updateTimer,this),this.container.onClickCloseButton=function(){a.handleClickCloseButton()},this.container.onClickInfoButton=function(){a.handleClickInfoButton()}}},{key:"listenScreenEvents",value:function(){$b.on($v.OPENING_SCREEN,this.handleOpeningScreen),$b.on($v.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){$b.off($v.OPENING_SCREEN,this.handleOpeningScreen),$b.off($v.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"updateTimer",value:function(a){if(a<0){var o=globalThis.game.language.getText("End");this.container.setTimerLabelStr(o)}else{var C=Rs.getStandardTimeFormat(a);if(this.container.setTimerLabelStr(C),0===a){var A=globalThis.game.language.getText("End");this.container.setTimerLabelStr(A)}}}},{key:"prepareOpen",value:function(){this.displayLeaderboardTime(),this.container.prepareFadeIn()}},{key:"open",value:(q=B(function(){var a;return _ts_generator(this,function(o){return a=this,this.enabled&&(this.playFadeInScreen(),this.loadAndDisplayLeaderboard().then(function(){a.screen.data&&a.screen.data.shouldOpenPopupJoinTournament&&a.tryToOpenPopupJoinTournament()}),$b.emit($v.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),$b.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name})),[2]})}),function(){return q.apply(this,arguments)})},{key:"loadAndDisplayLeaderboard",value:(z=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return a=td.gameScene.gamePlay.resultTournamentLoader,C=(o=this.screenData).allowLoadNewData,A=o.leaderboardId,C&&this.container.showLoadingAsync(),[4,this.fetchLeaderboard(A)];case 1:if(!("aborted"!==(P=I.sent())))return[3,3];return this.container.prepareScrollerItems(),P||(a.setAllowLoadNewData(!0),this.displayNoLeaderboard()),this.container.toggleLeaderboardIsEmptyNode(!P),this.container.hideLoadingAsync(),this.scrollToCurrentPlayerRank(),[4,this.container.playFadeInAnim()];case 2:I.sent(),I.label=3;case 3:return[2]}})}),function(){return z.apply(this,arguments)})},{key:"tryToOpenPopupJoinTournament",value:function(){td.gameScene.tournament.isJoinedCurTour()&&td.gameScene.tournament.tryToOpenPopupJoinTourAsync()}},{key:"displayLeaderboardTime",value:function(){var a=td.gameScene.gamePlay,o=a.timerHandler,C=a.resultTournamentLoader,A=o.getLeaderboardTimer();if(0===A){var P=globalThis.game.language.getText("End");this.container.setTimerLabelStr(P)}else if(C.getAllowLoadNewData()){var I=globalThis.game.language.getText("Loading...");this.container.setTimerLabelStr(I)}this.updateTimer(A)}},{key:"fetchLeaderboard",value:(x=B(function(a){var o,C,A,P,I,B,E,L,O,N,F,D,M,x,z,q,U;return _ts_generator(this,function(H){switch(H.label){case 0:if(o=this.screenData.allowLoadNewData,C=this.lbSignalController.renew(),!o)return[3,2];return[4,Promise.race([this.tryToFetchLeaderboardData(a),C.promise()])];case 1:H.sent(),H.label=2;case 2:if(C.aborted)return[2,"aborted"];if(P=(A=this.screenData).currentPlayer,!(I=A.leaders))return[2,!1];if(I.splice(tg.MAX_LEADERS+1),I.forEach(function(a,o){a.rank=o+1}),(B=I.sort(function(a,o){return a.rank-o.rank})).length>tg.MAX_LEADERS&&(B=B.slice(0,tg.MAX_LEADERS)),E=B.slice(0,3),O=(L=B.slice(3))[L.length-1],N=tg.SMALLER.MIN_RANK,O&&(N=L[L.length-1].rank+1),F=this.createUnknownPlayerEntry(N,tg.MAX_UNKNOWN_LEADERS),L.push.apply(L,R(F)),D=L.map(function(a){return{playerId:a.playerId,name:a.name,photo:a.photo,score:a.score,rank:a.rank,idx:a.rank}}),!this.node.active)return[2,!1];if(this.container.updateTopTiers(E),this.container.loadScroller(D),x=(M=$k.getPlayer()).name,z=M.photo,q=$k.getPlayerId(),P)this.isNewPlayerInLeaderboard()?this.container.updateMyLeaderboardItem(-1,P.name,0,P.photo):this.container.updateMyLeaderboardItem(P.rank,P.name,P.score,P.photo);else(U=I.find(function(a){return a.playerId===q}))?this.container.updateMyLeaderboardItem(U.rank,U.name,U.score,U.photo):this.container.updateMyLeaderboardItem(-1,x,-1,z);return[2,!0]}})}),function(a){return x.apply(this,arguments)})},{key:"displayNoLeaderboard",value:function(){this.container.loadScroller([]),this.container.updateTopTiers([]);var a=$k.getPlayer(),o=a.name,C=a.photo;this.container.updateMyLeaderboardItem(-1,o,-1,C)}},{key:"tryToFetchLeaderboardData",value:(M=B(function(a){var o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(o=td.gameScene.gamePlay.resultTournamentLoader,A=(C=this.screenData).currentPlayer,P=C.leaders,A&&P)return[3,2];return[4,o.preloadLeaderboardData(a)];case 1:I.sent(),this.setLeadersData(o.getCurrentPlayerEntry(),o.getLeaderboard()),I.label=2;case 2:return a?o.setAllowLoadNewData(!0):o.setAllowLoadNewData(!1),[2]}})}),function(a){return M.apply(this,arguments)})},{key:"createUnknownPlayerEntry",value:function(a,o){for(var C=[],A=a;A<=o;A++)C.push({playerId:"",name:"???",photo:"",score:-1,rank:A});return C}},{key:"isNewPlayerInLeaderboard",value:function(){var a=this.screenData,o=a.currentPlayer,C=a.leaders;return!C||!!o&&o.rank===tg.DEFAULT_RANK&&!C.find(function(a){return a.playerId===o.playerId})}},{key:"scrollToCurrentPlayerRank",value:function(){var a=this.screenData,o=a.currentPlayer,C=a.leaders;if(o){var A=o.rank,P=tg.SMALLER.MIN_RANK,I=tg.SMALLER.MAX_RANK;if(A>=P&&A<=I)this.container.moveToRank(A-P),this.container.refreshScroller();else this.container.moveToRank(0)}else if(C){var B=$k.getPlayerId(),R=C.findIndex(function(a){return a.playerId===B})-3;R<0?this.container.moveToRank(0):this.container.moveToRank(R)}else this.container.moveToRank(0)}},{key:"playFadeInScreen",value:(D=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(a=this.node.getComponent(ea)))return[3,2];return o=Y(a).to(.05,{opacity:255}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"playFadeOutScreen",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(a=this.node.getComponent(ea)))return[3,2];return o=Y(a).to(.24,{opacity:0}),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"close",value:(L=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return(a=[]).push(this.playFadeOutScreen()),a.push(td.gameScene.uiManager.openDashboardScreenAsync()),this.screen.data&&this.screen.data.leaderboardId&&a.push(td.gameScene.tournament.tryToPlayNewTournament()),[4,Promise.all(a)];case 1:return o.sent(),this.node.active=!1,this.screen.data={},$b.emit($v.CLOSED_SCREEN,{screenName:this.node.name}),$b.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return L.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"handleClickCloseButton",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),this.lbSignalController.abort(),[4,t_.closeScreenAsync(tP.LEADERBOARD_SCREEN)];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickInfoButton",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,t_.openScreenAsync(tP.TOURNAMENT_TUTORIAL_SCREEN)];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return I.apply(this,arguments)})}]),b}(eo)).prototype,"container",[$t,$n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s=L($a.prototype,"screen",[$i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$r=$a))||$r)||$r),U._RF.pop(),U._RF.push({},"daa70r49mtGR6iXhcKLcS3q","Loading",void 0);var $w,$S,$T,$C,$A,$_,$P,$I,$B,$R,$E,$L=$.ccclass;$.property,$L("Loading")(function(P){C(u,P);var I,R,E=A(u);function u(){return o(this,u),E.apply(this,arguments)}return a(u,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){eh.addPersistRootNode(this.node)}},{key:"show",value:(R=B(function(a){return _ts_generator(this,function(a){return this.node.active=!0,[2]})}),function(a){return R.apply(this,arguments)})},{key:"hide",value:(I=B(function(a){var o;return _ts_generator(this,function(a){return null!=(o=this.node)&&o.active&&(this.node.active=!1),[2]})}),function(a){return I.apply(this,arguments)})}]),u}(eo)),U._RF.pop(),U._RF.push({},"d6100IJcgFEhaKEAyNbhT0H","ContainerPurchaseCanceled",void 0);var $O,$N,$F,$D,$M,$x,$z,$G,$q,$U,$H,$W,$V,$K,$Y=$.ccclass,$j=$.property,$X=($w=$Y("ContainerPurchaseCanceled"),$S=$j(ef),$T=tj.required,$C=$j(ef),$A=tj.required,$_=$j(Bg),$P=tj.required,$w(($B=L(($I=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"closeButton",$B,N(a)),O(a,"continueButton",$R,N(a)),O(a,"glowDot",$E,N(a)),a}return a(u,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,u)}},{key:"onClickCloseButton",set:function(a){this.closeButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickContinueButton",set:function(a){this.continueButton.node.on(ef.EventType.CLICK,a)}},{key:"prepareAnim",value:function(){this.node.scale=new ei(.5,.5),this.glowDot.prepareGlow()}},{key:"fadeIn",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.node).to(.3,{scale:ei.ONE},{easing:"backOut"}),[2,(this.glowDot.runGlow(),ts.runTweenAsync(a))]})}),function(){return R.apply(this,arguments)})},{key:"fadeOut",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.node).to(.3,{scale:new ei(.5,.5)},{easing:"backIn"}),[2,(this.glowDot.stopGlow(),ts.runTweenAsync(a))]})}),function(){return I.apply(this,arguments)})}]),u}(eo)).prototype,"closeButton",[$S,$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$R=L($I.prototype,"continueButton",[$C,$A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$E=L($I.prototype,"glowDot",[$_,$P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$I))||$I);U._RF.pop(),U._RF.push({},"2626b4H3BZNTK9Yb9hova4r","PurchaseCanceledScreen",void 0);var $J,$Z,$Q,$$,$0,$1,$2,$3,$4,$5,$6,$7,$8,$9,eee,eet,een,eei,eer,eea,eeo,ees,eel,eeu,eec,eeh,eep,eed,eef,eey,eev,eem,eeg,eeb,eek,eew,eeS,eeT,eeC,eeA,ee_,eeP,eeI,eeB,eeR,eeE,eeL,eeO=$.ccclass,eeN=$.property,eeF=$.disallowMultiple,eeD=$.requireComponent,eeM=GameCore.Events,eex=globalThis.game.event;$O=eeO("PurchaseCanceledScreen"),$N=eeD(Bi),$F=eeN(W),$D=tj.required,$M=eeN($X),$x=tj.required,$z=tj.required,$G=tj.required,$O($q=eeF($q=$N(($H=L(($U=function(P){C(v,P);var I,R,E,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"backgroundSprite",$H,N(a)),O(a,"container",$W,N(a)),O(a,"screen",$V,N(a)),O(a,"uiOpacity",$K,N(a)),a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("PurchaseCanceledScreen: screen not found");a.validateEventPayload(o)&&a.prepareScreen()},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(v,[{key:"__preload",value:function(){this.initComponents(),this.listenScreenEvents(),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this)}},{key:"initComponents",value:function(){this.screen=this.getComponent(Bi),this.uiOpacity=this.getComponent(ea),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,v)}},{key:"listenScreenEvents",value:function(){eex.on(eeM.OPENING_SCREEN,this.handleOpeningScreen),eex.on(eeM.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"unListenScreenEvents",value:function(){eex.off(eeM.OPENING_SCREEN,this.handleOpeningScreen),eex.off(eeM.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"onLoad",value:function(){this.registryEvents(),this.updateLandscapeOrPortraitStyle()}},{key:"registryEvents",value:function(){var a=this;this.container.onClickCloseButton=function(){a.handleClickCloseButton()},this.container.onClickContinueButton=function(){a.handleClickContinueButton()}}},{key:"updateLandscapeOrPortraitStyle",value:function(){var a=this.backgroundSprite.getComponent(eX),o=this.backgroundSprite.getComponent(en);if(a&&o){var C=nr.isPortrait();if(a.isAlignLeft=C,a.isAlignRight=C,C&&(a.left=0,a.right=0),!C){var A=o.contentSize.height;o.setContentSize(2483,A)}}}},{key:"handleClickCloseButton",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,t_.closeScreenAsync(tP.PURCHASE_CANCELED_SCREEN)];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return M.apply(this,arguments)})},{key:"handleClickContinueButton",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,t_.closeScreenAsync(tP.PURCHASE_CANCELED_SCREEN)];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return D.apply(this,arguments)})},{key:"closeScreenAsync",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.POPUP_OFF),[4,Promise.all([this.container.fadeOut(),this.fadeOut()])];case 1:return a.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"fadeOut",value:(L=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.uiOpacity).to(.25,{opacity:0}),[2,ts.runTweenAsync(a)]})}),function(){return L.apply(this,arguments)})},{key:"prepareScreen",value:function(){this.uiOpacity.opacity=0,this.container.prepareAnim(),this.prepareBackground()}},{key:"prepareBackground",value:function(){this.backgroundSprite.spriteFrame=td.gameScene.background.getCurrentLevelGameBg(),this.resizeGamePlayBg()}},{key:"resizeGamePlayBg",value:function(){if(!nr.isPortrait()){var a=td.gameScene.background.getUITransform();if(a){var o=this.backgroundSprite.getComponent(en);if(o){var C=a.width,A=a.height;o.setContentSize(C,A)}}}}},{key:"open",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.enabled)return[3,2];return th.playSound(tZ.POPUP_SHOW),[4,Promise.all([this.container.fadeIn(),this.fadeIn()])];case 1:a.sent(),eex.emit(eeM.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),eex.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),a.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"fadeIn",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.uiOpacity).to(.25,{opacity:255}),[2,ts.runTweenAsync(a)]})}),function(){return R.apply(this,arguments)})},{key:"close",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.closeScreenAsync()];case 1:return a.sent(),this.node.active=!1,eex.emit(eeM.CLOSED_SCREEN,{screenName:this.node.name}),eex.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return I.apply(this,arguments)})},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}}]),v}(eo)).prototype,"backgroundSprite",[$F,$D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$W=L($U.prototype,"container",[$M,$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$V=L($U.prototype,"screen",[$z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$K=L($U.prototype,"uiOpacity",[$G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$q=$U))||$q)||$q),U._RF.pop(),U._RF.push({},"05302plWz5KqqtDgSrhdAv/","ScoreDisplay",void 0);var eez,eeG,eeq,eeU,eeH,eeW,eeV,eeK,eeY,eej,eeX,eeJ,eeZ,eeQ,ee$,ee0,ee1,ee2,ee3,ee4,ee5=$.ccclass,ee6=$.property,ee7=["en","br"],ee8=($J=ee5("ScoreDisplay"),$Z=ee6(W),$Q=tj.required,$$=ee6(W),$0=tj.required,$1=ee6(er),$2=tj.required,$3=ee6(er),$4=tj.required,$5=ee6(er),$6=tj.required,$7=ee6(er),$8=tj.required,$9=ee6(W),eee=tj.required,eet=ee6(W),een=tj.required,eei=ee6(W),eer=tj.required,eea=ee6([et]),eeo=tj.required(ni(et)),ees=ee6([et]),eel=tj.required(ni(et)),eeu=ee6([et]),eec=tj.required(ni(et)),eeh=ee6(et),eep=tj.required,eed=tj.required,eef=tj.required,eey=tj.required,$J((eem=L((eev=function(P){C(v,P);var I,R,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"yourPhoto",eem,N(a)),O(a,"opponentPhoto",eeg,N(a)),O(a,"yourName",eeb,N(a)),O(a,"opponentName",eek,N(a)),O(a,"yourScore",eew,N(a)),O(a,"opponentScore",eeS,N(a)),O(a,"resultSprite",eeT,N(a)),O(a,"resultGlowEffect",eeC,N(a)),O(a,"titleGlowEffect",eeA,N(a)),O(a,"titleSpriteFrames",ee_,N(a)),O(a,"resultGlowSpriteFrames",eeP,N(a)),O(a,"titleGlowSpriteFrames",eeI,N(a)),O(a,"defaultPhotoSpriteFrame",eeB,N(a)),O(a,"yourPhotoUITransform",eeR,N(a)),O(a,"opponentPhotoUITransform",eeE,N(a)),O(a,"resultSpriteUIOpacity",eeL,N(a)),a.scoreUIOpacityComponents=[],a.resultSpriteOriginalPosition=new ei,a.titleSpriteFramesMap=new Map,a}return a(v,[{key:"__preload",value:function(){this.yourPhotoUITransform=this.yourPhoto.getComponent(en),this.opponentPhotoUITransform=this.opponentPhoto.getComponent(en),this.resultSpriteOriginalPosition=this.resultSprite.node.position.clone(),this.resultSpriteUIOpacity=this.resultSprite.addComponent(ea);for(var a=0,o=["You","Score","Opponent"];a<o.length;a++){var C,A=o[a],P=this.node.getChildByName(A);if(P){var I=null!=(C=P.getComponent(ea))?C:P.addComponent(ea);this.scoreUIOpacityComponents.push(I)}}this.validateRequiredComponents(),this.initTitleSpriteFramesMap()}},{key:"initTitleSpriteFramesMap",value:function(){for(var a,o=0,C=0,A=0;A<this.titleSpriteFrames.length;A++){0!==A&&A%4==0&&o++;var P=null!=(a=this.titleSpriteFramesMap.get(ee7[o]))?a:[];P.push(this.titleSpriteFrames[C++]),this.titleSpriteFramesMap.set(ee7[o],P)}}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,v)}},{key:"setYourName",value:function(a){this.yourName.string=a}},{key:"setOpponentName",value:function(a){this.opponentName.string=a}},{key:"setYourScore",value:function(a){this.yourScore.string=a.toString()}},{key:"setOpponentScore",value:function(a){this.opponentScore.string=a}},{key:"setYourPhoto",value:function(a){var o=this;D4.loadProfilePhotoAsync(a).then(function(a){o.yourPhoto.spriteFrame=a,o.yourPhotoUITransform.setContentSize(135,134)})}},{key:"setYourPhotoSpriteFrame",value:function(a){this.yourPhoto.spriteFrame=null===a?this.defaultPhotoSpriteFrame:a,this.yourPhotoUITransform.setContentSize(215,215)}},{key:"setOpponentPhotoSpriteFrame",value:function(a){this.opponentPhoto.spriteFrame=null===a?this.defaultPhotoSpriteFrame:a,this.opponentPhotoUITransform.setContentSize(215,215)}},{key:"setResult",value:function(a){this.toggleResultGlowEffect(!0),this.toggleTitleGlowEffect(!1);var o=globalThis.game.language.getCurrentLocale(),C=this.titleSpriteFramesMap.get(o);C&&("win"===a?(this.toggleTitleGlowEffect(!0),this.resultSprite.spriteFrame=C[0],this.resultGlowEffect.spriteFrame=this.resultGlowSpriteFrames[0],this.titleGlowEffect.spriteFrame=this.titleGlowSpriteFrames[0]):"lose"===a?(this.toggleTitleGlowEffect(!0),this.resultSprite.spriteFrame=C[1],this.resultGlowEffect.spriteFrame=this.resultGlowSpriteFrames[1],this.titleGlowEffect.spriteFrame=this.titleGlowSpriteFrames[1]):"draw"===a?(this.toggleTitleGlowEffect(!0),this.resultSprite.spriteFrame=C[2],this.resultGlowEffect.spriteFrame=this.resultGlowSpriteFrames[2],this.titleGlowEffect.spriteFrame=this.titleGlowSpriteFrames[2]):(this.toggleResultGlowEffect(!1),this.resultSprite.spriteFrame=C[3]))}},{key:"toggleResultGlowEffect",value:function(a){this.resultGlowEffect.node.active=a}},{key:"toggleTitleGlowEffect",value:function(a){this.titleGlowEffect.node.active=a}},{key:"prepareFadeIn",value:function(){this.node.scale=new ei(1,1,1);var a=510/635;this.resultSprite.node.setScale(a,a,1),this.resultSprite.node.position=new ei(this.resultSpriteOriginalPosition.x,this.resultSpriteOriginalPosition.y-92,this.resultSpriteOriginalPosition.z),this.resultSpriteUIOpacity.opacity=0;var o,C=E(this.scoreUIOpacityComponents);try{for(C.s();!(o=C.n()).done;)o.value.opacity=0}catch(a){C.e(a)}finally{C.f()}}},{key:"fadeIn",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.fadeInResultSprite()];case 1:return a.sent(),[4,this.fadeInScoreUIOpacityComponents()];case 2:return a.sent(),[2]}})}),function(){return M.apply(this,arguments)})},{key:"fadeOut",value:(D=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.fadeOutResultSprite(),this.fadeOutScoreUIOpacityComponents()])]})}),function(){return D.apply(this,arguments)})},{key:"fadeInResultSprite",value:(F=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([Y(this.resultSprite.node).to(.2,{position:this.resultSpriteOriginalPosition},{easing:"sineOut"}),Y(this.resultSprite.node).to(.35,{scale:ei.ONE},{easing:te(.17,.47,0,1.02)}),Y(this.resultSpriteUIOpacity).to(.2,{opacity:255},{easing:"sineOut"})].map(function(){var a=B(function(a){return _ts_generator(this,function(o){return[2,ts.runTweenAsync(a)]})});return function(o){return a.apply(this,arguments)}}()))]})}),function(){return F.apply(this,arguments)})},{key:"fadeInScoreUIOpacityComponents",value:(L=B(function(){return _ts_generator(this,function(a){return[2,Promise.all(this.scoreUIOpacityComponents.map(function(){var a=B(function(a){var o;return _ts_generator(this,function(C){return o=Y(a).delay(.1).to(.3,{opacity:255}),[2,ts.runTweenAsync(o)]})});return function(o){return a.apply(this,arguments)}}()))]})}),function(){return L.apply(this,arguments)})},{key:"fadeOutResultSprite",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.resultSpriteUIOpacity).to(.2,{opacity:0},{easing:"sineOut"}),[2,ts.runTweenAsync(a)]})}),function(){return R.apply(this,arguments)})},{key:"fadeOutScoreUIOpacityComponents",value:(I=B(function(){return _ts_generator(this,function(a){return[2,Promise.all(this.scoreUIOpacityComponents.map(function(a){var o=Y(a).to(.3,{opacity:0},{easing:"sineOut"});return ts.runTweenAsync(o)}))]})}),function(){return I.apply(this,arguments)})}]),v}(eo)).prototype,"yourPhoto",[$Z,$Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeg=L(eev.prototype,"opponentPhoto",[$$,$0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeb=L(eev.prototype,"yourName",[$1,$2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eek=L(eev.prototype,"opponentName",[$3,$4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eew=L(eev.prototype,"yourScore",[$5,$6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeS=L(eev.prototype,"opponentScore",[$7,$8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeT=L(eev.prototype,"resultSprite",[$9,eee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeC=L(eev.prototype,"resultGlowEffect",[eet,een],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeA=L(eev.prototype,"titleGlowEffect",[eei,eer],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee_=L(eev.prototype,"titleSpriteFrames",[eea,eeo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eeP=L(eev.prototype,"resultGlowSpriteFrames",[ees,eel],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eeI=L(eev.prototype,"titleGlowSpriteFrames",[eeu,eec],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eeB=L(eev.prototype,"defaultPhotoSpriteFrame",[eeh,eep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeR=L(eev.prototype,"yourPhotoUITransform",[eed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeE=L(eev.prototype,"opponentPhotoUITransform",[eef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeL=L(eev.prototype,"resultSpriteUIOpacity",[eey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eev))||eev);U._RF.pop(),U._RF.push({},"2c1be98N5pJoYaRsu6xWHcd","ContainerResultChallengeFriends",void 0);var ee9,ete,ett,etn,eti,etr,eta,eto,ets,etl,etu,etc,eth=$.ccclass,etp=$.property,etd=(eez=eth("ContainerResultChallengeFriends"),eeG=etp(ee8),eeq=tj.required,eeU=etp(ef),eeH=tj.required,eeW=etp(ef),eeV=tj.required,eeK=etp(ee),eeY=tj.required,eej=tj.required,eeX=tj.required,eeJ=tj.required,eez((eeQ=L((eeZ=function(P){C(g,P);var I,R,L,F,D,M,x,q=A(g);function g(){var a;o(this,g);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=q.call.apply(q,[this].concat(A)),O(a,"scoreDisplay",eeQ,N(a)),O(a,"newMatchButton",ee$,N(a)),O(a,"mapButton",ee0,N(a)),O(a,"footer",ee1,N(a)),O(a,"containerUIOpacity",ee2,N(a)),O(a,"newMatchButtonUIOpacity",ee3,N(a)),O(a,"mapButtonUIOpacity",ee4,N(a)),a.displayResultScores={your:1400,opponent:1300},a}return a(g,[{key:"onClickNewMatchButton",set:function(a){this.newMatchButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickMapButton",set:function(a){this.mapButton.node.on(ef.EventType.CLICK,a)}},{key:"__preload",value:function(){this.containerUIOpacity=this.getComponent(ea),this.newMatchButtonUIOpacity=this.getNodeUIOpacity(this.newMatchButton.node),this.mapButtonUIOpacity=this.getNodeUIOpacity(this.mapButton.node),this.validateRequiredComponents()}},{key:"getNodeUIOpacity",value:function(a){var o;return null!=(o=a.getComponent(ea))?o:a.addComponent(ea)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,g)}},{key:"prepareContainer",value:function(a){this.containerUIOpacity.opacity=255,this.updateResultInfo(a)}},{key:"clearResultInfo",value:function(){this.scoreDisplay.setOpponentName(""),this.scoreDisplay.setYourScore(0),this.scoreDisplay.setOpponentScore("???"),this.scoreDisplay.setOpponentPhotoSpriteFrame(null)}},{key:"updateResultInfo",value:function(a){var o=a.newestScore,C=a.resultInfo;if(C){var A=C.playerScore,P=C.playerName,I=C.playerPhoto,B=C.opponentName,R=C.opponentPhoto,E=C.opponentScore,L=C.status;this.scoreDisplay.setYourName(P),this.setYourAvatar(I),this.scoreDisplay.setOpponentName(B),this.setOpponentAvatar(R),this.scoreDisplay.setYourScore(0);var O="???";"waiting"!==L&&(O=E.toString()),this.scoreDisplay.setOpponentScore(O),this.scoreDisplay.setResult(L),this.displayResultScores={your:o>A?o:A,opponent:"???"===O?"???":E}}}},{key:"setYourAvatar",value:function(a){var o=this;this.scoreDisplay.setYourPhotoSpriteFrame(null),D4.loadProfilePhotoAsync(a).then(function(a){o.scoreDisplay.setYourPhotoSpriteFrame(a)})}},{key:"setOpponentAvatar",value:function(a){var o=this;this.scoreDisplay.setOpponentPhotoSpriteFrame(null),D4.loadProfilePhotoAsync(a).then(function(a){o.scoreDisplay.setOpponentPhotoSpriteFrame(a)})}},{key:"prepareFadeIn",value:function(){this.scoreDisplay.prepareFadeIn();var a,o=this.getFooterButtonTuples(),C=E(o);try{for(C.s();!(a=C.n()).done;){var A=z(a.value,2),P=A[0],I=A[1];P.node.setScale(0,0,0),I.opacity=0}}catch(a){C.e(a)}finally{C.f()}}},{key:"fadeIn",value:(x=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.runFadeInComponentsAnimation(),this.runScoreCounterAnimation()])]})}),function(){return x.apply(this,arguments)})},{key:"fadeOut",value:(M=B(function(){return _ts_generator(this,function(a){return[2,this.runFadeOutComponentsAnimation()]})}),function(){return M.apply(this,arguments)})},{key:"runFadeOutComponentsAnimation",value:(D=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.scoreDisplay.fadeOut(),this.fadeOutButtons()])]})}),function(){return D.apply(this,arguments)})},{key:"runFadeInComponentsAnimation",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.scoreDisplay.fadeIn()];case 1:return a.sent(),[4,this.fadeInButtons()];case 2:return a.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"fadeInButtons",value:(L=B(function(){return _ts_generator(this,function(a){return[2,Promise.all(this.getFooterButtonTuples().map(function(){var a=B(function(a,o){var C,A,P,I;return _ts_generator(this,function(R){return A=(C=z(a,2))[0],P=C[1],I=.15*o,[2,Promise.all([Y(A.node).delay(I).to(.3,{scale:ei.ONE},{easing:"cubicOut"}),Y(P).delay(I).to(.3,{opacity:255},{easing:"cubicOut"})].map(function(){var a=B(function(a){return _ts_generator(this,function(o){return[2,ts.runTweenAsync(a)]})});return function(o){return a.apply(this,arguments)}}()))]})});return function(o,C){return a.apply(this,arguments)}}()))]})}),function(){return L.apply(this,arguments)})},{key:"fadeOutButtons",value:(R=B(function(){return _ts_generator(this,function(a){return[2,Promise.all(this.getFooterButtonTuples().map(function(){var a=B(function(a){var o,C;return _ts_generator(this,function(A){return o=z(a,2)[1],C=Y(o).to(.3,{opacity:0},{easing:"cubicOut"}),[2,ts.runTweenAsync(C)]})});return function(o){return a.apply(this,arguments)}}()))]})}),function(){return R.apply(this,arguments)})},{key:"getFooterButtonTuples",value:function(){return[[this.newMatchButton,this.newMatchButtonUIOpacity],[this.mapButton,this.mapButtonUIOpacity]]}},{key:"runScoreCounterAnimation",value:(I=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){return a=this,C=(o=this.displayResultScores).your,A=o.opponent,P=[ts.makeTweenCounter({from:0,to:C,duration:2,easing:"cubicInOut",onUpdate:function(o){var A=Math.floor(o);a.scoreDisplay.setYourScore(A),A%4==0&&0!==A&&th.playSound(tZ.SCORE_INCREASE_SINGLE,{volume:.3,allowMultiple:!0}),A===C&&0!==A&&th.playSound(tZ.SCORE_INCREASE_END,{volume:.3,allowMultiple:!0})}}).delay(.35)],[2,("???"!==A&&P.push(ts.makeTweenCounter({from:0,to:A,duration:2,easing:"cubicInOut",onUpdate:function(o){var C=Math.floor(o);a.scoreDisplay.setOpponentScore(C.toString())}}).delay(.35)),Promise.all(P.map(function(){var a=B(function(a){return _ts_generator(this,function(o){return[2,ts.runTweenAsync(a)]})});return function(o){return a.apply(this,arguments)}}())))]})}),function(){return I.apply(this,arguments)})}]),g}(eo)).prototype,"scoreDisplay",[eeG,eeq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee$=L(eeZ.prototype,"newMatchButton",[eeU,eeH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee0=L(eeZ.prototype,"mapButton",[eeW,eeV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee1=L(eeZ.prototype,"footer",[eeK,eeY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee2=L(eeZ.prototype,"containerUIOpacity",[eej],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee3=L(eeZ.prototype,"newMatchButtonUIOpacity",[eeX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee4=L(eeZ.prototype,"mapButtonUIOpacity",[eeJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eeZ))||eeZ);U._RF.pop(),U._RF.push({},"b6e7ean6U9FsLxvu9gG68ac","ResultChallengeFriendsScreen",void 0);var etf,ety,etv,etm,etg,etb,etk,etw,etS,etT,etC,etA,et_,etP,etI,etB,etR,etE,etL,etO,etN,etF,etD,etM,etx,etz,etG=$.ccclass,etq=$.property,etU=GameCore.Events,etH=globalThis.game.event;ee9=etG("ResultChallengeFriendsScreen"),ete=etq(etd),ett=tj.required,etn=etq(_Q),eti=tj.required,etr=tj.required,eta=tj.required,ee9((ets=L((eto=function(P){C(m,P);var I,R,E,L,F,D,M,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=z.call.apply(z,[this].concat(A)),O(a,"container",ets,N(a)),O(a,"confetti",etl,N(a)),O(a,"screen",etu,N(a)),O(a,"screenUIOpacity",etc,N(a)),a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("ChallengeFriendsScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},a.prepareFadeIn(),a.prepareOpen())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(m,[{key:"screenData",get:function(){return this.screen.data}},{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screenUIOpacity=this.getComponent(ea),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,m)}},{key:"onLoad",value:function(){this.registryEvents(),this.updateContainerWidget()}},{key:"registryEvents",value:function(){var a=this;this.container.onClickNewMatchButton=function(){a.handleNewMatchButtonClick()},this.container.onClickMapButton=function(){a.handleMapButtonClick()}}},{key:"updateContainerWidget",value:function(){try{var a=tf.getBannerAdWorldHeight();if(a<=0)return;var o=this.container.getComponent(eX);if(!o)return;o.bottom+=a,o.updateAlignment()}catch(a){return}}},{key:"listenScreenEvents",value:function(){etH.on(etU.OPENING_SCREEN,this.handleOpeningScreen),etH.on(etU.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){etH.off(etU.OPENING_SCREEN,this.handleOpeningScreen),etH.off(etU.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"prepareOpen",value:function(){this.container.prepareContainer(this.screenData)}},{key:"open",value:(x=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.enabled)return[3,2];return[4,this.fadeIn()];case 1:C.sent(),"win"===(null==(a=tb.getResultStatus())?void 0:a.status)&&this.confetti.playEffect(),(o=this.container.getComponent(ea))&&(o.opacity=255),etH.emit(etU.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),etH.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),C.label=2;case 2:return[2]}})}),function(){return x.apply(this,arguments)})},{key:"close",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.fadeOut()];case 1:return a.sent(),this.container.clearResultInfo(),this.confetti.stopEffect(),this.node.active=!1,etH.emit(etU.CLOSED_SCREEN,{screenName:this.node.name}),etH.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return M.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"handleNewMatchButtonClick",value:(D=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),a=window.game.match.getMatchState().mode,o=td.gameScene.gamePlay.gameUI.header,C=td.gameScene.uiManager,"challenge-friend"===a&&o.disableChallengeBlock(),"single"!==a&&null!==a&&td.gameScene.gamePlay.resetSingleMode(),[4,t_.closeScreenAsync(tP.RESULT_CHALLENGE_FRIENDS_SCREEN)];case 1:return A.sent(),[4,C.openChallengeFriendScreenAsync()];case 2:return A.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return D.apply(this,arguments)})},{key:"handleMapButtonClick",value:(F=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(td.gameScene.toggleBlockInputContainer(!0),o=(a=td.gameScene.gamePlay).gameUI,a.stepLogHandler.logAllRemainingSteps(),"challenge-friend"===(C=window.game.match.getMatchState().mode)&&o.header.disableChallengeBlock(),!("single"!==C&&null!==C))return[3,2];return[4,tb.processStartMatchWithoutLogMatchStart(function(){return tb.startMatchAsync("single")})];case 1:I.sent(),td.gameScene.rubyBarComp.runWidgetRightTypeUpdateAnimation("default"),td.gameScene.gamePlay.resetSingleMode(),I.label=2;case 2:return P=(A=this.screenData).playingLevel!==A.playerLevel,th.playMusic(tZ.DASHBOARD_MUSIC),td.gameScene.toggleBlockInputContainer(!0),a.isTutorialLevel()&&(a.tileManager.resetTileTutorial(),a.tileManager.tutorialHand.stopAnimationTutorialHand()),[4,Promise.all([a.gameUI.fadeOutGameScreen({shouldHideRubyBar:!0}),t_.closeScreenAsync(tP.RESULT_CHALLENGE_FRIENDS_SCREEN)])];case 3:return I.sent(),P&&td.gameScene.restartLevel(),[4,ts.waitTweenAsync(.1)];case 4:return I.sent(),[4,td.gameScene.transition.processBackToDashboard()];case 5:return I.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return F.apply(this,arguments)})},{key:"prepareFadeIn",value:function(){this.container.prepareFadeIn(),this.screenUIOpacity.opacity=0}},{key:"fadeIn",value:(L=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.fadeInScreen(),this.container.fadeIn()])]})}),function(){return L.apply(this,arguments)})},{key:"fadeOut",value:(E=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.fadeOutScreen(),this.container.fadeOut()])]})}),function(){return E.apply(this,arguments)})},{key:"fadeInScreen",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.screenUIOpacity).to(.3,{opacity:255},{easing:"cubicOut"}),[2,ts.runTweenAsync(a)]})}),function(){return R.apply(this,arguments)})},{key:"fadeOutScreen",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=Y(this.screenUIOpacity).to(.3,{opacity:0},{easing:"quadOut"}),[2,ts.runTweenAsync(a)]})}),function(){return I.apply(this,arguments)})}]),m}(eo)).prototype,"container",[ete,ett],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etl=L(eto.prototype,"confetti",[etn,eti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etu=L(eto.prototype,"screen",[etr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etc=L(eto.prototype,"screenUIOpacity",[eta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eto)),U._RF.pop(),U._RF.push({},"0788fsdKdBBjrR2qqiYcS3K","ResultDailyScreen",void 0);var etW,etV,etK,etY,etj,etX,etJ,etZ,etQ,et$,et0,et1,et2,et3,et4,et5,et6,et7,et8,et9,ene,ent,enn,eni,enr,ena,eno,ens,enl,enu,enc,enh,enp,end,enf,eny,env,enm,eng,enb,enk,enw,enS,enT,enC,enA,en_,enP,enI,enB,enR,enE,enL,enO=$.ccclass,enN=$.property,enF=$.disallowMultiple,enD=$.requireComponent,enM=GameCore.Events,enx=globalThis.game,enz=enx.event,enG=enx.event;etf=enO("ResultDailyScreen"),ety=enD(Bi),etv=enN(ef),etm=tj.required,etg=enN(W),etb=tj.required,etk=enN(W),etw=tj.required,etS=enN(pj),etT=tj.required,etC=enN(ee),etA=tj.required,et_=enN(ee),etP=tj.required,etI=tj.required,etB=tj.required,etf(etR=enF(etR=ety((etL=L((etE=function(P){C(b,P);var I,R,L,F,D,M,x,z,q,U=A(b);function b(){var a;o(this,b);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=U.call.apply(U,[this].concat(A)),O(a,"continueButton",etL,N(a)),O(a,"gamePlayBg",etO,N(a)),O(a,"imageFrame",etN,N(a)),O(a,"flyUpEffect",etF,N(a)),O(a,"loadingFrame",etD,N(a)),O(a,"popUpContainer",etM,N(a)),O(a,"screen",etx,N(a)),O(a,"textLoading",etz,N(a)),a.dotsLoading=[],a.originalDotPosition=[],a.dotLoadingTweens=[],a.textTween=void 0,a.nextButtonBubbleTween=null,a.ribbonPurple=null,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("ResultDailyScreen: screen not found");a.validateEventPayload(o)&&(th.playMusic(tZ.WIN_MUSIC),a.updateGamePlayBgAndImageFrame(o),a.prepareOpenScreen())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(b,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.listenScreenEvents(),this.registryButtonEvents(),this.setUpBubbleButtons(),this.setUpLoadingNode(),this.createRibbonSpine(),this.validateRequiredComponents()}},{key:"createRibbonSpine",value:function(){var a=td.gameScene.gamePlay.loader.getSpinePrefab(kf.WONDERFUL_RIBBON);if(a){var o=ej(a);o.setParent(this.popUpContainer);var C=o.getComponent(A3);C&&(this.ribbonPurple=C)}}},{key:"setUpLoadingNode",value:function(){for(var a=0;a<this.loadingFrame.children.length;a++)if(this.loadingFrame.children[a].name.includes("dot")){var o=this.loadingFrame.children[a];this.dotsLoading.push(o),this.originalDotPosition.push(o.position.clone())}else this.textLoading=this.loadingFrame.children[a]}},{key:"resetLoadingNode",value:function(){this.stopDotStampAnimation(),this.stopTextLoadingAnimation();for(var a=0;a<this.dotsLoading.length;a++)this.dotsLoading[a].setPosition(this.originalDotPosition[a])}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,b)}},{key:"listenScreenEvents",value:function(){enz.on(enM.OPENING_SCREEN,this.handleOpeningScreen),enz.on(enM.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){enz.off(enM.OPENING_SCREEN,this.handleOpeningScreen),enz.off(enM.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"registryButtonEvents",value:function(){this.continueButton.node.on(ef.EventType.CLICK,this.handleClickedContinueBtn,this)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"open",value:(q=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.resetGamePlayBg(),this.flyUpEffect.play(),this.ribbonPurple&&this.ribbonPurple.fadeIn(),this.updatePassLevelAndPassLevelInRowDailyMissions(),[4,this.playAnimShowContainer()];case 1:return a.sent(),[4,this.playTweenShowMapAndNextButton()];case 2:return a.sent(),enz.emit(enM.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),enG.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return q.apply(this,arguments)})},{key:"close",value:(z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.POPUP_OFF),this.flyUpEffect.stop(),this.ribbonPurple&&this.ribbonPurple.fadeOut(),[4,Promise.all([this.playAnimCloseContainer(),this.playAnimCloseGamePlayBg()])];case 1:return a.sent(),this.node.active=!1,enz.emit(enM.CLOSED_SCREEN,{screenName:this.node.name}),enz.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return z.apply(this,arguments)})},{key:"handleClickedContinueBtn",value:(x=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,tb.processStartMatchWithoutLogMatchStart(function(){return tb.startMatchAsync("single")})];case 1:return a.sent(),th.playMusic(tZ.DASHBOARD_MUSIC),[4,Promise.all([t_.closeScreenAsync(tP.RESULT_DAILY_SCREEN),td.gameScene.uiManager.openDashboardScreenAsync()])];case 2:return a.sent(),td.gameScene.gamePlay.resetSingleMode(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return x.apply(this,arguments)})},{key:"prepareOpenScreen",value:function(){this.ribbonPurple||this.createRibbonSpine(),this.stopNextButtonAnimation(),this.runNextButtonAnimation();var a=this.screen.container.getComponent(ea);a&&(a.opacity=255,this.ribbonPurple&&this.ribbonPurple.prepareFadeIn(),this.resetContainer(),this.resetNextButton())}},{key:"updateGamePlayBgAndImageFrame",value:(M=B(function(a){var o,C,A,P,I,B;return _ts_generator(this,function(R){switch(R.label){case 0:if((o=td.gameScene.background.getCurrentBackground())&&(this.gamePlayBg.spriteFrame=o),this.resizeGamePlayBg(),C=td.gameScene.gamePlay.loader,A=a.screenData.stampName.split("-0")[1],P="card-bg-".concat(A),this.loadingFrame.active=!1,!!C.checkIsAlreadyPhoto(P))return[3,4];this.loadingFrame.active=!0,this.playLoadingAnimation(),R.label=1;case 1:return R.trys.push([1,3,,4]),[4,C.loadPhotoCardsAsync(P)];case 2:if(!R.sent())return[2,void 0];return I=C.getPhotoFrame(P),[2,(this.imageFrame.spriteFrame=I,void this.stopLoadingAnimation())];case 3:return R.sent(),[2,void 0];case 4:return B=C.getPhotoFrame(P),this.imageFrame.spriteFrame=B,[2]}})}),function(a){return M.apply(this,arguments)})},{key:"resizeGamePlayBg",value:function(){if(!nr.isPortrait()){var a=td.gameScene.background.getUITransform();if(a){var o=this.gamePlayBg.getComponent(en);if(o){var C=a.width,A=a.height;o.setContentSize(C,A)}}}}},{key:"resetContainer",value:function(){var a=510/635;this.screen.container.scale=new ei(a,a,1);var o=this.screen.container.getComponent(ea);o&&(o.opacity=.5)}},{key:"resetNextButton",value:function(){var a=this.continueButton.getComponent(ea);a&&(a.opacity=0)}},{key:"playAnimShowContainer",value:(D=B(function(){var a,o;return _ts_generator(this,function(C){if(a=this,o=this.screen.container.getComponent(ea))return[2,(Y(o).to(.095,{opacity:255},{easing:"smooth"}).start(),new Promise(function(o){Y(a.screen.container).to(.35,{scale:new ei(1,1,1)},{easing:tt(.17,.47,0,1.02)}).call(function(){o()}).start()}))];return[2]})}),function(){return D.apply(this,arguments)})},{key:"playTweenShowMapAndNextButton",value:(F=B(function(){var a;return _ts_generator(this,function(o){if(a=this.continueButton.getComponent(ea))return[2,new Promise(function(o){Y(a).delay(.05).to(.233,{opacity:255}).call(function(){o()}).start()})];return[2]})}),function(){return F.apply(this,arguments)})},{key:"playAnimCloseContainer",value:(L=B(function(){var a,o,C;return _ts_generator(this,function(A){if(a=this,o=510/635,C=this.screen.container.getComponent(ea))return[2,new Promise(function(A){Y(C).to(.25,{opacity:0}).start(),Y(a.screen.container).to(.3,{scale:new ei(o,o,1)},{easing:"backIn"}).call(function(){A()}).start()})];return[2]})}),function(){return L.apply(this,arguments)})},{key:"playAnimCloseGamePlayBg",value:(R=B(function(){var a;return _ts_generator(this,function(o){if(a=this.gamePlayBg.node.getComponent(ea))return[2,new Promise(function(o){Y(a).to(.25,{opacity:0}).call(function(){o()}).start()})];return[2]})}),function(){return R.apply(this,arguments)})},{key:"resetGamePlayBg",value:function(){var a=this.gamePlayBg.node.getComponent(ea);a&&(a.opacity=255,this.gamePlayBg.node.scale=new ei(1,1,1))}},{key:"playLoadingAnimation",value:function(){this.resetLoadingNode();var a=this.loadingFrame.getComponent(ea);a&&(a.opacity=255,this.playDotAnimation(),this.playTextLoadingAnimation())}},{key:"stopLoadingAnimation",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.resetLoadingNode(),!(a=this.loadingFrame.getComponent(ea)))return[3,2];return o=Y(a).to(.5,{opacity:0},{easing:"cubicOut"}),[4,ts.runTweenAsync(o)];case 1:C.sent(),this.stopDotStampAnimation(),this.stopTextLoadingAnimation(),C.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"playDotAnimation",value:function(){for(var a=this,o=0;o<this.dotsLoading.length;o++)(function(){var C=a.dotsLoading[o],A=C.position.clone(),P=A.x,I=A.y,B=A.z,R=Y(C).delay(.2*o).to(1,{position:new ei(P,I+3,B)},{easing:"cubicOut"}).call(function(){var o=Y(C).to(.5,{position:new ei(P,I-3,B)},{easing:"cubicOut"}).to(.5,{position:new ei(P,I+3,B)},{easing:"cubicOut"}).union().repeatForever().start();a.dotLoadingTweens.push(o),a.dotLoadingTweens.push(R)}).start()})()}},{key:"playTextLoadingAnimation",value:function(){var a=this.textLoading.getComponent(ea);a&&(this.textTween=Y(a).delay(.2).to(.85,{opacity:127},{easing:tn}).to(.85,{opacity:255},{easing:tn}).union().repeatForever().start())}},{key:"stopDotStampAnimation",value:function(){var a,o=E(this.dotLoadingTweens);try{for(o.s();!(a=o.n()).done;)a.value.stop()}catch(a){o.e(a)}finally{o.f()}this.dotLoadingTweens=[]}},{key:"stopTextLoadingAnimation",value:function(){var a=this.textLoading.getComponent(ea);a&&(a.opacity=255,this.textTween&&this.textTween.stop())}},{key:"runNextButtonAnimation",value:function(){this.nextButtonBubbleTween&&this.nextButtonBubbleTween.start()}},{key:"stopNextButtonAnimation",value:function(){this.nextButtonBubbleTween&&(this.nextButtonBubbleTween.stop(),this.continueButton.node.setScale(1,1,1))}},{key:"setUpBubbleButtons",value:function(){this.nextButtonBubbleTween=ti(this.continueButton.node);var a=this.continueButton.getComponent(az);a&&(a.animationUp=this.nextButtonBubbleTween)}},{key:"updatePassLevelAndPassLevelInRowDailyMissions",value:function(){td.gameScene.gamePlay.updateDailyMissionCount({passLevels:function(a){return a+1},passLevelsInARow:function(a){return a+1}})}}]),b}(eo)).prototype,"continueButton",[etv,etm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etO=L(etE.prototype,"gamePlayBg",[etg,etb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etN=L(etE.prototype,"imageFrame",[etk,etw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etF=L(etE.prototype,"flyUpEffect",[etS,etT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etD=L(etE.prototype,"loadingFrame",[etC,etA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etM=L(etE.prototype,"popUpContainer",[et_,etP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etx=L(etE.prototype,"screen",[etI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etz=L(etE.prototype,"textLoading",[etB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),etR=etE))||etR)||etR),U._RF.pop(),U._RF.push({},"a4a29UTixJBBYbvfhP9KWkS","ResultContainer",void 0);var enq,enU,enH,enW,enV,enK,enY,enj,enX,enJ,enZ,enQ=$.ccclass,en$=$.property,en0=(etW=enQ("ResultContainer"),etV=en$(ef),etK=tj.required,etY=en$(ef),etj=tj.required,etX=en$(ef),etJ=tj.required,etZ=en$(er),etQ=tj.required,et$=en$(er),et0=tj.required,et1=en$(er),et2=tj.required,et3=en$(er),et4=tj.required,et5=en$(er),et6=tj.required,et7=en$(er),et8=tj.required,et9=en$(er),ene=tj.required,ent=en$(uk),enn=tj.required,eni=en$(pj),enr=tj.required,ena=en$(eb),eno=tj.required,ens=en$(eb),enl=tj.required,enu=en$(ee),enc=tj.required,enh=en$(ea),enp=tj.required,end=en$(ee),enf=tj.required,etW((env=L((eny=function(P){C(m,P);var I,R,E,L,F,D,M,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=z.call.apply(z,[this].concat(A)),O(a,"nextLevelButton",env,N(a)),O(a,"shareButton",enm,N(a)),O(a,"adButton",eng,N(a)),O(a,"levelText",enb,N(a)),O(a,"levelLeftText",enk,N(a)),O(a,"quoteTextTop1",enw,N(a)),O(a,"quoteTextTop2",enS,N(a)),O(a,"quoteTextTop3",enT,N(a)),O(a,"quoteTextBot1",enC,N(a)),O(a,"quoteTextBot2",enA,N(a)),O(a,"progressBar",en_,N(a)),O(a,"flyUpEffect",enP,N(a)),O(a,"layoutLevelLeft",enI,N(a)),O(a,"layoutButtonLevel",enB,N(a)),O(a,"title",enR,N(a)),O(a,"textQuote",enE,N(a)),O(a,"giftBox",enL,N(a)),a.levelCompletedPosY=0,a.levelCompletedInitializePosY=0,a.originalGiftBoxPosition=new ei,a.nextButtonBubbleTween=null,a}return a(m,[{key:"__preload",value:function(){this.originalGiftBoxPosition=this.giftBox.position.clone(),tj.validateRequiredProperties(this,m),this.setUpBubbleButton()}},{key:"setUpBubbleButton",value:function(){this.nextButtonBubbleTween=ti(this.nextLevelButton.node);var a=this.nextLevelButton.node.getComponent(az);a&&this.nextButtonBubbleTween&&(a.animationUp=this.nextButtonBubbleTween)}},{key:"fadeIn1",value:(x=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.playTitleTween(),this.playTweenShowTextQuote()])];case 1:return a.sent(),[2]}})}),function(){return x.apply(this,arguments)})},{key:"fadeIn2",value:(M=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.playProgressBarTween()])];case 1:return a.sent(),[2]}})}),function(){return M.apply(this,arguments)})},{key:"playTitleTween",value:(D=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(this.levelCompletedPosY||(this.levelCompletedPosY=this.title.position.y,this.levelCompletedInitializePosY=this.levelCompletedPosY+95),!(a=this.title.getComponent(ea)))return[3,2];return C=(o=this.title.position).x,A=o.z,this.title.position=new ei(C,this.levelCompletedInitializePosY,A),Y(a).to(.4,{opacity:255}).start(),P=Y(this.title).parallel(Y().to(.4,{position:new ei(C,this.levelCompletedPosY,A)},{easing:"backOut"}),Y().to(.4,{scale:new ei(1,1,1)},{easing:"backOut"})),[4,ts.runTweenAsync(P)];case 1:I.sent(),I.label=2;case 2:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"playTweenShowTextQuote",value:(F=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.textQuote).to(.3,{opacity:255},{easing:"sineInOut"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"playProgressBarTween",value:(L=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.progressBar.node).to(.35,{scale:new ei(1,1,1)},{easing:"backOut"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"playTweenShowAdAndNextButton",value:(E=B(function(){var a,o,C,A;return _ts_generator(this,function(P){if(a=this,o=this.adButton.getComponent(ea),C=this.shareButton.getComponent(ea),A=this.nextLevelButton.getComponent(ea),o&&A&&C)return[2,new Promise(function(P){Y(o).delay(.05).to(.233,{opacity:255}).start(),Y(C).delay(.05).to(.233,{opacity:255}).start(),Y(A).delay(.05).to(.233,{opacity:255}).call(function(){a.runNextButtonBubbleAnim(),P()}).start()})];return[2]})}),function(){return E.apply(this,arguments)})},{key:"hideAllButtons",value:function(){var a=this.adButton.getComponent(ea),o=this.shareButton.getComponent(ea),C=this.nextLevelButton.getComponent(ea);a&&C&&o&&(a.opacity=0,o.opacity=0,C.opacity=0)}},{key:"runAnimProgress",value:(R=B(function(a,o,C,A){var P,I;return _ts_generator(this,function(B){return P=this,I={progress:a},[2,new Promise(function(a){Y(I).to(.5,{progress:o},{onUpdate:function(a,o){var A;P.progressBar.setProgress({numerator:null!=(A=null==a?void 0:a.progress)?A:0,denominator:C})}}).call(function(){null==A||A(),a()}).start()})]})}),function(a,o,C,A){return R.apply(this,arguments)})},{key:"fitToNextButton",value:function(){if(this.layoutButtonLevel.node.parent){var a=this.layoutButtonLevel.node.parent.getComponent(en),o=this.layoutButtonLevel.node.getComponent(en);if(a&&o){var C=a.contentSize,A=o.contentSize,P=Math.min((C.width-82)/A.width,1);this.layoutButtonLevel.node.setScale(new ei(P,P,1))}}}},{key:"playAnimCloseContainer",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){if(a=this,o=this.getComponent(ea))return[2,(this.stopNextButtonAnimation(),new Promise(function(C){Y(o).to(.25,{opacity:0}).start(),Y(a.node).to(.3,{scale:new ei(1,1,1)},{easing:"backIn"}).call(function(){C()}).start()}))];return[2]})}),function(){return I.apply(this,arguments)})},{key:"runNextButtonBubbleAnim",value:function(){this.nextButtonBubbleTween&&this.nextButtonBubbleTween.start()}},{key:"stopNextButtonAnimation",value:function(){this.nextButtonBubbleTween&&(this.nextButtonBubbleTween.stop(),this.nextLevelButton.node.setScale(1,1,1))}}]),m}(eo)).prototype,"nextLevelButton",[etV,etK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enm=L(eny.prototype,"shareButton",[etY,etj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eng=L(eny.prototype,"adButton",[etX,etJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enb=L(eny.prototype,"levelText",[etZ,etQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enk=L(eny.prototype,"levelLeftText",[et$,et0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enw=L(eny.prototype,"quoteTextTop1",[et1,et2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enS=L(eny.prototype,"quoteTextTop2",[et3,et4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enT=L(eny.prototype,"quoteTextTop3",[et5,et6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enC=L(eny.prototype,"quoteTextBot1",[et7,et8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enA=L(eny.prototype,"quoteTextBot2",[et9,ene],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),en_=L(eny.prototype,"progressBar",[ent,enn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enP=L(eny.prototype,"flyUpEffect",[eni,enr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enI=L(eny.prototype,"layoutLevelLeft",[ena,eno],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enB=L(eny.prototype,"layoutButtonLevel",[ens,enl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enR=L(eny.prototype,"title",[enu,enc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enE=L(eny.prototype,"textQuote",[enh,enp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enL=L(eny.prototype,"giftBox",[end,enf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eny))||eny);U._RF.pop(),U._RF.push({},"ead5cpbBfVEMo7L+IcgTuV9","ResultScreenView",void 0);var en1,en2,en3,en4,en5,en6,en7,en8,en9,eie,eit=$.ccclass,ein=$.property,eii=(enq=eit("ResultScreenView"),enU=ein(W),enH=tj.required,enW=ein(W),enV=tj.required,enK=ein(en0),enY=tj.required,enq((enX=L((enj=function(){var C,A,P,I,R,E;function n(){o(this,n),O(this,"gamePlayBg",enX,this),O(this,"gamePlayMask",enJ,this),O(this,"resultContainer",enZ,this)}return a(n,[{key:"init",value:function(){tj.validateRequiredProperties(this,n)}},{key:"onClickNextLevelButton",set:function(a){this.resultContainer.nextLevelButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickShareButton",set:function(a){this.resultContainer.shareButton.node.on(ef.EventType.CLICK,a)}},{key:"onClickAdButton",set:function(a){this.resultContainer.adButton.node.on(ef.EventType.CLICK,a)}},{key:"layoutLevelLeftText",get:function(){return this.resultContainer.levelLeftText.string},set:function(a){var o=this.resultContainer,C=o.levelLeftText,A=o.layoutLevelLeft;C.string=a,A.updateLayout()}},{key:"activeLayoutLevelLeft",set:function(a){this.resultContainer.layoutLevelLeft.node.active=a}},{key:"progressBarProgress",set:function(a){this.resultContainer.progressBar.setProgress(a)}},{key:"quoteTextTop1",set:function(a){this.resultContainer.quoteTextTop1.string=a}},{key:"quoteTextTop2",set:function(a){this.resultContainer.quoteTextTop2.string=a}},{key:"quoteTextTop3",set:function(a){this.resultContainer.quoteTextTop3.string=a}},{key:"quoteTextBot1",set:function(a){this.resultContainer.quoteTextBot1.string=a}},{key:"quoteTextBot2",set:function(a){this.resultContainer.quoteTextBot2.string=a}},{key:"nextLevelButtonInteractive",set:function(a){this.resultContainer.nextLevelButton.interactable=a}},{key:"shareButtonInteractive",set:function(a){this.resultContainer.shareButton.interactable=a}},{key:"adButtonInteractive",set:function(a){this.resultContainer.adButton.interactable=a}},{key:"levelText",set:function(a){this.resultContainer.levelText.string=a,this.resultContainer.layoutLevelLeft.updateLayout()}},{key:"activeNextLevelButton",set:function(a){this.resultContainer.nextLevelButton.node.active=a}},{key:"activeShareButton",set:function(a){this.resultContainer.shareButton.node.active=a}},{key:"activeAdButton",set:function(a){this.resultContainer.adButton.node.active=a}},{key:"prepareFadeIn",value:function(a){var o=a.levelText,C=a.mode,A=this.resultContainer.getComponent(ea);A&&(A.opacity=255),this.levelText=o,this.updateTextNextButton(C),this.resultContainer.hideAllButtons(),this.resultContainer.textQuote.opacity=0,this.resultContainer.title.setScale(new ei(.5,.5,.5)),this.resultContainer.progressBar.node.scale=new ei(0,0,0);var P=this.resultContainer.progressBar.node.getComponent(ea);P&&(P.opacity=255);var I=this.resultContainer.title.getComponent(ea);if(I&&(I.opacity=0),this.gamePlayBg.spriteFrame=td.gameScene.background.getCurrentBackground(),!nr.isPortrait()){var B=td.gameScene.background.getUITransform();if(B){var R=this.gamePlayBg.getComponent(en);if(R){var E=B.width,L=B.height;R.setContentSize(E,L)}}}}},{key:"fadeIn",value:(E=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,this.resultContainer.fadeIn1()];case 1:return o.sent(),this.resultContainer.flyUpEffect.play(),th.playSound(tZ.PROGRESS,{volume:.56}),[4,this.resultContainer.fadeIn2()];case 2:return o.sent(),[4,this.runAnimProgress(a)];case 3:return o.sent(),this.resultContainer.fitToNextButton(),[4,this.resultContainer.playTweenShowAdAndNextButton()];case 4:return o.sent(),[2]}})}),function(a){return E.apply(this,arguments)})},{key:"fadeOut",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.resultContainer.flyUpEffect.stop(),[4,Promise.all([this.resultContainer.playAnimCloseContainer(),this.playBgAnims()])];case 1:return a.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"updateTextNextButton",value:function(a){var o=this.resultContainer.nextLevelButton.node.getChildByName("TextIcon");if(o){var C=o.getComponent(er);if(C)if("daily-challenge"===a){C.string=globalThis.game.language.getText("CONTINUE");var A=this.resultContainer.nextLevelButton.node.getChildByName("icon-next");A&&(A.active=!1),C.node.setPosition(-6.612,10.632,0)}else{C.string=globalThis.game.language.getText("NEXT");var P=this.resultContainer.nextLevelButton.node.getChildByName("icon-next");P&&(P.active=!0),C.node.setPosition(-46.612,10.632,0)}}}},{key:"runAnimProgress",value:(I=B(function(a){var o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:if(!a)return[3,2];return o=a.layoutLevelLeftText,C=a.startProgress,A=a.endProgress,P=a.denominator,I=a.numerator,this.layoutLevelLeftText=o,[4,this.resultContainer.runAnimProgress(C,A,P,function(){P===I&&th.playSound(tZ.PROGRESS_COMPLETE,{volume:.45})})];case 1:B.sent(),B.label=2;case 2:return[2]}})}),function(a){return I.apply(this,arguments)})},{key:"playBgAnims",value:(P=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.playAnimCloseGamePlayBg(),this.playAnimCloseGamePlayMask()])];case 1:return a.sent(),[2]}})}),function(){return P.apply(this,arguments)})},{key:"playAnimCloseGamePlayBg",value:(A=B(function(){var a;return _ts_generator(this,function(o){if(a=this.gamePlayBg.getComponent(ea))return[2,new Promise(function(o){Y(a).to(.25,{opacity:0}).call(function(){o()}).start()})];return[2]})}),function(){return A.apply(this,arguments)})},{key:"playAnimCloseGamePlayMask",value:(C=B(function(){var a;return _ts_generator(this,function(o){if(a=this.gamePlayMask.getComponent(ea))return[2,new Promise(function(o){Y(a).to(.25,{opacity:0}).call(function(){o()}).start()})];return[2]})}),function(){return C.apply(this,arguments)})},{key:"resetBgs",value:function(){this.resetGamePlayBg(),this.resetGamePlayMask()}},{key:"resetGamePlayBg",value:function(){var a=this.gamePlayBg.getComponent(ea);a&&(a.opacity=255,this.gamePlayBg.node.scale=new ei(1,1,1))}},{key:"resetGamePlayMask",value:function(){var a=this.gamePlayMask.getComponent(ea);a&&(a.opacity=175)}}]),n}()).prototype,"gamePlayBg",[enU,enH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enJ=L(enj.prototype,"gamePlayMask",[enW,enV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enZ=L(enj.prototype,"resultContainer",[enK,enY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),enj))||enj);U._RF.pop(),U._RF.push({},"5f2dff5xglI/bnhmxoovbDK","ResultScreen",void 0);var eir,eia,eio,eis,eil,eiu,eic,eih,eip=$.ccclass,eid=$.property,eif=$.disallowMultiple,eiy=$.requireComponent,eiv=GameCore.Events,eim=globalThis.game,eig=eim.event,eib=eim.event,eik=(en1=eip("ResultScreen"),en2=eiy(Bi),en3=eid(eii),en4=tj.required,en5=tj.required,en1(en6=eif(en6=en2((en8=L((en7=function(P){C(y,P);var I,R,E,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"resultScreenView",en8,N(a)),O(a,"screen",en9,N(a)),O(a,"containerWidget",eie,N(a)),a.rewardRuby=150,a.handleViewResized=function(){a.containerWidget.updateAlignment()},a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("ResultScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},th.playMusic(tZ.WIN_MUSIC),a.toggleButtonsInteractable(!0),a.updateButtonsState(o),a.prepareOpenScreen(),a.updateProgressBar())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a.handleClickedNextLevelBtn=B(function(){var o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if((o=td.gameScene).toggleBlockInputContainer(!0),"daily-challenge"!==game.match.getMatchState().mode)return[3,3];return[4,tb.startMatchAsync("single")];case 1:return I.sent(),[4,a.processBackToDashboard()];case 2:return[2,void I.sent()];case 3:if((C=o.gamePlay).gameUI.footer.toggleItems(!1),A=Math.min(td.levelManager.getLevel()+1,t4.MAX_LEVEL),tE(A),tL(A),th.playMusic(tZ.BACKGROUND_MUSIC),!(P=A<t4.MAX_LEVEL))return[3,5];return[4,C.loadLevelResourcesAsync(A)];case 4:P=!I.sent(),I.label=5;case 5:if(P)return[2,void o.toggleBlockInputContainer(!1)];return[4,t_.closeScreenAsync(tP.RESULT_SCREEN)];case 6:return I.sent(),[4,C.loadNextLevel()];case 7:return I.sent(),o.toggleBlockInputContainer(!1),[2]}})}),a.handleClickedShareBtn=B(function(){return _ts_generator(this,function(o){return"shareBestScoreAsync"in GameSDK.extra&&a.shareBestScoreAsync(),[2]})}),a.shareBestScoreAsync=B(function(){var o,C,A,P,I,B,R;return _ts_generator(this,function(E){switch(E.label){case 0:if(o=GameCore.Plugins.Analytics.Events.SHARE,!("shareAsync"in GameSDK.extra))return[3,4];A=(C=window.game).player,P=C.analytics,C.frameCapture,E.label=1;case 1:return E.trys.push([1,3,,4]),(I=A.getPlayer()).playerId,B=I.name,R=I.photo,I.data,a.screen.data,[4,GameSDK.extra.shareAsync({text:"Great! I have a best score!",intent:"SHARE",image:"",data:{playerName:B,playerPhoto:R,type:"share_invite"}})];case 2:return E.sent(),P.event(o,{share_content_type:"BestScore",success:!0}),[3,4];case 3:return E.sent(),P.event(o,{share_content_type:"BestScore",success:!1}),[3,4];case 4:return[2]}})}),a.validateImageRender=function(){var a=B(function(a){return _ts_generator(this,function(o){if("string"!=typeof a||!a)throw new eik(void 0,{imageShare:a});return[2]})});return function(o){return a.apply(this,arguments)}}(),a.handleClickedAd=B(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,tf.showRewardVideoAdAsync2("RESULT_SCREEN")];case 1:if(!o.sent())return[3,3];return td.gameScene.toggleBlockInputContainer(!0),[4,a.handleWatchedFullAd()];case 2:o.sent(),td.gameScene.toggleBlockInputContainer(!1),o.label=3;case 3:return[2]}})}),a}return a(y,[{key:"__preload",value:function(){this.initComponents(),this.overrideScreenOpenClose(),this.listenScreenEvents(),this.registryEvents()}},{key:"initComponents",value:function(){this.screen=this.getComponent(Bi),this.containerWidget=this.screen.container.getComponent(eX),this.resultScreenView.init(),this.validateRequiredComponents()}},{key:"overrideScreenOpenClose",value:function(){this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,y)}},{key:"listenScreenEvents",value:function(){eig.on(eiv.OPENING_SCREEN,this.handleOpeningScreen),eig.on(eiv.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){eig.off(eiv.OPENING_SCREEN,this.handleOpeningScreen),eig.off(eiv.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"registryEvents",value:function(){this.resultScreenView.onClickNextLevelButton=this.handleClickedNextLevelBtn,this.resultScreenView.onClickShareButton=this.handleClickedShareBtn,this.resultScreenView.onClickAdButton=this.handleClickedAd,ep.on(tl.VIEW_RESIZED,this.handleViewResized)}},{key:"onLoad",value:function(){var a=this.containerWidget;try{var o=tf.getBannerAdWorldHeight();if(o<=0)return;a.bottom+=o,a.updateAlignment()}catch(a){return}}},{key:"updateButtonsState",value:function(a){var o=a.screenData.canShowButtons;this.resultScreenView.activeAdButton=o,this.resultScreenView.activeShareButton=o,this.resultScreenView.activeNextLevelButton=o}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"open",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return this.resultScreenView.resetBgs(),this.updatePassLevelAndPassLevelInRowDailyMissions(),this.updateQuoteText(),a=this.getAnimProgressConfig(),[4,this.resultScreenView.fadeIn(a)];case 1:if(C.sent(),!this.getIsCompleteChapter())return[3,3];return o=this.screen.data.level,tU(o),tG(o),td.gameScene.gamePlay.gameDataManager.setGameData({collectedChapterEndLevel:o}),[4,this.processChapterComplete()];case 2:C.sent(),C.label=3;case 3:return eig.emit(eiv.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),eib.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return F.apply(this,arguments)})},{key:"updateProgressBar",value:function(){var a=this.screen.data.level||0,o=td.mapDataManager.getBackgroundCardPayLoadOfLevel(a);if(o){var C=(null==o?void 0:o.endLevel)-(null==o?void 0:o.startLevel)+1,A=C-((null==o?void 0:o.endLevel)-a);if(this.resultScreenView.progressBarProgress={numerator:A-1,denominator:C},A===C)return td.gameScene.gamePlay.isPlayedFinalLevel&&(this.resultScreenView.progressBarProgress={numerator:1,denominator:1}),void(this.resultScreenView.activeLayoutLevelLeft=!1);this.resultScreenView.activeLayoutLevelLeft=!0,this.resultScreenView.layoutLevelLeftText="".concat(C-A+1)}}},{key:"updateQuoteText",value:function(){var a=["First Win Quote p1","First Win Quote p2","First Win Quote p3"],o=["Retry Win Quote 1","Retry Win Quote 2","Retry Win Quote 3"];if(td.gameScene.getIsFirstWin()){var C=this.getRandomPercent(),A=a[Math.floor(Math.random()*a.length)];if(globalThis.game.language.hasTextKey(A)){var P,I,B,R,E=globalThis.game.language.getText(A,[C]).split("\n"),L=E[0]?E[0].split("".concat(C,"%")):[],O=E[1]?E[1].split("".concat(C,"%")):[];if(E[0].includes(C))this.resultScreenView.quoteTextTop2="".concat(C,"%"),this.resultScreenView.quoteTextBot1="",this.resultScreenView.quoteTextBot2=(null==(B=O[0])?void 0:B.trim())||"";else this.resultScreenView.quoteTextTop2="",this.resultScreenView.quoteTextBot1="".concat(C,"%"),this.resultScreenView.quoteTextBot2=(null==(R=O[1])?void 0:R.trim())||"";this.resultScreenView.quoteTextTop1=(null==(P=L[0])?void 0:P.trim())||"",this.resultScreenView.quoteTextTop3=(null==(I=L[1])?void 0:I.trim())||""}}else{var N=o[Math.floor(Math.random()*o.length)];if(globalThis.game.language.hasTextKey(N)){var F=globalThis.game.language.getText(N).split("\n");this.resultScreenView.quoteTextTop1=F[0]||"",this.resultScreenView.quoteTextTop2="",this.resultScreenView.quoteTextTop3="",this.resultScreenView.quoteTextBot1="",this.resultScreenView.quoteTextBot2=F[1]||""}}}},{key:"getRandomPercent",value:function(a,o){var C=arguments.length>0&&void 0!==a?a:85,A=arguments.length>1&&void 0!==o?o:98;return(Math.random()*(A-C)+C).toFixed(2)}},{key:"getAnimProgressConfig",value:function(){if(td.gameScene.gamePlay.isPlayedFinalLevel)return null;var a=this.screen.data.level||0,o=td.mapDataManager.getBackgroundCardPayLoadOfLevel(a);if(!o)return null;var C="".concat(parseInt(this.resultScreenView.layoutLevelLeftText)-1),A=(null==o?void 0:o.endLevel)-(null==o?void 0:o.startLevel)+1,P=A-((null==o?void 0:o.endLevel)-a);return{layoutLevelLeftText:C,startProgress:P-1,endProgress:0===P?A:P,denominator:A,numerator:P}}},{key:"close",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.POPUP_OFF),td.gameScene.setIsFirstWin(!0),[4,this.resultScreenView.fadeOut()];case 1:return a.sent(),this.node.active=!1,eig.emit(eiv.CLOSED_SCREEN,{screenName:this.node.name}),eig.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return L.apply(this,arguments)})},{key:"toggleButtonsInteractable",value:function(a){this.resultScreenView.nextLevelButtonInteractive=a,this.resultScreenView.shareButtonInteractive=a,this.resultScreenView.adButtonInteractive=a}},{key:"prepareOpenScreen",value:function(){this.resultScreenView.prepareFadeIn({mode:game.match.getMatchState().mode||"",levelText:this.getTextLevel()})}},{key:"getTextLevel",value:function(){if("daily-challenge"===game.match.getMatchState().mode)return globalThis.game.language.getText("Daily Challenge");var a=this.screen.data.level||1,o="".concat(Math.min(a+1,t4.MAX_LEVEL));return globalThis.game.language.getText("levelX",[o]).toUpperCase()}},{key:"processChapterComplete",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.setToNextLevel(),td.gameScene.gamePlay.resetSingleMode(),this.storeItemsToGameData(),[4,Promise.all([td.gameScene.uiManager.openDashboardScreenAsync({isGetReward:!0}),t_.closeScreenAsync(tP.RESULT_SCREEN)])];case 1:return a.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"getIsCompleteChapter",value:function(){return!!td.gameScene.gamePlay.canShowChapterCompleteScreen()}},{key:"setToNextLevel",value:function(){var a=td.gameScene.gamePlay,o=this.getNextLevel();this.node.scene.emit(t2.RESET_RESCUE),a.gameDataManager.setGameData({level:o})}},{key:"getNextLevel",value:function(){var a=this.getPassedLevelData();return++a===t4.MAX_LEVEL+1&&(a=t4.MAX_LEVEL),a}},{key:"getPassedLevelData",value:function(){return this.screen.data.level||1}},{key:"updatePassLevelAndPassLevelInRowDailyMissions",value:function(){td.gameScene.gamePlay.updateDailyMissionCount({passLevels:function(a){return a+1},passLevelsInARow:function(a){return a+1}})}},{key:"handleWatchedFullAd",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),a=td.gameScene,this.resultScreenView.activeAdButton=!1,[4,a.shop.runAnimationGetRuby({animElementCount:10,totalRubies:this.rewardRuby,withRubyBarAnimation:!0})];case 1:return o.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"processBackToDashboard",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playMusic(tZ.DASHBOARD_MUSIC),[4,Promise.all([t_.closeScreenAsync(tP.RESULT_SCREEN),td.gameScene.uiManager.openDashboardScreenAsync()])];case 1:return a.sent(),td.gameScene.gamePlay.resetSingleMode(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"storeItemsToGameData",value:function(){var a=td.gameScene.gamePlay.gameDataManager.getItems();tH({undo:1,magicWand:1,shuffle:1,transactionType:"chapter_complete_reward"}),td.gameScene.gamePlay.gameDataManager.setGameData({items:{undo:a.undo+1,return:a.return,shuffle:a.shuffle+1,extraSlot:a.extraSlot,magicWand:a.magicWand+1}})}}]),y}(eo)).prototype,"resultScreenView",[en3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eii}}),en9=L(en7.prototype,"screen",[en4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eie=L(en7.prototype,"containerWidget",[en5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),en6=en7))||en6)||en6),function(P){C(r,P);var I=A(r);function r(a,C){var A;return o(this,r),(A=I.call(this,a)).payload=void 0,A.name="WideFrameRenderFail",A.message=null!=a?a:"Wide frame render fail",A.payload=C,A}return a(r)}(q(Error)));U._RF.pop(),U._RF.push({},"14536m66LNH4KITnZUZCgWk","AnimationContainer",void 0);var eiw,eiS,eiT,eiC,eiA,ei_,eiP,eiI,eiB,eiR,eiE,eiL,eiO,eiN,eiF,eiD,eiM,eix,eiz,eiG,eiq,eiU,eiH,eiW,eiV,eiK,eiY,eij,eiX,eiJ,eiZ,eiQ,ei$,ei0,ei1,ei2,ei3=$.ccclass,ei4=$.property;eir=ei3("AnimationContainer"),eia=ei4(eY),eio=tj.required,eis=ei4(W),eil=tj.required,eir((eic=L((eiu=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"rubyPrefab",eic,N(a)),O(a,"background",eih,N(a)),a.instantiatedRubies=[],a.showingItems=[],a}return a(u,[{key:"__preload",value:function(){this.setBackgroundSpriteColorAlpha(0),tj.validateRequiredProperties(this,u)}},{key:"onLoad",value:function(){try{game.ads.getBannerHeight(GameCore.Configs.Ads.BannerDisplayAdOptions[0].PlacementId,tc.cssSizeToWorldSize(1),!0)}catch(a){}}},{key:"playRubyAnimation",value:(R=B(function(a){var o,C,A,P,I,R,E,L,O,N,F;return _ts_generator(this,function(D){switch(D.label){case 0:return A=this,P=a.animationElementCount,I=a.addCoinCount,R=td.gameScene.gamePlay.vibrate,th.playSound(tZ.COIN_APPEAR),E=null!=(o=null==(C=this.showingItems.find(function(a){return a.isRuby()}))?void 0:C.node.position)?o:ei.ZERO,L=td.gameScene.rubyBarComp.getWorldIconPosition(),O=this.getLocalPosition(L),N=Array.from({length:P},function(){var a=A.spawnRuby();return a.setPosition(E),a}),[4,Promise.all([td.gameScene.rubyBarComp.playScaleUpAnimation(),this.playExplosionAnimation(N)])];case 1:return D.sent(),N.sort(function(a,o){var C=[a,o].map(function(a){var o=a.position;return ei.distance(o,O)}),A=z(C,2);return A[0]-A[1]}),Promise.race(F=N.map(function(){var a=B(function(a,o){var C;return _ts_generator(this,function(P){switch(P.label){case 0:return C=Y(a).to(.05+.085*(o+1),{position:O},{easing:"sineOut"}),[4,ts.runTweenAsync(C)];case 1:return P.sent(),A.hideRuby(a),R.vibrate(50),th.playSound(tZ.COINS_ADD,{volume:.3}),td.gameScene.rubyBarComp.playBubbleAnimation(),[2]}})});return function(o,C){return a.apply(this,arguments)}}())).then(function(){td.gameScene.rubyBarComp.addRubyAmountWithAnimation(I)}),[4,Promise.all(F)];case 2:return D.sent(),[4,td.gameScene.rubyBarComp.playScaleDownAnimation()];case 3:return D.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"playExplosionAnimation",value:(I=B(function(a){return _ts_generator(this,function(o){return[2,Promise.all(a.map(function(){var a=B(function(a){var o;return _ts_generator(this,function(C){return o=Y(a).to(Math.random()*(.25-.2)+.2,{position:a.position.clone().add3f(15*(20*Math.random()-10),15*(20*Math.random()-10)-20,0)},{easing:"sineOut"}),[2,ts.runTweenAsync(o)]})});return function(o){return a.apply(this,arguments)}}()))]})}),function(a){return I.apply(this,arguments)})},{key:"spawnRuby",value:function(){var a=this.instantiatedRubies.find(function(a){return!a.active});if(a)return a.active=!0,a;var o=ej(this.rubyPrefab);return this.instantiatedRubies.push(o),this.node.addChild(o),o}},{key:"hideRuby",value:function(a){a.active=!1,this.instantiatedRubies.includes(a)||(this.instantiatedRubies.push(a),this.node.addChild(a))}},{key:"setBackgroundSpriteColorAlpha",value:function(a){var o=this.background.color.clone();o.a=a,this.background.color=o}},{key:"getLocalPosition",value:function(a){return a.clone().subtract(this.node.getWorldPosition())}}]),u}(eo)).prototype,"rubyPrefab",[eia,eio],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eih=L(eiu.prototype,"background",[eis,eil],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eiu)),U._RF.pop(),U._RF.push({},"0f897YvZ19Isb9cvW0x3veK","RankingScrollerItem",void 0);var ei5,ei6,ei7,ei8,ei9,ere,ert,ern,eri=$.ccclass,err=$.property,era=globalThis.game.player,ero=tt(.38,1.37,.64,1),ers=(eiw=eri("RankingScrollerItem"),eiS=err(er),eiT=tj.required,eiC=err(er),eiA=tj.required,ei_=err(er),eiP=tj.required,eiI=err(W),eiB=tj.required,eiR=err(ea),eiE=tj.required,eiL=err([ee]),eiO=tj.required(ni(ee)),eiN=err([ee]),eiF=tj.required(ni(ee)),eiD=err([ee]),eiM=tj.required(ni(ee)),eix=err(et),eiz=tj.required,eiG=err(n7),eiq=tj.required,eiU=tj.required,eiH=tj.required,eiw((eiV=L((eiW=function(P){C(k,P);var I,R,L,F,D,M,x,z,q,U,H=A(k);function k(){var a;o(this,k);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=H.call.apply(H,[this].concat(A)),O(a,"indexLabel",eiV,N(a)),O(a,"nameLabel",eiK,N(a)),O(a,"scoreLabel",eiY,N(a)),O(a,"photoSprite",eij,N(a)),O(a,"glowOpacity",eiX,N(a)),O(a,"giftNodes",eiJ,N(a)),O(a,"placeNodes",eiZ,N(a)),O(a,"backgroundNodes",eiQ,N(a)),O(a,"defaultAvatar",ei$,N(a)),O(a,"avatarMaskAnim",ei0,N(a)),O(a,"photoUITransform",ei1,N(a)),O(a,"uiOpacity",ei2,N(a)),a.currentName="",a.originalScoreLabelPosition=null,a.originalRankLabelSize=0,a.previousReject=void 0,a.isFadedIn=!1,a}return a(k,[{key:"getCurrentAvatar",value:function(){return this.photoSprite.spriteFrame}},{key:"__preload",value:function(){this.initComponents(),this.initData(),this.registerEvents()}},{key:"onLoad",value:function(){this.glowOpacity&&(this.glowOpacity.node.active=!1)}},{key:"initComponents",value:function(){this.photoUITransform=this.photoSprite.node.getComponent(en),this.uiOpacity=this.getComponent(ea),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,k)}},{key:"initData",value:function(){this.originalScoreLabelPosition||(this.originalScoreLabelPosition=this.scoreLabel.node.position.clone(),this.originalRankLabelSize=this.indexLabel.fontSize)}},{key:"registerEvents",value:function(){var a,o=this;try{null==(a=this.indexChangeCallbacks)||a.push(function(a){o.updateInfo(a)})}catch(a){}}},{key:"updateInfo",value:function(a){var o=this.scroller.getLeadersData()[a];if(o){if(!this.isFadedIn){var C=o.active?255:0;this.uiOpacity.opacity=C}var A=era.getPlayerId()===o.playerId;this.setMyRank(A),this.setName(o.name),this.setScore(o.score),this.setRank(o.rank),this.setTopGift(o.rank),this.setTopPlace(o.rank),this.loadAndSetPhotoAsync(o.photo)}}},{key:"setMyRank",value:function(a){a?(this.showBackgroundByIndex(1),this.indexLabel.color=new K("#972b00"),this.nameLabel.color=new K("#972b00"),this.scoreLabel.color=new K("#972b00")):(this.showBackgroundByIndex(0),this.indexLabel.color=new K("#005111"),this.nameLabel.color=new K("#005111"),this.scoreLabel.color=new K("#005111"))}},{key:"showBackgroundByIndex",value:function(a){this.backgroundNodes.forEach(function(o,C){o.active=C===a})}},{key:"setRankIndexLabel",value:function(a){var o=a.toString(),C=tg.DEFAULT_RANK-1;-1===a?o="?":a>C&&(o="".concat(C.toString(),"+")),this.indexLabel.string=o;var A=D4.getAutoResizedFontSize({text:o,originalSize:this.originalRankLabelSize,maxLength:2,minSize:10,shrinkFactor:10});this.indexLabel.fontSize=A}},{key:"setName",value:function(a){var o=D4.getShortName(a,7);this.currentName!==o&&(this.currentName=o,this.nameLabel.string=o)}},{key:"setScore",value:function(a){var o=a.toString();-1===a&&(o="???"),this.scoreLabel.string=o,this.alignScoreToCenter()}},{key:"alignScoreToCenter",value:function(){if(this.initData(),this.originalScoreLabelPosition){var a=this.scoreLabel.string.length,o=this.originalScoreLabelPosition,C=o.x,A=o.y,P=o.z,I=tg.TEXT_ALIGNMENT.MAX_SCORE_TEXT_LENGTH,B=tg.TEXT_ALIGNMENT.OFFSET_PER_CHARACTER,R=C;I-a>0&&(R=C-(I-a)*B),this.scoreLabel.node.setPosition(R,A,P)}}},{key:"setRank",value:function(a){var o=a.toString(),C=tg.DEFAULT_RANK-1;-1===a?o="?":a>C&&(o="".concat(C.toString(),"+")),this.indexLabel.string=o;var A=D4.getAutoResizedFontSize({text:o,originalSize:this.originalRankLabelSize,maxLength:2,minSize:10,shrinkFactor:10});this.indexLabel.fontSize=A}},{key:"setRankLabelString",value:function(a){this.indexLabel.string=a}},{key:"loadAndSetPhotoAsync",value:(U=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(this.previousReject&&this.previousReject("Previous photo load cancelled"),!(o=this.scroller.getCachePhoto(a)))return[3,1];return this.setAvatarSpriteFrame(o),[3,5];case 1:if(a.includes(tW.FAKE))return C=this.scroller.getRandomFakeImage(),[2,(this.setAvatarSpriteFrame(C),void this.scroller.setCachePhoto(a,C))];P.label=2;case 2:return P.trys.push([2,4,,5]),[4,this.loadPhotoAsync(a)];case 3:return(A=P.sent())?(this.setAvatarSpriteFrame(A),this.scroller.setCachePhoto(a,A)):this.setDefaultAvatar(),[3,5];case 4:return P.sent(),[3,5];case 5:return[2]}})}),function(a){return U.apply(this,arguments)})},{key:"setAvatarSpriteFrame",value:function(a){this.photoSprite.spriteFrame=a,this.photoUITransform.setContentSize(120,124)}},{key:"setDefaultAvatar",value:function(){this.photoSprite.spriteFrame=this.defaultAvatar,this.photoUITransform.setContentSize(120,124)}},{key:"loadPhotoAsync",value:(q=B(function(a){var o;return _ts_generator(this,function(C){return o=this,[2,new Promise(function(C,A){o.previousReject=A,D4.loadProfilePhotoAsync(a).then(function(a){return C(a)})})]})}),function(a){return q.apply(this,arguments)})},{key:"loadAndSetPhoto",value:(z=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:return[4,D4.loadProfilePhotoAsync(a)];case 1:return[2,((C=A.sent())?(this.photoSprite.spriteFrame=C,this.photoUITransform.setContentSize(o.x,o.y)):(this.photoSprite.spriteFrame=this.defaultAvatar,this.photoUITransform.setContentSize(o.x,o.y)),C)]}})}),function(a,o){return z.apply(this,arguments)})},{key:"setTopGift",value:function(a){if(0!==this.giftNodes.length){if(this.toggleAllGifts(!1),a<=3)this.giftNodes[a-1].active=!0;else if(a>=tg.GIFTS.GREEN_GIFT_MIN_RANK&&a<=tg.GIFTS.GREEN_GIFT_MAX_RANK)this.giftNodes[3].active=!0}}},{key:"setTopPlace",value:function(a){this.toggleAllPlaceNodes(!1),this.indexLabel.node.active=a>3,a>3||(this.placeNodes[a-1].active=!0)}},{key:"toggleAllGifts",value:function(a){var o,C=E(this.giftNodes);try{for(C.s();!(o=C.n()).done;)o.value.active=a}catch(a){C.e(a)}finally{C.f()}}},{key:"toggleAllPlaceNodes",value:function(a){var o,C=E(this.placeNodes);try{for(C.s();!(o=C.n()).done;)o.value.active=a}catch(a){C.e(a)}finally{C.f()}}},{key:"playMoveToTargetWordPosAnim",value:(x=B(function(a){var o,C;var A=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:return o=A.length>1&&void 0!==A[1]?A[1]:.2,C=Y(this.node).to(o,{worldPosition:a},{easing:"sineOut"}),[4,ts.runTweenAsync(C)];case 1:return P.sent(),[2]}})}),function(a){return x.apply(this,arguments)})},{key:"playSelectedAnim",value:(M=B(function(){var a,o;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:return a=C.length>0&&void 0!==C[0]?C[0]:.8,o=Y(this.node).to(a,{scale:new ei(1.05,1.05,1)},{easing:"backInOut"}),[4,ts.runTweenAsync(o)];case 1:return A.sent(),[2]}})}),function(){return M.apply(this,arguments)})},{key:"playReachedTargetAnim",value:(D=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return o=Y(this.node).to(.3,{scale:new ei(1.14,1.14,1)},{easing:"sineOut"}),[4,ts.runTweenAsync(o)];case 1:return P.sent(),C=Y(this.node).to(.15,{scale:new ei(.93,.93,1)},{easing:"backOut"}),[4,ts.runTweenAsync(C)];case 2:return P.sent(),a(),A=Y(this.node).to(.14,{scale:new ei(1,1,1)},{easing:"quartOut"}),[4,Promise.all([ts.runTweenAsync(A),this.playGlowAnim()])];case 3:return P.sent(),[2]}})}),function(a){return D.apply(this,arguments)})},{key:"playGlowAnim",value:(F=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return this.glowOpacity.node.active=!0,this.glowOpacity.opacity=0,a=Y(this.glowOpacity).to(.25,{opacity:256},{easing:"sineIn"}),o=Y(this.glowOpacity.node).to(.2,{scale:new ei(1.02,1.02,1)},{easing:"sineIn"}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:return P.sent(),C=Y(this.glowOpacity).to(.25,{opacity:0},{easing:"sineOut"}),A=Y(this.glowOpacity.node).to(.2,{scale:new ei(1,1,1)},{easing:"sineOut"}),[4,Promise.all([ts.runTweenAsync(C),ts.runTweenAsync(A)])];case 2:return P.sent(),this.glowOpacity.node.active=!1,[2]}})}),function(){return F.apply(this,arguments)})},{key:"playRankGoUpAnim",value:(L=B(function(a,o,C){var A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(A=this,!(a!==o))return[3,2];return P=Y({value:a}).to(C,{value:o},{progress:function(a,o,C,P){var I=Math.floor(P*(o-a)+a);return I<=3?A.indexLabel.node.active=!1:(A.indexLabel.node.active=!0,A.setRank(I)),A.setTopPlace(I),C}}),[4,ts.runTweenAsync(P)];case 1:I.sent(),I.label=2;case 2:return[2]}})}),function(a,o,C){return L.apply(this,arguments)})},{key:"playScoreGoUpAnim",value:(R=B(function(a,o,C){var A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:if(A=this,!(a!==o))return[3,2];return P=a,Y(this.scoreLabel.node).stop().to(.2,{scale:new ei(1.2,1.2,1)}).delay(C).to(.2,{scale:new ei(1,1,1)}).start(),I=ts.makeTweenCounter({from:a,to:o,duration:C,easing:"sineInOut",onUpdate:function(a){var o=Math.floor(a);P!==o&&(P=o,A.setScore(o),th.playSound(tZ.SCORE_INCREASE_SINGLE,{volume:.5,allowMultiple:!0}))}}),[4,ts.runTweenAsync(I)];case 1:B.sent(),B.label=2;case 2:return[2]}})}),function(a,o,C){return R.apply(this,arguments)})},{key:"prepareFadeIn",value:function(){this.node.scale=new ei(.1,.1,1),this.uiOpacity.opacity=0,this.avatarMaskAnim.prepareFadeIn(0),this.isFadedIn=!0}},{key:"playFadeInAnim",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=Y(this.node).to(.4,{scale:new ei(1,1,1)},{easing:ero}),o=Y(this.uiOpacity).to(.2,{opacity:255}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o),this.avatarMaskAnim.fadeInAsync({from:0,to:255,duration:.4})])];case 1:return C.sent(),this.isFadedIn=!1,[2]}})}),function(){return I.apply(this,arguments)})}]),k}(tQ)).prototype,"indexLabel",[eiS,eiT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eiK=L(eiW.prototype,"nameLabel",[eiC,eiA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eiY=L(eiW.prototype,"scoreLabel",[ei_,eiP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eij=L(eiW.prototype,"photoSprite",[eiI,eiB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eiX=L(eiW.prototype,"glowOpacity",[eiR,eiE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eiJ=L(eiW.prototype,"giftNodes",[eiL,eiO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eiZ=L(eiW.prototype,"placeNodes",[eiN,eiF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eiQ=L(eiW.prototype,"backgroundNodes",[eiD,eiM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ei$=L(eiW.prototype,"defaultAvatar",[eix,eiz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ei0=L(eiW.prototype,"avatarMaskAnim",[eiG,eiq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ei1=L(eiW.prototype,"photoUITransform",[eiU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ei2=L(eiW.prototype,"uiOpacity",[eiH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eiW))||eiW);U._RF.pop(),U._RF.push({},"0c4acLndUpPVLlchmYOe00y","RankingScroller",void 0);var erl,eru,erc,erh,erp,erd,erf,ery,erv,erm,erg,erb,erk,erw,erS,erT,erC,erA,er_,erP,erI=$.ccclass,erB=$.property,erR=tr(2),erE=(ei5=erI("RankingScroller"),ei6=erB(FL),ei7=tj.required,ei8=erB([et]),ei9=tj.required(ni(et)),ei5((ert=L((ere=function(P){C(m,P);var I,R,L,F,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=z.call.apply(z,[this].concat(A)),O(a,"starSparkle",ert,N(a)),O(a,"fakeImages",ern,N(a)),a.selectedRankingItem=null,a.selectedPlayerId="",a.fromRank=-1,a.toRank=1,a.toNewScore=-1,a.leadersData=[],a.cachePhotos=new Map,a}return a(m,[{key:"__preload",value:function(){M(D(m.prototype),"__preload",this).call(this),tj.validateRequiredProperties(this,m)}},{key:"getLeadersData",value:function(){return this.leadersData}},{key:"setCachePhoto",value:function(a,o){this.cachePhotos.set(a,o)}},{key:"getCachePhoto",value:function(a){return this.cachePhotos.get(a)||null}},{key:"getRankingBlock",value:function(a){var o=M(D(m.prototype),"getBlockAt",this).call(this,a);return o?o.getComponentInChildren(ers):null}},{key:"refresh",value:function(){var a=this.value;this.value=a;for(var o=this.getIndexToBlocks(),C=0,A=Object.values(o);C<A.length;C++){var P=A[C],I=P.index;P.index=I}}},{key:"start",value:function(){this.config.children.anchor="top",this.config.children.count=0,this.config.padding=12,this.config.margin.top=166,this.config.margin.bottom=113,this.config.children.size={width:986,height:178},this.setIsInputBlocked(!0),this.init()}},{key:"loadScrollerData",value:function(a){this.leadersData=a,this.config.children.count=a.length,this.init(),this.prepareFadeIn()}},{key:"prepareFadeIn",value:function(){for(var a=this.getIndexToBlocks(),o=0,C=Object.values(a);o<C.length;o++){var A=C[o].getComponentInChildren(ers);A&&A.prepareFadeIn()}}},{key:"fadeInAnim",value:(x=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:a=[],o=this.getIndexToBlocks(),C=0,A=Object.values(o),I.label=1;case 1:if(!(C<A.length))return[3,5];if(!(P=A[C].getComponentInChildren(ers)))return[3,3];return a.push(P.playFadeInAnim()),[4,ts.waitTweenAsync(.05)];case 2:I.sent(),I.label=3;case 3:I.label=4;case 4:return C++,[3,1];case 5:return[4,Promise.all(a)];case 6:return I.sent(),[2]}})}),function(){return x.apply(this,arguments)})},{key:"getRandomFakeImage",value:function(){var a=Math.floor(Math.random()*this.fakeImages.length);return this.fakeImages[a]}},{key:"getCurrentIdx",value:function(){return this.fromRank-this.leadersData[0].rank}},{key:"getTargetIdx",value:function(){return this.toRank-this.leadersData[0].rank}},{key:"preparePlayRankGoUpAnimation",value:function(a,o,C){this.selectedPlayerId=a,this.toNewScore=o;var A,P=E(this.leadersData);try{for(P.s();!(A=P.n()).done;){var I=A.value;I.playerId===this.selectedPlayerId&&(this.fromRank=I.rank)}}catch(a){P.e(a)}finally{P.f()}this.fromRank=this.parseFromRank(this.fromRank),this.toRank=this.parseToRank(C);var B=this.getCurrentIdx();this.moveToIndex(B);var R=this.leadersData.length;R>tg.MAX_LEADERS&&(this.leadersData[R-1].rank=this.fromRank),this.refresh()}},{key:"parseFromRank",value:function(a){return a<1?tg.DEFAULT_RANK:a}},{key:"parseToRank",value:function(a){var o=this.getMaxRankInLeaders();return a>tg.MAX_LEADERS+1?a:Math.min(a,o)}},{key:"getMaxRankInLeaders",value:function(){var a,o=0,C=E(this.leadersData);try{for(C.s();!(a=C.n()).done;)""!==a.value.playerId&&o++}catch(a){C.e(a)}finally{C.f()}return o}},{key:"playRankGoUpAnimation",value:(F=B(function(){var a,o,C,A,P,I,B,R,E,L,O,N,F,D,M,x,z;return _ts_generator(this,function(q){switch(q.label){case 0:if(a=this,o=this.getCurrentIdx(),C=this.getTargetIdx(),A=this.createTempItemToDisplay(o),P=this.leadersData[o],I=this.leadersData[C],B=this.getRankingBlock(o),R=P.name,E=P.photo,!(A&&B))return[3,6];return A.setMyRank(!0),(L=Math.max(.1*Math.abs(o-C),.3))>2.5&&(L=2.5),A.setTopGift(this.fromRank),A.setTopPlace(this.fromRank),O=this.fromRank-this.toRank<=1?1.2:.8,[4,A.playSelectedAnim(O)];case 1:return q.sent(),A.playScoreGoUpAnim(P.score,this.toNewScore,.5),[4,this.moveAboveBlocksDownAnim(o,C)];case 2:return q.sent(),I.active=!1,this.refresh(),A.playRankGoUpAnim(this.fromRank,this.toRank,L),[4,this.playScrollToTargetAnim(o,C,L)];case 3:if(q.sent(),!(N=this.getRankingBlock(C)))return[3,6];return F=N.node.getWorldPosition(),[4,A.playMoveToTargetWordPosAnim(F)];case 4:return q.sent(),A.setTopGift(this.toRank),M=(D=A.node.getWorldPosition()).x,x=D.y,z=D.z,this.starSparkle.node.setWorldPosition(M,x,z),[4,A.playReachedTargetAnim(function(){a.playStarEffect(),th.playSound(tZ.SCORE_INCREASE_END,{volume:.3})})];case 5:q.sent(),this.selectedRankingItem&&(this.selectedRankingItem.active=!1),I.active=!0,I.playerId=this.selectedPlayerId,I.name=R,I.photo=E,I.score=this.toNewScore,this.refresh(),q.label=6;case 6:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"moveAboveBlocksDownAnim",value:(L=B(function(a,o){var C,A,P,I,B,R,E,L,O;return _ts_generator(this,function(N){switch(N.label){case 0:for(C=[],A=a;A>o;A--){if(P=A-1,I=this.leadersData[P],B=this.getBlockAt(P),R=this.leadersData[A],E=this.getBlockAt(A),B&&E)L=E.margin,O=this.playMoveToTargetWordPosAnim(B,L),C.push(O);R.playerId=I.playerId,R.photo=I.photo,R.name=I.name,R.score=I.score,R.rank=I.rank+1}return[4,Promise.all(C)];case 1:return N.sent(),this.refresh(),[2]}})}),function(a,o){return L.apply(this,arguments)})},{key:"playMoveToTargetWordPosAnim",value:(R=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:return C=Y(a).to(.2,{margin:o},{easing:"sineOut"}),[4,ts.runTweenAsync(C)];case 1:return A.sent(),[2]}})}),function(a,o){return R.apply(this,arguments)})},{key:"resetData",value:function(){this.fromRank=-1}},{key:"createTempItemToDisplay",value:function(a){var o=this.getRankingBlock(a);if(!o)return null;var C=this.selectedRankingItem;C||(C=ej(this.blockPrefab),this.selectedRankingItem=C,C.setParent(this.node.parent)),C.setSiblingIndex(this.node.children.length-2);var A=o.node.getWorldPosition(),P=A.x,I=A.y,B=A.z;C.setWorldPosition(P,I,B),C.active=!0;var R=C.getComponent(ers);return R?(R.scroller=this,R.updateInfo(a),R):null}},{key:"handlePlayScrollSound",value:function(a){var o=a.ratio,C=a.duration,A=a.previousElapsed,P=a.soundInterval,I=a.power,B=void 0===I?2:I,R=a.minInterval,E=a.maxInterval,L=a.k,O=o*C,N=P;if(N-=O-A,P<=0){th.playSound(tZ.SCROLL_SHORT);var F=B*Math.pow(1-o,B-1);N=Math.max(void 0===R?.05:R,Math.min(void 0===E?.15:E,1/(F*(void 0===L?2:L))))}return{previousElapsed:O,soundInterval:N}}},{key:"playScrollToTargetAnim",value:(I=B(function(a,o,C){var A,P,I,B,R;return _ts_generator(this,function(E){switch(E.label){case 0:if(A=this,!(a!==o))return[3,2];return P=0,I=0,B=a,R=Y({value:a-1}).to(C,{value:o},{progress:function(a,o,R,E){var L=null;C<.5&&C>.3?L=A.handlePlayScrollSound({ratio:E,duration:C,previousElapsed:P,soundInterval:I,maxInterval:.1}):C>.3&&(L=A.handlePlayScrollSound({ratio:E,duration:C,previousElapsed:P,soundInterval:I})),L&&(P=L.previousElapsed,I=L.soundInterval);var O=E*(o-a)+a,N=Math.floor(O);return N!==B&&(B=N,A.refresh()),A.moveToIndex(O,A.getOffsetToFourFifthsOfScroller()),R},easing:erR}),[4,ts.runTweenAsync(R)];case 1:E.sent(),E.label=2;case 2:return[2]}})}),function(a,o,C){return I.apply(this,arguments)})},{key:"getOffsetToFourFifthsOfScroller",value:function(){return 178+12*tg.SCROLLER_MUL_VALUE}},{key:"playStarEffect",value:function(){this.starSparkle.node.active=!0,this.starSparkle.playEffect()}}]),m}(t$)).prototype,"starSparkle",[ei6,ei7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ern=L(ere.prototype,"fakeImages",[ei8,ei9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ere))||ere);U._RF.pop(),U._RF.push({},"cb61cbcsUlGcL17U3tfvkK2","ContainerResultTournament",void 0);var erL,erO,erN,erF,erD,erM,erx,erz,erG,erq,erU,erH,erW=$.ccclass,erV=$.property,erK=(erl=erW("ContainerResultTournament"),eru=erV(er),erc=tj.required,erh=erV(ea),erp=tj.required,erd=erV(ef),erf=tj.required,ery=erV(erE),erv=tj.required,erm=tj.required,erg=tj.required,erb=tj.required,erl((erw=L((erk=function(P){C(y,P);var I,R,E,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"timerLabel",erw,N(a)),O(a,"headerOpacity",erS,N(a)),O(a,"continueButton",erT,N(a)),O(a,"rankingScroller",erC,N(a)),O(a,"scrollerUITransform",erA,N(a)),O(a,"uiOpacity",er_,N(a)),O(a,"widget",erP,N(a)),a.originalScrollerHeight=0,a.originalTimerFontSize=0,a.continueButtonBubbleTween=null,a.handleViewResized=function(){a.widget.updateAlignment()},a}return a(y,[{key:"__preload",value:function(){this.initComponents(),this.initData(),this.registerEvents(),this.setUpBubbleButton()}},{key:"setUpBubbleButton",value:function(){this.continueButtonBubbleTween=ti(this.continueButton.node);var a=this.continueButton.node.getComponent(az);a&&this.continueButtonBubbleTween&&(a.animationUp=this.continueButtonBubbleTween)}},{key:"initData",value:function(){this.originalScrollerHeight||(this.originalScrollerHeight=this.scrollerUITransform.height,this.originalTimerFontSize=this.timerLabel.fontSize)}},{key:"initComponents",value:function(){this.scrollerUITransform=this.rankingScroller.node.getComponent(en),this.uiOpacity=this.node.getComponent(ea),this.widget=this.node.getComponent(eX),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,y)}},{key:"registerEvents",value:function(){ep.on(tl.VIEW_RESIZED,this.handleViewResized,this)}},{key:"onLoad",value:function(){var a=this.widget;try{var o=tf.getBannerAdWorldHeight();if(o<=0)return;a.bottom+=o,a.updateAlignment()}catch(a){return}}},{key:"setTimerLabel",value:function(a){this.timerLabel.string=a;var o=D4.getAutoResizedFontSize({text:a,originalSize:this.originalTimerFontSize,maxLength:8,minSize:3,shrinkFactor:3});this.timerLabel.fontSize=o}},{key:"loadScroller",value:function(a){this.rankingScroller.loadScrollerData(a)}},{key:"prepareFadeIn",value:function(){this.rankingScroller.clearScroller(),this.continueButton.node.scale=ei.ZERO,this.uiOpacity.opacity=0,this.node.setScale(.1,.1,.1),this.headerOpacity.opacity=0}},{key:"fadeIn",value:(F=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return a=Y(this.uiOpacity).to(.3,{opacity:255},{easing:"cubicOut"}),o=Y(this.node).to(.3,{scale:ei.ONE},{easing:"cubicOut"}),C=Y(this.headerOpacity).to(.3,{opacity:255},{easing:"cubicOut"}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o),ts.runTweenAsync(C)])];case 1:return A.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"fadeOut",value:(L=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return a=Y(this.uiOpacity).to(.3,{opacity:0},{easing:"cubicOut"}),o=Y(this.node).to(.3,{scale:new ei(.2,.2,1)},{easing:"cubicOut"}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:return C.sent(),this.stopContinueButtonAnimation(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"fadeInMiddleUI",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.rankingScroller.fadeInAnim()];case 1:return a.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"refreshScroller",value:function(){this.rankingScroller.refresh()}},{key:"prepareScrollerAnim",value:function(a,o,C){this.rankingScroller.preparePlayRankGoUpAnimation(a,o,C)}},{key:"setBlockScrollerInput",value:function(a){var o=this.rankingScroller.getComponent(y1);o&&o.setFreeControl(a)}},{key:"handlePlayRankGoUpAnimation",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.rankingScroller.playRankGoUpAnimation()];case 1:return a.sent(),[4,this.runContinueButtonAnim()];case 2:return a.sent(),this.rankingScroller.resetData(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"runContinueButtonAnim",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.continueButton.node).to(.3,{scale:ei.ONE},{easing:"cubicOut"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),this.runContinueButtonBubbleAnim(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"onClickContinueButton",set:function(a){this.continueButton.node.on(ef.EventType.CLICK,a)}},{key:"runContinueButtonBubbleAnim",value:function(){this.continueButtonBubbleTween&&this.continueButtonBubbleTween.start()}},{key:"stopContinueButtonAnimation",value:function(){this.continueButtonBubbleTween&&(this.continueButtonBubbleTween.stop(),this.continueButton.node.setScale(1,1,1))}}]),y}(eo)).prototype,"timerLabel",[eru,erc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erS=L(erk.prototype,"headerOpacity",[erh,erp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erT=L(erk.prototype,"continueButton",[erd,erf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erC=L(erk.prototype,"rankingScroller",[ery,erv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erA=L(erk.prototype,"scrollerUITransform",[erm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),er_=L(erk.prototype,"uiOpacity",[erg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erP=L(erk.prototype,"widget",[erb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erk))||erk);U._RF.pop(),U._RF.push({},"97c8diU3D1HWYYmHuaQ50Gl","ResultTournamentScreen",void 0);var erY,erj,erX,erJ,erZ,erQ,er$,er0,er1,er2,er3,er4=$.ccclass,er5=$.disallowMultiple,er6=$.requireComponent,er7=$.property,er8=GameCore.Plugins.Analytics,er9=GameCore.Events,eae=globalThis.game,eat=eae.event,ean=eae.player;erL=er4("ResultTournamentScreen"),erO=er6(Bi),erN=er7(erK),erF=tj.required,erD=er7(W),erM=tj.required,erx=tj.required,erL(erz=er5(erz=erO((erq=L((erG=function(P){C(m,P);var I,R,E,L,F,D,M,x,z=A(m);function m(){var a;o(this,m);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=z.call.apply(z,[this].concat(A)),O(a,"container",erq,N(a)),O(a,"backgroundSprite",erU,N(a)),O(a,"screen",erH,N(a)),a.countScreenOpenTimes=0,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("ResultTournamentScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},a.prepareFadeIn())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&(a.unscheduleAllCallbacks(),a.displayLeaderboardTime())},a}return a(m,[{key:"screenData",get:function(){return this.screen.data}},{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onLoad",value:function(){this.registryEvents()}},{key:"registryEvents",value:function(){var a=this;this.node.scene.on(t2.LEADER_BOARD_TIMER_COUNT_DOWN,this.updateTimer,this),this.container.onClickContinueButton=function(){a.handleClickContinueButton()}}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,m)}},{key:"listenScreenEvents",value:function(){eat.on(er9.OPENING_SCREEN,this.handleOpeningScreen),eat.on(er9.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){eat.off(er9.OPENING_SCREEN,this.handleOpeningScreen),eat.off(er9.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"prepareFadeIn",value:function(){this.container.prepareFadeIn();var a=this.backgroundSprite.color,o=a.r,C=a.g,A=a.b;this.backgroundSprite.color=new K(o,C,A,0)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"updateTimer",value:function(a){if(a<0){var o=globalThis.game.language.getText("End");this.container.setTimerLabel(o)}else{var C=Rs.getStandardTimeFormat(a);if(this.container.setTimerLabel(C),0===a){var A=globalThis.game.language.getText("End");this.container.setTimerLabel(A)}}}},{key:"displayLeaderboardTime",value:(x=B(function(){var a,o,C;return _ts_generator(this,function(A){if(0===(a=td.gameScene.gamePlay.timerHandler.getLeaderboardTimer()))o=globalThis.game.language.getText("End"),this.container.setTimerLabel(o);else if(this.screenData.allowLoadNewData)C=globalThis.game.language.getText("Loading..."),this.container.setTimerLabel(C);return this.updateTimer(a),[2]})}),function(){return x.apply(this,arguments)})},{key:"open",value:(M=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return th.playSound(tZ.POPUP_SHOW),this.container.setBlockScrollerInput(!1),[4,Promise.all([this.fadeInBackground(),this.container.fadeIn()])];case 1:if(B.sent(),!!(a=this.screenData.leaders))return[3,3];return td.gameScene.showLoadingScreen(3,t7.FAILED_TO_LOAD_TOURNAMENT_RESULT,!1),[4,this.closeScreenAsyncWhileOpen()];case 2:return[2,void B.sent()];case 3:if(!!(o=this.screenData.playerEntry))return[3,5];return td.gameScene.showLoadingScreen(3,t7.FAILED_TO_LOAD_TOURNAMENT_RESULT,!1),[4,this.closeScreenAsyncWhileOpen()];case 4:return[2,void B.sent()];case 5:return this.container.loadScroller(a),C=this.screenData.currentRank,A=this.screenData.newScore,P=o.rank>C?C:o.rank,I=ean.getPlayerId(),this.container.prepareScrollerAnim(I,A,P),[4,this.container.fadeInMiddleUI()];case 6:return B.sent(),[4,this.container.handlePlayRankGoUpAnimation()];case 7:return B.sent(),this.container.setBlockScrollerInput(!0),this.container.refreshScroller(),this.preloadLeaderboardData(),this.countScreenOpenTimes++,this.postScoreTournamentAsync(A),eat.emit(er9.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),eat.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return M.apply(this,arguments)})},{key:"fadeInBackground",value:(D=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return o=(a=this.backgroundSprite.color).r,C=a.g,A=a.b,P=Y(this.backgroundSprite).to(.35,{color:new K(o,C,A,255)},{easing:"cubicOut"}),[4,ts.runTweenAsync(P)];case 1:return I.sent(),[2]}})}),function(){return D.apply(this,arguments)})},{key:"closeScreenAsyncWhileOpen",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return eat.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[4,ts.waitTweenAsync(1)];case 1:return a.sent(),[4,t_.closeScreenAsync(tP.RESULT_TOURNAMENT_SCREEN)];case 2:return a.sent(),[4,td.gameScene.gamePlay.playEndGame()];case 3:return a.sent(),[2]}})}),function(){return F.apply(this,arguments)})},{key:"postScoreTournamentAsync",value:(L=B(function(a){var o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:if(o=window.game.analytics,C=null,A=!1,P=this.countScreenOpenTimes===t4.MAX_PER_PLAYED_LEVEL_TO_SHARE,!td.gameScene.gamePlay.resultTournamentLoader.isValidPlayerToSaveScore())return[3,8];I.label=1;case 1:if(I.trys.push([1,6,7,8]),!P)return[3,3];return[4,GameSDK.tournament.shareAsync({score:a})];case 2:return I.sent(),C=er8.Events.TOURNAMENT_SHARE,[3,5];case 3:if("tournament"!==window.game.match.getMatchState().mode)return[2];return[4,GameSDK.tournament.postScoreAsync(a)];case 4:I.sent(),C=er8.Events.TOURNAMENT_POST_SCORE,I.label=5;case 5:return A=!0,[3,8];case 6:return I.sent(),[3,8];case 7:return C&&o.event(C,{success:A}),[7];case 8:return[2]}})}),function(a){return L.apply(this,arguments)})},{key:"preloadLeaderboardData",value:function(){td.gameScene.gamePlay.resultTournamentLoader.preloadLeaderboardData()}},{key:"close",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.fadeOutBackground(),this.container.fadeOut()])];case 1:return a.sent(),this.node.active=!1,eat.emit(er9.CLOSED_SCREEN,{screenName:this.node.name}),eat.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"handleClickContinueButton",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,t_.closeScreenAsync(tP.RESULT_TOURNAMENT_SCREEN)];case 1:return a.sent(),[4,td.gameScene.gamePlay.playEndGame()];case 2:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"fadeOutBackground",value:(I=B(function(){var a,o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return o=(a=this.backgroundSprite.color).r,C=a.g,A=a.b,P=Y(this.backgroundSprite).to(.3,{color:new K(o,C,A,0)},{easing:"cubicOut"}),[4,ts.runTweenAsync(P)];case 1:return I.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),m}(eo)).prototype,"container",[erN,erF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erU=L(erG.prototype,"backgroundSprite",[erD,erM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erH=L(erG.prototype,"screen",[erx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),erz=erG))||erz)||erz),U._RF.pop(),U._RF.push({},"c49a7WnE6tOepHOAkOcToL+","TournamentGiftBlockAnimator",void 0);var eai,ear,eaa,eao,eas,eal,eau,eac,eah,eap,ead,eaf,eay,eav,eam,eag,eab,eak,eaw,eaS,eaT,eaC,eaA,ea_,eaP,eaI,eaB=$.ccclass,eaR=$.property,eaE=(erY=eaB("TournamentGiftBlockAnimator"),erj=eaR(ee),erX=tj.required,erJ=eaR(ee),erZ=tj.required,erQ=eaR(ee),er$=tj.required,erY((er1=L((er0=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"giftBlock",er1,N(a)),O(a,"giftBottom",er2,N(a)),O(a,"giftOpenedBottom",er3,N(a)),a}return a(u,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,u)}},{key:"playAnimation",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(this.showBottomBlock({isOpened:!1}),!(a=this.giftBlock.getComponent(es)))return[3,2];return[4,ts.runAnimationAsync(a,"GiftBlock")];case 1:o.sent(),o.label=2;case 2:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"onGiftOpened",value:function(){th.playSound(tZ.GIFT_OPEN,{volume:.7}),td.gameScene.gamePlay.vibrate.vibrate(50),this.showBottomBlock({isOpened:!0})}},{key:"showBottomBlock",value:function(a){var o=a.isOpened,C=void 0!==o&&o;this.giftBottom.active=!C,this.giftOpenedBottom.active=C}},{key:"playCloseGiftBlockAnimation",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.giftBlock).to(.5,{scale:ei.ZERO},{easing:"backIn"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eo)).prototype,"giftBlock",[erj,erX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),er2=L(er0.prototype,"giftBottom",[erJ,erZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),er3=L(er0.prototype,"giftOpenedBottom",[erQ,er$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),er0))||er0);U._RF.pop(),U._RF.push({},"83b36MtzNRF0KxCWFwQI8Wb","TournamentItemRewardBlock",void 0);var eaL,eaO,eaN,eaF,eaD,eaM=$.ccclass,eax=$.property,eaz=(eai=eaM("TournamentItemRewardBlock"),ear=eax([et]),eaa=tj.required(ni(et)),eao=eax(W),eas=tj.required,eal=eax(pj),eau=tj.required,eac=eax(pj),eah=tj.required,eap=eax(pj),ead=tj.required,eaf=eax(ee),eay=tj.required,eav=eax(ee),eam=tj.required,eag=eax(er),eab=tj.required,eai((eaw=L((eak=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"itemSpriteFrames",eaw,N(a)),O(a,"iconSprite",eaS,N(a)),O(a,"followSmokeEffect",eaT,N(a)),O(a,"glowEffect",eaC,N(a)),O(a,"squareGlowEffect",eaA,N(a)),O(a,"itemSquareGlow",ea_,N(a)),O(a,"itemGlow",eaP,N(a)),O(a,"numberLabel",eaI,N(a)),a}return a(s,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,s)}},{key:"setSpriteFrame",value:function(a){"undo"===a?this.iconSprite.spriteFrame=this.itemSpriteFrames[0]:"magicWand"===a?this.iconSprite.spriteFrame=this.itemSpriteFrames[1]:"shuffle"===a&&(this.iconSprite.spriteFrame=this.itemSpriteFrames[2])}},{key:"toggleFlowSmokeEffect",value:function(a){a?this.followSmokeEffect.play():this.followSmokeEffect.stop()}},{key:"playSquareGlowEffect",value:function(){this.squareGlowEffect.play()}},{key:"toggleGlowEffect",value:function(a){a?this.glowEffect.play():this.glowEffect.stop()}},{key:"playGlowAnimation",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return this.itemGlow.scale=ei.ZERO,this.setNodeOpacity(this.itemGlow,255),this.itemSquareGlow.scale=ei.ZERO,this.setNodeOpacity(this.itemSquareGlow,255),a=Y(this.itemGlow).to(.3,{scale:new ei(1.5,1.5,1.5)},{easing:"sineInOut"}),o=Y(this.itemSquareGlow).to(.3,{scale:new ei(1.5,1.5,1.5)},{easing:"sineInOut"}),[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 1:if(P.sent(),C=this.createOpacityAnimation(this.itemGlow,0,.2,e3.sineInOut),A=this.createOpacityAnimation(this.itemSquareGlow,0,.2,e3.sineInOut),!(C&&A))return[3,3];return[4,Promise.all([ts.runTweenAsync(C),ts.runTweenAsync(A)])];case 2:P.sent(),P.label=3;case 3:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"setNodeOpacity",value:function(a,o){var C=a.getComponent(ea);C&&(C.opacity=o)}},{key:"createOpacityAnimation",value:function(a,o,C,A){var P=a.getComponent(ea);if(P)return Y(P).to(C,{opacity:o},{easing:A})}},{key:"setNumberLabel",value:function(a){this.numberLabel.string="x".concat(a)}}]),s}(eo)).prototype,"itemSpriteFrames",[ear,eaa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eaS=L(eak.prototype,"iconSprite",[eao,eas],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eaT=L(eak.prototype,"followSmokeEffect",[eal,eau],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eaC=L(eak.prototype,"glowEffect",[eac,eah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eaA=L(eak.prototype,"squareGlowEffect",[eap,ead],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ea_=L(eak.prototype,"itemSquareGlow",[eaf,eay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eaP=L(eak.prototype,"itemGlow",[eav,eam],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eaI=L(eak.prototype,"numberLabel",[eag,eab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eak))||eak);U._RF.pop(),U._RF.push({},"decdcVEXA1B2ZaE+QinKabB","TournamentItemRewardManager",void 0);var eaG,eaq,eaU,eaH,eaW,eaV,eaK,eaY,eaj,eaX,eaJ,eaZ,eaQ,ea$,ea0,ea1,ea2,ea3,ea4,ea5,ea6,ea7,ea8,ea9,eoe,eot,eon,eoi,eor,eoa=$.ccclass,eoo=$.property,eos=(eaL=eoa("TournamentItemRewardManager"),eaO=eoo(eY),eaN=tj.required,eaL((eaD=L((eaF=function(P){C(y,P);var I,R,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"itemRewardPrefab",eaD,N(a)),a.itemRewards=[],a}return a(y,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,y)}},{key:"getItemRewardBlock",value:function(){var a,o=E(this.itemRewards);try{for(o.s();!(a=o.n()).done;){var C=a.value;if(!C.node.active)return C.toggleFlowSmokeEffect(!0),C.toggleGlowEffect(!1),C.node.active=!0,C}}catch(a){o.e(a)}finally{o.f()}var A=ej(this.itemRewardPrefab).getComponent(eaz);return A?(A.toggleFlowSmokeEffect(!1),this.itemRewards.push(A),A.node.setParent(this.node),A):null}},{key:"hideAllItemRewards",value:function(){var a,o=E(this.itemRewards);try{for(o.s();!(a=o.n()).done;){var C=a.value;C.toggleFlowSmokeEffect(!1),C.node.active=!1}}catch(a){o.e(a)}finally{o.f()}}},{key:"createItemReward",value:function(a,o){var C=this.getItemRewardBlock();if(!C)return null;C.node.setPosition(o),C.setSpriteFrame(a);var A=C.getComponent(ea);return A&&(A.opacity=0),C}},{key:"playAllItemsAnimation",value:(F=B(function(a){var o,C,A,P,I,B,R,L,O;return _ts_generator(this,function(N){switch(N.label){case 0:C=-((o=a.length)-1)/2*350,A=[],P=0,N.label=1;case 1:if(!(P<o))return[3,4];return th.playSound(tZ.FAIRY_DUST),A.push(this.playFirstItemAnimation(a[P],P,C)),(I=a[P].getComponent(ea))&&(I.opacity=255),[4,ts.waitTweenAsync(.4)];case 2:N.sent(),N.label=3;case 3:return P++,[3,1];case 4:return[4,Promise.all(A)];case 5:N.sent(),A=[],B=o-1,N.label=6;case 6:if(!(B>=0))return[3,9];return R=a[B].node,A.push(this.playSecondItemAnimation(R,B,o)),[4,ts.waitTweenAsync(.1)];case 7:N.sent(),N.label=8;case 8:return B--,[3,6];case 9:return[4,Promise.all(A)];case 10:N.sent(),O=E(a);try{for(O.s();!(L=O.n()).done;)L.value.toggleGlowEffect(!0)}catch(a){O.e(a)}finally{O.f()}return[2]}})}),function(a){return F.apply(this,arguments)})},{key:"playFirstItemAnimation",value:(L=B(function(a,o,C){var A,P,I,B,R,E,L;return _ts_generator(this,function(O){switch(O.label){case 0:if(A=C+20*o,(P=a.node).setScale(new ei(.75,.75,.75)),!a.getComponent(ea))return[3,5];return this.playItemScaleUpDownAnimation(a),I=P.getPosition().x,B=Y(P).to(.2,{position:new ei(I,180,0)}),[4,ts.runTweenAsync(B)];case 1:return O.sent(),a.playSquareGlowEffect(),[4,ts.waitTweenAsync(.1)];case 2:return O.sent(),R=Y(P).to(.4,{position:new ei(I,360,0)}),[4,ts.runTweenAsync(R)];case 3:return O.sent(),a.playSquareGlowEffect(),E=P.getPosition().y,L=Y(P).to(.4,{position:new ei(A,E,0)}),[4,ts.runTweenAsync(L)];case 4:O.sent(),a.playSquareGlowEffect(),O.label=5;case 5:return[2]}})}),function(a,o,C){return L.apply(this,arguments)})},{key:"playItemScaleUpDownAnimation",value:(R=B(function(a){var o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return o=a.node,C=Y(o).to(.4,{scale:new ei(1,1,1)}),a.playGlowAnimation(),[4,ts.runTweenAsync(C)];case 1:return P.sent(),A=Y(o).to(.4,{scale:new ei(.75,.75,.75)}),[4,ts.runTweenAsync(A)];case 2:return P.sent(),[2]}})}),function(a){return R.apply(this,arguments)})},{key:"playSecondItemAnimation",value:(I=B(function(a,o,C){var A,P;return _ts_generator(this,function(I){switch(I.label){case 0:return A=350*(o-(C-1)/2),P=Y(a).to(.3,{position:new ei(A,310,0),scale:new ei(1,1,1)}),[4,ts.runTweenAsync(P)];case 1:return I.sent(),[2]}})}),function(a,o,C){return I.apply(this,arguments)})}]),y}(eo)).prototype,"itemRewardPrefab",[eaO,eaN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eaF))||eaF);U._RF.pop(),U._RF.push({},"6d762Uq80hOSZ+75g5u5Gjt","RewardTournamentAnimation",void 0);var eol,eou,eoc,eoh,eop,eod,eof,eoy,eov,eom,eog,eob,eok,eow,eoS=$.ccclass,eoT=$.property,eoC=(eaG=eoS("RewardTournamentAnimation"),eaq=eoT(eaE),eaU=tj.required,eaH=eoT(eos),eaW=tj.required,eaV=eoT(ee),eaK=tj.required,eaY=eoT(ee),eaj=tj.required,eaX=eoT(ee),eaJ=tj.required,eaZ=eoT(pj),eaQ=tj.required,ea$=eoT(pj),ea0=tj.required,ea1=eoT(pj),ea2=tj.required,ea3=eoT(ee),ea4=tj.required,eaG((ea6=L((ea5=function(P){C(k,P);var I,E,L,F,D,M,x,z,q,U=A(k);function k(){var a;o(this,k);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=U.call.apply(U,[this].concat(A)),O(a,"giftBlockAnimator",ea6,N(a)),O(a,"itemRewardManager",ea7,N(a)),O(a,"textReceive",ea8,N(a)),O(a,"textTitle",ea9,N(a)),O(a,"textReward",eoe,N(a)),O(a,"circleGlow",eot,N(a)),O(a,"smallSpakleEffect",eon,N(a)),O(a,"spakleEffect",eoi,N(a)),O(a,"collectButton",eor,N(a)),a.originalTextReceiveY=0,a.originalTextTitleY=0,a.originalTextRewardY=0,a.effectPath=[],a.effectPath2=[],a.effectPath3=[],a}return a(k,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,k)}},{key:"setUpData",value:function(){this.originalTextReceiveY=this.textReceive.getPosition().y,this.originalTextTitleY=this.textTitle.getPosition().y,this.originalTextRewardY=this.textReward.getPosition().y,this.circleGlow.stop(),this.createCircleEffectPath(0,75),this.createCircleEffectPath2(0,75),this.createCircleEffectPath3(0,75)}},{key:"hideAllItemRewards",value:function(){this.itemRewardManager.hideAllItemRewards()}},{key:"prepareAnims",value:function(){this.setOpacity(this.textReceive,0),this.setOpacity(this.textTitle,0),this.setOpacity(this.textReward,0),this.setYPosition(this.textReceive,this.originalTextReceiveY),this.setYPosition(this.textTitle,this.originalTextTitleY),this.setYPosition(this.textReward,this.originalTextRewardY)}},{key:"playAnims",value:(q=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return this.prepareAnims(),[4,Promise.all([this.giftBlockAnimator.playAnimation(),this.playCircleEffectAnims(),this.playTextReceiveAnimation()])];case 1:return o.sent(),[4,this.handleGiftOpened(a)];case 2:return o.sent(),[2]}})}),function(a){return q.apply(this,arguments)})},{key:"playCircleEffectAnims",value:(z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.circleGlow.stop(),[4,ts.waitTweenAsync(.25)];case 1:return a.sent(),this.circleGlow.play(),this.playCurveEffect(),[4,ts.waitTweenAsync(.2)];case 2:return a.sent(),this.playCurveEffect2(),[4,ts.waitTweenAsync(.28)];case 3:return a.sent(),this.playCurveEffect3(),[2]}})}),function(){return z.apply(this,arguments)})},{key:"playCurveEffect",value:(x=B(function(){var a,o,C;return _ts_generator(this,function(A){return o=this,C=this.circleGlow.node.getPosition().z,(a=Y(this.effectPath)).sequence.apply(a,R(this.effectPath.map(function(a,A){return Y(o.circleGlow.node).to(.01,{position:new ei(a.x,a.y,C)},{easing:e3.linear})}))).start(),[2]})}),function(){return x.apply(this,arguments)})},{key:"playCurveEffect2",value:(M=B(function(){var a,o,C;return _ts_generator(this,function(A){return o=this,C=this.circleGlow.node.getPosition().z,(a=Y(this.effectPath2)).sequence.apply(a,R(this.effectPath2.map(function(a,A){return Y(o.circleGlow.node).to(.01,{position:new ei(a.x,a.y,C)},{easing:e3.linear})}))).start(),[2]})}),function(){return M.apply(this,arguments)})},{key:"playCurveEffect3",value:(D=B(function(){var a,o,C;return _ts_generator(this,function(A){return o=this,C=this.circleGlow.node.getPosition().z,(a=Y(this.effectPath3)).sequence.apply(a,R(this.effectPath3.map(function(a,A){return Y(o.circleGlow.node).to(.01,{position:new ei(a.x,a.y,C)},{easing:e3.linear})}))).start(),[2]})}),function(){return D.apply(this,arguments)})},{key:"createCircleEffectPath",value:function(a,o){if(!(this.effectPath.length>0)){for(var C=.55*Math.PI,A=0;A<16;A++){C-=Math.PI/13;var P=a+504*Math.cos(-C),I=o+504*Math.sin(-C);C>.8&&(P-=125,I-=100),this.effectPath.push(new H(P,I))}this.effectPath.reverse()}}},{key:"createCircleEffectPath2",value:function(a,o){if(!(this.effectPath2.length>0)){for(var C=1.54*Math.PI,A=0;A<17;A++){C-=Math.PI/16;var P=a+504*Math.cos(-C),I=o+504*Math.sin(-C);this.effectPath2.push(new H(P,I))}this.effectPath2.reverse()}}},{key:"createCircleEffectPath3",value:function(a,o){if(!(this.effectPath3.length>0)){for(var C=2.3*Math.PI,A=0;A<11;A++){C-=Math.PI/16;var P=a+504*Math.cos(-C),I=o+504*Math.sin(-C);this.effectPath3.push(new H(P,I))}this.effectPath3.reverse()}}},{key:"handleGiftOpened",value:(F=B(function(a){var o,C,A,P,I,B;return _ts_generator(this,function(R){switch(R.label){case 0:if(this.smallSpakleEffect.play(),o=this.giftBlockAnimator.node.getPosition().clone(),this.spakleEffect.node.setPosition(o),this.spakleEffect.play(),C=this.itemRewardManager.createItemReward("undo",new ei(0,-100,0)),A=this.itemRewardManager.createItemReward("magicWand",new ei(0,-100,0)),P=this.itemRewardManager.createItemReward("shuffle",new ei(0,-100,0)),!(C&&P&&A))return[3,3];switch(I=[C,A,P],a){case 1:null==C||C.setNumberLabel(3),null==A||A.setNumberLabel(3),null==P||P.setNumberLabel(3);break;case 2:null==C||C.setNumberLabel(2),null==A||A.setNumberLabel(2),null==P||P.setNumberLabel(2);break;case 3:null==C||C.setNumberLabel(1),null==A||A.setNumberLabel(1),null==P||P.setNumberLabel(1);break;default:if(null==C||C.setNumberLabel(1),null==A||A.setNumberLabel(1),I=[C,A],B=this.textReward.getComponent(er))B.string=globalThis.game.language.getText("You got 2 rewards!")}return[4,Promise.all([this.playTextAnimationsAfterClickCollect(),this.itemRewardManager.playAllItemsAnimation(I)])];case 1:return R.sent(),[4,this.giftBlockAnimator.playCloseGiftBlockAnimation()];case 2:R.sent(),this.fadeInCollectButton(),R.label=3;case 3:return[2]}})}),function(a){return F.apply(this,arguments)})},{key:"setOpacity",value:function(a,o){var C=a.getComponent(ea);C&&(C.opacity=o)}},{key:"setYPosition",value:function(a,o){var C=a.getPosition(),A=C.x,P=C.z;a.setPosition(A,o,P)}},{key:"playTextReceiveAnimation",value:(L=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return[4,ts.waitTweenAsync(.4)];case 1:if(P.sent(),a=this.createOpacityTween(this.textReceive,255,.1),o=this.createMoveTween(this.textReceive,new ei(0,-40,0),.1,e3.sineInOut),!a)return[3,6];return[4,Promise.all([ts.runTweenAsync(a),ts.runTweenAsync(o)])];case 2:return P.sent(),C=this.createMoveTween(this.textReceive,new ei(0,125,0),.25,e3.backInOut),[4,ts.runTweenAsync(C)];case 3:return P.sent(),[4,ts.waitTweenAsync(.2)];case 4:return P.sent(),A=this.createMoveTween(this.textReceive,new ei(0,-30,0),.5,e3.backOut),[4,ts.runTweenAsync(A)];case 5:P.sent(),P.label=6;case 6:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"playTextAnimationsAfterClickCollect",value:(E=B(function(){var a,o,C,A,P,I,B,R,E,L,O,N;return _ts_generator(this,function(F){switch(F.label){case 0:if(!(a=this.createOpacityTween(this.textReceive,0,.125)))return[3,7];return[4,ts.runTweenAsync(a)];case 1:if(F.sent(),o=this.createMoveTween(this.textTitle,new ei(0,20,0),.125,e3.linear),C=this.createOpacityTween(this.textTitle,255,.125),A=this.createMoveTween(this.textReward,new ei(0,20,0),.125,e3.linear),P=this.createOpacityTween(this.textReward,255,.125),!(C&&P))return[3,7];return[4,Promise.all([ts.runTweenAsync(o),ts.runTweenAsync(C),ts.runTweenAsync(A),ts.runTweenAsync(P)])];case 2:return F.sent(),[4,ts.waitTweenAsync(1.1)];case 3:if(F.sent(),I=this.createScaleTween(this.textReward,1.1,1,e3.sineOut),B=this.createMoveTween(this.textTitle,new ei(0,-2,0),.5,e3.sineOut),!(R=this.createOpacityTween(this.textTitle,127.5,.5)))return[3,7];return[4,Promise.all([ts.runTweenAsync(I),ts.runTweenAsync(B),ts.runTweenAsync(R)])];case 4:if(F.sent(),E=this.createMoveTween(this.textReward,new ei(0,-27,0),.5,e3.backOut),L=this.createScaleTween(this.textReward,1,.5,e3.backOut),O=this.createMoveTween(this.textTitle,new ei(0,-27,0),.5,e3.backOut),!(N=this.createOpacityTween(this.textTitle,255,.5)))return[3,6];return[4,Promise.all([ts.runTweenAsync(E),ts.runTweenAsync(L),ts.runTweenAsync(O),ts.runTweenAsync(N)])];case 5:F.sent(),F.label=6;case 6:F.label=7;case 7:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"fadeInCollectButton",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(!(a=this.createOpacityTween(this.collectButton,255,.233)))return[3,2];return[4,ts.runTweenAsync(a)];case 1:o.sent(),o.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"createOpacityTween",value:function(a,o,C){var A=a.getComponent(ea);return A?Y(A).to(C,{opacity:o}):null}},{key:"createMoveTween",value:function(a,o,C,A){var P=a.getPosition(),I=P.x,B=P.y,R=P.z;return Y(a).to(C,{position:new ei(I+o.x,B+o.y,R)},{easing:A})}},{key:"createScaleTween",value:function(a,o,C,A){return Y(a).to(C,{scale:new ei(o,o,o)},{easing:A})}},{key:"changeTextTitle",value:function(a){var o=this.textTitle.getComponent(er);o&&(o.string=a)}}]),k}(eo)).prototype,"giftBlockAnimator",[eaq,eaU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ea7=L(ea5.prototype,"itemRewardManager",[eaH,eaW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ea8=L(ea5.prototype,"textReceive",[eaV,eaK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ea9=L(ea5.prototype,"textTitle",[eaY,eaj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eoe=L(ea5.prototype,"textReward",[eaX,eaJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eot=L(ea5.prototype,"circleGlow",[eaZ,eaQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eon=L(ea5.prototype,"smallSpakleEffect",[ea$,ea0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eoi=L(ea5.prototype,"spakleEffect",[ea1,ea2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eor=L(ea5.prototype,"collectButton",[ea3,ea4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ea5))||ea5);U._RF.pop(),U._RF.push({},"c9887RMBCJJ37ClupQGx+Zj","RewardTournamentScreen",void 0);var eoA,eo_,eoP,eoI,eoB,eoR=$.ccclass,eoE=$.property,eoL=$.disallowMultiple,eoO=$.requireComponent,eoN=GameCore.Events,eoF=globalThis.game,eoD=eoF.event,eoM=eoF.event;eol=eoR("RewardTournamentScreen"),eou=eoO(Bi),eoc=eoE(ef),eoh=tj.required,eop=eoE(eoC),eod=tj.required,eof=tj.required,eoy=tj.required,eol(eov=eoL(eov=eou((eog=L((eom=function(P){C(d,P);var I,R,E,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"collectButton",eog,N(a)),O(a,"rewardTournamentAnimation",eob,N(a)),O(a,"screen",eok,N(a)),O(a,"screenOpacity",eow,N(a)),a.collectButtonBubbleTween=null,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("ChapterCompleteScreen: screen not found");a.validateEventPayload(o)&&(a.screen.data=o.screenData||{},a.prepareOpenScreen())},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(d,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.listenScreenEvents(),this.registryButtonEvents(),this.setUpScreen(),this.validateRequiredComponents(),this.setUpBubbleButtons(),this.toggleButtonsInteractable(!1)}},{key:"setUpScreen",value:function(){this.rewardTournamentAnimation.setUpData(),this.screenOpacity=this.getComponent(ea)}},{key:"onLoad",value:function(){this.updateCollectButtonPosition()}},{key:"updateCollectButtonPosition",value:function(){var a=0;try{a=game.ads.getBannerHeight(GameCore.Configs.Ads.BannerDisplayAdOptions[0].PlacementId,tc.cssSizeToWorldSize(1),!0)}catch(a){}var o=this.collectButton.getComponent(eX);o&&a&&(o.bottom+=a)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,d)}},{key:"listenScreenEvents",value:function(){eoD.on(eoN.OPENING_SCREEN,this.handleOpeningScreen),eoD.on(eoN.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){eoD.off(eoN.OPENING_SCREEN,this.handleOpeningScreen),eoD.off(eoN.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"registryButtonEvents",value:function(){this.collectButton.node.on(ef.EventType.CLICK,this.handleClickedCollectBtn,this)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"open",value:(L=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:return o=void 0===(a=this.screen.data.playerRank)?0:a,this.handleOpenFromRewardTournamentScreen(o),th.playMusic(tZ.WIN_MUSIC),th.playSound(tZ.FAIRY_DUST),this.storeItemsToGameData(o),[4,this.rewardTournamentAnimation.playAnims(o)];case 1:return C.sent(),this.toggleButtonsInteractable(!0),eoD.emit(eoN.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),eoM.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return L.apply(this,arguments)})},{key:"close",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.toggleButtonsInteractable(!1),[4,this.fadeOutScreen()];case 1:return a.sent(),this.node.active=!1,eoD.emit(eoN.CLOSED_SCREEN,{screenName:this.node.name}),eoD.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return E.apply(this,arguments)})},{key:"toggleButtonsInteractable",value:function(a){this.collectButton.interactable=a}},{key:"handleClickedCollectBtn",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),this.rewardTournamentAnimation.hideAllItemRewards(),[4,t_.closeScreenAsync(tP.REWARD_TOURNAMENT_SCREEN)];case 1:return a.sent(),th.playMusic(tZ.DASHBOARD_MUSIC),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"prepareOpenScreen",value:function(){this.stopCollectButtonAnimation(),this.screenOpacity.opacity=255,this.resetCollectButton(),this.resetContainer(),this.runCollectButtonAnimation(),this.rewardTournamentAnimation.prepareAnims()}},{key:"resetCollectButton",value:function(){var a=this.collectButton.getComponent(ea);a&&(a.opacity=0)}},{key:"resetContainer",value:function(){this.screen.container.scale=ei.ONE;var a=this.screen.container.getComponent(ea);a&&(a.opacity=256)}},{key:"runCollectButtonAnimation",value:function(){this.collectButtonBubbleTween&&this.collectButtonBubbleTween.start()}},{key:"stopCollectButtonAnimation",value:function(){this.collectButtonBubbleTween&&(this.collectButtonBubbleTween.stop(),this.collectButton.node.setScale(1,1,1))}},{key:"setUpBubbleButtons",value:function(){this.collectButtonBubbleTween=ti(this.collectButton.node);var a=this.collectButton.getComponent(az);a&&(a.animationUp=this.collectButtonBubbleTween)}},{key:"fadeOutScreen",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.screenOpacity).to(.25,{opacity:0}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"handleOpenFromRewardTournamentScreen",value:function(a){var o="";o="br"===globalThis.game.language.getCurrentLocale()?"".concat(nn.PREFIX_TOUR_AT_RANK_BR," ").concat(a).concat(nn.ORDINAL_BR," ").concat(nn.POSTFIX_TOUR_AT_RANK_EN):"".concat(nn.PREFIX_TOUR_AT_RANK_EN," ").concat(a).concat(1===a?"st":2===a?"nd":3===a?"rd":"th"," ").concat(nn.POSTFIX_TOUR_AT_RANK_EN),this.rewardTournamentAnimation.changeTextTitle(o)}},{key:"storeItemsToGameData",value:function(a){var o=td.gameScene.gamePlay.gameDataManager.getItems(),C=this.addItemBasedOnPlayerRank(a),A=C.undo,P=C.magicWand,I=C.shuffle;this.sendAnalytics(a,{undo:A,magicWand:P,shuffle:I}),td.gameScene.gamePlay.gameDataManager.setGameData({items:{undo:o.undo+A,return:o.return,shuffle:o.shuffle+I,extraSlot:o.extraSlot,magicWand:o.magicWand+P}})}},{key:"addItemBasedOnPlayerRank",value:function(a){return[{undo:3,magicWand:3,shuffle:3},{undo:2,magicWand:2,shuffle:2},{undo:1,magicWand:1,shuffle:1},{undo:1,magicWand:1,shuffle:0}][a>=1&&a<=3?a-1:3]}},{key:"sendAnalytics",value:function(a,o){for(var C=o.undo,A=o.magicWand,P=o.shuffle,I=[],B=td.gameScene.gamePlay.gameDataManager.getLevel(),R=0,E=[{typeName:tk.MAGIC,amount:A},{typeName:tk.UNDO,amount:C},{typeName:tk.SHUFFLE,amount:P}];R<E.length;R++){var L=E[R],O=L.typeName,N=L.amount;N>0&&I.push({resourceTypeName:O,resourceChange:N})}tS({maxPlayerLevel:B,playerRankTournament:a,resourceTransaction:I,transactionCount:1,transactionType:"tournament_reward"})}}]),d}(eo)).prototype,"collectButton",[eoc,eoh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eob=L(eom.prototype,"rewardTournamentAnimation",[eop,eod],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eok=L(eom.prototype,"screen",[eof],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eow=L(eom.prototype,"screenOpacity",[eoy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eov=eom))||eov)||eov),U._RF.pop(),U._RF.push({},"8ab3e2kHVBOR75wbMu8efOp","DailyRewardButtonAnim",void 0);var eox,eoz,eoG,eoq,eoU,eoH=$.ccclass,eoW=$.property;eoA=eoH("DailyRewardButtonAnim"),eo_=eoW(ee),eoP=tj.required,eoA((eoB=L((eoI=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"gift",eoB,N(a)),a.originalGiftPosition=void 0,a.giftAnim=null,a}return a(r,[{key:"__preload",value:function(){this.originalGiftPosition=this.gift.position.clone(),tj.validateRequiredProperties(this,r)}},{key:"onEnable",value:function(){this.play()}},{key:"onDisable",value:function(){this.stop()}},{key:"play",value:function(){if(this.originalGiftPosition){var a=this.originalGiftPosition,o=a.x,C=a.y,A=a.z,P=Y(this.gift).to(.15,{position:new ei(o,C+10,A)}),I=Y(this.gift).by(.125,{angle:10}).by(.125,{angle:-20}).by(.125,{angle:20}).by(.125,{angle:-10}).by(.01,{angle:0}),B=Y(this.gift).to(.18,{position:new ei(o,C,A)});this.giftAnim=Y(this.gift).delay(3).then(P).then(I).then(B).union().repeatForever().start()}}},{key:"stop",value:function(){this.giftAnim&&(this.giftAnim.stop(),this.giftAnim=null),this.originalGiftPosition&&(this.gift.setPosition(this.originalGiftPosition.clone()),this.gift.angle=0)}}]),r}(eo)).prototype,"gift",[eo_,eoP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eoI)),U._RF.pop(),U._RF.push({},"bf43flypjZMobyWtjH0XjOg","Mill",void 0);var eoV,eoK,eoY,eoj,eoX,eoJ,eoZ,eoQ,eo$,eo0,eo1,eo2,eo3,eo4,eo5=$.ccclass,eo6=$.property;eox=eo5("Mill"),eoz=eo6(ee),eoG=tj.required,eox((eoU=L((eoq=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"orthographicNode",eoU,N(a)),a.currentTween=null,a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"start",value:function(){this.playAnim()}},{key:"playAnim",value:function(){this.currentTween=Y(this.orthographicNode).by(8.742,{angle:360}).repeatForever().start()}},{key:"stopAnim",value:function(){this.currentTween&&(this.currentTween.stop(),this.orthographicNode.angle=0)}}]),r}(eo)).prototype,"orthographicNode",[eoz,eoG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eoq)),U._RF.pop(),U._RF.push({},"914780xKHpIDrBUi9XG7WCK","ContainerSelectLanguage",void 0);var eo7,eo8,eo9,ese,est,esn,esi,esr,esa,eso,ess,esl,esu=$.ccclass,esc=$.property,esh=(eoV=esu("ContainerSelectLanguage"),eoK=esc(ee),eoY=tj.required,eoj=esc(ee),eoX=tj.required,eoJ=esc(ee),eoZ=tj.required,eoQ=esc(ef),eo$=tj.required,eoV((eo1=L((eo0=function(P){C(d,P);var I,R,E,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"topContainer",eo1,N(a)),O(a,"middleContainer",eo2,N(a)),O(a,"bottomContainer",eo3,N(a)),O(a,"closeButton",eo4,N(a)),a.screenAnimation=null,a.popupAnimation=null,a}return a(d,[{key:"__preload",value:function(){this.initComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,d)}},{key:"initComponents",value:function(){this.validateRequiredComponents()}},{key:"onClickCloseButton",set:function(a){this.closeButton.node.on(ef.EventType.CLICK,a,this)}},{key:"checkPointerInPopup",value:function(a){return!!this.isPointInWorldBounds(this.topContainer,a)||!!this.isPointInWorldBounds(this.middleContainer,a)||!!this.isPointInWorldBounds(this.bottomContainer,a)}},{key:"isPointInWorldBounds",value:function(a,o){var C,A=tc.getBoundingBoxToWorld(a);return null!=(C=null==A?void 0:A.contains(o))&&C}},{key:"runScreenEntranceAnimation",value:(L=B(function(){var a,o,C;return _ts_generator(this,function(A){if(o=this,null==(a=this.screenAnimation)||a.stop(),C=this.node.getComponent(ea))return[2,(C.opacity=0,new Promise(function(a){o.screenAnimation=Y(C).to(.25,{opacity:255}).call(function(){a()}).start()}))];return[2]})}),function(){return L.apply(this,arguments)})},{key:"runScreenExitAnimation",value:(E=B(function(){var a,o,C;return _ts_generator(this,function(A){if(o=this,null==(a=this.screenAnimation)||a.stop(),C=this.node.getComponent(ea))return[2,new Promise(function(a){o.screenAnimation=Y(C).to(.25,{opacity:0}).call(function(){a()}).start()})];return[2]})}),function(){return E.apply(this,arguments)})},{key:"runPopupEntranceAnimation",value:(R=B(function(a){var o,C;return _ts_generator(this,function(a){return C=this,[2,(null==(o=this.popupAnimation)||o.stop(),new Promise(function(a){C.popupAnimation=Y(C.node).to(.3,{scale:new ei(1,1,1)},{easing:"backOut"}).call(function(){a()}).start()}))]})}),function(a){return R.apply(this,arguments)})},{key:"runPopupExitAnimation",value:(I=B(function(a){var o,C;return _ts_generator(this,function(a){return C=this,[2,(null==(o=this.popupAnimation)||o.stop(),new Promise(function(a){C.popupAnimation=Y(C.node).to(.3,{scale:new ei(.5,.5,.5)},{easing:"backIn"}).call(function(){a()}).start()}))]})}),function(a){return I.apply(this,arguments)})}]),d}(eo)).prototype,"topContainer",[eoK,eoY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo2=L(eo0.prototype,"middleContainer",[eoj,eoX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo3=L(eo0.prototype,"bottomContainer",[eoJ,eoZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo4=L(eo0.prototype,"closeButton",[eoQ,eo$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo0))||eo0);U._RF.pop(),U._RF.push({},"eb4c4kWU39DqLL6rAclmvGT","SelectLanguageScreen",void 0);var esp=$.ccclass,esd=$.property,esf=$.disallowMultiple,esy=$.requireComponent,esv=GameCore.Events,esm=globalThis.game,esg=esm.event,esb=esm.event;eo7=esp("SelectLanguageScreen"),eo8=esy(Bi),eo9=esd(esh),ese=tj.required,est=esd(ef),esn=tj.required,esi=tj.required,eo7(esr=esf(esr=eo8((eso=L((esa=function(P){C(y,P);var I,R,E,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"container",eso,N(a)),O(a,"touchZone",ess,N(a)),O(a,"screen",esl,N(a)),a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("SelectLanguageScreen: screen not found");a.validateEventPayload(o)},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(y,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents(),this.registryButtonEvents(),this.init()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.updateContainerWidget()}},{key:"updateContainerWidget",value:function(){try{var a=tf.getBannerAdWorldHeight();if(a<=0)return;var o=this.container.getComponent(eX);if(!o)return;o.verticalCenter=a/2,o.updateAlignment()}catch(a){return}}},{key:"init",value:function(){this.container.node.scale=new ei(.5,.5,.5)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,y)}},{key:"listenScreenEvents",value:function(){esg.on(esv.OPENING_SCREEN,this.handleOpeningScreen),esg.on(esv.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){esg.off(esv.OPENING_SCREEN,this.handleOpeningScreen),esg.off(esv.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"registryButtonEvents",value:function(){this.container.onClickCloseButton=this.handleClickedCloseBtn.bind(this),this.touchZone.node.on(ee.EventType.TOUCH_END,this.handleCancelBtnClickForTouchZone,this)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"open",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.container.runScreenEntranceAnimation(),[4,this.container.runPopupEntranceAnimation(this.screen)];case 1:return a.sent(),esg.emit(esv.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),esb.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return F.apply(this,arguments)})},{key:"close",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.container.runScreenExitAnimation(),[4,this.container.runPopupExitAnimation(this.screen)];case 1:return a.sent(),this.node.active=!1,esg.emit(esv.CLOSED_SCREEN,{screenName:this.node.name}),esg.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return L.apply(this,arguments)})},{key:"handleClickedCloseBtn",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,Promise.all([t_.closeScreenAsync(tP.SELECT_LANGUAGE_SCREEN),td.gameScene.rubyBarComp.runShowAnimationAsync(),this.fadeInDashboard()])];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleCancelBtnClickForTouchZone",value:function(a){var o=a.getUILocation();this.container.checkPointerInPopup(o)||this.handleCancelClicked()}},{key:"handleCancelClicked",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,Promise.all([t_.closeScreenAsync(tP.SELECT_LANGUAGE_SCREEN),td.gameScene.rubyBarComp.runShowAnimationAsync(),this.fadeInDashboard()])];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"fadeInDashboard",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.node.scene.once(t2.FADED_IN_DASHBOARD_DONE,o),td.gameScene.uiManager.handleScreenReturn()})]})}),function(){return I.apply(this,arguments)})}]),y}(eo)).prototype,"container",[eo9,ese],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ess=L(esa.prototype,"touchZone",[est,esn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),esl=L(esa.prototype,"screen",[esi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),esr=esa))||esr)||esr),U._RF.pop(),U._RF.push({},"50ae9+tc3xKoIZW9mXGkV1g","ContentView",void 0),(0,$.ccclass)("ContentView")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"__preload",value:function(){}},{key:"start",value:function(){}},{key:"drawCountryPanel",value:function(a,o){this.node.addChild(a),a.setPosition(-1.308,-73.732-160*o,1)}}]),r}(eo)),U._RF.pop(),U._RF.push({},"8dcfewZVmxDBqY3rv+cQbbD","LanguagesContainer",void 0);var esk,esw,esS,esT,esC,esA,es_,esP,esI,esB,esR,esE,esL,esO,esN,esF,esD,esM,esx,esz,esG,esq,esU,esH,esW,esV,esK,esY,esj,esX,esJ,esZ,esQ,es$,es0,es1,es2,es3,es4,es5,es6,es7,es8,es9,ele,elt,eln,eli,elr,ela,elo,els,ell,elu,elc,elh,elp,eld,elf,ely,elv,elm,elg,elb,elk,elw=["en","br"],elS=$.ccclass,elT=$.property,elC=globalThis.game.language;esk=elS("LanguagesContainer"),esw=elT([et]),esS=tj.required,esT=elT([et]),esC=tj.required(ni(et)),esA=elT([et]),es_=tj.required(ni(et)),esP=elT(ee),esI=tj.required,esk((esR=L((esB=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"flags",esR,N(a)),O(a,"countriesPurple",esE,N(a)),O(a,"countriesWhite",esL,N(a)),O(a,"countryPanelPrefab",esO,N(a)),a.currentLanguageCode="en",a.currentMarkCountry=null,a.listCountryPanel=[],a.flagsMap=new Map,a.countriesPurpleMap=new Map,a.countriesWhiteMap=new Map,a}return a(r,[{key:"__preload",value:function(){this.loadAllFlags(),this.loadAllCountries(),tj.validateRequiredProperties(this,r)}},{key:"start",value:function(){this.loadAllFlags(),this.loadAllCountries(),this.createCountryPanelByLangs()}},{key:"setCurrentLanguageCode",value:function(){this.currentLanguageCode=elC.getPlayerLanguage()}},{key:"registryButtonEvents",value:function(a){a.node.on(ef.EventType.CLICK,this.handleClickedCountryPanel,this)}},{key:"loadAllFlags",value:function(){var a,o=E(this.flags);try{for(o.s();!(a=o.n()).done;){var C=a.value;this.flagsMap.set(C.name,C)}}catch(a){o.e(a)}finally{o.f()}}},{key:"loadAllCountries",value:function(){var a,o=E(this.countriesPurple);try{for(o.s();!(a=o.n()).done;){var C=a.value;this.countriesPurpleMap.set(C.name,C)}}catch(a){o.e(a)}finally{o.f()}var A,P=E(this.countriesWhite);try{for(P.s();!(A=P.n()).done;){var I=A.value;this.countriesWhiteMap.set(I.name,I)}}catch(a){P.e(a)}finally{P.f()}}},{key:"getFlag",value:function(a){return this.flagsMap.get(a)}},{key:"getCountryPurple",value:function(a){return this.countriesPurpleMap.get(a)}},{key:"getCountryWhite",value:function(a){return this.countriesWhiteMap.get(a)}},{key:"setPropertiesCountryPanel",value:function(a,o,C){var A,P,I=null==(A=a.getChildByName("Flag"))?void 0:A.getComponent(W);I&&(I.spriteFrame=o);var B=null==(P=a.getChildByName("Name"))?void 0:P.getComponent(W);return B&&(B.spriteFrame=C),a}},{key:"updateCheckMarkCountryPanel",value:function(){for(var a=0;a<this.listCountryPanel.length;a++)this.getCountryPurple(elw[a]).name===this.currentLanguageCode?this.setCheckMarkCountryPanel(this.listCountryPanel[a],!0):this.setCheckMarkCountryPanel(this.listCountryPanel[a],!1)}},{key:"setCheckMarkCountryPanel",value:function(a,o){var C=a.getChildByName("CheckMarkSquare");if(C){var A=C.getChildByName("CheckMark");A&&(A.active=o)}}},{key:"createCountryPanelByLangs",value:function(){var a,o;this.setCurrentLanguageCode();for(var C=null!=(a=null==(o=this.node.getComponent(en))?void 0:o.height)?a:0,A=0;A<elw.length;A++){var P=ej(this.countryPanelPrefab);this.setCountryButtonName(P,elw[A]),P.active=!0;var I=P.getComponent(ef);if(I&&this.registryButtonEvents(I),"br"===elw[A]){var B=P.getChildByName("Name");B&&B.setPosition(B.position.x+35,B.position.y)}var R=this.getFlag("flag-".concat(elw[A])),E=this.getCountryPurple(elw[A]);this.setPropertiesCountryPanel(P,R,E),this.node.addChild(P),P.setPosition(-1.308,-73.732-160*A+C/2,1),this.listCountryPanel.push(P)}this.updateCheckMarkCountryPanel()}},{key:"handleClickedCountryPanel",value:function(a){var o=this;this.currentMarkCountry!==a.node&&(this.currentMarkCountry=a.node,this.updateCurrentLanguageCode(),this.updateCheckMarkCountryPanel(),ep.emit(tl.PRELOAD_LANGUAGE,{locale:this.currentLanguageCode,onLoad:function(){ep.emit(tl.CHOOSE_LANGUAGE,{locale:o.currentLanguageCode,saveToPlayerData:!0})},onError:function(a){}}))}},{key:"updateCurrentLanguageCode",value:function(){var a;if(null!==this.currentMarkCountry){var o=this.currentMarkCountry.getChildByName("Name");if(o){var C=o.getComponent(W);if(C){var A=null==(a=C.spriteFrame)?void 0:a.name;A&&(this.currentLanguageCode=A)}}}}},{key:"setCountryButtonName",value:function(a,o){var C=o.charAt(0).toUpperCase()+o.slice(1);a.name="".concat(C,"CountryBtn")}}]),r}(eo)).prototype,"flags",[esw,esS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),esE=L(esB.prototype,"countriesPurple",[esT,esC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),esL=L(esB.prototype,"countriesWhite",[esA,es_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),esO=L(esB.prototype,"countryPanelPrefab",[esP,esI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),esB)),U._RF.pop(),U._RF.push({},"fc4b1rbBSlNUqX/jSioKxYZ","ContainerBaseSetting",void 0);var elA,el_,elP,elI,elB,elR,elE,elL,elO,elN,elF,elD,elM,elx=$.ccclass,elz=$.property,elG=globalThis.game.getBuildVersion(),elq=(esN=elx("ContainerBaseSetting"),esF=elz(ee),esD=tj.required,esM=elz(ee),esx=tj.required,esz=elz(ee),esG=tj.required,esq=elz(ef),esU=tj.required,esH=elz(ef),esW=tj.required,esV=elz(ef),esK=tj.required,esY=elz(ef),esj=tj.required,esX=elz(ef),esJ=tj.required,esZ=elz(ef),esQ=tj.required,es$=elz(ef),es0=tj.required,es1=elz(ef),es2=tj.required,es3=elz(ef),es4=tj.required,es5=elz(er),es6=tj.required,es7=elz(ef),es8=tj.required,es9=elz(Bg),ele=tj.required,elt=tj.required,eln=tj.required,esN((elr=L((eli=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"topContainer",elr,N(a)),O(a,"middleContainer",ela,N(a)),O(a,"bottomContainer",elo,N(a)),O(a,"cancelButton",els,N(a)),O(a,"inviteButton",ell,N(a)),O(a,"musicButton",elu,N(a)),O(a,"soundButton",elc,N(a)),O(a,"mapBtn",elh,N(a)),O(a,"replayBtn",elp,N(a)),O(a,"tutorialBtn",eld,N(a)),O(a,"fanpageBtn",elf,N(a)),O(a,"languageBtn",ely,N(a)),O(a,"textBuildVersion",elv,N(a)),O(a,"joinGroupBtn",elm,N(a)),O(a,"glowDot",elg,N(a)),O(a,"musicSwitch",elb,N(a)),O(a,"soundSwitch",elk,N(a)),a}return a(r,[{key:"onEnable",value:function(){this.setStateBtn()}},{key:"setStateBtn",value:function(){var a=td.gameScene.uiManager.getCurrentScreen();(null==a?void 0:a.name)===tO[tP.DASHBOARD_SCREEN]?(this.mapBtn.node.active=!1,this.replayBtn.node.active=!1,this.tutorialBtn.node.active=!0,this.languageBtn.node.active=!0):(this.mapBtn.node.active=!0,this.replayBtn.node.active=!0,this.tutorialBtn.node.active=!1,this.languageBtn.node.active=!1)}},{key:"__preload",value:function(){this.initComponents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,r)}},{key:"initComponents",value:function(){this.musicSwitch=this.musicButton.node.getComponent(mq),this.soundSwitch=this.soundButton.node.getComponent(mq),this.validateRequiredComponents()}},{key:"updateSwitchDataUI",value:function(a,o,C){this.musicSwitch.setEnabled(a),this.soundSwitch.setEnabled(o)}},{key:"onClickMusicButton",set:function(a){this.musicButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickSoundButton",set:function(a){this.soundButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickCancelButton",set:function(a){this.cancelButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickInviteButton",set:function(a){this.inviteButton.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickMapButton",set:function(a){this.mapBtn.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickReplayButton",set:function(a){this.replayBtn.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickTutorialButton",set:function(a){this.tutorialBtn.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickFanpageButton",set:function(a){this.fanpageBtn.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickLanguageButton",set:function(a){this.languageBtn.node.on(ef.EventType.CLICK,a,this)}},{key:"onClickJoinGroupButton",set:function(a){this.joinGroupBtn.node.on(ef.EventType.CLICK,a,this)}},{key:"checkPointerInPopup",value:function(a){return!!this.isPointInWorldBounds(this.topContainer,a)||!!this.isPointInWorldBounds(this.middleContainer,a)||!!this.isPointInWorldBounds(this.bottomContainer,a)}},{key:"isPointInWorldBounds",value:function(a,o){var C,A;return null!=(C=null==(A=a.getComponent(en))?void 0:A.hitTest(o))&&C}},{key:"setBuildVersion",value:function(){var a="".concat(elG,".").concat(this.hashToXDigits(String(elG),2),".").concat(this.hashToXDigits(String(elG),3)," (").concat(this.hashToXDigits(String(elG),4),")");this.textBuildVersion.string=a}},{key:"hashToXDigits",value:function(a,o){return function(a){for(var o=0,C=0;C<a.length;C++)o=(o<<5)-o+a.charCodeAt(C)|0;return Math.abs(o)}(String(a))%(9*Math.pow(10,o-1))+Math.pow(10,o-1)}}]),r}(eo)).prototype,"topContainer",[esF,esD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ela=L(eli.prototype,"middleContainer",[esM,esx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elo=L(eli.prototype,"bottomContainer",[esz,esG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),els=L(eli.prototype,"cancelButton",[esq,esU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ell=L(eli.prototype,"inviteButton",[esH,esW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elu=L(eli.prototype,"musicButton",[esV,esK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elc=L(eli.prototype,"soundButton",[esY,esj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elh=L(eli.prototype,"mapBtn",[esX,esJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elp=L(eli.prototype,"replayBtn",[esZ,esQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eld=L(eli.prototype,"tutorialBtn",[es$,es0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elf=L(eli.prototype,"fanpageBtn",[es1,es2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ely=L(eli.prototype,"languageBtn",[es3,es4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elv=L(eli.prototype,"textBuildVersion",[es5,es6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elm=L(eli.prototype,"joinGroupBtn",[es7,es8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elg=L(eli.prototype,"glowDot",[es9,ele],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elb=L(eli.prototype,"musicSwitch",[elt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elk=L(eli.prototype,"soundSwitch",[eln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eli))||eli);U._RF.pop(),U._RF.push({},"d4939JfOx5Jv6F0rzhbzqth","ContainerMobileSetting",void 0);var elU,elH,elW,elV,elK,elY,elj,elX,elJ,elZ,elQ,el$,el0,el1,el2,el3,el4=$.ccclass,el5=$.property,el6=(elA=el4("ContainerMobileSetting"),el_=el5(W),elP=tj.required,elI=el5(er),elB=tj.required,elR=el5(ef),elE=tj.required,elL=tj.required,elA((elN=L((elO=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"vibrationIcon",elN,N(a)),O(a,"vibrationLabel",elF,N(a)),O(a,"vibrationButton",elD,N(a)),O(a,"vibrationSwitch",elM,N(a)),a}return a(r,[{key:"initComponents",value:function(){this.vibrationSwitch=this.vibrationButton.node.getComponent(mq),M(D(r.prototype),"initComponents",this).call(this),tj.validateRequiredProperties(this,r)}},{key:"updateSwitchDataUI",value:function(a,o,C){M(D(r.prototype),"updateSwitchDataUI",this).call(this,a,o),this.vibrationSwitch.setEnabled(C)}},{key:"onClickVibrationButton",set:function(a){this.vibrationButton.node.on(ef.EventType.CLICK,a,this)}},{key:"hideVibrationComponents",value:function(){var a=this.getComponent(en);a&&a.setContentSize(a.width,1360);for(var o=0,C=[this.vibrationIcon,this.vibrationLabel,this.vibrationButton];o<C.length;o++)C[o].node.active=!1}}]),r}(elq)).prototype,"vibrationIcon",[el_,elP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elF=L(elO.prototype,"vibrationLabel",[elI,elB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elD=L(elO.prototype,"vibrationButton",[elR,elE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elM=L(elO.prototype,"vibrationSwitch",[elL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elO))||elO);U._RF.pop(),U._RF.push({},"aa42eiH6SRPgIrLdv4lkiC1","SettingsScreen",void 0);var el7=$.ccclass,el8=$.property,el9=GameCore,eue=el9.Events,eut=el9.Utils,eun=globalThis.game,eui=eun.event,eur=eun.player,eua=eun.analytics;elU=el7("SettingsScreen"),elH=el8(el6),elW=tj.required,elV=el8(ee),elK=tj.required,elY=el8(ef),elj=tj.required,elX=el8(ee),elJ=tj.required,elZ=tj.required,elU((el$=L((elQ=function(P){C(_,P);var I,R,E,L,F,D,M,x,z,q,U,H,V,j,X,J,Z,Q,$,et=A(_);function _(){var a;o(this,_);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=et.call.apply(et,[this].concat(A)),O(a,"mobileContainer",el$,N(a)),O(a,"container",el0,N(a)),O(a,"touchZone",el1,N(a)),O(a,"purpleBackground",el2,N(a)),O(a,"baseScreen",el3,N(a)),a.cheatLogic=new Pz,a.popupAnimation=null,a.screenAnimation=null,a.enableCloseOnTouch=!0,a.handleOpeningScreen=function(o){a.validateEventPayload(o)&&(a.updateSwitchDataUI(o),a.updateScreenData(o))},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a.handleJoinGroup=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:tV(),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,FBInstant.community.canJoinOfficialGroupAsync()];case 2:if(!a.sent())return[3,4];return[4,FBInstant.community.joinOfficialGroupAsync()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return a.sent(),[3,6];case 6:return[2]}})}),a}return a(_,[{key:"__preload",value:function(){this.listenScreenEvents(),"WEB"===GameSDK.getPlatform()&&this.mobileContainer.hideVibrationComponents(),this.baseScreen=this.node.getComponent("BaseScreen"),this.baseScreen.open=this.open.bind(this),this.baseScreen.close=this.close.bind(this),this.mobileContainer.node.scale=new ei(.5,.5),this.validateRequiredComponents()}},{key:"open",value:($=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return this.cheatLogic.resetCheatAction(),a=this.mobileContainer.glowDot,th.playSound(tZ.POPUP_SHOW),this.setNodeOpacity(this.purpleBackground,255),a.prepareGlow(),this.runScreenEntranceAnimation(),[4,this.runPopupEntranceAnimation()];case 1:return o.sent(),a.runGlow(),eui.emit(eue.OPENED_SCREEN,{screenName:this.node.name}),eui.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return $.apply(this,arguments)})},{key:"close",value:(Q=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.POPUP_OFF),this.runScreenExitAnimation(),this.fadeOutPurpleBackground(),this.mobileContainer.glowDot.stopGlow(),[4,this.runPopupExitAnimation()];case 1:return a.sent(),eui.emit(eue.CLOSED_SCREEN,{screenName:this.node.name}),this.node.active=!1,eui.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return Q.apply(this,arguments)})},{key:"runScreenEntranceAnimation",value:(Z=B(function(){var a,o,C;return _ts_generator(this,function(A){if(o=this,null==(a=this.screenAnimation)||a.stop(),C=this.container.getComponent(ea))return[2,(C.opacity=0,new Promise(function(a){o.screenAnimation=Y(C).to(.25,{opacity:255}).call(function(){a()}).start()}))];return[2]})}),function(){return Z.apply(this,arguments)})},{key:"runScreenExitAnimation",value:(J=B(function(){var a,o,C;return _ts_generator(this,function(A){if(o=this,null==(a=this.screenAnimation)||a.stop(),C=this.container.getComponent(ea))return[2,new Promise(function(a){o.screenAnimation=Y(C).to(.25,{opacity:0}).call(function(){a()}).start()})];return[2]})}),function(){return J.apply(this,arguments)})},{key:"runPopupEntranceAnimation",value:(X=B(function(){var a,o;return _ts_generator(this,function(C){return o=this,[2,(this.mobileContainer.setBuildVersion(),null==(a=this.popupAnimation)||a.stop(),new Promise(function(a){o.popupAnimation=Y(o.mobileContainer.node).to(.3,{scale:new ei(1,1,1)},{easing:"backOut"}).call(function(){a()}).start()}))]})}),function(){return X.apply(this,arguments)})},{key:"runPopupExitAnimation",value:(j=B(function(){var a,o;return _ts_generator(this,function(C){return o=this,[2,(null==(a=this.popupAnimation)||a.stop(),new Promise(function(a){o.popupAnimation=Y(o.mobileContainer.node).to(.3,{scale:new ei(.5,.5,.5)},{easing:"backIn"}).call(function(){a()}).start()}))]})}),function(){return j.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.registryButtonEvents(),this.updateContainerWidget()}},{key:"start",value:function(){var a=this.container.getComponent(ea);a&&Y(a).to(.3,{opacity:255},{easing:"smooth"}).start()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,_)}},{key:"registryButtonEvents",value:function(){var a=this,o=this.mobileContainer;o.onClickMusicButton=function(){a.handleMusicClicked()},o.onClickSoundButton=function(){a.handleSoundClicked()},o.onClickCancelButton=function(){a.handleCancelClicked()},o.onClickInviteButton=function(){a.handleInviteClicked()},o.onClickMapButton=function(){a.handleMapClicked()},o.onClickReplayButton=function(){a.handleReplayClicked()},o.onClickVibrationButton=function(){a.handleVibrationClicked()},o.onClickTutorialButton=function(){a.handleTutorialClicked()},o.onClickFanpageButton=function(){a.handleFanPageClicked()},o.onClickLanguageButton=function(){a.handleLanguageClicked()},o.onClickJoinGroupButton=function(){a.handleJoinGroupClicked()},this.touchZone.node.on(ee.EventType.TOUCH_END,this.handleCancelBtnClickForTouchZone,this);var C=this.mobileContainer.node.getChildByName("popup-top");if(C){var i=function(){var o=C.getComponent(W);o&&a.cheatLogic.canPushActionHold2s()&&(o.color=new K(0,255,0),a.cheatLogic.pushCheatAction("hold2s"))};C.on(ee.EventType.TOUCH_START,this.scheduleOnce.bind(this,i,2),this),C.on(ee.EventType.TOUCH_END,this.unschedule.bind(this,i),this),C.on(ee.EventType.TOUCH_CANCEL,this.unschedule.bind(this,i),this)}}},{key:"updateContainerWidget",value:function(){try{var a=tf.getBannerAdWorldHeight();if(a<=0)return;var o=this.container.getComponent(eX);if(!o)return;o.verticalCenter=a/2,o.updateAlignment()}catch(a){return}}},{key:"updateSwitchDataUI",value:function(a){var o=a.screenData,C=o.music,A=o.sound,P=o.vibrate;this.mobileContainer.updateSwitchDataUI(C,A,P)}},{key:"listenScreenEvents",value:function(){eui.on(eue.OPENING_SCREEN,this.handleOpeningScreen),eui.on(eue.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){eui.off(eue.OPENING_SCREEN,this.handleOpeningScreen),eui.off(eue.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"updateScreenData",value:function(a){var o=a.screenData;eut.Valid.isObject(o)&&(o.duration&&o.duration>0&&this.scheduleOnce(function(){t_.closeScreen(tP.SETTINGS_SCREEN)},o.duration),!1===o.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0,this.baseScreen.data=o)}},{key:"handleCancelBtnClickForTouchZone",value:function(a){var o=a.getLocation();this.mobileContainer.checkPointerInPopup(o)||(this.handleCancelClicked(),eua.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:aP[this.touchZone.node.name],screen_name:tp.getCurrentPage()}),this.cheatLogic.pushCheatAction("closeOutside"),this.cheatLogic.isOnCheatMode()&&td.gameScene.checkAndShowDevToolOrNot({forceOpen:!0}))}},{key:"handleCancelClicked",value:(V=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),C=(o=td.gameScene).uiManager,A=o.gamePlay.gameUI.header,P=null==(a=C.getCurrentScreen())?void 0:a.name,I=[t_.closeScreenAsync(tP.SETTINGS_SCREEN),this.fadeInDashboard(),td.gameScene.rubyBarComp.runShowAnimationAsync()],P!==tO[tP.DASHBOARD_SCREEN]&&I.push(A.showButtonsAsync()),[4,Promise.all(I)];case 1:switch(B.sent(),td.gameScene.toggleBlockInputContainer(!1),window.game.match.getMatchState().mode){case"challenge-friend":A.challengeBlock.resumeTimer()}return[2]}})}),function(){return V.apply(this,arguments)})},{key:"fadeInDashboard",value:(H=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.node.scene.once(t2.FADED_IN_DASHBOARD_DONE,o),td.gameScene.uiManager.handleScreenReturn()})]})}),function(){return H.apply(this,arguments)})},{key:"handleMusicClicked",value:function(){th.playSound(tZ.SWITCH);var a=eur.getPlayerSettings().music;eur.setSetting("music",!a),a?th.pauseMusic():th.playMusic(),this.cheatLogic.pushCheatAction("music")}},{key:"handleSoundClicked",value:function(){th.playSound(tZ.SWITCH);var a=eur.getPlayerSettings().sound;eur.setSetting("sound",!a),this.cheatLogic.pushCheatAction("sound")}},{key:"handleVibrationClicked",value:function(){th.playSound(tZ.SWITCH);var a=eur.getPlayerSettings().vibrate;eur.setSetting("vibrate",!a),a||td.gameScene.gamePlay.vibrate.vibrate(50),this.cheatLogic.pushCheatAction("vibration")}},{key:"handleInviteClicked",value:(U=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if("ANDROID"!==GameSDK.getPlatform())return[3,3];if(!("inviteAsync"in GameSDK.extra))return[3,2];return[4,this.inviteAsyncMessage()];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:if(!("shareBestScoreAsync"in GameSDK.extra))return[3,5];return a=GameSDK.extra.shareBestScoreAsync.bind(GameSDK.extra),GameSDK.extra.shareBestScoreAsync=this.shareBestScoreAsync.bind(this),[4,GameSDK.extra.shareBestScoreAsync()];case 4:o.sent(),GameSDK.extra.shareBestScoreAsync=a,o.label=5;case 5:return this.cheatLogic.pushCheatAction("invite"),[2]}})}),function(){return U.apply(this,arguments)})},{key:"inviteAsyncMessage",value:(q=B(function(){var a,o,C,A,P,I,B,R,E,L;return _ts_generator(this,function(O){switch(O.label){case 0:a=window.game.analytics,o=this.baseScreen.data,C=GameCore.Plugins.Analytics.Events.INVITE,O.label=1;case 1:return O.trys.push([1,4,,5]),P=(A=window.game).analytics,I=A.frameCapture,B=o.playerId,R=o.playerPhoto,E=o.playerLevel,[4,I.wideframe.renderShareScore({playerId:B,playerPhoto:R,playerScore:E})];case 2:if("string"!=typeof(L=O.sent())||!L)throw new Error("Image share is not valid");return[4,FBInstant.inviteAsync({cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chi ngay"}},text:{default:"I am playing this game, it is so fun!",localizations:{en_US:"I am playing this game, it is so fun!",vi_VN:"Chi ngay!"}},image:L||"",data:{type:"share_invite"}})];case 3:return O.sent(),P.event(C,{share_content_type:"BestLevel",success:!0}),[3,5];case 4:return O.sent(),a.event(C,{share_content_type:"BestLevel",success:!1}),[3,5];case 5:return[2]}})}),function(){return q.apply(this,arguments)})},{key:"shareBestScoreAsync",value:(z=B(function(){var a,o,C,A,P,I,B;return _ts_generator(this,function(R){switch(R.label){case 0:if(a=this.baseScreen.data,o=GameCore.Plugins.Analytics.Events.SHARE,!("shareAsync"in GameSDK.extra))return[3,4];A=(C=window.game).analytics,C.frameCapture,R.label=1;case 1:return R.trys.push([1,3,,4]),P=a.playerId,I=a.playerName,B=a.playerPhoto,a.playerLevel,[4,GameSDK.extra.shareAsync({text:"Stumbled on this cool game now I cant stop playing. Best level unlocked!",intent:"SHARE",image:"",data:{playerId:P,playerName:I,playerPhoto:B,type:"share_invite"}})];case 2:return R.sent(),A.event(o,{share_content_type:"BestLevel",success:!0}),[3,4];case 3:return R.sent(),A.event(o,{share_content_type:"BestLevel",success:!1}),[3,4];case 4:return[2]}})}),function(){return z.apply(this,arguments)})},{key:"handleMapClicked",value:(x=B(function(){return _ts_generator(this,function(a){return[2,td.gameScene.transition.processBackToDashboardFromGameplay()]})}),function(){return x.apply(this,arguments)})},{key:"handleReplayClicked",value:(M=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),td.gameScene.restartLevel(),a=td.gameScene.gamePlay,o=window.game.match.getMatchState().mode,C=a.gameUI.header,"challenge-friend"===o&&C.clearChallengeBlockScore(),a.isTutorialLevel()&&(a.tileManager.resetTileTutorial(),a.tileManager.tutorialHand.stopAnimationTutorialHand()),[4,a.gameUI.fadeOutGameScreen({shouldHideRubyBar:!0})];case 1:return A.sent(),[4,t_.closeScreenAsync(tP.SETTINGS_SCREEN)];case 2:return A.sent(),[4,td.gameScene.gamePlay.handleGameRetry()];case 3:return A.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return M.apply(this,arguments)})},{key:"fadeOutPurpleBackground",value:(D=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(a=this.purpleBackground.getComponent(ea)))return[3,2];return o=Y(a).to(.25,{opacity:0}).start(),[4,ts.runTweenAsync(o)];case 1:C.sent(),C.label=2;case 2:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"setNodeOpacity",value:function(a,o){var C=a.getComponent(ea);C&&(C.opacity=o)}},{key:"handleTutorialClicked",value:(F=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return td.gameScene.toggleGamePlayScreen(!0),td.gameScene.toggleBlockInputContainer(!0),a=this.baseScreen.data,C=(o=td.gameScene).gamePlay,A=o.uiManager,C.gameUI.footer.toggleItems(!1),A.getDashboardScreen(),A.setCurrentScreen(null),C.setBackgroundFor({level:a.tutorialLevel}),[4,C.loadLevelResourcesAsync(a.tutorialLevel)];case 1:if(!P.sent())return[3,5];return td.gameScene.restartLevel(),th.playMusic(tZ.BACKGROUND_MUSIC),[4,t_.closeScreenAsync(tP.DASHBOARD_SCREEN)];case 2:return P.sent(),[4,t_.closeScreenAsync(tP.SETTINGS_SCREEN)];case 3:return P.sent(),[4,C.handlePlayLevelTutorial()];case 4:return P.sent(),td.gameScene.gamePlay.resetSingleMode(),td.gameScene.toggleBlockInputContainer(!1),[3,6];case 5:td.gameScene.toggleBlockInputContainer(!1),P.label=6;case 6:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"handleFanPageClicked",value:(L=B(function(){return _ts_generator(this,function(a){return this.cheatLogic.pushCheatAction("fanPage"),this.followOfficialPageAsync().catch(function(){}),[2]})}),function(){return L.apply(this,arguments)})},{key:"followOfficialPageAsync",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:tK(),a.label=1;case 1:return a.trys.push([1,4,,5]),[4,FBInstant.community.canFollowOfficialPageAsync()];case 2:if(!a.sent())throw new Error("INVALID_OPERATION");return[4,FBInstant.community.followOfficialPageAsync()];case 3:return a.sent(),[3,5];case 4:return a.sent(),[3,5];case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleJoinGroupClicked",value:(R=B(function(){return _ts_generator(this,function(a){return this.cheatLogic.pushCheatAction("joinGroup"),this.handleJoinGroup().catch(function(){}),[2]})}),function(){return R.apply(this,arguments)})},{key:"handleLanguageClicked",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,t_.closeScreenAsync(tP.SETTINGS_SCREEN)];case 1:return a.sent(),[4,t_.openScreenAsync(tP.SELECT_LANGUAGE_SCREEN)];case 2:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return I.apply(this,arguments)})}]),_}(eo)).prototype,"mobileContainer",[elH,elW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),el0=L(elQ.prototype,"container",[elV,elK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),el1=L(elQ.prototype,"touchZone",[elY,elj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),el2=L(elQ.prototype,"purpleBackground",[elX,elJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),el3=L(elQ.prototype,"baseScreen",[elZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),elQ)),U._RF.pop(),U._RF.push({},"dd1daicRtlPb7M3OntAhlFd","CsUtils",void 0);var euo,eus,eul,euu,euc,euh=function(){function n(){o(this,n)}return a(n,null,[{key:"warnNo",value:function(a){}},{key:"getTraceStack",value:function(){var a=new Error;if(a.stack){var o=a.stack.split("\n");return o.length>3&&o.splice(1,2),o.join("\n")}return"No stack trace available"}}]),n}();U._RF.pop(),U._RF.push({},"2c784+1jklAirxl125pW/p2","BaseBundle",void 0);var eup,eud,euf,euy,euv,eum,eug,eub,euk,euw,euS,euT,euC,euA,eu_,euP,euI=$.ccclass,euB=$.property,euR=(euo=euI("BaseBundle"),eus=euB(ef),eul=tj.required,euo((euc=L((euu=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"buyBtn",euc,N(a)),a.onClickBuy=void 0,a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"onEnable",value:function(){this.buyBtn.node.on(ef.EventType.CLICK,this.handleClickBuy,this)}},{key:"handleClickBuy",value:function(a,o){var C;(null==o?void 0:o.type)===ee.EventType.TOUCH_CANCEL&&o.simulate||null==(C=this.onClickBuy)||C.call(this)}},{key:"setButtonName",value:function(a){this.buyBtn.node.name=a}}]),r}(eo)).prototype,"buyBtn",[eus,eul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euu))||euu);U._RF.pop(),U._RF.push({},"d31bcYiesxMfLRv3gxv1mVy","NormalBundle",void 0);var euE,euL,euO,euN,euF,euD,euM,eux=$.ccclass,euz=$.property,euG=tt(.38,1.37,.64,1),euq=(eup=eux("NormalBundle"),eud=euz(W),euf=tj.required,euy=euz(et),euv=tj.required,eum=euz(er),eug=tj.required,eub=euz(er),euk=tj.required,euw=tj.required,eup((euT=L((euS=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"typeIcon",euT,N(a)),O(a,"rubySpriteFrame",euC,N(a)),O(a,"typeText",euA,N(a)),O(a,"descriptionText",eu_,N(a)),O(a,"uiOpacity",euP,N(a)),a.isRubyBundle=!1,a.productId="",a.shopBlockAnimOpen=void 0,a.shopBlockAnimExit=void 0,a}return a(u,[{key:"__preload",value:function(){M(D(u.prototype),"__preload",this).call(this);var a=this.node.getComponent(ea);a?(a.opacity=0,this.uiOpacity=a,tj.validateRequiredProperties(this,u)):euh.warnNo(ea)}},{key:"switchToRubyBundle",value:function(a){this.isRubyBundle=!0,this.typeIcon.spriteFrame=this.rubySpriteFrame,this.descriptionText.node.active=!1,this.typeText.string="".concat(a," Rubies");var o=this.typeText.node.getPosition();this.typeText.node.setPosition(o.x,o.y-20,o.z)}},{key:"setPrice",value:function(a){var o=this.buyBtn.node.getChildByName("PriceLabel");if(o){var C=o.getComponent(er);C&&(C.string=a)}}},{key:"playEntranceAnimation",value:(R=B(function(){var a,o,C;var A=arguments;return _ts_generator(this,function(P){return o=this,C=A.length>0&&void 0!==A[0]?A[0]:0,[2,(null==(a=this.shopBlockAnimOpen)||a.stop(),this.node.scale=new ei(0,0,0),this.uiOpacity.opacity=255,new Promise(function(a){o.shopBlockAnimOpen=Y(o.node).delay(.1*C).to(.5,{scale:new ei(1,1,1)},{easing:euG}).call(function(){a()}).start()}))]})}),function(){return R.apply(this,arguments)})},{key:"playExitAnimation",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){return o=this,[2,(null==(a=this.shopBlockAnimExit)||a.stop(),new Promise(function(a){o.shopBlockAnimExit=Y(o.uiOpacity).to(.2,{opacity:0}).call(function(){a()}).start()}))]})}),function(){return I.apply(this,arguments)})},{key:"updateTypeTextBasedOnLocale",value:function(){if(!this.isRubyBundle){var a=globalThis.game.language.getText("Remove ADS"),o=globalThis.game.language.getText("30 days + 300 Rubies");this.typeText.string=a,this.descriptionText.string=o}}}]),u}(euR)).prototype,"typeIcon",[eud,euf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euC=L(euS.prototype,"rubySpriteFrame",[euy,euv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euA=L(euS.prototype,"typeText",[eum,eug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eu_=L(euS.prototype,"descriptionText",[eub,euk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euP=L(euS.prototype,"uiOpacity",[euw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euS))||euS);U._RF.pop(),U._RF.push({},"5380fN7k4NCX5IUbX7jGror","SuperBundle",void 0);var euU,euH,euW,euV,euK,euY,euj,euX,euJ,euZ,euQ,eu$=$.ccclass,eu0=$.property,eu1=tt(.38,1.37,.64,1),eu2=(euE=eu$("SuperBundle"),euL=eu0(ee),euO=tj.required,euN=tj.required,euE((euD=L((euF=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"basketBlock",euD,N(a)),O(a,"uiOpacity",euM,N(a)),a.shopBlockAnimOpen=void 0,a.shopBlockAnimExit=void 0,a.basketBlockAnim=void 0,a.productId="",a}return a(u,[{key:"__preload",value:function(){M(D(u.prototype),"__preload",this).call(this);var a=this.node.getComponent(ea);a?(a.opacity=0,this.uiOpacity=a,tj.validateRequiredProperties(this,u)):euh.warnNo(ea)}},{key:"playEntranceAnimation",value:(R=B(function(){var a,o,C;var A=arguments;return _ts_generator(this,function(P){return o=this,C=A.length>0&&void 0!==A[0]?A[0]:0,[2,(null==(a=this.shopBlockAnimOpen)||a.stop(),this.playBasketBlockAnimation(),this.node.scale=new ei(0,0,0),this.uiOpacity.opacity=255,new Promise(function(a){o.shopBlockAnimOpen=Y(o.node).delay(.1*C).to(.5,{scale:new ei(1,1,1)},{easing:eu1}).call(function(){a()}).start()}))]})}),function(){return R.apply(this,arguments)})},{key:"playExitAnimation",value:(I=B(function(){var a,o,C;return _ts_generator(this,function(A){return C=this,[2,(null==(a=this.shopBlockAnimExit)||a.stop(),null==(o=this.basketBlockAnim)||o.stop(),this.basketBlock.scale=new ei(1,1,1),new Promise(function(a){C.shopBlockAnimExit=Y(C.uiOpacity).to(.2,{opacity:0}).call(function(){a()}).start()}))]})}),function(){return I.apply(this,arguments)})},{key:"playBasketBlockAnimation",value:function(){var a;null==(a=this.basketBlockAnim)||a.stop(),this.basketBlockAnim=Y(this.basketBlock).delay(.2).to(1.4,{scale:new ei(1.05,1.05,1.05)},{easing:tn}).to(1.4,{scale:new ei(1,1,1)},{easing:tn}).union().repeatForever().start()}},{key:"setPrice",value:function(a){var o=this.buyBtn.node.getChildByName("PriceLabel");if(o){var C=o.getComponent(er);C&&(C.string=a)}}}]),u}(euR)).prototype,"basketBlock",[euL,euO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euM=L(euF.prototype,"uiOpacity",[euN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euF))||euF);U._RF.pop(),U._RF.push({},"8a894fMqHdN/rjoqchzbvLl","ShopContainerBlock",void 0);var eu3,eu4=$.ccclass,eu5=$.property,eu6=(euU=eu4("ShopContainerBlock"),euH=eu5(eY),euW=tj.required,euV=eu5(eY),euK=tj.required,euY=eu5(eY),euj=tj.required,euU((euJ=L((euX=function(P){C(y,P);var I,R,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"superPackPrefab",euJ,N(a)),O(a,"megaPackPrefab",euZ,N(a)),O(a,"normalPackPrefab",euQ,N(a)),a.allPackNodes=[],a.allPackBundles=[],a.isPacksCreated=!1,a.purchaseHandler=null,a}return a(y,[{key:"setPurchaseHandler",value:function(a){this.purchaseHandler=a}},{key:"__preload",value:function(){var a,o=this;null==(a=this.indexChangeCallbacks)||a.push(function(a){0!==a||o.isPacksCreated||(o.createAllPacks(),o.isPacksCreated=!0)}),tj.validateRequiredProperties(this,y)}},{key:"createAllPacks",value:function(){this.clearAllPacks();var a=this.calculateTotalContentHeight();this.updateContentContainerSize(a);for(var o=a/2,C=0;C<Td.length;C++){var A=Td[C],P=this.getPackHeight(A.type),I=o-P/2,B=this.createPackNode(A,C);B.setPosition(0,I,0),this.node.addChild(B),this.allPackNodes.push(B),o-=P+20}}},{key:"clearAllPacks",value:function(){var a,o=E(this.allPackNodes);try{for(o.s();!(a=o.n()).done;){var C=a.value;null!=C&&C.isValid&&C.destroy()}}catch(a){o.e(a)}finally{o.f()}this.allPackNodes=[],this.allPackBundles=[]}},{key:"createPackNode",value:function(a,o){var C,A,P=this;if("super"===a.type||"mega"===a.type){var I="super"===a.type?this.superPackPrefab:this.megaPackPrefab;(A=(C=ej(I)).getComponent(eu2)).productId=a.productId,A.setPrice("".concat(a.price.toString()," USD")),A.onClickBuy=function(){return P.handleClickBuy(a.productId)}}else(A=(C=ej(this.normalPackPrefab)).getComponent(euq)).productId=a.productId,a.isRubyBundle&&A.switchToRubyBundle(a.rewards.coins||0),A.setPrice("".concat(a.price.toString()," USD")),A.onClickBuy=function(){return P.handleClickBuy(a.productId)};var B=this.getButtonName({type:a.type,coins:a.rewards.coins,removeAds:a.rewards.removeAds||!1});A.setButtonName(B);var R=C.getComponent(en);return R&&R.setAnchorPoint(.5,.5),this.allPackBundles.push(A),C}},{key:"getPackHeight",value:function(a){switch(a){case"super":case"mega":return 544;case"normal":default:return 188}}},{key:"updateContentContainerSize",value:function(a){var o=this.node.getComponent(en);o&&(o.setContentSize(1080,a),o.setAnchorPoint(.5,.5))}},{key:"calculateTotalContentHeight",value:function(){var a,o=0,C=E(Td);try{for(C.s();!(a=C.n()).done;){var A=a.value;o+=this.getPackHeight(A.type)+20}}catch(a){C.e(a)}finally{C.f()}return o-20}},{key:"handleClickBuy",value:(F=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:if(!this.purchaseHandler)return[3,2];return[4,this.purchaseHandler(a)];case 1:return o.sent(),[3,3];case 2:o.label=3;case 3:return[2]}})}),function(a){return F.apply(this,arguments)})},{key:"playEntranceAnimation",value:(L=B(function(){var a,o;return _ts_generator(this,function(C){for(a=0;a<this.allPackBundles.length;a++)o=this.allPackBundles[a],this.playBundleAnimationWithDelay(o,a);return[2]})}),function(){return L.apply(this,arguments)})},{key:"playBundleAnimationWithDelay",value:(R=B(function(a,o){return _ts_generator(this,function(C){switch(C.label){case 0:return C.trys.push([0,2,,3]),[4,a.playEntranceAnimation(o)];case 1:return C.sent(),[3,3];case 2:return C.sent(),[3,3];case 3:return[2]}})}),function(a,o){return R.apply(this,arguments)})},{key:"playExitAnimation",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:o=[],C=E(this.allPackBundles);try{for(C.s();!(a=C.n()).done;){A=a.value;try{o.push(A.playExitAnimation())}catch(a){}}}catch(a){C.e(a)}finally{C.f()}return[4,Promise.all(o)];case 1:return P.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateAllPackPrices",value:function(a){for(var o=this,C=0;C<this.allPackBundles.length;C++)(function(){var A=o.allPackBundles[C],P=Td[C];if(P){var I=a.find(function(a){return a.productID===P.productId});I&&A.setPrice(I.price)}})()}},{key:"updatePackVisibility",value:function(){if(td.gameScene.gamePlay.gameDataManager.getMultiData(["removeAds"]).removeAds.endTime>Date.now()){for(var a=0;a<Td.length;a++)if("remove_ads_plus_300rubies"===Td[a].productId){var o=this.allPackNodes[a];o&&(o.active=!1)}this.repositionVisiblePacks()}}},{key:"repositionVisiblePacks",value:function(){var a,o=this.calculateTotalContentHeight()/2,C=E(this.allPackNodes);try{for(C.s();!(a=C.n()).done;){var A=a.value;if(null!=A&&A.active){var P=A.getComponent(en);if(P){var I=P.height,B=o-I/2;A.setPosition(0,B,0),o-=I+20}}}}catch(a){C.e(a)}finally{C.f()}}},{key:"updateTypeTextBasedOnLocale",value:function(){var a,o=E(this.allPackBundles);try{for(o.s();!(a=o.n()).done;){var C=a.value;_instanceof(C,euq)&&C.updateTypeTextBasedOnLocale()}}catch(a){o.e(a)}finally{o.f()}}},{key:"getButtonName",value:function(a){var o=a.type,C=a.coins,A=a.removeAds;switch(o){case"super":return"SuperBundleShopBtn";case"mega":return"MegaBundleShopBtn";case"normal":return A?"Plus300RubiesAndRemoveAdsShopBtn":"Plus".concat(C,"RubiesShopBtn");default:return""}}}]),y}(tQ)).prototype,"superPackPrefab",[euH,euW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euZ=L(euX.prototype,"megaPackPrefab",[euV,euK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euQ=L(euX.prototype,"normalPackPrefab",[euY,euj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),euX))||euX);U._RF.pop(),U._RF.push({},"2d409tFCV9CxY/wy1qddNm0","ShopScroller",void 0);var eu7,eu8,eu9,ece,ect,ecn,eci,ecr,eca=(0,$.ccclass)("ShopScroller")(eu3=function(P){C(c,P);var I,R,L=A(c);function c(){return o(this,c),L.apply(this,arguments)}return a(c,[{key:"start",value:function(){var a=0;try{a=tf.getBannerAdWorldHeight()}catch(a){}var o=this.calculateTotalContentHeight();this.config.children.count=1,this.config.children.size={width:1080,height:o},this.config.children.anchor="top",this.config.margin={top:0,bottom:a},this.init()}},{key:"calculateTotalContentHeight",value:function(){var a,o=0,C=E(Td);try{for(C.s();!(a=C.n()).done;){var A=a.value;o+=this.getPackHeight(A.type)+20}}catch(a){C.e(a)}finally{C.f()}return Math.max(o-20,600)}},{key:"getPackHeight",value:function(a){switch(a){case"super":case"mega":return 544;case"normal":default:return 188}}},{key:"playEntranceAnimation",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(this.value=0,!(a=this.getContainerBlock()))return[3,2];return[4,a.playEntranceAnimation()];case 1:return o.sent(),[3,3];case 2:o.label=3;case 3:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"playExitAnimation",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:if(!(a=this.getContainerBlock()))return[3,2];return[4,a.playExitAnimation()];case 1:return o.sent(),[3,3];case 2:o.label=3;case 3:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateAllPackPrices",value:function(a){var o=this.getContainerBlock();o&&o.updateAllPackPrices(a)}},{key:"updatePackVisibility",value:function(){var a=this.getContainerBlock();a&&a.updatePackVisibility()}},{key:"updateTypeTextBasedOnLocale",value:function(){var a=this.getContainerBlock();a&&a.updateTypeTextBasedOnLocale()}},{key:"getContainerBlock",value:function(){var a=this.getBlockAt(0);return a?a.node.getComponentInChildren(eu6):null}}]),c}(t$))||eu3;U._RF.pop(),U._RF.push({},"12ebbwxKPJB8qx9SqbFuoDy","ShopContainer",void 0);var eco,ecs,ecl,ecu,ecc,ech,ecp,ecd,ecf=$.ccclass,ecy=$.property,ecv=(eu7=ecf("ShopContainer"),eu8=ecy(ee),eu9=tj.required,ece=ecy(eca),ect=tj.required,eu7((eci=L((ecn=function(P){C(w,P);var I,R,E,L,F,D,M,x,z,q,U,H,W,V=A(w);function w(){var a;o(this,w);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=V.call.apply(V,[this].concat(A)),O(a,"maskContainer",eci,N(a)),O(a,"shopScroller",ecr,N(a)),a.catalog=null,a}return a(w,[{key:"__preload",value:(W=B(function(){return _ts_generator(this,function(a){return this.maskContainer.active=!1,tj.validateRequiredProperties(this,w),[2]})}),function(){return W.apply(this,arguments)})},{key:"runIncreaseAnimations",value:(H=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.runFadeOutAnimations()];case 1:return a.sent(),[2]}})}),function(){return H.apply(this,arguments)})},{key:"updateItemAmountsInMiniItems",value:function(){}},{key:"runFadeOutAnimations",value:(U=B(function(){return _ts_generator(this,function(a){return[2]})}),function(){return U.apply(this,arguments)})},{key:"runFadeInMaskAnimation",value:(q=B(function(){var a;return _ts_generator(this,function(o){if(this.maskContainer){if(this.maskContainer.active=!0,a=this.maskContainer.getComponent(ea))return[2,new Promise(function(o){Y(a).to(.3,{opacity:160}).call(function(){return o()}).start()})]}return[2]})}),function(){return q.apply(this,arguments)})},{key:"runFadeOutMaskAnimation",value:(z=B(function(){var a,o;return _ts_generator(this,function(C){if(a=this,this.maskContainer){if(o=this.maskContainer.getComponent(ea))return[2,new Promise(function(C){Y(o).to(.3,{opacity:0}).call(function(){a.maskContainer.active=!1,C()}).start()})]}return[2]})}),function(){return z.apply(this,arguments)})},{key:"playEntranceShopBlockAnimation",value:(x=B(function(){return _ts_generator(this,function(a){return[2,this.shopScroller.playEntranceAnimation()]})}),function(){return x.apply(this,arguments)})},{key:"playExitShopBlockAnimation",value:(M=B(function(){return _ts_generator(this,function(a){return[2,this.shopScroller.playExitAnimation()]})}),function(){return M.apply(this,arguments)})},{key:"handleClickBuy",value:(D=B(function(a){var o,C,A,P;return _ts_generator(this,function(I){switch(I.label){case 0:C=(o=td.gameScene).gamePlay,td.gameScene.rubyBarComp.setCanUpdateRubyAmountAfterSetGameData(!1),C.canUpdateItemsAmountAfterSetGameData=!1,I.label=1;case 1:return I.trys.push([1,5,7,8]),o.toggleBlockInputContainer(!0),o.showLoadingScreen(0,t7.PURCHASING,!0,0),A=C.gameDataManager.getCoins(),[4,this.processPurchase(a)];case 2:return P=I.sent(),this.sendAnalyticsEvent(P),o.closeLoadingScreen(),o.showLoadingScreen(2,t7.PURCHASE_SUCCESSFUL),[4,ts.waitTweenAsync(2)];case 3:return I.sent(),[4,this.runAnimClaimReward(a,A)];case 4:return I.sent(),C.itemManager.updateItemStates(),[3,8];case 5:return I.sent(),[4,this.handlePurchaseError()];case 6:return I.sent(),[3,8];case 7:return o.toggleBlockInputContainer(!1),td.gameScene.rubyBarComp.setCanUpdateRubyAmountAfterSetGameData(!0),C.canUpdateItemsAmountAfterSetGameData=!0,[7];case 8:return[2]}})}),function(a){return D.apply(this,arguments)})},{key:"updateUIBlockPurchase",value:(F=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:a=this,C.label=1;case 1:return C.trys.push([1,3,,4]),this.shopScroller.moveToIndex(0),(o=this.shopScroller.getContainerBlock())&&o.setPurchaseHandler(function(o){return a.handleClickBuy(o)}),this.updateTypeTextBasedOnLocale(),this.updatePositionPack(),[4,this.updateUIPrice()];case 2:return C.sent(),[3,4];case 3:return C.sent(),[3,4];case 4:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"updatePositionPack",value:function(){this.shopScroller.updatePackVisibility()}},{key:"updateTypeTextBasedOnLocale",value:function(){this.shopScroller.updateTypeTextBasedOnLocale()}},{key:"updateUIPrice",value:(L=B(function(){var a,o;return _ts_generator(this,function(C){switch(C.label){case 0:if(C.trys.push([0,3,,4]),this.catalog)return[3,2];return td.gameScene.showLoadingScreen(0,t7.LOADING,!0),o=this,[4,xI.inst.getCatalogAsync()];case 1:o.catalog=C.sent(),td.gameScene.closeLoadingScreen(),C.label=2;case 2:return this.shopScroller.updateAllPackPrices(null!=(a=this.catalog)?a:[]),[3,4];case 3:return C.sent(),td.gameScene.closeLoadingScreen(),[3,4];case 4:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"processPurchase",value:(E=B(function(a){var o;return _ts_generator(this,function(C){switch(C.label){case 0:return[4,xI.inst.purchaseAsync(a)];case 1:return o=C.sent(),[4,xI.inst.consumePurchaseAsync(a,o.purchaseToken)];case 2:return[2,(C.sent(),o)]}})}),function(a){return E.apply(this,arguments)})},{key:"runAnimClaimReward",value:(R=B(function(a,o){var C,A;return _ts_generator(this,function(P){switch(P.label){case 0:if(!(null!=(C=xI.inst.findProductConfig(a))&&C.rewards))return[3,3];return A=td.gameScene,C.rewards.removeAds&&this.updatePositionPack(),[4,A.shop.handleCloseShopScreenAsync({canBlockInput:!1,canOpenFreeRuby:!1})];case 1:return P.sent(),[4,A.shop.handlePurchasePackAsync({productId:a,oldCoins:o})];case 2:return P.sent(),[3,4];case 3:P.label=4;case 4:return[2]}})}),function(a,o){return R.apply(this,arguments)})},{key:"handlePurchaseError",value:(I=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:return o=(a=td.gameScene).gamePlay,a.showLoadingScreen(0,"Loading...",!0),C=o.gameDataManager.getLevel(),[4,o.setBackgroundFor({level:C})];case 1:return A.sent(),a.closeLoadingScreen(),[4,t_.openScreenAsync(tP.PURCHASE_CANCELED_SCREEN)];case 2:return A.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"sendAnalyticsEvent",value:function(a){var o=xI.inst.findProductConfig(a.productID);if(o&&this.catalog){var C=[],A=o.rewards;A.items&&Object.values(A.items).forEach(function(a,o){C.push({resourceTypeName:tY[o],resourceChange:a})}),A.coins&&C.push({resourceTypeName:tk.RUBIES,resourceChange:A.coins}),A.removeAds&&C.push({resourceTypeName:tk.REMOVE_30_DAYS_ADS,resourceChange:1});var P=this.catalog.find(function(a){return a.productID===o.productId});if(P){var I=this.extractPrice(P),B=D4.capitalizeFirstLetter(o.type);tS({transId:a.paymentID,purchaseAmount:I.toString(),purchaseCurrency:P.priceCurrencyCode,resourceTransaction:C,transactionCount:1,transactionType:"Buy".concat(B,"Bundle")})}}}},{key:"extractPrice",value:function(a){return"priceAmount"in a&&("number"==typeof a.priceAmount||"string"==typeof a.priceAmount)?Number(a.priceAmount):0}}]),w}(eo)).prototype,"maskContainer",[eu8,eu9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecr=L(ecn.prototype,"shopScroller",[ece,ect],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecn))||ecn);U._RF.pop(),U._RF.push({},"1578fWwKQdGp6t64llfU6xe","HeaderShopScreen",void 0);var ecm,ecg,ecb,eck,ecw,ecS,ecT,ecC,ecA,ec_,ecP,ecI,ecB,ecR,ecE,ecL,ecO=$.ccclass,ecN=$.property,ecF=(eco=ecO("HeaderShopScreen"),ecs=ecN(ee),ecl=tj.required,ecu=ecN(er),ecc=tj.required,eco((ecp=L((ech=function(P){C(u,P);var I,R,E=A(u);function u(){var a;o(this,u);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=E.call.apply(E,[this].concat(A)),O(a,"rubyBar",ecp,N(a)),O(a,"rubyBarCoinAmount",ecd,N(a)),a.headerOpacityAnimation=null,a.headerMoveAnimation=null,a}return a(u,[{key:"__preload",value:function(){var a=this.node.getComponent(ea);a&&(a.opacity=0),tj.validateRequiredProperties(this,u)}},{key:"playHeaderEntranceAnimation",value:(R=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){return C=this,null==(a=this.headerOpacityAnimation)||a.stop(),null==(o=this.headerMoveAnimation)||o.stop(),A=td.gameScene.rubyBarComp.getSize(),(P=this.rubyBar.getComponent(en)).width=A.width,P.height=A.height,I=td.gameScene.rubyBarComp.getRubyAmount(),[2,(this.setRubyAmountWithoutAnimation(I),new Promise(function(a){var o=C.node.getComponent(ea);o&&(o.opacity=0);var A=C.node.getComponent(en).height,P=C.node.getComponent(eX);if(P&&o){P.top=-A/2;var I=-52.5;nr.isPortrait()||(I=0),C.headerMoveAnimation=Y(P).to(.2,{top:I},{easing:"cubicOut"}).call(function(){a()}).start(),C.headerOpacityAnimation=Y(o).to(.2,{opacity:255},{easing:"cubicOut"}).start()}else euh.warnNo(ea)}))]})}),function(){return R.apply(this,arguments)})},{key:"playHeaderExitAnimation",value:(I=B(function(){var a,o;return _ts_generator(this,function(C){return o=this,[2,(null==(a=this.headerMoveAnimation)||a.stop(),new Promise(function(a){var C=o.node.getComponent(en).height,A=o.node.getComponent(eX);if(A){var P=o.node.getComponent(ea);P?(o.headerMoveAnimation=Y(A).to(.2,{top:-C/2},{easing:"cubicIn"}).call(function(){a()}).start(),o.headerOpacityAnimation=Y(P).to(.2,{opacity:0},{easing:"cubicIn"}).start()):euh.warnNo(ea)}}))]})}),function(){return I.apply(this,arguments)})},{key:"setRubyAmountWithoutAnimation",value:function(a){this.rubyBarCoinAmount.string=a.toString();var o=td.gameScene.rubyBarComp.getSize().width,C=this.rubyBarCoinAmount.getComponent(eX),A=this.rubyBar.getComponent(en),P=td.gameScene.rubyBarComp.getDefaultWidth();if(o<P)A.width=P,C.left=123-10*(a.toString().length-1);else A.width=o,C.left=86}}]),u}(eo)).prototype,"rubyBar",[ecs,ecl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecd=L(ech.prototype,"rubyBarCoinAmount",[ecu,ecc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ech))||ech);U._RF.pop(),U._RF.push({},"95829zC8GdI1556N0GBJSGq","ShopScreen",void 0);var ecD,ecM,ecx,ecz,ecG,ecq,ecU,ecH,ecW,ecV,ecK,ecY,ecj,ecX,ecJ,ecZ,ecQ,ec$=$.ccclass,ec0=$.property,ec1=GameCore,ec2=ec1.Events,ec3=ec1.Utils,ec4=globalThis.game.event;ecm=ec$("ShopScreen"),ecg=ec0(ecv),ecb=tj.required,eck=ec0(ef),ecw=tj.required,ecS=ec0(ecF),ecT=tj.required,ecC=ec0(ea),ecA=tj.required,ec_=tj.required,ecm((ecI=L((ecP=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"shopContainer",ecI,N(a)),O(a,"closeBtn",ecB,N(a)),O(a,"header",ecR,N(a)),O(a,"purpleBgUIOpacity",ecE,N(a)),O(a,"baseScreen",ecL,N(a)),a.originalHeaderWidth=0,a.enableCloseOnTouch=!0,a.handleViewResized=function(){if(!nr.isPortrait()){var o=a.header.getComponent(en),C=eP.getVisibleSize().width;o&&(C<a.originalHeaderWidth?o.setContentSize(C,o.height):o.setContentSize(a.originalHeaderWidth,o.height))}},a.handleOpeningScreen=function(o){a.validateEventPayload(o)&&a.updateScreenData(o)},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(p,[{key:"__preload",value:function(){var a;this.listenScreenEvents(),this.baseScreen=this.node.getComponent("BaseScreen"),this.baseScreen.open=this.open.bind(this),this.baseScreen.close=this.close.bind(this),this.originalHeaderWidth=(null==(a=this.header.node.getComponent(en))?void 0:a.width)||0;var o=this.shopContainer.node.getComponent(ea);o&&(o.opacity=255),this.listenGameEvents(),tj.validateRequiredProperties(this,p)}},{key:"listenGameEvents",value:function(){ep.on(tl.VIEW_RESIZED,this.handleViewResized)}},{key:"open",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.shopContainer.updateUIBlockPurchase()];case 1:return a.sent(),th.playSound(tZ.SHOP_POPUP_SHOW),[4,Promise.all([ts.fadeInNode(this.purpleBgUIOpacity.node,.25),this.shopContainer.playEntranceShopBlockAnimation(),this.header.playHeaderEntranceAnimation()])];case 2:return a.sent(),ec4.emit(ec2.OPENED_SCREEN,{screenName:this.node.name}),ec4.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return E.apply(this,arguments)})},{key:"close",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([ts.fadeOutNode(this.purpleBgUIOpacity.node,.25),this.shopContainer.playExitShopBlockAnimation(),this.header.playHeaderExitAnimation()])];case 1:return a.sent(),ec4.emit(ec2.CLOSED_SCREEN,{screenName:this.node.name}),this.node.active=!1,ec4.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return R.apply(this,arguments)})},{key:"registryButtonEvents",value:function(){this.closeBtn.node.on(ef.EventType.CLICK,this.handleClickClose,this)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.registryButtonEvents(),this.validateRequiredComponents(),this.handleViewResized()}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){ec4.on(ec2.OPENING_SCREEN,this.handleOpeningScreen),ec4.on(ec2.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){ec4.off(ec2.OPENING_SCREEN,this.handleOpeningScreen),ec4.off(ec2.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"updateScreenData",value:function(a){var o=a.screenData;ec3.Valid.isObject(o)&&(!1===o.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0)}},{key:"handleClickClose",value:(I=B(function(){return _ts_generator(this,function(a){return[2,td.gameScene.shop.handleCloseShopScreenAsync()]})}),function(){return I.apply(this,arguments)})},{key:"updatePositionPack",value:function(){this.shopContainer.updatePositionPack()}}]),p}(eo)).prototype,"shopContainer",[ecg,ecb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecB=L(ecP.prototype,"closeBtn",[eck,ecw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecR=L(ecP.prototype,"header",[ecS,ecT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecE=L(ecP.prototype,"purpleBgUIOpacity",[ecC,ecA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecL=L(ecP.prototype,"baseScreen",[ec_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecP)),U._RF.pop(),U._RF.push({},"853a2Yj02tFQaViQNL1+0r2","MiniItemShopScreen",void 0);var ec5=$.ccclass,ec6=$.property,ec7={position:[{time:.5,curve:.25,c3:.75},{time:.6667,position:.4663,curve:.131,c2:.11,c3:.982,c4:.73},{time:.7833,position:1}],color:[{color:"ffffff00",curve:.156,c2:.76,c3:.75},{time:.2333,color:"ffffffff",curve:"stepped"},{time:.7667,color:"ffffffff"}],rotate:[{angle:26.11,curve:0,c2:.6,c3:.682,c4:.83},{time:.4,angle:-8.57,curve:.25,c3:.75},{time:.6667}],scale:[{x:0,y:0,curve:.049,c2:.82,c3:.75},{time:.2333,x:1.497,y:1.497,curve:.241,c2:.02,c4:.86},{time:.5,x:.861,y:.861,curve:.25,c3:.75},{time:.65,x:1.261,y:1.261},{time:.7667,x:.552,y:.552}]};ecD=ec5("MiniItemShopScreen"),ecM=ec6(ee),ecx=tj.required,ecz=ec6(ee),ecG=tj.required,ecq=ec6(ee),ecU=tj.required,ecH=ec6(et),ecW=tj.required,ecV=ec6(kZ),ecK=tj.required,ecD((ecj=L((ecY=function(P){C(d,P);var R,E,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"icon",ecj,N(a)),O(a,"amountText",ecX,N(a)),O(a,"countText",ecJ,N(a)),O(a,"iconFrame",ecZ,N(a)),O(a,"sparkleEffect",ecQ,N(a)),a.animIconPool=[],a.iconOriginScaleX=.7,a.iconOriginScaleY=.7,a.originPosition=void 0,a.toLeft=!0,a}return a(d,[{key:"__preload",value:function(){this.node.active=!1,this.originPosition=this.node.position.clone(),this.node.position=new ei(this.node.position.x+300,this.node.position.y,1),tj.validateRequiredProperties(this,d)}},{key:"runIncreaseAnim",value:(L=B(function(a,o,C){var A,P,I,R,E,L;return _ts_generator(this,function(O){switch(O.label){case 0:return A=this,[4,this.fadeIn(C)];case 1:return O.sent(),P=Number(this.amountText.getComponent(er).string),I=this.node.scale.x,R=this.node.scale.y,E=!0,L=Y(this.node).to(.1,{scale:new ei(1.1*I,R,1)}).to(.1,{scale:new ei(I,1.1*R,1)}).union().reverseTime().repeatForever(),[4,this.runMultipleIconsAnimation(a-P,o,function(){var a=A.amountText.getComponent(er);a.string="".concat(Number(a.string)+1),E&&(L.start(),E=!1)})];case 2:return O.sent(),this.sparkleEffect.stop(),this.sparkleEffect.play(),td.gameScene.gamePlay.vibrate.vibrate(50),[4,ts.waitTweenAsync(.3)];case 3:return[2,(O.sent(),L.stop(),new Promise(function(a){Y(A.node).to(.1,{scale:new ei(A.iconOriginScaleX,A.iconOriginScaleY,1)}).call(B(function(){return _ts_generator(this,function(o){return a(),[2]})})).start()}))]}})}),function(a,o,C){return L.apply(this,arguments)})},{key:"runMultipleIconsAnimation",value:function(a,o,C){var A=this,P=arguments.length>0&&void 0!==a?a:1,B=arguments.length>1&&void 0!==o?o:0,R=arguments.length>2?C:void 0;if(P<1){for(var E=0;E<P;E++)null==R||R();return Promise.resolve()}var L=this.requestAnimIcons(P),O=this.node.getWorldPosition(),N=O.x,F=O.y,D=this.node.parent.getComponent(en).convertToNodeSpaceAR(new ei(N,F,0)),M=D.x,x=D.y,z=this.node.getComponent(en).convertToNodeSpaceAR(new ei(N,F,0)),q=z.x,U=z.y,H=this.toLeft?-1:1,W={x:M+140*H,y:x},V={x:q+360*H,y:U},K=this.node.getWorldPosition(),Y=K.x,j=K.y,X=this.node.parent.getComponent(en).convertToNodeSpaceAR(new ei(Y,j,0)),J=X.x,Z=X.y;return new Promise(function(a){P>0?(A.countText.getComponent(er).string="x"+P,A.runCountTextAnimation(V,600,B)):A.countText.active=!1,P>L.length&&(P=L.length);for(var l=function(o){var C={x:W.x+o*H*5,y:W.y+5*o};L[o].setPosition(C.x,C.y,1),L[o].active=!0,L[o].getComponent(ea).opacity=0,L[o].setScale(A.iconOriginScaleX,A.iconOriginScaleY,1);var E=new nz({vertices:[-211.5,40.29,-186.35,97.94,-156.05,167.39,-78.09,171.9,-28.95,87.7,2.75,33.38],startPoint:[C.x,C.y],endPoint:[J+10*H,Z]}),O=new nI([I(I({},ec7),{},{target:L[o],delay:1e3*B+75*o,path:E})]);0===o&&O.events.on("startDelay",function(){th.playSound(tZ.ITEM_RECEIVE,{volume:.3})}),o===P-1&&O.events.on("complete",function(){a()}),O.events.on("complete",function(){th.playSound(tZ.ITEM_APPEAR),null==R||R(),L[o].active=!1,L[o].setScale(A.iconOriginScaleX,A.iconOriginScaleY,1)}),O.start()},o=P-1;o>=0;o--)l(o)})}},{key:"requestAnimIcons",value:function(a){var o=this.animIconPool;if(o.length<a)for(var C=o.length;C<a;C++){var A=new ee;A.addComponent(W).spriteFrame=this.iconFrame,A.active=!1,A.addComponent(ea),o.push(A),this.node.parent.addChild(A)}return o}},{key:"runCountTextAnimation",value:function(a,o,C){var A=this,P=this.countText.scale.clone(),I=this.countText.getComponent(ea);I.opacity&&(I.opacity=0);var B=Y(I).to(o/1e3,{opacity:0},{easing:"backOut"}),R=Y(this.countText).to(o/1e3,{position:new ei(a.x,a.y+40,0)},{easing:"backOut"}).call(function(){A.countText.setScale(P),A.countText.active=!1}),E=Y(this.countText).to(o/1e3,{scale:new ei(1.15*P.x,1.15*P.y,P.z)},{easing:"backOut"});Y(I).delay(C).to(.4,{opacity:255},{easing:"backOut"}).start(),Y(this.countText).delay(C).call(function(){A.countText.active=!0,A.countText.position=new ei(a.x,a.y,0)}).delay(.6).call(function(){E.start(),B.start(),R.start()}).start()}},{key:"fadeIn",value:(E=B(function(a){var o;return _ts_generator(this,function(C){return o=this,[2,(this.node.active=!0,new Promise(function(C){Y(o.node).delay(.1*a).to(.25,{position:new ei(o.originPosition.x,o.originPosition.y,1)},{easing:"backOut"}).call(function(){C()}).start()}))]})}),function(a){return E.apply(this,arguments)})},{key:"fadeOut",value:(R=B(function(a){var o;return _ts_generator(this,function(C){return o=this,[2,new Promise(function(C){Y(o.node).delay(.1*a).to(.25,{position:new ei(o.originPosition.x+300,o.originPosition.y,1)},{easing:"backIn"}).call(function(){o.node.active=!1,C()}).start()})]})}),function(a){return R.apply(this,arguments)})}]),d}(eo)).prototype,"icon",[ecM,ecx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecX=L(ecY.prototype,"amountText",[ecz,ecG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecJ=L(ecY.prototype,"countText",[ecq,ecU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecZ=L(ecY.prototype,"iconFrame",[ecH,ecW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecQ=L(ecY.prototype,"sparkleEffect",[ecV,ecK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ecY)),U._RF.pop(),U._RF.push({},"06ed4u/8rtD14ktIA0fWV6t","MegaBundle",void 0);var ec8,ec9,ehe,eht,ehn,ehi,ehr,eha,eho,ehs,ehl,ehu,ehc,ehh,ehp,ehd,ehf,ehy,ehv,ehm,ehg=$.ccclass;$.property,ehg("MegaBundle")(function(P){C(r,P);var I=A(r);function r(){return o(this,r),I.apply(this,arguments)}return a(r,[{key:"start",value:function(){}}]),r}(eu2)),U._RF.pop(),U._RF.push({},"e6501zGTOpBmaeQNPrmvJDu","StampScreen",void 0);var ehb=$.ccclass,ehk=$.disallowMultiple,ehw=$.requireComponent,ehS=$.property,ehT=GameCore.Events,ehC=globalThis.game.event;ec8=ehb("StampScreen"),ec9=ehw(Bi),ehe=ehS(ee),eht=tj.required,ehn=ehS(W),ehi=tj.required,ehr=ehS(ee),eha=tj.required,eho=ehS(ee),ehs=tj.required,ehl=tj.required,ehu=tj.required,ec8(ehc=ehk(ehc=ec9((ehp=L((ehh=function(P){C(f,P);var I,R,E,L,F,D,M=A(f);function f(){var a;o(this,f);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=M.call.apply(M,[this].concat(A)),O(a,"stamp",ehp,N(a)),O(a,"stampSprite",ehd,N(a)),O(a,"purpleBackground",ehf,N(a)),O(a,"title",ehy,N(a)),O(a,"screen",ehv,N(a)),O(a,"stampScreenAnimation",ehm,N(a)),a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("StampScreen: screen not found");a.validateEventPayload(o)&&a.prepareOpenScreen()},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(f,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.stampScreenAnimation=this.node.getComponent(es),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,f)}},{key:"listenScreenEvents",value:function(){ehC.on(ehT.OPENING_SCREEN,this.handleOpeningScreen),ehC.on(ehT.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){ehC.off(ehT.OPENING_SCREEN,this.handleOpeningScreen),ehC.off(ehT.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"open",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.enabled)return[3,2];return[4,this.playAnimations()];case 1:a.sent(),ehC.emit(ehT.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),ehC.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),a.label=2;case 2:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"prepareOpenScreen",value:function(){this.setStampBackground(),this.setNodeOpacity(this.purpleBackground,0),this.setNodeOpacity(this.title,0),this.setNodeOpacity(this.stamp,0)}},{key:"setStampBackground",value:(F=B(function(){var a,o,C,A,P,I;return _ts_generator(this,function(B){switch(B.label){case 0:if(a=this.getTargetLevel(),!(o=td.mapDataManager.getBgKeyForSpecialLevel(a)))return[3,2];return C=td.gameScene.gamePlay.loader,A=o.split("_"),P="frame-bg-".concat(A[1]),[4,C.loadStampFrameAsync(P)];case 1:I=B.sent(),this.stampSprite.spriteFrame=I,B.label=2;case 2:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"getTargetLevel",value:function(){var a=td.gameScene.gamePlay,o=a.gameDataManager.getLevel()-1;return a.gameDataManager.getLevel()===t4.MAX_LEVEL&&(o=t4.MAX_LEVEL),o}},{key:"setNodeOpacity",value:function(a,o){var C=a.getComponent(ea);C&&(C.opacity=o)}},{key:"playNodeOpacityAnimation",value:(L=B(function(a,o,C){var A;return _ts_generator(this,function(P){switch(P.label){case 0:if(!(A=a.getComponent(ea)))return[3,2];return[4,ts.runTweenAsync(Y(A).to(C,{opacity:o}))];case 1:P.sent(),P.label=2;case 2:return[2]}})}),function(a,o,C){return L.apply(this,arguments)})},{key:"close",value:(E=B(function(){return _ts_generator(this,function(a){return this.node.active=!1,ehC.emit(ehT.CLOSED_SCREEN,{screenName:this.node.name}),ehC.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]})}),function(){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"playAnimations",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,ts.waitTweenAsync(.5)];case 1:return a.sent(),th.playSound(tZ.WHOOSH_IN),[4,ts.runAnimationAsync(this.stampScreenAnimation,"StampScreen")];case 2:return a.sent(),[4,Promise.all([this.runStampMoveToChapterEndAnimation(),this.playNodeOpacityAnimation(this.purpleBackground,0,.75),this.playNodeOpacityAnimation(this.title,0,.75)])];case 3:return a.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"runStampMoveToChapterEndAnimation",value:(I=B(function(){var a,o,C,A,P,I,B,R,E,L,O,N,F,D;return _ts_generator(this,function(M){switch(M.label){case 0:if(a=this,!(o=td.gameScene.uiManager.getDashboardScreen().getTheLatestLevelBlock({ignoreIfNotGetReward:!0})))return[3,3];if(!(C=o.getStampBlock()))return[3,2];return th.playSound(tZ.WHOOSH_OUT),C.stopAnims({resetAppear:!1}),C.resetToOriginalPosition(),P=(A=this.stamp.worldPosition).x,I=A.y,B=A.z,E=(R=C.node.worldPosition).x,L=R.y,O=te(.2,-.48,.7,-1.03),N=te(.45,.12,.48,1.05),F=Y({count:0}).to(1.75,{count:1},{progress:function(o,C,A,R){var F=O(R),D=N(R);return a.stamp.setWorldPosition(P+(E-P)*F,I+(L-I)*D,B),R}}),D=Y(this.stamp).to(1.75,{scale:new ei(.69,.69,1)},{easing:e3.cubicOut}),[4,Promise.all([ts.runTweenAsync(F),ts.runTweenAsync(D)])];case 1:M.sent(),C.toggleChildrenStampBlock(!0),C.playWaveAnimation(),M.label=2;case 2:return[3,4];case 3:M.label=4;case 4:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"playSealStampSound",value:function(){th.playSound(tZ.SEAL_STAMP)}}]),f}(eo)).prototype,"stamp",[ehe,eht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehd=L(ehh.prototype,"stampSprite",[ehn,ehi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehf=L(ehh.prototype,"purpleBackground",[ehr,eha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehy=L(ehh.prototype,"title",[eho,ehs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehv=L(ehh.prototype,"screen",[ehl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehm=L(ehh.prototype,"stampScreenAnimation",[ehu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehc=ehh))||ehc)||ehc),U._RF.pop(),U._RF.push({},"775e0MYfdpBvIzZmm0jO8Qo","FakePanelContainer",void 0);var ehA,eh_,ehP,ehI,ehB,ehR,ehE,ehL,ehO,ehN,ehF=function(){function n(a,C){o(this,n),this.position=new ei,this.panel=void 0,this.panel=a,this.position=C}return a(n,[{key:"getPosition",value:function(){return this.position}},{key:"getPanel",value:function(){return this.panel}}]),n}();U._RF.pop(),U._RF.push({},"1b52cSWP5xBHJiyNR1lrQ2r","PanelContainer",void 0);var ehD,ehM,ehx,ehz,ehG,ehq,ehU=$.ccclass,ehH=$.property,ehW=(ehA=ehU("PanelContainer"),eh_=ehH(er),ehP=ehH(er),ehI=ehH(W),ehB=ehH([ee]),ehA((ehE=L((ehR=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"titleLabel",ehE,N(a)),O(a,"levelRangeLabel",ehL,N(a)),O(a,"background",ehO,N(a)),O(a,"themeSprites",ehN,N(a)),a.appearTween=null,a.isEnded=!1,a.startLevel=0,a.endLevel=0,a}return a(s,[{key:"getStartLevel",value:function(){return this.startLevel}},{key:"isInRangeLevel",value:function(a){return a>=this.startLevel&&a<=this.endLevel}},{key:"setTitleLabel",value:function(a){this.titleLabel.string=a}},{key:"setLevelRangeLabel",value:function(a,o){this.levelRangeLabel.string="Level ".concat(a," - ").concat(o),this.startLevel=a,this.endLevel=o}},{key:"setBackgroundSprite",value:function(a){this.background.spriteFrame=a}},{key:"setThemeSprites",value:function(a){for(var o=Math.ceil(this.themeSprites.length/a.length)-1,C=0;C<o;C++)this.themeSprites[C].active=!1;for(var A=o+a.length,P=0,I=o;I<A;I++){var B=this.themeSprites[I].getComponent(W);if(!B)return;B.node.active=!0,B.spriteFrame=a[P++]}for(var R=A;R<this.themeSprites.length;R++)this.themeSprites[R].active=!1}},{key:"reset",value:function(){this.appearTween=null,this.node.setScale(0,0,0)}},{key:"resetTween",value:function(){this.appearTween=null,this.node.setScale(.2,.2,0)}},{key:"isNormal",value:function(){return this.node.scale.x>=.9}},{key:"playAppearAnim",value:function(){this.isEnded||this.appearTween||(em.stopAllByTarget(this.node),this.appearTween=Y(this.node).to(.587,{scale:new ei(1,1,1)},{easing:this.customBackOut}).start())}},{key:"playInitialAnim",value:function(){this.appearTween||(this.isEnded=!1,em.stopAllByTarget(this.node),this.node.setScale(0,0,0),Y(this.node).to(.5,{scale:new ei(1,1,1)},{easing:this.customBackOut}).start())}},{key:"playEndAnim",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return this.isEnded=!0,em.stopAllByTarget(this.node),a=Y(this.node).to(.1,{scale:new ei(0,0,0)},{easing:"cubicIn"}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"customBackOut",value:function(a){var o=a-1;return o*o*(2.4*o+1.4)+1}},{key:"getName",value:function(){return this.titleLabel.string}}]),s}(eo)).prototype,"titleLabel",[eh_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehL=L(ehR.prototype,"levelRangeLabel",[ehP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehO=L(ehR.prototype,"background",[ehI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehN=L(ehR.prototype,"themeSprites",[ehB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ehR))||ehR);U._RF.pop(),U._RF.push({},"81a80QltoRF6q1KahHVbsaE","ThemeScroller",void 0);var ehV,ehK,ehY,ehj,ehX,ehJ,ehZ=$.ccclass,ehQ=$.property,eh$=(ehD=ehZ("ThemeScroller"),ehM=ehQ(eY),ehx=ehQ(eJ),ehD((ehG=L((ehz=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"panelPrefab",ehG,N(a)),O(a,"scrollView",ehq,N(a)),a.fakeItems=[],a.realItems=[],a.content=void 0,a.contentUITransform=void 0,a.maxRealItems=20,a.maxFakeItems=0,a.itemHeight=394,a.offset=200,a.spaceBetweenItems=18,a.paddingTop=18,a.paddingBottom=4,a.standardHeight=1334,a.canAppearAnim=!1,a}return a(r,[{key:"setMaxFakeItems",value:function(a){this.maxFakeItems=a}},{key:"__preload",value:function(){this.registerEvents(),this.initializeComponents(),this.initializeRealPanels(),this.initializeFakePanels()}},{key:"registerEvents",value:function(){this.node.on(vx,this.handleScrollWithDirection,this)}},{key:"initializeComponents",value:function(){this.content=this.scrollView.content,this.contentUITransform=this.content.getComponent(en),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"getRedundantArea",value:function(){return Math.max(0,this.getDeviceHeight()-this.standardHeight)}},{key:"getDeviceHeight",value:function(){return eP.getVisibleSize().y}},{key:"getBannerHeight",value:function(){return game.ads.getBannerHeight(GameCore.Configs.Ads.BannerDisplayAdOptions[0].PlacementId,tc.cssSizeToWorldSize(1),!0)}},{key:"initializeRealPanels",value:function(){for(var a=0;a<this.maxRealItems;a++){var o=ej(this.panelPrefab),C=new ei(0,-(a*(this.itemHeight+this.spaceBetweenItems)+this.offset+this.paddingTop),0);o.setPosition(C),this.content.addChild(o);var A=o.getComponent(ehW);if(!A)return;this.realItems.push(A)}var P=this.getBannerHeight(),I=this.getRedundantArea();this.contentUITransform.height=this.maxFakeItems*(this.itemHeight+this.spaceBetweenItems)+this.paddingBottom*devicePixelRatio+P-I}},{key:"initializeFakePanels",value:function(){for(var a=0,o=0;o<this.maxFakeItems;o++){var C=new ehF(this.realItems[a],new ei(0,-(o*(this.itemHeight+this.spaceBetweenItems)+this.offset+this.paddingTop),0));this.fakeItems.push(C),a=(a+1)%this.maxRealItems}}},{key:"handleScrollWithDirection",value:function(){var a,o=this.getVisibleFakePanels(),C=E(o);try{for(C.s();!(a=C.n()).done;){var A=a.value,P=A.getPanel();P.node.setPosition(A.getPosition());var I=this.fakeItems.indexOf(A);this.updateData(I,P),this.canAppearAnim&&P.playAppearAnim()}}catch(a){C.e(a)}finally{C.f()}}},{key:"getVisibleFakePanels",value:function(){var a,o=[],C=this.getBorderUp(),A=this.getBorderDown(),P=E(this.fakeItems);try{for(P.s();!(a=P.n()).done;){var I=a.value,B=I.getPosition().y;B<=C&&B>=A&&o.push(I)}}catch(a){P.e(a)}finally{P.f()}return o}},{key:"getBorderUp",value:function(){return 800-this.content.position.y}},{key:"getBorderDown",value:function(){return-this.content.position.y-this.getDeviceHeight()-400}},{key:"getItemHeight",value:function(){return this.itemHeight}},{key:"moveToItem",value:function(a){var o=this,C=a.getPosition(),A=new H(0,-C.y-500);this.canAppearAnim=!1,this.scrollView.scrollToOffset(A),this.scheduleOnce(function(){o.canAppearAnim=!0},.1)}},{key:"updateData",value:function(a,o){}}]),r}(eo)).prototype,"panelPrefab",[ehM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehq=L(ehz.prototype,"scrollView",[ehx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehz))||ehz);U._RF.pop(),U._RF.push({},"fe717V1PWxLo7cMygiOWS8h","ContainerTheme",void 0);var eh0,eh1,eh2,eh3,eh4,eh5,eh6=$.ccclass,eh7=$.property,eh8=(ehV=eh6("ContainerTheme"),ehK=eh7(v9),ehY=eh7(eh$),ehV((ehX=L((ehj=function(P){C(y,P);var I,R,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"smoothScroller",ehX,N(a)),O(a,"themeScroller",ehJ,N(a)),a.previousItem=null,a.uiOpacity=void 0,a}return a(y,[{key:"__preload",value:function(){this.uiOpacity=this.node.getComponent(ea),this.registryScrollerEvents(),this.setUpScroller(),this.validateRequiredComponents()}},{key:"registryScrollerEvents",value:function(){this.smoothScroller.node.on(vx,this.handlePlayPanelAnimWhileScrolling,this),this.smoothScroller.node.on("touch-end",this.onTouchScrollEnd,this),this.themeScroller.updateData=this.updatePanelData.bind(this)}},{key:"setUpScroller",value:function(){var a=td.mapDataManager.getLengthScrollerPayload();this.themeScroller.setMaxFakeItems(a)}},{key:"getHeaderOffset",value:function(){var a=td.gameScene.gamePlay.gameUI;return a.getPreHeightHeader()-a.getCurrentHeightHeader()}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"resetScroller",value:function(){}},{key:"updatePanelData",value:function(a,o){var C=td.gameScene.gamePlay,A=td.mapDataManager.getScrollerPayLoad(a);if(A){var P=A.title;A.textures.frame.split("/")[1],o.setTitleLabel(P),o.setLevelRangeLabel(A.startLevel,A.endLevel);var I,B=E(A.backgroundCardPayloads);try{for(B.s();!(I=B.n()).done;){var R=I.value;if(!(C.gameDataManager.getLevel()<R.startLevel))R.texture.frame.split("/")[1]}}catch(a){B.e(a)}finally{B.f()}}}},{key:"moveToPanel",value:function(){for(var a=td.gameScene.gamePlay,o=0;o<this.themeScroller.fakeItems.length;o++){var C=td.mapDataManager.getScrollerPayLoad(o),A=this.themeScroller.fakeItems[o];if(C&&this.isInRangeLevel(a.gameDataManager.getLevel(),C.startLevel,C.endLevel))return void this.themeScroller.moveToItem(A)}}},{key:"isInRangeLevel",value:function(a,o,C){return a>=o&&a<=C}},{key:"reset",value:function(){this.uiOpacity.opacity=0;var a,o=E(this.themeScroller.realItems);try{for(o.s();!(a=o.n()).done;)a.value.reset()}catch(a){o.e(a)}finally{o.f()}}},{key:"toggleBackgroundAnim",value:(F=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!a)return[3,2];return o=Y(this.uiOpacity).to(.1,{opacity:255},{easing:"smooth"}),[4,ts.runTweenAsync(o)];case 1:return A.sent(),[3,4];case 2:return C=Y(this.uiOpacity).to(.15,{opacity:0},{easing:"smooth"}),[4,ts.runTweenAsync(C)];case 3:A.sent(),A.label=4;case 4:return[2]}})}),function(a){return F.apply(this,arguments)})},{key:"toggleItemsAnim",value:(L=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:if(!a)return[3,2];return[4,this.playOpenThemeScreenAnim()];case 1:return o.sent(),[3,4];case 2:return[4,this.playCloseThemeScreenAnim()];case 3:o.sent(),o.label=4;case 4:return[2]}})}),function(a){return L.apply(this,arguments)})},{key:"playOpenThemeScreenAnim",value:(R=B(function(){var a,o;return _ts_generator(this,function(C){o=E(this.themeScroller.realItems);try{for(o.s();!(a=o.n()).done;)a.value.playInitialAnim()}catch(a){o.e(a)}finally{o.f()}return[2]})}),function(){return R.apply(this,arguments)})},{key:"playCloseThemeScreenAnim",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:o=[],C=E(this.themeScroller.realItems);try{for(C.s();!(a=C.n()).done;)A=a.value,o.push(A.playEndAnim())}catch(a){C.e(a)}finally{C.f()}return[4,Promise.all(o)];case 1:return P.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"onTouchScrollEnd",value:function(){var a,o=this.smoothScroller.node.worldPosition.y+1800,C=o-this.themeScroller.getDeviceHeight(),A=E(this.themeScroller.realItems);try{for(A.s();!(a=A.n()).done;){var P=a.value;P.node.worldPosition.y<=o&&P.node.worldPosition.y>=C&&P.playAppearAnim()}}catch(a){A.e(a)}finally{A.f()}}},{key:"handlePlayPanelAnimWhileScrolling",value:function(a){var o,C=this.smoothScroller.node.worldPosition.y+800,A=C-this.themeScroller.getDeviceHeight()-this.themeScroller.getItemHeight()/2,P=void 0,I=E(this.themeScroller.realItems);try{for(I.s();!(o=I.n()).done;){var B=o.value,R=B.node.worldPosition.y;R<=C&&R>=A?a&&!P?P=B:a||(P=B):this.resetPreviousItem(B)}}catch(a){I.e(a)}finally{I.f()}void 0!==P&&(this.previousItem=P,P.isNormal()||P.playAppearAnim())}},{key:"resetPreviousItem",value:function(a){this.previousItem&&a.resetTween()}}]),y}(eo)).prototype,"smoothScroller",[ehK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehJ=L(ehj.prototype,"themeScroller",[ehY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ehj))||ehj);U._RF.pop(),U._RF.push({},"77872d4xLVG+ZmrFoc99GN4","HeaderTheme",void 0);var eh9,epe,ept,epn,epi,epr,epa=$.ccclass,epo=$.property,eps=(eh0=epa("HeaderTheme"),eh1=epo(ee),eh2=epo(ef),eh0((eh4=L((eh3=function(P){C(p,P);var I,R,E,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"themeTitleNode",eh4,N(a)),O(a,"backButton",eh5,N(a)),a.originalBackButtonPos=ei.ZERO,a.hideOriginalBackButtonPos=ei.ZERO,a.themeTitleOpacity=void 0,a.uiOpacity=void 0,a}return a(p,[{key:"__preload",value:function(){this.themeTitleOpacity=this.themeTitleNode.getComponent(ea),this.uiOpacity=this.node.getComponent(ea),this.initData(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"initData",value:function(){var a=this.backButton.node.position,o=a.x,C=a.y,A=a.z;this.originalBackButtonPos=new ei(o,C,A),this.hideOriginalBackButtonPos=new ei(o-200,C,A)}},{key:"onClickBackButton",set:function(a){this.backButton.node.on(ef.EventType.CLICK,a,this)}},{key:"reset",value:function(){var a=this.hideOriginalBackButtonPos,o=a.x,C=a.y,A=a.z;this.backButton.node.position=new ei(o,C,A),this.themeTitleOpacity.opacity=255,this.uiOpacity.opacity=0,this.themeTitleNode.scale=new ei(0,0,0)}},{key:"toggleBackgroundAnim",value:(E=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!a)return[3,2];return o=Y(this.uiOpacity).to(.1,{opacity:255},{easing:"smooth"}),[4,ts.runTweenAsync(o)];case 1:return A.sent(),[3,4];case 2:return C=Y(this.uiOpacity).to(.2,{opacity:0},{easing:"smooth"}),[4,ts.runTweenAsync(C)];case 3:A.sent(),A.label=4;case 4:return[2]}})}),function(a){return E.apply(this,arguments)})},{key:"toggleBackButtonAnim",value:(R=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!a)return[3,2];return o=Y(this.backButton.node).to(.3,{position:this.originalBackButtonPos},{easing:"backOut"}),[4,ts.runTweenAsync(o)];case 1:return A.sent(),[3,4];case 2:return C=Y(this.backButton.node).to(.3,{position:this.hideOriginalBackButtonPos},{easing:"backIn"}),[4,ts.runTweenAsync(C)];case 3:A.sent(),A.label=4;case 4:return[2]}})}),function(a){return R.apply(this,arguments)})},{key:"toggleThemeTitleAnim",value:(I=B(function(a){var o,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!a)return[3,2];return o=Y(this.themeTitleNode).to(.3,{scale:new ei(1,1,1)},{easing:tt(.38,1.37,.64,1)}),[4,ts.runTweenAsync(o)];case 1:return A.sent(),[3,4];case 2:return C=Y(this.themeTitleOpacity).to(.2,{opacity:0},{easing:"smooth"}),[4,ts.runTweenAsync(C)];case 3:A.sent(),A.label=4;case 4:return[2]}})}),function(a){return I.apply(this,arguments)})}]),p}(eo)).prototype,"themeTitleNode",[eh1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eh5=L(eh3.prototype,"backButton",[eh2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eh3))||eh3);U._RF.pop(),U._RF.push({},"c9094J6QbxPnrk6jxESQ/xn","ThemeScreen",void 0);var epl,epu,epc,eph,epp,epd,epf,epy,epv,epm,epg,epb,epk,epw,epS,epT,epC,epA,ep_,epP=$.ccclass,epI=$.property,epB=globalThis.game.event,epR=GameCore.Events;eh9=epP("ThemeScreen"),epe=epI(eps),ept=epI(eh8),eh9((epi=L((epn=function(P){C(f,P);var I,R,E,L,F,D,M=A(f);function f(){var a;o(this,f);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=M.call.apply(M,[this].concat(A)),O(a,"header",epi,N(a)),O(a,"container",epr,N(a)),a.baseScreen=void 0,a}return a(f,[{key:"__preload",value:function(){this.registryButtonEvents(),this.baseScreen=this.node.getComponent("BaseScreen"),this.baseScreen.open=this.open.bind(this),this.baseScreen.close=this.close.bind(this),this.validateRequiredComponents();var a=this.header.getComponent(ea);a&&(a.opacity=0)}},{key:"validateRequiredComponents",value:function(){tj.lazyValidateProperties(this)}},{key:"open",value:(D=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return a&&(this.baseScreen.data=a),this.container.moveToPanel(),this.baseScreen.runAnimation("OpenScreen"),th.playSound(tZ.THEME_POPUP_SHOW),[4,this.handleOpenScreen()];case 1:return o.sent(),epB.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),this.container.resetScroller(),[2]}})}),function(a){return D.apply(this,arguments)})},{key:"close",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.node.active)return[3,2];return th.playSound(tZ.SWITCH),[4,this.handleCloseScreen()];case 1:a.sent(),epB.emit(epR.CLOSED_SCREEN,{screenName:this.node.name}),this.node.active=!1,epB.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),this.baseScreen.runAnimation("CloseScreen"),a.label=2;case 2:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"registryButtonEvents",value:function(){var a=this;this.header.onClickBackButton=function(){a.handleBackClicked()}}},{key:"handleOpenScreen",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.header.reset(),this.container.reset(),[4,Promise.all([this.header.toggleBackgroundAnim(!0),this.container.toggleBackgroundAnim(!0)])];case 1:return a.sent(),this.header.toggleBackButtonAnim(!0),[4,Promise.all([this.header.toggleThemeTitleAnim(!0),this.container.toggleItemsAnim(!0)])];case 2:return a.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"handleCloseScreen",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.header.toggleThemeTitleAnim(!1),this.container.toggleItemsAnim(!1),this.header.toggleBackButtonAnim(!1)])];case 1:return a.sent(),[4,Promise.all([this.header.toggleBackgroundAnim(!1),this.container.toggleBackgroundAnim(!1)])];case 2:return a.sent(),[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleBackClicked",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,Promise.all([t_.closeScreenAsync(tP.THEME_SCREEN),this.fadeInDashboard()])];case 1:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"fadeInDashboard",value:(I=B(function(){return _ts_generator(this,function(a){return[2]})}),function(){return I.apply(this,arguments)})}]),f}(eo)).prototype,"header",[epe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epr=L(epn.prototype,"container",[ept],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epn)),U._RF.pop(),U._RF.push({},"c7a80DT3vdInaOmS1bS9jeD","TournamentInfoScreen",void 0);var epE,epL,epO,epN,epF,epD,epM,epx,epz,epG,epq,epU,epH,epW,epV,epK,epY,epj,epX,epJ,epZ,epQ,ep$,ep0,ep1,ep2,ep3,ep4,ep5,ep6=$.ccclass,ep7=$.property,ep8=GameCore.Events,ep9=globalThis.game.event;epl=ep6("TournamentInfoScreen"),epu=ep7(ef),epc=tj.required,eph=ep7(ef),epp=tj.required,epd=ep7(ee),epf=tj.required,epy=ep7(er),epv=tj.required,epm=ep7(nt),epg=tj.required,epb=tj.required,epl((epw=L((epk=function(P){C(v,P);var I,R,E,L,F,D,M,x=A(v);function v(){var a;o(this,v);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=x.call.apply(x,[this].concat(A)),O(a,"startButton",epw,N(a)),O(a,"closeButton",epS,N(a)),O(a,"popupContainer",epT,N(a)),O(a,"timer",epC,N(a)),O(a,"glowDot",epA,N(a)),O(a,"screen",ep_,N(a)),a.originalTimeFontSize=0,a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("FinishTournamentInfoScreen: screen not found");a.prepareOpen(),a.validateEventPayload(o)},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(v,[{key:"__preload",value:function(){this.listenScreenEvents(),this.registryButtonEvents(),this.initComponents(),this.initData(),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this)}},{key:"initComponents",value:function(){this.screen=this.node.getComponent("BaseScreen"),this.validateRequiredComponents()}},{key:"initData",value:function(){this.popupContainer.scale=new ei(0,0,0),this.originalTimeFontSize=this.timer.fontSize}},{key:"onLoad",value:function(){this.updateContainerWidget(),this.node.scene.on(t2.LEADER_BOARD_TIMER_COUNT_DOWN,this.updateLBTime,this)}},{key:"updateContainerWidget",value:function(){try{var a=tf.getBannerAdWorldHeight();if(a<=0)return;var o=this.popupContainer.getComponent(eX);if(!o)return;o.bottom+=a,o.updateAlignment()}catch(a){return}}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"start",value:function(){var a=this.popupContainer.getComponent(ea);a&&(a.opacity=255)}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,v)}},{key:"listenScreenEvents",value:function(){ep9.on(ep8.OPENING_SCREEN,this.handleOpeningScreen),ep9.on(ep8.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){ep9.off(ep8.OPENING_SCREEN,this.handleOpeningScreen),ep9.off(ep8.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"registryButtonEvents",value:function(){this.startButton.node.on(ef.EventType.CLICK,this.handleStartButtonClick,this),this.closeButton.node.on(ef.EventType.CLICK,this.handleCloseButtonClick,this)}},{key:"prepareOpen",value:function(){var a=td.gameScene.gamePlay.timerHandler.getLeaderboardTimer();this.updateLBTime(a)}},{key:"open",value:(M=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return(a=this.glowDot).prepareGlow(),th.playSound(tZ.POPUP_SHOW),[4,this.tweenScaleUpPopup()];case 1:return o.sent(),a.runGlow(),ep9.emit(ep8.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),ep9.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return M.apply(this,arguments)})},{key:"close",value:(D=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.POPUP_OFF),this.glowDot.stopGlow(),[4,this.tweenScaleDownPopup()];case 1:return a.sent(),this.node.active=!1,ep9.emit(ep8.CLOSED_SCREEN,{screenName:this.node.name}),ep9.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return D.apply(this,arguments)})},{key:"tweenScaleUpPopup",value:(F=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.screen.runAnimation("OpenScreen"),Y(a.popupContainer).to(.2,{scale:new ei(1,1,1)},{easing:"backOut"}).call(function(){o()}).start()})]})}),function(){return F.apply(this,arguments)})},{key:"tweenScaleDownPopup",value:(L=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.screen.runAnimation("CloseScreen"),Y(a.popupContainer).to(.2,{scale:new ei(0,0,0)},{easing:"sineIn"}).call(function(){o()}).start()})]})}),function(){return L.apply(this,arguments)})},{key:"handleStartButtonClick",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,t_.closeScreenAsync(tP.TOURNAMENT_INFO_SCREEN)];case 1:if(a.sent(),!this.canOpenPopupJoinTournament())return[3,5];return[4,td.gameScene.tournament.tryToJoinTournamentAsync()];case 2:if(!!a.sent())return[3,4];return[4,Promise.all([this.fadeInDashboard(),td.gameScene.rubyBarComp.runShowAnimationAsync()])];case 3:return[2,(a.sent(),void td.gameScene.toggleBlockInputContainer(!1))];case 4:td.gameScene.gamePlay.requestResetLevel(),a.label=5;case 5:return[4,td.gameScene.rubyBarComp.runHideAnimationAsync()];case 6:return a.sent(),[4,Promise.all([td.gameScene.uiManager.openLeaderboardScreenAsync(),t_.closeScreenAsync(tP.DASHBOARD_SCREEN)])];case 7:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return E.apply(this,arguments)})},{key:"canOpenPopupJoinTournament",value:function(){return!td.gameScene.tournament.isJoinedCurTour()}},{key:"handleCloseButtonClick",value:(R=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),[4,t_.closeScreenAsync(tP.TOURNAMENT_INFO_SCREEN)];case 1:return a.sent(),[4,Promise.all([this.fadeInDashboard(),td.gameScene.rubyBarComp.runShowAnimationAsync()])];case 2:return a.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return R.apply(this,arguments)})},{key:"updateLBTime",value:function(a){if(a<=0){var o="Loading...";o=a<0?globalThis.game.language.getText("Loading..."):globalThis.game.language.getText("End"),this.setTimerLabelText(o)}else{var C=Rs.getStandardTimeFormat(a);this.setTimerLabelText(C)}}},{key:"setTimerLabelText",value:function(a){this.timer.string=a;var o=D4.getAutoResizedFontSize({text:a,originalSize:this.originalTimeFontSize,maxLength:8,minSize:3,shrinkFactor:3});this.timer.fontSize=o}},{key:"fadeInDashboard",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){a.node.scene.once(t2.FADED_IN_DASHBOARD_DONE,o),td.gameScene.uiManager.handleScreenReturn()})]})}),function(){return I.apply(this,arguments)})}]),v}(eo)).prototype,"startButton",[epu,epc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epS=L(epk.prototype,"closeButton",[eph,epp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epT=L(epk.prototype,"popupContainer",[epd,epf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epC=L(epk.prototype,"timer",[epy,epv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epA=L(epk.prototype,"glowDot",[epm,epg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep_=L(epk.prototype,"screen",[epb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epk)),U._RF.pop(),U._RF.push({},"a2990xpDSdPHro2ip50/gY9","ContainerTournamentTutorial",void 0);var ede,edt,edn,edi,edr,eda,edo,eds,edl,edu,edc,edh,edp=$.ccclass,edd=$.property,edf=(epE=edp("ContainerTournamentTutorial"),epL=edd(eX),epO=tj.required,epN=edd(eX),epF=tj.required,epD=edd(eX),epM=tj.required,epx=edd(ee),epz=tj.required,epG=edd(ee),epq=tj.required,epU=edd(ee),epH=tj.required,epW=edd(ee),epV=tj.required,epK=edd(ee),epY=tj.required,epj=edd(ef),epX=tj.required,epE((epZ=L((epJ=function(P){C(p,P);var I,R,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"header",epZ,N(a)),O(a,"middle",epQ,N(a)),O(a,"footer",ep$,N(a)),O(a,"cloverChallenge",ep0,N(a)),O(a,"winLevelNode",ep1,N(a)),O(a,"collectNode",ep2,N(a)),O(a,"improveRankingNode",ep3,N(a)),O(a,"tapToContinue",ep4,N(a)),O(a,"tapZoneButton",ep5,N(a)),a.items=null,a.originalItemPos=[],a.scaleTargetValue=1,a}return a(p,[{key:"onClickTapZoneButton",set:function(a){this.tapZoneButton.node.on(ef.EventType.CLICK,a,this)}},{key:"getTapZoneButton",value:function(){return this.tapZoneButton}},{key:"__preload",value:function(){ep.on(tl.VIEW_RESIZED,this.alignContainerItems,this),this.initData(),tj.validateRequiredProperties(this,p)}},{key:"initData",value:function(){if(!this.items){this.items=[this.cloverChallenge,this.winLevelNode,this.collectNode,this.improveRankingNode,this.tapToContinue];var a,o=E(this.items);try{for(o.s();!(a=o.n()).done;){var C=a.value;this.originalItemPos.push(C.position.clone())}}catch(a){o.e(a)}finally{o.f()}}}},{key:"onLoad",value:function(){this.alignContainerItems()}},{key:"alignContainerItems",value:function(){var a=eP.getVisibleSize().height,o=tu.DesignSize.Landscape.HEIGHT;a=Math.min(a,2100);var C=(2100-o)/3;if(this.scaleTargetValue=a/2100,this.items){for(var A=0;A<this.items.length;A++){var P=this.items[A];if(P.setScale(this.scaleTargetValue,this.scaleTargetValue,1),0!==A&&4!==A){var I=this.originalItemPos[A],B=I.x*this.scaleTargetValue,R=I.y*this.scaleTargetValue+C;P.setPosition(B,R,0)}}var E=tf.getBannerAdWorldHeight(),L=this.footer.getComponent(eX);L&&(L.bottom=E)}}},{key:"prepareOpenAnim",value:function(){if(this.initData(),this.items){var a,o=.7*this.scaleTargetValue,C=E(this.items);try{for(C.s();!(a=C.n()).done;){var A=a.value;A.scale=new ei(o,o,1);var P=A.getComponent(ea);P&&(P.opacity=0)}}catch(a){C.e(a)}finally{C.f()}}}},{key:"playOpenAnim",value:(R=B(function(){var a,o,C,A,P,I,B,R;return _ts_generator(this,function(L){switch(L.label){case 0:if(!this.items)return[3,2];o=[],C=.1,A=E(this.items);try{for(A.s();!(a=A.n()).done;)if(P=a.value,I=Y(P).delay(C).to(.5,{scale:new ei(this.scaleTargetValue,this.scaleTargetValue,1)},{easing:ta}),B=P.getComponent(ea))R=Y(B).delay(C).to(.5,{opacity:255},{easing:ta}),o.push(ts.runTweenAsync(I)),o.push(ts.runTweenAsync(R)),C+=.2}catch(a){A.e(a)}finally{A.f()}return[4,Promise.all(o)];case 1:L.sent(),L.label=2;case 2:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"prepareCloseAnim",value:function(){if(this.items){var a,o=E(this.items);try{for(o.s();!(a=o.n()).done;){var C=a.value;C.scale=new ei(this.scaleTargetValue,this.scaleTargetValue,1);var A=C.getComponent(ea);A&&(A.opacity=204)}}catch(a){o.e(a)}finally{o.f()}}}},{key:"playCloseAnim",value:(I=B(function(){var a,o,C,A,P,I,B;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.items)return[3,2];o=[],C=E(this.items);try{for(C.s();!(a=C.n()).done;)if(A=a.value,P=Y(A).to(.2,{scale:new ei(this.scaleTargetValue,this.scaleTargetValue,1)},{easing:ta}),I=A.getComponent(ea))B=Y(I).to(.2,{opacity:0},{easing:ta}),o.push(ts.runTweenAsync(P)),o.push(ts.runTweenAsync(B))}catch(a){C.e(a)}finally{C.f()}return[4,Promise.all(o)];case 1:R.sent(),R.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})}]),p}(eo)).prototype,"header",[epL,epO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epQ=L(epJ.prototype,"middle",[epN,epF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep$=L(epJ.prototype,"footer",[epD,epM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep0=L(epJ.prototype,"cloverChallenge",[epx,epz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep1=L(epJ.prototype,"winLevelNode",[epG,epq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep2=L(epJ.prototype,"collectNode",[epU,epH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep3=L(epJ.prototype,"improveRankingNode",[epW,epV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep4=L(epJ.prototype,"tapToContinue",[epK,epY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep5=L(epJ.prototype,"tapZoneButton",[epj,epX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),epJ))||epJ);U._RF.pop(),U._RF.push({},"2dc7bLBwL9KMrHkBUguD7sg","TournamentTutorialScreen",void 0);var edy,edv,edm,edg,edb,edk=$.ccclass,edw=$.disallowMultiple,edS=$.requireComponent,edT=$.property,edC=GameCore.Events,edA=globalThis.game,ed_=edA.event,edP=edA.analytics;ede=edk("TournamentTutorialScreen"),edt=edS(Bi),edn=edT(edf),edi=tj.required,edr=edT(ea),eda=tj.required,edo=tj.required,ede(eds=edw(eds=edt((edu=L((edl=function(P){C(y,P);var I,R,E,L,F,D=A(y);function y(){var a;o(this,y);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=D.call.apply(D,[this].concat(A)),O(a,"container",edu,N(a)),O(a,"blackMask",edc,N(a)),O(a,"screen",edh,N(a)),a.handleOpeningScreen=function(o){if(!a.screen)throw new Error("IntroBattlePassScreen: screen not found");a.validateEventPayload(o)&&a.prepareOpenAnim()},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(y,[{key:"__preload",value:function(){this.screen=this.getComponent(Bi),this.screen.open=this.open.bind(this),this.screen.close=this.close.bind(this),this.validateRequiredComponents(),this.listenScreenEvents(),this.registryButtonEvents()}},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,y)}},{key:"listenScreenEvents",value:function(){ed_.on(edC.OPENING_SCREEN,this.handleOpeningScreen),ed_.on(edC.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){ed_.off(edC.OPENING_SCREEN,this.handleOpeningScreen),ed_.off(edC.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"registryButtonEvents",value:function(){var a=this;this.container.onClickTapZoneButton=function(){a.handleTapZoneButtonClicked()}}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"prepareOpenAnim",value:function(){this.container.prepareOpenAnim(),this.blackMask.opacity=0}},{key:"open",value:(F=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!this.enabled)return[3,2];return[4,Promise.all([this.playFadeInMask(),this.container.playOpenAnim()])];case 1:a.sent(),ed_.emit(edC.OPENED_SCREEN,{screenName:this.node.name,screenData:this.screen.data}),ed_.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),a.label=2;case 2:return[2]}})}),function(){return F.apply(this,arguments)})},{key:"playFadeInMask",value:(L=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.blackMask).to(.25,{opacity:229.5}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"close",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,Promise.all([this.playFadeOutMask(),this.container.playCloseAnim()])];case 1:return a.sent(),this.node.active=!1,ed_.emit(edC.CLOSED_SCREEN,{screenName:this.node.name}),ed_.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return E.apply(this,arguments)})},{key:"playFadeOutMask",value:(R=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return a=Y(this.blackMask).to(.25,{opacity:0}),[4,ts.runTweenAsync(a)];case 1:return o.sent(),[2]}})}),function(){return R.apply(this,arguments)})},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"handleTapZoneButtonClicked",value:(I=B(function(){var a;return _ts_generator(this,function(o){switch(o.label){case 0:return td.gameScene.toggleBlockInputContainer(!0),this.container.prepareCloseAnim(),a=this.container.getTapZoneButton().node,edP.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:aP[a.name],screen_name:tp.getCurrentPage()}),[4,t_.closeScreenAsync(tP.TOURNAMENT_TUTORIAL_SCREEN)];case 1:return o.sent(),td.gameScene.toggleBlockInputContainer(!1),[2]}})}),function(){return I.apply(this,arguments)})}]),y}(eo)).prototype,"container",[edn,edi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),edc=L(edl.prototype,"blackMask",[edr,eda],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),edh=L(edl.prototype,"screen",[edo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eds=edl))||eds)||eds),U._RF.pop(),U._RF.push({},"cf70ai8YfNGfY2tQA2muZoS","MiniTilePool",void 0);var edI,edB,edR,edE,edL,edO=$.ccclass,edN=$.property,edF=(edy=edO("MiniTilePool"),edv=edN(eY),edm=tj.required,edy((edb=L((edg=function(P){C(r,P);var I=A(r);function r(){var a;o(this,r);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=I.call.apply(I,[this].concat(A)),O(a,"miniTilePrefab",edb,N(a)),a.pool=[],a}return a(r,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,r)}},{key:"getMiniTile",value:function(){for(var a=0;a<this.pool.length;a++)if(!this.pool[a].node.active)return this.pool[a].node.active=!0,this.pool[a];var o=ej(this.miniTilePrefab).getComponent(_O);if(o)return this.pool.push(o),o;throw new Error("MiniTile component is not found on the instantiated tile")}}]),r}(eo)).prototype,"miniTilePrefab",[edv,edm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),edg))||edg);U._RF.pop(),U._RF.push({},"a3a30ttqzZEOb8TzRr9GEis","MiniBoard",void 0);var edD,edM=$.ccclass,edx=$.property,edz={ROW:1,COL:3},edG={WIDTH:92.16,HEIGHT:88},edq=(edI=edM("MiniBoard"),edB=edx(edF),edR=tj.required,edI((edL=L((edE=function(P){C(p,P);var I,R,L=A(p);function p(){var a;o(this,p);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=L.call.apply(L,[this].concat(A)),O(a,"miniTilePool",edL,N(a)),a.miniBoardMap=[],a.tweensFadeInTile=[],a}return a(p,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,p)}},{key:"getMiniTileByPosition",value:function(a,o){return this.miniBoardMap[a][o]}},{key:"createMiniBoard",value:(R=B(function(){var a,o,C,A,P,I,B;return _ts_generator(this,function(R){for(this.miniBoardMap=[],a=[new H(0,1.5*-edG.HEIGHT+30),new H(2*edG.WIDTH,1.5*-edG.HEIGHT+30),new H(4*edG.WIDTH,1.5*-edG.HEIGHT+30)],o=0;o<edz.ROW;o++)for(C=0,this.miniBoardMap[o]=[];C<edz.COL;C++){if((A=this.miniTilePool.getMiniTile()).node.parent=this.node,P=o*edz.COL+C,A.node.setSiblingIndex(P),I=a[C],A.node.position=new ei(I.x,I.y,0),A.node.scale=new ei(0,0,0),!(B=A.getComponent(_O)))throw new Error("MiniTile component is not found on the instantiated tile");this.miniBoardMap[o][C]=B}return this.getTutorialBoardData(),[2]})}),function(){return R.apply(this,arguments)})},{key:"fadeInMiniGame",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:a=this,o=[],C=function(C){var A,P;return _ts_generator(this,function(I){switch(I.label){case 0:A=function(A){var P;return _ts_generator(this,function(I){return P=a.miniBoardMap[C][A],o.push(new Promise(function(o){a.tweensFadeInTile.push(Y(P.node).delay(.05*(A+C*edz.COL)).to(.1,{scale:new ei(1,1,1)},{easing:"backOut"}).call(function(){return o()}).start())})),[2]})},P=0,I.label=1;case 1:if(!(P<edz.COL))return[3,4];return[5,_ts_values(A(P))];case 2:I.sent(),I.label=3;case 3:return P++,[3,1];case 4:return[2]}})},A=0,P.label=1;case 1:if(!(A<edz.ROW))return[3,4];return[5,_ts_values(C(A))];case 2:P.sent(),P.label=3;case 3:return A++,[3,1];case 4:return[4,Promise.all(o)];case 5:return P.sent(),[2]}})}),function(){return I.apply(this,arguments)})},{key:"getTutorialBoardData",value:function(){for(var a=[],o=0;o<edz.ROW;o++)for(var C=0;C<edz.COL;C++)a.push({i:o,j:C});GameCore.Utils.Array.shuffle(a);for(var A=0,P=[21];A<P.length;A++)for(var I=P[A],B=0;B<3;B++){var R=a.pop();if(R){var E=this.miniBoardMap[R.i][R.j].getComponent(_O);if(E){var L=td.gameScene.gamePlay.loader.getOriginalTileIcon(I-1);L&&E.setIcon(L)}}}}},{key:"stopAllTweenFadeIn",value:function(){var a,o=E(this.tweensFadeInTile);try{for(o.s();!(a=o.n()).done;){var C=a.value;null==C||C.stop()}}catch(a){o.e(a)}finally{o.f()}}}]),p}(eo)).prototype,"miniTilePool",[edB,edR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),edE))||edE);U._RF.pop(),U._RF.push({},"9c2fbzN3/JMn7l35eJqsL3b","MiniRack",void 0);var edU,edH=$.ccclass,edW={X:85,Y:378},edV=edH("MiniRack")(edD=function(P){C(h,P);var I,R,L,O=A(h);function h(){var a;o(this,h);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=O.call.apply(O,[this].concat(A))).tiles=[],a.tweensMiniTile=[],a}return a(h,[{key:"__preload",value:function(){}},{key:"onLoad",value:function(){}},{key:"start",value:function(){}},{key:"handleAddTile",value:(L=B(function(a,o){var C;return _ts_generator(this,function(A){switch(A.label){case 0:return this.tiles.push(a),a.node.setSiblingIndex(1e3),o.node.setSiblingIndex(1001),C=this.tiles.indexOf(a),[4,this.tileFallToRack(a,C)];case 1:return A.sent(),[2]}})}),function(a,o){return L.apply(this,arguments)})},{key:"tileFallToRack",value:(R=B(function(a,o){var C,A,P;return _ts_generator(this,function(I){return C=this,A=this.node.position.x-edW.X+92*o,P=this.node.position.y-edW.Y,[2,new Promise(function(o){var I=Y(a.node).to(.5,{position:new ei(A,P),scale:new ei(.95,.95)},{easing:"sineOut"}).call(B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,C.playMatch3Animation()];case 1:return a.sent(),o(),[2]}})})).start();C.tweensMiniTile.push(I)})]})}),function(a,o){return R.apply(this,arguments)})},{key:"playMatch3Animation",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){if(a.tiles.length<3)o();else for(var C=0;C<a.tiles.length;C++)(function(){var A=a.tiles[C],P=Y(A.node).to(.1,{scale:new ei(0,0)},{easing:"sineOut"}).call(function(){A.resetProperties(),A.node.active=!1,a.tiles=[],o()}).start();a.tweensMiniTile.push(P)})()})]})}),function(){return I.apply(this,arguments)})},{key:"stopAllTween",value:function(){var a,o=E(this.tweensMiniTile);try{for(o.s();!(a=o.n()).done;)a.value.stop()}catch(a){o.e(a)}finally{o.f()}}},{key:"clearRack",value:function(){this.tiles=[]}}]),h}(eo))||edD;U._RF.pop(),U._RF.push({},"e492bEkiglGVKwu1bh/SHbw","TutorialHand",void 0);var edK,edY,edj,edX,edJ,edZ,edQ,ed$,ed0,ed1,ed2,ed3=(0,$.ccclass)("TutorialHand")(edU=function(P){C(d,P);var I,R,E,L,O,N,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return(a=F.call.apply(F,[this].concat(A))).originalHandScale=void 0,a.isMoving=!1,a}return a(d,[{key:"__preload",value:function(){this.originalHandScale=this.node.scale.clone()}},{key:"returnToRestPosition",value:(N=B(function(){return _ts_generator(this,function(a){return this.isMoving=!1,em.stopAllByTarget(this.node),this.node.setPosition(470,-230),this.originalHandScale&&this.node.setScale(this.originalHandScale),[2]})}),function(){return N.apply(this,arguments)})},{key:"reachThenClick",value:(O=B(function(a){return _ts_generator(this,function(o){switch(o.label){case 0:return this.node.active=!0,[4,this.reachToPosition(a)];case 1:return o.sent(),[4,this.click()];case 2:return o.sent(),[2]}})}),function(a){return O.apply(this,arguments)})},{key:"reachToPosition",value:(L=B(function(a){var o;return _ts_generator(this,function(C){return o=this,[2,(this.isMoving=!0,em.stopAllByTarget(this.node),new Promise(function(C){Y(o.node).to(.5,{position:new ei(a.x,a.y,1)},{easing:"sineInOut"}).call(function(){o.isMoving=!1,C()}).start()}))]})}),function(a){return L.apply(this,arguments)})},{key:"scaleHandToNormal",value:(E=B(function(){var a;return _ts_generator(this,function(o){if(a=this,this.node.scale!==this.originalHandScale)return[2,new Promise(function(o){Y(a.node).to(.1,{scale:a.originalHandScale}).call(function(){return o()}).start()})];return[2]})}),function(){return E.apply(this,arguments)})},{key:"scaleHandDown",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){Y(a.node).to(.1,{scale:new ei(.8*a.originalHandScale.x,.8*a.originalHandScale.y,1)}).call(function(){return o()}).start()})]})}),function(){return R.apply(this,arguments)})},{key:"click",value:(I=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return this.isMoving=!0,em.stopAllByTarget(this.node),[4,this.scaleHandToNormal()];case 1:return a.sent(),[4,this.scaleHandDown()];case 2:return a.sent(),[4,this.scaleHandToNormal()];case 3:return a.sent(),this.isMoving=!1,[2]}})}),function(){return I.apply(this,arguments)})}]),d}(eo))||edU;U._RF.pop(),U._RF.push({},"2ac00o8bnRJ855hf2Ss28XJ","MiniGame",void 0);var ed4,ed5,ed6,ed7,ed8,ed9,efe,eft,efn=$.ccclass,efi=$.property,efr=(edK=efn("MiniGame"),edY=efi(edV),edj=tj.required,edX=efi(edq),edJ=tj.required,edZ=efi(ed3),edQ=tj.required,edK((ed0=L((ed$=function(P){C(d,P);var I,E,L,F=A(d);function d(){var a;o(this,d);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=F.call.apply(F,[this].concat(A)),O(a,"miniRack",ed0,N(a)),O(a,"miniBoard",ed1,N(a)),O(a,"tutorialHand",ed2,N(a)),a.isClickOkButton=!1,a.isPlaying=!1,a.solution=[],a}return a(d,[{key:"__preload",value:function(){tj.validateRequiredProperties(this,d)}},{key:"initMiniGame",value:(L=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.miniBoard.createMiniBoard()];case 1:return a.sent(),this.tutorialHand.node.setSiblingIndex(1e4),this.initSolution(),[2]}})}),function(){return L.apply(this,arguments)})},{key:"playEndlessly",value:(E=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:if(!!this.isPlaying)return[3,9];return this.isPlaying=!0,[4,this.initMiniGame()];case 1:a.sent(),a.label=2;case 2:if(!this.isPlaying)return[3,6];return[4,this.miniBoard.fadeInMiniGame()];case 3:return a.sent(),[4,this.playTutorial()];case 4:if(a.sent(),this.isClickOkButton)return this.stopPlaying(),[3,6];a.label=5;case 5:return[3,2];case 6:if(this.isClickOkButton)return[3,8];return[4,this.playEndlessly()];case 7:a.sent(),a.label=8;case 8:a.label=9;case 9:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"stopPlaying",value:function(){this.miniRack.clearRack(),this.tutorialHand.returnToRestPosition(),this.miniBoard.stopAllTweenFadeIn();for(var a=0;a<this.solution.length;a++){var o=this.solution[a];o.resetProperties(),o.node.active=!1}this.miniRack.stopAllTween(),this.isPlaying=!1}},{key:"playTutorial",value:(I=B(function(){var a,o,C;return _ts_generator(this,function(A){switch(A.label){case 0:a=0,o=this.solution.length,A.label=1;case 1:if(!(a<o&&!this.isClickOkButton))return[3,8];if(!(C=this.solution[a]))return[3,8];if(this.tutorialHand.isMoving)return[3,6];return[4,this.tutorialHand.reachThenClick(new ei(C.node.position.x,C.node.position.y,1))];case 2:if(A.sent(),a!==o-1)return[3,4];return[4,this.miniRack.handleAddTile(C,this.tutorialHand)];case 3:return A.sent(),[3,5];case 4:this.miniRack.handleAddTile(C,this.tutorialHand),A.label=5;case 5:a++,A.label=6;case 6:A.label=7;case 7:return[3,1];case 8:return this.isPlaying=!1,[2]}})}),function(){return I.apply(this,arguments)})},{key:"initSolution",value:function(){this.solution=[];for(var a,o=this.miniBoard.miniBoardMap.flat(),C=this.fisherYatesShuffle(o),A={},P=0;P<C.length;P++){var I=C[P],B=I.iconIdx;A[B]||(A[B]=[]),A[B].push(I)}for(var E in A)(a=this.solution).push.apply(a,R(A[E]))}},{key:"fisherYatesShuffle",value:function(a){for(var o,C=a.length;0!==C;){o=Math.floor(Math.random()*C),C--;var A=[a[o],a[C]];a[C]=A[0],a[o]=A[1]}return a}}]),d}(eo)).prototype,"miniRack",[edY,edj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed1=L(ed$.prototype,"miniBoard",[edX,edJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed2=L(ed$.prototype,"tutorialHand",[edZ,edQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed$))||ed$);U._RF.pop(),U._RF.push({},"a2b34U88hVA0ZfNWEEw/wxa","ContainerTutorial",void 0);var efa,efo,efs,efl,efu,efc,efh,efp,efd,eff,efy=$.ccclass,efv=$.property,efm=(ed4=efy("ContainerTutorial"),ed5=efv(ef),ed6=tj.required,ed7=efv(efr),ed8=tj.required,ed4((efe=L((ed9=function(P){C(s,P);var I,R=A(s);function s(){var a;o(this,s);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=R.call.apply(R,[this].concat(A)),O(a,"okBtn",efe,N(a)),O(a,"miniGame",eft,N(a)),a}return a(s,[{key:"onClickOkButton",set:function(a){this.okBtn.node.on(ef.EventType.CLICK,a,this)}},{key:"__preload",value:function(){this.okBtn.node.scale=new ei(.7,.7,1),tj.validateRequiredProperties(this,s)}},{key:"toggleElements",value:function(a){this.node.active=a}},{key:"runOkButtonEntranceAnimation",value:(I=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){Y(a.okBtn.node).to(.3,{scale:new ei(1,1,1)},{easing:"backOut"}).start();var C=a.okBtn.node.getComponent(ea);C&&(C.opacity=0,Y(C).to(.3,{opacity:255}).call(function(){return o()}).start())})]})}),function(){return I.apply(this,arguments)})}]),s}(eo)).prototype,"okBtn",[ed5,ed6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eft=L(ed9.prototype,"miniGame",[ed7,ed8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed9))||ed9);U._RF.pop(),U._RF.push({},"90d77xqU/pJ0Z8CwYBMPAIz","TutorialScreen",void 0);var efg=$.ccclass,efb=$.property,efk=GameCore,efw=efk.Events,efS=efk.Utils,efT=globalThis.game.event;efa=efg("TutorialScreen"),efo=efb(efm),efs=tj.required,efl=efb(Bg),efu=tj.required,efc=tj.required,efa((efp=L((efh=function(P){C(g,P);var I,R,E,L,F,D,M,x,z,q=A(g);function g(){var a;o(this,g);for(var C=arguments.length,A=new Array(C),P=0;P<C;P++)A[P]=arguments[P];return a=q.call.apply(q,[this].concat(A)),O(a,"container",efp,N(a)),O(a,"glowDot",efd,N(a)),O(a,"baseScreen",eff,N(a)),a.enableCloseOnTouch=!0,a.handleOpeningScreen=function(o){a.validateEventPayload(o)&&a.updateScreenData(o)},a.handleClosingScreen=function(o){a.validateEventPayload(o)&&a.unscheduleAllCallbacks()},a}return a(g,[{key:"__preload",value:function(){this.listenScreenEvents(),this.registryButtonEvents(),this.baseScreen=this.node.getComponent("BaseScreen"),this.baseScreen.open=this.open.bind(this),this.baseScreen.close=this.close.bind(this),this.container.node.scale=new ei(.5,.5);var a=this.node.getComponent(ea);a&&(a.opacity=0),this.validateRequiredComponents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"start",value:function(){var a=this.container.getComponent(ea);a&&(a.opacity=255)}},{key:"open",value:(z=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.POPUP_SHOW),tF(),this.glowDot.prepareGlow(),[4,this.runEntranceAnimation()];case 1:return a.sent(),this.glowDot.runGlow(),this.container.miniGame.isClickOkButton=!1,this.container.miniGame.playEndlessly(),efT.emit(efw.OPENED_SCREEN,{screenName:this.node.name,screenData:this.baseScreen.data}),efT.emit(tI.OPEN_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return z.apply(this,arguments)})},{key:"close",value:(x=B(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return th.playSound(tZ.POPUP_OFF),tD(1),this.glowDot.stopGlow(),[4,this.runExitAnimation()];case 1:return a.sent(),efT.emit(efw.CLOSED_SCREEN,{screenName:this.node.name}),this.node.active=!1,this.container.miniGame.stopPlaying(),efT.emit(tI.CLOSE_ANIM_FINISHED,{name:this.node.name}),[2]}})}),function(){return x.apply(this,arguments)})},{key:"runExitAnimation",value:(M=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.runScreenExitAnimation(),this.runPopupExitAnimation()])]})}),function(){return M.apply(this,arguments)})},{key:"runScreenExitAnimation",value:(D=B(function(){var a;return _ts_generator(this,function(o){if(a=this.node.getComponent(ea))return[2,new Promise(function(o){Y(a).to(.25,{opacity:0}).call(function(){return o()}).start()})];return[2]})}),function(){return D.apply(this,arguments)})},{key:"runPopupExitAnimation",value:(F=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){Y(a.container.node).to(.3,{scale:new ei(.5,.5,1)},{easing:"backIn"}).call(function(){return o()}).start()})]})}),function(){return F.apply(this,arguments)})},{key:"runEntranceAnimation",value:(L=B(function(){return _ts_generator(this,function(a){return[2,Promise.all([this.runScreenEntranceAnimation(),this.runPopupEntranceAnimation(),this.container.runOkButtonEntranceAnimation()])]})}),function(){return L.apply(this,arguments)})},{key:"runScreenEntranceAnimation",value:(E=B(function(){var a;return _ts_generator(this,function(o){if(a=this.node.getComponent(ea))return[2,new Promise(function(o){Y(a).to(.25,{opacity:255}).call(function(){return o()}).start()})];return[2]})}),function(){return E.apply(this,arguments)})},{key:"runPopupEntranceAnimation",value:(R=B(function(){var a;return _ts_generator(this,function(o){return a=this,[2,new Promise(function(o){var C=a.baseScreen.backgroundMask.getComponent(ea);C&&Y(C).to(.25,{opacity:255}).start(),Y(a.container.node).to(.3,{scale:new ei(1,1,1)},{easing:"backOut"}).call(function(){return o()}).start()})]})}),function(){return R.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){tj.validateRequiredProperties(this,g)}},{key:"listenScreenEvents",value:function(){efT.on(efw.OPENING_SCREEN,this.handleOpeningScreen),efT.on(efw.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){efT.off(efw.OPENING_SCREEN,this.handleOpeningScreen),efT.off(efw.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"registryButtonEvents",value:function(){var a=this;this.container.onClickOkButton=function(){a.handleOkClick()}}},{key:"validateEventPayload",value:function(a){return a.screenName===this.node.name}},{key:"updateScreenData",value:function(a){var o=a.screenData;efS.Valid.isObject(o)&&(o.duration&&o.duration>0&&this.scheduleOnce(function(){t_.closeScreen(tP.TUTORIAL_SCREEN)},o.duration),!1===o.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0)}},{key:"handleOkClick",value:(I=B(function(){var a,o,C,A;return _ts_generator(this,function(P){switch(P.label){case 0:return C=(o=(a=td.gameScene).gamePlay).tileManager,A=o.gameUI,a.toggleBlockInputContainer(!0),this.container.miniGame.isClickOkButton=!0,[4,Promise.all([t_.closeScreenAsync(tP.TUTORIAL_SCREEN),A.header.showButtonsAsync(),a.rubyBarComp.runShowAnimationAsync()])];case 1:return P.sent(),a.toggleBlockInputContainer(!1),C.setUpTutorialHand(),[2]}})}),function(){return I.apply(this,arguments)})}]),g}(eo)).prototype,"container",[efo,efs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),efd=L(efh.prototype,"glowDot",[efl,efu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eff=L(efh.prototype,"baseScreen",[efc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),efh)),U._RF.pop(),U._RF.push({},"ca600QzdYZDSLmGmfSVyz4h","AnimAbortSignal",void 0),GameCore.Utils.Array,U._RF.pop(),U._RF.push({},"2899eBXHXtEQpMgQSUqXvPv","CacheUtils",void 0);var efC=GameCore.Utils.Image,efA=globalThis.game.frameCapture,ef_=function(){var C,A,P;function n(){o(this,n)}return a(n,null,[{key:"inst",get:function(){return this._instance||(this._instance=new n),this._instance}},{key:"getPlayerAvatar",value:(P=B(function(a,o,C,A){var P;return _ts_generator(this,function(I){switch(I.label){case 0:if(P=this.playerAvatarCache.get("".concat(o,":").concat(C)))return[3,2];return[4,this.loadPlayerAvatar(a,o,C,A)];case 1:P=I.sent(),I.label=2;case 2:return[2,P]}})}),function(a,o,C,A){return P.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(A=B(function(a,o,C,A){var P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return[4,this.loadImage(a,C,C,"".concat(o,":").concat(C))];case 1:if(P=B.sent(),(null==A||!A.aborted)&&P)return I=et.createWithImage(P),[2,(this.playerAvatarCache.set("".concat(o,":").concat(C),I),I)];return[2]}})}),function(a,o,C,P){return A.apply(this,arguments)})},{key:"isAvatarCached",value:function(a,o){return this.playerAvatarCache.has("".concat(a,":").concat(o))}},{key:"loadImage",value:(C=B(function(a,o,C,A){var P,I;return _ts_generator(this,function(B){switch(B.label){case 0:return B.trys.push([0,5,,6]),[4,efA.captureAsync({width:o,height:C,name:"LeaderAvatar",renderOptions:x({},A,{name:A,type:"image",depth:0,position:[0,0],size:[o,C],image:a})})];case 1:if(!(P=B.sent()))return[3,3];return[4,efC.loadImage(P)];case 2:return I=B.sent(),[3,4];case 3:I=null,B.label=4;case 4:return[2,I];case 5:return B.sent(),[2,null];case 6:return[2]}})}),function(a,o,A,P){return C.apply(this,arguments)})}]),n}();ef_._instance=void 0,ef_.playerAvatarCache=new Map;try{new ef_}catch(a){}U._RF.pop(),U._RF.push({},"88f2b4WH6NBlaGD7WvCOA2j","VibrateUtils",void 0),GameCore.Utils.Browser,globalThis.game.player,U._RF.pop()}}}),function(a){a("virtual:///prerequisite-imports/main","chunks:///main.js")}(function(a,o){System.register(a,[o],function(a,o){return{setters:[function(o){var C={};for(var A in o)if("default"!==A&&"__esModule"!==A)C[A]=o[A];a(C)}],execute:function(){}}})});