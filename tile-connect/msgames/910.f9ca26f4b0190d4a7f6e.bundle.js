"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[910],{593:function(e,t,r){r.r(t),r.d(t,{default:function(){return K}});var n=r(88),a=r(39),u=r(58),o=r.n(u),i=r(78),s=r.n(i),c=r(77),p=r.n(c),l=r(182),d=r.n(l),f=r(76),h=r.n(f),m=r(582),v=r(179),b=r(180),w=r.n(b),x=r(184),y=r.n(x),k=r(408),g=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).name="BadRequest",n.message=t||"This request is bad",n.payload=r,n}return(0,a.Z)(t,e),t}((0,k.Z)(Error)),T=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).name="RequestTimeout",n.message=t||"This request is timeout",n.payload=r,n}return(0,a.Z)(t,e),t}((0,k.Z)(Error)),I=r(407),Z=GameCore.Configs,C=Z.AppId,S=Z.Network,P=function(e){if(!e.ok)throw new g(null,{response:e})},j=function(){var e=window.game.auth.getToken();return{token:e,timeout:S.Timeout,headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}}},A=function(e,t,r,a){return(0,n.Z)(o().mark((function n(){var u,i,c,p,l;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,u=e+"/apps/"+C+"/"+t,i=new AbortController,r.signal=i.signal,c=setTimeout((function(){i.abort()}),r.timeout),GameCore.Utils.Valid.isObject(a)&&(r.body=s()(a)),n.next=8,fetch(u,r);case 8:return p=n.sent,clearTimeout(c),P(p),n.next=13,p.json();case 13:if(n.t0=n.sent,n.t0){n.next=16;break}n.t0={};case 16:return l=n.t0,n.abrupt("return",l);case 20:if(n.prev=20,n.t1=n.catch(0),!(n.t1 instanceof g)){n.next=24;break}return n.abrupt("return",null);case 24:if(!(n.t1 instanceof Object&&GameCore.Utils.Object.hasOwn(n.t1,"name"))){n.next=27;break}if("AbortError"!==n.t1.name){n.next=27;break}throw new T(null);case 27:throw n.t1;case 28:case"end":return n.stop()}}),n,null,[[0,20]])})))},D=function(){var e=(0,n.Z)(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",t());case 4:if(e.prev=4,e.t0=e.catch(0),!(e.t0 instanceof T&&r>0)){e.next=18;break}return e.prev=7,e.next=10,(0,I.qZ)(600);case 10:return e.next=12,D(t,r-1);case 12:return e.abrupt("return",e.sent);case 15:return e.prev=15,e.t1=e.catch(7),e.abrupt("return",{});case 18:if(!(e.t0 instanceof T)){e.next=20;break}return e.abrupt("return",{});case 20:return console.warn(e.t0),e.abrupt("return",{});case 22:case"end":return e.stop()}}),e,null,[[0,4],[7,15]])})));return function(t,r){return e.apply(this,arguments)}}(),O=function(){var e=(0,n.Z)(o().mark((function e(t,r,n,a){var u,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),void 0===a&&(a=S.Retries),e.prev=2,u=(0,v.Z)({},j(),r,{method:"GET"}),i=A(n,t,u),e.next=7,D(i,a);case 7:return e.abrupt("return",e.sent);case 10:return e.prev=10,e.t0=e.catch(2),console.warn(e.t0),e.abrupt("return",{});case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),M=function(){var e=(0,n.Z)(o().mark((function e(t,r,n,a,u){var i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),void 0===u&&(u=S.Retries),e.prev=2,i=(0,v.Z)({},j(),n,{method:"POST"}),s=A(a,t,i,r),e.next=7,D(s,u);case 7:return e.abrupt("return",e.sent);case 10:return e.prev=10,e.t0=e.catch(2),console.warn(e.t0),e.abrupt("return",{});case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,r,n,a,u){return e.apply(this,arguments)}}(),E=GameCore.Configs,G=E.AppId,N=E.OtherHost,R=E.LeadersBoard,_=(function(){var e=(0,n.Z)(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={appId:G,resetScore:0,numberOfLeaders:15,timezone:"utc+0",sortOrder:"desc",statistics:"max",resettable:"manually",description:"no description"},!R.UseMock){e.next=5;break}return e.next=4,(0,I.qZ)(1e3);case 4:return e.abrupt("return",(0,v.Z)({},r,t,{_id:R.LeaderboardId,type:"app_leaderboard",description:"mockup_leaderboard",createdAt:new Date(Date.now()).toISOString(),updatedAt:new Date(Date.now()).toISOString()}));case 5:return"leaderboards",e.next=8,M("leaderboards",(0,v.Z)({},r,t),{},N);case 8:return n=e.sent,e.abrupt("return",(null==n?void 0:n.data)||{});case 10:case"end":return e.stop()}}),e)})))}(),function(){var e=(0,n.Z)(o().mark((function e(t,r){var n,a,u,i,s,c,p,l,d,f,h,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r={}),n=[],!R.UseMock){e.next=7;break}return e.next=5,(0,I.qZ)(1e3);case 5:return s=(i=r).limit,c=void 0===s?10:s,p=i.offset,l=void 0===p?0:p,e.abrupt("return",w()(a=y()(u=new Array(c)).call(u,null)).call(a,(function(e,t){var r=(t+1)*(l+1),n=R.MockOptions.PlayerEntryIndex===t,a={playerId:"player-0"+r,name:"MPlayer "+r,photo:"./assets/images/others/avatar.jpg",rank:r,score:Math.floor(1e5/r+1e4*Math.random())};if(n){var u=window.game.player.getPlayer(),o=u.playerId,i=u.name,s=u.photo;a.playerId=o,a.name=i,a.photo=s}return a})));case 7:return d=GameCore.Utils.String.params(r),f="leaderboards/"+t+"/leaders",e.next=11,O(f+"?"+d,{},N);case 11:if((h=e.sent)&&(null==h||!h.error)){e.next=14;break}throw new Error((null==h?void 0:h.error)||"Leaderboard not found");case 14:if(!((m=(null==h?void 0:h.data)||[]).length<1)){e.next=17;break}return e.abrupt("return",n);case 17:return n=m,e.abrupt("return",n);case 19:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),q=(function(){var e=(0,n.Z)(o().mark((function e(t,r,n){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M("leaderboards/"+t+"/players/"+r,{score:n},{},N);case 2:return a=e.sent,e.abrupt("return",(null==a?void 0:a.data)||{});case 4:case"end":return e.stop()}}),e)})))}(),function(){var e=(0,n.Z)(o().mark((function e(t,r){var n,a,u,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,t){e.next=3;break}return e.abrupt("return",n);case 3:if(a=R.Prefix+"/"+r+"/players"){e.next=6;break}return e.abrupt("return",n);case 6:return u=GameCore.Utils.String.params({playerIds:t}),e.next=9,O(a+"?"+u,{},N);case 9:if(i=e.sent,!((s=(null==i?void 0:i.data)||[]).length<1)){e.next=13;break}return e.abrupt("return",n);case 13:return n=s[0],e.abrupt("return",n);case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),F=r(597),L=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).name="SameContext",n.message=t||"The game attempted to perform a context switch into the current context.",n.code="SAME_CONTEXT",n.payload=r,n}return(0,a.Z)(t,e),t}((0,k.Z)(Error)),U=GameCore.Configs,B=U.LeadersBoard,V=U.Tournament,Y=B.LeaderboardId,z=B.Limit,J=V.YourMockTournamentCount,H=function(){function e(e){this.id=void 0,this.title=void 0,this.contextId=void 0,this.payload=void 0,this.endTime=void 0,this.initialScore=void 0,this.id=e,this.title=this.id+"'s Tournament",this.contextId="000-"+this.id,this.initialScore=0,this.payload=s()({playerId:"1213456",playerName:"Player",leaderboardId:Y});var t=e>7?7:e;this.endTime=Math.round((Date.now()+864e5*t)/1e3)}var t=e.prototype;return t.getID=function(){return this.id},t.getTitle=function(){return this.title},t.getPayload=function(){return this.payload},t.getEndTime=function(){return this.endTime},t.getContextID=function(){return this.contextId},t.getInitialScore=function(){return this.initialScore},t.setCreatePayload=function(e){var t=e.initialScore,r=e.config,n=e.data;this.initialScore=t,r&&(this.title=r.tournamentTitle),n&&(this.payload=s()(n))},e}(),X=function(e){function t(){var t,r;(r=e.call(this)||this).tournaments=void 0,r.tournamentData=void 0;var n=new H(1);return r.tournaments=[n],r.tournamentData=((t={})[1..toString()]=n,t),r.createYourMockTournaments(),r}(0,a.Z)(t,e);var r=t.prototype;return r.createAsync=function(){var e=(0,n.Z)(o().mark((function e(t){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new(p())((function(e){var n=r.tournaments.length+1,a=new H(n);a.setCreatePayload(t),r.tournaments.push(a),r.tournamentData[n]=a,e(a)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.shareAsync=function(){var e=(0,n.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new(p())((function(e){return e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.joinAsync=function(){var e=(0,n.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t in this.tournamentData){e.next=3;break}return e.abrupt("return",this.getPromiseRejectTournamentNotFound());case 3:if(r=this.tournamentData[t],r.getContextID()!==FBInstant.context.getID()){e.next=7;break}return e.abrupt("return",p().reject(new L(null)));case 7:return e.prev=7,e.next=10,this.validateTournament(r);case 10:return e.next=12,GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0);case 12:return e.next=14,FBInstant.context.switchAsync(t);case 14:e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(7),e.abrupt("return",p().reject(e.t0));case 19:return e.abrupt("return",p().resolve());case 20:case"end":return e.stop()}}),e,this,[[7,16]])})));return function(t){return e.apply(this,arguments)}}(),r.validateTournament=function(){var e=(0,n.Z)(o().mark((function e(t){var r,n,a,u,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.getPayload(),n=JSON.parse(r),a=n.leaderboardId,u=[],e.prev=3,e.next=6,_(a,{limit:z});case 6:u=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",p().reject(e.t0));case 12:if(0!==u.length){e.next=14;break}return e.abrupt("return",this.getPromiseRejectTournamentNotFound());case 14:if(i=window.game.player.getPlayerId(),d()(u).call(u,(function(e){return e.playerId===i}))){e.next=18;break}return e.abrupt("return",this.getPromiseRejectTournamentNotFound());case 18:return s=null,e.prev=19,e.next=22,q(i,a);case 22:s=e.sent,e.next=28;break;case 25:return e.prev=25,e.t1=e.catch(19),e.abrupt("return",p().reject(e.t1));case 28:if(s){e.next=30;break}return e.abrupt("return",this.getPromiseRejectTournamentNotFound());case 30:return e.abrupt("return",p().resolve());case 31:case"end":return e.stop()}}),e,this,[[3,9],[19,25]])})));return function(t){return e.apply(this,arguments)}}(),r.getPromiseRejectTournamentNotFound=function(){return p().reject(new F.Z(null))},r.postScoreAsync=function(){var e=(0,n.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p().resolve());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.getTournamentsAsync=function(){var e=(0,n.Z)(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h()(t=[]).call(t,this.tournaments),e.abrupt("return",r);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.createYourMockTournaments=function(){for(var e=window.game.player.getPlayer(),t=e.playerId,r=e.name,n=0;n<J;n++){var a=1+n+1,u=new H(a);u.setCreatePayload({initialScore:0,config:{tournamentTitle:r+" 's Tournament"},data:{playerId:t,playerName:r,leaderboardId:Y}}),this.tournaments.push(u),this.tournamentData[a]=u}},t}(m.J),K=X}}]);