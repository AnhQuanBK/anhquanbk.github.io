"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[307],{620:function(e,t,r){r.r(t),r.d(t,{default:function(){return R}});var n=r(82),a=r(36),u=r(54),o=r.n(u),i=r(55),s=r.n(i),c=r(84),p=r.n(c),d=r(192),l=r.n(d),f=r(83),h=r.n(f),m=r(608),v=r(120),b=r(123),y=r.n(b),x=r(194),w=r.n(x),g=r(609),k=r(190),I=GameCore.Configs,A=I.AppId,T=I.OtherHost,S=I.LeadersBoard,C=(function(){var e=(0,n.A)(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={appId:A,resetScore:0,numberOfLeaders:15,timezone:"utc+0",sortOrder:"desc",statistics:"max",resettable:"manually",description:"no description"},!S.UseMock){e.next=5;break}return e.next=4,(0,k.QN)(1e3);case 4:return e.abrupt("return",(0,v.A)({},r,t,{_id:S.LeaderboardId,type:"app_leaderboard",description:"mockup_leaderboard",createdAt:new Date(Date.now()).toISOString(),updatedAt:new Date(Date.now()).toISOString()}));case 5:return e.next=8,(0,g.b)("leaderboards",(0,v.A)({},r,t),{},T);case 8:return n=e.sent,e.abrupt("return",(null==n?void 0:n.data)||{});case 10:case"end":return e.stop()}}),e)})))}(),function(){var e=(0,n.A)(o().mark((function e(t,r){var n,a,u,i,s,c,p,d,l,f,h,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r={}),n=[],!S.UseMock){e.next=7;break}return e.next=5,(0,k.QN)(1e3);case 5:return s=(i=r).limit,c=void 0===s?10:s,p=i.offset,d=void 0===p?0:p,e.abrupt("return",y()(a=w()(u=new Array(c)).call(u,null)).call(a,(function(e,t){var r=(t+1)*(d+1),n=S.MockOptions.PlayerEntryIndex===t,a={playerId:"player-0"+r,name:"MPlayer "+r,photo:"./assets/images/others/avatar.jpg",rank:r,score:Math.floor(1e5/r+1e4*Math.random())};if(n){var u=window.game.player.getPlayer(),o=u.playerId,i=u.name,s=u.photo;a.playerId=o,a.name=i,a.photo=s}return a})));case 7:return l=GameCore.Utils.String.params(r),f="leaderboards/"+t+"/leaders",e.next=11,(0,g.J)(f+"?"+l,{},T);case 11:if((h=e.sent)&&(null==h||!h.error)){e.next=14;break}throw new Error((null==h?void 0:h.error)||"Leaderboard not found");case 14:if(!((m=(null==h?void 0:h.data)||[]).length<1)){e.next=17;break}return e.abrupt("return",n);case 17:return n=m,e.abrupt("return",n);case 19:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),P=(function(){var e=(0,n.A)(o().mark((function e(t,r,n){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,g.b)("leaderboards/"+t+"/players/"+r,{score:n},{},T);case 2:return a=e.sent,e.abrupt("return",(null==a?void 0:a.data)||{});case 4:case"end":return e.stop()}}),e)})))}(),function(){var e=(0,n.A)(o().mark((function e(t,r){var n,a,u,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,t){e.next=3;break}return e.abrupt("return",n);case 3:if(a=S.Prefix+"/"+r+"/players"){e.next=6;break}return e.abrupt("return",n);case 6:return u=GameCore.Utils.String.params({playerIds:t}),e.next=9,(0,g.J)(a+"?"+u,{},T);case 9:if(i=e.sent,!((s=(null==i?void 0:i.data)||[]).length<1)){e.next=13;break}return e.abrupt("return",n);case 13:return n=s[0],e.abrupt("return",n);case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),D=r(624),j=function(e){function t(t,r){var n;return(n=e.call(this,t,r)||this).name="SameContext",n.message=t||"The game attempted to perform a context switch into the current context.",n.code="SAME_CONTEXT",n.payload=r,n}return(0,a.A)(t,e),t}((0,r(121).A)(Error)),M=GameCore.Configs,N=M.LeadersBoard,O=M.Tournament,_=N.LeaderboardId,F=N.Limit,L=O.YourMockTournamentCount,E=function(){function e(e){this.id=void 0,this.title=void 0,this.contextId=void 0,this.payload=void 0,this.endTime=void 0,this.initialScore=void 0,this.id=e,this.title=this.id+"'s Tournament",this.contextId="000-"+this.id,this.initialScore=0,this.payload=s()({playerId:"1213456",playerName:"Player",leaderboardId:_});var t=e>7?7:e;this.endTime=Math.round((Date.now()+864e5*t)/1e3)}var t=e.prototype;return t.getID=function(){return this.id},t.getTitle=function(){return this.title},t.getPayload=function(){return this.payload},t.getEndTime=function(){return this.endTime},t.getContextID=function(){return this.contextId},t.getInitialScore=function(){return this.initialScore},t.setCreatePayload=function(e){var t=e.initialScore,r=e.config,n=e.data;this.initialScore=t,r&&(this.title=r.tournamentTitle),n&&(this.payload=s()(n))},e}(),G=function(e){function t(){var t,r;(r=e.call(this)||this).tournaments=void 0,r.tournamentData=void 0;var n=new E(1);return r.tournaments=[n],r.tournamentData=((t={})[1..toString()]=n,t),r.createYourMockTournaments(),r}(0,a.A)(t,e);var r=t.prototype;return r.createAsync=function(){var e=(0,n.A)(o().mark((function e(t){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new(p())((function(e){var n=r.tournaments.length+1,a=new E(n);a.setCreatePayload(t),r.tournaments.push(a),r.tournamentData[n]=a,e(a)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.shareAsync=function(){var e=(0,n.A)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new(p())((function(e){return e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.joinAsync=function(){var e=(0,n.A)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t in this.tournamentData){e.next=3;break}return e.abrupt("return",this.getPromiseRejectTournamentNotFound());case 3:if(r=this.tournamentData[t],r.getContextID()!==FBInstant.context.getID()){e.next=7;break}return e.abrupt("return",p().reject(new j(null)));case 7:return e.prev=7,e.next=10,this.validateTournament(r);case 10:return e.next=12,GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0);case 12:return e.next=14,FBInstant.context.switchAsync(t);case 14:e.next=19;break;case 16:return e.prev=16,e.t0=e.catch(7),e.abrupt("return",p().reject(e.t0));case 19:return e.abrupt("return",p().resolve());case 20:case"end":return e.stop()}}),e,this,[[7,16]])})));return function(t){return e.apply(this,arguments)}}(),r.validateTournament=function(){var e=(0,n.A)(o().mark((function e(t){var r,n,a,u,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.getPayload(),n=JSON.parse(r),a=n.leaderboardId,u=[],e.prev=3,e.next=6,C(a,{limit:F});case 6:u=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",p().reject(e.t0));case 12:if(0!==u.length){e.next=14;break}return e.abrupt("return",this.getPromiseRejectTournamentNotFound());case 14:if(i=window.game.player.getPlayerId(),l()(u).call(u,(function(e){return e.playerId===i}))){e.next=18;break}return e.abrupt("return",this.getPromiseRejectTournamentNotFound());case 18:return s=null,e.prev=19,e.next=22,P(i,a);case 22:s=e.sent,e.next=28;break;case 25:return e.prev=25,e.t1=e.catch(19),e.abrupt("return",p().reject(e.t1));case 28:if(s){e.next=30;break}return e.abrupt("return",this.getPromiseRejectTournamentNotFound());case 30:return e.abrupt("return",p().resolve());case 31:case"end":return e.stop()}}),e,this,[[3,9],[19,25]])})));return function(t){return e.apply(this,arguments)}}(),r.getPromiseRejectTournamentNotFound=function(){return p().reject(new D.A(null))},r.postScoreAsync=function(){var e=(0,n.A)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p().resolve());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.getTournamentsAsync=function(){var e=(0,n.A)(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h()(t=[]).call(t,this.tournaments),e.abrupt("return",r);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.createYourMockTournaments=function(){for(var e=window.game.player.getPlayer(),t=e.playerId,r=e.name,n=0;n<L;n++){var a=1+n+1,u=new E(a);u.setCreatePayload({initialScore:0,config:{tournamentTitle:r+" 's Tournament"},data:{playerId:t,playerName:r,leaderboardId:_}}),this.tournaments.push(u),this.tournamentData[a]=u}},t}(m.o),R=G}}]);