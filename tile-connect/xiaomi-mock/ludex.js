import{a as ge}from"./chunks-KEX3JHX6.js";import{a as rt,b as I,c as L,d as va,f as Gr,g as Br,h as Ur,i as W,j as n,k as jr,l as o,m as l,n as c,o as d,p as h,q as u,r as j,s as ee,v as Da,w as Ia,x as p,y}from"./chunks-YRGLJTH6.js";var Hr=Gr((e,t)=>{"use strict";n(),o(),l(),c(),d(),h(),u(),y(),p();var a=Object.prototype.hasOwnProperty,s="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(s=!1));function i(w,A,v){this.fn=w,this.context=A,this.once=v||!1}function f(w,A,v,x,S){if(typeof v!="function")throw new TypeError("The listener must be a function");var P=new i(v,x||w,S),C=s?s+A:A;return w._events[C]?w._events[C].fn?w._events[C]=[w._events[C],P]:w._events[C].push(P):(w._events[C]=P,w._eventsCount++),w}function g(w,A){--w._eventsCount===0?w._events=new r:delete w._events[A]}function m(){this._events=new r,this._eventsCount=0}m.prototype.eventNames=function(){var w=[],A,v;if(this._eventsCount===0)return w;for(v in A=this._events)a.call(A,v)&&w.push(s?v.slice(1):v);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(A)):w},m.prototype.listeners=function(w){var A=s?s+w:w,v=this._events[A];if(!v)return[];if(v.fn)return[v.fn];for(var x=0,S=v.length,P=new Array(S);x<S;x++)P[x]=v[x].fn;return P},m.prototype.listenerCount=function(w){var A=s?s+w:w,v=this._events[A];return v?v.fn?1:v.length:0},m.prototype.emit=function(w,A,v,x,S,P){var C=s?s+w:w;if(!this._events[C])return!1;var E=this._events[C],oe=arguments.length,xe,T;if(E.fn){switch(E.once&&this.removeListener(w,E.fn,void 0,!0),oe){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,A),!0;case 3:return E.fn.call(E.context,A,v),!0;case 4:return E.fn.call(E.context,A,v,x),!0;case 5:return E.fn.call(E.context,A,v,x,S),!0;case 6:return E.fn.call(E.context,A,v,x,S,P),!0}for(T=1,xe=new Array(oe-1);T<oe;T++)xe[T-1]=arguments[T];E.fn.apply(E.context,xe)}else{var kr=E.length,He;for(T=0;T<kr;T++)switch(E[T].once&&this.removeListener(w,E[T].fn,void 0,!0),oe){case 1:E[T].fn.call(E[T].context);break;case 2:E[T].fn.call(E[T].context,A);break;case 3:E[T].fn.call(E[T].context,A,v);break;case 4:E[T].fn.call(E[T].context,A,v,x);break;default:if(!xe)for(He=1,xe=new Array(oe-1);He<oe;He++)xe[He-1]=arguments[He];E[T].fn.apply(E[T].context,xe)}}return!0},m.prototype.on=function(w,A,v){return f(this,w,A,v,!1)},m.prototype.once=function(w,A,v){return f(this,w,A,v,!0)},m.prototype.removeListener=function(w,A,v,x){var S=s?s+w:w;if(!this._events[S])return this;if(!A)return g(this,S),this;var P=this._events[S];if(P.fn)P.fn===A&&(!x||P.once)&&(!v||P.context===v)&&g(this,S);else{for(var C=0,E=[],oe=P.length;C<oe;C++)(P[C].fn!==A||x&&!P[C].once||v&&P[C].context!==v)&&E.push(P[C]);E.length?this._events[S]=E.length===1?E[0]:E:g(this,S)}return this},m.prototype.removeAllListeners=function(w){var A;return w?(A=s?s+w:w,this._events[A]&&g(this,A)):(this._events=new r,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prefixed=s,m.EventEmitter=m,typeof t<"u"&&(t.exports=m)});n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var xa=(e=>(e.DRAFT="draft",e.SINGLE="single",e.TOURNAMENT="tournament",e.MATCHING_GROUP="matching-group",e.CHALLENGE_FRIEND="challenge-friend",e))(xa||{}),z=xa,$r=z,Sa=$r;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Vr=e=>e,Kr=Vr;n(),o(),l(),c(),d(),h(),u(),y(),p();var Wr=()=>{},zr=Wr,qr={asConst:Kr,noop:zr};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Yr=(e,t)=>{if(e)return t<0?e[e.length+t]:e[t]},Jr=Yr;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Qr=(e,t)=>{let a=[];for(let s=0;s<e;s++)a.push(t(s));return a},Ea=Qr,Xr=e=>Ea(e,()=>{}),bt=Xr,Zr=(e,t)=>{let a=Math.ceil(e.length/t);return bt(a).map((s,r)=>e.slice(r*t,r*t+t))},ei=Zr;n(),o(),l(),c(),d(),h(),u(),y(),p();var ti=(e,t)=>e.filter(a=>t.indexOf(a)<0),ai=ti;n(),o(),l(),c(),d(),h(),u(),y(),p();var si=e=>e.reduce((t,a)=>t.concat(a),[]),ri=si;n(),o(),l(),c(),d(),h(),u(),y(),p();var ii=(e,t)=>e.indexOf(t)>=0,ni=ii;n(),o(),l(),c(),d(),h(),u(),y(),p();var oi=(e,t)=>e.slice(0,t),li=oi;n(),o(),l(),c(),d(),h(),u(),y(),p();var ci=(e,t)=>{for(let a=0;a<e.length;a++)if(t(e[a],a))return e[a]},Pa=ci;n(),o(),l(),c(),d(),h(),u(),y(),p();var di=(e,t)=>{for(let a=0;a<e.length;a++)if(t(e[a],a))return a;return-1},ba=di;n(),o(),l(),c(),d(),h(),u(),y(),p();var hi=e=>{for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}},La=hi;n(),o(),l(),c(),d(),h(),u(),y(),p();var ui=e=>{let t=[...e];return La(t),t},pi=ui;n(),o(),l(),c(),d(),h(),u(),y(),p();var yi=(e,t,a)=>a.indexOf(e)===t&&e!==null&&e!==void 0,fi=e=>e.filter(yi),gi=fi,mi={at:Jr,chunk:ei,difference:ai,fillWith:Ea,length:bt,limit:li,search:Pa,searchIndex:ba,has:ni,shuffle:La,toShuffled:pi,unique:gi,flatten:ri};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var wi=()=>"OffscreenCanvas"in window&&typeof OffscreenCanvas<"u",Ai=(e,t)=>{let a=new OffscreenCanvas(0,0),s=a.getContext(e,t);return s?{canvas:a,context:s}:null},vi=(e,t)=>{let a=document.createElement("canvas"),s=a.getContext(e,t);return s?{canvas:a,context:s}:null},Di=e=>{let{contextType:t="2d",contextAttributes:a={},type:s="auto"}=e,r=null;return s!=="canvas"&&wi()&&(r=Ai(t,a)),!r&&s!=="offscreen"&&(r=vi(t,a)),r},Lt=Di;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Ii=e=>!e||e===""||e===0||typeof e=="number"&&isNaN(e),Ca=Ii,xi=e=>Ca(e)?e!==!1&&e!==0:typeof e=="string"||Array.isArray(e)?e.length===0:typeof e=="object"&&e!==null?Object.keys(e).length===0:!1,Ct=xi,Na="Tile Connect",Nt={},Ta=e=>Ct(e)?GameSDK.getSDKName()??"Storage":e??"Storage",Si=e=>{let t=`${Na}_${e}`;return Nt[t]?Promise.resolve(Nt[t]):new Promise((a,s)=>{let r=1,i,f=g=>{i=indexedDB.open(Na,g),i.onerror=m=>{let w=m.target.error;w?.name==="VersionError"?(r++,f(r)):s(w)},i.onsuccess=m=>{let w=i.result;Nt[t]=w,a(w)},i.onupgradeneeded=m=>{let w=m.target.result;r=w.version,w.objectStoreNames.contains(e)||w.createObjectStore(e)}};f(r)})},Oa=Si,Ei=async(e,t)=>{try{let a=Ta(t),s=await Oa(a);if(!s.objectStoreNames.contains(a))return{};let r=s.transaction(a,"readonly").objectStore(a);return new Promise((i,f)=>{let g=r.get(e);g.onerror=()=>f(g.error),g.onsuccess=()=>i(g.result)})}catch{return{}}},Pi=Ei;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var bi=e=>{try{return JSON.parse(e)}catch{return null}},Tt=bi,Li=e=>{try{let t=localStorage.getItem(e);return t===null?null:Tt(t)}catch{return null}},_a=Li;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Ci=e=>{try{return JSON.stringify(e,null,0)}catch{return""}},Ot=Ci,Ni=e=>Tt(Ot(e)),Ra=Ni,Ti=()=>{let e="en_US",t=Ra(window.navigator.languages)||[],a=Pa(t,s=>s.indexOf("-")>-1);return!a||a.indexOf("-")===-1?e:a.replace("-","_")},Oi=Ti;n(),o(),l(),c(),d(),h(),u(),y(),p();var _i=()=>{let e=window.location.search.substring(1);if(!e)return{};let t=e.split("&"),a={};for(let s of t){let r=s.split("=");a[r[0]]=decodeURIComponent(r[1])}return a},Ri=_i;n(),o(),l(),c(),d(),h(),u(),y(),p();var Mi=()=>{let{body:e,documentElement:t}=document,{clientHeight:a}=e,{clientHeight:s}=t;return Math.max(s,a)||0},Fi=Mi;n(),o(),l(),c(),d(),h(),u(),y(),p();var ki=()=>{let{body:e,documentElement:t}=document,{clientWidth:a}=e,{clientWidth:s}=t;return Math.max(s,a)||0},Gi=ki;n(),o(),l(),c(),d(),h(),u(),y(),p();var Bi=e=>{localStorage.removeItem(e)},Ui=Bi;n(),o(),l(),c(),d(),h(),u(),y(),p();var ji=async(e,t,a)=>{try{if(Ct(t))return;let s=Ta(a),r=await Oa(s);if(!r.objectStoreNames.contains(s))return;let i=r.transaction(s,"readwrite").objectStore(s);return new Promise((f,g)=>{try{let m=i.put(t,e);m.onsuccess=()=>f(),m.onerror=()=>g(m.error)}catch(m){g(m)}})}catch{}},Hi=ji;n(),o(),l(),c(),d(),h(),u(),y(),p();var $i=()=>{let e="vibrate"in window.navigator;if(e)try{window.navigator.vibrate(0)}catch{return!1}return e},Vi=e=>{try{return $i()?(window.navigator.vibrate(0),window.navigator.vibrate(e),!0):!1}catch{return!1}},Ki=Vi;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Wi=(e,t,a)=>{let s,r=!1;return function(...i){if(a&&!r){r=!0,e.apply(this,i);return}clearTimeout(s),s=setTimeout(()=>{e.apply(this,i)},t)}},_t=Wi;n(),o(),l(),c(),d(),h(),u(),y(),p();var zi=e=>{let t=Object.create(null);return function(...a){let s=`__memoize__${JSON.stringify(a)}`;if(s in t)return t[s];let r=e.apply(this,a);return t[s]=r,r}},Se=zi;n(),o(),l(),c(),d(),h(),u(),y(),p();var qi=(e,t,a)=>{let s,r=!1,i=!1;return function(...f){if(a&&!i){i=!0,e.apply(this,f);return}r&&(r=!1,e.apply(this,f)),clearTimeout(s),s=setTimeout(()=>{r=!0},t)}},Rt=qi;n(),o(),l(),c(),d(),h(),u(),y(),p();var Yi=(e,t)=>{let a=e.value;return e.value=async function(...s){await t.apply(this,s);let r=a.apply(this,s);return r instanceof Promise?await r:r},e},Ji=Yi;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Qi=e=>{if(e instanceof Error)return e;if(e!==null&&typeof e=="object"&&"message"in e&&typeof e.message=="string"){let t=new Error(e.message);return"stack"in e&&typeof e.stack=="string"&&(t.stack=e.stack),"name"in e&&typeof e.name=="string"&&(t.name=e.name),"code"in e&&typeof e.code=="string"&&Object.assign(t,{code:e.code}),t}if(e!==null&&typeof e=="object")try{return new Error(JSON.stringify(e,null,2))}catch{return new Error(`[Object conversion failed] ${String(e)}`)}return new Error(String(e))},Mt=Qi,Xi=(e,t)=>{let a=e.value;return e.value=async function(...s){let r;try{let i=a.apply(this,s);return i instanceof Promise?await i:i}catch(i){r=Mt(i)}finally{t?.(r)}},e},Zi=Xi;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var en=e=>{let t=typeof e=="object"||typeof e=="function",a=Array.isArray(e);return e!==null&&t&&!a},M=en,Ma=(e,t)=>{if(typeof e!==t)throw new Error(`Value ${e} is not type of ${t} (${typeof e})`)},tn=(e,t,a)=>{let s;return a||Ma(e,t),!M(e)||!a?e:Object.defineProperty(e,a,{get(){return s},set(r){Ma(r,t),s=r}})},Ft=tn,an=(e,t)=>{let a=e.value;return e.value=function(...s){return t.forEach((r,i)=>{try{Ft(s[i],r)}catch(f){let g="[Decorator:validateParams]";throw f instanceof Error?(f.message=`${g}: ${f.message}`,f):new Error(`${g}: ${f}`)}}),a.apply(this,s)},e},sn=an;n(),o(),l(),c(),d(),h(),u(),y(),p();var rn=(e,t)=>{for(let a of t)try{return Ft(e,a),!1}catch{}return!0},nn=(e,t)=>{let a=e.value;return e.value=function(...s){let r=a.apply(this,s);if(rn(r,t))throw new Error(`[Decorator:validateReturn] ${r} (${typeof r}) is not type of ${t.join(" | ")}`);return r},e},on=nn,ln=class fe{static isProperty(t,a,s){return!!(s&&(typeof s.value<"u"||s.get||s.set))}static isFunction(t,a,s){return!!(s&&(typeof s.value=="function"||typeof s.initializer=="function"))}static trace=(t,a,s)=>{try{let{value:r,initializer:i,get:f,set:g}=s??{};try{if(!(f||g)){if(typeof r!="function"){if(typeof i=="function"){let m=i?.();if(typeof m!="function"){if(!(typeof m<"u"))throw new Error("Initializer returned undefined")}}else if(!r)throw new Error("Unsupported decorator")}}}catch{}}catch{}finally{}return s};static locked(t,a,s){return L(I({},s),{value:()=>{throw new Error("Method is locked")}})}static preStart(t){return(a,s,r)=>fe.isFunction("preStart",s,r)?Ji(r,t):r}static tryCatch(t){return(a,s,r)=>fe.isFunction("tryCatch",s,r)?Zi(r,t):r}static debounce(t){return(a,s,r)=>{if(!fe.isFunction("debounce",s,r))return r;let i=r.value;return i?r.value=_t(i,t):r.initializer&&(i=r.initializer,r.initializer=function(){return _t(i.call(this),t)}),r}}static throttle(t){return(a,s,r)=>{if(!fe.isFunction("throttle",s,r))return r;let i=r.value;return i?r.value=Rt(i,t):r.initializer&&(i=r.initializer,r.initializer=function(){return Rt(i.call(this),t,!0)}),r}}static memoize(t,a,s){if(!fe.isFunction("memoize",a,s))return s;let r=s.value;return r?s.value=Se(r):s.initializer&&(r=s.initializer,s.initializer=function(){return Se(r.call(this))}),s}static validateValue(t){return(a,s,r)=>{if(!fe.isProperty("validateValue",s,r))return r;try{return Ft(a,t,s)}catch(i){return i instanceof Error,r}}}static validateReturn=(...t)=>(a,s,r)=>fe.isFunction("validateReturn",s,r)?on(r,t):r;static validateParams=(...t)=>(a,s,r)=>fe.isFunction("validateParams",s,r)?sn(r,t):r},kt=ln,cn=()=>{self.onmessage=s=>{let{action:r,payload:i}=s.data;switch(r){case"drawImage":break;case"saveData":break;case"getData":break;default:}};function e(s){}function t(s){}function a(s){}},Gt=class Rr{worker=null;static _instance;constructor(){this.init()}static get inst(){return this._instance||(this._instance=new Rr),this._instance}init(){let t=new Blob([`(${cn.toString()})()`],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(t))}static postMessage(t,a){if(!this.inst.worker)throw new Error("Worker is not initialized");this.inst.worker.postMessage({action:t,payload:a})}};W([kt.tryCatch()],Gt.prototype,"init",1),W([kt.tryCatch()],Gt,"postMessage",1);var dn=Gt,hn=dn;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var un=e=>e==null,Fa=e=>{if(!M(e))return e;for(let t in e)if(un(e[t]))delete e[t];else{let a=e[t];M(a)&&(e[t]=Fa(a))}return e},ka=Fa;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Ga=Object,pn=(e,t)=>{if("assign"in Ga)return Ga.assign(e,t);let a=e;for(let s in t)a[s]=t[s];return a},$e=pn,yn=e=>typeof e!="object"||e===null?null:$e(e,{}),Ba=yn;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ua=(e,t)=>{for(let a in t)M(e[a])&&M(t[a])?Ua(e[a],t[a]):$e(e,{[a]:t[a]});return e},ja=Ua,fn=(e,t)=>{try{let a=_a(e),s={};M(a)&&(s=a);let r=Ba(t);if(!M(r))return!1;let i=ka(r),f=ja(s,i),g=Ot(f);return localStorage.setItem(e,g),!0}catch{return!1}},gn=fn,mn={createCanvas:Lt,getLocale:Oi,getLocalStorage:_a,getQueryParams:Ri,getScreenHeight:Fi,getScreenWidth:Gi,writeLocalStorage:gn,vibrate:Ki,getIndexedDB:Pi,WebWorker:hn,setIndexedDB:Hi,removeKeyLocalStorage:Ui};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var wn=()=>Math.round(window.devicePixelRatio)??1,Ha=wn,An=e=>e*Ha(),vn=An;n(),o(),l(),c(),d(),h(),u(),y(),p();var Dn=()=>/Android/i.test(navigator.userAgent),In=Dn;n(),o(),l(),c(),d(),h(),u(),y(),p();var xn=()=>!/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),Sn=xn;n(),o(),l(),c(),d(),h(),u(),y(),p();var En=()=>/iPhone|iPad|iPod/i.test(navigator.userAgent),Pn=En;n(),o(),l(),c(),d(),h(),u(),y(),p();var bn=()=>/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),Ln=bn,Cn={getPhysicPixels:vn,isDesktop:Sn,isMobile:Ln,isAndroid:In,isIOS:Pn,pixelRatio:Ha};n(),o(),l(),c(),d(),h(),u(),y(),p(),Ia(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Nn=e=>{let t=e.map(a=>Promise.resolve(a).then(s=>({status:"fulfilled",value:s}),s=>({status:"rejected",reason:s})));return Promise.all(t)},Tn=Nn;n(),o(),l(),c(),d(),h(),u(),y(),p();var On=e=>typeof Promise.any=="function"?Promise.any(e):new Promise((t,a)=>{let s=[],r=0,i=f=>{if(!(f<e.length))if(s.length>0)t(s[0]);else{let g=new Error("All promises were rejected");g.errors=s,a(g)}};e.forEach((f,g)=>{f.then(m=>{s[g]=m,r++,i(r)}).catch(m=>{s[g]=m,r++,i(r)})})}),_n=On;n(),o(),l(),c(),d(),h(),u(),y(),p();var Rn=async e=>{try{return[await e,null]}catch(t){return[null,Mt(t)]}},Mn=Rn;n(),o(),l(),c(),d(),h(),u(),y(),p();var Fn=(e,t)=>{try{return e()}catch(a){try{return t()}catch{throw a}}},kn=Fn;n(),o(),l(),c(),d(),h(),u(),y(),p();var Gn=async(e,t)=>{try{return await e()}catch(a){try{return await t()}catch{throw a}}},Bn=Gn;n(),o(),l(),c(),d(),h(),u(),y(),p();var Un=e=>{let{generate:t,generateSeed:a=()=>Math.random()*1e6,seed:s=Date.now()}=e,r=s;return(...i)=>(r=a(r),t(r,...i))},jn=Un;n(),o(),l(),c(),d(),h(),u(),y(),p();var $a=(e,t)=>{e.__proto__.valueOf=()=>t,e.__proto__.toString=()=>`${t}`},Hn=e=>e.constructor(L(I({},e),{__proto__:e.__proto__})),Va=e=>{let t=Object.keys(e);for(let a of t){let s=Object.getOwnPropertyDescriptor(e,a)?.value;if(M(s)){Va(s);continue}try{let r=s;$a(r,s),Object.defineProperty(e,a,{enumerable:!1,configurable:!0,get(){return Hn(r)},set(i){$e(r,i),$a(r,i)}})}catch{}}},$n=Va,Vn={debounce:_t,throttle:Rt,syncVars:$n,memoize:Se,retry:kn,retryAsync:Bn,allSettled:Tn,any:_n,accessBlocker:Da,rng:jn,handleAsync:Mn,toError:Mt};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Kn=e=>{let t={};for(let a in e){let s=e[a];t[s]=a}return t},Ka=Kn,Wn=Se((e,t)=>{let a=e.toLowerCase();if(typeof e=="string"){let s=t[a];if(typeof s=="string")return s}return"?"}),zn=Se(e=>{let t=[],a=/:([A-Z0-9?]+)/gm,s=null;for(;s=a.exec(e),s!==null;)t.push(s[1]);return t}),qn=Se(e=>{let t=[],a=/(\d+[A-Z?]|[A-Z?])/gm,s=null;for(;s=a.exec(e),s!==null;){let r=s[0];if(r.length>=2){let{length:i}=r,f=r.slice(0,i-1),g=r[i-1],m=bt(+f).map(()=>g);t.push(...m);continue}t.push(r)}return t}),Yn=(e,t)=>{let a=e,s=Ka(t),r={},i=0,f=0,g=zn(a);for(let m of g){i=0,f++,r[f]||(r[f]={});let w=qn(m);for(let A of w){i++;let v=Wn(A,s);r[f][i]=v}}return r},Jn=Yn;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Qn=(e,t)=>M(e)?typeof Object.hasOwn=="function"?Object.hasOwn(e,t):Object.prototype.hasOwnProperty.call(e,t):!1,Q=Qn;n(),o(),l(),c(),d(),h(),u(),y(),p();var Xn=e=>typeof e=="string",Wa=Xn,Zn=Se((e,t)=>{if(!M(t)||!Q(t,e))return"?";let a=t[e];return typeof a=="string"?`${a.toUpperCase()}`:"?"}),za=(e,t,a=!1)=>{let s="";if(!M(e))return s;let r="",i=1;for(let f in e){if(!Q(e,f))continue;let g=e[f];if(M(g)){s+=`:${za(g,t,!0)}`;continue}if(!Wa(g))continue;let m=Zn(g,t);m===r?(i++,s=s.slice(0,-2)):i=1,s+=`${i}${m}`,r=m}return s=s.replace(/1([A-Z])/g,"$1"),s},eo=za;n(),o(),l(),c(),d(),h(),u(),y(),p();var to=(e,t)=>{try{if(!e)return"";if(t){let a=atob(e),s=btoa(t);return a=a.replace(s,"="),atob(a)}return atob(e)}catch{return""}},ao=to;n(),o(),l(),c(),d(),h(),u(),y(),p();var so=()=>({}),Bt={},it=e=>(Bt[e]||(Bt[e]=so()),Bt[e]),qa=(e,t)=>{let a=it(t),s=Object.keys(a).length;a[e]=s+1},ro=(e,t,a=1)=>{let s=e[0],r=[],i=it(a);if(t)for(let m in t)qa(m,a);for(let m=1;m<e.length;m++){let w=e[m],A=`${s}${w}`;m++,s=e[m],i[A]===void 0&&(qa(A,a),i=it(a))}s=e[0];let f=1,g=0;for(;f<e.length;){let m=e[f],w=`${s}${m}`,A=io(e.slice(g),i);if(A!==null){r.push(i[A]),f+=A.length-w.length,s="",g=f+1,f++;continue}i[w]===void 0?s=w:(r.push(i[w]),s="",g=f+1),f++}return r},io=(e,t)=>{let a=Object.keys(t);return a=a.filter(s=>e.indexOf(s)>-1&&e!==s),a.length===0?null:a.sort((s,r)=>r.length-s.length)[0]},no=ro;n(),o(),l(),c(),d(),h(),u(),y(),p();var oo=e=>{let t={};for(let a in e)t[e[a]]=a;return t},lo=(e,t,a=1)=>{let s="",r="",i=it(a);t&&(i=I(I({},t),i));let f=oo(i);for(let g in e){let m=e[g];f[m]!==void 0?s=f[m]:s="?",r+=s}return r},co=lo;n(),o(),l(),c(),d(),h(),u(),y(),p();var ho=(e,t)=>{try{if(!e)return"";if(t){let a=btoa(e),s=btoa(t);return a=a.replace("=",s),btoa(a)}return btoa(e)}catch{return""}},uo=ho,po={decodeMap:Jn,encodeMap:eo,hashToString:ao,stringToHash:uo,lwzCompress:no,lwzDecompress:co};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var yo=(e,t)=>{let a=e.split(","),s=a[0].match(/:(.*?);/);if(!s)return null;let r=s[1],i=atob(a[a.length-1]),f=i.length,g=new Uint8Array(f);for(;f--;)g[f]=i.charCodeAt(f);return new File([g],t,{type:r})},fo=yo;n(),o(),l(),c(),d(),h(),u(),y(),p();var go=e=>new Promise((t,a)=>{let s=new FileReader;s.onloadend=()=>t(s.result),s.onerror=a,s.readAsDataURL(e)}),mo=go;n(),o(),l(),c(),d(),h(),u(),y(),p();var Fe=new Image,wo=(e,t=!0,a=!0)=>new Promise(s=>{t&&(Fe=new Image),Fe.onload=()=>{s(Fe),a&&URL.revokeObjectURL(Fe.src)},Fe.onerror=()=>{s(null)},Fe.src=URL.createObjectURL(e)}),Ao=wo;n(),o(),l(),c(),d(),h(),u(),y(),p();var vo=async(e,t)=>{let a=await fetch(e).then(s=>s.blob()).catch(()=>null);return a?new File([a],t):null},Do=vo;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ee=Lt({contextType:"2d",contextAttributes:{willReadFrequently:!0}}),Io=async e=>new Promise((t,a)=>{let s=new FileReader;s.onload=()=>t(s.result),s.onerror=a,s.readAsDataURL(e)}),xo=async(e,t="png")=>{let{width:a,height:s}=e;if(!a||!s)throw new Error("Element has no width or height");if(!Ee)throw new Error("Failed to create canvas");if(Ee.canvas.width=a,Ee.canvas.height=s,Ee.context.drawImage(e,0,0,a,s),Ee.canvas instanceof HTMLCanvasElement)return Ee.canvas.toDataURL(`image/${t}`,.85);let r=await Ee.canvas.convertToBlob({type:`image/${t}`});return Io(r)},So=xo;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ya=Lt({contextType:"2d",contextAttributes:{willReadFrequently:!0}}),Eo=async(e,t="png")=>{try{if(!Ya)throw new Error("Failed to create canvas");let{canvas:a,context:s}=Ya;return a.width=e.width,a.height=e.height,s.drawImage(e,0,0,e.width,e.height),a instanceof HTMLCanvasElement?new Promise(r=>{a.toBlob(i=>r(i),`image/${t}`,.9)}):a.convertToBlob({type:`image/${t}`,quality:.9})}catch{return null}},Po=Eo;n(),o(),l(),c(),d(),h(),u(),y(),p();var bo=async e=>{if(!e)throw new Error("url is empty");try{let t=await fetch(e);if(!t.ok)throw new Error("Network response was not ok");return await t.blob()}catch(t){throw t instanceof Error?t:new Error("Failed to fetch image")}},Lo=bo;n(),o(),l(),c(),d(),h(),u(),y(),p();var Co=async e=>new Promise((t,a)=>{e||a(new Error("url is empty"));let s=new Image;s.crossOrigin="anonymous",s.onload=()=>{t(s)},s.onerror=r=>{a(r)},s.src=e}),No=Co;n(),o(),l(),c(),d(),h(),u(),y(),p();var To=(e,t)=>{if(isNaN(e)||isNaN(t))throw new Error("width and height must be numbers");return{string:"+",style:`font-size: 1px; padding: ${Math.floor(t/2)}px ${Math.floor(e/2)}px;`}},Oo=(e,t=1)=>{let a=new Image;a.onload=function(){let s=this,r=s.width*t,i=s.height*t,f=To(r,i)},a.src=e},_o=Oo,Ro={base64ToFile:fo,blobToDataImage:mo,blobToHtmlImage:Ao,blobUrlToFile:Do,elementToBase64:So,elementToBlob:Po,fetchImage:Lo,loadImage:No,logImage:_o};n(),o(),l(),c(),d(),h(),u(),y(),p();var Mo={clone:Ra,decode:Tt,encode:Ot};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Fo=class Mr{perf=null;static _inst;static get inst(){return this._inst||(this._inst=new Mr),this._inst}static setService(t){this.inst.perf=t??null}static measure(t){this.inst.perf?.measure(t)}static start(t){this.inst.perf?.start(t)}static stop(t){try{this.inst.perf?.stop(t)}catch{}}static putMetric(t,a,s=Date.now()){this.inst.perf?.putMetric(t,a,s)}static incMetric(t,a,s=1){this.inst.perf?.incrementMetric(t,a,s)}static putAttr(t,a,s){let r=s.slice(0,100);this.inst.perf?.putAttr(t,a,r)}static rmAttr(t,a){this.inst.perf?.removeAttr(t,a)}},ko=Fo,Go={Mark:ko};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Bo=(e,t)=>{if(typeof e!="number")return"0";let a=rt(10,t),s=e,r=0;for(;s>=a;)s=Math.floor(s/1e3),r++;let i=s.toString(),f=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qad","Qid","Sxd","Spd"][r];return`${i}${f}`},Uo=Bo;n(),o(),l(),c(),d(),h(),u(),y(),p();var jo=(e,t,a="0")=>{let s=e.toString(),r=s.length;for(let i=0;i<t-r;i++)s=s+a;return s},Ho=jo;n(),o(),l(),c(),d(),h(),u(),y(),p();var $o=(e,t,a="0")=>{let s=e.toString(),r=s.length;for(let i=0;i<t-r;i++)s=a+s;return s},Vo=$o;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ko=(e,t)=>{let a=t?Math.random()>.5?1:-1:1;return Math.floor(Math.random()*e)*a},Ut=Ko;n(),o(),l(),c(),d(),h(),u(),y(),p();var Wo=e=>e>0?1:e<0?-1:e===0?0:Number.NaN,zo=Wo;n(),o(),l(),c(),d(),h(),u(),y(),p();var qo=(e,t)=>{let{fractionalDigits:a=0,startAbbreviate:s=1e3,abbreviateStep:r=3,maxLength:i=-1,removeLastZero:f=!0,suffixes:g=["","k","m","b","t","q"]}=t||{},m=i===-1?99999999:i;if(e>=s){let x=Math.floor(e/rt(10,r)),S=Math.floor((x.toString().length-1)/r)+1,P=(e/rt(rt(10,r),S)).toFixed(a),C=m-g[S].length,E=P.substring(0,C);return(f?Ja(E):E)+g[S]}let w=e.toFixed(a),A=m-g[0].length,v=w.substring(0,A);return f?Ja(v):v+g[0]},Ja=e=>{if(e.indexOf(".")<0)return e;for(let t=e.length-1;t>=0;t--){if(e[t]===".")return e.substring(0,t);if(e[t]!=="0")return e.substring(0,t+1)}return e},Yo=qo,Jo={getShortNumber:Uo,sign:zo,padEnd:Ho,padStart:Vo,random:Ut,toAbbreviatedString:Yo};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Qo=e=>{let t=e.replace(/[-_\s.]+(.)?/g,(a,s)=>s?s.toUpperCase():"");return t.substring(0,1).toUpperCase()+t.substring(1)},Qa=e=>{let t=e.replace(/[-_\s.]+(.)?/g,(a,s)=>s?s.toUpperCase():"");return t.substring(0,1).toLowerCase()+t.substring(1)},jt=e=>{let t={};for(let a in e){let s=e[a],r=Qa(a);Array.isArray(s)?t[r]=s.map(i=>typeof i=="object"?jt(i):i):typeof s=="object"?t[r]=jt(s):t[r]=e[a]}return t},Xo=jt;n(),o(),l(),c(),d(),h(),u(),y(),p();var Xa=(e,t)=>{let a={};for(let s in t)if(Q(t,s))if(Q(e,s)){let r=e[s],i=t[s];if(M(r)&&M(i)&&r!==null&&i!==null&&typeof r!="function"&&typeof i!="function"){let f=Xa(r,i);Object.keys(f).length>0&&(a[s]=f)}else Object.is(r,i)||(a[s]=i)}else a[s]=t[s];for(let s in e)Q(e,s)&&!Q(t,s)&&(a[s]=void 0);return a},Zo=Xa;n(),o(),l(),c(),d(),h(),u(),y(),p();var Za=(e,t)=>{let a={};for(let s in t)if(Q(t,s))if(M(t[s])&&t[s]!==null)if(M(e[s])&&e[s]!==null){if(typeof t[s]=="function")continue;let r=Za(e[s],t[s]);Object.keys(r).length>0&&(a[s]=r)}else Q(e,s)||(a[s]=$e({},t[s]));else Q(e,s)||(a[s]=t[s]);return a},el=Za;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var tl=e=>["string","number","symbol"].indexOf(typeof e)>-1,es=tl,al=(e,t)=>{let a={};for(let s of e){let r=s[t];es(r)&&(a[r]=s)}return a},sl=al;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var ts=e=>e.replace(/([a-z])([A-Z])/g,"$1_$2").replace(/\s+/g,"_").toLowerCase(),Ht=e=>{let t={};for(let a in e){let s=e[a],r=ts(a);Array.isArray(s)?t[r]=s.map(i=>typeof i=="object"?Ht(i):i):typeof s=="object"?t[r]=Ht(s):t[r]=e[a]}return t},rl=Ht;n(),o(),l(),c(),d(),h(),u(),y(),p();var il=e=>Object.keys(e).map(t=>e[t]),nl=il,ol={assign:$e,camelCaseKeys:Xo,clone:Ba,clear:ka,diff:Zo,hasOwn:Q,invert:Ka,keyBy:sl,merge:ja,snakeCaseKeys:rl,vals:nl,filterDeep:el};n(),o(),l(),c(),d(),h(),u(),y(),p();var as={};Br(as,{Signal:()=>ss,SignalAbortedError:()=>$t,SignalController:()=>ll}),n(),o(),l(),c(),d(),h(),u(),y(),p();var $t=class extends Error{constructor(e="Signal aborted with no reason"){super(e),this.name="SignalAbortedStopped"}},ss=class Fr{state={type:"running"};callbacks=[];once(t){this.callbacks.push(t)}off(t){this.callbacks=this.callbacks.filter(a=>a!==t)}abort(t){let a=this.constructReason(t);this.state={type:"stopped",reason:a};for(let s of this.callbacks)s(a);this.callbacks=[]}get aborted(){return this.state.type==="stopped"}get reason(){if(this.state.type==="stopped")return this.state.reason}wrap(t){if(!this.aborted)return t}chain(t){t instanceof Fr?t.once(a=>this.abort(a)):t.addEventListener("abort",()=>this.abort(t.reason),{once:!0})}promise(){return this.aborted?Promise.resolve(this.reason):new Promise(t=>{this.once(a=>t(a))})}constructReason(t){return t instanceof Error?t:typeof t=="string"?new $t(t):new $t}},ll=class{signal;renew(){this.signal?.abort();let e=new ss;return this.signal=e,e}abort(){this.signal?.abort()}promise(){return this.signal===void 0?Promise.resolve(void 0):this.signal.promise()}},cl=as;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var dl=e=>e&&e[0].toUpperCase()+e.slice(1),hl=dl;n(),o(),l(),c(),d(),h(),u(),y(),p();function ul(e,t=2){let a=[],s=e.split(" "),r=s.length;for(let i=r;i>=1;i--)for(let f=0;f<=r-i;f++){let g=s.slice(f,f+i).join(" ");e.split(g).length-1>=t&&a.indexOf(g)<0&&g.length>1&&a.push(g)}return a.sort((i,f)=>i.length-f.length)}var pl=ul;n(),o(),l(),c(),d(),h(),u(),y(),p();var Pe=null,yl="Anonymous",fl=async()=>{let e="https://randommer.io/api/Name",{RandomNameApiKey:t}=Ludex.Configs.Mockup.Profile,a=await fetch(e,{method:"GET",headers:{"X-Api-Key":t,"Content-Type":"application/json"},body:JSON.stringify({nameType:"surname",quantity:1e3})});if(!a.ok)throw new Error("Can't fetch names");let s=await a.json();if(!M(s)||!Q(s,"data")||!Array.isArray(s.data))throw new Error("Invalid names response");return s.data},gl=async()=>{try{if(!Pe&&(Pe=await fl(),!Pe))throw new Error("Cannot fetch names");let e=Pe[Ut(Pe.length)],t=Pe[Ut(Pe.length)];return`${e} ${t}`}catch{return yl}},ml=gl;n(),o(),l(),c(),d(),h(),u(),y(),p();var wl=(e=16)=>{let t=r=>Math.floor(r).toString(e),a=t(Date.now()/1e3),s=Array(e+1).join(" ");return a+s.replace(/./g,()=>t(Math.random()*e))},Al=wl;n(),o(),l(),c(),d(),h(),u(),y(),p();var vl=e=>{let t=e?e.split("_"):[],a=t.length>0?t[0]:"en_US";switch(a){case"id":case"in":a="id";break}return a},Dl=vl;n(),o(),l(),c(),d(),h(),u(),y(),p();var Il=(e,t)=>{let a=e.split(" "),s=(a.length<=1?[...a]:[a[0],a.pop()]).join(" "),r=s.lastIndexOf(" ")||0,i=r>=0?r:t;return(s.length>t?s.substring(0,i):s).substring(0,t)},xl=Il;n(),o(),l(),c(),d(),h(),u(),y(),p();var Sl=e=>{let t=0;if(e.length===0)return t;for(let a=0;a<e.length;a++){let s=e.charCodeAt(a);t=(t<<5)-t+s,t=t&t}return t},El=Sl;n(),o(),l(),c(),d(),h(),u(),y(),p();var Pl=(e,t)=>{for(let a=0;a<t.length;a++)if(e[a]!==t[a])return!1;return!0},bl=Pl;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ll=(e,t,a=" ")=>{let s=Math.floor(t);if(e.length>=s)return e;let r=s-e.length,i="";for(let f=0;f<r;f++)i+=a;return i.slice(0,r)+e},Cl=Ll;n(),o(),l(),c(),d(),h(),u(),y(),p();var Nl=e=>Object.keys(e).reduce((t,a)=>{let s=e[a];return s!==void 0&&t.push(`${a}=${s}`),t},[]).join("&"),Tl=Nl;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ol=(e,t)=>{let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*#%&!",s="",r=e;t!==void 0&&(r-=t.length,s+=t);for(let i=0;i<r;i++){let f=Math.floor(Math.random()*a.length);s+=a.charAt(f)}return s},_l=Ol;n(),o(),l(),c(),d(),h(),u(),y(),p();var Rl="0123456789ABCDEF",Ml=(e="0x")=>{let t=e;for(let a=0;a<6;a++)t+=Rl[Math.floor(Math.random()*16)];return t},Fl=Ml;n(),o(),l(),c(),d(),h(),u(),y(),p();var kl=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,t=>t==="\u0111"?"d":"D"),Gl=kl;n(),o(),l(),c(),d(),h(),u(),y(),p();function Bl(e){let t=Ul(e),a=t%rs.length,s=(t>>8)%is.length,r=(t>>16)%1e4;return`${rs[a]}${is[s]}${r}`}var Ul=e=>{let t=0;for(let a=0;a<e.length;a++){let s=e.charCodeAt(a);t=(t<<5)-t+s,t=t|0}return t=Math.abs(t),t},rs=["James","Mary","John","Patricia","Robert","Jennifer","Michael","Linda","William","Elizabeth","David","Susan","Richard","Jessica","Joseph","Sarah","Thomas","Karen","Charles","Nancy","Christopher","Lisa","Daniel","Margaret","Matthew","Betty","Anthony","Sandra","Mark","Ashley","Donald","Dorothy","Steven","Kimberly","Paul","Emily","Andrew","Donna","Joshua","Michelle","Kenneth","Carol","Kevin","Amanda","Brian","Melissa","George","Deborah"],is=["Smith","Johnson","Williams","Jones","Brown","Davis","Miller","Wilson","Moore","Taylor","Anderson","Thomas","Jackson","White","Harris","Martin","Thompson","Garcia","Martinez","Robinson","Clark","Rodriguez","Lewis","Lee","Walker","Hall","Allen","Young","Hernandez","King","Wright","Lopez","Hill","Scott","Green","Adams","Baker","Gonzalez","Nelson","Carter","Mitchell","Perez","Roberts","Turner","Phillips","Campbell","Parker","Evans"],jl={toCamelCase:Qa,toUpperCamelCase:Qo,capitalize:hl,generateObjectId:Al,getLanguageCode:Dl,getShortName:xl,hashCode:El,matchStart:bl,padStart:Cl,params:Tl,random:_l,randomColor:Fl,removeDiacritics:Gl,findDuplicateSubstrings:pl,generateNameAsync:ml,toSnakeCase:ts,generateNameUsingString:Bl};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var ns=[60,3600,86400,86400*7,86400*30,86400*365,Number.POSITIVE_INFINITY],Hl=["second","minute","hour","day","week","month","year"],$l=(e,t,a,s="Soon")=>{try{let r=t??"en",i=a??{numeric:"auto"},f=Math.round((e*1e3-Date.now())/1e3),g=Math.abs(Math.round((e*1e3-Date.now())/1e3)),m=ba(ns,A=>A>g),w=m?ns[m-1]:1;return new Intl.RelativeTimeFormat(r,i).format(Math.floor(f/w),Hl[m])}catch(r){if(s!==void 0)return"Soon";throw r}},Vl=$l;n(),o(),l(),c(),d(),h(),u(),y(),p();var Kl=e=>{let t=new Date(e),a=t.getUTCHours(),s=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds(),f=a<10?`0${a}`:`${a}`,g=s<10?`0${s}`:`${s}`,m=r<10?`0${r}`:`${r}`,w=`${i}`;return i<10?w=`00${i}`:i<100&&(w=`0${i}`),`${f}:${g}:${m}:${w}`},Wl=Kl;n(),o(),l(),c(),d(),h(),u(),y(),p();var zl=e=>{let t=new Date(e),a=new Date;return t.getDate()===a.getDate()&&t.getMonth()===a.getMonth()&&t.getFullYear()===a.getFullYear()},ql=zl;n(),o(),l(),c(),d(),h(),u(),y(),p();var Yl=e=>new Promise(t=>setTimeout(t,e)),Jl=Yl,Ql={isToday:ql,sleepAsync:Jl,getRelativeTime:Vl,getTimeString:Wl};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Xl=e=>typeof e=="boolean",Zl=Xl;n(),o(),l(),c(),d(),h(),u(),y(),p();var ec=()=>!0,tc=ec;n(),o(),l(),c(),d(),h(),u(),y(),p();var ac=e=>typeof e=="function",os=ac;n(),o(),l(),c(),d(),h(),u(),y(),p();var sc=e=>typeof e=="number",rc=sc;n(),o(),l(),c(),d(),h(),u(),y(),p();var ic=e=>os(e)?e instanceof Promise||"then"in e&&typeof e.then=="function"?!0:e.constructor.name==="AsyncFunction":!1,nc=ic;n(),o(),l(),c(),d(),h(),u(),y(),p();var oc=(e,t,a)=>{let{timeout:s=1e3,checkInterval:r=16}=a??{},i,f;return new Promise((g,m)=>{if(typeof e!="function")throw new Error("Input from must be a function");f=setInterval(()=>{let w=e(),A=typeof t=="function"?t():t;w===A&&(clearTimeout(i),clearInterval(f),g(!0))},r),s>0&&(clearTimeout(i),i=setTimeout(()=>{clearInterval(f),m(new Error("Timeout"))},s))})},lc=oc,cc={isBoolean:Zl,isDebugger:tc,isEmpty:Ct,isFalsy:Ca,isFunction:os,isNumber:rc,isObject:M,isPromise:nc,isPropertyKey:es,isString:Wa,isValueChangeAsync:lc},dc={Array:mi,Browser:mn,Decorator:kt,Device:Cn,Function:Vn,Hash:po,Image:Ro,Json:Mo,Mark:Go.Mark,Object:ol,Signal:cl,String:jl,Number:Jo,Time:Ql,Valid:cc},hc=dc,uc=Object.preventExtensions({Dtos:{},Utils:Object.freeze(hc),Match:Object.freeze({Modes:Object.freeze(Sa)}),Events:Object.freeze(ge),Configs:Object.seal(jr),Plugins:Object.seal({Ads:null,Audio:null,Analytics:null})});window.Ludex=uc,window.TypeGuard=qr,window.GameName="Tile Connect",window.BuildVersion=15,n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:ke,Object:be,String:Vt,Json:ls}=Ludex.Utils,Ve="is invalid",pc=class ne{static strict={};static data={};static addDefaultData(t){ke.isObject(t)||this.prototype.e("default data",Ve),t=ls.clone(t);let{name:a}=this;ke.isObject(ne.data[a])||(ne.data[a]={}),ne.data[a]=be.merge(ne.data[a],t)}static getDefaultData(){let{name:t}=this;return ls.clone(ne.data[t])}static addValidateFunction(t,a){ke.isString(t)||this.prototype.e("validate key",Ve),typeof a!="function"&&this.prototype.e("validate function",Ve);let s=`validate${Vt.capitalize(t)}`;be.assign(this.prototype,{[s]:a})}constructor(t){this.defaultData(),this.processData(t)}static makeStrict(){ne.strict[this.name]=!0}static makeLoose(){ne.strict[this.name]=!1}processData(t){this.n(t),this.o(t),this.setupData(t)}defaultData(){let{name:t}=this.constructor;this.p(ne.data[t])}p(t){ke.isObject(t)||this.e("data",Ve);for(let a in t)if(be.hasOwn(t,a)){let s=t[a];be.assign(this,{[a]:s})}}l(t){ke.isObject(t)||this.e("structure","is not object");let a=this.getKeys();for(let s of a){let r=this[s];r===void 0&&this.e("structure",`has no key ${s}`),!be.hasOwn(t,s)&&r!==void 0&&this.h(s,t)}}h(t,a){ke.isObject(a)||this.e("data",Ve);let s=this[t];s===void 0&&this.e("default",`has no key ${t}`),be.assign(a,{[t]:s})}c(t){let a=this.getKeys();for(let s of a){let r=t[s],i=Vt.removeDiacritics(s).replace(/[^a-zA-Z0-9]/g,""),f=`validate${Vt.capitalize(i)}`,g=this[f];if(typeof g=="function")try{g.call(this,r)}catch(m){if(ne.strict[this.constructor.name])throw m;this.h(s,t)}else this.e("validate",`has no function ${f}`)}}d(t){let a=this.getKeys();for(let s of a){let r=t[s];be.assign(this,{[s]:r})}}e(t,a){throw new Error(`${this.constructor.name}: ${t} ${a}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([t])=>t!=="toObject"))}getKeys(){return Object.keys(this).filter(t=>t!=="toObject"&&t!=="strict")}},le=pc;Ludex.Dtos={Base:le},n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var yc=class{codex;plugins;constructor(e){this.codex=e,this.plugins={}}install(e,t,a,s){if(typeof t!="function"){GameSDK.getSDKName();return}let r=new t(this.codex);this.plugins[e]=r,a&&Object.defineProperty(this.codex,s,{get:()=>r}),r.init()}get(e){return this.plugins[e]}},fc=yc;n(),o(),l(),c(),d(),h(),u(),y(),p();var gc=class{codex;constructor(e){this.codex=e}init(){}},mc=gc,wc=class{codex;plugins;ads;auth;audio;event;match;player;profile;context;storage;language;missions;analytics;visibility;leaderboard;dailyRewards;remoteConfig;frameCapture;firebase;monitorError;adaptivePerformance;inputRecorder;console;profiler;canvasRecorder;constructor(){this.codex=this,this.plugins=new fc(this.codex)}async boot(){}async start(){}getBuildVersion(){return 0}};window.Ludex.Plugins={BasePlugin:mc};var Ac=wc;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var vc=class extends Error{payload;constructor(e,t){super(e),this.name="BadRequest",this.message=e??"This request is bad",this.payload=t}},Kt=vc;n(),o(),l(),c(),d(),h(),u(),y(),p();var Dc=class extends Error{payload;constructor(e,t){super(e),this.name="RequestTimeout",this.message=e??"This request is timeout",this.payload=t}},Wt=Dc,{Utils:{Valid:Ic,Time:xc},Configs:{AppId:cs,Network:zt}}=Ludex,Sc=e=>{if(!e.ok)throw new Kt(void 0,{response:e})},ds=()=>{let e=codex.auth.getToken();return{token:e,timeout:zt.Timeout,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}},hs=(e,t,a,s)=>async()=>{try{if(!cs)throw new Kt("AppId is not defined");let r=`${e}/apps/${cs}/${t}`,i=new AbortController;a.signal=i.signal;let f=setTimeout(()=>{i.abort()},a.timeout);Ic.isObject(s)&&(a.body=JSON.stringify(s));let g=await fetch(r,a);return clearTimeout(f),Sc(g),await g.json()||{}}catch(r){if(r instanceof Kt)return null;throw r instanceof Object&&"name"in r&&r.name==="AbortError"?new Wt:r}},qt=async(e,t)=>{try{return e()}catch(a){if(a instanceof Wt&&t>0)try{return await xc.sleepAsync(600),await qt(e,t-1)}catch{return{}}return a instanceof Wt?{}:{}}},Ge=async(e,t,a,s=zt.Retries)=>{try{let r=L(I(I({},ds()),t),{method:"GET"}),i=hs(a,e,r);return await qt(i,s)}catch{return{}}},te=async(e,t,a,s,r=zt.Retries)=>{try{let i=L(I(I({},ds()),a),{method:"POST"}),f=hs(s,e,i,t);return await qt(f,r)}catch{return{}}},{Configs:{Notification:{ApiUrl:Ec}},Utils:{Object:Pc}}=Ludex,bc=async e=>{if(!Pc.hasOwn(e,"playerId"))throw new Error("Missing playerId");let{playerId:t}=e;await te(`players/${t}`,e,{},Ec,10)};n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Lc={score:"score",settings:"settings",isFirstLogin:"isFirstLogin",gameData:"gameData",missionsData:"missionsData",notificationData:"notificationData",dailyRewardedData:"dailyRewardedData",lastCallSwitchGame:"lastCallSwitchGame",remoteConfig:"remoteConfig"},Cc=Lc;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Nc={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{score:0,isFirstLogin:!0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},notificationData:{D1:{arrivalDate:0},D2:{arrivalDate:0},D3:{arrivalDate:0},D4:{arrivalDate:0},D5:{arrivalDate:0},D6:{arrivalDate:0},D7:{arrivalDate:0}},missionsData:{process:{}},lastCallSwitchGame:0}},me=Nc,{Valid:Ke}=Ludex.Utils,{playerId:Tc,name:Oc,photo:_c,locale:Rc}=me,We="is invalid",us=class extends le{setupData(e){this.d(e)}n(e){this.l(e)}o(e){this.c(e)}validateId(e){(!Ke.isString(e)||!e)&&this.e("_id",We)}validatePlayerId(e){(!Ke.isString(e)||!e)&&this.e("playerId",We)}validateName(e){(!Ke.isString(e)||!e)&&this.e("name",We)}validatePhoto(e){Ke.isString(e)||this.e("photo",We)}validateLocale(e){(!Ke.isString(e)||!e)&&this.e("locale",We)}toObject(){return super.toObject()}};us.addDefaultData({playerId:Tc,name:Oc,photo:_c,locale:Rc});var Yt=us,Mc=new Yt({playerId:"10",name:"Your Friend"}).toObject(),ce=Mc;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Fc=class extends Error{code;constructor(e){super(e),this.code="CREATE_MATCH_FAILED"}},de=Fc,kc=class extends de{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}},N=kc,{Dtos:Jt,Utils:{Array:Gc,Object:Bc,Json:zg,Valid:Qt},Events:Uc}=Ludex,jc=class{codex;constructor(e){this.codex=e}initContext=()=>{let e={contextId:GameSDK.context.getID()??"",contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new Jt.Context.Info(e),{contextId:a,contextType:s,entryPointData:r}=t.toObject();this.codex.context.receiveContext(a,s,r)};initPlayer=async()=>{try{let{player:e}=this.codex,t=this.getPlayerInfo(),a=Gc.unique(Bc.vals(Cc)),s=await GameSDK.player.getDataAsync(a),r=new Jt.Player.Data(s).toObject();e.receiveData(t,r)}catch{}finally{this.codex.event.emit(Uc.PLAYER_INFO_LOADED)}};getPlayerInfo=()=>{try{let e=GameSDK.player.getID(),t=GameSDK.player.getName(),a=GameSDK.player.getPhoto(),s=GameSDK.getLocale();if(!Qt.isString(e))throw new N;return Qt.isString(t)||(t="You"),(!Qt.isString(s)||!s)&&(s="en"),new Jt.Player.Info({playerId:e,name:t,photo:a,locale:s}).toObject()}catch{return ce}}},Hc=jc;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var ps=(e=>(e.IDLE="idle",e.LOADING="loading",e.FILLED="filled",e.SHOWING="showing",e))(ps||{}),ys=ps;n(),o(),l(),c(),d(),h(),u(),y(),p();var fs=(e=>(e.BANNER="banner",e.INTERSTITIAL="interstitial",e.REWARDED_VIDEO="rewarded_video",e.REWARDED_INTERSTITIAL="rewarded_interstitial",e))(fs||{}),ae=fs;n(),o(),l(),c(),d(),h(),u(),y(),p();var $c=class extends Error{code;constructor(e,t){super(t),this.code=e,this.message=t}},nt=$c;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Vc=class{type;service;placementId;_status;constructor(e,t){this.type=e,this._status=ys.IDLE,this.placementId=t}setStatus(e){this._status!==e&&(this._status=e)}get status(){return this._status}e(e){throw new nt("AD_INSTANCE_ERROR",e)}},Kc=Vc,Wc=class extends Kc{loadAsync(){this.e("This method is not implemented")}showAsync(){this.e("This method is not implemented")}hideAsync(){this.e("Unsupported method")}},gs=Wc;Ludex.Plugins.Ads={Types:ae,Status:ys,AdError:nt,AdInstance:gs};var{Utils:{Array:ot,Object:ms,Function:zc}}=Ludex,qc=class extends Ludex.Plugins.BasePlugin{enabled;config;lastCallAdShownTime;isAdFullSizeShowed;ads={};safeAreaBottom;degradationTracking={failedAttempts:0,lastSuccessTime:0};init(){this.lastCallAdShownTime={[ae.BANNER]:0,[ae.INTERSTITIAL]:0,[ae.REWARDED_VIDEO]:0,[ae.REWARDED_INTERSTITIAL]:0},this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom(),this.resetDegradationTracking()}calculateSafeAreaBottom(){try{let e=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(e,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(e){this.config=e,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new nt("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(e,t,a){let s=`${e}-${t}`;this.ads[s]||(this.ads[s]={type:e,placementId:t,interval:null,instance:new a(e,t)})}async loadAdAsync(e,t){this.checkEnabled();try{await this.getAd(e,t).instance.loadAsync()}catch(a){throw this.degradationTracking.failedAttempts++,a}}async showAdAsync(e,t){if(this.checkEnabled(),!this.canShowAd(e,t))return;let{event:a}=this.codex,s=this.getAd(e,t);try{a.emit(Ludex.Events.AD_SHOWING,{type:e,placementId:t}),this.isAdFullSizeShowed=!0,await s.instance.showAsync(),this.resetDegradationTracking(),this.lastCallAdShownTime[e]=Date.now()/1e3}catch(r){throw this.degradationTracking.failedAttempts++,r}finally{a.emit(Ludex.Events.AD_CLOSED,{type:e,placementId:t}),this.isAdFullSizeShowed=!1}}getAdStatus(e,t){return this.checkEnabled(),this.getAd(e,t).instance.status}getAd(e,t){let a=null;if(t?a=this.getAdByPlacementId(t,e):a=this.getPriorityAdByType(e),!a)throw new nt("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}getAdsByType(e){return ms.vals(this.ads).filter(t=>t.type===e)}getAdByPlacementId(e,t){let a=ms.vals(this.ads);return ot.search(a,r=>r.placementId===e&&(!t||r.type===t))||null}getPriorityAdByType(e){let t=this.getAdsByType(e);return t.length&&ot.search(t,s=>s.type===e)||null}canShowAd(e,t){return this.canShowAdByTime(e,t)}canShowAdByTime(e,t){try{let a=Date.now()/1e3,s;if(t)s=this.getCommonAdConfig(t);else{let w=this.getPriorityAdByType(e);if(!w)return!1;s=this.getCommonAdConfig(w.placementId)}let{SecondsBetweenAds:r,SecondsFirstTime:i}=s,f=a-this.lastCallAdShownTime[e],g=f>r,m=f>i;return this.lastCallAdShownTime[e]>0?g:m}catch{return!1}}canShowBannerAd(e){try{let t=this.getBannerConfig(e),{Platform:a}=t;if(a==="ALL")return!0;let s=GameSDK.getPlatform();return s?s===a:!1}catch{return!1}}async showBannerAdAsync(e,t=!0){this.checkEnabled();let a=this.getAd(ae.BANNER,e);if(!this.canShowBannerAd(a.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(a),t?await this.showBannerAdWithSchedule(a):await this.showBannerAdOnce(a)}async showBannerAdOnce(e){let{event:t}=this.codex;if(!this.isAdFullSizeShowing())try{await e.instance.loadAsync(),await e.instance.showAsync(),t.emit(Ludex.Events.AD_SHOWING,{type:ae.BANNER,placementId:e.placementId})}catch(a){let s=zc.toError(a);if(s.code!=="AD_NOT_FILLED")try{await e.instance.hideAsync()}catch{}t.emit(Ludex.Events.AD_FAILED,{type:ae.BANNER,placementId:e.placementId,error:s})}}async showBannerAdWithSchedule(e){await this.showBannerAdOnce(e);let t=this.getBannerConfig(e.placementId),{SecondsReload:a}=t;if(a<=0||!a)return;let s=()=>this.showBannerAdWithSchedule(e);e.interval=setTimeout(s,a*1e3)}async hideBannerAdAsync(e){this.checkEnabled();let t=this.getAd(ae.BANNER,e);this.cleanBannerReloadTimer(t),await t.instance.hideAsync();let{event:a}=this.codex;a.emit(Ludex.Events.AD_CLOSED,{type:ae.BANNER,placementId:e})}cleanBannerReloadTimer(e){try{let{interval:t}=e;if(!t)return;clearInterval(t)}catch{}}getCommonAdConfig(e){let t=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions,...this.config.RewardedInterstitialAdOptions],a=ot.search(t,s=>s.PlacementId===e);if(!a)throw new Error(`Ad config with placementId ${e} not found`);return a}getBannerConfig(e){let t=ot.search(this.config.BannerDisplayAdOptions,a=>a.PlacementId===e);if(!t)throw new Error(`Banner config with placementId ${e} not found`);return t}getBannerHeight(e,t,a=!0){this.checkEnabled();let s=this.getBannerConfig(e),r=GameSDK.getBannerHeight(s);return a?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(r+this.safeAreaBottom)*t):r*t}getSafeAreaBottom(e){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*e}resetDegradationTracking(){this.degradationTracking={failedAttempts:0,lastSuccessTime:Date.now()}}isServiceDegraded(){let e=Date.now(),{MaxFailedAttempts:t,ResetTimeMinutes:a}=this.config.DegradationTracking,{lastSuccessTime:s,failedAttempts:r}=this.degradationTracking;return e-s>a*60*1e3&&this.resetDegradationTracking(),r>=t}},Yc=qc,Jc=Yc;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Qc={APP_LAUNCH:"app_launch",APP_INITIALIZED:"app_initialized",ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",USE_ITEM:"use_item",EARN_ITEM:"earn_item",GET_FREE_ITEM:"get_free_item",SHARE:"share",INVITE:"invite",MESSAGE:"message",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_INIT:"ad_init",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOWING:"ad_showing",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",SWITCH_GAME_POPUP:"switch_game_popup",SWITCH_GAME:"switch_game"},D=Qc;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Xc=class{history=[];missing=[];outOfOrder=[];completed=!1;failed=!1;warned=[];debug=!1;addEvent(e,t){if(this.completed||this.failed){this.debugLog("Skip event:",e);return}this.history.push(e),this.validateAndUpdate(e)}validateAndUpdate(e){let t=this.validateFunnelState();if(t.hasFailed){this.failed=!0,this.logValidationError();return}t.hasWarnings&&this.handleWarnings(t.warnings),this.checkFunnelCompletion(e)}validateFunnelState(){let e={hasFailed:!1,hasWarnings:!1,warnings:[]},t=this.getCurrentSteps().filter(s=>s.t);for(let s=0;s<t.length;s++){let r=t[s],i=this.history.indexOf(r.name);if(i===-1)return this.missing=[r.name],e.hasFailed=!0,e;if(s>0){let f=t[s-1];if(this.history.indexOf(f.name)>i)return this.missing=[f.name],e.hasFailed=!0,e}}let a=this.validateDependencies();return a.length>0&&(e.hasWarnings=!0,e.warnings=a,this.outOfOrder=a),e}getCurrentSteps(){let e=this.history[this.history.length-1],t=this.funnelSteps.findIndex(a=>a.name===e);return this.funnelSteps.slice(0,t+1)}validateDependencies(){let e=[];return this.history.forEach((t,a)=>{let s=this.funnelSteps.find(i=>i.name===t);if(!s?.r?.length)return;let r=s.r.find(i=>!this.history.includes(i)||this.history.indexOf(i)>a);r&&!this.warned.includes(t)&&(e.push({event:t,missingDependency:r}),this.warned.push(t))}),e}checkFunnelCompletion(e){let t=this.funnelSteps[this.funnelSteps.length-1];e===t.name&&this.funnelSteps.filter(a=>a.t).every(a=>this.history.includes(a.name))&&(this.completed=!0,this.logCompletion())}handleWarnings(e){for(let t of e);}logValidationError(){let e=this.constructor.name;this.missing.length}logCompletion(){let e=this.constructor.name;this.outOfOrder.length>0}debugLog(...e){this.debug}isFunnelCompleted(){return this.completed}isFunnelFailed(){return this.failed}getEventHistory(){return[...this.history]}getMissingEvents(){return[...this.missing]}getOutOfOrderEvents(){return[...this.outOfOrder]}},lt=Xc,Zc=class extends lt{debug=!1;funnelSteps=[{name:D.AD_INIT,t:!0,i:{service:"adsense"},a:"Init adsense ad"},{name:D.AD_LOAD_FAILED,t:!1,i:{service:this.service},a:"Platform ad load failed (trigger for adsense)"},{name:D.AD_LOAD,t:!0,i:{service:"adsense"},a:"Start loading adsense ad"},{name:D.AD_LOAD_FAILED,t:!1,r:[D.AD_LOAD],i:{service:"adsense"},a:"Adsense ad load failed"},{name:D.AD_SHOWING,t:!0,r:[D.AD_LOAD],i:{service:"adsense"},a:"Adsense ad is showing"},{name:D.AD_SHOW,t:!1,r:[D.AD_SHOWING],i:{service:"adsense"},a:"Adsense ad shown successfully"},{name:D.AD_SHOW_FAILED,t:!1,r:[D.AD_SHOWING],i:{service:"adsense"},a:"Adsense ad show failed"},{name:D.AD_LOAD,t:!1,i:{service:"adsense"},a:"Preload adsense ad"}];get service(){return GameSDK?.getSDKName()??"Ludex"}addEvent(e,t){let{service:a}=t??{};!a||!(a==="adsense"||e===D.AD_LOAD_FAILED&&a==="platform")||super.addEvent(e,t)}},ed=Zc;n(),o(),l(),c(),d(),h(),u(),y(),p();var td=class extends lt{debug=!1;funnelSteps=[{name:D.APP_LAUNCH,t:!0,a:"Application launched"},{name:D.APP_INITIALIZED,t:!0,r:[D.APP_LAUNCH],a:"Application initialized"},{name:D.ENGINE_READY,t:!0,r:[D.APP_INITIALIZED],a:"Game engine initialized"},{name:D.LOAD_START,t:!0,r:[D.ENGINE_READY],a:"Start loading game assets"},{name:D.LOAD_COMPLETE,t:!0,r:[D.LOAD_START],a:"Game assets loaded completely"},{name:D.APP_READY,t:!0,r:[D.LOAD_COMPLETE],a:"Game is ready to play"}]},ad=td;n(),o(),l(),c(),d(),h(),u(),y(),p();var sd=class extends lt{debug=!1;funnelSteps=[{name:D.AD_INIT,t:!0,i:{service:this.service},a:"Init platform ad"},{name:D.AD_LOAD,t:!0,i:{service:this.service},a:"Start loading platform ad"},{name:D.AD_LOAD_FAILED,t:!1,r:[D.AD_LOAD],i:{service:this.service},a:"Platform ad load failed"},{name:D.AD_SHOWING,t:!0,r:[D.AD_LOAD],i:{service:this.service},a:"Platform ad is showing"},{name:D.AD_SHOW,t:!1,r:[D.AD_SHOWING],i:{service:this.service},a:"Platform ad shown successfully"},{name:D.AD_SHOW_FAILED,t:!1,r:[D.AD_SHOWING],i:{service:this.service},a:"Platform ad show failed"},{name:D.AD_LOAD,t:!1,i:{service:this.service},a:"Preload platform ad"}];get service(){return GameSDK?.getSDKName()??"Ludex"}addEvent(e,t){t?.service===this.service&&super.addEvent(e,t)}},rd=sd;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Utils:{String:Le,Valid:id}}=Ludex,nd=class{codex;name;color;options;selfLog;currentPath;constructor(e,t,a){this.codex=e,this.name=t,this.options=a,this.color=a.color||"#FFF",this.selfLog=a.log,this.currentPath="/"}event(e,t){this.logInfo("event",{name:e,payload:t});let a=this.formatEventName(e);this.processEvent(a,t)}logInfo(e,t){this.selfLog}pageview(e){let t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),document.title=t,this.event(D.PAGE_VIEW,{path_path:e,page_title:t})}levelStart(e,t,a){this.event(D.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e),game_mode:a?Le.toUpperCamelCase(a):void 0})}levelFail(e,t,a){this.event(D.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e),game_mode:a?Le.toUpperCamelCase(a):void 0})}levelRescue(e,t,a){this.event(D.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e),game_mode:a?Le.toUpperCamelCase(a):void 0})}levelComplete(e,t,a){this.event(D.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e),game_mode:a?Le.toUpperCamelCase(a):void 0})}initAdEvent(e){let{adService:t,state:a}=e;this.event(D.AD_INIT,{ad_service:t,state:a})}loadAdEvent(e){let{type:t,placement:a,service:s}=e;this.event(D.AD_LOAD,{ad_type:t,screen_name:a,ad_service:s})}showAdEvent(e){let{type:t,placement:a,service:s}=e;this.event(D.AD_SHOW,{ad_type:t,screen_name:a,ad_service:s})}loadInterstitialAd(e){let{placement:t,service:a}=e;this.loadAdEvent({type:"interstitial",placement:t,service:a})}showInterstitialAd(e){let{placement:t,service:a}=e;this.showAdEvent({type:"interstitial",placement:t,service:a})}loadRewardedVideoAd(e){let{placement:t,service:a}=e;this.loadAdEvent({type:"rewarded_video",placement:t,service:a})}showRewardedVideoAd(e){let{placement:t,service:a}=e;this.showAdEvent({type:"rewarded_video",placement:t,service:a})}receiveVideoReward(e){let{placement:t,service:a}=e;this.event(D.AD_REWARD,{screen_name:t,ad_service:a})}loadRewardedInterstitialAd(e){let{placement:t,service:a}=e;this.loadAdEvent({type:"rewarded_interstitial",placement:t,service:a})}showRewardedInterstitialAd(e){let{placement:t,service:a}=e;this.showAdEvent({type:"rewarded_interstitial",placement:t,service:a})}receiveInterstitialReward(e){let{placement:t,service:a}=e;this.event(D.AD_REWARD,{screen_name:t,ad_service:a})}loadAdFail(e){let{type:t,placement:a,service:s}=e;this.event(D.AD_LOAD_FAILED,{ad_type:t,screen_name:a,ad_service:s})}showAdFail(e){let{type:t,placement:a,service:s}=e;this.event(D.AD_SHOW_FAILED,{ad_type:t,screen_name:a,ad_service:s})}showingAd(e){let{type:t,placement:a,service:s}=e;this.event(D.AD_SHOWING,{ad_type:t,screen_name:a,ad_service:s})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}getLevelName(e){return`Level ${Le.padStart(e.toString(),5,"0")}`}getPageTitle(e){let t=e.split("/").pop();if(!id.isString(t))return e;let a=t.replace(/([-_\s.])/g," $1");return Le.toUpperCamelCase(a)}addGameModeToPageTitle(e){let{match:t}=this.codex,a=t.getMatchState(),{mode:s}=a;return s||(s="Normal"),`${Le.toUpperCamelCase(s)}::${e}`}},od=nd;Ludex.Plugins.Analytics={Events:D,BaseFunnel:lt,BaseAnalytics:od};var ld=class extends Ludex.Plugins.BasePlugin{analytics=[];placement="unknown";funnels=[];constructor(e){super(e),this.initFunnels()}add(e){let t=this.analytics.findIndex(a=>a.name===e.name);t!==-1?this.analytics[t]=e:this.analytics.push(e)}isActive(){return this.analytics.length>=1}initFunnels(){this.addFunnel(new ad),this.addFunnel(new ed),this.addFunnel(new rd)}addFunnel(e){this.funnels.push(e)}s(e,t){for(let a of this.funnels)a.addEvent(e,t)}pageview=e=>{if(!this.isActive())return;this.placement=e;let t=this.getPageByKey(e);for(let a of this.analytics)a.pageview(t);this.s(D.PAGE_VIEW)};event(e,t){if(this.isActive()){for(let a of this.analytics)a.event(e,t);this.s(e,t)}}levelStart(e,t,a){if(this.isActive()){for(let s of this.analytics)s.levelStart(e,t,a);this.s(D.LEVEL_START,{score:t,mode:a})}}levelRescue(e,t,a){if(this.isActive()){for(let s of this.analytics)s.levelRescue(e,t,a);this.s(D.LEVEL_RESCUE,{score:t,mode:a})}}levelFail(e,t,a){if(this.isActive()){for(let s of this.analytics)s.levelFail(e,t,a);this.s(D.LEVEL_END,{score:t,mode:a})}}levelComplete(e,t,a){if(this.isActive()){for(let s of this.analytics)s.levelComplete(e,t,a);this.s(D.LEVEL_END,{score:t,mode:a})}}async initAdEvent(e){if(this.isActive()){await this.codex.event.waitTo(D.APP_READY);for(let t of this.analytics)t.initAdEvent(e)}}loadInterstitialAd(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.loadInterstitialAd(t);this.s(D.AD_LOAD,t)}showInterstitialAd(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.showInterstitialAd(t);this.s(D.AD_SHOW,t)}loadRewardedVideoAd(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.loadRewardedVideoAd(t);this.s(D.AD_LOAD,t)}showRewardedVideoAd(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.showRewardedVideoAd(t);this.s(D.AD_SHOW,t)}receiveVideoReward(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.receiveVideoReward(t);this.s(D.AD_REWARD,t)}loadRewardedInterstitialAd(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.loadRewardedInterstitialAd(t);this.s(D.AD_LOAD,t)}showRewardedInterstitialAd(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.showRewardedInterstitialAd(t);this.s(D.AD_SHOW,t)}receiveInterstitialReward(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.receiveInterstitialReward(t);this.s(D.AD_REWARD,t)}loadAdFail(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.loadAdFail(t);this.s(D.AD_LOAD_FAILED,t)}showAdFail(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.showAdFail(t);this.s(D.AD_SHOW_FAILED,t)}showingAd(e){if(!this.isActive())return;let t=L(I({},e),{placement:this.placement});for(let a of this.analytics)a.showingAd(t);this.s(D.AD_SHOWING,t)}getPageByKey(e){let t=e;if(t.indexOf("_")>-1){let r=t.replace(/_/g,"-");return r=r.toLowerCase(),r}let a=t.length-1,s="";for(;a>0;){s=t.charAt(a);let r=isNaN(parseInt(s,10)),i=s===s.toUpperCase();r&&i&&(t=`${t.slice(0,a)}-${t.slice(a)}`),a--}return t.toLowerCase()}},cd=ld,dd=cd;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var hd=class{key;constructor(e){this.key=e}getKey(){return this.key}},ud=hd;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Decorator:ws}=Ludex.Utils,As=class{id;isMuteAll;masterVolume;audioClips;constructor(e){this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]=I(I({},this.audioClips[e]),t)}async play(e,t){let a=this.getAudioClip(e);if(a){let{audioPlayer:s}=a;this.playWithRealConfig(s,t)}else await this.loadAndPlay(e,t)}async loadAndPlay(e,t){let a=await this.onLoadAudio(e,t);if(!a)return;let{volume:s=1}=t||{};this.setAudioClip(e,{volume:s,audioPlayer:a}),this.playWithRealConfig(a,t)}playWithRealConfig(e,t){if(t){let{volume:a=1}=t;t.volume=this.masterVolume*a}e.play(t)}pause(e){let t=this.getAudioClip(e);if(!t)return!1;let{audioPlayer:a}=t;return a.pause(),!0}resume(e){let t=this.getAudioClip(e);if(!t)return!1;let{audioPlayer:a}=t;return a.resume(),!0}stop(e){let t=this.getAudioClip(e);if(!t)return!1;let{audioPlayer:a}=t;return a.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{let{audioPlayer:a,volume:s=1}=e;switch(t){case"play":a.play();break;case"pause":a.pause();break;case"resume":a.resume();break;case"stop":a.stop();break;case"mute":a.setVolume(0);break;case"unmute":case"setVolume":a.setVolume(this.masterVolume*s);break;default:throw new Error(`Unsupported function: ${t}`)}}catch{}}callAudioPlayers(e){let{Object:t}=Ludex.Utils,a=t.vals(this.audioClips);for(let s of a)this.queueAudioPlayer(s,e)}};W([ws.tryCatch(),ws.validateParams("string")],As.prototype,"loadAndPlay",1);var pd=As;Ludex.Plugins.Audio={BaseAudioPlayer:ud,BaseChannelManager:pd};var{Decorator:vs}=Ludex.Utils,Ds=class extends Ludex.Plugins.BasePlugin{firstChannelId;channels={};addChannel(e){let t=e.getId();this.channels[t]=e,this.firstChannelId||(this.firstChannelId=t)}getChannel(e){if(e===void 0)return this.channels[this.firstChannelId];let t=this.channels[e];if(!t)throw new Error(`Channel ${e} not found`);return t}async play(e,t,a){await this.getChannel(a).play(e,t)}pause(e,t){try{this.getChannel(t).pause(e)}catch{}}resume(e,t){try{this.getChannel(t).resume(e)}catch{}}stop(e,t){try{this.getChannel(t).stop(e)}catch{}}stopAll(e){try{this.getChannel(e).stopAll()}catch{}}mute(e){try{this.getChannel(e).muteAll()}catch{}}unmute(e){try{this.getChannel(e).unmuteAll()}catch{}}setVolume(e,t){try{this.getChannel(t).setVolume(e)}catch{}}getVolume(e){try{return this.getChannel(e).getVolume()}catch{return-1}}};W([vs.tryCatch(),vs.validateParams("string")],Ds.prototype,"play",1);var yd=Ds,fd=yd;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var gd={token:"",isRequesting:!1},md=gd,{Utils:{Object:wd}}=Ludex,Ad=class extends Ludex.Plugins.BasePlugin{init(){let{storage:e}=this.codex;e.addStorage("auth",md)}async requestToken(){let{storage:e}=this.codex;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);let t=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",t)}catch(t){if(wd.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token","")}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){let{storage:e}=this.codex;return e.getStorageData("auth","token")??""}},vd=Ad,Dd=vd;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Is=(e=>(e.SOLO="solo",e.TOURNAMENT="tournament",e.SHARE_INVITE="share_invite",e.MATCHING_GROUP="matching_group_match",e.CHALLENGE_FRIEND="challenge_friend_match",e))(Is||{}),Ce=Is;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Id=Sa,Ne=Id,{Configs:xd,Utils:{Array:Sd,Valid:Ed,Browser:Pd}}=Ludex,bd=class{codex;constructor(e){this.codex=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return Ed.isObject(e)}isTournamentEntryPoint(e){return Sd.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],e)}receiveContext(e,t,a){let{storage:s}=this.codex;s.setStorageData("context","contextId",e),this.isValidEntryPointData(a)&&s.setStorageData("context","entryPointData",a),this.isValidContextType(t)&&s.setStorageData("context","contextType",t)}async detectContextSessionType(){let{storage:e}=this.codex,t=e.getStorageData("context","entryPointData"),{type:a}=t??{},{SOLO:s,TOURNAMENT:r,MATCHING_GROUP:i,SHARE_INVITE:f,CHALLENGE_FRIEND:g}=Ce,m=s;a===r&&(m=r),a===i&&(m=i),(a===g||a===f)&&(m=g),m===s&&(xd.Core.FastCheckTournamentContext?m=this.fastCheckTournamentContext()||m:m=await this.outdatedCheckTournamentContext()||m),e.setStorageData("context","sessionContextType",m)}fastCheckTournamentContext(){let e=Pd.getQueryParams().entry_point;return typeof e!="string"||!this.isTournamentEntryPoint(e)?!1:Ce.TOURNAMENT}async outdatedCheckTournamentContext(){let{storage:e}=this.codex;if(!("getTournamentAsync"in GameSDK))return!1;try{let t=await GameSDK.getTournamentAsync();return e.setStorageData("context","contextId",t.getContextID()),t.getEndTime()>Date.now()/1e3?Ce.TOURNAMENT:!1}catch{return!1}}detectContextGameMode(){let{player:e,storage:t}=this.codex,a=t.getStorageData("context","entryPointData"),s=t.getStorageData("context","sessionContextType"),r=e.getPlayerId(),{matchId:i,playerId:f,opponentId:g=ce.playerId}=a??{},m=r===f,w=g===ce.playerId||[g,f].indexOf(r)>=0,{TOURNAMENT:A,MATCHING_GROUP:v,SHARE_INVITE:x,CHALLENGE_FRIEND:S}=Ce,P=Ne.SINGLE;s===A&&(P=Ne.TOURNAMENT),s===x&&!m&&(P=Ne.CHALLENGE_FRIEND),s===S&&i&&w&&(P=Ne.CHALLENGE_FRIEND),s===v&&(P=Ne.MATCHING_GROUP),t.setStorageData("context","contextGameMode",P)}},Ld=bd;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Cd=class extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e??"Player has finished match"}},xs=Cd;n(),o(),l(),c(),d(),h(),u(),y(),p();var Nd=class extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}},Xt=Nd,{Events:ct,Plugins:{Analytics:Ss},Utils:{Valid:Td}}=Ludex,Od=class{codex;constructor(e){this.codex=e}async processContextData(){let{player:e,storage:t,monitorError:a}=this.codex,s=t.getStorageData("context","contextId")??"",r=t.getStorageData("context","entryPointData")??{},i=t.getStorageData("context","sessionContextType")??"",{type:f,matchId:g,playerId:m,opponentId:w,playerScore:A,action:v}=r;v&&await this.processEntryPointAction(v);let x=e.isFirstSession();setTimeout(()=>{this.logUserAnalytics(x)},1e3);let{TOURNAMENT:S,SHARE_INVITE:P,MATCHING_GROUP:C,CHALLENGE_FRIEND:E}=Ce;if(i===S)try{await this.processTournamentModeAsync(s);return}catch{a?.sendException(new Error("Process Tournament Fail"),{contextId:s,isFirstSession:x,entryPointData:r,playerData:e.getPlayerData()})}if(i===E){if(f===P&&typeof m=="string"){await this.processChallengeFromPostAsync(m);return}if(f===E&&typeof g=="string"&&typeof m=="string"&&typeof w=="string"){await this.processChallengeFromMessageAsync({contextId:s,matchId:g,playerId:m,opponentId:w});return}}if(i===C&&typeof m=="string"&&typeof A=="number"){await this.processMatchingGroupModeAsync(m,A);return}if(x){await this.processSingleModeAsync(!0),e.loggedIn();return}this.switchToDashboardScene()}logUserAnalytics(e){try{let{player:t,analytics:a}=this.codex;if(e)a.event(Ss.Events.NEW_USER);else{let{coins:s}=t.getPlayerData().gameData;a.event(Ss.Events.RETURNING_USER,{coins:s})}}catch{}}async processEntryPointAction(e){try{let{player:t}=this.codex;switch(e){case"reset_data":t.setPlayerDataByName("score",0),t.setGameData({coins:0,level:1}),await t.syncProfileToServer();break;case"enable_debug":t.setPlayerDataByName("debug",!0);break;case"set_locale_en":this.requestSetLocale("en");break;case"set_locale_ru":this.requestSetLocale("ru");break}}catch{}}requestSetLocale(e){let{event:t}=this.codex;t.emit(ct.REQUEST_LANGUAGE,{locale:e})}async processTournamentModeAsync(e){let{match:t,player:a}=this.codex,s=a.getPlayerId();if(Td.isEmpty(e))throw new Error("Cannot get contextId");await t.tournament.continue.processAsync({playerId:s,contextId:e}),this.switchToGameScene()}async processChallengeFromPostAsync(e){let{match:t,player:a}=this.codex,s=a.getPlayerId();if(s===e)await t.single.start.processAsync({playerId:s});else try{await t.challenge.friend.processAsync({playerId:s,opponentId:e})}catch{await t.single.start.processAsync({playerId:s})}this.switchToGameScene()}async processChallengeFromMessageAsync(e){try{await this.processContinueChallengeFromMessageAsync(e)}catch(t){if(t instanceof xs){await this.processAwaitChallengeFromMessageAsync(e);return}if(t instanceof Xt){await this.processJoinChallengeFromMessageAsync(e);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(e){let{contextId:t,matchId:a,playerId:s,opponentId:r}=e,{match:i,player:f}=this.codex,g=f.getPlayerId();if(s===g)await i.challenge.continue.processAsync({contextId:t,matchId:a,playerId:g,opponentId:r});else{let m=r===ce.playerId;await i.challenge.continue.processAsync({contextId:t,matchId:a,playerId:g,opponentId:m?r:s})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(e){let{contextId:t,matchId:a,playerId:s}=e,{match:r,player:i}=this.codex,f=i.getPlayerId();await r.challenge.join.processAsync({contextId:t,matchId:a,playerId:f,opponentId:s}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(e){let{contextId:t,matchId:a,playerId:s}=e,{match:r,player:i}=this.codex,f=i.getPlayerId();try{await r.challenge.await.processAsync({contextId:t,matchId:a,playerId:f,opponentId:s}),this.switchToChallengeResultScene()}catch{await this.processResultChallengeFromMessageAsync(e)}}async processResultChallengeFromMessageAsync(e){let{contextId:t,matchId:a,playerId:s}=e,{match:r,player:i}=this.codex,f=i.getPlayerId();try{await r.challenge.result.processAsync({contextId:t,matchId:a,playerId:f,opponentId:s}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(e,t){let{match:a,player:s}=this.codex;await a.group.join.processAsync({playerId:s.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processSingleModeAsync(e){let{match:t,player:a}=this.codex,s=a.getPlayerId();e&&await t.handler.setMatchCustomData({playerId:s,contextId:"SOLO"}),await t.single.start.processAsync({playerId:s}),this.switchToGameScene()}switchToDashboardScene(){let{event:e}=this.codex;e.emit(ct.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}switchToGameScene(){let{event:e}=this.codex;e.emit(ct.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}switchToChallengeResultScene(){let{event:e}=this.codex;e.emit(ct.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}},_d=Od;n(),o(),l(),c(),d(),h(),u(),y(),p();var Rd={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},Es=Rd,{Events:ze}=Ludex,Md=class extends Ludex.Plugins.BasePlugin{context;loader;constructor(e){super(e),this.loader=new _d(e),this.context=new Ld(e)}init(){let{storage:e}=this.codex;e.addStorage("context",Es)}getSessionContextTypes(){return Ce}async processContextData(){let{event:e,monitorError:t}=this.codex;try{e.getEventEmitCount(ze.CONTEXT_SESSION_TYPE_DETECTED)>0||await e.waitTo(ze.CONTEXT_SESSION_TYPE_DETECTED,3e3),await this.loader.processContextData(),e.emit(ze.CONTEXT_DATA_PROCESSED)}catch(a){if(this.switchToDashboardScene(),t){let s=a instanceof Error?a:new Error(JSON.stringify(a));t.sendException(s)}}}async detectContextSessionType(){let{event:e,monitorError:t}=this.codex;try{await this.context.detectContextSessionType(),e.emit(ze.CONTEXT_SESSION_TYPE_DETECTED)}catch(a){if(t){let s=a instanceof Error?a:new Error(JSON.stringify(a));t.sendException(s)}}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(e,t,a){this.context.receiveContext(e,t,a)}switchToDashboardScene(){let{event:e}=this.codex;e.emit(ze.SWITCH_SCENE,{sceneName:"DashboardScene"})}},Fd=Md;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:Zt}=Ludex.Utils,{contextId:kd,contextType:Gd,entryPointData:Bd}=Es,ea="is invalid",Ps=class extends le{data;setupData(e){this.d(e)}n(e){this.l(e)}o(e){this.c(e)}validateContextId(e){Zt.isString(e)||this.e("contextId",ea)}validateContextType(e){(!Zt.isString(e)||!e)&&this.e("contextType",ea)}validateEntryPointData(e){Zt.isObject(e)||this.e("entryPointData",ea)}toObject(){return super.toObject()}};Ps.addDefaultData({contextId:kd,contextType:Gd,entryPointData:Bd});var Ud=Ps;Ludex.Dtos.Context={Info:Ud};var jd=Fd;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Hd={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},$d=Hd,{Object:Vd}=Ludex.Utils,Kd=class{async getDailyRewardsAsync(){return Vd.vals($d)}},Wd=Kd;n(),o(),l(),c(),d(),h(),u(),y(),p();var zd={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},K=zd;n(),o(),l(),c(),d(),h(),u(),y(),p();var qd={dailyRewards:{}},Yd=qd,{Configs:{DailyRewards:{CheckInterrupt:bs,MaxDays:Ls,MockTime:Cs}},Utils:{Array:ta,Valid:Te}}=Ludex,dt=Cs>0?Cs:864e5,Jd=class extends Ludex.Plugins.BasePlugin{dailyRewardsApi=new Wd;init(){let{storage:e}=this.codex;e.addStorage("dailyRewards",Yd)}async requestDailyRewardsAsync(){let e=await this.dailyRewardsApi.getDailyRewardsAsync(),{logs:t,rewards:a}=this.parseDailyRewards(e);this.setRewardsLog(t),this.setDailyRewards(a)}getDailyRewards(){let{storage:e}=this.codex;return e.getStorageData("dailyRewards","dailyRewards")||null}logLoginReward(){bs?this.logFromFirstReward():this.logFromLastReward()}logFromFirstReward(){let{player:e}=this.codex,{dailyRewardedData:t}=e.getPlayerData();if(!Te.isObject(t))return;let{logDays:a,firstReward:s}=t,r=new Date,i=[...a];if(s===0){i[0]=!0,Te.isDebugger()||r.setHours(0,0,0,0),this.setRewardsLog({logDays:i,firstReward:r.valueOf(),lastReward:r.valueOf()});return}let f=r.valueOf()-s,g=Math.floor(f/dt);g>=Ls||g>=a.length||(i[g]=!0,Te.isDebugger()||r.setHours(0,0,0,0),this.setRewardsLog({logDays:i,lastReward:r.valueOf()}))}logFromLastReward(){let{player:e}=this.codex,{dailyRewardedData:t}=e.getPlayerData();if(!Te.isObject(t))return;let{logDays:a,lastReward:s}=t,r=new Date,i=[...a];if(s===0){i[0]=!0,Te.isDebugger()||r.setHours(0,0,0,0),this.setRewardsLog({logDays:i,firstReward:r.valueOf(),lastReward:r.valueOf()});return}let f=r.valueOf()-s;if(Math.floor(f/dt)<1)return;let g=ta.searchIndex(i,m=>m===!1);g!==void 0&&(i[g]=!0,Te.isDebugger()||r.setHours(0,0,0,0),this.setRewardsLog({logDays:i,lastReward:r.valueOf()}))}setRewardsLog(e){let{logDays:t,firstReward:a,lastReward:s}=e,{player:r}=this.codex,{dailyRewardedData:i}=r.getPlayerData();Te.isObject(i)&&(this.isSameLog(i,e)||r.setPlayerDataByName("dailyRewardedData",{logDays:t!==void 0?[...t]:[...i.logDays],firstReward:a??i.firstReward,lastReward:s??i.lastReward}))}isSameLog(e,t){if(t.firstReward!==void 0&&e.firstReward!==t.firstReward||t.lastReward!==void 0&&e.lastReward!==t.lastReward)return!1;if(t.logDays!==void 0){if(e.logDays.length!==t.logDays.length)return!1;for(let a=0;a<t.logDays.length;a++)if(e.logDays[a]!==t.logDays[a])return!1}return!0}parseDailyRewards(e){let{player:t}=this.codex,{dailyRewardedData:a}=t.getPlayerData(),{logDays:s,firstReward:r,lastReward:i}=a??{};if(s===void 0||r===void 0||r===0||i===void 0||i===0||s.length!==e.length){let f=this.getDefaultDailyRewards(e);return{logs:{logDays:f.logDays,firstReward:0,lastReward:0},rewards:f.rewards}}return bs?this.parseFromFirstReward(e,s,r,i):this.parseFromLastReward(e,s,r,i)}parseFromFirstReward(e,t,a,s){let r=Date.now()-a;if(r<0){let A=this.getDefaultDailyRewards(e);return{logs:{logDays:A.logDays,firstReward:0,lastReward:0},rewards:A.rewards}}let i=Math.floor(r/dt),f=i>=Ls||i>=t.length,g=ta.search(t.slice(0,i),A=>A===!1)!==void 0;if(f||g){let A=this.getDefaultDailyRewards(e);return{logs:{logDays:A.logDays,firstReward:0,lastReward:s},rewards:A.rewards}}let m=[],w={};for(let A=0;A<e.length;A++){let v=e[A],x=m.length>i,S=m.length===i,P=t[A];if(x){m.push(!1),w[v.id]=L(I({},v),{status:K.WAITING});continue}if(m.push(P),S){w[v.id]=L(I({},v),{status:P?K.REWARDED:K.READY});continue}w[v.id]=L(I({},v),{status:P?K.REWARDED:K.SKIPPED})}return{logs:{logDays:m,firstReward:a,lastReward:s},rewards:w}}parseFromLastReward(e,t,a,s){let r=Date.now()-s;if(r<0){let w=this.getDefaultDailyRewards(e);return{logs:{logDays:w.logDays,firstReward:0,lastReward:0},rewards:w.rewards}}let i=Math.floor(r/dt)>=1,f=ta.searchIndex(t,w=>w===!1);if(f===-1&&i){let w=this.getDefaultDailyRewards(e);return w.rewards[e[0].id].status=i?K.READY:K.WAITING,{logs:{logDays:w.logDays,firstReward:0,lastReward:s},rewards:w.rewards}}let g=[],m={};for(let w=0,A=e.length;w<A;w++){let v=e[w],x=f!==-1&&w>f,S=w===f;if(x){g.push(!1),m[v.id]=L(I({},v),{status:K.WAITING});continue}if(S){g.push(!1),m[v.id]=L(I({},v),{status:i?K.READY:K.WAITING});continue}g.push(!0),m[v.id]=L(I({},v),{status:K.REWARDED})}return{logs:{logDays:g,firstReward:a,lastReward:s},rewards:m}}getDefaultDailyRewards(e){let t=[],a={};for(let s of e)t.push(!1),a[s.id]=L(I({},s),{status:K.WAITING});return a[e[0].id].status=K.READY,{logDays:t,rewards:a}}setDailyRewards(e){let{storage:t}=this.codex;t.setStorageData("dailyRewards","dailyRewards",e)}},Qd=Jd,Xd=Qd;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Zd=Ur(Hr(),1),eh=Zd.default,th=new eh,Oe=th;n(),o(),l(),c(),d(),h(),u(),y(),p();var ah={names:[],history:[]},sh=ah,{Utils:{Decorator:we}}=Ludex,he=class extends Ludex.Plugins.BasePlugin{enableLog=!1;muteEvents=[];init(){let{storage:e}=this.codex;e.addStorage("event",sh)}enableLogEvent(){this.enableLog=!0}on(e,t){this.addEventName(e),this.addHistory(e,"on","listening"),Oe.on(e,t)}once(e,t){this.addEventName(e),this.addHistory(e,"once","listening"),Oe.once(e,t)}waitTo(e,t){return new Promise((a,s)=>{let r,i=f=>{clearTimeout(r),a(f)};this.once(e,i),t&&t>0&&(r=setTimeout(()=>{this.off(e,i),s(new Error(`Event ${e} timeout`))},t))})}catchUp(e,t){if(this.once(e,t),!(this.getEventEmitCount(e)>0))return;let{payload:a}=this.getLastEventInfo(e)??{};this.emit(e,a)}off(e,t){Oe.off(e,t),this.addHistory(e,"action","removed")}mute(e){this.muteEvents.indexOf(e)>-1||this.muteEvents.push(e)}clear(e){Oe.removeAllListeners(e),this.addHistory(e,"action","removed")}emit(e,t){if(this.muteEvents.indexOf(e)>-1)return;let a=[];t&&(a=[t]),this.addHistory(e,"action","called",t),Oe.emit(e,...a)}addEventName(e){let{storage:t}=this.codex,a=t.getStorageData("event","names");a&&a.indexOf(e)<0&&a.push(e)}limitHistory(e){if(e.length<=1e4)return e;let{Utils:{Array:t}}=Ludex;return t.limit(e,1e4)}getEventListeners(e){return this.getHistory().filter(t=>t.name===e&&t.status==="listening").map(t=>t.name)}getHistory(){let{storage:e}=this.codex,t=e.getStorageData("event","history")??[];return this.limitHistory(t)}getEventEmitCount(e){return this.getHistory().filter(t=>t.name===e&&t.status==="called").length}getLastEventInfo(e){let t=this.getHistory(),a=null;for(let s=t.length-1;s>=0;s--)if(t[s].name===e){a=t[s];break}return a}getTypeFromHistory(e){return this.getLastEventInfo(e)?.type??null}getCallsFromHistory(e){return this.getLastEventInfo(e)?.called??0}addHistory(e,t,a,s){let r=this.getTypeFromHistory(e)??t,i=this.getCallsFromHistory(e),f=a==="called"?i+1:i;this.getHistory().push({type:r,status:a,name:e,called:f,payload:s??{}}),this.logEventInfo(e,r,a,f)}logEventInfo(e,t,a,s){this.enableLog&&(a==="listening"&&Oe.listenerCount(e)>1,a==="called"&&Oe.listenerCount(e)<=0)}};W([we.validateParams("string","function")],he.prototype,"on",1),W([we.validateParams("string","function")],he.prototype,"once",1),W([we.validateParams("string")],he.prototype,"waitTo",1),W([we.validateParams("string","function")],he.prototype,"catchUp",1),W([we.validateParams("string","function")],he.prototype,"off",1),W([we.validateParams("string")],he.prototype,"mute",1),W([we.validateParams("string")],he.prototype,"clear",1),W([we.validateParams("string")],he.prototype,"emit",1);var rh=he,ih=rh;ee(),ee(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var nh=class extends Error{locale;constructor(e){super(`Locale "${e}" not found`),this.name="LocaleNotFoundError",this.locale=e}},Ns=nh;n(),o(),l(),c(),d(),h(),u(),y(),p();var oh=class extends Error{key;locale;constructor(e,t){let a=String(e);super(`Text with key "${a}" not found in locale "${t}"`),this.name="MissingKeyInLocaleError",this.key=a,this.locale=t}},aa=oh,{Utils:{Object:sa,Function:Ts,Browser:lh},Configs:{Languages:{DetectPlayerLocale:ch}}}=Ludex,dh=class extends Ludex.Plugins.BasePlugin{locale;fallbackLocale;data={};setFallbackLocale(e){this.fallbackLocale=e}hasTextKey(e,t){let a=t??this.getCurrentLocale(),{text:s}=this.getLocaleData(a);return sa.hasOwn(s,e)}hasTextureKey(e,t){let a=t??this.getCurrentLocale(),{texture:s}=this.getLocaleData(a);return sa.hasOwn(s,e)}add(e,t,a=!1){this.data[e]=t,a&&this.setFallbackLocale(e)}choose(e){this.locale=e;let{event:t}=this.codex;t.emit(Ludex.Events.LANGUAGE_CHANGED,{locale:e})}getText(e,t,a,s=!1){try{return this.uncaughtGetText(e,t,a,!s)}catch(r){return r instanceof aa||r instanceof Ns,String(e)}}getTexture(e,t,a=!1){return this.uncaughtGetTexture(e,t,!a)}uncaughtGetText(e,t=[],a,s=!0){if(!s||this.fallbackLocale===void 0){let f=this.getRawText(e,a??this.getCurrentLocale());return this.replaceVariables(f,t)}let r=this.fallbackLocale,i=Ts.retry(()=>this.getRawText(e,a??this.getCurrentLocale()),()=>this.getRawText(e,r));return this.replaceVariables(i,t)}getRawText(e,t){if(!this.hasTextKey(e,t))throw new aa(e,t);let{text:a}=this.getLocaleData(t);return a[e]}uncaughtGetTexture(e,t,a=!0){if(!a||this.fallbackLocale===void 0)return this.getRawTexture(e,t??this.getCurrentLocale());let s=this.fallbackLocale;return Ts.retry(()=>this.getRawTexture(e,t??this.getCurrentLocale()),()=>this.getRawTexture(e,s))}getRawTexture(e,t){if(!this.hasTextureKey(e,t))throw new aa(e,t);let{texture:a}=this.getLocaleData(t);return a[e]}getCurrentLocale(){return this.locale??"en"}getLocaleData(e){let t=e??this.getCurrentLocale();if(!sa.hasOwn(this.data,t))throw new Ns(t);return this.data[t]}replaceVariables(e,t){let a=t.length;if(a===0)return e;let s=e;for(let r=0;r<a;r++){let i=t[r],f=`%{${r}}`;s=s.replace(f,i)}return s}getPlayerLanguage(){let{player:e}=this.codex,t=GameSDK.getLocale()?.trim().split(/[-_]/)[0],a=this.getBrowserLanguage();return t!==a?t??a:e.isFirstSession()?a:e.getPlayerSetting("language")??a}getBrowserLanguage(){return ch===!1?"en":lh.getLocale()?.trim()?.split(/[-_]/)[0]}},hh=dh,uh=hh;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var ph={_id:"",name:"",createdBy:"",description:"",expireTime:6048e5,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15},yh=ph,{Configs:{OtherHost:qe,Mockup:Ye,AppId:fh},Utils:{Object:Je,String:Os,Valid:_s}}=Ludex,gh=class{mockAPI;async initMockAPI(){if(this.mockAPI)return;let e=(await import("./chunks-M5N4UHHN.js")).default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new e}async getLeadersAsync(e,t,a){let s=Os.params(a),r;return Ye.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in a?r=await this.mockAPI.getPlayers(e,a):r=await this.mockAPI.getLeaders(e,a)):r=await Ge(`${t}?${s}`,{},qe),!Je.hasOwn(r,"data")||!Array.isArray(r.data)?[]:r.data}async getLeaderboardAsync(e){let t,a=`leaderboards/${e}`;return Ye.Leaderboards.Enabled?(await this.initMockAPI(),t=await this.mockAPI.getLeaderboardAsync(e)):(t=await Ge(a,{},qe),Je.hasOwn(t,"data")&&_s.isObject(t.data)&&(t=t.data)),t}async getLeaderboardsAsync(e){let t,a=Ludex.Utils.String.params(e);return Ye.Leaderboards.Enabled?(await this.initMockAPI(),t=await this.mockAPI.getLeaderboardsAsync(e)):(t=await Ge(`leaderboards?${a}`,{},qe),Je.hasOwn(t,"data")&&Array.isArray(t.data)?t=t.data:t=[]),t}async setLeaderboardScoreAsync(e){let{leaderboardId:t,playerId:a,score:s}=e;Ye.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(t,a,s)):await te(`leaderboards/${t}/players/${a}`,{score:s},{},qe)}async createLeaderboardAsync(e){let t=e._id??Os.generateObjectId(),a=e.numberOfLeaders,s=L(I(I({},yh),e),{_id:t,appId:fh,numberOfLeaders:a}),r="leaderboards",i;if(Ye.Leaderboards.Enabled?(await this.initMockAPI(),i=await this.mockAPI.createLeaderboard(s)):(i=await te(r,s,{},qe),Je.hasOwn(i,"data")&&_s.isObject(i.data)&&(i=i.data)),!Je.hasOwn(i,"_id")||i._id!==t)throw new Error("Create leaderboard failed");return t}},mh=gh;n(),o(),l(),c(),d(),h(),u(),y(),p();var wh={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},Rs=wh;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ah={leaderboards:{}},vh=Ah,{Utils:{Array:Dh,Valid:Ih,Json:Ms,Object:ht}}=Ludex,xh=class extends Ludex.Plugins.BasePlugin{lbAPI=new mh;configs;init(){let{storage:e}=this.codex;e.addStorage("leaderboard",vh),this.configs={}}addLeaderboard(e){let{name:t,type:a,leaderboardId:s,autoSortRank:r}=e;if(this.getLeaderboard(t))return;let i=`leaderboards/${s}/`;(a==="global"||a==="tournament")&&(i+="leaders"),a==="friends"&&(i+="players"),this.configs[t]={id:s,name:t,type:a,host:i,autoSortRank:r};let f=Ms.clone(Rs);this.setLeaderboard(t,I({},f))}async requestLeaderboardsAsync(e){try{return await this.lbAPI.getLeaderboardsAsync(e)}catch{return[]}}async requestLeaderboardAsync(e,t){try{this.validateLeaderboard(e),this.clearLeaderboard(e),this.setLeaderboard(e,{isRequesting:!0});let{id:a,type:s,host:r}=this.configs[e],i=[];if(s==="friends"){let{player:f}=this.codex,g=f.getPlayerId(),m=f.getConnectedPlayerIds(t,0),w=[g,...m];this.configs[e].playerIds=[...w],i=await this.lbAPI.getLeadersAsync(a,r,{playerIds:w})}else i=await this.lbAPI.getLeadersAsync(a,r,{limit:t,offset:0});if(i.length===0)return;await this.receiveLeaderboardAsync(e,i),this.setLeaderboard(e,{limit:t,offset:0})}finally{let a=await this.lbAPI.getLeaderboardAsync(this.configs[e].id),s=a?a.resettable:"",r=a?a.amountPlayer:0;this.setLeaderboard(e,{isRequesting:!1,resettable:s,amountPlayer:r})}}async loadMoreLeaderboardAsync(e,t){let a=this.getLeaderboard(e);if(a){if(this.configs[e].type==="friends")return;try{this.setLeaderboard(e,{isRequesting:!0});let{id:s,host:r}=this.configs[e],{offset:i,limit:f}=a,g=i+f,m=await this.lbAPI.getLeadersAsync(s,r,{limit:t,offset:g});if(m.length===0)return;this.receiveLeaderboardAsync(e,m),this.setLeaderboard(e,{limit:t,offset:g})}finally{this.setLeaderboard(e,{isRequesting:!1})}}}getLeaderboard(e){let{storage:t}=this.codex,a=t.getStorageData("leaderboard","leaderboards");return!a||!a[e]?null:a[e]}async getLeadersByPlayerIdsAsync(e,t){try{this.validateLeaderboard(e);let{id:a}=this.configs[e],s=`leaderboards/${a}/players`,r=await this.lbAPI.getLeadersAsync(a,s,{playerIds:t});return r.length===0?[]:this.toLeaders(r)}catch{return[]}}async getLeaderboardResponseAsync(e){return await this.lbAPI.getLeaderboardAsync(e)}clearLeaderboard(e){try{this.validateLeaderboard(e);let t=Ms.clone(Rs);this.setLeaderboard(e,null),this.setLeaderboard(e,I({},t))}catch{}}isLeaderboardEmpty(e){let t=this.getLeaderboard(e);if(!t)return!0;let{leaders:a}=t;return Object.keys(a).length===0}isExistLeaderboardId(e){let{configs:t}=this;return ht.vals(t).some(a=>a.id===e)}getLeaderboardName(e){let{configs:t}=this,a=Dh.search(ht.vals(t),s=>s.id===e);return a?a.name:null}async setLeaderboardScoreAsync(e,t,a){try{if(GameSDK.extra.isGuest)return;this.validateLeaderboard(e);let{id:s}=this.configs[e],r=await this.getLastScoreOnLeaderboard(e,t);if(r&&a<=r)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:s,playerId:t,score:a})}catch{}}async getLastScoreOnLeaderboard(e,t){let a=await this.getLeadersByPlayerIdsAsync(e,[t]);return a.length===0?null:a[0].score}async createLeaderboardAsync(e){return this.lbAPI.createLeaderboardAsync(e)}validateLeaderboard(e){let t=this.getLeaderboard(e);if(!Ih.isObject(t))throw new Error(`Leaderboard with name ${e} not found`)}setLeaderboard(e,t){if(!t)return;let{storage:a}=this.codex;a.setStorageData("leaderboard","leaderboards",{[e]:t})}async receiveLeaderboardAsync(e,t){this.validateLeaderboard(e);let a=(await this.toLeaders(t)).filter(m=>m.name&&m.photo),{leaders:s={}}=this.getLeaderboard(e)??{},r=a.filter(m=>s[m.playerId]?(s[m.playerId]=m,!1):!0),i=ht.vals(s);r.length>0&&i.unshift(...r);let f=i.sort((m,w)=>w.score-m.score);this.configs[e].autoSortRank&&(f=f.map((m,w)=>L(I({},m),{rank:w+1})));let g=ht.keyBy(f,"playerId");this.setLeaderboard(e,{leaders:g})}async toLeaders(e){let{profile:t}=this.codex,a=e.map(r=>r.playerId);await t.requestProfiles(a);let s=t.getProfiles();return e.map(r=>{let{playerId:i}=r,f=s[i];if(!f){let{language:g}=this.codex,m=g.getText("core.nameless")??"Nameless";return L(I({},r),{name:m,photo:"default"})}return L(I({},r),{name:f.name,photo:f.photo})}).map(r=>L(I({},r),{score:parseInt(r.score,10)}))}},Sh=xh,Eh=Sh;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Ph=class{APIHost;setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}},bh=Ph,{Utils:Fs}=Ludex,Lh=class extends bh{async createSingleMatchAsync(e){let t=await te("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(t)}async getSingleMatchDetailAsync(){let e=await Ge("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(e)}async updateSingleMatchMoveAsync(e,t){let a=`single-matches/${e}/move`,s=await te(a,t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishSingleMatchAsync(e){let t=`single-matches/${e}/finish`,a=await te(t,{},{},this.getAPIHost());return this.returnValidMatchData(a)}async createMatchAsync(e){let t=await te("matches",e,{},this.getAPIHost());return this.returnValidMatchData(t)}async joinMatchAsync(e){let t=`matches/${e}/join`,a=await te(t,{},{},this.getAPIHost());return this.returnValidMatchData(a)}async getMatchDetailByIdAsync(e){let t=`matches/${e}`,a=await Ge(t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishMatchAsync(e){let{matchId:t="",score:a=0,level:s=0,extraData:r={}}=e,i=`matches/${t}/finish`,f=await te(i,{matchId:t,score:a,level:s,extraData:r},{},this.getAPIHost());return this.returnValidMatchData(f)}returnValidMatchData(e){return Fs.Valid.isObject(e)?Fs.Object.hasOwn(e,"data")?e.data??{}:{}:{}}},Ch=Lh,Nh=class{matchAPI;constructor(e){this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new Ch}setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}setMatchAPIInstance(e){this.matchAPI=e}getMatchAPI(){return this.matchAPI}},Th=Nh;n(),o(),l(),c(),d(),h(),u(),y(),p();var Oh=class{codex;match;constructor(e,t){this.codex=e,this.match=t}startLog(e){this.match.useCPUProfile}endLog(){this.match.useCPUProfile}async processAsync(e){throw new Error("Not implemented")}},O=Oh;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Object:_h,Valid:Qe,Json:Rh}=Ludex.Utils,Mh=class{codex;match;nextHandler;stateData;constructor(e){this.codex=e.codex,this.match=e.match,this.nextHandler=null,this.stateData={Before:null,After:null}}setNext(e){return this.nextHandler=e,e}async processAsync(e){this.u("Before",e)}async nextAsync(e){this.u("After",e),this.y(),this.nextHandler&&await this.nextHandler.processAsync(e)}u(e,t){if(!Qe.isDebugger())return;this.stateData[e]=Rh.clone(t);let a=t,{profiles:s,customData:r}=a,i=va(a,["profiles","customData"])}y(){let{After:e,Before:t}=this.stateData;if(!e||!t)return;let a=_h.diff(t,e);if(!Qe.isEmpty(a)){let s=a,{profiles:r={},customData:i={}}=s,f=va(s,["profiles","customData"]);Qe.isEmpty(f),Qe.isEmpty(r),Qe.isEmpty(i)}this.stateData.After=null,this.stateData.Before=null}},b=Mh,Fh=class extends b{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}},F=Fh;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var kh=class extends de{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}},ks=kh;n(),o(),l(),c(),d(),h(),u(),y(),p();var Gh=class extends de{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}},ra=Gh,{Plugins:Bh,Utils:Uh}=Ludex,{Analytics:jh}=Bh,{String:Gs,Valid:Bs}=Uh,Hh=class extends b{async processAsync(e){super.processAsync(e);let{mode:t,customData:a}=e,{level:s}=a;this.validateMode(t),this.validateLevel(s);let{analytics:r}=this.codex;r.event(jh.Events.MATCH_START,{level:s,game_mode:Gs.toUpperCamelCase(t),level_name:this.getLevelName(s)}),await this.nextAsync(e)}validateMode(e){if(!Bs.isString(e))throw new ra}validateLevel(e){if(!Bs.isNumber(e))throw new ks}getLevelName(e){return`Level ${Gs.padStart(e.toString(),5,"0")}`}},X=Hh;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var $h={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},H=$h,Vh=class extends b{async processAsync(e){super.processAsync(e);let{mode:t,status:a}=e,s=t??Ne.SINGLE;a===H.FINISHED&&(s=Ne.SINGLE),this.contextGameModeDetected(s),await this.nextAsync(e)}contextGameModeDetected(e){let{storage:t}=this.codex;t.setStorageData("context","contextGameMode",e)}},G=Vh;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Kh=class extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}},ia=Kh;n(),o(),l(),c(),d(),h(),u(),y(),p();var Wh=class extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}},Us=Wh;n(),o(),l(),c(),d(),h(),u(),y(),p();var zh=class extends de{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}},ue=zh;n(),o(),l(),c(),d(),h(),u(),y(),p();var qh=class extends Error{constructor(e){super(e),this.name="OpponentHasFinishedMatch",this.message=e||"Opponent has finished match"}},Yh=qh;n(),o(),l(),c(),d(),h(),u(),y(),p();var Jh=class extends de{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}},q=Jh;n(),o(),l(),c(),d(),h(),u(),y(),p();var Qh=class extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e??"The player is not currently in this match"}},na=Qh;n(),o(),l(),c(),d(),h(),u(),y(),p();var Xh=class extends Error{constructor(e){super(e),this.name="PlayerNotFinishedMatch",this.message=e||"Player not finished match"}},js=Xh,{Dtos:Zh,Utils:{Object:eu}}=Ludex,tu=class extends b{async processAsync(e){super.processAsync(e),this.validateMatchData(e);let t=await this.getMatchAsync(e),a=new Zh.Match.Data(t).toObject();this.validateAwaitMatchData(e,a),this.updateMatchData(e,a),this.validateMatchStatus(e),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){let{id:t}=e;if(typeof t!="string")throw new ue}validateMatchStatus(e){let{status:t}=e;if(t!==H.ACTIVE)throw new Us}validateAwaitMatchData(e,t){let{id:a,customData:s}=e,{_id:r,whitePlayerId:i,blackPlayerId:f}=t;if(typeof r!="string"||r!==a)throw new ia;let{playerId:g}=s,m=i===g,w=f===g;if(!m&&f===ce.playerId)throw new Xt;if(!m&&!w)throw new na}validatePlayerTurn(e){let{profiles:t,customData:a}=e,{playerId:s}=a;if(typeof s!="string")throw new N;let{finished:r}=t[s];if(!r)throw new js}validateOpponentTurn(e){let{profiles:t,customData:a}=e,{opponentId:s}=a;if(typeof s!="string")throw new q;let{finished:r}=t[s];if(r)throw new Yh}async getMatchAsync(e){let{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}updateMatchGeneral(e,t){let{status:a,extraData:s}=t;e.status=a,e.customData=eu.merge(e.customData,s)}updatePlayerIds(e,t){let{whitePlayerId:a,blackPlayerId:s}=t,r=a===e.customData.playerId;e.customData.playerId=r?a:s,e.customData.opponentId=r?s:a}initializeProfiles(e){let{playerId:t,opponentId:a}=e.customData;if(!t||!a)return;let s={name:"",photo:"",finished:!1};e.profiles[t]||(e.profiles[t]=I({id:t},s)),e.profiles[a]||(e.profiles[a]=I({id:a},s))}updateScoresAndStatus(e,t){let{playerId:a,opponentId:s}=e.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerScore:i,whitePlayerFinish:f,blackPlayerScore:g,blackPlayerFinish:m}=t,w=r===a;e.profiles[a].score=w?i:g,e.profiles[s].score=w?g:i,e.profiles[a].finished=w?f:m,e.profiles[s].finished=w?m:f}},au=tu;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var su={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},oa=su,ru=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.initializeMatch(e),await this.nextAsync(e)}initializeMatch(e){let{id:t,mode:a,customData:s}=this.payload;e.id=t??null,e.mode=a||null,e.status=H.OPEN,e.startAt=0,e.finishAt=0,e.profiles={},e.customData=I(I(I({},oa),e.customData),s)}},Y=ru;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var iu=Ce,_e=iu;n(),o(),l(),c(),d(),h(),u(),y(),p();var nu=class extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}},_=nu;n(),o(),l(),c(),d(),h(),u(),y(),p();var ou=class extends de{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}},se=ou;n(),o(),l(),c(),d(),h(),u(),y(),p();var lu=class extends de{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}},k=lu,cu=class extends b{async processAsync(e){super.processAsync(e),this.validateData(e);let t=await this.createWideframesAwaitingAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){let{id:t,customData:a}=e,{contextId:s,opponentId:r}=a;if(!t||typeof t!="string")throw new ue;if(!s||typeof s!="string")throw new se;if(!r||typeof r!="string")throw new q}async createWideframesAwaitingAsync(e){try{let{frameCapture:t}=this.codex,{profiles:a,customData:s}=e,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],g=a[i];if(!f||!g)return null;let{photo:m,score:w=0,finished:A}=f;if(!A)return null;let{photo:v,score:x=0,finished:S}=g;return S?null:await t.wideframe.renderResultChallenge({playerId:r,playerPhoto:m,playerScore:w,opponentId:i,opponentPhoto:v,opponentScore:x,isPlayerFinished:!0,isOpponentFinished:!1})}catch{return null}}async sendMessageAsync(e,t){let{id:a,profiles:s,customData:r}=e,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");let g=s[i];if(!g)throw new k;let{name:m}=g,w={data:{type:_e.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${m} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${m} \u0111ang ch\u1EDD b\u1EA1n k\u1EBFt th\xFAc tr\u1EADn \u0111\u1EA5u. Ch\u01A1i ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(w)}},du=cu;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Dtos:hu}=Ludex,uu=class extends b{async processAsync(e){super.processAsync(e),this.validateData(e);let{customData:t}=e,{playerId:a,opponentId:s}=t,r=a,i=await this.getProfile(r);if(!i)throw new k;if(this.updateMatchProfile(e,r,i),r=s,r!==ce.playerId){let f=await this.getProfile(r);if(!f)throw new k;this.updateMatchProfile(e,r,f)}else this.updateMatchProfile(e,r);await this.nextAsync(e)}validateData(e){let{customData:t}=e,{playerId:a,opponentId:s}=t;if(!a||typeof a!="string")throw new N;if(!s||typeof s!="string")throw new q}async getProfile(e){let{profile:t}=this.codex;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,a){let{name:s,photo:r}=a??ce,i=new hu.Match.Profile({id:t,name:s,photo:r}).toObject();e.profiles[t]?(e.profiles[t].name=i.name,e.profiles[t].photo=i.photo):e.profiles[t]=i}},Ae=uu,pu=class extends O{async processAsync(e){try{this.startLog(e);let{matchId:t,playerId:a,opponentId:s}=e,r=new F(this),i=new Y(this,{id:t,mode:z.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:s}});r.setNext(i);let f=new au(this);i.setNext(f);let g=new Ae(this);f.setNext(g);let m=new du(this);g.setNext(m);let w=new X(this);m.setNext(w);let A=new G(this);w.setNext(A);let v=this.match.getMatchState();await r.processAsync(v)}finally{this.endLog()}}},yu=pu;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var fu=class extends de{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}},la=fu,{Valid:Hs,Object:$s}=Ludex.Utils,gu=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e);let{opponentId:t}=this.payload,a=await this.createAsync(t);e.customData.contextId=a,await this.nextAsync(e)}async createAsync(e){try{await GameSDK.context.createAsync(e)}catch(a){this.validateError(a)}let t=GameSDK.context.getID();if(!Hs.isString(t))throw new la;return t}validateError(e){if(!$s.hasOwn(e,"code"))throw e;if(e.code!=="SAME_CONTEXT"){if(e.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(e))throw e;return}throw e}}validateErrorMessage(e){if(!$s.hasOwn(e,"message")||!Hs.isString(e.message))throw e}isNotConnectedPlayerError(e){return this.validateErrorMessage(e),e.message.indexOf("is not a connected player of the current player")>-1}},mu=gu;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var wu=class extends de{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}},ut=wu,{Dtos:Au,Utils:{Object:vu}}=Ludex,Du=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.validateData(e);let t=await this.createMatchAsync(e),a=new Au.Match.Data(t).toObject();this.updateMatchState(e,a),await this.nextAsync(e)}validateData(e){let{status:t,customData:a}=e,{opponentId:s}=a;if(typeof s!="string")throw new q;if(t!==H.OPEN)throw new ut}async createMatchAsync(e){let{opponentId:t}=e.customData,{extraData:a}=this.payload;if(!t)return{};let s={opponentPlayerId:t,extraData:a};return this.match.api.getMatchAPI().createMatchAsync(s)}updateMatchState(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateFinishStatus(e,t)}updateMatchGeneral(e,t){let{_id:a,extraData:s}=t;e.id=a||null,e.customData=vu.merge(e.customData,s)}updatePlayerIds(e,t){let{whitePlayerId:a,blackPlayerId:s}=t,{customData:r}=e,i=a===r.opponentId,f=i?s:a,g=i?a:s;e.customData.playerId=f,e.customData.opponentId=g}initializeProfiles(e){let{playerId:t,opponentId:a}=e.customData;if(!t||!a)return;let s={name:"",photo:"",finished:!1};e.profiles[t]||(e.profiles[t]=I({id:t},s)),e.profiles[a]||(e.profiles[a]=I({id:a},s))}updateFinishStatus(e,t){let{playerId:a,opponentId:s}=e.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerFinish:i,blackPlayerFinish:f}=t,g=r===e.customData.opponentId,m=g?f:i,w=g?i:f;e.profiles[a].finished=m,e.profiles[s].finished=w}},Vs=Du;n(),o(),l(),c(),d(),h(),u(),y(),p();var Iu=class extends b{async processAsync(e){if(super.processAsync(e),e.status!==H.OPEN)throw new ut;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=H.ACTIVE,e.startAt=Date.now()}},re=Iu;n(),o(),l(),c(),d(),h(),u(),y(),p();var xu=class extends b{async processAsync(e){super.processAsync(e),this.validateData(e);let t=await this.createWideframesChallengeAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){let{id:t,customData:a}=e,{contextId:s,opponentId:r}=a;if(!t||typeof t!="string")throw new ue;if(!s||typeof s!="string")throw new se;if(!r||typeof r!="string")throw new q}async createWideframesChallengeAsync(e){try{let{frameCapture:t}=this.codex,{profiles:a,customData:s}=e,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],g=a[i];if(!f||!g)return null;let{photo:m,score:w=0}=f,{photo:A,score:v=0}=g;return await t.wideframe.renderResultChallenge({playerId:r,playerPhoto:m,playerScore:w,opponentId:i,opponentPhoto:A,opponentScore:v,isPlayerFinished:!1,isOpponentFinished:!1})}catch{return null}}async sendMessageAsync(e,t){let{id:a,profiles:s,customData:r}=e,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");let{name:g}=s[i],m={data:{type:_e.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${g} challenges you`,localizations:{vi_VN:`${g} th\u1EED th\xE1ch b\u1EA1n trong tr\u1EADn \u0111\u1EA5u n\xE0y. Ch\u01A1i ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(m)}},Ks=xu,Su=class extends O{async processAsync(e){try{this.startLog(e);let{playerId:t,opponentId:a,extraData:s}=e,r=new F(this),i=new mu(this,{opponentId:a});r.setNext(i);let f=new Y(this,{mode:z.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:a}});i.setNext(f);let g=new Vs(this,{extraData:s});f.setNext(g);let m=new Ae(this);g.setNext(m);let w=new re(this);m.setNext(w);let A=new X(this);w.setNext(A);let v=new Ks(this);A.setNext(v);let x=new G(this);v.setNext(x);let S=this.match.getMatchState();await r.processAsync(S)}finally{this.endLog()}}},Eu=Su;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Pu=class extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}},ca=Pu,{Utils:Ws}=Ludex,bu=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e);let{contextId:t}=this.payload;await this.switchAsync(t),e.customData.contextId=t,await this.nextAsync(e)}checkSameContext(e){let t=e==="SOLO",a=GameSDK.context.getID();if(a===e)throw new ca;if(t&&a===null)throw new ca}async switchAsync(e){let t=e==="SOLO";try{this.checkSameContext(e),await GameSDK.context.switchAsync(e,t)}catch(a){if(a instanceof ca)return;if(!Ws.Object.hasOwn(a,"code"))throw a;if(Ws.Device.isAndroid()&&t&&a.code==="INVALID_PARAM")return;if(a.code!=="SAME_CONTEXT")throw a}}},pt=bu;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Dtos:Lu,Utils:{Object:Cu}}=Ludex,Nu=class extends b{async processAsync(e){super.processAsync(e),this.validateMatchData(e);let t=await this.getMatchAsync(e),a=new Lu.Match.Data(t).toObject();this.validateContinueMatchData(e,a),this.updateMatchData(e,a),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){let{id:t,status:a}=e;if(typeof t!="string")throw new ue;if(a!==H.OPEN)throw new ut}validateContinueMatchData(e,t){let{id:a,customData:s}=e,{_id:r,whitePlayerId:i,blackPlayerId:f}=t;if(typeof r!="string"||r!==a)throw new ia;let{playerId:g}=s,m=i===g,w=f===g;if(!m&&f===ce.playerId)throw new Xt;if(!m&&!w)throw new na}validatePlayerTurn(e){let{profiles:t,customData:a}=e,{playerId:s}=a;if(typeof s!="string")throw new N;let{finished:r}=t[s];if(r)throw new xs}async getMatchAsync(e){let{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}updateMatchGeneral(e,t){let{extraData:a}=t;e.customData=Cu.merge(e.customData,a)}updatePlayerIds(e,t){let{whitePlayerId:a,blackPlayerId:s}=t,r=a===e.customData.playerId;e.customData.playerId=r?a:s,e.customData.opponentId=r?s:a}initializeProfiles(e){let{playerId:t,opponentId:a}=e.customData;if(!t||!a)return;let s={name:"",photo:"",finished:!1};e.profiles[t]||(e.profiles[t]=I({id:t},s)),e.profiles[a]||(e.profiles[a]=I({id:a},s))}updateScoresAndStatus(e,t){let{playerId:a,opponentId:s}=e.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerScore:i,whitePlayerFinish:f,blackPlayerScore:g,blackPlayerFinish:m}=t,w=r===a;e.profiles[a].score=w?i:g,e.profiles[s].score=w?g:i,e.profiles[a].finished=w?f:m,e.profiles[s].finished=w?m:f}},Tu=Nu;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ou=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){if(super.processAsync(e),this.payload.ignore){await this.nextAsync(e);return}this.validateData(e);let t=await this.createWideframesCurrentScoreAsync();t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){let{id:t,customData:a}=e,{contextId:s,opponentId:r}=a;if(!t||typeof t!="string")throw new ue;if(!s||typeof s!="string")throw new se;if(!r||typeof r!="string")throw new q}async createWideframesCurrentScoreAsync(){try{let{player:e,frameCapture:t}=this.codex,{playerId:a,photo:s}=e.getPlayer();return await t.wideframe.renderUpdateChallenge({playerId:a,playerPhoto:s})}catch{return null}}async sendMessageAsync(e,t){let{id:a,profiles:s,customData:r}=e,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");let g=s[i];if(!g)throw new k;let{name:m}=g,w={data:{type:_e.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${m} made an update.`,localizations:{vi_VN:`${m} \u0111\xE3 c\u1EADp nh\u1EADt tr\u1EADn \u0111\u1EA5u. Ch\u01A1i ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");await GameSDK.extra.updateAsync(w)}},_u=Ou,Ru=class extends O{async processAsync(e){try{this.startLog(e);let{contextId:t,matchId:a,playerId:s,opponentId:r,sendUpdateMessage:i=!0}=e,f=new F(this),g=new pt(this,{contextId:t});f.setNext(g);let m=new Y(this,{id:a,mode:z.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:r}});g.setNext(m);let w=new Tu(this);m.setNext(w);let A=new Ae(this);w.setNext(A);let v=new re(this);A.setNext(v);let x=new _u(this,{ignore:!i});v.setNext(x);let S=new X(this);x.setNext(S);let P=new G(this);S.setNext(P);let C=this.match.getMatchState();await f.processAsync(C)}finally{this.endLog()}}},Mu=Ru;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Plugins:Fu,Utils:ku}=Ludex,{Analytics:Gu}=Fu,{String:zs,Valid:qs}=ku,Bu=class extends b{async processAsync(e){super.processAsync(e);let{customData:t,mode:a,startAt:s,finishAt:r}=e,{level:i}=t;this.validateMode(a),this.validateLevel(i);let{analytics:f}=this.codex,g=Math.floor((r-s)/1e3);f.event(Gu.Events.MATCH_END,{level:i,game_mode:zs.toUpperCamelCase(a),level_name:this.getLevelName(i),time_played:g}),await this.nextAsync(e)}validateMode(e){if(!qs.isString(e))throw new ra}validateLevel(e){if(!qs.isNumber(e))throw new ks}getLevelName(e){return`Level ${zs.padStart(e.toString(),5,"0")}`}},Xe=Bu;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Uu=class extends Error{constructor(e){super(e),this.name="LeaderboardNotExist",this.message=e??"Leaderboard not exist in game"}},Ys=Uu;n(),o(),l(),c(),d(),h(),u(),y(),p();var ju=class extends Error{constructor(e){super(e),this.name="ScoreNotValid",this.message=e??"Score is not valid"}},da=ju,{Utils:{Valid:Hu},Configs:{Leaderboards:{LeaderboardList:$u}}}=Ludex,Vu=class extends b{payload;skipPostScore;constructor(e,t){super(e),this.payload={score:0,playerId:""},this.skipPostScore=!!t?.ignore}async processAsync(e){if(super.processAsync(e),this.skipPostScore){await this.nextAsync(e);return}this.setupSetScorePayload(e),"submitGameResultsAsync"in GameSDK.extra&&await GameSDK.extra.submitGameResultsAsync(this.payload.score);for(let t of $u){let{Id:a,Mode:s}=t;!e.mode||!this.isValidMode(s,e.mode)||this.setLeaderboardScoreAsync(I({leaderboardId:a},this.payload))}await this.nextAsync(e)}isValidMode(e,t){return e===t}async setupSetScorePayload(e){let{profiles:t,customData:a}=e,{playerId:s}=a;if(!s||!t[s])throw new k;let{score:r}=t[s];if(!Hu.isNumber(r))throw new da;this.payload={score:r,playerId:s}}async setLeaderboardScoreAsync(e){try{let{playerId:t,score:a,leaderboardId:s}=e,r=this.codex.leaderboard.getLeaderboardName(s);if(!r)throw new Ys;await this.codex.leaderboard.setLeaderboardScoreAsync(r,t,a)}catch{}}},yt=Vu;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Dtos:Ku,Utils:Wu}=Ludex,{Valid:ft,Object:zu}=Wu,qu=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.validateMatchData(e);let{useAPI:t}=this.payload;if(t){let a=await this.finishMatchAsync(e),s=new Ku.Match.Data(a).toObject();this.updateMatchFromAPI(e,s)}else this.updateMatchData(e);this.updateMatchState(e),await this.nextAsync(e)}validateMatchData(e){let{status:t,profiles:a,customData:s}=e;if(t!==H.ACTIVE)throw new Us;let{playerId:r}=s;if(!r||!zu.hasOwn(a,r))throw new na}updateMatchData(e){let{playerId:t}=e.customData;if(!ft.isString(t))throw new N;e.profiles[t].finished=!0}updateMatchState(e){e.status=H.FINISHED,e.finishAt=Date.now()}async finishMatchAsync(e){let{id:t,profiles:a,customData:s}=e,{level:r,playerId:i}=s;if(!ft.isString(i))throw new N;let{score:f}=a[i],{extraData:g}=this.payload,m={matchId:t??"",score:f,level:r,extraData:g};return this.match.api.getMatchAPI().finishMatchAsync(m)}updateMatchFromAPI(e,t){let{playerId:a,opponentId:s}=e.customData;if(!ft.isString(a))throw new N;if(!ft.isString(s))throw new q;let{whitePlayerId:r,whitePlayerScore:i,blackPlayerScore:f,whitePlayerFinish:g,blackPlayerFinish:m}=t,w=a===r,A=w?i:f,v=w?f:i,x=w?g:m,S=w?m:g;e.profiles[a].score=A,e.profiles[s].score=v,e.profiles[a].finished=x,e.profiles[s].finished=S}},Ze=qu;n(),o(),l(),c(),d(),h(),u(),y(),p();var Yu=class extends b{async processAsync(e){super.processAsync(e),this.validateData(e);let t=await this.createWideframesResultAsync(e);t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){let{id:t,customData:a}=e,{contextId:s,opponentId:r}=a;if(!t||typeof t!="string")throw new ue;if(!s||typeof s!="string")throw new se;if(!r||typeof r!="string")throw new q}async createWideframesResultAsync(e){try{let{frameCapture:t}=this.codex,{profiles:a,customData:s}=e,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],g=a[i];if(!f||!g)return null;let{photo:m,score:w=0,finished:A}=f,{photo:v,score:x=0,finished:S}=g;return await t.wideframe.renderResultChallenge({playerId:r,playerPhoto:m,playerScore:w,opponentId:i,opponentPhoto:v,opponentScore:x,isPlayerFinished:!!A,isOpponentFinished:!!S})}catch{return null}}progressSendFinishedMessage(e,t){let{profiles:a,customData:s}=e,{playerId:r,opponentId:i}=s;if(!r||typeof r!="string")throw new N;if(!i||typeof i!="string")throw new q;if(!a[r]||!a[i])throw new k;let{score:f=0,finished:g}=a[r],{score:m=0,finished:w}=a[i];g?this.sendFinishMessageAsync(e,t):w&&f>m?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){let{id:a,profiles:s,customData:r}=e,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");let g=s[i];if(!g)throw new k;let{name:m}=g,w={data:{type:_e.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f,status:H.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem k\u1EBFt qu\u1EA3"}},text:{default:`${m} just finished. Check them now.`,localizations:{vi_VN:`${m} v\u1EEBa ho\xE0n th\xE0nh m\xE0n ch\u01A1i. Nh\u1EA5n \u0111\u1EC3 xem k\u1EBFt qu\u1EA3 tr\u1EADn \u0111\u1EA5u.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");await GameSDK.extra.updateAsync(w)}async sendPlayTurnMessageAsync(e,t){let{id:a,profiles:s,customData:r}=e,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;let g=s[i];if(!g)throw new k;let{name:m,score:w}=g,A={data:{type:_e.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f,status:H.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${m} got ${w} scores. So easy! Can you?`,localizations:{vi_VN:`${m} \u0111\xE3 \u0111\u1EA1t ${w} \u0111i\u1EC3m! Nh\u1EA5n Ch\u01A1i \u0111\u1EC3 so t\xE0i!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");await GameSDK.extra.updateAsync(A)}async sendBestScoreMessageAsync(e,t){let{id:a,profiles:s,customData:r}=e,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;let g=s[i];if(!g)throw new k;let{name:m,score:w}=g,A={data:{type:_e.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f,status:H.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem k\u1EBFt qu\u1EA3"}},text:{default:`${m} beat your high score. Their score: ${w}`,localizations:{vi_VN:`${m} \u0111\xE3 v\u01B0\u1EE3t qua \u0111i\u1EC3m s\u1ED1 c\u1EE7a b\u1EA1n, v\u1EDBi ${w} \u0111i\u1EC3m!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");await GameSDK.extra.updateAsync(A)}},Ju=Yu;n(),o(),l(),c(),d(),h(),u(),y(),p();var Qu=class extends b{ignore;constructor(e,t){super(e),this.ignore=!!t?.ignore}async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){if(this.ignore)return;let{profiles:t,customData:a}=e,{playerId:s}=a;if(!s||!t[s])throw new k;let{player:r}=this.codex,i=r.getBestScore()||0,{score:f=0}=t[s];f<=i||(r.setBestScore(f),t[s].bestScore=f)}},et=Qu,Xu=class extends O{async processAsync(e){try{this.startLog(e);let{extraData:t}=e??{},a=new F(this),s=new Ze(this,{useAPI:!0,extraData:t});a.setNext(s);let r=new Ju(this);s.setNext(r);let i=new Xe(this);r.setNext(i);let f=new et(this);i.setNext(f);let g=new yt(this);f.setNext(g);let m=new G(this);g.setNext(m);let w=this.match.getMatchState();await a.processAsync(w)}finally{this.endLog()}}},Zu=Xu;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var ep=class extends Error{constructor(e){super(e),this.name="ContextAreSolo",this.message=e??"Context are solo"}},tp=ep;n(),o(),l(),c(),d(),h(),u(),y(),p();var ap=class extends Error{constructor(e){super(e),this.name="ContextNotChallenge",this.message=e??"Context is not a challenge"}},sp=ap;n(),o(),l(),c(),d(),h(),u(),y(),p();var rp=class extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}},ip=rp,{Utils:np,Dtos:op}=Ludex,{Array:lp,Object:cp}=np,dp=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.checkCurrentContext();let t=await this.getOpponentIdFromContextAsync();e.customData.opponentId=t,await this.nextAsync(e)}checkCurrentContext(){let e=GameSDK.context.getID();if(typeof e!="string")throw new se;if(e==="SOLO")throw new tp}async getOpponentIdFromContextAsync(){let{ignoreId:e}=this.payload,t=await this.getContextPlayers([e]);if(t.length>1)throw new sp;let a=ce;return t.length===1&&(a=t[0]),a.playerId}async getContextPlayers(e){try{let t=await GameSDK.context.getPlayersAsync(),a=[];for(let s of t){let r=s.getID();if(e.indexOf(r)>-1)continue;let i=s.getName();if(!i)continue;let f=s.getPhoto();a.push(new op.Player.Info({playerId:r,name:i,photo:f}).toObject())}return lp.unique(a)}catch(t){if(cp.hasOwn(t,"code")&&t.code==="NETWORK_FAILURE")throw new ip;return[]}}},Js=dp;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var hp=class extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}},ha=hp,{Object:up}=Ludex.Utils,pp=class extends b{async processAsync(e){super.processAsync(e);let t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!up.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}let e=GameSDK.context.getID();if(typeof e!="string")throw new la;return e}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new ha):new _("getTournamentAsync")}catch(e){if(e instanceof ha)throw e}}},yp=pp,fp=class extends O{async processAsync(e){try{this.startLog(e);let{playerId:t,extraData:a}=e,s=new F(this),r=new yp(this);s.setNext(r);let i=new Y(this,{mode:z.CHALLENGE_FRIEND,customData:{playerId:t}});r.setNext(i);let f=new Js(this,{ignoreId:t});i.setNext(f);let g=new Vs(this,{extraData:a});f.setNext(g);let m=new Ae(this);g.setNext(m);let w=new re(this);m.setNext(w);let A=new X(this);w.setNext(A);let v=new Ks(this);A.setNext(v);let x=new G(this);v.setNext(x);let S=this.match.getMatchState();await s.processAsync(S)}finally{this.endLog()}}},gp=fp;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var mp=class extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}},wp=mp;n(),o(),l(),c(),d(),h(),u(),y(),p();var Ap=class extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}},vp=Ap;n(),o(),l(),c(),d(),h(),u(),y(),p();var Dp=class extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}},Ip=Dp,{Dtos:xp,Utils:{Object:Sp}}=Ludex,Ep=class extends b{async processAsync(e){super.processAsync(e),this.validateMatchData(e);let t=await this.joinMatchAsync(e),a=new xp.Match.Data(t).toObject();this.validateJoinMatchData(e,a),this.updateMatchData(e,a),await this.nextAsync(e)}validateMatchData(e){let{status:t}=e;if(t!==H.OPEN)throw new ut}validateJoinMatchData(e,t){let{id:a,customData:s}=e,{_id:r,blackPlayerId:i,whitePlayerId:f,whitePlayerFinish:g,blackPlayerFinish:m}=t,w=i===s.playerId,A=f===s.opponentId;if(typeof r!="string"||r!==a||!A)throw new wp;if(g&&m)throw new vp;if(!w)throw new Ip}async joinMatchAsync(e){let{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}updateMatchGeneral(e,t){let{extraData:a}=t;e.customData=Sp.merge(e.customData,a)}updatePlayerIds(e,t){let{whitePlayerId:a,blackPlayerId:s}=t,{customData:r}=e,i=a===r.playerId,f=i?a:s,g=i?s:a;e.customData.playerId=f,e.customData.opponentId=g}initializeProfiles(e){let{playerId:t,opponentId:a}=e.customData;if(!t||!a)return;let s={name:"",photo:"",finished:!1};e.profiles[t]||(e.profiles[t]=I({id:t},s)),e.profiles[a]||(e.profiles[a]=I({id:a},s))}updateScoresAndStatus(e,t){let{playerId:a,opponentId:s}=e.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerScore:i,whitePlayerFinish:f,blackPlayerScore:g,blackPlayerFinish:m}=t,w=r===e.customData.playerId;e.profiles[a].score=w?i:g,e.profiles[s].score=w?g:i,e.profiles[a].finished=w?f:m,e.profiles[s].finished=w?m:f}},Pp=Ep;n(),o(),l(),c(),d(),h(),u(),y(),p();var bp=class extends b{async processAsync(e){super.processAsync(e),this.validateData(e);let t=await this.createWideframesAcceptedAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){let{id:t,customData:a}=e,{contextId:s,opponentId:r}=a;if(!t||typeof t!="string")throw new ue;if(!s||typeof s!="string")throw new se;if(!r||typeof r!="string")throw new q}async createWideframesAcceptedAsync(e){try{let{frameCapture:t}=this.codex,{profiles:a,customData:s}=e,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],g=a[i];if(!f||!g)return null;let{photo:m,score:w=0,finished:A}=f;if(A)return null;let{photo:v,score:x=0,finished:S}=g;return S?await t.wideframe.renderResultChallenge({playerId:r,playerPhoto:m,playerScore:w,opponentId:i,opponentPhoto:v,opponentScore:x,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch{return null}}async sendMessageAsync(e,t){let{id:a,profiles:s,customData:r}=e,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");let g=s[i];if(!g)throw new k;let{name:m}=g,w={data:{type:_e.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${m} accepted the challenge.`,localizations:{vi_VN:`${m} \u0111\xE3 ch\u1EA5p nh\u1EADn tham gia tr\u1EADn \u0111\u1EA5u.`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(w)}},Lp=bp,Cp=class extends O{async processAsync(e){try{this.startLog(e);let{matchId:t,playerId:a,opponentId:s}=e,r=new F(this),i=new Y(this,{id:t,mode:z.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:s}});r.setNext(i);let f=new Pp(this);i.setNext(f);let g=new Ae(this);f.setNext(g);let m=new re(this);g.setNext(m);let w=new Lp(this);m.setNext(w);let A=new X(this);w.setNext(A);let v=new G(this);A.setNext(v);let x=this.match.getMatchState();await r.processAsync(x)}finally{this.endLog()}}},Np=Cp;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Tp={_id:"",status:"",appId:"",createdAt:"",startedAt:null,finishedAt:null,winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1,extraData:{}},Op=Tp,{Configs:{AppId:_p},Utils:{Valid:$}}=Ludex,V="is invalid",ua=class extends le{setupData(e){this.d(e)}n(e){this.l(e)}o(e){this.c(e)}validateId(e){(!$.isString(e)||!e)&&this.e("_id",V)}validateStatus(e){(!$.isString(e)||!e)&&this.e("status",V)}validateAppId(e){(!$.isString(e)||e!==_p)&&this.e("appId",V)}validateCreatedAt(e){$.isString(e)||this.e("createdAt",V)}validateStartedAt(e){e!==null&&($.isString(e)||this.e("startedAt",V))}validateFinishedAt(e){e!==null&&($.isString(e)||this.e("finishedAt",V))}validateExtraData(e){e!==null&&($.isObject(e)||this.e("extraData",V))}validateWinnerId(e){e!==null&&(!$.isString(e)||!e)&&this.e("winnerId",V)}validateWhitePlayerId(e){(!$.isString(e)||!e)&&this.e("whitePlayerId",V)}validateBlackPlayerId(e){(!$.isString(e)||!e)&&this.e("blackPlayerId",V)}validateWhitePlayerScore(e){$.isNumber(e)||this.e("whitePlayerScore",V)}validateBlackPlayerScore(e){$.isNumber(e)||this.e("blackPlayerScore",V)}validateWhitePlayerFinish(e){$.isBoolean(e)||this.e("whitePlayerFinish",V)}validateBlackPlayerFinish(e){$.isBoolean(e)||this.e("blackPlayerFinish",V)}toObject(){return super.toObject()}};ua.makeStrict(),ua.addDefaultData(Op);var Qs=ua;n(),o(),l(),c(),d(),h(),u(),y(),p();var Rp=class extends Error{constructor(e){super(e),this.name="MatchAreNotFinished",this.message=e||"Match are not finished"}},Mp=Rp;n(),o(),l(),c(),d(),h(),u(),y(),p();var Fp=class extends Error{constructor(e){super(e),this.name="OpponentNotFinishedMatch",this.message=e||"Opponent not finished match"}},kp=Fp,{Utils:{Object:Gp}}=Ludex,Bp=class extends b{async processAsync(e){super.processAsync(e),this.validateMatchData(e);let t=await this.getMatchAsync(e),a=new Qs(t).toObject();this.validateResultMatchData(e,a),this.updateMatchData(e,a),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){let{id:t}=e;if(typeof t!="string")throw new ue}validateResultMatchData(e,t){let{id:a}=e,{_id:s,whitePlayerFinish:r,blackPlayerFinish:i}=t;if(typeof s!="string"||s!==a)throw new ia;if(!r&&!i)throw new Mp}validatePlayerTurn(e){let{profiles:t,customData:a}=e,{playerId:s}=a;if(typeof s!="string")throw new N;let{finished:r}=t[s];if(!r)throw new js}validateOpponentTurn(e){let{profiles:t,customData:a}=e,{opponentId:s}=a;if(typeof s!="string")throw new q;let{finished:r}=t[s];if(!r)throw new kp}async getMatchAsync(e){let{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):null}updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}updateMatchGeneral(e,t){let{extraData:a}=t;e.status=H.FINISHED,e.customData=Gp.merge(e.customData,a)}updatePlayerIds(e,t){let{whitePlayerId:a,blackPlayerId:s}=t,{customData:r}=e,i=a===r.playerId,f=i?a:s,g=i?s:a;e.customData.playerId=f,e.customData.opponentId=g}initializeProfiles(e){let{playerId:t,opponentId:a}=e.customData;if(!t||!a)return;let s={name:"",photo:"",finished:!0};e.profiles[t]||(e.profiles[t]=I({id:t},s)),e.profiles[a]||(e.profiles[a]=I({id:a},s))}updateScoresAndStatus(e,t){let{playerId:a,opponentId:s}=e.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerScore:i,whitePlayerFinish:f,blackPlayerScore:g,blackPlayerFinish:m}=t,w=r===e.customData.playerId;e.profiles[a].score=w?i:g,e.profiles[s].score=w?g:i,e.profiles[a].finished=w?f:m,e.profiles[s].finished=w?m:f}},Up=Bp,jp=class extends O{async processAsync(e){try{this.startLog(e);let{matchId:t,playerId:a,opponentId:s}=e,r=new F(this),i=new Y(this,{id:t,mode:z.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:s}});r.setNext(i);let f=new Up(this);i.setNext(f);let g=new Ae(this);f.setNext(g);let m=new G(this);g.setNext(m);let w=this.match.getMatchState();await r.processAsync(w)}finally{this.endLog()}}},Hp=jp;n(),o(),l(),c(),d(),h(),u(),y(),p();var $p=class extends O{fallbackSingleMode;async processAsync(e){try{this.startLog(e);let{playerId:t,extraData:a,fallbackSingleMode:s}=e;this.fallbackSingleMode=s;let r=await this.startFLowChallengeFriend({playerId:t,extraData:a});if(r===!0)return;if(r instanceof ha)await this.startFlowTournament(t);else if(this.fallbackSingleMode)await this.startFlowSingle(t);else throw r}finally{this.endLog()}}startFLowChallengeFriend=async e=>{try{return await this.match.challenge.invite.processAsync(e),!0}catch(t){return t}};startFlowTournament=async e=>{try{let t=GameSDK.context.getID();if(typeof t!="string")throw new se;await this.match.tournament.continue.processAsync({playerId:e,contextId:t})}catch{await this.startFlowSingle(e)}};startFlowSingle=async e=>this.match.single.start.processAsync({playerId:e})},Vp=$p;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Kp=class extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}},tt=Kp;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:Xs}=Ludex.Utils,Wp=class extends b{payload;leaderboardPayload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.setupSetScorePayload(e),"submitGameResultsAsync"in GameSDK.extra&&await GameSDK.extra.submitGameResultsAsync(this.payload.score),this.setLeaderboardScoreAsync(),await this.nextAsync(e)}async setupSetScorePayload(e){let{profiles:t,customData:a}=e,{playerId:s}=a;if(!s||!t[s])throw new k;let{score:r,leaderboardId:i}=this.payload;if(!Xs.isNumber(r))throw new da;if(!Xs.isString(i))throw new tt;this.leaderboardPayload={score:r,playerId:s,leaderboardId:i}}async setLeaderboardScoreAsync(){try{let{playerId:e,score:t,leaderboardId:a}=this.leaderboardPayload,s=this.codex.leaderboard.getLeaderboardName(a);if(!s)throw new Ys;await this.codex.leaderboard.setLeaderboardScoreAsync(s,e,t)}catch{}}},Zs=Wp,{Utils:{Valid:zp}}=Ludex,qp=class extends Zs{constructor(e){super(e,{score:0,leaderboardId:""})}async setupSetScorePayload(e){let{profiles:t,customData:a}=e,{playerId:s,leaderboardId:r}=a;if(!r)throw new tt;if(!s||!t[s])throw new k;let{score:i}=t[s];if(!zp.isNumber(i))throw new da;this.payload.score=i,this.payload.leaderboardId=r,super.setupSetScorePayload(e)}},pa=qp;n(),o(),l(),c(),d(),h(),u(),y(),p();var Yp=class extends b{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){let{id:t,customData:a}=e,{contextId:s,opponentId:r}=a;if(!t||typeof t!="string")throw new ue;if(!s||typeof s!="string")throw new se;if(!r||typeof r!="string")throw new q}async createWideframesResultGroupAsync(e){try{let{frameCapture:t}=this.codex,{profiles:a,customData:s}=e,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],g=a[i];if(!f||!g)return null;let{photo:m,score:w=0}=f,{photo:A,score:v=0}=g;return await t.wideframe.renderResultChallenge({playerId:r,playerPhoto:m,playerScore:w,opponentId:i,opponentPhoto:A,opponentScore:v,isPlayerFinished:!0,isOpponentFinished:!0})}catch{return null}}async createWideframesBestScoreAsync(e){try{let{player:t,frameCapture:a}=this.codex,{playerId:s}=e.customData,{playerId:r,photo:i,data:f}=t.getPlayer();if(s!==r)return null;let{score:g}=f||{};return await a.wideframe.renderShareScore({playerId:r,playerPhoto:i,playerScore:g})}catch{return null}}async progressSendGroupMessage(e){let{profiles:t,customData:a}=e,{playerId:s,opponentId:r}=a;if(r&&typeof r=="string"){if(!s||typeof s!="string")throw new N;let f=t[s],g=t[r];if(!f||!g)return;let{score:m=0}=f,{score:w=0}=g;if(m>w){let A=await this.createWideframesResultGroupAsync(e);if(!A)return;this.sendBestScoreMessageAsync(e,A);return}}let i=await this.createWideframesBestScoreAsync(e);i&&this.sendChallengeMessageAsync(e,i)}async sendBestScoreMessageAsync(e,t){let{profiles:a,customData:s}=e,{playerId:r}=s;if(!r||typeof r!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");let i=a[r];if(!i)throw new k;let{name:f,score:g}=i,m={data:{type:this.codex.context.getSessionContextTypes().MATCHING_GROUP,playerId:r,playerName:f,playerScore:g},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i"}},text:{default:`${f} beats your high score. Their score: ${g}.`,localizations:{vi_VN:`${f} v\u1EEBa v\u01B0\u1EE3t \u0111i\u1EC3m s\u1ED1 cao nh\u1EA5t c\u1EE7a b\u1EA1n! Ch\u01A1i l\u1EA7n n\u1EEFa ch\u1EE9?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");await GameSDK.extra.updateAsync(m)}async sendChallengeMessageAsync(e,t){let{profiles:a,customData:s}=e,{playerId:r}=s;if(!r||typeof r!="string")throw new N;let i=a[r];if(!i)throw new k;let{name:f,score:g}=i,m={data:{type:this.codex.context.getSessionContextTypes().MATCHING_GROUP,playerId:r,playerName:f,playerScore:g},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${f} got ${g} scores. So easy! Can you?`,localizations:{vi_VN:`${f} \u0111\xE3 \u0111\u1EA1t ${g} \u0111i\u1EC3m! Qu\xE1 d\u1EC5 lu\xF4n. Ch\u01A1i l\u1EA1i n\xE0o!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new _("updateAsync");await GameSDK.extra.updateAsync(m)}},Jp=Yp,Qp=class extends O{async processAsync(){try{this.startLog();let e=new F(this),t=new Ze(this,{useAPI:!1});e.setNext(t);let a=new Jp(this);t.setNext(a);let s=new Xe(this);a.setNext(s);let r=new et(this);s.setNext(r);let i=new pa(this);r.setNext(i);let f=new G(this);i.setNext(f);let g=this.match.getMatchState();await e.processAsync(g)}finally{this.endLog()}}},Xp=Qp;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Dtos:Zp}=Ludex,ey=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.updateProfileMatchData(e),await this.nextAsync(e)}updateProfileMatchData(e){let{id:t}=this.payload,{profiles:a}=e;if(!a[t])throw new k;let s=I(I({},a[t]),this.payload),r=new Zp.Match.Profile(s).toObject();a[r.id]=r}},gt=ey,ty=class extends O{async processAsync(e){try{this.startLog(e);let{playerId:t,opponentId:a,opponentScore:s}=e,r=new F(this),i=new Y(this,{id:"7749",mode:z.MATCHING_GROUP,customData:{playerId:t,opponentId:a}});r.setNext(i);let f=new Ae(this);i.setNext(f);let g=new gt(this,{id:t,score:s});f.setNext(g);let m=new re(this);g.setNext(m);let w=new X(this);m.setNext(w);let A=new G(this);w.setNext(A);let v=this.match.getMatchState();await r.processAsync(v)}finally{this.endLog()}}},ay=ty;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var sy=class extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}},er=sy,ry=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),await this.checkMatchGroupSupported();let t=await this.matchingGroup();e.customData.contextId=t,await this.nextAsync(e)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new _("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new _("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new er;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new er}async matchingGroup(){if(!("matchPlayerAsync"in GameSDK.extra))throw new _("matchPlayerAsync");let{matchTag:e,autoSwitch:t=!1,onlyExisting:a=!1}=this.payload;await GameSDK.extra.matchPlayerAsync(e,t,a);let s=GameSDK.context.getID();if(typeof s!="string")throw new la;return s}},iy=ry,ny=class extends O{async processAsync(e){try{this.startLog(e);let{matchTag:t,playerId:a,options:s}=e,r=new F(this),i=new iy(this,I({matchTag:t},s));r.setNext(i);let f=new Y(this,{id:"7749",mode:z.MATCHING_GROUP,customData:{playerId:a}});i.setNext(f);let g=new Js(this,{ignoreId:a});f.setNext(g);let m=new re(this);g.setNext(m);let w=new Ae(this);m.setNext(w);let A=new X(this);w.setNext(A);let v=new G(this);A.setNext(v);let x=this.match.getMatchState();await r.processAsync(x)}finally{this.endLog()}}},oy=ny;n(),o(),l(),c(),d(),h(),u(),y(),p();var ly=class extends O{async processAsync(){try{this.startLog();let e=new F(this),t=new Ze(this,{useAPI:!1});e.setNext(t);let a=new Xe(this);t.setNext(a);let s=new et(this);a.setNext(s);let r=new yt(this);s.setNext(r);let i=new G(this);r.setNext(i);let f=this.match.getMatchState();await e.processAsync(f)}finally{this.endLog()}}},cy=ly;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var dy=class extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}},hy=dy,{Dtos:uy}=Ludex,py=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e);let{profileId:t}=this.payload;if(!t)throw new hy;let{player:a}=this.codex,s=a.getPlayerId(),r;if(t===s)r=this.getPlayerProfile();else if(r=await this.getProfileAsync(t),!r)throw new k;this.updateMatchData(r,e),await this.nextAsync(e)}getPlayerProfile(){let{player:e}=this.codex,{playerId:t,name:a,photo:s,locale:r}=e.getPlayer();return{playerId:t,name:a,photo:s,locale:r}}async getProfileAsync(e){let{profile:t}=this.codex;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchData(e,t){let{playerId:a,name:s,photo:r}=e,i=new uy.Match.Profile({id:a,name:s,photo:r}).toObject();t.profiles[a]=i}},at=py,yy=class extends O{async processAsync(e){try{this.startLog(e);let{playerId:t}=e,a=new F(this),s=new pt(this,{contextId:"SOLO"});a.setNext(s);let r=new Y(this,{id:"123456",mode:z.SINGLE,customData:{playerId:t}});s.setNext(r);let i=new re(this);r.setNext(i);let f=new at(this,{profileId:t});i.setNext(f);let g=new X(this);f.setNext(g);let m=new G(this);g.setNext(m);let w=this.match.getMatchState();await a.processAsync(w)}finally{this.endLog()}}},fy=yy;n(),o(),l(),c(),d(),h(),u(),y(),p();var gy=class extends O{async processAsync(e){try{this.startLog(e);let{setPlayerBestScore:t=!1,postGlobalLeaderboard:a=!1}=e??{},s=new F(this),r=new Ze(this,{useAPI:!1});s.setNext(r);let i=new Xe(this);r.setNext(i);let f=new et(this,{ignore:!t});i.setNext(f);let g=new yt(this,{ignore:!a});f.setNext(g);let m=new G(this);g.setNext(m);let w=this.match.getMatchState();await s.processAsync(w)}finally{this.endLog()}}},my=gy;n(),o(),l(),c(),d(),h(),u(),y(),p();var wy=class extends O{async processAsync(e){try{this.startLog(e);let{matchId:t,playerId:a,gameMode:s,extraData:r={}}=e,i=new F(this),f=new pt(this,{contextId:"SOLO"});i.setNext(f);let g=new Y(this,{id:t,mode:s,customData:I({playerId:a},r)});f.setNext(g);let m=new re(this);g.setNext(m);let w=new at(this,{profileId:a});m.setNext(w);let A=new X(this);w.setNext(A);let v=new G(this);A.setNext(v);let x=this.match.getMatchState();await i.processAsync(x)}finally{this.endLog()}}},Ay=wy;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Plugins:vy,Utils:Dy}=Ludex,{Analytics:Iy}=vy,{String:xy,Valid:Sy}=Dy,Ey=class extends b{async processAsync(e){super.processAsync(e);let{mode:t,customData:a}=e;this.validateMode(t);let{analytics:s}=this.codex,{tournamentId:r,leaderboardId:i}=a;s.event(Iy.Events.TOURNAMENT_START,{success:!0,game_mode:xy.toUpperCamelCase(t),tournament_id:r,leaderboard_id:i}),await this.nextAsync(e)}validateMode(e){if(!Sy.isString(e))throw new ra}},tr=Ey;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Py=class extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}},ar=Py,{Valid:ya}=Ludex.Utils,by=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e);let{contextId:t}=this.payload;this.validateContextId(t);let a=await GameSDK.getTournamentAsync(),s=a.getID().toString();this.validateTournamentId(s);let r=JSON.parse(a.getPayload()||"{}"),{leaderboardId:i}=r;this.validateLeaderboardId(i),e.customData.contextId=t,e.customData.tournamentId=s,e.customData.leaderboardId=i,await this.nextAsync(e)}validateContextId(e){if(!ya.isString(e))throw new se}validateTournamentId(e){if(!ya.isString(e))throw new ar}validateLeaderboardId(e){if(!ya.isString(e)||e==="")throw new tt}},Ly=by,Cy=class extends O{async processAsync(e){try{this.startLog(e);let{playerId:t,contextId:a}=e,s=new F(this),r=new Ly(this,{contextId:a});s.setNext(r);let i=new Y(this,{id:"1997",mode:z.TOURNAMENT,customData:{playerId:t}});r.setNext(i);let f=new re(this);i.setNext(f);let g=new at(this,{profileId:t});f.setNext(g);let m=new X(this);g.setNext(m);let w=new tr(this);m.setNext(w);let A=new G(this);m.setNext(A);let v=this.match.getMatchState();await s.processAsync(v)}finally{this.endLog()}}},Ny=Cy;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Plugins:Ty}=Ludex,{Analytics:Oy}=Ty,_y=class extends b{async processAsync(e){super.processAsync(e);let{customData:t}=e,{analytics:a}=this.codex,{tournamentId:s,leaderboardId:r}=t;a.event(Oy.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:s,leaderboard_id:r}),await this.nextAsync(e)}},Ry=_y;n(),o(),l(),c(),d(),h(),u(),y(),p();var My=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),await this.createTournamentAsync(),await this.updateMatchStateAsync(e),await this.nextAsync(e)}async createTournamentAsync(){let{name:e,score:t,customData:a}=this.payload;await GameSDK.tournament.createAsync({initialScore:t,config:{title:e,tournamentTitle:e},data:a})}async updateMatchStateAsync(e){try{if(!("getTournamentAsync"in GameSDK))throw new _("getTournamentAsync");let t=await GameSDK.getTournamentAsync(),a=t.getContextID(),s=t.getID().toString(),{playerId:r}=this.payload;e.customData.playerId=r,e.customData.contextId=a,e.customData.tournamentId=s}catch(t){if(t instanceof _)return}}},Fy=My;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:sr}=Ludex.Utils,ky=class extends b{payload;leaderboardPayload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.validatePayload(),await this.setupCreatePayload(e),await this.createLeaderboardAsync(e),await this.nextAsync(e)}validatePayload(){let{leaderboardId:e}=this.payload;if(!sr.isString(e))throw new tt}validatePlayerId(e){if(!sr.isString(e))throw new N}async setupCreatePayload(e){let{playerId:t}=e.customData;this.validatePlayerId(t);let{name:a,leaderboardId:s,customData:r}=this.payload;this.leaderboardPayload={_id:s,name:a??"",createdBy:t,description:JSON.stringify(r)}}async createLeaderboardAsync(e){let t=await this.codex.leaderboard.createLeaderboardAsync(this.leaderboardPayload);e.customData.leaderboardId=t}},Gy=ky,By=class extends O{async processAsync(e){try{this.startLog(e);let{playerId:t,name:a,score:s,leaderboardId:r,payload:i}=e,f=new F(this),g=new pt(this,{contextId:"SOLO"});f.setNext(g);let m=new Fy(this,{name:a,score:s,playerId:t,customData:i});g.setNext(m);let w=new at(this,{profileId:t});m.setNext(w);let A=new gt(this,{id:t,score:s});w.setNext(A);let v=new Gy(this,{name:a,customData:i,leaderboardId:r});A.setNext(v);let x=new pa(this);v.setNext(x);let S=new Ry(this);x.setNext(S);let P=this.match.getMatchState();await f.processAsync(P)}finally{this.endLog()}}},Uy=By;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Plugins:{Analytics:rr},Utils:{Valid:jy}}=Ludex,Hy=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.validateData(e),await this.postScoreTournamentAsync(e),await this.nextAsync(e)}validateData(e){let{profiles:t,customData:a}=e,{playerId:s}=a;if(this.validatePlayerId(s),!t[s])throw new k}validatePlayerId(e){if(!jy.isString(e))throw new N}getPlayerProfile(e){let{profiles:t,customData:a}=e,{playerId:s}=a;return this.validatePlayerId(s),t[s]}isNewBestScore(e){let t=this.getPlayerProfile(e),{score:a=0,bestScore:s=0}=t;return a>s}async postScoreTournamentAsync(e){let{analytics:t}=codex,a=this.getPlayerProfile(e),{score:s=0}=a,r=null,i=!1,{checkBestScore:f}=this.payload,g=this.isNewBestScore(e);try{if(!("getTournamentAsync"in GameSDK))throw new _("getTournamentAsync");await GameSDK.getTournamentAsync(),!f||g?(r=rr.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:s})):(r=rr.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(s)),i=!0}catch{}finally{r&&t.event(r,{success:i})}}},$y=Hy,Vy=class extends O{async processAsync(e){try{this.startLog(e);let{playerId:t,bestScore:a,checkBestScore:s=!1}=e,r=new F(this),i=new Ze(this,{useAPI:!1});r.setNext(i);let f=new gt(this,{id:t,bestScore:a});i.setNext(f);let g=new $y(this,{checkBestScore:s});f.setNext(g);let m=new Xe(this);g.setNext(m);let w=new et(this);m.setNext(w);let A=new pa(this);w.setNext(A);let v=new yt(this);A.setNext(v);let x=new G(this);v.setNext(x);let S=this.match.getMatchState();await r.processAsync(S)}finally{this.endLog()}}},Ky=Vy;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:fa,Object:Wy}=Ludex.Utils,zy=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e);let{tournamentId:t}=this.payload;this.validateTournamentId(t),await this.joinTournamentAsync(t);let a=await GameSDK.getTournamentAsync(),s=a.getContextID();this.validateContextId(s);let r=JSON.parse(a.getPayload()||"{}"),{leaderboardId:i}=r;this.validateLeaderboardId(i),e.customData.contextId=s,e.customData.tournamentId=t,e.customData.leaderboardId=i,await this.nextAsync(e)}validateTournamentId(e){if(!fa.isString(e))throw new ar}validateContextId(e){if(!fa.isString(e))throw new se}validateLeaderboardId(e){if(!fa.isString(e)||e==="")throw new tt}async joinTournamentAsync(e){if(!("tournament"in GameSDK))throw new _("tournament");try{await GameSDK.tournament.joinAsync(e)}catch(t){if(!Wy.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}}},qy=zy,Yy=class extends O{async processAsync(e){try{this.startLog(e);let{playerId:t,tournamentId:a}=e,s=new F(this),r=new qy(this,{tournamentId:a});s.setNext(r);let i=new Y(this,{id:"1997",mode:z.TOURNAMENT,customData:{playerId:t}});r.setNext(i);let f=new re(this);i.setNext(f);let g=new at(this,{profileId:t});f.setNext(g);let m=new X(this);g.setNext(m);let w=new tr(this);m.setNext(w);let A=new G(this);w.setNext(A);let v=this.match.getMatchState();await s.processAsync(v)}finally{this.endLog()}}},Jy=Yy;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Dtos:Qy,Utils:Xy}=Ludex,{Object:Zy}=Xy,ef=class extends b{async processAsync(e){super.processAsync(e);let t=await this.getMatchCustomData(e);this.updateMatchCustomData(e,t),await this.nextAsync(e)}async getMatchCustomData(e){let{id:t}=e;return t?(await this.match.api.getMatchAPI().getMatchDetailByIdAsync(t))?.extraData??{}:{}}updateMatchCustomData(e,t){let a=Zy.merge(e.customData,t),s=new Qy.Match.CustomData(a).toObject();e.customData=s}},tf=ef;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Dtos:af,Utils:sf}=Ludex,{Object:rf}=sf,nf=class extends b{payload;constructor(e,t){super(e),this.payload=t}async processAsync(e){super.processAsync(e),this.updateMatchCustomData(e),await this.nextAsync(e)}updateMatchCustomData(e){let t=rf.merge(e.customData,this.payload),a=new af.Match.CustomData(t).toObject();e.customData=a}},of=nf;n(),o(),l(),c(),d(),h(),u(),y(),p();var lf={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:I({},oa)},cf=lf,{Configs:ir}=Ludex,df=class extends Ludex.Plugins.BasePlugin{base;group;single;context;strategy;challenge;tournament;api;handler;useCPUProfile;init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(e){this.useCPUProfile=e}createMatchData(){let{storage:e}=this.codex;e.addStorage("match",cf)}getMatchState(){let{storage:e}=this.codex;return e.getStorage("match")}createBaseConcrete(){this.base=new O(this.codex,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createContextFlows(),this.createStrategyFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:async e=>{let t=new gt(this.base,e);await this.processHandlerAsync(t)},setMatchCustomData:async e=>{let t=new of(this.base,e);await this.processHandlerAsync(t)},getMatchCustomData:async()=>{let e=new tf(this.base);await this.processHandlerAsync(e)},setLeaderboardScore:async e=>{let t=new Zs(this.base,e);await this.processHandlerAsync(t)}}}createAPIHandler(){let e={appId:ir.AppId,matchAPIHost:ir.ApiHost};this.api=new Th(e)}createGroupFlows(){this.group={join:new ay(this.codex,this),start:new oy(this.codex,this),finish:new Xp(this.codex,this)}}createSingleFlows(){this.single={start:new fy(this.codex,this),finish:new cy(this.codex,this)}}createStrategyFlows(){this.strategy={start:new Ay(this.codex,this),finish:new my(this.codex,this)}}createContextFlows(){this.context={choose:new Vp(this.codex,this)}}createChallengeFlows(){this.challenge={invite:new gp(this.codex,this),friend:new Eu(this.codex,this),join:new Np(this.codex,this),await:new yu(this.codex,this),result:new Hp(this.codex,this),finish:new Zu(this.codex,this),continue:new Mu(this.codex,this)}}createTournamentFlows(){this.tournament={join:new Jy(this.codex,this),create:new Uy(this.codex,this),finish:new Ky(this.codex,this),continue:new Ny(this.codex,this)}}processHandlerAsync(e){let t=this.getMatchState();return e.processAsync(t)}},hf=df;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:Re}=Ludex.Utils,Me="is invalid",ga=class extends le{setupData(e){this.d(e)}n(e){this.l(e)}o(e){this.c(e)}validateLevel(e){(!Re.isNumber(e)||e<0)&&this.e("level",Me)}validateRescued(e){(!Re.isNumber(e)||e<0)&&this.e("rescued",Me)}validateContextId(e){Re.isString(e)||this.e("contextId",Me)}validatePlayerId(e){Re.isString(e)||this.e("playerId",Me)}validateOpponentId(e){!Re.isString(e)&&e!==null&&this.e("opponentId",Me)}validateTournamentId(e){!Re.isString(e)&&e!==null&&this.e("tournamentId",Me)}validateLeaderboardId(e){!Re.isString(e)&&e!==null&&this.e("leaderboardId",Me)}toObject(){return super.toObject()}};ga.makeStrict(),ga.addDefaultData(oa);var uf=ga;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:Be}=Ludex.Utils,Ue="is invalid",nr=class extends le{setupData(e){this.d(e)}n(e){this.l(e)}o(e){this.c(e)}validateId(e){(!Be.isString(e)||!e)&&this.e("id",Ue)}validateName(e){(!Be.isString(e)||!e)&&this.e("name",Ue)}validatePhoto(e){Be.isString(e)||this.e("photo",Ue)}validateScore(e){(!Be.isNumber(e)||e<0)&&this.e("score",Ue)}validateBestScore(e){(!Be.isNumber(e)||e<0)&&this.e("bestScore",Ue)}validateFinished(e){Be.isBoolean(e)||this.e("finished",Ue)}toObject(){return super.toObject()}};nr.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1});var pf=nr;Ludex.Dtos.Match={Data:Qs,Profile:pf,CustomData:uf};var yf=hf;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var ff=[{id:"finish-level",title:"Finish 1 level",require:{level:1},reward:{coin:300},duration:1e3*60*60*24}],gf=class{async getMissionsAsync(){return[...ff]}},mf=gf;n(),o(),l(),c(),d(),h(),u(),y(),p();var wf={tasks:[],process:{}},Af=wf,{Utils:{Json:or,Valid:lr,Object:mt}}=Ludex,vf=class extends Ludex.Plugins.BasePlugin{api;init(){let{storage:e}=this.codex;e.addStorage("missions",Af,!0),this.api=new mf}async requestMissions(){let e=await this.api.getMissionsAsync(),t=Date.now();for(let a of e)a.expirationTime=t+a.duration;this.receivePlayerMissionData(e)}addMission(e){let{storage:t}=this.codex,{id:a,duration:s,expirationTime:r}=e;r||(e.expirationTime=Date.now()+s);let i=t.getStorageData("missions","tasks")??[],f=i.findIndex(m=>m.id===a);if(f!==-1){let m=mt.merge(i[f],e);i[f]=m}else i.push(e);let g=[...i];t.setStorageData("missions","tasks",g),this.addProcessLog(e),this.updatePlayerMissionProcess(),t.updateToWebStorage("missions")}addProcessLog(e){let{storage:t}=this.codex,{id:a,require:s}=e,r={},i=Object.keys(s);for(let g of i)r[g]=0;let f=t.getStorageData("missions","process")??{};f[a]={require:r,rewarded:!1},t.setStorageData("missions","process",f)}removeMission(e){let{storage:t}=this.codex,a=t.getStorageData("missions","tasks");if(!a)return;let s=a.filter(r=>r.id!==e);t.setStorageData("missions","tasks",s),this.removeProcessLog(e),t.updateToWebStorage("missions")}removeProcessLog(e){let{storage:t}=this.codex,a=t.getStorageData("missions","process")??{};if(a[e]){let{require:s}=a[e],r=Object.keys(s);for(let i of r)s[i]=0;a[e]={require:s,rewarded:!1}}t.setStorageData("missions","process",a)}receivePlayerMissionData(e){let{storage:t}=this.codex,a=t.getStorageData("missions","tasks")??[],s=this.filterMissionByExpirationTime(a),r=this.combineMissions(e,s);t.setStorageData("missions","tasks",r);let i=this.filterExistingSavedProcess(s);this.receiveProcessLogs(r,i),this.updatePlayerMissionProcess(),t.updateToWebStorage("missions")}filterExistingSavedProcess(e){let{player:t}=this.codex,a=t.getPlayerDataByKey("missionsData"),{process:s={}}=a||{},r=e.map(g=>g.id),i=Object.keys(s).filter(g=>!r.includes(g)),f={};for(let g of i)f[g]=s[g];return f}filterMissionByExpirationTime(e){let t=Date.now();return e.filter(a=>{let{expirationTime:s}=a;return s?t<s:!1})}combineMissions(e,t){let a=t.map(r=>r.id),s=e.filter(r=>{let{id:i}=r;return!a.includes(i)});return[...t,...s]}receiveProcessLogs(e,t){let a={};for(let s of e){let{id:r,require:i}=s;if(mt.hasOwn(t,r)){a[r]=or.clone(t[r]);return}let f={},g=Object.keys(i);for(let m of g)f[m]=0;a[r]={require:f,rewarded:!1}}this.updateMissionProcess(a)}updateMissionProcess(e){let{storage:t}=this.codex;t.setStorageData("missions","process",e),t.updateToWebStorage("missions")}getPlayerMissionProcess(){let{player:e}=this.codex,t=e.getPlayerDataByKey("missionsData"),{process:a}=t||{};return or.clone(a)}addMissionValue(e){let{id:t,type:a,value:s}=e,r=this.getPlayerMissionProcess();if(!lr.isObject(r))return;let i=r,f=Object.keys(i).filter(g=>g.includes(t));for(let g of f){let m=i[g];!m||m.rewarded||(m.require[a]+=s)}this.updateMissionProcess(i),this.updatePlayerMissionProcess()}setMissionRewardClaimed(e){let t=this.getPlayerMissionProcess();if(!lr.isObject(t))return;let a=t;mt.hasOwn(a,e)&&(a[e].rewarded=!0,this.updateMissionProcess(a),this.updatePlayerMissionProcess())}updatePlayerMissionProcess(){let{player:e}=this.codex,t=this.codex.storage.getStorageData("missions","process"),a=this.getPlayerMissionProcess(),s=mt.merge(a,t);e.setPlayerDataByName("missionsData",{process:s})}},Df=vf,If=Df;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Utils:{Object:xf},Configs:{ApiHost:cr}}=Ludex,Sf=()=>{let e=GameSDK.getSDKName(),t="players";switch(e){case"MsGames":t+="?platform=ms-games";break;case"Yandex":t+="?platform=yandex";break;default:break}return t},Ef=async e=>{if(!cr)return{};let t=Sf(),a=await te(t,e,{},cr,10);return xf.hasOwn(a,"data")?a.data||{}:{}},{Utils:{Array:Pf,Object:wt,Valid:bf},Configs:{AppId:Lf}}=Ludex,Cf=class extends Ludex.Plugins.BasePlugin{isLoggedIn=!1;init(){let{storage:e}=this.codex;e.addStorage("player",me)}receiveData(e,t){let{storage:a}=this.codex,{playerId:s,name:r,photo:i,locale:f}=e;a.setStorageData("player","playerId",s),a.setStorageData("player","name",r),a.setStorageData("player","photo",i),a.setStorageData("player","locale",f),t&&(this.setPlayerData(t),this.isLoggedIn=!t.isFirstLogin)}async syncDataToSDK(){try{let e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch{}}async syncProfileToServer(){if(GameSDK.extra.isGuest)throw new Error("Guest player cannot sync profile to server");let{storage:e}=this.codex,t=this.getPlayer(),{playerId:a,name:s,photo:r,locale:i}=t,f=this.getPlayerASID();!bf.isString(f)&&"getASIDAsync"in GameSDK.player&&(f=await GameSDK.player.getASIDAsync()??f,e.setStorageData("player","ASID",`${f}`)),await Ef({appId:Lf,ASID:f,playerId:a,name:s,photo:r,locale:i})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){let{storage:t}=this.codex;t.setStorageData("player","data",e),this.syncDataToSDK()}setBestScore(e){this.setPlayerDataByName("score",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){let t=this.getGameData()??{},a=wt.merge(t,e);this.setPlayerDataByName("gameData",a)}async requestConnectedPlayers(){let{storage:e}=this.codex,t=(await GameSDK.player.getConnectedPlayersAsync()).map(r=>{let i=r.getID(),f=r.getName(),g=r.getPhoto();return!i||!f||!g?null:new Yt({playerId:i,name:f,photo:g}).toObject()}),a=Pf.unique(t);if(a.length<1)return;let s=wt.keyBy(a,"playerId");e.setStorageData("player","connectedPlayers",s)}getPlayer(){let{storage:e}=this.codex;return e.getStorage("player")}getPlayerId(){let{storage:e}=this.codex;return e.getStorageData("player","playerId")??""}getPlayerASID(){let{storage:e}=this.codex;return e.getStorageData("player","ASID")??null}getPlayerLocale(){let{storage:e}=this.codex;return e.getStorageData("player","locale")??""}getPlayerData(){let{storage:e}=this.codex;return e.getStorageData("player","data")??me.data}getPlayerDataByKey(e){let t=this.getPlayerData();return wt.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){let t=this.getPlayerSettings();return wt.hasOwn(t,e)?t[e]:null}getPlayerSettings(){let{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??me.data.isFirstLogin}isFirstSession(){return!this.isLoggedIn}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){let{score:e}=this.getPlayerData();return e}getConnectedPlayers(){let{storage:e}=this.codex;return e.getStorageData("player","connectedPlayers")??{}}getConnectedPlayerIds(e,t){let a=this.getConnectedPlayers();return Object.keys(a).slice(t,t+e)}getNotificationData(){return this.getPlayerDataByKey("notificationData")??me.data.notificationData}},Nf=Cf;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Dtos:dr,Utils:{Valid:U}}=Ludex,{score:Tf,settings:Of,gameData:_f,isFirstLogin:Rf,missionsData:Mf,notificationData:Ff,dailyRewardedData:kf,lastCallSwitchGame:Gf}=me.data,B="is invalid",hr=class extends le{processData(e){this.n(e),e.settings=new dr.Player.Settings(e.settings).toObject(),e.gameData=new dr.Player.GameData(e.gameData).toObject(),this.o(e),this.setupData(e)}setupData(e){this.d(e)}n(e){this.l(e)}o(e){this.c(e)}validateScore(e){(!U.isNumber(e)||e<0)&&this.e("score",B)}validateSettings(e){U.isObject(e)||this.e("settings",B)}validateMissionsData(e){U.isObject(e)||this.e("missionsData",B),(!("process"in e)||!U.isObject(e.process))&&this.e("missionsData.process",B)}validateNotificationData(e){U.isObject(e)||this.e("notificationData",B),(!("D1"in e)||!U.isObject(e.D1))&&this.e("notificationData.D1",B),(!("D2"in e)||!U.isObject(e.D2))&&this.e("notificationData.D2",B),(!("D3"in e)||!U.isObject(e.D3))&&this.e("notificationData.D3",B),(!("D4"in e)||!U.isObject(e.D4))&&this.e("notificationData.D4",B),(!("D5"in e)||!U.isObject(e.D5))&&this.e("notificationData.D5",B),(!("D6"in e)||!U.isObject(e.D6))&&this.e("notificationData.D6",B),(!("D7"in e)||!U.isObject(e.D7))&&this.e("notificationData.D7",B)}validateGameData(e){U.isObject(e)||this.e("gameData",B)}validateIsFirstLogin(e){U.isBoolean(e)||this.e("isFirstLogin",B)}validateDailyRewardedData(e){U.isObject(e)||this.e("dailyRewardedData",B)}validateLastCallSwitchGame(e){U.isNumber(e)||this.e("lastCallSwitchGame",B),e<0&&this.e("lastCallSwitchGame",B)}toObject(){return super.toObject()}};hr.addDefaultData({score:Tf,settings:Of,gameData:_f,isFirstLogin:Rf,missionsData:Mf,notificationData:Ff,dailyRewardedData:kf,lastCallSwitchGame:Gf});var Bf=hr;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:ur}=Ludex.Utils,{level:Uf,coins:jf}=me.data.gameData,pr=class extends le{setupData(e){this.d(e)}n(e){this.l(e)}o(e){this.c(e)}validateLevel(e){(!ur.isNumber(e)||e<0)&&this.e("level","is invalid")}validateCoins(e){(!ur.isNumber(e)||e<0)&&this.e("coins","is invalid")}toObject(){return super.toObject()}};pr.addDefaultData({level:Uf,coins:jf});var Hf=pr;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Valid:At}=Ludex.Utils,{sound:$f,music:Vf,vibrate:Kf,language:Wf}=me.data.settings,vt="is invalid",yr=class extends le{setupData(e){this.d(e)}n(e){this.l(e)}o(e){this.c(e)}validateSound(e){At.isBoolean(e)||this.e("sound",vt)}validateMusic(e){At.isBoolean(e)||this.e("music",vt)}validateVibrate(e){At.isBoolean(e)||this.e("vibrate",vt)}validateLanguage(e){(!At.isString(e)||!e)&&this.e("language",vt)}toObject(){return super.toObject()}};yr.addDefaultData({sound:$f,music:Vf,vibrate:Kf,language:Wf});var zf=yr;Ludex.Dtos.Player={Info:Yt,Data:Bf,Settings:zf,GameData:Hf};var qf=Nf;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Configs:{ApiHost:fr,Mockup:Yf},Utils:{Object:Jf,String:Qf}}=Ludex,Xf=class{mockAPI;async initMockAPI(){if(this.mockAPI)return;let e=(await import("./chunks-M5N4UHHN.js")).default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new e}async getPlayersAsync(e){let t=Qf.params(e),a;if(Yf.Profile.Enabled)await this.initMockAPI(),a=await this.mockAPI.getPlayersAsync(e);else{if(!fr)return[];a=await Ge(`players?${t}`,{},fr)}return!Jf.hasOwn(a,"data")||!Array.isArray(a.data)?[]:a.data}},Zf=Xf;n(),o(),l(),c(),d(),h(),u(),y(),p();var eg={profiles:{},profileIds:[]},gr=eg,{Utils:tg,Dtos:ag}=Ludex,{Array:mr,Valid:sg,Object:rg,Function:ig}=tg,ng=class extends Ludex.Plugins.BasePlugin{profileAPI=new Zf;init(){let{storage:e}=this.codex;e.addStorage("profile",gr)}async requestProfiles(e){let t=this.getProfileIds(),a=mr.difference(e,t);if(a.length<1)return;let s=mr.chunk(a,400).map(f=>this.profileAPI.getPlayersAsync({playerIds:f})),r=(await ig.allSettled(s)).reduce((f,g)=>g.status==="fulfilled"?f.concat(g.value):f,[]);if(!this.validateProfilesResponse(r))return;let i=this.convertToProfiles(r);this.setProfiles(i)}getProfile(e){return this.getProfiles()[e]??null}getProfiles(){let{storage:e}=this.codex;return e.getStorageData("profile","profiles")??gr.profiles}setProfiles(e){let{storage:t}=this.codex;t.setStorageData("profile","profiles",e),t.setStorageData("profile","profileIds",Object.keys(e))}getProfileIds(){let{storage:e}=this.codex;return e.getStorageData("profile","profileIds")??[]}validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}convertToProfiles(e){let t={};for(let a of e)rg.hasOwn(a,"playerId")&&sg.isString(a.playerId)&&(t[a.playerId]=new ag.Player.Info(a).toObject());return t}},og=ng,lg=og;ee(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var wr="Tile Connect",{Utils:{Object:Ar,Valid:vr,Browser:Dr}}=Ludex,cg=class extends Ludex.Plugins.BasePlugin{storages;storageLocalKeys={};constructor(e){super(e),this.storages={}}async addStorage(e,t,a=!1){this.storages[e]=t,a&&await this.initFromWebStorage(e,t)}async initFromWebStorage(e,t){this.storageLocalKeys[e]=!0;let a=await Dr.getIndexedDB(`${wr}_S_${e}`);if(!vr.isObject(a))return;let s=Object.keys(t);for(let r of s)Ar.hasOwn(a,r)&&typeof t[r]==typeof a[r]&&this.setStorageData(e,r,a[r])}initStorageData(e,t,a){this.storages[e][t]=a}setStorageData(e,t,a){let s;if(vr.isObject(a)){let r=this.getStorageData(e,t);s=Ar.merge(r,a)}else s=a;this.storages[e][t]=s}getStorageData(e,t){return this.getStorage(e)[t]}getStorage(e){return this.storages[e]}async updateToWebStorage(e){if(this.storageLocalKeys[e])return this.saveToWebStorage(e)}async saveToWebStorage(e){let t=this.getStorage(e);return Dr.setIndexedDB(`${wr}_S_${e}`,t)}},dg=cg,hg=dg;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var ug=class extends Ludex.Plugins.BasePlugin{isVisible=!0;browserPrefixes=["moz","ms","o","","webkit"];init(){let e=this.getBrowserPrefix(),t=[this.getVisibilityEvent(e),"focus","blur"];for(let a of t)this.registerEvent(window,a),this.registerEvent(document,a);GameSDK.extra&&("onPause"in GameSDK.extra&&GameSDK.extra.onPause(()=>this.handleVisibilityChange("blur")),"onResume"in GameSDK.extra&&GameSDK.extra.onResume(()=>this.handleVisibilityChange("focus"))),this.registerEvent(window,"pageshow"),this.registerEvent(window,"pagehide"),window.addEventListener("message",a=>{(a.data==="nativePause"||a.data==="nativeResume")&&this.handleVisibilityChange(a.data)},!1)}isGameVisible(){return this.isVisible}getHiddenPropertyName(e){return e?`${e}Hidden`:"hidden"}getVisibilityEvent(e){return`${e||""}visibilitychange`}getBrowserPrefix(){for(let e of this.browserPrefixes)if(this.getHiddenPropertyName(e)in document)return e;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.codex.event.emit(Ludex.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.codex.event.emit(Ludex.Events.VISIBILITY_HIDDEN))}registerEvent(e,t){e.addEventListener(t,()=>{this.handleVisibilityChange(t)},!1)}handleVisibilityChange=e=>{let t={focus:this.onVisibleEvent.bind(this),pageshow:this.onVisibleEvent.bind(this),nativeResume:this.onVisibleEvent.bind(this),blur:this.onHiddenEvent.bind(this),pagehide:this.onHiddenEvent.bind(this),nativePause:this.onHiddenEvent.bind(this)};if(t[e]){t[e]();return}let a=this.getBrowserPrefix();this.getHiddenPropertyName(a)in document?this.onHiddenEvent():this.onVisibleEvent()}},pg=ug,yg=pg;Ia(),n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{Utils:{Object:Ir},Plugins:{Ads:{Status:J,Types:pe,AdError:Dt,AdInstance:fg}}}=Ludex,gg=class extends fg{service;instance;instanceQueue=[];constructor(e,t){super(e,t),this.service=GameSDK.getSDKName(),this.instance=null}async loadAsync(){if(!(this.instance&&this.status===J.FILLED)){if(this.status!==J.IDLE)throw new Dt("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new Dt("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.setStatus(J.LOADING),await this.instance.loadAsync(),this.setStatus(J.FILLED),this.logAdLoad()}catch(e){throw this.setStatus(J.IDLE),e instanceof Object&&"code"in e&&e.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.pushInstanceToQueue(this.instance),self.codex.analytics.loadAdFail({type:this.type,service:this.service}),e}}}async showAsync(){if(this.status!==J.FILLED)throw new Dt("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new Dt("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let e=!1;try{this.setStatus(J.SHOWING),self.codex.analytics.showingAd({type:this.type,service:this.service}),await this.instance.showAsync(),e=!0,this.setStatus(J.IDLE),this.instance=null}catch(t){throw Ir.hasOwn(t,"code")&&(t.code==="AD_NOT_LOADED"&&this.setStatus(J.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf(`${t.code}`)>-1&&(this.setStatus(J.IDLE),this.instance=null),t.code==="USER_INPUT"&&(e=!0)),this.status===J.SHOWING&&(this.setStatus(J.IDLE),this.instance=null),t}finally{e?this.logAdShown():self.codex.analytics.showAdFail({type:this.type,service:this.service})}}async createInstanceByType(e){try{return await this.getAdInstanceByType(e)}catch(t){return Ir.hasOwn(t,"code")&&t.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed():null}}async getAdInstanceByType(e){switch(e){case pe.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case pe.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);case pe.REWARDED_INTERSTITIAL:return await GameSDK.getRewardedInterstitialAsync(this.placementId);default:return null}}getAdInstanceFailed(){if("canBeLoadedAd"in GameSDK.extra){for(let e of this.instanceQueue)if(GameSDK.extra.canBeLoadedAd(e))return this.instanceQueue.splice(this.instanceQueue.indexOf(e),1),e}else return this.instanceQueue.shift()||null;return null}logAdLoad(){switch(this.type){case pe.INTERSTITIAL:self.codex.analytics.loadInterstitialAd({service:this.service});break;case pe.REWARDED_VIDEO:self.codex.analytics.loadRewardedVideoAd({service:this.service});break;case pe.REWARDED_INTERSTITIAL:self.codex.analytics.loadRewardedInterstitialAd({service:this.service});break}}logAdShown(){switch(this.type){case pe.INTERSTITIAL:self.codex.analytics.showInterstitialAd({service:this.service});break;case pe.REWARDED_VIDEO:self.codex.analytics.showRewardedVideoAd({service:this.service});break;case pe.REWARDED_INTERSTITIAL:self.codex.analytics.showRewardedInterstitialAd({service:this.service});break}}pushInstanceToQueue(e){this.instanceQueue.push(e)}},xr=gg,{Plugins:{Ads:{Types:It}}}=Ludex,mg=class extends xr{constructor(e,t){super(e,t),this.service="adsense"}async createInstanceByType(e){try{let t=window.GoogleAds;if(!t)throw new Error("GoogleAds not found");switch(e){case It.BANNER:return t.getBannerAdAsync(this.placementId);case It.REWARDED_VIDEO:return t.getRewardedVideoAsync(this.placementId);case It.INTERSTITIAL:return t.getInterstitialAdAsync(this.placementId);case It.REWARDED_INTERSTITIAL:return t.getRewardedInterstitialAsync(this.placementId);default:return null}}catch{return null}}getAdInstanceFailed(){return null}},wg=mg;n(),o(),l(),c(),d(),h(),u(),y(),p(),n(),o(),l(),c(),d(),h(),u(),y(),p();var Ag=class extends gs{async loadAsync(){this.e("Unsupported method")}async showAsync(){this.e("This method is not implemented")}async hideAsync(){this.e("This method is not implemented")}},vg=Ag,{Status:Sr}=Ludex.Plugins.Ads,Dg=class extends vg{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.setStatus(Sr.SHOWING)}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.setStatus(Sr.IDLE)}},Ig=Dg;n(),o(),l(),c(),d(),h(),u(),y(),p();var{Utils:{Array:ve}}=Ludex,ye={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed"},De={NOT_STARTED:"not-started",IN_PROGRESS:"in-progress",COMPLETED:"completed",FAILED:"failed"},Er=["reward"],Pr=["next","preroll","browse","pause","start"],xt=["auto"],xg=class{initStatus=ye.IDLE;preloadStatus=De.NOT_STARTED;codex;adBreak;adConfig;config;serviceName="adsense";rewardedType="reward";interstitialType="next";bannerFormatType="auto";constructor(e){this.codex=e}setInitStatus(e){this.initStatus!==e&&(this.codex?.analytics?.initAdEvent({adService:this.serviceName,state:e}),this.initStatus=e)}getInitStatus(){return this.initStatus}async getRewardedVideoAsync(e){return await this.ensureInitialized(),this.createAdInstance(this.rewardedType,e)}async getInterstitialAdAsync(e){return await this.ensureInitialized(),this.createAdInstance(this.interstitialType,e)}async getRewardedInterstitialAsync(e){return await this.ensureInitialized(),this.createAdInstance(this.rewardedType,e)}async getBannerAdAsync(e){return await this.ensureInitialized(),this.createAdInstance(this.bannerFormatType,e)}setRewardType(e){ve.has(Er,e)&&(this.rewardedType=e)}setInterstitialType(e){ve.has(Pr,e)&&(this.interstitialType=e)}setBannerFormatType(e){ve.has(xt,e)&&(this.bannerFormatType=e)}async initAsync(e){try{switch(this.initStatus){case ye.LOADED:return;case ye.LOADING:return}if(!this.validateConfig(e))throw new Error("Invalid Google Ads configuration");this.setInitStatus(ye.LOADING),this.config=e,await this.loadScriptElementAsync()}catch(t){throw this.setInitStatus(ye.FAILED),t}}validateConfig(e){if(!e)return!1;let{dataAdClient:t,dataAdHost:a}=e;if(!t&&!a)return!1;if(e.dataAdFrequencyHint){let s=Number(e.dataAdFrequencyHint);if(isNaN(s)||s<=0)return!1}return!0}async loadScriptElementAsync(){try{await this.injectMainScript(),await this.configureGoogleAds(),this.config.usePreload&&await this.preloadAdConfig()}catch(e){throw e}}async injectMainScript(){return new Promise((e,t)=>{try{let a=document.createElement("script");this.configureScriptAttributes(a),a.onload=()=>{this.setInitStatus(ye.LOADED),e()},a.onerror=s=>{this.setInitStatus(ye.FAILED),t(new Error(`Failed to load ${this.serviceName} Ads script: ${s}`))},document.head.appendChild(a)}catch(a){t(a)}})}async configureGoogleAds(){try{window.adsbygoogle=window.adsbygoogle||[],window.adBreak=e=>adsbygoogle.push(e),window.adConfig=e=>adsbygoogle.push(e),this.adBreak=window.adBreak,this.adConfig=window.adConfig}catch(e){throw e}}configureScriptAttributes(e){let{dataAdClient:t,dataAdHost:a,dataAdChannel:s,dataAdBreakTest:r,dataAdFrequencyHint:i}=this.config;e.async=!0,e.crossOrigin="anonymous";let f="";i&&e.setAttribute("data-ad-frequency-hint",`${i}s`),t&&(e.setAttribute("data-ad-client",t),f+=`?client=${t}`),s&&e.setAttribute("data-ad-channel",s),a&&(e.setAttribute("data-ad-host",a),f+=`&host=${a}`),r&&e.setAttribute("data-adbreak-test","on"),e.src=`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js${f}`}async ensureInitialized(){if(this.initStatus!==ye.LOADED)throw new Error("Google Ads not initialized. Call initAsync first.");await this.ensurePreloaded()}async ensurePreloaded(){this.preloadStatus!==De.COMPLETED&&await this.preloadAdPlacement()}createAdInstance(e,t){let a=ve.has(xt,e);return{getPlacementID:()=>t,loadAsync:async()=>{if(!a)return this.preloadAdPlacement();let{dataAdClient:s,dataAdBreakTest:r}=this.config;return this.setupBannerAdElement({placementId:t,dataAdClient:s,dataAdBreakTest:r})},showAsync:()=>this.showAd(e,t),hideAsync:()=>this.hideAd(e,t)}}async showAd(e,t){return new Promise((a,s)=>{try{if(ve.has(xt,e))return;let r=this.createAdBreakConfig({type:e,placementId:t,resolve:a,reject:s});this.adBreak(r)}catch(r){s(r)}})}async hideAd(e,t){if(!ve.has(xt,e)||document.getElementsByClassName("adsbygoogle").length===0)return;let a=this.getBannerAdElement(t);a&&a.remove()}getBannerAdElement(e){let t=document.getElementsByClassName("adsbygoogle");return Array.from(t).find(a=>a.getAttribute("data-placement-id")===e)||null}async setupBannerAdElement(e){let{placementId:t,dataAdClient:a,dataAdBreakTest:s}=e;if(this.getBannerAdElement(t))return;let r=document.createElement("div");r.className="google-ads-banner",r.style.height="51px",r.style.bottom="0";let i=document.createElement("ins");i.className="adsbygoogle",i.setAttribute("data-ad-client",a),i.setAttribute("data-ad-slot",t??""),i.setAttribute("data-ad-test",s?"on":"off"),i.setAttribute("data-full-width-responsive","false"),r.appendChild(i);let f=document.createElement("script");f.innerHTML="(adsbygoogle = window.adsbygoogle || []).push({});",r.appendChild(f),document.body.insertAdjacentElement("beforeend",r)}createAdBreakConfig(e){let t=this.createBaseAdBreakConfig({placementId:e.placementId}),{type:a}=e;if(ve.has(Pr,a))return this.createInterstitialAdBreakConfig(t,e);if(ve.has(Er,a))return this.createRewardAdBreakConfig(t,e);throw new Error(`Ad type: ${a} is not supported.`)}createBaseAdBreakConfig(e){return{name:e.placementId,beforeAd:()=>{},adBreakDone:t=>{}}}createInterstitialAdBreakConfig(e,{resolve:t,reject:a}){return L(I({},e),{type:this.interstitialType,adBreakDone:s=>{e.adBreakDone?.(s),this.handleAdBreakDone({info:s,resolve:t,reject:a})}})}createRewardAdBreakConfig(e,{resolve:t,reject:a}){return L(I({},e),{type:this.rewardedType,beforeReward:s=>{s()},adDismissed:()=>{a(new Error("USER_INPUT"))},adViewed:()=>{t()}})}handleAdBreakDone(e){let{info:t,resolve:a,reject:s}=e;switch(t.breakStatus){case"viewed":a();break;case"frequencyCapped":s(new Error("AD_FREQUENCY_CAPPED"));break;default:s(new Error(t.breakStatus))}}async preloadAdPlacement(){if(this.initStatus!==ye.LOADED)throw new Error(`${this.serviceName} Ads not initiated.`);return this.preloadAdConfig()}getPreloadStatus(){return this.preloadStatus}async preloadAdConfig(){if(this.preloadStatus!==De.COMPLETED&&this.preloadStatus!==De.IN_PROGRESS)return this.preloadStatus=De.IN_PROGRESS,new Promise((e,t)=>{let a=setTimeout(()=>{this.preloadStatus===De.IN_PROGRESS&&(this.preloadStatus=De.FAILED,t(new Error("Failed to preload ad config in time.")))},5e3);this.adConfig({preloadAdBreaks:"on",onReady:()=>{clearTimeout(a),this.preloadStatus=De.COMPLETED,e()}})})}},Sg=xg;ee(),ee(),ee(),ee(),ee(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{BaseAnalytics:Eg,Events:je}=Ludex.Plugins.Analytics,Pg=[je.SCREEN_OPEN],{Utils:{Array:bg}}=Ludex,Lg=class extends Eg{constructor(e,t){super(e,"GoogleAnalytics",L(I({},t),{color:"#E35335"}))}processEvent(e,t){bg.has(Pg,e)||(this.customEvent(e,t),gtag("event",e,t))}customEvent(e,t){switch(e){case je.AD_SHOW:case je.AD_SHOW_FAILED:case je.AD_SHOWING:case je.USE_ITEM:case je.EARN_ITEM:this.addLevelName(t);break;default:break}}addLevelName(e){if(!e||!this.codex?.match)return;let t=this.codex.match.getMatchState().customData.level;!t||t<0||(e.level_name=this.getLevelName(t))}},ma=Lg;ee(),n(),o(),l(),c(),d(),h(),u(),y(),p();var{BaseAnalytics:Cg}=Ludex.Plugins.Analytics,Ng=class extends Cg{constructor(e){super(e,"XiaomiAnalytics",{color:"#00c6ff"})}processEvent(e){GameSDK.extra&&"logEvent"in GameSDK.extra&&GameSDK.extra.logEvent(e)}},Tg=Ng;ee();var br="production",wa=15,{Dtos:Og,Events:Ie,Configs:{AppId:_g,Ads:Z,Analytics:St,Debugger:ie,Firebase:Lr,Notification:Rg,RemoteConfig:Cr,PerformanceMonitor:Mg,AdaptivePerformance:Nr},Plugins:{Ads:{Types:Et}},Utils:{Device:Fg,Object:Tr,Json:st,String:Or,Valid:kg,Time:Gg,Function:Bg,Mark:R}}=Ludex,Ug=class extends Ac{markName="Core Initialize";modulePlugins=[];getBuildVersion(){return parseInt(`${wa}`)||0}async boot(){super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(Ie.CORE_BOOTING),this.f(),this.initFirebasePlugin(),this.initMarkCoreInitialize(),R.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initClarityAnalytics(),this.initFirebaseAnalytics(),this.initYandexAnalytics(),this.initXiaomiAnalytics(),this.initFacebookAnalytics(),this.initTranssionH5Analytics(),R.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),R.putAttr(this.markName,"Step","Load Lazy Plugins"),kg.isDebugger()||this.event.on(Ie.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addCanvasRecorderPlugin().then(this.initCanvasRecorderPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),this.addInputRecorderPlugin().then(this.initInputRecorderPlugin),R.putAttr(this.markName,"Step","Load Dev Plugins"),this.event.catchUp(Ie.GAME_SDK_READY,this.addDevPlugins)}async f(){await Gg.sleepAsync(2e3),this.event.getEventListeners(Ie.CORE_BOOTING).length}async start(){super.start(),R.putAttr(this.markName,"Step","Core Start"),this.event.emit(Ie.CORE_STARTING),R.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),R.putAttr(this.markName,"Step","Init States"),await this.initState(),R.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),GameSDK.getSDKName()==="FacebookInstant"&&Fg.isIOS()?this.event.catchUp(Ie.GAME_SDK_STARTED,this.processContextSession):await this.processContextSession(),R.putAttr(this.markName,"Step","Core Ready"),R.putAttr(this.markName,"Success","true"),this.event.emit(Ie.CORE_READY)}processContextSession=async()=>{R.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();let e=this.storage.getStorageData("context","sessionContextType")||"unknown";R.putAttr(this.markName,"Context Mode",e),R.stop(this.markName)};addPlugins(){this.installPlugin("Storage",hg),this.installPlugin("Event",ih),this.installPlugin("Ads",Jc),this.installPlugin("Auth",Dd),this.installPlugin("Audio",fd),this.installPlugin("Match",yf),this.installPlugin("Player",qf),this.installPlugin("Profile",lg),this.installPlugin("Context",jd),this.installPlugin("Language",uh),this.installPlugin("Missions",If),this.installPlugin("Analytics",dd),this.installPlugin("Visibility",yg),this.installPlugin("Leaderboard",Eh),this.installPlugin("DailyRewards",Xd),this.installPlugin("FrameCapture",j),this.installPlugin("RemoteConfig",j),"Proxy"in window&&this.installPlugin("Firebase",j)}installPlugin(e,t,a=!1){let s=Or.toCamelCase(Or.capitalize(e));this.plugins.install(e,t,!0,s),e!=="Storage"&&(a?this.emitModulePluginReady(e):this.emitCorePluginReady(e))}async addMonitorPlugin(){try{let{MonitorError:e}=ie;if(!e.Enabled)return;this.modulePlugins.push("MonitorError");let t=(await import("./chunks-PAOICN6Y.js")).default;if(typeof t!="function")return;this.installPlugin("MonitorError",t,!0)}catch{}}async addCanvasRecorderPlugin(){try{let{CanvasRecorder:e}=ie;if(!e.Enabled)return;this.modulePlugins.push("CanvasRecorder");let t=(await import("./chunks-M5N4UHHN.js")).default;if(typeof t!="function")throw new Error("CanvasRecorderPlugin is not a function");this.installPlugin("CanvasRecorder",t,!0)}catch{}}async addAdaptivePerformancePlugin(){try{if(!Nr.Enabled)return;this.modulePlugins.push("AdaptivePerformance");let e=(await import("./chunks-UZX6RL7C.js")).default;if(typeof e!="function")return;this.installPlugin("AdaptivePerformance",e,!0)}catch{}}async addInputRecorderPlugin(){try{let{InputRecorder:e}=ie;if(!e.Enabled)return;this.modulePlugins.push("InputRecorder");let t=(await import("./chunks-M5N4UHHN.js")).default;if(typeof t!="function")return;this.installPlugin("InputRecorder",t,!0)}catch{}}addDevPlugins=()=>{let{ListPlayerDevIds:e}=ie,t=GameSDK?.player?.getID();br!=="development"&&(!t||e.indexOf(t)<0)||(this.addConsolePlugin(),this.addProfilerPlugin())};async addConsolePlugin(){try{let{Console:e}=ie;if(!e.Enabled)return;this.modulePlugins.push("Console");let t=(await import("./chunks-M5N4UHHN.js")).default;if(typeof t!="function")throw new Error("ConsolePlugin is not a function");this.installPlugin("Console",t,!0),this.initConsolePlugin()}catch{}}async addProfilerPlugin(){try{let{Profiler:e}=ie;if(!e.Enabled)return;this.modulePlugins.push("Profiler");let t=(await import("./chunks-M5N4UHHN.js")).default;if(typeof t!="function")throw new Error("ProfilerPlugin is not a function");this.installPlugin("Profiler",t,!0),this.initProfilerPlugin()}catch{}}emitCorePluginReady(e){this.event.emit(ge.CORE_PLUGIN_READY,{name:e})}emitModulePluginReady(e){this.event.emit(ge.MODULE_PLUGIN_READY,{name:e})}handleProtectGameInstance=()=>{let e=this.event.getEventEmitCount(ge.MODULE_PLUGIN_READY),t=this.modulePlugins.length;e<t||(window.codex=Object.freeze(window.codex),Da(window,"codex"))};initEventPlugin(){let{EventLogging:e}=ie;e.Enabled&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){this.ads.configure(Z),this.initGoogleAds(),this.initTranssionH5Ads(),this.initAdInstance(),Z.Enabled&&this.analytics.initAdEvent({adService:"platform",state:"loaded"})}async initGoogleAds(){try{if(!Z.Enabled)return;let{AdSense:e}=Z.AdServiceConfigs;if(!e.Enabled)return;let t=new Sg(this);await t.initAsync({usePreload:e.UsePreload,dataAdHost:e.DataAdHost,dataAdClient:e.DataAdClient,dataAdChannel:e.DataAdChannel,dataAdBreakTest:e.DataAdBreakTest,dataAdFrequencyHint:e.DataAdFrequencyHint}),window.GoogleAds=t}catch{}}async initTranssionH5Ads(){try{if(!Z.Enabled)return;let{Savana:e}=Z.AdServiceConfigs;if(!e.Enabled)return;let t=new j(this);await t.initAsync({usePreload:e.UsePreload,dataAdHost:e.DataAdHost,dataAdClient:e.DataAdClient,dataAdChannel:e.DataAdChannel,dataAdBreakTest:e.DataAdBreakTest,dataAdFrequencyHint:e.DataAdFrequencyHint}),window.TranssionH5Ads=t}catch{}}getAdInstanceByService(e,t=!1){let{AdSense:a,AppLovin:s,Savana:r}=Z.AdServiceConfigs;switch(e){case"adsense":if(a.Enabled)return wg;break;case"applovin":s.Enabled;break;case"savana":if(r.Enabled)return j;break;default:return t?Ig:xr}return null}initAdInstance(){for(let t of Z.InterstitialAdOptions){let a=this.getAdInstanceByService(t.AdService);a&&this.ads.setAdInstance(Et.INTERSTITIAL,t.PlacementId,a)}for(let t of Z.RewardedVideoAdOptions){let a=this.getAdInstanceByService(t.AdService);a&&this.ads.setAdInstance(Et.REWARDED_VIDEO,t.PlacementId,a)}for(let t of Z.RewardedInterstitialAdOptions){let a=this.getAdInstanceByService(t.AdService);a&&this.ads.setAdInstance(Et.REWARDED_INTERSTITIAL,t.PlacementId,a)}let e=!0;for(let t of Z.BannerDisplayAdOptions){let a=this.getAdInstanceByService(t.AdService,e);a&&this.ads.setAdInstance(Et.BANNER,t.PlacementId,a)}}async initState(){try{let e=new Hc(this);e.initContext(),await e.initPlayer()}catch{}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin=()=>{if(!this.canvasRecorder)return;let{CanvasRecorder:e}=ie,{Type:t,Quality:a,RecordFps:s,SyncFps:r}=e.Options;this.canvasRecorder.configure({type:t,quality:a,syncFps:r,recordFps:s}),this.canvasRecorder.setPanelExpanded(e.PanelExpanded);let i=document.querySelector("canvas");i&&this.canvasRecorder.setCanvas(i)};initMonitorErrorPlugin=()=>{if(!this.monitorError)return;let{MonitorError:e,ListPlayerDevIds:t}=ie,{ApiKey:a,Service:s,Feedback:r,TrackUser:i,FilterErrors:f}=e,{playerId:g,name:m}=this.player.getPlayer();g&&t.indexOf(g)>=0||(window.disableSimpleTrackErrors?.(),this.monitorError.configure({apiKey:a,service:s,feedback:r,trackUser:i,releaseStage:br,buildVersion:`${wa??1}`}),this.monitorError.setUser({id:g,name:m}),this.monitorError.addFilterErrors(f),this.monitorError.initFeedbackTrackErrors(),this.updateMonitorErrorUserAndMetadata(),this.processErrorsQueue())};updateMonitorErrorUserAndMetadata=()=>{this.event.catchUp(Ie.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded)};processErrorsQueue=()=>{if(this.monitorError&&window.__errorQueue){for(let e of window.__errorQueue)if(e instanceof Error)this.monitorError.sendException(e);else{let t=Bg.toError(e);this.monitorError.sendException(t)}window.__errorQueue=null}};processWhenPlayerInfoLoaded=()=>{if(!this.monitorError)return;let{playerId:e,name:t}=this.player.getPlayer();this.monitorError.setUser({id:e,name:t}),this.monitorError.addMetadata({isFirstSession:this.player.isFirstSession()})};initRemoteConfig(){if(!Cr.Enabled)return;let e=st.clone(Cr);this.remoteConfig.configure(e),this.event.on(ge.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(ge.REQUEST_UPDATE_CONFIG,this.handleUpdateLudexConfig),this.event.catchUp(ge.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}handleSaveRemoteConfig=e=>{try{let t={[e.type]:e};this.player.setPlayerDataByName("remoteConfig",t)}catch{}};handleUpdateLudexConfig=e=>{try{let{id:t,type:a}=e;if(a!=="Ludex")return;Ludex.Configs=Tr.merge(Ludex.Configs,e.config);let{Ads:s}=Ludex.Configs;this.ads.configure(s),this.event.emit(ge.REMOTE_CONFIG_UPDATED,{id:t,type:a})}catch{}};handleStorageCurrentRemoteConfig=()=>{let e=this.player.getPlayerDataByKey("remoteConfig");if(e){for(let t in e)if(Tr.hasOwn(e,t)){let a=e[t],s=st.clone(a),r=new Og.RemoteConfig.Data(s).toObject();this.remoteConfig.setRemoteConfig(r),this.remoteConfig.processUpdateConfig(r.id,r.type)}}};initFirebasePlugin(){if(!Lr.Enabled||!this.firebase)return;let e=st.clone(Lr);this.firebase.configure(e),R.setService(this.firebase.services.performance)}initMarkCoreInitialize(){Mg.CoreFlows&&(R.measure(this.markName),R.putAttr(this.markName,"Build",`${wa}`),R.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),R.putAttr(this.markName,"Platform",GameSDK.getPlatform()),R.putAttr(this.markName,"Success","false"),R.start(this.markName))}initAdaptivePerformancePlugin=()=>{if(!this.adaptivePerformance)return;let e=st.clone(Nr);this.adaptivePerformance.configure(e)};initInputRecorderPlugin=()=>{if(!this.inputRecorder)return;let{InputRecorder:e}=ie,t=st.clone(e);t&&this.inputRecorder.configure(t)};async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch{}}processAfterSyncProfile=()=>{Rg.Enabled&&this.updatePlayerProfileToNotificationService()};async updatePlayerProfileToNotificationService(){try{let e=this.player.getPlayer(),{ASID:t,playerId:a,name:s,photo:r,locale:i}=e;await bc({appId:_g,ASID:t,playerId:a,name:s,photo:r,locale:i})}catch{}}initGoogleAnalytics(){let{Enabled:e,ConsoleLog:t}=St.GoogleAnalytics??{};if(e){if(typeof ma!="function"||!(ma.prototype instanceof Object))return;this.analytics.add(new ma(this.codex,{log:!!t}))}}initClarityAnalytics(){let{Enabled:e,ConsoleLog:t}=St.ClarityAnalytics??{};if(!e||typeof j!="function"||!(j.prototype instanceof Object))return;let a=new j(this.codex,{log:!!t}),s=this.player.getPlayer(),{playerId:r}=s;a.setUser(r,GameSDK.extra.isGuest),this.analytics.add(a)}initFirebaseAnalytics(){let{Enabled:e,ConsoleLog:t}=St.FirebaseAnalytics??{};if(!e||typeof j!="function"||!(j.prototype instanceof Object))return;let a=new j(this.codex,{log:!!t});this.analytics.add(a);let s="no_entry";GameSDK.getEntryPointAsync().then(r=>{s=r}).catch(r=>{}).finally(()=>{let r=this.player.getPlayer(),{playerId:i,locale:f}=r,{fbig_ad_id:g,fbig_adset_id:m,fbig_campaign_id:w,fb_instant_game_adset_id:A,fb_instant_game_ad_id:v,fb_instant_game_campaign_id:x}=GameSDK.getEntryPointData()||{},S=g||v,P=m||A,C=w||x;a.setUser(i,{locale:f,ad_id:S,adset_id:P,campaign_id:C,traffic_source:s})})}initYandexAnalytics(){GameSDK.getSDKName()==="Yandex"&&this.analytics.add(new j(this.codex))}initXiaomiAnalytics(){GameSDK.getSDKName()==="Xiaomi"&&this.analytics.add(new Tg(this.codex))}initFacebookAnalytics(){let e=GameSDK.getSDKName(),{Enabled:t,Prefix:a,ConsoleLog:s}=St.FacebookAnalytics??{};if(!(!t||e!=="FacebookInstant")){if(typeof a!="string")return;this.analytics.add(new j(this.codex,{prefix:a,log:!!s}))}}initTranssionH5Analytics(){GameSDK.getSDKName()==="TranssionH5"&&this.analytics.add(new j(this.codex))}},jg=Ug,{Configs:{GameEngine:{ForceDesktopDPR:Pt}},Utils:{Device:Hg},Events:Aa}=Ludex,$g=async()=>{let e=new jg;window.codex=e,globalThis.codex=e;let t=20;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t),window.__ludexStart=!0,await e.boot(),e.event.catchUp(Aa.REQUEST_CORE_START,_r),Vg(e)},_r=()=>{if(!window.__sdkInitiated){codex.event.catchUp(Aa.GAME_SDK_READY,_r);return}codex.start();let e=25;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e)},Vg=e=>{let t=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(t);let a=10;window.__sdkLoadingCount<a&&(window.__sdkLoadingCount=a),e.event.emit(Aa.GAME_SDK_READY)},5)};Pt!==!1&&Hg.isDesktop()&&typeof Pt=="number"&&Pt>0&&(window.devicePixelRatio=Pt),window.originalRequestAnimationFrame=window.requestAnimationFrame,window.isCustomRequestAnimationFrame=window.isCustomRequestAnimationFrame??!0,window.isCustomRequestAnimationFrame&&(window.requestAnimationFrame=e=>window.isCustomRequestAnimationFrame?(setTimeout(e,1e3/60),0):window.originalRequestAnimationFrame(e)),$g();
