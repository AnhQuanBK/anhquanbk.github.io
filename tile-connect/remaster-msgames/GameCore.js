var kc=Object.defineProperty;var eh=(a,e,t)=>e in a?kc(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var o=(a,e)=>kc(a,"name",{value:e,configurable:!0});var f=(a,e,t)=>(eh(a,typeof e!="symbol"?e+"":e,t),t);import{G as p,P as N,M as sh,_ as lt,a as J,C as wt,w as nh}from"./bundle/core.js";import{g as ah}from"./bundle/__commonjsHelpers__.js";o(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}o(t,"getFetchOpts");function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}o(s,"processPreload")},"polyfill")();const{Valid:Ut,Object:vs,String:Ss,Json:Uc}=p.Utils,te="is invalid",tt=class tt{static addDefaultData(e){Ut.isObject(e)||this.prototype.exception("default data",te),e=Uc.clone(e);const{name:t}=this;Ut.isObject(tt.data[t])||(tt.data[t]={}),tt.data[t]=vs.merge(tt.data[t],e),console.info(`${t} default data:`,tt.data[t])}static getDefaultData(){const{name:e}=this;return Uc.clone(tt.data[e])}static addValidateFunction(e,t){Ut.isString(e)||this.prototype.exception("validate key",te),typeof t!="function"&&this.prototype.exception("validate function",te);const s=`validate${Ss.capitalize(e)}`;Object.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){const{name:e}=this.constructor;this.lazyDefaultData(tt.data[e])}lazyDefaultData(e){Ut.isObject(e)||this.exception("data",te);for(const t in e)if(vs.hasOwn(e,t)){const s=e[t];Object.assign(this,{[t]:s})}}lazyValidateStructure(e){Ut.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(t=>{const s=this[t];s===void 0&&this.exception("structure",`has no key ${t}`),!vs.hasOwn(e,t)&&s!==void 0&&this.setDefaultData(t,e)})}setDefaultData(e,t){Ut.isObject(t)||this.exception("data",te);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),Object.assign(t,{[e]:s})}lazyValidateData(e){this.getKeys().forEach(t=>{const s=e[t],n=Ss.removeDiacritics(t).replace(/[^a-zA-Z0-9]/g,""),i=`validate${Ss.capitalize(n)}`,r=this[i];if(typeof r=="function")try{r.call(this,s)}catch(c){console.warn(c),this.setDefaultData(t,e)}else this.exception("validate",`has no function ${i}`)})}lazySetupData(e){this.getKeys().forEach(t=>{const s=e[t];Object.assign(this,{[t]:s})})}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};o(tt,"BaseDtos"),f(tt,"data",{});let F=tt;p.Dtos={Base:F};const ih={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",dailyRewarded:"dailyRewarded",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin"},Re={ASID:"9999",playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},{Valid:ee}=p.Utils,{playerId:rh,name:oh,photo:ch,locale:lh}=Re,se="is invalid",Pi=class Pi extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!ee.isString(e)||!e)&&this.exception("_id",se)}validatePlayerId(e){(!ee.isString(e)||!e)&&this.exception("playerId",se)}validateName(e){(!ee.isString(e)||!e)&&this.exception("name",se)}validatePhoto(e){ee.isString(e)||this.exception("photo",se)}validateLocale(e){(!ee.isString(e)||!e)&&this.exception("locale",se)}toObject(){return super.toObject()}};o(Pi,"PlayerInfoDtos");let Kt=Pi;Kt.addDefaultData({playerId:rh,name:oh,photo:ch,locale:lh});const dt=new Kt({playerId:"10",name:"Your Friend"}).toObject(),Ci=class Ci extends Error{constructor(t){super(t);f(this,"code");this.code="CREATE_MATCH_FAILED"}};o(Ci,"ACreateMatchFailed");let et=Ci;const Ti=class Ti extends et{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}};o(Ti,"PlayerIdNotValid");let D=Ti;const{Dtos:Ps}=p,_i=class _i{constructor(e){f(this,"game");f(this,"initContext",o(()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new Ps.Context.Info(e),{contextId:s,contextType:n,entryPointData:i}=t.toObject();this.game.context.receiveContext(s,n,i)},"initContext"));f(this,"initPlayer",o(async()=>{const{player:e}=this.game,t=this.getPlayerInfo();console.info("playerInfo",p.Utils.Json.clone(t));const s=Object.values(ih);console.info("dataKeys",s);const n=await GameSDK.player.getDataAsync(s);console.info("rawData",p.Utils.Json.clone(n));const i=new Ps.Player.Data(n).toObject();console.info("playerData",p.Utils.Json.clone(i)),e.receiveData(t,i),this.game.event.emit(p.Events.PLAYER_INFO_LOADED)},"initPlayer"));f(this,"getPlayerInfo",o(()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),n=GameSDK.getLocale();if(!p.Utils.Valid.isString(e))throw new D;return p.Utils.Valid.isString(t)||(t="You"),new Ps.Player.Info({playerId:e,name:t,photo:s,locale:n}).toObject()}catch{return dt}},"getPlayerInfo"));this.game=e}};o(_i,"StateInitiator");let Xs=_i;const xi=class xi extends Error{constructor(t,s){super(t);f(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}};o(xi,"BadRequest");let he=xi;const Ni=class Ni extends Error{constructor(t,s){super(t);f(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}};o(Ni,"RequestTimeout");let ue=Ni;const{Utils:dh,Configs:hh}=p,{AppId:Bc,Network:hi}=hh,uh=o(a=>{if(!a.ok)throw new he(void 0,{response:a})},"validateResponse"),Wl=o(()=>{const a=window.game.auth.getToken();return{token:a,timeout:hi.Timeout,headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}},"defaultConfig"),Hl=o((a,e,t,s)=>async()=>{try{if(!Bc)throw new he("AppId is not defined");const n=`${a}/apps/${Bc}/${e}`,i=new AbortController;t.signal=i.signal;const r=setTimeout(()=>{i.abort()},t.timeout);p.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const c=await fetch(n,t);return clearTimeout(r),uh(c),await c.json()||{}}catch(n){if(n instanceof he)return null;throw n instanceof Object&&"name"in n&&n.name==="AbortError"?new ue:n}},"requester"),ui=o(async(a,e)=>{try{return a()}catch(t){if(t instanceof ue&&e>0)try{return await dh.Time.sleepAsync(600),await ui(a,e-1)}catch{return{}}return t instanceof ue?{}:(console.warn("Request error",t),{})}},"handleRequest"),jt=o(async(a,e={},t,s=hi.Retries)=>{try{const n={...Wl(),...e,method:"GET"},i=Hl(t,a,n);return await ui(i,s)}catch(n){return console.warn("Get error",n),{}}},"get"),B=o(async(a,e,t={},s,n=hi.Retries)=>{try{const i={...Wl(),...t,method:"POST"},r=Hl(s,a,i,e);return await ui(r,n)}catch(i){return console.warn("Post error",i),{}}},"post"),{ApiUrl:fh}=p.Configs.Notification,ph=o(async a=>{if(!p.Utils.Object.hasOwn(a,"playerId"))throw new Error("Missing playerId");const{playerId:e}=a;await B(`players/${e}`,a,{},fh,10)},"updatePlayerProfileNotificationAsync");var ql=(a=>(a.IDLE="idle",a.LOADING="loading",a.FILLED="filled",a.SHOWING="showing",a))(ql||{});const Yl=ql;var Xl=(a=>(a.BANNER="banner",a.INTERSTITIAL="interstitial",a.REWARDED_VIDEO="rewarded_video",a))(Xl||{});const ct=Xl;var _e;let re=(_e=class extends Error{constructor(t,s){super(s);f(this,"code");this.code=t,this.message=s}},o(_e,"AdError"),_e);const Oi=class Oi{constructor(e,t){f(this,"type");f(this,"status");f(this,"placementId");this.type=e,this.status=Yl.IDLE,this.placementId=t}getStatus(){return this.status}exception(e){throw new re("AD_INSTANCE_ERROR",e)}};o(Oi,"BaseInstance");let Js=Oi;var xe;let Jl=(xe=class extends Js{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}},o(xe,"AdInstance"),xe);p.Plugins.Ads={Types:ct,Status:Yl,AdError:re,AdInstance:Jl};const Mi=class Mi extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enabled");f(this,"config");f(this,"lastCallAdShownTime");f(this,"isAdFullSizeShowed");f(this,"lastShowAdRequestTime");f(this,"ads",{});f(this,"safeAreaBottom")}init(){this.lastCallAdShownTime=0,this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new re("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(t,s,n){if(this.ads[s]){console.warn(`AdsPlugin: Ad instance with placementId ${s} already exists`);return}this.ads[s]={type:t,placementId:s,interval:null,instance:new n(t,s)}}async preloadInterstitialAdAsync(){await this.loadAdAsync(ct.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new re("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(ct.INTERSTITIAL)}async preloadRewardedVideoAsync(){await this.loadAdAsync(ct.REWARDED_VIDEO)}async showRewardedVideoAsync(){await this.showAdAsync(ct.REWARDED_VIDEO)}async loadAdAsync(t,s){this.checkEnabled(),await this.getAd(t,s).instance.loadAsync()}async showAdAsync(t,s){this.checkEnabled();const{event:n}=this.game,i=this.getAd(t,s);this.lastCallAdShownTime=window.performance.now()/1e3;try{n.emit(p.Events.AD_SHOWING,{placementId:s}),this.isAdFullSizeShowed=!0,await i.instance.showAsync()}finally{n.emit(p.Events.AD_CLOSED,{placementId:s}),this.isAdFullSizeShowed=!1}}getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.getStatus()}getAd(t,s){let n=null;if(s?n=this.getAdByPlacementId(s):n=this.getPriorityAdByType(t),!n)throw new re("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return n}getAdsByType(t){return Object.values(this.ads).filter(s=>s.type===t)}getAdByPlacementId(t){const s=this.ads[t];return s||null}getPriorityAdByType(t){const s=this.getAdsByType(t);if(!s.length)return null;const n=s.find(i=>i.type===t);return n||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let n;if(t)n=this.getCommonAdConfig(t);else{const h=this.getPriorityAdByType(ct.INTERSTITIAL);if(!h)return!1;n=this.getCommonAdConfig(h.placementId)}const{SecondsBetweenAds:i,SecondsFirstTime:r}=n,c=s-this.lastCallAdShownTime,l=c>i,d=c>r;return this.lastCallAdShownTime>0?l:d}catch(s){return console.warn("Error while checking canbeShowInterstitialAdByTime",s),!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:n}=s;if(n==="ALL")return!0;const i=GameSDK.getPlatform();return i?i===n:!1}catch(s){return console.warn("Error while checking canbeShowBannerAd",s),!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd(ct.BANNER,t);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const{event:n}=this.game;n.emit(p.Events.AD_SHOWING,{placementId:t});const i=this.getBannerConfig(s.placementId),{SecondsReload:r}=i;r<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},r*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd(ct.BANNER,t);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync();const{event:n}=this.game;n.emit(p.Events.AD_CLOSED,{placementId:t})}cleanBannerReloadTimer(t){try{const s=this.getAd(ct.BANNER,t),{interval:n}=s;if(!n)return;clearInterval(n)}catch(s){console.warn("Error while cleaning banner reload timer",s)}}getCommonAdConfig(t){const n=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions].find(i=>i.PlacementId===t);if(!n)throw new Error(`Ad config with placementId ${t} not found`);return n}getBannerConfig(t){const s=this.config.BannerDisplayAdOptions.find(n=>n.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t,s){this.checkEnabled();const n=this.getBannerConfig(t),{BannerHeight:i}=n;return(i+this.safeAreaBottom)*s}getSafeAreaBottom(t){return this.safeAreaBottom*t}updateLastShowAdRequestTime(){this.lastShowAdRequestTime=window.performance.now()/1e3}getLastShowAdRequestTime(){return this.lastShowAdRequestTime}};o(Mi,"AdsPlugin");let Qs=Mi;var Ql=(a=>(a.BUTTON_CLICK="button_click",a.SCREEN_OPEN="screen_open",a.LOAD_START="load_start",a.LOAD_COMPLETE="load_complete",a.APP_READY="app_ready",a.PAGE_VIEW="page_view",a.TUTORIAL_BEGIN="tutorial_begin",a.TUTORIAL_STEP="tutorial_step",a.TUTORIAL_COMPLETE="tutorial_complete",a.MATCH_START="match_start",a.MATCH_RESCUE="match_rescue",a.MATCH_END="match_end",a.LEVEL_START="level_start",a.LEVEL_RESCUE="level_rescue",a.LEVEL_END="level_end",a.SHARE="share",a.MESSAGE="message",a.INVITE="invite",a.SHORTCUT_CREATE="shortcut_create",a.SHORTCUT_CREATE_POPUP="shortcut_create_popup",a.BOT_SUBSCRIBE="bot_subscribe",a.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",a.AD_LOAD="ad_load",a.AD_LOAD_FAILED="ad_load_failed",a.AD_SHOW="ad_show",a.AD_SHOW_FAILED="ad_show_failed",a.AD_REWARD="ad_reward",a.AD_IMPRESSION="ad_impression",a.NEW_USER="new_user",a.JOIN_GROUP="join_group",a.TOURNAMENT_START="tournament_start",a.TOURNAMENT_SHARE="tournament_share",a.TOURNAMENT_CREATE="tournament_create",a.TOURNAMENT_POST_SCORE="tournament_post_score",a.GET_FREE_ITEM="get_free_item",a.USE_ITEM="use_item",a.EARN_ITEM="earn_item",a))(Ql||{});const H=Ql,{String:Vc,Valid:gh}=p.Utils;var Ne;let yh=(Ne=class{constructor(e,t,s){f(this,"game");f(this,"name");f(this,"color");f(this,"options");f(this,"selfLog");f(this,"currentPath");this.game=e,this.name=t,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/",console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t){this.logInfo("event",{name:e,payload:t});const s=this.formatEventName(e);this.processEvent(s,t)}logInfo(e,t){this.selfLog&&console.info(`%c${this.name}: ${e}`,`color: ${this.color}`,t)}pageview(e){let t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),this.event(H.PAGE_VIEW,{page_title:t})}levelStart(e,t){this.event(H.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e)})}levelFail(e,t){this.event(H.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e)})}levelRescue(e,t){this.event(H.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e)})}levelComplete(e,t){this.event(H.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e)})}loadAdEvent(e,t){this.event(H.AD_LOAD,{ad_type:e,screen_name:t})}showAdEvent(e,t){this.event(H.AD_SHOW,{ad_type:e,screen_name:t}),this.event(H.AD_IMPRESSION,{ad_format:e})}loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}showInterstitialAd(e){this.showAdEvent("interstitial",e)}loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}receiveVideoReward(e){this.event(H.AD_REWARD,{screen_name:e})}loadAdFail(e,t){this.event(H.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}showAdFail(e,t){this.event(H.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}getLevelName(e){return`Level ${e}`}getPageTitle(e){const t=e.split("/").pop();if(!gh.isString(t))return e;const s=t.replace(/([-_\s.])/g," $1");return Vc.toUpperCamelCase(s)}addGameModeToPageTitle(e){const{match:t}=this.game,s=t.getMatchState();let{mode:n}=s;return n||(n="Normal"),`${Vc.toUpperCamelCase(n)}::${e}`}},o(Ne,"BaseAnalytics"),Ne);p.Plugins.Analytics={Events:H,BaseAnalytics:yh};const Ri=class Ri extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"analytics",[]);f(this,"placement","unknown");f(this,"pageview",o(t=>{if(!this.isActive())return;this.placement=t;const s=this.getPageByKey(t);this.analytics.forEach(n=>{n.pageview(s)})},"pageview"))}add(t){this.analytics.push(t)}isActive(){return this.analytics.length>=1}event(t,s){this.isActive()&&this.analytics.forEach(n=>{n.event(t,s)})}levelStart(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelStart(t,s)})}levelRescue(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelRescue(t,s)})}levelFail(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelFail(t,s)})}levelComplete(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelComplete(t,s)})}loadInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadInterstitialAd(this.placement)})}showInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(this.placement)})}loadRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadRewardedVideoAd(this.placement)})}showRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(this.placement)})}receiveVideoReward(){this.isActive()&&this.analytics.forEach(t=>{t.receiveVideoReward(this.placement)})}loadAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.loadAdFail(t,this.placement)})}showAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.showAdFail(t,this.placement)})}getPageByKey(t){if(t.includes("_")){let s=t.replace(/_/g,"-");return s=s.toLowerCase(),s}else{let s=t.length-1,n="";for(;s>0;){n=t.charAt(s);const i=isNaN(parseInt(n,10)),r=n===n.toUpperCase();i&&r&&(t=`${t.slice(0,s)}-${t.slice(s)}`),s--}return t.toLowerCase()}}};o(Ri,"AnalyticsPlugin");let Zs=Ri;const Li=class Li{constructor(e){f(this,"key");this.key=e}getKey(){return this.key}};o(Li,"BaseAudioPlayer");let tn=Li;const $i=class $i{constructor(e){f(this,"id");f(this,"isMuteAll");f(this,"masterVolume");f(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:n}=s;this.playWithRealConfig(n,t)}else this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:n=1}=t||{};this.setAudioClip(e,{volume:n,audioPlayer:s}),this.playWithRealConfig(s,t)}catch(s){console.warn("playAudio",s)}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:n=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*n);break;default:throw new Error(`Unsupported function: ${t}`)}}catch(s){console.warn("queueAudioPlayer",s)}}callAudioPlayers(e){Object.values(this.audioClips).forEach(s=>{this.queueAudioPlayer(s,e)})}};o($i,"BaseChannelManager");let en=$i;p.Plugins.Audio={BaseAudioPlayer:tn,BaseChannelManager:en};const Fi=class Fi extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"firstChannelId");f(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}play(t,s,n){try{this.getChannel(n).play(t,s)}catch(i){console.warn("playSound",i)}}pause(t,s){try{this.getChannel(s).pause(t)}catch(n){console.warn("pauseSound",n)}}resume(t,s){try{this.getChannel(s).resume(t)}catch(n){console.warn("resumeSound",n)}}stop(t,s){try{this.getChannel(s).stop(t)}catch(n){console.warn("stopSound",n)}}stopAll(t){try{this.getChannel(t).stopAll()}catch(s){console.warn("stopAllSounds",s)}}mute(t){try{this.getChannel(t).muteAll()}catch(s){console.warn("mute",s)}}unmute(t){try{this.getChannel(t).unmuteAll()}catch(s){console.warn("unmute",s)}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch(n){console.warn("setSoundVolume",n)}}};o(Fi,"AudioPlugin");let sn=Fi;const mh={token:"",isRequesting:!1},ki=class ki extends N.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",mh)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const i=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",i)}catch(t){if(p.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token",""),console.error(t)}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}};o(ki,"AuthPlugin");let nn=ki;var Zl=(a=>(a.SOLO="solo",a.TOURNAMENT="tournament",a.SHARE_INVITE="share_invite",a.MATCHING_GROUP="matching_group_match",a.CHALLENGE_FRIEND="challenge_friend_match",a))(Zl||{});const fe=Zl,_t=sh,Ui=class Ui{constructor(e){f(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return p.Utils.Valid.isObject(e)}receiveContext(e,t,s){const{storage:n}=this.game;n.setStorageData("context","contextId",e),this.isValidEntryPointData(s)?n.setStorageData("context","entryPointData",s):console.warn(`Invalid context type: ${t}`),this.isValidContextType(t)?n.setStorageData("context","contextType",t):console.warn(`Invalid context type: ${t}`)}async detectContextSessionType(){const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:n,TOURNAMENT:i,MATCHING_GROUP:r,SHARE_INVITE:c,CHALLENGE_FRIEND:l}=fe;let d=n;if(s===i&&(d=i),s===r&&(d=r),(s===l||s===c)&&(d=l),d===n)try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");await GameSDK.getTournamentAsync(),d=i}catch{}e.setStorageData("context","sessionContextType",d)}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),n=t.getStorageData("context","sessionContextType"),i=e.getPlayerId(),{matchId:r,playerId:c,opponentId:l=dt.playerId}=s,d=i===c,u=l===dt.playerId||[l,c].indexOf(i)>=0,{TOURNAMENT:g,MATCHING_GROUP:y,SHARE_INVITE:w,CHALLENGE_FRIEND:A}=fe;let m=_t.SINGLE;n===g&&(m=_t.TOURNAMENT),n===w&&!d&&(m=_t.CHALLENGE_FRIEND),n===A&&r&&u&&(m=_t.CHALLENGE_FRIEND),n===y&&(m=_t.MATCHING_GROUP),t.setStorageData("context","contextGameMode",m)}};o(Ui,"Context");let an=Ui;const Bi=class Bi extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e??"Player has finished match"}};o(Bi,"PlayerHasFinishedMatch");let qe=Bi;const Vi=class Vi extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}};o(Vi,"PlayerNotJoinInMatch");let pe=Vi;const{Events:Cs,Plugins:wh}=p,{Analytics:Ah}=wh,Gi=class Gi{constructor(e){f(this,"game");this.game=e}async processContextData(){const{player:e,analytics:t,storage:s}=this.game,n=s.getStorageData("context","contextId"),i=s.getStorageData("context","entryPointData"),r=s.getStorageData("context","sessionContextType"),{type:c,matchId:l,playerId:d,opponentId:h,playerScore:u}=i||{};console.info("isFirstLogin",e.isFirstLogin()),e.isFirstLogin()&&t.event(Ah.Events.NEW_USER);const{TOURNAMENT:g,SHARE_INVITE:y,MATCHING_GROUP:w,CHALLENGE_FRIEND:A}=fe;if(r===g){try{await this.processTournamentModeAsync()}catch{await this.processSingleModeAsync()}return}if(r===A){if(c===y&&typeof d=="string"){await this.processChallengeFromPostAsync(d);return}if(c===A&&typeof l=="string"&&typeof d=="string"&&typeof h=="string"){await this.processChallengeFromMessageAsync({contextId:n,matchId:l,playerId:d,opponentId:h});return}}if(r===w&&typeof d=="string"&&typeof u=="number"){await this.processMatchingGroupModeAsync(d,u);return}if(e.isFirstLogin()){await this.processSingleModeAsync(),e.loggedIn();return}this.switchToDashboardScene()}async processTournamentModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId(),n=GameSDK.context.getID();if(typeof n!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:n}),this.switchToGameScene()}async processChallengeFromPostAsync(e){const{match:t,player:s}=this.game,n=s.getPlayerId();if(n===e)await t.single.start.processAsync({playerId:n});else try{await t.challenge.friend.processAsync({playerId:n,opponentId:e})}catch(r){console.warn("processChallengeFromPostAsync",r),await t.single.start.processAsync({playerId:n})}this.switchToGameScene()}async processChallengeFromMessageAsync(e){try{await this.processContinueChallengeFromMessageAsync(e)}catch(t){console.warn("processContinueChallengeFromMessageAsync",t),t instanceof qe&&await this.processAwaitChallengeFromMessageAsync(e),t instanceof pe&&await this.processJoinChallengeFromMessageAsync(e)}}async processContinueChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n,opponentId:i}=e,{match:r,player:c}=this.game,l=c.getPlayerId();if(n===l)await r.challenge.continue.processAsync({contextId:t,matchId:s,playerId:l,opponentId:i});else{const h=i===dt.playerId;await r.challenge.continue.processAsync({contextId:t,matchId:s,playerId:l,opponentId:h?i:n})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();await i.challenge.join.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();await i.challenge.await.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n}),this.switchToResultScene()}async processMatchingGroupModeAsync(e,t){const{match:s,player:n}=this.game;await s.group.join.processAsync({playerId:n.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processSingleModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId();await e.single.start.processAsync({playerId:s}),this.switchToGameScene()}switchToDashboardScene(){const{event:e}=this.game;e.emit(Cs.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isMatchStartFromLoader:!0}})}switchToGameScene(){const{event:e}=this.game;e.emit(Cs.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isMatchStartFromLoader:!0}})}switchToResultScene(){const{event:e}=this.game;e.emit(Cs.SWITCH_SCENE,{sceneName:"ResultScene",sceneData:{isMatchStartFromLoader:!0}})}};o(Gi,"Loader");let rn=Gi;const td={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},{Events:Ih}=p,ji=class ji extends N.Plugins.BasePlugin{constructor(t){super(t);f(this,"context");f(this,"loader");this.loader=new rn(t),this.context=new an(t)}init(){const{storage:t}=this.game;t.addStorage("context",td)}getSessionContextTypes(){return fe}async processContextData(){try{await this.loader.processContextData()}catch(t){console.error("processContextData",t),this.switchToDashboardScene()}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch(t){console.error("detectContextSessionType",t)}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,n){this.context.receiveContext(t,s,n)}switchToDashboardScene(){const{event:t}=this.game;t.emit(Ih.SWITCH_SCENE,{sceneName:"DashboardScene"})}};o(ji,"ContextPlugin");let on=ji;const{Valid:Ts}=p.Utils,{contextId:bh,contextType:Eh,entryPointData:Dh}=td,_s="is invalid",zi=class zi extends F{constructor(){super(...arguments);f(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){Ts.isString(t)||this.exception("contextId",_s)}validateContextType(t){(!Ts.isString(t)||!t)&&this.exception("contextType",_s)}validateEntryPointData(t){Ts.isObject(t)||this.exception("entryPointData",_s)}toObject(){return super.toObject()}};o(zi,"ContextInfoDtos");let Ye=zi;Ye.addDefaultData({contextId:bh,contextType:Eh,entryPointData:Dh});p.Dtos.Context={Info:Ye};const vh={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},Ki=class Ki{async getDailyRewardsAsync(){return Object.values(vh)}};o(Ki,"DailyRewardsAPI");let cn=Ki;const ne={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},Sh={dailyRewards:{}},Gc=p.Configs.DailyRewards,Wi=class Wi extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"dailyRewardsApi",new cn)}init(){const{storage:t}=this.game;t.addStorage("dailyRewards",Sh)}async requestDailyRewardsAsync(){const t=await this.dailyRewardsApi.getDailyRewardsAsync();t.length!==0&&this.receiveDailyRewards(t)}getDailyRewards(){const{storage:t}=this.game,s=t.getStorageData("dailyRewards","dailyRewards");return s||null}logLoginReward(){const{player:t}=this.game,{logDays:s}=t.getPlayerData().dailyRewarded,n=[...s];n[n.length-1]=!0,this.logDailyRewards(n)}logDailyRewards(t,s=!1){const{player:n}=this.game;n.setPlayerDataByName("dailyRewarded",{logDays:t,lastRewarded:s?0:Date.now()})}receiveDailyRewards(t){const{player:s}=this.game,{logDays:n,lastRewarded:i}=s.getPlayerData().dailyRewarded,r=new Date,c=new Date(i),l=new Date(c.toDateString()),d=Math.abs(r.valueOf()-l.valueOf()),u=Math.floor(d/864e5)>1,y=Gc.CheckInterrupt&&u||n.length>=Gc.MaxDays,w=y?[!1]:[...n,!1];this.logDailyRewards(w);const A=t.map((m,E)=>{const U=E<w.length,v=w.length===E+1,Ds=w[E]===!1;let Q=ne.WAITING;return v?Q=ne.READY:y?Q=ne.WAITING:U&&Ds?Q=ne.SKIPPED:U&&(Q=ne.REWARDED),{...m,status:Q}});this.setDailyRewards(A)}setDailyRewards(t){const{storage:s}=this.game;s.setStorageData("dailyRewards","dailyRewards",t)}};o(Wi,"DailyRewardsPlugin");let ln=Wi;var fi={exports:{}};fi.exports;(function(a){var e=Object.prototype.hasOwnProperty,t="~";function s(){}o(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(l,d,h){this.fn=l,this.context=d,this.once=h||!1}o(n,"EE");function i(l,d,h,u,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new n(h,u||l,g),w=t?t+d:d;return l._events[w]?l._events[w].fn?l._events[w]=[l._events[w],y]:l._events[w].push(y):(l._events[w]=y,l._eventsCount++),l}o(i,"addListener");function r(l,d){--l._eventsCount===0?l._events=new s:delete l._events[d]}o(r,"clearEvent");function c(){this._events=new s,this._eventsCount=0}o(c,"EventEmitter"),c.prototype.eventNames=o(function(){var d=[],h,u;if(this._eventsCount===0)return d;for(u in h=this._events)e.call(h,u)&&d.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},"eventNames"),c.prototype.listeners=o(function(d){var h=t?t+d:d,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var g=0,y=u.length,w=new Array(y);g<y;g++)w[g]=u[g].fn;return w},"listeners"),c.prototype.listenerCount=o(function(d){var h=t?t+d:d,u=this._events[h];return u?u.fn?1:u.length:0},"listenerCount"),c.prototype.emit=o(function(d,h,u,g,y,w){var A=t?t+d:d;if(!this._events[A])return!1;var m=this._events[A],E=arguments.length,U,v;if(m.fn){switch(m.once&&this.removeListener(d,m.fn,void 0,!0),E){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,u),!0;case 4:return m.fn.call(m.context,h,u,g),!0;case 5:return m.fn.call(m.context,h,u,g,y),!0;case 6:return m.fn.call(m.context,h,u,g,y,w),!0}for(v=1,U=new Array(E-1);v<E;v++)U[v-1]=arguments[v];m.fn.apply(m.context,U)}else{var Ds=m.length,Q;for(v=0;v<Ds;v++)switch(m[v].once&&this.removeListener(d,m[v].fn,void 0,!0),E){case 1:m[v].fn.call(m[v].context);break;case 2:m[v].fn.call(m[v].context,h);break;case 3:m[v].fn.call(m[v].context,h,u);break;case 4:m[v].fn.call(m[v].context,h,u,g);break;default:if(!U)for(Q=1,U=new Array(E-1);Q<E;Q++)U[Q-1]=arguments[Q];m[v].fn.apply(m[v].context,U)}}return!0},"emit"),c.prototype.on=o(function(d,h,u){return i(this,d,h,u,!1)},"on"),c.prototype.once=o(function(d,h,u){return i(this,d,h,u,!0)},"once"),c.prototype.removeListener=o(function(d,h,u,g){var y=t?t+d:d;if(!this._events[y])return this;if(!h)return r(this,y),this;var w=this._events[y];if(w.fn)w.fn===h&&(!g||w.once)&&(!u||w.context===u)&&r(this,y);else{for(var A=0,m=[],E=w.length;A<E;A++)(w[A].fn!==h||g&&!w[A].once||u&&w[A].context!==u)&&m.push(w[A]);m.length?this._events[y]=m.length===1?m[0]:m:r(this,y)}return this},"removeListener"),c.prototype.removeAllListeners=o(function(d){var h;return d?(h=t?t+d:d,this._events[h]&&r(this,h)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,a.exports=c})(fi);var Ph=fi.exports;const Ch=ah(Ph),pt=new Ch,Th={names:[],history:[]},Hi=class Hi extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enableLog",!1);f(this,"muteEvents",[])}init(){const{storage:t}=this.game;t.addStorage("event",Th)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),pt.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),pt.once(t,s)}off(t,s){this.validateCallback(s),pt.off(t,s),this.addHistory(t,"any","removed")}mute(t){this.muteEvents.includes(t)||this.muteEvents.push(t)}clear(t){pt.removeAllListeners(t),this.addHistory(t,"any","removed")}emit(t,s){if(this.muteEvents.includes(t))return;let n=[];s&&(n=[s]),this.addHistory(t,"any","called",s),pt.emit(t,...n)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,n=s.getStorageData("event","names");n.includes(t)||n.push(t)}getEventListeners(){const t=pt.eventNames();return Object.keys(t)}getEventEmitCount(t){const{storage:s}=this.game;return s.getStorageData("event","history").filter(i=>i.name===t&&i.status==="called").length}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}getTypeFromHistory(t){var n;return((n=this.getHistory().find(i=>i.name===t))==null?void 0:n.type)??null}getCallsFromHistory(t){var n;return((n=this.getHistory().find(i=>i.name===t))==null?void 0:n.called)??0}addHistory(t,s,n,i){const c=this.getTypeFromHistory(t)??s,l=this.getCallsFromHistory(t),d=n==="called"?l+1:l;this.getHistory().push({type:c,status:n,name:t,called:d,payload:i??{}}),this.logEventInfo(t,c,n,d)}logEventInfo(t,s,n,i){if(this.enableLog){if(n==="listening"){console.info(`Event (${s}) ${t}: ${n}`);const r=pt.listenerCount(t);r>1&&console.warn(`Event ${t} has ${r} listener`)}else s!=="any"&&console.info(`Event (${s}) ${t}: ${n} (${i} times)`);n==="called"&&pt.listenerCount(t)<=0&&console.warn(`Event ${t} is called but not listening`)}}};o(Hi,"EventPlugin");let dn=Hi;var jc={};const ed=o(function(a){const e=[];let t=0;for(let s=0;s<a.length;s++){let n=a.charCodeAt(s);n<128?e[t++]=n:n<2048?(e[t++]=n>>6|192,e[t++]=n&63|128):(n&64512)===55296&&s+1<a.length&&(a.charCodeAt(s+1)&64512)===56320?(n=65536+((n&1023)<<10)+(a.charCodeAt(++s)&1023),e[t++]=n>>18|240,e[t++]=n>>12&63|128,e[t++]=n>>6&63|128,e[t++]=n&63|128):(e[t++]=n>>12|224,e[t++]=n>>6&63|128,e[t++]=n&63|128)}return e},"stringToByteArray$1"),_h=o(function(a){const e=[];let t=0,s=0;for(;t<a.length;){const n=a[t++];if(n<128)e[s++]=String.fromCharCode(n);else if(n>191&&n<224){const i=a[t++];e[s++]=String.fromCharCode((n&31)<<6|i&63)}else if(n>239&&n<365){const i=a[t++],r=a[t++],c=a[t++],l=((n&7)<<18|(i&63)<<12|(r&63)<<6|c&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=a[t++],r=a[t++];e[s++]=String.fromCharCode((n&15)<<12|(i&63)<<6|r&63)}}return e.join("")},"byteArrayToString"),sd={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(a,e){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let n=0;n<a.length;n+=3){const i=a[n],r=n+1<a.length,c=r?a[n+1]:0,l=n+2<a.length,d=l?a[n+2]:0,h=i>>2,u=(i&3)<<4|c>>4;let g=(c&15)<<2|d>>6,y=d&63;l||(y=64,r||(g=64)),s.push(t[h],t[u],t[g],t[y])}return s.join("")},encodeString(a,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(a):this.encodeByteArray(ed(a),e)},decodeString(a,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(a):_h(this.decodeStringToByteArray(a,e))},decodeStringToByteArray(a,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let n=0;n<a.length;){const i=t[a.charAt(n++)],c=n<a.length?t[a.charAt(n)]:0;++n;const d=n<a.length?t[a.charAt(n)]:64;++n;const u=n<a.length?t[a.charAt(n)]:64;if(++n,i==null||c==null||d==null||u==null)throw new hn;const g=i<<2|c>>4;if(s.push(g),d!==64){const y=c<<4&240|d>>2;if(s.push(y),u!==64){const w=d<<6&192|u;s.push(w)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}},qi=class qi extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}};o(qi,"DecodeBase64StringError");let hn=qi;const xh=o(function(a){const e=ed(a);return sd.encodeByteArray(e,!0)},"base64Encode"),nd=o(function(a){return xh(a).replace(/\./g,"")},"base64urlEncodeWithoutPadding"),Nh=o(function(a){try{return sd.decodeString(a,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},"base64Decode");function Oh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}o(Oh,"getGlobal");const Mh=o(()=>Oh().__FIREBASE_DEFAULTS__,"getDefaultsFromGlobal"),Rh=o(()=>{if(typeof process>"u"||typeof jc>"u")return;const a=jc.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},"getDefaultsFromEnvVariable"),Lh=o(()=>{if(typeof document>"u")return;let a;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=a&&Nh(a[1]);return e&&JSON.parse(e)},"getDefaultsFromCookie"),$h=o(()=>{try{return Mh()||Rh()||Lh()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},"getDefaults"),ad=o(()=>{var a;return(a=$h())===null||a===void 0?void 0:a.config},"getDefaultAppConfig");const Yi=class Yi{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}};o(Yi,"Deferred");let un=Yi;function Fh(){const a=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof a=="object"&&a.id!==void 0}o(Fh,"isBrowserExtension");function As(){try{return typeof indexedDB=="object"}catch{return!1}}o(As,"isIndexedDBAvailable");function pi(){return new Promise((a,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(s);n.onsuccess=()=>{n.result.close(),t||self.indexedDB.deleteDatabase(s),a(!0)},n.onupgradeneeded=()=>{t=!1},n.onerror=()=>{var i;e(((i=n.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}o(pi,"validateIndexedDBOpenable");function id(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}o(id,"areCookiesEnabled");const kh="FirebaseError",ys=class ys extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=kh,Object.setPrototypeOf(this,ys.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Et.prototype.create)}};o(ys,"FirebaseError");let ht=ys;const Xi=class Xi{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],r=i?Uh(i,s):"Error",c=`${this.serviceName}: ${r} (${n}).`;return new ht(n,c,s)}};o(Xi,"ErrorFactory");let Et=Xi;function Uh(a,e){return a.replace(Bh,(t,s)=>{const n=e[s];return n!=null?String(n):`<${s}?>`})}o(Uh,"replaceTemplate");const Bh=/\{\$([^}]+)}/g;function Xe(a,e){if(a===e)return!0;const t=Object.keys(a),s=Object.keys(e);for(const n of t){if(!s.includes(n))return!1;const i=a[n],r=e[n];if(zc(i)&&zc(r)){if(!Xe(i,r))return!1}else if(i!==r)return!1}for(const n of s)if(!t.includes(n))return!1;return!0}o(Xe,"deepEqual");function zc(a){return a!==null&&typeof a=="object"}o(zc,"isObject");const Vh=1e3,Gh=2,jh=4*60*60*1e3,zh=.5;function fn(a,e=Vh,t=Gh){const s=e*Math.pow(t,a),n=Math.round(zh*s*(Math.random()-.5)*2);return Math.min(jh,s+n)}o(fn,"calculateBackoffMillis");function nt(a){return a&&a._delegate?a._delegate:a}o(nt,"getModularInstance");const Ji=class Ji{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};o(Ji,"Component");let Y=Ji;const Ct="[DEFAULT]";const Qi=class Qi{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new un;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&s.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Wh(e))try{this.getOrInitializeService({instanceIdentifier:Ct})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:n});s.resolve(i)}catch{}}}}clearInstance(e=Ct){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ct){return this.instances.has(e)}getOptions(e=Ct){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,r]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);s===c&&r.resolve(n)}return n}onInit(e,t){var s;const n=this.normalizeInstanceIdentifier(t),i=(s=this.onInitCallbacks.get(n))!==null&&s!==void 0?s:new Set;i.add(e),this.onInitCallbacks.set(n,i);const r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const n of s)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Kh(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Ct){return this.component?this.component.multipleInstances?e:Ct:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};o(Qi,"Provider");let pn=Qi;function Kh(a){return a===Ct?void 0:a}o(Kh,"normalizeIdentifierForFactory");function Wh(a){return a.instantiationMode==="EAGER"}o(Wh,"isComponentEager");const Zi=class Zi{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new pn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};o(Zi,"ComponentContainer");let gn=Zi;var b;(function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"})(b||(b={}));const Hh={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},qh=b.INFO,Yh={[b.DEBUG]:"log",[b.VERBOSE]:"log",[b.INFO]:"info",[b.WARN]:"warn",[b.ERROR]:"error"},Xh=o((a,e,...t)=>{if(e<a.logLevel)return;const s=new Date().toISOString(),n=Yh[e];if(n)console[n](`[${s}]  ${a.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},"defaultLogHandler"),tr=class tr{constructor(e){this.name=e,this._logLevel=qh,this._logHandler=Xh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in b))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Hh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...e),this._logHandler(this,b.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...e),this._logHandler(this,b.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,b.INFO,...e),this._logHandler(this,b.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,b.WARN,...e),this._logHandler(this,b.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...e),this._logHandler(this,b.ERROR,...e)}};o(tr,"Logger");let Wt=tr;const Jh=o((a,e)=>e.some(t=>a instanceof t),"instanceOfAny");let Kc,Wc;function Qh(){return Kc||(Kc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}o(Qh,"getIdbProxyableTypes");function Zh(){return Wc||(Wc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}o(Zh,"getCursorAdvanceMethods");const rd=new WeakMap,yn=new WeakMap,od=new WeakMap,xs=new WeakMap,gi=new WeakMap;function tu(a){const e=new Promise((t,s)=>{const n=o(()=>{a.removeEventListener("success",i),a.removeEventListener("error",r)},"unlisten"),i=o(()=>{t(At(a.result)),n()},"success"),r=o(()=>{s(a.error),n()},"error");a.addEventListener("success",i),a.addEventListener("error",r)});return e.then(t=>{t instanceof IDBCursor&&rd.set(t,a)}).catch(()=>{}),gi.set(e,a),e}o(tu,"promisifyRequest");function eu(a){if(yn.has(a))return;const e=new Promise((t,s)=>{const n=o(()=>{a.removeEventListener("complete",i),a.removeEventListener("error",r),a.removeEventListener("abort",r)},"unlisten"),i=o(()=>{t(),n()},"complete"),r=o(()=>{s(a.error||new DOMException("AbortError","AbortError")),n()},"error");a.addEventListener("complete",i),a.addEventListener("error",r),a.addEventListener("abort",r)});yn.set(a,e)}o(eu,"cacheDonePromiseForTransaction");let mn={get(a,e,t){if(a instanceof IDBTransaction){if(e==="done")return yn.get(a);if(e==="objectStoreNames")return a.objectStoreNames||od.get(a);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return At(a[e])},set(a,e,t){return a[e]=t,!0},has(a,e){return a instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in a}};function su(a){mn=a(mn)}o(su,"replaceTraps");function nu(a){return a===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=a.call(Ns(this),e,...t);return od.set(s,e.sort?e.sort():[e]),At(s)}:Zh().includes(a)?function(...e){return a.apply(Ns(this),e),At(rd.get(this))}:function(...e){return At(a.apply(Ns(this),e))}}o(nu,"wrapFunction");function au(a){return typeof a=="function"?nu(a):(a instanceof IDBTransaction&&eu(a),Jh(a,Qh())?new Proxy(a,mn):a)}o(au,"transformCachableValue");function At(a){if(a instanceof IDBRequest)return tu(a);if(xs.has(a))return xs.get(a);const e=au(a);return e!==a&&(xs.set(a,e),gi.set(e,a)),e}o(At,"wrap");const Ns=o(a=>gi.get(a),"unwrap");function cd(a,e,{blocked:t,upgrade:s,blocking:n,terminated:i}={}){const r=indexedDB.open(a,e),c=At(r);return s&&r.addEventListener("upgradeneeded",l=>{s(At(r.result),l.oldVersion,l.newVersion,At(r.transaction),l)}),t&&r.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),n&&l.addEventListener("versionchange",d=>n(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}o(cd,"openDB");const iu=["get","getKey","getAll","getAllKeys","count"],ru=["put","add","delete","clear"],Os=new Map;function Hc(a,e){if(!(a instanceof IDBDatabase&&!(e in a)&&typeof e=="string"))return;if(Os.get(e))return Os.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,n=ru.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(n||iu.includes(t)))return;const i=o(async function(r,...c){const l=this.transaction(r,n?"readwrite":"readonly");let d=l.store;return s&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),n&&l.done]))[0]},"method");return Os.set(e,i),i}o(Hc,"getMethod");su(a=>({...a,get:(e,t,s)=>Hc(e,t)||a.get(e,t,s),has:(e,t)=>!!Hc(e,t)||a.has(e,t)}));const er=class er{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ou(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}};o(er,"PlatformLoggerServiceImpl");let wn=er;function ou(a){const e=a.getComponent();return(e==null?void 0:e.type)==="VERSION"}o(ou,"isVersionServiceProvider");const An="@firebase/app",qc="0.9.27";const Mt=new Wt("@firebase/app"),cu="@firebase/app-compat",lu="@firebase/analytics-compat",du="@firebase/analytics",hu="@firebase/app-check-compat",uu="@firebase/app-check",fu="@firebase/auth",pu="@firebase/auth-compat",gu="@firebase/database",yu="@firebase/database-compat",mu="@firebase/functions",wu="@firebase/functions-compat",Au="@firebase/installations",Iu="@firebase/installations-compat",bu="@firebase/messaging",Eu="@firebase/messaging-compat",Du="@firebase/performance",vu="@firebase/performance-compat",Su="@firebase/remote-config",Pu="@firebase/remote-config-compat",Cu="@firebase/storage",Tu="@firebase/storage-compat",_u="@firebase/firestore",xu="@firebase/firestore-compat",Nu="firebase",Ou="10.8.0";const In="[DEFAULT]",Mu={[An]:"fire-core",[cu]:"fire-core-compat",[du]:"fire-analytics",[lu]:"fire-analytics-compat",[uu]:"fire-app-check",[hu]:"fire-app-check-compat",[fu]:"fire-auth",[pu]:"fire-auth-compat",[gu]:"fire-rtdb",[yu]:"fire-rtdb-compat",[mu]:"fire-fn",[wu]:"fire-fn-compat",[Au]:"fire-iid",[Iu]:"fire-iid-compat",[bu]:"fire-fcm",[Eu]:"fire-fcm-compat",[Du]:"fire-perf",[vu]:"fire-perf-compat",[Su]:"fire-rc",[Pu]:"fire-rc-compat",[Cu]:"fire-gcs",[Tu]:"fire-gcs-compat",[_u]:"fire-fst",[xu]:"fire-fst-compat","fire-js":"fire-js",[Nu]:"fire-js-all"};const Je=new Map,bn=new Map;function Ru(a,e){try{a.container.addComponent(e)}catch(t){Mt.debug(`Component ${e.name} failed to register with FirebaseApp ${a.name}`,t)}}o(Ru,"_addComponent");function ut(a){const e=a.name;if(bn.has(e))return Mt.debug(`There were multiple attempts to register component ${e}.`),!1;bn.set(e,a);for(const t of Je.values())Ru(t,a);return!0}o(ut,"_registerComponent");function Zt(a,e){const t=a.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),a.container.getProvider(e)}o(Zt,"_getProvider");const Lu={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},It=new Et("app","Firebase",Lu);const sr=class sr{constructor(e,t,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Y("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw It.create("app-deleted",{appName:this._name})}};o(sr,"FirebaseAppImpl");let En=sr;const $u=Ou;function ld(a,e={}){let t=a;typeof e!="object"&&(e={name:e});const s=Object.assign({name:In,automaticDataCollectionEnabled:!1},e),n=s.name;if(typeof n!="string"||!n)throw It.create("bad-app-name",{appName:String(n)});if(t||(t=ad()),!t)throw It.create("no-options");const i=Je.get(n);if(i){if(Xe(t,i.options)&&Xe(s,i.config))return i;throw It.create("duplicate-app",{appName:n})}const r=new gn(n);for(const l of bn.values())r.addComponent(l);const c=new En(t,s,r);return Je.set(n,c),c}o(ld,"initializeApp");function yi(a=In){const e=Je.get(a);if(!e&&a===In&&ad())return ld();if(!e)throw It.create("no-app",{appName:a});return e}o(yi,"getApp");function q(a,e,t){var s;let n=(s=Mu[a])!==null&&s!==void 0?s:a;t&&(n+=`-${t}`);const i=n.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const c=[`Unable to register library "${n}" with version "${e}":`];i&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&r&&c.push("and"),r&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Mt.warn(c.join(" "));return}ut(new Y(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}o(q,"registerVersion");const Fu="firebase-heartbeat-database",ku=1,ge="firebase-heartbeat-store";let Ms=null;function dd(){return Ms||(Ms=cd(Fu,ku,{upgrade:(a,e)=>{switch(e){case 0:try{a.createObjectStore(ge)}catch(t){console.warn(t)}}}}).catch(a=>{throw It.create("idb-open",{originalErrorMessage:a.message})})),Ms}o(dd,"getDbPromise$1");async function Uu(a){try{const t=(await dd()).transaction(ge),s=await t.objectStore(ge).get(hd(a));return await t.done,s}catch(e){if(e instanceof ht)Mt.warn(e.message);else{const t=It.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Mt.warn(t.message)}}}o(Uu,"readHeartbeatsFromIndexedDB");async function Yc(a,e){try{const s=(await dd()).transaction(ge,"readwrite");await s.objectStore(ge).put(e,hd(a)),await s.done}catch(t){if(t instanceof ht)Mt.warn(t.message);else{const s=It.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Mt.warn(s.message)}}}o(Yc,"writeHeartbeatsToIndexedDB");function hd(a){return`${a.name}!${a.options.appId}`}o(hd,"computeKey");const Bu=1024,Vu=30*24*60*60*1e3,nr=class nr{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new vn(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Xc();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(r=>r.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const c=new Date(r.date).valueOf();return Date.now()-c<=Vu}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Xc(),{heartbeatsToSend:s,unsentEntries:n}=Gu(this._heartbeatsCache.heartbeats),i=nd(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}};o(nr,"HeartbeatServiceImpl");let Dn=nr;function Xc(){return new Date().toISOString().substring(0,10)}o(Xc,"getUTCDateString");function Gu(a,e=Bu){const t=[];let s=a.slice();for(const n of a){const i=t.find(r=>r.agent===n.agent);if(i){if(i.dates.push(n.date),Jc(t)>e){i.dates.pop();break}}else if(t.push({agent:n.agent,dates:[n.date]}),Jc(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}o(Gu,"extractHeartbeatsForHeader");const ar=class ar{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return As()?pi().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Uu(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Yc(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Yc(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}};o(ar,"HeartbeatStorageImpl");let vn=ar;function Jc(a){return nd(JSON.stringify({version:2,heartbeats:a})).length}o(Jc,"countBytes");function ju(a){ut(new Y("platform-logger",e=>new wn(e),"PRIVATE")),ut(new Y("heartbeat",e=>new Dn(e),"PRIVATE")),q(An,qc,a),q(An,qc,"esm2017"),q("fire-js","")}o(ju,"registerCoreComponents");ju("");var zu="firebase",Ku="10.8.0";q(zu,Ku,"app");const ud="@firebase/installations",mi="0.6.5";const fd=1e4,pd=`w:${mi}`,gd="FIS_v2",Wu="https://firebaseinstallations.googleapis.com/v1",Hu=60*60*1e3,qu="installations",Yu="Installations";const Xu={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Rt=new Et(qu,Yu,Xu);function yd(a){return a instanceof ht&&a.code.includes("request-failed")}o(yd,"isServerError");function md({projectId:a}){return`${Wu}/projects/${a}/installations`}o(md,"getInstallationsEndpoint");function wd(a){return{token:a.token,requestStatus:2,expiresIn:Qu(a.expiresIn),creationTime:Date.now()}}o(wd,"extractAuthTokenInfoFromResponse");async function Ad(a,e){const s=(await e.json()).error;return Rt.create("request-failed",{requestName:a,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}o(Ad,"getErrorFromResponse");function Id({apiKey:a}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":a})}o(Id,"getHeaders$1");function Ju(a,{refreshToken:e}){const t=Id(a);return t.append("Authorization",Zu(e)),t}o(Ju,"getHeadersWithAuth");async function bd(a){const e=await a();return e.status>=500&&e.status<600?a():e}o(bd,"retryIfServerError");function Qu(a){return Number(a.replace("s","000"))}o(Qu,"getExpiresInFromResponseExpiresIn");function Zu(a){return`${gd} ${a}`}o(Zu,"getAuthorizationHeader");async function tf({appConfig:a,heartbeatServiceProvider:e},{fid:t}){const s=md(a),n=Id(a),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const r={fid:t,authVersion:gd,appId:a.appId,sdkVersion:pd},c={method:"POST",headers:n,body:JSON.stringify(r)},l=await bd(()=>fetch(s,c));if(l.ok){const d=await l.json();return{fid:d.fid||t,registrationStatus:2,refreshToken:d.refreshToken,authToken:wd(d.authToken)}}else throw await Ad("Create Installation",l)}o(tf,"createInstallationRequest");function Ed(a){return new Promise(e=>{setTimeout(e,a)})}o(Ed,"sleep");function ef(a){return btoa(String.fromCharCode(...a)).replace(/\+/g,"-").replace(/\//g,"_")}o(ef,"bufferToBase64UrlSafe");const sf=/^[cdef][\w-]{21}$/,Sn="";function nf(){try{const a=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(a),a[0]=112+a[0]%16;const t=af(a);return sf.test(t)?t:Sn}catch{return Sn}}o(nf,"generateFid");function af(a){return ef(a).substr(0,22)}o(af,"encode");function Is(a){return`${a.appName}!${a.appId}`}o(Is,"getKey");const Dd=new Map;function vd(a,e){const t=Is(a);Sd(t,e),rf(t,e)}o(vd,"fidChanged");function Sd(a,e){const t=Dd.get(a);if(t)for(const s of t)s(e)}o(Sd,"callFidChangeCallbacks");function rf(a,e){const t=of();t&&t.postMessage({key:a,fid:e}),cf()}o(rf,"broadcastFidChange");let xt=null;function of(){return!xt&&"BroadcastChannel"in self&&(xt=new BroadcastChannel("[Firebase] FID Change"),xt.onmessage=a=>{Sd(a.data.key,a.data.fid)}),xt}o(of,"getBroadcastChannel");function cf(){Dd.size===0&&xt&&(xt.close(),xt=null)}o(cf,"closeBroadcastChannel");const lf="firebase-installations-database",df=1,Lt="firebase-installations-store";let Rs=null;function wi(){return Rs||(Rs=cd(lf,df,{upgrade:(a,e)=>{switch(e){case 0:a.createObjectStore(Lt)}}})),Rs}o(wi,"getDbPromise");async function Qe(a,e){const t=Is(a),n=(await wi()).transaction(Lt,"readwrite"),i=n.objectStore(Lt),r=await i.get(t);return await i.put(e,t),await n.done,(!r||r.fid!==e.fid)&&vd(a,e.fid),e}o(Qe,"set");async function Pd(a){const e=Is(a),s=(await wi()).transaction(Lt,"readwrite");await s.objectStore(Lt).delete(e),await s.done}o(Pd,"remove");async function bs(a,e){const t=Is(a),n=(await wi()).transaction(Lt,"readwrite"),i=n.objectStore(Lt),r=await i.get(t),c=e(r);return c===void 0?await i.delete(t):await i.put(c,t),await n.done,c&&(!r||r.fid!==c.fid)&&vd(a,c.fid),c}o(bs,"update");async function Ai(a){let e;const t=await bs(a.appConfig,s=>{const n=hf(s),i=uf(a,n);return e=i.registrationPromise,i.installationEntry});return t.fid===Sn?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}o(Ai,"getInstallationEntry");function hf(a){const e=a||{fid:nf(),registrationStatus:0};return Cd(e)}o(hf,"updateOrCreateInstallationEntry");function uf(a,e){if(e.registrationStatus===0){if(!navigator.onLine){const n=Promise.reject(Rt.create("app-offline"));return{installationEntry:e,registrationPromise:n}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=ff(a,t);return{installationEntry:t,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:pf(a)}:{installationEntry:e}}o(uf,"triggerRegistrationIfNecessary");async function ff(a,e){try{const t=await tf(a,e);return Qe(a.appConfig,t)}catch(t){throw yd(t)&&t.customData.serverCode===409?await Pd(a.appConfig):await Qe(a.appConfig,{fid:e.fid,registrationStatus:0}),t}}o(ff,"registerInstallation");async function pf(a){let e=await Qc(a.appConfig);for(;e.registrationStatus===1;)await Ed(100),e=await Qc(a.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:s}=await Ai(a);return s||t}return e}o(pf,"waitUntilFidRegistration");function Qc(a){return bs(a,e=>{if(!e)throw Rt.create("installation-not-found");return Cd(e)})}o(Qc,"updateInstallationRequest");function Cd(a){return gf(a)?{fid:a.fid,registrationStatus:0}:a}o(Cd,"clearTimedOutRequest");function gf(a){return a.registrationStatus===1&&a.registrationTime+fd<Date.now()}o(gf,"hasInstallationRequestTimedOut");async function yf({appConfig:a,heartbeatServiceProvider:e},t){const s=mf(a,t),n=Ju(a,t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const r={installation:{sdkVersion:pd,appId:a.appId}},c={method:"POST",headers:n,body:JSON.stringify(r)},l=await bd(()=>fetch(s,c));if(l.ok){const d=await l.json();return wd(d)}else throw await Ad("Generate Auth Token",l)}o(yf,"generateAuthTokenRequest");function mf(a,{fid:e}){return`${md(a)}/${e}/authTokens:generate`}o(mf,"getGenerateAuthTokenEndpoint");async function Ii(a,e=!1){let t;const s=await bs(a.appConfig,i=>{if(!Td(i))throw Rt.create("not-registered");const r=i.authToken;if(!e&&If(r))return i;if(r.requestStatus===1)return t=wf(a,e),i;{if(!navigator.onLine)throw Rt.create("app-offline");const c=Ef(i);return t=Af(a,c),c}});return t?await t:s.authToken}o(Ii,"refreshAuthToken");async function wf(a,e){let t=await Zc(a.appConfig);for(;t.authToken.requestStatus===1;)await Ed(100),t=await Zc(a.appConfig);const s=t.authToken;return s.requestStatus===0?Ii(a,e):s}o(wf,"waitUntilAuthTokenRequest");function Zc(a){return bs(a,e=>{if(!Td(e))throw Rt.create("not-registered");const t=e.authToken;return Df(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}o(Zc,"updateAuthTokenRequest");async function Af(a,e){try{const t=await yf(a,e),s=Object.assign(Object.assign({},e),{authToken:t});return await Qe(a.appConfig,s),t}catch(t){if(yd(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Pd(a.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Qe(a.appConfig,s)}throw t}}o(Af,"fetchAuthTokenFromServer");function Td(a){return a!==void 0&&a.registrationStatus===2}o(Td,"isEntryRegistered");function If(a){return a.requestStatus===2&&!bf(a)}o(If,"isAuthTokenValid");function bf(a){const e=Date.now();return e<a.creationTime||a.creationTime+a.expiresIn<e+Hu}o(bf,"isAuthTokenExpired");function Ef(a){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},a),{authToken:e})}o(Ef,"makeAuthTokenRequestInProgressEntry");function Df(a){return a.requestStatus===1&&a.requestTime+fd<Date.now()}o(Df,"hasAuthTokenRequestTimedOut");async function vf(a){const e=a,{installationEntry:t,registrationPromise:s}=await Ai(e);return s?s.catch(console.error):Ii(e).catch(console.error),t.fid}o(vf,"getId");async function Sf(a,e=!1){const t=a;return await Pf(t),(await Ii(t,e)).token}o(Sf,"getToken");async function Pf(a){const{registrationPromise:e}=await Ai(a);e&&await e}o(Pf,"completeInstallationRegistration");function Cf(a){if(!a||!a.options)throw Ls("App Configuration");if(!a.name)throw Ls("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!a.options[t])throw Ls(t);return{appName:a.name,projectId:a.options.projectId,apiKey:a.options.apiKey,appId:a.options.appId}}o(Cf,"extractAppConfig");function Ls(a){return Rt.create("missing-app-config-values",{valueName:a})}o(Ls,"getMissingValueError");const _d="installations",Tf="installations-internal",_f=o(a=>{const e=a.getProvider("app").getImmediate(),t=Cf(e),s=Zt(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},"publicFactory"),xf=o(a=>{const e=a.getProvider("app").getImmediate(),t=Zt(e,_d).getImmediate();return{getId:()=>vf(t),getToken:n=>Sf(t,n)}},"internalFactory");function Nf(){ut(new Y(_d,_f,"PUBLIC")),ut(new Y(Tf,xf,"PRIVATE"))}o(Nf,"registerInstallations");Nf();q(ud,mi);q(ud,mi,"esm2017");const Ze="analytics",Of="firebase_id",Mf="origin",Rf=60*1e3,Lf="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",bi="https://www.googletagmanager.com/gtag/js";const $=new Wt("@firebase/analytics");const $f={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},G=new Et("analytics","Analytics",$f);function Ff(a){if(!a.startsWith(bi)){const e=G.create("invalid-gtag-resource",{gtagURL:a});return $.warn(e.message),""}return a}o(Ff,"createGtagTrustedTypesScriptURL");function xd(a){return Promise.all(a.map(e=>e.catch(t=>t)))}o(xd,"promiseAllSettled");function kf(a,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(a,e)),t}o(kf,"createTrustedTypesPolicy");function Uf(a,e){const t=kf("firebase-js-sdk-policy",{createScriptURL:Ff}),s=document.createElement("script"),n=`${bi}?l=${a}&id=${e}`;s.src=t?t==null?void 0:t.createScriptURL(n):n,s.async=!0,document.head.appendChild(s)}o(Uf,"insertScriptTag");function Bf(a){let e=[];return Array.isArray(window[a])?e=window[a]:window[a]=e,e}o(Bf,"getOrCreateDataLayer");async function Vf(a,e,t,s,n,i){const r=s[n];try{if(r)await e[r];else{const l=(await xd(t)).find(d=>d.measurementId===n);l&&await e[l.appId]}}catch(c){$.error(c)}a("config",n,i)}o(Vf,"gtagOnConfig");async function Gf(a,e,t,s,n){try{let i=[];if(n&&n.send_to){let r=n.send_to;Array.isArray(r)||(r=[r]);const c=await xd(t);for(const l of r){const d=c.find(u=>u.measurementId===l),h=d&&e[d.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),a("event",s,n||{})}catch(i){$.error(i)}}o(Gf,"gtagOnEvent");function jf(a,e,t,s){async function n(i,...r){try{if(i==="event"){const[c,l]=r;await Gf(a,e,t,c,l)}else if(i==="config"){const[c,l]=r;await Vf(a,e,t,s,c,l)}else if(i==="consent"){const[c]=r;a("consent","update",c)}else if(i==="get"){const[c,l,d]=r;a("get",c,l,d)}else if(i==="set"){const[c]=r;a("set",c)}else a(i,...r)}catch(c){$.error(c)}}return o(n,"gtagWrapper"),n}o(jf,"wrapGtag");function zf(a,e,t,s,n){let i=o(function(...r){window[s].push(arguments)},"gtagCore");return window[n]&&typeof window[n]=="function"&&(i=window[n]),window[n]=jf(i,a,e,t),{gtagCore:i,wrappedGtag:window[n]}}o(zf,"wrapOrCreateGtag");function Kf(a){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(bi)&&t.src.includes(a))return t;return null}o(Kf,"findGtagScriptOnPage");const Wf=30,Hf=1e3,ir=class ir{constructor(e={},t=Hf){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};o(ir,"RetryData");let Pn=ir;const Nd=new Pn;function qf(a){return new Headers({Accept:"application/json","x-goog-api-key":a})}o(qf,"getHeaders");async function Yf(a){var e;const{appId:t,apiKey:s}=a,n={method:"GET",headers:qf(s)},i=Lf.replace("{app-id}",t),r=await fetch(i,n);if(r.status!==200&&r.status!==304){let c="";try{const l=await r.json();!((e=l.error)===null||e===void 0)&&e.message&&(c=l.error.message)}catch{}throw G.create("config-fetch-failed",{httpStatus:r.status,responseMessage:c})}return r.json()}o(Yf,"fetchDynamicConfig");async function Xf(a,e=Nd,t){const{appId:s,apiKey:n,measurementId:i}=a.options;if(!s)throw G.create("no-app-id");if(!n){if(i)return{measurementId:i,appId:s};throw G.create("no-api-key")}const r=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new Cn;return setTimeout(async()=>{c.abort()},t!==void 0?t:Rf),Od({appId:s,apiKey:n,measurementId:i},r,c,e)}o(Xf,"fetchDynamicConfigWithRetry");async function Od(a,{throttleEndTimeMillis:e,backoffCount:t},s,n=Nd){var i;const{appId:r,measurementId:c}=a;try{await Jf(s,e)}catch(l){if(c)return $.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:r,measurementId:c};throw l}try{const l=await Yf(a);return n.deleteThrottleMetadata(r),l}catch(l){const d=l;if(!Qf(d)){if(n.deleteThrottleMetadata(r),c)return $.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:r,measurementId:c};throw l}const h=Number((i=d==null?void 0:d.customData)===null||i===void 0?void 0:i.httpStatus)===503?fn(t,n.intervalMillis,Wf):fn(t,n.intervalMillis),u={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return n.setThrottleMetadata(r,u),$.debug(`Calling attemptFetch again in ${h} millis`),Od(a,u,s,n)}}o(Od,"attemptFetchDynamicConfigWithRetry");function Jf(a,e){return new Promise((t,s)=>{const n=Math.max(e-Date.now(),0),i=setTimeout(t,n);a.addEventListener(()=>{clearTimeout(i),s(G.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}o(Jf,"setAbortableTimeout$1");function Qf(a){if(!(a instanceof ht)||!a.customData)return!1;const e=Number(a.customData.httpStatus);return e===429||e===500||e===503||e===504}o(Qf,"isRetriableError$1");const rr=class rr{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};o(rr,"AnalyticsAbortSignal");let Cn=rr;async function Zf(a,e,t,s,n){if(n&&n.global){a("event",t,s);return}else{const i=await e,r=Object.assign(Object.assign({},s),{send_to:i});a("event",t,r)}}o(Zf,"logEvent$1");async function tp(){if(As())try{await pi()}catch(a){return $.warn(G.create("indexeddb-unavailable",{errorInfo:a==null?void 0:a.toString()}).message),!1}else return $.warn(G.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}o(tp,"validateIndexedDB");async function ep(a,e,t,s,n,i,r){var c;const l=Xf(a);l.then(y=>{t[y.measurementId]=y.appId,a.options.measurementId&&y.measurementId!==a.options.measurementId&&$.warn(`The measurement ID in the local Firebase config (${a.options.measurementId}) does not match the measurement ID fetched from the server (${y.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(y=>$.error(y)),e.push(l);const d=tp().then(y=>{if(y)return s.getId()}),[h,u]=await Promise.all([l,d]);Kf(i)||Uf(i,h.measurementId),n("js",new Date);const g=(c=r==null?void 0:r.config)!==null&&c!==void 0?c:{};return g[Mf]="firebase",g.update=!0,u!=null&&(g[Of]=u),n("config",h.measurementId,g),h.measurementId}o(ep,"_initializeAnalytics");var Oe;let sp=(Oe=class{constructor(e){this.app=e}_delete(){return delete oe[this.app.options.appId],Promise.resolve()}},o(Oe,"AnalyticsService"),Oe),oe={},tl=[];const el={};let $s="dataLayer",np="gtag",sl,Md,nl=!1;function ap(){const a=[];if(Fh()&&a.push("This is a browser extension environment."),id()||a.push("Cookies are not available."),a.length>0){const e=a.map((s,n)=>`(${n+1}) ${s}`).join(" "),t=G.create("invalid-analytics-context",{errorInfo:e});$.warn(t.message)}}o(ap,"warnOnBrowserContextMismatch");function ip(a,e,t){ap();const s=a.options.appId;if(!s)throw G.create("no-app-id");if(!a.options.apiKey)if(a.options.measurementId)$.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${a.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw G.create("no-api-key");if(oe[s]!=null)throw G.create("already-exists",{id:s});if(!nl){Bf($s);const{wrappedGtag:i,gtagCore:r}=zf(oe,tl,el,$s,np);Md=i,sl=r,nl=!0}return oe[s]=ep(a,tl,el,e,sl,$s,t),new sp(a)}o(ip,"factory$1");function rp(a=yi()){a=nt(a);const e=Zt(a,Ze);return e.isInitialized()?e.getImmediate():op(a)}o(rp,"getAnalytics");function op(a,e={}){const t=Zt(a,Ze);if(t.isInitialized()){const n=t.getImmediate();if(Xe(e,t.getOptions()))return n;throw G.create("already-initialized")}return t.initialize({options:e})}o(op,"initializeAnalytics");function Rd(a,e,t,s){a=nt(a),Zf(Md,oe[a.app.options.appId],e,t,s).catch(n=>$.error(n))}o(Rd,"logEvent");const al="@firebase/analytics",il="0.10.1";function cp(){ut(new Y(Ze,(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();return ip(s,n,t)},"PUBLIC")),ut(new Y("analytics-internal",a,"PRIVATE")),q(al,il),q(al,il,"esm2017");function a(e){try{const t=e.getProvider(Ze).getImmediate();return{logEvent:(s,n,i)=>Rd(t,s,n,i)}}catch(t){throw G.create("interop-component-reg-failed",{reason:t})}}o(a,"internalFactory")}o(cp,"registerAnalytics");cp();const or=class or{constructor(e){f(this,"plugin");f(this,"firebaseApp");this.plugin=e,"firebaseApp"in e&&(this.firebaseApp=e.firebaseApp)}setStorageData(e,t,s){const{storage:n}=this.plugin.game,i={[e]:{[t]:s}};n.setStorageData("firebase","services",i)}};o(or,"BaseService");let ye=or;const{Valid:rl}=p.Utils,cr=class cr extends ye{constructor(t){super(t);f(this,"analytics");this.initialize()}initialize(){this.analytics=rp(this.firebaseApp),this.setStorageData("analytics","isInitialized",!0)}event(t,s){this.analytics&&rl.isString(t)&&rl.isObject(s)&&(Rd(this.analytics,t,s),this.setStorageData("analytics","lastEvent",t))}};o(cr,"AnalyticsService");let Tn=cr;const ol="@firebase/performance",_n="0.6.5";const Ld=_n,lp="FB-PERF-TRACE-START",dp="FB-PERF-TRACE-STOP",xn="FB-PERF-TRACE-MEASURE",$d="_wt_",Fd="_fp",kd="_fcp",Ud="_fid",Bd="@firebase/performance/config",Vd="@firebase/performance/configexpire",hp="performance",Gd="Performance";const up={"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},M=new Et(hp,Gd,up);const ot=new Wt(Gd);ot.logLevel=b.INFO;let Fs,jd;const ms=class ms{constructor(e){if(this.window=e,!e)throw M.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){!this.performance||!this.performance.mark||this.performance.mark(e)}measure(e,t,s){!this.performance||!this.performance.measure||this.performance.measure(e,t,s)}getEntriesByType(e){return!this.performance||!this.performance.getEntriesByType?[]:this.performance.getEntriesByType(e)}getEntriesByName(e){return!this.performance||!this.performance.getEntriesByName?[]:this.performance.getEntriesByName(e)}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return!fetch||!Promise||!id()?(ot.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1):As()?!0:(ot.info("IndexedDB is not supported by current browser"),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(n=>{for(const i of n.getEntries())t(i)}).observe({entryTypes:[e]})}static getInstance(){return Fs===void 0&&(Fs=new ms(jd)),Fs}};o(ms,"Api");let x=ms;function fp(a){jd=a}o(fp,"setupApi");let zd;function pp(a){const e=a.getId();return e.then(t=>{zd=t}),e}o(pp,"getIidPromise");function Ei(){return zd}o(Ei,"getIid");function gp(a){const e=a.getToken();return e.then(t=>{}),e}o(gp,"getAuthTokenPromise");function cl(a,e){const t=a.length-e.length;if(t<0||t>1)throw M.create("invalid String merger input");const s=[];for(let n=0;n<a.length;n++)s.push(a.charAt(n)),e.length>n&&s.push(e.charAt(n));return s.join("")}o(cl,"mergeStrings");let ks;const ws=class ws{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=cl("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=cl("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return ks===void 0&&(ks=new ws),ks}};o(ws,"SettingsService");let V=ws;var zt;(function(a){a[a.UNKNOWN=0]="UNKNOWN",a[a.VISIBLE=1]="VISIBLE",a[a.HIDDEN=2]="HIDDEN"})(zt||(zt={}));const yp=["firebase_","google_","ga_"],mp=new RegExp("^[a-zA-Z]\\w*$"),wp=40,Ap=100;function Ip(){const a=x.getInstance().navigator;return a!=null&&a.serviceWorker?a.serviceWorker.controller?2:3:1}o(Ip,"getServiceWorkerStatus");function Kd(){switch(x.getInstance().document.visibilityState){case"visible":return zt.VISIBLE;case"hidden":return zt.HIDDEN;default:return zt.UNKNOWN}}o(Kd,"getVisibilityState");function bp(){const e=x.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}o(bp,"getEffectiveConnectionType");function Ep(a){return a.length===0||a.length>wp?!1:!yp.some(t=>a.startsWith(t))&&!!a.match(mp)}o(Ep,"isValidCustomAttributeName");function Dp(a){return a.length!==0&&a.length<=Ap}o(Dp,"isValidCustomAttributeValue");function Wd(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.appId;if(!t)throw M.create("no app id");return t}o(Wd,"getAppId");function vp(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.projectId;if(!t)throw M.create("no project id");return t}o(vp,"getProjectId");function Sp(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.apiKey;if(!t)throw M.create("no api key");return t}o(Sp,"getApiKey");const Pp="0.0.1",Z={loggingEnabled:!0},Cp="FIREBASE_INSTALLATIONS_AUTH";function Tp(a,e){const t=_p();return t?(ll(t),Promise.resolve()):Op(a,e).then(ll).then(s=>xp(s),()=>{})}o(Tp,"getConfig");function _p(){const a=x.getInstance().localStorage;if(!a)return;const e=a.getItem(Vd);if(!e||!Mp(e))return;const t=a.getItem(Bd);if(t)try{return JSON.parse(t)}catch{return}}o(_p,"getStoredConfig");function xp(a){const e=x.getInstance().localStorage;!a||!e||(e.setItem(Bd,JSON.stringify(a)),e.setItem(Vd,String(Date.now()+V.getInstance().configTimeToLive*60*60*1e3)))}o(xp,"storeConfig");const Np="Could not fetch config, will use default configs";function Op(a,e){return gp(a.installations).then(t=>{const s=vp(a.app),n=Sp(a.app),i=`https://firebaseremoteconfig.googleapis.com/v1/projects/${s}/namespaces/fireperf:fetch?key=${n}`,r=new Request(i,{method:"POST",headers:{Authorization:`${Cp} ${t}`},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:Wd(a.app),app_version:Ld,sdk_version:Pp})});return fetch(r).then(c=>{if(c.ok)return c.json();throw M.create("RC response not ok")})}).catch(()=>{ot.info(Np)})}o(Op,"getRemoteConfig$1");function ll(a){if(!a)return a;const e=V.getInstance(),t=a.entries||{};return t.fpr_enabled!==void 0?e.loggingEnabled=String(t.fpr_enabled)==="true":e.loggingEnabled=Z.loggingEnabled,t.fpr_log_source?e.logSource=Number(t.fpr_log_source):Z.logSource&&(e.logSource=Z.logSource),t.fpr_log_endpoint_url?e.logEndPointUrl=t.fpr_log_endpoint_url:Z.logEndPointUrl&&(e.logEndPointUrl=Z.logEndPointUrl),t.fpr_log_transport_key?e.transportKey=t.fpr_log_transport_key:Z.transportKey&&(e.transportKey=Z.transportKey),t.fpr_vc_network_request_sampling_rate!==void 0?e.networkRequestsSamplingRate=Number(t.fpr_vc_network_request_sampling_rate):Z.networkRequestsSamplingRate!==void 0&&(e.networkRequestsSamplingRate=Z.networkRequestsSamplingRate),t.fpr_vc_trace_sampling_rate!==void 0?e.tracesSamplingRate=Number(t.fpr_vc_trace_sampling_rate):Z.tracesSamplingRate!==void 0&&(e.tracesSamplingRate=Z.tracesSamplingRate),e.logTraceAfterSampling=dl(e.tracesSamplingRate),e.logNetworkAfterSampling=dl(e.networkRequestsSamplingRate),a}o(ll,"processConfig");function Mp(a){return Number(a)>Date.now()}o(Mp,"configValid");function dl(a){return Math.random()<=a}o(dl,"shouldLogAfterSampling");let Di=1,Us;function Hd(a){return Di=2,Us=Us||Lp(a),Us}o(Hd,"getInitializationPromise");function Rp(){return Di===3}o(Rp,"isPerfInitialized");function Lp(a){return $p().then(()=>pp(a.installations)).then(e=>Tp(a,e)).then(()=>hl(),()=>hl())}o(Lp,"initializePerf");function $p(){const a=x.getInstance().document;return new Promise(e=>{if(a&&a.readyState!=="complete"){const t=o(()=>{a.readyState==="complete"&&(a.removeEventListener("readystatechange",t),e())},"handler");a.addEventListener("readystatechange",t)}else e()})}o($p,"getDocumentReadyComplete");function hl(){Di=3}o(hl,"changeInitializationStatus");const vi=10*1e3,Fp=5.5*1e3,qd=3,kp=1e3;let ts=qd,bt=[],ul=!1;function Up(){ul||(Es(Fp),ul=!0)}o(Up,"setupTransportService");function Es(a){setTimeout(()=>{if(ts!==0){if(!bt.length)return Es(vi);Bp()}},a)}o(Es,"processQueue");function Bp(){const a=bt.splice(0,kp),e=a.map(s=>({source_extension_json_proto3:s.message,event_time_ms:String(s.eventTime)})),t={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:V.getInstance().logSource,log_event:e};Vp(t,a).catch(()=>{bt=[...a,...bt],ts--,ot.info(`Tries left: ${ts}.`),Es(vi)})}o(Bp,"dispatchQueueEvents");function Vp(a,e){return Gp(a).then(t=>(t.ok||ot.info("Call to Firebase backend failed."),t.json())).then(t=>{const s=Number(t.nextRequestWaitMillis);let n=vi;isNaN(s)||(n=Math.max(s,n));const i=t.logResponseDetails;Array.isArray(i)&&i.length>0&&i[0].responseAction==="RETRY_REQUEST_LATER"&&(bt=[...e,...bt],ot.info("Retry transport request later.")),ts=qd,Es(n)})}o(Vp,"sendEventsToFl");function Gp(a){const e=V.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(a)})}o(Gp,"postToFlEndpoint");function jp(a){if(!a.eventTime||!a.message)throw M.create("invalid cc log");bt=[...bt,a]}o(jp,"addToQueue");function zp(a){return(...e)=>{const t=a(...e);jp({message:t,eventTime:Date.now()})}}o(zp,"transportHandler");let Bs;function Yd(a,e){Bs||(Bs=zp(Wp)),Bs(a,e)}o(Yd,"sendLog");function Le(a){const e=V.getInstance();!e.instrumentationEnabled&&a.isAuto||!e.dataCollectionEnabled&&!a.isAuto||x.getInstance().requiredApisAvailable()&&(a.isAuto&&Kd()!==zt.VISIBLE||(Rp()?Vs(a):Hd(a.performanceController).then(()=>Vs(a),()=>Vs(a))))}o(Le,"logTrace");function Vs(a){if(!Ei())return;const e=V.getInstance();!e.loggingEnabled||!e.logTraceAfterSampling||setTimeout(()=>Yd(a,1),0)}o(Vs,"sendTraceLog");function Kp(a){const e=V.getInstance();if(!e.instrumentationEnabled)return;const t=a.url,s=e.logEndPointUrl.split("?")[0],n=e.flTransportEndpointUrl.split("?")[0];t===s||t===n||!e.loggingEnabled||!e.logNetworkAfterSampling||setTimeout(()=>Yd(a,0),0)}o(Kp,"logNetworkRequest");function Wp(a,e){return e===0?Hp(a):qp(a)}o(Wp,"serializer");function Hp(a){const e={url:a.url,http_method:a.httpMethod||0,http_response_code:200,response_payload_bytes:a.responsePayloadBytes,client_start_time_us:a.startTimeUs,time_to_response_initiated_us:a.timeToResponseInitiatedUs,time_to_response_completed_us:a.timeToResponseCompletedUs},t={application_info:Xd(a.performanceController.app),network_request_metric:e};return JSON.stringify(t)}o(Hp,"serializeNetworkRequest");function qp(a){const e={name:a.name,is_auto:a.isAuto,client_start_time_us:a.startTimeUs,duration_us:a.durationUs};Object.keys(a.counters).length!==0&&(e.counters=a.counters);const t=a.getAttributes();Object.keys(t).length!==0&&(e.custom_attributes=t);const s={application_info:Xd(a.performanceController.app),trace_metric:e};return JSON.stringify(s)}o(qp,"serializeTrace");function Xd(a){return{google_app_id:Wd(a),app_instance_id:Ei(),web_app_info:{sdk_version:Ld,page_url:x.getInstance().getUrl(),service_worker_status:Ip(),visibility_state:Kd(),effective_connection_type:bp()},application_process_state:0}}o(Xd,"getApplicationInfo");const Yp=100,Xp="_",Jp=[Fd,kd,Ud];function Qp(a,e){return a.length===0||a.length>Yp?!1:e&&e.startsWith($d)&&Jp.indexOf(a)>-1||!a.startsWith(Xp)}o(Qp,"isValidMetricName");function Zp(a){const e=Math.floor(a);return e<a&&ot.info(`Metric value should be an Integer, setting the value as : ${e}.`),e}o(Zp,"convertMetricValueToInteger");const de=class de{constructor(e,t,s=!1,n){this.performanceController=e,this.name=t,this.isAuto=s,this.state=1,this.customAttributes={},this.counters={},this.api=x.getInstance(),this.randomId=Math.floor(Math.random()*1e6),this.isAuto||(this.traceStartMark=`${lp}-${this.randomId}-${this.name}`,this.traceStopMark=`${dp}-${this.randomId}-${this.name}`,this.traceMeasure=n||`${xn}-${this.randomId}-${this.name}`,n&&this.calculateTraceMetrics())}start(){if(this.state!==1)throw M.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(this.state!==2)throw M.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Le(this)}record(e,t,s){if(e<=0)throw M.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw M.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(t*1e3),this.startTimeUs=Math.floor(e*1e3),s&&s.attributes&&(this.customAttributes=Object.assign({},s.attributes)),s&&s.metrics)for(const n of Object.keys(s.metrics))isNaN(Number(s.metrics[n]))||(this.counters[n]=Math.floor(Number(s.metrics[n])));Le(this)}incrementMetric(e,t=1){this.counters[e]===void 0?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(Qp(e,this.name))this.counters[e]=Zp(t??0);else throw M.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const s=Ep(e),n=Dp(t);if(s&&n){this.customAttributes[e]=t;return}if(!s)throw M.create("invalid attribute name",{attributeName:e});if(!n)throw M.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){this.customAttributes[e]!==void 0&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(t.duration*1e3),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,s,n){const i=x.getInstance().getUrl();if(!i)return;const r=new de(e,$d+i,!0),c=Math.floor(x.getInstance().getTimeOrigin()*1e3);r.setStartTime(c),t&&t[0]&&(r.setDuration(Math.floor(t[0].duration*1e3)),r.putMetric("domInteractive",Math.floor(t[0].domInteractive*1e3)),r.putMetric("domContentLoadedEventEnd",Math.floor(t[0].domContentLoadedEventEnd*1e3)),r.putMetric("loadEventEnd",Math.floor(t[0].loadEventEnd*1e3)));const l="first-paint",d="first-contentful-paint";if(s){const h=s.find(g=>g.name===l);h&&h.startTime&&r.putMetric(Fd,Math.floor(h.startTime*1e3));const u=s.find(g=>g.name===d);u&&u.startTime&&r.putMetric(kd,Math.floor(u.startTime*1e3)),n&&r.putMetric(Ud,Math.floor(n*1e3))}Le(r)}static createUserTimingTrace(e,t){const s=new de(e,t,!1,t);Le(s)}};o(de,"Trace");let Nt=de;function fl(a,e){const t=e;if(!t||t.responseStart===void 0)return;const s=x.getInstance().getTimeOrigin(),n=Math.floor((t.startTime+s)*1e3),i=t.responseStart?Math.floor((t.responseStart-t.startTime)*1e3):void 0,r=Math.floor((t.responseEnd-t.startTime)*1e3),c=t.name&&t.name.split("?")[0],l={performanceController:a,url:c,responsePayloadBytes:t.transferSize,startTimeUs:n,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:r};Kp(l)}o(fl,"createNetworkRequestEntry");const tg=5e3;function pl(a){Ei()&&(setTimeout(()=>sg(a),0),setTimeout(()=>eg(a),0),setTimeout(()=>ng(a),0))}o(pl,"setupOobResources");function eg(a){const e=x.getInstance(),t=e.getEntriesByType("resource");for(const s of t)fl(a,s);e.setupObserver("resource",s=>fl(a,s))}o(eg,"setupNetworkRequests");function sg(a){const e=x.getInstance(),t=e.getEntriesByType("navigation"),s=e.getEntriesByType("paint");if(e.onFirstInputDelay){let n=setTimeout(()=>{Nt.createOobTrace(a,t,s),n=void 0},tg);e.onFirstInputDelay(i=>{n&&(clearTimeout(n),Nt.createOobTrace(a,t,s,i))})}else Nt.createOobTrace(a,t,s)}o(sg,"setupOobTraces");function ng(a){const e=x.getInstance(),t=e.getEntriesByType("measure");for(const s of t)gl(a,s);e.setupObserver("measure",s=>gl(a,s))}o(ng,"setupUserTimingTraces");function gl(a,e){const t=e.name;t.substring(0,xn.length)!==xn&&Nt.createUserTimingTrace(a,t)}o(gl,"createUserTimingTrace");const lr=class lr{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||((e==null?void 0:e.dataCollectionEnabled)!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),(e==null?void 0:e.instrumentationEnabled)!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),x.getInstance().requiredApisAvailable()?pi().then(t=>{t&&(Up(),Hd(this).then(()=>pl(this),()=>pl(this)),this.initialized=!0)}).catch(t=>{ot.info(`Environment doesn't support IndexedDB: ${t}`)}):ot.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){V.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return V.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){V.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return V.getInstance().dataCollectionEnabled}};o(lr,"PerformanceController");let Nn=lr;const ag="[DEFAULT]";function ig(a=yi()){return a=nt(a),Zt(a,"performance").getImmediate()}o(ig,"getPerformance");function rg(a,e){return a=nt(a),new Nt(a,e)}o(rg,"trace");const og=o((a,{options:e})=>{const t=a.getProvider("app").getImmediate(),s=a.getProvider("installations-internal").getImmediate();if(t.name!==ag)throw M.create("FB not default");if(typeof window>"u")throw M.create("no window");fp(window);const n=new Nn(t,s);return n._init(e),n},"factory");function cg(){ut(new Y("performance",og,"PUBLIC")),q(ol,_n),q(ol,_n,"esm2017")}o(cg,"registerPerformance");cg();const dr=class dr extends ye{constructor(t){super(t);f(this,"perf");f(this,"traces");this.traces={},this.initialize()}initialize(){this.perf=ig(this.firebaseApp),this.perf.dataCollectionEnabled=!0,this.perf.instrumentationEnabled=!1,this.setStorageData("performance","isInitialized",!0)}measure(t){this.perf&&(this.traces[t]=rg(this.perf,t))}start(t){this.traces[t]&&this.traces[t].start()}record(t,s){if(!this.traces[t])return;const{startTime:n=Date.now(),duration:i,options:r}=s;this.traces[t].record(n,i,r)}stop(t){this.traces[t]&&this.traces[t].stop()}putMetric(t,s,n=1){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].putMetric(i,n)}incrementMetric(t,s,n=1){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].incrementMetric(i,n)}putAttr(t,s,n){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].putAttribute(i,n)}removeAttr(t,s){if(!this.traces[t])return;const n=this.formatKeyName(s);this.traces[t].removeAttribute(n)}formatKeyName(t){return t.replace(/\s/g,"_")}};o(dr,"PerformanceService");let On=dr;const Gs="@firebase/remote-config",yl="0.4.5";const hr=class hr{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};o(hr,"RemoteConfigAbortSignal");let Mn=hr;const Jd="remote-config";const lg={"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"},L=new Et("remoteconfig","Remote Config",lg);function dg(a,e){return a instanceof ht&&a.code.indexOf(e)!==-1}o(dg,"hasErrorCode");const hg=!1,ug="",ml=0,fg=["1","true","t","yes","y","on"],ur=class ur{constructor(e,t=ug){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return this._source==="static"?hg:fg.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return ml;let e=Number(this._value);return isNaN(e)&&(e=ml),e}getSource(){return this._source}};o(ur,"Value");let ce=ur;function pg(a=yi()){return a=nt(a),Zt(a,Jd).getImmediate()}o(pg,"getRemoteConfig");async function gg(a){const e=nt(a),[t,s]=await Promise.all([e._storage.getLastSuccessfulFetchResponse(),e._storage.getActiveConfigEtag()]);return!t||!t.config||!t.eTag||t.eTag===s?!1:(await Promise.all([e._storageCache.setActiveConfig(t.config),e._storage.setActiveConfigEtag(t.eTag)]),!0)}o(gg,"activate");function yg(a){const e=nt(a);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}o(yg,"ensureInitialized");async function mg(a){const e=nt(a),t=new Mn;setTimeout(async()=>{t.abort()},e.settings.fetchTimeoutMillis);try{await e._client.fetch({cacheMaxAgeMillis:e.settings.minimumFetchIntervalMillis,signal:t}),await e._storageCache.setLastFetchStatus("success")}catch(s){const n=dg(s,"fetch-throttle")?"throttle":"failure";throw await e._storageCache.setLastFetchStatus(n),s}}o(mg,"fetchConfig");function wg(a,e){return Ag(nt(a),e).asString()}o(wg,"getString");function Ag(a,e){const t=nt(a);t._isInitializationComplete||t._logger.debug(`A value was requested for key "${e}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);const s=t._storageCache.getActiveConfig();return s&&s[e]!==void 0?new ce("remote",s[e]):t.defaultConfig&&t.defaultConfig[e]!==void 0?new ce("default",String(t.defaultConfig[e])):(t._logger.debug(`Returning static value for key "${e}". Define a default or remote value if this is unintentional.`),new ce("static"))}o(Ag,"getValue");const fr=class fr{constructor(e,t,s,n){this.client=e,this.storage=t,this.storageCache=s,this.logger=n}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const s=Date.now()-t,n=s<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${s}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${n}.`),n}async fetch(e){const[t,s]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(s&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return s;e.eTag=s&&s.eTag;const n=await this.client.fetch(e),i=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return n.status===200&&i.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(i),n}};o(fr,"CachingClient");let Rn=fr;function Ig(a=navigator){return a.languages&&a.languages[0]||a.language}o(Ig,"getUserLanguage");const pr=class pr{constructor(e,t,s,n,i,r){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=s,this.projectId=n,this.apiKey=i,this.appId=r}async fetch(e){const[t,s]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,r={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},c={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:s,app_id:this.appId,language_code:Ig()},l={method:"POST",headers:r,body:JSON.stringify(c)},d=fetch(i,l),h=new Promise((m,E)=>{e.signal.addEventListener(()=>{const U=new Error("The operation was aborted.");U.name="AbortError",E(U)})});let u;try{await Promise.race([d,h]),u=await d}catch(m){let E="fetch-client-network";throw(m==null?void 0:m.name)==="AbortError"&&(E="fetch-timeout"),L.create(E,{originalErrorMessage:m==null?void 0:m.message})}let g=u.status;const y=u.headers.get("ETag")||void 0;let w,A;if(u.status===200){let m;try{m=await u.json()}catch(E){throw L.create("fetch-client-parse",{originalErrorMessage:E==null?void 0:E.message})}w=m.entries,A=m.state}if(A==="INSTANCE_STATE_UNSPECIFIED"?g=500:A==="NO_CHANGE"?g=304:(A==="NO_TEMPLATE"||A==="EMPTY_CONFIG")&&(w={}),g!==304&&g!==200)throw L.create("fetch-status",{httpStatus:g});return{status:g,eTag:y,config:w}}};o(pr,"RestClient");let Ln=pr;function bg(a,e){return new Promise((t,s)=>{const n=Math.max(e-Date.now(),0),i=setTimeout(t,n);a.addEventListener(()=>{clearTimeout(i),s(L.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}o(bg,"setAbortableTimeout");function Eg(a){if(!(a instanceof ht)||!a.customData)return!1;const e=Number(a.customData.httpStatus);return e===429||e===500||e===503||e===504}o(Eg,"isRetriableError");const gr=class gr{constructor(e,t){this.client=e,this.storage=t}async fetch(e){const t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:s}){await bg(e.signal,t);try{const n=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),n}catch(n){if(!Eg(n))throw n;const i={throttleEndTimeMillis:Date.now()+fn(s),backoffCount:s+1};return await this.storage.setThrottleMetadata(i),this.attemptFetch(e,i)}}};o(gr,"RetryingClient");let $n=gr;const Dg=60*1e3,vg=12*60*60*1e3,yr=class yr{constructor(e,t,s,n,i){this.app=e,this._client=t,this._storageCache=s,this._storage=n,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:Dg,minimumFetchIntervalMillis:vg},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}};o(yr,"RemoteConfig");let Fn=yr;function He(a,e){const t=a.target.error||void 0;return L.create(e,{originalErrorMessage:t&&(t==null?void 0:t.message)})}o(He,"toFirebaseError");const Tt="app_namespace_store",Sg="firebase_remote_config",Pg=1;function Cg(){return new Promise((a,e)=>{try{const t=indexedDB.open(Sg,Pg);t.onerror=s=>{e(He(s,"storage-open"))},t.onsuccess=s=>{a(s.target.result)},t.onupgradeneeded=s=>{const n=s.target.result;switch(s.oldVersion){case 0:n.createObjectStore(Tt,{keyPath:"compositeKey"})}}}catch(t){e(L.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}})}o(Cg,"openDatabase");const mr=class mr{constructor(e,t,s,n=Cg()){this.appId=e,this.appName=t,this.namespace=s,this.openDbPromise=n}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){const t=await this.openDbPromise;return new Promise((s,n)=>{const r=t.transaction([Tt],"readonly").objectStore(Tt),c=this.createCompositeKey(e);try{const l=r.get(c);l.onerror=d=>{n(He(d,"storage-get"))},l.onsuccess=d=>{const h=d.target.result;s(h?h.value:void 0)}}catch(l){n(L.create("storage-get",{originalErrorMessage:l==null?void 0:l.message}))}})}async set(e,t){const s=await this.openDbPromise;return new Promise((n,i)=>{const c=s.transaction([Tt],"readwrite").objectStore(Tt),l=this.createCompositeKey(e);try{const d=c.put({compositeKey:l,value:t});d.onerror=h=>{i(He(h,"storage-set"))},d.onsuccess=()=>{n()}}catch(d){i(L.create("storage-set",{originalErrorMessage:d==null?void 0:d.message}))}})}async delete(e){const t=await this.openDbPromise;return new Promise((s,n)=>{const r=t.transaction([Tt],"readwrite").objectStore(Tt),c=this.createCompositeKey(e);try{const l=r.delete(c);l.onerror=d=>{n(He(d,"storage-delete"))},l.onsuccess=()=>{s()}}catch(l){n(L.create("storage-delete",{originalErrorMessage:l==null?void 0:l.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}};o(mr,"Storage");let kn=mr;const wr=class wr{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),s=this.storage.getActiveConfig(),n=await e;n&&(this.lastFetchStatus=n);const i=await t;i&&(this.lastSuccessfulFetchTimestampMillis=i);const r=await s;r&&(this.activeConfig=r)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}};o(wr,"StorageCache");let Un=wr;function Tg(){ut(new Y(Jd,a,"PUBLIC").setMultipleInstances(!0)),q(Gs,yl),q(Gs,yl,"esm2017");function a(e,{instanceIdentifier:t}){const s=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();if(typeof window>"u")throw L.create("registration-window");if(!As())throw L.create("indexed-db-unavailable");const{projectId:i,apiKey:r,appId:c}=s.options;if(!i)throw L.create("registration-project-id");if(!r)throw L.create("registration-api-key");if(!c)throw L.create("registration-app-id");t=t||"firebase";const l=new kn(c,s.name,t),d=new Un(l),h=new Wt(Gs);h.logLevel=b.ERROR;const u=new Ln(n,$u,t,i,r,c),g=new $n(u,l),y=new Rn(g,l,d,h),w=new Fn(s,y,d,l,h);return yg(w),w}o(a,"remoteConfigFactory")}o(Tg,"registerRemoteConfig");async function _g(a){return a=nt(a),await mg(a),gg(a)}o(_g,"fetchAndActivate");Tg();const{Valid:wl}=p.Utils,Ar=class Ar extends ye{constructor(t){super(t);f(this,"remoteConfig");this.initialize()}initialize(){this.remoteConfig=pg(this.firebaseApp),this.setStorageData("remoteConfig","isInitialized",!0)}async fetchDataAsync(){this.remoteConfig&&(await _g(this.remoteConfig),this.setStorageData("remoteConfig","lastFetchTime",Date.now()),this.setStorageData("remoteConfig","lastFetchStatus",this.remoteConfig.lastFetchStatus))}getDataByKey(t){if(!this.remoteConfig)return null;const s=wg(this.remoteConfig,t);if(!wl.isString(s))return null;const n=JSON.parse(s);return wl.isObject(n.data)?(this.setStorageData("remoteConfig","lastConfig",n),n):null}};o(Ar,"RemoteConfigService");let Bn=Ar;const xg={services:{},isInitialized:!1},Ir=class Ir extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"firebaseApp");f(this,"services")}init(){this.services={};const{storage:t}=this.game;t.addStorage("firebase",xg)}configure(t){this.initializeFirebase(t.Options),this.initializeServices(t.Services)}initializeFirebase(t){const s={appId:t.AppId,apiKey:t.ApiKey,projectId:t.ProjectId,authDomain:t.AuthDomain,measurementId:t.MeasurementId,storageBucket:t.StorageBucket,messagingSenderId:t.MessagingSenderId};this.firebaseApp=ld(s),this.setStorageData("isInitialized",!0)}initializeServices(t){this.getStorageData("isInitialized")&&(this.initializeAnalytics(t.Analytics),this.initializePerformance(t.Performance),this.initializeRemoteConfig(t.RemoteConfig))}initializeAnalytics(t){t.Enabled&&(this.services.analytics=new Tn(this))}initializePerformance(t){t.Enabled&&(this.services.performance=new On(this))}initializeRemoteConfig(t){t.Enabled&&(this.services.remoteConfig=new Bn(this))}setStorageData(t,s){const{storage:n}=this.game;n.setStorageData("firebase",t,s)}getStorageData(t){const{storage:s}=this.game;return s.getStorageData("firebase",t)}};o(Ir,"FirebasePlugin");let Vn=Ir;const Ng='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',Og=o((a,e)=>{if(isNaN(a)||isNaN(e))throw new Error("width and height must be numbers");return{string:"+",style:`font-size: 1px; padding: ${Math.floor(e/2)}px ${Math.floor(a/2)}px;`}},"getBox"),Mg=o((a,e=1)=>{const t=new Image;t.onload=function(){const s=this,n=s.width*e,i=s.height*e,r=Og(n,i);console.info(`%c ${r.string}`,`${r.style} background: transparent url(${a}) no-repeat center center; background-size: ${n}px ${i}px;`)},t.src=a},"logImage"),{Configs:Rg,Utils:Lg}=p,{Object:Al}=Lg,{Enabled:$g,WideframeConfigs:Gn}=Rg.FrameCapture,Fg=o(async a=>{if(!$g)return console.warn("FrameCapture is not enabled"),null;const e=Ug(a);if(!e)return null;kg(e,Gn.ResultChallenge);const{frameCapture:t}=window.game,{Width:s,Height:n}=Gn.ResultChallenge;return t.captureAsync({name:"ResultChallenge",width:s,height:n,renderOptions:e})},"renderResultChallenge"),kg=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"result-challenge",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe$2"),Ug=o(a=>{try{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:n="20",opponentPhoto:i="",opponentScore:r=0,isPlayerFinished:c,isOpponentFinished:l}=a,{RenderOptions:d}=Gn.ResultChallenge,h=Al.camelCaseKeys(Al.clone(d)),{playerPhoto:u,opponentPhoto:g}=h,y=s===r,w=s>r,A=c??l,m=c&&l;return u.type==="image"&&(u.name=`${e}`,u.image=t),g.type==="image"&&(g.name=`${n}`,g.image=i),A&&Bg(h,{playerScore:s,opponentScore:r,isPlayerFinished:c,isOpponentFinished:l}),!y&&m&&(w?delete h.rightCrown:delete h.leftCrown),h}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),Bg=o((a,e)=>{const{leftScore:t,rightScore:s}=a,{playerScore:n=0,opponentScore:i=0,isPlayerFinished:r,isOpponentFinished:c}=e;t.type==="text"&&(t.text=r?`${n}`:"???"),s.type==="text"&&(s.text=c?`${i}`:"???")},"addRenderScores"),{Configs:Vg,Utils:Gg}=p,{Object:Il}=Gg,{Enabled:jg,WideframeConfigs:jn}=Vg.FrameCapture,zg=o(async a=>{if(!jg)return console.warn("FrameCapture is not enabled"),null;const e=Wg(a);if(!e)return null;Kg(e,jn.ShareLeaderboard);const{frameCapture:t}=window.game,{Width:s,Height:n}=jn.ShareLeaderboard;return t.captureAsync({name:"ShareLeaderboard",width:s,height:n,renderOptions:e})},"renderShareLeaderboard"),Kg=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"share-leaderboard",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe$1"),Wg=o(a=>{try{const{playerId:e,playerPhoto:t,leaders:s}=a,{RenderOptions:n}=jn.ShareLeaderboard,i=Il.camelCaseKeys(Il.clone(n)),{avatar:r}=i;return r.type==="image"&&(r.name=`${e}`,r.image=t),Hg(i,s),i}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),Hg=o((a,e)=>{const t="600 48px";e.forEach((s,n)=>{const{id:i,name:r,photo:c,score:l}=s;let d=1294+180*n;a[`photo_${i}`]={depth:-1,name:i,type:"image",image:c,size:[96,96],position:[436,d]},d=1360+180*n,a[`name_${i}`]={font:t,depth:1,name:i,type:"text",text:r,position:[600,d],fillStyle:"#b18151"},a[`score_${i}`]={font:t,depth:1,name:i,type:"text",text:`${l}`,fillStyle:"#b18151",position:[100,d]}})},"addLeaders"),{Configs:qg,Utils:Yg}=p,{Object:bl}=Yg,{Enabled:Xg,WideframeConfigs:zn}=qg.FrameCapture,Jg=o(async a=>{if(!Xg)return console.warn("FrameCapture is not enabled"),null;const e=Zg(a);if(!e)return null;Qg(e,zn.ShareScore);const{frameCapture:t}=window.game,{Width:s,Height:n}=zn.ShareScore;return t.captureAsync({name:"ShareScore",width:s,height:n,renderOptions:e})},"renderShareScore"),Qg=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"share-score",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe"),Zg=o(a=>{try{const{playerId:e,playerPhoto:t,playerScore:s}=a,{RenderOptions:n}=zn.ShareScore,i=bl.camelCaseKeys(bl.clone(n));console.log("renderOptions",i);const{avatar:r,playerScore:c}=i;return r.type==="image"&&(r.name=`${e}`,r.image=t),c.type==="text"&&(c.text=`${s}`),i}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),{Configs:ty,Utils:ey}=p,{Image:El,Object:Dl,Valid:js}=ey,{Options:zs}=ty.FrameCapture,br=class br extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"width");f(this,"height");f(this,"canvas",null);f(this,"testRenderOptions",null);f(this,"caches",{});f(this,"wideframe",{})}init(){this.addWideframeRender("renderShareScore",Jg),this.addWideframeRender("renderResultChallenge",Fg),this.addWideframeRender("renderShareLeaderboard",zg)}async preloadAsync(t){const{renderOptions:s}=t;await this.loadImages(s)}async captureAsync(t){const{width:s,height:n,renderOptions:i}=t;this.width=s,this.height=n,this.createCanvas();const r=this.testRenderOptions??i;return this.testRenderOptions=r,await this.loadImages(r),this.drawObjects(r),this.snapshotFrameAsync()}addWideframeRender(t,s){this.wideframe[t]=s}setTestRenderOptions(t){if(!t){this.testRenderOptions=null;return}const s=Dl.camelCaseKeys(t);this.testRenderOptions=Dl.merge(this.testRenderOptions,s)}createCanvas(){if(this.canvas){const t=this.canvas.getContext("2d");t?t.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}async loadImages(t){const s=Object.values(t).filter(c=>c.type==="image"),n=this.prepareLoadImages(s),i=Object.values(n);if(i.length<1)return;const r=await Promise.all(i);this.cacheImages(n,r)}prepareLoadImages(t){const s={};for(const n of t){const{name:i,image:r,fallbackImage:c}=n,l=this.caches[i];!js.isString(r)||l||(r===""&&js.isString(c)&&(n.image=c),console.info("prepareLoadImages",n),s[i]=El.loadImage(n.image))}return s}cacheImages(t,s){for(const n in t){const i=s.shift();i&&(this.caches[n]=i)}}drawObjects(t){const s=Object.values(t).sort((n,i)=>n.depth-i.depth);for(const n of s)switch(n.type){case"text":this.drawText(n);break;case"image":this.drawImage(n);break}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{position:n,font:i,text:r,color:c,lineWidth:l,textAlign:d}=t;s.font=`${i} ${Ng}`,s.fillStyle=c??"#ffffff",l&&(s.lineWidth=l),d&&(s.textAlign=d),console.info("drawText",t);const[h,u]=n;s.fillText(r,h,u)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{name:n,size:i,position:r,fallbackImage:c}=t;let l=this.caches[n];if(!l&&c&&(l=this.caches[c]),!l)throw new Error(`Image ${n} not found`);console.info("drawImage",t);const[d,h]=r,[u,g]=i;s.drawImage(l,d,h,u,g)}async snapshotFrameAsync(){if(!this.canvas)return null;let t=null;if(zs.UseBlobIfPossible&&"toBlob"in this.canvas?t=await this.createAsBlob():t=this.createAsDataImage(),!t)throw new Error("Image data is null");return js.isDebugger()&&Mg(t),t}createAsDataImage(){if(!this.canvas)return null;const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return null;const{Quality:s,RenderType:n}=zs;return t.canvas.toDataURL(`image/${n}`,s)}createAsBlob(){return new Promise(t=>{if(!this.canvas){t(null);return}const{Quality:s,RenderType:n}=zs;this.canvas.toBlob(i=>{if(!i){t(null);return}El.blobToDataImage(i).then(r=>{t(r)})},`image/${n}`,s)})}};o(br,"FrameCapturePlugin");let Kn=br;const{Utils:vl}=p,Er=class Er extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"locale");f(this,"data",{})}add(t,s){this.data[t]=s}choose(t){this.locale=t;const{event:s}=this.game;s.emit(p.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,n){const{text:i}=this.getLocaleData(n);if(!vl.Object.hasOwn(i,t)){const c=n??this.getCurrentLocale();return console.warn(`Text with key "${String(t)}" not found in locale "${c}"`),String(t)}const r=i[t];return this.replaceVariables(r,s??[])}getTexture(t){const{texture:s}=this.getLocaleData();return s[t]}getCurrentLocale(){return this.locale||"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!vl.Object.hasOwn(this.data,s))throw new Error(`Locale "${s}" not found`);return this.data[s]}replaceVariables(t,s){const n=s.length;if(n==0)return t;let i=t;for(let r=0;r<n;r++){const c=s[r],l=`%{${r}}`;i=i.replace(l,c)}return i}};o(Er,"LanguagePlugin");let Wn=Er;const sy={_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15},{Configs:ny,Utils:ay}=p,{Object:Ks,String:Sl}=ay,{OtherHost:$e,Mockup:Fe,AppId:iy}=ny,Dr=class Dr{constructor(){f(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await lt(()=>import("./bundle/empty-script.js"),__vite__mapDeps([]),import.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new e}async getLeaderboardAsync(e,t,s){const n=Sl.params(s);let i;return Fe.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in s?i=await this.mockAPI.getPlayers(e,s):i=await this.mockAPI.getLeaders(e,s)):i=await jt(`${t}?${n}`,{},$e),!Ks.hasOwn(i,"data")||!Array.isArray(i.data)?[]:i.data}async getLeaderboardsAsync(e){let t;const s=p.Utils.String.params(e),n="leaderboards";return Fe.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.getLeaderboardsAsync(e)):(t=await jt(`${n}?${s}`,{},$e),!Ks.hasOwn(t,"data")||!Array.isArray(t.data)?[]:t.data)}async setLeaderboardScoreAsync(e){const{leaderboardId:t,playerId:s,score:n}=e;Fe.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(t,s,n)):await B(`leaderboards/${t}/players/${s}`,{score:n},{},$e)}async createLeaderboardAsync(e){const t=e._id??Sl.generateObjectId(),s={...sy,...e,_id:t,appId:iy},n="leaderboards";let i;if(Fe.Leaderboards.Enabled?(await this.initMockAPI(),i=await this.mockAPI.createLeaderboard(s)):i=await B(n,s,{},$e),!Ks.hasOwn(i,"_id")||i._id!==t)throw new Error("Create leaderboard failed");return t}};o(Dr,"LeaderboardAPI");let Hn=Dr;const Pl={limit:0,offset:0,leaders:{},isRequesting:!1},ry={leaderboards:{}},{Valid:oy,Json:Cl,Object:cy}=p.Utils,vr=class vr extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"lbAPI",new Hn);f(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",ry),this.configs={}}addLeaderboard(t){const{name:s,type:n,leaderboardId:i,autoSortRank:r}=t;if(this.getLeaderboard(s)){console.warn(`Leaderboard with name ${s} already exists`);return}let l=`leaderboards/${i}/`;(n==="global"||n==="tournament")&&(l+="leaders"),n==="friends"&&(l+="players"),this.configs[s]={id:i,name:s,type:n,host:l,autoSortRank:r};const d=Cl.clone(Pl);this.setLeaderboard(s,{...d})}async requestLeaderboardsAsync(t){try{return await this.lbAPI.getLeaderboardsAsync(t)}catch(s){return console.warn("requestGlobalLeaderboardsAsync",s),[]}}async requestLeaderboardAsync(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{id:n,type:i,host:r}=this.configs[t];let c=[];if(i==="friends"){const{player:l}=this.game,d=l.getPlayerId(),h=l.getConnectedPlayerIds(s,0),u=[d,...h];this.configs[t].playerIds=[...u],c=await this.lbAPI.getLeaderboardAsync(n,r,{playerIds:u})}else c=await this.lbAPI.getLeaderboardAsync(n,r,{limit:s,offset:0});if(c.length===0)return;await this.receiveLeaderboardAsync(t,c),this.setLeaderboard(t,{limit:s,offset:0})}finally{this.setLeaderboard(t,{isRequesting:!1})}}async loadMoreLeaderboardAsync(t,s){const n=this.getLeaderboard(t);if(n){if(this.configs[t].type==="friends"){console.warn("Cannot load more leaderboard with type friend");return}try{this.setLeaderboard(t,{isRequesting:!0});const{id:i,host:r}=this.configs[t],{offset:c,limit:l}=n,d=c+l,h=await this.lbAPI.getLeaderboardAsync(i,r,{limit:s,offset:d});if(h.length===0)return;this.receiveLeaderboardAsync(t,h),this.setLeaderboard(t,{limit:s,offset:d})}finally{this.setLeaderboard(t,{isRequesting:!1})}}}getLeaderboard(t){const{storage:s}=this.game,n=s.getStorageData("leaderboard","leaderboards");return n[t]?n[t]:null}clearLeaderboard(t){try{this.validateLeaderboard(t);const s=Cl.clone(Pl);this.setLeaderboard(t,null),this.setLeaderboard(t,{...s})}catch(s){console.warn(s)}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:n}=s;return Object.keys(n).length===0}isExistLeaderboardId(t){const{configs:s}=this;return Object.values(s).some(n=>n.id===t)}getLeaderboardName(t){const{configs:s}=this,n=Object.values(s).find(i=>i.id===t);return n?n.name:null}async setLeaderboardScoreAsync(t,s,n){try{this.validateLeaderboard(t);const{id:i}=this.configs[t],r=await this.getLastScoreOnLeaderboard(t,s);if(r&&n<=r)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:i,playerId:s,score:n})}catch(i){console.warn(i)}}async getLastScoreOnLeaderboard(t,s){var i;let n=this.getLeaderboard(t);return n||(await this.requestLeaderboardAsync(t,120),n=this.getLeaderboard(t)),n?((i=n.leaders[s])==null?void 0:i.score)??null:null}async createLeaderboardAsync(t){return this.lbAPI.createLeaderboardAsync(t)}validateLeaderboard(t){const s=this.getLeaderboard(t);if(!oy.isObject(s))throw new Error(`Leaderboard with name ${t} not found`)}setLeaderboard(t,s){const{storage:n}=this.game;n.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboardAsync(t,s){this.validateLeaderboard(t);const{profile:n}=this.game,i=s.map(A=>A.playerId);await n.requestProfiles(i);const r=n.getProfiles(),l=s.map(A=>{const{playerId:m}=A,E=r[m];return E?{...A,name:E.name,photo:E.photo}:{...A,name:"Nameless",photo:"default"}}).filter(A=>A.name&&A.photo),{offset:d=0,leaders:h={}}=this.getLeaderboard(t)??{},u=l.filter(A=>!h[A.playerId]);if(d>0&&u.length>0){const A=Object.values(h).map(m=>({...m,score:`${m.score}`}));u.unshift(...A)}let y=u.map(A=>({...A,score:parseInt(A.score,10)})).sort((A,m)=>m.score-A.score);this.configs[t].autoSortRank&&(y=y.map((A,m)=>({...A,rank:m+1})));const w=cy.keyBy(y,"playerId");this.setLeaderboard(t,{leaders:w})}};o(vr,"LeaderboardPlugin");let qn=vr;const Sr=class Sr{constructor(){f(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}};o(Sr,"BaseAPI");let Yn=Sr;const{Utils:Tl}=p,Pr=class Pr extends Yn{async createSingleMatchAsync(e){const s=await B("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await jt("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,n=await B(s,t,{},this.getAPIHost());return this.returnValidMatchData(n)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await B(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createEndlessMatchAsync(e){const s=await B("endless-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getEndlessMatchDetailAsync(){const t=await jt("endless-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateEndlessMatchMilestoneAsync(e,t){const s=`endless-matches/${e}/milestone`,n=await B(s,t,{},this.getAPIHost());return this.returnValidMatchData(n)}async finishEndlessMatchAsync(e){const t=`endless-matches/${e}/finish`,s=await B(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await B("matches",{opponentPlayerId:e},{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await B(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await jt(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:n=0,extraData:i={}}=e,r=`matches/${t}/finish`,c=await B(r,{matchId:t,score:s,level:n,extraData:i},{},this.getAPIHost());return this.returnValidMatchData(c)}returnValidMatchData(e){let t={};return!Tl.Valid.isObject(e)||!Tl.Object.hasOwn(e,"data")||(t=e.data),t}};o(Pr,"MatchAPI");let Xn=Pr;const Cr=class Cr{constructor(e){f(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new Xn}setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}setMatchAPIInstance(e){this.matchAPI=e}getMatchAPI(){return this.matchAPI}};o(Cr,"APIHandler");let Jn=Cr;const Tr=class Tr{constructor(e,t){f(this,"game");f(this,"match");this.game=e,this.match=t}startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group(`🚀 ${this.constructor.name}`),e&&console.log("📦 ? Payload:",e)}endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}async processAsync(e){throw new Error("Not implemented")}};o(Tr,"BaseConcrete");let P=Tr;const _r=class _r extends et{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}};o(_r,"LevelNotDefined");let es=_r;const xr=class xr extends et{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}};o(xr,"MatchModeNotDefined");let me=xr;const{Object:Ws,Valid:ly}=p.Utils;var Me;let I=(Me=class{constructor(e){f(this,"game");f(this,"match");f(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){console.groupCollapsed(`➡️ ${this.constructor.name}`),this.logData("Before",e)}async nextAsync(e){this.logData("After",e),console.groupEnd(),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){if(!ly.isDebugger())return;console.groupCollapsed(`📦 MatchState: ${e}`);const{profiles:s,customData:n,...i}=t;console.info("💾 Base"),console.table(Ws.clone(i)),console.info("💾 Profile"),console.table(Ws.clone(s)),console.info("💾 Custom"),console.table(Ws.clone(n)),console.groupEnd()}},o(Me,"BaseHandler"),Me);const{Plugins:dy,Utils:hy}=p,{Analytics:uy}=dy,{String:fy,Valid:_l}=hy,Nr=class Nr extends I{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e,{level:n}=s;this.validateMode(t),this.validateLevel(n);const{analytics:i}=this.game;i.event(uy.Events.MATCH_START,{level:n,game_mode:fy.toUpperCamelCase(t),level_name:`level_${n}`}),await this.nextAsync(e)}validateMode(e){if(!_l.isString(e))throw new me}validateLevel(e){if(!_l.isNumber(e))throw new es}};o(Nr,"LogMatchStartHandler");let z=Nr;const j={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},Or=class Or extends I{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let n=t??_t.SINGLE;s===j.FINISHED&&(n=_t.SINGLE),this.contextGameModeDetected(n),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}};o(Or,"ContextGameModeHandler");let _=Or;const Mr=class Mr extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}};o(Mr,"GetMatchDetailFailed");let we=Mr;const Rr=class Rr extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}};o(Rr,"MatchAreNotActive");let ss=Rr;const Lr=class Lr extends et{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}};o(Lr,"MatchIdNotValid");let st=Lr;const $r=class $r extends Error{constructor(e){super(e),this.name="OpponentHasFinishedMatch",this.message=e||"Opponent has finished match"}};o($r,"OpponentHasFinishedMatch");let ns=$r;const Fr=class Fr extends et{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}};o(Fr,"OpponentIdNotValid");let R=Fr;const kr=class kr extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e??"The player is not currently in this match"}};o(kr,"PlayerNotCurrentInMatch");let Ae=kr;const Ur=class Ur extends Error{constructor(e){super(e),this.name="PlayerNotFinishedMatch",this.message=e||"Player not finished match"}};o(Ur,"PlayerNotFinishedMatch");let as=Ur;const{Dtos:py}=p,Br=class Br extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new py.Match.Data(t).toObject();this.validateAwaitMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new st;if(s!==j.ACTIVE)throw new ss}validateAwaitMatchData(e,t){const{id:s,customData:n}=e,{_id:i,whitePlayerId:r,blackPlayerId:c}=t;if(typeof i!="string"||i!==s)throw new we;const{playerId:l}=n,d=r===l,h=c===l;if(!d&&c===dt.playerId)throw new pe;if(!d&&!h)throw new Ae}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(!i)throw new as}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new R;const{finished:i}=t[n];if(i)throw new ns}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,g=h?i:n;e.customData.playerId=u,e.customData.opponentId=g,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[g].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[g].finished=m}};o(Br,"AwaitMatchHandler");let Qn=Br;const Si={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},Vr=class Vr extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:n,customData:i}=this.payload;t.id=s??null,t.mode=n||null,t.status=j.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...Si,...t.customData,...i}}};o(Vr,"PrepareMatchHandler");let k=Vr;const Gr=class Gr extends et{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}};o(Gr,"MatchAreNotOpen");let Ht=Gr;const jr=class jr extends I{async processAsync(e){if(super.processAsync(e),e.status!==j.OPEN)throw new Ht;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=j.ACTIVE,e.startAt=Date.now()}};o(jr,"StartMatchHandler");let K=jr;const Ot=fe,zr=class zr extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}};o(zr,"UnavailableFeature");let S=zr;const Kr=class Kr extends et{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}};o(Kr,"ContextIdNotValid");let X=Kr;const Wr=class Wr extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAwaitingAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new st;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new R}async createWideframesAwaitingAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c;if(!u)return null;const{photo:g,score:y=0,finished:w}=l;return w?null:await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:g,opponentScore:y,isPlayerFinished:!0,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesAwaitingAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK))throw new S("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${l} đang chờ bạn kết thúc trận đấu. Chơi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.updateAsync(d)}};o(Wr,"SendAwaitingMessageHandler");let Zn=Wr;const Hr=class Hr extends I{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}};o(Hr,"NothingHandler");let C=Hr;const qr=class qr extends et{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}};o(qr,"ProfileNotFound");let W=qr;const{Dtos:gy}=p,Yr=class Yr extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:n}=t;let i=s;const r=await this.getProfile(i);if(!r)throw new W;if(this.updateMatchProfile(e,i,r),i=n,i!==dt.playerId){const c=await this.getProfile(i);if(!c)throw new W;this.updateMatchProfile(e,i,c)}else this.updateMatchProfile(e,i);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:n}=t;if(!s||typeof s!="string")throw new D;if(!n||typeof n!="string")throw new R}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:n,photo:i}=s??dt,r=new gy.Match.Profile({id:t,name:n,photo:i}).toObject();e.profiles[t]?(e.profiles[t].name=r.name,e.profiles[t].photo=r.photo):e.profiles[t]=r}};o(Yr,"GetMatchProfilesHandler");let ft=Yr;const Xr=class Xr extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new C(this),r=new k(this,{id:t,mode:J.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new Qn(this);r.setNext(c);const l=new ft(this);c.setNext(l);const d=new K(this);l.setNext(d);const h=new Zn(this);d.setNext(h);const u=new z(this);h.setNext(u);const g=new _(this);u.setNext(g);const y=this.match.getMatchState();await i.processAsync(y)}finally{this.endLog()}}};o(Xr,"AwaitChallengeMatchConcrete");let ta=Xr;const Jr=class Jr extends et{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}};o(Jr,"CreateContextFailed");let Ie=Jr;const{Valid:xl,Object:Nl}=p.Utils,Qr=class Qr extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,n=await this.createAsync(s);t.customData.contextId=n,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(n){this.validateError(n)}const s=GameSDK.context.getID();if(!xl.isString(s))throw new Ie;return s}validateError(t){if(!Nl.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}validateErrorMessage(t){if(!Nl.hasOwn(t,"message")||!xl.isString(t.message))throw t}isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.includes("is not a connected player of the current player")}};o(Qr,"CreateContextHandler");let ea=Qr;const{Dtos:yy}=p,Zr=class Zr extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createMatchAsync(e),s=new yy.Match.Data(t).toObject();this.updateMatchState(e,s),await this.nextAsync(e)}validateData(e){const{status:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new R;if(t!==j.OPEN)throw new Ht}async createMatchAsync(e){const{opponentId:t}=e.customData;return t?this.match.api.getMatchAPI().createMatchAsync(t):{}}updateMatchState(e,t){const{customData:s}=e,{_id:n,whitePlayerId:i,blackPlayerId:r,whitePlayerFinish:c,blackPlayerFinish:l}=t,d=i===s.opponentId;e.id=n||null;const h=d?r:i,u=d?i:r;e.customData.playerId=h,e.customData.opponentId=u,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1});const g=d?l:c,y=d?c:l;e.profiles[h].finished=g,e.profiles[u].finished=y}};o(Zr,"CreateMatchHandler");let is=Zr;const to=class to extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesChallengeAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new st;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new R}async createWideframesChallengeAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0}=c,{photo:u,score:g=0}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:u,opponentScore:g,isPlayerFinished:!1,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesChallengeAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK))throw new S("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} challenges you`,localizations:{vi_VN:`${l} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.updateAsync(d)}};o(to,"SendChallengeMessageHandler");let rs=to;const eo=class eo extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,n=new C(this),i=new ea(this,{opponentId:s});n.setNext(i);const r=new k(this,{mode:J.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});i.setNext(r);const c=new is(this);r.setNext(c);const l=new ft(this);c.setNext(l);const d=new K(this);l.setNext(d);const h=new z(this);d.setNext(h);const u=new rs(this);h.setNext(u);const g=new _(this);u.setNext(g);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};o(eo,"ChallengeFriendConcrete");let sa=eo;const so=class so extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}};o(so,"SameContext");let le=so;const{Utils:Ol}=p,no=class no extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",n=GameSDK.context.getID();if(n===t)throw new le;if(s&&n===null)throw new le}async switchAsync(t){const s=t==="SOLO";try{this.checkSameContext(t),await GameSDK.context.switchAsync(t,s)}catch(n){if(n instanceof le)return;if(!Ol.Object.hasOwn(n,"code"))throw n;if(Ol.Device.isAndroid()&&s&&n.code==="INVALID_PARAM")return;if(n.code!=="SAME_CONTEXT")throw n}}};o(no,"SwitchContextHandler");let qt=no;const{Dtos:my}=p,ao=class ao extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new my.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validateOpponentTurn(e),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new st;if(s!==j.OPEN)throw new Ht}validateContinueMatchData(e,t){const{id:s,customData:n}=e,{_id:i,whitePlayerId:r,blackPlayerId:c}=t;if(typeof i!="string"||i!==s)throw console.warn("🤖 ? respMatchDataValidated",t),new we;const{playerId:l}=n,d=r===l,h=c===l;if(!d&&c===dt.playerId)throw new pe;if(!d&&!h)throw new Ae}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new R;const{finished:i}=t[n];if(i)throw new ns}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(i)throw new qe}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,g=h?i:n;e.customData.playerId=u,e.customData.opponentId=g,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[g].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[g].finished=m}};o(ao,"ContinueMatchHandler");let na=ao;const io=class io extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesCurrentScoreAsync();t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new st;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new R}async createWideframesCurrentScoreAsync(){try{const{player:e,frameCapture:t}=this.game,{playerId:s,photo:n}=e.getPlayer(),{profiles:i}=this.match.getMatchState(),{score:r=0}=i[s]||{};return await t.wideframe.renderShareScore({playerId:s,playerPhoto:n,playerScore:r})}catch(e){return console.warn("createWideframesCurrentScoreAsync",e),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK))throw new S("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} made an update.`,localizations:{vi_VN:`${l} đã cập nhật trận đấu. Chơi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(d)}};o(io,"SendUpdateMessageHandler");let aa=io;const ro=class ro extends P{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:n,opponentId:i}=e,r=new C(this),c=new qt(this,{contextId:t});r.setNext(c);const l=new k(this,{id:s,mode:J.CHALLENGE_FRIEND,customData:{playerId:n,opponentId:i}});c.setNext(l);const d=new na(this);l.setNext(d);const h=new ft(this);d.setNext(h);const u=new K(this);h.setNext(u);const g=new aa(this);u.setNext(g);const y=new z(this);g.setNext(y);const w=new _(this);y.setNext(w);const A=this.match.getMatchState();await r.processAsync(A)}finally{this.endLog()}}};o(ro,"ContinueChallengeMatchConcrete");let ia=ro;const{Plugins:wy,Utils:Ay}=p,{Analytics:Iy}=wy,{String:by,Valid:Ml}=Ay,oo=class oo extends I{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:n,finishAt:i}=e,{level:r}=t;this.validateMode(s),this.validateLevel(r);const{analytics:c}=this.game,l=Math.floor((i-n)/1e3);c.event(Iy.Events.MATCH_END,{level:r,game_mode:by.toUpperCamelCase(s),level_name:`level_${r}`,time_played:l}),await this.nextAsync(e)}validateMode(e){if(!Ml.isString(e))throw new me}validateLevel(e){if(!Ml.isNumber(e))throw new es}};o(oo,"LogMatchFinishedHandler");let $t=oo;const co=class co extends Error{constructor(e){super(e),this.name="ScoreNotValid",this.message=e??"Score is not valid"}};o(co,"ScoreNotValid");let Yt=co;const lo=class lo extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}};o(lo,"LeaderboardIdNotValid");let Ft=lo;const ho=class ho extends Error{constructor(e){super(e),this.name="LeaderboardNotExist",this.message=e??"Leaderboard not exist in game"}};o(ho,"LeaderboardNotExist");let ra=ho;const{Valid:Rl}=p.Utils,uo=class uo extends I{constructor(t,s){super(t);f(this,"payload");f(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.setupSetScorePayload(t),this.setLeaderboardScoreAsync(),await this.nextAsync(t)}async setupSetScorePayload(t){const{profiles:s,customData:n}=t,{playerId:i}=n;if(!i||!s[i])throw new W;const{score:r,leaderboardId:c}=this.payload;if(!Rl.isNumber(r))throw new Yt;if(!Rl.isString(c))throw new Ft;this.leaderboardPayload={score:r,playerId:i,leaderboardId:c}}async setLeaderboardScoreAsync(){try{const{playerId:t,score:s,leaderboardId:n}=this.leaderboardPayload,i=this.game.leaderboard.getLeaderboardName(n);if(!i)throw new ra;await this.game.leaderboard.setLeaderboardScoreAsync(i,t,s)}catch(t){console.warn("setLeaderboardScoreAsync",t)}}};o(uo,"SetLeaderboardScoreHandler");let Xt=uo;const{Valid:Ey}=p.Utils,{Leaderboards:Dy}=p.Configs,fo=class fo extends Xt{constructor(e){super(e,{score:0,leaderboardId:Dy.LeaderboardId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new W;const{score:i}=t[n];if(!Ey.isNumber(i))throw new Yt;this.payload.score=i,super.setupSetScorePayload(e)}};o(fo,"PostGlobalLeaderboardScoreHandler");let be=fo;const{Dtos:vy,Utils:Sy}=p,{Valid:ke,Object:Py}=Sy,po=class po extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateMatchData(t);const{useAPI:s}=this.payload;if(s){const n=await this.finishMatchAsync(t),i=new vy.Match.Data(n).toObject();this.updateMatchFromAPI(t,i)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}validateMatchData(t){const{status:s,profiles:n,customData:i}=t;if(s!==j.ACTIVE)throw new ss;const{playerId:r}=i;if(!r||!Py.hasOwn(n,r))throw new Ae}updateMatchData(t){const{playerId:s}=t.customData;if(!ke.isString(s))throw new D;t.profiles[s].finished=!0}updateMatchState(t){t.status=j.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:n,customData:i}=t,{level:r,playerId:c}=i;if(!ke.isString(c))throw new D;const{score:l}=n[c],{extraData:d}=this.payload,h={matchId:s??"",score:l,level:r,extraData:d};return this.match.api.getMatchAPI().finishMatchAsync(h)}updateMatchFromAPI(t,s){const{playerId:n,opponentId:i}=t.customData;if(!ke.isString(n))throw new D;if(!ke.isString(i))throw new R;const{whitePlayerId:r,whitePlayerScore:c,blackPlayerScore:l,whitePlayerFinish:d,blackPlayerFinish:h}=s,u=n===r,g=u?c:l,y=u?l:c,w=u?d:h,A=u?h:d;t.profiles[n].score=g,t.profiles[i].score=y,t.profiles[n].finished=w,t.profiles[i].finished=A}};o(po,"FinishMatchHandler");let kt=po;const go=class go extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync(e);t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new st;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new R}async createWideframesResultAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c,{photo:g,score:y=0,finished:w}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:g,opponentScore:y,isPlayerFinished:!!u,isOpponentFinished:!!w})}catch(t){return console.warn("createWideframesResultAsync",t),null}}progressSendFinishedMessage(e,t){const{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;if(!r||typeof r!="string")throw new R;const{score:c=0,finished:l}=s[i],{score:d=0,finished:h}=s[r];l?this.sendFinishMessageAsync(e,t):h&&c>d?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK))throw new S("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:j.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${l} just finished. Check them now.`,localizations:{vi_VN:`${l} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(d)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;const{name:l,score:d}=n[r],h={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:j.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} got ${d} scores. So easy! Can you?`,localizations:{vi_VN:`${l} đã đạt ${d} điểm! Nhấn Chơi để so tài!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(h)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;const{name:l,score:d}=n[r],h={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:j.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${l} beat your high score. Their score: ${d}`,localizations:{vi_VN:`${l} đã vượt qua điểm số của bạn, với ${d} điểm!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(h)}};o(go,"SendFinishedMessageHandler");let oa=go;const yo=class yo extends I{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new W;const{player:i}=this.game,r=i.getBestScore()||0,{score:c=0}=t[n];c<=r||(i.setBestScore(c),t[n].bestScore=c)}};o(yo,"SetPlayerBestScoreHandler");let Jt=yo;const mo=class mo extends P{async processAsync(e){try{this.startLog(e);const{extraData:t}=e??{},s=new C(this),n=new kt(this,{useAPI:!0,extraData:t});s.setNext(n);const i=new oa(this);n.setNext(i);const r=new $t(this);i.setNext(r);const c=new Jt(this);r.setNext(c);const l=new be(this);c.setNext(l);const d=new _(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(mo,"FinishChallengeMatchConcrete");let ca=mo;const wo=class wo extends Error{constructor(e){super(e),this.name="ContextAreSolo",this.message=e??"Context are solo"}};o(wo,"ContextAreSolo");let la=wo;const Ao=class Ao extends Error{constructor(e){super(e),this.name="OpponentNotJoinInContext",this.message=e??"Opponent is not join in context"}};o(Ao,"OpponentNotJoinInContext");let da=Ao;const Io=class Io extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}};o(Io,"NetworkFailure");let ha=Io;const{Utils:Cy,Dtos:Ty}=p,{Array:_y,Object:xy}=Cy,bo=class bo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new X;if(t==="SOLO")throw new la}async getOpponentIdFromContextAsync(){const{ignoreId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new da;let n=dt;return s.length===1&&(n=s[0]),n.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),n=[];return s.forEach(i=>{const r=i.getID();if(t.includes(r))return;const c=i.getName();if(!c)return;const l=i.getPhoto();n.push(new Ty.Player.Info({playerId:r,name:c,photo:l}).toObject())}),_y.unique(n)}catch(s){if(xy.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new ha;return[]}}};o(bo,"GetOpponentChallengeContextHandler");let ua=bo;const Eo=class Eo extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}};o(Eo,"ContextIsTournament");let Ee=Eo;const{Object:Ny}=p.Utils,Do=class Do extends I{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!Ny.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new Ie;return e}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new Ee):new S("getTournamentAsync")}catch(e){if(e instanceof Ee)throw e}}};o(Do,"ChooseContextHandler");let fa=Do;const vo=class vo extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new C(this),n=new fa(this);s.setNext(n);const i=new k(this,{mode:J.CHALLENGE_FRIEND,customData:{playerId:t}});n.setNext(i);const r=new ua(this,{ignoreId:t});i.setNext(r);const c=new is(this);r.setNext(c);const l=new ft(this);c.setNext(l);const d=new K(this);l.setNext(d);const h=new z(this);d.setNext(h);const u=new rs(this);h.setNext(u);const g=new _(this);u.setNext(g);const y=this.match.getMatchState();await s.processAsync(y)}finally{this.endLog()}}};o(vo,"InviteFriendsConcrete");let pa=vo;const So=class So extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}};o(So,"JoinMatchFailed");let ga=So;const Po=class Po extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}};o(Po,"MatchAreFinished");let ya=Po;const Co=class Co extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}};o(Co,"OtherPlayerHasJoinedMatch");let ma=Co;const{Dtos:Oy}=p,To=class To extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new Oy.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==j.OPEN)throw new Ht}validateJoinMatchData(e,t){const{id:s,customData:n}=e,{_id:i,blackPlayerId:r,whitePlayerId:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=r===n.playerId,u=c===n.opponentId;if(typeof i!="string"||i!==s||!u)throw console.warn("🤖 ? matchData",t),new ga;if(l&&d)throw new ya;if(!h)throw new ma}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,g=h?i:n;e.customData.playerId=u,e.customData.opponentId=g,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[g].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[g].finished=m}};o(To,"JoinMatchHandler");let wa=To;const _o=class _o extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAcceptedAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new st;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new R}async createWideframesAcceptedAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c;if(u)return null;const{photo:g,score:y=0,finished:w}=l;return w?await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:g,opponentScore:y,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch(t){return console.warn("createWideframesAcceptedAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK))throw new S("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} accepted the challenge.`,localizations:{vi_VN:`${l} đã chấp nhận tham gia trận đấu.`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.updateAsync(d)}};o(_o,"SendAcceptedMessageHandler");let Aa=_o;const xo=class xo extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new C(this),r=new k(this,{id:t,mode:J.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new wa(this);r.setNext(c);const l=new ft(this);c.setNext(l);const d=new K(this);l.setNext(d);const h=new Aa(this);d.setNext(h);const u=new z(this);h.setNext(u);const g=new _(this);u.setNext(g);const y=this.match.getMatchState();await i.processAsync(y)}finally{this.endLog()}}};o(xo,"JoinChallengeMatchConcrete");let Ia=xo;const{Valid:at}=p.Utils,it="is invalid",No=class No extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!at.isString(e)||!e)&&this.exception("_id",it)}validateMode(e){(!at.isString(e)||!e)&&this.exception("mode",it)}validateStatus(e){(!at.isString(e)||!e)&&this.exception("status",it)}validateWinnerId(e){(!at.isString(e)||!e)&&this.exception("winnerId",it)}validateWhitePlayerId(e){(!at.isString(e)||!e)&&this.exception("whitePlayerId",it)}validateBlackPlayerId(e){(!at.isString(e)||!e)&&this.exception("blackPlayerId",it)}validateWhitePlayerScore(e){at.isNumber(e)||this.exception("whitePlayerScore",it)}validateBlackPlayerScore(e){at.isNumber(e)||this.exception("blackPlayerScore",it)}validateWhitePlayerFinish(e){at.isBoolean(e)||this.exception("whitePlayerFinish",it)}validateBlackPlayerFinish(e){at.isBoolean(e)||this.exception("blackPlayerFinish",it)}toObject(){return super.toObject()}};o(No,"RespMatchDataDtos");let De=No;De.addDefaultData({_id:"",mode:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1});const Oo=class Oo extends Error{constructor(e){super(e),this.name="MatchAreNotFinished",this.message=e||"Match are not finished"}};o(Oo,"MatchAreNotFinished");let ba=Oo;const Mo=class Mo extends Error{constructor(e){super(e),this.name="OpponentNotFinishedMatch",this.message=e||"Opponent not finished match"}};o(Mo,"OpponentNotFinishedMatch");let Ea=Mo;const Ro=class Ro extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new De(t).toObject();this.validateResultMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new st}validateResultMatchData(e,t){const{id:s}=e,{_id:n,whitePlayerFinish:i,blackPlayerFinish:r}=t;if(typeof n!="string"||n!==s)throw new we;if(!i&&!r)throw new ba}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(!i)throw new as}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new R;const{finished:i}=t[n];if(!i)throw new Ea}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,g=h?i:n;e.customData.playerId=u,e.customData.opponentId=g,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!0}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!0});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[g].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[g].finished=m}};o(Ro,"ResultMatchHandler");let Da=Ro;const Lo=class Lo extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new C(this),r=new k(this,{id:t,mode:J.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new Da(this);r.setNext(c);const l=new ft(this);c.setNext(l);const d=new _(this);l.setNext(d);const h=this.match.getMatchState();await i.processAsync(h)}finally{this.endLog()}}};o(Lo,"ResultChallengeMatchConcrete");let va=Lo;const $o=class $o extends P{constructor(){super(...arguments);f(this,"fallbackSingleMode");f(this,"startFLowChallengeFriend",o(async t=>{try{return await this.match.challenge.invite.processAsync({playerId:t}),!0}catch(s){return s}},"startFLowChallengeFriend"));f(this,"startFlowTournament",o(async t=>{try{const s=GameSDK.context.getID();if(typeof s!="string")throw new X;await this.match.tournament.continue.processAsync({playerId:t,contextId:s})}catch{await this.startFlowSingle(t)}},"startFlowTournament"));f(this,"startFlowSingle",o(async t=>{if(!this.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");await this.match.single.start.processAsync({playerId:t})},"startFlowSingle"))}async processAsync(t){try{this.startLog(t);const{playerId:s,fallbackSingleMode:n}=t;this.fallbackSingleMode=n;const i=await this.startFLowChallengeFriend(s);if(i===!0)return;i instanceof Ee?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}};o($o,"ChooseContextConcrete");let Sa=$o;const{Valid:My}=p.Utils,{Leaderboards:Ry}=p.Configs,Fo=class Fo extends Xt{constructor(e){super(e,{score:0,leaderboardId:Ry.LeaderboardEndlessId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new W;const{endlessScore:i}=t[n];if(!My.isNumber(i))throw new Yt;this.payload.score=i,super.setupSetScorePayload(e)}};o(Fo,"PostGlobalLeaderboardEndlessScoreHandler");let Pa=Fo;const ko=class ko extends I{async processAsync(e){super.processAsync(e),this.setPlayerEndlessScore(e),await this.nextAsync(e)}setPlayerEndlessScore(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new W;const{player:i}=this.game,r=i.getBestEndlessScore()??0,{endlessScore:c=0}=t[n],l=r<c?c:r;i.setBestEndlessScore(l),t[n].bestEndlessScore=l}};o(ko,"SetPlayerEndlessScoreHandler");let Ca=ko;const Uo=class Uo extends P{async processAsync(){try{this.startLog();const e=new C(this),t=new kt(this,{useAPI:!1});e.setNext(t);const s=new $t(this);t.setNext(s);const n=new Ca(this);s.setNext(n);const i=new Pa(this);n.setNext(i);const r=new _(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};o(Uo,"FinishEndlessConcrete");let Ta=Uo;const Bo=class Bo extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}};o(Bo,"ProfileIdNotDefined");let _a=Bo;const{Dtos:Ly}=p,Vo=class Vo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new _a;const{player:n}=this.game,i=n.getPlayerId();let r;if(s===i)r=this.getPlayerProfile();else if(r=await this.getProfileAsync(s),!r)throw new W;this.updateMatchData(r,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:n,photo:i,locale:r}=t.getPlayer();return{playerId:s,name:n,photo:i,locale:r}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:n,name:i,photo:r}=t,c=new Ly.Match.Profile({id:n,name:i,photo:r}).toObject();s.profiles[n]=c}};o(Vo,"GetProfileHandler");let Dt=Vo;const Go=class Go extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new C(this),n=new qt(this,{contextId:"SOLO"});s.setNext(n);const i=new k(this,{id:"234567",mode:J.ENDLESS,customData:{playerId:t}});n.setNext(i);const r=new K(this);i.setNext(r);const c=new Dt(this,{profileId:t});r.setNext(c);const l=new z(this);c.setNext(l);const d=new _(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(Go,"StartEndlessConcrete");let xa=Go;const{Valid:$y}=p.Utils,jo=class jo extends Xt{constructor(e){super(e,{score:0,leaderboardId:""})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n,leaderboardId:i}=s;if(!i)throw new Ft;if(!n||!t[n])throw new W;const{score:r}=t[n];if(!$y.isNumber(r))throw new Yt;this.payload.score=r,this.payload.leaderboardId=i,super.setupSetScorePayload(e)}};o(jo,"PostLeaderboardScoreHandler");let ve=jo;const zo=class zo extends I{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new st;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new R}async createWideframesResultGroupAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0}=c,{photo:u,score:g=0}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:u,opponentScore:g,isPlayerFinished:!0,isOpponentFinished:!0})}catch(t){return console.warn("createWideframesResultGroupAsync",t),null}}async createWideframesBestScoreAsync(e){try{const{player:t,frameCapture:s}=this.game,{playerId:n}=e.customData,{playerId:i,photo:r,data:c}=t.getPlayer();if(n!==i)return null;const{score:l}=c||{};return await s.wideframe.renderShareScore({playerId:i,playerPhoto:r,playerScore:l})}catch(t){return console.warn("createWideframesBestScoreAsync",t),null}}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:n,opponentId:i}=s;if(i&&typeof i=="string"){if(!n||typeof n!="string")throw new D;const{score:c=0}=t[n]||{},{score:l=0}=t[i]||{};if(c>l){const d=await this.createWideframesResultGroupAsync(e);if(!d)return;this.sendBestScoreMessageAsync(e,d);return}}const r=await this.createWideframesBestScoreAsync(e);r&&this.sendChallengeMessageAsync(e,r)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:n}=e,{playerId:i}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK))throw new S("updateAsync");const{name:r,score:c}=s[i],d={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:i,playerName:r,playerScore:c},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:`${r} beats your high score. Their score: ${c}.`,localizations:{vi_VN:`${r} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(d)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:n}=e,{playerId:i}=n;if(!i||typeof i!="string")throw new D;const{name:r,score:c}=s[i],d={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:i,playerName:r,playerScore:c},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${r} got ${c} scores. So easy! Can you?`,localizations:{vi_VN:`${r} đã đạt ${c} điểm! Quá dễ luôn. Chơi lại nào!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK))throw new S("updateAsync");await GameSDK.updateAsync(d)}};o(zo,"SendGroupMessageHandler");let Na=zo;const Ko=class Ko extends P{async processAsync(){try{this.startLog();const e=new C(this),t=new kt(this,{useAPI:!1});e.setNext(t);const s=new Na(this);t.setNext(s);const n=new $t(this);s.setNext(n);const i=new Jt(this);n.setNext(i);const r=new ve(this);i.setNext(r);const c=new _(this);r.setNext(c);const l=this.match.getMatchState();await e.processAsync(l)}finally{this.endLog()}}};o(Ko,"FinishGroupConcrete");let Oa=Ko;const{Dtos:Fy}=p,Wo=class Wo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:n}=t;if(!n[s])throw new W;const i={...n[s],...this.payload},r=new Fy.Match.Profile(i).toObject();n[r.id]=r}};o(Wo,"SetProfileDataHandler");let Qt=Wo;const Ho=class Ho extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:n}=e,i=new C(this),r=new k(this,{id:"7749",mode:J.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});i.setNext(r);const c=new ft(this);r.setNext(c);const l=new Qt(this,{id:t,score:n});c.setNext(l);const d=new K(this);l.setNext(d);const h=new z(this);d.setNext(h);const u=new _(this);h.setNext(u);const g=this.match.getMatchState();await i.processAsync(g)}finally{this.endLog()}}};o(Ho,"JoinGroupConcrete");let Ma=Ho;const qo=class qo extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}};o(qo,"MatchGroupNotSupported");let os=qo;const{String:ky}=p.Utils,Yo=class Yo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=this.getMatchTag(),n=await this.matchingGroup(s);t.customData.contextId=n,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new S("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK))throw new S("checkCanPlayerMatchAsync");if(!GameSDK.getSupportedAPIs().includes("checkCanPlayerMatchAsync"))throw new os;if(!await GameSDK.checkCanPlayerMatchAsync())throw new os}getMatchTag(){const{locale:t}=this.payload;let s="global";if(t){const n=ky.getLanguageCode(t);n==="en"&&(s="en"),n==="in"&&(s="in")}return s}async matchingGroup(t){if(!("matchPlayerAsync"in GameSDK))throw new S("matchPlayerAsync");await GameSDK.matchPlayerAsync(t,!0,!0);const s=GameSDK.context.getID();if(typeof s!="string")throw new Ie;return s}};o(Yo,"GroupContextHandler");let Ra=Yo;const Xo=class Xo extends P{async processAsync(e){try{this.startLog(e);const{locale:t,playerId:s}=e,n=new C(this),i=new Ra(this,{locale:t});n.setNext(i);const r=new k(this,{id:"7749",mode:J.MATCHING_GROUP,customData:{playerId:s}});i.setNext(r);const c=new K(this);r.setNext(c);const l=new Dt(this,{profileId:s});c.setNext(l);const d=new z(this);l.setNext(d);const h=new _(this);d.setNext(h);const u=this.match.getMatchState();await n.processAsync(u)}finally{this.endLog()}}};o(Xo,"StartGroupConcrete");let La=Xo;const Jo=class Jo extends P{async processAsync(){try{this.startLog();const e=new C(this),t=new kt(this,{useAPI:!1});e.setNext(t);const s=new $t(this);t.setNext(s);const n=new Jt(this);s.setNext(n);const i=new be(this);n.setNext(i);const r=new _(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};o(Jo,"FinishSingleConcrete");let $a=Jo;const Qo=class Qo extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new C(this),n=new qt(this,{contextId:"SOLO"});s.setNext(n);const i=new k(this,{id:"123456",mode:J.SINGLE,customData:{playerId:t}});n.setNext(i);const r=new K(this);i.setNext(r);const c=new Dt(this,{profileId:t});r.setNext(c);const l=new z(this);c.setNext(l);const d=new _(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(Qo,"StartSingleConcrete");let Fa=Qo;const{Plugins:Uy,Utils:By}=p,{Analytics:Vy}=Uy,{String:Gy,Valid:jy}=By,Zo=class Zo extends I{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e;this.validateMode(t);const{analytics:n}=this.game,{tournamentId:i,leaderboardId:r}=s;n.event(Vy.Events.TOURNAMENT_START,{success:!0,game_mode:Gy.toUpperCamelCase(t),tournament_id:i,leaderboard_id:r}),await this.nextAsync(e)}validateMode(e){if(!jy.isString(e))throw new me}};o(Zo,"LogTournamentStartHandler");let cs=Zo;const tc=class tc extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}};o(tc,"TournamentIdNotValid");let ls=tc;const{Valid:Hs}=p.Utils,ec=class ec extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s);const n=await GameSDK.getTournamentAsync(),i=n.getID().toString();this.validateTournamentId(i);const r=JSON.parse(n.getPayload()||"{}"),{leaderboardId:c}=r;this.validateLeaderboardId(c),t.customData.contextId=s,t.customData.tournamentId=i,t.customData.leaderboardId=c,await this.nextAsync(t)}validateContextId(t){if(!Hs.isString(t))throw new X}validateTournamentId(t){if(!Hs.isString(t))throw new ls}validateLeaderboardId(t){if(!Hs.isString(t)||t==="")throw new Ft}};o(ec,"ContinueTournamentHandler");let ka=ec;const sc=class sc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,n=new C(this),i=new ka(this,{contextId:s});n.setNext(i);const r=new k(this,{id:"1997",mode:J.TOURNAMENT,customData:{playerId:t}});i.setNext(r);const c=new K(this);r.setNext(c);const l=new Dt(this,{profileId:t});c.setNext(l);const d=new z(this);l.setNext(d);const h=new cs(this);d.setNext(h);const u=new _(this);d.setNext(u);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}};o(sc,"ContinueTournamentConcrete");let Ua=sc;const{Plugins:zy}=p,{Analytics:Ky}=zy,nc=class nc extends I{async processAsync(e){super.processAsync(e);const{customData:t}=e,{analytics:s}=this.game,{tournamentId:n,leaderboardId:i}=t;s.event(Ky.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:n,leaderboard_id:i}),await this.nextAsync(e)}};o(nc,"LogTournamentCreateHandler");let Ba=nc;const ac=class ac extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.createTournamentAsync(),await this.updateMatchStateAsync(t),await this.nextAsync(t)}async createTournamentAsync(){const{name:t,score:s,customData:n}=this.payload;await GameSDK.tournament.createAsync({initialScore:s,config:{title:t,tournamentTitle:t},data:n})}async updateMatchStateAsync(t){try{if(!("getTournamentAsync"in GameSDK))throw new S("getTournamentAsync");const s=await GameSDK.getTournamentAsync(),n=s.getContextID(),i=s.getID().toString(),{playerId:r}=this.payload;t.customData.playerId=r,t.customData.contextId=n,t.customData.tournamentId=i}catch(s){if(s instanceof S)return}}};o(ac,"CreateTournamentHandler");let Va=ac;const{Valid:Ll}=p.Utils,ic=class ic extends I{constructor(t,s){super(t);f(this,"payload");f(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.validatePayload(),await this.setupCreatePayload(t),await this.createLeaderboardAsync(t),await this.nextAsync(t)}validatePayload(){const{leaderboardId:t}=this.payload;if(!Ll.isString(t))throw new Ft}validatePlayerId(t){if(!Ll.isString(t))throw new D}async setupCreatePayload(t){const{playerId:s}=t.customData;this.validatePlayerId(s);const{name:n,leaderboardId:i,customData:r}=this.payload;this.leaderboardPayload={_id:i,name:n??"",createdBy:s,description:JSON.stringify(r)}}async createLeaderboardAsync(t){const s=await this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload);t.customData.leaderboardId=s}};o(ic,"CreateLeaderboardHandler");let Ga=ic;const rc=class rc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,name:s,score:n,leaderboardId:i,payload:r}=e,c=new C(this),l=new qt(this,{contextId:"SOLO"});c.setNext(l);const d=new Va(this,{name:s,score:n,playerId:t,customData:r});l.setNext(d);const h=new Dt(this,{profileId:t});d.setNext(h);const u=new Qt(this,{id:t,score:n});h.setNext(u);const g=new Ga(this,{name:s,customData:r,leaderboardId:i});u.setNext(g);const y=new ve(this);g.setNext(y);const w=new Ba(this);y.setNext(w);const A=this.match.getMatchState();await c.processAsync(A)}finally{this.endLog()}}};o(rc,"CreateTournamentConcrete");let ja=rc;const{Analytics:$l}=p.Plugins,{Valid:Wy}=p.Utils,oc=class oc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),await this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:n}=t,{playerId:i}=n;if(this.validatePlayerId(i),!s[i])throw new W}validatePlayerId(t){if(!Wy.isString(t))throw new D}getPlayerProfile(t){const{profiles:s,customData:n}=t,{playerId:i}=n;return this.validatePlayerId(i),s[i]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:n=0,bestScore:i=0}=s;return n>i}async postScoreTournamentAsync(t){const{analytics:s}=window.game,n=this.getPlayerProfile(t),{score:i=0}=n;let r=null,c=!1;const{checkBestScore:l}=this.payload,d=this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new S("getTournamentAsync");await GameSDK.getTournamentAsync(),!l||d?(r=$l.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:i})):(r=$l.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(i)),c=!0}catch(h){console.warn("Post Score Tournament",h)}finally{r&&s.event(r,{success:c})}}};o(oc,"PostScoreTournamentHandler");let za=oc;const cc=class cc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,bestScore:s}=e,n=new C(this),i=new kt(this,{useAPI:!1});n.setNext(i);const r=new Qt(this,{id:t,bestScore:s});i.setNext(r);const c=new za(this,{checkBestScore:!1});r.setNext(c);const l=new $t(this);c.setNext(l);const d=new Jt(this);l.setNext(d);const h=new ve(this);d.setNext(h);const u=new be(this);h.setNext(u);const g=new _(this);u.setNext(g);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};o(cc,"FinishTournamentConcrete");let Ka=cc;const{Valid:qs,Object:Hy}=p.Utils,lc=class lc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const n=await GameSDK.getTournamentAsync(),i=n.getContextID();this.validateContextId(i);const r=JSON.parse(n.getPayload()||"{}"),{leaderboardId:c}=r;this.validateLeaderboardId(c),t.customData.contextId=i,t.customData.tournamentId=s,t.customData.leaderboardId=c,await this.nextAsync(t)}validateTournamentId(t){if(!qs.isString(t))throw new ls}validateContextId(t){if(!qs.isString(t))throw new X}validateLeaderboardId(t){if(!qs.isString(t)||t==="")throw new Ft}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new S("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!Hy.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}};o(lc,"JoinTournamentHandler");let Wa=lc;const dc=class dc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,n=new C(this),i=new Wa(this,{tournamentId:s});n.setNext(i);const r=new k(this,{id:"1997",mode:J.TOURNAMENT,customData:{playerId:t}});i.setNext(r);const c=new K(this);r.setNext(c);const l=new Dt(this,{profileId:t});c.setNext(l);const d=new z(this);l.setNext(d);const h=new cs(this);d.setNext(h);const u=new _(this);h.setNext(u);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}};o(dc,"JoinTournamentConcrete");let Ha=dc;const{Dtos:qy,Utils:Yy}=p,{Object:Xy}=Yy,hc=class hc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateMatchCustomData(t),await this.nextAsync(t)}updateMatchCustomData(t){const s=Xy.merge(t.customData,this.payload),n=new qy.Match.CustomData(s).toObject();t.customData=n}};o(hc,"SetMatchCustomDataHandler");let qa=hc;const Jy={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...Si}},{Configs:Fl}=p,uc=class uc extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"base");f(this,"group");f(this,"single");f(this,"endless");f(this,"context");f(this,"challenge");f(this,"tournament");f(this,"api");f(this,"handler");f(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",Jy)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createBaseConcrete(){this.base=new P(this.game,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:async t=>{const s=new Qt(this.base,t);await this.processHandlerAsync(s)},setMatchCustomData:async t=>{const s=new qa(this.base,t);await this.processHandlerAsync(s)},setLeaderboardScore:async t=>{const s=new Xt(this.base,t);await this.processHandlerAsync(s)}}}createAPIHandler(){const t={appId:Fl.AppId,matchAPIHost:Fl.ApiHost};this.api=new Jn(t)}createGroupFlows(){this.group={join:new Ma(this.game,this),start:new La(this.game,this),finish:new Oa(this.game,this)}}createSingleFlows(){this.single={start:new Fa(this.game,this),finish:new $a(this.game,this)}}createEndlessFlows(){this.endless={start:new xa(this.game,this),finish:new Ta(this.game,this)}}createContextFlows(){this.context={choose:new Sa(this.game,this)}}createChallengeFlows(){this.challenge={invite:new pa(this.game,this),friend:new sa(this.game,this),join:new Ia(this.game,this),await:new ta(this.game,this),result:new va(this.game,this),finish:new ca(this.game,this),continue:new ia(this.game,this)}}createTournamentFlows(){this.tournament={join:new Ha(this.game,this),create:new ja(this.game,this),finish:new Ka(this.game,this),continue:new Ua(this.game,this)}}processHandlerAsync(t){const s=this.getMatchState();return t.processAsync(s)}};o(uc,"MatchPlugin");let Ya=uc;const{Valid:vt}=p.Utils,St="is invalid",fc=class fc extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!vt.isNumber(e)||!e)&&this.exception("level",St)}validateRescued(e){(!vt.isNumber(e)||e<0)&&this.exception("rescued",St)}validateContextId(e){vt.isString(e)||this.exception("contextId",St)}validatePlayerId(e){vt.isString(e)||this.exception("playerId",St)}validateOpponentId(e){vt.isString(e)||this.exception("opponentId",St)}validateTournamentId(e){vt.isString(e)||this.exception("tournamentId",St)}validateLeaderboardId(e){vt.isString(e)||this.exception("leaderboardId",St)}toObject(){return super.toObject()}};o(fc,"MatchCustomDataDtos");let ds=fc;ds.addDefaultData(Si);const{Valid:gt}=p.Utils,yt="is invalid",pc=class pc extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!gt.isString(e)||!e)&&this.exception("id",yt)}validateName(e){(!gt.isString(e)||!e)&&this.exception("name",yt)}validatePhoto(e){gt.isString(e)||this.exception("photo",yt)}validateScore(e){(!gt.isNumber(e)||e<0)&&this.exception("score",yt)}validateBestScore(e){(!gt.isNumber(e)||e<0)&&this.exception("bestScore",yt)}validateEndlessScore(e){(!gt.isNumber(e)||e<0)&&this.exception("endlessScore",yt)}validateBestEndlessScore(e){(!gt.isNumber(e)||e<0)&&this.exception("bestEndlessScore",yt)}validateFinished(e){gt.isBoolean(e)||this.exception("finished",yt)}toObject(){return super.toObject()}};o(pc,"MatchProfileDtos");let hs=pc;hs.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0});p.Dtos.Match={Data:De,CustomData:ds,Profile:hs};const{Utils:Qy}=p,{ApiHost:Zy}=p.Configs,tm=o(async a=>{const e=await B("players",a,{},Zy,10);return Qy.Object.hasOwn(e,"data")?e.data||{}:{}},"updatePlayerProfileAsync"),{Utils:em,Configs:sm}=p,{AppId:nm}=sm,gc=class gc extends N.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",Re)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch(e){console.warn(e)}}receiveData(e,t){const{storage:s}=this.game,{playerId:n,name:i,photo:r,locale:c}=e;s.setStorageData("player","playerId",n),s.setStorageData("player","name",i),s.setStorageData("player","photo",r),s.setStorageData("player","locale",c),t&&this.setPlayerData(t)}async syncProfileToServer(){const e=this.getPlayer(),{ASID:t,playerId:s,name:n,photo:i,locale:r}=e;await tm({appId:nm,ASID:t,playerId:s,name:n,photo:i,locale:r})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=em.Object.merge(t,e);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(r=>{const c=r.getID(),l=r.getName(),d=r.getPhoto();return!c||!l||!d?null:new Kt({playerId:c,name:l,photo:d}).toObject()}),n=p.Utils.Array.unique(s);if(n.length<1)return;const i=p.Utils.Object.keyBy(n,"playerId");e.setStorageData("player","connectedPlayers",i)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerLocale(){const{storage:e}=this.game;return e.getStorageData("player","locale")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return p.Utils.Object.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return p.Utils.Object.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??!0}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:e}=this.getPlayerData();return e}getBestEndlessScore(){const{endlessScore:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,t+e)}};o(gc,"PlayerPlugin");let Xa=gc;const{Dtos:kl,Utils:am}=p,{Valid:Bt}=am,{score:Qd,endlessScore:im,settings:rm,gameData:om,isFirstLogin:cm,dailyRewarded:lm}=Re.data,Vt="is invalid",yc=class yc extends F{processData(e){this.validateStructure(e),e.settings=new kl.Player.Settings(e.settings).toObject(),e.gameData=new kl.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!Bt.isNumber(e)||e<0)&&this.exception("score",Vt)}validateEndlessScore(e){(!Bt.isNumber(e)||Qd<0)&&this.exception("endlessScore",Vt)}validateSettings(e){Bt.isObject(e)||this.exception("settings",Vt)}validateGameData(e){Bt.isObject(e)||this.exception("gameData",Vt)}validateIsFirstLogin(e){Bt.isBoolean(e)||this.exception("isFirstLogin",Vt)}validateDailyRewarded(e){Bt.isObject(e)||this.exception("dailyRewarded",Vt)}toObject(){return super.toObject()}};o(yc,"PlayerDataDtos");let us=yc;us.addDefaultData({score:Qd,endlessScore:im,settings:rm,gameData:om,isFirstLogin:cm,dailyRewarded:lm});const{Valid:Ul}=p.Utils,{level:dm,coins:hm}=Re.data.gameData,mc=class mc extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!Ul.isNumber(e)||e<1)&&this.exception("level","is invalid")}validateCoins(e){(!Ul.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}};o(mc,"PlayerGameDataDtos");let fs=mc;fs.addDefaultData({level:dm,coins:hm});const{Valid:Ue}=p.Utils,{sound:um,music:fm,vibrate:pm,language:gm}=Re.data.settings,Be="is invalid",wc=class wc extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){Ue.isBoolean(e)||this.exception("sound",Be)}validateMusic(e){Ue.isBoolean(e)||this.exception("music",Be)}validateVibrate(e){Ue.isBoolean(e)||this.exception("vibrate",Be)}validateLanguage(e){(!Ue.isString(e)||!e)&&this.exception("language",Be)}toObject(){return super.toObject()}};o(wc,"PlayerSettingsDtos");let ps=wc;ps.addDefaultData({sound:um,music:fm,vibrate:pm,language:gm});p.Dtos.Player={Info:Kt,Data:us,Settings:ps,GameData:fs};const{Configs:ym,Utils:mm}=p,{Object:wm,String:Am}=mm,{ApiHost:Im,Mockup:bm}=ym,Ac=class Ac{constructor(){f(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await lt(()=>import("./bundle/empty-script.js"),__vite__mapDeps([]),import.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new e}async getPlayersAsync(e){const t=Am.params(e);let s;return bm.Profile.Enabled?(await this.initMockAPI(),s=await this.mockAPI.getPlayersAsync(e)):s=await jt(`players?${t}`,{},Im),!wm.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data}};o(Ac,"ProfileAPI");let Ja=Ac;const Em={profiles:{},profileIds:[]},{Utils:Dm,Dtos:vm}=p,{Array:Sm,Valid:Pm,Object:Cm}=Dm,Ic=class Ic extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"profileAPI",new Ja)}init(){const{storage:t}=this.game;t.addStorage("profile",Em)}async requestProfiles(t){const s=this.getProfileIds(),n=Sm.difference(t,s);if(n.length<1)return;const i=await this.profileAPI.getPlayersAsync({playerIds:n});if(!this.validateProfilesResponse(i))return;const r=this.convertToProfiles(i);this.setProfiles(r)}getProfile(t){return this.getProfiles()[t]??null}getProfiles(){const{storage:t}=this.game;return t.getStorageData("profile","profiles")}setProfiles(t){const{storage:s}=this.game;s.setStorageData("profile","profiles",t),s.setStorageData("profile","profileIds",Object.keys(t))}getProfileIds(){const{storage:t}=this.game;return t.getStorageData("profile","profileIds")}validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}convertToProfiles(t){const s={};return t.forEach(n=>{Cm.hasOwn(n,"playerId")&&Pm.isString(n.playerId)&&(s[n.playerId]=new vm.Player.Info(n).toObject())}),s}};o(Ic,"ProfilePlugin");let Qa=Ic;const{Valid:Ve,Object:Bl}=p.Utils,{Ads:Zd,Gameplay:th}=p.Configs,Ge="is invalid",bc=class bc extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateAds(e){Ve.isObject(e)||this.exception("ads",Ge),this.validateCommonData(e,Zd)}validateGameplay(e){Ve.isObject(e)||this.exception("gameplay",Ge),this.validateCommonData(e,th)}validateCommonData(e,t){Object.keys(e).forEach(s=>{if(!Bl.hasOwn(e,s))return;Bl.hasOwn(t,s)||this.exception(`the "${s}" key`,Ge);const n=e[s],i=t[s];typeof n!=typeof i&&this.exception("value",Ge),Ve.isObject(n)&&Ve.isObject(i)&&this.validateCommonData(n,i)})}toObject(){return super.toObject()}};o(bc,"GameCoreConfigDtos");let Se=bc;Se.addDefaultData({Ads:Zd,Gameplay:th});const{Valid:je,Object:Tm}=p.Utils,Ec=class Ec extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){}validateData(e){this.validateCommonData(e)}validateCommonData(e,t=!0){Object.keys(e).forEach(s=>{if(!Tm.hasOwn(e,s))return;const n=e[s];!je.isBoolean(n)&&!je.isNumber(n)&&!je.isString(n)&&this.exception("value","is invalid"),je.isObject(n)&&this.validateCommonData(n,!1),t&&Object.assign(this,{[s]:n})})}toObject(){return super.toObject()}};o(Ec,"GamePlayConfigDtos");let Pe=Ec;Pe.addDefaultData({});const{Valid:Gt,Object:Vl}=p.Utils,Pt="is invalid",Dc=class Dc extends F{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Gt.isString(e)||!e)&&this.exception("id",Pt);const{remoteConfig:t}=window.game;return t.isRemoteConfigId(e)}validateType(e){(!Gt.isString(e)||!e)&&this.exception("type",Pt),["GameCore","Gameplay"].includes(e)||this.exception("type",Pt)}validateInfo(e){(!Gt.isObject(e)||!e)&&this.exception("info",Pt),(!Vl.hasOwn(e,"version")||!Gt.isString(e.version)||!e.version)&&this.exception("info.version",Pt),(!Vl.hasOwn(e,"createdAt")||!Gt.isString(e.createdAt)||!e.createdAt)&&this.exception("info.createdAt",Pt)}validateConfig(e){Gt.isObject(e)||this.exception("config",Pt)}toObject(){return super.toObject()}};o(Dc,"RemoteConfigDataDtos");let Ce=Dc;Ce.addDefaultData({id:"default",type:"GameCore",info:{version:"1.0.0",priority:100,createdAt:"unknown"},config:{}});const vc=class vc{constructor(e){f(this,"game");f(this,"plugin");f(this,"data");this.plugin=e,this.game=e.game,this.data=[]}getConfigById(e){return this.data.filter(s=>s.id===e)[0]}getConfigByVersion(e){return this.data.filter(s=>s.info.version===e)[0]}getConfigByLatestVersion(){return this.data.sort((t,s)=>t.info.createdAt.localeCompare(s.info.createdAt))[0]}getConfigByPriority(e){return this.data.filter(s=>s.info.priority<=e)[0]}};o(vc,"BaseHandler");let Te=vc;const{Valid:ze}=p.Utils,Sc=class Sc extends Te{constructor(t){super(t);f(this,"firebaseRemoteConfig");this.initialize()}initialize(){const{services:t}=this.game.firebase;if(!t.remoteConfig)throw new Error("FirebaseHandler: Firebase Remote Config is not initialized");this.firebaseRemoteConfig=t.remoteConfig}async fetchConfig(t){await this.firebaseRemoteConfig.fetchDataAsync();const s=this.getConfig(t);if(!s)throw new Error("FirebaseHandler: Parse data failed");return s}getConfig(t){const{id:s,type:n,conditions:i}=t;let r=null;if(this.data=[],r=this.getResultByType(n),console.log("Get config from remote",r),!r)return null;const{data:c}=r;if(!c||c.length===0)return null;if(this.data=c,s)return this.getConfigById(s);let l=null;return ze.isObject(i)&&(l=this.getConfigByConditions(i)),l||this.getConfigByLatestVersion()}getResultByType(t){switch(t){case"GameCore":return this.firebaseRemoteConfig.getDataByKey("gamecore_configs");case"Gameplay":return this.firebaseRemoteConfig.getDataByKey("gameplay_configs");default:return null}}getConfigByConditions(t){const{latest:s,version:n,priority:i}=t;return ze.isString(n)?this.getConfigByVersion(n):ze.isNumber(i)?this.getConfigByPriority(i):ze.isBoolean(s)?this.getConfigByLatestVersion():null}};o(Sc,"FirebaseHandler");let Za=Sc;const Pc=class Pc extends Te{async fetchConfig(e){const{id:t,type:s,conditions:n}=e;await p.Utils.Time.sleepAsync(800);let i=null;switch(s){case"GameCore":i=await this.requestGameCoreConfig(t,n);break;case"Gameplay":i=await this.requestGamePlayConfig(t,n);break;default:console.warn("fetchConfig: Invalid type",s);break}return i}async requestGameCoreConfig(e,t){if(this.data=(await lt(()=>import("./bundle/mock-gamecore-configs.js"),__vite__mapDeps([]),import.meta.url)).default,e)return this.getConfigById(e);const{version:s}=t??{};return s?this.getConfigByVersion(s):this.getConfigByLatestVersion()}async requestGamePlayConfig(e,t){if(this.data=(await lt(()=>import("./bundle/mock-gameplay-configs.js"),__vite__mapDeps([]),import.meta.url)).default,e)return this.getConfigById(e);const{latest:s,version:n,priority:i}=t??{};return n?this.getConfigByVersion(n):i?this.getConfigByPriority(i):s?this.getConfigByLatestVersion():this.getConfigByLatestVersion()}};o(Pc,"MockupHandler");let ti=Pc;const Cc=class Cc extends Te{async fetchConfig(e){const{type:t}=e,s=null;switch(t){case"GameCore":break;case"Gameplay":break;default:console.warn("fetchConfig: Invalid type",t);break}return s}};o(Cc,"SelfHostedHandler");let ei=Cc;const _m={fetchStatus:"idle",changes:[],remoteConfigs:{GameCore:{},Gameplay:{}}},Tc=class Tc extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enabled");f(this,"config");f(this,"handler");f(this,"timer");f(this,"handleFetchConfig",o(()=>{!this.enabled||this.getFetchStatus()==="fetching"||(this.fetchLatestConfigAsync("GameCore").then(s=>{s&&this.processUpdateConfig(s,"GameCore")}),this.fetchLatestConfigAsync("Gameplay").then(s=>{s&&this.processUpdateConfig(s,"Gameplay")}))},"handleFetchConfig"));f(this,"handleRemoteConfigUpdated",o(async t=>{if(!this.enabled)return;const{id:s,type:n}=t??{};if(this.checkChange(s,"updated"))return;const i=this.getRemoteConfig(s,n);if(!i)return;const{event:r}=this.game;r.emit(wt.REQUEST_SAVE_CONFIG,i),this.pushChange(s,"updated")},"handleRemoteConfigUpdated"))}init(){const{storage:t}=this.game;t.addStorage("remoteConfig",_m)}configure(t){this.config=t,this.enabled=this.config.Enabled,this.listenEvents(),this.createHandler(),this.initAutoFetch()}isRemoteConfigId(t){/^[a-zA-Z0-9_-]+$/.test(`${t}`)||this.exception("id","is invalid")}isRemoteConfigStored(t,s){return!!this.getRemoteConfig(t,s)}listenEvents(){const{event:t}=this.game;t.on(wt.REMOTE_CONFIG_UPDATED,this.handleRemoteConfigUpdated)}createHandler(){const{ServiceType:t}=this.config;switch(t){case"mockup":this.handler=new ti(this);break;case"firebase":this.handler=new Za(this);break;case"selfHosted":this.handler=new ei(this);break;default:console.warn("RemoteConfigPlugin: Invalid service type"),this.enabled=!1}}initAutoFetch(){if(!this.enabled)return;const{FetchIntervalInSeconds:t}=this.config.Options;if(t<=0)return;clearInterval(this.timer);const s=1e3;this.handleFetchConfig(),this.timer=setInterval(this.handleFetchConfig,t*s)}async fetchConfigAsync(t){if(!this.enabled)return!1;try{const{id:s,type:n}=t;this.config.SupportedDataTypes.indexOf(n)===-1&&this.exception(`"${n}" type`,"is unsupported"),s&&this.isRemoteConfigStored(s,n)&&this.exception(`"${s}" id`,"is stored"),this.setFetchStatus("fetching");const i=await this.handler.fetchConfig(t);console.info("[fetchConfigAsync]",i);const r=new Ce(i).toObject();let c;switch(r.type){case"GameCore":c=new Se(r.config).toObject();break;case"Gameplay":c=new Pe(r.config).toObject();break}return r.config=c,this.setRemoteConfig(r),this.setFetchStatus("success"),r.id}catch(s){return console.warn("[fetchConfigAsync]",s),this.setFetchStatus("failure"),!1}}async fetchLatestConfigAsync(t){if(!this.enabled)return!1;try{return await this.fetchConfigAsync({type:t,conditions:{latest:!0}})}catch(s){return console.warn("[fetchLatestConfigAsync]",s),!1}}async fetchDefaultConfigAsync(t){if(!this.enabled)return!1;try{const{DefaultConfigId:s}=this.config;return this.isRemoteConfigId(s),this.fetchConfigAsync({id:s,type:t})}catch(s){return console.warn("[fetchDefaultConfigAsync]",s),!1}}processUpdateConfig(t,s){if(!this.enabled)return!1;try{const n=this.getRemoteConfig(t,s);return n||this.exception(`"${t}" id`,"is not stored"),this.checkChange(t,"updated")&&this.exception(`"${t}" id`,"is updated"),this.requestUpdateConfig(n),this.requestHotUpdate(t,n.type),this.pushChange(t,"requested"),!0}catch{return!1}}requestUpdateConfig(t){if(!this.enabled)return;const{event:s}=this.game;s.emit(wt.REQUEST_UPDATE_CONFIG,t)}requestHotUpdate(t,s){if(!this.enabled)return;const{ForceReloadGame:n}=this.config.Options;if(!n)return;const{event:i}=this.game;i.emit(wt.REQUEST_HOT_RELOAD,{id:t,type:s})}rollbackConfig(t,s){try{const n=this.getRemoteConfig(t,s);return n?(this.requestUpdateConfig(n),this.requestHotUpdate(t,n.type),this.pushChange(t,"rollback"),!0):!1}catch(n){return console.warn("[rollbackConfig]",n),!1}}setStorageData(t,s){const{storage:n}=this.game;n.setStorageData("remoteConfig",t,s)}getRemoteConfigs(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","remoteConfigs")}getRemoteConfig(t,s){return this.getRemoteConfigs()[s][t]||null}setRemoteConfig(t){const{id:s,type:n}=t;this.setStorageData("remoteConfigs",{[n]:{[s]:t}})}setFetchStatus(t){this.setStorageData("fetchStatus",t)}getFetchStatus(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","fetchStatus")}getChanges(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","changes")}pushChange(t,s){const n={id:t,actionStatus:s},i=this.getChanges();i.push(n),this.setStorageData("changes",i)}checkChange(t,s){const i=this.getChanges().findLast(r=>r.id===t);return i?i.actionStatus===s:!1}exception(t,s){throw new Error(`RemoteConfigPlugin: ${t} ${s}`)}};o(Tc,"RemoteConfigPlugin");let si=Tc;p.Dtos.RemoteConfig={Data:Ce,GameCore:Se,Gameplay:Pe};p.Dtos.Player.Data.addDefaultData({remoteConfig:{GameCore:{},Gameplay:{}}});p.Dtos.Player.Data.addValidateFunction("remoteConfig",a=>{const{Valid:e}=p.Utils;if(!e.isObject(a))throw new Error("remoteConfig is invalid");if(!("GameCore"in a))throw new Error("remoteConfig.GameCore is invalid");if(!("Gameplay"in a))throw new Error("remoteConfig.Gameplay is invalid")});const{Utils:Gl}=p,_c=class _c extends N.Plugins.BasePlugin{constructor(t){super(t);f(this,"storages");this.storages={}}addStorage(t,s){console.info("addStorage",t,s),this.storages[t]=s}setStorageData(t,s,n){let i;if(Gl.Valid.isObject(n)){const r=this.getStorageData(t,s);i=Gl.Object.merge(r,n)}else i=n;this.storages[t][s]=i}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}};o(_c,"StoragePlugin");let ni=_c;const xc=class xc extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"isVisible",!0);f(this,"browserPrefixes",["moz","ms","o","","webkit"]);f(this,"handleVisibilityChange",o(t=>{if(typeof t=="boolean")return t?this.onVisibleEvent():this.onHiddenEvent();const s=this.getBrowserPrefix();return this.getHiddenPropertyName(s)in document?this.onHiddenEvent():this.onVisibleEvent()},"handleVisibilityChange"))}init(){const t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(i=>{window.addEventListener(i,()=>{let r;i==="focus"?r=!0:i==="blur"&&(r=!1),this.handleVisibilityChange(r)},!1)})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?t+"Hidden":"hidden"}getVisibilityEvent(t){return(t||"")+"visibilitychange"}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(p.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(p.Events.VISIBILITY_HIDDEN))}};o(xc,"VisibilityPlugin");let ai=xc;const Nc=class Nc extends Jl{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}};o(Nc,"BannerInstance");let ii=Nc;const{Status:jl}=p.Plugins.Ads,Oc=class Oc extends ii{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.status=jl.SHOWING}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.status=jl.IDLE}};o(Oc,"BannerAdInstance");let ri=Oc;const{Object:xm}=p.Utils,{Status:rt,Types:mt,AdError:Ke,AdInstance:Nm}=p.Plugins.Ads,Mc=class Mc extends Nm{constructor(t,s){super(t,s);f(this,"instance");f(this,"instanceLoadFailedQueue",[]);this.instance=null}async loadAsync(){if(console.info("AdInstance","loadAsync called",{type:this.type,status:this.status}),this.status!==rt.IDLE)throw new Ke("AD_NOT_READY","Ad is not ready.");let t=!1;try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new Ke("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.status=rt.LOADING,await this.instance.loadAsync(),t=!0,this.status=rt.FILLED,console.info("AdInstance","loadAsync success",{type:this.type,status:this.status}),this.type===mt.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(),this.type===mt.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd()}catch(s){throw console.warn("AdInstance","loadAsync failed",{type:this.type,status:this.status,error:s}),this.status=rt.IDLE,s instanceof Object&&"code"in s&&s.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.instanceLoadFailedQueue.push(this.instance),self.game.analytics.loadAdFail(this.type),s}finally{t?(this.type===mt.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(),this.type===mt.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd()):self.game.analytics.loadAdFail(this.type)}}async showAsync(){if(console.info("AdInstance","showAsync called",{type:this.type,status:this.status}),this.status!==rt.FILLED)throw new Ke("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new Ke("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let t=!1;try{this.status=rt.SHOWING,await this.instance.showAsync(),t=!0,this.status=rt.IDLE,this.instance=null,console.info("AdInstance","showAsync success",{type:this.type,status:this.status})}catch(s){throw console.warn("AdInstance","showAsync failed",{type:this.type,status:this.status,error:s}),this.status=rt.FILLED,p.Utils.Object.hasOwn(s,"code")&&(s.code==="AD_NOT_LOADED"&&(this.status=rt.IDLE),["USER_INPUT","INVALID_PARAM","INVALID_OPERATION"].includes(`${s.code}`)&&(this.status=rt.IDLE,this.instance=null),s.code==="USER_INPUT"&&(t=!0)),s}finally{t?(this.type===mt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),this.type===mt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()):self.game.analytics.showAdFail(this.type)}}async createInstanceByType(t){try{switch(t){case mt.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case mt.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);default:return null}}catch(s){if(!xm.hasOwn(s,"code"))throw s;return s.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed():null}}getAdInstanceFailed(){const{length:t}=this.instanceLoadFailedQueue,s=Math.floor(Math.random()*t);return this.instanceLoadFailedQueue[s]||null}};o(Mc,"NormalAdInstance");let gs=Mc;const{BaseAnalytics:Om,Events:zl}=p.Plugins.Analytics,Mm=[zl.BUTTON_CLICK,zl.SCREEN_OPEN],Rc=class Rc extends Om{constructor(t,s){super(t,"GoogleAnalytics",{...s,color:"#0F52BA"});f(this,"prefix");this.prefix=s.prefix}processEvent(t,s){if(!("logEvent"in GameSDK)||Mm.includes(t))return;const n=this.addPrefixToEventName(t);GameSDK.logEvent(n,1,s)}addPrefixToEventName(t){return`${this.prefix}_${t}`}};o(Rc,"FacebookAnalytics");let oi=Rc;const{BaseAnalytics:Rm,Events:Lm}=p.Plugins.Analytics,$m=[Lm.SCREEN_OPEN],Lc=class Lc extends Rm{constructor(e,t){super(e,"GoogleAnalytics",{...t,color:"#FFCA28"})}processEvent(e,t){var s;$m.indexOf(e)>=0||(s=this.game.firebase.services.analytics)==null||s.event(e,t)}};o(Lc,"FirebaseAnalytics");let ci=Lc;const{BaseAnalytics:Fm,Events:km}=p.Plugins.Analytics,Um=[km.SCREEN_OPEN],$c=class $c extends Fm{constructor(e,t){super(e,"GoogleAnalytics",{...t,color:"#E35335"})}processEvent(e,t){Um.indexOf(e)>=0||gtag("event",e,t)}};o($c,"GoogleAnalytics");let li=$c;const Bm="development",Ys="0",{Dtos:Vm,Events:ae,Configs:O,Utils:Gm}=p,{Object:Kl,Json:ie,Valid:jm,Mark:T}=Gm,Fc=class Fc extends N.Game{constructor(){super(...arguments);f(this,"markName","Core Initialize");f(this,"initMonitorErrorPlugin",o(()=>{if(!this.monitorError)return;const{MonitorError:t}=O.Debugger,{ApiKey:s,Service:n,TrackUser:i,FilterErrors:r,ListPlayerDevIds:c}=t,l=GameSDK.player.getID(),d=GameSDK.player.getName();l&&c.includes(l)||(this.monitorError.configure({apiKey:s,service:n,trackUser:i,releaseStage:Bm,buildVersion:`${Ys}`}),this.monitorError.setUser({id:l,name:d}),this.monitorError.addFilterErrors(r),this.updateMonitorErrorUserAndMetadata())},"initMonitorErrorPlugin"));f(this,"updateMonitorErrorUserAndMetadata",o(()=>{if(!(this.event.getEventEmitCount(ae.PLAYER_INFO_LOADED)>0)){this.event.once(ae.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded);return}this.processWhenPlayerInfoLoaded()},"updateMonitorErrorUserAndMetadata"));f(this,"processWhenPlayerInfoLoaded",o(()=>{var n,i;const{playerId:t,name:s}=this.player.getPlayer();(n=this.monitorError)==null||n.setUser({id:t,name:s}),(i=this.monitorError)==null||i.addMetadata({isFirstLogin:this.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));f(this,"handleSaveRemoteConfig",o(t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch(s){console.warn("handleSaveGameCoreConfig",s)}},"handleSaveRemoteConfig"));f(this,"handleUpdateGameCoreConfig",o(t=>{try{const{id:s,type:n}=t;if(n!=="GameCore")return;p.Configs=Kl.merge(p.Configs,t.config);const{Ads:i}=p.Configs;this.ads.configure(i),this.event.emit(wt.REMOTE_CONFIG_UPDATED,{id:s,type:n})}catch(s){console.warn("handleUpdateGameCoreConfig",s)}},"handleUpdateGameCoreConfig"));f(this,"handleStorageCurrentRemoteConfig",o(()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",ie.clone(t)),!!t){for(const s in t)if(Kl.hasOwn(t,s)){const n=t[s],i=ie.clone(n);console.log("newRemoteConfig",i);const r=new Vm.RemoteConfig.Data(i).toObject();console.info("remoteConfigValid",r),this.remoteConfig.setRemoteConfig(r),this.remoteConfig.processUpdateConfig(r.id,r.type)}}},"handleStorageCurrentRemoteConfig"));f(this,"initAdaptivePerformancePlugin",o(()=>{if(!this.adaptivePerformance)return;const t=ie.clone(O.AdaptivePerformance);this.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));f(this,"processAfterSyncProfile",o(()=>{const{Notification:t}=O;t.Enabled&&(this.updatePlayerProfileToNotificationService(),this.sendFirstNotification())},"processAfterSyncProfile"))}getBuildVersion(){return Ys}async boot(){console.groupCollapsed("🧬 GameCore Boot"),super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(ae.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),T.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),T.putAttr(this.markName,"Step","Load Lazy Plugins"),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),T.putAttr(this.markName,"Step","Load Dev Plugins"),this.addDevPlugins().then(()=>{this.initConsolePlugin(),this.initProfilerPlugin(),this.initCanvasRecorderPlugin()}),console.groupEnd()}async start(){console.groupCollapsed("🧬 GameCore Start"),super.start(),T.putAttr(this.markName,"Step","Core Start"),this.event.emit(ae.CORE_STARTING),T.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),T.putAttr(this.markName,"Step","Init States"),await this.initState(),T.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),T.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode(),T.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initFirebaseAnalytics(),this.initFacebookAnalytics(),this.event.emit(ae.CORE_READY),T.putAttr(this.markName,"Step","Core Ready"),T.putAttr(this.markName,"Success","true"),T.stop(this.markName),console.groupEnd()}addPlugins(){this.plugins.install("Storage",ni,!0,"storage"),this.storage=this.plugins.get("Storage"),this.plugins.install("Ads",Qs,!0,"ads"),this.plugins.install("Auth",nn,!0,"auth"),this.plugins.install("Audio",sn,!0,"audio"),this.plugins.install("Match",Ya,!0,"match"),this.plugins.install("Event",dn,!0,"event"),this.plugins.install("Player",Xa,!0,"player"),this.plugins.install("Profile",Qa,!0,"profile"),this.plugins.install("Context",on,!0,"context"),this.plugins.install("Language",Wn,!0,"language"),this.plugins.install("Firebase",Vn,!0,"firebase"),this.plugins.install("Analytics",Zs,!0,"analytics"),this.plugins.install("Visibility",ai,!0,"visibility"),this.plugins.install("Leaderboard",qn,!0,"leaderboard"),this.plugins.install("DailyRewards",ln,!0,"dailyRewards"),this.plugins.install("FrameCapture",Kn,!0,"frameCapture"),this.plugins.install("RemoteConfig",si,!0,"remoteConfig"),this.ads=this.plugins.get("Ads"),this.auth=this.plugins.get("Auth"),this.audio=this.plugins.get("Audio"),this.match=this.plugins.get("Match"),this.event=this.plugins.get("Event"),this.player=this.plugins.get("Player"),this.profile=this.plugins.get("Profile"),this.context=this.plugins.get("Context"),this.language=this.plugins.get("Language"),this.firebase=this.plugins.get("Firebase"),this.analytics=this.plugins.get("Analytics"),this.visibility=this.plugins.get("Visibility"),this.leaderboard=this.plugins.get("Leaderboard"),this.dailyRewards=this.plugins.get("DailyRewards"),this.frameCapture=this.plugins.get("FrameCapture"),this.remoteConfig=this.plugins.get("RemoteConfig")}async addMonitorPlugin(){const{MonitorError:t}=O.Debugger;if(!t.Enabled)return;const s=(await lt(()=>import("./bundle/empty-script2.js"),__vite__mapDeps([]),import.meta.url)).default;typeof s=="function"&&(this.plugins.install("MonitorError",s,!0,"monitorError"),this.monitorError=this.plugins.get("MonitorError"))}async addAdaptivePerformancePlugin(){const{AdaptivePerformance:t}=O;if(!t.Enabled)return;const s=(await lt(()=>import("./bundle/index.js"),__vite__mapDeps([0,1]),import.meta.url)).default;typeof s=="function"&&(this.plugins.install("AdaptivePerformance",s,!0,"adaptivePerformance"),this.adaptivePerformance=this.plugins.get("AdaptivePerformance"))}async addDevPlugins(){if(!jm.isDebugger())return;const{ShowConsole:t,ShowProfiler:s,CanvasRecorder:n}=O.Debugger;if(t){const i=(await lt(()=>import("./bundle/empty-script2.js"),__vite__mapDeps([]),import.meta.url)).default;typeof i=="function"&&(this.plugins.install("Console",i,!0,"console"),this.console=this.plugins.get("Console"))}if(s){const i=(await lt(()=>import("./bundle/empty-script2.js"),__vite__mapDeps([]),import.meta.url)).default;typeof i=="function"&&(this.plugins.install("Profiler",i,!0,"profiler"),this.profiler=this.plugins.get("Profiler"))}if(n.Enabled){const i=(await lt(()=>import("./bundle/empty-script2.js"),__vite__mapDeps([]),import.meta.url)).default;typeof i=="function"&&(this.plugins.install("CanvasRecorder",i,!0,"canvasRecorder"),this.canvasRecorder=this.plugins.get("CanvasRecorder"))}}initEventPlugin(){const{EventLogging:t}=O.Debugger;t&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){const{Ads:t}=p.Plugins;this.ads.configure(O.Ads),this.initAdInstance(t,O)}initAdInstance(t,s){const{InterstitialAdOptions:n,RewardedVideoAdOptions:i,BannerDisplayAdOptions:r}=s.Ads;n.forEach(c=>{this.ads.setAdInstance(t.Types.INTERSTITIAL,c.PlacementId,gs)}),i.forEach(c=>{this.ads.setAdInstance(t.Types.REWARDED_VIDEO,c.PlacementId,gs)}),r.forEach(c=>{this.ads.setAdInstance(t.Types.BANNER,c.PlacementId,ri)})}async initState(){try{const t=new Xs(this);t.initContext(),await t.initPlayer()}catch(t){console.error("StateInitiator",t)}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;const{CanvasRecorder:t}=O.Debugger,{Type:s,Quality:n,RecordFps:i,SyncFps:r}=t.Options;this.canvasRecorder.configure({type:s,quality:n,syncFps:r,recordFps:i});const c=document.querySelector("canvas");if(!c)return console.error("Canvas not found");this.canvasRecorder.setCanvas(c)}initRemoteConfig(){const{RemoteConfig:t}=O;if(!t.Enabled)return;const s=ie.clone(t);this.remoteConfig.configure(s),this.event.on(wt.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(wt.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(wt.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initFirebasePlugin(){const{Firebase:t}=O;if(!t.Enabled)return;const s=ie.clone(t);this.firebase.configure(s),T.setService(this.firebase.services.performance)}initMarkCoreInitialize(){O.PerformanceMonitor.CoreFlows&&(T.measure(this.markName),T.putAttr(this.markName,"Build",`${Ys}`),T.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),T.putAttr(this.markName,"Platform",GameSDK.getPlatform()),T.putAttr(this.markName,"Success","false"),T.start(this.markName))}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch(t){console.warn("processPlayerProfile fail",t)}}updatePlayerProfileToNotificationService(){const{AppId:t}=O,s=this.player.getPlayer(),{ASID:n,playerId:i,name:r,photo:c,locale:l}=s,d={appId:t,ASID:n,playerId:i,name:r,photo:c,locale:l};console.info("🚀 > profileData",d),ph(d).catch(()=>{console.warn("updatePlayerProfileNotificationAsync failed")})}async sendFirstNotification(){try{if(!this.player.isFirstLogin())return;const s=this.player.getPlayerASID();if(!s)return;const n=await GameSDK.player.getDataAsync(["isNotificationFirstSent"])||{},{isNotificationFirstSent:i}=n;if(i===!0||!("sendNotificationAsync"in GameSDK.extra))return;await GameSDK.extra.sendNotificationAsync({message:`Hi @[${s}] your friends are waiting to play with you, play now!`,delayTime:3600}),GameSDK.player.setDataAsync({isNotificationFirstSent:!0})}catch(t){console.warn("sendNotificationForNewUser",t)}}initGoogleAnalytics(){const{Enabled:t,ConsoleLog:s}=O.Analytics.GoogleAnalytics??{};t&&this.analytics.add(new li(this.game,{log:!!s}))}initFirebaseAnalytics(){const{Enabled:t,ConsoleLog:s}=O.Analytics.GoogleAnalytics??{};t&&this.analytics.add(new ci(this.game,{log:!!s}))}initFacebookAnalytics(){const{Enabled:t,Prefix:s,ConsoleLog:n}=O.Analytics.FacebookAnalytics??{};if(t){if(typeof s!="string"){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new oi(this.game,{prefix:s,log:!!n}))}}};o(Fc,"MagicGame");let di=Fc;const{Valid:zm,Device:Km}=p.Utils,{ForceDesktopDPR:We}=p.Configs.GameEngine,Wm=o(async()=>{try{try{gtag("event","app_initialize")}catch(t){console.warn("gtag init",t)}const a=new di;window.game=a,nh(window,"game");const e=30;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreStart=!0,await a.boot(),a.event.emit(p.Events.GAME_SDK_READY),a.event.once(p.Events.REQUEST_CORE_START,Hm)}catch(a){console.error("initGame",a)}},"initGame"),Hm=o(()=>{try{window.game.start(),zm.isDebugger()||(window.game=Object.freeze(window.game));const a=35;window.__sdkLoadingCount<a&&(window.__sdkLoadingCount=a)}catch(a){console.error("startGame",a)}},"startGame"),qm=o(()=>{const e=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(e);const t=20;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t),Wm()},100)},"waitGameSDK");console.warn("GameCore: wait SDK mode",!0);We!==!1&&Km.isDesktop()&&typeof We=="number"&&We>0&&(window.devicePixelRatio=We);qm();
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./bundle/index.js","./bundle/core.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
