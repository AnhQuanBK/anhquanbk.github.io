import{a as mt}from"./chunks-TZPU4KHH.js";import{a as re,b as I,c as L,d as va,f as Gr,g as Br,h as Ur,i as W,j as n,k as jr,l as o,m as l,n as c,o as d,p as h,q as u,r as j,s as tt,v as Da,w as Ia,x as y,y as p}from"./chunks-KKQSLYRF.js";var Hr=Gr((t,e)=>{"use strict";n(),o(),l(),c(),d(),h(),u(),p(),y();var a=Object.prototype.hasOwnProperty,s="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(s=!1));function i(w,A,v){this.fn=w,this.context=A,this.once=v||!1}function f(w,A,v,x,S){if(typeof v!="function")throw new TypeError("The listener must be a function");var P=new i(v,x||w,S),C=s?s+A:A;return w._events[C]?w._events[C].fn?w._events[C]=[w._events[C],P]:w._events[C].push(P):(w._events[C]=P,w._eventsCount++),w}function m(w,A){--w._eventsCount===0?w._events=new r:delete w._events[A]}function g(){this._events=new r,this._eventsCount=0}g.prototype.eventNames=function(){var w=[],A,v;if(this._eventsCount===0)return w;for(v in A=this._events)a.call(A,v)&&w.push(s?v.slice(1):v);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(A)):w},g.prototype.listeners=function(w){var A=s?s+w:w,v=this._events[A];if(!v)return[];if(v.fn)return[v.fn];for(var x=0,S=v.length,P=new Array(S);x<S;x++)P[x]=v[x].fn;return P},g.prototype.listenerCount=function(w){var A=s?s+w:w,v=this._events[A];return v?v.fn?1:v.length:0},g.prototype.emit=function(w,A,v,x,S,P){var C=s?s+w:w;if(!this._events[C])return!1;var E=this._events[C],ot=arguments.length,xt,T;if(E.fn){switch(E.once&&this.removeListener(w,E.fn,void 0,!0),ot){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,A),!0;case 3:return E.fn.call(E.context,A,v),!0;case 4:return E.fn.call(E.context,A,v,x),!0;case 5:return E.fn.call(E.context,A,v,x,S),!0;case 6:return E.fn.call(E.context,A,v,x,S,P),!0}for(T=1,xt=new Array(ot-1);T<ot;T++)xt[T-1]=arguments[T];E.fn.apply(E.context,xt)}else{var Fr=E.length,Ht;for(T=0;T<Fr;T++)switch(E[T].once&&this.removeListener(w,E[T].fn,void 0,!0),ot){case 1:E[T].fn.call(E[T].context);break;case 2:E[T].fn.call(E[T].context,A);break;case 3:E[T].fn.call(E[T].context,A,v);break;case 4:E[T].fn.call(E[T].context,A,v,x);break;default:if(!xt)for(Ht=1,xt=new Array(ot-1);Ht<ot;Ht++)xt[Ht-1]=arguments[Ht];E[T].fn.apply(E[T].context,xt)}}return!0},g.prototype.on=function(w,A,v){return f(this,w,A,v,!1)},g.prototype.once=function(w,A,v){return f(this,w,A,v,!0)},g.prototype.removeListener=function(w,A,v,x){var S=s?s+w:w;if(!this._events[S])return this;if(!A)return m(this,S),this;var P=this._events[S];if(P.fn)P.fn===A&&(!x||P.once)&&(!v||P.context===v)&&m(this,S);else{for(var C=0,E=[],ot=P.length;C<ot;C++)(P[C].fn!==A||x&&!P[C].once||v&&P[C].context!==v)&&E.push(P[C]);E.length?this._events[S]=E.length===1?E[0]:E:m(this,S)}return this},g.prototype.removeAllListeners=function(w){var A;return w?(A=s?s+w:w,this._events[A]&&m(this,A)):(this._events=new r,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prefixed=s,g.EventEmitter=g,typeof e<"u"&&(e.exports=g)});n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var xa=(t=>(t.DRAFT="draft",t.SINGLE="single",t.TOURNAMENT="tournament",t.MATCHING_GROUP="matching-group",t.CHALLENGE_FRIEND="challenge-friend",t))(xa||{}),z=xa,Vr=z,Sa=Vr;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Kr=t=>t,$r=Kr;n(),o(),l(),c(),d(),h(),u(),p(),y();var Wr=()=>{},zr=Wr,qr={asConst:$r,noop:zr};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Yr=(t,e)=>{if(t)return e<0?t[t.length+e]:t[e]},Jr=Yr;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Qr=(t,e)=>{let a=[];for(let s=0;s<t;s++)a.push(e(s));return a},Ea=Qr,Xr=t=>Ea(t,()=>{}),be=Xr,Zr=(t,e)=>{let a=Math.ceil(t.length/e);return be(a).map((s,r)=>t.slice(r*e,r*e+e))},ti=Zr;n(),o(),l(),c(),d(),h(),u(),p(),y();var ei=(t,e)=>t.filter(a=>e.indexOf(a)<0),ai=ei;n(),o(),l(),c(),d(),h(),u(),p(),y();var si=t=>t.reduce((e,a)=>e.concat(a),[]),ri=si;n(),o(),l(),c(),d(),h(),u(),p(),y();var ii=(t,e)=>t.indexOf(e)>=0,ni=ii;n(),o(),l(),c(),d(),h(),u(),p(),y();var oi=(t,e)=>t.slice(0,e),li=oi;n(),o(),l(),c(),d(),h(),u(),p(),y();var ci=(t,e)=>{for(let a=0;a<t.length;a++)if(e(t[a],a))return t[a]},Pa=ci;n(),o(),l(),c(),d(),h(),u(),p(),y();var di=(t,e)=>{for(let a=0;a<t.length;a++)if(e(t[a],a))return a;return-1},ba=di;n(),o(),l(),c(),d(),h(),u(),p(),y();var hi=t=>{for(let e=t.length-1;e>0;e--){let a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}},La=hi;n(),o(),l(),c(),d(),h(),u(),p(),y();var ui=t=>{let e=[...t];return La(e),e},yi=ui;n(),o(),l(),c(),d(),h(),u(),p(),y();var pi=(t,e,a)=>a.indexOf(t)===e&&t!==null&&t!==void 0,fi=t=>t.filter(pi),mi=fi,gi={at:Jr,chunk:ti,difference:ai,fillWith:Ea,length:be,limit:li,search:Pa,searchIndex:ba,has:ni,shuffle:La,toShuffled:yi,unique:mi,flatten:ri};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var wi=()=>"OffscreenCanvas"in window&&typeof OffscreenCanvas<"u",Ai=(t,e)=>{let a=new OffscreenCanvas(0,0),s=a.getContext(t,e);return s?{canvas:a,context:s}:null},vi=(t,e)=>{let a=document.createElement("canvas"),s=a.getContext(t,e);return s?{canvas:a,context:s}:null},Di=t=>{let{contextType:e="2d",contextAttributes:a={},type:s="auto"}=t,r=null;return s!=="canvas"&&wi()&&(r=Ai(e,a)),!r&&s!=="offscreen"&&(r=vi(e,a)),r},Le=Di;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Ii=t=>!t||t===""||t===0||typeof t=="number"&&isNaN(t),Ca=Ii,xi=t=>Ca(t)?t!==!1&&t!==0:typeof t=="string"||Array.isArray(t)?t.length===0:typeof t=="object"&&t!==null?Object.keys(t).length===0:!1,Ce=xi,Na="Tile Connect",Ne={},Ta=t=>Ce(t)?GameSDK.getSDKName()??"Storage":t??"Storage",Si=t=>{let e=`${Na}_${t}`;return Ne[e]?Promise.resolve(Ne[e]):new Promise((a,s)=>{let r=1,i,f=m=>{i=indexedDB.open(Na,m),i.onerror=g=>{let w=g.target.error;w?.name==="VersionError"?(r++,f(r)):s(w)},i.onsuccess=g=>{let w=i.result;Ne[e]=w,a(w)},i.onupgradeneeded=g=>{let w=g.target.result;r=w.version,w.objectStoreNames.contains(t)||w.createObjectStore(t)}};f(r)})},_a=Si,Ei=async(t,e)=>{try{let a=Ta(e),s=await _a(a);if(!s.objectStoreNames.contains(a))return{};let r=s.transaction(a,"readonly").objectStore(a);return new Promise((i,f)=>{let m=r.get(t);m.onerror=()=>f(m.error),m.onsuccess=()=>i(m.result)})}catch{return{}}},Pi=Ei;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var bi=t=>{try{return JSON.parse(t)}catch{return null}},Te=bi,Li=t=>{try{let e=localStorage.getItem(t);return e===null?null:Te(e)}catch{return null}},Oa=Li;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Ci=t=>{try{return JSON.stringify(t,null,0)}catch{return""}},_e=Ci,Ni=t=>Te(_e(t)),Ra=Ni,Ti=()=>{let t="en_US",e=Ra(window.navigator.languages)||[],a=Pa(e,s=>s.indexOf("-")>-1);return!a||a.indexOf("-")===-1?t:a.replace("-","_")},_i=Ti;n(),o(),l(),c(),d(),h(),u(),p(),y();var Oi=()=>{let t=window.location.search.substring(1);if(!t)return{};let e=t.split("&"),a={};for(let s of e){let r=s.split("=");a[r[0]]=decodeURIComponent(r[1])}return a},Ri=Oi;n(),o(),l(),c(),d(),h(),u(),p(),y();var Mi=()=>{let{body:t,documentElement:e}=document,{clientHeight:a}=t,{clientHeight:s}=e;return Math.max(s,a)||0},ki=Mi;n(),o(),l(),c(),d(),h(),u(),p(),y();var Fi=()=>{let{body:t,documentElement:e}=document,{clientWidth:a}=t,{clientWidth:s}=e;return Math.max(s,a)||0},Gi=Fi;n(),o(),l(),c(),d(),h(),u(),p(),y();var Bi=t=>{localStorage.removeItem(t)},Ui=Bi;n(),o(),l(),c(),d(),h(),u(),p(),y();var ji=async(t,e,a)=>{try{if(Ce(e))return;let s=Ta(a),r=await _a(s);if(!r.objectStoreNames.contains(s))return;let i=r.transaction(s,"readwrite").objectStore(s);return new Promise((f,m)=>{try{let g=i.put(e,t);g.onsuccess=()=>f(),g.onerror=()=>m(g.error)}catch(g){m(g)}})}catch{}},Hi=ji;n(),o(),l(),c(),d(),h(),u(),p(),y();var Vi=()=>{let t="vibrate"in window.navigator;if(t)try{window.navigator.vibrate(0)}catch{return!1}return t},Ki=t=>{try{return Vi()?(window.navigator.vibrate(0),window.navigator.vibrate(t),!0):!1}catch{return!1}},$i=Ki;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Wi=(t,e,a)=>{let s,r=!1;return function(...i){if(a&&!r){r=!0,t.apply(this,i);return}clearTimeout(s),s=setTimeout(()=>{t.apply(this,i)},e)}},Oe=Wi;n(),o(),l(),c(),d(),h(),u(),p(),y();var zi=t=>{let e=Object.create(null);return function(...a){let s=`__memoize__${JSON.stringify(a)}`;if(s in e)return e[s];let r=t.apply(this,a);return e[s]=r,r}},St=zi;n(),o(),l(),c(),d(),h(),u(),p(),y();var qi=(t,e,a)=>{let s,r=!1,i=!1;return function(...f){if(a&&!i){i=!0,t.apply(this,f);return}r&&(r=!1,t.apply(this,f)),clearTimeout(s),s=setTimeout(()=>{r=!0},e)}},Re=qi;n(),o(),l(),c(),d(),h(),u(),p(),y();var Yi=(t,e)=>{let a=t.value;return t.value=async function(...s){await e.apply(this,s);let r=a.apply(this,s);return r instanceof Promise?await r:r},t},Ji=Yi;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Qi=t=>{if(t instanceof Error)return t;if(t!==null&&typeof t=="object"&&"message"in t&&typeof t.message=="string"){let e=new Error(t.message);return"stack"in t&&typeof t.stack=="string"&&(e.stack=t.stack),"name"in t&&typeof t.name=="string"&&(e.name=t.name),"code"in t&&typeof t.code=="string"&&Object.assign(e,{code:t.code}),e}if(t!==null&&typeof t=="object")try{return new Error(JSON.stringify(t,null,2))}catch{return new Error(`[Object conversion failed] ${String(t)}`)}return new Error(String(t))},Me=Qi,Xi=(t,e)=>{let a=t.value;return t.value=async function(...s){let r;try{let i=a.apply(this,s);return i instanceof Promise?await i:i}catch(i){r=Me(i)}finally{e?.(r)}},t},Zi=Xi;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var tn=t=>{let e=typeof t=="object"||typeof t=="function",a=Array.isArray(t);return t!==null&&e&&!a},M=tn,Ma=(t,e)=>{if(typeof t!==e)throw new Error(`Value ${t} is not type of ${e} (${typeof t})`)},en=(t,e,a)=>{let s;return a||Ma(t,e),!M(t)||!a?t:Object.defineProperty(t,a,{get(){return s},set(r){Ma(r,e),s=r}})},ke=en,an=(t,e)=>{let a=t.value;return t.value=function(...s){return e.forEach((r,i)=>{try{ke(s[i],r)}catch(f){let m="[Decorator:validateParams]";throw f instanceof Error?(f.message=`${m}: ${f.message}`,f):new Error(`${m}: ${f}`)}}),a.apply(this,s)},t},sn=an;n(),o(),l(),c(),d(),h(),u(),p(),y();var rn=(t,e)=>{for(let a of e)try{return ke(t,a),!1}catch{}return!0},nn=(t,e)=>{let a=t.value;return t.value=function(...s){let r=a.apply(this,s);if(rn(r,e))throw new Error(`[Decorator:validateReturn] ${r} (${typeof r}) is not type of ${e.join(" | ")}`);return r},t},on=nn,ln=class ft{static isProperty(e,a,s){return!!(s&&(typeof s.value<"u"||s.get||s.set))}static isFunction(e,a,s){return!!(s&&(typeof s.value=="function"||typeof s.initializer=="function"))}static trace=(e,a,s)=>{try{let{value:r,initializer:i,get:f,set:m}=s??{};try{if(!(f||m)&&typeof r!="function")if(typeof i=="function"){let g=i?.();if(typeof g!="function"&&typeof g>"u")throw new Error("Initializer returned undefined")}else if(r){let g=typeof r}else throw new Error("Unsupported decorator")}catch{}}catch{}finally{}return s};static locked(e,a,s){return L(I({},s),{value:()=>{throw new Error("Method is locked")}})}static preStart(e){return(a,s,r)=>ft.isFunction("preStart",s,r)?Ji(r,e):r}static tryCatch(e){return(a,s,r)=>ft.isFunction("tryCatch",s,r)?Zi(r,e):r}static debounce(e){return(a,s,r)=>{if(!ft.isFunction("debounce",s,r))return r;let i=r.value;return i?r.value=Oe(i,e):r.initializer&&(i=r.initializer,r.initializer=function(){return Oe(i.call(this),e)}),r}}static throttle(e){return(a,s,r)=>{if(!ft.isFunction("throttle",s,r))return r;let i=r.value;return i?r.value=Re(i,e):r.initializer&&(i=r.initializer,r.initializer=function(){return Re(i.call(this),e,!0)}),r}}static memoize(e,a,s){if(!ft.isFunction("memoize",a,s))return s;let r=s.value;return r?s.value=St(r):s.initializer&&(r=s.initializer,s.initializer=function(){return St(r.call(this))}),s}static validateValue(e){return(a,s,r)=>{if(!ft.isProperty("validateValue",s,r))return r;try{return ke(a,e,s)}catch(i){return i instanceof Error,r}}}static validateReturn=(...e)=>(a,s,r)=>ft.isFunction("validateReturn",s,r)?on(r,e):r;static validateParams=(...e)=>(a,s,r)=>ft.isFunction("validateParams",s,r)?sn(r,e):r},Fe=ln,cn=()=>{self.onmessage=s=>{let{action:r,payload:i}=s.data;switch(r){case"drawImage":break;case"saveData":break;case"getData":break;default:}};function t(s){}function e(s){}function a(s){}},Ge=class Rr{worker=null;static _instance;constructor(){this.init()}static get inst(){return this._instance||(this._instance=new Rr),this._instance}init(){let e=new Blob([`(${cn.toString()})()`],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(e))}static postMessage(e,a){if(!this.inst.worker)throw new Error("Worker is not initialized");this.inst.worker.postMessage({action:e,payload:a})}};W([Fe.tryCatch()],Ge.prototype,"init",1),W([Fe.tryCatch()],Ge,"postMessage",1);var dn=Ge,hn=dn;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var un=t=>t==null,ka=t=>{if(!M(t))return t;for(let e in t)if(un(t[e]))delete t[e];else{let a=t[e];M(a)&&(t[e]=ka(a))}return t},Fa=ka;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Ga=Object,yn=(t,e)=>{if("assign"in Ga)return Ga.assign(t,e);let a=t;for(let s in e)a[s]=e[s];return a},Vt=yn,pn=t=>typeof t!="object"||t===null?null:Vt(t,{}),Ba=pn;n(),o(),l(),c(),d(),h(),u(),p(),y();var Ua=(t,e)=>{for(let a in e)M(t[a])&&M(e[a])?Ua(t[a],e[a]):Vt(t,{[a]:e[a]});return t},ja=Ua,fn=(t,e)=>{try{let a=Oa(t),s={};M(a)&&(s=a);let r=Ba(e);if(!M(r))return!1;let i=Fa(r),f=ja(s,i),m=_e(f);return localStorage.setItem(t,m),!0}catch{return!1}},mn=fn,gn={createCanvas:Le,getLocale:_i,getLocalStorage:Oa,getQueryParams:Ri,getScreenHeight:ki,getScreenWidth:Gi,writeLocalStorage:mn,vibrate:$i,getIndexedDB:Pi,WebWorker:hn,setIndexedDB:Hi,removeKeyLocalStorage:Ui};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var wn=()=>Math.round(window.devicePixelRatio)??1,Ha=wn,An=t=>t*Ha(),vn=An;n(),o(),l(),c(),d(),h(),u(),p(),y();var Dn=()=>/Android/i.test(navigator.userAgent),In=Dn;n(),o(),l(),c(),d(),h(),u(),p(),y();var xn=()=>!/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),Sn=xn;n(),o(),l(),c(),d(),h(),u(),p(),y();var En=()=>/iPhone|iPad|iPod/i.test(navigator.userAgent),Pn=En;n(),o(),l(),c(),d(),h(),u(),p(),y();var bn=()=>/Android|iPhone|iPad|iPod/i.test(navigator.userAgent),Ln=bn,Cn={getPhysicPixels:vn,isDesktop:Sn,isMobile:Ln,isAndroid:In,isIOS:Pn,pixelRatio:Ha};n(),o(),l(),c(),d(),h(),u(),p(),y(),Ia(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Nn=t=>{let e=t.map(a=>Promise.resolve(a).then(s=>({status:"fulfilled",value:s}),s=>({status:"rejected",reason:s})));return Promise.all(e)},Tn=Nn;n(),o(),l(),c(),d(),h(),u(),p(),y();var _n=t=>typeof Promise.any=="function"?Promise.any(t):new Promise((e,a)=>{let s=[],r=0,i=f=>{if(!(f<t.length))if(s.length>0)e(s[0]);else{let m=new Error("All promises were rejected");m.errors=s,a(m)}};t.forEach((f,m)=>{f.then(g=>{s[m]=g,r++,i(r)}).catch(g=>{s[m]=g,r++,i(r)})})}),On=_n;n(),o(),l(),c(),d(),h(),u(),p(),y();var Rn=async t=>{try{return[await t,null]}catch(e){return[null,Me(e)]}},Mn=Rn;n(),o(),l(),c(),d(),h(),u(),p(),y();var kn=(t,e)=>{try{return t()}catch(a){try{return e()}catch{throw a}}},Fn=kn;n(),o(),l(),c(),d(),h(),u(),p(),y();var Gn=async(t,e)=>{try{return await t()}catch(a){try{return await e()}catch{throw a}}},Bn=Gn;n(),o(),l(),c(),d(),h(),u(),p(),y();var Un=t=>{let{generate:e,generateSeed:a=()=>Math.random()*1e6,seed:s=Date.now()}=t,r=s;return(...i)=>(r=a(r),e(r,...i))},jn=Un;n(),o(),l(),c(),d(),h(),u(),p(),y();var Va=(t,e)=>{t.__proto__.valueOf=()=>e,t.__proto__.toString=()=>`${e}`},Hn=t=>t.constructor(L(I({},t),{__proto__:t.__proto__})),Ka=t=>{let e=Object.keys(t);for(let a of e){let s=Object.getOwnPropertyDescriptor(t,a)?.value;if(M(s)){Ka(s);continue}try{let r=s;Va(r,s),Object.defineProperty(t,a,{enumerable:!1,configurable:!0,get(){return Hn(r)},set(i){Vt(r,i),Va(r,i)}})}catch{}}},Vn=Ka,Kn={debounce:Oe,throttle:Re,syncVars:Vn,memoize:St,retry:Fn,retryAsync:Bn,allSettled:Tn,any:On,accessBlocker:Da,rng:jn,handleAsync:Mn,toError:Me};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var $n=t=>{let e={};for(let a in t){let s=t[a];e[s]=a}return e},$a=$n,Wn=St((t,e)=>{let a=t.toLowerCase();if(typeof t=="string"){let s=e[a];if(typeof s=="string")return s}return"?"}),zn=St(t=>{let e=[],a=/:([A-Z0-9?]+)/gm,s=null;for(;s=a.exec(t),s!==null;)e.push(s[1]);return e}),qn=St(t=>{let e=[],a=/(\d+[A-Z?]|[A-Z?])/gm,s=null;for(;s=a.exec(t),s!==null;){let r=s[0];if(r.length>=2){let{length:i}=r,f=r.slice(0,i-1),m=r[i-1],g=be(+f).map(()=>m);e.push(...g);continue}e.push(r)}return e}),Yn=(t,e)=>{let a=t,s=$a(e),r={},i=0,f=0,m=zn(a);for(let g of m){i=0,f++,r[f]||(r[f]={});let w=qn(g);for(let A of w){i++;let v=Wn(A,s);r[f][i]=v}}return r},Jn=Yn;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Qn=(t,e)=>M(t)?typeof Object.hasOwn=="function"?Object.hasOwn(t,e):Object.prototype.hasOwnProperty.call(t,e):!1,Q=Qn;n(),o(),l(),c(),d(),h(),u(),p(),y();var Xn=t=>typeof t=="string",Wa=Xn,Zn=St((t,e)=>{if(!M(e)||!Q(e,t))return"?";let a=e[t];return typeof a=="string"?`${a.toUpperCase()}`:"?"}),za=(t,e,a=!1)=>{let s="";if(!M(t))return s;let r="",i=1;for(let f in t){if(!Q(t,f))continue;let m=t[f];if(M(m)){s+=`:${za(m,e,!0)}`;continue}if(!Wa(m))continue;let g=Zn(m,e);g===r?(i++,s=s.slice(0,-2)):i=1,s+=`${i}${g}`,r=g}return s=s.replace(/1([A-Z])/g,"$1"),s},to=za;n(),o(),l(),c(),d(),h(),u(),p(),y();var eo=(t,e)=>{try{if(!t)return"";if(e){let a=atob(t),s=btoa(e);return a=a.replace(s,"="),atob(a)}return atob(t)}catch{return""}},ao=eo;n(),o(),l(),c(),d(),h(),u(),p(),y();var so=()=>({}),Be={},ie=t=>(Be[t]||(Be[t]=so()),Be[t]),qa=(t,e)=>{let a=ie(e),s=Object.keys(a).length;a[t]=s+1},ro=(t,e,a=1)=>{let s=t[0],r=[],i=ie(a);if(e)for(let g in e)qa(g,a);for(let g=1;g<t.length;g++){let w=t[g],A=`${s}${w}`;g++,s=t[g],i[A]===void 0&&(qa(A,a),i=ie(a))}s=t[0];let f=1,m=0;for(;f<t.length;){let g=t[f],w=`${s}${g}`,A=io(t.slice(m),i);if(A!==null){r.push(i[A]),f+=A.length-w.length,s="",m=f+1,f++;continue}i[w]===void 0?s=w:(r.push(i[w]),s="",m=f+1),f++}return r},io=(t,e)=>{let a=Object.keys(e);return a=a.filter(s=>t.indexOf(s)>-1&&t!==s),a.length===0?null:a.sort((s,r)=>r.length-s.length)[0]},no=ro;n(),o(),l(),c(),d(),h(),u(),p(),y();var oo=t=>{let e={};for(let a in t)e[t[a]]=a;return e},lo=(t,e,a=1)=>{let s="",r="",i=ie(a);e&&(i=I(I({},e),i));let f=oo(i);for(let m in t){let g=t[m];f[g]!==void 0?s=f[g]:s="?",r+=s}return r},co=lo;n(),o(),l(),c(),d(),h(),u(),p(),y();var ho=(t,e)=>{try{if(!t)return"";if(e){let a=btoa(t),s=btoa(e);return a=a.replace("=",s),btoa(a)}return btoa(t)}catch{return""}},uo=ho,yo={decodeMap:Jn,encodeMap:to,hashToString:ao,stringToHash:uo,lwzCompress:no,lwzDecompress:co};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var po=(t,e)=>{let a=t.split(","),s=a[0].match(/:(.*?);/);if(!s)return null;let r=s[1],i=atob(a[a.length-1]),f=i.length,m=new Uint8Array(f);for(;f--;)m[f]=i.charCodeAt(f);return new File([m],e,{type:r})},fo=po;n(),o(),l(),c(),d(),h(),u(),p(),y();var mo=t=>new Promise((e,a)=>{let s=new FileReader;s.onloadend=()=>e(s.result),s.onerror=a,s.readAsDataURL(t)}),go=mo;n(),o(),l(),c(),d(),h(),u(),p(),y();var kt=new Image,wo=(t,e=!0,a=!0)=>new Promise(s=>{e&&(kt=new Image),kt.onload=()=>{s(kt),a&&URL.revokeObjectURL(kt.src)},kt.onerror=()=>{s(null)},kt.src=URL.createObjectURL(t)}),Ao=wo;n(),o(),l(),c(),d(),h(),u(),p(),y();var vo=async(t,e)=>{let a=await fetch(t).then(s=>s.blob()).catch(()=>null);return a?new File([a],e):null},Do=vo;n(),o(),l(),c(),d(),h(),u(),p(),y();var Et=Le({contextType:"2d",contextAttributes:{willReadFrequently:!0}}),Io=async t=>new Promise((e,a)=>{let s=new FileReader;s.onload=()=>e(s.result),s.onerror=a,s.readAsDataURL(t)}),xo=async(t,e="png")=>{let{width:a,height:s}=t;if(!a||!s)throw new Error("Element has no width or height");if(!Et)throw new Error("Failed to create canvas");if(Et.canvas.width=a,Et.canvas.height=s,Et.context.drawImage(t,0,0,a,s),Et.canvas instanceof HTMLCanvasElement)return Et.canvas.toDataURL(`image/${e}`,.85);let r=await Et.canvas.convertToBlob({type:`image/${e}`});return Io(r)},So=xo;n(),o(),l(),c(),d(),h(),u(),p(),y();var Ya=Le({contextType:"2d",contextAttributes:{willReadFrequently:!0}}),Eo=async(t,e="png")=>{try{if(!Ya)throw new Error("Failed to create canvas");let{canvas:a,context:s}=Ya;return a.width=t.width,a.height=t.height,s.drawImage(t,0,0,t.width,t.height),a instanceof HTMLCanvasElement?new Promise(r=>{a.toBlob(i=>r(i),`image/${e}`,.9)}):a.convertToBlob({type:`image/${e}`,quality:.9})}catch{return null}},Po=Eo;n(),o(),l(),c(),d(),h(),u(),p(),y();var bo=async t=>{if(!t)throw new Error("url is empty");try{let e=await fetch(t);if(!e.ok)throw new Error("Network response was not ok");return await e.blob()}catch(e){throw e instanceof Error?e:new Error("Failed to fetch image")}},Lo=bo;n(),o(),l(),c(),d(),h(),u(),p(),y();var Co=async t=>new Promise((e,a)=>{t||a(new Error("url is empty"));let s=new Image;s.crossOrigin="anonymous",s.onload=()=>{e(s)},s.onerror=r=>{a(r)},s.src=t}),No=Co;n(),o(),l(),c(),d(),h(),u(),p(),y();var To=(t,e)=>{if(isNaN(t)||isNaN(e))throw new Error("width and height must be numbers");return{string:"+",style:`font-size: 1px; padding: ${Math.floor(e/2)}px ${Math.floor(t/2)}px;`}},_o=(t,e=1)=>{let a=new Image;a.onload=function(){let s=this,r=s.width*e,i=s.height*e,f=To(r,i)},a.src=t},Oo=_o,Ro={base64ToFile:fo,blobToDataImage:go,blobToHtmlImage:Ao,blobUrlToFile:Do,elementToBase64:So,elementToBlob:Po,fetchImage:Lo,loadImage:No,logImage:Oo};n(),o(),l(),c(),d(),h(),u(),p(),y();var Mo={clone:Ra,decode:Te,encode:_e};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var ko=class Mr{perf=null;static _inst;static get inst(){return this._inst||(this._inst=new Mr),this._inst}static setService(e){this.inst.perf=e??null}static measure(e){this.inst.perf?.measure(e)}static start(e){this.inst.perf?.start(e)}static stop(e){try{this.inst.perf?.stop(e)}catch{}}static putMetric(e,a,s=Date.now()){this.inst.perf?.putMetric(e,a,s)}static incMetric(e,a,s=1){this.inst.perf?.incrementMetric(e,a,s)}static putAttr(e,a,s){let r=s.slice(0,100);this.inst.perf?.putAttr(e,a,r)}static rmAttr(e,a){this.inst.perf?.removeAttr(e,a)}},Fo=ko,Go={Mark:Fo};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Bo=(t,e)=>{if(typeof t!="number")return"0";let a=re(10,e),s=t,r=0;for(;s>=a;)s=Math.floor(s/1e3),r++;let i=s.toString(),f=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qad","Qid","Sxd","Spd"][r];return`${i}${f}`},Uo=Bo;n(),o(),l(),c(),d(),h(),u(),p(),y();var jo=(t,e,a="0")=>{let s=t.toString(),r=s.length;for(let i=0;i<e-r;i++)s=s+a;return s},Ho=jo;n(),o(),l(),c(),d(),h(),u(),p(),y();var Vo=(t,e,a="0")=>{let s=t.toString(),r=s.length;for(let i=0;i<e-r;i++)s=a+s;return s},Ko=Vo;n(),o(),l(),c(),d(),h(),u(),p(),y();var $o=(t,e)=>{let a=e?Math.random()>.5?1:-1:1;return Math.floor(Math.random()*t)*a},Ue=$o;n(),o(),l(),c(),d(),h(),u(),p(),y();var Wo=t=>t>0?1:t<0?-1:t===0?0:Number.NaN,zo=Wo;n(),o(),l(),c(),d(),h(),u(),p(),y();var qo=(t,e)=>{let{fractionalDigits:a=0,startAbbreviate:s=1e3,abbreviateStep:r=3,maxLength:i=-1,removeLastZero:f=!0,suffixes:m=["","k","m","b","t","q"]}=e||{},g=i===-1?99999999:i;if(t>=s){let x=Math.floor(t/re(10,r)),S=Math.floor((x.toString().length-1)/r)+1,P=(t/re(re(10,r),S)).toFixed(a),C=g-m[S].length,E=P.substring(0,C);return(f?Ja(E):E)+m[S]}let w=t.toFixed(a),A=g-m[0].length,v=w.substring(0,A);return f?Ja(v):v+m[0]},Ja=t=>{if(t.indexOf(".")<0)return t;for(let e=t.length-1;e>=0;e--){if(t[e]===".")return t.substring(0,e);if(t[e]!=="0")return t.substring(0,e+1)}return t},Yo=qo,Jo={getShortNumber:Uo,sign:zo,padEnd:Ho,padStart:Ko,random:Ue,toAbbreviatedString:Yo};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Qo=t=>{let e=t.replace(/[-_\s.]+(.)?/g,(a,s)=>s?s.toUpperCase():"");return e.substring(0,1).toUpperCase()+e.substring(1)},Qa=t=>{let e=t.replace(/[-_\s.]+(.)?/g,(a,s)=>s?s.toUpperCase():"");return e.substring(0,1).toLowerCase()+e.substring(1)},je=t=>{let e={};for(let a in t){let s=t[a],r=Qa(a);Array.isArray(s)?e[r]=s.map(i=>typeof i=="object"?je(i):i):typeof s=="object"?e[r]=je(s):e[r]=t[a]}return e},Xo=je;n(),o(),l(),c(),d(),h(),u(),p(),y();var Xa=(t,e)=>{let a={};for(let s in e)if(Q(e,s))if(Q(t,s)){let r=t[s],i=e[s];if(M(r)&&M(i)&&r!==null&&i!==null&&typeof r!="function"&&typeof i!="function"){let f=Xa(r,i);Object.keys(f).length>0&&(a[s]=f)}else Object.is(r,i)||(a[s]=i)}else a[s]=e[s];for(let s in t)Q(t,s)&&!Q(e,s)&&(a[s]=void 0);return a},Zo=Xa;n(),o(),l(),c(),d(),h(),u(),p(),y();var Za=(t,e)=>{let a={};for(let s in e)if(Q(e,s))if(M(e[s])&&e[s]!==null)if(M(t[s])&&t[s]!==null){if(typeof e[s]=="function")continue;let r=Za(t[s],e[s]);Object.keys(r).length>0&&(a[s]=r)}else Q(t,s)||(a[s]=Vt({},e[s]));else Q(t,s)||(a[s]=e[s]);return a},tl=Za;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var el=t=>["string","number","symbol"].indexOf(typeof t)>-1,ts=el,al=(t,e)=>{let a={};for(let s of t){let r=s[e];ts(r)&&(a[r]=s)}return a},sl=al;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var es=t=>t.replace(/([a-z])([A-Z])/g,"$1_$2").replace(/\s+/g,"_").toLowerCase(),He=t=>{let e={};for(let a in t){let s=t[a],r=es(a);Array.isArray(s)?e[r]=s.map(i=>typeof i=="object"?He(i):i):typeof s=="object"?e[r]=He(s):e[r]=t[a]}return e},rl=He;n(),o(),l(),c(),d(),h(),u(),p(),y();var il=t=>Object.keys(t).map(e=>t[e]),nl=il,ol={assign:Vt,camelCaseKeys:Xo,clone:Ba,clear:Fa,diff:Zo,hasOwn:Q,invert:$a,keyBy:sl,merge:ja,snakeCaseKeys:rl,vals:nl,filterDeep:tl};n(),o(),l(),c(),d(),h(),u(),p(),y();var as={};Br(as,{Signal:()=>ss,SignalAbortedError:()=>Ve,SignalController:()=>ll}),n(),o(),l(),c(),d(),h(),u(),p(),y();var Ve=class extends Error{constructor(t="Signal aborted with no reason"){super(t),this.name="SignalAbortedStopped"}},ss=class kr{state={type:"running"};callbacks=[];once(e){this.callbacks.push(e)}off(e){this.callbacks=this.callbacks.filter(a=>a!==e)}abort(e){let a=this.constructReason(e);this.state={type:"stopped",reason:a};for(let s of this.callbacks)s(a);this.callbacks=[]}get aborted(){return this.state.type==="stopped"}get reason(){if(this.state.type==="stopped")return this.state.reason}wrap(e){if(!this.aborted)return e}chain(e){e instanceof kr?e.once(a=>this.abort(a)):e.addEventListener("abort",()=>this.abort(e.reason),{once:!0})}promise(){return this.aborted?Promise.resolve(this.reason):new Promise(e=>{this.once(a=>e(a))})}constructReason(e){return e instanceof Error?e:typeof e=="string"?new Ve(e):new Ve}},ll=class{signal;renew(){this.signal?.abort();let t=new ss;return this.signal=t,t}abort(){this.signal?.abort()}promise(){return this.signal===void 0?Promise.resolve(void 0):this.signal.promise()}},cl=as;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var dl=t=>t&&t[0].toUpperCase()+t.slice(1),hl=dl;n(),o(),l(),c(),d(),h(),u(),p(),y();function ul(t,e=2){let a=[],s=t.split(" "),r=s.length;for(let i=r;i>=1;i--)for(let f=0;f<=r-i;f++){let m=s.slice(f,f+i).join(" ");t.split(m).length-1>=e&&a.indexOf(m)<0&&m.length>1&&a.push(m)}return a.sort((i,f)=>i.length-f.length)}var yl=ul;n(),o(),l(),c(),d(),h(),u(),p(),y();var Pt=null,pl="Anonymous",fl=async()=>{let t="https://randommer.io/api/Name",{RandomNameApiKey:e}=Ludex.Configs.Mockup.Profile,a=await fetch(t,{method:"GET",headers:{"X-Api-Key":e,"Content-Type":"application/json"},body:JSON.stringify({nameType:"surname",quantity:1e3})});if(!a.ok)throw new Error("Can't fetch names");let s=await a.json();if(!M(s)||!Q(s,"data")||!Array.isArray(s.data))throw new Error("Invalid names response");return s.data},ml=async()=>{try{if(!Pt&&(Pt=await fl(),!Pt))throw new Error("Cannot fetch names");let t=Pt[Ue(Pt.length)],e=Pt[Ue(Pt.length)];return`${t} ${e}`}catch{return pl}},gl=ml;n(),o(),l(),c(),d(),h(),u(),p(),y();var wl=(t=16)=>{let e=r=>Math.floor(r).toString(t),a=e(Date.now()/1e3),s=Array(t+1).join(" ");return a+s.replace(/./g,()=>e(Math.random()*t))},Al=wl;n(),o(),l(),c(),d(),h(),u(),p(),y();var vl=t=>{let e=t?t.split("_"):[],a=e.length>0?e[0]:"en_US";switch(a){case"id":case"in":a="id";break}return a},Dl=vl;n(),o(),l(),c(),d(),h(),u(),p(),y();var Il=(t,e)=>{let a=t.split(" "),s=(a.length<=1?[...a]:[a[0],a.pop()]).join(" "),r=s.lastIndexOf(" ")||0,i=r>=0?r:e;return(s.length>e?s.substring(0,i):s).substring(0,e)},xl=Il;n(),o(),l(),c(),d(),h(),u(),p(),y();var Sl=t=>{let e=0;if(t.length===0)return e;for(let a=0;a<t.length;a++){let s=t.charCodeAt(a);e=(e<<5)-e+s,e=e&e}return e},El=Sl;n(),o(),l(),c(),d(),h(),u(),p(),y();var Pl=(t,e)=>{for(let a=0;a<e.length;a++)if(t[a]!==e[a])return!1;return!0},bl=Pl;n(),o(),l(),c(),d(),h(),u(),p(),y();var Ll=(t,e,a=" ")=>{let s=Math.floor(e);if(t.length>=s)return t;let r=s-t.length,i="";for(let f=0;f<r;f++)i+=a;return i.slice(0,r)+t},Cl=Ll;n(),o(),l(),c(),d(),h(),u(),p(),y();var Nl=t=>Object.keys(t).reduce((e,a)=>{let s=t[a];return s!==void 0&&e.push(`${a}=${s}`),e},[]).join("&"),Tl=Nl;n(),o(),l(),c(),d(),h(),u(),p(),y();var _l=(t,e)=>{let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*#%&!",s="",r=t;e!==void 0&&(r-=e.length,s+=e);for(let i=0;i<r;i++){let f=Math.floor(Math.random()*a.length);s+=a.charAt(f)}return s},Ol=_l;n(),o(),l(),c(),d(),h(),u(),p(),y();var Rl="0123456789ABCDEF",Ml=(t="0x")=>{let e=t;for(let a=0;a<6;a++)e+=Rl[Math.floor(Math.random()*16)];return e},kl=Ml;n(),o(),l(),c(),d(),h(),u(),p(),y();var Fl=t=>t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,e=>e==="\u0111"?"d":"D"),Gl=Fl;n(),o(),l(),c(),d(),h(),u(),p(),y();function Bl(t){let e=Ul(t),a=e%rs.length,s=(e>>8)%is.length,r=(e>>16)%1e4;return`${rs[a]}${is[s]}${r}`}var Ul=t=>{let e=0;for(let a=0;a<t.length;a++){let s=t.charCodeAt(a);e=(e<<5)-e+s,e=e|0}return e=Math.abs(e),e},rs=["James","Mary","John","Patricia","Robert","Jennifer","Michael","Linda","William","Elizabeth","David","Susan","Richard","Jessica","Joseph","Sarah","Thomas","Karen","Charles","Nancy","Christopher","Lisa","Daniel","Margaret","Matthew","Betty","Anthony","Sandra","Mark","Ashley","Donald","Dorothy","Steven","Kimberly","Paul","Emily","Andrew","Donna","Joshua","Michelle","Kenneth","Carol","Kevin","Amanda","Brian","Melissa","George","Deborah"],is=["Smith","Johnson","Williams","Jones","Brown","Davis","Miller","Wilson","Moore","Taylor","Anderson","Thomas","Jackson","White","Harris","Martin","Thompson","Garcia","Martinez","Robinson","Clark","Rodriguez","Lewis","Lee","Walker","Hall","Allen","Young","Hernandez","King","Wright","Lopez","Hill","Scott","Green","Adams","Baker","Gonzalez","Nelson","Carter","Mitchell","Perez","Roberts","Turner","Phillips","Campbell","Parker","Evans"],jl={toCamelCase:Qa,toUpperCamelCase:Qo,capitalize:hl,generateObjectId:Al,getLanguageCode:Dl,getShortName:xl,hashCode:El,matchStart:bl,padStart:Cl,params:Tl,random:Ol,randomColor:kl,removeDiacritics:Gl,findDuplicateSubstrings:yl,generateNameAsync:gl,toSnakeCase:es,generateNameUsingString:Bl};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var ns=[60,3600,86400,86400*7,86400*30,86400*365,Number.POSITIVE_INFINITY],Hl=["second","minute","hour","day","week","month","year"],Vl=(t,e,a,s="Soon")=>{try{let r=e??"en",i=a??{numeric:"auto"},f=Math.round((t*1e3-Date.now())/1e3),m=Math.abs(Math.round((t*1e3-Date.now())/1e3)),g=ba(ns,A=>A>m),w=g?ns[g-1]:1;return new Intl.RelativeTimeFormat(r,i).format(Math.floor(f/w),Hl[g])}catch(r){if(s!==void 0)return"Soon";throw r}},Kl=Vl;n(),o(),l(),c(),d(),h(),u(),p(),y();var $l=t=>{let e=new Date(t),a=e.getUTCHours(),s=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds(),f=a<10?`0${a}`:`${a}`,m=s<10?`0${s}`:`${s}`,g=r<10?`0${r}`:`${r}`,w=`${i}`;return i<10?w=`00${i}`:i<100&&(w=`0${i}`),`${f}:${m}:${g}:${w}`},Wl=$l;n(),o(),l(),c(),d(),h(),u(),p(),y();var zl=t=>{let e=new Date(t),a=new Date;return e.getDate()===a.getDate()&&e.getMonth()===a.getMonth()&&e.getFullYear()===a.getFullYear()},ql=zl;n(),o(),l(),c(),d(),h(),u(),p(),y();var Yl=t=>new Promise(e=>setTimeout(e,t)),Jl=Yl,Ql={isToday:ql,sleepAsync:Jl,getRelativeTime:Kl,getTimeString:Wl};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Xl=t=>typeof t=="boolean",Zl=Xl;n(),o(),l(),c(),d(),h(),u(),p(),y();var tc=()=>!!codex?.player?.getPlayerDataByKey("debug"),ec=tc;n(),o(),l(),c(),d(),h(),u(),p(),y();var ac=t=>typeof t=="function",os=ac;n(),o(),l(),c(),d(),h(),u(),p(),y();var sc=t=>typeof t=="number",rc=sc;n(),o(),l(),c(),d(),h(),u(),p(),y();var ic=t=>os(t)?t instanceof Promise||"then"in t&&typeof t.then=="function"?!0:t.constructor.name==="AsyncFunction":!1,nc=ic;n(),o(),l(),c(),d(),h(),u(),p(),y();var oc=(t,e,a)=>{let{timeout:s=1e3,checkInterval:r=16}=a??{},i,f;return new Promise((m,g)=>{if(typeof t!="function")throw new Error("Input from must be a function");f=setInterval(()=>{let w=t(),A=typeof e=="function"?e():e;w===A&&(clearTimeout(i),clearInterval(f),m(!0))},r),s>0&&(clearTimeout(i),i=setTimeout(()=>{clearInterval(f),g(new Error("Timeout"))},s))})},lc=oc,cc={isBoolean:Zl,isDebugger:ec,isEmpty:Ce,isFalsy:Ca,isFunction:os,isNumber:rc,isObject:M,isPromise:nc,isPropertyKey:ts,isString:Wa,isValueChangeAsync:lc},dc={Array:gi,Browser:gn,Decorator:Fe,Device:Cn,Function:Kn,Hash:yo,Image:Ro,Json:Mo,Mark:Go.Mark,Object:ol,Signal:cl,String:jl,Number:Jo,Time:Ql,Valid:cc},hc=dc,uc=Object.preventExtensions({Dtos:{},Utils:Object.freeze(hc),Match:Object.freeze({Modes:Object.freeze(Sa)}),Events:Object.freeze(mt),Configs:Object.seal(jr),Plugins:Object.seal({Ads:null,Audio:null,Analytics:null})});window.Ludex=uc,window.TypeGuard=qr,window.GameName="Tile Connect",window.BuildVersion=15,n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:Ft,Object:bt,String:Ke,Json:ls}=Ludex.Utils,Kt="is invalid",yc=class nt{static strict={};static data={};static addDefaultData(e){Ft.isObject(e)||this.prototype.t("default data",Kt),e=ls.clone(e);let{name:a}=this;Ft.isObject(nt.data[a])||(nt.data[a]={}),nt.data[a]=bt.merge(nt.data[a],e)}static getDefaultData(){let{name:e}=this;return ls.clone(nt.data[e])}static addValidateFunction(e,a){Ft.isString(e)||this.prototype.t("validate key",Kt),typeof a!="function"&&this.prototype.t("validate function",Kt);let s=`validate${Ke.capitalize(e)}`;bt.assign(this.prototype,{[s]:a})}constructor(e){this.defaultData(),this.processData(e)}static makeStrict(){nt.strict[this.name]=!0}static makeLoose(){nt.strict[this.name]=!1}processData(e){this.n(e),this.o(e),this.setupData(e)}defaultData(){let{name:e}=this.constructor;this.y(nt.data[e])}y(e){Ft.isObject(e)||this.t("data",Kt);for(let a in e)if(bt.hasOwn(e,a)){let s=e[a];bt.assign(this,{[a]:s})}}l(e){Ft.isObject(e)||this.t("structure","is not object");let a=this.getKeys();for(let s of a){let r=this[s];r===void 0&&this.t("structure",`has no key ${s}`),!bt.hasOwn(e,s)&&r!==void 0&&this.h(s,e)}}h(e,a){Ft.isObject(a)||this.t("data",Kt);let s=this[e];s===void 0&&this.t("default",`has no key ${e}`),bt.assign(a,{[e]:s})}c(e){let a=this.getKeys();for(let s of a){let r=e[s],i=Ke.removeDiacritics(s).replace(/[^a-zA-Z0-9]/g,""),f=`validate${Ke.capitalize(i)}`,m=this[f];if(typeof m=="function")try{m.call(this,r)}catch(g){if(nt.strict[this.constructor.name])throw g;this.h(s,e)}else this.t("validate",`has no function ${f}`)}}d(e){let a=this.getKeys();for(let s of a){let r=e[s];bt.assign(this,{[s]:r})}}t(e,a){throw new Error(`${this.constructor.name}: ${e} ${a}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject"&&e!=="strict")}},lt=yc;Ludex.Dtos={Base:lt},n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var pc=class{codex;plugins;constructor(t){this.codex=t,this.plugins={}}install(t,e,a,s){if(typeof e!="function"){GameSDK.getSDKName();return}let r=new e(this.codex);this.plugins[t]=r,a&&Object.defineProperty(this.codex,s,{get:()=>r}),r.init()}get(t){return this.plugins[t]}},fc=pc;n(),o(),l(),c(),d(),h(),u(),p(),y();var mc=class{codex;constructor(t){this.codex=t}init(){}},gc=mc,wc=class{codex;plugins;ads;auth;audio;event;match;player;profile;context;storage;language;missions;analytics;visibility;leaderboard;dailyRewards;remoteConfig;frameCapture;firebase;monitorError;adaptivePerformance;inputRecorder;console;profiler;canvasRecorder;constructor(){this.codex=this,this.plugins=new fc(this.codex)}async boot(){}async start(){}getBuildVersion(){return 0}};window.Ludex.Plugins={BasePlugin:gc};var Ac=wc;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var vc=class extends Error{payload;constructor(t,e){super(t),this.name="BadRequest",this.message=t??"This request is bad",this.payload=e}},$e=vc;n(),o(),l(),c(),d(),h(),u(),p(),y();var Dc=class extends Error{payload;constructor(t,e){super(t),this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=e}},We=Dc,{Utils:{Valid:Ic,Time:xc},Configs:{AppId:cs,Network:ze}}=Ludex,Sc=t=>{if(!t.ok)throw new $e(void 0,{response:t})},ds=()=>{let t=codex.auth.getToken();return{token:t,timeout:ze.Timeout,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}},hs=(t,e,a,s)=>async()=>{try{if(!cs)throw new $e("AppId is not defined");let r=`${t}/apps/${cs}/${e}`,i=new AbortController;a.signal=i.signal;let f=setTimeout(()=>{i.abort()},a.timeout);Ic.isObject(s)&&(a.body=JSON.stringify(s));let m=await fetch(r,a);return clearTimeout(f),Sc(m),await m.json()||{}}catch(r){if(r instanceof $e)return null;throw r instanceof Object&&"name"in r&&r.name==="AbortError"?new We:r}},qe=async(t,e)=>{try{return t()}catch(a){if(a instanceof We&&e>0)try{return await xc.sleepAsync(600),await qe(t,e-1)}catch{return{}}return a instanceof We?{}:{}}},Gt=async(t,e,a,s=ze.Retries)=>{try{let r=L(I(I({},ds()),e),{method:"GET"}),i=hs(a,t,r);return await qe(i,s)}catch{return{}}},et=async(t,e,a,s,r=ze.Retries)=>{try{let i=L(I(I({},ds()),a),{method:"POST"}),f=hs(s,t,i,e);return await qe(f,r)}catch{return{}}},{Configs:{Notification:{ApiUrl:Ec}},Utils:{Object:Pc}}=Ludex,bc=async t=>{if(!Pc.hasOwn(t,"playerId"))throw new Error("Missing playerId");let{playerId:e}=t;await et(`players/${e}`,t,{},Ec,10)};n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Lc={score:"score",settings:"settings",isFirstLogin:"isFirstLogin",gameData:"gameData",missionsData:"missionsData",notificationData:"notificationData",dailyRewardedData:"dailyRewardedData",lastCallSwitchGame:"lastCallSwitchGame",remoteConfig:"remoteConfig"},Cc=Lc;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Nc={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{score:0,isFirstLogin:!0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},notificationData:{D1:{arrivalDate:0},D2:{arrivalDate:0},D3:{arrivalDate:0},D4:{arrivalDate:0},D5:{arrivalDate:0},D6:{arrivalDate:0},D7:{arrivalDate:0}},missionsData:{process:{}},lastCallSwitchGame:0}},gt=Nc,{Valid:$t}=Ludex.Utils,{playerId:Tc,name:_c,photo:Oc,locale:Rc}=gt,Wt="is invalid",us=class extends lt{setupData(t){this.d(t)}n(t){this.l(t)}o(t){this.c(t)}validateId(t){(!$t.isString(t)||!t)&&this.t("_id",Wt)}validatePlayerId(t){(!$t.isString(t)||!t)&&this.t("playerId",Wt)}validateName(t){(!$t.isString(t)||!t)&&this.t("name",Wt)}validatePhoto(t){$t.isString(t)||this.t("photo",Wt)}validateLocale(t){(!$t.isString(t)||!t)&&this.t("locale",Wt)}toObject(){return super.toObject()}};us.addDefaultData({playerId:Tc,name:_c,photo:Oc,locale:Rc});var Ye=us,Mc=new Ye({playerId:"10",name:"Your Friend"}).toObject(),ct=Mc;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var kc=class extends Error{code;constructor(t){super(t),this.code="CREATE_MATCH_FAILED"}},dt=kc,Fc=class extends dt{constructor(t){super(t),this.name="PlayerIdNotValid",this.message=t??"Player id is not valid"}},N=Fc,{Dtos:Je,Utils:{Array:Gc,Object:Bc,Json:zm,Valid:Qe},Events:Uc}=Ludex,jc=class{codex;constructor(t){this.codex=t}initContext=()=>{let t={contextId:GameSDK.context.getID()??"",contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},e=new Je.Context.Info(t),{contextId:a,contextType:s,entryPointData:r}=e.toObject();this.codex.context.receiveContext(a,s,r)};initPlayer=async()=>{try{let{player:t}=this.codex,e=this.getPlayerInfo(),a=Gc.unique(Bc.vals(Cc)),s=await GameSDK.player.getDataAsync(a),r=new Je.Player.Data(s).toObject();t.receiveData(e,r)}catch{}finally{this.codex.event.emit(Uc.PLAYER_INFO_LOADED)}};getPlayerInfo=()=>{try{let t=GameSDK.player.getID(),e=GameSDK.player.getName(),a=GameSDK.player.getPhoto(),s=GameSDK.getLocale();if(!Qe.isString(t))throw new N;return Qe.isString(e)||(e="You"),(!Qe.isString(s)||!s)&&(s="en"),new Je.Player.Info({playerId:t,name:e,photo:a,locale:s}).toObject()}catch{return ct}}},Hc=jc;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var ys=(t=>(t.IDLE="idle",t.LOADING="loading",t.FILLED="filled",t.SHOWING="showing",t))(ys||{}),ps=ys;n(),o(),l(),c(),d(),h(),u(),p(),y();var fs=(t=>(t.BANNER="banner",t.INTERSTITIAL="interstitial",t.REWARDED_VIDEO="rewarded_video",t.REWARDED_INTERSTITIAL="rewarded_interstitial",t))(fs||{}),at=fs;n(),o(),l(),c(),d(),h(),u(),p(),y();var Vc=class extends Error{code;constructor(t,e){super(e),this.code=t,this.message=e}},ne=Vc;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Kc=class{type;service;placementId;_status;constructor(t,e){this.type=t,this._status=ps.IDLE,this.placementId=e}setStatus(t){this._status!==t&&(this._status=t)}get status(){return this._status}t(t){throw new ne("AD_INSTANCE_ERROR",t)}},$c=Kc,Wc=class extends $c{loadAsync(){this.t("This method is not implemented")}showAsync(){this.t("This method is not implemented")}hideAsync(){this.t("Unsupported method")}},ms=Wc;Ludex.Plugins.Ads={Types:at,Status:ps,AdError:ne,AdInstance:ms};var{Utils:{Array:oe,Object:gs,Function:zc}}=Ludex,qc=class extends Ludex.Plugins.BasePlugin{enabled;config;lastCallAdShownTime;isAdFullSizeShowed;ads={};safeAreaBottom;degradationTracking={failedAttempts:0,lastSuccessTime:0};init(){this.lastCallAdShownTime={[at.BANNER]:0,[at.INTERSTITIAL]:0,[at.REWARDED_VIDEO]:0,[at.REWARDED_INTERSTITIAL]:0},this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom(),this.resetDegradationTracking()}calculateSafeAreaBottom(){try{let t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new ne("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(t,e,a){let s=`${t}-${e}`;this.ads[s]||(this.ads[s]={type:t,placementId:e,interval:null,instance:new a(t,e)})}async loadAdAsync(t,e){this.checkEnabled();try{await this.getAd(t,e).instance.loadAsync()}catch(a){throw this.degradationTracking.failedAttempts++,a}}async showAdAsync(t,e){if(this.checkEnabled(),!this.canShowAd(t,e))return;let{event:a}=this.codex,s=this.getAd(t,e);try{a.emit(Ludex.Events.AD_SHOWING,{type:t,placementId:e}),this.isAdFullSizeShowed=!0,await s.instance.showAsync(),this.resetDegradationTracking(),this.lastCallAdShownTime[t]=Date.now()/1e3}catch(r){throw this.degradationTracking.failedAttempts++,r}finally{a.emit(Ludex.Events.AD_CLOSED,{type:t,placementId:e}),this.isAdFullSizeShowed=!1}}getAdStatus(t,e){return this.checkEnabled(),this.getAd(t,e).instance.status}getAd(t,e){let a=null;if(e?a=this.getAdByPlacementId(e,t):a=this.getPriorityAdByType(t),!a)throw new ne("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}getAdsByType(t){return gs.vals(this.ads).filter(e=>e.type===t)}getAdByPlacementId(t,e){let a=gs.vals(this.ads);return oe.search(a,r=>r.placementId===t&&(!e||r.type===e))||null}getPriorityAdByType(t){let e=this.getAdsByType(t);return e.length&&oe.search(e,s=>s.type===t)||null}canShowAd(t,e){return this.canShowAdByTime(t,e)}canShowAdByTime(t,e){try{let a=Date.now()/1e3,s;if(e)s=this.getCommonAdConfig(e);else{let w=this.getPriorityAdByType(t);if(!w)return!1;s=this.getCommonAdConfig(w.placementId)}let{SecondsBetweenAds:r,SecondsFirstTime:i}=s,f=a-this.lastCallAdShownTime[t],m=f>r,g=f>i;return this.lastCallAdShownTime[t]>0?m:g}catch{return!1}}canShowBannerAd(t){try{let e=this.getBannerConfig(t),{Platform:a}=e;if(a==="ALL")return!0;let s=GameSDK.getPlatform();return s?s===a:!1}catch{return!1}}async showBannerAdAsync(t,e=!0){this.checkEnabled();let a=this.getAd(at.BANNER,t);if(!this.canShowBannerAd(a.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(a),e?await this.showBannerAdWithSchedule(a):await this.showBannerAdOnce(a)}async showBannerAdOnce(t){let{event:e}=this.codex;if(!this.isAdFullSizeShowing())try{await t.instance.loadAsync(),await t.instance.showAsync(),e.emit(Ludex.Events.AD_SHOWING,{type:at.BANNER,placementId:t.placementId})}catch(a){let s=zc.toError(a);if(s.code!=="AD_NOT_FILLED")try{await t.instance.hideAsync()}catch{}e.emit(Ludex.Events.AD_FAILED,{type:at.BANNER,placementId:t.placementId,error:s})}}async showBannerAdWithSchedule(t){await this.showBannerAdOnce(t);let e=this.getBannerConfig(t.placementId),{SecondsReload:a}=e;if(a<=0||!a)return;let s=()=>this.showBannerAdWithSchedule(t);t.interval=setTimeout(s,a*1e3)}async hideBannerAdAsync(t){this.checkEnabled();let e=this.getAd(at.BANNER,t);this.cleanBannerReloadTimer(e),await e.instance.hideAsync();let{event:a}=this.codex;a.emit(Ludex.Events.AD_CLOSED,{type:at.BANNER,placementId:t})}cleanBannerReloadTimer(t){try{let{interval:e}=t;if(!e)return;clearInterval(e)}catch{}}getCommonAdConfig(t){let e=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions,...this.config.RewardedInterstitialAdOptions],a=oe.search(e,s=>s.PlacementId===t);if(!a)throw new Error(`Ad config with placementId ${t} not found`);return a}getBannerConfig(t){let e=oe.search(this.config.BannerDisplayAdOptions,a=>a.PlacementId===t);if(!e)throw new Error(`Banner config with placementId ${t} not found`);return e}getBannerHeight(t,e,a=!0){this.checkEnabled();let s=this.getBannerConfig(t),r=GameSDK.getBannerHeight(s);return a?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(r+this.safeAreaBottom)*e):r*e}getSafeAreaBottom(t){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*t}resetDegradationTracking(){this.degradationTracking={failedAttempts:0,lastSuccessTime:Date.now()}}isServiceDegraded(){let t=Date.now(),{MaxFailedAttempts:e,ResetTimeMinutes:a}=this.config.DegradationTracking,{lastSuccessTime:s,failedAttempts:r}=this.degradationTracking;return t-s>a*60*1e3&&this.resetDegradationTracking(),r>=e}},Yc=qc,Jc=Yc;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Qc={APP_LAUNCH:"app_launch",APP_INITIALIZED:"app_initialized",ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",USE_ITEM:"use_item",EARN_ITEM:"earn_item",GET_FREE_ITEM:"get_free_item",SHARE:"share",INVITE:"invite",MESSAGE:"message",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_INIT:"ad_init",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOWING:"ad_showing",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",SWITCH_GAME_POPUP:"switch_game_popup",SWITCH_GAME:"switch_game"},D=Qc;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Xc=class{history=[];missing=[];outOfOrder=[];completed=!1;failed=!1;warned=[];debug=!1;addEvent(t,e){if(this.completed||this.failed){this.debugLog("Skip event:",t);return}this.history.push(t),this.validateAndUpdate(t)}validateAndUpdate(t){let e=this.validateFunnelState();if(e.hasFailed){this.failed=!0,this.logValidationError();return}e.hasWarnings&&this.handleWarnings(e.warnings),this.checkFunnelCompletion(t)}validateFunnelState(){let t={hasFailed:!1,hasWarnings:!1,warnings:[]},e=this.getCurrentSteps().filter(s=>s.e);for(let s=0;s<e.length;s++){let r=e[s],i=this.history.indexOf(r.name);if(i===-1)return this.missing=[r.name],t.hasFailed=!0,t;if(s>0){let f=e[s-1];if(this.history.indexOf(f.name)>i)return this.missing=[f.name],t.hasFailed=!0,t}}let a=this.validateDependencies();return a.length>0&&(t.hasWarnings=!0,t.warnings=a,this.outOfOrder=a),t}getCurrentSteps(){let t=this.history[this.history.length-1],e=this.funnelSteps.findIndex(a=>a.name===t);return this.funnelSteps.slice(0,e+1)}validateDependencies(){let t=[];return this.history.forEach((e,a)=>{let s=this.funnelSteps.find(i=>i.name===e);if(!s?.r?.length)return;let r=s.r.find(i=>!this.history.includes(i)||this.history.indexOf(i)>a);r&&!this.warned.includes(e)&&(t.push({event:e,missingDependency:r}),this.warned.push(e))}),t}checkFunnelCompletion(t){let e=this.funnelSteps[this.funnelSteps.length-1];t===e.name&&this.funnelSteps.filter(a=>a.e).every(a=>this.history.includes(a.name))&&(this.completed=!0,this.logCompletion())}handleWarnings(t){for(let e of t);}logValidationError(){let t=this.constructor.name;this.missing.length}logCompletion(){let t=this.constructor.name,e=this.outOfOrder.length>0}debugLog(...t){this.debug}isFunnelCompleted(){return this.completed}isFunnelFailed(){return this.failed}getEventHistory(){return[...this.history]}getMissingEvents(){return[...this.missing]}getOutOfOrderEvents(){return[...this.outOfOrder]}},le=Xc,Zc=class extends le{debug=!1;funnelSteps=[{name:D.AD_INIT,e:!0,i:{service:"adsense"},a:"Init adsense ad"},{name:D.AD_LOAD_FAILED,e:!1,i:{service:this.service},a:"Platform ad load failed (trigger for adsense)"},{name:D.AD_LOAD,e:!0,i:{service:"adsense"},a:"Start loading adsense ad"},{name:D.AD_LOAD_FAILED,e:!1,r:[D.AD_LOAD],i:{service:"adsense"},a:"Adsense ad load failed"},{name:D.AD_SHOWING,e:!0,r:[D.AD_LOAD],i:{service:"adsense"},a:"Adsense ad is showing"},{name:D.AD_SHOW,e:!1,r:[D.AD_SHOWING],i:{service:"adsense"},a:"Adsense ad shown successfully"},{name:D.AD_SHOW_FAILED,e:!1,r:[D.AD_SHOWING],i:{service:"adsense"},a:"Adsense ad show failed"},{name:D.AD_LOAD,e:!1,i:{service:"adsense"},a:"Preload adsense ad"}];get service(){return GameSDK?.getSDKName()??"Ludex"}addEvent(t,e){let{service:a}=e??{};!a||!(a==="adsense"||t===D.AD_LOAD_FAILED&&a==="platform")||super.addEvent(t,e)}},td=Zc;n(),o(),l(),c(),d(),h(),u(),p(),y();var ed=class extends le{debug=!1;funnelSteps=[{name:D.APP_LAUNCH,e:!0,a:"Application launched"},{name:D.APP_INITIALIZED,e:!0,r:[D.APP_LAUNCH],a:"Application initialized"},{name:D.ENGINE_READY,e:!0,r:[D.APP_INITIALIZED],a:"Game engine initialized"},{name:D.LOAD_START,e:!0,r:[D.ENGINE_READY],a:"Start loading game assets"},{name:D.LOAD_COMPLETE,e:!0,r:[D.LOAD_START],a:"Game assets loaded completely"},{name:D.APP_READY,e:!0,r:[D.LOAD_COMPLETE],a:"Game is ready to play"}]},ad=ed;n(),o(),l(),c(),d(),h(),u(),p(),y();var sd=class extends le{debug=!1;funnelSteps=[{name:D.AD_INIT,e:!0,i:{service:this.service},a:"Init platform ad"},{name:D.AD_LOAD,e:!0,i:{service:this.service},a:"Start loading platform ad"},{name:D.AD_LOAD_FAILED,e:!1,r:[D.AD_LOAD],i:{service:this.service},a:"Platform ad load failed"},{name:D.AD_SHOWING,e:!0,r:[D.AD_LOAD],i:{service:this.service},a:"Platform ad is showing"},{name:D.AD_SHOW,e:!1,r:[D.AD_SHOWING],i:{service:this.service},a:"Platform ad shown successfully"},{name:D.AD_SHOW_FAILED,e:!1,r:[D.AD_SHOWING],i:{service:this.service},a:"Platform ad show failed"},{name:D.AD_LOAD,e:!1,i:{service:this.service},a:"Preload platform ad"}];get service(){return GameSDK?.getSDKName()??"Ludex"}addEvent(t,e){e?.service===this.service&&super.addEvent(t,e)}},rd=sd;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Utils:{String:Lt,Valid:id}}=Ludex,nd=class{codex;name;color;options;selfLog;currentPath;constructor(t,e,a){this.codex=t,this.name=e,this.options=a,this.color=a.color||"#FFF",this.selfLog=a.log,this.currentPath="/"}event(t,e){this.logInfo("event",{name:t,payload:e});let a=this.formatEventName(t);this.processEvent(a,e)}logInfo(t,e){this.selfLog}pageview(t){let e=this.getPageTitle(t);e=this.addGameModeToPageTitle(e),document.title=e,this.event(D.PAGE_VIEW,{path_path:t,page_title:e})}levelStart(t,e,a){this.event(D.LEVEL_START,{level:t,score:e,level_name:this.getLevelName(t),game_mode:a?Lt.toUpperCamelCase(a):void 0})}levelFail(t,e,a){this.event(D.LEVEL_END,{level:t,score:e,success:!1,level_name:this.getLevelName(t),game_mode:a?Lt.toUpperCamelCase(a):void 0})}levelRescue(t,e,a){this.event(D.LEVEL_RESCUE,{level:t,score:e,level_name:this.getLevelName(t),game_mode:a?Lt.toUpperCamelCase(a):void 0})}levelComplete(t,e,a){this.event(D.LEVEL_END,{level:t,score:e,success:!0,level_name:this.getLevelName(t),game_mode:a?Lt.toUpperCamelCase(a):void 0})}initAdEvent(t){let{adService:e,state:a}=t;this.event(D.AD_INIT,{ad_service:e,state:a})}loadAdEvent(t){let{type:e,placement:a,service:s}=t;this.event(D.AD_LOAD,{ad_type:e,screen_name:a,ad_service:s})}showAdEvent(t){let{type:e,placement:a,service:s}=t;this.event(D.AD_SHOW,{ad_type:e,screen_name:a,ad_service:s})}loadInterstitialAd(t){let{placement:e,service:a}=t;this.loadAdEvent({type:"interstitial",placement:e,service:a})}showInterstitialAd(t){let{placement:e,service:a}=t;this.showAdEvent({type:"interstitial",placement:e,service:a})}loadRewardedVideoAd(t){let{placement:e,service:a}=t;this.loadAdEvent({type:"rewarded_video",placement:e,service:a})}showRewardedVideoAd(t){let{placement:e,service:a}=t;this.showAdEvent({type:"rewarded_video",placement:e,service:a})}receiveVideoReward(t){let{placement:e,service:a}=t;this.event(D.AD_REWARD,{screen_name:e,ad_service:a})}loadRewardedInterstitialAd(t){let{placement:e,service:a}=t;this.loadAdEvent({type:"rewarded_interstitial",placement:e,service:a})}showRewardedInterstitialAd(t){let{placement:e,service:a}=t;this.showAdEvent({type:"rewarded_interstitial",placement:e,service:a})}receiveInterstitialReward(t){let{placement:e,service:a}=t;this.event(D.AD_REWARD,{screen_name:e,ad_service:a})}loadAdFail(t){let{type:e,placement:a,service:s}=t;this.event(D.AD_LOAD_FAILED,{ad_type:e,screen_name:a,ad_service:s})}showAdFail(t){let{type:e,placement:a,service:s}=t;this.event(D.AD_SHOW_FAILED,{ad_type:e,screen_name:a,ad_service:s})}showingAd(t){let{type:e,placement:a,service:s}=t;this.event(D.AD_SHOWING,{ad_type:e,screen_name:a,ad_service:s})}formatEventName(t){return t.toLowerCase().replace(/:/g,"_")}getLevelName(t){return`Level ${Lt.padStart(t.toString(),5,"0")}`}getPageTitle(t){let e=t.split("/").pop();if(!id.isString(e))return t;let a=e.replace(/([-_\s.])/g," $1");return Lt.toUpperCamelCase(a)}addGameModeToPageTitle(t){let{match:e}=this.codex,a=e.getMatchState(),{mode:s}=a;return s||(s="Normal"),`${Lt.toUpperCamelCase(s)}::${t}`}},od=nd;Ludex.Plugins.Analytics={Events:D,BaseFunnel:le,BaseAnalytics:od};var ld=class extends Ludex.Plugins.BasePlugin{analytics=[];placement="unknown";funnels=[];constructor(t){super(t),this.initFunnels()}add(t){let e=this.analytics.findIndex(a=>a.name===t.name);e!==-1?this.analytics[e]=t:this.analytics.push(t)}isActive(){return this.analytics.length>=1}initFunnels(){this.addFunnel(new ad),this.addFunnel(new td),this.addFunnel(new rd)}addFunnel(t){this.funnels.push(t)}s(t,e){for(let a of this.funnels)a.addEvent(t,e)}pageview=t=>{if(!this.isActive())return;this.placement=t;let e=this.getPageByKey(t);for(let a of this.analytics)a.pageview(e);this.s(D.PAGE_VIEW)};event(t,e){if(this.isActive()){for(let a of this.analytics)a.event(t,e);this.s(t,e)}}levelStart(t,e,a){if(this.isActive()){for(let s of this.analytics)s.levelStart(t,e,a);this.s(D.LEVEL_START,{score:e,mode:a})}}levelRescue(t,e,a){if(this.isActive()){for(let s of this.analytics)s.levelRescue(t,e,a);this.s(D.LEVEL_RESCUE,{score:e,mode:a})}}levelFail(t,e,a){if(this.isActive()){for(let s of this.analytics)s.levelFail(t,e,a);this.s(D.LEVEL_END,{score:e,mode:a})}}levelComplete(t,e,a){if(this.isActive()){for(let s of this.analytics)s.levelComplete(t,e,a);this.s(D.LEVEL_END,{score:e,mode:a})}}async initAdEvent(t){if(this.isActive()){await this.codex.event.waitTo(D.APP_READY);for(let e of this.analytics)e.initAdEvent(t)}}loadInterstitialAd(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.loadInterstitialAd(e);this.s(D.AD_LOAD,e)}showInterstitialAd(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.showInterstitialAd(e);this.s(D.AD_SHOW,e)}loadRewardedVideoAd(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.loadRewardedVideoAd(e);this.s(D.AD_LOAD,e)}showRewardedVideoAd(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.showRewardedVideoAd(e);this.s(D.AD_SHOW,e)}receiveVideoReward(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.receiveVideoReward(e);this.s(D.AD_REWARD,e)}loadRewardedInterstitialAd(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.loadRewardedInterstitialAd(e);this.s(D.AD_LOAD,e)}showRewardedInterstitialAd(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.showRewardedInterstitialAd(e);this.s(D.AD_SHOW,e)}receiveInterstitialReward(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.receiveInterstitialReward(e);this.s(D.AD_REWARD,e)}loadAdFail(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.loadAdFail(e);this.s(D.AD_LOAD_FAILED,e)}showAdFail(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.showAdFail(e);this.s(D.AD_SHOW_FAILED,e)}showingAd(t){if(!this.isActive())return;let e=L(I({},t),{placement:this.placement});for(let a of this.analytics)a.showingAd(e);this.s(D.AD_SHOWING,e)}getPageByKey(t){let e=t;if(e.indexOf("_")>-1){let r=e.replace(/_/g,"-");return r=r.toLowerCase(),r}let a=e.length-1,s="";for(;a>0;){s=e.charAt(a);let r=isNaN(parseInt(s,10)),i=s===s.toUpperCase();r&&i&&(e=`${e.slice(0,a)}-${e.slice(a)}`),a--}return e.toLowerCase()}},cd=ld,dd=cd;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var hd=class{key;constructor(t){this.key=t}getKey(){return this.key}},ud=hd;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Decorator:ws}=Ludex.Utils,As=class{id;isMuteAll;masterVolume;audioClips;constructor(t){this.id=t,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(t){return this.audioClips[t]?this.audioClips[t]:null}setAudioClip(t,e){this.audioClips[t]=I(I({},this.audioClips[t]),e)}async play(t,e){let a=this.getAudioClip(t);if(a){let{audioPlayer:s}=a;this.playWithRealConfig(s,e)}else await this.loadAndPlay(t,e)}async loadAndPlay(t,e){let a=await this.onLoadAudio(t,e);if(!a)return;let{volume:s=1}=e||{};this.setAudioClip(t,{volume:s,audioPlayer:a}),this.playWithRealConfig(a,e)}playWithRealConfig(t,e){if(e){let{volume:a=1}=e;e.volume=this.masterVolume*a}t.play(e)}pause(t){let e=this.getAudioClip(t);if(!e)return!1;let{audioPlayer:a}=e;return a.pause(),!0}resume(t){let e=this.getAudioClip(t);if(!e)return!1;let{audioPlayer:a}=e;return a.resume(),!0}stop(t){let e=this.getAudioClip(t);if(!e)return!1;let{audioPlayer:a}=e;return a.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(t){this.masterVolume=t,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(t,e){try{let{audioPlayer:a,volume:s=1}=t;switch(e){case"play":a.play();break;case"pause":a.pause();break;case"resume":a.resume();break;case"stop":a.stop();break;case"mute":a.setVolume(0);break;case"unmute":case"setVolume":a.setVolume(this.masterVolume*s);break;default:throw new Error(`Unsupported function: ${e}`)}}catch{}}callAudioPlayers(t){let{Object:e}=Ludex.Utils,a=e.vals(this.audioClips);for(let s of a)this.queueAudioPlayer(s,t)}};W([ws.tryCatch(),ws.validateParams("string")],As.prototype,"loadAndPlay",1);var yd=As;Ludex.Plugins.Audio={BaseAudioPlayer:ud,BaseChannelManager:yd};var{Decorator:vs}=Ludex.Utils,Ds=class extends Ludex.Plugins.BasePlugin{firstChannelId;channels={};addChannel(t){let e=t.getId();this.channels[e]=t,this.firstChannelId||(this.firstChannelId=e)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];let e=this.channels[t];if(!e)throw new Error(`Channel ${t} not found`);return e}async play(t,e,a){await this.getChannel(a).play(t,e)}pause(t,e){try{this.getChannel(e).pause(t)}catch{}}resume(t,e){try{this.getChannel(e).resume(t)}catch{}}stop(t,e){try{this.getChannel(e).stop(t)}catch{}}stopAll(t){try{this.getChannel(t).stopAll()}catch{}}mute(t){try{this.getChannel(t).muteAll()}catch{}}unmute(t){try{this.getChannel(t).unmuteAll()}catch{}}setVolume(t,e){try{this.getChannel(e).setVolume(t)}catch{}}getVolume(t){try{return this.getChannel(t).getVolume()}catch{return-1}}};W([vs.tryCatch(),vs.validateParams("string")],Ds.prototype,"play",1);var pd=Ds,fd=pd;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var md={token:"",isRequesting:!1},gd=md,{Utils:{Object:wd}}=Ludex,Ad=class extends Ludex.Plugins.BasePlugin{init(){let{storage:t}=this.codex;t.addStorage("auth",gd)}async requestToken(){let{storage:t}=this.codex;try{if(t.getStorageData("auth","isRequesting")||t.getStorageData("auth","token")!=="")return;t.setStorageData("auth","isRequesting",!0);let e=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();t.setStorageData("auth","token",e)}catch(e){if(wd.hasOwn(e,"code")&&e.code==="PENDING_REQUEST")return;t.setStorageData("auth","token","")}finally{t.setStorageData("auth","isRequesting",!1)}}getToken(){let{storage:t}=this.codex;return t.getStorageData("auth","token")??""}},vd=Ad,Dd=vd;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Is=(t=>(t.SOLO="solo",t.TOURNAMENT="tournament",t.SHARE_INVITE="share_invite",t.MATCHING_GROUP="matching_group_match",t.CHALLENGE_FRIEND="challenge_friend_match",t))(Is||{}),Ct=Is;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Id=Sa,Nt=Id,{Configs:xd,Utils:{Array:Sd,Valid:Ed,Browser:Pd}}=Ludex,bd=class{codex;constructor(t){this.codex=t}isValidContextType(t){return["THREAD","POST","SOLO","GROUP"].indexOf(t)>=0}isValidEntryPointData(t){return Ed.isObject(t)}isTournamentEntryPoint(t){return Sd.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],t)}receiveContext(t,e,a){let{storage:s}=this.codex;s.setStorageData("context","contextId",t),this.isValidEntryPointData(a)&&s.setStorageData("context","entryPointData",a),this.isValidContextType(e)&&s.setStorageData("context","contextType",e)}async detectContextSessionType(){let{storage:t}=this.codex,e=t.getStorageData("context","entryPointData"),{type:a}=e??{},{SOLO:s,TOURNAMENT:r,MATCHING_GROUP:i,SHARE_INVITE:f,CHALLENGE_FRIEND:m}=Ct,g=s;a===r&&(g=r),a===i&&(g=i),(a===m||a===f)&&(g=m),g===s&&(xd.Core.FastCheckTournamentContext?g=this.fastCheckTournamentContext()||g:g=await this.outdatedCheckTournamentContext()||g),t.setStorageData("context","sessionContextType",g)}fastCheckTournamentContext(){let t=Pd.getQueryParams().entry_point;return typeof t!="string"||!this.isTournamentEntryPoint(t)?!1:Ct.TOURNAMENT}async outdatedCheckTournamentContext(){let{storage:t}=this.codex;if(!("getTournamentAsync"in GameSDK))return!1;try{let e=await GameSDK.getTournamentAsync();return t.setStorageData("context","contextId",e.getContextID()),e.getEndTime()>Date.now()/1e3?Ct.TOURNAMENT:!1}catch{return!1}}detectContextGameMode(){let{player:t,storage:e}=this.codex,a=e.getStorageData("context","entryPointData"),s=e.getStorageData("context","sessionContextType"),r=t.getPlayerId(),{matchId:i,playerId:f,opponentId:m=ct.playerId}=a??{},g=r===f,w=m===ct.playerId||[m,f].indexOf(r)>=0,{TOURNAMENT:A,MATCHING_GROUP:v,SHARE_INVITE:x,CHALLENGE_FRIEND:S}=Ct,P=Nt.SINGLE;s===A&&(P=Nt.TOURNAMENT),s===x&&!g&&(P=Nt.CHALLENGE_FRIEND),s===S&&i&&w&&(P=Nt.CHALLENGE_FRIEND),s===v&&(P=Nt.MATCHING_GROUP),e.setStorageData("context","contextGameMode",P)}},Ld=bd;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Cd=class extends Error{constructor(t){super(t),this.name="PlayerHasFinishedMatch",this.message=t??"Player has finished match"}},xs=Cd;n(),o(),l(),c(),d(),h(),u(),p(),y();var Nd=class extends Error{constructor(t){super(t),this.name="PlayerNotJoinInMatch",this.message=t||"Player is not join in match"}},Xe=Nd,{Events:ce,Plugins:{Analytics:Ss},Utils:{Valid:Td}}=Ludex,_d=class{codex;constructor(t){this.codex=t}async processContextData(){let{player:t,storage:e,monitorError:a}=this.codex,s=e.getStorageData("context","contextId")??"",r=e.getStorageData("context","entryPointData")??{},i=e.getStorageData("context","sessionContextType")??"",{type:f,matchId:m,playerId:g,opponentId:w,playerScore:A,action:v}=r;v&&await this.processEntryPointAction(v);let x=t.isFirstSession();setTimeout(()=>{this.logUserAnalytics(x)},1e3);let{TOURNAMENT:S,SHARE_INVITE:P,MATCHING_GROUP:C,CHALLENGE_FRIEND:E}=Ct;if(i===S)try{await this.processTournamentModeAsync(s);return}catch{a?.sendException(new Error("Process Tournament Fail"),{contextId:s,isFirstSession:x,entryPointData:r,playerData:t.getPlayerData()})}if(i===E){if(f===P&&typeof g=="string"){await this.processChallengeFromPostAsync(g);return}if(f===E&&typeof m=="string"&&typeof g=="string"&&typeof w=="string"){await this.processChallengeFromMessageAsync({contextId:s,matchId:m,playerId:g,opponentId:w});return}}if(i===C&&typeof g=="string"&&typeof A=="number"){await this.processMatchingGroupModeAsync(g,A);return}if(x){await this.processSingleModeAsync(!0),t.loggedIn();return}this.switchToDashboardScene()}logUserAnalytics(t){try{let{player:e,analytics:a}=this.codex;if(t)a.event(Ss.Events.NEW_USER);else{let{coins:s}=e.getPlayerData().gameData;a.event(Ss.Events.RETURNING_USER,{coins:s})}}catch{}}async processEntryPointAction(t){try{let{player:e}=this.codex;switch(t){case"reset_data":e.setPlayerDataByName("score",0),e.setGameData({coins:0,level:1}),await e.syncProfileToServer();break;case"enable_debug":e.setPlayerDataByName("debug",!0);break;case"set_locale_en":this.requestSetLocale("en");break;case"set_locale_ru":this.requestSetLocale("ru");break}}catch{}}requestSetLocale(t){let{event:e}=this.codex;e.emit(ce.REQUEST_LANGUAGE,{locale:t})}async processTournamentModeAsync(t){let{match:e,player:a}=this.codex,s=a.getPlayerId();if(Td.isEmpty(t))throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:t}),this.switchToGameScene()}async processChallengeFromPostAsync(t){let{match:e,player:a}=this.codex,s=a.getPlayerId();if(s===t)await e.single.start.processAsync({playerId:s});else try{await e.challenge.friend.processAsync({playerId:s,opponentId:t})}catch{await e.single.start.processAsync({playerId:s})}this.switchToGameScene()}async processChallengeFromMessageAsync(t){try{await this.processContinueChallengeFromMessageAsync(t)}catch(e){if(e instanceof xs){await this.processAwaitChallengeFromMessageAsync(t);return}if(e instanceof Xe){await this.processJoinChallengeFromMessageAsync(t);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(t){let{contextId:e,matchId:a,playerId:s,opponentId:r}=t,{match:i,player:f}=this.codex,m=f.getPlayerId();if(s===m)await i.challenge.continue.processAsync({contextId:e,matchId:a,playerId:m,opponentId:r});else{let g=r===ct.playerId;await i.challenge.continue.processAsync({contextId:e,matchId:a,playerId:m,opponentId:g?r:s})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(t){let{contextId:e,matchId:a,playerId:s}=t,{match:r,player:i}=this.codex,f=i.getPlayerId();await r.challenge.join.processAsync({contextId:e,matchId:a,playerId:f,opponentId:s}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(t){let{contextId:e,matchId:a,playerId:s}=t,{match:r,player:i}=this.codex,f=i.getPlayerId();try{await r.challenge.await.processAsync({contextId:e,matchId:a,playerId:f,opponentId:s}),this.switchToChallengeResultScene()}catch{await this.processResultChallengeFromMessageAsync(t)}}async processResultChallengeFromMessageAsync(t){let{contextId:e,matchId:a,playerId:s}=t,{match:r,player:i}=this.codex,f=i.getPlayerId();try{await r.challenge.result.processAsync({contextId:e,matchId:a,playerId:f,opponentId:s}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(t,e){let{match:a,player:s}=this.codex;await a.group.join.processAsync({playerId:s.getPlayerId(),opponentId:t,opponentScore:e}),this.switchToGameScene()}async processSingleModeAsync(t){let{match:e,player:a}=this.codex,s=a.getPlayerId();t&&await e.handler.setMatchCustomData({playerId:s,contextId:"SOLO"}),await e.single.start.processAsync({playerId:s}),this.switchToGameScene()}switchToDashboardScene(){let{event:t}=this.codex;t.emit(ce.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}switchToGameScene(){let{event:t}=this.codex;t.emit(ce.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}switchToChallengeResultScene(){let{event:t}=this.codex;t.emit(ce.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}},Od=_d;n(),o(),l(),c(),d(),h(),u(),p(),y();var Rd={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},Es=Rd,{Events:zt}=Ludex,Md=class extends Ludex.Plugins.BasePlugin{context;loader;constructor(t){super(t),this.loader=new Od(t),this.context=new Ld(t)}init(){let{storage:t}=this.codex;t.addStorage("context",Es)}getSessionContextTypes(){return Ct}async processContextData(){let{event:t,monitorError:e}=this.codex;try{t.getEventEmitCount(zt.CONTEXT_SESSION_TYPE_DETECTED)>0||await t.waitTo(zt.CONTEXT_SESSION_TYPE_DETECTED,3e3),await this.loader.processContextData(),t.emit(zt.CONTEXT_DATA_PROCESSED)}catch(a){if(this.switchToDashboardScene(),e){let s=a instanceof Error?a:new Error(JSON.stringify(a));e.sendException(s)}}}async detectContextSessionType(){let{event:t,monitorError:e}=this.codex;try{await this.context.detectContextSessionType(),t.emit(zt.CONTEXT_SESSION_TYPE_DETECTED)}catch(a){if(e){let s=a instanceof Error?a:new Error(JSON.stringify(a));e.sendException(s)}}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,e,a){this.context.receiveContext(t,e,a)}switchToDashboardScene(){let{event:t}=this.codex;t.emit(zt.SWITCH_SCENE,{sceneName:"DashboardScene"})}},kd=Md;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:Ze}=Ludex.Utils,{contextId:Fd,contextType:Gd,entryPointData:Bd}=Es,ta="is invalid",Ps=class extends lt{data;setupData(t){this.d(t)}n(t){this.l(t)}o(t){this.c(t)}validateContextId(t){Ze.isString(t)||this.t("contextId",ta)}validateContextType(t){(!Ze.isString(t)||!t)&&this.t("contextType",ta)}validateEntryPointData(t){Ze.isObject(t)||this.t("entryPointData",ta)}toObject(){return super.toObject()}};Ps.addDefaultData({contextId:Fd,contextType:Gd,entryPointData:Bd});var Ud=Ps;Ludex.Dtos.Context={Info:Ud};var jd=kd;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Hd={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},Vd=Hd,{Object:Kd}=Ludex.Utils,$d=class{async getDailyRewardsAsync(){return Kd.vals(Vd)}},Wd=$d;n(),o(),l(),c(),d(),h(),u(),p(),y();var zd={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},$=zd;n(),o(),l(),c(),d(),h(),u(),p(),y();var qd={dailyRewards:{}},Yd=qd,{Configs:{DailyRewards:{CheckInterrupt:bs,MaxDays:Ls,MockTime:Cs}},Utils:{Array:ea,Valid:Tt}}=Ludex,de=Cs>0?Cs:864e5,Jd=class extends Ludex.Plugins.BasePlugin{dailyRewardsApi=new Wd;init(){let{storage:t}=this.codex;t.addStorage("dailyRewards",Yd)}async requestDailyRewardsAsync(){let t=await this.dailyRewardsApi.getDailyRewardsAsync(),{logs:e,rewards:a}=this.parseDailyRewards(t);this.setRewardsLog(e),this.setDailyRewards(a)}getDailyRewards(){let{storage:t}=this.codex;return t.getStorageData("dailyRewards","dailyRewards")||null}logLoginReward(){bs?this.logFromFirstReward():this.logFromLastReward()}logFromFirstReward(){let{player:t}=this.codex,{dailyRewardedData:e}=t.getPlayerData();if(!Tt.isObject(e))return;let{logDays:a,firstReward:s}=e,r=new Date,i=[...a];if(s===0){i[0]=!0,Tt.isDebugger()||r.setHours(0,0,0,0),this.setRewardsLog({logDays:i,firstReward:r.valueOf(),lastReward:r.valueOf()});return}let f=r.valueOf()-s,m=Math.floor(f/de);m>=Ls||m>=a.length||(i[m]=!0,Tt.isDebugger()||r.setHours(0,0,0,0),this.setRewardsLog({logDays:i,lastReward:r.valueOf()}))}logFromLastReward(){let{player:t}=this.codex,{dailyRewardedData:e}=t.getPlayerData();if(!Tt.isObject(e))return;let{logDays:a,lastReward:s}=e,r=new Date,i=[...a];if(s===0){i[0]=!0,Tt.isDebugger()||r.setHours(0,0,0,0),this.setRewardsLog({logDays:i,firstReward:r.valueOf(),lastReward:r.valueOf()});return}let f=r.valueOf()-s;if(Math.floor(f/de)<1)return;let m=ea.searchIndex(i,g=>g===!1);m!==void 0&&(i[m]=!0,Tt.isDebugger()||r.setHours(0,0,0,0),this.setRewardsLog({logDays:i,lastReward:r.valueOf()}))}setRewardsLog(t){let{logDays:e,firstReward:a,lastReward:s}=t,{player:r}=this.codex,{dailyRewardedData:i}=r.getPlayerData();Tt.isObject(i)&&(this.isSameLog(i,t)||r.setPlayerDataByName("dailyRewardedData",{logDays:e!==void 0?[...e]:[...i.logDays],firstReward:a??i.firstReward,lastReward:s??i.lastReward}))}isSameLog(t,e){if(e.firstReward!==void 0&&t.firstReward!==e.firstReward||e.lastReward!==void 0&&t.lastReward!==e.lastReward)return!1;if(e.logDays!==void 0){if(t.logDays.length!==e.logDays.length)return!1;for(let a=0;a<e.logDays.length;a++)if(t.logDays[a]!==e.logDays[a])return!1}return!0}parseDailyRewards(t){let{player:e}=this.codex,{dailyRewardedData:a}=e.getPlayerData(),{logDays:s,firstReward:r,lastReward:i}=a??{};if(s===void 0||r===void 0||r===0||i===void 0||i===0||s.length!==t.length){let f=this.getDefaultDailyRewards(t);return{logs:{logDays:f.logDays,firstReward:0,lastReward:0},rewards:f.rewards}}return bs?this.parseFromFirstReward(t,s,r,i):this.parseFromLastReward(t,s,r,i)}parseFromFirstReward(t,e,a,s){let r=Date.now()-a;if(r<0){let A=this.getDefaultDailyRewards(t);return{logs:{logDays:A.logDays,firstReward:0,lastReward:0},rewards:A.rewards}}let i=Math.floor(r/de),f=i>=Ls||i>=e.length,m=ea.search(e.slice(0,i),A=>A===!1)!==void 0;if(f||m){let A=this.getDefaultDailyRewards(t);return{logs:{logDays:A.logDays,firstReward:0,lastReward:s},rewards:A.rewards}}let g=[],w={};for(let A=0;A<t.length;A++){let v=t[A],x=g.length>i,S=g.length===i,P=e[A];if(x){g.push(!1),w[v.id]=L(I({},v),{status:$.WAITING});continue}if(g.push(P),S){w[v.id]=L(I({},v),{status:P?$.REWARDED:$.READY});continue}w[v.id]=L(I({},v),{status:P?$.REWARDED:$.SKIPPED})}return{logs:{logDays:g,firstReward:a,lastReward:s},rewards:w}}parseFromLastReward(t,e,a,s){let r=Date.now()-s;if(r<0){let w=this.getDefaultDailyRewards(t);return{logs:{logDays:w.logDays,firstReward:0,lastReward:0},rewards:w.rewards}}let i=Math.floor(r/de)>=1,f=ea.searchIndex(e,w=>w===!1);if(f===-1&&i){let w=this.getDefaultDailyRewards(t);return w.rewards[t[0].id].status=i?$.READY:$.WAITING,{logs:{logDays:w.logDays,firstReward:0,lastReward:s},rewards:w.rewards}}let m=[],g={};for(let w=0,A=t.length;w<A;w++){let v=t[w],x=f!==-1&&w>f,S=w===f;if(x){m.push(!1),g[v.id]=L(I({},v),{status:$.WAITING});continue}if(S){m.push(!1),g[v.id]=L(I({},v),{status:i?$.READY:$.WAITING});continue}m.push(!0),g[v.id]=L(I({},v),{status:$.REWARDED})}return{logs:{logDays:m,firstReward:a,lastReward:s},rewards:g}}getDefaultDailyRewards(t){let e=[],a={};for(let s of t)e.push(!1),a[s.id]=L(I({},s),{status:$.WAITING});return a[t[0].id].status=$.READY,{logDays:e,rewards:a}}setDailyRewards(t){let{storage:e}=this.codex;e.setStorageData("dailyRewards","dailyRewards",t)}},Qd=Jd,Xd=Qd;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Zd=Ur(Hr(),1),th=Zd.default,eh=new th,_t=eh;n(),o(),l(),c(),d(),h(),u(),p(),y();var ah={names:[],history:[]},sh=ah,{Utils:{Decorator:wt}}=Ludex,ht=class extends Ludex.Plugins.BasePlugin{enableLog=!1;muteEvents=[];init(){let{storage:t}=this.codex;t.addStorage("event",sh)}enableLogEvent(){this.enableLog=!0}on(t,e){this.addEventName(t),this.addHistory(t,"on","listening"),_t.on(t,e)}once(t,e){this.addEventName(t),this.addHistory(t,"once","listening"),_t.once(t,e)}waitTo(t,e){return new Promise((a,s)=>{let r,i=f=>{clearTimeout(r),a(f)};this.once(t,i),e&&e>0&&(r=setTimeout(()=>{this.off(t,i),s(new Error(`Event ${t} timeout`))},e))})}catchUp(t,e){if(this.once(t,e),!(this.getEventEmitCount(t)>0))return;let{payload:a}=this.getLastEventInfo(t)??{};this.emit(t,a)}off(t,e){_t.off(t,e),this.addHistory(t,"action","removed")}mute(t){this.muteEvents.indexOf(t)>-1||this.muteEvents.push(t)}clear(t){_t.removeAllListeners(t),this.addHistory(t,"action","removed")}emit(t,e){if(this.muteEvents.indexOf(t)>-1)return;let a=[];e&&(a=[e]),this.addHistory(t,"action","called",e),_t.emit(t,...a)}addEventName(t){let{storage:e}=this.codex,a=e.getStorageData("event","names");a&&a.indexOf(t)<0&&a.push(t)}limitHistory(t){if(t.length<=1e4)return t;let{Utils:{Array:e}}=Ludex;return e.limit(t,1e4)}getEventListeners(t){return this.getHistory().filter(e=>e.name===t&&e.status==="listening").map(e=>e.name)}getHistory(){let{storage:t}=this.codex,e=t.getStorageData("event","history")??[];return this.limitHistory(e)}getEventEmitCount(t){return this.getHistory().filter(e=>e.name===t&&e.status==="called").length}getLastEventInfo(t){let e=this.getHistory(),a=null;for(let s=e.length-1;s>=0;s--)if(e[s].name===t){a=e[s];break}return a}getTypeFromHistory(t){return this.getLastEventInfo(t)?.type??null}getCallsFromHistory(t){return this.getLastEventInfo(t)?.called??0}addHistory(t,e,a,s){let r=this.getTypeFromHistory(t)??e,i=this.getCallsFromHistory(t),f=a==="called"?i+1:i;this.getHistory().push({type:r,status:a,name:t,called:f,payload:s??{}}),this.logEventInfo(t,r,a,f)}logEventInfo(t,e,a,s){this.enableLog&&(a==="listening"&&_t.listenerCount(t)>1,a==="called"&&_t.listenerCount(t)<=0)}};W([wt.validateParams("string","function")],ht.prototype,"on",1),W([wt.validateParams("string","function")],ht.prototype,"once",1),W([wt.validateParams("string")],ht.prototype,"waitTo",1),W([wt.validateParams("string","function")],ht.prototype,"catchUp",1),W([wt.validateParams("string","function")],ht.prototype,"off",1),W([wt.validateParams("string")],ht.prototype,"mute",1),W([wt.validateParams("string")],ht.prototype,"clear",1),W([wt.validateParams("string")],ht.prototype,"emit",1);var rh=ht,ih=rh;tt(),tt(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var nh=class extends Error{locale;constructor(t){super(`Locale "${t}" not found`),this.name="LocaleNotFoundError",this.locale=t}},Ns=nh;n(),o(),l(),c(),d(),h(),u(),p(),y();var oh=class extends Error{key;locale;constructor(t,e){let a=String(t);super(`Text with key "${a}" not found in locale "${e}"`),this.name="MissingKeyInLocaleError",this.key=a,this.locale=e}},aa=oh,{Utils:{Object:sa,Function:Ts,Browser:lh},Configs:{Languages:{DetectPlayerLocale:ch}}}=Ludex,dh=class extends Ludex.Plugins.BasePlugin{locale;fallbackLocale;data={};setFallbackLocale(t){this.fallbackLocale=t}hasTextKey(t,e){let a=e??this.getCurrentLocale(),{text:s}=this.getLocaleData(a);return sa.hasOwn(s,t)}hasTextureKey(t,e){let a=e??this.getCurrentLocale(),{texture:s}=this.getLocaleData(a);return sa.hasOwn(s,t)}add(t,e,a=!1){this.data[t]=e,a&&this.setFallbackLocale(t)}choose(t){this.locale=t;let{event:e}=this.codex;e.emit(Ludex.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,e,a,s=!1){try{return this.uncaughtGetText(t,e,a,!s)}catch(r){return r instanceof aa||r instanceof Ns,String(t)}}getTexture(t,e,a=!1){return this.uncaughtGetTexture(t,e,!a)}uncaughtGetText(t,e=[],a,s=!0){if(!s||this.fallbackLocale===void 0){let f=this.getRawText(t,a??this.getCurrentLocale());return this.replaceVariables(f,e)}let r=this.fallbackLocale,i=Ts.retry(()=>this.getRawText(t,a??this.getCurrentLocale()),()=>this.getRawText(t,r));return this.replaceVariables(i,e)}getRawText(t,e){if(!this.hasTextKey(t,e))throw new aa(t,e);let{text:a}=this.getLocaleData(e);return a[t]}uncaughtGetTexture(t,e,a=!0){if(!a||this.fallbackLocale===void 0)return this.getRawTexture(t,e??this.getCurrentLocale());let s=this.fallbackLocale;return Ts.retry(()=>this.getRawTexture(t,e??this.getCurrentLocale()),()=>this.getRawTexture(t,s))}getRawTexture(t,e){if(!this.hasTextureKey(t,e))throw new aa(t,e);let{texture:a}=this.getLocaleData(e);return a[t]}getCurrentLocale(){return this.locale??"en"}getLocaleData(t){let e=t??this.getCurrentLocale();if(!sa.hasOwn(this.data,e))throw new Ns(e);return this.data[e]}replaceVariables(t,e){let a=e.length;if(a===0)return t;let s=t;for(let r=0;r<a;r++){let i=e[r],f=`%{${r}}`;s=s.replace(f,i)}return s}getPlayerLanguage(){let{player:t}=this.codex,e=GameSDK.getLocale()?.trim().split(/[-_]/)[0],a=this.getBrowserLanguage();return e!==a?e??a:t.isFirstSession()?a:t.getPlayerSetting("language")??a}getBrowserLanguage(){return ch===!1?"en":lh.getLocale()?.trim()?.split(/[-_]/)[0]}},hh=dh,uh=hh;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var yh={_id:"",name:"",createdBy:"",description:"",expireTime:6048e5,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15},ph=yh,{Configs:{OtherHost:qt,Mockup:Yt,AppId:fh},Utils:{Object:Jt,String:_s,Valid:Os}}=Ludex,mh=class{mockAPI;async initMockAPI(){if(this.mockAPI)return;let t=(await import("./chunks-L2X7HZGD.js")).default;if(typeof t!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new t}async getLeadersAsync(t,e,a){let s=_s.params(a),r;return Yt.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in a?r=await this.mockAPI.getPlayers(t,a):r=await this.mockAPI.getLeaders(t,a)):r=await Gt(`${e}?${s}`,{},qt),!Jt.hasOwn(r,"data")||!Array.isArray(r.data)?[]:r.data}async getLeaderboardAsync(t){let e,a=`leaderboards/${t}`;return Yt.Leaderboards.Enabled?(await this.initMockAPI(),e=await this.mockAPI.getLeaderboardAsync(t)):(e=await Gt(a,{},qt),Jt.hasOwn(e,"data")&&Os.isObject(e.data)&&(e=e.data)),e}async getLeaderboardsAsync(t){let e,a=Ludex.Utils.String.params(t);return Yt.Leaderboards.Enabled?(await this.initMockAPI(),e=await this.mockAPI.getLeaderboardsAsync(t)):(e=await Gt(`leaderboards?${a}`,{},qt),Jt.hasOwn(e,"data")&&Array.isArray(e.data)?e=e.data:e=[]),e}async setLeaderboardScoreAsync(t){let{leaderboardId:e,playerId:a,score:s}=t;Yt.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(e,a,s)):await et(`leaderboards/${e}/players/${a}`,{score:s},{},qt)}async createLeaderboardAsync(t){let e=t._id??_s.generateObjectId(),a=t.numberOfLeaders,s=L(I(I({},ph),t),{_id:e,appId:fh,numberOfLeaders:a}),r="leaderboards",i;if(Yt.Leaderboards.Enabled?(await this.initMockAPI(),i=await this.mockAPI.createLeaderboard(s)):(i=await et(r,s,{},qt),Jt.hasOwn(i,"data")&&Os.isObject(i.data)&&(i=i.data)),!Jt.hasOwn(i,"_id")||i._id!==e)throw new Error("Create leaderboard failed");return e}},gh=mh;n(),o(),l(),c(),d(),h(),u(),p(),y();var wh={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},Rs=wh;n(),o(),l(),c(),d(),h(),u(),p(),y();var Ah={leaderboards:{}},vh=Ah,{Utils:{Array:Dh,Valid:Ih,Json:Ms,Object:he}}=Ludex,xh=class extends Ludex.Plugins.BasePlugin{lbAPI=new gh;configs;init(){let{storage:t}=this.codex;t.addStorage("leaderboard",vh),this.configs={}}addLeaderboard(t){let{name:e,type:a,leaderboardId:s,autoSortRank:r}=t;if(this.getLeaderboard(e))return;let i=`leaderboards/${s}/`;(a==="global"||a==="tournament")&&(i+="leaders"),a==="friends"&&(i+="players"),this.configs[e]={id:s,name:e,type:a,host:i,autoSortRank:r};let f=Ms.clone(Rs);this.setLeaderboard(e,I({},f))}async requestLeaderboardsAsync(t){try{return await this.lbAPI.getLeaderboardsAsync(t)}catch{return[]}}async requestLeaderboardAsync(t,e){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});let{id:a,type:s,host:r}=this.configs[t],i=[];if(s==="friends"){let{player:f}=this.codex,m=f.getPlayerId(),g=f.getConnectedPlayerIds(e,0),w=[m,...g];this.configs[t].playerIds=[...w],i=await this.lbAPI.getLeadersAsync(a,r,{playerIds:w})}else i=await this.lbAPI.getLeadersAsync(a,r,{limit:e,offset:0});if(i.length===0)return;await this.receiveLeaderboardAsync(t,i),this.setLeaderboard(t,{limit:e,offset:0})}finally{let a=await this.lbAPI.getLeaderboardAsync(this.configs[t].id),s=a?a.resettable:"",r=a?a.amountPlayer:0;this.setLeaderboard(t,{isRequesting:!1,resettable:s,amountPlayer:r})}}async loadMoreLeaderboardAsync(t,e){let a=this.getLeaderboard(t);if(a&&this.configs[t].type!=="friends")try{this.setLeaderboard(t,{isRequesting:!0});let{id:s,host:r}=this.configs[t],{offset:i,limit:f}=a,m=i+f,g=await this.lbAPI.getLeadersAsync(s,r,{limit:e,offset:m});if(g.length===0)return;this.receiveLeaderboardAsync(t,g),this.setLeaderboard(t,{limit:e,offset:m})}finally{this.setLeaderboard(t,{isRequesting:!1})}}getLeaderboard(t){let{storage:e}=this.codex,a=e.getStorageData("leaderboard","leaderboards");return!a||!a[t]?null:a[t]}async getLeadersByPlayerIdsAsync(t,e){try{this.validateLeaderboard(t);let{id:a}=this.configs[t],s=`leaderboards/${a}/players`,r=await this.lbAPI.getLeadersAsync(a,s,{playerIds:e});return r.length===0?[]:this.toLeaders(r)}catch{return[]}}async getLeaderboardResponseAsync(t){return await this.lbAPI.getLeaderboardAsync(t)}clearLeaderboard(t){try{this.validateLeaderboard(t);let e=Ms.clone(Rs);this.setLeaderboard(t,null),this.setLeaderboard(t,I({},e))}catch{}}isLeaderboardEmpty(t){let e=this.getLeaderboard(t);if(!e)return!0;let{leaders:a}=e;return Object.keys(a).length===0}isExistLeaderboardId(t){let{configs:e}=this;return he.vals(e).some(a=>a.id===t)}getLeaderboardName(t){let{configs:e}=this,a=Dh.search(he.vals(e),s=>s.id===t);return a?a.name:null}async setLeaderboardScoreAsync(t,e,a){try{if(GameSDK.extra.isGuest)return;this.validateLeaderboard(t);let{id:s}=this.configs[t],r=await this.getLastScoreOnLeaderboard(t,e);if(r&&a<=r)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:s,playerId:e,score:a})}catch{}}async getLastScoreOnLeaderboard(t,e){let a=await this.getLeadersByPlayerIdsAsync(t,[e]);return a.length===0?null:a[0].score}async createLeaderboardAsync(t){return this.lbAPI.createLeaderboardAsync(t)}validateLeaderboard(t){let e=this.getLeaderboard(t);if(!Ih.isObject(e))throw new Error(`Leaderboard with name ${t} not found`)}setLeaderboard(t,e){if(!e)return;let{storage:a}=this.codex;a.setStorageData("leaderboard","leaderboards",{[t]:e})}async receiveLeaderboardAsync(t,e){this.validateLeaderboard(t);let a=(await this.toLeaders(e)).filter(g=>g.name&&g.photo),{leaders:s={}}=this.getLeaderboard(t)??{},r=a.filter(g=>s[g.playerId]?(s[g.playerId]=g,!1):!0),i=he.vals(s);r.length>0&&i.unshift(...r);let f=i.sort((g,w)=>w.score-g.score);this.configs[t].autoSortRank&&(f=f.map((g,w)=>L(I({},g),{rank:w+1})));let m=he.keyBy(f,"playerId");this.setLeaderboard(t,{leaders:m})}async toLeaders(t){let{profile:e}=this.codex,a=t.map(r=>r.playerId);await e.requestProfiles(a);let s=e.getProfiles();return t.map(r=>{let{playerId:i}=r,f=s[i];if(!f){let{language:m}=this.codex,g=m.getText("core.nameless")??"Nameless";return L(I({},r),{name:g,photo:"default"})}return L(I({},r),{name:f.name,photo:f.photo})}).map(r=>L(I({},r),{score:parseInt(r.score,10)}))}},Sh=xh,Eh=Sh;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Ph=class{APIHost;setAPIHost(t){this.APIHost=t}getAPIHost(){return this.APIHost}},bh=Ph,{Utils:ks}=Ludex,Lh=class extends bh{async createSingleMatchAsync(t){let e=await et("single-matches",t,{},this.getAPIHost());return this.returnValidMatchData(e)}async getSingleMatchDetailAsync(){let t=await Gt("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(t,e){let a=`single-matches/${t}/move`,s=await et(a,e,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishSingleMatchAsync(t){let e=`single-matches/${t}/finish`,a=await et(e,{},{},this.getAPIHost());return this.returnValidMatchData(a)}async createMatchAsync(t){let e=await et("matches",t,{},this.getAPIHost());return this.returnValidMatchData(e)}async joinMatchAsync(t){let e=`matches/${t}/join`,a=await et(e,{},{},this.getAPIHost());return this.returnValidMatchData(a)}async getMatchDetailByIdAsync(t){let e=`matches/${t}`,a=await Gt(e,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishMatchAsync(t){let{matchId:e="",score:a=0,level:s=0,extraData:r={}}=t,i=`matches/${e}/finish`,f=await et(i,{matchId:e,score:a,level:s,extraData:r},{},this.getAPIHost());return this.returnValidMatchData(f)}returnValidMatchData(t){return ks.Valid.isObject(t)?ks.Object.hasOwn(t,"data")?t.data??{}:{}:{}}},Ch=Lh,Nh=class{matchAPI;constructor(t){this.createAPI(),this.setAPIConfig(t)}createAPI(){this.matchAPI=new Ch}setAPIConfig(t){t.matchAPIHost&&this.matchAPI.setAPIHost(t.matchAPIHost)}setMatchAPIInstance(t){this.matchAPI=t}getMatchAPI(){return this.matchAPI}},Th=Nh;n(),o(),l(),c(),d(),h(),u(),p(),y();var _h=class{codex;match;constructor(t,e){this.codex=t,this.match=e}startLog(t){this.match.useCPUProfile}endLog(){this.match.useCPUProfile}async processAsync(t){throw new Error("Not implemented")}},_=_h;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Object:Oh,Valid:Qt,Json:Rh}=Ludex.Utils,Mh=class{codex;match;nextHandler;stateData;constructor(t){this.codex=t.codex,this.match=t.match,this.nextHandler=null,this.stateData={Before:null,After:null}}setNext(t){return this.nextHandler=t,t}async processAsync(t){this.u("Before",t)}async nextAsync(t){this.u("After",t),this.p(),this.nextHandler&&await this.nextHandler.processAsync(t)}u(t,e){if(!Qt.isDebugger())return;this.stateData[t]=Rh.clone(e);let a=e,{profiles:s,customData:r}=a,i=va(a,["profiles","customData"])}p(){let{After:t,Before:e}=this.stateData;if(!t||!e)return;let a=Oh.diff(e,t);if(!Qt.isEmpty(a)){let s=a,{profiles:r={},customData:i={}}=s,f=va(s,["profiles","customData"]);Qt.isEmpty(f),Qt.isEmpty(r),Qt.isEmpty(i)}this.stateData.After=null,this.stateData.Before=null}},b=Mh,kh=class extends b{async processAsync(t){await this.nextAsync(t)}async nextAsync(t){this.nextHandler&&await this.nextHandler.processAsync(t)}},k=kh;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Fh=class extends dt{constructor(t){super(t),this.name="LevelNotDefined",this.message=t??"Level is not defined"}},Fs=Fh;n(),o(),l(),c(),d(),h(),u(),p(),y();var Gh=class extends dt{constructor(t){super(t),this.name="MatchModeNotDefined",this.message=t??"Match id is not defined"}},ra=Gh,{Plugins:Bh,Utils:Uh}=Ludex,{Analytics:jh}=Bh,{String:Gs,Valid:Bs}=Uh,Hh=class extends b{async processAsync(t){super.processAsync(t);let{mode:e,customData:a}=t,{level:s}=a;this.validateMode(e),this.validateLevel(s);let{analytics:r}=this.codex;r.event(jh.Events.MATCH_START,{level:s,game_mode:Gs.toUpperCamelCase(e),level_name:this.getLevelName(s)}),await this.nextAsync(t)}validateMode(t){if(!Bs.isString(t))throw new ra}validateLevel(t){if(!Bs.isNumber(t))throw new Fs}getLevelName(t){return`Level ${Gs.padStart(t.toString(),5,"0")}`}},X=Hh;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Vh={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},H=Vh,Kh=class extends b{async processAsync(t){super.processAsync(t);let{mode:e,status:a}=t,s=e??Nt.SINGLE;a===H.FINISHED&&(s=Nt.SINGLE),this.contextGameModeDetected(s),await this.nextAsync(t)}contextGameModeDetected(t){let{storage:e}=this.codex;e.setStorageData("context","contextGameMode",t)}},G=Kh;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var $h=class extends Error{constructor(t){super(t),this.name="GetMatchDetailFailed",this.message=t??"Get match detail failed"}},ia=$h;n(),o(),l(),c(),d(),h(),u(),p(),y();var Wh=class extends Error{constructor(t){super(t),this.name="MatchAreNotActive",this.message=t??"Match are not active"}},Us=Wh;n(),o(),l(),c(),d(),h(),u(),p(),y();var zh=class extends dt{constructor(t){super(t),this.name="MatchIdNotValid",this.message=t??"Match id is not valid"}},ut=zh;n(),o(),l(),c(),d(),h(),u(),p(),y();var qh=class extends Error{constructor(t){super(t),this.name="OpponentHasFinishedMatch",this.message=t||"Opponent has finished match"}},Yh=qh;n(),o(),l(),c(),d(),h(),u(),p(),y();var Jh=class extends dt{constructor(t){super(t),this.name="OpponentIdNotValid",this.message=t??"Opponent id is not valid"}},q=Jh;n(),o(),l(),c(),d(),h(),u(),p(),y();var Qh=class extends Error{constructor(t){super(t),this.name="PlayerNotCurrentInMatch",this.message=t??"The player is not currently in this match"}},na=Qh;n(),o(),l(),c(),d(),h(),u(),p(),y();var Xh=class extends Error{constructor(t){super(t),this.name="PlayerNotFinishedMatch",this.message=t||"Player not finished match"}},js=Xh,{Dtos:Zh,Utils:{Object:tu}}=Ludex,eu=class extends b{async processAsync(t){super.processAsync(t),this.validateMatchData(t);let e=await this.getMatchAsync(t),a=new Zh.Match.Data(e).toObject();this.validateAwaitMatchData(t,a),this.updateMatchData(t,a),this.validateMatchStatus(t),this.validatePlayerTurn(t),this.validateOpponentTurn(t),await this.nextAsync(t)}validateMatchData(t){let{id:e}=t;if(typeof e!="string")throw new ut}validateMatchStatus(t){let{status:e}=t;if(e!==H.ACTIVE)throw new Us}validateAwaitMatchData(t,e){let{id:a,customData:s}=t,{_id:r,whitePlayerId:i,blackPlayerId:f}=e;if(typeof r!="string"||r!==a)throw new ia;let{playerId:m}=s,g=i===m,w=f===m;if(!g&&f===ct.playerId)throw new Xe;if(!g&&!w)throw new na}validatePlayerTurn(t){let{profiles:e,customData:a}=t,{playerId:s}=a;if(typeof s!="string")throw new N;let{finished:r}=e[s];if(!r)throw new js}validateOpponentTurn(t){let{profiles:e,customData:a}=t,{opponentId:s}=a;if(typeof s!="string")throw new q;let{finished:r}=e[s];if(r)throw new Yh}async getMatchAsync(t){let{id:e}=t;return e?this.match.api.getMatchAPI().getMatchDetailByIdAsync(e):{}}updateMatchData(t,e){this.updateMatchGeneral(t,e),this.updatePlayerIds(t,e),this.initializeProfiles(t),this.updateScoresAndStatus(t,e)}updateMatchGeneral(t,e){let{status:a,extraData:s}=e;t.status=a,t.customData=tu.merge(t.customData,s)}updatePlayerIds(t,e){let{whitePlayerId:a,blackPlayerId:s}=e,r=a===t.customData.playerId;t.customData.playerId=r?a:s,t.customData.opponentId=r?s:a}initializeProfiles(t){let{playerId:e,opponentId:a}=t.customData;if(!e||!a)return;let s={name:"",photo:"",finished:!1};t.profiles[e]||(t.profiles[e]=I({id:e},s)),t.profiles[a]||(t.profiles[a]=I({id:a},s))}updateScoresAndStatus(t,e){let{playerId:a,opponentId:s}=t.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerScore:i,whitePlayerFinish:f,blackPlayerScore:m,blackPlayerFinish:g}=e,w=r===a;t.profiles[a].score=w?i:m,t.profiles[s].score=w?m:i,t.profiles[a].finished=w?f:g,t.profiles[s].finished=w?g:f}},au=eu;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var su={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},oa=su,ru=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){let{id:e,mode:a,customData:s}=this.payload;t.id=e??null,t.mode=a||null,t.status=H.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData=I(I(I({},oa),t.customData),s)}},Y=ru;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var iu=Ct,Ot=iu;n(),o(),l(),c(),d(),h(),u(),p(),y();var nu=class extends Error{constructor(t){super(t),this.name="UnavailableFeature",this.message=`Unavailable feature: ${t}`}},O=nu;n(),o(),l(),c(),d(),h(),u(),p(),y();var ou=class extends dt{constructor(t){super(t),this.name="ContextIdNotValid",this.message=t??"Context id is not valid"}},st=ou;n(),o(),l(),c(),d(),h(),u(),p(),y();var lu=class extends dt{constructor(t){super(t),this.name="ProfileNotFound",this.message=t??"Profile not found"}},F=lu,cu=class extends b{async processAsync(t){super.processAsync(t),this.validateData(t);let e=await this.createWideframesAwaitingAsync(t);e&&this.sendMessageAsync(t,e),await this.nextAsync(t)}validateData(t){let{id:e,customData:a}=t,{contextId:s,opponentId:r}=a;if(!e||typeof e!="string")throw new ut;if(!s||typeof s!="string")throw new st;if(!r||typeof r!="string")throw new q}async createWideframesAwaitingAsync(t){try{let{frameCapture:e}=this.codex,{profiles:a,customData:s}=t,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],m=a[i];if(!f||!m)return null;let{photo:g,score:w=0,finished:A}=f;if(!A)return null;let{photo:v,score:x=0,finished:S}=m;return S?null:await e.wideframe.renderResultChallenge({playerId:r,playerPhoto:g,playerScore:w,opponentId:i,opponentPhoto:v,opponentScore:x,isPlayerFinished:!0,isOpponentFinished:!1})}catch{return null}}async sendMessageAsync(t,e){let{id:a,profiles:s,customData:r}=t,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");let m=s[i];if(!m)throw new F;let{name:g}=m,w={data:{type:Ot.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${g} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${g} \u0111ang ch\u1EDD b\u1EA1n k\u1EBFt th\xFAc tr\u1EADn \u0111\u1EA5u. Ch\u01A1i ngay!`}},image:e,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(w)}},du=cu;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Dtos:hu}=Ludex,uu=class extends b{async processAsync(t){super.processAsync(t),this.validateData(t);let{customData:e}=t,{playerId:a,opponentId:s}=e,r=a,i=await this.getProfile(r);if(!i)throw new F;if(this.updateMatchProfile(t,r,i),r=s,r!==ct.playerId){let f=await this.getProfile(r);if(!f)throw new F;this.updateMatchProfile(t,r,f)}else this.updateMatchProfile(t,r);await this.nextAsync(t)}validateData(t){let{customData:e}=t,{playerId:a,opponentId:s}=e;if(!a||typeof a!="string")throw new N;if(!s||typeof s!="string")throw new q}async getProfile(t){let{profile:e}=this.codex;return await e.requestProfiles([t]),e.getProfiles()[t]}updateMatchProfile(t,e,a){let{name:s,photo:r}=a??ct,i=new hu.Match.Profile({id:e,name:s,photo:r}).toObject();t.profiles[e]?(t.profiles[e].name=i.name,t.profiles[e].photo=i.photo):t.profiles[e]=i}},At=uu,yu=class extends _{async processAsync(t){try{this.startLog(t);let{matchId:e,playerId:a,opponentId:s}=t,r=new k(this),i=new Y(this,{id:e,mode:z.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:s}});r.setNext(i);let f=new au(this);i.setNext(f);let m=new At(this);f.setNext(m);let g=new du(this);m.setNext(g);let w=new X(this);g.setNext(w);let A=new G(this);w.setNext(A);let v=this.match.getMatchState();await r.processAsync(v)}finally{this.endLog()}}},pu=yu;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var fu=class extends dt{constructor(t){super(t),this.name="CreateContextFailed",this.message=t??"Create context failed"}},la=fu,{Valid:Hs,Object:Vs}=Ludex.Utils,mu=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t);let{opponentId:e}=this.payload,a=await this.createAsync(e);t.customData.contextId=a,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(a){this.validateError(a)}let e=GameSDK.context.getID();if(!Hs.isString(e))throw new la;return e}validateError(t){if(!Vs.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}validateErrorMessage(t){if(!Vs.hasOwn(t,"message")||!Hs.isString(t.message))throw t}isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.indexOf("is not a connected player of the current player")>-1}},gu=mu;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var wu=class extends dt{constructor(t){super(t),this.name="MatchAreNotOpen",this.message=t??"Match are not open"}},ue=wu,{Dtos:Au,Utils:{Object:vu}}=Ludex,Du=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.validateData(t);let e=await this.createMatchAsync(t),a=new Au.Match.Data(e).toObject();this.updateMatchState(t,a),await this.nextAsync(t)}validateData(t){let{status:e,customData:a}=t,{opponentId:s}=a;if(typeof s!="string")throw new q;if(e!==H.OPEN)throw new ue}async createMatchAsync(t){let{opponentId:e}=t.customData,{extraData:a}=this.payload;if(!e)return{};let s={opponentPlayerId:e,extraData:a};return this.match.api.getMatchAPI().createMatchAsync(s)}updateMatchState(t,e){this.updateMatchGeneral(t,e),this.updatePlayerIds(t,e),this.initializeProfiles(t),this.updateFinishStatus(t,e)}updateMatchGeneral(t,e){let{_id:a,extraData:s}=e;t.id=a||null,t.customData=vu.merge(t.customData,s)}updatePlayerIds(t,e){let{whitePlayerId:a,blackPlayerId:s}=e,{customData:r}=t,i=a===r.opponentId,f=i?s:a,m=i?a:s;t.customData.playerId=f,t.customData.opponentId=m}initializeProfiles(t){let{playerId:e,opponentId:a}=t.customData;if(!e||!a)return;let s={name:"",photo:"",finished:!1};t.profiles[e]||(t.profiles[e]=I({id:e},s)),t.profiles[a]||(t.profiles[a]=I({id:a},s))}updateFinishStatus(t,e){let{playerId:a,opponentId:s}=t.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerFinish:i,blackPlayerFinish:f}=e,m=r===t.customData.opponentId,g=m?f:i,w=m?i:f;t.profiles[a].finished=g,t.profiles[s].finished=w}},Ks=Du;n(),o(),l(),c(),d(),h(),u(),p(),y();var Iu=class extends b{async processAsync(t){if(super.processAsync(t),t.status!==H.OPEN)throw new ue;this.startMatch(t),await this.nextAsync(t)}startMatch(t){t.status=H.ACTIVE,t.startAt=Date.now()}},rt=Iu;n(),o(),l(),c(),d(),h(),u(),p(),y();var xu=class extends b{async processAsync(t){super.processAsync(t),this.validateData(t);let e=await this.createWideframesChallengeAsync(t);e&&this.sendMessageAsync(t,e),await this.nextAsync(t)}validateData(t){let{id:e,customData:a}=t,{contextId:s,opponentId:r}=a;if(!e||typeof e!="string")throw new ut;if(!s||typeof s!="string")throw new st;if(!r||typeof r!="string")throw new q}async createWideframesChallengeAsync(t){try{let{frameCapture:e}=this.codex,{profiles:a,customData:s}=t,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],m=a[i];if(!f||!m)return null;let{photo:g,score:w=0}=f,{photo:A,score:v=0}=m;return await e.wideframe.renderResultChallenge({playerId:r,playerPhoto:g,playerScore:w,opponentId:i,opponentPhoto:A,opponentScore:v,isPlayerFinished:!1,isOpponentFinished:!1})}catch{return null}}async sendMessageAsync(t,e){let{id:a,profiles:s,customData:r}=t,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");let{name:m}=s[i],g={data:{type:Ot.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${m} challenges you`,localizations:{vi_VN:`${m} th\u1EED th\xE1ch b\u1EA1n trong tr\u1EADn \u0111\u1EA5u n\xE0y. Ch\u01A1i ngay!`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(g)}},$s=xu,Su=class extends _{async processAsync(t){try{this.startLog(t);let{playerId:e,opponentId:a,extraData:s}=t,r=new k(this),i=new gu(this,{opponentId:a});r.setNext(i);let f=new Y(this,{mode:z.CHALLENGE_FRIEND,customData:{playerId:e,opponentId:a}});i.setNext(f);let m=new Ks(this,{extraData:s});f.setNext(m);let g=new At(this);m.setNext(g);let w=new rt(this);g.setNext(w);let A=new X(this);w.setNext(A);let v=new $s(this);A.setNext(v);let x=new G(this);v.setNext(x);let S=this.match.getMatchState();await r.processAsync(S)}finally{this.endLog()}}},Eu=Su;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Pu=class extends Error{constructor(t){super(t),this.name="SameContext",this.message=t??"Same context"}},ca=Pu,{Utils:Ws}=Ludex,bu=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t);let{contextId:e}=this.payload;await this.switchAsync(e),t.customData.contextId=e,await this.nextAsync(t)}checkSameContext(t){let e=t==="SOLO",a=GameSDK.context.getID();if(a===t)throw new ca;if(e&&a===null)throw new ca}async switchAsync(t){let e=t==="SOLO";try{this.checkSameContext(t),await GameSDK.context.switchAsync(t,e)}catch(a){if(a instanceof ca)return;if(!Ws.Object.hasOwn(a,"code"))throw a;if(Ws.Device.isAndroid()&&e&&a.code==="INVALID_PARAM")return;if(a.code!=="SAME_CONTEXT")throw a}}},ye=bu;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Dtos:Lu,Utils:{Object:Cu}}=Ludex,Nu=class extends b{async processAsync(t){super.processAsync(t),this.validateMatchData(t);let e=await this.getMatchAsync(t),a=new Lu.Match.Data(e).toObject();this.validateContinueMatchData(t,a),this.updateMatchData(t,a),this.validatePlayerTurn(t),await this.nextAsync(t)}validateMatchData(t){let{id:e,status:a}=t;if(typeof e!="string")throw new ut;if(a!==H.OPEN)throw new ue}validateContinueMatchData(t,e){let{id:a,customData:s}=t,{_id:r,whitePlayerId:i,blackPlayerId:f}=e;if(typeof r!="string"||r!==a)throw new ia;let{playerId:m}=s,g=i===m,w=f===m;if(!g&&f===ct.playerId)throw new Xe;if(!g&&!w)throw new na}validatePlayerTurn(t){let{profiles:e,customData:a}=t,{playerId:s}=a;if(typeof s!="string")throw new N;let{finished:r}=e[s];if(r)throw new xs}async getMatchAsync(t){let{id:e}=t;return e?this.match.api.getMatchAPI().getMatchDetailByIdAsync(e):{}}updateMatchData(t,e){this.updateMatchGeneral(t,e),this.updatePlayerIds(t,e),this.initializeProfiles(t),this.updateScoresAndStatus(t,e)}updateMatchGeneral(t,e){let{extraData:a}=e;t.customData=Cu.merge(t.customData,a)}updatePlayerIds(t,e){let{whitePlayerId:a,blackPlayerId:s}=e,r=a===t.customData.playerId;t.customData.playerId=r?a:s,t.customData.opponentId=r?s:a}initializeProfiles(t){let{playerId:e,opponentId:a}=t.customData;if(!e||!a)return;let s={name:"",photo:"",finished:!1};t.profiles[e]||(t.profiles[e]=I({id:e},s)),t.profiles[a]||(t.profiles[a]=I({id:a},s))}updateScoresAndStatus(t,e){let{playerId:a,opponentId:s}=t.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerScore:i,whitePlayerFinish:f,blackPlayerScore:m,blackPlayerFinish:g}=e,w=r===a;t.profiles[a].score=w?i:m,t.profiles[s].score=w?m:i,t.profiles[a].finished=w?f:g,t.profiles[s].finished=w?g:f}},Tu=Nu;n(),o(),l(),c(),d(),h(),u(),p(),y();var _u=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){if(super.processAsync(t),this.payload.ignore){await this.nextAsync(t);return}this.validateData(t);let e=await this.createWideframesCurrentScoreAsync();e&&this.sendMessageAsync(t,e),await this.nextAsync(t)}validateData(t){let{id:e,customData:a}=t,{contextId:s,opponentId:r}=a;if(!e||typeof e!="string")throw new ut;if(!s||typeof s!="string")throw new st;if(!r||typeof r!="string")throw new q}async createWideframesCurrentScoreAsync(){try{let{player:t,frameCapture:e}=this.codex,{playerId:a,photo:s}=t.getPlayer();return await e.wideframe.renderUpdateChallenge({playerId:a,playerPhoto:s})}catch{return null}}async sendMessageAsync(t,e){let{id:a,profiles:s,customData:r}=t,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");let m=s[i];if(!m)throw new F;let{name:g}=m,w={data:{type:Ot.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${g} made an update.`,localizations:{vi_VN:`${g} \u0111\xE3 c\u1EADp nh\u1EADt tr\u1EADn \u0111\u1EA5u. Ch\u01A1i ngay!`}},image:e,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");await GameSDK.extra.updateAsync(w)}},Ou=_u,Ru=class extends _{async processAsync(t){try{this.startLog(t);let{contextId:e,matchId:a,playerId:s,opponentId:r,sendUpdateMessage:i=!0}=t,f=new k(this),m=new ye(this,{contextId:e});f.setNext(m);let g=new Y(this,{id:a,mode:z.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:r}});m.setNext(g);let w=new Tu(this);g.setNext(w);let A=new At(this);w.setNext(A);let v=new rt(this);A.setNext(v);let x=new Ou(this,{ignore:!i});v.setNext(x);let S=new X(this);x.setNext(S);let P=new G(this);S.setNext(P);let C=this.match.getMatchState();await f.processAsync(C)}finally{this.endLog()}}},Mu=Ru;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Plugins:ku,Utils:Fu}=Ludex,{Analytics:Gu}=ku,{String:zs,Valid:qs}=Fu,Bu=class extends b{async processAsync(t){super.processAsync(t);let{customData:e,mode:a,startAt:s,finishAt:r}=t,{level:i}=e;this.validateMode(a),this.validateLevel(i);let{analytics:f}=this.codex,m=Math.floor((r-s)/1e3);f.event(Gu.Events.MATCH_END,{level:i,game_mode:zs.toUpperCamelCase(a),level_name:this.getLevelName(i),time_played:m}),await this.nextAsync(t)}validateMode(t){if(!qs.isString(t))throw new ra}validateLevel(t){if(!qs.isNumber(t))throw new Fs}getLevelName(t){return`Level ${zs.padStart(t.toString(),5,"0")}`}},Xt=Bu;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Uu=class extends Error{constructor(t){super(t),this.name="LeaderboardNotExist",this.message=t??"Leaderboard not exist in game"}},Ys=Uu;n(),o(),l(),c(),d(),h(),u(),p(),y();var ju=class extends Error{constructor(t){super(t),this.name="ScoreNotValid",this.message=t??"Score is not valid"}},da=ju,{Utils:{Valid:Hu},Configs:{Leaderboards:{LeaderboardList:Vu}}}=Ludex,Ku=class extends b{payload;skipPostScore;constructor(t,e){super(t),this.payload={score:0,playerId:""},this.skipPostScore=!!e?.ignore}async processAsync(t){if(super.processAsync(t),this.skipPostScore){await this.nextAsync(t);return}this.setupSetScorePayload(t),"submitGameResultsAsync"in GameSDK.extra&&await GameSDK.extra.submitGameResultsAsync(this.payload.score);for(let e of Vu){let{Id:a,Mode:s}=e;!t.mode||!this.isValidMode(s,t.mode)||this.setLeaderboardScoreAsync(I({leaderboardId:a},this.payload))}await this.nextAsync(t)}isValidMode(t,e){return t===e}async setupSetScorePayload(t){let{profiles:e,customData:a}=t,{playerId:s}=a;if(!s||!e[s])throw new F;let{score:r}=e[s];if(!Hu.isNumber(r))throw new da;this.payload={score:r,playerId:s}}async setLeaderboardScoreAsync(t){try{let{playerId:e,score:a,leaderboardId:s}=t,r=this.codex.leaderboard.getLeaderboardName(s);if(!r)throw new Ys;await this.codex.leaderboard.setLeaderboardScoreAsync(r,e,a)}catch{}}},pe=Ku;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Dtos:$u,Utils:Wu}=Ludex,{Valid:fe,Object:zu}=Wu,qu=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.validateMatchData(t);let{useAPI:e}=this.payload;if(e){let a=await this.finishMatchAsync(t),s=new $u.Match.Data(a).toObject();this.updateMatchFromAPI(t,s)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}validateMatchData(t){let{status:e,profiles:a,customData:s}=t;if(e!==H.ACTIVE)throw new Us;let{playerId:r}=s;if(!r||!zu.hasOwn(a,r))throw new na}updateMatchData(t){let{playerId:e}=t.customData;if(!fe.isString(e))throw new N;t.profiles[e].finished=!0}updateMatchState(t){t.status=H.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){let{id:e,profiles:a,customData:s}=t,{level:r,playerId:i}=s;if(!fe.isString(i))throw new N;let{score:f}=a[i],{extraData:m}=this.payload,g={matchId:e??"",score:f,level:r,extraData:m};return this.match.api.getMatchAPI().finishMatchAsync(g)}updateMatchFromAPI(t,e){let{playerId:a,opponentId:s}=t.customData;if(!fe.isString(a))throw new N;if(!fe.isString(s))throw new q;let{whitePlayerId:r,whitePlayerScore:i,blackPlayerScore:f,whitePlayerFinish:m,blackPlayerFinish:g}=e,w=a===r,A=w?i:f,v=w?f:i,x=w?m:g,S=w?g:m;t.profiles[a].score=A,t.profiles[s].score=v,t.profiles[a].finished=x,t.profiles[s].finished=S}},Zt=qu;n(),o(),l(),c(),d(),h(),u(),p(),y();var Yu=class extends b{async processAsync(t){super.processAsync(t),this.validateData(t);let e=await this.createWideframesResultAsync(t);e&&this.progressSendFinishedMessage(t,e),await this.nextAsync(t)}validateData(t){let{id:e,customData:a}=t,{contextId:s,opponentId:r}=a;if(!e||typeof e!="string")throw new ut;if(!s||typeof s!="string")throw new st;if(!r||typeof r!="string")throw new q}async createWideframesResultAsync(t){try{let{frameCapture:e}=this.codex,{profiles:a,customData:s}=t,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],m=a[i];if(!f||!m)return null;let{photo:g,score:w=0,finished:A}=f,{photo:v,score:x=0,finished:S}=m;return await e.wideframe.renderResultChallenge({playerId:r,playerPhoto:g,playerScore:w,opponentId:i,opponentPhoto:v,opponentScore:x,isPlayerFinished:!!A,isOpponentFinished:!!S})}catch{return null}}progressSendFinishedMessage(t,e){let{profiles:a,customData:s}=t,{playerId:r,opponentId:i}=s;if(!r||typeof r!="string")throw new N;if(!i||typeof i!="string")throw new q;if(!a[r]||!a[i])throw new F;let{score:f=0,finished:m}=a[r],{score:g=0,finished:w}=a[i];m?this.sendFinishMessageAsync(t,e):w&&f>g?this.sendBestScoreMessageAsync(t,e):this.sendPlayTurnMessageAsync(t,e)}async sendFinishMessageAsync(t,e){let{id:a,profiles:s,customData:r}=t,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");let m=s[i];if(!m)throw new F;let{name:g}=m,w={data:{type:Ot.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f,status:H.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem k\u1EBFt qu\u1EA3"}},text:{default:`${g} just finished. Check them now.`,localizations:{vi_VN:`${g} v\u1EEBa ho\xE0n th\xE0nh m\xE0n ch\u01A1i. Nh\u1EA5n \u0111\u1EC3 xem k\u1EBFt qu\u1EA3 tr\u1EADn \u0111\u1EA5u.`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");await GameSDK.extra.updateAsync(w)}async sendPlayTurnMessageAsync(t,e){let{id:a,profiles:s,customData:r}=t,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;let m=s[i];if(!m)throw new F;let{name:g,score:w}=m,A={data:{type:Ot.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f,status:H.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${g} got ${w} scores. So easy! Can you?`,localizations:{vi_VN:`${g} \u0111\xE3 \u0111\u1EA1t ${w} \u0111i\u1EC3m! Nh\u1EA5n Ch\u01A1i \u0111\u1EC3 so t\xE0i!`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");await GameSDK.extra.updateAsync(A)}async sendBestScoreMessageAsync(t,e){let{id:a,profiles:s,customData:r}=t,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;let m=s[i];if(!m)throw new F;let{name:g,score:w}=m,A={data:{type:Ot.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f,status:H.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem k\u1EBFt qu\u1EA3"}},text:{default:`${g} beat your high score. Their score: ${w}`,localizations:{vi_VN:`${g} \u0111\xE3 v\u01B0\u1EE3t qua \u0111i\u1EC3m s\u1ED1 c\u1EE7a b\u1EA1n, v\u1EDBi ${w} \u0111i\u1EC3m!`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");await GameSDK.extra.updateAsync(A)}},Ju=Yu;n(),o(),l(),c(),d(),h(),u(),p(),y();var Qu=class extends b{ignore;constructor(t,e){super(t),this.ignore=!!e?.ignore}async processAsync(t){super.processAsync(t),this.setPlayerBestScore(t),await this.nextAsync(t)}setPlayerBestScore(t){if(this.ignore)return;let{profiles:e,customData:a}=t,{playerId:s}=a;if(!s||!e[s])throw new F;let{player:r}=this.codex,i=r.getBestScore()||0,{score:f=0}=e[s];f<=i||(r.setBestScore(f),e[s].bestScore=f)}},te=Qu,Xu=class extends _{async processAsync(t){try{this.startLog(t);let{extraData:e}=t??{},a=new k(this),s=new Zt(this,{useAPI:!0,extraData:e});a.setNext(s);let r=new Ju(this);s.setNext(r);let i=new Xt(this);r.setNext(i);let f=new te(this);i.setNext(f);let m=new pe(this);f.setNext(m);let g=new G(this);m.setNext(g);let w=this.match.getMatchState();await a.processAsync(w)}finally{this.endLog()}}},Zu=Xu;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var ty=class extends Error{constructor(t){super(t),this.name="ContextAreSolo",this.message=t??"Context are solo"}},ey=ty;n(),o(),l(),c(),d(),h(),u(),p(),y();var ay=class extends Error{constructor(t){super(t),this.name="ContextNotChallenge",this.message=t??"Context is not a challenge"}},sy=ay;n(),o(),l(),c(),d(),h(),u(),p(),y();var ry=class extends Error{constructor(t){super(t),this.name="NetworkFailure",this.message=t??"Network failure"}},iy=ry,{Utils:ny,Dtos:oy}=Ludex,{Array:ly,Object:cy}=ny,dy=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.checkCurrentContext();let e=await this.getOpponentIdFromContextAsync();t.customData.opponentId=e,await this.nextAsync(t)}checkCurrentContext(){let t=GameSDK.context.getID();if(typeof t!="string")throw new st;if(t==="SOLO")throw new ey}async getOpponentIdFromContextAsync(){let{ignoreId:t}=this.payload,e=await this.getContextPlayers([t]);if(e.length>1)throw new sy;let a=ct;return e.length===1&&(a=e[0]),a.playerId}async getContextPlayers(t){try{let e=await GameSDK.context.getPlayersAsync(),a=[];for(let s of e){let r=s.getID();if(t.indexOf(r)>-1)continue;let i=s.getName();if(!i)continue;let f=s.getPhoto();a.push(new oy.Player.Info({playerId:r,name:i,photo:f}).toObject())}return ly.unique(a)}catch(e){if(cy.hasOwn(e,"code")&&e.code==="NETWORK_FAILURE")throw new iy;return[]}}},Js=dy;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var hy=class extends Error{constructor(t){super(t),this.name="ContextIsTournament",this.message=t??"Context is a tournament"}},ha=hy,{Object:uy}=Ludex.Utils,yy=class extends b{async processAsync(t){super.processAsync(t);let e=await this.chooseAsync();await this.checkContextTournament(),t.customData.contextId=e,await this.nextAsync(t)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(e){if(!uy.hasOwn(e,"code")||e.code!=="SAME_CONTEXT")throw e}let t=GameSDK.context.getID();if(typeof t!="string")throw new la;return t}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new ha):new O("getTournamentAsync")}catch(t){if(t instanceof ha)throw t}}},py=yy,fy=class extends _{async processAsync(t){try{this.startLog(t);let{playerId:e,extraData:a}=t,s=new k(this),r=new py(this);s.setNext(r);let i=new Y(this,{mode:z.CHALLENGE_FRIEND,customData:{playerId:e}});r.setNext(i);let f=new Js(this,{ignoreId:e});i.setNext(f);let m=new Ks(this,{extraData:a});f.setNext(m);let g=new At(this);m.setNext(g);let w=new rt(this);g.setNext(w);let A=new X(this);w.setNext(A);let v=new $s(this);A.setNext(v);let x=new G(this);v.setNext(x);let S=this.match.getMatchState();await s.processAsync(S)}finally{this.endLog()}}},my=fy;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var gy=class extends Error{constructor(t){super(t),this.name="JoinMatchFailed",this.message=t??"Join match failed"}},wy=gy;n(),o(),l(),c(),d(),h(),u(),p(),y();var Ay=class extends Error{constructor(t){super(t),this.name="MatchAreFinished",this.message=t??"Match are finished"}},vy=Ay;n(),o(),l(),c(),d(),h(),u(),p(),y();var Dy=class extends Error{constructor(t){super(t),this.name="OtherPlayerHasJoinedMatch",this.message=t??"Other player has joined match"}},Iy=Dy,{Dtos:xy,Utils:{Object:Sy}}=Ludex,Ey=class extends b{async processAsync(t){super.processAsync(t),this.validateMatchData(t);let e=await this.joinMatchAsync(t),a=new xy.Match.Data(e).toObject();this.validateJoinMatchData(t,a),this.updateMatchData(t,a),await this.nextAsync(t)}validateMatchData(t){let{status:e}=t;if(e!==H.OPEN)throw new ue}validateJoinMatchData(t,e){let{id:a,customData:s}=t,{_id:r,blackPlayerId:i,whitePlayerId:f,whitePlayerFinish:m,blackPlayerFinish:g}=e,w=i===s.playerId,A=f===s.opponentId;if(typeof r!="string"||r!==a||!A)throw new wy;if(m&&g)throw new vy;if(!w)throw new Iy}async joinMatchAsync(t){let{id:e}=t;return e?this.match.api.getMatchAPI().joinMatchAsync(e):{}}updateMatchData(t,e){this.updateMatchGeneral(t,e),this.updatePlayerIds(t,e),this.initializeProfiles(t),this.updateScoresAndStatus(t,e)}updateMatchGeneral(t,e){let{extraData:a}=e;t.customData=Sy.merge(t.customData,a)}updatePlayerIds(t,e){let{whitePlayerId:a,blackPlayerId:s}=e,{customData:r}=t,i=a===r.playerId,f=i?a:s,m=i?s:a;t.customData.playerId=f,t.customData.opponentId=m}initializeProfiles(t){let{playerId:e,opponentId:a}=t.customData;if(!e||!a)return;let s={name:"",photo:"",finished:!1};t.profiles[e]||(t.profiles[e]=I({id:e},s)),t.profiles[a]||(t.profiles[a]=I({id:a},s))}updateScoresAndStatus(t,e){let{playerId:a,opponentId:s}=t.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerScore:i,whitePlayerFinish:f,blackPlayerScore:m,blackPlayerFinish:g}=e,w=r===t.customData.playerId;t.profiles[a].score=w?i:m,t.profiles[s].score=w?m:i,t.profiles[a].finished=w?f:g,t.profiles[s].finished=w?g:f}},Py=Ey;n(),o(),l(),c(),d(),h(),u(),p(),y();var by=class extends b{async processAsync(t){super.processAsync(t),this.validateData(t);let e=await this.createWideframesAcceptedAsync(t);e&&this.sendMessageAsync(t,e),await this.nextAsync(t)}validateData(t){let{id:e,customData:a}=t,{contextId:s,opponentId:r}=a;if(!e||typeof e!="string")throw new ut;if(!s||typeof s!="string")throw new st;if(!r||typeof r!="string")throw new q}async createWideframesAcceptedAsync(t){try{let{frameCapture:e}=this.codex,{profiles:a,customData:s}=t,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],m=a[i];if(!f||!m)return null;let{photo:g,score:w=0,finished:A}=f;if(A)return null;let{photo:v,score:x=0,finished:S}=m;return S?await e.wideframe.renderResultChallenge({playerId:r,playerPhoto:g,playerScore:w,opponentId:i,opponentPhoto:v,opponentScore:x,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch{return null}}async sendMessageAsync(t,e){let{id:a,profiles:s,customData:r}=t,{playerId:i,opponentId:f}=r;if(!i||typeof i!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");let m=s[i];if(!m)throw new F;let{name:g}=m,w={data:{type:Ot.CHALLENGE_FRIEND,matchId:a,playerId:i,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${g} accepted the challenge.`,localizations:{vi_VN:`${g} \u0111\xE3 ch\u1EA5p nh\u1EADn tham gia tr\u1EADn \u0111\u1EA5u.`}},image:e,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(w)}},Ly=by,Cy=class extends _{async processAsync(t){try{this.startLog(t);let{matchId:e,playerId:a,opponentId:s}=t,r=new k(this),i=new Y(this,{id:e,mode:z.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:s}});r.setNext(i);let f=new Py(this);i.setNext(f);let m=new At(this);f.setNext(m);let g=new rt(this);m.setNext(g);let w=new Ly(this);g.setNext(w);let A=new X(this);w.setNext(A);let v=new G(this);A.setNext(v);let x=this.match.getMatchState();await r.processAsync(x)}finally{this.endLog()}}},Ny=Cy;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Ty={_id:"",status:"",appId:"",createdAt:"",startedAt:null,finishedAt:null,winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1,extraData:{}},_y=Ty,{Configs:{AppId:Oy},Utils:{Valid:V}}=Ludex,K="is invalid",ua=class extends lt{setupData(t){this.d(t)}n(t){this.l(t)}o(t){this.c(t)}validateId(t){(!V.isString(t)||!t)&&this.t("_id",K)}validateStatus(t){(!V.isString(t)||!t)&&this.t("status",K)}validateAppId(t){(!V.isString(t)||t!==Oy)&&this.t("appId",K)}validateCreatedAt(t){V.isString(t)||this.t("createdAt",K)}validateStartedAt(t){t!==null&&(V.isString(t)||this.t("startedAt",K))}validateFinishedAt(t){t!==null&&(V.isString(t)||this.t("finishedAt",K))}validateExtraData(t){t!==null&&(V.isObject(t)||this.t("extraData",K))}validateWinnerId(t){t!==null&&(!V.isString(t)||!t)&&this.t("winnerId",K)}validateWhitePlayerId(t){(!V.isString(t)||!t)&&this.t("whitePlayerId",K)}validateBlackPlayerId(t){(!V.isString(t)||!t)&&this.t("blackPlayerId",K)}validateWhitePlayerScore(t){V.isNumber(t)||this.t("whitePlayerScore",K)}validateBlackPlayerScore(t){V.isNumber(t)||this.t("blackPlayerScore",K)}validateWhitePlayerFinish(t){V.isBoolean(t)||this.t("whitePlayerFinish",K)}validateBlackPlayerFinish(t){V.isBoolean(t)||this.t("blackPlayerFinish",K)}toObject(){return super.toObject()}};ua.makeStrict(),ua.addDefaultData(_y);var Qs=ua;n(),o(),l(),c(),d(),h(),u(),p(),y();var Ry=class extends Error{constructor(t){super(t),this.name="MatchAreNotFinished",this.message=t||"Match are not finished"}},My=Ry;n(),o(),l(),c(),d(),h(),u(),p(),y();var ky=class extends Error{constructor(t){super(t),this.name="OpponentNotFinishedMatch",this.message=t||"Opponent not finished match"}},Fy=ky,{Utils:{Object:Gy}}=Ludex,By=class extends b{async processAsync(t){super.processAsync(t),this.validateMatchData(t);let e=await this.getMatchAsync(t),a=new Qs(e).toObject();this.validateResultMatchData(t,a),this.updateMatchData(t,a),this.validatePlayerTurn(t),this.validateOpponentTurn(t),await this.nextAsync(t)}validateMatchData(t){let{id:e}=t;if(typeof e!="string")throw new ut}validateResultMatchData(t,e){let{id:a}=t,{_id:s,whitePlayerFinish:r,blackPlayerFinish:i}=e;if(typeof s!="string"||s!==a)throw new ia;if(!r&&!i)throw new My}validatePlayerTurn(t){let{profiles:e,customData:a}=t,{playerId:s}=a;if(typeof s!="string")throw new N;let{finished:r}=e[s];if(!r)throw new js}validateOpponentTurn(t){let{profiles:e,customData:a}=t,{opponentId:s}=a;if(typeof s!="string")throw new q;let{finished:r}=e[s];if(!r)throw new Fy}async getMatchAsync(t){let{id:e}=t;return e?this.match.api.getMatchAPI().getMatchDetailByIdAsync(e):null}updateMatchData(t,e){this.updateMatchGeneral(t,e),this.updatePlayerIds(t,e),this.initializeProfiles(t),this.updateScoresAndStatus(t,e)}updateMatchGeneral(t,e){let{extraData:a}=e;t.status=H.FINISHED,t.customData=Gy.merge(t.customData,a)}updatePlayerIds(t,e){let{whitePlayerId:a,blackPlayerId:s}=e,{customData:r}=t,i=a===r.playerId,f=i?a:s,m=i?s:a;t.customData.playerId=f,t.customData.opponentId=m}initializeProfiles(t){let{playerId:e,opponentId:a}=t.customData;if(!e||!a)return;let s={name:"",photo:"",finished:!0};t.profiles[e]||(t.profiles[e]=I({id:e},s)),t.profiles[a]||(t.profiles[a]=I({id:a},s))}updateScoresAndStatus(t,e){let{playerId:a,opponentId:s}=t.customData;if(!a||!s)return;let{whitePlayerId:r,whitePlayerScore:i,whitePlayerFinish:f,blackPlayerScore:m,blackPlayerFinish:g}=e,w=r===t.customData.playerId;t.profiles[a].score=w?i:m,t.profiles[s].score=w?m:i,t.profiles[a].finished=w?f:g,t.profiles[s].finished=w?g:f}},Uy=By,jy=class extends _{async processAsync(t){try{this.startLog(t);let{matchId:e,playerId:a,opponentId:s}=t,r=new k(this),i=new Y(this,{id:e,mode:z.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:s}});r.setNext(i);let f=new Uy(this);i.setNext(f);let m=new At(this);f.setNext(m);let g=new G(this);m.setNext(g);let w=this.match.getMatchState();await r.processAsync(w)}finally{this.endLog()}}},Hy=jy;n(),o(),l(),c(),d(),h(),u(),p(),y();var Vy=class extends _{fallbackSingleMode;async processAsync(t){try{this.startLog(t);let{playerId:e,extraData:a,fallbackSingleMode:s}=t;this.fallbackSingleMode=s;let r=await this.startFLowChallengeFriend({playerId:e,extraData:a});if(r===!0)return;if(r instanceof ha)await this.startFlowTournament(e);else if(this.fallbackSingleMode)await this.startFlowSingle(e);else throw r}finally{this.endLog()}}startFLowChallengeFriend=async t=>{try{return await this.match.challenge.invite.processAsync(t),!0}catch(e){return e}};startFlowTournament=async t=>{try{let e=GameSDK.context.getID();if(typeof e!="string")throw new st;await this.match.tournament.continue.processAsync({playerId:t,contextId:e})}catch{await this.startFlowSingle(t)}};startFlowSingle=async t=>this.match.single.start.processAsync({playerId:t})},Ky=Vy;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var $y=class extends Error{constructor(t){super(t),this.name="LeaderboardIdNotValid",this.message=t??"Leaderboard id is not valid"}},ee=$y;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:Xs}=Ludex.Utils,Wy=class extends b{payload;leaderboardPayload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.setupSetScorePayload(t),"submitGameResultsAsync"in GameSDK.extra&&await GameSDK.extra.submitGameResultsAsync(this.payload.score),this.setLeaderboardScoreAsync(),await this.nextAsync(t)}async setupSetScorePayload(t){let{profiles:e,customData:a}=t,{playerId:s}=a;if(!s||!e[s])throw new F;let{score:r,leaderboardId:i}=this.payload;if(!Xs.isNumber(r))throw new da;if(!Xs.isString(i))throw new ee;this.leaderboardPayload={score:r,playerId:s,leaderboardId:i}}async setLeaderboardScoreAsync(){try{let{playerId:t,score:e,leaderboardId:a}=this.leaderboardPayload,s=this.codex.leaderboard.getLeaderboardName(a);if(!s)throw new Ys;await this.codex.leaderboard.setLeaderboardScoreAsync(s,t,e)}catch{}}},Zs=Wy,{Utils:{Valid:zy}}=Ludex,qy=class extends Zs{constructor(t){super(t,{score:0,leaderboardId:""})}async setupSetScorePayload(t){let{profiles:e,customData:a}=t,{playerId:s,leaderboardId:r}=a;if(!r)throw new ee;if(!s||!e[s])throw new F;let{score:i}=e[s];if(!zy.isNumber(i))throw new da;this.payload.score=i,this.payload.leaderboardId=r,super.setupSetScorePayload(t)}},ya=qy;n(),o(),l(),c(),d(),h(),u(),p(),y();var Yy=class extends b{async processAsync(t){super.processAsync(t),this.validateData(t),this.progressSendGroupMessage(t),await this.nextAsync(t)}validateData(t){let{id:e,customData:a}=t,{contextId:s,opponentId:r}=a;if(!e||typeof e!="string")throw new ut;if(!s||typeof s!="string")throw new st;if(!r||typeof r!="string")throw new q}async createWideframesResultGroupAsync(t){try{let{frameCapture:e}=this.codex,{profiles:a,customData:s}=t,{playerId:r,opponentId:i}=s;if(!r||!i)return null;let f=a[r],m=a[i];if(!f||!m)return null;let{photo:g,score:w=0}=f,{photo:A,score:v=0}=m;return await e.wideframe.renderResultChallenge({playerId:r,playerPhoto:g,playerScore:w,opponentId:i,opponentPhoto:A,opponentScore:v,isPlayerFinished:!0,isOpponentFinished:!0})}catch{return null}}async createWideframesBestScoreAsync(t){try{let{player:e,frameCapture:a}=this.codex,{playerId:s}=t.customData,{playerId:r,photo:i,data:f}=e.getPlayer();if(s!==r)return null;let{score:m}=f||{};return await a.wideframe.renderShareScore({playerId:r,playerPhoto:i,playerScore:m})}catch{return null}}async progressSendGroupMessage(t){let{profiles:e,customData:a}=t,{playerId:s,opponentId:r}=a;if(r&&typeof r=="string"){if(!s||typeof s!="string")throw new N;let f=e[s],m=e[r];if(!f||!m)return;let{score:g=0}=f,{score:w=0}=m;if(g>w){let A=await this.createWideframesResultGroupAsync(t);if(!A)return;this.sendBestScoreMessageAsync(t,A);return}}let i=await this.createWideframesBestScoreAsync(t);i&&this.sendChallengeMessageAsync(t,i)}async sendBestScoreMessageAsync(t,e){let{profiles:a,customData:s}=t,{playerId:r}=s;if(!r||typeof r!="string")throw new N;if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");let i=a[r];if(!i)throw new F;let{name:f,score:m}=i,g={data:{type:this.codex.context.getSessionContextTypes().MATCHING_GROUP,playerId:r,playerName:f,playerScore:m},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i"}},text:{default:`${f} beats your high score. Their score: ${m}.`,localizations:{vi_VN:`${f} v\u1EEBa v\u01B0\u1EE3t \u0111i\u1EC3m s\u1ED1 cao nh\u1EA5t c\u1EE7a b\u1EA1n! Ch\u01A1i l\u1EA7n n\u1EEFa ch\u1EE9?`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");await GameSDK.extra.updateAsync(g)}async sendChallengeMessageAsync(t,e){let{profiles:a,customData:s}=t,{playerId:r}=s;if(!r||typeof r!="string")throw new N;let i=a[r];if(!i)throw new F;let{name:f,score:m}=i,g={data:{type:this.codex.context.getSessionContextTypes().MATCHING_GROUP,playerId:r,playerName:f,playerScore:m},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Ch\u01A1i ngay"}},text:{default:`${f} got ${m} scores. So easy! Can you?`,localizations:{vi_VN:`${f} \u0111\xE3 \u0111\u1EA1t ${m} \u0111i\u1EC3m! Qu\xE1 d\u1EC5 lu\xF4n. Ch\u01A1i l\u1EA1i n\xE0o!`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new O("updateAsync");await GameSDK.extra.updateAsync(g)}},Jy=Yy,Qy=class extends _{async processAsync(){try{this.startLog();let t=new k(this),e=new Zt(this,{useAPI:!1});t.setNext(e);let a=new Jy(this);e.setNext(a);let s=new Xt(this);a.setNext(s);let r=new te(this);s.setNext(r);let i=new ya(this);r.setNext(i);let f=new G(this);i.setNext(f);let m=this.match.getMatchState();await t.processAsync(m)}finally{this.endLog()}}},Xy=Qy;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Dtos:Zy}=Ludex,tp=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){let{id:e}=this.payload,{profiles:a}=t;if(!a[e])throw new F;let s=I(I({},a[e]),this.payload),r=new Zy.Match.Profile(s).toObject();a[r.id]=r}},me=tp,ep=class extends _{async processAsync(t){try{this.startLog(t);let{playerId:e,opponentId:a,opponentScore:s}=t,r=new k(this),i=new Y(this,{id:"7749",mode:z.MATCHING_GROUP,customData:{playerId:e,opponentId:a}});r.setNext(i);let f=new At(this);i.setNext(f);let m=new me(this,{id:e,score:s});f.setNext(m);let g=new rt(this);m.setNext(g);let w=new X(this);g.setNext(w);let A=new G(this);w.setNext(A);let v=this.match.getMatchState();await r.processAsync(v)}finally{this.endLog()}}},ap=ep;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var sp=class extends Error{constructor(t){super(t),this.name="MatchGroupNotSupported",this.message=t??"Match group is not supported"}},tr=sp,rp=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();let e=await this.matchingGroup();t.customData.contextId=e,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new O("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new O("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new tr;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new tr}async matchingGroup(){if(!("matchPlayerAsync"in GameSDK.extra))throw new O("matchPlayerAsync");let{matchTag:t,autoSwitch:e=!1,onlyExisting:a=!1}=this.payload;await GameSDK.extra.matchPlayerAsync(t,e,a);let s=GameSDK.context.getID();if(typeof s!="string")throw new la;return s}},ip=rp,np=class extends _{async processAsync(t){try{this.startLog(t);let{matchTag:e,playerId:a,options:s}=t,r=new k(this),i=new ip(this,I({matchTag:e},s));r.setNext(i);let f=new Y(this,{id:"7749",mode:z.MATCHING_GROUP,customData:{playerId:a}});i.setNext(f);let m=new Js(this,{ignoreId:a});f.setNext(m);let g=new rt(this);m.setNext(g);let w=new At(this);g.setNext(w);let A=new X(this);w.setNext(A);let v=new G(this);A.setNext(v);let x=this.match.getMatchState();await r.processAsync(x)}finally{this.endLog()}}},op=np;n(),o(),l(),c(),d(),h(),u(),p(),y();var lp=class extends _{async processAsync(){try{this.startLog();let t=new k(this),e=new Zt(this,{useAPI:!1});t.setNext(e);let a=new Xt(this);e.setNext(a);let s=new te(this);a.setNext(s);let r=new pe(this);s.setNext(r);let i=new G(this);r.setNext(i);let f=this.match.getMatchState();await t.processAsync(f)}finally{this.endLog()}}},cp=lp;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var dp=class extends Error{constructor(t){super(t),this.name="ProfileIdNotDefined",this.message=t??"Profile id is not defined"}},hp=dp,{Dtos:up}=Ludex,yp=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t);let{profileId:e}=this.payload;if(!e)throw new hp;let{player:a}=this.codex,s=a.getPlayerId(),r;if(e===s)r=this.getPlayerProfile();else if(r=await this.getProfileAsync(e),!r)throw new F;this.updateMatchData(r,t),await this.nextAsync(t)}getPlayerProfile(){let{player:t}=this.codex,{playerId:e,name:a,photo:s,locale:r}=t.getPlayer();return{playerId:e,name:a,photo:s,locale:r}}async getProfileAsync(t){let{profile:e}=this.codex;return await e.requestProfiles([t]),e.getProfiles()[t]}updateMatchData(t,e){let{playerId:a,name:s,photo:r}=t,i=new up.Match.Profile({id:a,name:s,photo:r}).toObject();e.profiles[a]=i}},ae=yp,pp=class extends _{async processAsync(t){try{this.startLog(t);let{playerId:e}=t,a=new k(this),s=new ye(this,{contextId:"SOLO"});a.setNext(s);let r=new Y(this,{id:"123456",mode:z.SINGLE,customData:{playerId:e}});s.setNext(r);let i=new rt(this);r.setNext(i);let f=new ae(this,{profileId:e});i.setNext(f);let m=new X(this);f.setNext(m);let g=new G(this);m.setNext(g);let w=this.match.getMatchState();await a.processAsync(w)}finally{this.endLog()}}},fp=pp;n(),o(),l(),c(),d(),h(),u(),p(),y();var mp=class extends _{async processAsync(t){try{this.startLog(t);let{setPlayerBestScore:e=!1,postGlobalLeaderboard:a=!1}=t??{},s=new k(this),r=new Zt(this,{useAPI:!1});s.setNext(r);let i=new Xt(this);r.setNext(i);let f=new te(this,{ignore:!e});i.setNext(f);let m=new pe(this,{ignore:!a});f.setNext(m);let g=new G(this);m.setNext(g);let w=this.match.getMatchState();await s.processAsync(w)}finally{this.endLog()}}},gp=mp;n(),o(),l(),c(),d(),h(),u(),p(),y();var wp=class extends _{async processAsync(t){try{this.startLog(t);let{matchId:e,playerId:a,gameMode:s,extraData:r={}}=t,i=new k(this),f=new ye(this,{contextId:"SOLO"});i.setNext(f);let m=new Y(this,{id:e,mode:s,customData:I({playerId:a},r)});f.setNext(m);let g=new rt(this);m.setNext(g);let w=new ae(this,{profileId:a});g.setNext(w);let A=new X(this);w.setNext(A);let v=new G(this);A.setNext(v);let x=this.match.getMatchState();await i.processAsync(x)}finally{this.endLog()}}},Ap=wp;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Plugins:vp,Utils:Dp}=Ludex,{Analytics:Ip}=vp,{String:xp,Valid:Sp}=Dp,Ep=class extends b{async processAsync(t){super.processAsync(t);let{mode:e,customData:a}=t;this.validateMode(e);let{analytics:s}=this.codex,{tournamentId:r,leaderboardId:i}=a;s.event(Ip.Events.TOURNAMENT_START,{success:!0,game_mode:xp.toUpperCamelCase(e),tournament_id:r,leaderboard_id:i}),await this.nextAsync(t)}validateMode(t){if(!Sp.isString(t))throw new ra}},er=Ep;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Pp=class extends Error{constructor(t){super(t),this.name="TournamentIdNotValid",this.message=t??"Tournament id is not valid"}},ar=Pp,{Valid:pa}=Ludex.Utils,bp=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t);let{contextId:e}=this.payload;this.validateContextId(e);let a=await GameSDK.getTournamentAsync(),s=a.getID().toString();this.validateTournamentId(s);let r=JSON.parse(a.getPayload()||"{}"),{leaderboardId:i}=r;this.validateLeaderboardId(i),t.customData.contextId=e,t.customData.tournamentId=s,t.customData.leaderboardId=i,await this.nextAsync(t)}validateContextId(t){if(!pa.isString(t))throw new st}validateTournamentId(t){if(!pa.isString(t))throw new ar}validateLeaderboardId(t){if(!pa.isString(t)||t==="")throw new ee}},Lp=bp,Cp=class extends _{async processAsync(t){try{this.startLog(t);let{playerId:e,contextId:a}=t,s=new k(this),r=new Lp(this,{contextId:a});s.setNext(r);let i=new Y(this,{id:"1997",mode:z.TOURNAMENT,customData:{playerId:e}});r.setNext(i);let f=new rt(this);i.setNext(f);let m=new ae(this,{profileId:e});f.setNext(m);let g=new X(this);m.setNext(g);let w=new er(this);g.setNext(w);let A=new G(this);g.setNext(A);let v=this.match.getMatchState();await s.processAsync(v)}finally{this.endLog()}}},Np=Cp;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Plugins:Tp}=Ludex,{Analytics:_p}=Tp,Op=class extends b{async processAsync(t){super.processAsync(t);let{customData:e}=t,{analytics:a}=this.codex,{tournamentId:s,leaderboardId:r}=e;a.event(_p.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:s,leaderboard_id:r}),await this.nextAsync(t)}},Rp=Op;n(),o(),l(),c(),d(),h(),u(),p(),y();var Mp=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),await this.createTournamentAsync(),await this.updateMatchStateAsync(t),await this.nextAsync(t)}async createTournamentAsync(){let{name:t,score:e,customData:a}=this.payload;await GameSDK.tournament.createAsync({initialScore:e,config:{title:t,tournamentTitle:t},data:a})}async updateMatchStateAsync(t){try{if(!("getTournamentAsync"in GameSDK))throw new O("getTournamentAsync");let e=await GameSDK.getTournamentAsync(),a=e.getContextID(),s=e.getID().toString(),{playerId:r}=this.payload;t.customData.playerId=r,t.customData.contextId=a,t.customData.tournamentId=s}catch(e){if(e instanceof O)return}}},kp=Mp;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:sr}=Ludex.Utils,Fp=class extends b{payload;leaderboardPayload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.validatePayload(),await this.setupCreatePayload(t),await this.createLeaderboardAsync(t),await this.nextAsync(t)}validatePayload(){let{leaderboardId:t}=this.payload;if(!sr.isString(t))throw new ee}validatePlayerId(t){if(!sr.isString(t))throw new N}async setupCreatePayload(t){let{playerId:e}=t.customData;this.validatePlayerId(e);let{name:a,leaderboardId:s,customData:r}=this.payload;this.leaderboardPayload={_id:s,name:a??"",createdBy:e,description:JSON.stringify(r)}}async createLeaderboardAsync(t){let e=await this.codex.leaderboard.createLeaderboardAsync(this.leaderboardPayload);t.customData.leaderboardId=e}},Gp=Fp,Bp=class extends _{async processAsync(t){try{this.startLog(t);let{playerId:e,name:a,score:s,leaderboardId:r,payload:i}=t,f=new k(this),m=new ye(this,{contextId:"SOLO"});f.setNext(m);let g=new kp(this,{name:a,score:s,playerId:e,customData:i});m.setNext(g);let w=new ae(this,{profileId:e});g.setNext(w);let A=new me(this,{id:e,score:s});w.setNext(A);let v=new Gp(this,{name:a,customData:i,leaderboardId:r});A.setNext(v);let x=new ya(this);v.setNext(x);let S=new Rp(this);x.setNext(S);let P=this.match.getMatchState();await f.processAsync(P)}finally{this.endLog()}}},Up=Bp;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Plugins:{Analytics:rr},Utils:{Valid:jp}}=Ludex,Hp=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.validateData(t),await this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){let{profiles:e,customData:a}=t,{playerId:s}=a;if(this.validatePlayerId(s),!e[s])throw new F}validatePlayerId(t){if(!jp.isString(t))throw new N}getPlayerProfile(t){let{profiles:e,customData:a}=t,{playerId:s}=a;return this.validatePlayerId(s),e[s]}isNewBestScore(t){let e=this.getPlayerProfile(t),{score:a=0,bestScore:s=0}=e;return a>s}async postScoreTournamentAsync(t){let{analytics:e}=codex,a=this.getPlayerProfile(t),{score:s=0}=a,r=null,i=!1,{checkBestScore:f}=this.payload,m=this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new O("getTournamentAsync");await GameSDK.getTournamentAsync(),!f||m?(r=rr.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:s})):(r=rr.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(s)),i=!0}catch{}finally{r&&e.event(r,{success:i})}}},Vp=Hp,Kp=class extends _{async processAsync(t){try{this.startLog(t);let{playerId:e,bestScore:a,checkBestScore:s=!1}=t,r=new k(this),i=new Zt(this,{useAPI:!1});r.setNext(i);let f=new me(this,{id:e,bestScore:a});i.setNext(f);let m=new Vp(this,{checkBestScore:s});f.setNext(m);let g=new Xt(this);m.setNext(g);let w=new te(this);g.setNext(w);let A=new ya(this);w.setNext(A);let v=new pe(this);A.setNext(v);let x=new G(this);v.setNext(x);let S=this.match.getMatchState();await r.processAsync(S)}finally{this.endLog()}}},$p=Kp;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:fa,Object:Wp}=Ludex.Utils,zp=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t);let{tournamentId:e}=this.payload;this.validateTournamentId(e),await this.joinTournamentAsync(e);let a=await GameSDK.getTournamentAsync(),s=a.getContextID();this.validateContextId(s);let r=JSON.parse(a.getPayload()||"{}"),{leaderboardId:i}=r;this.validateLeaderboardId(i),t.customData.contextId=s,t.customData.tournamentId=e,t.customData.leaderboardId=i,await this.nextAsync(t)}validateTournamentId(t){if(!fa.isString(t))throw new ar}validateContextId(t){if(!fa.isString(t))throw new st}validateLeaderboardId(t){if(!fa.isString(t)||t==="")throw new ee}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new O("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(e){if(!Wp.hasOwn(e,"code")||e.code!=="SAME_CONTEXT")throw e}}},qp=zp,Yp=class extends _{async processAsync(t){try{this.startLog(t);let{playerId:e,tournamentId:a}=t,s=new k(this),r=new qp(this,{tournamentId:a});s.setNext(r);let i=new Y(this,{id:"1997",mode:z.TOURNAMENT,customData:{playerId:e}});r.setNext(i);let f=new rt(this);i.setNext(f);let m=new ae(this,{profileId:e});f.setNext(m);let g=new X(this);m.setNext(g);let w=new er(this);g.setNext(w);let A=new G(this);w.setNext(A);let v=this.match.getMatchState();await s.processAsync(v)}finally{this.endLog()}}},Jp=Yp;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Dtos:Qp,Utils:Xp}=Ludex,{Object:Zp}=Xp,tf=class extends b{async processAsync(t){super.processAsync(t);let e=await this.getMatchCustomData(t);this.updateMatchCustomData(t,e),await this.nextAsync(t)}async getMatchCustomData(t){let{id:e}=t;return e?(await this.match.api.getMatchAPI().getMatchDetailByIdAsync(e))?.extraData??{}:{}}updateMatchCustomData(t,e){let a=Zp.merge(t.customData,e),s=new Qp.Match.CustomData(a).toObject();t.customData=s}},ef=tf;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Dtos:af,Utils:sf}=Ludex,{Object:rf}=sf,nf=class extends b{payload;constructor(t,e){super(t),this.payload=e}async processAsync(t){super.processAsync(t),this.updateMatchCustomData(t),await this.nextAsync(t)}updateMatchCustomData(t){let e=rf.merge(t.customData,this.payload),a=new af.Match.CustomData(e).toObject();t.customData=a}},of=nf;n(),o(),l(),c(),d(),h(),u(),p(),y();var lf={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:I({},oa)},cf=lf,{Configs:ir}=Ludex,df=class extends Ludex.Plugins.BasePlugin{base;group;single;context;strategy;challenge;tournament;api;handler;useCPUProfile;init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){let{storage:t}=this.codex;t.addStorage("match",cf)}getMatchState(){let{storage:t}=this.codex;return t.getStorage("match")}createBaseConcrete(){this.base=new _(this.codex,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createContextFlows(),this.createStrategyFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:async t=>{let e=new me(this.base,t);await this.processHandlerAsync(e)},setMatchCustomData:async t=>{let e=new of(this.base,t);await this.processHandlerAsync(e)},getMatchCustomData:async()=>{let t=new ef(this.base);await this.processHandlerAsync(t)},setLeaderboardScore:async t=>{let e=new Zs(this.base,t);await this.processHandlerAsync(e)}}}createAPIHandler(){let t={appId:ir.AppId,matchAPIHost:ir.ApiHost};this.api=new Th(t)}createGroupFlows(){this.group={join:new ap(this.codex,this),start:new op(this.codex,this),finish:new Xy(this.codex,this)}}createSingleFlows(){this.single={start:new fp(this.codex,this),finish:new cp(this.codex,this)}}createStrategyFlows(){this.strategy={start:new Ap(this.codex,this),finish:new gp(this.codex,this)}}createContextFlows(){this.context={choose:new Ky(this.codex,this)}}createChallengeFlows(){this.challenge={invite:new my(this.codex,this),friend:new Eu(this.codex,this),join:new Ny(this.codex,this),await:new pu(this.codex,this),result:new Hy(this.codex,this),finish:new Zu(this.codex,this),continue:new Mu(this.codex,this)}}createTournamentFlows(){this.tournament={join:new Jp(this.codex,this),create:new Up(this.codex,this),finish:new $p(this.codex,this),continue:new Np(this.codex,this)}}processHandlerAsync(t){let e=this.getMatchState();return t.processAsync(e)}},hf=df;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:Rt}=Ludex.Utils,Mt="is invalid",ma=class extends lt{setupData(t){this.d(t)}n(t){this.l(t)}o(t){this.c(t)}validateLevel(t){(!Rt.isNumber(t)||t<0)&&this.t("level",Mt)}validateRescued(t){(!Rt.isNumber(t)||t<0)&&this.t("rescued",Mt)}validateContextId(t){Rt.isString(t)||this.t("contextId",Mt)}validatePlayerId(t){Rt.isString(t)||this.t("playerId",Mt)}validateOpponentId(t){!Rt.isString(t)&&t!==null&&this.t("opponentId",Mt)}validateTournamentId(t){!Rt.isString(t)&&t!==null&&this.t("tournamentId",Mt)}validateLeaderboardId(t){!Rt.isString(t)&&t!==null&&this.t("leaderboardId",Mt)}toObject(){return super.toObject()}};ma.makeStrict(),ma.addDefaultData(oa);var uf=ma;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:Bt}=Ludex.Utils,Ut="is invalid",nr=class extends lt{setupData(t){this.d(t)}n(t){this.l(t)}o(t){this.c(t)}validateId(t){(!Bt.isString(t)||!t)&&this.t("id",Ut)}validateName(t){(!Bt.isString(t)||!t)&&this.t("name",Ut)}validatePhoto(t){Bt.isString(t)||this.t("photo",Ut)}validateScore(t){(!Bt.isNumber(t)||t<0)&&this.t("score",Ut)}validateBestScore(t){(!Bt.isNumber(t)||t<0)&&this.t("bestScore",Ut)}validateFinished(t){Bt.isBoolean(t)||this.t("finished",Ut)}toObject(){return super.toObject()}};nr.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1});var yf=nr;Ludex.Dtos.Match={Data:Qs,Profile:yf,CustomData:uf};var pf=hf;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var ff=[{id:"finish-level",title:"Finish 1 level",require:{level:1},reward:{coin:300},duration:1e3*60*60*24}],mf=class{async getMissionsAsync(){return[...ff]}},gf=mf;n(),o(),l(),c(),d(),h(),u(),p(),y();var wf={tasks:[],process:{}},Af=wf,{Utils:{Json:or,Valid:lr,Object:ge}}=Ludex,vf=class extends Ludex.Plugins.BasePlugin{api;init(){let{storage:t}=this.codex;t.addStorage("missions",Af,!0),this.api=new gf}async requestMissions(){let t=await this.api.getMissionsAsync(),e=Date.now();for(let a of t)a.expirationTime=e+a.duration;this.receivePlayerMissionData(t)}addMission(t){let{storage:e}=this.codex,{id:a,duration:s,expirationTime:r}=t;r||(t.expirationTime=Date.now()+s);let i=e.getStorageData("missions","tasks")??[],f=i.findIndex(g=>g.id===a);if(f!==-1){let g=ge.merge(i[f],t);i[f]=g}else i.push(t);let m=[...i];e.setStorageData("missions","tasks",m),this.addProcessLog(t),this.updatePlayerMissionProcess(),e.updateToWebStorage("missions")}addProcessLog(t){let{storage:e}=this.codex,{id:a,require:s}=t,r={},i=Object.keys(s);for(let m of i)r[m]=0;let f=e.getStorageData("missions","process")??{};f[a]={require:r,rewarded:!1},e.setStorageData("missions","process",f)}removeMission(t){let{storage:e}=this.codex,a=e.getStorageData("missions","tasks");if(!a)return;let s=a.filter(r=>r.id!==t);e.setStorageData("missions","tasks",s),this.removeProcessLog(t),e.updateToWebStorage("missions")}removeProcessLog(t){let{storage:e}=this.codex,a=e.getStorageData("missions","process")??{};if(a[t]){let{require:s}=a[t],r=Object.keys(s);for(let i of r)s[i]=0;a[t]={require:s,rewarded:!1}}e.setStorageData("missions","process",a)}receivePlayerMissionData(t){let{storage:e}=this.codex,a=e.getStorageData("missions","tasks")??[],s=this.filterMissionByExpirationTime(a),r=this.combineMissions(t,s);e.setStorageData("missions","tasks",r);let i=this.filterExistingSavedProcess(s);this.receiveProcessLogs(r,i),this.updatePlayerMissionProcess(),e.updateToWebStorage("missions")}filterExistingSavedProcess(t){let{player:e}=this.codex,a=e.getPlayerDataByKey("missionsData"),{process:s={}}=a||{},r=t.map(m=>m.id),i=Object.keys(s).filter(m=>!r.includes(m)),f={};for(let m of i)f[m]=s[m];return f}filterMissionByExpirationTime(t){let e=Date.now();return t.filter(a=>{let{expirationTime:s}=a;return s?e<s:!1})}combineMissions(t,e){let a=e.map(r=>r.id),s=t.filter(r=>{let{id:i}=r;return!a.includes(i)});return[...e,...s]}receiveProcessLogs(t,e){let a={};for(let s of t){let{id:r,require:i}=s;if(ge.hasOwn(e,r)){a[r]=or.clone(e[r]);return}let f={},m=Object.keys(i);for(let g of m)f[g]=0;a[r]={require:f,rewarded:!1}}this.updateMissionProcess(a)}updateMissionProcess(t){let{storage:e}=this.codex;e.setStorageData("missions","process",t),e.updateToWebStorage("missions")}getPlayerMissionProcess(){let{player:t}=this.codex,e=t.getPlayerDataByKey("missionsData"),{process:a}=e||{};return or.clone(a)}addMissionValue(t){let{id:e,type:a,value:s}=t,r=this.getPlayerMissionProcess();if(!lr.isObject(r))return;let i=r,f=Object.keys(i).filter(m=>m.includes(e));for(let m of f){let g=i[m];!g||g.rewarded||(g.require[a]+=s)}this.updateMissionProcess(i),this.updatePlayerMissionProcess()}setMissionRewardClaimed(t){let e=this.getPlayerMissionProcess();if(!lr.isObject(e))return;let a=e;ge.hasOwn(a,t)&&(a[t].rewarded=!0,this.updateMissionProcess(a),this.updatePlayerMissionProcess())}updatePlayerMissionProcess(){let{player:t}=this.codex,e=this.codex.storage.getStorageData("missions","process"),a=this.getPlayerMissionProcess(),s=ge.merge(a,e);t.setPlayerDataByName("missionsData",{process:s})}},Df=vf,If=Df;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Utils:{Object:xf},Configs:{ApiHost:cr}}=Ludex,Sf=()=>{let t=GameSDK.getSDKName(),e="players";switch(t){case"MsGames":e+="?platform=ms-games";break;case"Yandex":e+="?platform=yandex";break;default:break}return e},Ef=async t=>{if(!cr)return{};let e=Sf(),a=await et(e,t,{},cr,10);return xf.hasOwn(a,"data")?a.data||{}:{}},{Utils:{Array:Pf,Object:we,Valid:bf},Configs:{AppId:Lf}}=Ludex,Cf=class extends Ludex.Plugins.BasePlugin{isLoggedIn=!1;init(){let{storage:t}=this.codex;t.addStorage("player",gt)}receiveData(t,e){let{storage:a}=this.codex,{playerId:s,name:r,photo:i,locale:f}=t;a.setStorageData("player","playerId",s),a.setStorageData("player","name",r),a.setStorageData("player","photo",i),a.setStorageData("player","locale",f),e&&(this.setPlayerData(e),this.isLoggedIn=!e.isFirstLogin)}async syncDataToSDK(){try{let t=this.getPlayerData();await GameSDK.player.setDataAsync(t)}catch{}}async syncProfileToServer(){if(GameSDK.extra.isGuest)throw new Error("Guest player cannot sync profile to server");let{storage:t}=this.codex,e=this.getPlayer(),{playerId:a,name:s,photo:r,locale:i}=e,f=this.getPlayerASID();!bf.isString(f)&&"getASIDAsync"in GameSDK.player&&(f=await GameSDK.player.getASIDAsync()??f,t.setStorageData("player","ASID",`${f}`)),await Ef({appId:Lf,ASID:f,playerId:a,name:s,photo:r,locale:i})}setPlayerDataByName(t,e){this.setPlayerData({[t]:e})}setPlayerData(t){let{storage:e}=this.codex;e.setStorageData("player","data",t),this.syncDataToSDK()}setBestScore(t){this.setPlayerDataByName("score",t)}setSetting(t,e){this.setPlayerDataByName("settings",{[t]:e})}setGameData(t){let e=this.getGameData()??{},a=we.merge(e,t);this.setPlayerDataByName("gameData",a)}async requestConnectedPlayers(){let{storage:t}=this.codex,e=(await GameSDK.player.getConnectedPlayersAsync()).map(r=>{let i=r.getID(),f=r.getName(),m=r.getPhoto();return!i||!f||!m?null:new Ye({playerId:i,name:f,photo:m}).toObject()}),a=Pf.unique(e);if(a.length<1)return;let s=we.keyBy(a,"playerId");t.setStorageData("player","connectedPlayers",s)}getPlayer(){let{storage:t}=this.codex;return t.getStorage("player")}getPlayerId(){let{storage:t}=this.codex;return t.getStorageData("player","playerId")??""}getPlayerASID(){let{storage:t}=this.codex;return t.getStorageData("player","ASID")??null}getPlayerLocale(){let{storage:t}=this.codex;return t.getStorageData("player","locale")??""}getPlayerData(){let{storage:t}=this.codex;return t.getStorageData("player","data")??gt.data}getPlayerDataByKey(t){let e=this.getPlayerData();return we.hasOwn(e,t)?e[t]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(t){let e=this.getPlayerSettings();return we.hasOwn(e,t)?e[t]:null}getPlayerSettings(){let{settings:t}=this.getPlayerData();return t}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??gt.data.isFirstLogin}isFirstSession(){return!this.isLoggedIn}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){let{score:t}=this.getPlayerData();return t}getConnectedPlayers(){let{storage:t}=this.codex;return t.getStorageData("player","connectedPlayers")??{}}getConnectedPlayerIds(t,e){let a=this.getConnectedPlayers();return Object.keys(a).slice(e,e+t)}getNotificationData(){return this.getPlayerDataByKey("notificationData")??gt.data.notificationData}},Nf=Cf;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Dtos:dr,Utils:{Valid:U}}=Ludex,{score:Tf,settings:_f,gameData:Of,isFirstLogin:Rf,missionsData:Mf,notificationData:kf,dailyRewardedData:Ff,lastCallSwitchGame:Gf}=gt.data,B="is invalid",hr=class extends lt{processData(t){this.n(t),t.settings=new dr.Player.Settings(t.settings).toObject(),t.gameData=new dr.Player.GameData(t.gameData).toObject(),this.o(t),this.setupData(t)}setupData(t){this.d(t)}n(t){this.l(t)}o(t){this.c(t)}validateScore(t){(!U.isNumber(t)||t<0)&&this.t("score",B)}validateSettings(t){U.isObject(t)||this.t("settings",B)}validateMissionsData(t){U.isObject(t)||this.t("missionsData",B),(!("process"in t)||!U.isObject(t.process))&&this.t("missionsData.process",B)}validateNotificationData(t){U.isObject(t)||this.t("notificationData",B),(!("D1"in t)||!U.isObject(t.D1))&&this.t("notificationData.D1",B),(!("D2"in t)||!U.isObject(t.D2))&&this.t("notificationData.D2",B),(!("D3"in t)||!U.isObject(t.D3))&&this.t("notificationData.D3",B),(!("D4"in t)||!U.isObject(t.D4))&&this.t("notificationData.D4",B),(!("D5"in t)||!U.isObject(t.D5))&&this.t("notificationData.D5",B),(!("D6"in t)||!U.isObject(t.D6))&&this.t("notificationData.D6",B),(!("D7"in t)||!U.isObject(t.D7))&&this.t("notificationData.D7",B)}validateGameData(t){U.isObject(t)||this.t("gameData",B)}validateIsFirstLogin(t){U.isBoolean(t)||this.t("isFirstLogin",B)}validateDailyRewardedData(t){U.isObject(t)||this.t("dailyRewardedData",B)}validateLastCallSwitchGame(t){U.isNumber(t)||this.t("lastCallSwitchGame",B),t<0&&this.t("lastCallSwitchGame",B)}toObject(){return super.toObject()}};hr.addDefaultData({score:Tf,settings:_f,gameData:Of,isFirstLogin:Rf,missionsData:Mf,notificationData:kf,dailyRewardedData:Ff,lastCallSwitchGame:Gf});var Bf=hr;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:ur}=Ludex.Utils,{level:Uf,coins:jf}=gt.data.gameData,yr=class extends lt{setupData(t){this.d(t)}n(t){this.l(t)}o(t){this.c(t)}validateLevel(t){(!ur.isNumber(t)||t<0)&&this.t("level","is invalid")}validateCoins(t){(!ur.isNumber(t)||t<0)&&this.t("coins","is invalid")}toObject(){return super.toObject()}};yr.addDefaultData({level:Uf,coins:jf});var Hf=yr;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Valid:Ae}=Ludex.Utils,{sound:Vf,music:Kf,vibrate:$f,language:Wf}=gt.data.settings,ve="is invalid",pr=class extends lt{setupData(t){this.d(t)}n(t){this.l(t)}o(t){this.c(t)}validateSound(t){Ae.isBoolean(t)||this.t("sound",ve)}validateMusic(t){Ae.isBoolean(t)||this.t("music",ve)}validateVibrate(t){Ae.isBoolean(t)||this.t("vibrate",ve)}validateLanguage(t){(!Ae.isString(t)||!t)&&this.t("language",ve)}toObject(){return super.toObject()}};pr.addDefaultData({sound:Vf,music:Kf,vibrate:$f,language:Wf});var zf=pr;Ludex.Dtos.Player={Info:Ye,Data:Bf,Settings:zf,GameData:Hf};var qf=Nf;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Configs:{ApiHost:fr,Mockup:Yf},Utils:{Object:Jf,String:Qf}}=Ludex,Xf=class{mockAPI;async initMockAPI(){if(this.mockAPI)return;let t=(await import("./chunks-L2X7HZGD.js")).default;if(typeof t!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new t}async getPlayersAsync(t){let e=Qf.params(t),a;if(Yf.Profile.Enabled)await this.initMockAPI(),a=await this.mockAPI.getPlayersAsync(t);else{if(!fr)return[];a=await Gt(`players?${e}`,{},fr)}return!Jf.hasOwn(a,"data")||!Array.isArray(a.data)?[]:a.data}},Zf=Xf;n(),o(),l(),c(),d(),h(),u(),p(),y();var tm={profiles:{},profileIds:[]},mr=tm,{Utils:em,Dtos:am}=Ludex,{Array:gr,Valid:sm,Object:rm,Function:im}=em,nm=class extends Ludex.Plugins.BasePlugin{profileAPI=new Zf;init(){let{storage:t}=this.codex;t.addStorage("profile",mr)}async requestProfiles(t){let e=this.getProfileIds(),a=gr.difference(t,e);if(a.length<1)return;let s=gr.chunk(a,400).map(f=>this.profileAPI.getPlayersAsync({playerIds:f})),r=(await im.allSettled(s)).reduce((f,m)=>m.status==="fulfilled"?f.concat(m.value):f,[]);if(!this.validateProfilesResponse(r))return;let i=this.convertToProfiles(r);this.setProfiles(i)}getProfile(t){return this.getProfiles()[t]??null}getProfiles(){let{storage:t}=this.codex;return t.getStorageData("profile","profiles")??mr.profiles}setProfiles(t){let{storage:e}=this.codex;e.setStorageData("profile","profiles",t),e.setStorageData("profile","profileIds",Object.keys(t))}getProfileIds(){let{storage:t}=this.codex;return t.getStorageData("profile","profileIds")??[]}validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}convertToProfiles(t){let e={};for(let a of t)rm.hasOwn(a,"playerId")&&sm.isString(a.playerId)&&(e[a.playerId]=new am.Player.Info(a).toObject());return e}},om=nm,lm=om;tt(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var wr="Tile Connect",{Utils:{Object:Ar,Valid:vr,Browser:Dr}}=Ludex,cm=class extends Ludex.Plugins.BasePlugin{storages;storageLocalKeys={};constructor(t){super(t),this.storages={}}async addStorage(t,e,a=!1){this.storages[t]=e,a&&await this.initFromWebStorage(t,e)}async initFromWebStorage(t,e){this.storageLocalKeys[t]=!0;let a=await Dr.getIndexedDB(`${wr}_S_${t}`);if(!vr.isObject(a))return;let s=Object.keys(e);for(let r of s)Ar.hasOwn(a,r)&&typeof e[r]==typeof a[r]&&this.setStorageData(t,r,a[r])}initStorageData(t,e,a){this.storages[t][e]=a}setStorageData(t,e,a){let s;if(vr.isObject(a)){let r=this.getStorageData(t,e);s=Ar.merge(r,a)}else s=a;this.storages[t][e]=s}getStorageData(t,e){return this.getStorage(t)[e]}getStorage(t){return this.storages[t]}async updateToWebStorage(t){if(this.storageLocalKeys[t])return this.saveToWebStorage(t)}async saveToWebStorage(t){let e=this.getStorage(t);return Dr.setIndexedDB(`${wr}_S_${t}`,e)}},dm=cm,hm=dm;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var um=class extends Ludex.Plugins.BasePlugin{isVisible=!0;browserPrefixes=["moz","ms","o","","webkit"];init(){let t=this.getBrowserPrefix(),e=[this.getVisibilityEvent(t),"focus","blur"];for(let a of e)this.registerEvent(window,a),this.registerEvent(document,a);GameSDK.extra&&("onPause"in GameSDK.extra&&GameSDK.extra.onPause(()=>this.handleVisibilityChange("blur")),"onResume"in GameSDK.extra&&GameSDK.extra.onResume(()=>this.handleVisibilityChange("focus"))),this.registerEvent(window,"pageshow"),this.registerEvent(window,"pagehide"),window.addEventListener("message",a=>{(a.data==="nativePause"||a.data==="nativeResume")&&this.handleVisibilityChange(a.data)},!1)}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?`${t}Hidden`:"hidden"}getVisibilityEvent(t){return`${t||""}visibilitychange`}getBrowserPrefix(){for(let t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.codex.event.emit(Ludex.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.codex.event.emit(Ludex.Events.VISIBILITY_HIDDEN))}registerEvent(t,e){t.addEventListener(e,()=>{this.handleVisibilityChange(e)},!1)}handleVisibilityChange=t=>{let e={focus:this.onVisibleEvent.bind(this),pageshow:this.onVisibleEvent.bind(this),nativeResume:this.onVisibleEvent.bind(this),blur:this.onHiddenEvent.bind(this),pagehide:this.onHiddenEvent.bind(this),nativePause:this.onHiddenEvent.bind(this)};if(e[t]){e[t]();return}let a=this.getBrowserPrefix();this.getHiddenPropertyName(a)in document?this.onHiddenEvent():this.onVisibleEvent()}},ym=um,pm=ym;Ia(),n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{Utils:{Object:Ir},Plugins:{Ads:{Status:J,Types:yt,AdError:De,AdInstance:fm}}}=Ludex,mm=class extends fm{service;instance;instanceQueue=[];constructor(t,e){super(t,e),this.service=GameSDK.getSDKName(),this.instance=null}async loadAsync(){if(!(this.instance&&this.status===J.FILLED)){if(this.status!==J.IDLE)throw new De("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new De("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.setStatus(J.LOADING),await this.instance.loadAsync(),this.setStatus(J.FILLED),this.logAdLoad()}catch(t){throw this.setStatus(J.IDLE),t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.pushInstanceToQueue(this.instance),self.codex.analytics.loadAdFail({type:this.type,service:this.service}),t}}}async showAsync(){if(this.status!==J.FILLED)throw new De("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new De("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let t=!1;try{this.setStatus(J.SHOWING),self.codex.analytics.showingAd({type:this.type,service:this.service}),await this.instance.showAsync(),t=!0,this.setStatus(J.IDLE),this.instance=null}catch(e){throw Ir.hasOwn(e,"code")&&(e.code==="AD_NOT_LOADED"&&this.setStatus(J.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf(`${e.code}`)>-1&&(this.setStatus(J.IDLE),this.instance=null),e.code==="USER_INPUT"&&(t=!0)),this.status===J.SHOWING&&(this.setStatus(J.IDLE),this.instance=null),e}finally{t?this.logAdShown():self.codex.analytics.showAdFail({type:this.type,service:this.service})}}async createInstanceByType(t){try{return await this.getAdInstanceByType(t)}catch(e){return Ir.hasOwn(e,"code")&&e.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed():null}}async getAdInstanceByType(t){switch(t){case yt.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case yt.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);case yt.REWARDED_INTERSTITIAL:return await GameSDK.getRewardedInterstitialAsync(this.placementId);default:return null}}getAdInstanceFailed(){if("canBeLoadedAd"in GameSDK.extra){for(let t of this.instanceQueue)if(GameSDK.extra.canBeLoadedAd(t))return this.instanceQueue.splice(this.instanceQueue.indexOf(t),1),t}else return this.instanceQueue.shift()||null;return null}logAdLoad(){switch(this.type){case yt.INTERSTITIAL:self.codex.analytics.loadInterstitialAd({service:this.service});break;case yt.REWARDED_VIDEO:self.codex.analytics.loadRewardedVideoAd({service:this.service});break;case yt.REWARDED_INTERSTITIAL:self.codex.analytics.loadRewardedInterstitialAd({service:this.service});break}}logAdShown(){switch(this.type){case yt.INTERSTITIAL:self.codex.analytics.showInterstitialAd({service:this.service});break;case yt.REWARDED_VIDEO:self.codex.analytics.showRewardedVideoAd({service:this.service});break;case yt.REWARDED_INTERSTITIAL:self.codex.analytics.showRewardedInterstitialAd({service:this.service});break}}pushInstanceToQueue(t){this.instanceQueue.push(t)}},xr=mm,{Plugins:{Ads:{Types:Ie}}}=Ludex,gm=class extends xr{constructor(t,e){super(t,e),this.service="adsense"}async createInstanceByType(t){try{let e=window.GoogleAds;if(!e)throw new Error("GoogleAds not found");switch(t){case Ie.BANNER:return e.getBannerAdAsync(this.placementId);case Ie.REWARDED_VIDEO:return e.getRewardedVideoAsync(this.placementId);case Ie.INTERSTITIAL:return e.getInterstitialAdAsync(this.placementId);case Ie.REWARDED_INTERSTITIAL:return e.getRewardedInterstitialAsync(this.placementId);default:return null}}catch{return null}}getAdInstanceFailed(){return null}},wm=gm;n(),o(),l(),c(),d(),h(),u(),p(),y(),n(),o(),l(),c(),d(),h(),u(),p(),y();var Am=class extends ms{async loadAsync(){this.t("Unsupported method")}async showAsync(){this.t("This method is not implemented")}async hideAsync(){this.t("This method is not implemented")}},vm=Am,{Status:Sr}=Ludex.Plugins.Ads,Dm=class extends vm{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.setStatus(Sr.SHOWING)}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.setStatus(Sr.IDLE)}},Im=Dm;n(),o(),l(),c(),d(),h(),u(),p(),y();var{Utils:{Array:vt}}=Ludex,pt={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed"},Dt={NOT_STARTED:"not-started",IN_PROGRESS:"in-progress",COMPLETED:"completed",FAILED:"failed"},Er=["reward"],Pr=["next","preroll","browse","pause","start"],xe=["auto"],xm=class{initStatus=pt.IDLE;preloadStatus=Dt.NOT_STARTED;codex;adBreak;adConfig;config;serviceName="adsense";rewardedType="reward";interstitialType="next";bannerFormatType="auto";constructor(t){this.codex=t}setInitStatus(t){this.initStatus!==t&&(this.codex?.analytics?.initAdEvent({adService:this.serviceName,state:t}),this.initStatus=t)}getInitStatus(){return this.initStatus}async getRewardedVideoAsync(t){return await this.ensureInitialized(),this.createAdInstance(this.rewardedType,t)}async getInterstitialAdAsync(t){return await this.ensureInitialized(),this.createAdInstance(this.interstitialType,t)}async getRewardedInterstitialAsync(t){return await this.ensureInitialized(),this.createAdInstance(this.rewardedType,t)}async getBannerAdAsync(t){return await this.ensureInitialized(),this.createAdInstance(this.bannerFormatType,t)}setRewardType(t){vt.has(Er,t)&&(this.rewardedType=t)}setInterstitialType(t){vt.has(Pr,t)&&(this.interstitialType=t)}setBannerFormatType(t){vt.has(xe,t)&&(this.bannerFormatType=t)}async initAsync(t){try{switch(this.initStatus){case pt.LOADED:return;case pt.LOADING:return}if(!this.validateConfig(t))throw new Error("Invalid Google Ads configuration");this.setInitStatus(pt.LOADING),this.config=t,await this.loadScriptElementAsync()}catch(e){throw this.setInitStatus(pt.FAILED),e}}validateConfig(t){if(!t)return!1;let{dataAdClient:e,dataAdHost:a}=t;if(!e&&!a)return!1;if(t.dataAdFrequencyHint){let s=Number(t.dataAdFrequencyHint);if(isNaN(s)||s<=0)return!1}return!0}async loadScriptElementAsync(){try{await this.injectMainScript(),await this.configureGoogleAds(),this.config.usePreload&&await this.preloadAdConfig()}catch(t){throw t}}async injectMainScript(){return new Promise((t,e)=>{try{let a=document.createElement("script");this.configureScriptAttributes(a),a.onload=()=>{this.setInitStatus(pt.LOADED),t()},a.onerror=s=>{this.setInitStatus(pt.FAILED),e(new Error(`Failed to load ${this.serviceName} Ads script: ${s}`))},document.head.appendChild(a)}catch(a){e(a)}})}async configureGoogleAds(){try{window.adsbygoogle=window.adsbygoogle||[],window.adBreak=t=>adsbygoogle.push(t),window.adConfig=t=>adsbygoogle.push(t),this.adBreak=window.adBreak,this.adConfig=window.adConfig}catch(t){throw t}}configureScriptAttributes(t){let{dataAdClient:e,dataAdHost:a,dataAdChannel:s,dataAdBreakTest:r,dataAdFrequencyHint:i}=this.config;t.async=!0,t.crossOrigin="anonymous";let f="";i&&t.setAttribute("data-ad-frequency-hint",`${i}s`),e&&(t.setAttribute("data-ad-client",e),f+=`?client=${e}`),s&&t.setAttribute("data-ad-channel",s),a&&(t.setAttribute("data-ad-host",a),f+=`&host=${a}`),r&&t.setAttribute("data-adbreak-test","on"),t.src=`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js${f}`}async ensureInitialized(){if(this.initStatus!==pt.LOADED)throw new Error("Google Ads not initialized. Call initAsync first.");await this.ensurePreloaded()}async ensurePreloaded(){this.preloadStatus!==Dt.COMPLETED&&await this.preloadAdPlacement()}createAdInstance(t,e){let a=vt.has(xe,t);return{getPlacementID:()=>e,loadAsync:async()=>{if(!a)return this.preloadAdPlacement();let{dataAdClient:s,dataAdBreakTest:r}=this.config;return this.setupBannerAdElement({placementId:e,dataAdClient:s,dataAdBreakTest:r})},showAsync:()=>this.showAd(t,e),hideAsync:()=>this.hideAd(t,e)}}async showAd(t,e){return new Promise((a,s)=>{try{if(vt.has(xe,t))return;let r=this.createAdBreakConfig({type:t,placementId:e,resolve:a,reject:s});this.adBreak(r)}catch(r){s(r)}})}async hideAd(t,e){if(!vt.has(xe,t)||document.getElementsByClassName("adsbygoogle").length===0)return;let a=this.getBannerAdElement(e);a&&a.remove()}getBannerAdElement(t){let e=document.getElementsByClassName("adsbygoogle");return Array.from(e).find(a=>a.getAttribute("data-placement-id")===t)||null}async setupBannerAdElement(t){let{placementId:e,dataAdClient:a,dataAdBreakTest:s}=t;if(this.getBannerAdElement(e))return;let r=document.createElement("div");r.className="google-ads-banner",r.style.height="51px",r.style.bottom="0";let i=document.createElement("ins");i.className="adsbygoogle",i.setAttribute("data-ad-client",a),i.setAttribute("data-ad-slot",e??""),i.setAttribute("data-ad-test",s?"on":"off"),i.setAttribute("data-full-width-responsive","false"),r.appendChild(i);let f=document.createElement("script");f.innerHTML="(adsbygoogle = window.adsbygoogle || []).push({});",r.appendChild(f),document.body.insertAdjacentElement("beforeend",r)}createAdBreakConfig(t){let e=this.createBaseAdBreakConfig({placementId:t.placementId}),{type:a}=t;if(vt.has(Pr,a))return this.createInterstitialAdBreakConfig(e,t);if(vt.has(Er,a))return this.createRewardAdBreakConfig(e,t);throw new Error(`Ad type: ${a} is not supported.`)}createBaseAdBreakConfig(t){return{name:t.placementId,beforeAd:()=>{},adBreakDone:e=>{}}}createInterstitialAdBreakConfig(t,{resolve:e,reject:a}){return L(I({},t),{type:this.interstitialType,adBreakDone:s=>{t.adBreakDone?.(s),this.handleAdBreakDone({info:s,resolve:e,reject:a})}})}createRewardAdBreakConfig(t,{resolve:e,reject:a}){return L(I({},t),{type:this.rewardedType,beforeReward:s=>{s()},adDismissed:()=>{a(new Error("USER_INPUT"))},adViewed:()=>{e()}})}handleAdBreakDone(t){let{info:e,resolve:a,reject:s}=t;switch(e.breakStatus){case"viewed":a();break;case"frequencyCapped":s(new Error("AD_FREQUENCY_CAPPED"));break;default:s(new Error(e.breakStatus))}}async preloadAdPlacement(){if(this.initStatus!==pt.LOADED)throw new Error(`${this.serviceName} Ads not initiated.`);return this.preloadAdConfig()}getPreloadStatus(){return this.preloadStatus}async preloadAdConfig(){if(this.preloadStatus!==Dt.COMPLETED&&this.preloadStatus!==Dt.IN_PROGRESS)return this.preloadStatus=Dt.IN_PROGRESS,new Promise((t,e)=>{let a=setTimeout(()=>{this.preloadStatus===Dt.IN_PROGRESS&&(this.preloadStatus=Dt.FAILED,e(new Error("Failed to preload ad config in time.")))},5e3);this.adConfig({preloadAdBreaks:"on",onReady:()=>{clearTimeout(a),this.preloadStatus=Dt.COMPLETED,t()}})})}},Sm=xm;tt(),tt(),tt(),tt(),tt(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{BaseAnalytics:Em,Events:jt}=Ludex.Plugins.Analytics,Pm=[jt.SCREEN_OPEN],{Utils:{Array:bm}}=Ludex,Lm=class extends Em{constructor(t,e){super(t,"GoogleAnalytics",L(I({},e),{color:"#E35335"}))}processEvent(t,e){bm.has(Pm,t)||(this.customEvent(t,e),gtag("event",t,e))}customEvent(t,e){switch(t){case jt.AD_SHOW:case jt.AD_SHOW_FAILED:case jt.AD_SHOWING:case jt.USE_ITEM:case jt.EARN_ITEM:this.addLevelName(e);break;default:break}}addLevelName(t){if(!t||!this.codex?.match)return;let e=this.codex.match.getMatchState().customData.level;!e||e<0||(t.level_name=this.getLevelName(e))}},ga=Lm;tt(),n(),o(),l(),c(),d(),h(),u(),p(),y();var{BaseAnalytics:Cm}=Ludex.Plugins.Analytics,Nm=class extends Cm{constructor(t){super(t,"XiaomiAnalytics",{color:"#00c6ff"})}processEvent(t){GameSDK.extra&&"logEvent"in GameSDK.extra&&GameSDK.extra.logEvent(t)}},Tm=Nm;tt();var br="production",wa=15,{Dtos:_m,Events:It,Configs:{AppId:Om,Ads:Z,Analytics:Se,Debugger:it,Firebase:Lr,Notification:Rm,RemoteConfig:Cr,PerformanceMonitor:Mm,AdaptivePerformance:Nr},Plugins:{Ads:{Types:Ee}},Utils:{Device:km,Object:Tr,Json:se,String:_r,Valid:Fm,Time:Gm,Function:Bm,Mark:R}}=Ludex,Um=class extends Ac{markName="Core Initialize";modulePlugins=[];getBuildVersion(){return parseInt(`${wa}`)||0}async boot(){super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(It.CORE_BOOTING),this.f(),this.initFirebasePlugin(),this.initMarkCoreInitialize(),R.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initClarityAnalytics(),this.initFirebaseAnalytics(),this.initYandexAnalytics(),this.initXiaomiAnalytics(),this.initFacebookAnalytics(),this.initTranssionH5Analytics(),R.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),R.putAttr(this.markName,"Step","Load Lazy Plugins"),Fm.isDebugger()||this.event.on(It.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addCanvasRecorderPlugin().then(this.initCanvasRecorderPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),this.addInputRecorderPlugin().then(this.initInputRecorderPlugin),R.putAttr(this.markName,"Step","Load Dev Plugins"),this.event.catchUp(It.GAME_SDK_READY,this.addDevPlugins)}async f(){await Gm.sleepAsync(2e3),this.event.getEventListeners(It.CORE_BOOTING).length}async start(){super.start(),R.putAttr(this.markName,"Step","Core Start"),this.event.emit(It.CORE_STARTING),R.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),R.putAttr(this.markName,"Step","Init States"),await this.initState(),R.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),GameSDK.getSDKName()==="FacebookInstant"&&km.isIOS()?this.event.catchUp(It.GAME_SDK_STARTED,this.processContextSession):await this.processContextSession(),R.putAttr(this.markName,"Step","Core Ready"),R.putAttr(this.markName,"Success","true"),this.event.emit(It.CORE_READY)}processContextSession=async()=>{R.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();let t=this.storage.getStorageData("context","sessionContextType")||"unknown";R.putAttr(this.markName,"Context Mode",t),R.stop(this.markName)};addPlugins(){this.installPlugin("Storage",hm),this.installPlugin("Event",ih),this.installPlugin("Ads",Jc),this.installPlugin("Auth",Dd),this.installPlugin("Audio",fd),this.installPlugin("Match",pf),this.installPlugin("Player",qf),this.installPlugin("Profile",lm),this.installPlugin("Context",jd),this.installPlugin("Language",uh),this.installPlugin("Missions",If),this.installPlugin("Analytics",dd),this.installPlugin("Visibility",pm),this.installPlugin("Leaderboard",Eh),this.installPlugin("DailyRewards",Xd),this.installPlugin("FrameCapture",j),this.installPlugin("RemoteConfig",j),"Proxy"in window&&this.installPlugin("Firebase",j)}installPlugin(t,e,a=!1){let s=_r.toCamelCase(_r.capitalize(t));this.plugins.install(t,e,!0,s),t!=="Storage"&&(a?this.emitModulePluginReady(t):this.emitCorePluginReady(t))}async addMonitorPlugin(){try{let{MonitorError:t}=it;if(!t.Enabled)return;this.modulePlugins.push("MonitorError");let e=(await import("./chunks-5K34DN6I.js")).default;if(typeof e!="function")return;this.installPlugin("MonitorError",e,!0)}catch{}}async addCanvasRecorderPlugin(){try{let{CanvasRecorder:t}=it;if(!t.Enabled)return;this.modulePlugins.push("CanvasRecorder");let e=(await import("./chunks-L2X7HZGD.js")).default;if(typeof e!="function")throw new Error("CanvasRecorderPlugin is not a function");this.installPlugin("CanvasRecorder",e,!0)}catch{}}async addAdaptivePerformancePlugin(){try{if(!Nr.Enabled)return;this.modulePlugins.push("AdaptivePerformance");let t=(await import("./chunks-3MSKKIWT.js")).default;if(typeof t!="function")return;this.installPlugin("AdaptivePerformance",t,!0)}catch{}}async addInputRecorderPlugin(){try{let{InputRecorder:t}=it;if(!t.Enabled)return;this.modulePlugins.push("InputRecorder");let e=(await import("./chunks-L2X7HZGD.js")).default;if(typeof e!="function")return;this.installPlugin("InputRecorder",e,!0)}catch{}}addDevPlugins=()=>{let{ListPlayerDevIds:t}=it,e=GameSDK?.player?.getID();br!=="development"&&(!e||t.indexOf(e)<0)||(this.addConsolePlugin(),this.addProfilerPlugin())};async addConsolePlugin(){try{let{Console:t}=it;if(!t.Enabled)return;this.modulePlugins.push("Console");let e=(await import("./chunks-L2X7HZGD.js")).default;if(typeof e!="function")throw new Error("ConsolePlugin is not a function");this.installPlugin("Console",e,!0),this.initConsolePlugin()}catch{}}async addProfilerPlugin(){try{let{Profiler:t}=it;if(!t.Enabled)return;this.modulePlugins.push("Profiler");let e=(await import("./chunks-L2X7HZGD.js")).default;if(typeof e!="function")throw new Error("ProfilerPlugin is not a function");this.installPlugin("Profiler",e,!0),this.initProfilerPlugin()}catch{}}emitCorePluginReady(t){this.event.emit(mt.CORE_PLUGIN_READY,{name:t})}emitModulePluginReady(t){this.event.emit(mt.MODULE_PLUGIN_READY,{name:t})}handleProtectGameInstance=()=>{let t=this.event.getEventEmitCount(mt.MODULE_PLUGIN_READY),e=this.modulePlugins.length;t<e||(window.codex=Object.freeze(window.codex),Da(window,"codex"))};initEventPlugin(){let{EventLogging:t}=it;t.Enabled&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){this.ads.configure(Z),this.initGoogleAds(),this.initTranssionH5Ads(),this.initAdInstance(),Z.Enabled&&this.analytics.initAdEvent({adService:"platform",state:"loaded"})}async initGoogleAds(){try{if(!Z.Enabled)return;let{AdSense:t}=Z.AdServiceConfigs;if(!t.Enabled)return;let e=new Sm(this);await e.initAsync({usePreload:t.UsePreload,dataAdHost:t.DataAdHost,dataAdClient:t.DataAdClient,dataAdChannel:t.DataAdChannel,dataAdBreakTest:t.DataAdBreakTest,dataAdFrequencyHint:t.DataAdFrequencyHint}),window.GoogleAds=e}catch{}}async initTranssionH5Ads(){try{if(!Z.Enabled)return;let{Savana:t}=Z.AdServiceConfigs;if(!t.Enabled)return;let e=new j(this);await e.initAsync({usePreload:t.UsePreload,dataAdHost:t.DataAdHost,dataAdClient:t.DataAdClient,dataAdChannel:t.DataAdChannel,dataAdBreakTest:t.DataAdBreakTest,dataAdFrequencyHint:t.DataAdFrequencyHint}),window.TranssionH5Ads=e}catch{}}getAdInstanceByService(t,e=!1){let{AdSense:a,AppLovin:s,Savana:r}=Z.AdServiceConfigs;switch(t){case"adsense":if(a.Enabled)return wm;break;case"applovin":s.Enabled;break;case"savana":if(r.Enabled)return j;break;default:return e?Im:xr}return null}initAdInstance(){for(let e of Z.InterstitialAdOptions){let a=this.getAdInstanceByService(e.AdService);a&&this.ads.setAdInstance(Ee.INTERSTITIAL,e.PlacementId,a)}for(let e of Z.RewardedVideoAdOptions){let a=this.getAdInstanceByService(e.AdService);a&&this.ads.setAdInstance(Ee.REWARDED_VIDEO,e.PlacementId,a)}for(let e of Z.RewardedInterstitialAdOptions){let a=this.getAdInstanceByService(e.AdService);a&&this.ads.setAdInstance(Ee.REWARDED_INTERSTITIAL,e.PlacementId,a)}let t=!0;for(let e of Z.BannerDisplayAdOptions){let a=this.getAdInstanceByService(e.AdService,t);a&&this.ads.setAdInstance(Ee.BANNER,e.PlacementId,a)}}async initState(){try{let t=new Hc(this);t.initContext(),await t.initPlayer()}catch{}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin=()=>{if(!this.canvasRecorder)return;let{CanvasRecorder:t}=it,{Type:e,Quality:a,RecordFps:s,SyncFps:r}=t.Options;this.canvasRecorder.configure({type:e,quality:a,syncFps:r,recordFps:s}),this.canvasRecorder.setPanelExpanded(t.PanelExpanded);let i=document.querySelector("canvas");i&&this.canvasRecorder.setCanvas(i)};initMonitorErrorPlugin=()=>{if(!this.monitorError)return;let{MonitorError:t,ListPlayerDevIds:e}=it,{ApiKey:a,Service:s,Feedback:r,TrackUser:i,FilterErrors:f}=t,{playerId:m,name:g}=this.player.getPlayer();m&&e.indexOf(m)>=0||(window.disableSimpleTrackErrors?.(),this.monitorError.configure({apiKey:a,service:s,feedback:r,trackUser:i,releaseStage:br,buildVersion:`${wa??1}`}),this.monitorError.setUser({id:m,name:g}),this.monitorError.addFilterErrors(f),this.monitorError.initFeedbackTrackErrors(),this.updateMonitorErrorUserAndMetadata(),this.processErrorsQueue())};updateMonitorErrorUserAndMetadata=()=>{this.event.catchUp(It.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded)};processErrorsQueue=()=>{if(this.monitorError&&window.__errorQueue){for(let t of window.__errorQueue)if(t instanceof Error)this.monitorError.sendException(t);else{let e=Bm.toError(t);this.monitorError.sendException(e)}window.__errorQueue=null}};processWhenPlayerInfoLoaded=()=>{if(!this.monitorError)return;let{playerId:t,name:e}=this.player.getPlayer();this.monitorError.setUser({id:t,name:e}),this.monitorError.addMetadata({isFirstSession:this.player.isFirstSession()})};initRemoteConfig(){if(!Cr.Enabled)return;let t=se.clone(Cr);this.remoteConfig.configure(t),this.event.on(mt.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(mt.REQUEST_UPDATE_CONFIG,this.handleUpdateLudexConfig),this.event.catchUp(mt.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}handleSaveRemoteConfig=t=>{try{let e={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",e)}catch{}};handleUpdateLudexConfig=t=>{try{let{id:e,type:a}=t;if(a!=="Ludex")return;Ludex.Configs=Tr.merge(Ludex.Configs,t.config);let{Ads:s}=Ludex.Configs;this.ads.configure(s),this.event.emit(mt.REMOTE_CONFIG_UPDATED,{id:e,type:a})}catch{}};handleStorageCurrentRemoteConfig=()=>{let t=this.player.getPlayerDataByKey("remoteConfig");if(t){for(let e in t)if(Tr.hasOwn(t,e)){let a=t[e],s=se.clone(a),r=new _m.RemoteConfig.Data(s).toObject();this.remoteConfig.setRemoteConfig(r),this.remoteConfig.processUpdateConfig(r.id,r.type)}}};initFirebasePlugin(){if(!Lr.Enabled||!this.firebase)return;let t=se.clone(Lr);this.firebase.configure(t),R.setService(this.firebase.services.performance)}initMarkCoreInitialize(){Mm.CoreFlows&&(R.measure(this.markName),R.putAttr(this.markName,"Build",`${wa}`),R.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),R.putAttr(this.markName,"Platform",GameSDK.getPlatform()),R.putAttr(this.markName,"Success","false"),R.start(this.markName))}initAdaptivePerformancePlugin=()=>{if(!this.adaptivePerformance)return;let t=se.clone(Nr);this.adaptivePerformance.configure(t)};initInputRecorderPlugin=()=>{if(!this.inputRecorder)return;let{InputRecorder:t}=it,e=se.clone(t);e&&this.inputRecorder.configure(e)};async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch{}}processAfterSyncProfile=()=>{Rm.Enabled&&this.updatePlayerProfileToNotificationService()};async updatePlayerProfileToNotificationService(){try{let t=this.player.getPlayer(),{ASID:e,playerId:a,name:s,photo:r,locale:i}=t;await bc({appId:Om,ASID:e,playerId:a,name:s,photo:r,locale:i})}catch{}}initGoogleAnalytics(){let{Enabled:t,ConsoleLog:e}=Se.GoogleAnalytics??{};t&&(typeof ga!="function"||!(ga.prototype instanceof Object)||this.analytics.add(new ga(this.codex,{log:!!e})))}initClarityAnalytics(){let{Enabled:t,ConsoleLog:e}=Se.ClarityAnalytics??{};if(!t||typeof j!="function"||!(j.prototype instanceof Object))return;let a=new j(this.codex,{log:!!e}),s=this.player.getPlayer(),{playerId:r}=s;a.setUser(r,GameSDK.extra.isGuest),this.analytics.add(a)}initFirebaseAnalytics(){let{Enabled:t,ConsoleLog:e}=Se.FirebaseAnalytics??{};if(!t||typeof j!="function"||!(j.prototype instanceof Object))return;let a=new j(this.codex,{log:!!e});this.analytics.add(a);let s="no_entry";GameSDK.getEntryPointAsync().then(r=>{s=r}).catch(r=>{}).finally(()=>{let r=this.player.getPlayer(),{playerId:i,locale:f}=r,{fbig_ad_id:m,fbig_adset_id:g,fbig_campaign_id:w,fb_instant_game_adset_id:A,fb_instant_game_ad_id:v,fb_instant_game_campaign_id:x}=GameSDK.getEntryPointData()||{},S=m||v,P=g||A,C=w||x;a.setUser(i,{locale:f,ad_id:S,adset_id:P,campaign_id:C,traffic_source:s})})}initYandexAnalytics(){GameSDK.getSDKName()==="Yandex"&&this.analytics.add(new j(this.codex))}initXiaomiAnalytics(){GameSDK.getSDKName()==="Xiaomi"&&this.analytics.add(new Tm(this.codex))}initFacebookAnalytics(){let t=GameSDK.getSDKName(),{Enabled:e,Prefix:a,ConsoleLog:s}=Se.FacebookAnalytics??{};!e||t!=="FacebookInstant"||typeof a=="string"&&this.analytics.add(new j(this.codex,{prefix:a,log:!!s}))}initTranssionH5Analytics(){GameSDK.getSDKName()==="TranssionH5"&&this.analytics.add(new j(this.codex))}},jm=Um,{Configs:{GameEngine:{ForceDesktopDPR:Pe}},Utils:{Device:Hm},Events:Aa}=Ludex,Vm=async()=>{let t=new jm;window.codex=t,globalThis.codex=t;let e=20;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__ludexStart=!0,await t.boot(),t.event.catchUp(Aa.REQUEST_CORE_START,Or),Km(t)},Or=()=>{if(!window.__sdkInitiated){codex.event.catchUp(Aa.GAME_SDK_READY,Or);return}codex.start();let t=25;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t)},Km=t=>{let e=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(e);let a=10;window.__sdkLoadingCount<a&&(window.__sdkLoadingCount=a),t.event.emit(Aa.GAME_SDK_READY)},5)};Pe!==!1&&Hm.isDesktop()&&typeof Pe=="number"&&Pe>0&&(window.devicePixelRatio=Pe),window.originalRequestAnimationFrame=window.requestAnimationFrame,window.isCustomRequestAnimationFrame=window.isCustomRequestAnimationFrame??!0,window.isCustomRequestAnimationFrame&&(window.requestAnimationFrame=t=>window.isCustomRequestAnimationFrame?(setTimeout(t,1e3/60),0):window.originalRequestAnimationFrame(t)),Vm();
