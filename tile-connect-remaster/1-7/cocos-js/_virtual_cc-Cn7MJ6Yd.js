System.register([],(function(t,i){"use strict";return{execute:function(){function n(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,p(r.key),r)}}function r(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(){return s=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},s.apply(this,arguments)}function e(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,u(t,i)}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function u(t,i){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},u(t,i)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function c(t,i,n){return c=o()?Reflect.construct.bind():function(t,i,n){var r=[null];r.push.apply(r,i);var s=new(Function.bind.apply(t,r));return n&&u(s,n.prototype),s},c.apply(null,arguments)}function a(t){var i="function"==typeof Map?new Map:void 0;return a=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,r)}function r(){return c(t,arguments,h(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,t)},a(t)}function f(t,i){if(null==t)return{};var n,r,s={},e=Object.keys(t);for(r=0;r<e.length;r++)n=e[r],i.indexOf(n)>=0||(s[n]=t[n]);return s}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(t,i){if(t){if("string"==typeof t)return d(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,i):void 0}}function d(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,r=new Array(i);n<i;n++)r[n]=t[n];return r}function w(t,i){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=l(t))||i){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(t,i){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,i);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function p(t){var i=g(t,"string");return"symbol"==typeof i?i:String(i)}function _(t,i,n,r){n&&Object.defineProperty(t,i,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function y(t,i,n,r,s){var e={};return Object.keys(r).forEach((function(t){e[t]=r[t]})),e.enumerable=!!e.enumerable,e.configurable=!!e.configurable,("value"in e||e.initializer)&&(e.writable=!0),e=n.slice().reverse().reduce((function(n,r){return r(t,i,n)||n}),e),s&&void 0!==e.initializer&&(e.value=e.initializer?e.initializer.call(s):void 0,e.initializer=void 0),void 0===e.initializer&&(Object.defineProperty(t,i,e),e=null),e}function m(t,i){const n="undefined"==typeof window?global:window;return void 0===n[t]?n[t]=i:n[t]}t({D:xL,E:GL,G:jL,J:HL,K:function(t){return BL.test(t)},N:function(t){return DL.test(t)},P:WL,Q:XL,W:YL,_:w,a$:nr,a7:IX,a8:RX,aA:ne,aC:he,aE:Js,aJ:Un,aK:xn,aL:Gn,aM:jn,aN:Hn,aO:Vn,aP:$n,aQ:zn,aR:Wn,aS:Xn,aT:Yn,aU:Kn,aV:qn,aW:Qn,aX:Jn,aY:Zn,aZ:tr,a_:ir,aa:function(t,i){for(var n=t,r="";null!==n&&n!==i;)r=n.name+"/"+r,n=n.parent;return r.slice(0,-1)},ab:s9,ap:Cs,ar:Rr,at:zs,av:ss,ay:gs,b0:rr,b1:sr,b2:ar,b3:fr,b9:wi,bD:function(t){return t[Mo]},bG:sh,bI:K,bJ:z,bK:X,bL:W,bM:Y,bN:nt,bO:tt,bP:ht,bQ:st,bR:ot,bS:ft,bT:vt,bU:at,ba:_i,bb:bi,bg:function(t){t>0&&(ov=t)},bk:function(t){for(var i in t){var n=t[i];vv[i]=n}},bl:function(t){for(var i,n=w(t);!(i=n()).done;)lv(i.value)},bm:function(t){return fv||(fv="undefined"==typeof Proxy?{}:new Proxy(t,{get:function(t,i,n){return lv(i),Reflect.get(t,i,n)}})),fv},bn:wv,bo:gv,br:Tn,bs:On,cB:Ke,cC:qe,cF:function(t,i){i.forEach((function(i){Object.getOwnPropertyNames(i.prototype).forEach((function(n){"constructor"!==n&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(i.prototype,n))}))}))},cG:q,cH:function(t,i){return io(t,i,0)},cI:io,cJ:function(t,i,n){for(var r=0,s=t.length-1,e=s>>>1;r<=s;e=r+s>>>1){var h=t[e];if(n(h,i)<0)s=e-1;else{if(!(n(h,i)>0))return e;r=e+1}}return~r},cK:function(){},cL:function(){},cM:gi,cN:Pv,c_:jC,cf:Sv,cg:Xa,ch:ff,cs:No,cu:Iv,cx:fn,cy:vn,du:Vp,dw:B$,er:r_t,ew:wyt,ex:gyt,w:SL,y:FL,z:UL}),m("CC_WECHAT",!1),m("CC_XIAOMI",!1),m("CC_ALIPAY",!1),m("CC_BYTEDANCE",!1),m("CC_OPPO",!1),m("CC_VIVO",!1),m("CC_HUAWEI",!1),m("CC_MIGU",!1),m("CC_HONOR",!1),m("CC_COCOS_RUNTIME",!1);const b=!1;m("CC_EDITOR",!1);const k=!1;m("CC_PREVIEW",!1),m("CC_BUILD",!0),m("CC_TEST",!1),m("CC_DEBUG",!1),m("CC_DEV",!1),m("CC_MINIGAME",!1),m("CC_RUNTIME_BASED",!1),m("CC_SUPPORT_JIT",!0),m("CC_JSB",!1);const A=!1;var E="undefined"==typeof window?global:window,T=t("am",{_global:E}),O=T;T.internal={};var S=t("al","3.8.7");E.CocosEngine=O.ENGINE_VERSION=S,E.cc=O;var I=void 0!==globalThis.jsb&&void 0!==jsb.window?jsb.window:globalThis;E.ccwindow=I;function R(t,i){return t^(t^i)&-(t<i)}function M(t){var i,n;return i=(t>65535)<<4,i|=n=((t>>>=i)>255)<<3,i|=n=((t>>>=n)>15)<<2,(i|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function C(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}function N(t){var i=32;return(t&=-t)&&i--,65535&t&&(i-=16),16711935&t&&(i-=8),252645135&t&&(i-=4),858993459&t&&(i-=2),1431655765&t&&(i-=1),i}function P(t){return--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}var L=new Array(256);!function(t){for(var i=0;i<256;++i){var n=i,r=i,s=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--s;t[i]=r<<s&255}}(L);var D=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:2147483647,INT_MIN:-1<<31,abs:function(t){var i=t>>31;return(t^i)-i},countTrailingZeros:N,deinterleave2:function(t,i){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>i&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},deinterleave3:function(t,i){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>i&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},interleave2:function(t,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))<<1},interleave3:function(t,i,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},isPow2:function(t){return!(t&t-1||!t)},log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},log2:M,max:R,min:function(t,i){return i^(t^i)&-(t<i)},nextCombination:function(t){var i=t|t-1;return i+1|(~i&-~i)-1>>>N(t)+1},nextPow2:P,parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},popCount:C,prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},reverse:function(t){return L[255&t]<<24|L[t>>>8&255]<<16|L[t>>>16&255]<<8|L[t>>>24&255]},sign:function(t){return(t>0)-(t<0)}});t("an",D);var B=I.document,F="https://github.com/cocos/cocos-engine/blob/"+S+"/EngineErrorMap.md",U=null,x=console.log.bind(console),G=x,j=x,H=function(t,i){if(!t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];console.log("ASSERT: "+$.apply(void 0,[i].concat(r)))}},V=x;function $(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return O.js.formatStr.apply(null,i)}function z(){return x.apply(void 0,arguments)}function W(){return G.apply(void 0,arguments)}function X(){return j.apply(void 0,arguments)}function Y(t,i){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return H.apply(void 0,[t,i].concat(r))}function K(){return V.apply(void 0,arguments)}function q(t){if(x=G=j=H=V=function(){},0!==t){if(t>4){var i=function(t){if(O.game.canvas){if(!U){var i=B.createElement("Div");i.setAttribute("id","logInfoDiv"),i.setAttribute("width","200");var n=O.game.canvas.height;i.setAttribute("height",""+n);var r=i.style;r.zIndex="99999",r.position="absolute",r.top=r.left="0",(U=B.createElement("textarea")).setAttribute("rows","20"),U.setAttribute("cols","30"),U.setAttribute("disabled","true");var s=U.style;s.backgroundColor="transparent",s.borderBottom="1px solid #cccccc",s.borderTopWidth=s.borderLeftWidth=s.borderRightWidth="0px",s.borderTopStyle=s.borderLeftStyle=s.borderRightStyle="none",s.padding="0px",s.margin="0px",i.appendChild(U),O.game.canvas.parentNode.appendChild(i)}U.value=U.value+t+"\r\n",U.scrollTop=U.scrollHeight}};j=function(){i("ERROR :  "+$.apply(void 0,arguments))},H=function(t,n){if(!t){for(var r=arguments.length,s=new Array(r>2?r-2:0),e=2;e<r;e++)s[e-2]=arguments[e];i("ASSERT: "+$.apply(void 0,[n].concat(s)))}},7!==t&&(G=function(){i("WARN :  "+$.apply(void 0,arguments))}),5===t&&(x=function(){i($.apply(void 0,arguments))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),j=console.error.bind?console.error.bind(console):function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return console.error.apply(console,i)},H=function(t,i){if(!t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];var e=$.apply(void 0,[i].concat(r));throw new Error(e)}});if(4!==t&&(G=console.warn.bind?console.warn.bind(console):function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return console.warn.apply(console,i)}),t<=2&&(x=console.log.bind?console.log.bind(console):function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return console.log.apply(console,i)}),t<=1&&"function"==typeof console.debug){var n=console.debug.bind(console);V=function(){return n.apply(void 0,arguments)}}}}function Q(t){X(t.stack||t)}function J(t){return function(i){for(var n=t+" "+i+", please go to "+F+"#"+i+" to see details.",r=arguments.length,s=new Array(r>1?r-1:0),e=1;e<r;e++)s[e-1]=arguments[e];return 0===s.length?n:n+" Arguments: "+s.join(", ")}}var Z=J("Log");function tt(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];z(Z.apply(void 0,[t].concat(n)))}var it=J("Debug");function nt(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];K(it.apply(void 0,[t].concat(n)))}var rt=J("Warning");function st(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];W(rt.apply(void 0,[t].concat(n)))}var et=J("Error");function ht(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];X(et.apply(void 0,[t].concat(n)))}var ut=J("Assert");function ot(t,i){if(!t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];Y(!1,ut.apply(void 0,[i].concat(r)))}}var ct=t("bV",{NONE:0,VERBOSE:1,INFO:2,WARN:3,ERROR:4,INFO_FOR_WEB_PAGE:5,WARN_FOR_WEB_PAGE:6,ERROR_FOR_WEB_PAGE:7});function at(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return et.apply(void 0,[t].concat(n))}function ft(){return!!O.profiler&&O.profiler.isShowingStats()}function vt(t){O.profiler&&(t?O.profiler.showStats():O.profiler.hideStats())}var lt,dt=Object.freeze({__proto__:null,DebugMode:ct,_resetDebugSetting:q,_throw:Q,assert:Y,assertID:ot,debug:K,debugID:nt,error:X,errorID:ht,getError:at,isDisplayStats:ft,log:z,logID:tt,setDisplayStats:vt,warn:W,warnID:st}),wt=function(){function t(t){this.id=0|998*Math.random(),this.prefix=t?t+".":""}return t.prototype.getNewId=function(){return this.prefix+(++this.id).toString()},t}();lt=wt,wt.global=new lt("global");var gt=new wt("TmpCId."),pt="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),_t="__classname__",yt="__cid__";function mt(t){return"number"==typeof t||t instanceof Number}function bt(t){return"string"==typeof t||t instanceof String}function kt(t){for(var i in t)return!1;return!0}var At,Et=(At={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(t,i,n,r,s){At.value=n,At.writable=r,At.enumerable=s,Object.defineProperty(t,i,At),At.value=void 0}),Tt=function(){var t={get:void 0,set:void 0,enumerable:!1};return function(i,n,r,s,e,h){void 0===e&&(e=!1),void 0===h&&(h=!1),"boolean"==typeof s&&(tt(1031),e=s,s=void 0),t.get=r,t.set=s,t.enumerable=e,t.configurable=h,Object.defineProperty(i,n,t),t.get=void 0,t.set=void 0}}(),Ot=function(){var t={get:void 0,enumerable:!1,configurable:!1};return function(i,n,r,s,e){t.get=r,t.enumerable=s,t.configurable=e,Object.defineProperty(i,n,t),t.get=void 0}}(),St=function(){var t={set:void 0,enumerable:!1,configurable:!1};return function(i,n,r,s,e){t.set=r,t.enumerable=s,t.configurable=e,Object.defineProperty(i,n,t),t.set=void 0}}();function It(t){var i=Object.create(null);return t&&(i["."]=1,i["/"]=1,delete i["."],delete i["/"]),i}function Rt(t){if("function"==typeof t){var i=t.prototype;if(i&&i.hasOwnProperty(_t)&&i[_t])return i[_t];var n="";if(t.name)n=t.name;else if(t.toString){var r,s=t.toString();(r="["===s.charAt(0)?/\[\w+\s*(\w+)\]/.exec(s):/^function\s*(\w+)/.exec(s))&&2===r.length&&(n=r[1])}return"Object"!==n?n:""}return t&&t.constructor?Rt(t.constructor):""}function Mt(t,i,n,r){var s=/([^.]+)$/,e=s.exec(i)[0],h=s.exec(n)[0];function u(){return this[h]}r?Tt(t,e,u,(function(t){this[h]=t})):Ot(t,e,u)}function Ct(t,i,n,r){for(var s in n)Mt(t,i+"."+s,n[s],r)}var Nt=/(%d)|(%s)/,Pt=/%s/;function Lt(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];if(0===arguments.length)return"";if(0===n.length)return""+t;if("string"==typeof t&&Nt.test(t))for(var s,e=w(n);!(s=e()).done;){var h=s.value,u="number"==typeof h?Nt:Pt;if(u.test(t)){var o=""+h;t=t.replace(u,o)}else t+=" "+h}else for(var c,a=w(n);!(c=a()).done;)t+=" "+c.value;return t}function Dt(){for(var t=arguments.length-1,i=new Array(t),n=0;n<t;++n)i[n]=arguments[n+1];return i}function Bt(t,i){for(;t;){var n=Object.getOwnPropertyDescriptor(t,i);if(n)return n;t=Object.getPrototypeOf(t)}return null}function Ft(t,i,n){var r=Bt(i,t);r&&Object.defineProperty(n,t,r)}function Ut(t){t=t||{};for(var i=0;i<(arguments.length<=1?0:arguments.length-1);++i){var n=i+1<1||arguments.length<=i+1?void 0:arguments[i+1];if(n){if("object"!=typeof n){ht(5402,n);continue}for(var r in n)r in t||Ft(r,n,t)}}return t}function xt(t){t=t||{};for(var i=0;i<(arguments.length<=1?0:arguments.length-1);++i){var n=i+1<1||arguments.length<=i+1?void 0:arguments[i+1];if(n){if("object"!=typeof n){ht(5403,n);continue}for(var r in n)Ft(r,n,t)}}return t}function Gt(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);return t.prototype=Object.create(i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t}function jt(t){var i=t.prototype,n=i&&Object.getPrototypeOf(i);return n&&n.constructor}function Ht(t,i){if(t&&i){if("function"!=typeof t)return!1;if("function"!=typeof i)return!1;if(t===i)return!0;for(;;){if(!(t=jt(t)))return!1;if(t===i)return!0}}return!1}function Vt(t){for(var i=0,n=Object.keys(t);i<n.length;i++)delete t[n[i]]}var $t=It(!0),zt=It(!0);function Wt(t,i,n){return function(r,s){if(s.prototype.hasOwnProperty(t)&&delete i[s.prototype[t]],Et(s.prototype,t,r),r){var e=i[r];!n&&e&&e!==s?ht(16334,t,r,""):i[r]=s}}}var Xt=Wt("__cid__",$t,!1),Yt=Wt("__classname__",zt,!0);function Kt(t,i){if(Yt(t,i),!i.prototype.hasOwnProperty(yt)){var n=t||gt.getNewId();n&&Xt(n,i)}}function qt(t,i){var n=zt[i],r=$t[i],s=!0;if(n&&n!==t&&(ht(16335,i),s=!1),r&&r!==t&&(ht(16336,i),s=!1),s){var e=t[pt];e||(e=[],t[pt]=e),e.push(i),zt[i]=t,$t[i]=t}}function Qt(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var r=0,s=i;r<s.length;r++){var e=s[r].prototype,h=e[yt];h&&delete $t[h];var u=e[_t];u&&delete zt[u];var o=e[pt];if(o)for(var c=0;c<o.length;++c){var a=o[c];delete zt[a],delete $t[a]}}}function Jt(t){return Zt(t)}function Zt(t){return $t[t]}function ti(t){return zt[t]}function ii(t){return ni(t)}function ni(t){if("function"==typeof t&&t.prototype.hasOwnProperty(yt))return t.prototype[yt];if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty(yt))return t[yt]}return""}var ri=function(){var t=i.prototype;function i(t,i){this.count=0;var n=void 0===i?t:i,r=void 0===i?null:t;this.T=new Array(n),this.O=r}return t.get=function(){return this._get()},t._get=function(){if(this.count>0){--this.count;var t=this.T[this.count];return this.T[this.count]=null,t}return null},t.put=function(t){var i=this.T;if(this.count<i.length){if(this.O&&!1===this.O(t))return;i[this.count]=t,++this.count}},t.resize=function(t){t>=0&&(this.T.length=t,this.count>t&&(this.count=t))},i}(),si=function(){function t(t){this.i=0,this.array=t}var i=t.prototype;return i.remove=function(t){var i=this.array.indexOf(t);i>=0&&this.removeAt(i)},i.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},i.fastRemove=function(t){var i=this.array.indexOf(t);i>=0&&this.fastRemoveAt(i)},i.fastRemoveAt=function(t){var i=this.array;i[t]=i[i.length-1],--i.length,t<=this.i&&--this.i},i.push=function(t){this.array.push(t)},r(t,[{key:"length",get:function(){return this.array.length},set:function(t){this.array.length=t,this.i>=t&&(this.i=t-1)}}]),t}();function ei(t,i){t.splice(i,1)}function hi(t,i){var n=t.length;i<0||i>=n||(t[i]=t[n-1],t.length=n-1)}function ui(t,i){var n=t.indexOf(i);return n>=0&&(ei(t,n),!0)}function oi(t,i){var n=t.indexOf(i);n>=0&&(t[n]=t[t.length-1],--t.length)}function ci(t,i){var n=t.findIndex(i);if(n>=0){var r=t[n];return ei(t,n),r}}function ai(t,i){return t.indexOf(i)>=0}function fi(t){for(var i=0,n=arguments.length<=1?0:arguments.length-1;i<n;++i)t[i]=i+1<1||arguments.length<=i+1?void 0:arguments[i+1]}var vi=Object.freeze({__proto__:null,MutableForwardIterator:si,appendObjectsAt:function(t,i,n){return t.splice.apply(t,[n,0].concat(i)),t},contains:ai,copy:function(t){for(var i=t.length,n=new Array(i),r=0;r<i;r+=1)n[r]=t[r];return n},fastRemove:oi,fastRemoveAt:hi,fillItems:fi,remove:ui,removeArray:function(t,i){for(var n=0,r=i.length;n<r;n++)ui(t,i[n])},removeAt:ei,removeIf:ci,verifyType:function(t,i){if(t&&t.length>0)for(var n,r=w(t);!(n=r()).done;)if(!(n.value instanceof i))return tt(1300),!1;return!0}}),li={IDGenerator:wt,Pool:ri,array:vi,isNumber:mt,isString:bt,isEmptyObject:kt,getPropertyDescriptor:Bt,addon:Ut,mixin:xt,extend:Gt,getSuper:jt,isChildClassOf:Ht,clear:Vt,value:Et,getset:Tt,get:Ot,set:St,unregisterClass:Qt,getClassName:Rt,setClassName:Kt,setClassAlias:qt,getClassByName:ti,getClassById:Zt,get _registeredClassNames(){return s({},zt)},set _registeredClassNames(t){Vt(zt),Object.assign(zt,t)},get _registeredClassIds(){return s({},$t)},set _registeredClassIds(t){Vt($t),Object.assign($t,t)},_getClassId:ii,getClassId:ni,_setClassId:Xt,_getClassById:Jt,obsolete:Mt,obsoletes:Ct,formatStr:Lt,shiftArguments:Dt,createMap:It};O.js=li;var di=Object.freeze({__proto__:null,IDGenerator:wt,Pool:ri,_getClassById:Jt,_getClassId:ii,_idToClass:$t,_nameToClass:zt,_setClassId:Xt,addon:Ut,array:vi,clear:Vt,copyAllProperties:function(t,i,n){for(var r=Object.getOwnPropertyNames(t),s=0,e=r.length;s<e;++s){var h=r[s];-1===n.indexOf(h)&&Ft(h,t,i)}},createMap:It,extend:Gt,formatStr:Lt,get:Ot,getClassById:Zt,getClassByName:ti,getClassId:ni,getClassName:Rt,getPropertyDescriptor:Bt,getSuper:jt,getset:Tt,isChildClassOf:Ht,isEmptyObject:kt,isNumber:mt,isString:bt,js:li,mixin:xt,obsolete:Mt,obsoletes:Ct,set:St,setClassAlias:qt,setClassName:Kt,shiftArguments:Dt,unregisterClass:Qt,value:Et});function wi(t){if("__bitmask__"in t)return t;Et(t,"__bitmask__",null,!0);for(var i=-1,n=Object.keys(t),r=0;r<n.length;r++){var s=n[r],e=t[s];if(-1===e)e=++i,t[s]=e;else if("number"==typeof e)i=e;else if("string"==typeof e&&Number.isInteger(parseFloat(s)))continue;var h=""+e;s!==h&&Et(t,h,s)}return t}function gi(t,i){i>=0&&t.length,t.length}t("bd",di),wi.isBitMask=function(t){return t&&Object.prototype.hasOwnProperty.call(t,"__bitmask__")},wi.getList=function(t){return t.__bitmask__?t.__bitmask__:wi.update(t)},wi.update=function(t){Array.isArray(t.__bitmask__)||(t.__bitmask__=[]);var i=t.__bitmask__;for(var n in i.length=0,t){var r=t[n];Number.isInteger(r)&&i.push({name:n,value:r})}return i.sort((function(t,i){return t.value-i.value})),i},O.BitMask=wi;var pi=Object.prototype.hasOwnProperty;function _i(t){return"__enums__"in t?t:(Et(t,"__enums__",null,!0),_i.update(t))}function yi(t){pi.call(t,"__enums__")}function mi(t){yi(t);var i=t.__enums__||[];i.length=0;var n=!0;for(var r in t){var s=t[r],e=Number.isInteger(s);e||(n=!1),(e||"string"==typeof s&&t[s]!==Number.parseInt(r))&&i.push({name:r,value:s})}return n&&i.sort((function(t,i){return t.value-i.value})),t.__enums__=i,i}function bi(t){"__enums__"in t||Et(t,"__enums__",null,!0)}_i.update=function(t){for(var i=-1,n=Object.keys(t),r=0;r<n.length;r++){var s=n[r],e=t[s];if(-1===e)e=++i,t[s]=e;else if("number"==typeof e)i=e;else if("string"==typeof e&&Number.isInteger(parseFloat(s)))continue;var h=""+e;s!==h&&Et(t,h,s)}return Array.isArray(t.__enums__)&&mi(t),t},_i.isEnum=function(t){return t&&pi.call(t,"__enums__")},_i.getList=function(t){return yi(t),t.__enums__?t.__enums__:mi(t)},_i.sortList=function(t,i){yi(t),Array.isArray(t.__enums__)&&t.__enums__.sort(i)},O.Enum=_i;var ki=t("bc",function(){function t(){}var i=t.prototype;return i.clone=function(){return ht(100,Rt(this)+".clone"),this},i.equals=function(){return!1},i.set=function(){ht(100,Rt(this)+".set")},i.toString=function(){return""},t}());Kt("cc.ValueType",ki),O.ValueType=ki;var Ai=t("c9",{PATH:"path",ENGINE:"engine",ASSETS:"assets",SCRIPTING:"scripting",PHYSICS:"physics",RENDERING:"rendering",LAUNCH:"launch",SCREEN:"screen",SPLASH_SCREEN:"splashScreen",ANIMATION:"animation",PROFILING:"profiling",PLUGINS:"plugins",XR:"xr"}),Ei=t("ca",function(){function t(){this.S={},this.I={}}var i=t.prototype;return i.init=function(t,i){var n=this;for(var r in void 0===t&&(t=""),void 0===i&&(i={}),i){var s=i[r];if(s)for(var e in s)this.overrideSettings(r,e,s[e])}return t?new Promise((function(i,r){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="text",s.onload=function(){n.S=JSON.parse(s.response),i()},s.onerror=function(){r(new Error("request settings failed!"))},s.send(null)})):Promise.resolve()},i.overrideSettings=function(t,i,n){t in this.I||(this.I[t]={}),this.I[t][i]=n},i.querySettings=function(t,i){if(t in this.I){var n=this.I[t];if(n&&i in n)return n[i]}if(t in this.S){var r=this.S[t];if(r&&i in r)return r[i]}return null},t}());Ei.Category=Ai;var Ti,Oi=t("cb",new Ei);O.settings=Oi,function(t){t[t.PORTRAIT=1]="PORTRAIT",t[t.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",t[t.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",t[t.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",t[t.LANDSCAPE=12]="LANDSCAPE",t[t.AUTO=13]="AUTO"}(Ti||(Ti={}));var Si=t("bY",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:Ti.PORTRAIT,ORIENTATION_PORTRAIT_UPSIDE_DOWN:Ti.PORTRAIT_UPSIDE_DOWN,ORIENTATION_LANDSCAPE:Ti.LANDSCAPE,ORIENTATION_LANDSCAPE_LEFT:Ti.LANDSCAPE_LEFT,ORIENTATION_LANDSCAPE_RIGHT:Ti.LANDSCAPE_RIGHT,ORIENTATION_AUTO:Ti.AUTO,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,ENABLE_FLOAT_OUTPUT:!1,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20,ENABLE_WEBGL_HIGHP_STRUCT_VALUES:!1,BATCHER2D_MEM_INCREMENT:144,CUSTOM_PIPELINE_NAME:"Builtin",init:function(){var t=Oi.querySettings("engine","macros");if(t)for(var i in t)Si[i]=t[i]}});function Ii(t,i){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];var e=performance.now(),h=requestAnimationFrame||window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;return void 0===h?setTimeout.apply(void 0,[t,i].concat(r)):h((function n(){performance.now()-e<i?h(n):t.apply(void 0,r)}))}O.macro=Si;for(var Ri=/^(?:cc|dragonBones|sp|ccsg)\..+/,Mi=new Array(123),Ci=0;Ci<123;++Ci)Mi[Ci]=64;for(var Ni=0;Ni<64;++Ni)Mi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(Ni)]=Ni;var Pi=Mi;function Li(t,i,n){function r(t,i,n,r){var s=Object.getOwnPropertyDescriptor(t,i);if(s)s.get&&n&&(t[n]=s.get),s.set&&r&&(t[r]=s.set);else{var e=t[n];Tt(t,i,e,t[r])}}for(var s,e=t.prototype,h=0,u=i.length;h<u;++h){var o=(s=i[h])[0].toUpperCase()+s.slice(1);r(e,s,"get"+o,"set"+o)}for(s in n){var c=n[s];r(e,s,c[0],c[1])}}function Di(t,i,n,r){var s=t[i];s?Array.isArray(s)?r?(s.push(s[0]),s[0]=n):s.push(n):t[i]=r?[n,s]:[s,n]:t[i]=n}function Bi(t,i){if("function"==typeof t.contains)return t.contains(i);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(i));var n=i.parentNode;if(n)do{if(n===t)return!0;n=n.parentNode}while(null!==n);return!1}function Fi(t){return"object"==typeof window&&"function"==typeof Node?t instanceof Node:!!t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function Ui(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];t&&Ii((function(){t.apply(void 0,n)}),0)}function xi(t){return!(!t||t.constructor!==Object)&&kt(t)}function Gi(t,i,n){if(i>n){var r=i;i=n,n=r}return t<i?i:t<n?t:n}function ji(t){return t*Si.RAD}function Hi(t){return t*Si.DEG}O.misc={BUILTIN_CLASSID_RE:Ri,BASE64_VALUES:Pi,propertyDefine:Li,pushToMap:Di,contains:Bi,isDomNode:Fi,callInNextTick:Ui,isPlainEmptyObj_DEV:xi,clampf:Gi,degreesToRadians:ji,radiansToDegrees:Hi},t("be",Object.freeze({__proto__:null,BASE64_VALUES:Pi,BUILTIN_CLASSID_RE:Ri,callInNextTick:Ui,clampf:Gi,contains:Bi,degreesToRadians:ji,isDomNode:Fi,isPlainEmptyObj_DEV:xi,propertyDefine:Li,pushToMap:Di,radiansToDegrees:Hi,tryCatchFunctor_EDITOR:function(t){return Function("target","try {\n  target."+t+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")}}));var Vi="$_$";function $i(t,i){var n=i?Object.create(i):{};return Et(t,"__attrs__",n),n}function zi(t){if("function"!=typeof t)return $i(t,Xi(t.constructor));for(var i,n=O.Class.getInheritanceChain(t),r=n.length-1;r>=0;r--){var s=n[r];s.hasOwnProperty("__attrs__")&&s.__attrs__||$i(s,(i=n[r+1])&&i.__attrs__)}return $i(t,(i=n[0])&&i.__attrs__),t.__attrs__}function Wi(t,i){var n=Xi(t),r=i+Vi,s={};for(var e in n)e.startsWith(r)&&(s[e.slice(r.length)]=n[e]);return s}function Xi(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||zi(t)}function Yi(t,i,n,r){Xi(t)[i+Vi+n]=r}var Ki=function(){function t(t,i){this.name=t,this.default=i}return t.prototype.toString=function(){return this.name},t}(),qi=t("bv",new Ki("Integer",0));O.Integer=qi,O.CCInteger=qi;var Qi=t("bw",new Ki("Float",0));O.Float=Qi,O.CCFloat=Qi;var Ji=t("bx",new Ki("Boolean",!1));O.Boolean=Ji,O.CCBoolean=Ji;var Zi=t("by",new Ki("String",""));function tn(t,i){return function(n,r){var s='"'+Rt(n)+"."+r+'"',e=Wi(n,r),h=e.type;if(h===qi||h===Qi?h="Number":h!==Zi&&h!==Ji||(h=""+h),h===t){if(e.hasOwnProperty("default")){var u=e.default;if(void 0!==u&&!Array.isArray(u)&&!xi(u)){var o=typeof u,c=t.toLowerCase();if(o===c)if("object"===c){if(!u||u instanceof e.ctor)return;st(3605,s,Rt(e.ctor))}else"Number"!==t&&st(3606,i,s,t);else{if("function"===o)return;t===Zi.default&&null==u?st(3607,s):st(3611,i,s,o)}delete e.type}}}else st(3604,s)}}O.String=Zi,O.CCString=Zi;var nn=Object.freeze({__proto__:null,CCBoolean:Ji,CCFloat:Qi,CCInteger:qi,CCString:Zi,DELIMETER:Vi,PrimitiveType:Ki,attr:Wi,createAttrs:zi,createAttrsSingle:$i,getClassAttrs:Xi,getObjTypeChecker_ET:function(t){return function(i,n){tn("Object","type")(i,n);var r=Xi(i)[n+Vi+"default"],s=O.Class.getDefault(r);if(!Array.isArray(s)&&Ht(t,O.ValueType)){var e=Rt(t),h=Lt('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Rt(i),n,e);r?z(h):st(3612,h,e,Rt(i),n,e)}}},getTypeChecker_ET:tn,setClassAttr:Yi}),rn={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function sn(t,i,n,r){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var s="_N$"+i;t.get=function(){return this[s]},t.set=function(t){var i=this[s];this[s]=t,n.call(this,i)};var e={};for(var h in r[s]=e,rn){var u=rn[h];t.hasOwnProperty(h)&&(e[h]=t[h],u.canUsedInGet||delete t[h])}}}function en(t,i,n,r){if(Array.isArray(i)){if(!(i.length>0))return ht(5508,n,r);t.type=i=i[0]}"function"==typeof i&&(i===String?t.type=O.String:i===Boolean?t.type=O.Boolean:i===Number&&(t.type=O.Float))}function hn(t,i,n){var r=t||void 0===i?{_short:!0}:{_short:!0,default:i};return n&&(r.type=n),r}function un(t,i){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return hn(i,[],t);if("function"==typeof t){var n=t;return hn(i,Ht(n,O.ValueType)?new n:null,n)}return t instanceof Ki?hn(i,void 0,t):hn(i,t)}return null}function on(t,i){for(var n in t){var r=t[n],s=un(r,!1);if(s&&(r=t[n]=s),r){var e=r.notify;e&&sn(r,n,e,t),"type"in r&&en(r,r.type,i,n)}}}var cn=[];function an(){return cn[cn.length-1]}function fn(t,i,n){vn(Xi(t),i,n)}function vn(t,i,n){t[""+i+Vi+"type"]="Enum",t[""+i+Vi+"enumList"]=_i.getList(n)}O._RF={push:function(t,i,n,r){void 0===n&&(n=i,i=""),cn.push({uuid:i,script:n,module:t,exports:t.exports,beh:null,importMeta:r})},pop:function(){var t=cn.pop(),i=t.module,n=i.exports;if(n===t.exports){for(var r in n)return;i.exports=n=t.cls}},peek:an};var ln=Vi,dn="__ctors__",wn=t("cz","Enum"),gn=t("cA","BitMask");function pn(t,i){t.indexOf(i)<0&&t.push(i)}function _n(t,i){pn(t.__props__,i)}function yn(t,i,n,r){_n(t,n),In(t,r,i,n)}function mn(t,i,n,r){var s=r.get;r.set,s&&(In(t,r,i,n),Yi(t,n,"serializable",!1))}function bn(t){return"function"==typeof t?t():t}function kn(t,i,n){var r=n.ctor;return Et(r,dn,!0,!0),r.prototype,i&&(r.$super=i),Kt(t,r),r}function An(t,i,n){var r=O.Component,s=an();if(s&&Ht(i,r)){if(Ht(s.cls,r))return ht(3615),null;t=t||s.script}var e=kn(t,i,n);if(s)if(Ht(i,r)){var h=s.uuid;h&&Xt(h,e),s.cls=e}else Ht(s.cls,r)||(s.cls=e);return e}function En(t,i,n,r){if(t.__props__=[],r&&r.__props__&&(t.__props__=r.__props__.slice()),n)for(var s in on(n,i),n){var e=n[s];e.get||e.set?mn(t,i,s,e):yn(t,i,s,e)}var h=Xi(t);t.__values__=t.__props__.filter((function(t){return!1!==h[""+t+ln+"serializable"]}))}function Tn(t){var i=t.name,n=t.extends,r=An(i,n,t);i||(i=O.js.getClassName(r)),r._sealed=!0,n&&(n._sealed=!1),En(r,i,t.properties,n);var s=t.editor;return s&&Ht(n,O.Component)&&O.Component._registerEditorProps(r,s),r}function On(t){return null==t||null==t.hasOwnProperty?void 0:t.hasOwnProperty("__values__")}Tn._isCCClass=function(t){return null==t||null==t.hasOwnProperty?void 0:t.hasOwnProperty(dn)},Tn.fastDefine=function(t,i,n){Kt(t,i);for(var r=i.__props__=i.__values__=Object.keys(n),s=Xi(i),e=0;e<r.length;e++){var h=r[e];s[h+ln+"visible"]=!1,s[h+ln+"default"]=n[h]}},Tn.Attr=nn,Tn.attr=Wi,Tn.isCCClassOrFastDefined=On,Tn.getInheritanceChain=function(t){for(var i=[];t=jt(t);)t!==Object&&i.push(t);return i};var Sn={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function In(t,i,n,r){var s=null,e="";function h(){return e=r+ln,s=Xi(t)}"type"in i&&void 0===i.type&&st(3660,r,n);var u=i.type;u&&(Sn[u]?(s||h())[e+"type"]=u:"Object"===u||("object"==typeof u?_i.isEnum(u)?vn(s||h(),r,u):wi.isBitMask(u)&&((s||h())[e+"type"]=gn,s[e+"bitmaskList"]=wi.getList(u)):"function"==typeof u&&((s||h())[e+"type"]="Object",s[e+"ctor"]=u))),"default"in i&&((s||h())[e+"default"]=i.default);var o,c=function(t,n){if(t in i){var r=i[t];typeof r===n&&((s||h())[e+t]=r)}};i.editorOnly&&((s||h())[e+"editorOnly"]=!0),1&i.__internalFlags?o=!0===i.serializable||!!(4&i.__internalFlags):!1===i.serializable&&(o=!1),void 0!==o&&((s||h())[e+"serializable"]=o),c("formerlySerializedAs","string");var a=i.range;a&&Array.isArray(a)&&a.length>=2&&((s||h())[e+"min"]=a[0],s[e+"max"]=a[1],a.length>2&&(s[e+"step"]=a[2])),c("step","number"),c("userData","object")}Tn.isArray=function(t){return t=bn(t),Array.isArray(t)},Tn.getDefault=bn,Tn.escapeForJS=function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},Tn.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,Tn.getNewValueTypeCode=function(t){for(var i=Rt(t),n=t.constructor,r="new "+i+"(",s=0;s<n.__props__.length;s++)r+=t[n.__props__[s]],s<n.__props__.length-1&&(r+=",");return r+")"},O.Class=Tn;var Rn=Math.abs,Mn=Math.floor,Cn=Math.PI,Nn=Cn/180,Pn=180/Cn,Ln=Math.random,Dn=t("aG",.5*Cn),Bn=t("aH",2*Cn),Fn=t("aI",1e-6);function Un(t,i){return Rn(t-i)<=Fn*Math.max(1,Rn(t),Rn(i))}function xn(t,i,n){return n=n||Fn,Rn(t-i)<=n}function Gn(t,i,n){if(i>n){var r=i;i=n,n=r}return t<i?i:t>n?n:t}function jn(t){return t<0?0:t>1?1:t}function Hn(t,i,n){return t+(i-t)*n}function Vn(t){return t*Nn}function $n(t){return t*Pn}function zn(){return Ln()}function Wn(t){Ln=t}function Xn(t,i){return zn()*(i-t)+t}function Yn(t,i){return Mn(Xn(t,i))}function Kn(t){return(t=(9301*t+49297)%233280)/233280}function qn(t,i,n){return Kn(t)*(n-i)+i}function Qn(t,i,n){return Mn(qn(t,i,n))}function Jn(t){return P(t)}function Zn(t,i){return t-Mn(t/i)*i}function tr(t,i){return t=Zn(t,2*i),i-Rn(t-i)}function ir(t,i,n){return(n-t)/(i-t)}function nr(t){return Rn(t.x)>Rn(t.y)?Rn(t.x)>Rn(t.z)?t.x:t.z:Rn(t.y)>Rn(t.z)?t.y:t.z}function rr(t,i){return Rn(t)>Rn(i)?t:i}function sr(t,i){i.forEach((function(i){Object.defineProperty(t,i,{enumerable:!0})}))}var er,hr,ur,or=(er=new Float32Array(1),hr=new Int32Array(er.buffer),function(t){er[0]=t;var i=hr[0],n=i>>16&32768,r=2147483647&i,s=r-(112<<23)+4096>>13;return s=r<113<<23?0:s,s=r>=143<<23?31744:s,s=r>255<<23?32256:s,hr[0]=n|s,hr[0]}),cr=function(){var t=new Float32Array(1),i=new Int32Array(t.buffer);return function(n){var r,s=32767&n,e=s<<13;return 31744!==e?(e+=112<<23,0===s?e=(1048575&e)>>1:32767===s&&(e=2147483647)):e=2139095040,r=(n>>15&1)<<31|e,i[0]=r,t[0]}}();function ar(t){return or(t)}function fr(t){return cr(t)}var vr=Math.abs,lr=Math.max,dr=Math.min,wr=Math.PI,gr=Math.acos,pr=Math.sin,_r=Math.cos,yr=Math.sqrt,mr=Math.ceil,br=Math.floor,kr=Math.round;function Ar(t,i,n){return Object.freeze(new Ir(t,i,n))}var Er,Tr,Or,Sr,Ir=t("aq",function(t){function i(i,n,r){var s;return s=t.call(this)||this,"object"==typeof i?(s.x=i.x,s.y=i.y,s.z=i.z):(s.x=i||0,s.y=n||0,s.z=r||0),s}e(i,t),i.zero=function(t){return t.x=0,t.y=0,t.z=0,t},i.clone=function(t){return new i(t.x,t.y,t.z)},i.copy=function(t,i){return t.x=i.x,t.y=i.y,t.z=i.z,t},i.set=function(t,i,n,r){return t.x=i,t.y=n,t.z=r,t},i.add=function(t,i,n){return t.x=i.x+n.x,t.y=i.y+n.y,t.z=i.z+n.z,t},i.subtract=function(t,i,n){return t.x=i.x-n.x,t.y=i.y-n.y,t.z=i.z-n.z,t},i.multiply=function(t,i,n){return t.x=i.x*n.x,t.y=i.y*n.y,t.z=i.z*n.z,t},i.divide=function(t,i,n){return t.x=i.x/n.x,t.y=i.y/n.y,t.z=i.z/n.z,t},i.ceil=function(t,i){return t.x=mr(i.x),t.y=mr(i.y),t.z=mr(i.z),t},i.floor=function(t,i){return t.x=br(i.x),t.y=br(i.y),t.z=br(i.z),t},i.min=function(t,i,n){return t.x=dr(i.x,n.x),t.y=dr(i.y,n.y),t.z=dr(i.z,n.z),t},i.max=function(t,i,n){return t.x=lr(i.x,n.x),t.y=lr(i.y,n.y),t.z=lr(i.z,n.z),t},i.round=function(t,i){return t.x=kr(i.x),t.y=kr(i.y),t.z=kr(i.z),t},i.multiplyScalar=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t},i.scaleAndAdd=function(t,i,n,r){return t.x=i.x+n.x*r,t.y=i.y+n.y*r,t.z=i.z+n.z*r,t},i.distance=function(t,i){var n=i.x-t.x,r=i.y-t.y,s=i.z-t.z;return yr(n*n+r*r+s*s)},i.squaredDistance=function(t,i){var n=i.x-t.x,r=i.y-t.y,s=i.z-t.z;return n*n+r*r+s*s},i.len=function(t){var i=t.x,n=t.y,r=t.z;return yr(i*i+n*n+r*r)},i.lengthSqr=function(t){var i=t.x,n=t.y,r=t.z;return i*i+n*n+r*r},i.negate=function(t,i){return t.x=-i.x,t.y=-i.y,t.z=-i.z,t},i.invert=function(t,i){return t.x=1/i.x,t.y=1/i.y,t.z=1/i.z,t},i.invertSafe=function(t,i){var n=i.x,r=i.y,s=i.z;return vr(n)<Fn?t.x=0:t.x=1/n,vr(r)<Fn?t.y=0:t.y=1/r,vr(s)<Fn?t.z=0:t.z=1/s,t},i.normalize=function(t,i){var n=i.x,r=i.y,s=i.z,e=n*n+r*r+s*s;return e>0?(e=1/yr(e),t.x=n*e,t.y=r*e,t.z=s*e):(t.x=0,t.y=0,t.z=0),t},i.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},i.cross=function(t,i,n){var r=i.x,s=i.y,e=i.z,h=n.x,u=n.y,o=n.z;return t.x=s*o-e*u,t.y=e*h-r*o,t.z=r*u-s*h,t},i.lerp=function(t,i,n,r){return t.x=i.x+r*(n.x-i.x),t.y=i.y+r*(n.y-i.y),t.z=i.z+r*(n.z-i.z),t},i.random=function(t,i){i=i||1;var n=2*zn()*wr,r=2*zn()-1,s=yr(1-r*r);return t.x=s*_r(n)*i,t.y=s*pr(n)*i,t.z=r*i,t},i.transformMat4=function(t,i,n){var r=i.x,s=i.y,e=i.z,h=n.m03*r+n.m07*s+n.m11*e+n.m15;return h=h?1/h:1,t.x=(n.m00*r+n.m04*s+n.m08*e+n.m12)*h,t.y=(n.m01*r+n.m05*s+n.m09*e+n.m13)*h,t.z=(n.m02*r+n.m06*s+n.m10*e+n.m14)*h,t},i.transformMat4Normal=function(t,i,n){var r=i.x,s=i.y,e=i.z,h=n.m03*r+n.m07*s+n.m11*e;return h=h?1/h:1,t.x=(n.m00*r+n.m04*s+n.m08*e)*h,t.y=(n.m01*r+n.m05*s+n.m09*e)*h,t.z=(n.m02*r+n.m06*s+n.m10*e)*h,t},i.transformMat3=function(t,i,n){var r=i.x,s=i.y,e=i.z;return t.x=r*n.m00+s*n.m03+e*n.m06,t.y=r*n.m01+s*n.m04+e*n.m07,t.z=r*n.m02+s*n.m05+e*n.m08,t},i.transformAffine=function(t,i,n){var r=i.x,s=i.y,e=i.z;return t.x=n.m00*r+n.m04*s+n.m08*e+n.m12,t.y=n.m01*r+n.m05*s+n.m09*e+n.m13,t.z=n.m02*r+n.m06*s+n.m10*e+n.m14,t},i.transformQuat=function(t,i,n){var r=n.w*i.x+n.y*i.z-n.z*i.y,s=n.w*i.y+n.z*i.x-n.x*i.z,e=n.w*i.z+n.x*i.y-n.y*i.x,h=-n.x*i.x-n.y*i.y-n.z*i.z;return t.x=r*n.w+h*-n.x+s*-n.z-e*-n.y,t.y=s*n.w+h*-n.y+e*-n.x-r*-n.z,t.z=e*n.w+h*-n.z+r*-n.y-s*-n.x,t},i.transformRTS=function(t,i,n,r,s){var e=i.x*s.x,h=i.y*s.y,u=i.z*s.z,o=n.w*e+n.y*u-n.z*h,c=n.w*h+n.z*e-n.x*u,a=n.w*u+n.x*h-n.y*e,f=-n.x*e-n.y*h-n.z*u;return t.x=o*n.w+f*-n.x+c*-n.z-a*-n.y+r.x,t.y=c*n.w+f*-n.y+a*-n.x-o*-n.z+r.y,t.z=a*n.w+f*-n.z+o*-n.y-c*-n.x+r.z,t},i.transformInverseRTS=function(t,i,n,r,s){var e=i.x-r.x,h=i.y-r.y,u=i.z-r.z,o=n.w*e-n.y*u+n.z*h,c=n.w*h-n.z*e+n.x*u,a=n.w*u-n.x*h+n.y*e,f=n.x*e+n.y*h+n.z*u;return t.x=(o*n.w+f*n.x+c*n.z-a*n.y)/s.x,t.y=(c*n.w+f*n.y+a*n.x-o*n.z)/s.y,t.z=(a*n.w+f*n.z+o*n.y-c*n.x)/s.z,t},i.rotateX=function(t,i,n,r){var s=i.x-n.x,e=i.y-n.y,h=i.z-n.z,u=_r(r),o=pr(r),c=s,a=e*u-h*o,f=e*o+h*u;return t.x=c+n.x,t.y=a+n.y,t.z=f+n.z,t},i.rotateY=function(t,i,n,r){var s=i.x-n.x,e=i.y-n.y,h=i.z-n.z,u=_r(r),o=pr(r),c=h*o+s*u,a=e,f=h*u-s*o;return t.x=c+n.x,t.y=a+n.y,t.z=f+n.z,t},i.rotateZ=function(t,i,n,r){var s=i.x-n.x,e=i.y-n.y,h=i.z-n.z,u=_r(r),o=pr(r),c=s*u-e*o,a=s*o+e*u,f=h;return t.x=c+n.x,t.y=a+n.y,t.z=f+n.z,t},i.rotateN=function(t,i,n,r,s){var e=i.x-n.x,h=i.y-n.y,u=i.z-n.z,o=r.x,c=r.y,a=r.z,f=_r(s),v=pr(s),l=e*(o*o*(1-f)+f)+h*(o*c*(1-f)-a*v)+u*(o*a*(1-f)+c*v),d=e*(o*c*(1-f)+a*v)+h*(c*c*(1-f)+f)+u*(c*a*(1-f)-o*v),w=e*(o*a*(1-f)-c*v)+h*(c*a*(1-f)+o*v)+u*(a*a*(1-f)+f);return t.x=l+n.x,t.y=d+n.y,t.z=w+n.z,t},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.x,t[n+1]=i.y,t[n+2]=i.z,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t},i.strictEquals=function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z},i.equals=function(t,i,n){void 0===n&&(n=Fn);var r=t.x,s=t.y,e=t.z,h=i.x,u=i.y,o=i.z;return vr(r-h)<=n*lr(1,vr(r),vr(h))&&vr(s-u)<=n*lr(1,vr(s),vr(u))&&vr(e-o)<=n*lr(1,vr(e),vr(o))},i.angle=function(t,i){var n=t.x*t.x+t.y*t.y+t.z*t.z,r=i.x*i.x+i.y*i.y+i.z*i.z;if(0===n||0===r)return 0;var s=(t.x*i.x+t.y*i.y+t.z*i.z)/yr(n*r);return s=Gn(s,-1,1),gr(s)},i.projectOnPlane=function(t,n,r){return i.subtract(t,n,i.project(t,n,r))},i.project=function(t,n,r){var s=i.lengthSqr(r);return s<1e-6?i.set(t,0,0,0):i.multiplyScalar(t,r,i.dot(n,r)/s)},i.moveTowards=function(t,i,n,r){var s=n.x-i.x,e=n.y-i.y,h=n.z-i.z,u=s*s+e*e+h*h;if(0===u||r>=0&&u<r*r)return t.x=n.x,t.y=n.y,t.z=n.z,t;var o=r/yr(u);return t.x=i.x+s*o,t.y=i.y+e*o,t.z=i.z+h*o,t},i.generateOrthogonal=function(t,n){var r=n.x,s=n.y,e=n.z,h=vr(r),u=vr(s),o=vr(e);return h<u&&h<o?i.set(t,0,e,-s):u<o?i.set(t,e,0,-r):i.set(t,s,-r,0),i.normalize(t,t)};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y,this.z)},n.set=function(t,i,n){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=i||0,this.z=n||0),this},n.equals=function(t,i){return void 0===i&&(i=Fn),vr(this.x-t.x)<=i&&vr(this.y-t.y)<=i&&vr(this.z-t.z)<=i},n.equals3f=function(t,i,n,r){return void 0===r&&(r=Fn),vr(this.x-t)<=r&&vr(this.y-i)<=r&&vr(this.z-n)<=r},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},n.strictEquals3f=function(t,i,n){return this.x===t&&this.y===i&&this.z===n},n.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},n.lerp=function(t,i){return this.x+=i*(t.x-this.x),this.y+=i*(t.y-this.y),this.z+=i*(t.z-this.z),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.add3f=function(t,i,n){return this.x+=t,this.y+=i,this.z+=n,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.subtract3f=function(t,i,n){return this.x-=t,this.y-=i,this.z-=n,this},n.multiplyScalar=function(t){return"object"==typeof t&&st(16357),this.x*=t,this.y*=t,this.z*=t,this},n.multiply=function(t){return"object"!=typeof t&&st(16358),this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.multiply3f=function(t,i,n){return this.x*=t,this.y*=i,this.z*=n,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},n.divide3f=function(t,i,n){return this.x/=t,this.y/=i,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(t,i){return this.x=Gn(this.x,t.x,i.x),this.y=Gn(this.y,t.y,i.y),this.z=Gn(this.z,t.z,i.z),this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.cross=function(t){var i=this.x,n=this.y,r=this.z,s=t.x,e=t.y,h=t.z;return this.x=n*h-r*e,this.y=r*s-i*h,this.z=i*e-n*s,this},n.length=function(){var t=this;return yr(t.x*t.x+t.y*t.y+t.z*t.z)},n.lengthSqr=function(){var t=this;return t.x*t.x+t.y*t.y+t.z*t.z},n.normalize=function(){var t=this,i=t.x,n=t.y,r=t.z,s=i*i+n*n+r*r;return s>0&&(s=1/yr(s),t.x=i*s,t.y=n*s,t.z=r*s),t},n.transformMat4=function(t){var i=this,n=i.x,r=i.y,s=i.z,e=t.m03*n+t.m07*r+t.m11*s+t.m15;return e=e?1/e:1,i.x=(t.m00*n+t.m04*r+t.m08*s+t.m12)*e,i.y=(t.m01*n+t.m05*r+t.m09*s+t.m13)*e,i.z=(t.m02*n+t.m06*r+t.m10*s+t.m14)*e,i},n.toVec2=function(){return new O.Vec2(this.x,this.y)},i}(ki));function Rr(t,i,n){return new Ir(t,i,n)}ur=Ir,Ir.UNIT_X=Ar(1,0,0),Ir.UNIT_Y=Ar(0,1,0),Ir.UNIT_Z=Ar(0,0,1),Ir.RIGHT=Ar(1,0,0),Ir.UP=Ar(0,1,0),Ir.FORWARD=Ar(0,0,-1),Ir.ZERO=Ar(0,0,0),Ir.ONE=Ar(1,1,1),Ir.NEG_ONE=Ar(-1,-1,-1),Ir.slerp=(Er=new ur,Tr=new ur,Or=new ur,function(t,i,n,r){var s=1e-5,e=ur.len(i),h=ur.len(n);if(e<s||h<s)return ur.lerp(t,i,n,r);var u=Hn(e,h,r),o=ur.dot(i,n)/(e*h);if(o>.99999)return ur.lerp(t,i,n,r);if(o<-.99999){var c=ur.multiplyScalar(Er,i,1/e),a=ur.generateOrthogonal(Tr,c);return Nr(Or,c,a,wr*r),ur.multiplyScalar(t,Or,u),t}var f=o,v=gr(f)*r,l=ur.multiplyScalar(Er,i,1/e),d=ur.multiplyScalar(Tr,n,1/h);return ur.scaleAndAdd(Or,d,l,-f),ur.normalize(Or,Or),ur.multiplyScalar(Or,Or,pr(v)),ur.scaleAndAdd(Or,Or,l,_r(v)),ur.multiplyScalar(t,Or,u),t}),Ir.signedAngle=(Sr=new ur,function(t,i,n){var r=ur.angle(t,i),s=ur.cross(Sr,t,i);return ur.dot(s,n)<0?-r:r}),Tn.fastDefine("cc.Vec3",Ir,{x:0,y:0,z:0}),O.Vec3=Ir;var Mr,Cr,Nr=(Mr={x:0,y:0,z:0,w:0},function(t,i,n,r){var s=.5*r,e=pr(s);return Mr.x=e*n.x,Mr.y=e*n.y,Mr.z=e*n.z,Mr.w=_r(s),Ir.transformQuat(t,i,Mr),t});O.v3=Rr;var Pr=Math.abs,Lr=Math.max,Dr=t("aw",function(t){function i(i,n,r,s,e,h,u,o,c){var a;void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=1),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=1);var f=v(a=t.call(this)||this);return"object"==typeof i?(f.m00=i.m00,f.m01=i.m01,f.m02=i.m02,f.m03=i.m03,f.m04=i.m04,f.m05=i.m05,f.m06=i.m06,f.m07=i.m07,f.m08=i.m08):(f.m00=i,f.m01=n,f.m02=r,f.m03=s,f.m04=e,f.m05=h,f.m06=u,f.m07=o,f.m08=c),a}e(i,t),i.clone=function(t){return new i(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},i.copy=function(t,i){return t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m03,t.m04=i.m04,t.m05=i.m05,t.m06=i.m06,t.m07=i.m07,t.m08=i.m08,t},i.set=function(t,i,n,r,s,e,h,u,o,c){return t.m00=i,t.m01=n,t.m02=r,t.m03=s,t.m04=e,t.m05=h,t.m06=u,t.m07=o,t.m08=c,t},i.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},i.transpose=function(t,i){if(t===i){var n=i.m01,r=i.m02,s=i.m05;t.m01=i.m03,t.m02=i.m06,t.m03=n,t.m05=i.m07,t.m06=r,t.m07=s}else t.m00=i.m00,t.m01=i.m03,t.m02=i.m06,t.m03=i.m01,t.m04=i.m04,t.m05=i.m07,t.m06=i.m02,t.m07=i.m05,t.m08=i.m08;return t},i.invert=function(t,n){var r=n.m00,s=n.m01,e=n.m02,h=n.m03,u=n.m04,o=n.m05,c=n.m06,a=n.m07,f=n.m08,v=f*u-o*a,l=-f*h+o*c,d=a*h-u*c,w=r*v+s*l+e*d;return 0===w?(i.set(t,0,0,0,0,0,0,0,0,0),t):(w=1/w,t.m00=v*w,t.m01=(-f*s+e*a)*w,t.m02=(o*s-e*u)*w,t.m03=l*w,t.m04=(f*r-e*c)*w,t.m05=(-o*r+e*h)*w,t.m06=d*w,t.m07=(-a*r+s*c)*w,t.m08=(u*r-s*h)*w,t)},i.determinant=function(t){var i=t.m00,n=t.m01,r=t.m02,s=t.m03,e=t.m04,h=t.m05,u=t.m06,o=t.m07,c=t.m08;return i*(c*e-h*o)+n*(-c*s+h*u)+r*(o*s-e*u)},i.multiply=function(t,i,n){var r=i.m00,s=i.m01,e=i.m02,h=i.m03,u=i.m04,o=i.m05,c=i.m06,a=i.m07,f=i.m08,v=n.m00,l=n.m01,d=n.m02,w=n.m03,g=n.m04,p=n.m05,_=n.m06,y=n.m07,m=n.m08;return t.m00=v*r+l*h+d*c,t.m01=v*s+l*u+d*a,t.m02=v*e+l*o+d*f,t.m03=w*r+g*h+p*c,t.m04=w*s+g*u+p*a,t.m05=w*e+g*o+p*f,t.m06=_*r+y*h+m*c,t.m07=_*s+y*u+m*a,t.m08=_*e+y*o+m*f,t},i.multiplyMat4=function(t,i,n){var r=i.m00,s=i.m01,e=i.m02,h=i.m03,u=i.m04,o=i.m05,c=i.m06,a=i.m07,f=i.m08,v=n.m00,l=n.m01,d=n.m02,w=n.m04,g=n.m05,p=n.m06,_=n.m08,y=n.m09,m=n.m10;return t.m00=v*r+l*h+d*c,t.m01=v*s+l*u+d*a,t.m02=v*e+l*o+d*f,t.m03=w*r+g*h+p*c,t.m04=w*s+g*u+p*a,t.m05=w*e+g*o+p*f,t.m06=_*r+y*h+m*c,t.m07=_*s+y*u+m*a,t.m08=_*e+y*o+m*f,t},i.transform=function(t,i,n){this.translate(t,i,n)},i.translate=function(t,i,n){var r=i.m00,s=i.m01,e=i.m02,h=i.m03,u=i.m04,o=i.m05,c=i.m06,a=i.m07,f=i.m08,v=n.x,l=n.y;return t.m00=r,t.m01=s,t.m02=e,t.m03=h,t.m04=u,t.m05=o,t.m06=v*r+l*h+c,t.m07=v*s+l*u+a,t.m08=v*e+l*o+f,t},i.scale=function(t,i,n){var r=n.x,s=n.y;return t.m00=r*i.m00,t.m01=r*i.m01,t.m02=r*i.m02,t.m03=s*i.m03,t.m04=s*i.m04,t.m05=s*i.m05,t.m06=i.m06,t.m07=i.m07,t.m08=i.m08,t},i.rotate=function(t,i,n){var r=i.m00,s=i.m01,e=i.m02,h=i.m03,u=i.m04,o=i.m05,c=i.m06,a=i.m07,f=i.m08,v=Math.sin(n),l=Math.cos(n);return t.m00=l*r+v*h,t.m01=l*s+v*u,t.m02=l*e+v*o,t.m03=l*h-v*r,t.m04=l*u-v*s,t.m05=l*o-v*e,t.m06=c,t.m07=a,t.m08=f,t},i.fromMat4=function(t,i){return t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m04,t.m04=i.m05,t.m05=i.m06,t.m06=i.m08,t.m07=i.m09,t.m08=i.m10,t},i.fromViewUp=function(t,n,r){return Ir.lengthSqr(n)<Fn*Fn?(i.identity(t),t):(r=r||Ir.UNIT_Y,Ir.normalize(Fr,Ir.cross(Fr,r,n)),Ir.lengthSqr(Fr)<Fn*Fn?(i.identity(t),t):(Ir.cross(Ur,n,Fr),i.set(t,Fr.x,Fr.y,Fr.z,Ur.x,Ur.y,Ur.z,n.x,n.y,n.z),t))},i.fromTranslation=function(t,i){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=i.x,t.m07=i.y,t.m08=1,t},i.fromScaling=function(t,i){return t.m00=i.x,t.m01=0,t.m02=0,t.m03=0,t.m04=i.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},i.fromRotation=function(t,i){var n=Math.sin(i),r=Math.cos(i);return t.m00=r,t.m01=n,t.m02=0,t.m03=-n,t.m04=r,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},i.fromQuat=function(t,i){var n=i.x,r=i.y,s=i.z,e=i.w,h=n+n,u=r+r,o=s+s,c=n*h,a=r*h,f=r*u,v=s*h,l=s*u,d=s*o,w=e*h,g=e*u,p=e*o;return t.m00=1-f-d,t.m03=a-p,t.m06=v+g,t.m01=a+p,t.m04=1-c-d,t.m07=l-w,t.m02=v-g,t.m05=l+w,t.m08=1-c-f,t},i.inverseTransposeMat4=function(t,i){var n=i.m00,r=i.m01,s=i.m02,e=i.m03,h=i.m04,u=i.m05,o=i.m06,c=i.m07,a=i.m08,f=i.m09,v=i.m10,l=i.m11,d=i.m12,w=i.m13,g=i.m14,p=i.m15,_=n*u-r*h,y=n*o-s*h,m=n*c-e*h,b=r*o-s*u,k=r*c-e*u,A=s*c-e*o,E=a*w-f*d,T=a*g-v*d,O=a*p-l*d,S=f*g-v*w,I=f*p-l*w,R=v*p-l*g,M=_*R-y*I+m*S+b*O-k*T+A*E;return M?(M=1/M,t.m00=(u*R-o*I+c*S)*M,t.m01=(o*O-h*R-c*T)*M,t.m02=(h*I-u*O+c*E)*M,t.m03=(s*I-r*R-e*S)*M,t.m04=(n*R-s*O+e*T)*M,t.m05=(r*O-n*I-e*E)*M,t.m06=(w*A-g*k+p*b)*M,t.m07=(g*m-d*A-p*y)*M,t.m08=(d*k-w*m+p*_)*M,t):null},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.m00,t[n+1]=i.m01,t[n+2]=i.m02,t[n+3]=i.m03,t[n+4]=i.m04,t[n+5]=i.m05,t[n+6]=i.m06,t[n+7]=i.m07,t[n+8]=i.m08,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.m00=i[n+0],t.m01=i[n+1],t.m02=i[n+2],t.m03=i[n+3],t.m04=i[n+4],t.m05=i[n+5],t.m06=i[n+6],t.m07=i[n+7],t.m08=i[n+8],t},i.add=function(t,i,n){return t.m00=i.m00+n.m00,t.m01=i.m01+n.m01,t.m02=i.m02+n.m02,t.m03=i.m03+n.m03,t.m04=i.m04+n.m04,t.m05=i.m05+n.m05,t.m06=i.m06+n.m06,t.m07=i.m07+n.m07,t.m08=i.m08+n.m08,t},i.subtract=function(t,i,n){return t.m00=i.m00-n.m00,t.m01=i.m01-n.m01,t.m02=i.m02-n.m02,t.m03=i.m03-n.m03,t.m04=i.m04-n.m04,t.m05=i.m05-n.m05,t.m06=i.m06-n.m06,t.m07=i.m07-n.m07,t.m08=i.m08-n.m08,t},i.multiplyScalar=function(t,i,n){return t.m00=i.m00*n,t.m01=i.m01*n,t.m02=i.m02*n,t.m03=i.m03*n,t.m04=i.m04*n,t.m05=i.m05*n,t.m06=i.m06*n,t.m07=i.m07*n,t.m08=i.m08*n,t},i.multiplyScalarAndAdd=function(t,i,n,r){return t.m00=n.m00*r+i.m00,t.m01=n.m01*r+i.m01,t.m02=n.m02*r+i.m02,t.m03=n.m03*r+i.m03,t.m04=n.m04*r+i.m04,t.m05=n.m05*r+i.m05,t.m06=n.m06*r+i.m06,t.m07=n.m07*r+i.m07,t.m08=n.m08*r+i.m08,t},i.strictEquals=function(t,i){return t.m00===i.m00&&t.m01===i.m01&&t.m02===i.m02&&t.m03===i.m03&&t.m04===i.m04&&t.m05===i.m05&&t.m06===i.m06&&t.m07===i.m07&&t.m08===i.m08},i.equals=function(t,i,n){return void 0===n&&(n=Fn),Pr(t.m00-i.m00)<=n*Lr(1,Pr(t.m00),Pr(i.m00))&&Pr(t.m01-i.m01)<=n*Lr(1,Pr(t.m01),Pr(i.m01))&&Pr(t.m02-i.m02)<=n*Lr(1,Pr(t.m02),Pr(i.m02))&&Pr(t.m03-i.m03)<=n*Lr(1,Pr(t.m03),Pr(i.m03))&&Pr(t.m04-i.m04)<=n*Lr(1,Pr(t.m04),Pr(i.m04))&&Pr(t.m05-i.m05)<=n*Lr(1,Pr(t.m05),Pr(i.m05))&&Pr(t.m06-i.m06)<=n*Lr(1,Pr(t.m06),Pr(i.m06))&&Pr(t.m07-i.m07)<=n*Lr(1,Pr(t.m07),Pr(i.m07))&&Pr(t.m08-i.m08)<=n*Lr(1,Pr(t.m08),Pr(i.m08))},i.toEuler=function(t,i){var n=t.m00,r=t.m01;t.m02;var s=t.m03,e=t.m04;t.m05;var h=t.m06,u=t.m07,o=t.m08;return u<.999?u>-.999?(i.x=Math.asin(-u),i.y=Math.atan2(h,o),i.z=Math.atan2(r,e),!0):(i.x=Dn,i.y=Math.atan2(s,n),i.z=0,!1):(i.x=-Dn,i.y=Math.atan2(-s,n),i.z=0,!1)};var n=i.prototype;return n.clone=function(){return new i(this)},n.set=function(t,i,n,r,s,e,h,u,o){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=1);var c=this;return"object"==typeof t?(c.m00=t.m00,c.m01=t.m01,c.m02=t.m02,c.m03=t.m03,c.m04=t.m04,c.m05=t.m05,c.m06=t.m06,c.m07=t.m07,c.m08=t.m08):(c.m00=t,c.m01=i,c.m02=n,c.m03=r,c.m04=s,c.m05=e,c.m06=h,c.m07=u,c.m08=o),c},n.equals=function(t,n){return void 0===n&&(n=Fn),i.equals(this,t,n)},n.strictEquals=function(t){return i.strictEquals(this,t)},n.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+",\n"+t.m03+", "+t.m04+", "+t.m05+",\n"+t.m06+", "+t.m07+", "+t.m08+"\n]"},n.identity=function(){return i.identity(this)},n.transpose=function(){var t=this,i=t.m01,n=t.m02,r=t.m05;return t.m01=t.m03,t.m02=t.m06,t.m03=i,t.m05=t.m07,t.m06=n,t.m07=r,t},n.invert=function(){return i.invert(this,this)},n.determinant=function(){return i.determinant(this)},n.add=function(t){var i=this;return i.m00+=t.m00,i.m01+=t.m01,i.m02+=t.m02,i.m03+=t.m03,i.m04+=t.m04,i.m05+=t.m05,i.m06+=t.m06,i.m07+=t.m07,i.m08+=t.m08,i},n.subtract=function(t){var i=this;return i.m00-=t.m00,i.m01-=t.m01,i.m02-=t.m02,i.m03-=t.m03,i.m04-=t.m04,i.m05-=t.m05,i.m06-=t.m06,i.m07-=t.m07,i.m08-=t.m08,i},n.multiply=function(t){return i.multiply(this,this,t)},n.multiplyScalar=function(t){var i=this;return i.m00*=t,i.m01*=t,i.m02*=t,i.m03*=t,i.m04*=t,i.m05*=t,i.m06*=t,i.m07*=t,i.m08*=t,i},n.scale=function(t){var i=t.x,n=t.y,r=this;return r.m00*=i,r.m01*=i,r.m02*=i,r.m03*=n,r.m04*=n,r.m05*=n,r},n.rotate=function(t){var i=this,n=i.m00,r=i.m01,s=i.m02,e=i.m03,h=i.m04,u=i.m05,o=i.m06,c=i.m07,a=i.m08,f=Math.sin(t),v=Math.cos(t);return i.m00=v*n+f*e,i.m01=v*r+f*h,i.m02=v*s+f*u,i.m03=v*e-f*n,i.m04=v*h-f*r,i.m05=v*u-f*s,i.m06=o,i.m07=c,i.m08=a,i},n.fromQuat=function(t){var i=t.x,n=t.y,r=t.z,s=t.w,e=i+i,h=n+n,u=r+r,o=i*e,c=n*e,a=n*h,f=r*e,v=r*h,l=r*u,d=s*e,w=s*h,g=s*u,p=this;return p.m00=1-a-l,p.m03=c-g,p.m06=f+w,p.m01=c+g,p.m04=1-o-l,p.m07=v-d,p.m02=f-w,p.m05=v+d,p.m08=1-o-a,p},i}(ki));Cr=Dr,Dr.IDENTITY=Object.freeze(new Cr);var Br,Fr=new Ir,Ur=new Ir;Tn.fastDefine("cc.Mat3",Dr,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),O.Mat3=Dr;var Gr=Math.abs,jr=Math.max,Hr=Math.min,Vr=Math.PI,$r=Math.acos,zr=Math.sin,Wr=Math.cos,Xr=Math.sqrt,Yr=Math.atan2,Kr=Math.asin,qr=Math.sign,Qr=t("au",function(t){function i(i,n,r,s){var e;return e=t.call(this)||this,"object"==typeof i?(e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w):(e.x=i||0,e.y=n||0,e.z=r||0,e.w=null!=s?s:1),e}e(i,t),i.clone=function(t){return new i(t.x,t.y,t.z,t.w)},i.copy=function(t,i){return t.x=i.x,t.y=i.y,t.z=i.z,t.w=i.w,t},i.set=function(t,i,n,r,s){return t.x=i,t.y=n,t.z=r,t.w=s,t},i.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},i.rotationTo=function(t,n,r){var s=Ir.dot(n,r);return s<-.999999?(Ir.cross(is,Ir.UNIT_X,n),is.length()<1e-6&&Ir.cross(is,Ir.UNIT_Y,n),Ir.normalize(is,is),i.fromAxisAngle(t,is,Vr),t):s>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(Ir.cross(is,n,r),t.x=is.x,t.y=is.y,t.z=is.z,t.w=1+s,i.normalize(t,t))},i.getAxisAngle=function(t,i){var n=2*$r(i.w),r=zr(n/2);return 0!==r?(t.x=i.x/r,t.y=i.y/r,t.z=i.z/r):(t.x=1,t.y=0,t.z=0),n},i.multiply=function(t,i,n){var r=i.x*n.w+i.w*n.x+i.y*n.z-i.z*n.y,s=i.y*n.w+i.w*n.y+i.z*n.x-i.x*n.z,e=i.z*n.w+i.w*n.z+i.x*n.y-i.y*n.x,h=i.w*n.w-i.x*n.x-i.y*n.y-i.z*n.z;return t.x=r,t.y=s,t.z=e,t.w=h,t},i.multiplyScalar=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t.w=i.w*n,t},i.scaleAndAdd=function(t,i,n,r){return t.x=i.x+n.x*r,t.y=i.y+n.y*r,t.z=i.z+n.z*r,t.w=i.w+n.w*r,t},i.rotateX=function(t,i,n){var r=zr(n*=.5),s=Wr(n),e=i.x,h=i.y,u=i.z,o=i.w;return t.x=e*s+o*r,t.y=h*s+u*r,t.z=u*s-h*r,t.w=o*s-e*r,t},i.rotateY=function(t,i,n){var r=zr(n*=.5),s=Wr(n),e=i.x,h=i.y,u=i.z,o=i.w;return t.x=e*s-u*r,t.y=h*s+o*r,t.z=u*s+e*r,t.w=o*s-h*r,t},i.rotateZ=function(t,i,n){var r=zr(n*=.5),s=Wr(n),e=i.x,h=i.y,u=i.z,o=i.w;return t.x=e*s+h*r,t.y=h*s-e*r,t.z=u*s+o*r,t.w=o*s-u*r,t},i.rotateAround=function(t,n,r,s){return i.invert(Zr,n),Ir.transformQuat(is,r,Zr),i.fromAxisAngle(Zr,is,s),i.multiply(t,n,Zr),t},i.rotateAroundLocal=function(t,n,r,s){return i.fromAxisAngle(Zr,r,s),i.multiply(t,n,Zr),t},i.calculateW=function(t,i){return t.x=i.x,t.y=i.y,t.z=i.z,t.w=Xr(Gr(1-i.x*i.x-i.y*i.y-i.z*i.z)),t},i.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w},i.lerp=function(t,i,n,r){return t.x=i.x+r*(n.x-i.x),t.y=i.y+r*(n.y-i.y),t.z=i.z+r*(n.z-i.z),t.w=i.w+r*(n.w-i.w),t},i.slerp=function(t,i,n,r){var s=0,e=0,h=n.x,u=n.y,o=n.z,c=n.w,a=i.x*n.x+i.y*n.y+i.z*n.z+i.w*n.w;if(a<0&&(a=-a,h=-h,u=-u,o=-o,c=-c),1-a>1e-6){var f=$r(a),v=zr(f);s=zr((1-r)*f)/v,e=zr(r*f)/v}else s=1-r,e=r;return t.x=s*i.x+e*h,t.y=s*i.y+e*u,t.z=s*i.z+e*o,t.w=s*i.w+e*c,t},i.sqlerp=function(t,n,r,s,e,h){return i.slerp(Zr,n,e,h),i.slerp(ts,r,s,h),i.slerp(t,Zr,ts,2*h*(1-h)),t},i.invert=function(t,i){var n=i.x*i.x+i.y*i.y+i.z*i.z+i.w*i.w,r=n?1/n:0;return t.x=-i.x*r,t.y=-i.y*r,t.z=-i.z*r,t.w=i.w*r,t},i.conjugate=function(t,i){return t.x=-i.x,t.y=-i.y,t.z=-i.z,t.w=i.w,t},i.len=function(t){return Xr(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},i.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},i.normalize=function(t,i){var n=i.x*i.x+i.y*i.y+i.z*i.z+i.w*i.w;return n>0?(n=1/Xr(n),t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t.w=i.w*n):(t.x=0,t.y=0,t.z=0,t.w=0),t},i.fromAxes=function(t,n,r,s){return Dr.set(ns,n.x,n.y,n.z,r.x,r.y,r.z,s.x,s.y,s.z),i.normalize(t,i.fromMat3(t,ns))},i.fromViewUp=function(t,n,r){return Dr.fromViewUp(ns,n,r),i.normalize(t,i.fromMat3(t,ns))},i.fromAxisAngle=function(t,i,n){var r=zr(n*=.5);return t.x=r*i.x,t.y=r*i.y,t.z=r*i.z,t.w=Wr(n),t},i.fromMat3=function(t,i){var n=i.m00,r=i.m01,s=i.m02,e=i.m03,h=i.m04,u=i.m05,o=i.m06,c=i.m07,a=i.m08,f=n-h-a,v=h-n-a,l=a-n-h,d=0,w=n+h+a;f>w&&(w=f,d=1),v>w&&(w=v,d=2),l>w&&(w=l,d=3);var g=.5*Xr(w+1),p=.25/g;switch(d){case 0:t.w=g,t.x=(u-c)*p,t.y=(o-s)*p,t.z=(r-e)*p;break;case 1:t.w=(u-c)*p,t.x=g,t.y=(r+e)*p,t.z=(o+s)*p;break;case 2:t.w=(o-s)*p,t.x=(r+e)*p,t.y=g,t.z=(u+c)*p;break;case 3:t.w=(r-e)*p,t.x=(o+s)*p,t.y=(u+c)*p,t.z=g;break;default:t.w=1,t.x=0,t.y=0,t.z=0}return t},i.fromEuler=function(t,i,n,r){n*=rs,r*=rs;var s=zr(i*=rs),e=Wr(i),h=zr(n),u=Wr(n),o=zr(r),c=Wr(r);return t.x=s*u*c+e*h*o,t.y=e*h*c+s*u*o,t.z=e*u*o-s*h*c,t.w=e*u*c-s*h*o,t},i.fromAngleZ=function(t,i){return i*=rs,t.x=t.y=0,t.z=zr(i),t.w=Wr(i),t},i.toAxisX=function(t,i){var n=2*i.y,r=2*i.z;return t.x=1-n*i.y-r*i.z,t.y=n*i.x+r*i.w,t.z=r*i.x-n*i.w,t},i.toAxisY=function(t,i){var n=2*i.x,r=2*i.y,s=2*i.z;return t.x=r*i.x-s*i.w,t.y=1-n*i.x-s*i.z,t.z=s*i.y+n*i.w,t},i.toAxisZ=function(t,i){var n=2*i.x,r=2*i.y,s=2*i.z;return t.x=s*i.x+r*i.w,t.y=s*i.y-n*i.w,t.z=1-n*i.x-r*i.y,t},i.toEuler=function(t,i,n){var r=i.x,s=i.y,e=i.z,h=i.w,u=0,o=0,c=0,a=r*s+e*h;if(a>.499999)u=0,o=$n(2*Yr(r,h)),c=90;else if(a<-.499999)u=0,o=-$n(2*Yr(r,h)),c=-90;else{var f=s*s,v=e*e;u=$n(Yr(2*r*h-2*s*e,1-r*r*2-2*v)),o=$n(Yr(2*s*h-2*r*e,1-2*f-2*v)),c=$n(Kr(2*a)),n&&(u=-180*qr(u+1e-6)+u,o=-180*qr(o+1e-6)+o,c=180*qr(c+1e-6)-c)}return t.x=u,t.y=o,t.z=c,t},i.toEulerInYXZOrder=function(t,i){Dr.fromQuat(ns,i),Dr.toEuler(ns,t),t.x=$n(t.x),t.y=$n(t.y),t.z=$n(t.z)},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.x,t[n+1]=i.y,t[n+2]=i.z,t[n+3]=i.w,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.w=i[n+3],t},i.strictEquals=function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z&&t.w===i.w},i.equals=function(t,i,n){return void 0===n&&(n=Fn),Gr(t.x-i.x)<=n*jr(1,Gr(t.x),Gr(i.x))&&Gr(t.y-i.y)<=n*jr(1,Gr(t.y),Gr(i.y))&&Gr(t.z-i.z)<=n*jr(1,Gr(t.z),Gr(i.z))&&Gr(t.w-i.w)<=n*jr(1,Gr(t.w),Gr(i.w))},i.angle=function(t,n){var r=Hr(Gr(i.dot(t,n)),1);return 2*$r(r)},i.rotateTowards=function(t,n,r,s){var e=i.angle(n,r);if(0===e)return t.x=r.x,t.y=r.y,t.z=r.z,t.w=r.w,t;var h=Hr(s/$n(e),1);return i.slerp(t,n,r,h)};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y,this.z,this.w)},n.set=function(t,i,n,r){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=i||0,this.z=n||0,this.w=null!=r?r:1),this},n.equals=function(t,n){return void 0===n&&(n=Fn),i.equals(this,t,n)},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.getEulerAngles=function(t){return i.toEuler(t,this)},n.lerp=function(t,i){var n=this;return n.x+=i*(t.x-n.x),n.y+=i*(t.y-n.y),n.z+=i*(t.z-n.z),n.w+=i*(t.w-n.w),n},n.slerp=function(t,n){return i.slerp(this,this,t,n)},n.length=function(){var t=this,i=t.x,n=t.y,r=t.z,s=t.w;return Xr(i*i+n*n+r*r+s*s)},n.lengthSqr=function(){var t=this,i=t.x,n=t.y,r=t.z,s=t.w;return i*i+n*n+r*r+s*s},n.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},i}(ki));Br=Qr,Qr.IDENTITY=Object.freeze(new Br);var Jr,Zr=new Qr,ts=new Qr,is=new Ir,ns=new Dr,rs=.5*Vr/180;function ss(t,i,n,r){return void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),new Qr(t,i,n,r)}Tn.fastDefine("cc.Quat",Qr,{x:0,y:0,z:0,w:1}),O.Quat=Qr,O.quat=ss;var es=Object.freeze,hs=t("aF",es([es([1,0,0,1]),es([0,1,-1,0]),es([-1,0,0,-1]),es([0,-1,1,0])])),us=Math.abs,os=Math.max,cs=Math.sqrt,as=Math.sin,fs=Math.cos,vs=Math.tan,ls=t("ax",function(t){function i(i,n,r,s,e,h,u,o,c,a,f,l,d,w,g,p){var _;void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=0),void 0===a&&(a=0),void 0===f&&(f=1),void 0===l&&(l=0),void 0===d&&(d=0),void 0===w&&(w=0),void 0===g&&(g=0),void 0===p&&(p=1);var y=v(_=t.call(this)||this);return"object"==typeof i?(y.m00=i.m00,_.m01=i.m01,_.m02=i.m02,_.m03=i.m03,y.m04=i.m04,_.m05=i.m05,_.m06=i.m06,_.m07=i.m07,y.m08=i.m08,_.m09=i.m09,_.m10=i.m10,_.m11=i.m11,y.m12=i.m12,_.m13=i.m13,_.m14=i.m14,_.m15=i.m15):(y.m00=i,_.m01=n,_.m02=r,_.m03=s,y.m04=e,_.m05=h,_.m06=u,_.m07=o,y.m08=c,_.m09=a,_.m10=f,_.m11=l,y.m12=d,_.m13=w,_.m14=g,_.m15=p),_}e(i,t),i.clone=function(t){return new i(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)},i.copy=function(t,i){return t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m03,t.m04=i.m04,t.m05=i.m05,t.m06=i.m06,t.m07=i.m07,t.m08=i.m08,t.m09=i.m09,t.m10=i.m10,t.m11=i.m11,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15,t},i.set=function(t,i,n,r,s,e,h,u,o,c,a,f,v,l,d,w,g){return t.m00=i,t.m01=n,t.m02=r,t.m03=s,t.m04=e,t.m05=h,t.m06=u,t.m07=o,t.m08=c,t.m09=a,t.m10=f,t.m11=v,t.m12=l,t.m13=d,t.m14=w,t.m15=g,t},i.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},i.zero=function(t){return t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t},i.transpose=function(t,i){if(t===i){var n=i.m01,r=i.m02,s=i.m03,e=i.m06,h=i.m07,u=i.m11;t.m01=i.m04,t.m02=i.m08,t.m03=i.m12,t.m04=n,t.m06=i.m09,t.m07=i.m13,t.m08=r,t.m09=e,t.m11=i.m14,t.m12=s,t.m13=h,t.m14=u}else t.m00=i.m00,t.m01=i.m04,t.m02=i.m08,t.m03=i.m12,t.m04=i.m01,t.m05=i.m05,t.m06=i.m09,t.m07=i.m13,t.m08=i.m02,t.m09=i.m06,t.m10=i.m10,t.m11=i.m14,t.m12=i.m03,t.m13=i.m07,t.m14=i.m11,t.m15=i.m15;return t},i.invert=function(t,n){var r=n.m00,s=n.m01,e=n.m02,h=n.m03,u=n.m04,o=n.m05,c=n.m06,a=n.m07,f=n.m08,v=n.m09,l=n.m10,d=n.m11,w=n.m12,g=n.m13,p=n.m14,_=n.m15,y=r*o-s*u,m=r*c-e*u,b=r*a-h*u,k=s*c-e*o,A=s*a-h*o,E=e*a-h*c,T=f*g-v*w,O=f*p-l*w,S=f*_-d*w,I=v*p-l*g,R=v*_-d*g,M=l*_-d*p,C=y*M-m*R+b*I+k*S-A*O+E*T;return 0===C?i.zero(t):(C=1/C,t.m00=(o*M-c*R+a*I)*C,t.m01=(e*R-s*M-h*I)*C,t.m02=(g*E-p*A+_*k)*C,t.m03=(l*A-v*E-d*k)*C,t.m04=(c*S-u*M-a*O)*C,t.m05=(r*M-e*S+h*O)*C,t.m06=(p*b-w*E-_*m)*C,t.m07=(f*E-l*b+d*m)*C,t.m08=(u*R-o*S+a*T)*C,t.m09=(s*S-r*R-h*T)*C,t.m10=(w*A-g*b+_*y)*C,t.m11=(v*b-f*A-d*y)*C,t.m12=(o*O-u*I-c*T)*C,t.m13=(r*I-s*O+e*T)*C,t.m14=(g*m-w*k-p*y)*C,t.m15=(f*k-v*m+l*y)*C,t)},i.determinant=function(t){var i=t.m00,n=t.m01,r=t.m02,s=t.m03,e=t.m04,h=t.m05,u=t.m06,o=t.m07,c=t.m08,a=t.m09,f=t.m10,v=t.m11,l=t.m12,d=t.m13,w=t.m14,g=t.m15;return(i*h-n*e)*(f*g-v*w)-(i*u-r*e)*(a*g-v*d)+(i*o-s*e)*(a*w-f*d)+(n*u-r*h)*(c*g-v*l)-(n*o-s*h)*(c*w-f*l)+(r*o-s*u)*(c*d-a*l)},i.multiply=function(t,i,n){var r=i.m00,s=i.m01,e=i.m02,h=i.m03,u=i.m04,o=i.m05,c=i.m06,a=i.m07,f=i.m08,v=i.m09,l=i.m10,d=i.m11,w=i.m12,g=i.m13,p=i.m14,_=i.m15,y=n.m00,m=n.m01,b=n.m02,k=n.m03;return t.m00=y*r+m*u+b*f+k*w,t.m01=y*s+m*o+b*v+k*g,t.m02=y*e+m*c+b*l+k*p,t.m03=y*h+m*a+b*d+k*_,y=n.m04,m=n.m05,b=n.m06,k=n.m07,t.m04=y*r+m*u+b*f+k*w,t.m05=y*s+m*o+b*v+k*g,t.m06=y*e+m*c+b*l+k*p,t.m07=y*h+m*a+b*d+k*_,y=n.m08,m=n.m09,b=n.m10,k=n.m11,t.m08=y*r+m*u+b*f+k*w,t.m09=y*s+m*o+b*v+k*g,t.m10=y*e+m*c+b*l+k*p,t.m11=y*h+m*a+b*d+k*_,y=n.m12,m=n.m13,b=n.m14,k=n.m15,t.m12=y*r+m*u+b*f+k*w,t.m13=y*s+m*o+b*v+k*g,t.m14=y*e+m*c+b*l+k*p,t.m15=y*h+m*a+b*d+k*_,t},i.transform=function(t,i,n){var r=n.x,s=n.y,e=n.z;if(i===t)t.m12=i.m00*r+i.m04*s+i.m08*e+i.m12,t.m13=i.m01*r+i.m05*s+i.m09*e+i.m13,t.m14=i.m02*r+i.m06*s+i.m10*e+i.m14,t.m15=i.m03*r+i.m07*s+i.m11*e+i.m15;else{var h=i.m00,u=i.m01,o=i.m02,c=i.m03,a=i.m04,f=i.m05,v=i.m06,l=i.m07,d=i.m08,w=i.m09,g=i.m10,p=i.m11;t.m00=h,t.m01=u,t.m02=o,t.m03=c,t.m04=a,t.m05=f,t.m06=v,t.m07=l,t.m08=d,t.m09=w,t.m10=g,t.m11=p,t.m12=h*r+a*s+d*e+i.m12,t.m13=u*r+f*s+w*e+i.m13,t.m14=o*r+v*s+g*e+i.m14,t.m15=c*r+l*s+p*e+i.m15}return t},i.translate=function(t,i,n){return i===t?(t.m12+=n.x,t.m13+=n.y,t.m14+=n.z):(t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m03,t.m04=i.m04,t.m05=i.m05,t.m06=i.m06,t.m07=i.m07,t.m08=i.m08,t.m09=i.m09,t.m10=i.m10,t.m11=i.m11,t.m12=i.m12+n.x,t.m13=i.m13+n.y,t.m14=i.m14+n.z,t.m15=i.m15),t},i.scale=function(t,i,n){var r=n.x,s=n.y,e=n.z;return t.m00=i.m00*r,t.m01=i.m01*r,t.m02=i.m02*r,t.m03=i.m03*r,t.m04=i.m04*s,t.m05=i.m05*s,t.m06=i.m06*s,t.m07=i.m07*s,t.m08=i.m08*e,t.m09=i.m09*e,t.m10=i.m10*e,t.m11=i.m11*e,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15,t},i.rotate=function(t,i,n,r){var s=r.x,e=r.y,h=r.z,u=cs(s*s+e*e+h*h);if(us(u)<Fn)return null;s*=u=1/u,e*=u,h*=u;var o=as(n),c=fs(n),a=1-c,f=i.m00,v=i.m01,l=i.m02,d=i.m03,w=i.m04,g=i.m05,p=i.m06,_=i.m07,y=i.m08,m=i.m09,b=i.m10,k=i.m11,A=s*s*a+c,E=e*s*a+h*o,T=h*s*a-e*o,O=s*e*a-h*o,S=e*e*a+c,I=h*e*a+s*o,R=s*h*a+e*o,M=e*h*a-s*o,C=h*h*a+c;return t.m00=f*A+w*E+y*T,t.m01=v*A+g*E+m*T,t.m02=l*A+p*E+b*T,t.m03=d*A+_*E+k*T,t.m04=f*O+w*S+y*I,t.m05=v*O+g*S+m*I,t.m06=l*O+p*S+b*I,t.m07=d*O+_*S+k*I,t.m08=f*R+w*M+y*C,t.m09=v*R+g*M+m*C,t.m10=l*R+p*M+b*C,t.m11=d*R+_*M+k*C,i!==t&&(t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15),t},i.rotateX=function(t,i,n){var r=as(n),s=fs(n),e=i.m04,h=i.m05,u=i.m06,o=i.m07,c=i.m08,a=i.m09,f=i.m10,v=i.m11;return i!==t&&(t.m00=i.m00,t.m01=i.m01,t.m02=i.m02,t.m03=i.m03,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15),t.m04=e*s+c*r,t.m05=h*s+a*r,t.m06=u*s+f*r,t.m07=o*s+v*r,t.m08=c*s-e*r,t.m09=a*s-h*r,t.m10=f*s-u*r,t.m11=v*s-o*r,t},i.rotateY=function(t,i,n){var r=as(n),s=fs(n),e=i.m00,h=i.m01,u=i.m02,o=i.m03,c=i.m08,a=i.m09,f=i.m10,v=i.m11;return i!==t&&(t.m04=i.m04,t.m05=i.m05,t.m06=i.m06,t.m07=i.m07,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15),t.m00=e*s-c*r,t.m01=h*s-a*r,t.m02=u*s-f*r,t.m03=o*s-v*r,t.m08=e*r+c*s,t.m09=h*r+a*s,t.m10=u*r+f*s,t.m11=o*r+v*s,t},i.rotateZ=function(t,i,n){var r=as(n),s=fs(n),e=i.m00,h=i.m01,u=i.m02,o=i.m03,c=i.m04,a=i.m05,f=i.m06,v=i.m07;return i!==t&&(t.m08=i.m08,t.m09=i.m09,t.m10=i.m10,t.m11=i.m11,t.m12=i.m12,t.m13=i.m13,t.m14=i.m14,t.m15=i.m15),t.m00=e*s+c*r,t.m01=h*s+a*r,t.m02=u*s+f*r,t.m03=o*s+v*r,t.m04=c*s-e*r,t.m05=a*s-h*r,t.m06=f*s-u*r,t.m07=v*s-o*r,t},i.fromTranslation=function(t,n){return i.identity(t),t.m12=n.x,t.m13=n.y,t.m14=n.z,t},i.fromScaling=function(t,n){return i.identity(t),t.m00=n.x,t.m05=n.y,t.m10=n.z,t},i.fromRotation=function(t,i,n){var r=n.x,s=n.y,e=n.z,h=cs(r*r+s*s+e*e);if(us(h)<Fn)return null;r*=h=1/h,s*=h,e*=h;var u=as(i),o=fs(i),c=1-o;return t.m00=r*r*c+o,t.m01=s*r*c+e*u,t.m02=e*r*c-s*u,t.m03=0,t.m04=r*s*c-e*u,t.m05=s*s*c+o,t.m06=e*s*c+r*u,t.m07=0,t.m08=r*e*c+s*u,t.m09=s*e*c-r*u,t.m10=e*e*c+o,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},i.fromXRotation=function(t,n){var r=as(n),s=fs(n);return i.identity(t),t.m05=s,t.m06=r,t.m09=-r,t.m10=s,t},i.fromYRotation=function(t,n){var r=as(n),s=fs(n);return i.identity(t),t.m00=s,t.m02=-r,t.m08=r,t.m10=s,t},i.fromZRotation=function(t,n){var r=as(n),s=fs(n);return i.identity(t),t.m00=s,t.m01=r,t.m04=-r,t.m05=s,t},i.fromRT=function(t,i,n){var r=i.x,s=i.y,e=i.z,h=i.w,u=r+r,o=s+s,c=e+e,a=r*u,f=r*o,v=r*c,l=s*o,d=s*c,w=e*c,g=h*u,p=h*o,_=h*c;return t.m00=1-(l+w),t.m01=f+_,t.m02=v-p,t.m03=0,t.m04=f-_,t.m05=1-(a+w),t.m06=d+g,t.m07=0,t.m08=v+p,t.m09=d-g,t.m10=1-(a+l),t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},i.getTranslation=function(t,i){return t.x=i.m12,t.y=i.m13,t.z=i.m14,t},i.getScaling=function(t,i){var n=ws.m00=i.m00,r=ws.m01=i.m01,s=ws.m02=i.m02,e=ws.m03=i.m04,h=ws.m04=i.m05,u=ws.m05=i.m06,o=ws.m06=i.m08,c=ws.m07=i.m09,a=ws.m08=i.m10;return t.x=cs(n*n+r*r+s*s),t.y=cs(e*e+h*h+u*u),t.z=cs(o*o+c*c+a*a),Dr.determinant(ws)<0&&(t.x*=-1),t},i.getRotation=function(t,i){var n=i.m00+i.m05+i.m10,r=0;return n>0?(r=2*cs(n+1),t.w=.25*r,t.x=(i.m06-i.m09)/r,t.y=(i.m08-i.m02)/r,t.z=(i.m01-i.m04)/r):i.m00>i.m05&&i.m00>i.m10?(r=2*cs(1+i.m00-i.m05-i.m10),t.w=(i.m06-i.m09)/r,t.x=.25*r,t.y=(i.m01+i.m04)/r,t.z=(i.m08+i.m02)/r):i.m05>i.m10?(r=2*cs(1+i.m05-i.m00-i.m10),t.w=(i.m08-i.m02)/r,t.x=(i.m01+i.m04)/r,t.y=.25*r,t.z=(i.m06+i.m09)/r):(r=2*cs(1+i.m10-i.m00-i.m05),t.w=(i.m01-i.m04)/r,t.x=(i.m08+i.m02)/r,t.y=(i.m06+i.m09)/r,t.z=.25*r),t},i.toRTS=function(t,n,r,s){i.toSRT(t,n,r,s)},i.toSRT=function(t,i,n,r){n&&Ir.set(n,t.m12,t.m13,t.m14);var s=Ir.set(ds,t.m00,t.m01,t.m02).length(),e=Ir.set(ds,t.m04,t.m05,t.m06).length(),h=Ir.set(ds,t.m08,t.m09,t.m10).length();if(r&&(r.x=s,r.y=e,r.z=h),0!==s&&0!==e&&0!==h){ws.m00=t.m00/s,ws.m01=t.m01/s,ws.m02=t.m02/s,ws.m03=t.m04/e,ws.m04=t.m05/e,ws.m05=t.m06/e,ws.m06=t.m08/h,ws.m07=t.m09/h,ws.m08=t.m10/h;var u=Dr.determinant(ws);r&&u<0&&(r.x*=-1),i&&(u<0&&(ws.m00*=-1,ws.m01*=-1,ws.m02*=-1),Qr.fromMat3(i,ws))}else i&&Qr.identity(i)},i.toEuler=function(t,i){return Dr.set(ws,t.m00,t.m01,t.m02,t.m04,t.m05,t.m06,t.m08,t.m09,t.m10),Dr.toEuler(ws,i)},i.fromRTS=function(t,n,r,s){return i.fromSRT(t,n,r,s)},i.fromSRT=function(t,i,n,r){var s=i.x,e=i.y,h=i.z,u=i.w,o=s+s,c=e+e,a=h+h,f=s*o,v=s*c,l=s*a,d=e*c,w=e*a,g=h*a,p=u*o,_=u*c,y=u*a,m=r.x,b=r.y,k=r.z;return t.m00=(1-(d+g))*m,t.m01=(v+y)*m,t.m02=(l-_)*m,t.m03=0,t.m04=(v-y)*b,t.m05=(1-(f+g))*b,t.m06=(w+p)*b,t.m07=0,t.m08=(l+_)*k,t.m09=(w-p)*k,t.m10=(1-(f+d))*k,t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},i.fromRTSOrigin=function(t,n,r,s,e){return i.fromSRTOrigin(t,n,r,s,e)},i.fromSRTOrigin=function(t,i,n,r,s){var e=i.x,h=i.y,u=i.z,o=i.w,c=e+e,a=h+h,f=u+u,v=e*c,l=e*a,d=e*f,w=h*a,g=h*f,p=u*f,_=o*c,y=o*a,m=o*f,b=r.x,k=r.y,A=r.z,E=s.x,T=s.y,O=s.z;return t.m00=(1-(w+p))*b,t.m01=(l+m)*b,t.m02=(d-y)*b,t.m03=0,t.m04=(l-m)*k,t.m05=(1-(v+p))*k,t.m06=(g+_)*k,t.m07=0,t.m08=(d+y)*A,t.m09=(g-_)*A,t.m10=(1-(v+w))*A,t.m11=0,t.m12=n.x+E-(t.m00*E+t.m04*T+t.m08*O),t.m13=n.y+T-(t.m01*E+t.m05*T+t.m09*O),t.m14=n.z+O-(t.m02*E+t.m06*T+t.m10*O),t.m15=1,t},i.fromQuat=function(t,i){var n=i.x,r=i.y,s=i.z,e=i.w,h=n+n,u=r+r,o=s+s,c=n*h,a=r*h,f=r*u,v=s*h,l=s*u,d=s*o,w=e*h,g=e*u,p=e*o;return t.m00=1-f-d,t.m01=a+p,t.m02=v-g,t.m03=0,t.m04=a-p,t.m05=1-c-d,t.m06=l+w,t.m07=0,t.m08=v+g,t.m09=l-w,t.m10=1-c-f,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},i.frustum=function(t,i,n,r,s,e,h){var u=1/(n-i),o=1/(s-r),c=1/(e-h);return t.m00=2*e*u,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*e*o,t.m06=0,t.m07=0,t.m08=(n+i)*u,t.m09=(s+r)*o,t.m10=(h+e)*c,t.m11=-1,t.m12=0,t.m13=0,t.m14=h*e*2*c,t.m15=0,t},i.perspective=function(t,i,n,r,s,e,h,u,o){void 0===e&&(e=!0),void 0===h&&(h=-1),void 0===u&&(u=1),void 0===o&&(o=0);var c=1/vs(i/2),a=1/(r-s),f=e?c/n:c,v=(e?c:c*n)*u,l=hs[o];return t.m00=f*l[0],t.m01=f*l[1],t.m02=0,t.m03=0,t.m04=v*l[2],t.m05=v*l[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(s-h*r)*a,t.m11=-1,t.m12=0,t.m13=0,t.m14=s*r*a*(1-h),t.m15=0,t},i.ortho=function(t,i,n,r,s,e,h,u,o,c){void 0===u&&(u=-1),void 0===o&&(o=1),void 0===c&&(c=0);var a=1/(i-n),f=1/(r-s)*o,v=1/(e-h),l=-2*a,d=-2*f,w=(i+n)*a,g=(s+r)*f,p=hs[c];return t.m00=l*p[0],t.m01=l*p[1],t.m02=0,t.m03=0,t.m04=d*p[2],t.m05=d*p[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=v*(1-u),t.m11=0,t.m12=w*p[0]+g*p[2],t.m13=w*p[1]+g*p[3],t.m14=(e-u*h)*v,t.m15=1,t},i.lookAt=function(t,i,n,r){var s=i.x,e=i.y,h=i.z,u=r.x,o=r.y,c=r.z,a=s-n.x,f=e-n.y,v=h-n.z,l=1/cs(a*a+f*f+v*v),d=o*(v*=l)-c*(f*=l),w=c*(a*=l)-u*v,g=u*f-o*a,p=f*(g*=l=1/cs(d*d+w*w+g*g))-v*(w*=l),_=v*(d*=l)-a*g,y=a*w-f*d;return t.m00=d,t.m01=p,t.m02=a,t.m03=0,t.m04=w,t.m05=_,t.m06=f,t.m07=0,t.m08=g,t.m09=y,t.m10=v,t.m11=0,t.m12=-(d*s+w*e+g*h),t.m13=-(p*s+_*e+y*h),t.m14=-(a*s+f*e+v*h),t.m15=1,t},i.inverseTranspose=function(t,i){var n=i.m00,r=i.m01,s=i.m02,e=i.m03,h=i.m04,u=i.m05,o=i.m06,c=i.m07,a=i.m08,f=i.m09,v=i.m10,l=i.m11,d=i.m12,w=i.m13,g=i.m14,p=i.m15,_=n*u-r*h,y=n*o-s*h,m=n*c-e*h,b=r*o-s*u,k=r*c-e*u,A=s*c-e*o,E=a*w-f*d,T=a*g-v*d,O=a*p-l*d,S=f*g-v*w,I=f*p-l*w,R=v*p-l*g,M=_*R-y*I+m*S+b*O-k*T+A*E;return M?(M=1/M,t.m00=(u*R-o*I+c*S)*M,t.m01=(o*O-h*R-c*T)*M,t.m02=(h*I-u*O+c*E)*M,t.m03=0,t.m04=(s*I-r*R-e*S)*M,t.m05=(n*R-s*O+e*T)*M,t.m06=(r*O-n*I-e*E)*M,t.m07=0,t.m08=(w*A-g*k+p*b)*M,t.m09=(g*m-d*A-p*y)*M,t.m10=(d*k-w*m+p*_)*M,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.m00,t[n+1]=i.m01,t[n+2]=i.m02,t[n+3]=i.m03,t[n+4]=i.m04,t[n+5]=i.m05,t[n+6]=i.m06,t[n+7]=i.m07,t[n+8]=i.m08,t[n+9]=i.m09,t[n+10]=i.m10,t[n+11]=i.m11,t[n+12]=i.m12,t[n+13]=i.m13,t[n+14]=i.m14,t[n+15]=i.m15,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.m00=i[n+0],t.m01=i[n+1],t.m02=i[n+2],t.m03=i[n+3],t.m04=i[n+4],t.m05=i[n+5],t.m06=i[n+6],t.m07=i[n+7],t.m08=i[n+8],t.m09=i[n+9],t.m10=i[n+10],t.m11=i[n+11],t.m12=i[n+12],t.m13=i[n+13],t.m14=i[n+14],t.m15=i[n+15],t},i.add=function(t,i,n){return t.m00=i.m00+n.m00,t.m01=i.m01+n.m01,t.m02=i.m02+n.m02,t.m03=i.m03+n.m03,t.m04=i.m04+n.m04,t.m05=i.m05+n.m05,t.m06=i.m06+n.m06,t.m07=i.m07+n.m07,t.m08=i.m08+n.m08,t.m09=i.m09+n.m09,t.m10=i.m10+n.m10,t.m11=i.m11+n.m11,t.m12=i.m12+n.m12,t.m13=i.m13+n.m13,t.m14=i.m14+n.m14,t.m15=i.m15+n.m15,t},i.subtract=function(t,i,n){return t.m00=i.m00-n.m00,t.m01=i.m01-n.m01,t.m02=i.m02-n.m02,t.m03=i.m03-n.m03,t.m04=i.m04-n.m04,t.m05=i.m05-n.m05,t.m06=i.m06-n.m06,t.m07=i.m07-n.m07,t.m08=i.m08-n.m08,t.m09=i.m09-n.m09,t.m10=i.m10-n.m10,t.m11=i.m11-n.m11,t.m12=i.m12-n.m12,t.m13=i.m13-n.m13,t.m14=i.m14-n.m14,t.m15=i.m15-n.m15,t},i.multiplyScalar=function(t,i,n){return t.m00=i.m00*n,t.m01=i.m01*n,t.m02=i.m02*n,t.m03=i.m03*n,t.m04=i.m04*n,t.m05=i.m05*n,t.m06=i.m06*n,t.m07=i.m07*n,t.m08=i.m08*n,t.m09=i.m09*n,t.m10=i.m10*n,t.m11=i.m11*n,t.m12=i.m12*n,t.m13=i.m13*n,t.m14=i.m14*n,t.m15=i.m15*n,t},i.multiplyScalarAndAdd=function(t,i,n,r){return t.m00=i.m00+n.m00*r,t.m01=i.m01+n.m01*r,t.m02=i.m02+n.m02*r,t.m03=i.m03+n.m03*r,t.m04=i.m04+n.m04*r,t.m05=i.m05+n.m05*r,t.m06=i.m06+n.m06*r,t.m07=i.m07+n.m07*r,t.m08=i.m08+n.m08*r,t.m09=i.m09+n.m09*r,t.m10=i.m10+n.m10*r,t.m11=i.m11+n.m11*r,t.m12=i.m12+n.m12*r,t.m13=i.m13+n.m13*r,t.m14=i.m14+n.m14*r,t.m15=i.m15+n.m15*r,t},i.strictEquals=function(t,i){return t.m00===i.m00&&t.m01===i.m01&&t.m02===i.m02&&t.m03===i.m03&&t.m04===i.m04&&t.m05===i.m05&&t.m06===i.m06&&t.m07===i.m07&&t.m08===i.m08&&t.m09===i.m09&&t.m10===i.m10&&t.m11===i.m11&&t.m12===i.m12&&t.m13===i.m13&&t.m14===i.m14&&t.m15===i.m15},i.equals=function(t,i,n){return void 0===n&&(n=Fn),us(t.m00-i.m00)<=n*os(1,us(t.m00),us(i.m00))&&us(t.m01-i.m01)<=n*os(1,us(t.m01),us(i.m01))&&us(t.m02-i.m02)<=n*os(1,us(t.m02),us(i.m02))&&us(t.m03-i.m03)<=n*os(1,us(t.m03),us(i.m03))&&us(t.m04-i.m04)<=n*os(1,us(t.m04),us(i.m04))&&us(t.m05-i.m05)<=n*os(1,us(t.m05),us(i.m05))&&us(t.m06-i.m06)<=n*os(1,us(t.m06),us(i.m06))&&us(t.m07-i.m07)<=n*os(1,us(t.m07),us(i.m07))&&us(t.m08-i.m08)<=n*os(1,us(t.m08),us(i.m08))&&us(t.m09-i.m09)<=n*os(1,us(t.m09),us(i.m09))&&us(t.m10-i.m10)<=n*os(1,us(t.m10),us(i.m10))&&us(t.m11-i.m11)<=n*os(1,us(t.m11),us(i.m11))&&us(t.m12-i.m12)<=n*os(1,us(t.m12),us(i.m12))&&us(t.m13-i.m13)<=n*os(1,us(t.m13),us(i.m13))&&us(t.m14-i.m14)<=n*os(1,us(t.m14),us(i.m14))&&us(t.m15-i.m15)<=n*os(1,us(t.m15),us(i.m15))};var n=i.prototype;return n.clone=function(){return new i(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(t,i,n,r,s,e,h,u,o,c,a,f,v,l,d,w){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=1),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=0),void 0===a&&(a=1),void 0===f&&(f=0),void 0===v&&(v=0),void 0===l&&(l=0),void 0===d&&(d=0),void 0===w&&(w=1);var g=this;return"object"==typeof t?(g.m01=t.m01,g.m02=t.m02,g.m03=t.m03,g.m04=t.m04,g.m05=t.m05,g.m06=t.m06,g.m07=t.m07,g.m08=t.m08,g.m09=t.m09,g.m10=t.m10,g.m11=t.m11,g.m12=t.m12,g.m13=t.m13,g.m14=t.m14,g.m15=t.m15,g.m00=t.m00):(g.m01=i,g.m02=n,g.m03=r,g.m04=s,g.m05=e,g.m06=h,g.m07=u,g.m08=o,g.m09=c,g.m10=a,g.m11=f,g.m12=v,g.m13=l,g.m14=d,g.m15=w,g.m00=t),g},n.equals=function(t,i){void 0===i&&(i=Fn);var n=1/0,r=this,s=r.m00,e=r.m01,h=r.m02,u=r.m03,o=r.m04,c=r.m05,a=r.m06,f=r.m07,v=r.m08,l=r.m09,d=r.m10,w=r.m11,g=r.m12,p=r.m13,_=r.m14,y=r.m15;return!(us(s)===n||us(e)===n||us(h)===n||us(u)===n||us(o)===n||us(c)===n||us(a)===n||us(f)===n||us(v)===n||us(l)===n||us(d)===n||us(w)===n||us(g)===n||us(p)===n||us(_)===n||us(y)===n)&&us(s-t.m00)<=i*os(1,us(s),us(t.m00))&&us(e-t.m01)<=i*os(1,us(e),us(t.m01))&&us(h-t.m02)<=i*os(1,us(h),us(t.m02))&&us(u-t.m03)<=i*os(1,us(u),us(t.m03))&&us(o-t.m04)<=i*os(1,us(o),us(t.m04))&&us(c-t.m05)<=i*os(1,us(c),us(t.m05))&&us(a-t.m06)<=i*os(1,us(a),us(t.m06))&&us(f-t.m07)<=i*os(1,us(f),us(t.m07))&&us(v-t.m08)<=i*os(1,us(v),us(t.m08))&&us(l-t.m09)<=i*os(1,us(l),us(t.m09))&&us(d-t.m10)<=i*os(1,us(d),us(t.m10))&&us(w-t.m11)<=i*os(1,us(w),us(t.m11))&&us(g-t.m12)<=i*os(1,us(g),us(t.m12))&&us(p-t.m13)<=i*os(1,us(p),us(t.m13))&&us(_-t.m14)<=i*os(1,us(_),us(t.m14))&&us(y-t.m15)<=i*os(1,us(y),us(t.m15))},n.strictEquals=function(t){var i=this;return i.m00===t.m00&&i.m01===t.m01&&i.m02===t.m02&&i.m03===t.m03&&i.m04===t.m04&&i.m05===t.m05&&i.m06===t.m06&&i.m07===t.m07&&i.m08===t.m08&&i.m09===t.m09&&i.m10===t.m10&&i.m11===t.m11&&i.m12===t.m12&&i.m13===t.m13&&i.m14===t.m14&&i.m15===t.m15},n.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+", "+t.m03+",\n"+t.m04+", "+t.m05+", "+t.m06+", "+t.m07+",\n"+t.m08+", "+t.m09+", "+t.m10+", "+t.m11+",\n"+t.m12+", "+t.m13+", "+t.m14+", "+t.m15+"\n]"},n.identity=function(){return i.identity(this)},n.zero=function(){return i.zero(this)},n.transpose=function(){var t=this,i=t.m01,n=t.m02,r=t.m03,s=t.m06,e=t.m07,h=t.m11;return t.m01=t.m04,t.m02=t.m08,t.m03=t.m12,t.m04=i,t.m06=t.m09,t.m07=t.m13,t.m08=n,t.m09=s,t.m11=t.m14,t.m12=r,t.m13=e,t.m14=h,t},n.invert=function(){var t=this,i=t.m00,n=t.m01,r=t.m02,s=t.m03,e=t.m04,h=t.m05,u=t.m06,o=t.m07,c=t.m08,a=t.m09,f=t.m10,v=t.m11,l=t.m12,d=t.m13,w=t.m14,g=t.m15,p=i*h-n*e,_=i*u-r*e,y=i*o-s*e,m=n*u-r*h,b=n*o-s*h,k=r*o-s*u,A=c*d-a*l,E=c*w-f*l,T=c*g-v*l,O=a*w-f*d,S=a*g-v*d,I=f*g-v*w,R=p*I-_*S+y*O+m*T-b*E+k*A;return 0===R?(t.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),t):(R=1/R,t.m00=(h*I-u*S+o*O)*R,t.m01=(r*S-n*I-s*O)*R,t.m02=(d*k-w*b+g*m)*R,t.m03=(f*b-a*k-v*m)*R,t.m04=(u*T-e*I-o*E)*R,t.m05=(i*I-r*T+s*E)*R,t.m06=(w*y-l*k-g*_)*R,t.m07=(c*k-f*y+v*_)*R,t.m08=(e*S-h*T+o*A)*R,t.m09=(n*T-i*S-s*A)*R,t.m10=(l*b-d*y+g*p)*R,t.m11=(a*y-c*b-v*p)*R,t.m12=(h*E-e*O-u*A)*R,t.m13=(i*O-n*E+r*A)*R,t.m14=(d*_-l*m-w*p)*R,t.m15=(c*m-a*_+f*p)*R,t)},n.determinant=function(){var t=this,i=t.m00,n=t.m01,r=t.m02,s=t.m03,e=t.m04,h=t.m05,u=t.m06,o=t.m07,c=t.m08,a=t.m09,f=t.m10,v=t.m11,l=t.m12,d=t.m13,w=t.m14,g=t.m15;return(i*h-n*e)*(f*g-v*w)-(i*u-r*e)*(a*g-v*d)+(i*o-s*e)*(a*w-f*d)+(n*u-r*h)*(c*g-v*l)-(n*o-s*h)*(c*w-f*l)+(r*o-s*u)*(c*d-a*l)},n.add=function(t){var i=this;return i.m00+=t.m00,i.m01+=t.m01,i.m02+=t.m02,i.m03+=t.m03,i.m04+=t.m04,i.m05+=t.m05,i.m06+=t.m06,i.m07+=t.m07,i.m08+=t.m08,i.m09+=t.m09,i.m10+=t.m10,i.m11+=t.m11,i.m12+=t.m12,i.m13+=t.m13,i.m14+=t.m14,i.m15+=t.m15,i},n.subtract=function(t){var i=this;return i.m00-=t.m00,i.m01-=t.m01,i.m02-=t.m02,i.m03-=t.m03,i.m04-=t.m04,i.m05-=t.m05,i.m06-=t.m06,i.m07-=t.m07,i.m08-=t.m08,i.m09-=t.m09,i.m10-=t.m10,i.m11-=t.m11,i.m12-=t.m12,i.m13-=t.m13,i.m14-=t.m14,i.m15-=t.m15,i},n.multiply=function(t){return i.multiply(this,this,t)},n.multiplyScalar=function(t){var i=this;return i.m00*=t,i.m01*=t,i.m02*=t,i.m03*=t,i.m04*=t,i.m05*=t,i.m06*=t,i.m07*=t,i.m08*=t,i.m09*=t,i.m10*=t,i.m11*=t,i.m12*=t,i.m13*=t,i.m14*=t,i.m15*=t,i},n.translate=function(t){return this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this},n.transform=function(t){var i=t.x,n=t.y,r=t.z,s=this,e=s.m00,h=s.m01,u=s.m02,o=s.m03,c=s.m04,a=s.m05,f=s.m06,v=s.m07,l=s.m08,d=s.m09,w=s.m10,g=s.m11;return s.m12=e*i+c*n+l*r+s.m12,s.m13=h*i+a*n+d*r+s.m13,s.m14=u*i+f*n+w*r+s.m14,s.m15=o*i+v*n+g*r+s.m15,s},n.scale=function(t){var i=t.x,n=t.y,r=t.z,s=this;return s.m00*=i,s.m01*=i,s.m02*=i,s.m03*=i,s.m04*=n,s.m05*=n,s.m06*=n,s.m07*=n,s.m08*=r,s.m09*=r,s.m10*=r,s.m11*=r,s},n.rotate=function(t,i){var n=i.x,r=i.y,s=i.z,e=cs(n*n+r*r+s*s);if(us(e)<Fn)return null;n*=e=1/e,r*=e,s*=e;var h=as(t),u=fs(t),o=1-u,c=this,a=c.m00,f=c.m01,v=c.m02,l=c.m03,d=c.m04,w=c.m05,g=c.m06,p=c.m07,_=c.m08,y=c.m09,m=c.m10,b=c.m11,k=n*n*o+u,A=r*n*o+s*h,E=s*n*o-r*h,T=n*r*o-s*h,O=r*r*o+u,S=s*r*o+n*h,I=n*s*o+r*h,R=r*s*o-n*h,M=s*s*o+u;return c.m00=a*k+d*A+_*E,c.m01=f*k+w*A+y*E,c.m02=v*k+g*A+m*E,c.m03=l*k+p*A+b*E,c.m04=a*T+d*O+_*S,c.m05=f*T+w*O+y*S,c.m06=v*T+g*O+m*S,c.m07=l*T+p*O+b*S,c.m08=a*I+d*R+_*M,c.m09=f*I+w*R+y*M,c.m10=v*I+g*R+m*M,c.m11=l*I+p*R+b*M,c},n.getTranslation=function(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t},n.getScale=function(t){var i=this,n=ws.m00=i.m00,r=ws.m01=i.m01,s=ws.m02=i.m02,e=ws.m03=i.m04,h=ws.m04=i.m05,u=ws.m05=i.m06,o=ws.m06=i.m08,c=ws.m07=i.m09,a=ws.m08=i.m10;return t.x=cs(n*n+r*r+s*s),t.y=cs(e*e+h*h+u*u),t.z=cs(o*o+c*c+a*a),Dr.determinant(ws)<0&&(t.x*=-1),t},n.getRotation=function(t){var i=this,n=Ir.set(ds,i.m00,i.m01,i.m02).length(),r=Ir.set(ds,i.m04,i.m05,i.m06).length(),s=Ir.set(ds,i.m08,i.m09,i.m10).length();return ws.m00=i.m00/n,ws.m01=i.m01/n,ws.m02=i.m02/n,ws.m03=i.m04/r,ws.m04=i.m05/r,ws.m05=i.m06/r,ws.m06=i.m08/s,ws.m07=i.m09/s,ws.m08=i.m10/s,Dr.determinant(ws)<0&&(ws.m00*=-1,ws.m01*=-1,ws.m02*=-1),Qr.fromMat3(t,ws)},n.fromRTS=function(t,n,r){return i.fromSRT(this,t,n,r)},n.fromSRT=function(t,n,r){return i.fromSRT(this,t,n,r)},n.fromQuat=function(t){return i.fromQuat(this,t)},i}(ki));Jr=ls,ls.IDENTITY=Object.freeze(new Jr);var ds=new Ir,ws=new Dr;function gs(t,i,n,r,s,e,h,u,o,c,a,f,v,l,d,w){return new ls(t,i,n,r,s,e,h,u,o,c,a,f,v,l,d,w)}Tn.fastDefine("cc.Mat4",ls,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),O.Mat4=ls,O.mat4=gs;var ps=Math.abs,_s=Math.max,ys=Math.min,ms=Math.PI,bs=Math.acos,ks=Math.sin,As=Math.cos,Es=Math.sqrt,Ts=Math.atan2,Os=Math.ceil,Ss=Math.floor,Is=Math.round;function Rs(t,i){return Object.freeze(new Ms(t,i))}var Ms=t("ao",function(t){function i(i,n){var r;return r=t.call(this)||this,"object"==typeof i?(r.x=i.x,r.y=i.y):(r.x=i||0,r.y=n||0),r}e(i,t),i.clone=function(t){return new i(t.x,t.y)},i.copy=function(t,i){return t.x=i.x,t.y=i.y,t},i.set=function(t,i,n){return t.x=i,t.y=n,t},i.add=function(t,i,n){return t.x=i.x+n.x,t.y=i.y+n.y,t},i.subtract=function(t,i,n){return t.x=i.x-n.x,t.y=i.y-n.y,t},i.multiply=function(t,i,n){return t.x=i.x*n.x,t.y=i.y*n.y,t},i.divide=function(t,i,n){return t.x=i.x/n.x,t.y=i.y/n.y,t},i.ceil=function(t,i){return t.x=Os(i.x),t.y=Os(i.y),t},i.floor=function(t,i){return t.x=Ss(i.x),t.y=Ss(i.y),t},i.min=function(t,i,n){return t.x=ys(i.x,n.x),t.y=ys(i.y,n.y),t},i.max=function(t,i,n){return t.x=_s(i.x,n.x),t.y=_s(i.y,n.y),t},i.round=function(t,i){return t.x=Is(i.x),t.y=Is(i.y),t},i.multiplyScalar=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t},i.scaleAndAdd=function(t,i,n,r){return t.x=i.x+n.x*r,t.y=i.y+n.y*r,t},i.distance=function(t,i){var n=i.x-t.x,r=i.y-t.y;return Es(n*n+r*r)},i.squaredDistance=function(t,i){var n=i.x-t.x,r=i.y-t.y;return n*n+r*r},i.len=function(t){var i=t.x,n=t.y;return Es(i*i+n*n)},i.lengthSqr=function(t){var i=t.x,n=t.y;return i*i+n*n},i.negate=function(t,i){return t.x=-i.x,t.y=-i.y,t},i.inverse=function(t,i){return t.x=1/i.x,t.y=1/i.y,t},i.inverseSafe=function(t,i){var n=i.x,r=i.y;return ps(n)<Fn?t.x=0:t.x=1/n,ps(r)<Fn?t.y=0:t.y=1/r,t},i.normalize=function(t,i){var n=i.x,r=i.y,s=n*n+r*r;return s>0?(s=1/Es(s),t.x=n*s,t.y=r*s):(t.x=0,t.y=0),t},i.dot=function(t,i){return t.x*i.x+t.y*i.y},i.cross=function(t,i,n){return t instanceof Ir?(t.x=t.y=0,t.z=i.x*n.y-i.y*n.x,t):t.x*i.y-t.y*i.x},i.lerp=function(t,i,n,r){var s=i.x,e=i.y;return t.x=s+r*(n.x-s),t.y=e+r*(n.y-e),t},i.random=function(t,i){i=i||1;var n=2*zn()*ms;return t.x=As(n)*i,t.y=ks(n)*i,t},i.transformMat3=function(t,i,n){var r=i.x,s=i.y;return t.x=n.m00*r+n.m03*s+n.m06,t.y=n.m01*r+n.m04*s+n.m07,t},i.transformMat4=function(t,i,n){var r=i.x,s=i.y;return t.x=n.m00*r+n.m04*s+n.m12,t.y=n.m01*r+n.m05*s+n.m13,t},i.str=function(t){return"Vec2("+t.x+", "+t.y+")"},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.x,t[n+1]=i.y,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.x=i[n+0],t.y=i[n+1],t},i.strictEquals=function(t,i){return t.x===i.x&&t.y===i.y},i.equals=function(t,i,n){return void 0===n&&(n=Fn),ps(t.x-i.x)<=n*_s(1,ps(t.x),ps(i.x))&&ps(t.y-i.y)<=n*_s(1,ps(t.y),ps(i.y))},i.angle=function(t,i){var n=t.x*t.x+t.y*t.y,r=i.x*i.x+i.y*i.y;if(0===n||0===r)return 0;var s=(t.x*i.x+t.y*i.y)/Es(n*r);return s=Gn(s,-1,1),bs(s)};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y)},n.set=function(t,i){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=i||0),this},n.equals=function(t,n){return void 0===n&&(n=Fn),i.equals(this,t,n)},n.equals2f=function(t,i,n){return void 0===n&&(n=Fn),ps(this.x-t)<=n*_s(1,ps(this.x),ps(t))&&ps(this.y-i)<=n*_s(1,ps(this.y),ps(i))},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y},n.strictEquals2f=function(t,i){return this.x===t&&this.y===i},n.toString=function(){return"("+this.x+", "+this.y+")"},n.lerp=function(t,i){var n=this.x,r=this.y;return this.x=n+i*(t.x-n),this.y=r+i*(t.y-r),this},n.clampf=function(t,i){return this.x=Gn(this.x,t.x,i.x),this.y=Gn(this.y,t.y,i.y),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.add2f=function(t,i){return this.x+=t,this.y+=i,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.subtract2f=function(t,i){return this.x-=t,this.y-=i,this},n.multiplyScalar=function(t){return"object"==typeof t&&st(16359),this.x*=t,this.y*=t,this},n.multiply=function(t){return"object"!=typeof t&&st(16360),this.x*=t.x,this.y*=t.y,this},n.multiply2f=function(t,i){return this.x*=t,this.y*=i,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this},n.divide2f=function(t,i){return this.x/=t,this.y/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},n.cross=function(t){return this.x*t.y-this.y*t.x},n.length=function(){return Es(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var t=this,i=t.x,n=t.y,r=i*i+n*n;return r>0&&(r=1/Es(r),t.x*=r,t.y*=r),t},n.angle=function(t){var i=this.lengthSqr(),n=t.lengthSqr();if(0===i||0===n)return 0;var r=this.dot(t)/Es(i*n);return r=Gn(r,-1,1),bs(r)},n.signAngle=function(t){var i=this.cross(t),n=this.dot(t);return Ts(i,n)},n.rotate=function(t){var i=this.x,n=this.y,r=ks(t),s=As(t);return this.x=s*i-r*n,this.y=r*i+s*n,this},n.project=function(t){var i=this.dot(t)/t.dot(t);return this.x=t.x*i,this.y=t.y*i,this},n.transformMat4=function(t){var i=this.x,n=this.y;return this.x=t.m00*i+t.m04*n+t.m12,this.y=t.m01*i+t.m05*n+t.m13,this},n.toVec3=function(){return new Ir(this.x,this.y,0)},i}(ki));function Cs(t,i){return new Ms(t,i)}Ms.ZERO=Rs(0,0),Ms.ONE=Rs(1,1),Ms.NEG_ONE=Rs(-1,-1),Ms.UNIT_X=Rs(1,0),Ms.UNIT_Y=Rs(0,1),Tn.fastDefine("cc.Vec2",Ms,{x:0,y:0}),O.Vec2=Ms,O.v2=Cs;var Ns=Math.abs,Ps=Math.max,Ls=Math.min,Ds=Math.PI,Bs=Math.sin,Fs=Math.cos,Us=Math.atan2,xs=Math.sqrt,Gs=Math.ceil,js=Math.floor,Hs=Math.round;function Vs(t,i,n,r){return Object.freeze(new $s(t,i,n,r))}var $s=t("as",function(t){function i(i,n,r,s){var e;return e=t.call(this)||this,"object"==typeof i?(e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w):(e.x=i||0,e.y=n||0,e.z=r||0,e.w=s||0),e}e(i,t),i.clone=function(t){return new i(t.x,t.y,t.z,t.w)},i.copy=function(t,i){return t.x=i.x,t.y=i.y,t.z=i.z,t.w=i.w,t},i.set=function(t,i,n,r,s){return t.x=i,t.y=n,t.z=r,t.w=s,t},i.fromColor=function(t,i){return t.x=i.r,t.y=i.g,t.z=i.b,t.w=i.a,t},i.angle=function(t,i){var n=t.y*i.z-t.z*i.y,r=t.z*i.x-t.x*i.z,s=t.x*i.y-t.y*i.x,e=t.x*i.x+t.y*i.y+t.z*i.z;return Us(xs(n*n+r*r+s*s),e)},i.add=function(t,i,n){return t.x=i.x+n.x,t.y=i.y+n.y,t.z=i.z+n.z,t.w=i.w+n.w,t},i.subtract=function(t,i,n){return t.x=i.x-n.x,t.y=i.y-n.y,t.z=i.z-n.z,t.w=i.w-n.w,t},i.multiply=function(t,i,n){return t.x=i.x*n.x,t.y=i.y*n.y,t.z=i.z*n.z,t.w=i.w*n.w,t},i.divide=function(t,i,n){return t.x=i.x/n.x,t.y=i.y/n.y,t.z=i.z/n.z,t.w=i.w/n.w,t},i.ceil=function(t,i){return t.x=Gs(i.x),t.y=Gs(i.y),t.z=Gs(i.z),t.w=Gs(i.w),t},i.floor=function(t,i){return t.x=js(i.x),t.y=js(i.y),t.z=js(i.z),t.w=js(i.w),t},i.min=function(t,i,n){return t.x=Ls(i.x,n.x),t.y=Ls(i.y,n.y),t.z=Ls(i.z,n.z),t.w=Ls(i.w,n.w),t},i.max=function(t,i,n){return t.x=Ps(i.x,n.x),t.y=Ps(i.y,n.y),t.z=Ps(i.z,n.z),t.w=Ps(i.w,n.w),t},i.round=function(t,i){return t.x=Hs(i.x),t.y=Hs(i.y),t.z=Hs(i.z),t.w=Hs(i.w),t},i.multiplyScalar=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t.w=i.w*n,t},i.scaleAndAdd=function(t,i,n,r){return t.x=i.x+n.x*r,t.y=i.y+n.y*r,t.z=i.z+n.z*r,t.w=i.w+n.w*r,t},i.distance=function(t,i){var n=i.x-t.x,r=i.y-t.y,s=i.z-t.z,e=i.w-t.w;return xs(n*n+r*r+s*s+e*e)},i.squaredDistance=function(t,i){var n=i.x-t.x,r=i.y-t.y,s=i.z-t.z,e=i.w-t.w;return n*n+r*r+s*s+e*e},i.len=function(t){var i=t.x,n=t.y,r=t.z,s=t.w;return xs(i*i+n*n+r*r+s*s)},i.lengthSqr=function(t){var i=t.x,n=t.y,r=t.z,s=t.w;return i*i+n*n+r*r+s*s},i.negate=function(t,i){return t.x=-i.x,t.y=-i.y,t.z=-i.z,t.w=-i.w,t},i.inverse=function(t,i){return t.x=1/i.x,t.y=1/i.y,t.z=1/i.z,t.w=1/i.w,t},i.inverseSafe=function(t,i){var n=i.x,r=i.y,s=i.z,e=i.w;return Ns(n)<Fn?t.x=0:t.x=1/n,Ns(r)<Fn?t.y=0:t.y=1/r,Ns(s)<Fn?t.z=0:t.z=1/s,Ns(e)<Fn?t.w=0:t.w=1/e,t},i.normalize=function(t,i){var n=i.x,r=i.y,s=i.z,e=i.w,h=n*n+r*r+s*s+e*e;return h>0?(h=1/xs(h),t.x=n*h,t.y=r*h,t.z=s*h,t.w=e*h):(t.x=0,t.y=0,t.z=0,t.w=0),t},i.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w},i.lerp=function(t,i,n,r){return t.x=i.x+r*(n.x-i.x),t.y=i.y+r*(n.y-i.y),t.z=i.z+r*(n.z-i.z),t.w=i.w+r*(n.w-i.w),t},i.scale=function(t,i,n){return t.x=i.x*n,t.y=i.y*n,t.z=i.z*n,t.w=i.w*n,t},i.random=function(t,i){i=i||1;var n=2*zn()*Ds,r=2*zn()-1,s=xs(1-r*r);return t.x=s*Fs(n)*i,t.y=s*Bs(n)*i,t.z=r*i,t.w=0,t},i.transformMat4=function(t,i,n){var r=i.x,s=i.y,e=i.z,h=i.w;return t.x=n.m00*r+n.m04*s+n.m08*e+n.m12*h,t.y=n.m01*r+n.m05*s+n.m09*e+n.m13*h,t.z=n.m02*r+n.m06*s+n.m10*e+n.m14*h,t.w=n.m03*r+n.m07*s+n.m11*e+n.m15*h,t},i.transformAffine=function(t,i,n){var r=i.x,s=i.y,e=i.z,h=i.w;return t.x=n.m00*r+n.m04*s+n.m08*e+n.m12*h,t.y=n.m01*r+n.m05*s+n.m09*e+n.m13*h,t.z=n.m02*r+n.m06*s+n.m10*e+n.m14*h,t.w=i.w,t},i.transformQuat=function(t,i,n){var r=i.x,s=i.y,e=i.z,h=n.x,u=n.y,o=n.z,c=n.w,a=c*r+u*e-o*s,f=c*s+o*r-h*e,v=c*e+h*s-u*r,l=-h*r-u*s-o*e;return t.x=a*c+l*-h+f*-o-v*-u,t.y=f*c+l*-u+v*-h-a*-o,t.z=v*c+l*-o+a*-u-f*-h,t.w=i.w,t},i.toArray=function(t,i,n){return void 0===n&&(n=0),t[n+0]=i.x,t[n+1]=i.y,t[n+2]=i.z,t[n+3]=i.w,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.w=i[n+3],t},i.strictEquals=function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z&&t.w===i.w},i.equals=function(t,i,n){void 0===n&&(n=Fn);var r=1/0;return!(Ns(t.x)===r||Ns(t.y)===r||Ns(t.z)===r||Ns(t.w)===r||Ns(i.x)===r||Ns(i.y)===r||Ns(i.z)===r||Ns(i.w)===r)&&Ns(t.x-i.x)<=n*Ps(1,Ns(t.x),Ns(i.x))&&Ns(t.y-i.y)<=n*Ps(1,Ns(t.y),Ns(i.y))&&Ns(t.z-i.z)<=n*Ps(1,Ns(t.z),Ns(i.z))&&Ns(t.w-i.w)<=n*Ps(1,Ns(t.w),Ns(i.w))};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y,this.z,this.w)},n.set=function(t,i,n,r){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=i||0,this.z=n||0,this.w=r||0),this},n.equals=function(t,i){void 0===i&&(i=Fn);var n=this;return Ns(n.x-t.x)<=i*Ps(1,Ns(n.x),Ns(t.x))&&Ns(n.y-t.y)<=i*Ps(1,Ns(n.y),Ns(t.y))&&Ns(n.z-t.z)<=i*Ps(1,Ns(n.z),Ns(t.z))&&Ns(n.w-t.w)<=i*Ps(1,Ns(n.w),Ns(t.w))},n.equals4f=function(t,i,n,r,s){void 0===s&&(s=Fn);var e=this;return Ns(e.x-t)<=s*Ps(1,Ns(e.x),Ns(t))&&Ns(e.y-i)<=s*Ps(1,Ns(e.y),Ns(i))&&Ns(e.z-n)<=s*Ps(1,Ns(e.z),Ns(n))&&Ns(e.w-r)<=s*Ps(1,Ns(e.w),Ns(r))},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.strictEquals4f=function(t,i,n,r){return this.x===t&&this.y===i&&this.z===n&&this.w===r},n.lerp=function(t,i){var n=this,r=n.x,s=n.y,e=n.z,h=n.w;return n.x=r+i*(t.x-r),n.y=s+i*(t.y-s),n.z=e+i*(t.z-e),n.w=h+i*(t.w-h),n},n.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},n.clampf=function(t,i){var n=this;return n.x=Gn(n.x,t.x,i.x),n.y=Gn(n.y,t.y,i.y),n.z=Gn(n.z,t.z,i.z),n.w=Gn(n.w,t.w,i.w),n},n.add=function(t){var i=this;return i.x+=t.x,i.y+=t.y,i.z+=t.z,i.w+=t.w,i},n.add4f=function(t,i,n,r){var s=this;return s.x+=t,s.y+=i,s.z+=n,s.w+=r,s},n.subtract=function(t){var i=this;return i.x-=t.x,i.y-=t.y,i.z-=t.z,i.w-=t.w,i},n.subtract4f=function(t,i,n,r){var s=this;return s.x-=t,s.y-=i,s.z-=n,s.w-=r,s},n.multiplyScalar=function(t){var i=this;return i.x*=t,i.y*=t,i.z*=t,i.w*=t,i},n.multiply=function(t){var i=this;return i.x*=t.x,i.y*=t.y,i.z*=t.z,i.w*=t.w,i},n.multiply4f=function(t,i,n,r){var s=this;return s.x*=t,s.y*=i,s.z*=n,s.w*=r,s},n.divide=function(t){var i=this;return i.x/=t.x,i.y/=t.y,i.z/=t.z,i.w/=t.w,i},n.divide4f=function(t,i,n,r){var s=this;return s.x/=t,s.y/=i,s.z/=n,s.w/=r,s},n.negative=function(){var t=this;return t.x=-t.x,t.y=-t.y,t.z=-t.z,t.w=-t.w,t},n.dot=function(t){var i=this;return i.x*t.x+i.y*t.y+i.z*t.z+i.w*t.w},n.cross=function(t){var i=this,n=i.x,r=i.y,s=i.z,e=t.x,h=t.y,u=t.z;return i.x=r*u-s*h,i.y=s*e-n*u,i.z=n*h-r*e,i},n.length=function(){var t=this,i=t.x,n=t.y,r=t.z,s=t.w;return xs(i*i+n*n+r*r+s*s)},n.lengthSqr=function(){var t=this,i=t.x,n=t.y,r=t.z,s=t.w;return i*i+n*n+r*r+s*s},n.normalize=function(){var t=this,i=t.x,n=t.y,r=t.z,s=t.w,e=i*i+n*n+r*r+s*s;return e>0&&(e=1/xs(e),t.x=i*e,t.y=n*e,t.z=r*e,t.w=s*e),t},n.scale=function(t){var i=this;return i.x*=t,i.y*=t,i.z*=t,i.w*=t,i},n.transformMat4=function(t){var i=this,n=i.x,r=i.y,s=i.z,e=i.w;return i.x=t.m00*n+t.m04*r+t.m08*s+t.m12*e,i.y=t.m01*n+t.m05*r+t.m09*s+t.m13*e,i.z=t.m02*n+t.m06*r+t.m10*s+t.m14*e,i.w=t.m03*n+t.m07*r+t.m11*s+t.m15*e,i},i}(ki));function zs(t,i,n,r){return new $s(t,i,n,r)}$s.ZERO=Vs(0,0,0,0),$s.ONE=Vs(1,1,1,1),$s.NEG_ONE=Vs(-1,-1,-1,-1),$s.UNIT_X=Vs(1,0,0,0),$s.UNIT_Y=Vs(0,1,0,0),$s.UNIT_Z=Vs(0,0,1,0),$s.UNIT_W=Vs(0,0,0,1),Tn.fastDefine("cc.Vec4",$s,{x:0,y:0,z:0,w:0}),O.Vec4=$s,O.v4=zs;var Ws=1/255,Xs=Math.abs,Ys=Math.max;function Ks(t,i,n,r){return Object.freeze(new Qs(t,i,n,r))}var qs,Qs=t("aD",function(t){function i(i,n,r,s){var e;return(e=t.call(this)||this).M=new Uint8ClampedArray(4),"string"==typeof i?e.fromHEX(i):void 0!==n?e.set(i,n,r,s):e.set(i),e}e(i,t),i.clone=function(t){var n=new i;return n.r=t.r,n.g=t.g,n.b=t.b,n.a=t.a,n},i.copy=function(t,i){return t.r=i.r,t.g=i.g,t.b=i.b,t.a=i.a,t},i.set=function(t,i,n,r,s){return t.r=i,t.g=n,t.b=r,t.a=s,t},i.toVec4=function(t,i){var n=t.M;return(i=void 0!==i?i:new $s).x=n[0]*Ws,i.y=n[1]*Ws,i.z=n[2]*Ws,i.w=n[3]*Ws,i},i.fromVec4=function(t,n){var r=(n=void 0===n?new i:n).M;return r[0]=t.x/Ws,r[1]=t.y/Ws,r[2]=t.z/Ws,r[3]=t.w/Ws,n},i.fromHEX=function(t,i){var n;return"string"==typeof i?(6===(i="#"===i[0]?i.substring(1):i).length?i+="FF":3===i.length?i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]+"FF":4===i.length&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]+i[3]+i[3]),n=Number("0x"+i)):(i<16777216&&(i=255+(i<<8)),n=i),t.r=n>>>24,t.g=(16711680&n)>>>16,t.b=(65280&n)>>>8,t.a=255&n,t},i.add=function(t,i,n){return t.r=i.r+n.r,t.g=i.g+n.g,t.b=i.b+n.b,t.a=i.a+n.a,t},i.subtract=function(t,i,n){return t.r=i.r-n.r,t.g=i.g-n.g,t.b=i.b-n.b,t.a=i.a-n.a,t},i.multiply=function(t,i,n){return t.r=i.r*n.r,t.g=i.g*n.g,t.b=i.b*n.b,t.a=i.a*n.a,t},i.divide=function(t,i,n){return t.r=i.r/n.r,t.g=i.g/n.g,t.b=i.b/n.b,t.a=i.a/n.a,t},i.scale=function(t,i,n){return t.r=i.r*n,t.g=i.g*n,t.b=i.b*n,t.a=i.a*n,t},i.lerp=function(t,i,n,r){var s=i.r,e=i.g,h=i.b,u=i.a;return t.r=s+(n.r-s)*r,t.g=e+(n.g-e)*r,t.b=h+(n.b-h)*r,t.a=u+(n.a-u)*r,t},i.toArray=function(t,n,r){void 0===r&&(r=0);var s=n instanceof i||n.a>1?1/255:1;return t[r+0]=n.r*s,t[r+1]=n.g*s,t[r+2]=n.b*s,t[r+3]=n.a*s,t},i.fromArray=function(t,i,n){return void 0===n&&(n=0),i.r=255*t[n+0],i.g=255*t[n+1],i.b=255*t[n+2],i.a=255*t[n+3],i},i.fromUint32=function(t,i){return i>>>=0,t.r=255&i,t.g=i>>8&255,t.b=i>>16&255,t.a=i>>24&255,t},i.toUint32=function(t){return(t.a<<24|t.b<<16|t.g<<8|t.r)>>>0},i.strictEquals=function(t,i){return t.r===i.r&&t.g===i.g&&t.b===i.b&&t.a===i.a},i.equals=function(t,i,n){return void 0===n&&(n=Fn),!(Xs(t.r)===1/0||Xs(t.g)===1/0||Xs(t.b)===1/0||Xs(t.a)===1/0)&&Xs(t.r-i.r)<=n*Ys(1,Xs(t.r),Xs(i.r))&&Xs(t.g-i.g)<=n*Ys(1,Xs(t.g),Xs(i.g))&&Xs(t.b-i.b)<=n*Ys(1,Xs(t.b),Xs(i.b))&&Xs(t.a-i.a)<=n*Ys(1,Xs(t.a),Xs(i.a))},i.hex=function(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0};var n=i.prototype;return n.clone=function(){var t=new i;return t.M.set(this.M),t},n.equals=function(t){var i=t,n=this.M;return t&&n[0]===i.r&&n[1]===i.g&&n[2]===i.b&&n[3]===i.a},n.lerp=function(t,n){return i.lerp(this,this,t,n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(t){return void 0===t&&(t="rgba"),"rgba"===t?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*Ws).toFixed(2)+")":"rgb"===t?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(t)},n.fromHEX=function(t){var i;return"string"==typeof t?(6===(t="#"===t[0]?t.substring(1):t).length?t+="FF":3===t.length?t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+"FF":4===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),i=Number("0x"+t)):(t<16777216&&(t=255+(t<<8)),i=t),this.r=i>>>24,this.g=(16711680&i)>>>16,this.b=(65280&i)>>>8,this.a=255&i,this},n.toHEX=function(t){void 0===t&&(t="#rrggbb");var i=this.M,n="0",r=[(i[0]<16?n:"")+i[0].toString(16),(i[1]<16?n:"")+i[1].toString(16),(i[2]<16?n:"")+i[2].toString(16)];return"#rgb"===t?(r[0]=r[0][0],r[1]=r[1][0],r[2]=r[2][0]):"#rrggbbaa"===t&&r.push((i[3]<16?n:"")+i[3].toString(16)),r.join("")},n.toRGBValue=function(){return this.M[2]<<16|this.M[1]<<8|this.M[0]},n.fromHSV=function(t,i,n){var r=0,s=0,e=0;if(0===i)r=s=e=n;else if(0===n)r=s=e=0;else{1===t&&(t=0),t*=6;var h=Math.floor(t),u=t-h,o=n*(1-i),c=n*(1-i*u),a=n*(1-i*(1-u));switch(h){default:case 0:r=n,s=a,e=o;break;case 1:r=c,s=n,e=o;break;case 2:r=o,s=n,e=a;break;case 3:r=o,s=c,e=n;break;case 4:r=a,s=o,e=n;break;case 5:r=n,s=o,e=c}}var f=this.M;return f[0]=255*r,f[1]=255*s,f[2]=255*e,this},n.toHSV=function(){var t=this.M[0]*Ws,i=this.M[1]*Ws,n=this.M[2]*Ws,r={h:0,s:0,v:0},s=Math.max(t,i,n),e=Math.min(t,i,n),h=0;return r.v=s,r.s=s?(s-e)/s:0,r.s?(h=s-e,r.h=t===s?(i-n)/h:i===s?2+(n-t)/h:4+(t-i)/h,r.h/=6,r.h<0&&(r.h+=1)):r.h=0,r},n.set=function(t,i,n,r){var s=this.M;if("object"==typeof t){var e,h,u,o,c=t;c.M?s.set(c.M):(s[0]=null!==(e=c.r)&&void 0!==e?e:0,s[1]=null!==(h=c.g)&&void 0!==h?h:0,s[2]=null!==(u=c.b)&&void 0!==u?u:0,s[3]=null!==(o=c.a)&&void 0!==o?o:255)}else s[0]=null!=t?t:0,s[1]=null!=i?i:0,s[2]=null!=n?n:0,s[3]=null!=r?r:255;return this},n.multiply=function(t){var i=this.M;return i[0]*=t.r/255,i[1]*=t.g/255,i[2]*=t.b/255,i[3]*=t.a/255,this},n.getModifiableProperties=function(){return["r","g","b","a"]},r(i,[{key:"r",get:function(){return this.M[0]},set:function(t){this.M[0]=t}},{key:"g",get:function(){return this.M[1]},set:function(t){this.M[1]=t}},{key:"b",get:function(){return this.M[2]},set:function(t){this.M[2]=t}},{key:"a",get:function(){return this.M[3]},set:function(t){this.M[3]=t}},{key:"x",get:function(){return this.M[0]*Ws},set:function(t){this.M[0]=255*t}},{key:"y",get:function(){return this.M[1]*Ws},set:function(t){this.M[1]=255*t}},{key:"z",get:function(){return this.M[2]*Ws},set:function(t){this.M[2]=255*t}},{key:"w",get:function(){return this.M[3]*Ws},set:function(t){this.M[3]=255*t}}]),i}(ki));function Js(t,i,n,r){return new Qs(t,i,n,r)}function Zs(t,i,n){if(i>n){var r=i;i=n,n=r}return t<i?i:t>n?n:t}function te(t){var i=t.clone();return i.x=Math.floor(t.x),i.y=Math.floor(t.y),i.z=Math.floor(t.z),i}Qs.WHITE=Ks(255,255,255,255),Qs.GRAY=Ks(127,127,127,255),Qs.BLACK=Ks(0,0,0,255),Qs.TRANSPARENT=Ks(0,0,0,0),Qs.RED=Ks(255,0,0,255),Qs.GREEN=Ks(0,255,0,255),Qs.BLUE=Ks(0,0,255,255),Qs.CYAN=Ks(0,255,255,255),Qs.MAGENTA=Ks(255,0,255,255),Qs.YELLOW=Ks(255,255,0,255),Tn.fastDefine("cc.Color",Qs,{r:0,g:0,b:0,a:255}),O.Color=Qs,O.color=Js;var ie=t("az",function(t){function i(i,n){var r;return r=t.call(this)||this,"object"==typeof i?(r.width=i.width,r.height=i.height):(r.width=i||0,r.height=n||0),r}e(i,t),i.lerp=function(t,i,n,r){return t.width=i.width+(n.width-i.width)*r,t.height=i.height+(n.height-i.height)*r,t},i.equals=function(t,i){return t.width===i.width&&t.height===i.height};var n=i.prototype;return n.clone=function(){return new i(this.width,this.height)},n.set=function(t,i){return"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=i||0),this},n.equals=function(t){return this.width===t.width&&this.height===t.height},n.lerp=function(t,i){return this.width+=(t.width-this.width)*i,this.height+=(t.height-this.height)*i,this},n.toString=function(){return"("+this.width+", "+this.height+")"},r(i,[{key:"x",get:function(){return this.width},set:function(t){this.width=t}},{key:"y",get:function(){return this.height},set:function(t){this.height=t}}]),i}(ki));function ne(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),new ie(t,i)}qs=ie,ie.ZERO=Object.freeze(new qs(0,0)),ie.ONE=Object.freeze(new qs(1,1)),Tn.fastDefine("cc.Size",ie,{width:0,height:0}),O.size=ne,O.Size=ie;var re=Math.max,se=Math.min,ee=t("aB",function(t){function i(i,n,r,s){var e;return e=t.call(this)||this,"object"==typeof i?(e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height):(e.x=i||0,e.y=n||0,e.width=r||0,e.height=s||0),e}e(i,t),i.fromMinMax=function(t,i,n){var r=se(i.x,n.x),s=se(i.y,n.y),e=re(i.x,n.x),h=re(i.y,n.y);return t.x=r,t.y=s,t.width=e-r,t.height=h-s,t},i.lerp=function(t,i,n,r){var s=i.x,e=i.y,h=i.width,u=i.height;return t.x=s+(n.x-s)*r,t.y=e+(n.y-e)*r,t.width=h+(n.width-h)*r,t.height=u+(n.height-u)*r,t},i.intersection=function(t,i,n){var r=i.x,s=i.y,e=i.x+i.width,h=i.y+i.height,u=n.x,o=n.y,c=n.x+n.width,a=n.y+n.height;return t.x=re(r,u),t.y=re(s,o),t.width=se(e,c)-t.x,t.height=se(h,a)-t.y,t},i.union=function(t,i,n){var r=i.x,s=i.y,e=i.width,h=i.height,u=n.x,o=n.y,c=n.width,a=n.height;return t.x=se(r,u),t.y=se(s,o),t.width=re(r+e,u+c)-t.x,t.height=re(s+h,o+a)-t.y,t},i.equals=function(t,i){return t.x===i.x&&t.y===i.y&&t.width===i.width&&t.height===i.height};var n=i.prototype;return n.clone=function(){return new i(this.x,this.y,this.width,this.height)},n.set=function(t,i,n,r){var s=this;return"object"==typeof t?(s.x=t.x,s.y=t.y,s.width=t.width,s.height=t.height):(s.x=t||0,s.y=i||0,s.width=n||0,s.height=r||0),s},n.equals=function(t){var i=this;return i.x===t.x&&i.y===t.y&&i.width===t.width&&i.height===t.height},n.lerp=function(t,i){var n=this,r=n.x,s=n.y,e=n.width,h=n.height;return n.x=r+(t.x-r)*i,n.y=s+(t.y-s)*i,n.width=e+(t.width-e)*i,n.height=h+(t.height-h)*i,n},n.toString=function(){var t=this;return"("+t.x+", "+t.y+", "+t.width+", "+t.height+")"},n.intersects=function(t){var i=this,n=i.x+i.width,r=i.y+i.height,s=t.x+t.width,e=t.y+t.height;return!(n<t.x||s<i.x||r<t.y||e<i.y)},n.contains=function(t){var i=this;return i.x<=t.x&&i.x+i.width>=t.x&&i.y<=t.y&&i.y+i.height>=t.y},n.containsRect=function(t){var i=this;return i.x<=t.x&&i.x+i.width>=t.x+t.width&&i.y<=t.y&&i.y+i.height>=t.y+t.height},n.transformMat4=function(t){var i=this,n=i.x,r=i.y,s=n+i.width,e=r+i.height,h=t.m00*n+t.m04*r+t.m12,u=t.m01*n+t.m05*r+t.m13,o=t.m00*s+t.m04*r+t.m12,c=t.m01*s+t.m05*r+t.m13,a=t.m00*n+t.m04*e+t.m12,f=t.m01*n+t.m05*e+t.m13,v=t.m00*s+t.m04*e+t.m12,l=t.m01*s+t.m05*e+t.m13,d=se(h,o,a,v),w=re(h,o,a,v),g=se(u,c,f,l),p=re(u,c,f,l);return i.x=d,i.y=g,i.width=w-d,i.height=p-g,i},n.transformMat4ToPoints=function(t,i,n,r,s){var e=this,h=e.x,u=e.y,o=h+e.width,c=u+e.height;i.x=t.m00*h+t.m04*u+t.m12,i.y=t.m01*h+t.m05*u+t.m13,s.x=t.m00*o+t.m04*u+t.m12,s.y=t.m01*o+t.m05*u+t.m13,n.x=t.m00*h+t.m04*c+t.m12,n.y=t.m01*h+t.m05*c+t.m13,r.x=t.m00*o+t.m04*c+t.m12,r.y=t.m01*o+t.m05*c+t.m13},r(i,[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new Ms(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new Ms(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new ie(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}},{key:"z",get:function(){return this.width},set:function(t){this.width=t}},{key:"w",get:function(){return this.height},set:function(t){this.height=t}}]),i}(ki));function he(t,i,n,r){return void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),new ee(t,i,n,r)}Tn.fastDefine("cc.Rect",ee,{x:0,y:0,width:0,height:0}),O.Rect=ee,O.rect=he;var ue=t("b4",Float64Array),oe=t("b5",function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.createFloatArray=function(t){return new ue(t)},r(i,[{key:"array",get:function(){return this._array}}]),i}(ki)),ce=Object.freeze({__proto__:null,Color:Qs,EPSILON:Fn,HALF_PI:Dn,MATH_FLOAT_ARRAY:ue,Mat3:Dr,Mat4:ls,MathBase:oe,Quat:Qr,Rect:ee,Size:ie,TWO_PI:Bn,Vec2:Ms,Vec3:Ir,Vec4:$s,absMax:rr,absMaxComponent:nr,approx:xn,bits:D,clamp:Gn,clamp01:jn,color:Js,enumerableProps:sr,equals:Un,floatToHalf:ar,halfToFloat:fr,inverseLerp:ir,lerp:Hn,mat4:gs,nextPow2:Jn,pingPong:tr,preTransforms:hs,pseudoRandom:Kn,pseudoRandomRange:qn,pseudoRandomRangeInt:Qn,quat:ss,random:zn,randomRange:Xn,randomRangeInt:Yn,rect:he,repeat:Zn,setRandGenerator:Wn,size:ne,toDegree:$n,toRadian:Vn,v2:Cs,v3:Rr,v4:zs});t("ai",ce);var ae=new Ir,fe=new Ir,ve=new Ir,le=new Ir,de=new Ir,we=new Ir,ge=new Array(3),pe=new Array(3);function _e(t,i){return Ir.dot(i.n,t)-i.d}function ye(t,i,n){return Ir.copy(t,i),Ir.subtract(de,n.center,n.halfExtents),Ir.add(we,n.center,n.halfExtents),t.x=t.x<de.x?de.x:t.x,t.y=t.y<de.y?de.y:t.y,t.z=t.z<de.z?de.z:t.z,t.x=t.x>we.x?we.x:t.x,t.y=t.y>we.y?we.y:t.y,t.z=t.z>we.z?we.z:t.z,t}function me(t,i,n){Ir.set(ae,n.orientation.m00,n.orientation.m01,n.orientation.m02),Ir.set(fe,n.orientation.m03,n.orientation.m04,n.orientation.m05),Ir.set(ve,n.orientation.m06,n.orientation.m07,n.orientation.m08),ge[0]=ae,ge[1]=fe,ge[2]=ve,pe[0]=n.halfExtents.x,pe[1]=n.halfExtents.y,pe[2]=n.halfExtents.z,Ir.subtract(le,i,n.center),Ir.set(t,n.center.x,n.center.y,n.center.z);for(var r=0;r<3;r++){var s=Ir.dot(le,ge[r]);s>pe[r]&&(s=pe[r]),s<-pe[r]&&(s=-pe[r]),t.x+=s*ge[r].x,t.y+=s*ge[r].y,t.z+=s*ge[r].z}return t}var be=Object.freeze({__proto__:null,point_plane:_e,pt_point_aabb:ye,pt_point_line:function(t,i,n,r){Ir.subtract(ae,n,r);var s=ae.clone(),e=Ir.lengthSqr(s);if(0===e)Ir.copy(t,n);else{Ir.subtract(ae,i,n);var h=Ir.dot(ae,s)/e;h<0?Ir.copy(t,n):h>1?Ir.copy(t,r):Ir.scaleAndAdd(t,n,s,h)}},pt_point_obb:me,pt_point_plane:function(t,i,n){var r=_e(i,n);return Ir.subtract(t,i,Ir.multiplyScalar(t,n.n,r))}}),ke=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=-1),this.s=void 0,this.e=void 0,this.C=void 0,this.C=2,this.s=new Ir(t,i,n),this.e=new Ir(r,s,e)}return t.create=function(i,n,r,s,e,h){return new t(i,n,r,s,e,h)},t.clone=function(i){return new t(i.s.x,i.s.y,i.s.z,i.e.x,i.e.y,i.e.z)},t.copy=function(t,i){return Ir.copy(t.s,i.s),Ir.copy(t.e,i.e),t},t.fromPoints=function(t,i,n){return Ir.copy(t.s,i),Ir.copy(t.e,n),t},t.set=function(t,i,n,r,s,e,h){return t.s.x=i,t.s.y=n,t.s.z=r,t.e.x=s,t.e.y=e,t.e.z=h,t},t.len=function(t){return Ir.distance(t.s,t.e)},t.prototype.length=function(){return Ir.distance(this.s,this.e)},r(t,[{key:"type",get:function(){return this.C}}]),t}(),Ae=new Ir(0,0,0),Ee=new Ir(0,0,0),Te=gs(),Oe=zs(),Se=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=0),this._type=32,this.n=new Ir(t,i,n),this.d=r}return t.create=function(i,n,r,s){return new t(i,n,r,s)},t.clone=function(i){return new t(i.n.x,i.n.y,i.n.z,i.d)},t.copy=function(t,i){return Ir.copy(t.n,i.n),t.d=i.d,t},t.fromPoints=function(t,i,n,r){return Ir.subtract(Ae,n,i),Ir.subtract(Ee,r,i),Ir.normalize(t.n,Ir.cross(t.n,Ae,Ee)),t.d=Ir.dot(t.n,i),t},t.set=function(t,i,n,r,s){return t.n.x=i,t.n.y=n,t.n.z=r,t.d=s,t},t.fromNormalAndPoint=function(t,i,n){return Ir.copy(t.n,i),t.d=Ir.dot(i,n),t},t.normalize=function(t,i){var n=i.n.length();return Ir.normalize(t.n,i.n),n>0&&(t.d=i.d/n),t},t.prototype.transform=function(t){ls.invert(Te,t),ls.transpose(Te,Te),$s.set(Oe,this.n.x,this.n.y,this.n.z,-this.d),$s.transformMat4(Oe,Oe,Te),Ir.set(this.n,Oe.x,Oe.y,Oe.z),this.d=-Oe.w},r(t,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(t){this.n.x=t}},{key:"y",get:function(){return this.n.y},set:function(t){this.n.y=t}},{key:"z",get:function(){return this.n.z},set:function(t){this.n.z=t}},{key:"w",get:function(){return this.d},set:function(t){this.d=t}}]),t}(),Ie=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=-1),this._type=1,this.o=new Ir(t,i,n),this.d=new Ir(r,s,e)}return t.create=function(i,n,r,s,e,h){return void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=1),new t(i,n,r,s,e,h)},t.clone=function(i){return new t(i.o.x,i.o.y,i.o.z,i.d.x,i.d.y,i.d.z)},t.copy=function(t,i){return Ir.copy(t.o,i.o),Ir.copy(t.d,i.d),t},t.fromPoints=function(t,i,n){return Ir.copy(t.o,i),Ir.normalize(t.d,Ir.subtract(t.d,n,i)),t},t.set=function(t,i,n,r,s,e,h){return t.o.x=i,t.o.y=n,t.o.z=r,t.d.x=s,t.d.y=e,t.d.z=h,t},t.prototype.computeHit=function(t,i){Ir.normalize(t,this.d),Ir.scaleAndAdd(t,this.o,t,i)},r(t,[{key:"type",get:function(){return this._type}}]),t}(),Re=function(){function t(t,i,n,r,s,e,h,u,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=1),void 0===o&&(o=0),this._type=64,this.a=new Ir(t,i,n),this.b=new Ir(r,s,e),this.c=new Ir(h,u,o)}return t.create=function(i,n,r,s,e,h,u,o,c){return void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=1),new t(i,n,r,s,e,h,u,o,c)},t.clone=function(i){return new t(i.a.x,i.a.y,i.a.z,i.b.x,i.b.y,i.b.z,i.c.x,i.c.y,i.c.z)},t.copy=function(t,i){return Ir.copy(t.a,i.a),Ir.copy(t.b,i.b),Ir.copy(t.c,i.c),t},t.fromPoints=function(t,i,n,r){return Ir.copy(t.a,i),Ir.copy(t.b,n),Ir.copy(t.c,r),t},t.set=function(t,i,n,r,s,e,h,u,o,c){return t.a.x=i,t.a.y=n,t.a.z=r,t.b.x=s,t.b.y=e,t.b.z=h,t.c.x=u,t.c.y=o,t.c.z=c,t},r(t,[{key:"type",get:function(){return this._type}}]),t}(),Me=new Ir,Ce=new Ir,Ne=new Ir,Pe=new Ir;function Le(t){return Math.max(Math.max(t.x,t.y),t.z)}var De=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),this._type=4,this._center=new Ir(t,i,n),this.L=r}t.create=function(i,n,r,s){return new t(i,n,r,s)},t.clone=function(i){return new t(i.center.x,i.center.y,i.center.z,i.radius)},t.copy=function(t,i){return Ir.copy(t.center,i.center),t.radius=i.radius,t},t.fromPoints=function(t,i,n){return Ir.multiplyScalar(t.center,Ir.add(Me,i,n),.5),t.radius=.5*Ir.subtract(Me,n,i).length(),t},t.set=function(t,i,n,r,s){return t.center.x=i,t.center.y=n,t.center.z=r,t.radius=s,t};var i=t.prototype;return i.destroy=function(){},i.clone=function(){return t.clone(this)},i.copy=function(i){return t.copy(this,i)},i.getBoundary=function(t,i){Ir.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Ir.set(i,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},i.transform=function(t,i,n,r,s){Ir.transformMat4(s.center,this.center,t),s.radius=this.radius*Le(r)},i.translateAndRotate=function(t,i,n){Ir.transformMat4(n.center,this.center,t)},i.setScale=function(t,i){i.radius=this.radius*Le(t)},i.mergePoint=function(t){this.radius<0&&(this.center.set(t),this.radius=0),Ir.subtract(Ce,t,this.center);var i=Ce.length();if(i>this.radius){var n=.5*(i-this.radius);this.radius+=n,Ir.multiplyScalar(Ce,Ce,n/i),Ir.add(this.center,this.center,Ce)}},i.mergePoints=function(t){var i=t.length;if(!(i<1)){this.radius=-1;for(var n=0;n<i;n++)this.mergePoint(t[n])}},i.mergeAABB=function(t){t.getBoundary(Ne,Pe),this.mergePoint(Ne),this.mergePoint(Pe)},r(t,[{key:"center",get:function(){return this._center},set:function(t){this._center=t}},{key:"radius",get:function(){return this.L},set:function(t){this.L=t}},{key:"type",get:function(){return this._type}}]),t}(),Be=function(){function t(){this._poolHandle=-1,Ue.addContainer(this)}return t.prototype.destroy=function(){Ue.removeContainer(this)},t}(),Fe=function(){function t(){this.F=[],this.U=0,this.shrinkTimeSpan=5}var i=t.prototype;return i.addContainer=function(t){-1===t._poolHandle&&(t._poolHandle=this.F.length,this.F.push(t))},i.removeContainer=function(t){-1!==t._poolHandle&&(this.F[this.F.length-1]._poolHandle=t._poolHandle,hi(this.F,t._poolHandle),t._poolHandle=-1)},i.tryShrink=function(){for(var t=0;t<this.F.length;t++)this.F[t].tryShrink()},i.update=function(t){this.U+=t,this.U>this.shrinkTimeSpan&&(this.tryShrink(),this.U-=this.shrinkTimeSpan)},t}(),Ue=new Fe,xe=t("b6",function(t){function i(i,n,r,s){var e;(e=t.call(this)||this).H=[],e.V=i,e.$=r||null,e.Z=Math.max(n,1),e.tt=s?R(s,1):e.Z,e.it=e.Z-1;for(var h=0;h<e.Z;++h)e.H.push(i());return e}e(i,t);var n=i.prototype;return n.alloc=function(){if(this.it<0){this.H.length=this.Z;for(var t=0;t<this.Z;t++)this.H[t]=this.V();this.it=this.Z-1}return this.H[this.it--]},n.free=function(t){this.H[++this.it]=t},n.freeArray=function(t){this.H.length=this.it+1,Array.prototype.push.apply(this.H,t),this.it+=t.length},n.tryShrink=function(){var t=this.it+1;if(!(t<=this.tt)){var i;if(i=t>>1>=this.tt?t>>1:Math.floor((t-this.tt+1)/2),this.$)for(var n=this.it-i+1;n<=this.it;++n)this.$(this.H[n]);this.it-=i,this.H.length=this.it+1}},n.destroy=function(){var i=arguments.length>0?arguments[0]:null;i&&st(14100);var n=i||this.$;if(n)for(var r=0;r<=this.it;r++)n(this.H[r]);this.H.length=0,this.it=-1,t.prototype.destroy.call(this)},i}(Be)),Ge=t("b7",function(t){function i(i,n,r){var s;(s=t.call(this)||this).nt=0,s.rt=i,s.$=r||null,s.M=new Array(n),s.st=n;for(var e=0;e<n;++e)s.M[e]=i();return s}e(i,t);var n=i.prototype;return n.reset=function(){this.nt=0},n.resize=function(t){if(t>this.M.length)for(var i=this.M.length;i<t;++i)this.M[i]=this.rt()},n.add=function(){return this.nt>=this.M.length&&this.resize(this.M.length<<1),this.M[this.nt++]},n.destroy=function(){if(this.$)for(var i=0;i<this.M.length;i++)this.$(this.M[i]);this.M.length=0,this.nt=0,t.prototype.destroy.call(this)},n.tryShrink=function(){if(this.M.length>>2>this.nt){var t=Math.max(this.st,this.M.length>>1);if(this.$)for(var i=t;i<this.M.length;i++)this.$(this.M[i]);this.M.length=t}},n.removeAt=function(t){if(!(t>=this.nt)){var i=this.nt-1,n=this.M[t];this.M[t]=this.M[i],this.M[i]=n,this.nt-=1}},r(i,[{key:"length",get:function(){return this.nt}},{key:"data",get:function(){return this.M}}]),i}(Be)),je=t("b8",function(t){function i(i,n){var r;return(r=t.call(this)||this).length=0,r.st=0,r.array=new Array(i),r.st=i,r.et=n,r}e(i,t);var n=i.prototype;return n.push=function(t){this.array[this.length++]=t},n.pop=function(){return this.array[--this.length]},n.get=function(t){return this.array[t]},n.clear=function(){this.length=0},n.destroy=function(){this.length=0,this.array.length=0,t.prototype.destroy.call(this)},n.tryShrink=function(){this.array.length>>2>this.length&&(this.array.length=Math.max(this.st,this.array.length>>1))},n.sort=function(){this.array.length=this.length,this.array.sort(this.et)},n.concat=function(t){for(var i=0;i<t.length;++i)this.array[this.length++]=t[i]},n.fastRemove=function(t){if(!(t>=this.length||t<0)){var i=--this.length;this.array[t]=this.array[i]}},n.indexOf=function(t){for(var i=0,n=this.length;i<n;++i)if(this.array[i]===t)return i;return-1},i}(Be));t("aj",Object.freeze({__proto__:null,CachedArray:je,Pool:xe,RecyclePool:Ge}));var He=t("bA","__editorExtras__"),Ve=t("bu",{Destroyed:1,RealDestroyed:2,ToDestroy:4,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsOnEnableCalled:2048,IsEditorOnEnableCalled:4096,IsPreloadStarted:8192,IsOnLoadCalled:16384,IsOnLoadStarted:32768,IsStartCalled:65536,IsRotationLocked:131072,IsScaleLocked:262144,IsAnchorLocked:524288,IsSizeLocked:1048576,IsPositionLocked:2097152,IsSkipTransformUpdate:16777216,PersistentMask:-4192741,AllHideMasks:1560}),$e=[];function ze(t,i){var n,r=t instanceof O.Node||t instanceof O.Component,s=r?"_id":null,e={};for(n in t)if(t.hasOwnProperty(n)){if(n===s)continue;switch(typeof t[n]){case"string":e[n]="";break;case"object":case"function":e[n]=null}}if(Tn._isCCClass(i))for(var h=O.Class.Attr.getClassAttrs(i),u=i.__props__,o=0;o<u.length;o++){var c=""+(n=u[o]);if(c in h){if(r&&"_id"===n)continue;switch(typeof h[c]){case"string":e[n]="";break;case"object":case"function":e[n]=null;break;case"undefined":e[n]=void 0}}}var a="";for(n in e){var f;f=Tn.IDENTIFIER_RE.test(n)?"o."+n+"=":"o["+Tn.escapeForJS(n)+"]=";var v=e[n];""===v&&(v='""'),a+=f+v+";\n"}return Function("o",a)}var We=t("bt",function(){function t(t){void 0===t&&(t=""),this._objFlags=0,this._name=t}t._deferredDestroy=function(){for(var t=$e.length,i=0;i<t;++i){var n=$e[i];1&n._objFlags||n._destroyImmediate()}t===$e.length?$e.length=0:$e.splice(0,t)};var i=t.prototype;return i.destroy=function(){return 1&this._objFlags?(st(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,$e.push(this),0))},i._destruct=function(){var t,i=this.constructor;Object.prototype.hasOwnProperty.call(i,"__destruct__")?t=i.__destruct__:(t=ze(this,i),Et(i,"__destruct__",t,!0)),t(this)},i._destroyImmediate=function(){var t;1&this._objFlags?ht(5e3):(null==(t=this._onPreDestroy)||t.call(this),this._destruct(),this._objFlags|=1)},r(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"hideFlags",get:function(){return 1560&this._objFlags},set:function(t){var i=1560&t;this._objFlags=-1561&this._objFlags|i}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),t}());We.prototype._deserialize=null,Tn.fastDefine("cc.Object",We,{_name:"",_objFlags:0});var Xe={};for(var Ye in Ve)"string"==typeof Ye&&"number"==typeof Ve[Ye]&&(Xe[Ye]=Ve[Ye]);function Ke(t){return t instanceof We}function qe(t,i){return"object"==typeof t?!(!t||t._objFlags&(i?5:1)):void 0!==t}Et(We,"Flags",Xe),O.isValid=qe,O.Object=We;var Qe=hi;function Je(){}var Ze=function(){function t(){this.callback=Je,this.target=void 0,this.once=!1}var i=t.prototype;return i.set=function(t,i,n){this.callback=t||Je,this.target=i,this.once=!!n},i.reset=function(){this.target=void 0,this.callback=Je,this.once=!1},i.check=function(){return!(Ke(this.target)&&!qe(this.target,!0))},t}(),th=new xe((function(){return new Ze}),32),ih=function(){function t(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var i=t.prototype;return i.removeByCallback=function(t){for(var i=0;i<this.callbackInfos.length;++i){var n=this.callbackInfos[i];n&&n.callback===t&&(n.reset(),th.free(n),Qe(this.callbackInfos,i),--i)}},i.removeByTarget=function(t){for(var i=0;i<this.callbackInfos.length;++i){var n=this.callbackInfos[i];n&&n.target===t&&(n.reset(),th.free(n),Qe(this.callbackInfos,i),--i)}},i.cancel=function(t){var i=this.callbackInfos[t];i&&(i.reset(),this.isInvoking?this.callbackInfos[t]=null:Qe(this.callbackInfos,t),th.free(i)),this.containCanceled=!0},i.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var i=this.callbackInfos[t];i&&(i.reset(),th.free(i),this.callbackInfos[t]=null)}this.containCanceled=!0},i.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||Qe(this.callbackInfos,t);this.containCanceled=!1},i.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},t}(),nh=new xe((function(){return new ih}),16),rh=t("cE",function(){function t(){this._callbackTable=It(!0),this.ht=void 0}var i=t.prototype;return i.on=function(t,i,n,r){if(!this.hasEventListener(t,i,n)){var s=this._callbackTable[t];s||(s=this._callbackTable[t]=nh.alloc());var e=th.alloc();e.set(i,n,r),s.callbackInfos.push(e)}return i},i.hasEventListener=function(t,i,n){var r=this._callbackTable&&this._callbackTable[t];if(!r)return!1;var s=r.callbackInfos;if(!i){if(r.isInvoking){for(var e=0;e<s.length;++e)if(s[e])return!0;return!1}return s.length>0}for(var h=0;h<s.length;++h){var u=s[h];if(u&&u.check()&&u.callback===i&&u.target===n)return!0}return!1},i.removeAll=function(t){var i=typeof t;if("string"===i||"number"===i){var n=this._callbackTable&&this._callbackTable[t];n&&(n.isInvoking?n.cancelAll():(n.clear(),nh.free(n),delete this._callbackTable[t]))}else if(t)for(var r in this._callbackTable){var s=this._callbackTable[r];if(s.isInvoking)for(var e=s.callbackInfos,h=0;h<e.length;++h){var u=e[h];u&&u.target===t&&s.cancel(h)}else s.removeByTarget(t)}},i.off=function(t,i,n){var r,s=this._callbackTable&&this._callbackTable[t];if(s){var e=s.callbackInfos;if(i)for(var h=0;h<e.length;++h){var u=e[h];if(u&&u.callback===i&&u.target===n){s.cancel(h);break}}else this.removeAll(t)}null==(r=this.ht)||r.call(this)},i.emit=function(t,i,n,r,s,e){var h=this._callbackTable&&this._callbackTable[t];if(h){var u=!h.isInvoking;h.isInvoking=!0;for(var o=h.callbackInfos,c=0,a=o.length;c<a;++c){var f=o[c];if(f){var v=f.callback,l=f.target;f.once&&this.off(t,v,l),f.check()?l?v.call(l,i,n,r,s,e):v(i,n,r,s,e):this.off(t,v,l)}}u&&(h.isInvoking=!1,h.containCanceled&&h.purgeCanceled())}},i.clear=function(){for(var t in this._callbackTable){var i=this._callbackTable[t];i&&(i.clear(),nh.free(i),delete this._callbackTable[t])}},i.ut=function(t){this.ht=t},t}());function sh(t){for(var i=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._callbackTable=It(!0),i}e(i,t);var n=i.prototype;return n.once=function(t,i,n){return this.on(t,i,n,!0)},n.targetOff=function(t){this.removeAll(t)},i}(t),n=rh.prototype,r=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),s=0;s<r.length;++s){var h=r[s];if(!(h in i.prototype)){var u=Object.getOwnPropertyDescriptor(n,h);u&&Object.defineProperty(i.prototype,h,u)}}return i}var eh=t("bF",sh((function(){})));O.EventTarget=eh;var hh,uh,oh,ch,ah,fh,vh=t("bH",function(){function t(){this.ot=[]}var i=t.prototype;return i.add=function(t){this.ot.includes(t)||this.ot.push(t)},i.hasListener=function(t){return this.ot.includes(t)},i.remove=function(t){oi(this.ot,t)},i.dispatch=function(){for(var t=arguments,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return Promise.all(this.ot.map((function(i){return i.apply(void 0,t)})).filter(Boolean))},t}());!function(t){t.UNKNOWN="unknown",t.WECHAT="wechat",t.ANDROID="androidbrowser",t.IE="ie",t.EDGE="edge",t.QQ="qqbrowser",t.MOBILE_QQ="mqqbrowser",t.UC="ucbrowser",t.UCBS="ucbs",t.BROWSER_360="360browser",t.BAIDU_APP="baiduboxapp",t.BAIDU="baidubrowser",t.MAXTHON="maxthon",t.OPERA="opera",t.OUPENG="oupeng",t.MIUI="miuibrowser",t.FIREFOX="firefox",t.SAFARI="safari",t.CHROME="chrome",t.LIEBAO="liebao",t.QZONE="qzone",t.SOUGOU="sogou",t.HUAWEI="huawei"}(hh||(hh={})),function(t){t.UNKNOWN="unknown",t.ENGLISH="en",t.CHINESE="zh",t.FRENCH="fr",t.ITALIAN="it",t.GERMAN="de",t.SPANISH="es",t.DUTCH="du",t.RUSSIAN="ru",t.KOREAN="ko",t.JAPANESE="ja",t.HUNGARIAN="hu",t.PORTUGUESE="pt",t.ARABIC="ar",t.NORWEGIAN="no",t.POLISH="pl",t.TURKISH="tr",t.UKRAINIAN="uk",t.ROMANIAN="ro",t.BULGARIAN="bg",t.HINDI="hi"}(uh||(uh={})),function(t){t[t.NONE=0]="NONE",t[t.LAN=1]="LAN",t[t.WWAN=2]="WWAN"}(oh||(oh={})),function(t){t.UNKNOWN="Unknown",t.IOS="iOS",t.ANDROID="Android",t.WINDOWS="Windows",t.LINUX="Linux",t.OSX="OS X",t.OHOS="OHOS",t.OPENHARMONY="OpenHarmony"}(ch||(ch={})),function(t){t.UNKNOWN="UNKNOWN",t.EDITOR_PAGE="EDITOR_PAGE",t.EDITOR_CORE="EDITOR_CORE",t.MOBILE_BROWSER="MOBILE_BROWSER",t.DESKTOP_BROWSER="DESKTOP_BROWSER",t.WIN32="WIN32",t.ANDROID="ANDROID",t.IOS="IOS",t.MACOS="MACOS",t.OHOS="OHOS",t.OPENHARMONY="OPENHARMONY",t.WECHAT_GAME="WECHAT_GAME",t.WECHAT_MINI_PROGRAM="WECHAT_MINI_PROGRAM",t.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",t.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",t.TAOBAO_CREATIVE_APP="TAOBAO_CREATIVE_APP",t.TAOBAO_MINI_GAME="TAOBAO_MINI_GAME",t.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",t.OPPO_MINI_GAME="OPPO_MINI_GAME",t.VIVO_MINI_GAME="VIVO_MINI_GAME",t.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",t.MIGU_MINI_GAME="MIGU_MINI_GAME",t.HONOR_MINI_GAME="HONOR_MINI_GAME"}(ah||(ah={})),function(t){t.WEBP="WEBP",t.IMAGE_BITMAP="IMAGE_BITMAP",t.WEB_VIEW="WEB_VIEW",t.VIDEO_PLAYER="VIDEO_PLAYER",t.SAFE_AREA="SAFE_AREA",t.HPE="HPE",t.INPUT_TOUCH="INPUT_TOUCH",t.EVENT_KEYBOARD="EVENT_KEYBOARD",t.EVENT_MOUSE="EVENT_MOUSE",t.EVENT_TOUCH="EVENT_TOUCH",t.EVENT_ACCELEROMETER="EVENT_ACCELEROMETER",t.EVENT_GAMEPAD="EVENT_GAMEPAD",t.EVENT_HANDLE="EVENT_HANDLE",t.EVENT_HMD="EVENT_HMD",t.EVENT_HANDHELD="EVENT_HANDHELD",t.WASM="WASM"}(fh||(fh={}));var lh,dh=function(t){function i(){var i,n;(n=t.call(this)||this).ct=null,n.ft=[];var r,s=window.navigator,e=s.userAgent.toLowerCase();null==s.getBattery||s.getBattery().then((function(t){n.ct=t})),n.networkType=oh.LAN,n.isNative=!1,n.isBrowser=!0,n.isMobile=/mobile|android|iphone|ipad/.test(e),n.platform=n.isMobile?ah.MOBILE_BROWSER:ah.DESKTOP_BROWSER,n.isLittleEndian=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0]);var h=s.language;n.nativeLanguage=h.toLowerCase(),h=(h=h||s.browserLanguage)?h.split("-")[0]:uh.ENGLISH,n.language=h;var u=!1,o=!1,c="",a=0,f=/android\s*(\d+(?:\.\d+)*)/i.exec(e)||/android\s*(\d+(?:\.\d+)*)/i.exec(s.platform);f&&(u=!0,c=f[1]||"",a=parseInt(c)||0),(f=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(e))?(o=!0,c=f[2]||"",a=parseInt(c)||0):(/(iPhone|iPad|iPod)/.exec(s.platform)||"MacIntel"===s.platform&&s.maxTouchPoints&&s.maxTouchPoints>1)&&(o=!0,c="",a=0);var v=ch.UNKNOWN;-1!==s.appVersion.indexOf("Win")?v=ch.WINDOWS:o?v=ch.IOS:-1!==s.appVersion.indexOf("Mac")?v=ch.OSX:-1!==s.appVersion.indexOf("X11")&&-1===s.appVersion.indexOf("Linux")?v=ch.LINUX:u?v=ch.ANDROID:-1===s.appVersion.indexOf("Linux")&&-1===e.indexOf("ubuntu")||(v=ch.LINUX),n.os=v,n.osVersion=c,n.osMainVersion=a,n.browserType=hh.UNKNOWN;var l=/wechat|weixin|micromessenger/i.exec(e)||/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(e)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(e)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(e),d=l?l[0].toLowerCase():ch.UNKNOWN;("safari"===d&&u||"qq"===d&&/android.*applewebkit/i.test(e))&&(d=hh.ANDROID);var w={micromessenger:hh.WECHAT,wechat:hh.WECHAT,weixin:hh.WECHAT,trident:hh.IE,edge:hh.EDGE,"360 aphone":hh.BROWSER_360,mxbrowser:hh.MAXTHON,"opr/":hh.OPERA,ubrowser:hh.UC,huaweibrowser:hh.HUAWEI};n.browserType=w[d]||d,n.browserVersion="";var g=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(e);g||(g=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(e)),n.browserVersion=g?g[4]:"",n.isXR=!1;var p,_=document.createElement("canvas");_.getContext("2d");try{p=_.toDataURL("image/webp").startsWith("data:image/webp")}catch(t){p=!1}if(n.os===ch.IOS){var y,m=null==(y=/ applewebkit\/(\d+)/.exec(e))?void 0:y[1];"string"==typeof m&&Number.parseInt(m)>=604&&(p=!0)}else if(n.browserType===hh.SAFARI){var A,E=null==(A=/ version\/(\d+)/.exec(e))?void 0:A[1];"string"==typeof E&&Number.parseInt(E)>=14&&(p=!0)}var T=void 0!==document.documentElement.ontouchstart||void 0!==document.ontouchstart||b,O=void 0!==document.documentElement.onmouseup||b,S=void 0!==navigator.xr,I=function(){if((n.os===ch.IOS||n.os===ch.OSX)&&/(OS 15_4)|(Version\/15.4)/.test(window.navigator.userAgent))return!1;try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0]));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){return!1}return!1}();return n.vt=((i={})[fh.WEBP]=p,i[fh.IMAGE_BITMAP]=!1,i[fh.WEB_VIEW]=!0,i[fh.VIDEO_PLAYER]=!0,i[fh.SAFE_AREA]=!1,i[fh.HPE]=!1,i[fh.INPUT_TOUCH]=T,i[fh.EVENT_KEYBOARD]=void 0!==document.documentElement.onkeyup||b,i[fh.EVENT_MOUSE]=O,i[fh.EVENT_TOUCH]=T||O,i[fh.EVENT_ACCELEROMETER]=void 0!==window.DeviceMotionEvent||void 0!==window.DeviceOrientationEvent,i[fh.EVENT_GAMEPAD]=void 0!==navigator.getGamepads||void 0!==navigator.webkitGetGamepads||S,i[fh.EVENT_HANDLE]=k,i[fh.EVENT_HMD]=S,i[fh.EVENT_HANDHELD]=S,i[fh.WASM]=I,i),n.ft.push(n.lt()),n.dt(),n}e(i,t);var n=i.prototype;return n.lt=function(){var t=this;if("undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob){var i=document.createElement("canvas");i.width=i.height=2;var n=createImageBitmap(i);if(n instanceof Promise)return n.then((function(i){i&&i.close&&(t.wt(fh.IMAGE_BITMAP,!0),i.close())}))}return Promise.resolve()},n.dt=function(){var t,i=this;t=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":"hidden";var n=!1,r=function(){n||(n=!0,i.emit("hide"))},s=function(t,r,s,e,h){n&&(n=!1,i.emit("show",t,r,s,e,h))};if(t)for(var e=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],h=0;h<e.length;h++)document.addEventListener(e[h],(function(i){var n=document[t];(n=n||i.hidden)?r():s()}));else window.addEventListener("blur",r),window.addEventListener("focus",s);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(window.onfocus=s),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pagehide",r),window.addEventListener("pageshow",s),document.addEventListener("pagehide",r),document.addEventListener("pageshow",s))},n.wt=function(t,i){return this.vt[t]=i},n.init=function(){return Promise.all(this.ft)},n.hasFeature=function(t){return this.vt[t]},n.getBatteryLevel=function(){return this.ct?this.ct.level:1},n.triggerGC=function(){},n.openURL=function(t){window.open(t)},n.now=function(){return Date.now?Date.now():+new Date},n.restartJSVM=function(){},n.exit=function(){window.close()},n.close=function(){this.emit("close")},i}(eh),wh=new dh,gh={auto:Ti.AUTO,landscape:Ti.LANDSCAPE,portrait:Ti.PORTRAIT};!function(t){t[t.Unknown=0]="Unknown",t[t.SubFrame=1]="SubFrame",t[t.BrowserWindow=2]="BrowserWindow",t[t.Fullscreen=3]="Fullscreen"}(lh||(lh={}));var ph=function(t){e(n,t);var i=n.prototype;function n(){var i,n,r,s,e,h;(i=t.call(this)||this).isFrameRotated=!1,i.handleResizeEvent=!0,i.gt=void 0,i._t=void 0,i.yt=void 0,i.bt=!1,i.kt={width:"0px",height:"0px"},i.At={width:"0px",height:"0px"},i.Et=void 0,i.Tt=!1,i.Ot=void 0,i.St=void 0,i.It=void 0,i.Rt=-1,i.Mt=new ie(0,0),i.Ct=!1,i.Nt=!1,i.rt={},i.Pt=[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],i.Lt=1,i.Dt=Ti.AUTO,i.Bt=Ti.AUTO,i.gt=document.getElementById("GameDiv"),i._t=document.getElementById("Cocos3dGameContainer"),i.yt=document.getElementById("GameCanvas"),i.gt||(i.gt=document.createElement("div"),i.gt.setAttribute("id","GameDiv"),null==(n=i.yt)||null==(r=n.parentNode)||r.insertBefore(i.gt,i.yt),i.gt.appendChild(i.yt)),i._t||(i._t=document.createElement("div"),i._t.setAttribute("id","Cocos3dGameContainer"),null==(s=i.yt)||null==(e=s.parentNode)||e.insertBefore(i._t,i.yt),i._t.appendChild(i.yt));for(var u=i.Pt,o=0;o<u.length;o++)if(h=u[o],void 0!==document[h[1]]){for(var c=0;c<h.length;c++)i.rt[u[0][c]]=h[c];break}return i.Tt=void 0!==i.rt.requestFullscreen,i.Ot="ontouchstart"in window?"touchend":"mousedown",i.dt(),i}return i.Ft=function(){this.Ut(),this.xt()},i.init=function(t,i){this.Et=i,this.orientation=gh[t.configOrientation],this.Ct=t.exactFitScreen,this.Nt=t.isHeadlessMode,this.xt()},i.requestFullScreen=function(){var t=this;return new Promise((function(i,n){t.isFullScreen?i():(t.Mt=t.windowSize,t.Gt().then((function(){i()})).catch((function(){var r=t.jt();r?r.addEventListener(t.Ot,(function(){t.Gt().then((function(){i()})).catch(n)}),{once:!0,capture:!0}):n(new Error("Cannot access fullscreen target"))})))}))},i.exitFullScreen=function(){var t=this;return new Promise((function(i,n){var r=document[t.rt.exitFullscreen]();window.Promise&&r instanceof Promise?r.then((function(){t.windowSize=t.Mt,i()})).catch(n):(t.windowSize=t.Mt,i())}))},i.dt=function(){var t=this;document.addEventListener(this.rt.fullscreenerror,(function(){null==t.It||t.It()})),window.addEventListener("resize",(function(){t.Ft()}));var i,n=function(i){i!==t.Bt&&(t.Bt=i,t.Ft(),t.emit("orientation-change",i))},r=function(){var i=Ti.PORTRAIT;switch(window.orientation){case 0:i=Ti.PORTRAIT;break;case 90:i=Ti.LANDSCAPE_RIGHT;break;case-90:i=Ti.LANDSCAPE_LEFT;break;case 180:i=Ti.PORTRAIT_UPSIDE_DOWN;break;default:i=t.Bt}return i},s=function(){-1!==t.Rt&&clearTimeout(t.Rt),t.Rt=setTimeout((function(){i()}),200)};if("function"==typeof window.matchMedia){!function i(){var n=window.devicePixelRatio,r=window.matchMedia("(resolution: "+n+"dppx)");r.addEventListener?r.addEventListener("change",(function(){t.emit("window-resize",t.windowSize.width,t.windowSize.height),i()}),{once:!0}):r.addListener&&r.addListener((function(){t.emit("window-resize",t.windowSize.width,t.windowSize.height)}))}();var e=window.matchMedia("(orientation: portrait)"),h=window.matchMedia("(orientation: landscape)"),u=screen.orientation;i=function(){var i=t.Bt;e.matches?(i=Ti.PORTRAIT,u&&(i="portrait-primary"===screen.orientation.type?Ti.PORTRAIT:Ti.PORTRAIT_UPSIDE_DOWN)):h.matches&&(i=Ti.LANDSCAPE,u&&(i="landscape-primary"===screen.orientation.type?Ti.LANDSCAPE_LEFT:Ti.LANDSCAPE_RIGHT)),n(i)},e.addEventListener?(e.addEventListener("change",s),h.addEventListener("change",s)):e.addListener&&(e.addListener(s),h.addListener(s))}else i=function(){var t=r();n(t)},window.addEventListener("orientationchange",s);document.addEventListener(this.rt.fullscreenchange,(function(){null==t.St||t.St(),t.emit("fullscreen-change",t.windowSize.width,t.windowSize.height)}))},i.Ht=function(t){var i=t.clone(),n=this.devicePixelRatio;return i.width/=n,i.height/=n,i},i.xt=function(t){if(this.gt){if(this.gt.style.display="flex",this.gt.style["justify-content"]="center",this.gt.style["align-items"]="center",this._windowType===lh.SubFrame){if(!t)return void this.Vt();this.gt.style.width=t.width+"px",this.gt.style.height=t.height+"px"}else{var i=window.innerWidth,n=window.innerHeight,r=document.body.scrollHeight-n;wh.os===ch.ANDROID&&n<r&&(n+=r),this.isFrameRotated?(this.gt.style["-webkit-transform"]="rotate(90deg)",this.gt.style.transform="rotate(90deg)",this.gt.style["-webkit-transform-origin"]="0px 0px 0px",this.gt.style.transformOrigin="0px 0px 0px",this.gt.style.margin="0 0 0 "+i+"px",this.gt.style.width=n+"px",this.gt.style.height=i+"px"):(this.gt.style["-webkit-transform"]="rotate(0deg)",this.gt.style.transform="rotate(0deg)",this.gt.style.margin="0px auto",this.gt.style.width=i+"px",this.gt.style.height=n+"px")}this.Vt()}},i.jt=function(){var t=this._windowType;return t===lh.Fullscreen?document[this.rt.fullscreenElement]:t===lh.SubFrame?this.gt:document.body},i.Gt=function(){var t=this;return new Promise((function(i,n){if(t.Tt){var r=t.jt();if(r){t.St=void 0,t.It=void 0;var s=r[t.rt.requestFullscreen]();window.Promise&&s instanceof Promise?s.then(i).catch(n):(t.St=i,t.It=n)}else n(new Error("Cannot access fullscreen target"))}else n(new Error("fullscreen is not supported"))}))},i.Ut=function(){var t=this.orientation,i=window.innerWidth>window.innerHeight;this.isFrameRotated=wh.isMobile&&(i&&t===Ti.PORTRAIT||!i&&t===Ti.LANDSCAPE)},i.Vt=function(){if(this._t){if(this.isProportionalToFrame){if(!this.gt)return void st(9201);var t,i,n=O.view.getDesignResolutionSize(),r=this.gt,s=r.clientWidth,e=r.clientHeight,h=n.width,u=n.height,o=s/h,c=e/u,a=this._t.style;o<c?(t=s,i=u*o):(t=h*c,i=e),a.width=t+"px",a.height=i+"px"}else{var f=this._t.style;f.width="100%",f.height="100%"}!this.gt||this.kt.width===this.gt.style.width&&this.kt.height===this.gt.style.height&&this.At.width===this._t.style.width&&this.At.height===this._t.style.height||(this.emit("window-resize",this.windowSize.width,this.windowSize.height),this.kt.width=this.gt.style.width,this.kt.height=this.gt.style.height,this.At.width=this._t.style.width,this.At.height=this._t.style.height)}else st(9201)},r(n,[{key:"supportFullScreen",get:function(){return this.Tt}},{key:"isFullScreen",get:function(){return!!this.Tt&&!!document[this.rt.fullscreenElement]}},{key:"devicePixelRatio",get:function(){var t;return Math.min(null!==(t=window.devicePixelRatio)&&void 0!==t?t:1,2)}},{key:"windowSize",get:function(){var t=this._windowSizeInCssPixels,i=this.devicePixelRatio;return t.width*=i,t.height*=i,t},set:function(t){this._windowType===lh.SubFrame?this.xt(this.Ht(t)):st(9202)}},{key:"resolution",get:function(){var t=this.windowSize,i=this.resolutionScale;return new ie(t.width*i,t.height*i)}},{key:"resolutionScale",get:function(){return this.Lt},set:function(t){var i;t!==this.Lt&&(this.Lt=t,null==(i=this.Et)||i.call(this))}},{key:"orientation",get:function(){return this.Dt},set:function(t){this.Dt!==t&&(this.Dt=t,this.Ft())}},{key:"safeAreaEdge",get:function(){var t=this.devicePixelRatio;return{top:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top")||"0")*t,bottom:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-bottom")||"0")*t,left:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-left")||"0")*t,right:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-right")||"0")*t}}},{key:"isProportionalToFrame",get:function(){return this.bt},set:function(t){this.bt!==t&&(this.bt=t,this.Vt())}},{key:"_windowSizeInCssPixels",get:function(){if(this.isProportionalToFrame)return this._t?new ie(this._t.clientWidth,this._t.clientHeight):(st(9201),new ie(0,0));var t,i,n;switch(this._windowType){case lh.SubFrame:return this.gt?new ie(this.gt.clientWidth,this.gt.clientHeight):(st(9201),new ie(0,0));case lh.Fullscreen:return t=this.jt(),i=this.isFrameRotated?t.clientHeight:t.clientWidth,n=this.isFrameRotated?t.clientWidth:t.clientHeight,new ie(i,n);case lh.BrowserWindow:return i=this.isFrameRotated?window.innerHeight:window.innerWidth,n=this.isFrameRotated?window.innerWidth:window.innerHeight,new ie(i,n);case lh.Unknown:default:return new ie(1,1)}}},{key:"_windowType",get:function(){return this.Nt?lh.Unknown:this.isFullScreen?lh.Fullscreen:this.gt?this.Ct?lh.BrowserWindow:lh.SubFrame:(st(9201),lh.Unknown)}}]),n}(eh),_h=new ph,yh=function(){function t(){}var i=t.prototype;return i.init=function(){var t,i,n=null===(t=Oi.querySettings("screen","exactFitScreen"))||void 0===t||t,r=null!==(i=Oi.querySettings("screen","orientation"))&&void 0!==i?i:"auto",s=3===Oi.querySettings("rendering","renderMode");_h.init({exactFitScreen:n,configOrientation:r,isHeadlessMode:s},(function(){var t,i=O.director;null!=(t=i.root)&&t.pipeline?i.root.pipeline.shadingScale=_h.resolutionScale:st(1220)}))},i.fullScreen=function(){return _h.isFullScreen},i.requestFullScreen=function(t,i,n){return arguments.length>0&&st(1400,"screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)","screen.requestFullScreen(): Promise"),_h.requestFullScreen().then((function(){null==i||i.call(document)})).catch((function(t){X(t),null==n||n.call(document)}))},i.exitFullScreen=function(){return _h.exitFullScreen()},i.autoFullScreen=function(t,i){var n;null==(n=this.requestFullScreen(t,i))||n.catch((function(t){W(t)}))},i.disableAutoFullScreen=function(){},i.on=function(t,i,n){_h.on(t,i,n)},i.once=function(t,i,n){_h.once(t,i,n)},i.off=function(t,i,n){_h.off(t,i,n)},r(t,[{key:"devicePixelRatio",get:function(){return _h.devicePixelRatio}},{key:"windowSize",get:function(){return _h.windowSize},set:function(t){_h.windowSize=t}},{key:"resolution",get:function(){return _h.resolution}},{key:"supportsFullScreen",get:function(){return _h.supportFullScreen}}]),t}(),mh=t("bW",new yh);O.screen=mh;var bh=t("bX",{Feature:fh,hasFeature:function(t){return wh.hasFeature(t)},NetworkType:oh,Language:uh,OS:ch,Platform:ah,BrowserType:hh,isNative:wh.isNative,isBrowser:wh.isBrowser,isMobile:wh.isMobile,isLittleEndian:wh.isLittleEndian,platform:wh.platform,language:wh.language,languageCode:wh.nativeLanguage,os:wh.os,osVersion:wh.osVersion,osMainVersion:wh.osMainVersion,browserType:wh.browserType,browserVersion:wh.browserVersion,isXR:wh.isXR,windowPixelResolution:mh.windowSize,capabilities:{canvas:!0,opengl:!0,webp:wh.hasFeature(fh.WEBP),imageBitmap:wh.hasFeature(fh.IMAGE_BITMAP),touches:wh.hasFeature(fh.INPUT_TOUCH),mouse:wh.hasFeature(fh.EVENT_MOUSE),keyboard:wh.hasFeature(fh.EVENT_KEYBOARD),accelerometer:wh.hasFeature(fh.EVENT_ACCELEROMETER)},localStorage:{},getNetworkType:function(){return wh.networkType},getBatteryLevel:function(){return wh.getBatteryLevel()},garbageCollect:function(){wh.triggerGC()},isObjectValid:function(t){return null!=t},$t:!1,dump:function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="supports webp: "+bh.hasFeature(fh.WEBP)+"\r\n",t+="supports bitmap: "+bh.hasFeature(fh.IMAGE_BITMAP)+"\r\n",t+="supports touches: "+bh.hasFeature(fh.INPUT_TOUCH)+"\r\n",t+="supports mouse: "+bh.hasFeature(fh.EVENT_MOUSE)+"\r\n",t+="supports keyboard: "+bh.hasFeature(fh.EVENT_KEYBOARD)+"\r\n",t+="supports accelerometer: "+bh.hasFeature(fh.EVENT_ACCELEROMETER)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",z(t+="Using "+(O.game.renderType===O.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(t){wh.openURL(t)},init:function(){var t=this;return Promise.resolve().then((function(){return wh.init()})).then((function(){try{var i=bh.localStorage=window.localStorage;i.setItem("storage",""),i.removeItem("storage"),i=null}catch(i){var n=function(){st(5200)};t.localStorage={getItem:n,setItem:n,clear:n,removeItem:n,key:n,length:0}}t.$t=(bh.os===ch.IOS||bh.os===ch.OSX)&&wh.isBrowser&&/(OS 14)|(Version\/14)/.test(window.navigator.userAgent)}))},now:function(){return wh.now()},restartVM:function(){wh.restartJSVM()},getSafeAreaRect:function(t){void 0===t&&(t=!0);var i=O.view,n=_h.safeAreaEdge;t&&(_h.orientation===Si.ORIENTATION_PORTRAIT?n.top<n.bottom?n.top=n.bottom:n.bottom=n.top:n.left<n.right?n.left=n.right:n.right=n.left);var r=_h.windowSize,s=new Ms(n.left,n.bottom),e=new Ms(r.width-n.right,r.height-n.top);i.zt(s),i.zt(e);var h=s.x,u=s.y,o=e.x-s.x,c=e.y-s.y;return new ee(h,u,o,c)}});O.sys=bh;var kh=t("bZ",{topLeft:O.v2(0,0),topRight:O.v2(0,0),top:O.v2(0,0),bottomLeft:O.v2(0,0),bottomRight:O.v2(0,0),bottom:O.v2(0,0),center:O.v2(0,0),left:O.v2(0,0),right:O.v2(0,0),width:0,height:0,init:function(t){var i=this.width=t.width,n=this.height=t.height,r=t.x,s=t.y,e=s+n,h=r+i;this.topLeft.x=r,this.topLeft.y=e,this.topRight.x=h,this.topRight.y=e,this.top.x=r+i/2,this.top.y=e,this.bottomLeft.x=r,this.bottomLeft.y=s,this.bottomRight.x=h,this.bottomRight.y=s,this.bottom.x=r+i/2,this.bottom.y=s,this.center.x=r+i/2,this.center.y=s+n/2,this.left.x=r,this.left.y=s+n/2,this.right.x=h,this.right.y=s+n/2}});O.visibleRect=kh;var Ah=new Ir,Eh=new Ir,Th=new Ir,Oh=new Ir,Sh=new Dr,Ih=Math.abs,Rh=function(t,i,n){Sh.m00=Ih(n.m00),Sh.m01=Ih(n.m01),Sh.m02=Ih(n.m02),Sh.m03=Ih(n.m04),Sh.m04=Ih(n.m05),Sh.m05=Ih(n.m06),Sh.m06=Ih(n.m08),Sh.m07=Ih(n.m09),Sh.m08=Ih(n.m10),Ir.transformMat3(t,i,Sh)},Mh=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=1),void 0===e&&(e=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=8,this.center=new Ir(t,i,n),this.halfExtents=new Ir(r,s,e)}t.create=function(i,n,r,s,e,h){return new t(i,n,r,s,e,h)},t.clone=function(i){return new t(i.center.x,i.center.y,i.center.z,i.halfExtents.x,i.halfExtents.y,i.halfExtents.z)},t.copy=function(t,i){return Ir.copy(t.center,i.center),Ir.copy(t.halfExtents,i.halfExtents),t},t.fromPoints=function(t,i,n){return Ir.add(Ah,n,i),Ir.subtract(Eh,n,i),Ir.multiplyScalar(t.center,Ah,.5),Ir.multiplyScalar(t.halfExtents,Eh,.5),t},t.set=function(t,i,n,r,s,e,h){return t.center.set(i,n,r),t.halfExtents.set(s,e,h),t},t.merge=function(i,n,r){return Ir.subtract(Ah,n.center,n.halfExtents),Ir.subtract(Eh,r.center,r.halfExtents),Ir.add(Th,n.center,n.halfExtents),Ir.add(Oh,r.center,r.halfExtents),Ir.max(Oh,Th,Oh),Ir.min(Th,Ah,Eh),t.fromPoints(i,Th,Oh)},t.toBoundingSphere=function(t,i){return t.center.set(i.center),t.radius=i.halfExtents.length(),t},t.transform=function(t,i,n){return Ir.transformMat4(t.center,i.center,n),Rh(t.halfExtents,i.halfExtents,n),t};var i=t.prototype;return i.getBoundary=function(t,i){Ir.subtract(t,this.center,this.halfExtents),Ir.add(i,this.center,this.halfExtents)},i.transform=function(t,i,n,r,s){Ir.transformMat4(s.center,this.center,t),Rh(s.halfExtents,this.halfExtents,t)},i.clone=function(){var i=this.center,n=this.halfExtents;return new t(i.x,i.y,i.z,n.x,n.y,n.z)},i.copy=function(t){return Ir.copy(this.center,t.center),Ir.copy(this.halfExtents,t.halfExtents),this},i.mergePoint=function(t){this.getBoundary(Ah,Eh),t.x<Ah.x&&(Ah.x=t.x),t.y<Ah.y&&(Ah.y=t.y),t.z<Ah.z&&(Ah.z=t.z),t.x>Eh.x&&(Eh.x=t.x),t.y>Eh.y&&(Eh.y=t.y),t.z>Eh.z&&(Eh.z=t.z),Ir.add(Th,Ah,Eh),this.center.set(Ir.multiplyScalar(Th,Th,.5)),this.halfExtents.set(Eh.x-Th.x,Eh.y-Th.y,Eh.z-Th.z)},i.mergePoints=function(t){if(!(t.length<1))for(var i=0;i<t.length;i++)this.mergePoint(t[i])},i.mergeFrustum=function(t){this.mergePoints(t.vertices)},r(t,[{key:"type",get:function(){return this._type}}]),t}(),Ch=function(){function t(t,i,n){void 0===t&&(t=.5),void 0===i&&(i=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=512,this.radius=t,this.halfHeight=i,this.axis=n,this.center=new Ir,this.rotation=new Qr,this.ellipseCenter0=new Ir(0,i,0),this.ellipseCenter1=new Ir(0,-i,0),this.updateCache()}var i=t.prototype;return i.transform=function(t,i,n,r,s){var e=r,h=nr(e);s.radius=this.radius*Math.abs(h);var u=(this.halfHeight+this.radius)*Math.abs(e.y)-s.radius;u<0&&(u=0),s.halfHeight=u,Ir.transformMat4(s.center,this.center,t),Qr.multiply(s.rotation,this.rotation,n),s.updateCache()},i.updateCache=function(){this.updateLocalCenter(),Ir.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Ir.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},i.updateLocalCenter=function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}},r(t,[{key:"type",get:function(){return this._type}}]),t}(),Nh=new Array(8);Nh[0]=Rr(1,1,1),Nh[1]=Rr(-1,1,1),Nh[2]=Rr(-1,-1,1),Nh[3]=Rr(1,-1,1),Nh[4]=Rr(1,1,-1),Nh[5]=Rr(-1,1,-1),Nh[6]=Rr(-1,-1,-1),Nh[7]=Rr(1,-1,-1);var Ph,Lh,Dh,Bh,Fh,Uh=Rr(),xh=Rr(),Gh=Rr(),jh=Se.fromPoints,Hh=Ir.set,Vh=Ir.transformMat4,$h=function(){i.createOrthographic=function(t,i,n,r,s,e){var h=i/2,u=n/2;Hh(Gh,h,u,-r),Vh(t.vertices[0],Gh,e),Hh(Gh,-h,u,-r),Vh(t.vertices[1],Gh,e),Hh(Gh,-h,-u,-r),Vh(t.vertices[2],Gh,e),Hh(Gh,h,-u,-r),Vh(t.vertices[3],Gh,e),Hh(Gh,h,u,-s),Vh(t.vertices[4],Gh,e),Hh(Gh,-h,u,-s),Vh(t.vertices[5],Gh,e),Hh(Gh,-h,-u,-s),Vh(t.vertices[6],Gh,e),Hh(Gh,h,-u,-s),Vh(t.vertices[7],Gh,e),t.updatePlanes()},i.createOrtho=function(t,n,r,s,e,h){return i.createOrthographic(t,n,r,s,e,h)},i.createPerspective=function(t,i,n,r,s,e){var h=Math.tan(.5*n),u=h*i;Uh.set(r*u,r*h,r),xh.set(s*u,s*h,s);var o=t.vertices;Gh.set(Uh.x,Uh.y,-Uh.z),Vh(o[0],Gh,e),Gh.set(-Uh.x,Uh.y,-Uh.z),Vh(o[1],Gh,e),Gh.set(-Uh.x,-Uh.y,-Uh.z),Vh(o[2],Gh,e),Gh.set(Uh.x,-Uh.y,-Uh.z),Vh(o[3],Gh,e),Gh.set(xh.x,xh.y,-xh.z),Vh(o[4],Gh,e),Gh.set(-xh.x,xh.y,-xh.z),Vh(o[5],Gh,e),Gh.set(-xh.x,-xh.y,-xh.z),Vh(o[6],Gh,e),Gh.set(xh.x,-xh.y,-xh.z),Vh(o[7],Gh,e),t.updatePlanes()},i.createFromAABB=function(t,i){var n=new Ir,r=new Ir;Ir.subtract(n,i.center,i.halfExtents),Ir.add(r,i.center,i.halfExtents);var s=t.vertices;return s[0].set(r.x,r.y,-n.z),s[1].set(n.x,r.y,-n.z),s[2].set(n.x,n.y,-n.z),s[3].set(r.x,n.y,-n.z),s[4].set(r.x,r.y,-r.z),s[5].set(n.x,r.y,-r.z),s[6].set(n.x,n.y,-r.z),s[7].set(r.x,n.y,-r.z),t.updatePlanes(),t};var t=i.prototype;function i(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=128,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=Se.create(0,0,0,0);this.vertices=new Array(8);for(var i=0;i<8;++i)this.vertices[i]=new Ir}return t.split=function(t,n,r,s,e){return i.createPerspective(this,r,s,t,n,e)},i.create=function(){return new i},i.clone=function(t){return i.copy(new i,t)},i.copy=function(t,i){t._type=i.type;for(var n=0;n<6;++n)Se.copy(t.planes[n],i.planes[n]);for(var r=0;r<8;++r)Ir.copy(t.vertices[r],i.vertices[r]);return t},t.update=function(t,i){var n=this.planes;Hh(n[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),n[0].d=-(t.m15+t.m12),Hh(n[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),n[1].d=-(t.m15-t.m12),Hh(n[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),n[2].d=-(t.m15+t.m13),Hh(n[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),n[3].d=-(t.m15-t.m13),Hh(n[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),n[4].d=-(t.m15+t.m14),Hh(n[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),n[5].d=-(t.m15-t.m14);for(var r=0;r<6;r++){var s=n[r],e=1/s.n.length();Ir.multiplyScalar(s.n,s.n,e),s.d*=e}for(var h=0;h<8;h++)Vh(this.vertices[h],Nh[h],i)},t.transform=function(t){for(var i=0;i<8;i++)Vh(this.vertices[i],this.vertices[i],t);this.updatePlanes()},t.zero=function(){for(var t=0;t<8;t++)this.vertices[t].set(0,0,0);for(var i=0;i<6;i++)Se.set(this.planes[i],0,0,0,0)},t.updatePlanes=function(){var t=this.planes,i=this.vertices;jh(t[0],i[1],i[6],i[5]),jh(t[1],i[3],i[4],i[7]),jh(t[2],i[6],i[3],i[7]),jh(t[3],i[0],i[5],i[4]),jh(t[4],i[2],i[0],i[3]),jh(t[5],i[7],i[5],i[6])},r(i,[{key:"accurate",set:function(t){this._type=t?256:128}},{key:"type",get:function(){return this._type}}]),i}(),zh=Ir.squaredDistance,Wh=Ir.subtract,Xh=Ir.dot,Yh=Ir.set,Kh=Ir.cross,qh=Ir.multiplyScalar,Qh=Ir.copy,Jh=Ir.add,Zh=Ir.scaleAndAdd,tu=Math.max,iu=Math.min,nu=Math.abs,ru=function(t,i){var n=Xh(t.d,i.n);if(nu(n)<Number.EPSILON)return 0;var r=-_e(t.o,i)/n;return r<0?0:r},su=(Ph=Rr(),Lh=Rr(),Dh=Rr(),Bh=Rr(),Fh=Rr(),function(t,i,n){Wh(Ph,i.b,i.a),Wh(Lh,i.c,i.a),Kh(Dh,t.d,Lh);var r=Xh(Ph,Dh);if(r<Number.EPSILON&&(!n||r>-Number.EPSILON))return 0;var s=1/r;Wh(Bh,t.o,i.a);var e=Xh(Bh,Dh)*s;if(e<0||e>1)return 0;Kh(Fh,Bh,Ph);var h=Xh(t.d,Fh)*s;if(h<0||e+h>1)return 0;var u=Xh(Lh,Fh)*s;return u<0?0:u}),eu=function(){var t=Rr();return function(i,n){var r=n.radius,s=n.center,e=i.o,h=i.d,u=r*r;Wh(t,s,e);var o=t.lengthSqr(),c=Xh(t,h),a=u-(o-c*c);if(a<0)return 0;var f=Math.sqrt(a),v=o<u?c+f:c-f;return v<0?0:v}}(),hu=function(){var t=Rr(),i=Rr();return function(n,r){return Wh(t,r.center,r.halfExtents),Jh(i,r.center,r.halfExtents),uu(n,t,i)}}();function uu(t,i,n){var r=t.o,s=t.d,e=1/s.x,h=1/s.y,u=1/s.z,o=(i.x-r.x)*e,c=(n.x-r.x)*e,a=(i.y-r.y)*h,f=(n.y-r.y)*h,v=(i.z-r.z)*u,l=(n.z-r.z)*u,d=tu(tu(iu(o,c),iu(a,f)),iu(v,l)),w=iu(iu(tu(o,c),tu(a,f)),tu(v,l));return w<0||d>w?0:d>0?d:w}var ou=function(){var t=Rr(),i=Rr(),n=Rr(),r=Rr(),s=Rr(),e=Rr(),h=Rr(),u=new Array(3),o=new Array(3),c=new Array(3),a=new Array(6);return function(f,v){var l=v.halfExtents,d=v.orientation;u[0]=l.x,u[1]=l.y,u[2]=l.z,t=v.center,i=f.o,n=f.d,Yh(r,d.m00,d.m01,d.m02),Yh(s,d.m03,d.m04,d.m05),Yh(e,d.m06,d.m07,d.m08),Wh(h,t,i),o[0]=Xh(r,n),o[1]=Xh(s,n),o[2]=Xh(e,n),c[0]=Xh(r,h),c[1]=Xh(s,h),c[2]=Xh(e,h);for(var w=0;w<3;++w){if(0===o[w]){if(-c[w]-u[w]>0||-c[w]+u[w]<0)return 0;o[w]=1e-7}a[2*w+0]=(c[w]+u[w])/o[w],a[2*w+1]=(c[w]-u[w])/o[w]}var g=tu(tu(iu(a[0],a[1]),iu(a[2],a[3])),iu(a[4],a[5])),p=iu(iu(tu(a[0],a[1]),tu(a[2],a[3])),tu(a[4],a[5]));return p<0||g>p?0:g>0?g:p}}(),cu=function(){var t=Rr(),i=Rr(),n=Rr(),r=Rr(),s=Rr(),e=Rr(),h=Rr(),u=new De;return function(o,c){var a=c.ellipseCenter0,f=c.ellipseCenter1,v=Wh(i,f,a);if(v.length()<Fn)return u.radius=c.radius,u.center.set(c.ellipseCenter0),Xu.raySphere(o,u);var l=o.o,d=Wh(n,l,a),w=Ir.normalize(t,o.d),g=Kh(r,w,v),p=g.lengthSqr();if(0===p){u.radius=c.radius;var _=Wh(s,f,l);return d.lengthSqr()<_.lengthSqr()?u.center.set(a):u.center.set(f),Xu.raySphere(o,u)}var y=Kh(s,d,v),m=v.lengthSqr(),b=2*Xh(g,y),k=c.radius*c.radius,A=b*b-4*p*(y.lengthSqr()-k*m);if(A<0)return 0;var E=(-b-Math.sqrt(A))/(2*p);if(E<0){u.radius=c.radius;var T=Wh(e,f,l);return d.lengthSqr()<T.lengthSqr()?u.center.set(c.ellipseCenter0):u.center.set(c.ellipseCenter1),Xu.raySphere(o,u)}var O=Zh(e,o.o,w,E),S=Wh(h,O,a),I=Xh(S,v)/m;return I>=0&&I<=1?E:I<0?(u.radius=c.radius,u.center.set(c.ellipseCenter0),Xu.raySphere(o,u)):I>1?(u.radius=c.radius,u.center.set(c.ellipseCenter1),Xu.raySphere(o,u)):0}}(),au=function(){var t=Rr();return function(i,n){Wh(t,i.e,i.s);var r=-_e(i.s,n)/Xh(t,n.n);return r<0||r>1?0:r}}(),fu=function(){var t=Rr(),i=Rr(),n=Rr(),r=Rr(),s=Rr(),e=Rr();return function(h,u,o){Wh(t,u.b,u.a),Wh(i,u.c,u.a),Wh(n,h.s,h.e),Kh(s,t,i);var c=Xh(n,s);if(c<=0)return 0;Wh(r,h.s,u.a);var a=Xh(r,s);if(a<0||a>c)return 0;Kh(e,n,r);var f=Xh(i,e);if(f<0||f>c)return 0;var v=-Xh(t,e);if(v<0||f+v>c)return 0;if(o){var l=1/c,d=1-(f*=l)-(v*=l);Yh(o,u.a.x*d+u.b.x*f+u.c.x*v,u.a.y*d+u.b.y*f+u.c.y*v,u.a.z*d+u.b.z*f+u.c.z*v)}return 1}}(),vu=new Ie;function lu(t,i){vu.o.set(t.s),Wh(vu.d,t.e,t.s),vu.d.normalize();var n=hu(vu,i);return n<=t.length()?n:0}function du(t,i){vu.o.set(t.s),Wh(vu.d,t.e,t.s),vu.d.normalize();var n=ou(vu,i);return n<=t.length()?n:0}function wu(t,i){vu.o.set(t.s),Wh(vu.d,t.e,t.s),vu.d.normalize();var n=eu(vu,i);return n<=t.length()?n:0}var gu,pu,_u,yu,mu=(gu=Rr(),pu=Rr(),_u=Rr(),yu=Rr(),function(t,i){return Wh(gu,t.center,t.halfExtents),Jh(pu,t.center,t.halfExtents),Wh(_u,i.center,i.halfExtents),Jh(yu,i.center,i.halfExtents),gu.x<=yu.x&&pu.x>=_u.x&&gu.y<=yu.y&&pu.y>=_u.y&&gu.z<=yu.z&&pu.z>=_u.z});function bu(t,i,n){Yh(n[0],t.x,i.y,i.z),Yh(n[1],t.x,i.y,t.z),Yh(n[2],t.x,t.y,i.z),Yh(n[3],t.x,t.y,t.z),Yh(n[4],i.x,i.y,i.z),Yh(n[5],i.x,i.y,t.z),Yh(n[6],i.x,t.y,i.z),Yh(n[7],i.x,t.y,t.z)}function ku(t,i,n,r,s,e){Yh(e[0],t.x+n.x*i.x+r.x*i.y+s.x*i.z,t.y+n.y*i.x+r.y*i.y+s.y*i.z,t.z+n.z*i.x+r.z*i.y+s.z*i.z),Yh(e[1],t.x-n.x*i.x+r.x*i.y+s.x*i.z,t.y-n.y*i.x+r.y*i.y+s.y*i.z,t.z-n.z*i.x+r.z*i.y+s.z*i.z),Yh(e[2],t.x+n.x*i.x-r.x*i.y+s.x*i.z,t.y+n.y*i.x-r.y*i.y+s.y*i.z,t.z+n.z*i.x-r.z*i.y+s.z*i.z),Yh(e[3],t.x+n.x*i.x+r.x*i.y-s.x*i.z,t.y+n.y*i.x+r.y*i.y-s.y*i.z,t.z+n.z*i.x+r.z*i.y-s.z*i.z),Yh(e[4],t.x-n.x*i.x-r.x*i.y-s.x*i.z,t.y-n.y*i.x-r.y*i.y-s.y*i.z,t.z-n.z*i.x-r.z*i.y-s.z*i.z),Yh(e[5],t.x+n.x*i.x-r.x*i.y-s.x*i.z,t.y+n.y*i.x-r.y*i.y-s.y*i.z,t.z+n.z*i.x-r.z*i.y-s.z*i.z),Yh(e[6],t.x-n.x*i.x+r.x*i.y-s.x*i.z,t.y-n.y*i.x+r.y*i.y-s.y*i.z,t.z-n.z*i.x+r.z*i.y-s.z*i.z),Yh(e[7],t.x-n.x*i.x-r.x*i.y+s.x*i.z,t.y-n.y*i.x-r.y*i.y+s.y*i.z,t.z-n.z*i.x-r.z*i.y+s.z*i.z)}function Au(t,i){for(var n=Xh(i,t[0]),r=n,s=1;s<8;++s){var e=Xh(i,t[s]);n=e<n?e:n,r=e>r?e:r}return[n,r]}var Eu,Tu,Ou,Su,Iu,Ru=function(){for(var t=new Array(15),i=0;i<15;i++)t[i]=Rr();for(var n=new Array(8),r=new Array(8),s=0;s<8;s++)n[s]=Rr(),r[s]=Rr();var e=Rr(),h=Rr();return function(i,s){var u=s.orientation;Yh(t[0],1,0,0),Yh(t[1],0,1,0),Yh(t[2],0,0,1),Yh(t[3],u.m00,u.m01,u.m02),Yh(t[4],u.m03,u.m04,u.m05),Yh(t[5],u.m06,u.m07,u.m08);for(var o=0;o<3;++o)Kh(t[6+3*o],t[o],t[3]),Kh(t[7+3*o],t[o],t[4]),Kh(t[7+3*o],t[o],t[5]);Wh(e,i.center,i.halfExtents),Jh(h,i.center,i.halfExtents),bu(e,h,n),ku(s.center,s.halfExtents,t[3],t[4],t[5],r);for(var c=0;c<15;++c){var a=Au(n,t[c]),f=Au(r,t[c]);if(f[0]>a[1]||a[0]>f[1])return 0}return 1}}(),Mu=function(t,i){var n=t.halfExtents,r=i.n,s=n.x*nu(r.x)+n.y*nu(r.y)+n.z*nu(r.z),e=Xh(r,t.center);return e+s<i.d?-1:e-s>i.d?0:1},Cu=function(t,i){for(var n=i.planes,r=0;r<n.length;r++)if(-1===Mu(t,n[r]))return 0;return 1},Nu=function(){for(var t=new Array(8),i=0,n=0,r=0;r<t.length;r++)t[r]=Rr();return function(r,s){for(var e=s.vertices,h=r.halfExtents,u=0,o=!1,c=0;c<s.planes.length;c++){if(-1===(u=Mu(r,s.planes[c])))return 0;1===u&&(o=!0)}if(!o)return 1;for(var a=0;a<e.length;a++)Wh(t[a],e[a],r.center);i=0,n=0;for(var f=0;f<e.length;f++)t[f].x>h.x?i++:t[f].x<-h.x&&n++;if(i===e.length||n===e.length)return 0;i=0,n=0;for(var v=0;v<e.length;v++)t[v].y>h.y?i++:t[v].y<-h.y&&n++;if(i===e.length||n===e.length)return 0;i=0,n=0;for(var l=0;l<e.length;l++)t[l].z>h.z?i++:t[l].z<-h.z&&n++;return i===e.length||n===e.length?0:1}}(),Pu=(Eu=Rr(),Tu=new Dr,function(t,i){return Wh(Eu,i,t.center),Ir.transformMat3(Eu,Eu,Dr.transpose(Tu,t.orientation)),n=Eu,r=t.halfExtents,nu(n.x)<r.x&&nu(n.y)<r.y&&nu(n.z)<r.z;var n,r}),Lu=(Ou=function(t,i,n,r){return nu(t.x*i+t.y*n+t.z*r)},function(t,i){var n=t.orientation,r=t.halfExtents,s=i.n,e=i.d,h=r.x*Ou(s,n.m00,n.m01,n.m02)+r.y*Ou(s,n.m03,n.m04,n.m05)+r.z*Ou(s,n.m06,n.m07,n.m08),u=Xh(s,t.center);return u+h<e?-1:u-h>e?0:1}),Du=function(t,i){for(var n=i.planes,r=0;r<n.length;r++)if(-1===Lu(t,n[r]))return 0;return 1},Bu=function(){for(var t=new Array(8),i=0,n=0,r=0,s=0;s<t.length;s++)t[s]=Rr();var e=function(t,i,n,r){return t.x*i+t.y*n+t.z*r};return function(s,h){for(var u=s.orientation,o=s.halfExtents,c=h.vertices,a=h.planes,f=0,v=!1,l=0;l<a.length;l++){if(-1===(f=Lu(s,a[l])))return 0;1===f&&(v=!0)}if(!v)return 1;for(var d=0;d<c.length;d++)Wh(t[d],c[d],s.center);n=0,r=0;for(var w=0;w<c.length;w++)(i=e(t[w],u.m00,u.m01,u.m02))>o.x?n++:i<-o.x&&r++;if(n===c.length||r===c.length)return 0;n=0,r=0;for(var g=0;g<c.length;g++)(i=e(t[g],u.m03,u.m04,u.m05))>o.y?n++:i<-o.y&&r++;if(n===c.length||r===c.length)return 0;n=0,r=0;for(var p=0;p<c.length;p++)(i=e(t[p],u.m06,u.m07,u.m08))>o.z?n++:i<-o.z&&r++;return n===c.length||r===c.length?0:1}}(),Fu=function(){for(var t=new Array(15),i=0;i<15;i++)t[i]=Rr();for(var n=new Array(8),r=new Array(8),s=0;s<8;s++)n[s]=Rr(),r[s]=Rr();return function(i,s){var e=i.orientation,h=s.orientation;Yh(t[0],e.m00,e.m01,e.m02),Yh(t[1],e.m03,e.m04,e.m05),Yh(t[2],e.m06,e.m07,e.m08),Yh(t[3],h.m00,h.m01,h.m02),Yh(t[4],h.m03,h.m04,h.m05),Yh(t[5],h.m06,h.m07,h.m08);for(var u=0;u<3;++u)Kh(t[6+3*u],t[u],t[3]),Kh(t[7+3*u],t[u],t[4]),Kh(t[8+3*u],t[u],t[5]);ku(i.center,i.halfExtents,t[0],t[1],t[2],n),ku(s.center,s.halfExtents,t[3],t[4],t[5],r);for(var o=0;o<15;++o){var c=Au(n,t[o]),a=Au(r,t[o]);if(a[0]>c[1]||c[0]>a[1])return 0}return 1}}(),Uu=function(){for(var t=new De,i=Rr(),n=Rr(),r=Rr(),s=new Array(8),e=0;e<8;e++)s[e]=Rr();for(var h=new Array(8),u=0;u<8;u++)h[u]=Rr();return function(e,u){var o=u.ellipseCenter0,c=u.ellipseCenter1,a=u.radius;if(0===zh(o,c))return t.radius=u.radius,t.center.set(o),Xu.sphereOBB(t,e);var f=e.orientation;i.x=f.m00,i.y=f.m01,i.z=f.m02,n.x=f.m03,n.y=f.m04,n.z=f.m05,r.x=f.m06,r.y=f.m07,r.z=f.m08,ku(e.center,e.halfExtents,i,n,r,s);var v=h,l=Qh(v[0],i),d=Qh(v[1],n),w=Qh(v[2],r);Wh(v[3],u.center,e.center).normalize();var g=Wh(v[4],o,c);g.normalize(),Kh(v[5],l,g),Kh(v[6],d,g),Kh(v[7],w,g);for(var p=0;p<8;++p){var _=Au(s,v[p]),y=Xh(v[p],o),m=Xh(v[p],c),b=tu(y,m)+a;if(iu(y,m)-a>_[1]||_[0]>b)return 0}return 1}}(),xu=function(t,i){var n=Xh(i.n,t.center),r=t.radius*i.n.length();return n+r<i.d?-1:n-r>i.d?0:1},Gu=function(t,i){for(var n=i.planes,r=0;r<n.length;r++)if(-1===xu(t,n[r]))return 0;return 1},ju=(Su=Rr(),Iu=[1,-1,1,-1,1,-1],function(t,i){for(var n=0;n<6;n++){var r=i.planes[n],s=t.radius,e=t.center,h=r.n,u=r.d,o=Xh(h,e);if(o+s<u)return 0;if(!(o-s>u)){Jh(Su,e,qh(Su,h,s));for(var c=0;c<6;c++)if(c!==n&&c!==n+Iu[n]){var a=i.planes[c];if(Xh(a.n,Su)<a.d)return 0}}}return 1}),Hu=function(t,i){var n=t.radius+i.radius;return zh(t.center,i.center)<n*n},Vu=function(){var t=Rr();return function(i,n){var r=i.radius;return ye(t,i.center,n),zh(i.center,t)<r*r}}(),$u=function(){var t=Rr();return function(i,n){var r=i.radius;return me(t,i.center,n),zh(i.center,t)<r*r}}(),zu=function(){var t=Rr(),i=Rr();return function(n,r){var s=r.ellipseCenter0,e=r.ellipseCenter1,h=n.center,u=n.radius+r.radius,o=u*u,c=zh(s,e);if(0===c)return zh(h,r.center)<o;Wh(t,h,s),Wh(i,e,s);var a=Xh(t,i)/c;return a<0?zh(h,s)<o:a>1?zh(h,e)<o:(Zh(t,s,i,a),zh(h,t)<o)}}(),Wu=function(){var t=Rr(),i=Rr(),n=Rr(),r=Rr(),s=Rr(),e=Rr();return function(h,u){var o,c,a=h.ellipseCenter0,f=h.ellipseCenter1,v=u.ellipseCenter1,l=u.ellipseCenter0,d=Wh(t,f,a),w=Wh(i,v,l),g=Wh(n,a,l),p=Xh(d,d),_=Xh(d,w),y=Xh(w,w),m=Xh(d,g),b=Xh(w,g),k=p*y-_*_,A=k,E=k;k<Fn?(o=0,A=1,c=b,E=y):(c=p*b-_*m,(o=_*b-y*m)<0?(o=0,c=b,E=y):o>A&&(o=A,c=b+_,E=y)),c<0?(c=0,-m<0?o=0:-m>p?o=A:(o=-m,A=p)):c>E&&(c=E,-m+_<0?o=0:-m+_>p?o=A:(o=-m+_,A=p));var T=nu(o)<Fn?0:o/A,O=nu(c)<Fn?0:c/E,S=r;S.set(g),S.add(qh(s,d,T)),S.subtract(qh(e,w,O));var I=h.radius+u.radius;return S.lengthSqr()<I*I}}(),Xu={raySphere:eu,rayAABB:hu,rayOBB:ou,rayPlane:ru,rayTriangle:su,rayCapsule:cu,raySubMesh:null,rayMesh:null,rayModel:null,lineSphere:wu,lineAABB:lu,lineOBB:du,linePlane:au,lineTriangle:fu,sphereWithSphere:Hu,sphereAABB:Vu,sphereOBB:$u,spherePlane:xu,sphereFrustum:Gu,sphereFrustumAccurate:ju,sphereCapsule:zu,aabbWithAABB:mu,aabbWithOBB:Ru,aabbPlane:Mu,aabbFrustum:Cu,aabbFrustumAccurate:Nu,obbWithOBB:Fu,obbPlane:Lu,obbFrustum:Du,obbFrustumAccurate:Bu,obbPoint:Pu,obbCapsule:Uu,aabbFrustumCompletelyInside:function(t,i){for(var n=i.planes,r=0;r<n.length;r++)if(0!==Mu(t,n[r]))return 0;return 1},capsuleWithCapsule:Wu,resolve:function(t,i,n){void 0===n&&(n=null);var r=t._type,s=i._type,e=this[r|s];return r<s?e(t,i,n):e(i,t,n)}};Xu[5]=eu,Xu[9]=hu,Xu[17]=ou,Xu[33]=ru,Xu[65]=su,Xu[513]=cu,Xu[6]=wu,Xu[10]=lu,Xu[18]=du,Xu[34]=au,Xu[66]=fu,Xu[4]=Hu,Xu[12]=Vu,Xu[20]=$u,Xu[36]=xu,Xu[132]=Gu,Xu[260]=ju,Xu[516]=zu,Xu[8]=mu,Xu[24]=Ru,Xu[40]=Mu,Xu[136]=Cu,Xu[264]=Nu,Xu[16]=Fu,Xu[48]=Lu,Xu[144]=Du,Xu[272]=Bu,Xu[528]=Uu,Xu[512]=Wu;var Yu,Ku=new Ir,qu=new Ir,Qu=new Dr,Ju=Math.abs,Zu=function(t,i,n){Qu.m00=Ju(n.m00),Qu.m01=Ju(n.m01),Qu.m02=Ju(n.m02),Qu.m03=Ju(n.m03),Qu.m04=Ju(n.m04),Qu.m05=Ju(n.m05),Qu.m06=Ju(n.m06),Qu.m07=Ju(n.m07),Qu.m08=Ju(n.m08),Ir.transformMat3(t,i,Qu)},to=function(){function t(t,i,n,r,s,e,h,u,o,c,a,f,v,l,d){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=1),void 0===e&&(e=1),void 0===h&&(h=1),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=0),void 0===a&&(a=1),void 0===f&&(f=0),void 0===v&&(v=0),void 0===l&&(l=0),void 0===d&&(d=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=16,this.center=new Ir(t,i,n),this.halfExtents=new Ir(r,s,e),this.orientation=new Dr(h,u,o,c,a,f,v,l,d)}t.create=function(i,n,r,s,e,h,u,o,c,a,f,v,l,d,w){return new t(i,n,r,s,e,h,u,o,c,a,f,v,l,d,w)},t.clone=function(i){return new t(i.center.x,i.center.y,i.center.z,i.halfExtents.x,i.halfExtents.y,i.halfExtents.z,i.orientation.m00,i.orientation.m01,i.orientation.m02,i.orientation.m03,i.orientation.m04,i.orientation.m05,i.orientation.m06,i.orientation.m07,i.orientation.m08)},t.copy=function(t,i){return Ir.copy(t.center,i.center),Ir.copy(t.halfExtents,i.halfExtents),Dr.copy(t.orientation,i.orientation),t},t.fromPoints=function(t,i,n){return Ir.multiplyScalar(t.center,Ir.add(Ku,i,n),.5),Ir.multiplyScalar(t.halfExtents,Ir.subtract(qu,n,i),.5),Dr.identity(t.orientation),t},t.set=function(t,i,n,r,s,e,h,u,o,c,a,f,v,l,d,w){return Ir.set(t.center,i,n,r),Ir.set(t.halfExtents,s,e,h),Dr.set(t.orientation,u,o,c,a,f,v,l,d,w),t};var i=t.prototype;return i.getBoundary=function(t,i){Zu(Ku,this.halfExtents,this.orientation),Ir.subtract(t,this.center,Ku),Ir.add(i,this.center,Ku)},i.transform=function(t,i,n,r,s){Ir.transformMat4(s.center,this.center,t),Dr.fromQuat(s.orientation,n),Ir.multiply(s.halfExtents,this.halfExtents,r)},i.translateAndRotate=function(t,i,n){Ir.transformMat4(n.center,this.center,t),Dr.fromQuat(n.orientation,i)},i.setScale=function(t,i){Ir.multiply(i.halfExtents,this.halfExtents,t)},r(t,[{key:"type",get:function(){return this._type}}]),t}();function io(t,i,n){void 0===n&&(n=1e-6);for(var r=0,s=t.length-1,e=s>>>1;r<=s;e=r+s>>>1){var h=t[e];if(h>i+n)s=e-1;else{if(!(h<i-n))return e;r=e+1}}return~r}Yu=Symbol.iterator;var no=function(){function t(){this._times=[],this._values=[]}var i=t.prototype;return i[Yu]=function(){var t=this,i=0;return{next:function(){if(i>=t._times.length)return{done:!0,value:void 0};var n=[t._times[i],t._values[i]];return++i,{done:!1,value:n}}}},i.keyframes=function(){return this},i.times=function(){return this._times},i.values=function(){return this._values},i.getKeyframeTime=function(t){return this._times[t]},i.getKeyframeValue=function(t){return this._values[t]},i.addKeyFrame=function(t,i){return this.Wt(t,i)},i.removeKeyframe=function(t){this._times.splice(t,1),this._values.splice(t,1)},i.indexOfKeyframe=function(t){return io(this._times,t)},i.updateTime=function(t,i){var n=this._values[t];this.removeKeyframe(t),this.Wt(i,n)},i.assignSorted=function(t,i){if(void 0!==i)this.setKeyframes(t.slice(),i.slice());else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return t[1]})))}},i.clear=function(){this._times.length=0,this._values.length=0},i.searchKeyframe=function(t){return io(this._times,t)},i.setKeyframes=function(t,i){t.length,i.length,ro(t),this._times=t,this._values=i},i.Wt=function(t,i){var n=this._times,r=this._values,s=n.length,e=io(n,t);if(e>=0)return e;var h=~e;return 0===h?(n.unshift(t),r.unshift(i)):h===s?(n.push(t),r.push(i)):(n.splice(h-1,0,t),r.splice(h-1,0,i)),h},r(t,[{key:"keyFramesCount",get:function(){return this._times.length}},{key:"rangeMin",get:function(){return this._times[0]}},{key:"rangeMax",get:function(){return this._times[this._values.length-1]}}]),t}();function ro(t){return t.every((function(t,i,n){return 0===i||t>n[i-1]||xn(t,n[i-1],1e-6)}))}function so(t,i,n,r,s){var e=n/r,h=i/r,u=e*e,o=1/3*(-1/3*u+h),c=.5*(2/27*e*u-1/3*e*h+t/r),a=o*o*o,f=c*c+a,v=0;if(ho(f)){if(ho(c))return s[0]=0,1;var l=Math.cbrt(-c);return s[0]=2*l,s[1]=-l,2}if(f<0){var d=1/3*Math.acos(-c/Math.sqrt(-a)),w=2*Math.sqrt(-o);s[0]=w*Math.cos(d),s[1]=-w*Math.cos(d+Math.PI/3),s[2]=-w*Math.cos(d-Math.PI/3),v=3}else{var g=Math.sqrt(f),p=Math.cbrt(g-c),_=-Math.cbrt(g+c);s[0]=p+_,v=1}for(var y=1/3*e,m=0;m<v;++m)s[m]-=y;return v}Tn.fastDefine("cc.KeyframeCurve",no,{_times:[],_values:[]}),t("c0",{LINEAR:0,CONSTANT:1,CUBIC:2}),t("c1",{LINEAR:0,CLAMP:1,LOOP:2,PING_PONG:3}),t("c2",{NONE:0,LEFT:1,RIGHT:2,BOTH:3});var eo=1e-9;function ho(t){return t>-1e-9&&t<eo}function uo(t,i,n,r){return n.slice().reverse().reduce((function(n,r){return r(t,i,n)||n}),r)}var oo=function(){},co=function(){return oo},ao=fo((function(){}));function fo(t){return function(i){return"function"==typeof i?t(i):function(n){return t(n,i)}}}function vo(t,i,n){var r=go(t);if(r){var s=po(r,"proto");po(s,"editor")[i]=n}}function lo(t){return function(i){return function(n){vo(n,t,i)}}}var wo="__ccclassCache__";function go(t){return po(t,wo)}function po(t,i){return t[i]||(t[i]={})}var _o=fo((function(t,i){var n=jt(t);n===Object&&(n=null);var r={name:i,extends:n,ctor:t},s=t[wo];if(s){var e=s.proto;e&&xt(r,e),t[wo]=void 0}return Tn(r)})),yo=lo("requireComponent"),mo=lo("executionOrder"),bo=ao;function ko(t,i,n){var r=null;function s(t,i,n){Io(To(t),Oo(t,i),t.constructor,i,r,n)}return void 0===t?ko({type:void 0}):void 0===i?(r=t,s):void s(t,i,n)}function Ao(t){var i;try{i=t()}catch(i){return t}return"object"!=typeof i||null===i?i:t}function Eo(t){var i;try{i=new t}catch(t){return{}}return i}function To(t){return go(t.constructor)}function Oo(t,i){var n,r,s=po(go(t.constructor),"proto"),e=po(s,"properties");return null!==(r=e[n=i])&&void 0!==r?r:e[n]={}}function So(t,i,n){var r,s,e=go(t.constructor),h=po(e,"proto"),u=po(h,"properties"),o=null!==(s=u[r=i])&&void 0!==s?s:u[r]={};return o.__internalFlags|=1,n&&"function"!=typeof n&&(n.get||n.set)?(n.get&&(o.get=n.get),n.set&&(o.set=n.set)):Ro(e,o,t.constructor,i,n),o}function Io(t,i,n,r,s,e){var h,u=e&&"function"!=typeof e&&(e.get||e.set);s&&(h=un(s,u));var o=xt(i,h||s||{});u?(e.get&&(o.get=e.get),e.set&&(o.set=e.set)):Ro(t,o,n,r,e)}function Ro(t,i,n,r,s){if(void 0!==s)"function"==typeof s?i.default=Ao(s):null===s||s.initializer&&(i.default=Ao(s.initializer));else{var e=t.default||(t.default=Eo(n));e.hasOwnProperty(r)&&(i.default=e[r])}}var Mo=Symbol("cc:SerializationMetadata"),Co=t("ct",(function(t,i,n){Lo(So(t,i,n))}));function No(t){return function(i,n,r){var s=So(i,n,r);s.formerlySerializedAs=t,Lo(s)}}var Po=function(t,i,n){var r=So(t,i,n);r.editorOnly=!0,Lo(r)};function Lo(t){t.__internalFlags|=4}var Do=oo,Bo=ao,Fo=co,Uo=ao,xo=co,Go=co,jo=co,Ho=t("ci",oo),Vo=t("ck",co),$o=t("cl",co),zo=t("cj",co),Wo=t("cn",co),Xo=t("co",co),Yo=t("cp",oo),Ko=t("cm",co),qo=t("cq",oo),Qo=ic(qi),Jo=ic(Qi),Zo=ic(Ji),tc=ic(Zi);function ic(t){return ko({type:t})}var nc,rc,sc,ec,hc,uc,oc,cc,ac=t("cr",(function(t,i,n){So(t,i,n).override=!0})),fc=t("bE",(function(){})),vc=Object.freeze({__proto__:null,boolean:Zo,ccclass:_o,disallowAnimation:qo,disallowMultiple:bo,displayName:$o,displayOrder:Ko,editable:Ho,executeInEditMode:Bo,executionOrder:mo,float:Jo,formerlySerializedAs:No,help:jo,icon:Go,inspector:xo,integer:Qo,menu:Fo,override:ac,playOnFocus:Uo,property:ko,range:Wo,rangeStep:Xo,requireComponent:yo,serializable:Co,slide:Yo,string:tc,tooltip:zo,type:ic,uniquelyReferenced:Do,visible:Vo});function lc(t,i){return(i<<3)+t}function dc(t){return gc[t]}function wc(t){switch(t){case 0:return Uint8Array;case 1:return Uint16Array;case 2:return Uint32Array;case 3:return Int8Array;case 4:return Int16Array;case 5:return Int32Array;case 6:return Float32Array;case 7:return Float64Array}}t("bq",vc),t("bz",_o("cc.CompactValueTypeArray")((oc=function(){function t(){this._byteOffset=sc&&sc(),this._unitCount=ec&&ec(),this._unitElement=hc&&hc(),this._length=uc&&uc()}return t.lengthFor=function(t,i,n){return dc(i).requiredUnits*t.length*wc(n).BYTES_PER_ELEMENT},t.compress=function(i,n,r,s,e,h){for(var u=dc(n),o=wc(r),c=u.requiredUnits*i.length,a=new o(s,e,c),f=0;f<i.length;++f)u.compress(a,f,i[f]);var v=new t;return v._unitElement=lc(r,n),v._byteOffset=h,v._unitCount=c,v._length=i.length,v},t.prototype.decompress=function(t){for(var i,n={storageUnit:7&(i=this._unitElement),elementType:i>>3},r=n.storageUnit,s=dc(n.elementType),e=new(wc(r))(t,this._byteOffset,this._unitCount),h=new Array(this._length),u=0;u<this._length;++u)h[u]=s.decompress(e,u);return h},t}(),oc.StorageUnit={Uint8:0,Uint16:1,Uint32:2,Int8:3,Int16:4,Int32:5,Float32:6,Float64:7},oc.ElementType={Scalar:0,Vec2:1,Vec3:2,Vec4:3,Quat:4,Mat4:5},sc=uo((rc=oc).prototype,"_byteOffset",[Co],(function(){return 0})),ec=uo(rc.prototype,"_unitCount",[Co],(function(){return 0})),hc=uo(rc.prototype,"_unitElement",[Co],(function(){return lc(0,0)})),uc=uo(rc.prototype,"_length",[Co],(function(){return 0})),nc=rc))||nc);var gc=((cc={})[0]={requiredUnits:1,compress:function(t,i,n){t[i]=n},decompress:function(t,i){return t[i]}},cc[1]={requiredUnits:2,compress:function(t,i,n){t[2*i]=n.x,t[2*i+1]=n.y},decompress:function(t,i){return new Ir(t[2*i],t[2*i+1])}},cc[2]={requiredUnits:3,compress:function(t,i,n){t[3*i]=n.x,t[3*i+1]=n.y,t[3*i+2]=n.z},decompress:function(t,i){return new Ir(t[3*i],t[3*i+1],t[3*i+2])}},cc[3]={requiredUnits:4,compress:function(t,i,n){t[4*i]=n.x,t[4*i+1]=n.y,t[4*i+2]=n.z,t[4*i+3]=n.w},decompress:function(t,i){return new $s(t[4*i],t[4*i+1],t[4*i+2],t[4*i+3])}},cc[4]={requiredUnits:4,compress:function(t,i,n){t[4*i]=n.x,t[4*i+1]=n.y,t[4*i+2]=n.z,t[4*i+3]=n.w},decompress:function(t,i){return new Qr(t[4*i],t[4*i+1],t[4*i+2],t[4*i+3])}},cc[5]={requiredUnits:16,compress:function(t,i,n){ls.toArray(t,n,16*i)},decompress:function(t,i){return ls.fromArray(new ls,t,16*i)}},cc),pc=t("bC",Symbol("[[Serialize]]")),_c=t("bB",Symbol("[[Deserialize]]"));function yc(){return 0}function mc(t){return t}function bc(t){return t*t}function kc(t){return t*(2-t)}function Ac(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function Ec(t){return t*t*t}function Tc(t){return--t*t*t+1}function Oc(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function Sc(t){return t*t*t*t}function Ic(t){return 1- --t*t*t*t}function Rc(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function Mc(t){return t*t*t*t*t}function Cc(t){return--t*t*t*t*t+1}function Nc(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function Pc(t){return 1===t?1:1-Math.cos(t*Math.PI/2)}function Lc(t){return Math.sin(t*Math.PI/2)}function Dc(t){return.5*(1-Math.cos(Math.PI*t))}function Bc(t){return 0===t?0:Math.pow(1024,t-1)}function Fc(t){return 1===t?1:1-Math.pow(2,-10*t)}function Uc(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}function xc(t){return 1-Math.sqrt(1-t*t)}function Gc(t){return Math.sqrt(1- --t*t)}function jc(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function Hc(t){var i,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,i=.1):i=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4))}function Vc(t){var i,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,i=.1):i=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin(2*(t-i)*Math.PI/.4)+1)}function $c(t){var i,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,i=.1):i=.4*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-i)*Math.PI/.4)*.5+1)}function zc(t){if(1===t)return 1;var i=1.70158;return t*t*((i+1)*t-i)}function Wc(t){if(0===t)return 0;var i=1.70158;return--t*t*((i+1)*t+i)+1}function Xc(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)}function Yc(t){return 1-Kc(1-t)}function Kc(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function qc(t){return t<.5?.5*Yc(2*t):.5*Kc(2*t-1)+.5}function Qc(t){return t<=0?0:t>=1?1:t*t*(3-2*t)}function Jc(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}O._decorator=vc;var Zc=ca(bc,kc),ta=ca(Ec,Tc),ia=ca(Sc,Ic),na=ca(Mc,Cc),ra=ca(Pc,Lc),sa=ca(Bc,Fc),ea=ca(xc,Gc),ha=ca(Hc,Vc),ua=ca(zc,Wc),oa=ca(Yc,Kc);function ca(t,i){return function(n){return n<.5?i(2*n)/2:t(2*n-1)/2+.5}}var aa,fa=Object.freeze({__proto__:null,backIn:zc,backInOut:Xc,backOut:Wc,backOutIn:ua,bounceIn:Yc,bounceInOut:qc,bounceOut:Kc,bounceOutIn:oa,circIn:xc,circInOut:jc,circOut:Gc,circOutIn:ea,constant:yc,cubicIn:Ec,cubicInOut:Oc,cubicOut:Tc,cubicOutIn:ta,elasticIn:Hc,elasticInOut:$c,elasticOut:Vc,elasticOutIn:ha,expoIn:Bc,expoInOut:Uc,expoOut:Fc,expoOutIn:sa,fade:Jc,linear:mc,quadIn:bc,quadInOut:Ac,quadOut:kc,quadOutIn:Zc,quartIn:Sc,quartInOut:Rc,quartOut:Ic,quartOutIn:ia,quintIn:Mc,quintInOut:Nc,quintOut:Cc,quintOutIn:na,sineIn:Pc,sineInOut:Dc,sineOut:Lc,sineOutIn:ra,smooth:Qc});t("ce",fa),t("cD",{LINEAR:0,CONSTANT:1,QUAD_IN:2,QUAD_OUT:3,QUAD_IN_OUT:4,QUAD_OUT_IN:5,CUBIC_IN:6,CUBIC_OUT:7,CUBIC_IN_OUT:8,CUBIC_OUT_IN:9,QUART_IN:10,QUART_OUT:11,QUART_IN_OUT:12,QUART_OUT_IN:13,QUINT_IN:14,QUINT_OUT:15,QUINT_IN_OUT:16,QUINT_OUT_IN:17,SINE_IN:18,SINE_OUT:19,SINE_IN_OUT:20,SINE_OUT_IN:21,EXPO_IN:22,EXPO_OUT:23,EXPO_IN_OUT:24,EXPO_OUT_IN:25,CIRC_IN:26,CIRC_OUT:27,CIRC_IN_OUT:28,CIRC_OUT_IN:29,ELASTIC_IN:30,ELASTIC_OUT:31,ELASTIC_IN_OUT:32,ELASTIC_OUT_IN:33,BACK_IN:34,BACK_OUT:35,BACK_IN_OUT:36,BACK_OUT_IN:37,BOUNCE_IN:38,BOUNCE_OUT:39,BOUNCE_IN_OUT:40,BOUNCE_OUT_IN:41,SMOOTH:42,FADE:43});var va,la=((aa={})[1]=yc,aa[0]=mc,aa[2]=bc,aa[3]=kc,aa[4]=Ac,aa[5]=Zc,aa[6]=Ec,aa[7]=Tc,aa[8]=Oc,aa[9]=ta,aa[10]=Sc,aa[11]=Ic,aa[12]=Rc,aa[13]=ia,aa[14]=Mc,aa[15]=Cc,aa[16]=Nc,aa[17]=na,aa[18]=Pc,aa[19]=Lc,aa[20]=Dc,aa[21]=ra,aa[22]=Bc,aa[23]=Fc,aa[24]=Uc,aa[25]=sa,aa[26]=xc,aa[27]=Gc,aa[28]=jc,aa[29]=ea,aa[30]=Hc,aa[31]=Vc,aa[32]=$c,aa[33]=ha,aa[34]=zc,aa[35]=Wc,aa[36]=Xc,aa[37]=ua,aa[38]=Yc,aa[39]=Kc,aa[40]=qc,aa[41]=oa,aa[42]=Qc,aa[43]=Jc,aa);function da(t){return la[t]}C(255),C(65280);var wa=function(t){function i(){var i;return(i=t.call(this)||this).value=0,i.rightTangent=0,i.rightTangentWeight=0,i.leftTangent=0,i.leftTangentWeight=0,i.Xt=0,i}return e(i,t),r(i,[{key:"interpolationMode",get:function(){return 255&this.Xt},set:function(t){this.Xt&=-256,this.Xt|=0|t}},{key:"tangentWeightMode",get:function(){return(65280&this.Xt)>>8},set:function(t){this.Xt&=-65281,this.Xt|=t<<8}},{key:"easingMethod",get:function(){return(16711680&this.Xt)>>16},set:function(t){this.Xt&=-16711681,this.Xt|=t<<16}}]),i}(fc);function ga(t){var i=new wa;if("number"==typeof t)i.value=t;else{var n=t.interpolationMode,r=t.tangentWeightMode,s=t.value,e=t.rightTangent,h=t.rightTangentWeight,u=t.leftTangent,o=t.leftTangentWeight,c=t.easingMethod,a=t[He];i.value=null!=s?s:i.value,i.rightTangent=null!=e?e:i.rightTangent,i.rightTangentWeight=null!=h?h:i.rightTangentWeight,i.leftTangent=null!=u?u:i.leftTangent,i.leftTangentWeight=null!=o?o:i.leftTangentWeight,i.interpolationMode=null!=n?n:i.interpolationMode,i.tangentWeightMode=null!=r?r:i.tangentWeightMode,i.easingMethod=null!=c?c:i.easingMethod,a&&(i[He]=a)}return i}Tn.fastDefine("cc.RealKeyframeValue",wa,((va={interpolationMode:0,tangentWeightMode:0,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:0})[He]=void 0,va)),Tn.Attr.setClassAttr(wa,He,"editorOnly",!0),(function(t){var i,n;return null!==(n=(i=t)[Mo])&&void 0!==n?n:i[Mo]={}}(wa)).uniquelyReferenced=!0;var pa=t("b$",function(t){function i(){var i;return(i=t.call(this)||this).preExtrapolation=1,i.postExtrapolation=1,i}e(i,t);var n=i.prototype;return n.evaluate=function(t){var i=this._times,n=this._values,r=i.length;if(0===r)return 0;var s=i[0],e=i[r-1];if(t<s){var h=this.preExtrapolation,u=n[0];if(1===h||r<2)return u.value;switch(h){case 0:return Va(s,n[0].value,i[1],n[1].value,t);case 2:t=ja(t,s,e);break;case 3:t=Ha(t,s,e);break;default:return u.value}}else if(t>e){var o=this.postExtrapolation,c=n[r-1];if(1===o||r<2)return c.value;switch(o){case 0:return Va(e,c.value,i[r-2],n[r-2].value,t);case 2:t=ja(t,s,e);break;case 3:t=Ha(t,s,e);break;default:return c.value}}var a=io(i,t);if(a>=0)return n[a].value;var f=~a,v=f-1,l=i[v],d=n[v],w=i[f];return $a(l,d,w,n[f],(t-l)/(w-l))},n.addKeyFrame=function(i,n){return t.prototype.addKeyFrame.call(this,i,ga(n))},n.assignSorted=function(t,i){if(void 0!==i)this.setKeyframes(t.slice(),i.map((function(t){return ga(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return ga(t[1])})))}},n.isConstant=function(t){if(this._values.length<=1)return!0;var i=this._values[0].value;return this._values.every((function(n){return xn(n.value,i,t)}))},n[pc]=function(t,i){if(i.toCCON){var n=this._times,r=this._values,s=n.length,e=new DataView(new ArrayBuffer(0+ma+ma+ba+ka*s+Ua*s)),h=0;e.setUint8(h,this.preExtrapolation),h+=ma,e.setUint8(h,this.postExtrapolation),h+=ma,e.setUint32(h,s,!0),h+=ba,n.forEach((function(t,i){return e.setFloat32(h+ka*i,t,!0)})),h+=ka*s;for(var u,o=w(r);!(u=o()).done;){var c=u.value;h=xa(e,c,h)}var a=new Uint8Array(e.buffer,0,h);t.writeProperty("bytes",a);var f=r.map((function(t){return t[He]}));f.some((function(t){return void 0!==t}))&&t.writeProperty("keyframeValueEditorExtras",f)}else t.writeThis()},n[_c]=function(t,i){if(i.fromCCON){var n=t.readProperty("bytes"),r=new DataView(n.buffer,n.byteOffset,n.byteLength),s=0;this.preExtrapolation=r.getUint8(s),s+=ma,this.postExtrapolation=r.getUint8(s),s+=ma;var e=r.getUint32(s,!0);s+=ba;var h=Array.from({length:e},(function(t,i){return r.getFloat32(s+ka*i,!0)}));s+=ka*e;for(var u=new Array(e),o=0;o<e;++o){var c=ga({});s=Ga(r,c,s),u[o]=c}n.byteLength;var a=t.readProperty("keyframeValueEditorExtras");a&&(a.length,a.forEach((function(t,i){return u[i][He]=t}))),this._times=h,this._values=u}else t.readThis()},i}(no));Tn.fastDefine("cc.RealCurve",pa,{_times:[],_values:[],preExtrapolation:1,postExtrapolation:1});var _a=8,ya=255<<_a,ma=1,ba=4,ka=4,Aa=4,Ea=4,Ta=1,Oa=1,Sa=4,Ia=4,Ra=4,Ma=4,Ca=ga({}),Na=Ca.interpolationMode,Pa=Ca.tangentWeightMode,La=Ca.leftTangent,Da=Ca.leftTangentWeight,Ba=Ca.rightTangent,Fa=Ca.rightTangentWeight,Ua=Aa+Ea+Ta+Oa+Sa+Ia+Ra+Ma+0;function xa(t,i,n){var r=0,s=n,e=s;s+=Aa;var h=i.value,u=i.interpolationMode,o=i.tangentWeightMode,c=i.rightTangent,a=i.rightTangentWeight,f=i.leftTangent,v=i.leftTangentWeight,l=i.easingMethod;return t.setFloat32(s,h,!0),s+=Ea,u!==Na&&(r|=2,t.setUint8(s,u),s+=Ta),o!==Pa&&(r|=4,t.setUint8(s,o),s+=Oa),f!==La&&(r|=8,t.setFloat32(s,f,!0),s+=Sa),v!==Da&&(r|=16,t.setFloat32(s,v,!0),s+=Ia),c!==Ba&&(r|=32,t.setFloat32(s,c,!0),s+=Ra),a!==Fa&&(r|=64,t.setFloat32(s,a,!0),s+=Ma),r|=l<<_a,t.setUint32(e,r,!0),s}function Ga(t,i,n){var r=n,s=t.getUint32(r,!0);r+=Aa,i.value=t.getFloat32(r,!0),r+=Ea,2&s&&(i.interpolationMode=t.getUint8(r),r+=Ta),4&s&&(i.tangentWeightMode=t.getUint8(r),r+=Oa),8&s&&(i.leftTangent=t.getFloat32(r,!0),r+=Sa),16&s&&(i.leftTangentWeight=t.getFloat32(r,!0),r+=Ia),32&s&&(i.rightTangent=t.getFloat32(r,!0),r+=Ra),64&s&&(i.rightTangentWeight=t.getFloat32(r,!0),r+=Ma);var e=(s&ya)>>_a;return i.easingMethod=e,r}function ja(t,i,n){return i+Zn(t-i,n-i)}function Ha(t,i,n){return i+tr(t-i,n-i)}function Va(t,i,n,r,s){return i+(r-i)/(n-t)*(s-t)}function $a(t,i,n,r,s){var e=n-t;switch(i.interpolationMode){default:case 1:return i.value;case 0:var h=0===i.easingMethod?s:da(i.easingMethod)(s);return Hn(i.value,r.value,h);case 2:var u=1/3,o=i.rightTangent,c=i.rightTangentWeight,a=!!(2&i.tangentWeightMode),f=r.leftTangent,v=r.leftTangentWeight,l=!!(1&r.tangentWeightMode);if(a||l){var d=0;if(a)d=c;else{var w=e,g=e*o;d=Math.sqrt(w*w+g*g)*u}var p=Math.atan(o),_=Math.cos(p)*d+t,y=Math.sin(p)*d+i.value,m=0;if(l)m=v;else{var b=e,k=e*f;m=Math.sqrt(b*b+k*k)*u}var A=Math.atan(f),E=(_-t)/e,T=(-Math.cos(A)*m+n-t)/e,O=y,S=-Math.sin(A)*m+r.value,I=[0,0,0],R=Wa(I,so(0-s,3*E,3*T-6*E,3*(E-T)+1,I),s);return za(i.value,O,S,r.value,R)}var M=i.value+u*o*e,C=r.value-u*f*e;return za(i.value,M,C,r.value,s)}}function za(t,i,n,r,s){var e=1-s;return e*e*e*t+3*e*e*s*i+3*e*s*s*n+s*s*s*r}function Wa(t,i,n){var r=n;if(1===i)r=t[0];else{r=-1/0;for(var s=0;s<i;++s){var e=t[s];e>=0&&e<=1&&e>r&&(r=e)}r===-1/0&&(r=0)}return r}function Xa(t,i,n,r,s){var e=1-s;return e*(e*(t+(3*i-t)*s)+3*n*s*s)+r*s*s*s}O.bezier=Xa;var Ya,Ka,qa,Qa,Ja,Za,tf,nf,rf,sf=Math.cos,ef=Math.acos,hf=Math.max,uf=2*Math.PI,of=Math.sqrt;function cf(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function af(t,i){var n,r,s,e,h=i-0,u=i-t[0],o=3*h,c=3*u,a=3*(i-t[2]),f=1/(-h+c-a+(i-1)),v=1/3,l=(o-6*u+a)*f,d=l*v,w=(-o+c)*f,g=(3*w-l*l)*v,p=g*v,_=(2*l*l*l-9*l*w+h*f*27)/27,y=_/2,m=y*y+p*p*p;if(m<0){var b=-g*v,k=of(b*b*b),A=-_/(2*k),E=ef(A<-1?-1:A>1?1:A),T=2*cf(k);return r=T*sf(E*v)-d,s=T*sf((E+uf)*v)-d,e=T*sf((E+2*uf)*v)-d,r>=0&&r<=1?s>=0&&s<=1?e>=0&&e<=1?hf(r,s,e):hf(r,s):e>=0&&e<=1?hf(r,e):r:s>=0&&s<=1?e>=0&&e<=1?hf(s,e):s:e}if(0===m)return s=-(n=y<0?cf(-y):-cf(y))-d,(r=2*n-d)>=0&&r<=1?s>=0&&s<=1?hf(r,s):r:s;var O=of(m);return(n=cf(-y+O))-cf(y+O)-d}function ff(t,i){var n=af(t,i),r=t[1];return((1-n)*(r+(t[3]-r)*n)*3+n*n)*n}O.bezierByTime=ff,t("c4",{SLERP:0,CONSTANT:1});var vf=_o("cc.QuatKeyframeValue")(Ya=Do((Ka=function(t){var i=void 0===t?{}:t,n=i.value,r=i.interpolationMode,s=i.easingMethod;this.interpolationMode=qa&&qa(),this.value=Qa&&Qa(),this.easingMethod=Ja&&Ja(),this.value=n?Qr.clone(n):this.value,this.interpolationMode=null!=r?r:this.interpolationMode,this.easingMethod=null!=s?s:this.easingMethod},qa=uo(Ka.prototype,"interpolationMode",[Co],(function(){return 0})),Qa=uo(Ka.prototype,"value",[Co],(function(){return Qr.clone(Qr.IDENTITY)})),Ja=uo(Ka.prototype,"easingMethod",[Co],(function(){return 0})),Ya=Ka))||Ya)||Ya;function lf(t){return new vf(t)}var df,wf=t("c3",_o("cc.QuatCurve")((tf=function(t){function i(){var i;return(i=t.call(this)||this).preExtrapolation=nf&&nf(),i.postExtrapolation=rf&&rf(),i}e(i,t);var n=i.prototype;return n.evaluate=function(t,i){var n;null!==(n=i)&&void 0!==n||(i=new Qr);var r=this._times,s=this._values,e=this.postExtrapolation,h=this.preExtrapolation,u=r.length;if(0===u)return i;var o=r[0],c=r[u-1];if(t<o){var a=s[0];switch(h){case 2:t=o+Zn(t-o,c-o);break;case 3:t=o+tr(t-o,c-o);break;default:return Qr.copy(i,a.value)}}else if(t>c){var f=s[u-1];switch(e){case 2:t=o+Zn(t-o,c-o);break;case 3:t=o+tr(t-o,c-o);break;default:return Qr.copy(i,f.value)}}var v=io(r,t);if(v>=0)return Qr.copy(i,s[v].value);var l=~v,d=l-1,w=r[d],g=s[d],p=r[l],_=s[l],y=(t-w)/(p-w);switch(g.interpolationMode){default:case 1:return Qr.copy(i,g.value);case 0:var m=g.easingMethod,b=0===m?y:Array.isArray(m)?ff(m,y):da(m)(y);return Qr.slerp(i,g.value,_.value,b)}},n.addKeyFrame=function(i,n){var r=new vf(n);return t.prototype.addKeyFrame.call(this,i,r)},n.assignSorted=function(t,i){if(void 0!==i)this.setKeyframes(t.slice(),i.map((function(t){return lf(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return lf(t[1])})))}},n[pc]=function(t,i){if(i.toCCON){var n=this._times,r=this._values,s=!0;r.forEach((function(t,i,n){var r=n[0];s&&t.interpolationMode!==r.interpolationMode&&(s=!1)}));var e=n.length,h=mf*(s?1:e),u=r.reduce((function(t,i){var n=i.easingMethod;return t+(Array.isArray(n)?bf+4*Af:bf)}),0),o=0,c=new DataView(new ArrayBuffer(o+=gf+pf+_f*e+4*yf*e+u+h+0)),a=0,f=0;s&&(f|=1),c.setUint32(a,f,!0),a+=gf,c.setUint32(a,e,!0),a+=pf,n.forEach((function(t,i){return c.setFloat32(a+_f*i,t,!0)})),a+=_f*e,r.forEach((function(t,i){var n=t.value,r=n.x,s=n.y,e=n.z,h=n.w,u=a+4*yf*i;c.setFloat32(u+0*yf,r,!0),c.setFloat32(u+1*yf,s,!0),c.setFloat32(u+2*yf,e,!0),c.setFloat32(u+3*yf,h,!0)})),a+=4*yf*e,r.forEach((function(t){var i=t.easingMethod;Array.isArray(i)?(c.setUint8(a,kf),++a,c.setFloat32(a+0*Af,i[0],!0),c.setFloat32(a+1*Af,i[1],!0),c.setFloat32(a+2*Af,i[2],!0),c.setFloat32(a+3*Af,i[3],!0),a+=4*Af):(c.setUint8(a,i),++a)}));var v=a;a+=h;var l=v;r.forEach((function(t){var i=t.interpolationMode;c.setUint8(l,i),s||(l+=mf)}));var d=new Uint8Array(c.buffer);t.writeProperty("bytes",d)}else t.writeThis()},n[_c]=function(t,i){if(i.fromCCON){var n=t.readProperty("bytes"),r=new DataView(n.buffer,n.byteOffset,n.byteLength),s=0,e=r.getUint32(s,!0);s+=gf;var h=1&e,u=r.getUint32(s,!0);s+=pf;var o=Array.from({length:u},(function(t,i){return r.getFloat32(s+_f*i,!0)})),c=s+=_f*u;s+=4*yf*u;var a=Array.from({length:u},(function(t,i){var n=c+4*yf*i,e=r.getFloat32(n+0*yf,!0),h=r.getFloat32(n+1*yf,!0),u=r.getFloat32(n+2*yf,!0),o=r.getFloat32(n+3*yf,!0),a=r.getUint8(s);++s;var f=lf({value:{x:e,y:h,z:u,w:o}});return a!==kf?f.easingMethod=a:(f.easingMethod=[r.getFloat32(s+0*Af,!0),r.getFloat32(s+1*Af,!0),r.getFloat32(s+2*Af,!0),r.getFloat32(s+3*Af,!0)],s+=4*Af),f}));if(h){var f=r.getUint8(s);++s;for(var v=0;v<u;++v)a[v].interpolationMode=f}else{for(var l=0;l<u;++l){var d=r.getUint8(s+l);a[l].interpolationMode=d}s+=u}this._times=o,this._values=a}else t.readThis()},i}(no),nf=uo(tf.prototype,"preExtrapolation",[Co],(function(){return 1})),rf=uo(tf.prototype,"postExtrapolation",[Co],(function(){return 1})),Za=tf))||Za),gf=1,pf=4,_f=4,yf=4,mf=1,bf=1,kf=255,Af=4,Ef=t("c5",_o("cc.ObjectCurve")(df=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.evaluate=function(t){var i=this.searchKeyframe(t);if(i>=0)return this._values[i];var n=Gn(~i-1,0,this._values.length-1);return this._values[n]},i}(no))||df),Tf={Blend:0,Fixed:1};_i(Tf);var Of=t("c6",(function(){this.color=Qs.WHITE.clone(),this.time=0}));Tn.fastDefine("cc.ColorKey",Of,{color:Qs.WHITE.clone(),time:0}),Tn.Attr.setClassAttr(Of,"color","visible",!0),Tn.Attr.setClassAttr(Of,"time","visible",!0);var Sf=t("c7",(function(){this.alpha=1,this.time=0}));Tn.fastDefine("cc.AlphaKey",Sf,{alpha:1,time:0}),Tn.Attr.setClassAttr(Sf,"alpha","visible",!0),Tn.Attr.setClassAttr(Sf,"time","visible",!0);var If=t("c8",function(){function t(){this.colorKeys=[],this.alphaKeys=[],this.mode=0}var i=t.prototype;return i.setKeys=function(t,i){this.colorKeys=t,this.alphaKeys=i},i.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort((function(t,i){return t.time-i.time})),this.alphaKeys.length>1&&this.alphaKeys.sort((function(t,i){return t.time-i.time}))},i.evaluate=function(t){return this.evaluateFast(new Qs,t)},i.evaluateFast=function(t,i){return this.Yt(t,i),t.a=this.Kt(i),t},i.randomColor=function(){return this.getRandomColor(new Qs)},i.getRandomColor=function(t){var i=this.colorKeys[Math.trunc(zn()*this.colorKeys.length)],n=this.alphaKeys[Math.trunc(zn()*this.alphaKeys.length)];return t.set(i.color),t.a=n.alpha,t},i.Yt=function(t,i){var n=this.colorKeys,r=n.length;if(r>1){i=Zn(i,1+Fn);for(var s=1;s<r;++s){var e=n[s-1].time,h=n[s].time;if(i>=e&&i<h){if(1===this.mode)return Qs.copy(t,n[s].color),t;var u=(i-e)/(h-e);return Qs.lerp(t,n[s-1].color,n[s].color,u),t}}var o=r-1;xn(i,n[o].time,Fn)?Qs.copy(t,n[o].color):i<n[0].time?Qs.lerp(t,Qs.BLACK,n[0].color,i/n[0].time):i>n[o].time&&Qs.lerp(t,n[o].color,Qs.BLACK,(i-n[o].time)/(1-n[o].time))}else 1===r?Qs.copy(t,n[0].color):Qs.copy(t,Qs.WHITE);return t},i.Kt=function(t){var i=this.alphaKeys,n=i.length;if(n>1){t=Zn(t,1+Fn);for(var r=1;r<n;++r){var s=i[r-1].time,e=i[r].time;if(t>=s&&t<e){if(1===this.mode)return i[r].alpha;var h=(t-s)/(e-s);return Hn(i[r-1].alpha,i[r].alpha,h)}}var u=n-1;return xn(t,i[u].time,Fn)?i[u].alpha:t<i[0].time?Hn(0,i[0].alpha,t/i[0].time):t>i[u].time?Hn(i[u].alpha,0,(t-i[u].time)/(1-i[u].time)):255}return 1===n?i[0].alpha:255},t}());If.Mode=Tf,Tn.fastDefine("cc.Gradient",If,{colorKeys:[],alphaKeys:[],mode:0}),Tn.Attr.setClassAttr(If,"colorKeys","visible",!0),Tn.Attr.setClassAttr(If,"alphaKeys","visible",!0),Tn.Attr.setClassAttr(If,"mode","visible",!0);var Rf=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};Tn.fastDefine("cc.Keyframe",Rf,{time:0,value:0,inTangent:0,outTangent:0});var Mf=function(){function t(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t.prototype.evaluate=function(t){return Cf(t-this.time,this.coefficient)},t}();function Cf(t,i){return t*(t*(t*i[0]+i[1])+i[2])+i[3]}var Nf=function(){function t(t){if(void 0===t&&(t=null),this._curve=void 0,this.qt=void 0,t instanceof pa)this._curve=t;else{var i=new pa;this._curve=i,i.preExtrapolation=2,i.postExtrapolation=1,t?i.assignSorted(t.map((function(t){return[t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]}))):i.assignSorted([[0,{interpolationMode:2,value:1}],[1,{interpolationMode:2,value:1}]])}this.qt=new Mf}var i=t.prototype;return i.addKey=function(t){t?this._curve.addKeyFrame(t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}):this._curve.clear()},i.evaluate_slow=function(t){return this._curve.evaluate(t)},i.evaluate=function(t){var i=this.qt,n=this._curve,r=n.keyFramesCount-1,s=t,e=t<0?n.preExtrapolation:n.postExtrapolation,h=n.getKeyframeTime(0),u=n.getKeyframeTime(r);switch(e){case 2:s=Zn(t-h,u-h)+h;break;case 3:s=tr(t-h,u-h)+h;break;default:s=Gn(t,h,u)}if(s>=i.time&&s<i.endTime)return i.evaluate(s);var o=this.Qt(i,s),c=Math.min(o+1,r);return this.calcOptimizedKey(i,o,c),i.evaluate(s)},i.calcOptimizedKey=function(t,i,n){var r=this._curve.getKeyframeTime(i),s=this._curve.getKeyframeTime(n),e=this._curve.getKeyframeValue(i),h=e.value,u=e.leftTangent,o=this._curve.getKeyframeValue(n),c=o.value,a=o.rightTangent;t.index=i,t.time=r,t.endTime=s;var f=s-r,v=c-h,l=1/(f*f),d=u*f,w=a*f;t.coefficient[0]=(d+w-v-v)*l/f,t.coefficient[1]=(v+v+v-d-d-w)*l,t.coefficient[2]=u,t.coefficient[3]=h},i.Qt=function(t,i){var n=this._curve,r=n.keyFramesCount,s=t.index;if(-1!==s)if(i>n.getKeyframeTime(s))for(var e=0;e<3;e++){var h=s+e;if(h+1<r&&n.getKeyframeTime(h+1)>i)return h}else for(var u=0;u<3;u++){var o=s-u;if(o>=0&&n.getKeyframeTime(o-1)<=i)return o-1}for(var c,a=0,f=r;f-a>1;)c=Math.floor((a+f)/2),n.getKeyframeTime(c)>=i?f=c:a=c;return a},r(t,[{key:"_internalCurve",get:function(){return this._curve}},{key:"keyFrames",get:function(){return Array.from(this._curve.keyframes()).map((function(t){var i=t[0],n=t[1],r=new Rf;return r.time=i,r.value=n.value,r.inTangent=n.leftTangent,r.outTangent=n.rightTangent,r}))},set:function(t){this._curve.assignSorted(t.map((function(t){return[t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]})))}},{key:"preWrapMode",get:function(){return Lf(this._curve.preExtrapolation)},set:function(t){this._curve.preExtrapolation=Pf(t)}},{key:"postWrapMode",get:function(){return Lf(this._curve.postExtrapolation)},set:function(t){this._curve.postExtrapolation=Pf(t)}}]),t}();function Pf(t){switch(t){default:case 0:case 1:case 8:return 1;case 22:return 3;case 2:return 2}}function Lf(t){switch(t){default:case 0:case 1:return 8;case 3:return 22;case 2:return 2}}Nf.Jt=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],Tn.fastDefine("cc.AnimationCurve",Nf,{_curve:null});var Df=Ir.multiplyScalar,Bf=Ir.add,Ff=4294967295,Uf=Rr(),xf=Rr(),Gf=Rr(),jf=Rr(),Hf=function(){function t(t,i){void 0===t&&(t=2),void 0===i&&(i=[]),this.C=void 0,this.Zt=[],this.C=1024,this.ti=t;for(var n=0;n<i.length;n++)this.Zt[n]=Rr(i[n])}t.create=function(i,n){return void 0===n&&(n=[]),new t(i,n)},t.clone=function(i){return new t(i.mode,i.knots)},t.copy=function(t,i){t.ti=i.mode,t.Zt.length=0;for(var n=i.knots,r=n.length,s=0;s<r;s++)t.Zt[s]=Rr(n[s]);return t};var i=t.prototype;return i.setModeAndKnots=function(t,i){this.ti=t,this.Zt.length=0;for(var n=0;n<i.length;n++)this.Zt[n]=Rr(i[n])},i.clearKnots=function(){this.Zt.length=0},i.getKnotCount=function(){return this.Zt.length},i.addKnot=function(t){this.Zt.push(Rr(t))},i.insertKnot=function(t,i){var n=Rr(i);t>=this.Zt.length?this.Zt.push(n):this.Zt.splice(t,0,n)},i.removeKnot=function(t){gi(this.Zt,t),this.Zt.splice(t,1)},i.setKnot=function(t,i){gi(this.Zt,t),this.Zt[t].set(i)},i.getKnot=function(t){return gi(this.Zt,t),this.Zt[t]},i.getPoint=function(i,n){void 0===n&&(n=Ff),i=Gn(i,0,1);var r=this.ii();if(0===r)return Rr();if(n===Ff){var s=1/r;n=Math.floor(i/s),i=i%s/s}var e=this.Zt;if(n>=r)return Rr(e[e.length-1]);switch(this.ti){case 0:return t.ni(e[n],e[n+1],i);case 1:var h=4*n;return t.ri(e[h],e[h+1],e[h+2],e[h+3],i);case 2:var u=n>0?e[n-1]:e[n],o=n+2<e.length?e[n+2]:e[n+1];return t.si(u,e[n],e[n+1],o,i);default:return Rr()}},i.getPoints=function(t,i){if(void 0===i&&(i=Ff),0===t)return[];if(1===t)return[this.getPoint(0,i)];for(var n=[],r=1/(t-1),s=0;s<t;s++){var e=s*r,h=this.getPoint(e,i);n.push(h)}return n},i.ii=function(){var t=this.Zt.length;switch(this.ti){case 0:case 2:return t<2?(st(14300),0):t-1;case 1:return t<4||t%4!=0?(st(14301),0):t/4;default:return ot(!1,16407),0}},t.ni=function(t,i,n){var r=new Ir;return Df(Uf,t,1-n),Df(xf,i,n),Bf(r,Uf,xf),r},t.ri=function(t,i,n,r,s){var e=new Ir,h=1-s;return Df(Uf,t,h*h*h),Df(xf,i,3*s*h*h),Df(Gf,n,3*s*s*h),Df(jf,r,s*s*s),Bf(Uf,Uf,xf),Bf(Gf,Gf,jf),Bf(e,Uf,Gf),e},t.si=function(t,i,n,r,s){var e=new Ir,h=s*s,u=h*s;return Df(Uf,t,-.5*u+h-.5*s),Df(xf,i,1.5*u-2.5*h+1),Df(Gf,n,-1.5*u+2*h+.5*s),Df(jf,r,.5*u-.5*h),Bf(Uf,Uf,xf),Bf(Gf,Gf,jf),Bf(e,Uf,Gf),e},r(t,[{key:"type",get:function(){return this.C}},{key:"mode",get:function(){return this.ti}},{key:"knots",get:function(){return this.Zt}}]),t}(),Vf=Object.freeze({__proto__:null,AABB:Mh,AnimationCurve:Nf,Capsule:Ch,ERaycastMode:{ALL:0,CLOSEST:1,ANY:2},Frustum:$h,Keyframe:Rf,Line:ke,OBB:to,OptimizedKey:Mf,Plane:Se,Ray:Ie,Sphere:De,Spline:Hf,SplineMode:{LINEAR:0,BEZIER:1,CATMULL_ROM:2},Triangle:Re,WrapModeMask:{Default:0,Normal:1,Loop:2,ShouldWrap:4,Clamp:8,PingPong:22,Reverse:36},constructLegacyCurveAndConvert:function(){var t=new pa;return t.assignSorted([[0,{interpolationMode:2,value:1}],[1,{interpolationMode:2,value:1}]]),t},distance:be,enums:{SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512,SHAPE_SPLINE:1024},evalOptCurve:Cf,intersect:Xu});t("ak",Vf);var $f=/(\.[^./?\\]*)(\?.*)?$/,zf=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,Wf=/[^./]+\/\.\.\//;function Xf(){for(var t="",i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return n.forEach((function(i){t=(t+(""===t?"":"/")+i).replace(/(\/|\\\\)$/,"")})),t}function Yf(t){var i=$f.exec(t);return i?i[1]:""}function Kf(t){if(t){var i=t.lastIndexOf(".");if(-1!==i)return t.substring(0,i)}return t}function qf(t,i){var n=t.indexOf("?");n>0&&(t=t.substring(0,n));var r=/(\/|\\)([^/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!r)return t;var s=r[2];return i&&t.substring(t.length-i.length).toLowerCase()===i.toLowerCase()?s.substring(0,s.length-i.length):s}function Qf(t){var i=zf.exec(t);return i?i[2]:""}function Jf(t,i){i=i||"";var n=t.indexOf("?"),r="";return n>0&&(r=t.substring(n),t=t.substring(0,n)),(n=t.lastIndexOf("."))<0?t+i+r:t.substring(0,n)+i+r}function Zf(t,i,n){if(0===i.indexOf("."))return Jf(t,i);var r=t.indexOf("?"),s="",e=n?Yf(t):"";return r>0&&(s=t.substring(r),t=t.substring(0,r)),r=(r=t.lastIndexOf("/"))<=0?0:r+1,t.substring(0,r)+i+e+s}function tv(t){var i=t=String(t);do{i=t,t=t.replace(Wf,"")}while(i.length!==t.length);return t}function iv(t){return t.replace(/[/\\]$/,"")}function nv(){return wh.os===ch.WINDOWS?"\\":"/"}t("bf",Object.freeze({__proto__:null,_normalize:tv,basename:qf,changeBasename:Zf,changeExtname:Jf,dirname:Qf,extname:Yf,getSeperator:nv,join:Xf,mainFileName:Kf,stripSep:iv}));var rv,sv,ev,hv,uv,ov=10;t("bh",rv),t("bi",sv),t("bj",ev);var cv=0,av=new Map;hv=function(t,i,n,r,s,e,h){var u=av.get(e);u&&u.logTimes>u.count&&(s("'%s' is deprecated, please use '%s' instead. "+h,t+"."+i,n+"."+r),u.count++)},t("bh",rv=function(t,i,n){null!=t&&n.forEach((function(n){var r=cv++;av.set(r,{id:r,count:0,logTimes:void 0!==n.logTimes?n.logTimes:ov});var s=null!=n.target?n.target:t,e=null!=n.newName?n.newName:n.name,h=null!=n.targetName?n.targetName:i,u=s===t,o=n.suggest?"("+n.suggest+")":"";if(null!=n.customFunction)t[n.name]=function(){var t;return hv(i,n.name,h,e,W,r,o),(t=n.customFunction).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var c=null!=n.customSetter,a=null!=n.customGetter;c&&a?Object.defineProperty(t,n.name,{get:function(){return hv(i,n.name,h,e,W,r,o),n.customGetter.call(this)},set:function(t){hv(i,n.name,h,e,W,r,o),n.customSetter.call(this,t)},enumerable:!1}):c?Object.defineProperty(t,n.name,{set:function(t){hv(i,n.name,h,e,W,r,o),n.customSetter.call(this,t)},enumerable:!1}):a&&Object.defineProperty(t,n.name,{get:function(){return hv(i,n.name,h,e,W,r,o),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(t,n.name,{get:function(){return hv(i,n.name,h,e,W,r,o),u?this[e]:s[e]},set:function(t){hv(i,n.name,h,e,W,r,o),u?this[e]=t:s[e]=t},enumerable:!1})}))}),uv=function(t,i,n,r,s){var e=av.get(r);e&&e.logTimes>e.count&&(n("'%s' has been removed. "+s,t+"."+i),e.count++)},t("bi",sv=function(t,i,n){null!=t&&n.forEach((function(n){var r=cv++;av.set(r,{id:r,count:0,logTimes:void 0!==n.logTimes?n.logTimes:ov});var s=n.suggest?"("+n.suggest+")":"";Object.defineProperty(t,n.name,{get:function(){return uv(i,n.name,X,r,s)},set:function(){uv(i,n.name,X,r,s)},enumerable:!1})}))}),t("bj",ev=function(){});var fv,vv={};function lv(t){var i=vv[t];if(i){var n=i.newName,r=i.since;i.removed?n?ht(16003,t,r,n):ht(16002,t,r):n?st(16001,t,r,n):st(16e3,t,r)}}var dv=new Ir;function wv(t,i,n,r){r||(r=new Ir),t.convertToUINode(i,n,r);var s=n.position;return r.add(s),r}function gv(t,i,n){return n||(n=new Ir),t.worldToScreen(i,n),n.x/=O.view.getScaleX(),n.y/=O.view.getScaleY(),n}var pv=t("bp",{WorldNode3DToLocalNodeUI:wv,WorldNode3DToWorldNodeUI:gv});O.pipelineUtils=pv,rv(O.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=i[0],s=i[3]||dv;return r.convertToUINode(i[1],i[2],s),s.add(i[2].position),i[3]||s.clone()}}]),t("cc",{LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:2147483648});var _v=t("cd",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,i){return t._priority<i._priority?1:t._priority>i.priority?-1:0};var i=t.prototype;return i.init=function(){},i.update=function(){},i.postUpdate=function(){},i.destroy=function(){},r(t,[{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}}]),t}());_v.Priority=_i({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:2147483648});var yv=new wt("Scheduler"),mv=function(){function t(t,i,n,r){this.ei=void 0,this.hi=void 0,this.ui=void 0,this.oi=void 0,this.ei=t,this.hi=i,this.ui=n,this.oi=r}return t.ci=function(i,n,r,s){var e=t.ai.pop();return e?(e.ei=i,e.hi=n,e.ui=r,e.oi=s):e=new t(i,n,r,s),e},t.fi=function(i){t.ai.length<20&&(i.ei=null,t.ai.push(i))},t}();mv.ai=[];var bv=function(){function t(t,i,n,r){this.li=void 0,this.di=void 0,this.ei=void 0,this.wi=void 0,this.li=t,this.di=i,this.ei=n,this.wi=r}return t.ci=function(i,n,r,s){var e=t.gi.pop();return e?(e.li=i,e.di=n,e.ei=r,e.wi=s):e=new t(i,n,r,s),e},t.fi=function(i){t.gi.length<20&&(i.li=i.di=i.ei=i.wi=null,t.gi.push(i))},t}();bv.gi=[];var kv=function(){function t(t,i,n,r,s,e){this.pi=void 0,this.ei=void 0,this._i=void 0,this.yi=void 0,this.mi=void 0,this.ui=void 0,this.pi=t,this.ei=i,this._i=n,this.yi=r,this.mi=s,this.ui=e}return t.ci=function(i,n,r,s,e,h){var u=t.bi.pop();return u?(u.pi=i,u.ei=n,u._i=r,u.yi=s,u.mi=e,u.ui=h):u=new t(i,n,r,s,e,h),u},t.fi=function(i){t.bi.length<20&&(i.pi=i.ei=i.yi=null,t.bi.push(i))},t}();kv.bi=[];var Av=function(){function t(){this.ki=void 0,this.Ai=void 0,this.Ei=void 0,this.Ti=void 0,this.Oi=void 0,this.Si=void 0,this.Ii=void 0,this.Ri=void 0,this.Mi=void 0,this.Ci=void 0,this.Ni=void 0,this.ki=!1,this.Ai=null,this.Ei=-1,this.Ti=!1,this.Oi=!1,this.Si=0,this.Ii=0,this.Ri=0,this.Mi=0,this.Ci=null}t.ci=function(){return t.Pi.pop()||new t},t.fi=function(i){t.Pi.length<20&&!i.ki&&(i.Ai=i.Ci=i.Ni=null,t.Pi.push(i))};var i=t.prototype;return i.Li=function(t,i,n,r,s,e){return this.ki=!1,this.Ai=t,this.Ci=n,this.Ni=i,this.Si=0,this.Ei=-1,this.Mi=r,this.Ri=e,this.Oi=this.Ri>0,this.Ii=s,this.Ti=this.Ii===O.macro.REPEAT_FOREVER,!0},i.Di=function(){return this.Mi},i.Bi=function(t){this.Mi=t},i.Fi=function(t){-1===this.Ei?(this.Ei=0,this.Si=0):(this.Ei+=t,this.Ti&&!this.Oi?this.Ei>=this.Mi&&(this.Ui(),this.Ei=0):(this.Oi?this.Ei>=this.Ri&&(this.Ui(),this.Ei-=this.Ri,this.Si+=1,this.Oi=!1):this.Ei>=this.Mi&&(this.Ui(),this.Ei=0,this.Si+=1),this.Ni&&!this.Ti&&this.Si>this.Ii&&this.xi()))},i.Gi=function(){return this.Ni},i.Ui=function(){this.Ci&&this.Ni&&(this.ki=!0,this.Ni.call(this.Ci,this.Ei),this.ki=!1)},i.xi=function(){this.Ai&&this.Ni&&this.Ci&&this.Ai.ji(this,this.Ci)},t}();Av.Pi=[];var Ev=t("b_",function(t){function i(){var i;return(i=t.call(this)||this).Hi=void 0,i.Vi=void 0,i.$i=void 0,i.zi=void 0,i.Wi=void 0,i.Xi=void 0,i.Yi=void 0,i.Ki=void 0,i.qi=void 0,i.Qi=void 0,i.Hi=1,i.Vi=[],i.$i=[],i.zi=[],i.Wi=It(!0),i.Xi=It(!0),i.Yi=null,i.Ki=!1,i.qi=!1,i.Qi=[],i}e(i,t),i.enableForTarget=function(t){var i=!1;(t.uuid||t.id)&&(i=!0),i||(t.id=yv.getNewId())};var n=i.prototype;return n.setTimeScale=function(t){this.Hi=t},n.getTimeScale=function(){return this.Hi},n.update=function(t){var i,n,r,s,e;for(this.qi=!0,1!==this.Hi&&(t*=this.Hi),i=0,r=(n=this.Vi).length;i<r;i++)(s=n[i]).ui||s.oi||!s.ei||null==s.ei.update||s.ei.update(t);for(i=0,r=(n=this.$i).length;i<r;i++)(s=n[i]).ui||s.oi||!s.ei||null==s.ei.update||s.ei.update(t);for(i=0,r=(n=this.zi).length;i<r;i++)(s=n[i]).ui||s.oi||!s.ei||null==s.ei.update||s.ei.update(t);var h=this.Qi;for(i=0;i<h.length;i++){var u;if(e=h[i],this.Yi=e,this.Ki=!1,!e.ui&&e.pi)for(e._i=0;e._i<e.pi.length;++e._i)e.yi=e.pi[e._i],e.mi=!1,e.yi.Fi(t),e.yi=null;this.Ki&&0===(null==(u=this.Yi.pi)?void 0:u.length)&&(this.Ji(this.Yi),--i)}for(i=0,n=this.Vi;i<n.length;)(s=n[i]).oi?this.Zi(s):i++;for(i=0,n=this.$i;i<n.length;)(s=n[i]).oi?this.Zi(s):i++;for(i=0,n=this.zi;i<n.length;)(s=n[i]).oi?this.Zi(s):i++;this.qi=!1,this.Yi=null},n.schedule=function(t,i,n,r,s,e){var h,u,o,c;"function"!=typeof t?(st(1514),o=i,c=t):(o=t,c=i),3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(e=!!r,r=O.macro.REPEAT_FOREVER,s=0),ot(Boolean(c),1502);var a=c.uuid||c.id;if(a){var f,v,l=this.Xi[a];if(l?l.ui!==e&&st(1511):(l=kv.ci(null,c,0,null,!1,Boolean(e)),this.Qi.push(l),this.Xi[a]=l),null==l.pi)l.pi=[];else for(v=0;v<l.pi.length;++v)if((f=l.pi[v])&&o===f.Gi())return tt(1507,f.Di(),n),void f.Bi(n);(f=Av.ci()).Li(this,o,c,n,null!==(h=r)&&void 0!==h?h:0,null!==(u=s)&&void 0!==u?u:0),l.pi.push(f),this.Yi===l&&this.Ki&&(this.Ki=!1)}else ht(1510)},n.scheduleUpdate=function(t,i,n){var r=t.uuid||t.id;if(r){var s=this.Wi[r];if(s&&s.di){if(s.di.hi===i)return s.di.oi=!1,void(s.di.ui=n);if(this.qi)return tt(1506),s.di.oi=!1,void(s.di.ui=n);this.unscheduleUpdate(t)}var e,h=mv.ci(t,i,n,!1);0===i?(e=this.$i,this.tn(e,h)):(e=i<0?this.Vi:this.zi,this.nn(e,h,i)),this.Wi[r]=bv.ci(e,h,t,null)}else ht(1510)},n.unschedule=function(t,i){if(i&&t){var n=i.uuid||i.id;if(n){var r=this.Xi[n];if(r){var s=r.pi;if(!s)return;for(var e=0,h=s.length;e<h;e++){var u=s[e];if(t===u.Gi())return u!==r.yi||r.mi||(r.mi=!0),s.splice(e,1),Av.fi(u),r._i>=e&&r._i--,void(0===s.length&&(this.Yi===r?this.Ki=!0:this.Ji(r)))}}}else ht(1510)}},n.ji=function(t,i){var n=i.uuid||i.id,r=this.Xi[n],s=r.pi;if(s&&0!==s.length)for(var e=s.length-1;e>=0;e--){var h=s[e];if(h===t)return s.splice(e,1),Av.fi(h),r._i>=e&&r._i--,void(0===s.length&&(this.Ki=!0))}},n.unscheduleUpdate=function(t){if(t){var i=t.uuid||t.id;if(i){var n=this.Wi[i];null!=n&&n.di&&(this.qi?n.di.oi=!0:this.Zi(n.di))}else ht(1510)}},n.unscheduleAllForTarget=function(t){if(t){var i=t.uuid||t.id;if(i){var n=this.Xi[i];if(null!=n&&n.pi){var r=n.pi;n.yi&&r.indexOf(n.yi)>-1&&!n.mi&&(n.mi=!0);for(var s=0,e=r.length;s<e;s++)Av.fi(r[s]);r.length=0,this.Yi===n?this.Ki=!0:this.Ji(n)}this.unscheduleUpdate(t)}else ht(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(2147483648)},n.unscheduleAllWithMinPriority=function(t){var i,n,r,s=this.Qi;for(i=s.length-1;i>=0;i--)(n=s[i]).ei&&this.unscheduleAllForTarget(n.ei);var e=0;if(t<0)for(i=0;i<this.Vi.length;){var h;e=this.Vi.length,null!=(h=r=this.Vi[i])&&h.ei&&r.hi>=t&&this.unscheduleUpdate(r.ei),e===this.Vi.length&&i++}if(t<=0)for(i=0;i<this.$i.length;){var u;e=this.$i.length,null!=(u=r=this.$i[i])&&u.ei&&this.unscheduleUpdate(r.ei),e===this.$i.length&&i++}for(i=0;i<this.zi.length;){var o;e=this.zi.length,null!=(o=r=this.zi[i])&&o.ei&&r.hi>=t&&this.unscheduleUpdate(r.ei),e===this.zi.length&&i++}},n.isScheduled=function(t,i){ot(Boolean(t),1508),ot(Boolean(i),1509);var n=i.uuid||i.id;if(!n)return ht(1510),!1;var r=this.Xi[n];if(!r)return!1;if(null==r.pi)return!1;for(var s=r.pi,e=0;e<s.length;++e)if(t===s[e].Gi())return!0;return!1},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(2147483648)},n.pauseAllTargetsWithMinPriority=function(t){var i,n,r,s,e=[],h=this.Qi;for(n=0,r=h.length;n<r;n++){var u;null!=(u=i=h[n])&&u.ei&&(i.ui=!0,e.push(i.ei))}if(t<0)for(n=0;n<this.Vi.length;n++){var o;null!=(o=s=this.Vi[n])&&o.ei&&s.hi>=t&&(s.ui=!0,e.push(s.ei))}if(t<=0)for(n=0;n<this.$i.length;n++){var c;null!=(c=s=this.$i[n])&&c.ei&&(s.ui=!0,e.push(s.ei))}for(n=0;n<this.zi.length;n++){var a;null!=(a=s=this.zi[n])&&a.ei&&s.hi>=t&&(s.ui=!0,e.push(s.ei))}return e},n.resumeTargets=function(t){if(t)for(var i=0;i<t.length;i++)this.resumeTarget(t[i])},n.pauseTarget=function(t){ot(Boolean(t),1503);var i=t.uuid||t.id;if(i){var n=this.Xi[i];n&&(n.ui=!0);var r=this.Wi[i];null!=r&&r.di&&(r.di.ui=!0)}else ht(1510)},n.resumeTarget=function(t){ot(Boolean(t),1504);var i=t.uuid||t.id;if(i){var n=this.Xi[i];n&&(n.ui=!1);var r=this.Wi[i];null!=r&&r.di&&(r.di.ui=!1)}else ht(1510)},n.isTargetPaused=function(t){ot(Boolean(t),1505);var i=t.uuid||t.id;if(!i)return ht(1510),!1;var n=this.Xi[i];if(n)return n.ui;var r=this.Wi[i];return!(null==r||!r.di)&&r.di.ui},n.Ji=function(t){if(t.ei){var i=t.ei.uuid||t.ei.id;if(void 0!==i){delete this.Xi[i];for(var n=this.Qi,r=0,s=n.length;r<s;r++)if(n[r]===t){n.splice(r,1);break}kv.fi(t)}}},n.Zi=function(t){if(t.ei){var i=t.ei.uuid||t.ei.id;if(void 0!==i){var n=this.Wi[i];if(n){var r=n.li,s=n.di;if(r)for(var e=0,h=r.length;e<h;e++)if(r[e]===s){r.splice(e,1);break}delete this.Wi[i],s&&mv.fi(s),bv.fi(n)}}}},n.nn=function(t,i,n){for(var r=0;r<t.length;r++)if(n<t[r].hi)return void t.splice(r,0,i);t.push(i)},n.tn=function(t,i){t.push(i)},i}(_v));Ev.ID="scheduler",O.Scheduler=Ev;var Tv=String.prototype.charCodeAt;function Ov(t){return this[t]}function Sv(t,i){for(var n=t.length,r=i^n,s=0,e="string"==typeof t?Tv:Ov;n>=4;){var h=255&e.call(t,s)|(255&e.call(t,++s))<<8|(255&e.call(t,++s))<<16|(255&e.call(t,++s))<<24;h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),n-=4,++s}switch(n){case 3:r^=(255&e.call(t,s+2))<<16;case 2:r^=(255&e.call(t,s+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.call(t,s)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}function Iv(t,i,n){if(gi(t,i),gi(t,n),i===n)return t;var r=t[i];if(i<n)for(var s=i+1;s<=n;++s)t[s-1]=t[s];else for(var e=i;e!==n;--e)t[e]=t[e-1];return t[n]=r,t}O.easing=fa;var Rv=function(){function t(){this.rn=null,this.sn=new WeakMap}var i=t.prototype;return i.registerGCObject=function(t){return t},i.init=function(){},i.en=function(){},i.destroy=function(){},t}(),Mv=t("cv",new Rv),Cv=t("cw",function(){function t(){return Mv.registerGCObject(this)}return t.prototype.destroy=function(){},t}());function Nv(t,i){for(var n,r=w(i);!(n=r()).done;){var s=n.value;Array.isArray(s)?Nv(t,s):t.push(s)}}function Pv(t){var i=[];return Nv(i,t),i.join("")}O.math=ce,O.geometry=Vf;var Lv=function(t,i,n){for(var r=0;r<i.length;++r)t.length<=r&&t.push(new n),t[r].copy(i[r]);t.length=i.length},Dv={UNKNOWN:0,SWAPCHAIN:1,BUFFER:2,TEXTURE:3,RENDER_PASS:4,FRAMEBUFFER:5,SAMPLER:6,SHADER:7,DESCRIPTOR_SET_LAYOUT:8,PIPELINE_LAYOUT:9,PIPELINE_STATE:10,DESCRIPTOR_SET:11,INPUT_ASSEMBLER:12,COMMAND_BUFFER:13,QUEUE:14,QUERY_POOL:15,GLOBAL_BARRIER:16,TEXTURE_BARRIER:17,BUFFER_BARRIER:18,COUNT:19},Bv={UNREADY:0,FAILED:1,SUCCESS:2},Fv={UNKNOWN:0,GLES2:1,GLES3:2,METAL:3,VULKAN:4,NVN:5,WEBGL:6,WEBGL2:7,WEBGPU:8},Uv={IDENTITY:0,ROTATE_90:1,ROTATE_180:2,ROTATE_270:3},xv={ELEMENT_INDEX_UINT:0,INSTANCED_ARRAYS:1,MULTIPLE_RENDER_TARGETS:2,BLEND_MINMAX:3,COMPUTE_SHADER:4,INPUT_ATTACHMENT_BENEFIT:5,SUBPASS_COLOR_INPUT:6,SUBPASS_DEPTH_STENCIL_INPUT:7,RASTERIZATION_ORDER_NOCOHERENT:8,MULTI_SAMPLE_RESOLVE_DEPTH_STENCIL:9,COUNT:10},Gv={UNKNOWN:0,A8:1,L8:2,LA8:3,R8:4,R8SN:5,R8UI:6,R8I:7,R16F:8,R16UI:9,R16I:10,R32F:11,R32UI:12,R32I:13,RG8:14,RG8SN:15,RG8UI:16,RG8I:17,RG16F:18,RG16UI:19,RG16I:20,RG32F:21,RG32UI:22,RG32I:23,RGB8:24,SRGB8:25,RGB8SN:26,RGB8UI:27,RGB8I:28,RGB16F:29,RGB16UI:30,RGB16I:31,RGB32F:32,RGB32UI:33,RGB32I:34,RGBA8:35,BGRA8:36,SRGB8_A8:37,RGBA8SN:38,RGBA8UI:39,RGBA8I:40,RGBA16F:41,RGBA16UI:42,RGBA16I:43,RGBA32F:44,RGBA32UI:45,RGBA32I:46,R5G6B5:47,R11G11B10F:48,RGB5A1:49,RGBA4:50,RGB10A2:51,RGB10A2UI:52,RGB9E5:53,DEPTH:54,DEPTH_STENCIL:55,BC1:56,BC1_ALPHA:57,BC1_SRGB:58,BC1_SRGB_ALPHA:59,BC2:60,BC2_SRGB:61,BC3:62,BC3_SRGB:63,BC4:64,BC4_SNORM:65,BC5:66,BC5_SNORM:67,BC6H_UF16:68,BC6H_SF16:69,BC7:70,BC7_SRGB:71,ETC_RGB8:72,ETC2_RGB8:73,ETC2_SRGB8:74,ETC2_RGB8_A1:75,ETC2_SRGB8_A1:76,ETC2_RGBA8:77,ETC2_SRGB8_A8:78,EAC_R11:79,EAC_R11SN:80,EAC_RG11:81,EAC_RG11SN:82,PVRTC_RGB2:83,PVRTC_RGBA2:84,PVRTC_RGB4:85,PVRTC_RGBA4:86,PVRTC2_2BPP:87,PVRTC2_4BPP:88,ASTC_RGBA_4X4:89,ASTC_RGBA_5X4:90,ASTC_RGBA_5X5:91,ASTC_RGBA_6X5:92,ASTC_RGBA_6X6:93,ASTC_RGBA_8X5:94,ASTC_RGBA_8X6:95,ASTC_RGBA_8X8:96,ASTC_RGBA_10X5:97,ASTC_RGBA_10X6:98,ASTC_RGBA_10X8:99,ASTC_RGBA_10X10:100,ASTC_RGBA_12X10:101,ASTC_RGBA_12X12:102,ASTC_SRGBA_4X4:103,ASTC_SRGBA_5X4:104,ASTC_SRGBA_5X5:105,ASTC_SRGBA_6X5:106,ASTC_SRGBA_6X6:107,ASTC_SRGBA_8X5:108,ASTC_SRGBA_8X6:109,ASTC_SRGBA_8X8:110,ASTC_SRGBA_10X5:111,ASTC_SRGBA_10X6:112,ASTC_SRGBA_10X8:113,ASTC_SRGBA_10X10:114,ASTC_SRGBA_12X10:115,ASTC_SRGBA_12X12:116,COUNT:117},jv={NONE:0,UNORM:1,SNORM:2,UINT:3,INT:4,UFLOAT:5,FLOAT:6},Hv={FLOAT:0,UNFILTERABLE_FLOAT:1,SINT:2,UINT:3},Vv={UNKNOWN:0,BOOL:1,BOOL2:2,BOOL3:3,BOOL4:4,INT:5,INT2:6,INT3:7,INT4:8,UINT:9,UINT2:10,UINT3:11,UINT4:12,FLOAT:13,FLOAT2:14,FLOAT3:15,FLOAT4:16,MAT2:17,MAT2X3:18,MAT2X4:19,MAT3X2:20,MAT3:21,MAT3X4:22,MAT4X2:23,MAT4X3:24,MAT4:25,SAMPLER1D:26,SAMPLER1D_ARRAY:27,SAMPLER2D:28,SAMPLER2D_ARRAY:29,SAMPLER3D:30,SAMPLER_CUBE:31,SAMPLER:32,TEXTURE1D:33,TEXTURE1D_ARRAY:34,TEXTURE2D:35,TEXTURE2D_ARRAY:36,TEXTURE3D:37,TEXTURE_CUBE:38,IMAGE1D:39,IMAGE1D_ARRAY:40,IMAGE2D:41,IMAGE2D_ARRAY:42,IMAGE3D:43,IMAGE_CUBE:44,SUBPASS_INPUT:45,COUNT:46},$v={NONE:0,TRANSFER_SRC:1,TRANSFER_DST:2,INDEX:4,VERTEX:8,UNIFORM:16,STORAGE:32,INDIRECT:64},zv={NONE:0,ENABLE_STAGING_WRITE:1},Wv={NONE:0,READ_ONLY:1,WRITE_ONLY:2,READ_WRITE:3},Xv={NONE:0,DEVICE:1,HOST:2},Yv={TEX1D:0,TEX2D:1,TEX3D:2,CUBE:3,TEX1D_ARRAY:4,TEX2D_ARRAY:5},Kv={UNKNOWN:0,BUFFER:1,TEX1D:2,TEX1D_ARRAY:3,TEX2D:4,TEX2D_ARRAY:5,TEX2DMS:6,TEX2DMS_ARRAY:7,TEX3D:8,TEXCUBE:9,TEXCUBE_ARRAY:10,RAYTRACING_ACCELERATION_STRUCTURE:11},qv={NONE:0,TRANSFER_SRC:1,TRANSFER_DST:2,SAMPLED:4,STORAGE:8,COLOR_ATTACHMENT:16,DEPTH_STENCIL_ATTACHMENT:32,INPUT_ATTACHMENT:64,SHADING_RATE:128},Qv={NONE:0,GEN_MIPMAP:1,GENERAL_LAYOUT:2,EXTERNAL_OES:4,EXTERNAL_NORMAL:8,LAZILY_ALLOCATED:16,MUTABLE_VIEW_FORMAT:64,MUTABLE_STORAGE:128},Jv={NONE:0,RENDER_TARGET:1,SAMPLED_TEXTURE:2,LINEAR_FILTER:4,STORAGE_TEXTURE:8,VERTEX_ATTRIBUTE:16,SHADING_RATE:32},Zv={X1:1,X2:2,X4:4,X8:8,X16:16,X32:32,X64:64},tl={OFF:0,ON:1,RELAXED:2,MAILBOX:3,HALF:4},il={NONE:0,POINT:1,LINEAR:2,ANISOTROPIC:3},nl={WRAP:0,MIRROR:1,CLAMP:2,BORDER:3},rl={NEVER:0,LESS:1,EQUAL:2,LESS_EQUAL:3,GREATER:4,NOT_EQUAL:5,GREATER_EQUAL:6,ALWAYS:7},sl={ZERO:0,KEEP:1,REPLACE:2,INCR:3,DECR:4,INVERT:5,INCR_WRAP:6,DECR_WRAP:7},el={ZERO:0,ONE:1,SRC_ALPHA:2,DST_ALPHA:3,ONE_MINUS_SRC_ALPHA:4,ONE_MINUS_DST_ALPHA:5,SRC_COLOR:6,DST_COLOR:7,ONE_MINUS_SRC_COLOR:8,ONE_MINUS_DST_COLOR:9,SRC_ALPHA_SATURATE:10,CONSTANT_COLOR:11,ONE_MINUS_CONSTANT_COLOR:12,CONSTANT_ALPHA:13,ONE_MINUS_CONSTANT_ALPHA:14},hl={ADD:0,SUB:1,REV_SUB:2,MIN:3,MAX:4},ul={NONE:0,R:1,G:2,B:4,A:8,ALL:15},ol={NONE:0,VERTEX:1,CONTROL:2,EVALUATION:4,GEOMETRY:8,FRAGMENT:16,COMPUTE:32,ALL:63},cl={LOAD:0,CLEAR:1,DISCARD:2},al={STORE:0,DISCARD:1},fl={NONE:0,INDIRECT_BUFFER:1,INDEX_BUFFER:2,VERTEX_BUFFER:4,VERTEX_SHADER_READ_UNIFORM_BUFFER:8,VERTEX_SHADER_READ_TEXTURE:16,VERTEX_SHADER_READ_OTHER:32,FRAGMENT_SHADER_READ_UNIFORM_BUFFER:64,FRAGMENT_SHADER_READ_TEXTURE:128,FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT:256,FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT:512,FRAGMENT_SHADER_READ_OTHER:1024,COLOR_ATTACHMENT_READ:2048,DEPTH_STENCIL_ATTACHMENT_READ:4096,COMPUTE_SHADER_READ_UNIFORM_BUFFER:8192,COMPUTE_SHADER_READ_TEXTURE:16384,COMPUTE_SHADER_READ_OTHER:32768,TRANSFER_READ:65536,HOST_READ:131072,PRESENT:262144,VERTEX_SHADER_WRITE:524288,FRAGMENT_SHADER_WRITE:1048576,COLOR_ATTACHMENT_WRITE:2097152,DEPTH_STENCIL_ATTACHMENT_WRITE:4194304,COMPUTE_SHADER_WRITE:8388608,TRANSFER_WRITE:16777216,HOST_PREINITIALIZED:33554432,HOST_WRITE:67108864,SHADING_RATE:134217728},vl={NONE:0,SAMPLE_ZERO:1,AVERAGE:2,MIN:3,MAX:4},ll={GRAPHICS:0,COMPUTE:1,RAY_TRACING:2},dl={POINT_LIST:0,LINE_LIST:1,LINE_STRIP:2,LINE_LOOP:3,LINE_LIST_ADJACENCY:4,LINE_STRIP_ADJACENCY:5,ISO_LINE_LIST:6,TRIANGLE_LIST:7,TRIANGLE_STRIP:8,TRIANGLE_FAN:9,TRIANGLE_LIST_ADJACENCY:10,TRIANGLE_STRIP_ADJACENCY:11,TRIANGLE_PATCH_ADJACENCY:12,QUAD_PATCH_LIST:13},wl={FILL:0,POINT:1,LINE:2},gl={GOURAND:0,FLAT:1},pl={NONE:0,FRONT:1,BACK:2},_l={NONE:0,LINE_WIDTH:1,DEPTH_BIAS:2,BLEND_CONSTANTS:4,DEPTH_BOUNDS:8,STENCIL_WRITE_MASK:16,STENCIL_COMPARE_MASK:32},yl={FRONT:1,BACK:2,ALL:3},ml={UNKNOWN:0,UNIFORM_BUFFER:1,DYNAMIC_UNIFORM_BUFFER:2,STORAGE_BUFFER:4,DYNAMIC_STORAGE_BUFFER:8,SAMPLER_TEXTURE:16,SAMPLER:32,TEXTURE:64,STORAGE_IMAGE:128,INPUT_ATTACHMENT:256},bl={GRAPHICS:0,COMPUTE:1,TRANSFER:2},kl={OCCLUSION:0,PIPELINE_STATISTICS:1,TIMESTAMP:2},Al={PRIMARY:0,SECONDARY:1},El={NONE:0,COLOR:1,DEPTH:2,STENCIL:4,DEPTH_STENCIL:6,ALL:7},Tl={FULL:0,SPLIT_BEGIN:1,SPLIT_END:2},Ol={RASTER:0,COMPUTE:1,COPY:2,MOVE:3,RAYTRACE:4,PRESENT:5},Sl=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=i,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),Il=function(){function t(t,i,n,r,s,e,h,u,o,c,a,f,v,l,d,w,g,p,_,y,m,b,k,A,E,T){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=0),void 0===a&&(a=0),void 0===f&&(f=0),void 0===v&&(v=0),void 0===l&&(l=0),void 0===d&&(d=0),void 0===w&&(w=1),void 0===g&&(g=0),void 0===p&&(p=0),void 0===_&&(_=new Sl),void 0===y&&(y=new Sl),void 0===m&&(m=!1),void 0===b&&(b=!1),void 0===k&&(k=!1),void 0===A&&(A=-1),void 0===E&&(E=1),void 0===T&&(T=1),this.maxVertexAttributes=t,this.maxVertexUniformVectors=i,this.maxFragmentUniformVectors=n,this.maxTextureUnits=r,this.maxImageUnits=s,this.maxVertexTextureUnits=e,this.maxColorRenderTargets=h,this.maxShaderStorageBufferBindings=u,this.maxShaderStorageBlockSize=o,this.maxUniformBufferBindings=c,this.maxUniformBlockSize=a,this.maxTextureSize=f,this.maxCubeMapTextureSize=v,this.maxArrayTextureLayers=l,this.max3DTextureSize=d,this.uboOffsetAlignment=w,this.maxComputeSharedMemorySize=g,this.maxComputeWorkGroupInvocations=p,this.maxComputeWorkGroupSize=_,this.maxComputeWorkGroupCount=y,this.supportQuery=m,this.supportVariableRateShading=b,this.supportSubPassShading=k,this.clipSpaceMinZ=A,this.screenSpaceSignY=E,this.clipSpaceSignY=T}return t.prototype.copy=function(t){return this.maxVertexAttributes=t.maxVertexAttributes,this.maxVertexUniformVectors=t.maxVertexUniformVectors,this.maxFragmentUniformVectors=t.maxFragmentUniformVectors,this.maxTextureUnits=t.maxTextureUnits,this.maxImageUnits=t.maxImageUnits,this.maxVertexTextureUnits=t.maxVertexTextureUnits,this.maxColorRenderTargets=t.maxColorRenderTargets,this.maxShaderStorageBufferBindings=t.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=t.maxShaderStorageBlockSize,this.maxUniformBufferBindings=t.maxUniformBufferBindings,this.maxUniformBlockSize=t.maxUniformBlockSize,this.maxTextureSize=t.maxTextureSize,this.maxCubeMapTextureSize=t.maxCubeMapTextureSize,this.maxArrayTextureLayers=t.maxArrayTextureLayers,this.max3DTextureSize=t.max3DTextureSize,this.uboOffsetAlignment=t.uboOffsetAlignment,this.maxComputeSharedMemorySize=t.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=t.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(t.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(t.maxComputeWorkGroupCount),this.supportQuery=t.supportQuery,this.supportVariableRateShading=t.supportVariableRateShading,this.supportSubPassShading=t.supportSubPassShading,this.clipSpaceMinZ=t.clipSpaceMinZ,this.screenSpaceSignY=t.screenSpaceSignY,this.clipSpaceSignY=t.clipSpaceSignY,this},t}(),Rl=function(){function t(t){void 0===t&&(t=!0),this.enableBarrierDeduce=t}return t.prototype.copy=function(t){return this.enableBarrierDeduce=t.enableBarrierDeduce,this},t}(),Ml=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=i,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),Cl=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=i,this.width=n,this.height=r}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t}(),Nl=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),this.width=t,this.height=i,this.depth=n}return t.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this},t}(),Pl=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),this.mipLevel=t,this.baseArrayLayer=i,this.layerCount=n}return t.prototype.copy=function(t){return this.mipLevel=t.mipLevel,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),Ll=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=1),this.baseMipLevel=t,this.levelCount=i,this.baseArrayLayer=n,this.layerCount=r}return t.prototype.copy=function(t){return this.baseMipLevel=t.baseMipLevel,this.levelCount=t.levelCount,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),Dl=function(){function t(t,i,n,r,s){void 0===t&&(t=new Pl),void 0===i&&(i=new Ml),void 0===n&&(n=new Pl),void 0===r&&(r=new Ml),void 0===s&&(s=new Nl),this.srcSubres=t,this.srcOffset=i,this.dstSubres=n,this.dstOffset=r,this.extent=s}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.extent.copy(t.extent),this},t}(),Bl=function(){function t(t,i,n,r,s,e){void 0===t&&(t=new Pl),void 0===i&&(i=new Ml),void 0===n&&(n=new Nl),void 0===r&&(r=new Pl),void 0===s&&(s=new Ml),void 0===e&&(e=new Nl),this.srcSubres=t,this.srcOffset=i,this.srcExtent=n,this.dstSubres=r,this.dstOffset=s,this.dstExtent=e}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.srcExtent.copy(t.srcExtent),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.dstExtent.copy(t.dstExtent),this},t}(),Fl=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=new Ml),void 0===s&&(s=new Nl),void 0===e&&(e=new Pl),this.buffOffset=t,this.buffStride=i,this.buffTexHeight=n,this.texOffset=r,this.texExtent=s,this.texSubres=e}return t.prototype.copy=function(t){return this.buffOffset=t.buffOffset,this.buffStride=t.buffStride,this.buffTexHeight=t.buffTexHeight,this.texOffset.copy(t.texOffset),this.texExtent.copy(t.texExtent),this.texSubres.copy(t.texSubres),this},t}(),Ul=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=1),this.left=t,this.top=i,this.width=n,this.height=r,this.minDepth=s,this.maxDepth=e}var i=t.prototype;return i.copy=function(t){return this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,this.minDepth=t.minDepth,this.maxDepth=t.maxDepth,this},i.reset=function(){this.left=0,this.top=0,this.width=0,this.height=0,this.minDepth=0,this.maxDepth=1},t}(),xl=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=i,this.z=n,this.w=r}var i=t.prototype;return i.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.set=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},i.reset=function(){this.x=0,this.y=0,this.z=0,this.w=0},t}(),Gl=function(){function t(t,i){void 0===t&&(t=""),void 0===i&&(i=new xl),this.name=t,this.color=i}return t.prototype.copy=function(t){return this.name=t.name,this.color.copy(t.color),this},t}(),jl=function(){function t(t,i,n,r,s,e,h,u){void 0===t&&(t=[0]),void 0===i&&(i=[0]),void 0===n&&(n=[0]),void 0===r&&(r=[0]),void 0===s&&(s=[0]),void 0===e&&(e=[0]),void 0===h&&(h=[0]),void 0===u&&(u=[0]),this.maxBlockCounts=t,this.maxSamplerTextureCounts=i,this.maxSamplerCounts=n,this.maxTextureCounts=r,this.maxBufferCounts=s,this.maxImageCounts=e,this.maxSubpassInputCounts=h,this.setIndices=u}return t.prototype.copy=function(t){return this.maxBlockCounts=t.maxBlockCounts.slice(),this.maxSamplerTextureCounts=t.maxSamplerTextureCounts.slice(),this.maxSamplerCounts=t.maxSamplerCounts.slice(),this.maxTextureCounts=t.maxTextureCounts.slice(),this.maxBufferCounts=t.maxBufferCounts.slice(),this.maxImageCounts=t.maxImageCounts.slice(),this.maxSubpassInputCounts=t.maxSubpassInputCounts.slice(),this.setIndices=t.setIndices.slice(),this},t}(),Hl=function(){function t(t,i,n,r,s){void 0===t&&(t=0),void 0===i&&(i=null),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),this.windowId=t,this.windowHandle=i,this.vsyncMode=n,this.width=r,this.height=s}return t.prototype.copy=function(t){return this.windowId=t.windowId,this.windowHandle=t.windowHandle,this.vsyncMode=t.vsyncMode,this.width=t.width,this.height=t.height,this},t}(),Vl=function(){function t(t){void 0===t&&(t=new jl),this.bindingMappingInfo=t}return t.prototype.copy=function(t){return this.bindingMappingInfo.copy(t.bindingMappingInfo),this},t}(),$l=function(){function t(t,i,n,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=0),this.usage=t,this.memUsage=i,this.size=n,this.stride=r,this.flags=s}return t.prototype.copy=function(t){return this.usage=t.usage,this.memUsage=t.memUsage,this.size=t.size,this.stride=t.stride,this.flags=t.flags,this},t}(),zl=function(){function t(t,i,n){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=0),this.buffer=t,this.offset=i,this.range=n}return t.prototype.copy=function(t){return this.buffer=t.buffer,this.offset=t.offset,this.range=t.range,this},t}(),Wl=function(){function t(t,i,n,r,s,e,h){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),this.vertexCount=t,this.firstVertex=i,this.indexCount=n,this.firstIndex=r,this.vertexOffset=s,this.instanceCount=e,this.firstInstance=h}return t.prototype.copy=function(t){return this.vertexCount=t.vertexCount,this.firstVertex=t.firstVertex,this.indexCount=t.indexCount,this.firstIndex=t.firstIndex,this.vertexOffset=t.vertexOffset,this.instanceCount=t.instanceCount,this.firstInstance=t.firstInstance,this},t}(),Xl=function(){function t(t,i,n,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=null),void 0===s&&(s=0),this.groupCountX=t,this.groupCountY=i,this.groupCountZ=n,this.indirectBuffer=r,this.indirectOffset=s}return t.prototype.copy=function(t){return this.groupCountX=t.groupCountX,this.groupCountY=t.groupCountY,this.groupCountZ=t.groupCountZ,this.indirectBuffer=t.indirectBuffer,this.indirectOffset=t.indirectOffset,this},t}(),Yl=function(){function t(t){void 0===t&&(t=[]),this.drawInfos=t}return t.prototype.copy=function(t){return Lv(this.drawInfos,t.drawInfos,Wl),this},t}(),Kl=function(){function t(t,i,n,r,s,e,h,u,o,c,a){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=1),void 0===u&&(u=1),void 0===o&&(o=1),void 0===c&&(c=1),void 0===a&&(a=0),this.type=t,this.usage=i,this.format=n,this.width=r,this.height=s,this.flags=e,this.layerCount=h,this.levelCount=u,this.samples=o,this.depth=c,this.externalRes=a}return t.prototype.copy=function(t){return this.type=t.type,this.usage=t.usage,this.format=t.format,this.width=t.width,this.height=t.height,this.flags=t.flags,this.layerCount=t.layerCount,this.levelCount=t.levelCount,this.samples=t.samples,this.depth=t.depth,this.externalRes=t.externalRes,this},t}(),ql=function(){function t(t,i,n,r,s,e,h,u,o){void 0===t&&(t=null),void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===e&&(e=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===o&&(o=1),this.texture=t,this.type=i,this.format=n,this.baseLevel=r,this.levelCount=s,this.baseLayer=e,this.layerCount=h,this.basePlane=u,this.planeCount=o}return t.prototype.copy=function(t){return this.texture=t.texture,this.type=t.type,this.format=t.format,this.baseLevel=t.baseLevel,this.levelCount=t.levelCount,this.baseLayer=t.baseLayer,this.layerCount=t.layerCount,this.basePlane=t.basePlane,this.planeCount=t.planeCount,this},t}(),Ql=function(){function t(t,i,n,r,s,e,h,u){void 0===t&&(t=2),void 0===i&&(i=2),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=7),this.minFilter=t,this.magFilter=i,this.mipFilter=n,this.addressU=r,this.addressV=s,this.addressW=e,this.maxAnisotropy=h,this.cmpFunc=u}return t.prototype.copy=function(t){return this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.mipFilter=t.mipFilter,this.addressU=t.addressU,this.addressV=t.addressV,this.addressW=t.addressW,this.maxAnisotropy=t.maxAnisotropy,this.cmpFunc=t.cmpFunc,this},t}(),Jl=function(){function t(t,i,n){void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=0),this.name=t,this.type=i,this.count=n}return t.prototype.copy=function(t){return this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),Zl=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=[]),void 0===s&&(s=0),void 0===e&&(e=0),this.set=t,this.binding=i,this.name=n,this.members=r,this.count=s,this.flattened=e}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,Lv(this.members,t.members,Jl),this.count=t.count,this.flattened=t.flattened,this},t}(),td=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),this.set=t,this.binding=i,this.name=n,this.type=r,this.count=s,this.flattened=e}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.flattened=t.flattened,this},t}(),id=function(){function t(t,i,n,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=0),void 0===s&&(s=0),this.set=t,this.binding=i,this.name=n,this.count=r,this.flattened=s}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.flattened=t.flattened,this},t}(),nd=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),this.set=t,this.binding=i,this.name=n,this.type=r,this.count=s,this.flattened=e}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.flattened=t.flattened,this},t}(),rd=function(){function t(t,i,n,r,s,e,h){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=3),void 0===h&&(h=0),this.set=t,this.binding=i,this.name=n,this.type=r,this.count=s,this.memoryAccess=e,this.flattened=h}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.memoryAccess=t.memoryAccess,this.flattened=t.flattened,this},t}(),sd=function(){function t(t,i,n,r,s,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=0),void 0===s&&(s=3),void 0===e&&(e=0),this.set=t,this.binding=i,this.name=n,this.count=r,this.memoryAccess=s,this.flattened=e}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.memoryAccess=t.memoryAccess,this.flattened=t.flattened,this},t}(),ed=function(){function t(t,i,n,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=0),void 0===s&&(s=0),this.set=t,this.binding=i,this.name=n,this.count=r,this.flattened=s}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.flattened=t.flattened,this},t}(),hd=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=""),this.stage=t,this.source=i}return t.prototype.copy=function(t){return this.stage=t.stage,this.source=t.source,this},t}(),ud=function(){function t(t,i,n,r,s,e){void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=!1),void 0===r&&(r=0),void 0===s&&(s=!1),void 0===e&&(e=0),this.name=t,this.format=i,this.isNormalized=n,this.stream=r,this.isInstanced=s,this.location=e}return t.prototype.copy=function(t){return this.name=t.name,this.format=t.format,this.isNormalized=t.isNormalized,this.stream=t.stream,this.isInstanced=t.isInstanced,this.location=t.location,this},t}(),od=function(){function t(t,i,n,r,s,e,h,u,o,c,a){void 0===t&&(t=""),void 0===i&&(i=[]),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===s&&(s=[]),void 0===e&&(e=[]),void 0===h&&(h=[]),void 0===u&&(u=[]),void 0===o&&(o=[]),void 0===c&&(c=[]),void 0===a&&(a=4294967295),this.name=t,this.stages=i,this.attributes=n,this.blocks=r,this.buffers=s,this.samplerTextures=e,this.samplers=h,this.textures=u,this.images=o,this.subpassInputs=c,this.hash=a}return t.prototype.copy=function(t){return this.name=t.name,Lv(this.stages,t.stages,hd),Lv(this.attributes,t.attributes,ud),Lv(this.blocks,t.blocks,Zl),Lv(this.buffers,t.buffers,sd),Lv(this.samplerTextures,t.samplerTextures,td),Lv(this.samplers,t.samplers,id),Lv(this.textures,t.textures,nd),Lv(this.images,t.images,rd),Lv(this.subpassInputs,t.subpassInputs,ed),this.hash=t.hash,this},t}(),cd=function(){function t(t,i,n,r){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===n&&(n=null),void 0===r&&(r=null),this.attributes=t,this.vertexBuffers=i,this.indexBuffer=n,this.indirectBuffer=r}return t.prototype.copy=function(t){return Lv(this.attributes,t.attributes,ud),this.vertexBuffers=t.vertexBuffers.slice(),this.indexBuffer=t.indexBuffer,this.indirectBuffer=t.indirectBuffer,this},t}(),ad=function(){function t(t,i,n,r,s){void 0===t&&(t=0),void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=null),this.format=t,this.sampleCount=i,this.loadOp=n,this.storeOp=r,this.barrier=s}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.loadOp=t.loadOp,this.storeOp=t.storeOp,this.barrier=t.barrier,this},t}(),fd=function(){function t(t,i,n,r,s,e,h){void 0===t&&(t=0),void 0===i&&(i=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=1),void 0===e&&(e=0),void 0===h&&(h=null),this.format=t,this.sampleCount=i,this.depthLoadOp=n,this.depthStoreOp=r,this.stencilLoadOp=s,this.stencilStoreOp=e,this.barrier=h}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.depthLoadOp=t.depthLoadOp,this.depthStoreOp=t.depthStoreOp,this.stencilLoadOp=t.stencilLoadOp,this.stencilStoreOp=t.stencilStoreOp,this.barrier=t.barrier,this},t}(),vd=function(){function t(t,i,n,r,s,e,h,u,o){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===s&&(s=-1),void 0===e&&(e=-1),void 0===h&&(h=-1),void 0===u&&(u=0),void 0===o&&(o=0),this.inputs=t,this.colors=i,this.resolves=n,this.preserves=r,this.depthStencil=s,this.depthStencilResolve=e,this.shadingRate=h,this.depthResolveMode=u,this.stencilResolveMode=o}return t.prototype.copy=function(t){return this.inputs=t.inputs.slice(),this.colors=t.colors.slice(),this.resolves=t.resolves.slice(),this.preserves=t.preserves.slice(),this.depthStencil=t.depthStencil,this.depthStencilResolve=t.depthStencilResolve,this.shadingRate=t.shadingRate,this.depthResolveMode=t.depthResolveMode,this.stencilResolveMode=t.stencilResolveMode,this},t}(),ld=function(){function t(t,i,n,r,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=null),void 0===r&&(r=0),void 0===s&&(s=0),this.srcSubpass=t,this.dstSubpass=i,this.generalBarrier=n,this.prevAccesses=r,this.nextAccesses=s}return t.prototype.copy=function(t){return this.srcSubpass=t.srcSubpass,this.dstSubpass=t.dstSubpass,this.generalBarrier=t.generalBarrier,this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this},t}(),dd=function(){function t(t,i,n,r,s){void 0===t&&(t=[]),void 0===i&&(i=new fd),void 0===n&&(n=new fd),void 0===r&&(r=[]),void 0===s&&(s=[]),this.colorAttachments=t,this.depthStencilAttachment=i,this.depthStencilResolveAttachment=n,this.subpasses=r,this.dependencies=s}return t.prototype.copy=function(t){return Lv(this.colorAttachments,t.colorAttachments,ad),this.depthStencilAttachment.copy(t.depthStencilAttachment),this.depthStencilResolveAttachment.copy(t.depthStencilResolveAttachment),Lv(this.subpasses,t.subpasses,vd),Lv(this.dependencies,t.dependencies,ld),this},t}(),wd=function(){function t(t,i,n,r,s,e,h,u,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),this.width=t,this.height=i,this.depthOrArraySize=n,this.firstSlice=r,this.numSlices=s,this.mipLevel=e,this.levelCount=h,this.basePlane=u,this.planeCount=o}return t.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.depthOrArraySize=t.depthOrArraySize,this.firstSlice=t.firstSlice,this.numSlices=t.numSlices,this.mipLevel=t.mipLevel,this.levelCount=t.levelCount,this.basePlane=t.basePlane,this.planeCount=t.planeCount,this},t}(),gd=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.prevAccesses=t,this.nextAccesses=i,this.type=n}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this},t}(),pd=function(){function t(t,i,n,r,s,e,h){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=new wd),void 0===s&&(s=!1),void 0===e&&(e=null),void 0===h&&(h=null),this.prevAccesses=t,this.nextAccesses=i,this.type=n,this.range=r,this.discardContents=s,this.srcQueue=e,this.dstQueue=h}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this.range.copy(t.range),this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this},t}(),_d=function(){function t(t,i,n,r,s,e,h,u){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=!1),void 0===h&&(h=null),void 0===u&&(u=null),this.prevAccesses=t,this.nextAccesses=i,this.type=n,this.offset=r,this.size=s,this.discardContents=e,this.srcQueue=h,this.dstQueue=u}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this.offset=t.offset,this.size=t.size,this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this},t}(),yd=function(){function t(t,i,n,r){void 0===t&&(t=null),void 0===i&&(i=[]),void 0===n&&(n=null),void 0===r&&(r=null),this.renderPass=t,this.colorTextures=i,this.depthStencilTexture=n,this.depthStencilResolveTexture=r}return t.prototype.copy=function(t){return this.renderPass=t.renderPass,this.colorTextures=t.colorTextures.slice(),this.depthStencilTexture=t.depthStencilTexture,this.depthStencilResolveTexture=t.depthStencilResolveTexture,this},t}(),md=function(){function t(t,i,n,r,s,e,h,u,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=[]),this.binding=t,this.descriptorType=i,this.count=n,this.stageFlags=r,this.access=s,this.viewDimension=e,this.sampleType=h,this.format=u,this.immutableSamplers=o}return t.prototype.copy=function(t){return this.binding=t.binding,this.descriptorType=t.descriptorType,this.count=t.count,this.stageFlags=t.stageFlags,this.access=t.access,this.viewDimension=t.viewDimension,this.sampleType=t.sampleType,this.format=t.format,this.immutableSamplers=t.immutableSamplers.slice(),this},t}(),bd=function(){function t(t){void 0===t&&(t=[]),this.bindings=t}return t.prototype.copy=function(t){return Lv(this.bindings,t.bindings,md),this},t}(),kd=function(){function t(t){void 0===t&&(t=null),this.layout=t}return t.prototype.copy=function(t){return this.layout=t.layout,this},t}(),Ad=function(){function t(t){void 0===t&&(t=[]),this.setLayouts=t}return t.prototype.copy=function(t){return this.setLayouts=t.setLayouts.slice(),this},t}(),Ed=function(){function t(t){void 0===t&&(t=[]),this.attributes=t}return t.prototype.copy=function(t){return Lv(this.attributes,t.attributes,ud),this},t}(),Td=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=0),this.queue=t,this.type=i}return t.prototype.copy=function(t){return this.queue=t.queue,this.type=t.type,this},t}(),Od=function(){function t(t){void 0===t&&(t=0),this.type=t}return t.prototype.copy=function(t){return this.type=t.type,this},t}(),Sd=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=32767),void 0===n&&(n=!0),this.type=t,this.maxQueryObjects=i,this.forceWait=n}return t.prototype.copy=function(t){return this.type=t.type,this.maxQueryObjects=t.maxQueryObjects,this.forceWait=t.forceWait,this},t}(),Id=function(){function t(t,i,n,r,s,e,h,u){void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=!1),void 0===e&&(e=!1),void 0===h&&(h=!1),void 0===u&&(u=!1),this.name=t,this.size=i,this.count=n,this.type=r,this.hasAlpha=s,this.hasDepth=e,this.hasStencil=h,this.isCompressed=u}return t.prototype.copy=function(t){return this.name=t.name,this.size=t.size,this.count=t.count,this.type=t.type,this.hasAlpha=t.hasAlpha,this.hasDepth=t.hasDepth,this.hasStencil=t.hasStencil,this.isCompressed=t.isCompressed,this},t}(),Rd=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.bufferSize=t,this.textureSize=i}return t.prototype.copy=function(t){return this.bufferSize=t.bufferSize,this.textureSize=t.textureSize,this},t}(),Md=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.writeMask=t,this.compareMask=i,this.reference=n}return t.prototype.copy=function(t){return this.writeMask=t.writeMask,this.compareMask=t.compareMask,this.reference=t.reference,this},t}(),Cd=function(){function t(t,i,n,r,s,e,h,u,o,c,a){void 0===t&&(t=new Ul),void 0===i&&(i=new Cl),void 0===n&&(n=new xl),void 0===r&&(r=1),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=new Md),void 0===a&&(a=new Md),this.viewport=t,this.scissor=i,this.blendConstant=n,this.lineWidth=r,this.depthBiasConstant=s,this.depthBiasClamp=e,this.depthBiasSlope=h,this.depthMinBounds=u,this.depthMaxBounds=o,this.stencilStatesFront=c,this.stencilStatesBack=a}return t.prototype.copy=function(t){return this.viewport.copy(t.viewport),this.scissor.copy(t.scissor),this.blendConstant.copy(t.blendConstant),this.lineWidth=t.lineWidth,this.depthBiasConstant=t.depthBiasConstant,this.depthBiasClamp=t.depthBiasClamp,this.depthBiasSlope=t.depthBiasSlope,this.depthMinBounds=t.depthMinBounds,this.depthMaxBounds=t.depthMaxBounds,this.stencilStatesFront.copy(t.stencilStatesFront),this.stencilStatesBack.copy(t.stencilStatesBack),this},t}(),Nd=function(t){function i(n){var r;return(r=t.call(this)||this).hn=0,r.un=0,r.cn=0,r.hn=n,r.un=i.an[0]++,r.cn=i.an[n]++,r}return e(i,t),r(i,[{key:"objectType",get:function(){return this.hn}},{key:"objectID",get:function(){return this.un}},{key:"typedID",get:function(){return this.cn}}]),i}(Cv);Nd.an=Array(19).fill(65536);var Pd={ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR1:"a_color1",ATTR_COLOR2:"a_color2",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_BATCH_ID:"a_batch_id",ATTR_BATCH_UV:"a_batch_uv"};function Ld(t,i,n,r,s,e,h,u){return new Id(t,i,n,r,s,e,h,u)}function Dd(t){return new Id("ASTC_SRGBA_"+t,1,4,1,!0,!1,!1,!0)}function Bd(t){return new Id("ASTC_RGBA_"+t,1,4,1,!0,!1,!1,!0)}var Fd=Object.freeze([Ld("UNKNOWN"),Ld("A8",1,1,1,!0),Ld("L8",1,1,1),Ld("LA8",1,2,1,!0),Ld("R8",1,1,1),Ld("R8SN",1,1,2),Ld("R8UI",1,1,3),Ld("R8I",1,1,4),Ld("R16F",2,1,6),Ld("R16UI",2,1,3),Ld("R16I",2,1,4),Ld("R32F",4,1,6),Ld("R32UI",4,1,3),Ld("R32I",4,1,4),Ld("RG8",2,2,1),Ld("RG8SN",2,2,2),Ld("RG8UI",2,2,3),Ld("RG8I",2,2,4),Ld("RG16F",4,2,6),Ld("RG16UI",4,2,3),Ld("RG16I",4,2,4),Ld("RG32F",8,2,6),Ld("RG32UI",8,2,3),Ld("RG32I",8,2,4),Ld("RGB8",3,3,1),Ld("SRGB8",3,3,1),Ld("RGB8SN",3,3,2),Ld("RGB8UI",3,3,3),Ld("RGB8I",3,3,4),Ld("RGB16F",6,3,6),Ld("RGB16UI",6,3,3),Ld("RGB16I",6,3,4),Ld("RGB32F",12,3,6),Ld("RGB32UI",12,3,3),Ld("RGB32I",12,3,4),Ld("RGBA8",4,4,1,!0),Ld("BGRA8",4,4,1,!0),Ld("SRGB8_A8",4,4,1,!0),Ld("RGBA8SN",4,4,2,!0),Ld("RGBA8UI",4,4,3,!0),Ld("RGBA8I",4,4,4,!0),Ld("RGBA16F",8,4,6,!0),Ld("RGBA16UI",8,4,3,!0),Ld("RGBA16I",8,4,4,!0),Ld("RGBA32F",16,4,6,!0),Ld("RGBA32UI",16,4,3,!0),Ld("RGBA32I",16,4,4,!0),Ld("R5G6B5",2,3,1),Ld("R11G11B10F",4,3,6),Ld("RGB5A1",2,4,1,!0),Ld("RGBA4",2,4,1,!0),Ld("RGB10A2",2,4,1,!0),Ld("RGB10A2UI",2,4,3,!0),Ld("RGB9E5",2,4,6,!0),Ld("DEPTH",4,1,6,!1,!0),Ld("DEPTH_STENCIL",5,2,6,!1,!0,!0),Ld("BC1",1,3,1,!1,!1,!1,!0),Ld("BC1_ALPHA",1,4,1,!0,!1,!1,!0),Ld("BC1_SRGB",1,3,1,!1,!1,!1,!0),Ld("BC1_SRGB_ALPHA",1,4,1,!0,!1,!1,!0),Ld("BC2",1,4,1,!0,!1,!1,!0),Ld("BC2_SRGB",1,4,1,!0,!1,!1,!0),Ld("BC3",1,4,1,!0,!1,!1,!0),Ld("BC3_SRGB",1,4,1,!0,!1,!1,!0),Ld("BC4",1,1,1,!1,!1,!1,!0),Ld("BC4_SNORM",1,1,2,!1,!1,!1,!0),Ld("BC5",1,2,1,!1,!1,!1,!0),Ld("BC5_SNORM",1,2,2,!1,!1,!1,!0),Ld("BC6H_UF16",1,3,5,!1,!1,!1,!0),Ld("BC6H_SF16",1,3,6,!1,!1,!1,!0),Ld("BC7",1,4,1,!0,!1,!1,!0),Ld("BC7_SRGB",1,4,1,!0,!1,!1,!0),Ld("ETC_RGB8",1,3,1,!1,!1,!1,!0),Ld("ETC2_RGB8",1,3,1,!1,!1,!1,!0),Ld("ETC2_SRGB8",1,3,1,!1,!1,!1,!0),Ld("ETC2_RGB8_A1",1,4,1,!0,!1,!1,!0),Ld("ETC2_SRGB8_A1",1,4,1,!0,!1,!1,!0),Ld("ETC2_RGBA8",2,4,1,!0,!1,!1,!0),Ld("ETC2_SRGB8_A8",2,4,1,!0,!1,!1,!0),Ld("EAC_R11",1,1,1,!1,!1,!1,!0),Ld("EAC_R11SN",1,1,2,!1,!1,!1,!0),Ld("EAC_RG11",2,2,1,!1,!1,!1,!0),Ld("EAC_RG11SN",2,2,2,!1,!1,!1,!0),Ld("PVRTC_RGB2",2,3,1,!1,!1,!1,!0),Ld("PVRTC_RGBA2",2,4,1,!0,!1,!1,!0),Ld("PVRTC_RGB4",2,3,1,!1,!1,!1,!0),Ld("PVRTC_RGBA4",2,4,1,!0,!1,!1,!0),Ld("PVRTC2_2BPP",2,4,1,!0,!1,!1,!0),Ld("PVRTC2_4BPP",2,4,1,!0,!1,!1,!0),Bd("4x4"),Bd("5x4"),Bd("5x5"),Bd("6x5"),Bd("6x6"),Bd("8x5"),Bd("8x6"),Bd("8x8"),Bd("10x5"),Bd("10x6"),Bd("10x8"),Bd("10x10"),Bd("12x10"),Bd("12x12"),Dd("4x4"),Dd("5x4"),Dd("5x5"),Dd("6x5"),Dd("6x6"),Dd("8x5"),Dd("8x6"),Dd("8x8"),Dd("10x5"),Dd("10x6"),Dd("10x8"),Dd("10x10"),Dd("12x10"),Dd("12x12")]),Ud=15,xd=496;function Gd(t){return t>0&&!(t&t-1)}var jd=Math.ceil;function Hd(t,i,n,r){if(!Fd[t].isCompressed)return i*n*r*Fd[t].size;switch(t){case 56:case 57:case 58:case 59:case 72:case 73:case 74:case 75:case 79:case 80:case 85:case 86:case 88:return jd(i/4)*jd(n/4)*8*r;case 60:case 61:case 62:case 63:case 64:case 65:case 69:case 68:case 70:case 71:case 77:case 76:case 81:case 82:case 89:case 103:return jd(i/4)*jd(n/4)*16*r;case 66:case 67:return jd(i/4)*jd(n/4)*32*r;case 83:case 84:case 87:return jd(i/8)*jd(n/4)*8*r;case 90:case 104:return jd(i/5)*jd(n/4)*16*r;case 91:case 105:return jd(i/5)*jd(n/5)*16*r;case 92:case 106:return jd(i/6)*jd(n/5)*16*r;case 93:case 107:return jd(i/6)*jd(n/6)*16*r;case 94:case 108:return jd(i/8)*jd(n/5)*16*r;case 95:case 109:return jd(i/8)*jd(n/6)*16*r;case 96:case 110:return jd(i/8)*jd(n/8)*16*r;case 97:case 111:return jd(i/10)*jd(n/5)*16*r;case 98:case 112:return jd(i/10)*jd(n/6)*16*r;case 99:case 113:return jd(i/10)*jd(n/8)*16*r;case 100:case 114:return jd(i/10)*jd(n/10)*16*r;case 101:case 115:return jd(i/12)*jd(n/10)*16*r;case 102:case 116:return jd(i/12)*jd(n/12)*16*r;default:return 0}}function Vd(t,i,n,r,s){for(var e=0,h=0;h<s;++h)e+=Hd(t,i,n,r),i=Math.max(i>>1,1),n=Math.max(n>>1,1);return e}var $d=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function zd(t){return $d[t]||0}function Wd(t){if(t.isCompressed)return Uint8Array;var i=t.size/t.count;switch(t.type){case 1:case 3:switch(i){case 1:default:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}case 2:case 4:switch(i){case 1:default:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}case 6:return 2===i?Uint16Array:Float32Array}return Float32Array}function Xd(t){switch(t){case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 65:case 69:case 68:case 70:case 71:case 66:case 67:case 72:case 73:case 74:case 75:case 79:case 80:case 77:case 76:case 81:case 82:case 85:case 86:case 88:case 89:case 103:return{width:4,height:4};case 83:case 84:case 87:return{width:8,height:4};case 90:case 104:return{width:5,height:4};case 91:case 105:return{width:5,height:5};case 92:case 106:return{width:6,height:5};case 93:case 107:return{width:6,height:6};case 94:case 108:return{width:8,height:5};case 95:case 109:return{width:8,height:6};case 96:case 110:return{width:8,height:8};case 97:case 111:return{width:10,height:5};case 98:case 112:return{width:10,height:6};case 99:case 113:return{width:10,height:8};case 100:case 114:return{width:10,height:10};case 101:case 115:return{width:12,height:10};case 102:case 116:return{width:12,height:12};default:return{width:1,height:1}}}function Yd(t,i){return jd(t/i)*i}var Kd=Object.freeze({__proto__:null,API:Fv,AccessFlagBit:fl,Address:nl,Attribute:ud,AttributeName:Pd,BarrierType:Tl,BindingMappingInfo:jl,BlendFactor:el,BlendOp:hl,BufferBarrierInfo:_d,BufferFlagBit:zv,BufferInfo:$l,BufferTextureCopy:Fl,BufferUsageBit:$v,BufferViewInfo:zl,ClearFlagBit:El,Color:xl,ColorAttachment:ad,ColorMask:ul,CommandBufferInfo:Td,CommandBufferType:Al,ComparisonFunc:rl,CullMode:pl,DESCRIPTOR_BUFFER_TYPE:Ud,DESCRIPTOR_DYNAMIC_TYPE:10,DESCRIPTOR_SAMPLER_TYPE:xd,DESCRIPTOR_STORAGE_BUFFER_TYPE:12,DRAW_INFO_SIZE:28,DepthStencilAttachment:fd,DescriptorSetInfo:kd,DescriptorSetLayoutBinding:md,DescriptorSetLayoutInfo:bd,DescriptorType:ml,DeviceCaps:Il,DeviceInfo:Vl,DeviceOptions:Rl,DispatchInfo:Xl,DrawInfo:Wl,DynamicStateFlagBit:_l,DynamicStates:Cd,DynamicStencilStates:Md,Extent:Nl,Feature:xv,Filter:il,Format:Gv,FormatFeatureBit:Jv,FormatInfo:Id,FormatInfos:Fd,FormatSize:Hd,FormatSurfaceSize:Vd,FormatType:jv,FramebufferInfo:yd,GFXObject:Nd,GeneralBarrierInfo:gd,GetTypeSize:zd,IndirectBuffer:Yl,InputAssemblerInfo:cd,InputState:Ed,IsPowerOf2:Gd,LoadOp:cl,MarkerInfo:Gl,MemoryAccessBit:Wv,MemoryStatus:Rd,MemoryUsageBit:Xv,ObjectType:Dv,Offset:Ml,PassType:Ol,PipelineBindPoint:ll,PipelineLayoutInfo:Ad,PolygonMode:wl,PrimitiveMode:dl,QueryPoolInfo:Sd,QueryType:kl,QueueInfo:Od,QueueType:bl,Rect:Cl,RenderPassInfo:dd,ResolveMode:vl,ResourceRange:wd,SampleCount:Zv,SampleType:Hv,SamplerInfo:Ql,ShadeModel:gl,ShaderInfo:od,ShaderStage:hd,ShaderStageFlagBit:ol,Size:Sl,Status:Bv,StencilFace:yl,StencilOp:sl,StoreOp:al,SubpassDependency:ld,SubpassInfo:vd,SurfaceTransform:Uv,SwapchainInfo:Hl,TextureBarrierInfo:pd,TextureBlit:Bl,TextureCopy:Dl,TextureFlagBit:Qv,TextureInfo:Kl,TextureSubresLayers:Pl,TextureSubresRange:Ll,TextureType:Yv,TextureUsageBit:qv,TextureViewInfo:ql,Type:Vv,Uniform:Jl,UniformBlock:Zl,UniformInputAttachment:ed,UniformSampler:id,UniformSamplerTexture:td,UniformStorageBuffer:sd,UniformStorageImage:rd,UniformTexture:nd,ViewDimension:Kv,Viewport:Ul,VsyncMode:tl,alignTo:Yd,formatAlignment:Xd,getTypedArrayConstructor:Wd}),qd=function(t){function i(){var i;return(i=t.call(this,2)||this).vn=0,i.ln=0,i.dn=0,i.wn=1,i.nt=0,i.Xt=0,i.gn=!1,i}return e(i,t),r(i,[{key:"usage",get:function(){return this.vn}},{key:"memUsage",get:function(){return this.ln}},{key:"size",get:function(){return this.dn}},{key:"stride",get:function(){return this.wn}},{key:"count",get:function(){return this.nt}},{key:"flags",get:function(){return this.Xt}}]),i}(Nd),Qd=function(t){function i(){var i;return(i=t.call(this,13)||this).pn=null,i.C=0,i._n=0,i.yn=0,i.mn=0,i}return e(i,t),r(i,[{key:"type",get:function(){return this.C}},{key:"queue",get:function(){return this.pn}},{key:"numDrawCalls",get:function(){return this._n}},{key:"numInstances",get:function(){return this.yn}},{key:"numTris",get:function(){return this.mn}}]),i}(Nd),Jd=function(){function t(){this.kn=0,this.An="",this.En="",this.Tn=new Array(10),this.On=new Array(117),this.pn=null,this.Sn=null,this._n=0,this.yn=0,this.mn=0,this.In=new Rd,this.Rn=new Il,this.Mn=new jl,this.Cn=new Map,this.Nn=new Map,this.Pn=new Map,this.Ln=new Map,this.Dn=35}var i=t.prototype;return i.hasFeature=function(t){return this.Tn[t]},i.getFormatFeatures=function(t){return this.On[t]},i.enableAutoBarrier=function(){},i.getMaxSampleCount=function(){return 1},r(t,[{key:"gfxAPI",get:function(){return this.kn}},{key:"queue",get:function(){return this.pn}},{key:"commandBuffer",get:function(){return this.Sn}},{key:"swapchainFormat",get:function(){return this.Dn}},{key:"renderer",get:function(){return this.An}},{key:"vendor",get:function(){return this.En}},{key:"numDrawCalls",get:function(){return this._n}},{key:"numInstances",get:function(){return this.yn}},{key:"numTris",get:function(){return this.mn}},{key:"memoryStatus",get:function(){return this.In}},{key:"capabilities",get:function(){return this.Rn}},{key:"bindingMappingInfo",get:function(){return this.Mn}}]),t}();Jd.Bn=void 0;var Zd=function(){function t(t){this.Fn=null,this.Un=null,this.xn=null,this.Gn=null;var i=t.capabilities,n=new Uint8Array(64);if(n.fill(255),i.maxTextureSize>=2){this.Fn=t.createTexture(new Kl(1,12,35,2,2,0));var r=new Fl(0,0,0,new Ml(0,0,0),new Nl(2,2,1));t.copyBuffersToTexture([n],this.Fn,[r])}if(i.maxTextureSize>=2){this.xn=t.createTexture(new Kl(3,12,35,2,2,0,6));var s=new Fl(0,0,0,new Ml(0,0,0),new Nl(2,2,1));t.copyBuffersToTexture([n],this.xn,[s]),s.texSubres.baseArrayLayer=1,t.copyBuffersToTexture([n],this.xn,[s]),s.texSubres.baseArrayLayer=2,t.copyBuffersToTexture([n],this.xn,[s]),s.texSubres.baseArrayLayer=3,t.copyBuffersToTexture([n],this.xn,[s]),s.texSubres.baseArrayLayer=4,t.copyBuffersToTexture([n],this.xn,[s]),s.texSubres.baseArrayLayer=5,t.copyBuffersToTexture([n],this.xn,[s])}if(i.max3DTextureSize>=2){this.Un=t.createTexture(new Kl(2,12,35,2,2,0,1,1,1,2));var e=new Fl(0,0,0,new Ml(0,0,0),new Nl(2,2,2),new Pl(0,0,1));t.copyBuffersToTexture([n],this.Un,[e])}if(i.maxArrayTextureLayers>=2){this.Gn=t.createTexture(new Kl(5,12,35,2,2,0,2));var h=new Fl(0,0,0,new Ml(0,0,0),new Nl(2,2,1),new Pl(0,0,1));t.copyBuffersToTexture([n],this.Gn,[h]),h.texSubres.baseArrayLayer=1,t.copyBuffersToTexture([n],this.Gn,[h])}}return t.prototype.jn=function(t){switch(t){case 1:return this.Fn;case 2:return this.Un;case 3:return this.xn;case 5:return this.Gn;default:return null}},t}(),tw=function(t){function i(){var i;return(i=t.call(this,1)||this).Hn=0,i.Vn=null,i.$n=null,i}return e(i,t),r(i,[{key:"colorTexture",get:function(){return this.Vn}},{key:"depthStencilTexture",get:function(){return this.$n}},{key:"surfaceTransform",get:function(){return this.Hn}},{key:"width",get:function(){return this.Vn.width}},{key:"height",get:function(){return this.Vn.height}}]),i}(Nd),iw=function(t){function i(){var i;return(i=t.call(this,5)||this).zn=null,i.Wn=[],i.$n=null,i.Xn=0,i.Yn=0,i}return e(i,t),r(i,[{key:"renderPass",get:function(){return this.zn}},{key:"colorTextures",get:function(){return this.Wn}},{key:"depthStencilTexture",get:function(){return this.$n}},{key:"width",get:function(){var t,i;return this.colorTextures.length>0?null!==(t=null==(i=this.colorTextures[0])?void 0:i.width)&&void 0!==t?t:this.Xn:this.depthStencilTexture?this.depthStencilTexture.width:this.Xn}},{key:"height",get:function(){var t,i;return this.colorTextures.length>0?null!==(t=null==(i=this.colorTextures[0])?void 0:i.height)&&void 0!==t?t:this.Yn:this.depthStencilTexture?this.depthStencilTexture.height:this.Yn}},{key:"needRebuild",get:function(){return!1}}]),i}(Nd),nw=function(t){function i(){var i;return(i=t.call(this,12)||this).Kn=[],i.qn=0,i.Qn=[],i.Jn=null,i.Zn=null,i.tr=new Wl,i}e(i,t);var n=i.prototype;return n.getVertexBuffer=function(t){return void 0===t&&(t=0),t<this.Qn.length?this.Qn[t]:null},n.computeAttributesHash=function(){for(var t="attrs",i=0;i<this.attributes.length;++i){var n=this.attributes[i];t+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced+","+n.location}return Sv(t,666)},r(i,[{key:"attributes",get:function(){return this.Kn}},{key:"vertexBuffers",get:function(){return this.Qn}},{key:"indexBuffer",get:function(){return this.Jn}},{key:"indirectBuffer",get:function(){return this.Zn}},{key:"attributesHash",get:function(){return this.qn}},{key:"vertexCount",get:function(){return this.tr.vertexCount},set:function(t){this.tr.vertexCount=t}},{key:"firstVertex",get:function(){return this.tr.firstVertex},set:function(t){this.tr.firstVertex=t}},{key:"indexCount",get:function(){return this.tr.indexCount},set:function(t){this.tr.indexCount=t}},{key:"firstIndex",get:function(){return this.tr.firstIndex},set:function(t){this.tr.firstIndex=t}},{key:"vertexOffset",get:function(){return this.tr.vertexOffset},set:function(t){this.tr.vertexOffset=t}},{key:"instanceCount",get:function(){return this.tr.instanceCount},set:function(t){this.tr.instanceCount=t}},{key:"firstInstance",get:function(){return this.tr.firstInstance},set:function(t){this.tr.firstInstance=t}},{key:"drawInfo",get:function(){return this.tr},set:function(t){this.tr=t}}]),i}(Nd),rw=function(t){function i(){var i;return(i=t.call(this,11)||this).ir=null,i.nr=[],i.rr=[],i.Cn=[],i.sr=!1,i}e(i,t);var n=i.prototype;return n.bindBuffer=function(t,i,n){void 0===n&&(n=0);var r=this.ir.bindingIndices[t],s=this.ir.bindings[r];if(s&&s.descriptorType&Ud){var e=this.ir.descriptorIndices[t];this.nr[e+n]!==i&&(this.nr[e+n]=i,this.sr=!0)}},n.bindSampler=function(t,i,n){void 0===n&&(n=0);var r=this.ir.bindingIndices[t],s=this.ir.bindings[r];if(s&&s.descriptorType&xd){var e=this.ir.descriptorIndices[t];this.Cn[e+n]!==i&&(this.Cn[e+n]=i,this.sr=!0)}},n.bindTexture=function(t,i,n){void 0===n&&(n=0);var r=this.ir.bindingIndices[t],s=this.ir.bindings[r];if(s&&s.descriptorType&xd){var e=this.ir.descriptorIndices[t];this.rr[e+n]!==i&&(this.rr[e+n]=i,this.sr=!0)}},n.getBuffer=function(t,i){void 0===i&&(i=0);var n=this.ir.descriptorIndices[t];return this.nr[n+i]},n.getSampler=function(t,i){void 0===i&&(i=0);var n=this.ir.descriptorIndices[t];return this.Cn[n+i]},n.getTexture=function(t,i){void 0===i&&(i=0);var n=this.ir.descriptorIndices[t];return this.rr[n+i]},r(i,[{key:"layout",get:function(){return this.ir}}]),i}(Nd),sw=function(t){function i(){var i;return(i=t.call(this,8)||this).hr=[],i.ur=[],i.cr=[],i}return e(i,t),r(i,[{key:"bindings",get:function(){return this.hr}},{key:"bindingIndices",get:function(){return this.ur}},{key:"descriptorIndices",get:function(){return this.cr}}]),i}(Nd),ew=function(t){function i(){var i;return(i=t.call(this,9)||this).vr=[],i}return e(i,t),r(i,[{key:"setLayouts",get:function(){return this.vr}}]),i}(Nd),hw=function(){function t(t,i,n,r,s,e,h,u,o,c,a,f){void 0===t&&(t=!1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=2),void 0===s&&(s=!0),void 0===e&&(e=!1),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=!0),void 0===a&&(a=!1),void 0===f&&(f=1),this.isDiscard=t,this.polygonMode=i,this.shadeModel=n,this.cullMode=r,this.isFrontFaceCCW=s,this.depthBiasEnabled=e,this.depthBias=h,this.depthBiasClamp=u,this.depthBiasSlop=o,this.isDepthClip=c,this.isMultisample=a,this.lineWidth=f}var i=t.prototype;return i.reset=function(){this.isDiscard=!1,this.polygonMode=0,this.shadeModel=0,this.cullMode=2,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},i.assign=function(t){Object.assign(this,t)},i.destroy=function(){},r(t,[{key:"native",get:function(){return this}}]),t}(),uw=function(){function t(t,i,n,r,s,e,h,u,o,c,a,f,v,l,d,w,g,p,_){void 0===t&&(t=!0),void 0===i&&(i=!0),void 0===n&&(n=1),void 0===r&&(r=!1),void 0===s&&(s=7),void 0===e&&(e=65535),void 0===h&&(h=65535),void 0===u&&(u=1),void 0===o&&(o=1),void 0===c&&(c=1),void 0===a&&(a=1),void 0===f&&(f=!1),void 0===v&&(v=7),void 0===l&&(l=65535),void 0===d&&(d=65535),void 0===w&&(w=1),void 0===g&&(g=1),void 0===p&&(p=1),void 0===_&&(_=1),this.depthTest=t,this.depthWrite=i,this.depthFunc=n,this.stencilTestFront=r,this.stencilFuncFront=s,this.stencilReadMaskFront=e,this.stencilWriteMaskFront=h,this.stencilFailOpFront=u,this.stencilZFailOpFront=o,this.stencilPassOpFront=c,this.stencilRefFront=a,this.stencilTestBack=f,this.stencilFuncBack=v,this.stencilReadMaskBack=l,this.stencilWriteMaskBack=d,this.stencilFailOpBack=w,this.stencilZFailOpBack=g,this.stencilPassOpBack=p,this.stencilRefBack=_}var i=t.prototype;return i.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=1,this.stencilTestFront=!1,this.stencilFuncFront=7,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=1,this.stencilZFailOpFront=1,this.stencilPassOpFront=1,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=7,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=1,this.stencilZFailOpBack=1,this.stencilPassOpBack=1,this.stencilRefBack=1},i.assign=function(t){Object.assign(this,t)},i.destroy=function(){},r(t,[{key:"native",get:function(){return this}}]),t}(),ow=function(){function t(t,i,n,r,s,e,h,u){void 0===t&&(t=!1),void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=15),this.blend=t,this.blendSrc=i,this.blendDst=n,this.blendEq=r,this.blendSrcAlpha=s,this.blendDstAlpha=e,this.blendAlphaEq=h,this.blendColorMask=u}var i=t.prototype;return i.reset=function(){this.blend=!1,this.blendSrc=1,this.blendDst=0,this.blendEq=0,this.blendSrcAlpha=1,this.blendDstAlpha=0,this.blendAlphaEq=0,this.blendColorMask=15},i.assign=function(t){Object.assign(this,t)},i.destroy=function(){},t}(),cw=function(){function t(t,i,n,r){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===n&&(n=new xl),void 0===r&&(r=[new ow]),this.isA2C=t,this.isIndepend=i,this.blendColor=n,this.targets=r}var i=t.prototype;return i.setTarget=function(t,i){var n=this.targets[t];n||(n=this.targets[t]=new ow),Object.assign(n,i)},i.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},i.destroy=function(){},r(t,[{key:"native",get:function(){return this}}]),t}(),aw=function(t,i,n,r,s,e,h,u,o,c){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=new Ed),void 0===s&&(s=new hw),void 0===e&&(e=new uw),void 0===h&&(h=new cw),void 0===u&&(u=7),void 0===o&&(o=0),void 0===c&&(c=0),this.shader=t,this.pipelineLayout=i,this.renderPass=n,this.inputState=r,this.rasterizerState=s,this.depthStencilState=e,this.blendState=h,this.primitive=u,this.dynamicStates=o,this.bindPoint=c},fw=function(t){function i(){var i;return(i=t.call(this,10)||this).lr=null,i.dr=null,i.wr=7,i.gr=null,i.pr=new hw,i._r=new uw,i.yr=new cw,i.mr=0,i.zn=null,i}return e(i,t),r(i,[{key:"shader",get:function(){return this.lr}},{key:"pipelineLayout",get:function(){return this.dr}},{key:"primitive",get:function(){return this.wr}},{key:"rasterizerState",get:function(){return this.pr}},{key:"depthStencilState",get:function(){return this._r}},{key:"blendState",get:function(){return this.yr}},{key:"inputState",get:function(){return this.gr}},{key:"dynamicStates",get:function(){return this.mr}},{key:"renderPass",get:function(){return this.zn}}]),i}(Nd),vw=function(t){function i(){var i;return(i=t.call(this,14)||this).C=0,i}return e(i,t),r(i,[{key:"type",get:function(){return this.C}}]),i}(Nd),lw=function(t){function i(){var i;return(i=t.call(this,4)||this).kr=[],i.Ar=null,i.Er=[],i.Tr=0,i}return e(i,t),i.prototype.computeHash=function(){var t="";if(this.Er.length)for(var i=0;i<this.Er.length;++i){var n=this.Er[i];if(n.inputs.length){t+="ia";for(var r=0;r<n.inputs.length;++r){var s=this.kr[n.inputs[r]];t+=","+s.format+","+s.sampleCount}}if(n.colors.length){t+="ca";for(var e=0;e<n.colors.length;++e){var h=this.kr[n.colors[e]];t+=","+h.format+","+h.sampleCount}}if(n.depthStencil>=0){var u=this.kr[n.depthStencil];t+="ds,"+u.format+","+u.sampleCount}}else{t+="ca";for(var o=0;o<this.kr.length;++o){var c=this.kr[o];t+=","+c.format+","+c.sampleCount}var a=this.Ar;a&&(t+="ds,"+a.format+","+a.sampleCount)}return Sv(t,666)},r(i,[{key:"colorAttachments",get:function(){return this.kr}},{key:"depthStencilAttachment",get:function(){return this.Ar}},{key:"subPasses",get:function(){return this.Er}},{key:"hash",get:function(){return this.Tr}}]),i}(Nd),dw=function(t){function i(i,n){var r;return(r=t.call(this,6)||this).Or=new Ql,r.Tr=0,r.Or.copy(i),r.Tr=n,r}return e(i,t),i.computeHash=function(t){var i=t.minFilter;return i|=t.magFilter<<2,i|=t.mipFilter<<4,i|=t.addressU<<6,i|=t.addressV<<8,i|=t.addressW<<10,(i|=Math.min(t.maxAnisotropy,16)<<12)|t.cmpFunc<<17},i.unpackFromHash=function(t){var i=new Ql;return i.minFilter=3&t,i.magFilter=t>>2&3,i.mipFilter=t>>4&3,i.addressU=t>>6&3,i.addressV=t>>8&3,i.addressW=t>>10&3,i.maxAnisotropy=t>>12&31,i.cmpFunc=t>>17&7,i},r(i,[{key:"info",get:function(){return this.Or}},{key:"hash",get:function(){return this.Tr}}]),i}(Nd),ww=function(t){function i(){var i;return(i=t.call(this,7)||this).Sr="",i.Ir=[],i.Kn=[],i.Rr=[],i.Cn=[],i}return e(i,t),r(i,[{key:"name",get:function(){return this.Sr}},{key:"attributes",get:function(){return this.Kn}},{key:"blocks",get:function(){return this.Rr}},{key:"samplers",get:function(){return this.Cn}},{key:"stages",get:function(){return this.Ir}}]),i}(Nd),gw=function(t){function i(){var i;return(i=t.call(this,3)||this).Or=new Kl,i.Mr=new ql,i.Cr=!1,i.Nr=!1,i.dn=0,i}return e(i,t),i.getLevelCount=function(t,i){return Math.floor(Math.log2(Math.max(t,i)))},r(i,[{key:"type",get:function(){return this.Or.type}},{key:"usage",get:function(){return this.Or.usage}},{key:"format",get:function(){return this.Or.format}},{key:"width",get:function(){return this.Or.width}},{key:"height",get:function(){return this.Or.height}},{key:"depth",get:function(){return this.Or.depth}},{key:"layerCount",get:function(){return this.Or.layerCount}},{key:"levelCount",get:function(){return this.Or.levelCount}},{key:"samples",get:function(){return this.Or.samples}},{key:"flags",get:function(){return this.Or.flags}},{key:"size",get:function(){return this.dn}},{key:"info",get:function(){return this.Or}},{key:"viewInfo",get:function(){return this.Mr}},{key:"isTextureView",get:function(){return this.Nr}}]),i}(Nd),pw=function(t){function i(i,n){var r;return(r=t.call(this,16)||this).Or=new gd,r.Tr=0,r.Or.copy(i),r.Tr=n,r}return e(i,t),i.computeHash=function(t){return Sv(t.prevAccesses+" "+t.nextAccesses+" "+t.type,666)},r(i,[{key:"info",get:function(){return this.Or}},{key:"hash",get:function(){return this.Tr}}]),i}(Nd),_w=function(t){function i(i,n){var r;return(r=t.call(this,17)||this).Or=new pd,r.Tr=0,r.Or.copy(i),r.Tr=n,r}return e(i,t),i.computeHash=function(t){var i=t.prevAccesses+" "+t.nextAccesses;return i+=t.type,i+=t.range.mipLevel,i+=t.range.levelCount,i+=t.range.firstSlice,i+=t.range.numSlices,i+=t.range.basePlane,i+=t.range.planeCount,i+=t.discardContents,i+=t.srcQueue?t.srcQueue.type:0,Sv(i+=t.dstQueue?t.dstQueue.type:0,666)},r(i,[{key:"info",get:function(){return this.Or}},{key:"hash",get:function(){return this.Tr}}]),i}(Nd),yw=function(t){function i(i,n){var r;return(r=t.call(this,18)||this).Or=new _d,r.Tr=0,r.Or.copy(i),r.Tr=n,r}return e(i,t),i.computeHash=function(t){var i=t.prevAccesses+" "+t.nextAccesses;return i+=t.type,i+=t.offset,i+=t.size,i+=t.discardContents,i+=t.srcQueue?t.srcQueue.type:0,Sv(i+=t.dstQueue?t.dstQueue.type:0,666)},r(i,[{key:"info",get:function(){return this.Or}},{key:"hash",get:function(){return this.Tr}}]),i}(Nd),mw={Device:Jd,Swapchain:tw,Buffer:qd,Texture:gw,Sampler:dw,Shader:ww,InputAssembler:nw,RenderPass:lw,Framebuffer:iw,DescriptorSet:rw,DescriptorSetLayout:sw,PipelineLayout:ew,PipelineState:fw,CommandBuffer:Qd,Queue:vw,GeneralBarrier:pw,TextureBarrier:_w,BufferBarrier:yw,RasterizerState:hw,BlendState:cw,BlendTarget:ow,DepthStencilState:uw,PipelineStateInfo:aw};Object.assign(mw,Kd),T.gfx=mw;var bw=function(){function t(){this.Pr=!1,this.Lr=void 0,this.Dr=null,this.Br=void 0,this.Fr=-1,this.Ur=!1}var i=t.prototype;return i.Gr=function(t,i){var n=this;return this.Ur?Promise.resolve(!0):t?(this.Lr=new t,new Promise((function(t,r){n.Lr.initialize(i).then((function(i){n.Ur=i,t(i)})).catch((function(t){r(t)}))}))):Promise.resolve(!1)},i.jr=function(t,i){return!!this.Ur||(t&&(this.Lr=new t,this.Ur=this.Lr.initialize(i)),this.Ur)},i.init=function(t,i){var n=this;if(this.Pr)return!0;var r=Oi.querySettings(Ei.Category.RENDERING,"renderMode");this.Dr=t,this.Dr&&(this.Dr.oncontextmenu=function(){return!1}),this.Fr=this.Hr(r),this.Ur=!1;var s=new Vl(i);if(1===this.Fr||2===this.Fr){var e=!!globalThis.WebGL2RenderingContext;if(globalThis.navigator.userAgent.toLowerCase(),bh.browserType===hh.UC&&(e=!1),Jd.Bn=t,2===this.Fr&&T.WebGPUDevice)return new Promise((function(t,i){n.Gr(T.WebGPUDevice,s).then((function(i){n.Vr(),t(i)})).catch((function(t){i(t)}))}));e&&T.WebGL2Device&&this.jr(T.WebGL2Device,s),T.WebGLDevice&&this.jr(T.WebGLDevice,s),T.EmptyDevice&&this.jr(T.EmptyDevice,s),this.Vr()}else 4===this.Fr&&T.EmptyDevice&&(this.jr(T.EmptyDevice,s),this.Vr());return!!this.Lr||(ht(16337),this.Fr=-1,!1)},i.Vr=function(){var t=new Hl(1,this.Dr),i=mh.windowSize;t.width=i.width,t.height=i.height,this.Br=this.Lr.createSwapchain(t)},i.$r=function(){return"gpu"in globalThis.navigator},i.Hr=function(t){("number"!=typeof t||t>4||t<0)&&(t=0);var i=0,n=!1;if(1===t?(i=0,n=!0):0===t||4===t?(i=this.$r()?2:1,n=!0):2===t?(i=1,n=!0):3===t&&(i=4,n=!0),!n)throw new Error(at(3820,t));return i},r(t,[{key:"gfxDevice",get:function(){return this.Lr}},{key:"swapchain",get:function(){return this.Br}}]),t}(),kw=new bw;t("af",Object.freeze({__proto__:null,API:Fv,AccessFlagBit:fl,Address:nl,Attribute:ud,AttributeName:Pd,BarrierType:Tl,BindingMappingInfo:jl,BlendFactor:el,BlendOp:hl,BlendState:cw,BlendTarget:ow,Buffer:qd,BufferBarrierInfo:_d,BufferFlagBit:zv,BufferInfo:$l,BufferTextureCopy:Fl,BufferUsageBit:$v,BufferViewInfo:zl,ClearFlagBit:El,Color:xl,ColorAttachment:ad,ColorMask:ul,CommandBuffer:Qd,CommandBufferInfo:Td,CommandBufferType:Al,ComparisonFunc:rl,CullMode:pl,DESCRIPTOR_BUFFER_TYPE:Ud,DESCRIPTOR_DYNAMIC_TYPE:10,DESCRIPTOR_SAMPLER_TYPE:xd,DESCRIPTOR_STORAGE_BUFFER_TYPE:12,DRAW_INFO_SIZE:28,DefaultResource:Zd,DepthStencilAttachment:fd,DepthStencilState:uw,DescriptorSet:rw,DescriptorSetInfo:kd,DescriptorSetLayout:sw,DescriptorSetLayoutBinding:md,DescriptorSetLayoutInfo:bd,DescriptorType:ml,Device:Jd,DeviceCaps:Il,DeviceInfo:Vl,DeviceManager:bw,DeviceOptions:Rl,DispatchInfo:Xl,DrawInfo:Wl,DynamicStateFlagBit:_l,DynamicStates:Cd,DynamicStencilStates:Md,Extent:Nl,Feature:xv,Filter:il,Format:Gv,FormatFeatureBit:Jv,FormatInfo:Id,FormatInfos:Fd,FormatSize:Hd,FormatSurfaceSize:Vd,FormatType:jv,Framebuffer:iw,FramebufferInfo:yd,GFXObject:Nd,GeneralBarrier:pw,GeneralBarrierInfo:gd,GetTypeSize:zd,IndirectBuffer:Yl,InputAssembler:nw,InputAssemblerInfo:cd,InputState:Ed,IsPowerOf2:Gd,LegacyRenderMode:{AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGPU:4},LoadOp:cl,MarkerInfo:Gl,MemoryAccessBit:Wv,MemoryStatus:Rd,MemoryUsageBit:Xv,ObjectType:Dv,Offset:Ml,PassType:Ol,PipelineBindPoint:ll,PipelineLayout:ew,PipelineLayoutInfo:Ad,PipelineState:fw,PipelineStateInfo:aw,PolygonMode:wl,PrimitiveMode:dl,QueryPoolInfo:Sd,QueryType:kl,Queue:vw,QueueInfo:Od,QueueType:bl,RasterizerState:hw,Rect:Cl,RenderPass:lw,RenderPassInfo:dd,RenderType:{UNKNOWN:-1,CANVAS:0,WEBGL:1,WEBGPU:2,OPENGL:3,HEADLESS:4},ResolveMode:vl,ResourceRange:wd,SampleCount:Zv,SampleType:Hv,Sampler:dw,SamplerInfo:Ql,ShadeModel:gl,Shader:ww,ShaderInfo:od,ShaderStage:hd,ShaderStageFlagBit:ol,Size:Sl,Status:Bv,StencilFace:yl,StencilOp:sl,StoreOp:al,SubpassDependency:ld,SubpassInfo:vd,SurfaceTransform:Uv,Swapchain:tw,SwapchainInfo:Hl,Texture:gw,TextureBarrier:_w,TextureBarrierInfo:pd,TextureBlit:Bl,TextureCopy:Dl,TextureFlagBit:Qv,TextureInfo:Kl,TextureSubresLayers:Pl,TextureSubresRange:Ll,TextureType:Yv,TextureUsageBit:qv,TextureViewInfo:ql,Type:Vv,Uniform:Jl,UniformBlock:Zl,UniformInputAttachment:ed,UniformSampler:id,UniformSamplerTexture:td,UniformStorageBuffer:sd,UniformStorageImage:rd,UniformTexture:nd,ViewDimension:Kv,Viewport:Ul,VsyncMode:tl,alignTo:Yd,deviceManager:kw,formatAlignment:Xd,getTypedArrayConstructor:Wd}));var Aw=new $s;function Ew(t,i,n,r){if(n){var s=n.chunk,e=n.data,h=s.vb,u=n.vertexCount,o=t.worldMatrix,c=o.m00,a=o.m01,f=o.m02,v=o.m03,l=o.m04,d=o.m05,w=o.m06,g=o.m07,p=o.m12,_=o.m13,y=o.m14,m=o.m15;Aw.set(r.r/255,r.g/255,r.b/255,r.a/255);for(var b=0,k=0;k<u;++k){var A=e[k],E=A.x,T=A.y,O=v*E+g*T+m;O=O?1/O:1,h[b+0]=(c*E+l*T+p)*O,h[b+1]=(a*E+d*T+_)*O,h[b+2]=(f*E+w*T+y)*O,$s.toArray(h,Aw,b+5),b+=n.floatStride}s.bufferId;for(var S=s.vertexOffset,I=s.meshBuffer,R=s.meshBuffer.iData,M=I.indexOffset,C=0,N=u/4;C<N;C++){var P=S+4*C;R[M++]=P,R[M++]=P+1,R[M++]=P+2,R[M++]=P+1,R[M++]=P+3,R[M++]=P+2}I.indexOffset+=n.indexCount,I.setDirty()}}function Tw(t,i){if(t.chunk)for(var n,r,s,e,h=t.vertexFormat,u=t.chunk.vb,o=0,c=0;c<h.length;++c){if(r=h[c],(s=Fd[r.format]).hasAlpha)if(e=t.floatStride,s.size/s.count==1){n||(n=new Uint32Array(u.buffer,u.byteOffset,u.length));for(var a=~~Gn(Math.round(255*i),0,255),f=o;f<n.length;f+=e)n[f]=(16777215&n[f]|a<<24)>>>0}else if(s.size/s.count==4)for(var v=o+3;v<u.length;v+=e)u[v]=i;o+=s.size>>2}}var Ow=function(){function t(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=It(!0),this._count=0)}var i=t.prototype;return i.add=function(t,i){return t in this._map||this._count++,this._map[t]=i},i.get=function(t){return this._map[t]},i.has=function(t){return t in this._map},i.remove=function(t){var i=this._map[t];return t in this._map&&(delete this._map[t],this._count--),i},i.clear=function(){0!==this._count&&(this._map=It(!0),this._count=0)},i.forEach=function(t){for(var i in this._map)t(this._map[i],i)},i.find=function(t){for(var i in this._map)if(t(this._map[i],i))return this._map[i];return null},i.destroy=function(){this._map=null},r(t,[{key:"map",get:function(){return this._map}},{key:"count",get:function(){return this._count}}]),t}(),Sw=function(){function t(i,n){this.id=t.zr++,this.name="",this.pipes=[],this.name=i;for(var r=0,s=n.length;r<s;r++)this.pipes.push(n[r])}var i=t.prototype;return i.insert=function(t,i){return i>this.pipes.length?(st(4921),this):(this.pipes.splice(i,0,t),this)},i.append=function(t){return this.pipes.push(t),this},i.remove=function(t){return this.pipes.splice(t,1),this},i.sync=function(t){var i=this.pipes;if(0===i.length)return null;t.isFinished=!1;for(var n=0,r=i.length;n<r;){var s=(0,i[n])(t);if(s)return t.isFinished=!0,s;++n!==r&&(t.input=t.output,t.output=null)}return t.isFinished=!0,t.output},i.async=function(t){0!==this.pipes.length&&(t.isFinished=!1,this.Wr(0,t))},i.Wr=function(t,i){var n=this;(0,this.pipes[t])(i,(function(r){r?(i.isFinished=!0,i.dispatch("complete",r)):++t<n.pipes.length?(i.input=i.output,i.output=null,n.Wr(t,i)):(i.isFinished=!0,i.dispatch("complete",r,i.output))}))},t}();Sw.zr=0;var Iw=new Ow,Rw=new Ow,Mw=new Ow,Cw=new Ow,Nw=new Sw("normal load",[]),Pw=new Sw("fetch",[]),Lw=new Sw("transform url",[]),Dw=new Map,Bw={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}},Fw=function(){function t(i){this.id=t.Xr++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinished=!0,this.set(i)}t.create=function(i){var n;return 0!==t.Yr.length?(n=t.Yr.pop()).set(i):n=new t(i),n};var i=t.prototype;return i.set=function(t){void 0===t&&(t=Object.create(null)),this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},i.dispatch=function(t,i,n,r,s){switch(t){case"complete":this.onComplete&&this.onComplete(i,n);break;case"progress":this.onProgress&&this.onProgress(i,n,r,s);break;case"error":this.onError&&this.onError(i,n,r,s);break;default:var e="on"+t[0].toUpperCase()+t.substring(1);"function"==typeof this[e]&&this[e](i,n,r,s)}},i.recycle=function(){t.Yr.length!==t.Kr&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t.Yr.push(this))},r(t,[{key:"isFinish",get:function(){return this.isFinished},set:function(t){this.isFinished=t}}]),t}();Fw.Kr=500,Fw.Xr=0,Fw.Yr=[];var Uw="0123456789abcdef".split(""),xw=["","","",""],Gw=xw.concat(xw,"-",xw,"-",xw,"-",xw,"-",xw,xw,xw),jw=Gw.map((function(t,i){return"-"===t?NaN:i})).filter(Number.isFinite);function Hw(t){var i=t.split("@")[0];if(22!==i.length)return t;Gw[0]=t[0],Gw[1]=t[1];for(var n=2,r=2;n<22;n+=2){var s=Pi[t.charCodeAt(n)],e=Pi[t.charCodeAt(n+1)];Gw[jw[r++]]=Uw[s>>2],Gw[jw[r++]]=Uw[(3&s)<<2|e>>4],Gw[jw[r++]]=Uw[15&e]}return t.replace(i,Gw.join(""))}var Vw=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function $w(t,i){(i=i||Object.create(null)).__isNative__=i.isNative,i.nativeExt&&(i.ext=i.nativeExt);var n=Cw.find((function(i){return!!i.getAssetInfo(t)}));return n&&(i.bundle=n.name),Xw(t,i)}function zw(t){return!!t&&(t instanceof T.SceneAsset||t instanceof T.Scene)}function Ww(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function Xw(t,i){var n=Fw.create({input:t,options:i}),r=[];try{for(var s,e=w(Lw.sync(n));!(s=e()).done;){var h=s.value,u=h.url;h.recycle(),r.push(u)}}catch(t){for(var o,c=w(n.output);!(o=c()).done;)o.value.recycle();X(t.message,t.stack)}return n.recycle(),r.length>1?r:r[0]}var Yw,Kw,qw,Qw,Jw,Zw,tg=Object.freeze({__proto__:null,decodeUuid:Hw,getUrlWithUuid:$w,getUuidFromURL:function(t){var i=Vw.exec(t);return i?i[1]:""},isScene:zw,normalize:Ww,transform:Xw}),ig=Co,ng=ko,rg=t("dx",_o("cc.Asset")((Kw=function(t){function i(i){var n;return(n=t.call(this,i)||this).loaded=!0,n._native=qw&&qw(),n._nativeUrl="",n.qr=null,n.Qr=0,Object.defineProperty(v(n),"_uuid",{value:"",writable:!0}),n}e(i,t),i.deserialize=function(t){return T.deserialize(t)};var n=i.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(t,i){void 0===i&&(i=!0),this._native=!1!==i?t||"":"/"+t},n.addRef=function(){return this.Qr++,this},n.decRef=function(t){return void 0===t&&(t=!0),this.Qr>0&&this.Qr--,t&&T.assetManager.getReleaseManager().tryRelease(this),this},n.onLoaded=function(){},n.initDefault=function(t){t&&(this._uuid=t),this.isDefault=!0},n.validate=function(){return!0},n.destroy=function(){return K(at(12101,this._uuid)),t.prototype.destroy.call(this)},r(i,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=$w(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=$w(this._uuid,{__nativeName__:t,nativeExt:Yf(t),isNative:!0})}return this._nativeUrl}},{key:"uuid",get:function(){return this._uuid}},{key:"_nativeAsset",get:function(){return this.qr},set:function(t){this.qr=t}},{key:"nativeAsset",get:function(){return this.qr}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this.Qr}}]),i}(sh(We)),qw=uo(Kw.prototype,"_native",[ig],(function(){return""})),y(Kw.prototype,"_nativeAsset",[ng],Object.getOwnPropertyDescriptor(Kw.prototype,"_nativeAsset"),Kw.prototype),Yw=Kw))||Yw);rg.prototype.createNode=null,T.Asset=rg;var sg=1346981187,eg=_i({PVR:0,PKM:1,ASTC:2});function hg(t,i){return 4===t?89:5===t?4===i?90:91:6===t?5===i?92:93:8===t?5===i?94:6===i?95:96:10===t?5===i?97:6===i?98:8===i?99:100:10===i?101:102}function ug(t,i){return t[i]<<8|t[i+1]}function og(t){return!!(bh.hasFeature(bh.Feature.IMAGE_BITMAP)&&t instanceof ImageBitmap)}var cg,ag,fg,vg,lg,dg,wg,gg,pg,_g,yg,mg=t("dD",_o("cc.ImageAsset")((Zw=function(t){e(n,t),n.mergeCompressedTextureMips=function(t){var i=new Uint8Array(0);try{for(var n,r=8+4*t.length,s=0,e=w(t);!(n=e()).done;)s+=n.value.byteLength;s+=r,i=new Uint8Array(s);var h=new DataView(i.buffer,i.byteOffset,i.byteLength);h.setUint32(0,sg,!0),h.setUint32(4,t.length,!0);for(var u=r,o=0;o<t.length;o++){var c=t[o];if(h.setUint32(8+4*o,c.byteLength,!0),c instanceof ArrayBuffer){var a=new Uint8Array(c);i.set(a,u)}else{var f=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);i.set(f,u)}u+=c.byteLength}}catch(t){W(t)}return i},n.Jr=function(t,i){var r={_data:new Uint8Array(0),_compressed:!0,width:0,height:0,format:0,mipmapLevelDataSize:[]},s=t instanceof ArrayBuffer?t:t.buffer,e=new DataView(s);if(e.getUint32(0,!0)===sg){var h=e.getUint32(4,!0),u=e.getUint32(8,!0),o=8+4*h;n.Zr(t,0,o,u,i,r);for(var c=o+u,a=1;a<h;a++){var f=e.getUint32(8+4*a,!0);n.Zr(t,a,c,f,i,r),c+=f}}else n.Zr(t,0,0,0,i,r);return r},n.Zr=function(t,i,r,s,e,h){switch(e){case eg.PVR:n.ts(t,i,r,s,h);break;case eg.PKM:n.ns(t,i,r,s,h);break;case eg.ASTC:n.rs(t,i,r,s,h)}},n.ts=function(t,i,n,r,s){var e=t instanceof ArrayBuffer?t:t.buffer,h=new Int32Array(e,n,13);if(55727696===h[0]){var u=n+h[12]+52,o=r-h.byteLength;if(r>0){var c=new Uint8Array(e,u,o),a=new Uint8Array(s._data.byteLength+c.byteLength);a.set(s._data),a.set(c,s._data.byteLength),s._data=a,s.mipmapLevelDataSize[i]=o}else s._data=new Uint8Array(e,u);s.width=i>0?s.width:h[7],s.height=i>0?s.height:h[6]}else{if(559044176!==h[11])throw new Error("Invalid magic number in PVR header");var f=n+h[0],v=r-h.byteLength;if(r>0){var l=new Uint8Array(e,f,v),d=new Uint8Array(s._data.byteLength+l.byteLength);d.set(s._data),d.set(l,s._data.byteLength),s._data=d,s.mipmapLevelDataSize[i]=v}else s._data=new Uint8Array(e,f);s.width=i>0?s.width:h[1],s.height=i>0?s.height:h[2]}},n.ns=function(t,i,n,r,s){var e=t instanceof ArrayBuffer?t:t.buffer,h=new Uint8Array(e,n,16),u=ug(h,6);if(0!==u&&1!==u&&3!==u)throw new Error("Invalid magic number in ETC header");var o=n+16,c=r-16;if(r>0){var a=new Uint8Array(e,o,c),f=new Uint8Array(s._data.byteLength+a.byteLength);f.set(s._data),f.set(a,s._data.byteLength),s._data=f,s.mipmapLevelDataSize[i]=c}else s._data=new Uint8Array(e,o);s.width=i>0?s.width:ug(h,12),s.height=i>0?s.height:ug(h,14)},n.rs=function(t,i,n,r,s){var e=t instanceof ArrayBuffer?t:t.buffer,h=new Uint8Array(e,n,16);if(1554098963!==h[0]+(h[1]<<8)+(h[2]<<16)+(h[3]<<24))throw new Error("Invalid magic number in ASTC header");var u=h[4],o=h[5],c=h[6];if((u<3||u>6||o<3||o>6||c<3||c>6)&&(u<4||7===u||9===u||11===u||u>12||o<4||7===o||9===o||11===o||o>12||1!==c))throw new Error("Invalid block number in ASTC header");var a=hg(u,o),f=n+16,v=r-16;if(r>0){var l=new Uint8Array(e,f,v),d=new Uint8Array(s._data.byteLength+l.byteLength);d.set(s._data),d.set(l,s._data.byteLength),s._data=d,s.mipmapLevelDataSize[i]=v}else s._data=new Uint8Array(e,f);s.width=i>0?s.width:h[7]+(h[8]<<8)+(h[9]<<16),s.height=i>0?s.height:h[10]+(h[11]<<8)+(h[12]<<16),s.format=a};var i=n.prototype;function n(i){var n;return(n=t.call(this)||this).ss=void 0,n.es=void 0,n.hs=35,n.Xn=0,n.Yn=0,n.ss={_data:null,width:0,height:0,format:0,_compressed:!1,mipmapLevelDataSize:[]},void 0!==i&&n.reset(i),n}return i.us=function(){if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0){var t=this.mipmapLevelDataSize[0],i=this.data,r=new n({_data:new Uint8Array(i.buffer,0,t),_compressed:!0,width:this.width,height:this.height,format:this.format,mipmapLevelDataSize:[]});return r._uuid=""+this._uuid,r}return this},i.fs=function(){var t=[];if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0)for(var i,r=this.mipmapLevelDataSize,s=this.data,e=0,h=this.height,u=this.width,o=w(r);!(i=o()).done;){var c=i.value,a=new n({_data:new Uint8Array(s.buffer,e,c),_compressed:!0,width:u,height:h,format:this.format,mipmapLevelDataSize:[]});e+=c,a._uuid=""+this._uuid,u=Math.max(u>>1,1),h=Math.max(h>>1,1),t.push(a)}else t.push(this);return t},i.reset=function(t){og(t)||t instanceof HTMLElement?this.ss=t:(this.ss=t,this.hs=t.format)},i.destroy=function(){if(this.data&&this.data instanceof HTMLImageElement)this.data.src="",this._setRawAsset("");else if(og(this.data)){var i;null==(i=this.data)||i.close()}return t.prototype.destroy.call(this)},i._serialize=function(){},i._deserialize=function(t){var i="";"string"==typeof t?i=t:(this.Xn=t.w,this.Yn=t.h,i=t.fmt);for(var r,s=kw.gfxDevice,e=i.split("_"),h=Number.MAX_VALUE,u=this.hs,o="",c=Si.SUPPORT_TEXTURE_FORMATS,a=w(e);!(r=a()).done;){var f=r.value.split("@"),v=parseInt(f[0],void 0),l=n.vs[v]||f[0],d=c.indexOf(l);if(-1!==d&&d<h){var g=f[1]?parseInt(f[1]):this.hs;if(!(".astc"!==l||s&&2&s.getFormatFeatures(89)))continue;if(!(".pvr"!==l||s&&2&s.getFormatFeatures(86)))continue;if(!(72!==g&&1026!==g||s&&2&s.getFormatFeatures(72)))continue;if(!(73!==g&&77!==g||s&&2&s.getFormatFeatures(73)))continue;if(".webp"===l&&!bh.hasFeature(bh.Feature.WEBP))continue;h=d,o=l,u=g}}o?(this._setRawAsset(o),this.hs=u):st(3121)},i.initDefault=function(i){if(t.prototype.initDefault.call(this,i),n.ls)this.reset(n.ls);else{var r=I.document.createElement("canvas"),s=r.getContext("2d"),e=r.width=r.height=2;s.fillStyle="#ff00ff",s.fillRect(0,0,e,e),this.reset(r),n.ls=r}},i.validate=function(){return!!this.data},r(n,[{key:"_nativeAsset",get:function(){return this.ss},set:function(t){t instanceof HTMLElement||og(t)||(t.format=t.format||this.hs),this.reset(t)}},{key:"data",get:function(){return(t=this.ss)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||og(t)?this.ss:this.ss&&this.ss._data;var t}},{key:"width",get:function(){return this.ss.width||this.Xn}},{key:"height",get:function(){return this.ss.height||this.Yn}},{key:"format",get:function(){return this.hs}},{key:"isCompressed",get:function(){return this.hs>=72&&this.hs<=102||this.hs>=1024&&this.hs<=1026}},{key:"mipmapLevelDataSize",get:function(){return this.ss.mipmapLevelDataSize}},{key:"url",get:function(){return this.nativeUrl}}]),n}(rg),Zw.vs=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],Zw.ls=null,y((Jw=Zw).prototype,"_nativeAsset",[ac],Object.getOwnPropertyDescriptor(Jw.prototype,"_nativeAsset"),Jw.prototype),Qw=Jw))||Qw);T.ImageAsset=mg,bi(Gv);var bg,kg,Ag,Eg=new wt("Tex"),Tg=_o("cc.TextureBase")((yg=function(t){function i(i){var n;return(n=t.call(this,i)||this)._format=fg&&fg(),n._minFilter=vg&&vg(),n._magFilter=lg&&lg(),n._mipFilter=dg&&dg(),n._wrapS=wg&&wg(),n._wrapT=gg&&gg(),n._wrapR=pg&&pg(),n._anisotropy=_g&&_g(),n.Xn=1,n.Yn=1,n.ds=new Ql,n.ws=null,n.Lr=null,n.gs=0,n.ps=Eg.getNewId(),n.Lr=n._getGFXDevice(),n.gs=Sv(n.ps,666),n}e(i,t);var n=i.prototype;return n.getId=function(){return this.ps},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(t,i,n){void 0===n&&(n=t),this._wrapS=t,this.ds.addressU=t,this._wrapT=i,this.ds.addressV=i,this._wrapR=n,this.ds.addressW=n,this.Lr&&(this.ws=this.Lr.getSampler(this.ds))},n.setFilters=function(t,i){this._minFilter=t,this.ds.minFilter=t,this._magFilter=i,this.ds.magFilter=i,this.Lr&&(this.ws=this.Lr.getSampler(this.ds))},n.setMipFilter=function(t){this._mipFilter=t,this.ds.mipFilter=t,this.Lr&&(this.ws=this.Lr.getSampler(this.ds))},n.setAnisotropy=function(t){t=Math.min(t,16),this._anisotropy=t,this.ds.maxAnisotropy=t,this.Lr&&(this.ws=this.Lr.getSampler(this.ds))},n.destroy=function(){var i,n=t.prototype.destroy.call(this);return n&&null!=(i=T.director.root)&&i.batcher2D&&T.director.root.batcher2D._s(this.gs),n},n.getHash=function(){return this.gs},n.getGFXTexture=function(){return null},n.getSamplerInfo=function(){return this.ds},n.getGFXSampler=function(){return this.ws||(this.Lr?this.ws=this.Lr.getSampler(this.ds):ht(9302)),this.ws},n._serialize=function(){return""},n._deserialize=function(t){var i=t.split(",");i.unshift(""),i.length>=5&&(this.setFilters(parseInt(i[1]),parseInt(i[2])),this.setWrapMode(parseInt(i[3]),parseInt(i[4]))),i.length>=7&&(this.setMipFilter(parseInt(i[5])),this.setAnisotropy(parseInt(i[6])))},n._getGFXDevice=function(){return kw.gfxDevice},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(t){this._format=void 0===t?35:t},n._getGFXPixelFormat=function(t){return 1026===t?t=72:1025===t?t=85:1024===t&&(t=83),t},r(i,[{key:"isCompressed",get:function(){return this._format>=72&&this._format<=102||this._format>=1024&&this._format<=1026}},{key:"isAlphaAtlas",get:function(){return 1026===this._format||1025===this._format||1024===this._format}},{key:"width",get:function(){return this.Xn}},{key:"height",get:function(){return this.Yn}}]),i}(rg),yg.PixelFormat={RGB565:47,RGB5A1:49,RGBA4444:50,RGB888:24,RGB32F:32,RGBA8888:35,BGRA8888:36,RGBA32F:44,A8:1,I8:2,AI8:3,RGB_PVRTC_2BPPV1:83,RGBA_PVRTC_2BPPV1:84,RGB_A_PVRTC_2BPPV1:1024,RGB_PVRTC_4BPPV1:85,RGBA_PVRTC_4BPPV1:86,RGB_A_PVRTC_4BPPV1:1025,RGB_ETC1:72,RGBA_ETC1:1026,RGB_ETC2:73,RGBA_ETC2:77,RGBA_ASTC_4x4:89,RGBA_ASTC_5x4:90,RGBA_ASTC_5x5:91,RGBA_ASTC_6x5:92,RGBA_ASTC_6x6:93,RGBA_ASTC_8x5:94,RGBA_ASTC_8x6:95,RGBA_ASTC_8x8:96,RGBA_ASTC_10x5:97,RGBA_ASTC_10x6:98,RGBA_ASTC_10x8:99,RGBA_ASTC_10x10:100,RGBA_ASTC_12x10:101,RGBA_ASTC_12x12:102},yg.WrapMode={REPEAT:0,CLAMP_TO_EDGE:2,MIRRORED_REPEAT:1,CLAMP_TO_BORDER:3},yg.Filter={NONE:0,LINEAR:2,NEAREST:1},fg=uo((ag=yg).prototype,"_format",[Co],(function(){return 35})),vg=uo(ag.prototype,"_minFilter",[Co],(function(){return 2})),lg=uo(ag.prototype,"_magFilter",[Co],(function(){return 2})),dg=uo(ag.prototype,"_mipFilter",[Co],(function(){return 0})),wg=uo(ag.prototype,"_wrapS",[Co],(function(){return 0})),gg=uo(ag.prototype,"_wrapT",[Co],(function(){return 0})),pg=uo(ag.prototype,"_wrapR",[Co],(function(){return 0})),_g=uo(ag.prototype,"_anisotropy",[Co],(function(){return 0})),cg=ag))||cg;T.TextureBase=Tg;var Og=t("dJ",_o("cc.Script")(bg=function(t){function i(i){return t.call(this,i)||this}return e(i,t),i}(rg))||bg);T._Script=Og;var Sg=t("dK",_o("cc.JavaScript")(kg=function(t){function i(i){return t.call(this,i)||this}return e(i,t),i}(Og))||kg);T._JavaScript=Sg;var Ig,Rg,Mg,Cg,Ng,Pg,Lg,Dg=t("dL",_o("cc.TypeScript")(Ag=function(t){function i(i){return t.call(this,i)||this}return e(i,t),i}(Og))||Ag);T._TypeScript=Dg;var Bg,Fg,Ug,xg,Gg,jg,Hg,Vg,$g,zg,Wg,Xg=t("c$",_o("cc.ClickEvent")((Rg=function(){function t(){this.target=Mg&&Mg(),this.component=Cg&&Cg(),this._componentId=Ng&&Ng(),this.handler=Pg&&Pg(),this.customEventData=Lg&&Lg()}t.emitEvents=function(i){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];for(var e=0,h=i.length;e<h;e++){var u=i[e];u instanceof t&&u.emit(r)}};var i=t.prototype;return i.emit=function(t){var i=this.target;if(O.isValid(i)){this.ys();var n=O.js.getClassById(this._componentId),r=i.getComponent(n);if(O.isValid(r)){var s=r[this.handler];"function"==typeof s&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),s.apply(r,t))}}},i.ks=function(t){var i=O.js.getClassByName(t);return O.js.getClassId(i)},i.As=function(t){var i=O.js.getClassById(t);return O.js.getClassName(i)},i.ys=function(){this._componentId||(this._componentName=this.component,this.component="")},r(t,[{key:"_componentName",get:function(){return this.ys(),this.As(this._componentId)},set:function(t){this._componentId=this.ks(t)}}]),t}(),Mg=uo(Rg.prototype,"target",[Co],(function(){return null})),Cg=uo(Rg.prototype,"component",[Co],(function(){return""})),Ng=uo(Rg.prototype,"_componentId",[Co],(function(){return""})),Pg=uo(Rg.prototype,"handler",[Co],(function(){return""})),Lg=uo(Rg.prototype,"customEventData",[Co],(function(){return""})),Ig=Rg))||Ig),Yg=new wt("Comp"),Kg=t("d0",(Bg=_o("cc.Component"),Fg=ic(Og),Bg((Vg=function(t){function i(){var i;return(i=t.call(this)||this).node=Gg&&Gg(),i._enabled=jg&&jg(),i.__prefab=Hg&&Hg(),i._sceneGetter=null,i._id=Yg.getNewId(),i}e(i,t);var n=i.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene},n.addComponent=function(t){return this.node.addComponent(t)},n.getComponent=function(t){return this.node.getComponent(t)},n.getComponents=function(t){return this.node.getComponents(t)},n.getComponentInChildren=function(t){return this.node.getComponentInChildren(t)},n.getComponentsInChildren=function(t){return this.node.getComponentsInChildren(t)},n.destroy=function(){return!!t.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&O.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),O.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(t){return t||(t=O.instantiate._clone(this,this)),t&&(t.node=null),t},n.schedule=function(t,i,n,r){void 0===i&&(i=0),void 0===n&&(n=O.macro.REPEAT_FOREVER),void 0===r&&(r=0),ot(Boolean(t),1619),ot((i=i||0)>=0,1620),n=Number.isNaN(n)?O.macro.REPEAT_FOREVER:n,r=r||0;var s=O.director.getScheduler(),e=s.isTargetPaused(this);s.schedule(t,this,i,n,r,e)},n.scheduleOnce=function(t,i){void 0===i&&(i=0),this.schedule(t,0,0,i)},n.unschedule=function(t){t&&O.director.getScheduler().unschedule(t,this)},n.unscheduleAllCallbacks=function(){O.director.getScheduler().unscheduleAllForTarget(this)},r(i,[{key:"name",get:function(){if(this._name)return this._name;var t=Rt(this),i=t.lastIndexOf(".");return i>=0&&(t=t.slice(i+1)),this.node?this.node.name+"<"+t+">":t},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){var i=O.director._compScheduler;t?i.enableComp(this):i.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return 16384&this._objFlags}},{key:"internalUpdate",get:function(){return this.update}},{key:"internalLateUpdate",get:function(){return this.lateUpdate}},{key:"internalPreload",get:function(){return this.__preload}},{key:"internalOnLoad",get:function(){return this.onLoad}},{key:"internalStart",get:function(){return this.start}},{key:"internalOnEnable",get:function(){return this.onEnable}},{key:"internalOnDisable",get:function(){return this.onDisable}},{key:"internalOnDestroy",get:function(){return this.onDestroy}}]),i}(We),Vg.EventHandler=Xg,Vg._executionOrder=0,Vg._requireComponent=null,Vg.system=null,y((xg=Vg).prototype,"__scriptAsset",[Fg],Object.getOwnPropertyDescriptor(xg.prototype,"__scriptAsset"),xg.prototype),Gg=uo(xg.prototype,"node",[Co],(function(){return null})),jg=uo(xg.prototype,"_enabled",[Co],(function(){return!0})),Hg=uo(xg.prototype,"__prefab",[Co],(function(){return null})),Ug=xg))||Ug));Et(Kg,"_registerEditorProps",(function(t,i){var n=i.requireComponent;n&&(Array.isArray(n)&&(n=n.filter(Boolean)),t._requireComponent=n);var r=i.executionOrder;r&&"number"==typeof r&&(t._executionOrder=r)})),O.Component=Kg;var qg=t("dm",_o("cc.MissingScript")((zg=function(t){function i(){var i;return(i=t.call(this)||this)._$erialized=Wg&&Wg(),i}return e(i,t),i.safeFindClass=function(t){var i=Zt(t);if(i)return i;T.deserialize.reportMissingClass(t)},i.prototype.onLoad=function(){st(4600,this.node.name)},i}(Kg),Wg=uo(zg.prototype,"_$erialized",[Co,Po],(function(){return null})),$g=zg))||$g);T._MissingScript=qg;try{var Qg=qg.__values__;0!==Qg.length&&"_$erialized"===Qg[Qg.length-1]||(ht(16338),ht(16339,Qg.join(", ")))}catch(pe){ht(16340,""+pe)}var Jg=function(){function t(t){if(this.Es=0,this.Ts=void 0,this.Os=void 0,t instanceof ArrayBuffer)this.Ts=t,this.Os=new DataView(this.Ts);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this.Ts=t.buffer,this.Os=new DataView(this.Ts,t.byteOffset,t.byteLength)}}var i=t.prototype;return i.Ss=function(t){for(var i=new Array(t),n=0;n<t;n++)i[n]=this.parse();return i},i.Is=function(t){for(var i={},n=0;n<t;n++)i[this.parse()]=this.parse();return i},i.Rs=function(t){var i=Zg(this.Os,this.Es,t);return this.Es+=t,i},i.Ms=function(t){var i=this.Ts.slice(this.Es,this.Es+t);return this.Es+=t,i},i.parse=function(){var t,i=this.Os.getUint8(this.Es++),n=0,r=0,s=0,e=0;if(i<192)return i<128?i:i<144?this.Is(15&i):i<160?this.Ss(15&i):this.Rs(31&i);if(i>223)return-1*(255-i+1);switch(i){case 192:return null;case 194:return!1;case 195:return!0;case 196:return n=this.Os.getUint8(this.Es),this.Es+=1,this.Ms(n);case 197:return n=this.Os.getUint16(this.Es),this.Es+=2,this.Ms(n);case 198:return n=this.Os.getUint32(this.Es),this.Es+=4,this.Ms(n);case 199:if(n=this.Os.getUint8(this.Es),r=this.Os.getInt8(this.Es+1),this.Es+=2,-1===r){var h=this.Os.getUint32(this.Es);return s=this.Os.getInt32(this.Es+4),e=this.Os.getUint32(this.Es+8),this.Es+=12,new Date(1e3*(4294967296*s+e)+h/1e6)}return[r,this.Ms(n)];case 200:return n=this.Os.getUint16(this.Es),r=this.Os.getInt8(this.Es+2),this.Es+=3,[r,this.Ms(n)];case 201:return n=this.Os.getUint32(this.Es),r=this.Os.getInt8(this.Es+4),this.Es+=5,[r,this.Ms(n)];case 202:return t=this.Os.getFloat32(this.Es),this.Es+=4,t;case 203:return t=this.Os.getFloat64(this.Es),this.Es+=8,t;case 204:return t=this.Os.getUint8(this.Es),this.Es+=1,t;case 205:return t=this.Os.getUint16(this.Es),this.Es+=2,t;case 206:return t=this.Os.getUint32(this.Es),this.Es+=4,t;case 207:return s=this.Os.getUint32(this.Es)*Math.pow(2,32),e=this.Os.getUint32(this.Es+4),this.Es+=8,s+e;case 208:return t=this.Os.getInt8(this.Es),this.Es+=1,t;case 209:return t=this.Os.getInt16(this.Es),this.Es+=2,t;case 210:return t=this.Os.getInt32(this.Es),this.Es+=4,t;case 211:return s=this.Os.getInt32(this.Es)*Math.pow(2,32),e=this.Os.getUint32(this.Es+4),this.Es+=8,s+e;case 212:return r=this.Os.getInt8(this.Es),this.Es+=1,0===r?void(this.Es+=1):[r,this.Ms(1)];case 213:return r=this.Os.getInt8(this.Es),this.Es+=1,[r,this.Ms(2)];case 214:return r=this.Os.getInt8(this.Es),this.Es+=1,-1===r?(t=this.Os.getUint32(this.Es),this.Es+=4,new Date(1e3*t)):[r,this.Ms(4)];case 215:return r=this.Os.getInt8(this.Es),this.Es+=1,0===r?(s=this.Os.getInt32(this.Es)*Math.pow(2,32),e=this.Os.getUint32(this.Es+4),this.Es+=8,new Date(s+e)):-1===r?(s=this.Os.getUint32(this.Es),e=this.Os.getUint32(this.Es+4),this.Es+=8,new Date(1e3*(4294967296*(3&s)+e)+(s>>>2)/1e6)):[r,this.Ms(8)];case 216:return r=this.Os.getInt8(this.Es),this.Es+=1,[r,this.Ms(16)];case 217:return n=this.Os.getUint8(this.Es),this.Es+=1,this.Rs(n);case 218:return n=this.Os.getUint16(this.Es),this.Es+=2,this.Rs(n);case 219:return n=this.Os.getUint32(this.Es),this.Es+=4,this.Rs(n);case 220:return n=this.Os.getUint16(this.Es),this.Es+=2,this.Ss(n);case 221:return n=this.Os.getUint32(this.Es),this.Es+=4,this.Ss(n);case 222:return n=this.Os.getUint16(this.Es),this.Es+=2,this.Is(n);case 223:return n=this.Os.getUint32(this.Es),this.Es+=4,this.Is(n)}throw new Error("Could not parse")},r(t,[{key:"offset",get:function(){return this.Es}}]),t}();function Zg(t,i,n){for(var r="",s=0,e=i,h=i+n;e<h;e++){var u=t.getUint8(e);if(128&u)if(192!=(224&u))if(224!=(240&u)){if(240!=(248&u))throw new Error("Invalid byte "+u.toString(16));(s=(7&u)<<18|(63&t.getUint8(++e))<<12|(63&t.getUint8(++e))<<6|63&t.getUint8(++e))>=65536?(s-=65536,r+=String.fromCharCode(55296+(s>>>10),56320+(1023&s))):r+=String.fromCharCode(s)}else r+=String.fromCharCode((15&u)<<12|(63&t.getUint8(++e))<<6|63&t.getUint8(++e));else r+=String.fromCharCode((31&u)<<6|63&t.getUint8(++e));else r+=String.fromCharCode(u)}return r}function tp(t){var i=new Jg(t),n=i.parse();if(i.offset!==t.byteLength)throw new Error(t.byteLength-i.offset+" trailing bytes");return n}var ip=function(){function t(t,i){this.Cs=t,this.Ns=i}return r(t,[{key:"document",get:function(){return this.Cs}},{key:"chunks",get:function(){return this.Ns}}]),t}();function np(t){if(t.length<16)throw new sp(at(13102));var i=new DataView(t.buffer,t.byteOffset,t.byteLength);if(1313817411!==i.getUint32(0,!0))throw new sp(at(13100));var n=i.getUint32(4,!0);if(i.getUint32(8,!0)!==i.byteLength)throw new sp(at(13102));var r=12,s=i.getUint32(r,!0);r+=4;var e,h=new Uint8Array(i.buffer,r+i.byteOffset,s);r+=s;try{if(1===n){var u=rp(h);e=JSON.parse(u)}else 2===n&&(e=tp(h))}catch(t){throw new sp(t)}for(var o=[];r<i.byteLength;){r%8!=0&&(r+=8-r%8);var c=i.getUint32(r,!0);r+=4,o.push(new Uint8Array(i.buffer,r+i.byteOffset,c)),r+=c}if(r!==i.byteLength)throw new sp(at(13102));return new ip(e,o)}function rp(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);if("Buffer"in globalThis)return globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString();throw new Error(at(13104))}var sp=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(a(Error));function ep(t,i,n,r,s){if(i instanceof T.ValueType){s||t.push("if(prop){");var e=Rt(i);t.push("s._deserializeFastDefinedObject(o"+n+",prop,"+e+");"),s||t.push("}else o"+n+"=null;")}else t.push("\nif (prop) {\n    s._deserializeAndAssignField(o, prop, "+r+");\n} else {\n    o"+n+"=null;\n}\n")}!function(){function t(){this.Ps=[],this.Ls=0}var i=t.prototype;i.alignAs=function(t){if(0!==t){var i=this.Ls%t;if(0!==i){var n=t-i;return this.Ps.push(n),this.Ls+=n,n}}return 0},i.append=function(t){var i=this.Ls;return this.Ps.push(t),this.Ls+=t.byteLength,i},i.get=function(){var t=new Uint8Array(this.Ls),i=0;return this.Ps.forEach((function(n){"number"==typeof n?i+=n:(t.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),i),i+=n.byteLength)})),t},r(t,[{key:"byteLength",get:function(){return this.Ls}}])}(),T.internal.decodeCCONBinary=np,T.internal.CCON=ip;var hp=function(t,i){for(var n=Tn.Attr.getClassAttrs(i),r=i.__values__,s=["var prop;"],e=fp(i),h=0;h<r.length;h++){var u=r[h],o=void 0,c=void 0;Tn.IDENTIFIER_RE.test(u)?(c='"'+u+'"',o="."+u):o="["+(c=Tn.escapeForJS(u))+"]";var a=o;if(n[u+ap]){var f=n[u+ap];a=Tn.IDENTIFIER_RE.test(f)?"."+f:"["+Tn.escapeForJS(f)+"]"}s.push("prop=d"+a+";"),s.push('if(typeof prop!=="undefined"){');var v=Tn.getDefault(n[u+cp]),l=n[u+op];e&&(void 0!==v||l)?vp(v,l)?s.push("o"+o+"=prop;"):ep(s,v,o,c,!0):(s.push('if(typeof prop!=="object"){o'+o+"=prop;}else{"),ep(s,v,o,c,!1),s.push("}")),s.push("}")}return(Ht(i,T.Node)||Ht(i,T.Component))&&s.push("d._id&&(o._id=d._id);"),"_$erialized"===r[r.length-1]&&(s.push("o._$erialized=JSON.parse(JSON.stringify(d));"),s.push("s._fillPlainObject(o._$erialized,d);")),Function("s","o","d","k",s.join(""))},up=Tn.Attr.DELIMETER,op=up+"type",cp=up+"default",ap=up+"formerlySerializedAs";function fp(t){return Ri.test(ni(t))}function vp(t,i){if(void 0===t)return i instanceof Tn.Attr.PrimitiveType||i===wn||i===gn;var n=typeof t;return"string"===n||"number"===n||"boolean"===n}var lp=function(t){function i(){return t.call(this,(function(t){t.clear()}),1)||this}return e(i,t),i}(ri);lp.prototype.get=function(t,i,n,r,s){var e=this._get();return e?(e.reset(t,i,n,r,s),e):new dp(t,i,n,r,s)};var dp=function(){function t(t,i,n,r){this.deserializedList=[],this.deserializedData=null,this.result=t,this.customEnv=r,this.Ds=i,this.Bs=n,this.Fs=null==i?void 0:i.onDereferenced}var i=t.prototype;return i.reset=function(t,i,n,r){this.result=t,this.customEnv=r,this.Ds=i,this.Bs=n,this.Fs=null==i?void 0:i.onDereferenced},i.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this.Ds=null,this.Bs=null,this.Fs=null},i.deserialize=function(t){var i,n=!1;t instanceof ip?(n=!0,i=t.document,t.chunks.length>0&&(t.chunks.length,this.Us=t.chunks[0])):i=t,this.xs=i,this.Gs={fromCCON:n};var r=Array.isArray(i)?i[0]:i;return this.deserializedData=this.Hs(r,0),this.xs=void 0,this.Us=void 0,this.Gs=void 0,this.deserializedData},i.Hs=function(t,i,n,r){switch(t.__type__){case"TypedArray":return this.Vs(t);case"TypedArrayRef":return this.$s(t);default:return t.__type__?this.zs(t,i,n,r):Array.isArray(t)?this.Ws(t):this.Xs(t)}},i.Vs=function(t){return globalThis[t.ctor].from(t.array)},i.$s=function(t){var i=t.offset,n=t.length,r=t.ctor;return new globalThis[r](this.Us.buffer,this.Us.byteOffset+i,n)},i.Ws=function(t){for(var i,n=new Array(t.length),r=0;r<t.length;r++)"object"==typeof(i=t[r])&&i?this._deserializeAndAssignField(n,i,""+r)&&(n[r]=null):n[r]=i;return n},i.Xs=function(t){var i={};return this._fillPlainObject(i,t),i},i.zs=function(t,i,n,r){var s=this,e=t.__type__,h=this.Ds(e,t,n,r);if(!h)return this.Ds===Zt&&this.Bs(e),null;var u=function(t){var n=new t;return i>=0&&(s.deserializedList[i]=n),n}(h);return this.Ys(t,u,h),u},i.Ys=function(t,i,n,r){void 0===r&&(r=!1),r||!i[_c]?i._deserialize?i._deserialize(t.content,this):T.Class._isCCClass(n)?this.Ks(i,t,n):this._deserializeFastDefinedObject(i,t,n):this.qs(t,i,n)},i.qs=function(t,i,n){var r=this,s={readProperty:function(i){var n=t[i];return"object"==typeof n&&n?r.Qs(n):n},readThis:function(){r.Ys(t,i,n,!0)},readSuper:function(){var s=jt(n);s&&r.Ys(t,i,s)}};i[_c](s,this.Gs)},i.Ks=function(t,i,n){var r;if(n.hasOwnProperty("__deserialize__"))r=n.__deserialize__;else{r=hp(0,n);try{if(n===qg){var s=n.__values__;0!==s.length&&"_$erialized"===s[s.length-1]||(ht(16341),ht(16342,s.join(", ")));var e=r;r=function(t,i,n,r){e(t,i,n,r),i._$erialized||ht(16343,JSON.stringify(n))}}}catch(t){ht(16344,""+t)}Et(n,"__deserialize__",r,!0)}r(this,t,i,n)},i._deserializeAndAssignField=function(t,i,n){var r=i.__id__;if("number"==typeof r){var s=this.deserializedList[r];if(s)t[n]=s;else{var e,h=this.xs[r];t[n]=this.Hs(h,r,void 0,n),null==(e=this.Fs)||e.call(this,this.deserializedList,r,t,n)}}else{var u=i.__uuid__;if(u){var o=i.__expectedType__;this.result.push(t,n,u,o)}else t[n]=this.Hs(i,-1)}return!1},i.Qs=function(t){var i=t.__id__;if("number"==typeof i){var n=this.deserializedList[i];if(n)return n;var r=this.xs[i];return this.Hs(r,i,void 0,void 0)}if(t.__uuid__)throw t.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this.Hs(t,-1)},i._fillPlainObject=function(t,i){for(var n in i)if(i.hasOwnProperty(n)){var r=i[n];"object"!=typeof r?"__type__"!==n&&(t[n]=r):r?this._deserializeAndAssignField(t,r,n)&&(t[n]=null):t[n]=null}},i._deserializeFastDefinedObject=function(t,i,n){if(n===T.Vec2)return t.x=i.x||0,void(t.y=i.y||0);if(n===T.Vec3)return t.x=i.x||0,t.y=i.y||0,void(t.z=i.z||0);if(n!==T.Color){if(n===T.Size)return t.width=i.width||0,void(t.height=i.height||0);for(var r=Tn.Attr.getClassAttrs(n),s=n.__values__,e=0;e<s.length;e++){var h=s[e],u=i[h];void 0!==u||i.hasOwnProperty(h)||(u=Tn.getDefault(r[h+cp])),"object"!=typeof u?t[h]=u:u?this._deserializeAndAssignField(t,u,h):t[h]=null}}else{t.r=i.r||0,t.g=i.g||0,t.b=i.b||0;var o=i.a;t.a=void 0===o?255:o}},r(t,[{key:"ignoreEditorOnly",get:function(){return this.Js}}]),t}();function wp(t,i,n){var r,s=(n=n||{}).classFinder||Zt,e=n.createAssetRefs||bh.platform===ah.EDITOR_CORE,h=n.customEnv,u=n.ignoreEditorOnly,o=null!==(r=n.reportMissingClass)&&void 0!==r?r:T.deserialize.reportMissingClass;i.init();var c=dp.pool.get(i,s,o,h,u);T.game._isCloning=!0;var a=c.deserialize(t);return T.game._isCloning=!1,dp.pool.put(c),e&&i.assignAssetsBy((function(t,i){return EditorExtends.serialize.asAsset(t,i.type)})),a}dp.pool=new lp;var gp=[Ms,Ir,$s,Qr,Qs,ie,ee,ls];function pp(t,i){t.x=i[1],t.y=i[2],t.z=i[3],t.w=i[4]}var _p=[function(t,i){t.x=i[1],t.y=i[2]},function(t,i){t.x=i[1],t.y=i[2],t.z=i[3]},pp,pp,function(t,i){Qs.fromUint32(t,i[1])},function(t,i){t.width=i[1],t.height=i[2]},function(t,i){t.x=i[1],t.y=i[2],t.width=i[3],t.height=i[4]},function(t,i){ls.fromArray(t,i,1)}],yp=1,mp=0,bp=0,kp=1,Ap=2,Ep=0,Tp=0,Op=t("dv",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var i=t.prototype;return i.init=function(t){t?(this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},i.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},i.push=function(t,i,n,r){this.uuidObjList.push(t),this.uuidPropList.push(i),this.uuidList.push(n),this.uuidTypeList.push(r||"")},t}());function Sp(t,i,n){for(var r=t.length-1,s=0,e=3*t[r];s<e;s+=3){var h=t[s],u=i[t[s+2]],o=t[s+1];o>=0?h[n[o]]=u:h[~o]=u}for(;s<r;s+=3){var c=i[t[s]],a=i[t[s+2]],f=t[s+1];f>=0?c[n[f]]=a:c[~f]=a}}function Ip(t,i){for(var n=t[4][i[Tp]],r=n[Ep],s=new(0,r[bp]),e=r[kp],h=r[Ap],u=n[n.length-1],o=Ep+1;o<u;++o)s[e[n[o]]]=i[o];for(;o<i.length;++o){var c=e[n[o]],a=r[n[o]+h];(0,Lp[a])(t,s,c,i[o])}return s}function Rp(t,i,n){var r=new i;return r._deserialize?r._deserialize(n,t[0]):ht(5303,Rt(i)),r}function Mp(t,i,n,r){r>=0?i[n]=t[5][r]:t[7][3*~r]=i}function Cp(t){return function(i,n,r,s){for(var e=0;e<s.length;++e)t(i,s,e,s[e]);n[r]=s}}function Np(t,i,n,r){i[n]=null,t[8][r]=i}function Pp(t,i,n,r){i[n]=Ip(t,r)}Op.pool=new ri((function(t){t.reset()}),5),Op.pool.get=function(){return this._get()||new Op};var Lp=new Array(13);function Dp(t){var i=t[5],n=t[6],r=n===mp?0:n.length,s=i[i.length-1],e=i.length-r;"number"!=typeof s?s=0:(s<0&&(s=~s),--e);for(var h=0;h<e;++h)i[h]=Ip(t,i[h]);for(var u=t[3],o=0;o<r;++o,++h){var c=n[o],a=i[h];if(c>=0){var f=u[c];i[h]=Rp(t,f,a)}else(0,Lp[c=~c])(t,i,h,a)}return s}function Bp(t,i,n){return t||n(i),Object}function Fp(t,i,n,r,s,e,h){var u=t(i);if(!u){if(s)return void(n[r]=function(i,n,r){return function(){var s=t(r)||Bp(e,r,h);return i[n]=s,new s}}(n,r,i));u=Bp(e,i,h)}n[r]=u}function Up(t,i,n,r){for(var s=n||Zt,e=t[3],h=0;h<e.length;++h){var u=e[h];"string"!=typeof u?Fp(s,u[bp],u,bp,i,n,r):Fp(s,u,e,h,i,n,r)}}function xp(t){var i=t[4];if(i)for(var n=t[3],r=0;r<i.length;++r){var s=i[r];s[Ep]=n[s[Ep]]}}function Gp(t){for(var i=t[5],n=t[2],r=t[1],s=t[8],e=t[9],h=t[10],u=0;u<s.length;++u){var o=s[u];"number"==typeof o&&(s[u]=i[o]);var c=e[u];"number"==typeof c&&(c=c>=0?n[c]:~c,e[u]=c);var a=h[u];"number"==typeof a&&(h[u]=r[a])}}function jp(t){if(Array.isArray(t)){var i=t[0];return"number"==typeof i||i instanceof $p}return!1}function Hp(t,i,n){var r;i.init(t),null!==(r=n)&&void 0!==r||(n={});var s=t[0],e=!1;if("object"==typeof s&&(e=s.preprocessed,s=s.version),s<yp)throw new Error(at(5304,s));var h,u=n;u._version=s,u.result=i,t[0]=u,e||(Up(t,!1,n.classFinder,null!==(h=n.reportMissingClass)&&void 0!==h?h:Vp.reportMissingClass),xp(t))}function Vp(t,i,n){"string"==typeof t&&(t=JSON.parse(t));var r,s=!1;if(i||(i=Op.pool.get(),s=!0),jp(t)){Hp(t,i,n);var e=t;T.game._isCloning=!0;var h=e[5],u=Dp(e);T.game._isCloning=!1,e[7]&&Sp(e[7],h,e[2]),Gp(e),r=h[u]}else r=wp(t,i,n);return s&&Op.pool.put(i),r}Lp[0]=function(t,i,n,r){i[n]=r},Lp[1]=Mp,Lp[2]=Cp(Mp),Lp[3]=Cp(Np),Lp[4]=Pp,Lp[5]=function(t,i,n,r){var s=r[0],e=i[n];(0,_p[s])(e,r)},Lp[6]=Np,Lp[7]=function(t,i,n,r){i[n].set(r)},Lp[8]=function(t,i,n,r){var s=r[0],e=new gp[s];(0,_p[s])(e,r),i[n]=e},Lp[9]=Cp(Pp),Lp[10]=function(t,i,n,r){var s=t[3][r[0]];i[n]=Rp(t,s,r[1])},Lp[11]=function(t,i,n,r){var s=r[0];i[n]=s;for(var e=1;e<r.length;e+=3){var h=r[e],u=r[e+1],o=r[e+2];(0,Lp[u])(t,s,h,o)}},Lp[12]=function(t,i,n,r){for(var s=r[0],e=0;e<s.length;++e){var h=s[e],u=r[e+1];0!==u&&(0,Lp[u])(t,s,e,h)}i[n]=s},Vp.Details=Op,Vp.reportMissingClass=function(t){ht(5302,t)};var $p=function(t){this.preprocessed=!0,this.version=t};function zp(t,i){if(t[0]<yp)throw new Error(at(5304,t[0]));Up(t,!0,i,Vp.reportMissingClass),xp(t);for(var n=new $p(t[0]),r=t[1],s=t[2],e=t[3],h=t[4],u=t[5],o=0;o<u.length;++o)u[o].unshift(n,r,s,e,h);return u}function Wp(t,i,n){return[yp,mp,mp,[t],mp,n?[i,-1]:[i],[0],mp,[],[],[]]}function Xp(t){return n=(i=t)[1],i[10].map((function(t){return n[t]}));var i,n}T.deserialize=Vp;var Yp=new WeakMap,Kp=new WeakSet,qp=new WeakSet;function Qp(t,i){var n;n=qg.safeFindClass;var r,s=Op.pool.get();try{r=Vp(t,s,{classFinder:n,customEnv:i})}catch(t){throw X(t),Op.pool.put(s),t}r._uuid=i.__uuid__||"";for(var e=s.uuidList,h=s.uuidObjList,u=s.uuidPropList,o=s.uuidTypeList||[],c=[],a=0;a<e.length;a++){var f=e[a];c[a]={uuid:Hw(f),owner:h[a],prop:u[a],type:Zt(o[a])}}return Yp.set(r,c),r._native&&Kp.add(r),Op.pool.put(s),r}var Jp=function(){function t(){this._depends=new Ow}var i=t.prototype;return i.init=function(){this._depends.clear()},i.getNativeDep=function(t){var i=this._depends.get(t);return i&&i.nativeDep?s({},i.nativeDep):null},i.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},i.getDepsRecursively=function(t){var i=Object.create(null),n=[];return this.Zs(t,i,n),n},i.remove=function(t){this._depends.remove(t)},i.parse=function(t,i){var n,r,s=null;if(Array.isArray(i)||i.__type__||i instanceof ip){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(i)||"number"==typeof(r=(n=i[5])[n.length-1])&&r<0)try{var e=Qp(i,{__uuid__:t});(s=this.te(e)).nativeDep&&(s.nativeDep.uuid=t),Mw.add(t+"@import",e)}catch(i){Rw.remove(t+"@import"),s={deps:[]}}else s={deps:this.re(i)}}else{if(this._depends.has(t)&&(s=this._depends.get(t)).parsedFromExistAsset)return s;s=this.te(i)}return this._depends.add(t,s),s},i.te=function(t){for(var i={deps:[],parsedFromExistAsset:!0},n=Yp.get(t),r=0,s=n.length;r<s;r++)i.deps.push(n[r].uuid);return Kp.has(t)&&(i.nativeDep=t._nativeDep),i},i.re=function(t){var i=Xp(t);return i.forEach((function(t,n){return i[n]=Hw(t)})),i},i.Zs=function(t,i,n){for(var r=this.getDeps(t),s=0;s<r.length;s++){var e=r[s];i[e]||(i[e]=!0,n.push(e),this.Zs(e,i,n))}},r(t,null,[{key:"instance",get:function(){return this.se||(this.se=new t),this.se}}]),t}();Jp.se=void 0;var Zp,t_=Jp.instance,i_=[new Fl];function n_(t,i){for(var n=Math.max(t,i),r=0;n;)n>>=1,r++;return r}function r_(t){return t&&!(t&t-1)}function s_(t,i,n){return!(6===t.gfxAPI)||r_(i)&&r_(n)}var e_,h_,u_,o_,c_,a_=_o("cc.SimpleTexture")(Zp=function(t){function i(i){var n;return(n=t.call(this,i)||this).ee=null,n.he=null,n.ue=1,n.ce=0,n.ae=0,n.fe=0,n.ve=1e3,n}e(i,t);var n=i.prototype;return n.getGFXTexture=function(){return this.he},n.destroy=function(){return this.le(),this.de(),t.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(t,i,n){if(void 0===i&&(i=0),void 0===n&&(n=0),this.ee&&!(this.ue<=i)){var r=this._getGFXDevice();if(r){var s=i_[0];s.texExtent.width=this.ce>>i,s.texExtent.height=this.ae>>i,s.texSubres.mipLevel=i,s.texSubres.baseArrayLayer=n,ArrayBuffer.isView(t)?r.copyBuffersToTexture([t],this.ee,i_):r.copyTexImagesToTexture([t],this.ee,i_)}}},n.we=function(t,i,n){var r=t.data;if(r&&(this.uploadData(r,i,n),this.ge(),Si.CLEANUP_IMAGE_CACHE)){var s=t_.getDeps(this._uuid),e=s.indexOf(t._uuid);-1!==e&&(hi(s,e),t.decRef())}},n.ge=function(){this.pe()},n.pe=function(){this.loaded=!0,this.emit("load")},n._e=function(t){this.ue=t<1?1:t},n.ye=function(t,i){this.fe=t<1?0:t,this.ve=i<1?0:i},n.setMipRange=function(t,i){ot(t<=i,3124),this.ye(t,i);var n=this._getGFXDevice();if(n){var r=this.me(n);this.le(),this.he=r}},n.be=function(){return null},n.ke=function(){return null},n.Ae=function(){if(this.le(),this.de(),0!==this.ue){var t=this._getGFXDevice();t&&(this.Ee(t),this.he=this.me(t))}},n.isUsingOfflineMipmaps=function(){return!1},n.Ee=function(t){if(0!==this.Xn&&0!==this.Yn){var i=0;0!==this._mipFilter&&s_(t,this.Xn,this.Yn)&&(this.ue=n_(this.Xn,this.Yn),this.isUsingOfflineMipmaps()||this.isCompressed||(i=1));var n=this.be({usage:22,format:this._getGFXFormat(),levelCount:this.ue,flags:i});if(n){var r=t.createTexture(n);this.ce=n.width,this.ae=n.height,this.ee=r}}},n.me=function(t){if(!this.ee)return null;var i=this.ve<this.ue?this.ve:this.ue-1,n=this.ke({texture:this.ee,format:this._getGFXFormat(),baseLevel:this.fe,levelCount:i-this.fe+1});return n?t.createTexture(n):null},n.de=function(){this.ee&&(this.ee.destroy(),this.ee=null)},n.le=function(){this.he&&(this.he.destroy(),this.he=null)},r(i,[{key:"mipmapLevel",get:function(){return this.ue}}]),i}(Tg))||Zp;T.SimpleTexture=a_;var f_=t("dE",(e_=_o("cc.Texture2D"),h_=ic([mg]),e_((o_=function(t){function i(i){var n;return(n=t.call(this,i)||this)._mipmaps=c_&&c_(),n.Te=[],n}e(i,t);var n=i.prototype;return n.Oe=function(t){var i=this;if(this.Te=t,this._e(this.Te.length),this.Te.length>0){var n=this.Te[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this.Te.length,baseLevel:this.fe,maxLevel:this.ve}),this.Te.forEach((function(t,n){i.we(t,n)}))}else this.reset({width:0,height:0,mipmapLevel:this.Te.length,baseLevel:this.fe,maxLevel:this.ve})},n.Se=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.Se()},n.reset=function(t){this.Xn=t.width,this.Yn=t.height,this._setGFXFormat(t.format);var i=void 0===t.mipmapLevel?1:t.mipmapLevel;this._e(i);var n=void 0===t.baseLevel?0:t.baseLevel,r=void 0===t.maxLevel?1e3:t.maxLevel;this.ye(n,r),this.Ae()},n.create=function(t,i,n,r,s,e){void 0===n&&(n=35),void 0===r&&(r=1),void 0===s&&(s=0),void 0===e&&(e=1e3),this.reset({width:t,height:i,format:n,mipmapLevel:r,baseLevel:s,maxLevel:e})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=void 0),!(t>=this.Te.length))for(var n=Math.min(void 0===i?this.Te.length:i,this.Te.length-t),r=0;r<n;++r){var s=t+r;this.we(this.Te[s],s)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],this.Te=[],t.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(i,n){var r=i;t.prototype._deserialize.call(this,r.base,n),this._mipmaps=new Array(r.mipmaps.length);for(var s=0;s<r.mipmaps.length;++s)if(this._mipmaps[s]=new mg,r.mipmaps[s]){var e=r.mipmaps[s];n.result.push(this._mipmaps,""+s,e,ni(mg))}},n.be=function(t){var i=new Kl(1);return i.width=this.Xn,i.height=this.Yn,Object.assign(i,t),i},n.ke=function(t){var i=new ql;return i.type=1,Object.assign(i,t),i},n.initDefault=function(i){t.prototype.initDefault.call(this,i);var n=new mg;n.initDefault(),this.image=n},n.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},r(i,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){this._mipmaps=t;var i=[];if(1===t.length){var n=t[0];i.push.apply(i,n.fs())}else if(t.length>1)for(var r=0;r<t.length;++r){var s=t[r];i.push(s.us())}this.Oe(i)}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),i}(a_),c_=uo(o_.prototype,"_mipmaps",[h_],(function(){return[]})),u_=o_))||u_));function v_(t,i,n,r){t.drawTextureAt(i,n,r)}T.Texture2D=f_;var l_,d_,w_,g_,p_,__,y_,m_,b_,k_,A_,E_,T_,O_,S_=t("A",function(){function t(t,i){this._innerTextureInfos={},this.Ie=[],this._count=0;var n=new I_;n.initWithSize(t,i),this._texture=n,this.Xn=t,this.Yn=i,this.Re=2,this.Me=2,this.Ce=2}var i=t.prototype;return i.insertSpriteFrame=function(t){var i=t.rect,n=t.texture,r=this._innerTextureInfos[n.getId()],s=i.x,e=i.y;if(r)s+=r.x,e+=r.y;else{var h=n.width,u=n.height;if(this.Re+h+2>this.Xn&&(this.Re=2,this.Me=this.Ce),this.Me+u+2>this.Ce&&(this.Ce=this.Me+u+2),this.Ce>this.Yn)return null;var o=this._texture,c=n.image;T.internal.dynamicAtlasManager.textureBleeding&&((h<=8||u<=8)&&(v_(o,c,this.Re-1,this.Me-1),v_(o,c,this.Re-1,this.Me+1),v_(o,c,this.Re+1,this.Me-1),v_(o,c,this.Re+1,this.Me+1)),v_(o,c,this.Re-1,this.Me),v_(o,c,this.Re+1,this.Me),v_(o,c,this.Re,this.Me-1),v_(o,c,this.Re,this.Me+1)),v_(o,c,this.Re,this.Me),this._innerTextureInfos[n.getId()]={x:this.Re,y:this.Me,texture:n},this._count++,s+=this.Re,e+=this.Me,this.Re+=h+2}var a={x:s,y:e,texture:this._texture};return this.Ie.push(t),a},i.removeSpriteFrame=function(t){oi(this.Ie,t)},i.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},i.isEmpty=function(){return this._count<=0},i.reset=function(){this.Re=2,this.Me=2,this.Ce=2;for(var t=this.Ie,i=0,n=t.length;i<n;i++){var r=t[i];r.isValid&&r._resetDynamicAtlasFrame()}this.Ie.length=0,this._innerTextureInfos={}},i.destroy=function(){this.reset(),this._texture.destroy()},t}()),I_=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.initWithSize=function(t,i,n){void 0===n&&(n=35),this.reset({width:t,height:i,format:n})},n.drawTextureAt=function(t,i,n){var r=this.getGFXTexture();if(t&&r){var s=this._getGFXDevice();if(s){var e=new Fl;e.texOffset.x=i,e.texOffset.y=n,e.texExtent.width=t.width,e.texExtent.height=t.height,s.copyTexImagesToTexture([t.data],r,[e])}else st(16363)}},i}(f_),R_={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},M_=t("cZ",function(){function t(){}return t.init=function(){var i=Oi.querySettings("engine","customLayers");if(i)for(var n=0;n<i.length;n++){var r=i[n];t.addLayer(r.name,r.bit)}},t.makeMaskInclude=function(t){return t.reduce((function(t,i){return t|i}),0)},t.makeMaskExclude=function(i){return~t.makeMaskInclude(i)},t.addLayer=function(i,n){if(void 0!==n)if(n>19||n<0)st(16365);else{var r=1<<n;t.Enum[i],at(2104,i),t.Enum[i]=r,Et(t.Enum,String(r),i),t.BitMask[i]=r,Et(t.BitMask,String(r),i),wi.update(t.BitMask),_i.update(t.Enum)}else st(16364)},t.deleteLayer=function(i){if(i>19||i<0)st(16366);else{var n=1<<i;delete t.Enum[t.Enum[n]],delete t.Enum[n],delete t.BitMask[t.BitMask[n]],delete t.BitMask[n],wi.update(t.BitMask),_i.update(t.Enum)}},t.nameToLayer=function(i){return void 0===i?(st(16367),-1):M(t.Enum[i])},t.layerToName=function(i){return i>31||i<0?(st(16368),""):t.Enum[1<<i]},t}());M_.Enum=_i(R_),M_.BitMask=wi(s({},R_)),O.Layers=M_;var C_={DEFAULT:100,UI:200};T.RenderPassStage=C_;var N_={bindings:[],layouts:{}},P_={bindings:[],layouts:{}},L_=new jl([4,0,7,0],[4,0,9,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,2,1,3]),D_=function(){};l_=D_,D_.TIME_OFFSET=0,D_.SCREEN_SIZE_OFFSET=4,D_.NATIVE_SIZE_OFFSET=8,D_.PROBE_INFO_OFFSET=12,D_.DEBUG_VIEW_MODE_OFFSET=16,D_.COUNT=20,D_.SIZE=80,D_.NAME="CCGlobal",D_.BINDING=0,D_.DESCRIPTOR=new md(l_.BINDING,1,1,63),D_.LAYOUT=new Zl(0,l_.BINDING,l_.NAME,[new Jl("cc_time",16,1),new Jl("cc_screenSize",16,1),new Jl("cc_nativeSize",16,1),new Jl("cc_probeInfo",16,1),new Jl("cc_debug_view_mode",16,1)],1),N_.layouts[D_.NAME]=D_.LAYOUT,N_.bindings[D_.BINDING]=D_.DESCRIPTOR;var B_=function(){};d_=B_,B_.MAT_VIEW_OFFSET=0,B_.MAT_VIEW_INV_OFFSET=16,B_.MAT_PROJ_OFFSET=32,B_.MAT_PROJ_INV_OFFSET=48,B_.MAT_VIEW_PROJ_OFFSET=64,B_.MAT_VIEW_PROJ_INV_OFFSET=80,B_.CAMERA_POS_OFFSET=96,B_.SURFACE_TRANSFORM_OFFSET=100,B_.SCREEN_SCALE_OFFSET=104,B_.EXPOSURE_OFFSET=108,B_.MAIN_LIT_DIR_OFFSET=112,B_.MAIN_LIT_COLOR_OFFSET=116,B_.AMBIENT_SKY_OFFSET=120,B_.AMBIENT_GROUND_OFFSET=124,B_.GLOBAL_FOG_COLOR_OFFSET=128,B_.GLOBAL_FOG_BASE_OFFSET=132,B_.GLOBAL_FOG_ADD_OFFSET=136,B_.NEAR_FAR_OFFSET=140,B_.VIEW_PORT_OFFSET=144,B_.COUNT=148,B_.SIZE=592,B_.NAME="CCCamera",B_.BINDING=1,B_.DESCRIPTOR=new md(d_.BINDING,1,1,63),B_.LAYOUT=new Zl(0,d_.BINDING,d_.NAME,[new Jl("cc_matView",25,1),new Jl("cc_matViewInv",25,1),new Jl("cc_matProj",25,1),new Jl("cc_matProjInv",25,1),new Jl("cc_matViewProj",25,1),new Jl("cc_matViewProjInv",25,1),new Jl("cc_cameraPos",16,1),new Jl("cc_surfaceTransform",16,1),new Jl("cc_screenScale",16,1),new Jl("cc_exposure",16,1),new Jl("cc_mainLitDir",16,1),new Jl("cc_mainLitColor",16,1),new Jl("cc_ambientSky",16,1),new Jl("cc_ambientGround",16,1),new Jl("cc_fogColor",16,1),new Jl("cc_fogBase",16,1),new Jl("cc_fogAdd",16,1),new Jl("cc_nearFar",16,1),new Jl("cc_viewPort",16,1)],1),N_.layouts[B_.NAME]=B_.LAYOUT,N_.bindings[B_.BINDING]=B_.DESCRIPTOR;var F_=function(){};w_=F_,F_.MAT_LIGHT_VIEW_OFFSET=0,F_.MAT_LIGHT_VIEW_PROJ_OFFSET=16,F_.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET=32,F_.SHADOW_PROJ_DEPTH_INFO_OFFSET=36,F_.SHADOW_PROJ_INFO_OFFSET=40,F_.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET=44,F_.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=48,F_.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=52,F_.SHADOW_COLOR_OFFSET=56,F_.PLANAR_NORMAL_DISTANCE_INFO_OFFSET=60,F_.COUNT=64,F_.SIZE=256,F_.NAME="CCShadow",F_.BINDING=2,F_.DESCRIPTOR=new md(w_.BINDING,1,1,63),F_.LAYOUT=new Zl(0,w_.BINDING,w_.NAME,[new Jl("cc_matLightView",25,1),new Jl("cc_matLightViewProj",25,1),new Jl("cc_shadowInvProjDepthInfo",16,1),new Jl("cc_shadowProjDepthInfo",16,1),new Jl("cc_shadowProjInfo",16,1),new Jl("cc_shadowNFLSInfo",16,1),new Jl("cc_shadowWHPBInfo",16,1),new Jl("cc_shadowLPNNInfo",16,1),new Jl("cc_shadowColor",16,1),new Jl("cc_planarNDInfo",16,1)],1),N_.layouts[F_.NAME]=F_.LAYOUT,N_.bindings[F_.BINDING]=F_.DESCRIPTOR;var U_=function(){};g_=U_,U_.CSM_LEVEL_COUNT=4,U_.CSM_VIEW_DIR_0_OFFSET=0,U_.CSM_VIEW_DIR_1_OFFSET=16,U_.CSM_VIEW_DIR_2_OFFSET=32,U_.CSM_ATLAS_OFFSET=48,U_.MAT_CSM_VIEW_PROJ_OFFSET=64,U_.CSM_PROJ_DEPTH_INFO_OFFSET=128,U_.CSM_PROJ_INFO_OFFSET=144,U_.CSM_SPLITS_INFO_OFFSET=160,U_.COUNT=164,U_.SIZE=656,U_.NAME="CCCSM",U_.BINDING=3,U_.DESCRIPTOR=new md(g_.BINDING,1,1,16),U_.LAYOUT=new Zl(0,g_.BINDING,g_.NAME,[new Jl("cc_csmViewDir0",16,g_.CSM_LEVEL_COUNT),new Jl("cc_csmViewDir1",16,g_.CSM_LEVEL_COUNT),new Jl("cc_csmViewDir2",16,g_.CSM_LEVEL_COUNT),new Jl("cc_csmAtlas",16,g_.CSM_LEVEL_COUNT),new Jl("cc_matCSMViewProj",25,g_.CSM_LEVEL_COUNT),new Jl("cc_csmProjDepthInfo",16,g_.CSM_LEVEL_COUNT),new Jl("cc_csmProjInfo",16,g_.CSM_LEVEL_COUNT),new Jl("cc_csmSplitsInfo",16,1)],1),N_.layouts[U_.NAME]=U_.LAYOUT,N_.bindings[U_.BINDING]=U_.DESCRIPTOR;var x_="cc_shadowMap",G_=new md(4,16,1,16),j_=new td(0,4,x_,28,1);N_.layouts[x_]=j_,N_.bindings[4]=G_;var H_="cc_environment",V_=new md(5,16,1,16),$_=new td(0,5,H_,31,1);N_.layouts[H_]=$_,N_.bindings[5]=V_;var z_="cc_diffuseMap",W_=new md(7,16,1,16),X_=new td(0,7,z_,31,1);N_.layouts[z_]=X_,N_.bindings[7]=W_;var Y_="cc_spotShadowMap",K_=new md(6,16,1,16),q_=new td(0,6,Y_,28,1);N_.layouts[Y_]=q_,N_.bindings[6]=K_;var Q_=function(){};p_=Q_,Q_.MAT_WORLD_OFFSET=0,Q_.MAT_WORLD_IT_OFFSET=16,Q_.LIGHTINGMAP_UVPARAM=32,Q_.LOCAL_SHADOW_BIAS=36,Q_.REFLECTION_PROBE_DATA1=40,Q_.REFLECTION_PROBE_DATA2=44,Q_.REFLECTION_PROBE_BLEND_DATA1=48,Q_.REFLECTION_PROBE_BLEND_DATA2=52,Q_.COUNT=56,Q_.SIZE=224,Q_.NAME="CCLocal",Q_.BINDING=0,Q_.DESCRIPTOR=new md(0,1,1,49,1,1),Q_.LAYOUT=new Zl(2,0,p_.NAME,[new Jl("cc_matWorld",25,1),new Jl("cc_matWorldIT",25,1),new Jl("cc_lightingMapUVParam",16,1),new Jl("cc_localShadowBias",16,1),new Jl("cc_reflectionProbeData1",16,1),new Jl("cc_reflectionProbeData2",16,1),new Jl("cc_reflectionProbeBlendData1",16,1),new Jl("cc_reflectionProbeBlendData2",16,1)],1),P_.layouts[Q_.NAME]=Q_.LAYOUT,P_.bindings[0]=Q_.DESCRIPTOR;var J_=function(){};__=J_,J_.WORLD_BOUND_CENTER=0,J_.WORLD_BOUND_HALF_EXTENTS=__.WORLD_BOUND_CENTER+4,J_.COUNT=__.WORLD_BOUND_HALF_EXTENTS+4,J_.SIZE=4*__.COUNT,J_.NAME="CCWorldBound",J_.BINDING=0,J_.DESCRIPTOR=new md(__.BINDING,1,1,33,1,1),J_.LAYOUT=new Zl(2,__.BINDING,__.NAME,[new Jl("cc_worldBoundCenter",16,1),new Jl("cc_worldBoundHalfExtents",16,1)],1),P_.layouts[J_.NAME]=J_.LAYOUT,P_.bindings[J_.BINDING]=J_.DESCRIPTOR;var Z_="a_matWorld0",ty="a_sh_linear_const_r",iy=function(){};y_=iy,iy.BATCHING_COUNT=10,iy.MAT_WORLDS_OFFSET=0,iy.COUNT=16*y_.BATCHING_COUNT,iy.SIZE=4*y_.COUNT,iy.NAME="CCLocalBatched",iy.BINDING=0,iy.DESCRIPTOR=new md(y_.BINDING,1,1,33,1,1),iy.LAYOUT=new Zl(2,y_.BINDING,y_.NAME,[new Jl("cc_matWorlds",25,y_.BATCHING_COUNT)],1),P_.layouts[iy.NAME]=iy.LAYOUT,P_.bindings[iy.BINDING]=iy.DESCRIPTOR;var ny=function(){};m_=ny,ny.LIGHTS_PER_PASS=1,ny.LIGHT_POS_OFFSET=0,ny.LIGHT_COLOR_OFFSET=4,ny.LIGHT_SIZE_RANGE_ANGLE_OFFSET=8,ny.LIGHT_DIR_OFFSET=12,ny.LIGHT_BOUNDING_SIZE_VS_OFFSET=16,ny.COUNT=20,ny.SIZE=80,ny.NAME="CCForwardLight",ny.BINDING=1,ny.DESCRIPTOR=new md(m_.BINDING,2,1,16,1,1),ny.LAYOUT=new Zl(2,m_.BINDING,m_.NAME,[new Jl("cc_lightPos",16,1),new Jl("cc_lightColor",16,1),new Jl("cc_lightSizeRangeAngle",16,1),new Jl("cc_lightDir",16,1),new Jl("cc_lightBoundingSizeVS",16,1)],1),P_.layouts[ny.NAME]=ny.LAYOUT,P_.bindings[ny.BINDING]=ny.DESCRIPTOR;var ry=function(){};ry.LIGHTS_PER_PASS=10;var sy=function(){};b_=sy,sy.JOINTS_TEXTURE_INFO_OFFSET=0,sy.COUNT=b_.JOINTS_TEXTURE_INFO_OFFSET+4,sy.SIZE=4*b_.COUNT,sy.NAME="CCSkinningTexture",sy.BINDING=3,sy.DESCRIPTOR=new md(b_.BINDING,1,1,1,1,1),sy.LAYOUT=new Zl(2,b_.BINDING,b_.NAME,[new Jl("cc_jointTextureInfo",16,1)],1),P_.layouts[sy.NAME]=sy.LAYOUT,P_.bindings[sy.BINDING]=sy.DESCRIPTOR;var ey=function(){};k_=ey,ey.JOINTS_ANIM_INFO_OFFSET=0,ey.COUNT=k_.JOINTS_ANIM_INFO_OFFSET+4,ey.SIZE=4*k_.COUNT,ey.NAME="CCSkinningAnimation",ey.BINDING=2,ey.DESCRIPTOR=new md(k_.BINDING,1,1,1,1,1),ey.LAYOUT=new Zl(2,k_.BINDING,k_.NAME,[new Jl("cc_jointAnimInfo",16,1)],1),P_.layouts[ey.NAME]=ey.LAYOUT,P_.bindings[ey.BINDING]=ey.DESCRIPTOR;var hy="a_jointAnimInfo",uy=function(){function t(){}return t.initLayout=function(i){t.Ne=i,t.nt=12*i,t.dn=4*t.nt,t.LAYOUT.members[0].count=3*i},r(t,null,[{key:"JOINT_UNIFORM_CAPACITY",get:function(){return t.Ne}},{key:"COUNT",get:function(){return t.nt}},{key:"SIZE",get:function(){return t.dn}}]),t}();function oy(t){uy.initLayout(t),P_.layouts[uy.NAME]=uy.LAYOUT,P_.bindings[uy.BINDING]=uy.DESCRIPTOR}A_=uy,uy.Ne=0,uy.nt=0,uy.dn=0,uy.NAME="CCSkinning",uy.BINDING=3,uy.DESCRIPTOR=new md(A_.BINDING,1,1,1,1,1),uy.LAYOUT=new Zl(2,A_.BINDING,A_.NAME,[new Jl("cc_joints",16,1)],1);var cy=function(){};E_=cy,cy.MAX_MORPH_TARGET_COUNT=60,cy.OFFSET_OF_WEIGHTS=0,cy.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=240,cy.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=244,cy.OFFSET_OF_VERTICES_COUNT=248,cy.COUNT_BASE_4_BYTES=64,cy.SIZE=256,cy.NAME="CCMorph",cy.BINDING=4,cy.DESCRIPTOR=new md(E_.BINDING,1,1,1,1,1),cy.LAYOUT=new Zl(2,E_.BINDING,E_.NAME,[new Jl("cc_displacementWeights",16,15),new Jl("cc_displacementTextureInfo",16,1)],1),P_.layouts[cy.NAME]=cy.LAYOUT,P_.bindings[cy.BINDING]=cy.DESCRIPTOR;var ay=function(){};T_=ay,ay.NAME="CCUILocal",ay.BINDING=5,ay.DESCRIPTOR=new md(T_.BINDING,2,1,1,1,1),ay.LAYOUT=new Zl(2,T_.BINDING,T_.NAME,[new Jl("cc_local_data",16,1)],1),P_.layouts[ay.NAME]=ay.LAYOUT,P_.bindings[ay.BINDING]=ay.DESCRIPTOR;var fy=function(){};O_=fy,fy.SH_LINEAR_CONST_R_OFFSET=0,fy.SH_LINEAR_CONST_G_OFFSET=4,fy.SH_LINEAR_CONST_B_OFFSET=8,fy.SH_QUADRATIC_R_OFFSET=12,fy.SH_QUADRATIC_G_OFFSET=16,fy.SH_QUADRATIC_B_OFFSET=20,fy.SH_QUADRATIC_A_OFFSET=24,fy.COUNT=28,fy.SIZE=112,fy.NAME="CCSH",fy.BINDING=6,fy.DESCRIPTOR=new md(6,1,1,16,1,1),fy.LAYOUT=new Zl(2,6,O_.NAME,[new Jl("cc_sh_linear_const_r",16,1),new Jl("cc_sh_linear_const_g",16,1),new Jl("cc_sh_linear_const_b",16,1),new Jl("cc_sh_quadratic_r",16,1),new Jl("cc_sh_quadratic_g",16,1),new Jl("cc_sh_quadratic_b",16,1),new Jl("cc_sh_quadratic_a",16,1)],1),P_.layouts[fy.NAME]=fy.LAYOUT,P_.bindings[6]=fy.DESCRIPTOR;var vy="cc_jointTexture",ly=new md(7,16,1,1,1,4),dy=new td(2,7,vy,28,1);P_.layouts[vy]=dy,P_.bindings[7]=ly;var wy="cc_realtimeJoint",gy=new md(7,16,1,1,1,4),py=new td(2,7,wy,28,1);P_.layouts[wy]=py,P_.bindings[7]=gy;var _y="cc_PositionDisplacements",yy=new md(8,16,1,1,1,4),my=new td(2,8,_y,28,1);P_.layouts[_y]=my,P_.bindings[8]=yy;var by="cc_NormalDisplacements",ky=new md(9,16,1,1,1,4),Ay=new td(2,9,by,28,1);P_.layouts[by]=Ay,P_.bindings[9]=ky;var Ey="cc_TangentDisplacements",Ty=new md(10,16,1,1,1,4),Oy=new td(2,10,Ey,28,1);P_.layouts[Ey]=Oy,P_.bindings[10]=Ty;var Sy="cc_lightingMap",Iy=11,Ry=new md(Iy,16,1,16,1,4),My=new td(2,Iy,Sy,28,1);P_.layouts[Sy]=My,P_.bindings[11]=Ry;var Cy="cc_spriteTexture",Ny=new md(12,16,1,16,1,4),Py=new td(2,12,Cy,28,1);P_.layouts[Cy]=Py,P_.bindings[12]=Ny;var Ly="cc_reflectionProbeCubemap",Dy=13,By=new md(Dy,16,1,16,1,9),Fy=new td(2,Dy,Ly,31,1);P_.layouts[Ly]=Fy,P_.bindings[13]=By;var Uy="cc_reflectionProbePlanarMap",xy=14,Gy=new md(xy,16,1,16,1,4),jy=new td(2,xy,Uy,28,1);P_.layouts[Uy]=jy,P_.bindings[14]=Gy;var Hy="cc_reflectionProbeDataMap",Vy=new md(15,16,1,16,1,4),$y=new td(2,15,Hy,28,1);P_.layouts[Hy]=$y,P_.bindings[15]=Vy,new md(16,16,1,16,1,9),new td(2,16,"cc_reflectionProbeBlendCubemap",31,1);var zy,Wy,Xy,Yy,Ky=M_.makeMaskExclude([M_.BitMask.UI_2D,M_.BitMask.GIZMOS,M_.BitMask.EDITOR,M_.BitMask.SCENE_GIZMO,M_.BitMask.PROFILER]),qy=M_.makeMaskExclude([M_.BitMask.UI_2D,M_.BitMask.PROFILER]),Qy=M_.Enum.ALL;function Jy(t){if(zy)return zy;var i=new Kl(1,0,Zy(t)?11:35,16,16,0,1,1,1,1);return zy=t.createTexture(i)}function Zy(t){return!(3&~t.getFormatFeatures(11)||6===t.gfxAPI)}function tm(t){return!(3&~t.getFormatFeatures(41))}function im(){return!(!T.rendering||!T.rendering.enableEffectImport)}function nm(){return new Ge((function(){return{priority:0,hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64)}t("cO",Object.freeze({__proto__:null,CAMERA_DEFAULT_MASK:Ky,CAMERA_EDITOR_MASK:qy,ENABLE_PROBE_BLEND:!1,INST_JOINT_ANIM_INFO:hy,INST_MAT_WORLD:Z_,INST_SH:ty,JOINT_UNIFORM_CAPACITY:30,MODEL_ALWAYS_MASK:Qy,ModelLocalBindings:{UBO_LOCAL:0,UBO_FORWARD_LIGHTS:1,UBO_SKINNING_ANIMATION:2,UBO_SKINNING_TEXTURE:3,UBO_MORPH:4,UBO_UI_LOCAL:5,UBO_SH:6,SAMPLER_JOINTS:7,SAMPLER_MORPH_POSITION:8,SAMPLER_MORPH_NORMAL:9,SAMPLER_MORPH_TANGENT:10,SAMPLER_LIGHTMAP:11,SAMPLER_SPRITE:12,SAMPLER_REFLECTION_PROBE_CUBE:13,SAMPLER_REFLECTION_PROBE_PLANAR:14,SAMPLER_REFLECTION_PROBE_DATA_MAP:15,COUNT:16},PIPELINE_FLOW_FORWARD:"ForwardFlow",PIPELINE_FLOW_MAIN:"MainFlow",PIPELINE_FLOW_SHADOW:"ShadowFlow",PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",PipelineGlobalBindings:{UBO_GLOBAL:0,UBO_CAMERA:1,UBO_SHADOW:2,UBO_CSM:3,SAMPLER_SHADOWMAP:4,SAMPLER_ENVIRONMENT:5,SAMPLER_SPOT_SHADOW_MAP:6,SAMPLER_DIFFUSEMAP:7,COUNT:8},RenderPassStage:C_,RenderPriority:{MIN:0,MAX:255,DEFAULT:128},SetIndex:{GLOBAL:0,MATERIAL:1,LOCAL:2,COUNT:3},UBOCSM:U_,UBOCSMEnum:{CSM_LEVEL_COUNT:4,CSM_VIEW_DIR_0_OFFSET:0,CSM_VIEW_DIR_1_OFFSET:16,CSM_VIEW_DIR_2_OFFSET:32,CSM_ATLAS_OFFSET:48,MAT_CSM_VIEW_PROJ_OFFSET:64,CSM_PROJ_DEPTH_INFO_OFFSET:128,CSM_PROJ_INFO_OFFSET:144,CSM_SPLITS_INFO_OFFSET:160,COUNT:164,SIZE:656},UBOCamera:B_,UBOCameraEnum:{MAT_VIEW_OFFSET:0,MAT_VIEW_INV_OFFSET:16,MAT_PROJ_OFFSET:32,MAT_PROJ_INV_OFFSET:48,MAT_VIEW_PROJ_OFFSET:64,MAT_VIEW_PROJ_INV_OFFSET:80,CAMERA_POS_OFFSET:96,SURFACE_TRANSFORM_OFFSET:100,SCREEN_SCALE_OFFSET:104,EXPOSURE_OFFSET:108,MAIN_LIT_DIR_OFFSET:112,MAIN_LIT_COLOR_OFFSET:116,AMBIENT_SKY_OFFSET:120,AMBIENT_GROUND_OFFSET:124,GLOBAL_FOG_COLOR_OFFSET:128,GLOBAL_FOG_BASE_OFFSET:132,GLOBAL_FOG_ADD_OFFSET:136,NEAR_FAR_OFFSET:140,VIEW_PORT_OFFSET:144,COUNT:148,SIZE:592},UBODeferredLight:ry,UBOForwardLight:ny,UBOForwardLightEnum:{LIGHTS_PER_PASS:1,LIGHT_POS_OFFSET:0,LIGHT_COLOR_OFFSET:4,LIGHT_SIZE_RANGE_ANGLE_OFFSET:8,LIGHT_DIR_OFFSET:12,LIGHT_BOUNDING_SIZE_VS_OFFSET:16,COUNT:20,SIZE:80},UBOGlobal:D_,UBOGlobalEnum:{TIME_OFFSET:0,SCREEN_SIZE_OFFSET:4,NATIVE_SIZE_OFFSET:8,PROBE_INFO_OFFSET:12,DEBUG_VIEW_MODE_OFFSET:16,COUNT:20,SIZE:80},UBOLocal:Q_,UBOLocalBatched:iy,UBOLocalEnum:{MAT_WORLD_OFFSET:0,MAT_WORLD_IT_OFFSET:16,LIGHTINGMAP_UVPARAM:32,LOCAL_SHADOW_BIAS:36,REFLECTION_PROBE_DATA1:40,REFLECTION_PROBE_DATA2:44,REFLECTION_PROBE_BLEND_DATA1:48,REFLECTION_PROBE_BLEND_DATA2:52,COUNT:56,SIZE:224,BINDING:0},UBOMorph:cy,UBOMorphEnum:{MAX_MORPH_TARGET_COUNT:60,OFFSET_OF_WEIGHTS:0,OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH:240,OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT:244,OFFSET_OF_VERTICES_COUNT:248,COUNT_BASE_4_BYTES:64,SIZE:256},UBOSH:fy,UBOSHEnum:{SH_LINEAR_CONST_R_OFFSET:0,SH_LINEAR_CONST_G_OFFSET:4,SH_LINEAR_CONST_B_OFFSET:8,SH_QUADRATIC_R_OFFSET:12,SH_QUADRATIC_G_OFFSET:16,SH_QUADRATIC_B_OFFSET:20,SH_QUADRATIC_A_OFFSET:24,COUNT:28,SIZE:112,BINDING:6},UBOShadow:F_,UBOShadowEnum:{MAT_LIGHT_VIEW_OFFSET:0,MAT_LIGHT_VIEW_PROJ_OFFSET:16,SHADOW_INV_PROJ_DEPTH_INFO_OFFSET:32,SHADOW_PROJ_DEPTH_INFO_OFFSET:36,SHADOW_PROJ_INFO_OFFSET:40,SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET:44,SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET:48,SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET:52,SHADOW_COLOR_OFFSET:56,PLANAR_NORMAL_DISTANCE_INFO_OFFSET:60,COUNT:64,SIZE:256},UBOSkinning:uy,UBOSkinningAnimation:ey,UBOSkinningTexture:sy,UBOUILocal:ay,UBOWorldBound:J_,UNIFORM_DIFFUSEMAP_BINDING:7,UNIFORM_ENVIRONMENT_BINDING:5,UNIFORM_JOINT_TEXTURE_BINDING:7,UNIFORM_LIGHTMAP_TEXTURE_BINDING:Iy,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:9,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:8,UNIFORM_REALTIME_JOINT_TEXTURE_BINDING:7,UNIFORM_REFLECTION_PROBE_BLEND_CUBEMAP_BINDING:16,UNIFORM_REFLECTION_PROBE_CUBEMAP_BINDING:Dy,UNIFORM_REFLECTION_PROBE_DATA_MAP_BINDING:15,UNIFORM_REFLECTION_PROBE_TEXTURE_BINDING:xy,UNIFORM_SHADOWMAP_BINDING:4,UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING:6,UNIFORM_SPRITE_TEXTURE_BINDING:12,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:10,bindingMappingInfo:L_,getDefaultShadowTexture:Jy,getPassPool:nm,globalDescriptorSetLayout:N_,isEnableEffect:im,localDescriptorSetLayout:P_,localDescriptorSetLayout_ResizeMaxJoints:oy,supportsR16HalfFloatTexture:function(t){return!(3&~t.getFormatFeatures(8))},supportsR32FloatTexture:Zy,supportsRGBA16HalfFloatTexture:tm,supportsRGBA32FloatTexture:function(t){return!(3&~t.getFormatFeatures(44))}}));var rm=4227858432,sm=66060288,em=1044480,hm=function(t,i,n,r){return void 0===r&&(r=0),i<<26&rm|t<<20&sm|n<<12&em|4095&r},um=function(t){return(t&rm)>>>26},om=function(t){return(t&sm)>>>20},cm=function(t){return(t&em)>>>12},am=function(t){return 4095&t},fm=function(t,i){return 67108863&t|i<<26&rm},vm=((Wy={})[0]=function(t,i,n){return void 0===n&&(n=0),st(12010,n)},Wy[5]=function(t,i,n){return void 0===n&&(n=0),t[n]},Wy[6]=function(t,i,n){return void 0===n&&(n=0),Ms.fromArray(i,t,n)},Wy[7]=function(t,i,n){return void 0===n&&(n=0),Ir.fromArray(i,t,n)},Wy[8]=function(t,i,n){return void 0===n&&(n=0),$s.fromArray(i,t,n)},Wy[13]=function(t,i,n){return void 0===n&&(n=0),t[n]},Wy[14]=function(t,i,n){return void 0===n&&(n=0),Ms.fromArray(i,t,n)},Wy[15]=function(t,i,n){return void 0===n&&(n=0),Ir.fromArray(i,t,n)},Wy[16]=function(t,i,n){return void 0===n&&(n=0),$s.fromArray(i,t,n)},Wy[21]=function(t,i,n){return void 0===n&&(n=0),Dr.fromArray(i,t,n)},Wy[25]=function(t,i,n){return void 0===n&&(n=0),ls.fromArray(i,t,n)},Wy),lm=((Xy={})[0]=function(t,i,n){return void 0===n&&(n=0),st(12010,n)},Xy[5]=function(t,i,n){return void 0===n&&(n=0),t[n]=i},Xy[6]=function(t,i,n){return void 0===n&&(n=0),Ms.toArray(t,i,n)},Xy[7]=function(t,i,n){return void 0===n&&(n=0),Ir.toArray(t,i,n)},Xy[8]=function(t,i,n){return void 0===n&&(n=0),$s.toArray(t,i,n)},Xy[13]=function(t,i,n){return void 0===n&&(n=0),t[n]=i},Xy[14]=function(t,i,n){return void 0===n&&(n=0),Ms.toArray(t,i,n)},Xy[15]=function(t,i,n){return void 0===n&&(n=0),Ir.toArray(t,i,n)},Xy[16]=function(t,i,n){return void 0===n&&(n=0),$s.toArray(t,i,n)},Xy[21]=function(t,i,n){return void 0===n&&(n=0),Dr.toArray(t,i,n)},Xy[25]=function(t,i,n){return void 0===n&&(n=0),ls.toArray(t,i,n)},Xy),dm=((Yy={})[5]=function(t){return"number"==typeof t},Yy[13]=function(t){return"number"==typeof t},Yy[6]=function(t){return!!(t instanceof Ms)},Yy[14]=function(t){return!!(t instanceof Ms)},Yy[7]=function(t){return!!(t instanceof Ir)},Yy[15]=function(t){return!!(t instanceof Ir)},Yy[8]=function(t){return!!(t instanceof $s)},Yy[16]=function(t){return!!(t instanceof $s||t instanceof Qs||t instanceof Qr)},Yy[21]=function(t){return!!(t instanceof Dr)},Yy[25]=function(t){return!!(t instanceof ls)},Yy),wm=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function gm(t){switch(t){case 1:case 5:case 9:case 13:return wm[0];case 2:case 6:case 10:case 14:return wm[1];case 4:case 8:case 12:case 16:return wm[2];case 25:return wm[3];case 28:return"default-texture";case 31:return"default-cube-texture";case 29:return"default-array-texture";case 30:return"default-3d-texture"}return wm[0]}function pm(t){switch(t){case 28:return"-texture";case 31:return"-cube-texture";case 29:return"-array-texture";case 30:return"-3d-texture";default:return"-unknown"}}function _m(t,i){for(var n=Object.entries(i),r=!1,s=0;s<n.length;s++)t[n[s][0]]!==n[s][1]&&(t[n[s][0]]=n[s][1],r=!0);return r}function ym(t,i){switch(t.type){case"boolean":return"number"==typeof i?i.toString():i?"1":"0";case"string":return void 0!==i?i:t.options[0];case"number":return void 0!==i?i.toString():t.range[0].toString();default:return st(16369),"-1"}}function mm(t,i){for(var n=[],r=0;r<i.length;r++){var s=i[r],e=s.name,h=t[e],u=ym(s,h),o=!h||"0"===h;n.push({name:e,value:u,isDefault:o})}return n}function bm(t,i){return t+i.reduce((function(t,i){return i.isDefault?t:t+"|"+i.name+i.value}),"")}function km(t,i){for(var n=0;n<t.length;n++){var r=t[n];if("!"===r[0]){if(i[r.slice(1)])return!1}else if(!i[r])return!1}return!0}function Am(t,i,n){for(var r=[],s=t.attributes,e=0;e<s.length;e++)km(s[e].defines,n)&&r.push(i[e]);return r}function Em(t,i){var n=t.defines;if(t.uber){for(var r="",s=0;s<n.length;s++){var e=n[s],h=i[e.name];if(h&&e._map){var u=e._map(h);r+=""+e._offset+u+"|"}}return""+r+t.hash}for(var o=0,c=0;c<n.length;c++){var a=n[c],f=i[a.name];f&&a._map&&(o|=a._map(f)<<a._offset)}return o.toString(16)+"|"+t.hash}var Tm=new Map;function Om(t,i){if(i.count)return t+zd(i.type)*i.count;var n=Tm.get(i.name);return void 0!==n?t+zd(i.type)*n:(ht(16345,i.name),t)}function Sm(t){return t.reduce(Om,0)}function Im(t){for(var i={},n=0;n<t.blocks.length;n++)for(var r=t.blocks[n],s=r.members,e=0,h=0;h<s.length;h++){var u=s[h];i[u.name]=hm(r.binding,u.type,u.count,e),e+=(zd(u.type)>>2)*u.count}for(var o=0;o<t.samplerTextures.length;o++){var c=t.samplerTextures[o];i[c.name]=hm(c.binding,c.type,c.count)}return i}function Rm(t){return Math.ceil(Math.log2(Math.max(t,2)))}function Mm(t){for(var i=0,n=function(){var n=t.defines[r],s=1;if("number"===n.type){var e=n.range;s=Rm(e[1]-e[0]+1),n._map=function(t){return t-e[0]}}else"string"===n.type?(s=Rm(n.options.length),n._map=function(t){return Math.max(0,n.options.findIndex((function(i){return i===t})))}):"boolean"===n.type&&(n._map=function(t){return t?1:0});n._offset=i,i+=s},r=0;r<t.defines.length;r++)n();for(var s in i>31&&(t.uber=!0),t.constantMacros="",t.builtins.statistics)t.constantMacros+="#define "+s+" "+t.builtins.statistics[s]+"\n"}function Cm(t){var i=Object.keys(t).reduce((function(i,n){return i.reduce((function(i,r){for(var e=t[n],h=0;h<e.length;++h){var u=s({},r);u[n]=e[h],i.push(u)}return i}),[])}),[{}]);return i}function Nm(t){for(var i=0;i<t.techniques.length;i++)for(var n=t.techniques[i],r=0;r<n.passes.length;r++){var s=n.passes[r];void 0!==s.propertyIndex&&void 0===s.properties&&(s.properties=n.passes[s.propertyIndex].properties)}}Tm.set("cc_joints",uy.LAYOUT.members[0].count),Tm.set("cc_lightPos",1),Tm.set("cc_lightColor",1),Tm.set("cc_lightSizeRangeAngle",1),Tm.set("cc_lightDir",1),Tm.set("cc_lightBoundingSizeVS",1);var Pm=new bd;function Lm(t,i,n,r){for(var s=t.builtins[r],e=[],h=function(){var t=s.blocks[u],i=n.layouts[t.name],r=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&r&&r.descriptorType&Ud))return st(16348,t.name),1;e.push(i)},u=0;u<s.blocks.length;u++)h();Array.prototype.unshift.apply(i.shaderInfo.blocks,e);for(var o=[],c=function(){var t=s.samplerTextures[a],i=n.layouts[t.name],r=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&r&&r.descriptorType&xd))return st(16349,t.name),1;o.push(i)},a=0;a<s.samplerTextures.length;a++)c();Array.prototype.unshift.apply(i.shaderInfo.samplerTextures,o)}var Dm=function(){function t(){this._templates={},this._cache={},this._templateInfos={}}var i=t.prototype;return i.register=function(t){for(var i=0;i<t.shaders.length;i++)this.define(t.shaders[i]).effectName=t.name;for(var n=0;n<t.techniques.length;n++)for(var r=t.techniques[n],s=0;s<r.passes.length;s++){var e=r.passes[s];void 0!==e.propertyIndex&&void 0===e.properties&&(e.properties=r.passes[e.propertyIndex].properties)}},i.define=function(t){var i=this._templates[t.name];if(i&&i.hash===t.hash)return i;var n=s({},t);if(Mm(n),this._templates[t.name]=n,!this._templateInfos[n.hash]){var r={};r.samplerStartBinding=n.blocks.length,r.shaderInfo=new od,r.blockSizes=[],r.bindings=[];for(var e=0;e<n.blocks.length;e++){var h=n.blocks[e];r.blockSizes.push(Sm(h.members)),r.bindings.push(new md(h.binding,1,1,h.stageFlags)),r.shaderInfo.blocks.push(new Zl(1,h.binding,h.name,h.members.map((function(t){return new Jl(t.name,t.type,t.count)})),1))}for(var u=0;u<n.samplerTextures.length;u++){var o=n.samplerTextures[u];r.bindings.push(new md(o.binding,16,o.count,o.stageFlags)),r.shaderInfo.samplerTextures.push(new td(1,o.binding,o.name,o.type,o.count))}for(var c=0;c<n.samplers.length;c++){var a=n.samplers[c];r.bindings.push(new md(a.binding,32,a.count,a.stageFlags)),r.shaderInfo.samplers.push(new id(1,a.binding,a.name,a.count))}for(var f=0;f<n.textures.length;f++){var v=n.textures[f];r.bindings.push(new md(v.binding,64,v.count,v.stageFlags)),r.shaderInfo.textures.push(new nd(1,v.binding,v.name,v.type,v.count))}for(var l=0;l<n.buffers.length;l++){var d=n.buffers[l];r.bindings.push(new md(d.binding,4,1,d.stageFlags)),r.shaderInfo.buffers.push(new sd(1,d.binding,d.name,1,d.memoryAccess))}for(var w=0;w<n.images.length;w++){var g=n.images[w];r.bindings.push(new md(g.binding,128,g.count,g.stageFlags)),r.shaderInfo.images.push(new rd(1,g.binding,g.name,g.type,g.count,g.memoryAccess))}for(var p=0;p<n.subpassInputs.length;p++){var _=n.subpassInputs[p];r.bindings.push(new md(_.binding,256,_.count,_.stageFlags)),r.shaderInfo.subpassInputs.push(new ed(1,_.binding,_.name,_.count))}r.gfxAttributes=[];for(var y=0;y<n.attributes.length;y++){var m=n.attributes[y];r.gfxAttributes.push(new ud(m.name,m.format,m.isNormalized,0,m.isInstanced,m.location))}Lm(n,r,P_,"locals"),r.shaderInfo.stages.push(new hd(1,"")),r.shaderInfo.stages.push(new hd(16,"")),r.handleMap=Im(n),r.setLayouts=[],this._templateInfos[n.hash]=r}return n},i.getTemplate=function(t){return this._templates[t]},i.getTemplateInfo=function(t){var i=this._templates[t].hash;return this._templateInfos[i]},i.getDescriptorSetLayout=function(t,i,n){void 0===n&&(n=!1);var r=this._templates[i],s=this._templateInfos[r.hash];return s.setLayouts.length||(Pm.bindings=s.bindings,s.setLayouts[1]=t.createDescriptorSetLayout(Pm),Pm.bindings=P_.bindings,s.setLayouts[2]=t.createDescriptorSetLayout(Pm)),s.setLayouts[n?2:1]},i.hasProgram=function(t){return void 0!==this._templates[t]},i.getKey=function(t,i){return Em(this._templates[t],i)},i.destroyShaderByDefines=function(t){var i=this,n=Object.keys(t);if(n.length)for(var r=n.map((function(i){var n=t[i];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+i+n)})),s=Object.keys(this._cache).filter((function(t){return r.every((function(n){return n.test(i._cache[t].name)}))})),e=0;e<s.length;e++){var h=s[e],u=this._cache[h];K("destroyed shader "+u.name),u.destroy(),delete this._cache[h]}},i.getGFXShader=function(t,i,n,r,s){Object.assign(n,r.macros),s||(s=this.getKey(i,n));var e=this._cache[s];if(e)return e;var h=this._templates[i],u=this._templateInfos[h.hash];u.pipelineLayout||(this.getDescriptorSetLayout(t,i),Lm(h,u,N_,"globals"),u.setLayouts[0]=r.descriptorSetLayout,u.pipelineLayout=t.createPipelineLayout(new Ad(u.setLayouts)));var o=mm(n,h.defines),c=r.constantMacros+h.constantMacros+o.reduce((function(t,i){return t+"#define "+i.name+" "+i.value+"\n"}),""),a=h.glsl3,f=Bm(t);f?a=h[f]:ht(16346),u.shaderInfo.stages[0].source=c+a.vert,u.shaderInfo.stages[1].source=c+a.frag,u.shaderInfo.attributes=Am(h,u.gfxAttributes,n),u.shaderInfo.name=bm(i,o);var v=u.shaderInfo;return this._cache[s]=t.createShader(v)},t}();function Bm(t){switch(t.gfxAPI){case 1:case 6:return"glsl1";case 2:case 7:return"glsl3";default:return"glsl4"}}var Fm,Um,xm,Gm,jm,Hm,Vm,$m=new Dm;T.programLib=$m;var zm,Wm,Xm,Ym,Km,qm,Qm,Jm=["planar-shadow","skybox","deferred-lighting","bloom","hbao","copy-pass","post-process","profiler","splash-screen","unlit","sprite","particle","particle-gpu","particle-trail","billboard","terrain","graphics","clear-stencil","spine","occlusion-query","geometry-renderer","debug-renderer","ssss-blur","float-output-process"],Zm=t("dG",_o("cc.EffectAsset")((Vm=function(t){function i(i){var n;return(n=t.call(this,i)||this).techniques=xm&&xm(),n.shaders=Gm&&Gm(),n.combinations=jm&&jm(),n.hideInEditor=Hm&&Hm(),n}e(i,t),i.register=function(t){i.Pe[t.name]=t,i.Le=!1},i.remove=function(t){if("string"!=typeof t)i.Pe[t.name]&&i.Pe[t.name]===t&&delete i.Pe[t.name];else{if(i.Pe[t])return void delete i.Pe[t];for(var n in i.Pe)if(i.Pe[n]._uuid===t)return void delete i.Pe[n]}},i.get=function(t){if(i.Pe[t])return i.Pe[t];for(var n in i.Pe)if(i.Pe[n]._uuid===t)return i.Pe[n];return Jm.includes(t)&&st(16101,t),null},i.getAll=function(){return i.Pe},i.isLayoutValid=function(){return i.Le},i.setLayoutValid=function(){i.Le=!0};var n=i.prototype;return n.onLoaded=function(){if(T.rendering&&T.rendering.enableEffectImport){Nm(this);var t=T.rendering.programLib;t.addEffect(this),t.init(kw.gfxDevice)}else $m.register(this);i.register(this),T.game.once(T.Game.EVENT_RENDERER_INITED,this.De,this)},n.De=function(){var t=this;if(T.rendering&&T.rendering.enableEffectImport)T.rendering.programLib.precompileEffect(kw.gfxDevice,this);else for(var i=T.director.root,n=function(){var n=t.shaders[r],s=t.combinations[r];if(!s)return 1;Cm(s).forEach((function(t){return $m.getGFXShader(kw.gfxDevice,n.name,t,i.pipeline)}))},r=0;r<this.shaders.length;r++)n()},n.destroy=function(){return i.remove(this),t.prototype.destroy.call(this)},n.initDefault=function(n){t.prototype.initDefault.call(this,n);var r=i.get("builtin-unlit");this.name="builtin-unlit",this.shaders=r.shaders,this.combinations=r.combinations,this.techniques=r.techniques},n.validate=function(){return this.techniques.length>0&&this.shaders.length>0},i}(rg),Vm.Pe={},Vm.Le=!0,xm=uo((Um=Vm).prototype,"techniques",[Co],(function(){return[]})),Gm=uo(Um.prototype,"shaders",[Co],(function(){return[]})),jm=uo(Um.prototype,"combinations",[Co],(function(){return[]})),Hm=uo(Um.prototype,"hideInEditor",[Co,Po],(function(){return!1})),Fm=Um))||Fm);T.EffectAsset=Zm;var tb=t("dF",_o("cc.TextureCube")((Qm=function(t){function i(i){var n;return(n=t.call(this,i)||this).isRGBE=Xm&&Xm(),n._mipmapAtlas=Ym&&Ym(),n._mipmapMode=Km&&Km(),n._mipmaps=qm&&qm(),n.Te=[],n}e(i,t);var n=i.prototype;return n.Oe=function(t){var i=this;if(this.Te=t,this._e(this.Te.length),this.Te.length>0){var n=this.Te[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this.Te.length,baseLevel:this.fe,maxLevel:this.ve}),this.Te.forEach((function(t,n){ib(t,(function(t,r){i.we(t,n,r)}))}))}else this.reset({width:0,height:0,mipmapLevel:this.Te.length,baseLevel:this.fe,maxLevel:this.ve})},n.isUsingOfflineMipmaps=function(){return 2===this._mipmapMode},i.fromTexture2DArray=function(t,n){for(var r=[],s=t.length/6,e=0;e<s;e++){var h=6*e;r.push({front:t[h+4].image,back:t[h+5].image,left:t[h+1].image,right:t[h+0].image,top:t[h+2].image,bottom:t[h+3].image})}return(n=n||new i).mipmaps=r,n},n.onLoaded=function(){2===this._mipmapMode?this.mipmapAtlas=this._mipmapAtlas:this.mipmaps=this._mipmaps},n.reset=function(t){this.Xn=t.width,this.Yn=t.height,this._setGFXFormat(t.format);var i=void 0===t.mipmapLevel?1:t.mipmapLevel;this._e(i);var n=void 0===t.baseLevel?0:t.baseLevel,r=void 0===t.maxLevel?1e3:t.maxLevel;this.ye(n,r),this.Ae()},n.updateMipmaps=function(t,i){var n=this;if(void 0===t&&(t=0),void 0===i&&(i=void 0),!(t>=this.Te.length))for(var r=Math.min(void 0===i?this.Te.length:i,this.Te.length-t),s=function(){var i=t+e;ib(n.Te[i],(function(t,r){n.we(t,i,r)}))},e=0;e<r;++e)s()},n.destroy=function(){return this._mipmaps=[],this.Te=[],this._mipmapAtlas=null,t.prototype.destroy.call(this)},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(i,n){var r=i;if(t.prototype._deserialize.call(this,r.base,n),this.isRGBE=r.rgbe,this._mipmapMode=r.mipmapMode,2===this._mipmapMode){var s=r.mipmapAtlas,e=r.mipmapLayout;this._mipmapAtlas={atlas:{},layout:e},this._mipmapAtlas.atlas={front:new mg,back:new mg,left:new mg,right:new mg,top:new mg,bottom:new mg};var h=ni(mg);n.result.push(this._mipmapAtlas.atlas,"front",s.front,h),n.result.push(this._mipmapAtlas.atlas,"back",s.back,h),n.result.push(this._mipmapAtlas.atlas,"left",s.left,h),n.result.push(this._mipmapAtlas.atlas,"right",s.right,h),n.result.push(this._mipmapAtlas.atlas,"top",s.top,h),n.result.push(this._mipmapAtlas.atlas,"bottom",s.bottom,h)}else{this._mipmaps=new Array(r.mipmaps.length);for(var u=0;u<r.mipmaps.length;++u){this._mipmaps[u]={front:new mg,back:new mg,left:new mg,right:new mg,top:new mg,bottom:new mg};var o=r.mipmaps[u],c=ni(mg);n.result.push(this._mipmaps[u],"front",o.front,c),n.result.push(this._mipmaps[u],"back",o.back,c),n.result.push(this._mipmaps[u],"left",o.left,c),n.result.push(this._mipmaps[u],"right",o.right,c),n.result.push(this._mipmaps[u],"top",o.top,c),n.result.push(this._mipmaps[u],"bottom",o.bottom,c)}}},n.be=function(t){var i=new Kl(3);return i.width=this.Xn,i.height=this.Yn,i.layerCount=6,Object.assign(i,t),i},n.ke=function(t){var i=new ql;return i.type=3,i.baseLayer=0,i.layerCount=6,Object.assign(i,t),i},n._uploadAtlas=function(){var t=this,i=this._mipmapAtlas.layout,n=i[0];this.reset({width:n.width,height:n.height,format:this._mipmapAtlas.atlas.front.format,mipmapLevel:i.length}),ib(this._mipmapAtlas.atlas,(function(n,r){var s=new f_;s.image=n,s.reset({width:n.width,height:n.height,format:n.format}),s.uploadData(n.data);for(var e=0;e<i.length;e++){var h=i[e],u=s.getGFXTexture().size,o=new Uint8Array(u),c=new Fl;c.texOffset.x=h.left,c.texOffset.y=h.top,c.texExtent.width=h.width,c.texExtent.height=h.height,t._getGFXDevice().copyTextureToBuffers(s.getGFXTexture(),[o],[c]);var a=new mg({_data:o,_compressed:n.isCompressed,width:h.width,height:h.height,format:n.format});t.we(a,h.level,r)}}))},n.initDefault=function(i){t.prototype.initDefault.call(this,i);var n=new mg;n.initDefault(),this.mipmaps=[{front:n,back:n,top:n,bottom:n,left:n,right:n}]},n.validate=function(){if(2===this._mipmapMode){if(null===this.mipmapAtlas||0===this.mipmapAtlas.layout.length)return!1;var t=this.mipmapAtlas.atlas;return!!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}return 0!==this._mipmaps.length&&!this._mipmaps.find((function(t){return!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}))},r(i,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){this._mipmaps=t;var i=[];if(1===t.length){var n=t[0],r=n.front.fs(),s=n.back.fs(),e=n.left.fs(),h=n.right.fs(),u=n.top.fs(),o=n.bottom.fs();if(r.length!==s.length||r.length!==e.length||r.length!==h.length||r.length!==u.length||r.length!==o.length)return ht(16347),void this.Oe([]);for(var c=r.length,a=0;a<c;++a){var f={front:r[a],back:s[a],left:e[a],right:h[a],top:u[a],bottom:o[a]};i.push(f)}}else t.length>1&&t.forEach((function(t){var n={front:t.front.us(),back:t.back.us(),left:t.left.us(),right:t.right.us(),top:t.top.us(),bottom:t.bottom.us()};i.push(n)}));this.Oe(i)}},{key:"mipmapAtlas",get:function(){return this._mipmapAtlas},set:function(t){var i=this;if(this._mipmapAtlas=t,this._mipmapAtlas){var n=this._mipmapAtlas.atlas.front;if(n.data){var r=this._mipmapAtlas.atlas,s=this._mipmapAtlas.layout,e=s[0],h=Object.assign(I.document.createElement("canvas"),{width:n.width,height:n.height}).getContext("2d");this.reset({width:e.width,height:e.height,format:n.format,mipmapLevel:s.length});for(var u=function(){var t=s[o];ib(r,(function(r,s){h.clearRect(0,0,n.width,n.height);var e=r.data;h.drawImage(e,0,0);var u=h.getImageData(t.left,t.top,t.width,t.height),o=new mg({_data:u.data,_compressed:r.isCompressed,width:u.width,height:u.height,format:r.format});i.we(o,t.level,s)}))},o=0;o<s.length;o++)u()}}else this.reset({width:0,height:0,mipmapLevel:0})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),i}(a_),Qm.FaceIndex={right:0,left:1,top:2,bottom:3,front:4,back:5},Xm=uo((Wm=Qm).prototype,"isRGBE",[Co],(function(){return!1})),Ym=uo(Wm.prototype,"_mipmapAtlas",[Co],(function(){return null})),Km=uo(Wm.prototype,"_mipmapMode",[Co],(function(){return 0})),qm=uo(Wm.prototype,"_mipmaps",[Co],(function(){return[]})),zm=Wm))||zm);function ib(t,i){i(t.front,4),i(t.back,5),i(t.left,1),i(t.right,0),i(t.top,2),i(t.bottom,3)}O.TextureCube=tb;var nb=function(t,i){return!(t.length>i.length)||47===t.charCodeAt(i.length)},rb=function(t){var i=t.uuids,n=t.paths,r=t.types,s=t.deps,e=t.paths=Object.create(null);if(!1===t.debug){for(var h=0,u=i.length;h<u;h++)i[h]=Hw(i[h]);for(var o in n){var c=n[o],a=c[1];c[1]=r[a]}}else{for(var f=Object.create(null),v=0,l=i.length;v<l;v++){var d=i[v];i[v]=f[d]=Hw(d)}i=f}for(var w in n){var g=n[w];e[i[w]]=g}var p=t.scenes;for(var _ in p){var y=p[_];p[_]=i[y]}var m=t.packs;for(var b in m)for(var k=m[b],A=0;A<k.length;++A)k[A]=i[k[A]];var E=t.versions;if(E)for(var T in E)for(var O=E[T],S=0;S<O.length;S+=2){var I=O[S];O[S]=i[I]||I}var R=t.redirect;if(R)for(var M=0;M<R.length;M+=2)R[M]=i[R[M]],R[M+1]=s[R[M+1]];if(t.extensionMap){var C=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return 1;t.extensionMap[n].forEach((function(r,s){t.extensionMap[n][s]=i[r]||r}))};for(var N in t.extensionMap)C(N)}},sb=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Ow,this.scenes=new Ow,this.paths=new Ow}var i=t.prototype;return i.init=function(t){var i=this;rb(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this.Be(t.uuids),this.Fe(t.paths),this.Ue(t.scenes),this.xe(t.packs,t.extensionMap[".cconb"]),this.Ge(t.versions),this.je(t.redirect);var n=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return 1;t.extensionMap[n].forEach((function(t){var r=i.assetInfos.get(t);r&&(r.extension=n)}))};for(var r in t.extensionMap)n(r)},i.getInfoWithPath=function(t,i){if(!t)return null;t=Ww(t);var n=this.paths.get(t);if(n){if(!i)return n[0];for(var r=0,s=n.length;r<s;r++){var e=n[r];if(Ht(e.ctor,i))return e}}return null},i.getDirWithPath=function(t,i,n){"/"===(t=Ww(t))[t.length-1]&&(t=t.slice(0,-1));var r=n||[];return this.paths.forEach((function(n,s){if(s.startsWith(t)&&nb(s,t)||!t)for(var e=0,h=n.length;e<h;e++){var u=n[e];i&&!Ht(u.ctor,i)||r.push(u)}})),r},i.getAssetInfo=function(t){return this.assetInfos.get(t)||null},i.getSceneInfo=function(t){t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t);var i=this.scenes.find((function(i,n){return n.endsWith(t)}));return i},i.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},i.Be=function(t){if(t){this.assetInfos.clear();for(var i=0,n=t.length;i<n;i++){var r=t[i];this.assetInfos.add(r,{uuid:r})}}},i.Fe=function(t){if(t){var i=this.paths;for(var n in i.clear(),t){var r=t[n],s=r[0],e=r[1],h=3===r.length,u=this.assetInfos.get(n);u.path=s,u.ctor=Zt(e),i.has(s)?h?i.get(s).push(u):i.get(s).unshift(u):i.add(s,[u])}}},i.Ue=function(t){if(t){var i=this.scenes;i.clear();var n=this.assetInfos;for(var r in t){var s=t[r],e=n.get(s);e.url=r,i.add(r,e)}}},i.xe=function(t,i){if(t){var n=this.assetInfos;for(var r in t){var s=t[r],e={uuid:r,packedUuids:s,ext:(null==s?void 0:s.length)>0&&(null==i?void 0:i.includes(s[0]))?".bin":".json"};n.add(r,e);for(var h=0,u=s.length;h<u;h++){var o=s[h],c=n.get(o),a=c.packs;a?1===u?a.unshift(e):a.push(e):c.packs=[e]}}}},i.Ge=function(t){if(t){var i=this.assetInfos,n=t.import;if(n)for(var r=0,s=n.length;r<s;r+=2){var e=n[r];i.get(e).ver=n[r+1]}if(n=t.native)for(var h=0,u=n.length;h<u;h+=2){var o=n[h];i.get(o).nativeVer=n[h+1]}}},i.je=function(t){if(t)for(var i=this.assetInfos,n=0,r=t.length;n<r;n+=2){var s=t[n];i.get(s).redirect=t[n+1]}},t}();function eb(t,i){t._uuid&&i.push(t._uuid)}function hb(t,i){for(var n=Object.getOwnPropertyNames(t),r=0;r<n.length;r++){var s=n[r];if("node"!==s&&"__eventTargets"!==s){var e=t[s];if("object"==typeof e&&e)if(Array.isArray(e))for(var h=0;h<e.length;h++){var u=e[h];u instanceof rg&&eb(u,i)}else if(e.constructor&&e.constructor!==Object)e instanceof rg&&eb(e,i);else for(var o=Object.getOwnPropertyNames(e),c=0;c<o.length;c++){var a=e[o[c]];a instanceof rg&&eb(a,i)}}}}function ub(t,i){for(var n=0;n<t._components.length;n++)hb(t._components[n],i);for(var r=0;r<t._children.length;r++)ub(t._children[r],i)}function ob(t,i,n,r){n.push(t._uuid);for(var s=t_.getDeps(t._uuid),e=0,h=s.length;e<h;e++){var u=Iw.get(s[e]);if(u){var o=u._uuid;o in i?i[o]+=r:i[o]=u.refCount+r,n.includes(o)||ob(u,i,n,r)}}}var cb=[];function ab(t){var i=Object.create(null);if(i[t._uuid]=t.refCount,ob(t,i,cb,-1),cb.length=0,0!==i[t._uuid])return i[t._uuid];for(var n in i)0!==i[n]&&ob(Iw.get(n),i,cb,1);return cb.length=0,i[t._uuid]}var fb=function(){function t(){this.He=new Ow,this.Ve=new Ow,this.$e=!1,this.ze=[]}var i=t.prototype;return i.addIgnoredAsset=function(t){this.ze.push(t._uuid)},i.init=function(){this.He.clear(),this.Ve.clear()},i._addPersistNodeRef=function(t){var i=[];ub(t,i);for(var n=0,r=i.length;n<r;n++){var s=Iw.get(i[n]);s&&s.addRef()}this.He.add(t.uuid,i)},i._removePersistNodeRef=function(t){if(this.He.has(t.uuid)){for(var i=this.He.get(t.uuid),n=0,r=i.length;n<r;n++){var s=Iw.get(i[n]);s&&s.decRef()}this.He.remove(t.uuid)}},i._autoRelease=function(t,i,n){if(t){for(var r=t_.getDeps(t.uuid),s=0,e=r.length;s<e;s++){var h=Iw.get(r[s]);h&&h.decRef(t.autoReleaseAssets)}var u=t_._depends.get(t.uuid);if(u&&u.persistDeps)for(var o=u.persistDeps,c=0,a=o.length;c<a;c++){var f=Iw.get(o[c]);f&&f.decRef(t.autoReleaseAssets)}t.uuid!==i.uuid&&t_.remove(t.uuid)}var v=t_._depends.get(i.uuid);for(var l in v&&(v.persistDeps=[]),n){for(var d,g,p=n[l],_=this.He.get(p.uuid),y=w(_);!(g=y()).done;){var m=g.value,b=Iw.get(m);b&&b.addRef()}v&&(d=v.persistDeps).push.apply(d,_)}},i.tryRelease=function(t,i){void 0===i&&(i=!1),t instanceof rg&&(i?this.We(t,i):(this.Ve.add(t._uuid,t),this.$e||(this.$e=!0,Ui(this.Xe.bind(this)))))},i.Xe=function(){var t=this;this.$e=!1,this.Ve.forEach((function(i){t.We(i)})),this.Ve.clear()},i.We=function(t,i){void 0===i&&(i=!1);var n=t._uuid;if(this.Ve.remove(n),qe(t,!0)&&-1===this.ze.indexOf(n)&&!(!i&&t.refCount>0&&ab(t)>0)){Iw.remove(n);for(var r=t_.getDeps(n),s=0,e=r.length;s<e;s++){var h=Iw.get(r[s]);h&&(h.decRef(!1),this.We(h,!1))}t.destroy(),t_.remove(n)}},t}(),vb=new fb;function lb(t){for(var i=0,n=t.input.length;i<n;i++){var r=t.input[i];!r.isNative&&r.content instanceof rg&&r.content.decRef(!1),r.recycle()}t.input=null}function db(t,i){return i?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function wb(t,i,n,r,s){void 0===s&&(s=0),t(s,(function(e,h){s++,!e||s>i?r&&r(e,h):setTimeout((function(){wb(t,i,n,r,s)}),n)}))}function gb(t,i,n,r,e){try{for(var h=t_.parse(t,i),u=0,o=h.deps.length;u<o;u++){var c=h.deps[u];c in n||(n[c]=!0,r.push({uuid:c,bundle:e&&e.name}))}h.nativeDep&&(e&&(h.nativeDep.bundle=e.name),r.push(s({},h.nativeDep)))}catch(t){X(t.message,t.stack)}}function pb(t,i,n){i&&(n=void 0!==n?n:T.assetManager.cacheAsset,zw(i)||!n||i.isDefault||Iw.add(t,i))}function _b(t,i,n){var r=!1,s=Yp.get(i);if(s){for(var e=0,h=s.length;e<h;e++){var u=s[e],o=n[u.uuid+"@import"];if(o)u.owner[u.prop]=o.addRef();else{if(ht(16350,u.uuid),T.assetManager.dispatchAssetMissing(i,u.owner,u.prop,u.uuid),u.type&&u.type!==rg){var c=new u.type;c.initDefault(u.uuid),u.owner[u.prop]=c}r=!0}}Yp.delete(i)}return Kp.has(i)&&(n[t+"@native"]?i._nativeAsset=n[t+"@native"]:(r=!0,ht(16351,t)),Kp.delete(i)),r}function yb(t){var i=t.source;if(t.options.__outputAsArray__||1!==i.length)for(var n=t.output=[],r=0,s=i.length;r<s;r++)n.push(i[r].content);else t.output=i[0].content}function mb(t,i,n){var r=0,s=[],e=t.length;0===e&&n&&n(s);for(var h=function(t){t&&s.push(t),++r===e&&n&&n(s)},u=0;u<e;u++)i(t[u],h)}function bb(t,i,n){var r=t,s=i,e=n;if(void 0===n){var h="function"==typeof t;i?(e=i,h||(s=null)):void 0===i&&h&&(e=t,r=null,s=null),void 0!==i&&h&&(s=t,r=null)}return{options:r||Object.create(null),onProgress:s,onComplete:e}}function kb(t,i,n){var r=t,s=i,e=n;if(void 0===n){var h=Ht(t,rg);i?(e=i,h&&(s=null)):void 0!==i||h||(e=t,s=null,r=null),void 0===i||h||(s=t,r=null)}return{type:r,onProgress:s||null,onComplete:e}}function Ab(t,i,n,r){if(void 0===r&&(r={}),!n[i]||r[i])return!1;r[i]=!0;var s=!1,e=t_.getDeps(i);if(e)for(var h=0,u=e.length;h<u;h++){var o=e[h];if(o===t||Ab(t,o,n,r)){s=!0;break}}return s}function Eb(t){return function(i,n){if(t){var r=[];Array.isArray(n)?n.forEach((function(t){return t instanceof rg&&r.push(t.addRef())})):n instanceof rg&&r.push(n.addRef()),Ui((function(){r.forEach((function(t){return t.decRef(!1)})),t(i,n)}))}}}var Tb=function(){function t(){this.Ye=new sb}var i=t.prototype;return i.getInfoWithPath=function(t,i){return this.Ye.getInfoWithPath(t,i)},i.getDirWithPath=function(t,i,n){return this.Ye.getDirWithPath(t,i,n)},i.getAssetInfo=function(t){return this.Ye.getAssetInfo(t)},i.getSceneInfo=function(t){return this.Ye.getSceneInfo(t)},i.init=function(t){this.Ye.init(t),Cw.add(t.name,this)},i.load=function(t,i,n,r){var s=kb(i,n,r),e=s.type,h=s.onProgress,u=s.onComplete,o={__requestType__:"path",type:e,bundle:this.name,__outputAsArray__:Array.isArray(t)};T.assetManager.loadAny(t,o,h,u)},i.preload=function(t,i,n,r){var s=kb(i,n,r),e=s.type,h=s.onProgress,u=s.onComplete;T.assetManager.preloadAny(t,{__requestType__:"path",type:e,bundle:this.name},h,u)},i.loadDir=function(t,i,n,r){var s=kb(i,n,r),e=s.type,h=s.onProgress,u=s.onComplete;T.assetManager.loadAny(t,{__requestType__:"dir",type:e,bundle:this.name,__outputAsArray__:!0},h,u)},i.preloadDir=function(t,i,n,r){var s=kb(i,n,r),e=s.type,h=s.onProgress,u=s.onComplete;T.assetManager.preloadAny(t,{__requestType__:"dir",type:e,bundle:this.name},h,u)},i.loadScene=function(t,i,n,r){var s=bb(i,n,r),e=s.options,h=s.onProgress,u=s.onComplete;e.preset=e.preset||"scene",e.bundle=this.name,T.assetManager.loadAny({scene:t},e,h,(function(t,i){if(t)X(t.message,t.stack);else if(i.scene){var n=i.scene;n.id=i._uuid,n.name=i.name}else t=new Error("The asset "+i._uuid+" is not a scene");u&&u(t,i)}))},i.preloadScene=function(t,i,n,r){var s=bb(i,n,r),e=s.options,h=s.onProgress,u=s.onComplete;e.bundle=this.name,T.assetManager.preloadAny({scene:t},e,h,(function(i){i&&ht(1210,t,i.message),u&&u(i)}))},i.get=function(t,i){var n=this.getInfoWithPath(t,i);return n&&Iw.get(n.uuid)||null},i.release=function(t,i){var n=this.get(t,i);n&&vb.tryRelease(n,!0)},i.releaseUnusedAssets=function(){var t=this;Iw.forEach((function(i){var n=t.getAssetInfo(i._uuid);n&&!n.redirect&&vb.tryRelease(i)}))},i.releaseAll=function(){var t=this;Iw.forEach((function(i){var n=t.getAssetInfo(i._uuid);n&&!n.redirect&&vb.tryRelease(i,!0)}))},i._destroy=function(){this.Ye.destroy()},r(t,[{key:"config",get:function(){return this.Ye}},{key:"name",get:function(){return this.Ye.name}},{key:"deps",get:function(){return this.Ye.deps}},{key:"base",get:function(){return this.Ye.base}}]),t}(),Ob=t("dO",new Tb);function Sb(t,i,n){var r=new I.Image;function s(){r.removeEventListener("load",s),r.removeEventListener("error",e),n&&n(null,r)}function e(){r.removeEventListener("load",s),r.removeEventListener("error",e),n&&n(new Error(at(4930,t)))}return"file:"!==I.location.protocol&&(r.crossOrigin="anonymous"),r.addEventListener("load",s),r.addEventListener("error",e),r.src=t,r}function Ib(t,i,n,r){var s=new XMLHttpRequest,e="download failed: "+t+", status: ";if(s.open("GET",t,!0),void 0!==i.xhrResponseType&&(s.responseType=i.xhrResponseType),void 0!==i.xhrWithCredentials&&(s.withCredentials=i.xhrWithCredentials),void 0!==i.xhrMimeType&&s.overrideMimeType&&s.overrideMimeType(i.xhrMimeType),void 0!==i.xhrTimeout&&(s.timeout=i.xhrTimeout),i.xhrHeader)for(var h in i.xhrHeader)s.setRequestHeader(h,i.xhrHeader[h]);return s.onload=function(){200===s.status||0===s.status?r&&r(null,s.response):r&&r(new Error(""+e+s.status+"(no response)"))},n&&(s.onprogress=function(t){t.lengthComputable&&n(t.loaded,t.total)}),s.onerror=function(){r&&r(new Error(""+e+s.status+"(error)"))},s.ontimeout=function(){r&&r(new Error(""+e+s.status+"(time out)"))},s.onabort=function(){r&&r(new Error(""+e+s.status+"(abort)"))},s.send(null),s}T.resources=Ob;var Rb=I.document,Mb={};function Cb(t,i,n){if(Mb[t])return n&&n(null),null;var r=Rb.createElement("script");function s(){r.parentNode.removeChild(r),r.removeEventListener("load",s,!1),r.removeEventListener("error",e,!1),Mb[t]=!0,n&&n(null)}function e(){r.parentNode.removeChild(r),r.removeEventListener("load",s,!1),r.removeEventListener("error",e,!1),n&&n(new Error(at(4928,t)))}return"file:"!==I.location.protocol&&(r.crossOrigin="anonymous"),r.async=i.scriptAsyncLoading||!1,r.src=t,r.addEventListener("load",s,!1),r.addEventListener("error",e,!1),Rb.body.appendChild(r),r}var Nb=/^(?:\w+:\/\/|\.+\/).+/,Pb=function(t,i,n){(bh.hasFeature(bh.Feature.IMAGE_BITMAP)&&T.assetManager.allowImageBitmap?Lb:Sb)(t,i,n)},Lb=function(t,i,n){i.xhrResponseType="blob",Ib(t,i,i.onFileProgress,n)},Db=function(t,i,n){i.xhrResponseType="json",Ib(t,i,i.onFileProgress,n)},Bb=function(t,i,n){i.xhrResponseType="arraybuffer",Ib(t,i,i.onFileProgress,n)},Fb=function(t,i,n){var r=function(t,i){try{i(null,np(new Uint8Array(t)))}catch(t){i(t)}};Xb._downloadArrayBuffer(t.replace(".cconb",".bin"),i,(function(s,e){s?Xb._downloadArrayBuffer(t,i,(function(t,i){t?n(t):r(i,n)})):r(e,n)}))},Ub=function(t,i,n){i.xhrResponseType="text",Ib(t,i,i.onFileProgress,n)},xb=function(t,i,n){var r=qf(t),s=t;Nb.test(s)||(s=-1!==Xb.remoteBundles.indexOf(r)?Xb.remoteServerAddress+"remote/"+r:"assets/"+r);var e=i.version||Xb.bundleVers[r],h=0,u=null,o=null;Db(s+"/config."+(e?e+".":"")+"json",i,(function(t,i){o=t||o,(u=i)&&(u.base=s+"/"),2==++h&&n(o,u)})),Cb(s+"/index."+(e?e+".":"")+"js",i,(function(t){o=t||o,2==++h&&n(o,u)}))},Gb=function(){var t=i.prototype;function i(){this.maxConcurrency=15,this.maxRequestsPerFrame=15,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers={},this.remoteBundles=[],this.downloadDomImage=Sb,this.downloadDomAudio=null,this.downloadFile=Ib,this.downloadScript=Cb,this._downloadArrayBuffer=Bb,this._downloadJson=Db,this.Ke={".png":Pb,".jpg":Pb,".bmp":Pb,".jpeg":Pb,".gif":Pb,".ico":Pb,".tiff":Pb,".webp":Pb,".image":Pb,".pvr":Bb,".pkm":Bb,".astc":Bb,".txt":Ub,".xml":Ub,".vsh":Ub,".fsh":Ub,".atlas":Ub,".tmx":Ub,".tsx":Ub,".json":Db,".ExportJson":Db,".plist":Ub,".cconb":Fb,".fnt":Ub,".binary":Bb,".bin":Bb,".dbbin":Bb,".skel":Bb,".js":Cb,bundle:xb,default:Ub},this.qe=new Ow,this.pn=[],this.Qe=!1,this.Je=0,this.Ze=0,this.th=-1,this.ih=!1,this.nh="",this.rh=1/30}return t.init=function(t,i,n){void 0===t&&(t=""),void 0===i&&(i={}),void 0===n&&(n=[]),this.qe.clear(),this.pn.length=0,this.nh=t,this.bundleVers=i,this.remoteBundles=n},t.register=function(t,i){"object"==typeof t?xt(this.Ke,t):this.Ke[t]=i},t.download=function(t,i,n,r,s){var e=this,h=Rw.get(t);if(h)s(null,h);else{var u=this.qe.get(t);if(u){u.push(s);var o=this.pn.find((function(i){return i.id===t}));if(!o)return;var c=r.priority||0;o.priority<c&&(o.priority=c,this.Qe=!0)}else{var a=void 0!==r.maxRetryCount?r.maxRetryCount:this.maxRetryCount,f=void 0!==r.maxConcurrency?r.maxConcurrency:this.maxConcurrency,v=void 0!==r.maxRequestsPerFrame?r.maxRequestsPerFrame:this.maxRequestsPerFrame,l=this.Ke[n]||this.Ke.default;wb((function(n,h){if(0===n&&e.qe.add(t,[s]),e.limited){e.sh();var u=function(t,i){e.Je--,e.eh(f,v),h(t,i)};e.Je<f&&e.Ze<v?(l(db(i,e.appendTimeStamp),r,u),e.Je++,e.Ze++):(e.pn.push({id:t,priority:r.priority||0,url:i,options:r,done:u,handler:l}),e.Qe=!0,e.Je<f&&e.eh(f,v))}else l(db(i,e.appendTimeStamp),r,h)}),a,this.retryInterval,(function(i,n){i||Rw.add(t,n);for(var r=e.qe.remove(t),s=0,h=r.length;s<h;s++)r[s](i,n)}))}}},t.loadSubpackage=function(t,i){T.assetManager.loadBundle(t,null,i)},t.sh=function(){var t=performance.now(),i=T.game.deltaTime,n=i>this.rh?this.rh:i;t-this.th>1e3*n&&(this.Ze=0,this.th=t)},t.hh=function(t,i){for(this.ih=!1,this.sh();this.pn.length>0&&this.Je<t&&this.Ze<i;){this.Qe&&(this.pn.sort((function(t,i){return t.priority-i.priority})),this.Qe=!1);var n=this.pn.pop();if(!n)break;this.Je++,this.Ze++,n.handler(db(n.url,this.appendTimeStamp),n.options,n.done)}this.eh(t,i)},t.eh=function(t,i){!this.ih&&this.pn.length>0&&(Ui(this.hh.bind(this),t,i),this.ih=!0)},r(i,[{key:"remoteServerAddress",get:function(){return this.nh}},{key:"handlers",get:function(){return this.Ke}}],[{key:"instance",get:function(){return i.se||(i.se=new i),i.se}}]),i}();Gb.se=void 0;var jb,Hb,Vb,$b,zb,Wb,Xb=Gb.instance,Yb=Gb.instance,Kb=t("dC",_o("cc.JsonAsset")((Hb=function(t){function i(i){var n;return(n=t.call(this,i)||this).json=Vb&&Vb(),n}return e(i,t),i}(rg),Vb=uo(Hb.prototype,"json",[Co],(function(){return null})),jb=Hb))||jb);T.JsonAsset=Kb;var qb,Qb,Jb=t("dB",_o("cc.TextAsset")((zb=function(t){function i(i){var n;return(n=t.call(this,i)||this).text=Wb&&Wb(),n}return e(i,t),i.prototype.toString=function(){return this.text},i}(rg),Wb=uo(zb.prototype,"text",[Co],(function(){return""})),$b=zb))||$b);T.TextAsset=Jb;var Zb=t("dy",_o("cc.BufferAsset")((Qb=function(t){function i(i){var n;return(n=t.call(this,i)||this).Ts=null,n}e(i,t);var n=i.prototype;return n.buffer=function(){return this.Ts,this.Ts},n.validate=function(){return!!this.Ts},r(i,[{key:"_nativeAsset",get:function(){return this.Ts},set:function(t){t instanceof ArrayBuffer?this.Ts=t:this.Ts=t.buffer}}]),i}(rg),y(Qb.prototype,"_nativeAsset",[ac],Object.getOwnPropertyDescriptor(Qb.prototype,"_nativeAsset"),Qb.prototype),qb=Qb))||qb);function tk(t,i,n,r){var s=null,e=null;try{(s=new mg)._nativeUrl=t,s._nativeAsset=i}catch(t){e=t}r(e,s)}function ik(t,i,n,r){var s=new Kb;s.json=i,r(null,s)}function nk(t,i,n,r){var s=new Jb;s.text=i,r(null,s)}function rk(t,i,n,r){var s=new Zb;s._nativeUrl=t,s._nativeAsset=i,r(null,s)}function sk(t,i,n,r){var s=new rg;s._nativeUrl=t,s._nativeAsset=i,r(null,s)}function ek(t,n,r,s){var e=Cw.get(n.name);e||(e="resources"===n.name?Ob:new Tb,n.base=n.base||t+"/",e.init(n)),i.import("virtual:///prerequisite-imports/"+e.name).then((function(){s(null,e)})).catch(s)}T.BufferAsset=Zb;var hk=function(){function t(){this.uh=new Ow,this.oh={".png":tk,".jpg":tk,".bmp":tk,".jpeg":tk,".gif":tk,".ico":tk,".tiff":tk,".webp":tk,".image":tk,".pvr":tk,".pkm":tk,".astc":tk,".txt":nk,".xml":nk,".vsh":nk,".fsh":nk,".atlas":nk,".tmx":nk,".tsx":nk,".fnt":nk,".json":ik,".ExportJson":ik,".binary":rk,".bin":rk,".dbbin":rk,".skel":rk,bundle:ek,default:sk}}var i=t.prototype;return i.register=function(t,i){"object"==typeof t?xt(this.oh,t):this.oh[t]=i},i.create=function(t,i,n,r,s){var e=this,h=this.oh[n]||this.oh.default,u=Iw.get(t);if(r.reloadAsset||!u){var o=this.uh.get(t);o?o.push(s):(this.uh.add(t,[s]),h(t,i,r,(function(i,n){!i&&n instanceof rg&&(n._uuid=t,pb(t,n,r.cacheAsset));for(var s=e.uh.remove(t),h=0,u=s.length;h<u;h++)s[h](i,n)})))}else s(null,u)},t}(),uk=new hk,ok=!0;function ck(t){var i=new DataView(t,0,t.byteLength);if("BINP"!==String.fromCharCode.apply(String,new Uint8Array(t.slice(0,4))))throw new Error("Invalid bin package format");var n=i.getUint32(4,ok);if(2!==n)return ak(t,i,n);for(var r=i.getUint32(8,ok),s=[],e=4*(3+2*r),h=0;h<r;h++){var u=i.getUint32(4*(3+2*h),ok)+e,o=i.getUint32(4*(4+2*h),ok);s.push({offset:u,size:o})}return s.map((function(i){var n=i.offset,r=i.size;return new Uint8Array(t,n,r)}))}function ak(t,i,n){return{1:fk}[n](t,i)}function fk(t,i){for(var n=i.getUint32(8,ok),r=[],s=4*(3+n),e=0;e<n;e++){var h=i.getUint32(4*(3+e),ok);r.push({offset:s,size:h}),s+=h}return r.map((function(i){var n=i.offset,r=i.size;return new Uint8Array(t,n,r)}))}var vk=function(){function t(){this.ah=new Ow,this.fh={".json":this.unpackJson,".bin":this.unpackBin}}var i=t.prototype;return i.unpackJson=function(t,i,n,r){var s=It(!0),e=null;if(Array.isArray(i)){(i=zp(i)).length!==t.length&&ht(4915);for(var h=0;h<t.length;h++)s[t[h]+"@import"]=i[h]}else{var u=ni(f_),o=ni(mg);if(i.type===u&&i.data){var c=i.data;c.length!==t.length&&ht(4915);for(var a=0;a<t.length;a++)s[t[a]+"@import"]=Wp(u,{base:c[a][0],mipmaps:c[a][1]})}else{if(i.type!==o||!i.data)return void r(e=new Error("unmatched type pack!"),null);var f=i.data;f.length!==t.length&&ht(4915);for(var v=0;v<t.length;v++)s[t[v]+"@import"]=f[v]}}r(e,s)},i.unpackBin=function(t,i,n,r){var s=It(!0),e=null;try{var h=ck(i);t.forEach((function(t,i){return s[t+"@import"]=np(h[i])}))}catch(t){e=t}r(e,s)},i.init=function(){this.ah.clear()},i.register=function(t,i){"object"==typeof t?xt(this.fh,t):this.fh[t]=i},i.unpack=function(t,i,n,r,s){i?(0,this.fh[n])(t,i,r,s):s(new Error("package data is wrong!"))},i.load=function(t,i,n){var r=this;if(!t.isNative&&t.info&&t.info.packs)if(Rw.has(t.id))n(null,Rw.get(t.id));else{var s=t.info.packs,e=s.find((function(t){return r.ah.has(t.uuid)}));if(e)this.ah.get(e.uuid).push({onComplete:n,id:t.id});else{var h=s[0];this.ah.add(h.uuid,[{onComplete:n,id:t.id}]),t.config;var u=Xw(h.uuid,{ext:h.ext,bundle:t.config.name}),o=function(i,n){Rw.remove(h.uuid),i&&X(i.message,i.stack),r.unpack(h.packedUuids,n,h.ext,t.options,(function(t,n){if(!t)for(var s in n)Rw.add(s,n[s]);for(var e=r.ah.remove(h.uuid),u=0,o=e.length;u<o;u++){var c=e[u];if(i||t)c.onComplete(i||t);else{var a=n[c.id];a?c.onComplete(null,a):c.onComplete(new Error("can not retrieve data from package"))}}}))};".bin"===h.ext?Yb._downloadArrayBuffer(u,t.options,o):".json"===h.ext?Yb.download(h.uuid,u,h.ext,t.options,o):ht(4916,h.ext)}}else Yb.download(t.id,t.url,t.ext,t.options,n)},t}(),lk=new vk;function dk(t,i){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var r=t.options,s=t.progress,e=[],h=s.total,u=r.__exclude__=r.__exclude__||Object.create(null);t.output=[],mb(t.input,(function(r,o){if(!r.isNative&&Iw.has(r.uuid)){var c=Iw.get(r.uuid);return r.content=c.addRef(),t.output.push(r),s.canInvoke&&t.dispatch("progress",++s.finish,s.total,r),void o()}lk.load(r,t.options,(function(c,a){c?t.isFinished||(!T.assetManager.force||n?(X(c.message,c.stack),s.canInvoke=!1,i(c)):(t.output.push(r),s.canInvoke&&t.dispatch("progress",++s.finish,s.total,r))):t.isFinished||(r.file=a,t.output.push(r),r.isNative||(u[r.uuid]=!0,gb(r.uuid,a,u,e,r.config),s.total=h+e.length),s.canInvoke&&t.dispatch("progress",++s.finish,s.total,r)),o()}))}),(function(){if(t.isFinished)return lb(t),void t.dispatch("error");if(e.length>0){var h=Fw.create({input:e,progress:s,options:r,onProgress:t.onProgress,onError:Fw.prototype.recycle,onComplete:function(r){var s;r||((s=t.output).push.apply(s,h.output),h.recycle()),n&&wk(t),i(r)}});Pw.async(h)}else n&&wk(t),i()}))}function wk(t){for(var i=t.output,n=0,r=i.length;n<r;n++)i[n].content&&i[n].content.decRef(!1)}var gk=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.parse=function(t){var i=this._parseXML(t).documentElement;if("plist"!==i.tagName)return st(5100),{};for(var n=null,r=0,s=i.childNodes.length;r<s&&1!==(n=i.childNodes[r]).nodeType;r++);return this.dh(n)},n.dh=function(t){var i=null,n=t.tagName;if("dict"===n)i=this.wh(t);else if("array"===n)i=this.gh(t);else if("string"===n)if(1===t.childNodes.length)i=t.firstChild.nodeValue;else{i="";for(var r=0;r<t.childNodes.length;r++)i+=t.childNodes[r].nodeValue}else"false"===n?i=!1:"true"===n?i=!0:"real"===n?i=parseFloat(t.firstChild.nodeValue):"integer"===n&&(i=parseInt(t.firstChild.nodeValue,10));return i},n.gh=function(t){for(var i=[],n=0,r=t.childNodes.length;n<r;n++){var s=t.childNodes[n];1===s.nodeType&&i.push(this.dh(s))}return i},n.wh=function(t){for(var i={},n="",r=0,s=t.childNodes.length;r<s;r++){var e=t.childNodes[r];1===e.nodeType&&("key"===e.tagName?n=e.firstChild.nodeValue:i[n]=this.dh(e))}return i},i}(function(){function t(){this.ph=null,globalThis.DOMParser&&(this.ph=new DOMParser)}var i=t.prototype;return i.parse=function(t){return this._parseXML(t)},i._parseXML=function(t){if(this.ph)return this.ph.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t}()),pk=new gk,_k=function(){function t(){this._h=new Ow,this.yh={".png":this.mh,".jpg":this.mh,".bmp":this.mh,".jpeg":this.mh,".gif":this.mh,".ico":this.mh,".tiff":this.mh,".webp":this.mh,".image":this.mh,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.bh,".ccon":this.bh,".cconb":this.bh}}var i=t.prototype;return i.mh=function(t,i,n){t instanceof HTMLImageElement?n(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){n(null,t)}),(function(t){n(t,null)}))},i.parsePVRTex=function(t,i,n){var r=null,s=null;try{s=mg.Jr(t,0)}catch(t){W(r=t)}n(r,s)},i.parsePKMTex=function(t,i,n){var r=null,s=null;try{s=mg.Jr(t,1)}catch(t){W(r=t)}n(r,s)},i.parseASTCTex=function(t,i,n){var r=null,s=null;try{s=mg.Jr(t,2)}catch(t){W(r=t)}n(r,s)},i.parsePlist=function(t,i,n){var r=null,s=pk.parse(t);s||(r=new Error("parse failed")),n(r,s)},i.bh=function(t,i,n){if(t){var r=null,s=null;try{r=Qp(t,i)}catch(t){s=t}n(s,r)}else n(new Error(at(3702,i.__uuid__)))},i.kh=function(){this._h.clear()},i.register=function(t,i){"object"==typeof t?xt(this.yh,t):this.yh[t]=i},i.parse=function(t,i,n,r,s){var e=this,h=Mw.get(t);if(h)s(null,h);else{var u=this._h.get(t);if(u)u.push(s);else{var o=this.yh[n];o?(this._h.add(t,[s]),o(i,r,(function(i,n){i?Rw.remove(t):zw(n)||Mw.add(t,n);for(var r=e._h.remove(t),s=0,h=r.length;s<h;s++)r[s](i,n)}))):s(null,i)}}},r(t,null,[{key:"instance",get:function(){return this.se||(this.se=new t),this.se}}]),t}();_k.se=void 0;var yk=_k.instance;function mk(t,i){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var r=t.options,s=t.progress;r.__exclude__=r.__exclude__||Object.create(null),t.output=[],mb(t.input,(function(e,h){var u=Fw.create({input:e,onProgress:t.onProgress,options:r,progress:s,onComplete:function(r,o){r&&!t.isFinished&&(!T.assetManager.force||n?(X(r.message,r.stack),s.canInvoke=!1,i(r)):s.canInvoke&&t.dispatch("progress",++s.finish,s.total,e)),t.output.push(o),u.recycle(),h(null)}});bk.async(u)}),(function(){if(r.__exclude__=null,t.isFinished)return lb(t),void t.dispatch("error");yb(t),lb(t),i()}))}var bk=new Sw("loadOneAsset",[function(t,i){var n=t.output=t.input,r=n.options,s=n.isNative,e=n.uuid,h=n.file,u=r.reloadAsset;h||!u&&!s&&Iw.has(e)?i():lk.load(n,t.options,(function(t,r){n.file=r,i(t)}))},function(t,i){var n=t.output=t.input,r=t.progress,s=t.options.__exclude__,e=n.id,h=n.file,u=n.options;if(n.isNative)yk.parse(e,h,n.ext,u,(function(s,h){s?i(s):(n.content=h,r.canInvoke&&t.dispatch("progress",++r.finish,r.total,n),Rw.remove(e),Mw.remove(e),i())}));else{var o=n.uuid;if(o in s){var c=s[o],a=c.finish,f=c.content,v=c.err,l=c.callbacks;r.canInvoke&&t.dispatch("progress",++r.finish,r.total,n),a||Ab(o,o,s)?(f&&f.addRef(),n.content=f,i(v)):l.push({done:i,item:n})}else if(!u.reloadAsset&&Iw.has(o)){var d=Iw.get(o);n.content=d.addRef(),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,n),i()}else u.__uuid__=o,yk.parse(e,h,"import",u,(function(n,r){n?i(n):kk(t,r,i)}))}}]);function kk(t,i,n){var r=t.input,s=t.progress,e=r,h=e.uuid,u=e.id,o=e.options,c=e.config,a=o.cacheAsset,f=[];i.addRef&&i.addRef(),gb(h,i,Object.create(null),f,c),s.canInvoke&&t.dispatch("progress",++s.finish,s.total+=f.length,r);var v=t.options.__exclude__[h]={content:i,finish:!1,callbacks:[{done:n,item:r}]},l=Fw.create({input:f,options:t.options,onProgress:t.onProgress,onError:Fw.prototype.recycle,progress:s,onComplete:function(t){if(i.decRef&&i.decRef(!1),v.finish=!0,v.err=t,!t){for(var n,r=Array.isArray(l.output)?l.output:[l.output],s=Object.create(null),e=w(r);!(n=e()).done;){var o=n.value;o&&(s[o instanceof rg?o._uuid+"@import":h+"@native"]=o)}_b(h,i,s);try{"function"!=typeof i.onLoaded||qp.has(i)||Kp.has(i)||(i.onLoaded(),qp.add(i))}catch(t){ht(16352,h,t.message,t.stack)}Rw.remove(u),Mw.remove(u),pb(h,i,a),l.recycle()}for(var c=v.callbacks,f=0,d=c.length;f<d;f++){var g=c[f];i.addRef&&i.addRef(),g.item.content=i,g.done(t)}c.length=0}});Nw.async(l)}function Ak(t,i){var n=t.options,r=Object.create(null),s=Object.create(null);for(var e in n)switch(e){case"path":case"uuid":case"dir":case"scene":case"url":break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":r[e]=n[e];break;case"__exclude__":case"__outputAsArray__":s[e]=n[e];break;default:r[e]=n[e],s[e]=n[e]}t.options=s;var h=Fw.create({input:t.input,options:r}),u=null;try{t.output=t.source=Lw.sync(h)}catch(t){u=t;for(var o=0,c=h.output.length;o<c;o++)h.output[o].recycle()}h.recycle(),i(u)}var Ek=function(){function t(){this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this.ps=""}return t.create=function(){return 0!==t.Yr.length?t.Yr.pop():new t},t.prototype.recycle=function(){t.Yr.length!==t.Kr&&(this.ps="",this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t.Yr.push(this))},r(t,[{key:"id",get:function(){return this.ps||(this.ps=(this.overrideUuid||this.uuid)+"@"+(this.isNative?"native":"import")),this.ps}}]),t}();Ek.Kr=500,Ek.Yr=[];var Tk=[];function Ok(t){var i=t.options,n=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(var r=function(){var r=n[s],e=Ek.create(),h=null,u=null;if("string"==typeof r&&((r=Object.create(null))[i.__requestType__||"uuid"]=n[s]),"object"==typeof r){Ut(r,i),r.preset&&Ut(r,Bw[r.preset]);var o=function(){var t;switch(c){case"uuid":var i,s=e.uuid=Hw(r.uuid);if(!r.bundle){var o=Cw.find((function(t){return!!t.getAssetInfo(s)}));r.bundle=o&&o.name}if(Cw.has(r.bundle)){if(h=Cw.get(r.bundle).config,(u=h.getAssetInfo(s))&&u.redirect){if(!Cw.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");h=Cw.get(u.redirect).config,u=h.getAssetInfo(s)}e.config=h,e.info=u}e.ext=r.ext||(null==(i=u)?void 0:i.extension)||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case"dir":if(Cw.has(r.bundle)){Cw.get(r.bundle).config.getDirWithPath(r.dir,r.type,Tk);for(var a,f=w(Tk);!(a=f()).done;){var v=a.value;n.push({uuid:v.uuid,__isNative__:!1,ext:v.extension||".json",bundle:r.bundle})}Tk.length=0}e.recycle(),e=null;break;case"path":if(Cw.has(r.bundle)){if(h=Cw.get(r.bundle).config,(u=h.getInfoWithPath(r.path,r.type))&&u.redirect){if(!Cw.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");h=Cw.get(u.redirect).config,u=h.getAssetInfo(u.uuid)}if(!u)throw e.recycle(),new Error("Bundle "+r.bundle+" doesn't contain "+r.path);e.config=h,e.uuid=u.uuid,e.info=u}e.ext=r.ext||(null==(t=u)?void 0:t.extension)||".json";break;case"scene":if(!r.bundle){var l=Cw.find((function(t){return!!t.getSceneInfo(r.scene)}));r.bundle=l&&l.name}if(Cw.has(r.bundle)){if(h=Cw.get(r.bundle).config,(u=h.getSceneInfo(r.scene))&&u.redirect){if(!Cw.has(u.redirect))throw new Error("you need to load bundle "+u.redirect+" first");h=Cw.get(u.redirect).config,u=h.getAssetInfo(u.uuid)}if(!u)throw e.recycle(),new Error("Bundle "+h.name+" doesn't contain scene "+r.scene);e.config=h,e.uuid=u.uuid,e.info=u}break;case"__isNative__":e.isNative=r.__isNative__;break;case"url":e.url=r.url,e.uuid=r.uuid||r.url,e.ext=r.ext||Yf(r.url),e.isNative=void 0===r.__isNative__||r.__isNative__;break;default:e.options[c]=r[c]}if(!e)return 1};for(var c in r)if(o())break}if(!e)return 1;if(t.output.push(e),!e.uuid&&!e.url)throw new Error("Can not parse this input:"+JSON.stringify(r))},s=0;s<n.length;s++)r();return null}function Sk(t){for(var i=t.output=t.input,n=function(){var t=i[r];if(Dw.has(t.uuid)){var n=Dw.get(t.uuid),s=Cw.find((function(t){return!!t.getAssetInfo(n)}));if(s){var e;t.overrideUuid=n;var h=s.config,u=h.getAssetInfo(n);if(u&&u.redirect){if(!Cw.has(u.redirect))throw new Error("Please load bundle "+u.redirect+" first");u=(h=Cw.get(u.redirect).config).getAssetInfo(n)}t.config=h,t.info=u,t.ext=t.isNative?t.ext:(null==(e=u)?void 0:e.extension)||".json"}else st(16201,n,t.uuid)}},r=0;r<i.length;r++)n()}function Ik(t){for(var i=t.output=t.input,n=0;n<i.length;n++){var r=i[n];if(!r.url){var s,e,h=r.config;e=r.isNative?h&&h.nativeBase?h.base+h.nativeBase:T.assetManager.generalNativeBase:h&&h.importBase?h.base+h.importBase:T.assetManager.generalImportBase;var u=r.overrideUuid||r.uuid,o="";r.info&&(o=r.isNative?r.info.nativeVer?"."+r.info.nativeVer:"":r.info.ver?"."+r.info.ver:""),s=".ttf"===r.ext?e+"/"+u.slice(0,2)+"/"+u+o+"/"+r.options.__nativeName__:e+"/"+u.slice(0,2)+"/"+u+o+r.ext,r.url=s}}return null}var Rk=Oi.querySettings.bind(Oi),Mk="assets",Ck="asset-missing",Nk=t("dN",function(){function t(){this.pipeline=Nw.append(Ak).append(mk),this.fetchPipeline=Pw.append(Ak).append(dk),this.transformPipeline=Lw.append(Ok).append(Sk).append(Ik),this.bundles=Cw,this.assets=Iw,this.assetsOverrideMap=Dw,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=t_,this.force=k,this.allowImageBitmap=!1,this.utils=tg,this.downloader=Yb,this.parser=yk,this.packManager=lk,this.cacheAsset=!0,this.cacheManager=null,this.presets=Bw,this.factory=uk,this.preprocessPipe=Ak,this.fetchPipe=dk,this.loadPipe=mk,this.references=null,this.Ah=vb,this.Eh=Rw,this.Th=Mw,this.Oh=null,this.Sh=[],this.Ih=new eh}var i=t.prototype;return i.getReleaseManager=function(){return this.Ah},i.onAssetMissing=function(t,i){this.Ih.on(Ck,t,i)},i.offAssetMissing=function(t,i){this.Ih.off(Ck,t,i)},i.dispatchAssetMissing=function(t,i,n,r){this.Ih.emit(Ck,t,i,n,r)},i.init=function(t){void 0===t&&(t={});var i=t.server||Rk(Mk,"server")||"",n=t.bundleVers||Rk(Mk,"bundleVers")||{},r=t.remoteBundles||Rk(Mk,"remoteBundles")||[],s=t.downloadMaxConcurrency||Rk(Mk,"downloadMaxConcurrency");s&&s>0&&(this.downloader.maxConcurrency=s),this.Eh.clear(),this.Th.clear(),this.Ah.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(i,n,r),this.parser.kh(),this.dependUtil.init();var e=t.importBase||Rk(Mk,"importBase")||"";e&&e.endsWith("/")&&(e=e.substring(0,e.length-1));var h=t.nativeBase||Rk(Mk,"nativeBase")||"";h&&h.endsWith("/")&&(h=h.substring(0,h.length-1)),this.generalImportBase=e,this.generalNativeBase=h,this.Sh=Rk(Mk,"projectBundles")||[];var u=Rk(Mk,"assetsOverrides")||{};for(var o in u)this.assetsOverrideMap.set(o,u[o])},i.getBundle=function(t){return Cw.get(t)||null},i.removeBundle=function(t){t._destroy(),Cw.remove(t.name)},i.loadAny=function(t,i,n,r){var s=bb(i,n,r),e=s.options,h=s.onProgress,u=s.onComplete;e.preset=e.preset||"default",t=Array.isArray(t)?t.slice():t;var o=Fw.create({input:t,onProgress:h,onComplete:Eb(u),options:e});Nw.async(o)},i.preloadAny=function(t,i,n,r){var s=bb(i,n,r),e=s.options,h=s.onProgress,u=s.onComplete;e.preset=e.preset||"preload",t=Array.isArray(t)?t.slice():t;var o=Fw.create({input:t,onProgress:h,onComplete:Eb(u),options:e});Pw.async(o)},i.loadRemote=function(t,i,n){var r=bb(i,void 0,n),s=r.options,e=r.onComplete;s.reloadAsset||!this.assets.has(t)?(s.__isNative__=!0,s.preset=s.preset||"remote",this.loadAny({url:t},s,null,(function(i,n){i?(X(i.message,i.stack),e&&e(i,n)):uk.create(t,n,s.ext||Yf(t),s,(function(t,i){e&&e(t,i)}))}))):Eb(e)(null,this.assets.get(t))},i.loadBundle=function(t,i,n){var r=bb(i,void 0,n),s=r.options,e=r.onComplete,h=qf(t);this.bundles.has(h)?Eb(e)(null,this.getBundle(h)):(s.preset=s.preset||"bundle",s.ext="bundle",s.__isNative__=!0,this.loadAny({url:t},s,null,(function(i,n){i?(X(i.message,i.stack),e&&e(i,n)):uk.create(t,n,"bundle",s,(function(t,i){e&&e(t,i)}))})))},i.releaseAsset=function(t){vb.tryRelease(t,!0)},i.releaseUnusedAssets=function(){Iw.forEach((function(t){vb.tryRelease(t)}))},i.releaseAll=function(){Iw.forEach((function(t){vb.tryRelease(t,!0)}))},i.loadWithJson=function(){throw new Error("Only valid in Editor")},r(t,[{key:"files",get:function(){return this.Eh}},{key:"main",get:function(){return Cw.get("main")||null}},{key:"resources",get:function(){return Cw.get("resources")||null}}],[{key:"instance",get:function(){return this.se||(this.se=new t),this.se}}]),t}());Nk.se=void 0,Nk.Pipeline=Sw,Nk.Task=Fw,Nk.Cache=Ow,Nk.RequestItem=Ek,Nk.Bundle=Tb,Nk.BuiltinBundleName={INTERNAL:"internal",RESOURCES:"resources",MAIN:"main",START_SCENE:"start-scene"},Nk.CacheManager=function(){this.cacheDir=void 0,this.cacheEnabled=void 0,this.autoClear=void 0,this.cacheInterval=void 0,this.deleteInterval=void 0,this.cachedFiles=void 0},Nk.Downloader=Gb,Nk.Parser=_k,Nk.DependUtil=Jp;var Pk=t("dM",T.assetManager=Nk.instance);T.AssetManager=Nk;var Lk,Dk,Bk=t("dP",function(){function t(){this._resources={},this._materialsToBeCompiled=[]}var i=t.prototype;return i.init=function(){for(var t=this._resources,i=new Uint8Array(16),n=new Uint8Array(16),r=new Uint8Array(16),s=new Uint8Array(16),e=new Uint8Array(16),h=0,u=0;u<4;u++)i[h]=0,i[h+1]=0,i[h+2]=0,i[h+3]=255,n[h]=0,n[h+1]=0,n[h+2]=0,n[h+3]=0,r[h]=119,r[h+1]=119,r[h+2]=119,r[h+3]=255,s[h]=255,s[h+1]=255,s[h+2]=255,s[h+3]=255,e[h]=127,e[h+1]=127,e[h+2]=255,e[h+3]=255,h+=4;var o=new Uint8Array(1024);h=0;for(var c=0;c<256;c++)o[h]=221,o[h+1]=221,o[h+2]=221,o[h+3]=255,h+=4;h=0;for(var a=0;a<8;a++){for(var f=0;f<8;f++)o[h]=85,o[h+1]=85,o[h+2]=85,o[h+3]=255,h+=4;h+=32}h+=32;for(var v=0;v<8;v++){for(var l=0;l<8;l++)o[h]=85,o[h+1]=85,o[h+2]=85,o[h+3]=255,h+=4;h+=32}var d={width:2,height:2,_data:i,_compressed:!1,format:35},w={width:2,height:2,_data:n,_compressed:!1,format:35},g={width:2,height:2,_data:r,_compressed:!1,format:35},p={width:2,height:2,_data:s,_compressed:!1,format:35},_={width:2,height:2,_data:e,_compressed:!1,format:35},y={width:16,height:16,_data:o,_compressed:!1,format:35},m=new mg(d),b=new f_;b._uuid="black-texture",b.image=m,t[b._uuid]=b;var k=new mg(w),A=new f_;A._uuid="empty-texture",A.image=k,t[A._uuid]=A;var E=new tb;E._uuid="black-cube-texture",E.setMipFilter(1),E.image={front:new mg(d),back:new mg(d),left:new mg(d),right:new mg(d),top:new mg(d),bottom:new mg(d)},t[E._uuid]=E;var O=new mg(g),S=new f_;S._uuid="grey-texture",S.image=O,t[S._uuid]=S;var I=new tb;I._uuid="grey-cube-texture",I.setMipFilter(1),I.image={front:new mg(g),back:new mg(g),left:new mg(g),right:new mg(g),top:new mg(g),bottom:new mg(g)},t[I._uuid]=I;var R=new mg(p),M=new f_;M._uuid="white-texture",M.image=R,t[M._uuid]=M;var C=new tb;C._uuid="white-cube-texture",C.setMipFilter(1),C.image={front:new mg(p),back:new mg(p),left:new mg(p),right:new mg(p),top:new mg(p),bottom:new mg(p)},t[C._uuid]=C;var N=new mg(_),P=new f_;P._uuid="normal-texture",P.image=N,t[P._uuid]=P;var L=new mg(y),D=new f_;D._uuid="default-texture",D.image=L,t[D._uuid]=D;var B=new tb;if(B.setMipFilter(1),B._uuid="default-cube-texture",B.image={front:new mg(y),back:new mg(y),left:new mg(y),right:new mg(y),top:new mg(y),bottom:new mg(y)},t[B._uuid]=B,T.SpriteFrame){var F=new T.SpriteFrame,U=m,x=new f_;x.image=U,F.texture=x,F._uuid="default-spriteframe",t[F._uuid]=F}},i.addAsset=function(t,i){this._resources[t]=i},i.get=function(t){return this._resources[t]},i.loadBuiltinAssets=function(){var t=this,i=Oi.querySettings("engine","builtinAssets");if(!i)return Promise.resolve();var n=this._resources;return new Promise((function(r,s){Pk.loadBundle("internal",(function(e){e?s(e):Pk.loadAny(i,(function(i,e){i?s(i):(e.forEach((function(i){n[i.name]=i,vb.addIgnoredAsset(i),i instanceof T.Material&&t._materialsToBeCompiled.push(i)})),r())}))}))}))},i.compileBuiltinMaterial=function(){for(var t=0;t<this._materialsToBeCompiled.length;++t)for(var i=this._materialsToBeCompiled[t],n=0;n<i.passes.length;++n)i.passes[n].tryCompile();this._materialsToBeCompiled.length=0},t}()),Fk=t("dQ",T.builtinResMgr=new Bk),Uk=t("cV",(Lk=new Map,Dk=0,function(t){return"number"==typeof t?t:(Lk.has(t)||(Lk.set(t,1<<Dk),Dk++),Lk.get(t))}));function xk(t,i){var n=t.sortRender,r=i.sortRender;return n.hash-r.hash||n.shaderId-r.shaderId}var Gk=t("cQ",function(){function t(t){this.instances=[],this.hasPendingModels=!1,this.dynamicOffsets=[],this.sortRender=void 0,this.Rh=t.device,this.pass=t,this.Mh=nm(),this.sortRender=this.Mh.add()}var i=t.prototype;return i.destroy=function(){this.instances.forEach((function(t){t.vb.destroy(),t.ia.destroy()})),this.Mh.reset(),this.instances.length=0},i.merge=function(t,i,n){void 0===n&&(n=null);var r=t.instancedAttributeBlock,s=r.buffer.length;if(s){var e=t.inputAssembler,h=t.descriptorSet,u=h.getTexture(Iy),o=h.getTexture(Dy),c=h.getTexture(xy),a=t.useReflectionProbeType,f=n;f||(f=t.shaders[i]);var v=t.descriptorSet,l=t.passes[i].priority<<16|t.priority<<8|i;this.sortRender.hash=l,this.sortRender.shaderId=f.typedID,this.sortRender.passIdx=i;for(var d=0;d<this.instances.length;++d){var w,g,p=this.instances[d];if(!((null==(w=p.ia.indexBuffer)?void 0:w.objectID)!==(null==(g=e.indexBuffer)?void 0:g.objectID)||p.count>=1024)&&p.lightingMap.objectID===u.objectID&&p.useReflectionProbeType===a&&p.reflectionProbeCubemap.objectID===o.objectID&&p.reflectionProbePlanarMap.objectID===c.objectID&&p.stride===s){if(p.count>=p.capacity){p.capacity<<=1;var _=p.stride*p.capacity,y=p.data;p.data=new Uint8Array(_),p.data.set(y),p.vb.resize(_)}return p.shader=f,p.descriptorSet=v,p.data.set(r.buffer,p.stride*p.count++),void(this.hasPendingModels=!0)}}for(var m=this.Rh.createBuffer(new $l(10,3,32*s,s)),b=new Uint8Array(32*s),k=e.vertexBuffers.slice(),A=e.attributes.slice(),E=e.indexBuffer,T=0;T<r.attributes.length;T++){var O=r.attributes[T],S=new ud(O.name,O.format,O.isNormalized,k.length,!0);A.push(S)}b.set(r.buffer),k.push(m);var I=new cd(A,k,E),R=this.Rh.createInputAssembler(I);this.instances.push({count:1,capacity:32,vb:m,data:b,ia:R,stride:s,shader:f,descriptorSet:v,lightingMap:u,reflectionProbeCubemap:o,reflectionProbePlanarMap:c,useReflectionProbeType:a,reflectionProbeBlendCubemap:null}),this.hasPendingModels=!0}},i.uploadBuffers=function(t){for(var i=0;i<this.instances.length;++i){var n=this.instances[i];n.count&&(n.ia.instanceCount=n.count,t.updateBuffer(n.vb,n.data))}},i.clear=function(){this.instances.forEach((function(t){t.count=0})),this.hasPendingModels=!1,this.Mh.reset()},t}()),jk=new $l(18,1),Hk=new zl(null),Vk=new kd(null),$k=function(){function t(t){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new cw,this._dss=new uw,this._rs=new hw,this._priority=128,this._stage=100,this._phase=Uk("default"),this._passID=4294967295,this._subpassID=4294967295,this._phaseID=4294967295,this._primitive=7,this._batchingScheme=0,this._dynamicStates=0,this._instancedBuffers={},this._hash=0,this._rootBufferDirty=!1,this._root=t,this._device=kw.gfxDevice}t.fillPipelineInfo=function(t,i){void 0!==i.priority&&(t._priority=i.priority),void 0!==i.primitive&&(t._primitive=i.primitive),void 0!==i.stage&&(t._stage=i.stage),void 0!==i.dynamicStates&&(t._dynamicStates=i.dynamicStates),void 0!==i.phase&&(t._phase=Uk(i.phase));var n=t._bs;if(i.blendState){var r=i.blendState,s=r.targets;s&&s.forEach((function(t,i){n.setTarget(i,t)})),void 0!==r.isA2C&&(n.isA2C=r.isA2C),void 0!==r.isIndepend&&(n.isIndepend=r.isIndepend),void 0!==r.blendColor&&(n.blendColor=r.blendColor)}t._rs.assign(i.rasterizerState),t._dss.assign(i.depthStencilState)},t.getPassHash=function(t){var i="";if(T.rendering&&T.rendering.enableEffectImport){var n=T.rendering.programLib.getKey(t._phaseID,t.program,t.defines);i=t._phaseID.toString()+","+n}else i=$m.getKey(t.program,t.defines);var r,s=i+","+t._primitive+","+t._dynamicStates;return s+=zk(t._bs),s+=Wk(t._dss),Sv(s+=",rs,"+(r=t._rs).cullMode+","+r.depthBias+","+r.isFrontFaceCCW,666)};var i=t.prototype;return i.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},i.getHandle=function(t,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var r=this._propertyHandleMap[t];return r?(n?r=fm(r,n):i&&(r=fm(r,um(r)-i)),r+i):0},i.getBinding=function(t){var i=this.getHandle(t);return i?om(i):-1},i.setUniform=function(t,i){var n=om(t),r=um(t),s=am(t),e=this.Ch(r,n);lm[r](e,i,s),this._rootBufferDirty=!0},i.getUniform=function(t,i){var n=om(t),r=um(t),s=am(t),e=this.Ch(r,n);return vm[r](e,i,s)},i.setUniformArray=function(t,i){for(var n=om(t),r=um(t),s=zd(r)>>2,e=this.Ch(r,n),h=am(t),u=0;u<i.length;u++,h+=s)null!==i[u]&&lm[r](e,i[u],h);this._rootBufferDirty=!0},i.bindTexture=function(t,i,n){this._descriptorSet.bindTexture(t,i,n||0)},i.bindSampler=function(t,i,n){this._descriptorSet.bindSampler(t,i,n||0)},i.setDynamicState=function(t,i){var n=this._dynamics[t];n&&n.value===i||(n.value=i,n.dirty=!0)},i.overridePipelineStates=function(){st(12102)},i.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()):ht(12006)},i.getInstancedBuffer=function(t){return void 0===t&&(t=0),this._instancedBuffers[t]||(this._instancedBuffers[t]=new Gk(this))},i.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var i=this._shaderInfo.blocks[t];this._buffers[i.binding].destroy()}for(var n in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[n].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy()},i.resetUniform=function(t){var i=this.getHandle(t);if(i){for(var n=um(i),r=om(i),s=am(i),e=cm(i),h=this.Ch(n,r),u=this._properties[t],o=u&&u.value||gm(n),c=(zd(n)>>2)*e,a=0;a+o.length<=c;a+=o.length)h.set(o,s+a);this._rootBufferDirty=!0}},i.resetTexture=function(t,i){var n=this.getHandle(t);if(n){var r,s=um(n),e=om(n),h=this._properties[t],u=h&&h.value,o=(r="string"==typeof u?Fk.get(""+u+pm(s)):u||Fk.get(gm(s)))&&r.getGFXTexture(),c=h&&void 0!==h.samplerHash?dw.unpackFromHash(h.samplerHash):r&&r.getSamplerInfo(),a=this._device.getSampler(c);this._descriptorSet.bindSampler(e,a,i||0),this._descriptorSet.bindTexture(e,o,i||0)}},i.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var i=this._shaderInfo.blocks[t],n=0,r=0;r<i.members.length;r++){for(var s=i.members[r],e=this.Ch(s.type,i.binding),h=this._properties[s.name],u=h&&h.value||gm(s.type),o=(zd(s.type)>>2)*s.count,c=0;c+u.length<=o;c+=u.length)e.set(u,n+c);n+=o}this._rootBufferDirty=!0},i.resetTextures=function(){var t=this;if(T.rendering)this._shaderInfo.descriptors[1].samplerTextures.forEach((function(i){for(var n=0;n<i.count;++n)t.resetTexture(i.name,n)}));else for(var i=0;i<this._shaderInfo.samplerTextures.length;i++)for(var n=this._shaderInfo.samplerTextures[i],r=0;r<n.count;r++)this.resetTexture(n.name,r)},i.tryCompile=function(){var i=this._root.pipeline;if(!i)return!1;if(this._syncBatchingScheme(),T.rendering&&T.rendering.enableEffectImport){var n=T.rendering.programLib,r=n.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);if(!r)return st(12103,this._programName),!1;this._shader=r.shader,this._pipelineLayout=n.getPipelineLayout(this.device,this._phaseID,this._programName)}else{var s=$m.getGFXShader(this._device,this._programName,this._defines,i);if(!s)return st(12104,this._programName),!1;this._shader=s,this._pipelineLayout=$m.getTemplateInfo(this._programName).pipelineLayout}return this._hash=t.getPassHash(this),!0},i.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._shader&&!this.tryCompile())return st(12105),null;if(!t)return this._shader;for(var i=this._root.pipeline,n=0;n<t.length;n++){var r=t[n];this._defines[r.name]=r.value}this._isBlend&&(this._defines.CC_IS_TRANSPARENCY_PASS=1);var s=null;if(T.rendering&&T.rendering.enableEffectImport){var e=T.rendering.programLib.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);e&&(s=e.shader)}else s=$m.getGFXShader(this._device,this._programName,this._defines,i);for(var h=0;h<t.length;h++){var u=t[h];delete this._defines[u.name]}return s},i.beginChangeStatesSilently=function(){},i.endChangeStatesSilently=function(){},i._doInit=function(i,n){var r;void 0===n&&(n=!1),this._priority=128,this._stage=100;var e=null==(r=T.rendering)?void 0:r.enableEffectImport;if(e){var h=T.rendering;if("number"==typeof i.phase?(this._passID=i._passID,this._subpassID=i._subpassID,this._phaseID=i._phaseID):(this._passID=h.getPassID(i.pass),this._passID!==h.INVALID_ID&&(i.subpass?(this._subpassID=h.getSubpassID(this._passID,i.subpass),this._phaseID=h.getPhaseID(this._subpassID,i.phase)):this._phaseID=h.getPhaseID(this._passID,i.phase))),this._passID===h.INVALID_ID)return void ht(12107,i.program);if(this._phaseID===h.INVALID_ID)return void ht(12108,i.program)}else"number"==typeof i.phase?this._passID=i._passID:i.pass&&"default"!==i.pass&&(ot(4294967295===this._passID,12110),this._passID=0);this._phase=Uk("default"),this._primitive=7,this._passIndex=i.passIndex,this._propertyIndex=void 0!==i.propertyIndex?i.propertyIndex:i.passIndex,this._programName=i.program,this._defines=n?s({},i.defines):i.defines,this._shaderInfo=e?T.rendering.programLib.getProgramInfo(this._phaseID,this._programName):$m.getTemplate(i.program),this._properties=i.properties||this._properties;var u=this._device;t.fillPipelineInfo(this,i),i.stateOverrides&&t.fillPipelineInfo(this,i.stateOverrides),Vk.layout=e?T.rendering.programLib.getMaterialDescriptorSetLayout(this._device,this._phaseID,i.program):$m.getDescriptorSetLayout(this._device,i.program),this._descriptorSet=this._device.createDescriptorSet(Vk);var o,c,a=this._shaderInfo.blocks;if(e){var f=T.rendering.programLib;o=f.getBlockSizes(this._phaseID,this._programName),c=f.getHandleMap(this._phaseID,this._programName)}else{var v=$m.getTemplateInfo(i.program);o=v.blockSizes,c=v.handleMap}if(e){var l=T.rendering.programLib.getShaderInfo(this._phaseID,this.program);this.Nh(u,l.blocks,o)}else this.Ph(u,a,o);var d=this._propertyHandleMap=c,w={};for(var g in this._properties){var p=this._properties[g];p.handleInfo&&(w[g]=this.getHandle.apply(this,p.handleInfo))}Object.assign(d,w)},i.Ph=function(t,i,n){for(var r=t.capabilities.uboOffsetAlignment,s=[],e=0,h=0,u=0;u<i.length;u++){var o=n[u];s.push(h),h+=Math.ceil(o/r)*r,e=o}var c=s[s.length-1]+16*Math.ceil(e/16);c&&(jk.size=16*Math.ceil(c/16),this._rootBuffer=t.createBuffer(jk),this._rootBlock=new ArrayBuffer(c));for(var a=0,f=0;a<i.length;a++){var v=i[a].binding,l=n[a];Hk.buffer=this._rootBuffer,Hk.offset=s[f++],Hk.range=16*Math.ceil(l/16);var d=this._buffers[v]=t.createBuffer(Hk);this._blocks[v]=new Float32Array(this._rootBlock,Hk.offset,l/4),this._blocksInt[v]=new Int32Array(this._blocks[v].buffer,this._blocks[v].byteOffset,this._blocks[v].length),this._descriptorSet.bindBuffer(v,d)}},i.Nh=function(t,i,n){for(var r=t.capabilities.uboOffsetAlignment,s=[],e=0,h=0,u=0;u<i.length;u++)if(1===i[u].set){var o=n[u];s.push(h),h+=Math.ceil(o/r)*r,e=o}if(0!==e){var c=s[s.length-1]+e;c&&(jk.size=16*Math.ceil(c/16),this._rootBuffer=t.createBuffer(jk),this._rootBlock=new ArrayBuffer(c))}for(var a=0,f=0;a<i.length;a++)if(1===i[a].set){var v=i[a].binding,l=n[a];Hk.buffer=this._rootBuffer,Hk.offset=s[f++],Hk.range=16*Math.ceil(l/16);var d=this._buffers[v]=t.createBuffer(Hk);this._blocks[v]=new Float32Array(this._rootBlock,Hk.offset,l/4),this._blocksInt[v]=new Int32Array(this._blocks[v].buffer,this._blocks[v].byteOffset,this._blocks[v].length),this._descriptorSet.bindBuffer(v,d)}},i._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(1)?this._batchingScheme=1:(this._defines.USE_INSTANCING=!1,this._batchingScheme=0):this._batchingScheme=0},i.Ch=function(t,i){return t<13?this._blocksInt[i]:this._blocks[i]},i.Lh=function(t,i,n){this._priority=t.priority,this._stage=t.stage,this._phase=t.phase,this._phaseID=t._phaseID,this._passID=t._passID,this._batchingScheme=t.batchingScheme,this._primitive=t.primitive,this._dynamicStates=t.dynamicStates,this._bs=t.blendState,this._dss=i,this._descriptorSet=t.descriptorSet,this._rs=t.rasterizerState,this._passIndex=t.passIndex,this._propertyIndex=t.propertyIndex,this._programName=t.program,this._defines=t.defines,this._shaderInfo=t._shaderInfo,this._properties=t._properties,this._blocks=t._blocks,this._blocksInt=t._blocksInt,this._dynamics=t._dynamics,this._shader=t._shader,T.rendering&&T.rendering.enableEffectImport?this._pipelineLayout=T.rendering.programLib.getPipelineLayout(this.device,this._phaseID,this._programName):this._pipelineLayout=$m.getTemplateInfo(this._programName).pipelineLayout,this._hash=t._hash^n},i.Dh=function(){this._hash=t.getPassHash(this)},i.Bh=function(t){this._rootBufferDirty=t},i.Fh=function(t){this._priority=t},r(t,[{key:"_isBlend",get:function(){return this.blendState.targets.some((function(t){return t.blend}))}},{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return T.rendering&&T.rendering.enableEffectImport?T.rendering.programLib.getLocalDescriptorSetLayout(this._device,this._phaseID,this._programName):$m.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"passID",get:function(){return this._passID}},{key:"phaseID",get:function(){return this._phaseID}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),t}();function zk(t){var i=",bs,"+t.isA2C;return t.targets.forEach((function(t){i+=",bt,"+t.blend+","+t.blendEq+","+t.blendAlphaEq+","+t.blendColorMask,i+=","+t.blendSrc+","+t.blendDst+","+t.blendSrcAlpha+","+t.blendDstAlpha})),i}function Wk(t){var i=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return i+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,i+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(i+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}$k.getTypeFromHandle=um,$k.getBindingFromHandle=om,$k.getCountFromHandle=cm,$k.getOffsetFromHandle=am;var Xk,Yk,Kk,qk,Qk,Jk,Zk,tA,iA,nA=t("cR",function(){function t(){}return t.getOrCreatePipelineState=function(t,i,n,r,s){var e=i.hash^r.hash^s.attributesHash^n.typedID,h=this.Uh.get(e);if(!h){var u=i.pipelineLayout,o=new Ed(s.attributes),c=new aw(n,u,r,o,i.rasterizerState,i.depthStencilState,i.blendState,i.primitive,i.dynamicStates);h=t.createPipelineState(c),this.Uh.set(e,h)}return h},t}());function rA(t,i){t.x=i.x*i.x,t.y=i.y*i.y,t.z=i.z*i.z}function sA(t){for(var i=t.length-1;i>=0;--i)if(t[i].window.swapchain)return}nA.Uh=new Map,new Ul,new Cl;var eA=new $s,hA=t("dH",(Xk=_o("cc.Material"),Yk=ic(Zm),Xk((qk=function(t){function i(i){var n;return(n=t.call(this,i)||this)._effectAsset=Qk&&Qk(),n._techIdx=Jk&&Jk(),n._defines=Zk&&Zk(),n._states=tA&&tA(),n._props=iA&&iA(),n._passes=[],n._hash=0,n}e(i,t),i.getHash=function(t){for(var i,n=0,r=w(t.passes);!(i=r()).done;)n^=i.value.hash;return n};var n=i.prototype;return n.initialize=function(t){this._passes.length?st(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this.xh(t),this.Gh())},n.reset=function(t){this.initialize(t)},n.destroy=function(){return this.jh(),t.prototype.destroy.call(this)},n.recompileShaders=function(){st(16370,this.name)},n.overridePipelineStates=function(){st(16371,this.name)},n.onLoaded=function(){this.Gh()},n.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var i=0;i<this._props.length;i++)this._props[i]={};if(t)for(var n,r=w(this._passes);!(n=r()).done;){var s=n.value;s.resetUBOs(),s.resetTextures()}},n.setProperty=function(t,i,n){var r=!1;if(void 0===n)for(var s=this._passes,e=s.length,h=0;h<e;h++){var u=s[h];this.Hh(u,t,i)&&(this._props[u.propertyIndex][t]=i,r=!0)}else{n>=this._passes.length&&st(16372,n);var o=this._passes[n];this.Hh(o,t,i)&&(this._props[o.propertyIndex][t]=i,r=!0)}r||st(16373,t)},n.getProperty=function(t,i){if(void 0===i)for(var n=this._props,r=n.length,s=0;s<r;s++){var e=n[s];if(t in e)return e[t]}else{if(i>=this._passes.length)return st(16372,i),null;var h=this._props[this._passes[i].propertyIndex];if(t in h)return h[t]}return null},n.copy=function(t,i){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var n=0;n<t._props.length;n++)this._props[n]=s({},t._props[n]);this._defines.length=t._defines.length;for(var r=0;r<t._defines.length;r++)this._defines[r]=s({},t._defines[r]);this._states.length=t._states.length;for(var e=0;e<t._states.length;e++)this._states[e]=s({},t._states[e]);this._effectAsset=t._effectAsset,i&&this.xh(i),this.Gh()},n.xh=function(t){void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=Zm.get(t.effectName)),t.defines&&this.Vh(t.defines,this._defines),t.states&&this.Vh(t.states,this._states)},n.Vh=function(t,i){var n=t;if(!Array.isArray(n)){var r=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(r).fill(n)}for(var s=0;s<n.length;++s)Object.assign(i[s]||(i[s]={}),n[s])},n.$h=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var i=t.passes.length,n=[],r=0;r<i;++r){var s=t.passes[r],e=s.passIndex=r,h=s.defines=this._defines[e]||(this._defines[e]={});if(s.stateOverrides=this._states[e]||(this._states[e]={}),void 0!==s.propertyIndex&&Object.assign(h,this._defines[s.propertyIndex]),void 0!==s.embeddedMacros&&Object.assign(h,s.embeddedMacros),!s.switch||h[s.switch]){var u=new $k(T.director.root);u.initialize(s),n.push(u)}}return n},n.Gh=function(t){var n=this;if(void 0===t&&(t=!0),this._effectAsset){this._passes=this.$h();var r=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=r,t)this._passes.forEach((function(t,i){var r=n._props[i];for(var s in r||(r=n._props[i]={}),void 0!==t.propertyIndex&&Object.assign(r,n._props[t.propertyIndex]),r)n.Hh(t,s,r[s])}));else for(var s=0;s<this._props.length;s++)this._props[s]={}}this._hash=i.getHash(this)},n.Hh=function(t,i,n){var r=this,s=t.getHandle(i);if(!s)return!1;if(um(s)<26)if(Array.isArray(n))t.setUniformArray(s,n);else if(null!==n){var e;if(null!=(e=t.properties[i])&&e.linear){var h=n;rA(eA,h),eA.w=h.w,n=eA}t.setUniform(s,n)}else t.resetUniform(i);else Array.isArray(n)?n.forEach((function(i,n){r.zh(t,s,i,n)})):n?this.zh(t,s,n):t.resetTexture(i);return!0},n.zh=function(t,i,n,r){var s=$k.getBindingFromHandle(i);if(n instanceof gw)t.bindTexture(s,n,r);else if(n instanceof Tg){var e=n.getGFXTexture();if(!e||!e.width||!e.height)return;t.bindTexture(s,e,r),t.bindSampler(s,n.getGFXSampler(),r)}},n.jh=function(){if(this._passes&&this._passes.length)for(var t,i=w(this._passes);!(t=i()).done;)t.value.destroy();this._passes.length=0},n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.initialize({effectName:"builtin-unlit",defines:{USE_COLOR:!0},technique:0}),this.setProperty("mainColor",new Qs("#ff00ff"))},n.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},r(i,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),i}(rg),Qk=uo(qk.prototype,"_effectAsset",[Yk],(function(){return null})),Jk=uo(qk.prototype,"_techIdx",[Co],(function(){return 0})),Zk=uo(qk.prototype,"_defines",[Co],(function(){return[]})),tA=uo(qk.prototype,"_states",[Co],(function(){return[]})),iA=uo(qk.prototype,"_props",[Co],(function(){return[]})),Kk=qk))||Kk));T.Material=hA;var uA=t("cW",(function(){this.quadIB=null,this.quadVB=null,this.quadIA=null})),oA=new $s,cA=_i({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),aA=cA.LAYERED+1,fA=function(){function t(){this._fogColor=new Qs("#C8C8C8"),this._colorArray=new $s(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2,this._activated=!1}var i=t.prototype;return i.initialize=function(t){this._activated=!1,this.fogColor=t.fogColor,this._enabled=t.enabled,this._type=this.enabled?t.type:aA,this._accurate=t.accurate,this.fogDensity=t.fogDensity,this.fogStart=t.fogStart,this.fogEnd=t.fogEnd,this.fogAtten=t.fogAtten,this.fogTop=t.fogTop,this.fogRange=t.fogRange},i.activate=function(){this._updatePipeline(),this._activated=!0},i._updatePipeline=function(){var t=T.director.root,i=this.enabled?this.type:aA,n=this.accurate?1:0,r=t.pipeline;r.macros.CC_USE_FOG===i&&r.macros.CC_USE_ACCURATE_FOG===n||(r.macros.CC_USE_FOG=i,r.macros.CC_USE_ACCURATE_FOG=n,this._activated&&t.onGlobalPipelineStateChanged())},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,t?this.activate():(this._type=aA,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._accurate=t,this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),oA.set(t.x,t.y,t.z,t.w),rA(this._colorArray,oA)}},{key:"type",get:function(){return this._type},set:function(t){this._type=this.enabled?t:aA,this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t}},{key:"colorArray",get:function(){return this._colorArray}}]),t}();function vA(){return T.director.root.pipeline.pipelineSceneData}T.Fog=fA;var lA=function(){function t(){this._groundAlbedoHDR=new $s(.2,.2,.2,1),this._skyColorHDR=new $s(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new $s(.2,.2,.2,1),this._skyColorLDR=new $s(.2,.5,.8,1),this._skyIllumLDR=0,this._mipmapCount=1,this._enabled=!1}return t.prototype.initialize=function(t){this._skyColorHDR=t.skyColorHDR,this._groundAlbedoHDR.set(t.groundAlbedoHDR),this._skyIllumHDR=t.skyIllumHDR,this._skyColorLDR=t.skyColorLDR,this._groundAlbedoLDR.set(t.groundAlbedoLDR),this._skyIllumLDR=t.skyIllumLDR},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"skyColor",get:function(){return vA().isHDR?this._skyColorHDR:this._skyColorLDR},set:function(t){vA().isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t)}},{key:"skyIllum",get:function(){return vA().isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){vA().isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t}},{key:"groundAlbedo",get:function(){return vA().isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(t){vA().isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t)}}]),t}();lA.SUN_ILLUM=65e3,lA.SKY_ILLUM=2e4,T.Ambient=lA;var dA=function(t){function i(i,n){var r;(r=t.call(this,i.root)||this).Wh=!1,r.Xh=i,r.Yh=n,r._doInit(r.Xh,!0),r._shaderInfo.blocks.forEach((function(t){var i=r._blocks[t.binding],n=r.Xh.blocks[t.binding];i.set(n)})),r._rootBufferDirty=!0;var s=r.Xh,e=r._descriptorSet;return r._shaderInfo.samplerTextures.forEach((function(t){for(var i=0;i<t.count;i++){var n=s._descriptorSet,r=t.binding,h=n.getSampler(r,i),u=n.getTexture(r,i);e.bindSampler(r,h,i),e.bindTexture(r,u,i)}})),t.prototype.tryCompile.call(v(r)),r}e(i,t);var n=i.prototype;return n.overridePipelineStates=function(t,i){this._bs.reset(),this._rs.reset(),this._dss.reset(),$k.fillPipelineInfo(this,t),$k.fillPipelineInfo(this,i),this._onStateChange()},n.tryCompile=function(i){if(i&&!_m(this._defines,i))return!1;var n=t.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this.Wh=!0},n.endChangeStatesSilently=function(){this.Wh=!1},n._syncBatchingScheme=function(){this._defines.USE_INSTANCING=!1,this._batchingScheme=0},n._onStateChange=function(){this._hash=$k.getPassHash(this),this.Yh.onPassStateChange(this.Wh)},r(i,[{key:"parent",get:function(){return this.Xh}}]),i}($k),wA=function(t){function i(i){var n;return(n=t.call(this)||this)._passes=[],n.Kh=0,n.Xh=i.parent,n.Yh=i.owner||null,n.Kh=i.subModelIdx||0,n.copy(n.Xh),n}e(i,t);var n=i.prototype;return n.recompileShaders=function(t,i){this._passes&&this.effectAsset&&(void 0===i?this._passes.forEach((function(i){i.tryCompile(t)})):this._passes[i].tryCompile(t))},n.overridePipelineStates=function(t,i){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===i)for(var r=0;r<this._passes.length;r++){var s=this._passes[r],e=this._states[r]||(this._states[r]={});for(var h in t)e[h]=t[h];s.overridePipelineStates(n[s.passIndex],e)}else{var u=this._states[i]||(this._states[i]={});for(var o in t)u[o]=t[o];this._passes[i].overridePipelineStates(n[i],u)}}},n.destroy=function(){return this.jh(),!0},n.onPassStateChange=function(t){this._hash=hA.getHash(this),!t&&this.Yh&&this.Yh.qh(this.Kh,this)},n.$h=function(){var t=[],i=this.Xh.passes;if(!i)return t;for(var n=0;n<i.length;++n)t.push(new dA(i[n],this));return t},r(i,[{key:"parent",get:function(){return this.Xh}},{key:"owner",get:function(){return this.Yh}}]),i}(hA),gA=null,pA=null,_A={HEMISPHERE_DIFFUSE:0,AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION:1,DIFFUSEMAP_WITH_REFLECTION:2};_i(_A);var yA=function(){function t(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1,this._editableMaterial=null,this._activated=!1,this._reflectionHDR=null,this._reflectionLDR=null,this._rotationAngle=0}var i=t.prototype;return i.initialize=function(t){this._activated=!1,this._enabled=t.enabled,this._useIBL=t.useIBL,this._useDiffuseMap=t.applyDiffuseMap,this._useHDR=t.useHDR},i.setEnvMaps=function(t,i){this._envmapHDR=t,this._envmapLDR=i,this._updateGlobalBinding(),this._updatePipeline()},i.setDiffuseMaps=function(t,i){this._diffuseMapHDR=t,this._diffuseMapLDR=i,this._updateGlobalBinding(),this._updatePipeline()},i.setSkyboxMaterial=function(t){t?(this._editableMaterial=new wA({parent:t}),this._editableMaterial.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})):this._editableMaterial=null,this._updatePipeline()},i.setReflectionMaps=function(t,i){this._reflectionHDR=t,this._reflectionLDR=i,this._updateGlobalBinding(),this._updatePipeline()},i.setRotationAngle=function(t){this._rotationAngle=t},i.getRotationAngle=function(){return this._rotationAngle},i.updateMaterialRenderInfo=function(){this._updateGlobalBinding(),this._updatePipeline()},i.activate=function(){var t=T.director.root.pipeline;this._globalDSManager=t.globalDSManager,this._default=Fk.get("default-cube-texture"),this._model||(this._model=T.director.root.createModel(T.renderer.scene.Model));var i=this._default.isRGBE;if(this._default.isUsingOfflineMipmaps(),this.envmap&&(i=this.envmap.isRGBE,this.envmap.isUsingOfflineMipmaps()),!pA){var n=new hA;n.initialize({effectName:"pipeline/skybox",defines:{USE_RGBE_CUBEMAP:i}}),pA=new wA({parent:n})}this.enabled&&(gA||(gA=T.utils.createMesh(T.primitives.box({width:2,height:2,length:2}))),this._editableMaterial?this._model.initSubModel(0,gA.renderingSubMeshes[0],this._editableMaterial):this._model.initSubModel(0,gA.renderingSubMeshes[0],pA)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline(),this._activated=!0},i._updatePipeline=function(){var t=T.director.root,i=t.pipeline,n=this.useIBL?this.isRGBE?2:1:0,r=this.useIBL&&this.useDiffuseMap&&this.diffuseMap&&this.diffuseMap!==this._default?this.isRGBE?2:1:0,s=this.useHDR,e=this.useConvolutionMap;if(i.macros.CC_USE_IBL===n&&i.macros.CC_USE_DIFFUSEMAP===r&&i.macros.CC_USE_HDR===s&&i.macros.CC_IBL_CONVOLUTED===e||(i.macros.CC_USE_IBL=n,i.macros.CC_USE_DIFFUSEMAP=r,i.macros.CC_USE_HDR=s,i.macros.CC_IBL_CONVOLUTED=e,this._activated&&t.onGlobalPipelineStateChanged()),this.enabled){var h=this.envmap?this.envmap:this._default,u=this._editableMaterial?this._editableMaterial:pA;u&&(u.setProperty("environmentMap",h),u.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})),this._model&&(this._model.setSubModelMaterial(0,u),this._updateSubModes())}},i._updateGlobalBinding=function(){if(!T.rendering&&this._globalDSManager){var t=kw.gfxDevice;if(this.reflectionMap){var i=this.reflectionMap.getGFXTexture(),n=t.getSampler(this.reflectionMap.getSamplerInfo());this._globalDSManager.bindSampler(5,n),this._globalDSManager.bindTexture(5,i)}else{var r=this.envmap?this.envmap:this._default;if(r){var s=r.getGFXTexture(),e=t.getSampler(r.getSamplerInfo());this._globalDSManager.bindSampler(5,e),this._globalDSManager.bindTexture(5,s)}}var h=this.diffuseMap?this.diffuseMap:this._default;if(h){var u=h.getGFXTexture(),o=t.getSampler(h.getSamplerInfo());this._globalDSManager.bindSampler(7,o),this._globalDSManager.bindTexture(7,u)}this._globalDSManager.update()}},i._updateSubModes=function(){if(this._model)for(var t=this._model.subModels,i=0;i<t.length;i++)t[i].update()},r(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,t?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(t){this._useHDR=t,this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(t){this._useIBL=t,this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(t){this._useDiffuseMap=t,this._updatePipeline()}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"useConvolutionMap",get:function(){return this.reflectionMap?this.reflectionMap.isUsingOfflineMipmaps():!!this.envmap&&this.envmap.isUsingOfflineMipmaps()}},{key:"envmap",get:function(){return vA().isHDR?this._envmapHDR:this._envmapLDR},set:function(t){vA().isHDR?this.setEnvMaps(t,this._envmapLDR):this.setEnvMaps(this._envmapHDR,t)}},{key:"diffuseMap",get:function(){return vA().isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){vA().isHDR?this.setDiffuseMaps(t,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,t)}},{key:"reflectionMap",get:function(){return vA().isHDR?this._reflectionHDR:this._reflectionLDR}},{key:"editableMaterial",get:function(){return this._editableMaterial}}]),t}();T.Skybox=yA;var mA=_i({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048}),bA=_i({Planar:0,ShadowMap:1}),kA=_i({HARD:0,SOFT:1,SOFT_2X:2,SOFT_4X:3}),AA=_i({LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4}),EA=_i({NONE:1,RemoveDuplicates:2,DisableRotationFix:3}),TA=bA.ShadowMap+1,OA=function(){function t(){this.fixedSphere=new De(0,0,0,.01),this.maxReceived=4,this._matLight=new ls,this._material=null,this._instancingMaterial=null,this._enabled=!1,this._type=TA,this._distance=0,this._planeBias=1,this._normal=new Ir(0,1,0),this._shadowColor=new Qs(0,0,0,76),this._size=new Ms(1024,1024),this._shadowMapDirty=!1}var i=t.prototype;return i.getPlanarShader=function(t){this._material||(this._material=new hA,this._material.initialize({effectName:"pipeline/planar-shadow"}));var i=this._material.passes;return i.length>0?i[0].getShaderVariant(t):null},i.initialize=function(t){this._enabled=t.enabled,this._type=this.enabled?t.type:TA,this.normal=t.planeDirection,this.distance=t.planeHeight,this.planeBias=t.planeBias,this.shadowColor=t.shadowColor,this.maxReceived=t.maxReceived,t.shadowMapSize!==this._size.x&&(this.size.set(t.shadowMapSize,t.shadowMapSize),this._shadowMapDirty=!0)},i.activate=function(){if(this._enabled)if(this.type===bA.Planar)this._updatePlanarInfo();else{var t=T.director.root;t.pipeline.macros.CC_SHADOW_TYPE=2,t.onGlobalPipelineStateChanged()}else{var i=T.director.root;i.pipeline.macros.CC_SHADOW_TYPE=0,i.onGlobalPipelineStateChanged()}},i._updatePlanarInfo=function(){this._material||(this._material=new hA,this._material.initialize({effectName:"pipeline/planar-shadow"}));var t=T.director.root;t.pipeline.macros.CC_SHADOW_TYPE=1,t.onGlobalPipelineStateChanged()},i.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t,this.activate()}},{key:"type",get:function(){return this._type},set:function(t){this._type=this.enabled?t:TA,this.activate()}},{key:"normal",get:function(){return this._normal},set:function(t){Ir.copy(this._normal,t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t}},{key:"planeBias",get:function(){return this._planeBias},set:function(t){this._planeBias=t}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t)}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(t){this._shadowMapDirty=t}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}}]),t}();OA.MAX_FAR=2e3,OA.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),T.Shadows=OA;var SA,IA=function(){function t(){this._enabled=!1,this._minPos=new Ir(0,0,0),this._maxPos=new Ir(0,0,0),this._depth=0}return t.prototype.initialize=function(t){this._enabled=t.enabled,this._minPos=t.minPos,this._maxPos=t.maxPos,this._depth=t.depth},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t}}]),t}(),RA=new ad;RA.format=35;var MA=new fd;MA.format=55;var CA,NA=new dd([RA],MA),PA={width:1,height:1,renderPassInfo:NA},LA=t("dI",_o("cc.RenderTexture")(SA=function(t){function i(i){var n;return(n=t.call(this,i)||this).Qh=null,n}e(i,t);var n=i.prototype;return n.initialize=function(t){this._name=t.name||"",this.Xn=t.width,this.Yn=t.height,this.Jh(t)},n.reset=function(t){this.initialize(t)},n.destroy=function(){if(this.Qh){var i=T.director.root;null==i||i.destroyWindow(this.Qh),this.Qh=null}return t.prototype.destroy.call(this)},n.resize=function(t,i){this.Xn=Math.floor(Gn(t,1,2048)),this.Yn=Math.floor(Gn(i,1,2048)),this.Qh&&this.Qh.resize(this.Xn,this.Yn),this.emit("resize",this.Qh)},n._serialize=function(){return{}},n._deserialize=function(i,n){var r=i;this.Xn=r.w,this.Yn=r.h,this._name=r.n,t.prototype._deserialize.call(this,r.base,n)},n.getGFXTexture=function(){return this.Qh&&this.Qh.framebuffer.colorTextures[0]},n.onLoaded=function(){this.Jh()},n.Jh=function(t){var i=T.director.root;PA.title=this._name,PA.width=this.Xn,PA.height=this.Yn,PA.renderPassInfo=t&&t.passInfo?t.passInfo:NA,PA.externalResLow=t&&t.externalResLow?t.externalResLow:0,PA.externalResHigh=t&&t.externalResHigh?t.externalResHigh:0,PA.externalFlag=t&&t.externalFlag?t.externalFlag:0,PA.renderPassInfo.colorAttachments.forEach((function(t){t.format=i.device.swapchainFormat})),RA.barrier=kw.gfxDevice.getGeneralBarrier(new gd(128,128)),this.Qh?(this.Qh.destroy(),this.Qh.initialize(kw.gfxDevice,PA)):this.Qh=i.createWindow(PA)},n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.Xn=this.Yn=1,this.Jh()},n.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},n.readPixels=function(t,i,n,r,s){t=t||0,i=i||0,n=n||this.width,r=r||this.height;var e=this.getGFXTexture();if(!e)return ht(7606),null;var h=4*n*r;if(void 0===s)s=new Uint8Array(h);else if(s.length<h)return ht(7607,h),null;var u=this._getGFXDevice(),o=[],c=[],a=new Fl;return a.texOffset.x=t,a.texOffset.y=i,a.texExtent.width=n,a.texExtent.height=r,c.push(a),o.push(s),null==u||u.copyTextureToBuffers(e,o,c),s},r(i,[{key:"window",get:function(){return this.Qh}}]),i}(Tg))||SA);T.RenderTexture=LA,sv(Tg.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),rv(LA.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this.window}}]);var DA=((CA={})[1]="Uint",CA[2]="Int",CA[3]="Uint",CA[4]="Int",CA[5]="Float",CA[6]="Float",CA.default="Uint",CA);function BA(t){return""+(DA[t.type]||DA.default)+t.size/t.count*8}function FA(t,i,n,r,s){void 0===n&&(n=11),void 0===r&&(r=0),void 0===s&&(s=0);var e=Fd[n];s||(s=e.size);for(var h="set"+BA(e),u=e.size/e.count,o=Math.floor(i.length/e.count),c=bh.isLittleEndian,a=0;a<o;++a)for(var f=r+s*a,v=0;v<e.count;++v){var l=f+u*v;t[h](l,i[e.count*a+v],c)}}function UA(t,i,n,r,s,e){void 0===i&&(i=11),void 0===n&&(n=0),void 0===r&&(r=t.byteLength-n),void 0===s&&(s=0),void 0===e&&(e=[]);var h=Fd[i];s||(s=h.size);for(var u="get"+BA(h),o=h.size/h.count,c=Math.floor(r/s),a=bh.isLittleEndian,f=0;f<c;++f)for(var v=n+s*f,l=0;l<h.count;++l){var d=v+o*l;e[h.count*f+l]=t[u](d,a)}return e}function xA(t,i,n,r,s,e,h){void 0===n&&(n=11),void 0===r&&(r=0),void 0===s&&(s=t.byteLength-r),void 0===e&&(e=0),h||(h=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));var u=Fd[n];e||(e=u.size);for(var o="set"+BA(u),c="get"+BA(u),a=u.size/u.count,f=Math.floor(s/e),v=bh.isLittleEndian,l=0;l<f;++l)for(var d=r+e*l,w=0;w<u.count;++w){var g=d+a*w,p=t[c](g,v);h[o](g,i(p,w,t),v)}return h}var GA={positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Ir.ZERO,max:Ir.ZERO}},jA=t("dz",function(){function t(t,i,n,r,s,e){void 0===r&&(r=null),void 0===s&&(s=null),void 0===e&&(e=!0),this.mesh=void 0,this.subMeshIdx=void 0,this.Zh=[],this.tu=void 0,this.iu=void 0,this.nu=void 0,this.ru=void 0,this.Qn=void 0,this.tr=null,this.Kn=i,this.Qn=t,this.Jn=r,this.Zn=s,this.su=n,this.eu=new cd(i,t,r,s),this.hu=e}var i=t.prototype;return i.invalidateGeometricInfo=function(){this.ru=void 0},i.genFlatBuffers=function(){if(!this.Zh.length&&this.mesh&&void 0!==this.subMeshIdx){var t=this.mesh,i=0,n=t.struct.primitives[this.subMeshIdx];n.indexView&&(i=n.indexView.count);for(var r=0;r<n.vertexBundelIndices.length;r++){var s=n.vertexBundelIndices[r],e=t.struct.vertexBundles[s],h=n.indexView?n.indexView.count:e.view.count,u=e.view.stride,o=u*h,c=new Uint8Array(t.data.buffer,e.view.offset,e.view.length),a=new Uint8Array(n.indexView?o:e.view.length);if(n.indexView){for(var f=t.readIndices(this.subMeshIdx),v=0;v<i;++v)for(var l=v*u,d=f[v]*u,w=0;w<u;++w)a[l+w]=c[d+w];this.Zh.push({stride:u,count:h,buffer:a})}else a.set(t.data.subarray(e.view.offset,e.view.offset+e.view.length)),this.Zh.push({stride:u,count:h,buffer:a})}}},i.destroy=function(){for(var t=0;t<this.vertexBuffers.length;t++)this.vertexBuffers[t].destroy();if(this.vertexBuffers.length=0,this.Jn&&(this.hu&&this.Jn.destroy(),this.Jn=null),this.tu&&this.iu){for(var i=0;i<this.iu.length;i++)this.tu[this.iu[i]].destroy();this.tu=void 0,this.iu=void 0}this.Zn&&(this.Zn.destroy(),this.Zn=null)},i.enableVertexIdChannel=function(t){if(!this.nu){var i=this.vertexBuffers.length,n=this.attributes.length,r=this.uu(t);this.Qn.push(r),this.Kn.push(new ud("a_vertexId",11,!1,i)),this.eu.attributes=this.Kn,this.eu.vertexBuffers=this.Qn,this.nu={stream:i,index:n}}},i.uu=function(t){for(var i=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(i),r=0;r<i;++r)n[r]=r+.5;var s=t.createBuffer(new $l(10,1,n.byteLength,n.BYTES_PER_ELEMENT));return s.update(n),s},r(t,[{key:"attributes",get:function(){return this.Kn}},{key:"vertexBuffers",get:function(){return this.Qn}},{key:"indexBuffer",get:function(){return this.Jn}},{key:"indirectBuffer",get:function(){return this.Zn}},{key:"primitiveMode",get:function(){return this.su}},{key:"geometricInfo",get:function(){if(this.ru)return this.ru;if(void 0===this.mesh)return GA;if(void 0===this.subMeshIdx)return GA;var t,i=this.mesh,n=this.subMeshIdx,r=this.attributes.find((function(t){return"a_position"===t.name}));if(!r)return GA;switch(r.format){case 21:case 32:if(!(t=i.readAttribute(n,"a_position")))return GA;break;case 44:var s=i.readAttribute(n,"a_position");if(!s)return GA;var e=s.length/4;t=new Float32Array(3*e);for(var h=0;h<e;++h){var u=3*h,o=4*h;t[u]=s[o],t[u+1]=s[o+1],t[u+2]=s[o+2]}break;case 18:case 29:var c=i.readAttribute(n,"a_position");if(!c)return GA;t=new Float32Array(c.length);for(var a=0;a<c.length;++a)t[a]=fr(c[a]);break;case 41:var f=i.readAttribute(n,"a_position");if(!f)return GA;var v=f.length/4;t=new Float32Array(3*v);for(var l=0;l<v;++l){var d=3*l,w=4*l;t[d]=fr(f[w]),t[d+1]=fr(f[w+1]),t[d+2]=fr(f[w+2])}break;default:return GA}var g=i.readIndices(n)||void 0,p=new Ir,_=new Ir,y=Fd[r.format].count;2===y?(p.set(t[0],t[1],0),_.set(t[0],t[1],0)):(p.set(t[0],t[1],t[2]),_.set(t[0],t[1],t[2]));for(var m=0;m<t.length;m+=y)2===y?(p.x=t[m]>p.x?t[m]:p.x,p.y=t[m+1]>p.y?t[m+1]:p.y,_.x=t[m]<_.x?t[m]:_.x,_.y=t[m+1]<_.y?t[m+1]:_.y):(p.x=t[m]>p.x?t[m]:p.x,p.y=t[m+1]>p.y?t[m+1]:p.y,p.z=t[m+2]>p.z?t[m+2]:p.z,_.x=t[m]<_.x?t[m]:_.x,_.y=t[m+1]<_.y?t[m+1]:_.y,_.z=t[m+2]<_.z?t[m+2]:_.z);return this.ru={positions:t,indices:g,boundingBox:{max:p,min:_}},this.ru}},{key:"drawInfo",get:function(){return this.tr},set:function(t){this.tr=t}},{key:"flatBuffers",get:function(){return this.Zh}},{key:"jointMappedBuffers",get:function(){var t=this;if(this.tu)return this.tu;var i=this.tu=[],n=this.iu=[];if(!this.mesh||void 0===this.subMeshIdx)return this.tu=this.vertexBuffers;var r,s,e=this.mesh.struct,h=e.primitives[this.subMeshIdx];if(!e.jointMaps||void 0===h.jointMapIndex||!e.jointMaps[h.jointMapIndex])return this.tu=this.vertexBuffers;for(var u=T.director.root.device,o=function(){var o=e.vertexBundles[h.vertexBundelIndices[c]];s=0,r=0;for(var a=0;a<o.attributes.length;a++){var f=o.attributes[a];if("a_joints"===f.name){r=f.format;break}s+=Fd[f.format].size}if(r){var v=new Uint8Array(t.mesh.data.buffer,o.view.offset,o.view.length),l=new DataView(v.slice().buffer),d=e.jointMaps[h.jointMapIndex];xA(l,(function(t){return d.indexOf(t)}),r,s,o.view.length,o.view.stride,l);var w=u.createBuffer(new $l(10,1,o.view.length,o.view.stride));w.update(l.buffer),i.push(w),n.push(c)}else i.push(t.vertexBuffers[h.vertexBundelIndices[c]])},c=0;c<h.vertexBundelIndices.length;c++)o();return this.nu&&i.push(this.uu(u)),i}},{key:"iaInfo",get:function(){return this.eu}}]),t}()),HA=function(){var t=i.prototype;function i(t){this.ou=null,this.au=1,this.fu=1,this.colorDirty=!0,this._uiTransformComp=null,this.vu=null,this.lu=t}return t.wu=function(t){this.au=t},t.applyOpacity=function(t){this.au=this.fu*t},i.markOpacityTree=function(){},r(i,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this.lu.getComponent("cc.UITransform")),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this.ou},set:function(t){this.ou&&t?st(12002):this.ou=t}},{key:"opacity",get:function(){return this.au}},{key:"localOpacity",get:function(){return this.fu},set:function(t){this.fu=t,this.colorDirty=!0}}]),i}();O.GAME_VIEW;var VA=t("d3",{LOCAL:0,WORLD:1}),$A=t("d4",{NONE:0,POSITION:1,ROTATION:2,SCALE:4,SKEW:8,RS:6,RSS:14,TRS:7,TRS_MASK:-8});O.internal.TransformBit=$A;var zA=t("d5",_i({Static:0,Stationary:1,Movable:2})),WA=t("d6",{TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_WHEEL:"mouse-wheel",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave",KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",TRANSFORM_CHANGED:"transform-changed",MOBILITY_CHANGED:"mobility-changed",SCENE_CHANGED_FOR_PERSISTS:"scene-changed-for-persists",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",PARENT_CHANGED:"parent-changed",NODE_DESTROYED:"node-destroyed",LAYER_CHANGED:"layer-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed",CHILDREN_ORDER_CHANGED:"sibling-order-changed",ACTIVE_IN_HIERARCHY_CHANGED:"active-in-hierarchy-changed",COMPONENT_ADDED:"component-added",COMPONENT_REMOVED:"component-removed",LIGHT_PROBE_CHANGED:"light-probe-changed",LIGHT_PROBE_BAKING_CHANGED:"light-probe-baking-changed",ACTIVE_CHANGED:"active-changed"}),XA=t("dT",function(){function t(t,i){this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=t,this.bubbles=!!i}var i=t.prototype;return i.unuse=function(){this.type=t.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=t.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},i.reuse=function(t,i){this.type=t,this.bubbles=i||!1},i.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},i.getCurrentTarget=function(){return this.currentTarget},i.getType=function(){return this.type},t}());XA.NO_TYPE="no_type",XA.TOUCH="touch",XA.MOUSE="mouse",XA.KEYBOARD="keyboard",XA.ACCELERATION="acceleration",XA.NONE=0,XA.CAPTURING_PHASE=1,XA.AT_TARGET=2,XA.BUBBLING_PHASE=3,T.Event=XA;var YA=t("dU",function(t){function i(i,n){var r;return(r=t.call(this,"devicemotion",n)||this).acc=i,r}return e(i,t),i}(XA));XA.EventAcceleration=YA;var KA=t("dV",function(t){function i(i,n,r){var s;return"boolean"==typeof n&&(n=n?"keydown":"keyup"),(s=t.call(this,n,r)||this).rawEvent=void 0,s.gu="keyup"!==n,"number"==typeof i?s.keyCode=i:(s.keyCode=i.keyCode,s.rawEvent=i),s.windowId=0,s}return e(i,t),r(i,[{key:"isPressed",get:function(){return this.gu}}]),i}(XA));XA.EventKeyboard=KA;var qA=t("dW",function(t){function i(n,r,s,e){var h;return(h=t.call(this,n,r)||this).movementX=0,h.movementY=0,h.windowId=0,h.preventSwallow=!1,h.pu=i.BUTTON_MISSING,h.Re=0,h.Me=0,h._u=0,h.yu=0,h.mu=0,h.bu=0,h.ku=n,s&&(h._u=s.x,h.yu=s.y),h.windowId=null!=e?e:h.windowId,h}e(i,t);var n=i.prototype;return n.setScrollData=function(t,i){this.mu=t,this.bu=i},n.getScrollX=function(){return this.mu},n.getScrollY=function(){return this.bu},n.setLocation=function(t,i){this.Re=t,this.Me=i},n.getLocation=function(t){return t||(t=new Ms),Ms.set(t,this.Re,this.Me),t},n.getLocationInView=function(t){return t||(t=new Ms),Ms.set(t,this.Re,T.view._designResolutionSize.height-this.Me),t},n.getUILocation=function(t){return t||(t=new Ms),Ms.set(t,this.Re,this.Me),T.view.zt(t),t},n.getPreviousLocation=function(t){return t||(t=new Ms),Ms.set(t,this._u,this.yu),t},n.getUIPreviousLocation=function(t){return t||(t=new Ms),Ms.set(t,this._u,this.yu),T.view.zt(t),t},n.getDelta=function(t){return t||(t=new Ms),Ms.set(t,this.Re-this._u,this.Me-this.yu),t},n.getDeltaX=function(){return this.Re-this._u},n.getDeltaY=function(){return this.Me-this.yu},n.getUIDelta=function(t){t||(t=new Ms);var i=T.view;return Ms.set(t,(this.Re-this._u)/i.getScaleX(),(this.Me-this.yu)/i.getScaleY()),t},n.getUIDeltaX=function(){return(this.Re-this._u)/T.view.getScaleX()},n.getUIDeltaY=function(){return(this.Me-this.yu)/T.view.getScaleY()},n.setButton=function(t){this.pu=t},n.getButton=function(){return this.pu},n.getLocationX=function(){return this.Re},n.getLocationY=function(){return this.Me},n.getUILocationX=function(){var t=T.view,i=t.getViewportRect();return(this.Re-i.x)/t.getScaleX()},n.getUILocationY=function(){var t=T.view,i=t.getViewportRect();return(this.Me-i.y)/t.getScaleY()},r(i,[{key:"eventType",get:function(){return this.ku}}]),i}(XA));qA.BUTTON_MISSING=-1,qA.BUTTON_LEFT=0,qA.BUTTON_RIGHT=2,qA.BUTTON_MIDDLE=1,qA.BUTTON_4=3,qA.BUTTON_5=4,qA.BUTTON_6=5,qA.BUTTON_7=6,qA.BUTTON_8=7,XA.EventMouse=qA;var QA=new Ms,JA=t("dX",function(t){function i(i,n,r,s){var e;return void 0===s&&(s=[]),(e=t.call(this,r,n)||this).touch=null,e.simulate=!1,e.windowId=0,e.preventSwallow=!1,e.Au=r,e.Eu=i||[],e.Tu=s,e}e(i,t);var n=i.prototype;return n.getEventCode=function(){return this.Au},n.getTouches=function(){return this.Eu},n.getAllTouches=function(){return this.Tu},n.setLocation=function(t,i){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,i)},n.getLocation=function(t){return this.touch?this.touch.getLocation(t):new Ms},n.getUILocation=function(t){return this.touch?this.touch.getUILocation(t):new Ms},n.getLocationInView=function(t){return this.touch?this.touch.getLocationInView(t):new Ms},n.getPreviousLocation=function(t){return this.touch?this.touch.getPreviousLocation(t):new Ms},n.getStartLocation=function(t){return this.touch?this.touch.getStartLocation(t):new Ms},n.getUIStartLocation=function(t){return this.touch?this.touch.getUIStartLocation(t):new Ms},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(t){return this.touch?this.touch.getDelta(t):new Ms},n.getUIDelta=function(t){return this.touch?this.touch.getUIDelta(t):new Ms},n.getDeltaX=function(){return this.touch?this.touch.getDelta(QA).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(QA).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},i}(XA));JA.MAX_TOUCHES=5,XA.EventTouch=JA;var ZA=t("dY",function(t){function i(i,n){var r;return(r=t.call(this,i,!1)||this).gamepad=n,r}return e(i,t),i}(XA)),tE=t("dZ",function(t){function i(i,n){var r;return(r=t.call(this,i,!1)||this).handleInputDevice=n,r}return e(i,t),i}(XA)),iE=t("d_",function(t){function i(i,n){var r;return(r=t.call(this,i,!1)||this).hmdInputDevice=n,r}return e(i,t),i}(XA)),nE=(t("d$",function(t){function i(i,n){var r;return(r=t.call(this,i,!1)||this).handheldInputDevice=n,r}return e(i,t),i}(XA)),t("e0",(function(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=i,this.z=n,this.timestamp=r}))),rE=t("dS",{TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_WHEEL:"mouse-wheel",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave",KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",TRANSFORM_CHANGED:"transform-changed",SCENE_CHANGED_FOR_PERSISTS:"scene-changed-for-persists",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",PARENT_CHANGED:"parent-changed",NODE_DESTROYED:"node-destroyed",LAYER_CHANGED:"layer-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"});T.SystemEventType=rE,t("e1",{NONE:0,MOBILE_BACK:6,BACKSPACE:8,TAB:9,ENTER:13,SHIFT_LEFT:16,CTRL_LEFT:17,ALT_LEFT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,INSERT:45,DELETE:46,DIGIT_0:48,DIGIT_1:49,DIGIT_2:50,DIGIT_3:51,DIGIT_4:52,DIGIT_5:53,DIGIT_6:54,DIGIT_7:55,DIGIT_8:56,DIGIT_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,NUM_0:96,NUM_1:97,NUM_2:98,NUM_3:99,NUM_4:100,NUM_5:101,NUM_6:102,NUM_7:103,NUM_8:104,NUM_9:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_SUBTRACT:109,NUM_DECIMAL:110,NUM_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,BACK_QUOTE:192,BRACKET_LEFT:219,BACKSLASH:220,BRACKET_RIGHT:221,QUOTE:222,SHIFT_RIGHT:2e3,CTRL_RIGHT:2001,ALT_RIGHT:2002,NUM_ENTER:2003});var sE=new Ms,eE=t("e2",function(){function t(t,i,n){void 0===n&&(n=0),this.Ou=new Ms,this.Su=new Ms,this.Iu=0,this.ps=0,this.Ru=new Ms,this.Mu=!1,this.setTouchInfo(n,t,i)}var i=t.prototype;return i.getLocation=function(t){return t||(t=new Ms),t.set(this.Ou.x,this.Ou.y),t},i.getLocationX=function(){return this.Ou.x},i.getLocationY=function(){return this.Ou.y},i.getUILocation=function(t){return t||(t=new Ms),t.set(this.Ou.x,this.Ou.y),T.view.zt(t),t},i.getUILocationX=function(){var t=T.view,i=t.getViewportRect();return(this.Ou.x-i.x)/t.getScaleX()},i.getUILocationY=function(){var t=T.view,i=t.getViewportRect();return(this.Ou.y-i.y)/t.getScaleY()},i.getPreviousLocation=function(t){return t||(t=new Ms),t.set(this.Su.x,this.Su.y),t},i.getUIPreviousLocation=function(t){return t||(t=new Ms),t.set(this.Su.x,this.Su.y),T.view.zt(t),t},i.getStartLocation=function(t){return t||(t=new Ms),t.set(this.Ru.x,this.Ru.y),t},i.getUIStartLocation=function(t){return t||(t=new Ms),t.set(this.Ru.x,this.Ru.y),T.view.zt(t),t},i.getDelta=function(t){return t||(t=new Ms),t.set(this.Ou),t.subtract(this.Su),t},i.getUIDelta=function(t){t||(t=new Ms),sE.set(this.Ou),sE.subtract(this.Su);var i=T.view;return t.set(i.getScaleX(),i.getScaleY()),Ms.divide(t,sE,t),t},i.getLocationInView=function(t){return t||(t=new Ms),t.set(this.Ou.x,T.view._designResolutionSize.height-this.Ou.y),t},i.getPreviousLocationInView=function(t){return t||(t=new Ms),t.set(this.Su.x,T.view._designResolutionSize.height-this.Su.y),t},i.getStartLocationInView=function(t){return t||(t=new Ms),t.set(this.Ru.x,T.view._designResolutionSize.height-this.Ru.y),t},i.getID=function(){return this.ps},i.setTouchInfo=function(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.Su=this.Ou,this.Ou=new Ms(i||0,n||0),this.ps=t,this.Mu||(this.Ru=new Ms(this.Ou),this.Mu=!0)},i.setPoint=function(t,i){"object"==typeof t?(this.Ou.x=t.x,this.Ou.y=t.y):(this.Ou.x=t||0,this.Ou.y=i||0),this.Iu=T.game.frameStartTime},i.setPrevPoint=function(t,i){this.Su="object"==typeof t?new Ms(t.x,t.y):new Ms(t||0,i||0),this.Iu=T.game.frameStartTime},i.clone=function(){var i=this.getID();this.getStartLocation(sE);var n=new t(sE.x,sE.y,i);return this.getLocation(sE),n.setPoint(sE.x,sE.y),this.getPreviousLocation(sE),n.setPrevPoint(sE),n},r(t,[{key:"lastModified",get:function(){return this.Iu}}]),t}());T.Touch=eE;var hE,uE,oE,cE,aE,fE,vE,lE,dE,wE,gE,pE,_E,yE,mE,bE,kE,AE=new xe((function(){return new Array(16)}),3),EE=null,TE=new Ms,OE=["touch-start","touch-move","touch-end","touch-cancel"],SE=["mouse-down","mouse-enter","mouse-move","mouse-leave","mouse-up","mouse-wheel"],IE=new rh,RE=function(){function t(t){this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this.Cu=null,this.Nu=!1,this.Pu=!1,this.lu=t}var i=t.prototype;return i.setEnabled=function(t,i){if(void 0===i&&(i=!1),this.Nu!==t){this.Nu=t;var n=this.node.children;if(t&&this.Lu(),IE.emit(2),i&&n.length>0)for(var r=0;r<n.length;++r)n[r].eventProcessor.setEnabled(t,!0)}},i.reattach=function(){this.node.walk((function(i){var n=i.eventProcessor,r=n.Du(t._maskComp);n.maskList=r}))},i.destroy=function(){if(EE===this.lu&&(EE=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),IE.emit(1,this),this.Cu){var t=new JA([this.Cu],!0,"touch-cancel");t.touch=this.Cu,this.dispatchEvent(t),this.Cu=null}},i.on=function(t,i,n,r){var s,e;return this.Bu(t),((r=!!r)?null!==(s=this.capturingTarget)&&void 0!==s?s:this.capturingTarget=this.Fu():null!==(e=this.bubblingTarget)&&void 0!==e?e:this.bubblingTarget=this.Fu()).on(t,i,n),i},i.once=function(t,i,n,r){var s,e;return this.Bu(t),((r=!!r)?null!==(s=this.capturingTarget)&&void 0!==s?s:this.capturingTarget=this.Fu():null!==(e=this.bubblingTarget)&&void 0!==e?e:this.bubblingTarget=this.Fu()).on(t,i,n,!0),i},i.off=function(t,i,n,r){var s;null==(s=(r=!!r)?this.capturingTarget:this.bubblingTarget)||s.off(t,i,n)},i.targetOff=function(t){var i,n;null==(i=this.capturingTarget)||i.removeAll(t),null==(n=this.bubblingTarget)||n.removeAll(t),this.shouldHandleEventTouch&&!this.Uu()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this.xu()&&(this.shouldHandleEventMouse=!1),this.Gu()||IE.emit(1,this)},i.emit=function(t,i,n,r,s,e){var h;null==(h=this.bubblingTarget)||h.emit(t,i,n,r,s,e)},i.dispatchEvent=function(t){var i,n=this.node,r=0;t.target=n;var s=AE.alloc();for(s.length=0,this.getCapturingTargets(t.type,s),t.eventPhase=1,r=s.length-1;r>=0;--r)if((i=s[r]).eventProcessor.capturingTarget&&(t.currentTarget=i,i.eventProcessor.capturingTarget.emit(t.type,t,s),t.propagationStopped))return void AE.free(s);if(t.eventPhase=2,t.currentTarget=n,this.capturingTarget&&this.capturingTarget.emit(t.type,t),!t.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(s.length=0,this.getBubblingTargets(t.type,s),t.eventPhase=3,r=0;r<s.length;++r)if((i=s[r]).eventProcessor.bubblingTarget&&(t.currentTarget=i,i.eventProcessor.bubblingTarget.emit(t.type,t),t.propagationStopped))return void AE.free(s);AE.free(s)},i.hasEventListener=function(t,i,n){var r=!1;return this.bubblingTarget&&(r=this.bubblingTarget.hasEventListener(t,i,n)),!r&&this.capturingTarget&&(r=this.capturingTarget.hasEventListener(t,i,n)),r},i.getCapturingTargets=function(t,i){for(var n=this.lu.parent;n;){var r;null!=(r=n.eventProcessor.capturingTarget)&&r.hasEventListener(t)&&i.push(n),n=n.parent}},i.getBubblingTargets=function(t,i){for(var n=this.lu.parent;n;){var r;null!=(r=n.eventProcessor.bubblingTarget)&&r.hasEventListener(t)&&i.push(n),n=n.parent}},i.onUpdatingSiblingIndex=function(){IE.emit(2)},i.Du=function(t){var i=this.node;if(t){for(var n=0,r=[],s=i;s&&T.Node.isNode(s);s=s.parent,++n){var e=s.getComponent(t);if(e){var h={index:n,comp:e};r?r.push(h):r=[h]}}return r.length>0?r:null}return null},i.Lu=function(){this.maskList=this.Du(t._maskComp)},i.ju=function(t){return-1!==OE.indexOf(t)},i.Hu=function(t){return-1!==SE.indexOf(t)},i.Uu=function(){for(var t=0;t<OE.length;++t){var i=OE[t];if(this.hasEventListener(i))return!0}return!1},i.xu=function(){for(var t=0;t<SE.length;++t){var i=SE[t];if(this.hasEventListener(i))return!0}return!1},i.Gu=function(){return!!this.Uu()||this.xu()},i.Bu=function(t){var i=this.ju(t),n=this.Hu(t);i?this.shouldHandleEventTouch=!0:n&&(this.shouldHandleEventMouse=!0),!i&&!n||this.Gu()||IE.emit(0,this)},i.Fu=function(){var t=this,i=new rh;return i.ut((function(){t.shouldHandleEventTouch&&!t.Uu()&&(t.shouldHandleEventTouch=!1),t.shouldHandleEventMouse&&!t.xu()&&(t.shouldHandleEventMouse=!1),t.Gu()||IE.emit(1,t)})),i},i.Vu=function(t){switch(t.type){case"mouse-down":return this.$u(t);case"mouse-move":return this.zu(t);case"mouse-up":return this.Wu(t);case"mouse-wheel":return this.Xu(t);case"mouse-leave-window":return this.Yu(t);case"mouse-enter-window":return this.Ku(t);default:return!1}},i.$u=function(t){var i=this.lu,n=i.qu();return!(!i||!n||(t.getLocation(TE),!n.hitTest(TE,t.windowId)||(t.type="mouse-down",t.bubbles=!0,i.dispatchEvent(t),t.propagationStopped=!0,0)))},i.zu=function(t){var i=this.lu,n=i.qu();return!(!i||!n||this.Pu||(t.getLocation(TE),n.hitTest(TE,t.windowId)?(this.previousMouseIn||(EE&&EE!==i&&(t.type="mouse-leave",EE.dispatchEvent(t),EE.eventProcessor.previousMouseIn=!1),EE=i,t.type="mouse-enter",i.dispatchEvent(t),this.previousMouseIn=!0),t.type="mouse-move",t.bubbles=!0,i.dispatchEvent(t),t.propagationStopped=!0,0):(this.previousMouseIn&&(t.type="mouse-leave",i.dispatchEvent(t),this.previousMouseIn=!1,EE=null),1)))},i.Wu=function(t){var i=this.lu,n=i.qu();return!(!i||!n||(t.getLocation(TE),!n.hitTest(TE,t.windowId)||(t.type="mouse-up",t.bubbles=!0,i.dispatchEvent(t),t.propagationStopped=!0,0)))},i.Xu=function(t){var i=this.lu,n=i.qu();return!(!i||!n||(t.getLocation(TE),!n.hitTest(TE,t.windowId)||(t.type="mouse-wheel",t.bubbles=!0,i.dispatchEvent(t),t.propagationStopped=!0,0)))},i.Yu=function(t){return this.Pu=!0,this.previousMouseIn&&(t.type="mouse-leave",this.lu.dispatchEvent(t),this.previousMouseIn=!1,EE=null),!1},i.Ku=function(){return this.Pu=!1,!1},i.Qu=function(t){try{switch(t.type){case"touch-start":return this.Ju(t);case"touch-move":return this.Zu(t);case"touch-end":return this.io(t);case"touch-cancel":return this.no(t);default:return!1}}catch(t){throw this.claimedTouchIdList.length=0,t}},i.Ju=function(t){var i=this.node,n=i.qu();return!(!i||!n||(t.getLocation(TE),!n.hitTest(TE,t.windowId)||(t.type="touch-start",t.bubbles=!0,this.Cu=t.touch,i.dispatchEvent(t),0)))},i.Zu=function(t){var i=this.node;return!(!i||!i.qu()||(t.type="touch-move",t.bubbles=!0,this.Cu=t.touch,i.dispatchEvent(t),0))},i.io=function(t){var i=this.node,n=i.qu();i&&n&&(t.getLocation(TE),n.hitTest(TE,t.windowId)?t.type="touch-end":t.type="touch-cancel",t.bubbles=!0,i.dispatchEvent(t),this.Cu=null)},i.no=function(t){var i=this.node;i&&i.qu()&&(t.type="touch-cancel",t.bubbles=!0,i.dispatchEvent(t),this.Cu=null)},r(t,[{key:"isEnabled",get:function(){return this.Nu}},{key:"node",get:function(){return this.lu}}]),t}();RE._maskComp=null,RE.callbacksInvoker=IE,T.NodeEventProcessor=RE;var ME=128,CE="transform-changed",NE="active-changed",PE=new wt("Node");function LE(t){return t?"string"==typeof t?ti(t):t:(ht(3804),null)}var DE=Rr(),BE=Rr(),FE=ss(),UE=ss(),xE=ss(),GE=new Dr,jE=gs(),HE=gs(),VE=[],$E=Symbol("ReserveContentsForAllSyncablePrefab"),zE=0,WE=t("cX",(hE=_o("cc.Node"),uE=ic(Ir),oE=ic(zA),hE((kE=function(t){e(n,t);var i=n.prototype;function n(i){var n;return void 0===i&&(i="New Node"),(n=t.call(this,i)||this)._parent=fE&&fE(),n._children=vE&&vE(),n._active=lE&&lE(),n._components=dE&&dE(),n._prefab=wE&&wE(),n._scene=null,n._activeInHierarchy=!1,n._id=PE.getNewId(),n._eventProcessor=new RE(v(n)),n._eventMask=0,n._siblingIndex=0,n._originalSceneId="",n._uiProps=new HA(v(n)),n._static=!1,n._lpos=gE&&gE(),n._lrot=pE&&pE(),n._lscale=_E&&_E(),n._mobility=yE&&yE(),n._layer=mE&&mE(),n._euler=bE&&bE(),n._transformFlags=15,n._eulerDirty=!1,n._flagChangeVersion=0,n._hasChangedFlags=0,n._pos=new Ir,n._rot=new Qr,n._scale=new Ir(1,1,1),n._mat=new ls,n}return i.ro=function(t){this._activeInHierarchy=t},n.so=function(t){t._updateScene()},n._incSkewCompCount=function(){},n._decSkewCompCount=function(){},n._findComponent=function(t,i){var n=i,r=t._components;if(n._sealed)for(var s=0;s<r.length;++s){var e=r[s];if(e.constructor===i)return e}else for(var h=0;h<r.length;++h){var u=r[h];if(u instanceof i)return u}return null},n.eo=function(t,i,n){var r=i,s=t._components;if(r._sealed)for(var e=0;e<s.length;++e){var h=s[e];h.constructor===i&&n.push(h)}else for(var u=0;u<s.length;++u){var o=s[u];o instanceof i&&n.push(o)}},n.ho=function(t,i){for(var r=0;r<t.length;++r){var s=t[r],e=n._findComponent(s,i);if(e)return e;if(s._children.length>0&&(e=n.ho(s._children,i)))return e}return null},n.uo=function(t,i,r){for(var s=0;s<t.length;++s){var e=t[s];n.eo(e,i,r),e._children.length>0&&n.uo(e._children,i,r)}},i.oo=function(){return this._components},i._updateScene=function(){null==this._parent?ht(1640,this.name,this.uuid):this._scene=this._parent._scene},i.attr=function(t){xt(this,t)},i.getParent=function(){return this._parent},i.co=function(t){this._parent=t},i.setParent=function(t,i){if(void 0===i&&(i=!1),i&&this.updateWorldTransform(),this._parent!==t){var n=this._parent,r=t;if(this._parent=r,this._siblingIndex=0,this._onSetParent(n,i),this.emit&&this.emit("parent-changed",n),n&&!(n._objFlags&ME)){var s=n._children.indexOf(this);n._children.splice(s,1),n._updateSiblingIndex(),n.emit&&n.emit("child-removed",this)}r&&(r._children.push(this),this._siblingIndex=r._children.length-1,r.emit&&r.emit("child-added",this)),this._onHierarchyChanged(n)}},i.getChildByUuid=function(t){if(!t)return z("Invalid uuid"),null;for(var i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._id===t)return i[n];return null},i.getChildByName=function(t){if(!t)return z("Invalid name"),null;for(var i=this._children,n=0,r=i.length;n<r;n++)if(i[n]._name===t)return i[n];return null},i.getChildByPath=function(t){for(var i,n=t.split("/"),r=this,s=function(){var t=n[e];if(0===t.length)return 0;var i=r.children.find((function(i){return i.name===t}));if(!i)return{v:null};r=i},e=0;e<n.length;++e)if(0!==(i=s())&&i)return i.v;return r},i.addChild=function(t){t.setParent(this)},i.insertChild=function(t,i){t.setParent(this),t.setSiblingIndex(i)},i.getSiblingIndex=function(){return this._siblingIndex},i.setSiblingIndex=function(t){if(this._parent)if(256&this._parent._objFlags)ht(3821);else{var i=this._parent._children;t=t>=0?t:i.length+t;var n=i.indexOf(this);t!==n&&(i.splice(n,1),t<i.length?i.splice(t,0,this):i.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t),this._eventProcessor.onUpdatingSiblingIndex())}},i.walk=function(t,i){var r=1,s=null,e=null,h=0,u=n.ao[n.fo];u||(u=[],n.ao.push(u)),n.fo++,u.length=0,u[0]=this;for(var o=null,c=!1;r;)if(e=u[--r])if(!c&&t?t(e):c&&i&&i(e),u[r]=null,c){if(o===this._parent)break;if(c=!1,s)if(s[++h])u[r]=s[h],r++;else if(o&&(u[r]=o,r++,c=!0,o._parent?(h=(s=o._parent._children).indexOf(o),o=o._parent):(o=null,s=null),h<0))break}else e._children.length>0?(o=e,s=e._children,h=0,u[r]=s[h],r++):(u[r]=e,r++,c=!0);u.length=0,n.fo--},i.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},i.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},i.removeAllChildren=function(){for(var t=this._children,i=t.length-1;i>=0;i--){var n=t[i];n&&(n.parent=null)}this._children.length=0},i.isChildOf=function(t){var i=this;do{if(i===t)return!0;i=i._parent}while(i);return!1},i.getComponent=function(t){var i=LE(t);return i?n._findComponent(this,i):null},i.getComponents=function(t){var i=LE(t),r=[];return i&&n.eo(this,i,r),r},i.getComponentInChildren=function(t){var i=LE(t);return i?n.ho(this._children,i):null},i.getComponentsInChildren=function(t){var i=LE(t),r=[];return i&&(n.eo(this,i,r),n.uo(this._children,i,r)),r},i.addComponent=function(t){var i;if("string"==typeof t){if(!(i=ti(t)))throw T._RF.peek()&&ht(3808,t),TypeError(at(3807,t))}else{if(!t)throw TypeError(at(3804));i=t}if("function"!=typeof i)throw TypeError(at(3809));if(!Ht(i,T.Component))throw TypeError(at(3810));var n=i._requireComponent;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){var s=n[r];this.getComponent(s)||this.addComponent(s)}else{var e=n;this.getComponent(e)||this.addComponent(e)}var h=new i;return h.node=this,this._components.push(h),this.emit("component-added",h),this._activeInHierarchy&&T.director._nodeActivator.activateComp(h),h},i.removeComponent=function(t){if(t){var i=null;(i=t instanceof Kg?t:this.getComponent(t))&&i.destroy()}else ht(3813)},i.on=function(t,i,n,r){switch(void 0===r&&(r=!1),t){case CE:this._eventMask|=1;break;case NE:this._eventMask|=2}this._eventProcessor.on(t,i,n,r)},i.off=function(t,i,n,r){if(void 0===r&&(r=!1),this._eventProcessor.off(t,i,n,r),!this._eventProcessor.hasEventListener(t))switch(t){case CE:this._eventMask&=-2;break;case NE:this._eventMask&=-3}},i.once=function(t,i,n,r){this._eventProcessor.once(t,i,n,r)},i.emit=function(t,i,n,r,s,e){this._eventProcessor.emit(t,i,n,r,s,e)},i.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},i.hasEventListener=function(t,i,n){return this._eventProcessor.hasEventListener(t,i,n)},i.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(CE)&&(this._eventMask&=-2),2&this._eventMask&&!this._eventProcessor.hasEventListener(NE)&&(this._eventMask&=-3)},i.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},i.destroyAllChildren=function(){for(var t=this._children,i=0;i<t.length;++i)t[i].destroy()},i._removeComponent=function(t){if(t){if(!(this._objFlags&ME)){var i=this._components.indexOf(t);-1!==i?(this._components.splice(i,1),this.emit("component-removed",t)):t.node!==this&&ht(3815)}}else ht(3814)},i._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t;this.emit("sibling-order-changed")},i._instantiate=function(t,i){return void 0===i&&(i=!1),t||(t=T.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(i),t},i._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof T.Scene||T.game.removePersistRootNode(this);var i=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==i&&T.director._nodeActivator.activateNode(this,i)},i._onPreDestroyBase=function(){this._objFlags|=ME;var t=this._parent,i=!!t&&!!(t._objFlags&ME);if(this._persistNode&&T.game.removePersistRootNode(this),!i&&t){this.emit("parent-changed",this);var n=t._children.indexOf(this);t._children.splice(n,1),this._siblingIndex=0,t._updateSiblingIndex(),t.emit&&t.emit("child-removed",this)}this.emit("node-destroyed",this),this._eventProcessor.destroy();for(var r=this._children,s=0;s<r.length;++s)r[s]._destroyImmediate();for(var e=this._components,h=0;h<e.length;++h)e[h]._destroyImmediate();return i},n.isNode=function(t){return t instanceof n&&(t.constructor===n||!(t instanceof T.Scene))},i._onPreDestroy=function(){return this._onPreDestroyBase()},i[pc]=function(t){t.writeThis()},i._onSetParent=function(t,i){void 0===i&&(i=!1);var r=this,s=r._parent;if(s&&(null!=t&&t._scene===s._scene||null==s._scene||r.walk(n.so)),i){if(s)if(s.updateWorldTransform(),xn(ls.determinant(s._mat),0,Fn))st(14300),r._transformFlags|=7,r.updateWorldTransform();else{var e=s._mat;ls.multiply(jE,ls.invert(jE,e),r._mat),ls.toSRT(jE,r._lrot,r._lpos,r._lscale)}else Ir.copy(r._lpos,r._pos),Qr.copy(r._lrot,r._rot),Ir.copy(r._lscale,r._scale);r._eulerDirty=!0}r.invalidateChildren(7)},i._onHierarchyChanged=function(t){this.eventProcessor.reattach(),this._onHierarchyChangedBase(t)},i._onBatchCreated=function(t){2&this._eventMask&&(this._activeInHierarchy||this.emit(NE,this,!1)),this.hasChangedFlags=7,this._children.forEach((function(i,n){i._siblingIndex=n,i._onBatchCreated(t)}))},i._onBeforeSerialize=function(){this.eulerAngles},i._onPostActivated=function(t){var i=this;2&i._eventMask&&i.emit(NE,i,t);var n=this._eventProcessor;if(n.isEnabled===t&&RE.callbacksInvoker.emit(2),n.setEnabled(t),t){i.invalidateChildren(7);var r=i._uiProps&&i._uiProps.uiComp;r&&(r.setNodeDirty(),r.setTextureDirty(),r.vo())}},i.translate=function(t,i){var n=i||0;if(0===n)Ir.transformQuat(DE,t,this._lrot),this._lpos.x+=DE.x,this._lpos.y+=DE.y,this._lpos.z+=DE.z;else if(1===n)if(this._parent){Qr.invert(FE,this._parent.worldRotation),Ir.transformQuat(DE,t,FE);var r=this.worldScale;this._lpos.x+=DE.x/r.x,this._lpos.y+=DE.y/r.y,this._lpos.z+=DE.z/r.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(1),1&this._eventMask&&this.emit(CE,1)},i.rotate=function(t,i){var n=i||0;if(Qr.normalize(FE,t),0===n)Qr.multiply(this._lrot,this._lrot,FE);else if(1===n){var r=this.worldRotation;Qr.multiply(UE,FE,r),Qr.invert(FE,r),Qr.multiply(UE,FE,UE),Qr.multiply(this._lrot,this._lrot,UE)}this._eulerDirty=!0,this.invalidateChildren(2),1&this._eventMask&&this.emit(CE,2)},i.lookAt=function(t,i){this.getWorldPosition(DE),Ir.subtract(DE,DE,t),Ir.normalize(DE,DE),Qr.fromViewUp(FE,DE,i),this.setWorldRotation(FE)},i.invalidateChildren=function(t){var i,n,r=0,s=0,e=0,h=0,u=1|t;for(VE[0]=this;r>=0;){if(h=(i=VE[r--]).hasChangedFlags,i.isValid&&!i.isSkipTransformUpdate&&(i._transformFlags&h&t)!==t)for(i._transformFlags|=t,i.hasChangedFlags=h|t,e=(n=i._children).length,s=0;s<e;s++)VE[++r]=n[s];t=u}},i.updateWorldTransform=function(){if(this._transformFlags){for(var t,i,n,r=this,s=0;r&&r._transformFlags;)VE[s++]=r,r=r._parent;for(var e=0,h=0,u=0;s;){if(i=(t=VE[--s])._mat,n=t._pos,h=1&(e|=t._transformFlags),u=14&e,r){if(h&&!u&&(Ir.transformMat4(n,t._lpos,r._mat),i.m12=n.x,i.m13=n.y,i.m14=n.z),u){var o=i;ls.fromSRT(jE,t._lrot,t._lpos,t._lscale),ls.multiply(i,r._mat,jE);var c=2&e?t._rot:null;ls.toSRT(o,c,n,t._scale)}}else h&&(Ir.copy(n,t._lpos),i.m12=n.x,i.m13=n.y,i.m14=n.z),u&&(2&e&&Qr.copy(t._rot,t._lrot),4&e&&Ir.copy(t._scale,t._lscale),ls.fromSRT(i,t._rot,t._pos,t._scale));t._transformFlags=0,r=t}}},i.setPosition=function(t,i,n){var r=this._lpos;void 0===i?Ir.copy(r,t):(void 0===n&&(n=r.z),Ir.set(r,t,i,n)),this.invalidateChildren(1),1&this._eventMask&&this.emit(CE,1)},i.getPosition=function(t){return t?Ir.set(t,this._lpos.x,this._lpos.y,this._lpos.z):Ir.copy(new Ir,this._lpos)},i.setRotation=function(t,i,n,r){void 0===i?Qr.copy(this._lrot,t):Qr.set(this._lrot,t,i,n,r),this._eulerDirty=!0,this.invalidateChildren(2),1&this._eventMask&&this.emit(CE,2)},i.setRotationFromEuler=function(t,i,n){if(void 0===i)Ir.copy(this._euler,t),Qr.fromEuler(this._lrot,t.x,t.y,t.z);else{var r=void 0===n?this._euler.z:n;Ir.set(this._euler,t,i,r),Qr.fromEuler(this._lrot,t,i,r)}this._eulerDirty=!1,this.invalidateChildren(2),1&this._eventMask&&this.emit(CE,2)},i.getRotation=function(t){return t?Qr.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):Qr.copy(new Qr,this._lrot)},i.setScale=function(t,i,n){var r=this._lscale;void 0===i?Ir.copy(r,t):(void 0===n&&(n=r.z),Ir.set(r,t,i,n)),this.invalidateChildren(4),1&this._eventMask&&this.emit(CE,4)},i.getScale=function(t){return t?Ir.set(t,this._lscale.x,this._lscale.y,this._lscale.z):Ir.copy(new Ir,this._lscale)},i.inverseTransformPoint=function(t,i){Ir.copy(t,i);for(var n=this,r=0;n._parent;)VE[r++]=n,n=n._parent;for(;r>=0;)Ir.transformInverseRTS(t,t,n._lrot,n._lpos,n._lscale),n=VE[--r];return t},i.setWorldPosition=function(t,i,n){var r=this._pos;void 0===i?Ir.copy(r,t):Ir.set(r,t,i,n);var s=this._parent,e=this._lpos;s?(s.updateWorldTransform(),Ir.transformMat4(e,r,ls.invert(jE,s._mat))):Ir.copy(e,r),this.invalidateChildren(1),1&this._eventMask&&this.emit(CE,1)},i.getWorldPosition=function(t){return this.updateWorldTransform(),t?Ir.copy(t,this._pos):Ir.copy(new Ir,this._pos)},i.setWorldRotation=function(t,i,n,r){var s=this._rot;void 0===i?Qr.copy(s,t):Qr.set(s,t,i,n,r),this._parent?(this._parent.updateWorldTransform(),Qr.multiply(this._lrot,Qr.conjugate(this._lrot,this._parent._rot),s)):Qr.copy(this._lrot,s),this._eulerDirty=!0,this.invalidateChildren(2),1&this._eventMask&&this.emit(CE,2)},i.setWorldRotationFromEuler=function(t,i,n){Qr.fromEuler(FE,t,i,n),this.setWorldRotation(FE)},i.getWorldRotation=function(t){return this.updateWorldTransform(),t?Qr.copy(t,this._rot):Qr.copy(new Qr,this._rot)},i.setWorldScale=function(t,i,n){var r=this,s=r._parent;s&&r.updateWorldTransform();var e=r._scale;void 0===i?Ir.copy(e,t):Ir.set(e,t,i,n);var h=0;if(s){var u=r._mat;r._uiProps.vu&&(ls.fromSRT(jE,r._lrot,r._lpos,r._lscale),ls.multiply(u,s._mat,jE));var o=Ir.set(BE,u.m00,u.m01,u.m02).length(),c=Ir.set(BE,u.m04,u.m05,u.m06).length(),a=Ir.set(BE,u.m08,u.m09,u.m10).length();0===o?(DE.x=e.x,u.m00=1,h=2):DE.x=e.x/o,0===c?(DE.y=e.y,u.m05=1,h=2):DE.y=e.y/c,0===a?(DE.z=e.z,u.m10=1,h=2):DE.z=e.z/a,ls.scale(jE,u,DE),ls.multiply(HE,ls.invert(HE,s._mat),jE),Dr.fromQuat(GE,Qr.conjugate(xE,r._lrot)),Dr.multiplyMat4(GE,GE,HE);var f=r._lscale;f.x=Ir.set(DE,GE.m00,GE.m01,GE.m02).length(),f.y=Ir.set(DE,GE.m03,GE.m04,GE.m05).length(),f.z=Ir.set(DE,GE.m06,GE.m07,GE.m08).length(),0!==f.x&&0!==f.y&&0!==f.z||(h=2)}else Ir.copy(r._lscale,e);r.invalidateChildren(4|h),1&r._eventMask&&r.emit(CE,4|h)},i.getWorldScale=function(t){return this.updateWorldTransform(),t?Ir.copy(t,this._scale):Ir.copy(new Ir,this._scale)},i.getWorldMatrix=function(t){this.updateWorldTransform();var i=t||new ls;return ls.copy(i,this._mat)},i.getWorldRS=function(t){this.updateWorldTransform();var i=t||new ls;return ls.copy(i,this._mat),i.m12=0,i.m13=0,i.m14=0,i},i.getWorldRT=function(t){this.updateWorldTransform();var i=t||new ls;return ls.fromRT(i,this._rot,this._pos)},i.setRTS=function(t,i,n){var r=0;t&&(r|=2,void 0!==t.w?(Qr.copy(this._lrot,t),this._eulerDirty=!0):(Ir.copy(this._euler,t),Qr.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),i&&(Ir.copy(this._lpos,i),r|=1),n&&(Ir.copy(this._lscale,n),r|=4),r&&(this.invalidateChildren(r),1&this._eventMask&&this.emit(CE,r))},i.isTransformDirty=function(){return 0!==this._transformFlags},i.pauseSystemEvents=function(t){this._eventProcessor.setEnabled(!1,t)},i.resumeSystemEvents=function(t){this._eventProcessor.setEnabled(!0,t)},n.resetHasChangedFlags=function(){zE+=1},n.clearNodeArray=function(){n.lo<n.do?n.lo++:(n.lo=0,VE.length=0)},i.getPathInHierarchy=function(){for(var t=this.name,i=this.parent;i&&!(i instanceof T.Scene);)t=i.name+"/"+t,i=i.parent;return t},i.qu=function(){return this._uiProps.uiTransformComp},r(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(64&this._objFlags)>0},set:function(t){t?this._objFlags|=64:this._objFlags&=-65}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var i=this._parent;i&&i._activeInHierarchy&&T.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}},{key:"prefab",get:function(){return this._prefab}},{key:"id",set:function(t){this._id=t}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(t){this._siblingIndex=t}},{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"x",get:function(){return this._lpos.x},set:function(t){this.setPosition(t,this._lpos.y,this._lpos.z)}},{key:"y",get:function(){return this._lpos.y},set:function(t){this.setPosition(this._lpos.x,t,this._lpos.z)}},{key:"z",get:function(){return this._lpos.z},set:function(t){this.setPosition(this._lpos.x,this._lpos.y,t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"worldPositionX",get:function(){return this.updateWorldTransform(),this._pos.x},set:function(t){this.setWorldPosition(t,this._pos.y,this._pos.z)}},{key:"worldPositionY",get:function(){return this.updateWorldTransform(),this._pos.y},set:function(t){this.setWorldPosition(this._pos.x,t,this._pos.z)}},{key:"worldPositionZ",get:function(){return this.updateWorldTransform(),this._pos.z},set:function(t){this.setWorldPosition(this._pos.x,this._pos.y,t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(Qr.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)}},{key:"angle",get:function(){return this.eulerAngles.z},set:function(t){Ir.set(this._euler,0,0,t),Qr.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(2),1&this._eventMask&&this.emit(CE,2)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){ls.toSRT(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(7),this._eulerDirty=!0,1&this._eventMask&&this.emit(CE,7)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Ir.transformQuat(new Ir,Ir.FORWARD,this.worldRotation)},set:function(t){var i=t.length();Ir.multiplyScalar(DE,t,-1/i),Qr.fromViewUp(FE,DE),this.setWorldRotation(FE)}},{key:"up",get:function(){return Ir.transformQuat(new Ir,Ir.UP,this.worldRotation)}},{key:"right",get:function(){return Ir.transformQuat(new Ir,Ir.RIGHT,this.worldRotation)}},{key:"mobility",get:function(){return this._mobility},set:function(t){this._mobility!==t&&(this._mobility=t,this.emit("mobility-changed"))}},{key:"layer",get:function(){return this._layer},set:function(t){var i=this;if(i._layer!==t){i._layer=t;var n=i._uiProps&&i._uiProps.uiComp;n&&(n.setNodeDirty(),n.vo()),i.emit("layer-changed",i._layer)}}},{key:"flagChangedVersion",get:function(){return this._flagChangeVersion}},{key:"hasChangedFlags",get:function(){return this._flagChangeVersion===zE?this._hasChangedFlags:0},set:function(t){this._flagChangeVersion=zE,this._hasChangedFlags=t}},{key:"isSkipTransformUpdate",get:function(){return!!(16777216&this._objFlags)},set:function(t){t?this._objFlags|=16777216:this._objFlags&=-16777217}}]),n}(We),kE.wo=PE,kE.ao=[[]],kE.fo=0,kE.EventType=WA,kE.NodeSpace=VA,kE.TransformDirtyBit=$A,kE.TransformBit=$A,kE.reserveContentsForAllSyncablePrefabTag=$E,kE.lo=0,kE.do=1e3,y((aE=kE).prototype,"_persistNode",[ko],Object.getOwnPropertyDescriptor(aE.prototype,"_persistNode"),aE.prototype),fE=uo(aE.prototype,"_parent",[Co],(function(){return null})),vE=uo(aE.prototype,"_children",[Co],(function(){return[]})),lE=uo(aE.prototype,"_active",[Co],(function(){return!0})),dE=uo(aE.prototype,"_components",[Co],(function(){return[]})),wE=uo(aE.prototype,"_prefab",[Co],(function(){return null})),gE=uo(aE.prototype,"_lpos",[Co],(function(){return new Ir})),pE=uo(aE.prototype,"_lrot",[Co],(function(){return new Qr})),_E=uo(aE.prototype,"_lscale",[Co],(function(){return new Ir(1,1,1)})),yE=uo(aE.prototype,"_mobility",[Co],(function(){return zA.Static})),mE=uo(aE.prototype,"_layer",[Co],(function(){return M_.Enum.DEFAULT})),bE=uo(aE.prototype,"_euler",[Co],(function(){return new Ir})),y(aE.prototype,"eulerAngles",[uE],Object.getOwnPropertyDescriptor(aE.prototype,"eulerAngles"),aE.prototype),y(aE.prototype,"mobility",[oE],Object.getOwnPropertyDescriptor(aE.prototype,"mobility"),aE.prototype),cE=aE))||cE));T.Node=WE;var XE,YE,KE,qE,QE,JE,ZE,tT,iT,nT,rT,sT,eT,hT,uT,oT,cT,aT,fT,vT,lT,dT,wT,gT,pT,_T,yT,mT,bT,kT,AT,ET,TT,OT,ST,IT,RT,MT,CT,NT,PT,LT,DT,BT,FT,UT,xT,GT,jT,HT,VT,$T,zT,WT,XT,YT,KT,qT,QT,JT,ZT,tO,iO,nO,rO,sO,eO,hO,uO,oO,cO,aO,fO,vO,lO,dO,wO,gO,pO,_O,yO,mO,bO,kO,AO,EO,TO,OO,SO,IO,RO,MO,CO,NO,PO,LO,DO,BO,FO,UO,xO,GO,jO,HO,VO,$O,zO,WO,XO,YO,KO,qO,QO,JO,ZO,tS,iS,nS,rS,sS,eS,hS,uS,oS,cS,aS,fS,vS,lS,dS,wS=_i({DEFAULT:0,LINEAR:1}),gS=function(){function t(){this._toneMappingType=wS.DEFAULT,this._activated=!1}var i=t.prototype;return i.initialize=function(t){this._toneMappingType=t.toneMappingType},i.activate=function(){this._updatePipeline(),this._activated=!0},i._updatePipeline=function(){var t=T.director.root;t.pipeline.macros.CC_TONE_MAPPING_TYPE=this._toneMappingType,this._activated&&t.onGlobalPipelineStateChanged()},r(t,[{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(t){this._toneMappingType=t,this._updatePipeline()}}]),t}(),pS=new Ir(0,1,0),_S=new Ir,yS=new $s,mS=new Qs,bS=new Qr,kS=function(t){var i=1/Math.max(Math.max(Math.max(t.x,t.y),t.z),1e-4);i<1&&(t.x*=i,t.y*=i,t.z*=i)},AS=t("d7",(XE=_o("cc.AmbientInfo"),YE=ic(Qi),KE=No("_skyColor"),qE=No("_skyIllum"),QE=No("_groundAlbedo"),XE((ZE=function(){function t(){this._skyColorHDR=tT&&tT(),this._skyIllumHDR=iT&&iT(),this._groundAlbedoHDR=nT&&nT(),this._skyColorLDR=rT&&rT(),this._skyIllumLDR=sT&&sT(),this._groundAlbedoLDR=eT&&eT(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},r(t,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var t=vA().isHDR;return yS.set(t?this._skyColorHDR:this._skyColorLDR),kS(yS),mS.set(255*yS.x,255*yS.y,255*yS.z,255)},set:function(t){yS.set(t.x,t.y,t.z,t.w),vA().isHDR?this._skyColorHDR.set(yS):this._skyColorLDR.set(yS),this._resource&&this._resource.skyColor.set(yS)}},{key:"skyColor",set:function(t){vA().isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t),this._resource&&this._resource.skyColor.set(t)}},{key:"skyIllum",get:function(){return vA().isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){vA().isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t,this._resource&&(this._resource.skyIllum=t)}},{key:"groundLightingColor",get:function(){var t=vA().isHDR;return yS.set(t?this._groundAlbedoHDR:this._groundAlbedoLDR),kS(yS),mS.set(255*yS.x,255*yS.y,255*yS.z,255)},set:function(t){yS.set(t.x,t.y,t.z,t.w),vA().isHDR?this._groundAlbedoHDR.set(yS):this._groundAlbedoLDR.set(yS),this._resource&&this._resource.groundAlbedo.set(yS)}},{key:"groundAlbedo",set:function(t){vA().isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t),this._resource&&this._resource.groundAlbedo.set(t)}}]),t}(),y(ZE.prototype,"skyIllum",[YE],Object.getOwnPropertyDescriptor(ZE.prototype,"skyIllum"),ZE.prototype),tT=uo(ZE.prototype,"_skyColorHDR",[Co,KE],(function(){return new $s(.2,.5,.8,1)})),iT=uo(ZE.prototype,"_skyIllumHDR",[Co,qE],(function(){return lA.SKY_ILLUM})),nT=uo(ZE.prototype,"_groundAlbedoHDR",[Co,QE],(function(){return new $s(.2,.2,.2,1)})),rT=uo(ZE.prototype,"_skyColorLDR",[Co],(function(){return new $s(.2,.5,.8,1)})),sT=uo(ZE.prototype,"_skyIllumLDR",[Co],(function(){return lA.SKY_ILLUM})),eT=uo(ZE.prototype,"_groundAlbedoLDR",[Co],(function(){return new $s(.2,.2,.2,1)})),JE=ZE))||JE));O.AmbientInfo=AS;var ES=t("d8",(hT=_o("cc.SkyboxInfo"),uT=ic(_A),oT=ic(tb),cT=ic(Qi),aT=ic(tb),fT=ic(tb),vT=ic(hA),lT=ic(tb),dT=No("_envmap"),wT=ic(tb),gT=ic(tb),pT=ic(tb),_T=ic(hA),yT=ic(tb),mT=ic(tb),hT((kT=function(){function t(){this._envLightingType=AT&&AT(),this._envmapHDR=ET&&ET(),this._envmapLDR=TT&&TT(),this._diffuseMapHDR=OT&&OT(),this._diffuseMapLDR=ST&&ST(),this._enabled=IT&&IT(),this._useHDR=RT&&RT(),this._editableMaterial=MT&&MT(),this._reflectionHDR=CT&&CT(),this._reflectionLDR=NT&&NT(),this._rotationAngle=PT&&PT(),this._resource=null}var i=t.prototype;return i.activate=function(t){this.envLightingType=this._envLightingType,this._resource=t,t.initialize(this),t.setEnvMaps(this._envmapHDR,this._envmapLDR),t.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),t.setSkyboxMaterial(this._editableMaterial),t.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),t.setRotationAngle(this._rotationAngle),t.activate()},i.updateEnvMap=function(t){t||(this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=0,st(15001));var i=this._resource;i&&(i.setEnvMaps(this._envmapHDR,this._envmapLDR),i.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),i.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),i.useDiffuseMap=this.applyDiffuseMap,i.envmap=t)},i.setMaterialProperty=function(t,i,n){var r=this._resource;if(r){var s=r.editableMaterial;r.enabled&&s&&(s.setProperty(t,i,n),s.passes.forEach((function(t){t.update()})))}},r(t,[{key:"applyDiffuseMap",get:function(){return 2===this._envLightingType},set:function(t){this._resource&&(this._resource.useDiffuseMap=t)}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))}},{key:"envLightingType",get:function(){return this._envLightingType},set:function(t){this.envmap||0===t?(0===t?(this.useIBL=!1,this.applyDiffuseMap=!1):1===t?(this.useIBL=!0,this.applyDiffuseMap=!1):2===t&&(this.useIBL=!0,this.applyDiffuseMap=!0),this._envLightingType=t):(this.useIBL=!1,this.applyDiffuseMap=!1,this._envLightingType=0,st(15001))}},{key:"useIBL",get:function(){return 0!==this._envLightingType},set:function(t){this._resource&&(this._resource.useIBL=t)}},{key:"useHDR",get:function(){return vA().isHDR=this._useHDR,this._useHDR},set:function(t){vA().isHDR=t,this._useHDR=t;var i=this._resource;i&&2===this.envLightingType&&(null===this.diffuseMap?(this.envLightingType=1,st(15e3)):this.diffuseMap.isDefault&&st(15002)),i&&(i.useHDR=this._useHDR,i.updateMaterialRenderInfo())}},{key:"envmap",get:function(){return vA().isHDR?this._envmapHDR:this._envmapLDR},set:function(t){var i=vA().isHDR;i?(this._envmapHDR=t,this._reflectionHDR=null):(this._envmapLDR=t,this._reflectionLDR=null),t||(i?this._diffuseMapHDR=null:this._diffuseMapLDR=null,this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=0,st(15001));var n=this._resource;n&&(n.setEnvMaps(this._envmapHDR,this._envmapLDR),n.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),n.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),n.useDiffuseMap=this.applyDiffuseMap,n.envmap=t)}},{key:"rotationAngle",get:function(){return this._rotationAngle},set:function(t){this._rotationAngle=t,this._resource&&this._resource.setRotationAngle(this._rotationAngle)}},{key:"diffuseMap",get:function(){return vA().isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){vA().isHDR?this._diffuseMapHDR=t:this._diffuseMapLDR=t,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}},{key:"reflectionMap",get:function(){return vA().isHDR?this._reflectionHDR:this._reflectionLDR},set:function(t){vA().isHDR?this._reflectionHDR=t:this._reflectionLDR=t,this._resource&&this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR)}},{key:"skyboxMaterial",get:function(){return this._editableMaterial},set:function(t){this._editableMaterial=t,this._resource&&this._resource.setSkyboxMaterial(this._editableMaterial)}}]),t}(),y(kT.prototype,"envLightingType",[uT],Object.getOwnPropertyDescriptor(kT.prototype,"envLightingType"),kT.prototype),y(kT.prototype,"envmap",[oT],Object.getOwnPropertyDescriptor(kT.prototype,"envmap"),kT.prototype),y(kT.prototype,"rotationAngle",[cT],Object.getOwnPropertyDescriptor(kT.prototype,"rotationAngle"),kT.prototype),y(kT.prototype,"diffuseMap",[aT],Object.getOwnPropertyDescriptor(kT.prototype,"diffuseMap"),kT.prototype),y(kT.prototype,"reflectionMap",[fT],Object.getOwnPropertyDescriptor(kT.prototype,"reflectionMap"),kT.prototype),y(kT.prototype,"skyboxMaterial",[vT],Object.getOwnPropertyDescriptor(kT.prototype,"skyboxMaterial"),kT.prototype),AT=uo(kT.prototype,"_envLightingType",[Co],(function(){return 0})),ET=uo(kT.prototype,"_envmapHDR",[Co,lT,dT],(function(){return null})),TT=uo(kT.prototype,"_envmapLDR",[Co,wT],(function(){return null})),OT=uo(kT.prototype,"_diffuseMapHDR",[Co,gT],(function(){return null})),ST=uo(kT.prototype,"_diffuseMapLDR",[Co,pT],(function(){return null})),IT=uo(kT.prototype,"_enabled",[Co],(function(){return!1})),RT=uo(kT.prototype,"_useHDR",[Co],(function(){return!0})),MT=uo(kT.prototype,"_editableMaterial",[Co,_T],(function(){return null})),CT=uo(kT.prototype,"_reflectionHDR",[Co,yT],(function(){return null})),NT=uo(kT.prototype,"_reflectionLDR",[Co,mT],(function(){return null})),PT=uo(kT.prototype,"_rotationAngle",[Co],(function(){return 0})),bT=kT))||bT));O.SkyboxInfo=ES;var TS=t("d9",(LT=_o("cc.FogInfo"),DT=ic(cA),BT=ic(Qi),FT=ic(Qi),UT=ic(Qi),xT=ic(Qi),GT=ic(Qi),jT=ic(Qi),LT((tO=function(){function t(){this._type=$T&&$T(),this._fogColor=zT&&zT(),this._enabled=WT&&WT(),this._fogDensity=XT&&XT(),this._fogStart=YT&&YT(),this._fogEnd=KT&&KT(),this._fogAtten=qT&&qT(),this._fogTop=QT&&QT(),this._fogRange=JT&&JT(),this._accurate=ZT&&ZT(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this),t.activate()},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t){this._enabled=t;var i=this._resource;i&&(i.enabled=t,t&&(i.type=this._type))}}},{key:"accurate",get:function(){return this._accurate},set:function(t){if(this._accurate!==t){this._accurate=t;var i=this._resource;i&&(i.accurate=t,t&&(i.type=this._type))}}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),tO.FogType=cA,y((VT=tO).prototype,"type",[DT],Object.getOwnPropertyDescriptor(VT.prototype,"type"),VT.prototype),y(VT.prototype,"fogDensity",[BT],Object.getOwnPropertyDescriptor(VT.prototype,"fogDensity"),VT.prototype),y(VT.prototype,"fogStart",[FT],Object.getOwnPropertyDescriptor(VT.prototype,"fogStart"),VT.prototype),y(VT.prototype,"fogEnd",[UT],Object.getOwnPropertyDescriptor(VT.prototype,"fogEnd"),VT.prototype),y(VT.prototype,"fogAtten",[xT],Object.getOwnPropertyDescriptor(VT.prototype,"fogAtten"),VT.prototype),y(VT.prototype,"fogTop",[GT],Object.getOwnPropertyDescriptor(VT.prototype,"fogTop"),VT.prototype),y(VT.prototype,"fogRange",[jT],Object.getOwnPropertyDescriptor(VT.prototype,"fogRange"),VT.prototype),$T=uo(VT.prototype,"_type",[Co],(function(){return cA.LINEAR})),zT=uo(VT.prototype,"_fogColor",[Co],(function(){return new Qs("#C8C8C8")})),WT=uo(VT.prototype,"_enabled",[Co],(function(){return!1})),XT=uo(VT.prototype,"_fogDensity",[Co],(function(){return.3})),YT=uo(VT.prototype,"_fogStart",[Co],(function(){return.5})),KT=uo(VT.prototype,"_fogEnd",[Co],(function(){return 300})),qT=uo(VT.prototype,"_fogAtten",[Co],(function(){return 5})),QT=uo(VT.prototype,"_fogTop",[Co],(function(){return 1.5})),JT=uo(VT.prototype,"_fogRange",[Co],(function(){return 1.2})),ZT=uo(VT.prototype,"_accurate",[Co],(function(){return!1})),HT=VT))||HT)),OS=t("da",(iO=_o("cc.ShadowsInfo"),nO=ic(bA),rO=ic(Qi),sO=ic(Qi),eO=ic(qi),hO=ic(mA),iO((oO=function(){function t(){this._enabled=cO&&cO(),this._type=aO&&aO(),this._normal=fO&&fO(),this._distance=vO&&vO(),this._planeBias=lO&&lO(),this._shadowColor=dO&&dO(),this._maxReceived=wO&&wO(),this._size=gO&&gO(),this._resource=null}var i=t.prototype;return i.setPlaneFromNode=function(t){t.getWorldRotation(bS),this.planeDirection=Ir.transformQuat(_S,pS,bS),t.getWorldPosition(_S),this.planeHeight=Ir.dot(this._normal,_S)},i.activate=function(t){this._resource=t,t.initialize(this),t.activate()},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t){this._enabled=t;var i=this._resource;i&&(i.enabled=t,t&&(i.type=this._type))}}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)}},{key:"planeDirection",get:function(){return this._normal},set:function(t){Ir.copy(this._normal,t),this._resource&&(this._resource.normal=t)}},{key:"planeHeight",get:function(){return this._distance},set:function(t){this._distance=t,this._resource&&(this._resource.distance=t)}},{key:"planeBias",get:function(){return this._planeBias},set:function(t){this._planeBias=t,this._resource&&(this._resource.planeBias=t)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(t){var i=this._resource;this._size.set(t,t),i&&(i.size.set(t,t),i.shadowMapDirty=!0)}}]),t}(),y(oO.prototype,"type",[nO],Object.getOwnPropertyDescriptor(oO.prototype,"type"),oO.prototype),y(oO.prototype,"planeHeight",[rO],Object.getOwnPropertyDescriptor(oO.prototype,"planeHeight"),oO.prototype),y(oO.prototype,"planeBias",[sO],Object.getOwnPropertyDescriptor(oO.prototype,"planeBias"),oO.prototype),y(oO.prototype,"maxReceived",[eO],Object.getOwnPropertyDescriptor(oO.prototype,"maxReceived"),oO.prototype),y(oO.prototype,"shadowMapSize",[hO],Object.getOwnPropertyDescriptor(oO.prototype,"shadowMapSize"),oO.prototype),cO=uo(oO.prototype,"_enabled",[Co],(function(){return!1})),aO=uo(oO.prototype,"_type",[Co],(function(){return bA.Planar})),fO=uo(oO.prototype,"_normal",[Co],(function(){return new Ir(0,1,0)})),vO=uo(oO.prototype,"_distance",[Co],(function(){return 0})),lO=uo(oO.prototype,"_planeBias",[Co],(function(){return 1})),dO=uo(oO.prototype,"_shadowColor",[Co],(function(){return new Qs(0,0,0,76)})),wO=uo(oO.prototype,"_maxReceived",[Co],(function(){return 4})),gO=uo(oO.prototype,"_size",[Co],(function(){return new Ms(1024,1024)})),uO=oO))||uO));O.ShadowsInfo=OS;var SS=t("db",new Ir(-1024,-1024,-1024)),IS=t("dc",new Ir(1024,1024,1024)),RS=t("dd",8),MS=t("de",(pO=_o("cc.OctreeInfo"),_O=ic(qi),pO((mO=function(){function t(){this._enabled=bO&&bO(),this._minPos=kO&&kO(),this._maxPos=AO&&AO(),this._depth=EO&&EO(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t,this._resource&&(this._resource.minPos=t)}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t,this._resource&&(this._resource.maxPos=t)}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t,this._resource&&(this._resource.depth=t)}}]),t}(),y(mO.prototype,"depth",[_O],Object.getOwnPropertyDescriptor(mO.prototype,"depth"),mO.prototype),bO=uo(mO.prototype,"_enabled",[Co],(function(){return!1})),kO=uo(mO.prototype,"_minPos",[Co],(function(){return new Ir(SS)})),AO=uo(mO.prototype,"_maxPos",[Co],(function(){return new Ir(IS)})),EO=uo(mO.prototype,"_depth",[Co],(function(){return RS})),yO=mO))||yO));O.OctreeInfo=MS;var CS=t("df",(TO=_o("cc.SkinInfo"),OO=ic(Qi),SO=ic(Qi),TO((RO=function(){function t(){this._enabled=MO&&MO(),this._blurRadius=CO&&CO(),this._sssIntensity=NO&&NO(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this)},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"blurRadius",get:function(){return this._blurRadius},set:function(t){this._blurRadius=t,this._resource&&(this._resource.blurRadius=t)}},{key:"sssIntensity",get:function(){return this._sssIntensity},set:function(t){this._sssIntensity=t,this._resource&&(this._resource.sssIntensity=t)}}]),t}(),y(RO.prototype,"blurRadius",[OO],Object.getOwnPropertyDescriptor(RO.prototype,"blurRadius"),RO.prototype),y(RO.prototype,"sssIntensity",[SO],Object.getOwnPropertyDescriptor(RO.prototype,"sssIntensity"),RO.prototype),MO=uo(RO.prototype,"_enabled",[Co],(function(){return!0})),CO=uo(RO.prototype,"_blurRadius",[Co],(function(){return.01})),NO=uo(RO.prototype,"_sssIntensity",[Co],(function(){return 3})),IO=RO))||IO));O.SkinInfo=CS;var NS=t("dg",(PO=_o("cc.PostSettingsInfo"),LO=ic(wS),PO((BO=function(){function t(){this._toneMappingType=FO&&FO(),this._resource=null}return t.prototype.activate=function(t){this._resource=t,t.initialize(this),t.activate()},r(t,[{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(t){this._toneMappingType=t,this._resource&&(this._resource.toneMappingType=t)}}]),t}(),y(BO.prototype,"toneMappingType",[LO],Object.getOwnPropertyDescriptor(BO.prototype,"toneMappingType"),BO.prototype),FO=uo(BO.prototype,"_toneMappingType",[Co],(function(){return wS.DEFAULT})),DO=BO))||DO));O.PostSettingsInfo=NS;var PS,LS,DS,BS,FS,US,xS,GS,jS,HS,VS,$S,zS,WS,XS,YS,KS,qS,QS,JS,ZS,tI,iI,nI,rI,sI,eI,hI,uI,oI,cI,aI,fI,vI,lI,dI,wI,gI,pI,_I,yI,mI,bI,kI,AI,EI,TI,OI,SI,II,RI,MI,CI,NI,PI,LI,DI,BI,FI,UI,xI,GI,jI,HI,VI,$I,zI,WI,XI,YI=t("dh",(UO=_o("cc.LightProbeInfo"),xO=ic(Qi),GO=ic(qi),jO=ic(qi),HO=ic(Qi),VO=ic(Qi),UO((zO=function(){function t(){this._giScale=WO&&WO(),this._giSamples=XO&&XO(),this._bounces=YO&&YO(),this._reduceRinging=KO&&KO(),this._showProbe=qO&&qO(),this._showWireframe=QO&&QO(),this._showConvex=JO&&JO(),this._data=ZO&&ZO(),this._lightProbeSphereVolume=tS&&tS(),this._nodes=[],this._scene=null,this._resource=null}var i=t.prototype;return i.activate=function(t,i){this._scene=t,this._resource=i,i.initialize(this)},i.onProbeBakeFinished=function(){this.po(this._scene)},i.onProbeBakeCleared=function(){this.clearSHCoefficients(),this.po(this._scene)},i.po=function(t){var i=this;t&&(t.emit("light-probe-baking-changed"),t.children.forEach((function(t){i.po(t)})))},i.clearSHCoefficients=function(){this._data&&(this._data.probes.forEach((function(t){t.coefficients.length=0})),this._o())},i.isUniqueNode=function(){return 1===this._nodes.length},i.addNode=function(t){if(!t)return!1;for(var i=0;i<this._nodes.length;i++)if(this._nodes[i].node===t)return!1;return this._nodes.push({node:t,probes:null}),!0},i.removeNode=function(t){if(!t)return!1;var i=this._nodes.findIndex((function(i){return i.node===t}));return-1!==i&&(this._nodes.splice(i,1),!0)},i.syncData=function(t,i){for(var n=0;n<this._nodes.length;n++)if(this._nodes[n].node===t)return void(this._nodes[n].probes=i)},i.update=function(t){if(void 0===t&&(t=!0),T.internal.LightProbesData){this._data||(this._data=new T.internal.LightProbesData,this._resource&&(this._resource.data=this._data));for(var i=[],n=0;n<this._nodes.length;n++){var r=this._nodes[n],s=r.node,e=r.probes,h=s.worldPosition;if(e)for(var u=0;u<e.length;u++){var o=Rr();Ir.add(o,e[u],h),i.push(o)}}if(i.length<4)return this.yo(),void this._data.reset();this._data.updateProbes(i),t&&(this.yo(),this._data.updateTetrahedrons())}},i._o=function(){if(this._scene){var t=this._scene.renderScene;t&&t.models.forEach((function(t){t.clearSHUBOs()}))}},i.yo=function(){if(this._scene){var t=this._scene.renderScene;t&&t.models.forEach((function(t){t.tetrahedronIndex=-1}))}},r(t,[{key:"giScale",get:function(){return this._giScale},set:function(t){this._giScale!==t&&(this._giScale=t,this._resource&&(this._resource.giScale=t))}},{key:"giSamples",get:function(){return this._giSamples},set:function(t){this._giSamples!==t&&(this._giSamples=t,this._resource&&(this._resource.giSamples=t))}},{key:"bounces",get:function(){return this._bounces},set:function(t){this._bounces!==t&&(this._bounces=t,this._resource&&(this._resource.bounces=t))}},{key:"reduceRinging",get:function(){return this._reduceRinging},set:function(t){this._reduceRinging!==t&&(this._reduceRinging=t,this._resource&&(this._resource.reduceRinging=t))}},{key:"showProbe",get:function(){return this._showProbe},set:function(t){this._showProbe!==t&&(this._showProbe=t,this._resource&&(this._resource.showProbe=t))}},{key:"showWireframe",get:function(){return this._showWireframe},set:function(t){this._showWireframe!==t&&(this._showWireframe=t,this._resource&&(this._resource.showWireframe=t))}},{key:"showConvex",get:function(){return this._showConvex},set:function(t){this._showConvex!==t&&(this._showConvex=t,this._resource&&(this._resource.showConvex=t))}},{key:"data",get:function(){return this._data},set:function(t){this._data!==t&&(this._data=t,this._resource&&(this._resource.data=t))}},{key:"lightProbeSphereVolume",get:function(){return this._lightProbeSphereVolume},set:function(t){this._lightProbeSphereVolume!==t&&(this._lightProbeSphereVolume=t,this._resource&&(this._resource.lightProbeSphereVolume=t))}}]),t}(),y(zO.prototype,"giScale",[xO],Object.getOwnPropertyDescriptor(zO.prototype,"giScale"),zO.prototype),y(zO.prototype,"giSamples",[GO],Object.getOwnPropertyDescriptor(zO.prototype,"giSamples"),zO.prototype),y(zO.prototype,"bounces",[jO],Object.getOwnPropertyDescriptor(zO.prototype,"bounces"),zO.prototype),y(zO.prototype,"reduceRinging",[HO],Object.getOwnPropertyDescriptor(zO.prototype,"reduceRinging"),zO.prototype),y(zO.prototype,"lightProbeSphereVolume",[VO],Object.getOwnPropertyDescriptor(zO.prototype,"lightProbeSphereVolume"),zO.prototype),WO=uo(zO.prototype,"_giScale",[Co],(function(){return 1})),XO=uo(zO.prototype,"_giSamples",[Co],(function(){return 1024})),YO=uo(zO.prototype,"_bounces",[Co],(function(){return 2})),KO=uo(zO.prototype,"_reduceRinging",[Co],(function(){return 0})),qO=uo(zO.prototype,"_showProbe",[Co],(function(){return!0})),QO=uo(zO.prototype,"_showWireframe",[Co],(function(){return!0})),JO=uo(zO.prototype,"_showConvex",[Co],(function(){return!1})),ZO=uo(zO.prototype,"_data",[Co],(function(){return null})),tS=uo(zO.prototype,"_lightProbeSphereVolume",[Co],(function(){return 1})),$O=zO))||$O)),KI=t("di",(iS=_o("cc.SceneGlobals"),nS=ic(ES),iS((sS=function(){function t(){this.ambient=eS&&eS(),this.shadows=hS&&hS(),this._skybox=uS&&uS(),this.fog=oS&&oS(),this.octree=cS&&cS(),this.skin=aS&&aS(),this.lightProbeInfo=fS&&fS(),this.postSettings=vS&&vS(),this.bakedWithStationaryMainLight=lS&&lS(),this.bakedWithHighpLightmap=dS&&dS(),this.disableLightmap=!1}return t.prototype.activate=function(t){var i=O.director.root.pipeline.pipelineSceneData;this.skybox.activate(i.skybox),this.ambient.activate(i.ambient),this.shadows.activate(i.shadows),this.fog.activate(i.fog),this.octree.activate(i.octree),this.skin.activate(i.skin),this.postSettings.activate(i.postSettings),this.lightProbeInfo&&i.lightProbes&&this.lightProbeInfo.activate(t,i.lightProbes),O.director.root.onGlobalPipelineStateChanged()},r(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),eS=uo(sS.prototype,"ambient",[Co],(function(){return new AS})),hS=uo(sS.prototype,"shadows",[Co],(function(){return new OS})),uS=uo(sS.prototype,"_skybox",[Co],(function(){return new ES})),oS=uo(sS.prototype,"fog",[Co],(function(){return new TS})),y(sS.prototype,"skybox",[nS],Object.getOwnPropertyDescriptor(sS.prototype,"skybox"),sS.prototype),cS=uo(sS.prototype,"octree",[Co],(function(){return new MS})),aS=uo(sS.prototype,"skin",[Co],(function(){return new CS})),fS=uo(sS.prototype,"lightProbeInfo",[Co],(function(){return new YI})),vS=uo(sS.prototype,"postSettings",[Co],(function(){return new NS})),lS=uo(sS.prototype,"bakedWithStationaryMainLight",[Co],(function(){return!1})),dS=uo(sS.prototype,"bakedWithHighpLightmap",[Co],(function(){return!1})),rS=sS))||rS));O.SceneGlobals=KI;var qI=(PS=_o("cc.TargetInfo"),LS=ic([Zi]),PS((BS=function(){this.localID=FS&&FS()},FS=uo(BS.prototype,"localID",[Co,LS],(function(){return[]})),DS=BS))||DS),QI=(US=_o("cc.TargetOverrideInfo"),xS=ic(We),GS=ic(qI),jS=ic([Zi]),HS=ic(WE),VS=ic(qI),US((zS=function(){this.source=WS&&WS(),this.sourceInfo=XS&&XS(),this.propertyPath=YS&&YS(),this.target=KS&&KS(),this.targetInfo=qS&&qS()},WS=uo(zS.prototype,"source",[Co,xS],(function(){return null})),XS=uo(zS.prototype,"sourceInfo",[Co,GS],(function(){return null})),YS=uo(zS.prototype,"propertyPath",[Co,jS],(function(){return[]})),KS=uo(zS.prototype,"target",[Co,HS],(function(){return null})),qS=uo(zS.prototype,"targetInfo",[Co,VS],(function(){return null})),$S=zS))||$S),JI=_o("cc.CompPrefabInfo")((JS=function(){this.fileId=ZS&&ZS()},ZS=uo(JS.prototype,"fileId",[Co],(function(){return""})),QS=JS))||QS,ZI=(tI=_o("CCPropertyOverrideInfo"),iI=ic(qI),nI=ic([Zi]),tI((sI=function(){function t(){this.targetInfo=eI&&eI(),this.propertyPath=hI&&hI(),this.value=uI&&uI()}return t.prototype.isTarget=function(){},t}(),eI=uo(sI.prototype,"targetInfo",[Co,iI],(function(){return null})),hI=uo(sI.prototype,"propertyPath",[Co,nI],(function(){return[]})),uI=uo(sI.prototype,"value",[Co],null),rI=sI))||rI),tR=(oI=_o("cc.MountedChildrenInfo"),cI=ic(qI),aI=ic([WE]),oI((vI=function(){function t(){this.targetInfo=lI&&lI(),this.nodes=dI&&dI()}return t.prototype.isTarget=function(){},t}(),lI=uo(vI.prototype,"targetInfo",[Co,cI],(function(){return null})),dI=uo(vI.prototype,"nodes",[Co,aI],(function(){return[]})),fI=vI))||fI),iR=(wI=_o("cc.MountedComponentsInfo"),gI=ic(qI),pI=ic([Kg]),wI((yI=function(){function t(){this.targetInfo=mI&&mI(),this.components=bI&&bI()}return t.prototype.isTarget=function(){},t}(),mI=uo(yI.prototype,"targetInfo",[Co,gI],(function(){return null})),bI=uo(yI.prototype,"components",[Co,pI],(function(){return[]})),_I=yI))||_I),nR=(kI=_o("cc.PrefabInstance"),AI=ic(WE),EI=ic([tR]),TI=ic([iR]),OI=ic([ZI]),SI=ic([qI]),kI((RI=function(){function t(){this.fileId=MI&&MI(),this.prefabRootNode=CI&&CI(),this.mountedChildren=NI&&NI(),this.mountedComponents=PI&&PI(),this.propertyOverrides=LI&&LI(),this.removedComponents=DI&&DI(),this.targetMap={},this.expanded=!1}var i=t.prototype;return i.findPropertyOverride=function(){},i.removePropertyOverride=function(){},t}(),MI=uo(RI.prototype,"fileId",[Co],(function(){return""})),CI=uo(RI.prototype,"prefabRootNode",[Co,AI],null),NI=uo(RI.prototype,"mountedChildren",[Co,EI],(function(){return[]})),PI=uo(RI.prototype,"mountedComponents",[Co,TI],(function(){return[]})),LI=uo(RI.prototype,"propertyOverrides",[Co,OI],(function(){return[]})),DI=uo(RI.prototype,"removedComponents",[Co,SI],(function(){return[]})),II=RI))||II),rR=(BI=_o("cc.PrefabInfo"),FI=ic(WE),UI=ic(nR),xI=ic([QI]),BI((jI=function(){this.root=HI&&HI(),this.asset=VI&&VI(),this.fileId=$I&&$I(),this.instance=zI&&zI(),this.targetOverrides=WI&&WI(),this.nestedPrefabInstanceRoots=XI&&XI()},HI=uo(jI.prototype,"root",[Co,FI],null),VI=uo(jI.prototype,"asset",[Co],null),$I=uo(jI.prototype,"fileId",[Co],(function(){return""})),zI=uo(jI.prototype,"instance",[Co,UI],null),WI=uo(jI.prototype,"targetOverrides",[Co,xI],null),XI=uo(jI.prototype,"nestedPrefabInstanceRoots",[Co],null),GI=jI))||GI);function sR(t){var i=null==t?void 0:t.prefab;if(i&&i.instance){if(!i.asset)return ht(3701,t.name),void(i.instance=void 0);var n=t._objFlags,r=t.getParent(),s=t.uuid;t[He],T.game._isCloning=!0,i.asset._doInstantiate(t),T.game._isCloning=!1,t._objFlags=n,t.co(r),t.id=s,t.prefab&&(t.prefab.instance=i.instance)}}function eR(t,i,n){var r;if(i&&t){var s=i,e=null==(r=t.prefab)?void 0:r.instance;!n&&e&&(i[e.fileId]={},s=i[e.fileId]);var h=t.prefab;h&&(s[h.fileId]=t),t.components.forEach((function(t){t.__prefab&&(s[t.__prefab.fileId]=t)})),t.children.forEach((function(t){eR(t,s,!1)}))}}function hR(t,i){if(!t)return null;for(var n=i,r=0;r<t.length;r++){if(!n)return null;n=n[t[r]]}return n}function uR(t,i,n){if(i)for(var r=0;r<i.length;r++){var s=i[r];if(s&&s.targetInfo){var e=hR(s.targetInfo.localID,n);if(!e)continue;var h=n,u=s.targetInfo.localID;if(u.length>0)for(var o=0;o<u.length-1;o++)h=h[u[o]];if(s.nodes)for(var c=0;c<s.nodes.length;c++){var a=s.nodes[c];a&&!e.children.includes(a)&&(e.children.push(a),a.co(e),eR(a,h,!1),a.siblingIndex=e.children.length-1,vR(a,!0))}}}}function oR(t,i,n){if(i)for(var r=0;r<i.length;r++){var s=i[r];if(s&&s.targetInfo){var e=hR(s.targetInfo.localID,n);if(!e)continue;if(s.components)for(var h=0;h<s.components.length;h++){var u=s.components[h];u&&(u.node=e,e.oo().push(u))}}}}function cR(t,i,n){if(i)for(var r=0;r<i.length;r++){var s=i[r];if(s){var e=hR(s.localID,n);if(!e||!e.node)continue;var h=e.node.components.indexOf(e);h>=0&&e.node.oo().splice(h,1)}}}function aR(t,i,n){if(!(i.length<=0))for(var r=null,s=0;s<i.length;s++){var e=i[s];if(e&&e.targetInfo){if(!(r=hR(e.targetInfo.localID,n)))continue;var h=r,u=e.propertyPath.slice();if(u.length>0){var o=u.pop();if(!o)continue;for(var c=0;c<u.length&&(h=h[u[c]]);c++);if(!h)continue;if(Array.isArray(h))if("length"===o)h[o]=e.value;else{var a=Number.parseInt(o);Number.isInteger(a)&&a<h.length&&(h[o]=e.value)}else h[o]instanceof ki?h[o].set(e.value):h[o]=e.value}}}}function fR(t){var i,n=null==(i=t.prefab)?void 0:i.targetOverrides;if(n)for(var r=0;r<n.length;r++){var s,e=n[r],h=e.source,u=e.sourceInfo;if(u){var o,c=e.source,a=null==c||null==(o=c.prefab)?void 0:o.instance;a&&a.targetMap&&(h=hR(u.localID,a.targetMap))}if(h){var f,v=e.targetInfo;if(v){var l=e.target,d=null==l||null==(s=l.prefab)?void 0:s.instance;if(d&&d.targetMap&&(f=hR(v.localID,d.targetMap))){var w=e.propertyPath.slice(),g=h;if(w.length>0){var p=w.pop();if(!p)return;for(var _=0;_<w.length&&(g=g[w[_]]);_++);if(!g)continue;g[p]=f}}}}}}function vR(t,i){var n;void 0===i&&(i=!1);var r=null==t||null==(n=t.prefab)?void 0:n.instance;if(r&&!r.expanded){sR(t),i&&t&&t.children&&t.children.forEach((function(t){vR(t,!0)}));var s={};r.targetMap=s,eR(t,s,!0),uR(0,r.mountedChildren,s),cR(0,r.removedComponents,s),oR(0,r.mountedComponents,s),aR(0,r.propertyOverrides,s),r.expanded=!0}else i&&t&&t.children&&t.children.forEach((function(t){vR(t,!0)}))}function lR(t){var i=t.prefab;i&&i.nestedPrefabInstanceRoots&&i.nestedPrefabInstanceRoots.forEach((function(t){vR(t)}))}T._PrefabInfo=rR;var dR,wR,gR,pR,_R,yR,mR,bR=Object.freeze({__proto__:null,CompPrefabInfo:JI,MountedChildrenInfo:tR,MountedComponentsInfo:iR,PrefabInfo:rR,PrefabInstance:nR,PropertyOverrideInfo:ZI,TargetInfo:qI,TargetOverrideInfo:QI,applyMountedChildren:uR,applyMountedComponents:oR,applyNodeAndComponentId:function t(i,n){for(var r=i.components,s=i.children,e=0;e<r.length;e++){var h,u,o=r[e],c=null!==(h=null==(u=o.__prefab)?void 0:u.fileId)&&void 0!==h?h:"";o._id=""+n+c}for(var a=0;a<s.length;a++){var f=s[a],v=f.prefab,l=null!=v&&v.instance?v.instance.fileId:null==v?void 0:v.fileId;l&&(f.id=""+n+l,null!=v&&v.instance||t(f,n))}},applyPropertyOverrides:aR,applyRemovedComponents:cR,applyTargetOverrides:fR,createNodeWithPrefab:sR,expandNestedPrefabInstanceNode:lR,expandPrefabInstanceNode:vR,generateTargetMap:eR,getTarget:hR}),kR=t("cY",_o("cc.Scene")((wR=function(t){e(n,t);var i=n.prototype;function n(i){var n;return(n=t.call(this,i)||this).autoReleaseAssets=gR&&gR(),n._globals=pR&&pR(),n.dependAssets=null,n._renderScene=null,n._prefabSyncedInLiveReload=!1,n._activeInHierarchy=!1,O.director&&O.director.root&&(n._renderScene=O.director.root.createScene({})),n._inited=!O.game||!O.game._isCloning,n}return i._updateScene=function(){this._scene=this},i.destroy=function(){var t=We.prototype.destroy.call(this);if(t)for(var i=this._children,n=0;n<i.length;++n)i[n].active=!1;return this._renderScene&&O.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},i.addComponent=function(){throw new Error(at(3822))},i._onHierarchyChanged=function(){},i._onPostActivated=function(){},i._onBatchCreated=function(t){for(var i=this._children.length,n=0;n<i;++n)this._children[n]._siblingIndex=n,this._children[n]._onBatchCreated(t)},i.updateWorldTransform=function(){},i._instantiate=function(){return null},i.mo=function(){this._inited||(lR(this),fR(this),this._onBatchCreated(b),this._inited=!0),this.walk(WE.so)},i.ko=function(t){void 0===t&&(t=!0),O.director._nodeActivator.activateNode(this,t),this._globals.activate(this)},r(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),n}(WE),gR=uo(wR.prototype,"autoReleaseAssets",[Co],(function(){return!1})),pR=uo(wR.prototype,"_globals",[Co],(function(){return new KI})),dR=wR))||dR);O.Scene=kR;var AR=t("dA",_o("cc.SceneAsset")((yR=function(t){function i(i){var n;return(n=t.call(this,i)||this).scene=mR&&mR(),n}e(i,t);var n=i.prototype;return n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.scene=new kR("New Scene")},n.validate=function(){return!!this.scene},i}(rg),mR=uo(yR.prototype,"scene",[Co],(function(){return null})),_R=yR))||_R);T.SceneAsset=AR;var ER=new ls,TR=new ls,OR=new ls,SR=new ls,IR=new ls,RR=new ls,MR=new ls,CR=new Ir(0,0,0),NR=new Ir,PR=new Ms,LR=new Ir,DR=new Ir,BR=new Ir(1e7,1e7,1e7),FR=new Ir(-1e7,-1e7,-1e7),UR=new Ir,xR=0,GR=0,jR=function(){function t(t){this._shadowObjects=[],this._shadowCameraFar=0,this._matShadowView=new ls,this._matShadowProj=new ls,this._matShadowViewProj=new ls,this._validFrustum=new $h,this._splitFrustum=new $h,this._lightViewFrustum=new $h,this._castLightViewBoundingBox=new Mh,this._level=t,this._validFrustum.accurate=!0,this._splitFrustum.accurate=!0,this._lightViewFrustum.accurate=!0}var i=t.prototype;return i.copyToValidFrustum=function(t){$h.copy(this._validFrustum,t)},i.calculateValidFrustumOrtho=function(t,i,n,r,s){$h.createOrtho(this._validFrustum,t,i,n,r,s)},i.calculateSplitFrustum=function(t,i,n,r){this._splitFrustum.split(n,r,t.aspect,t.fov,i)},i.destroy=function(){this._shadowObjects.length=0},i.createMatrix=function(t,i,n){var r=T.director.root.device,s=t.shadowInvisibleOcclusionRange;$h.copy(this._lightViewFrustum,this._splitFrustum),ls.fromRT(TR,t.node.rotation,CR),ls.invert(OR,TR);var e,h,u=OR.clone();this._lightViewFrustum.transform(OR),Mh.fromPoints(this._castLightViewBoundingBox,BR,FR),this._castLightViewBoundingBox.mergeFrustum(this._lightViewFrustum),t.csmOptimizationMode===EA.DisableRotationFix?(e=2*this._castLightViewBoundingBox.halfExtents.x,h=2*this._castLightViewBoundingBox.halfExtents.y):e=h=Ir.distance(this._lightViewFrustum.vertices[0],this._lightViewFrustum.vertices[6]);var o=T.director.root.pipeline.pipelineSceneData.csmSupported?t.csmLevel:1;if(o>1&&t.csmOptimizationMode===EA.RemoveDuplicates)if(this._level>=o-1)GR=this._castLightViewBoundingBox.halfExtents.z,xR=this._castLightViewBoundingBox.center.z;else{var c=Math.abs(this._castLightViewBoundingBox.center.z-xR)+GR;this._castLightViewBoundingBox.halfExtents.z=Math.max(this._castLightViewBoundingBox.center.z,c)}var a=this._castLightViewBoundingBox.halfExtents.z;this._shadowCameraFar=2*a+s;var f=this._castLightViewBoundingBox.center;if(UR.set(f.x,f.y,f.z+a+s),Ir.transformMat4(UR,UR,TR),ls.fromRT(TR,t.node.rotation,UR),ls.invert(OR,TR),!n){var v=.5*e,l=.5*h;ls.ortho(SR,-v,v,-l,l,.1,this._shadowCameraFar,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY),ls.multiply(RR,SR,u),Ir.transformMat4(NR,UR,RR);var d=2/i;PR.set(d,d);var w=NR.x%PR.x,g=NR.y%PR.y;LR.set(NR.x-w,NR.y-g,NR.z),ls.invert(MR,RR),Ir.transformMat4(DR,LR,MR),ls.fromRT(TR,t.node.rotation,DR),ls.invert(OR,TR),ls.multiply(IR,SR,OR),ls.copy(this._matShadowView,OR),ls.copy(this._matShadowProj,SR),ls.copy(this._matShadowViewProj,IR)}$h.createOrtho(this._validFrustum,e,h,.1,this._shadowCameraFar,TR)},r(t,[{key:"level",get:function(){return this._level}},{key:"shadowObjects",get:function(){return this._shadowObjects}},{key:"shadowCameraFar",get:function(){return this._shadowCameraFar},set:function(t){this._shadowCameraFar=t}},{key:"matShadowView",get:function(){return this._matShadowView},set:function(t){this._matShadowView=t}},{key:"matShadowProj",get:function(){return this._matShadowProj},set:function(t){this._matShadowProj=t}},{key:"matShadowViewProj",get:function(){return this._matShadowViewProj},set:function(t){this._matShadowViewProj=t}},{key:"validFrustum",get:function(){return this._validFrustum}},{key:"splitFrustum",get:function(){return this._splitFrustum}},{key:"lightViewFrustum",get:function(){return this._lightViewFrustum}},{key:"castLightViewBoundingBox",get:function(){return this._castLightViewBoundingBox}}]),t}(),HR=function(t){function i(i){var n;return(n=t.call(this,i)||this)._splitCameraNear=0,n._splitCameraFar=0,n._csmAtlas=new $s,n.Ao(i),n}e(i,t);var n=i.prototype;return n.destroy=function(){t.prototype.destroy.call(this)},n.Ao=function(t){var i=T.director.root.device.capabilities.clipSpaceSignY,n=t%2-.5,r=(.5-Math.floor(t/2))*i;this._csmAtlas.set(.5,.5,n,r)},r(i,[{key:"splitCameraNear",get:function(){return this._splitCameraNear},set:function(t){this._splitCameraNear=t}},{key:"splitCameraFar",get:function(){return this._splitCameraFar},set:function(t){this._splitCameraFar=t}},{key:"csmAtlas",get:function(){return this._csmAtlas},set:function(t){this._csmAtlas=t}}]),i}(jR),VR=function(){function t(){this._castShadowObjects=[],this._layerObjects=new je(64),this._layers=[],this._levelCount=0,this._specialLayer=new jR(1),this._shadowDistance=0;for(var t=0;t<AA.LEVEL_4;t++)this._layers[t]=new HR(t)}var i=t.prototype;return i.update=function(t,i){var n=i.scene.mainLight;if(null!==n){var r=t.shadows,s=T.director.root.pipeline.pipelineSceneData.csmSupported?n.csmLevel:1,e=n.shadowDistance;r.enabled&&n.shadowEnabled&&(n.shadowFixedArea?this.Eo(n):((n.csmNeedUpdate||this._levelCount!==s||this._shadowDistance!==e)&&(this.To(n),this._levelCount=s,this._shadowDistance=e),this.Oo(i,n,r)))}},i.destroy=function(){this._castShadowObjects.length=0;for(var t=0;t<this._layers.length;t++)this._layers[t].destroy();this._layers.length=0},i.Eo=function(t){var i=T.director.root.device,n=t.shadowOrthoSize,r=t.shadowOrthoSize,s=t.shadowNear,e=t.shadowFar;ls.fromRT(TR,t.node.worldRotation,t.node.worldPosition),ls.invert(OR,TR),ls.ortho(SR,-n,n,-r,r,s,e,i.capabilities.clipSpaceMinZ,i.capabilities.clipSpaceSignY),ls.multiply(IR,SR,OR),this._specialLayer.matShadowView=OR,this._specialLayer.matShadowProj=SR,this._specialLayer.matShadowViewProj=IR,this._specialLayer.calculateValidFrustumOrtho(2*n,2*r,s,e,TR)},i.To=function(t){var i=.1,n=t.shadowDistance,r=n/i,s=T.director.root.pipeline.pipelineSceneData.csmSupported?t.csmLevel:1,e=t.csmLayerLambda;this._layers[0].splitCameraNear=i;for(var h=1;h<s;h++){var u=h/s,o=e*i*Math.pow(r,u)+(1-e)*(i+(n-i)*u),c=1.005*o;this._layers[h].splitCameraNear=o,this._layers[h-1].splitCameraFar=c}this._layers[s-1].splitCameraFar=n,t.csmNeedUpdate=!1},i.Oo=function(t,i,n){var r=T.director.root.pipeline.pipelineSceneData.csmSupported?i.csmLevel:1,s=r>1?.5*n.size.x:n.size.x;if(!(s<0)){this.So(ER,t);for(var e=r-1;e>=0;e--){var h=this._layers[e],u=h.splitCameraNear,o=h.splitCameraFar;h.calculateSplitFrustum(t,ER,u,o),h.createMatrix(i,s,!1)}r===AA.LEVEL_1?(this._specialLayer.shadowCameraFar=this._layers[0].shadowCameraFar,ls.copy(this._specialLayer.matShadowView,this._layers[0].matShadowView),ls.copy(this._specialLayer.matShadowProj,this._layers[0].matShadowProj),ls.copy(this._specialLayer.matShadowViewProj,this._layers[0].matShadowViewProj),this._specialLayer.copyToValidFrustum(this._layers[0].validFrustum)):(this._specialLayer.calculateSplitFrustum(t,ER,.1,i.shadowDistance),this._specialLayer.createMatrix(i,s,!0))}},i.So=function(t,i){if(i.node){var n=i.node,r=n.worldPosition,s=n.worldRotation;ls.fromRT(t,s,r)}},r(t,[{key:"castShadowObjects",get:function(){return this._castShadowObjects}},{key:"layerObjects",get:function(){return this._layerObjects}},{key:"layers",get:function(){return this._layers}},{key:"specialLayer",get:function(){return this._specialLayer}}]),t}(),$R=function(){function t(){this._enabled=!0,this._blurRadius=.01,this._sssIntensity=3}return t.prototype.initialize=function(t){this._enabled=t.enabled,this._blurRadius=t.blurRadius,this._sssIntensity=t.sssIntensity},r(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"blurRadius",get:function(){return this._blurRadius},set:function(t){this._blurRadius=t}},{key:"sssIntensity",get:function(){return this._sssIntensity},set:function(t){this._sssIntensity=t}}]),t}(),zR=t("cP",function(){function t(){this.fog=new fA,this.ambient=new lA,this.skybox=new yA,this.shadows=new OA,this.csmLayers=new VR,this.octree=new IA,this.skin=new $R,this.postSettings=new gS,this.lightProbes=T.internal.LightProbes?new T.internal.LightProbes:null,this.validPunctualLights=[],this.renderObjects=[],this.shadowFrameBufferMap=new Map,this._geometryRendererMaterials=[],this._geometryRendererPasses=[],this._geometryRendererShaders=[],this._occlusionQueryVertexBuffer=null,this._occlusionQueryIndicesBuffer=null,this._occlusionQueryInputAssembler=null,this._occlusionQueryMaterial=null,this._occlusionQueryShader=null,this._isHDR=!0,this._shadingScale=1,this._csmSupported=!0,this.Io=null,this.Ro=null,this.Mo=null,this._shadingScale=1}var i=t.prototype;return i.activate=function(t){return this._device=t,this.initGeometryRendererMaterials(),this.initOcclusionQuery(),!0},i.initGeometryRendererMaterials=function(){for(var t=0,i=this._geometryRendererMaterials,n=0;n<6;n++){i[n]=new hA,i[n]._uuid="geometry-renderer-material-"+n,i[n].initialize({effectName:"internal/builtin-geometry-renderer",technique:n});for(var r=i[n].passes,s=0;s<r.length;++s)this._geometryRendererPasses[t]=r[s],this._geometryRendererShaders[t]=r[s].getShaderVariant(),t++}},i.initOcclusionQuery=function(){if(this._occlusionQueryInputAssembler||(this._occlusionQueryInputAssembler=this.Co()),!this._occlusionQueryMaterial){var t=new hA;t._uuid="default-occlusion-query-material",t.initialize({effectName:"internal/builtin-occlusion-query"}),this._occlusionQueryMaterial=t,t.passes.length>0&&(this._occlusionQueryShader=t.passes[0].getShaderVariant())}},i.getOcclusionQueryPass=function(){return this._occlusionQueryMaterial&&this._occlusionQueryMaterial.passes.length>0?this._occlusionQueryMaterial.passes[0]:null},i.updatePipelineSceneData=function(){},i.destroy=function(){var t,i,n;this.shadows.destroy(),this.csmLayers.destroy(),this.validPunctualLights.length=0,null==(t=this._occlusionQueryInputAssembler)||t.destroy(),this._occlusionQueryInputAssembler=null,null==(i=this._occlusionQueryVertexBuffer)||i.destroy(),this._occlusionQueryVertexBuffer=null,null==(n=this._occlusionQueryIndicesBuffer)||n.destroy(),this._occlusionQueryIndicesBuffer=null,this.Io=null,this.Ro=null,this.Mo=null},i.Co=function(){var t=this._device,i=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]);this._occlusionQueryVertexBuffer=t.createBuffer(new $l(10,1,96,12)),this._occlusionQueryVertexBuffer.update(i);var n=new Uint16Array([0,2,1,1,2,3,4,5,6,5,7,6,1,3,7,1,7,5,0,4,6,0,6,2,0,1,5,0,5,4,2,6,7,2,7,3]);this._occlusionQueryIndicesBuffer=t.createBuffer(new $l(6,1,72,2)),this._occlusionQueryIndicesBuffer.update(n);var r=[new ud("a_position",32)],s=new cd(r,[this._occlusionQueryVertexBuffer],this._occlusionQueryIndicesBuffer);return t.createInputAssembler(s)},r(t,[{key:"isHDR",get:function(){return this._isHDR},set:function(t){this._isHDR=t}},{key:"shadingScale",get:function(){return this._shadingScale},set:function(t){this._shadingScale=t}},{key:"csmSupported",get:function(){return this._csmSupported},set:function(t){this._csmSupported=t}},{key:"standardSkinModel",get:function(){return this.Ro},set:function(t){this.Ro=t}},{key:"standardSkinMeshRenderer",get:function(){return this.Io},set:function(t){this.Io&&this.Io!==t&&this.Io.No(),this.Io=t,this.standardSkinModel=t?t.model:null}},{key:"skinMaterialModel",get:function(){return this.Mo},set:function(t){this.Mo=t}},{key:"geometryRendererPasses",get:function(){return this._geometryRendererPasses}},{key:"geometryRendererShaders",get:function(){return this._geometryRendererShaders}}]),t}()),WR=(t("cT",{RENDER_FRAME_BEGIN:"render-frame-begin",RENDER_FRAME_END:"render-frame-end",RENDER_CAMERA_BEGIN:"render-camera-begin",RENDER_CAMERA_END:"render-camera-end",ATTACHMENT_SCALE_CAHNGED:"attachment-scale-changed"}),t("cS",function(t){function i(){var i;return(i=t.call(this)||this).eventTargetOn=t.prototype.on,i.eventTargetOnce=t.prototype.once,i}e(i,t);var n=i.prototype;return n.on=function(t,i,n,r){return this.eventTargetOn(t,i,n,r)},n.once=function(t,i,n){return this.eventTargetOnce(t,i,n)},i}(eh))),XR=t("cU",function(){function t(){this._singleMode=0,this._compositeModeValue=0,this._lightingWithAlbedo=!0,this._csmLayerColoration=!1,this._activate()}var i=t.prototype;return i.isCompositeModeEnabled=function(t){return!!(this._compositeModeValue&1<<t)},i.enableCompositeMode=function(t,i){this.Po(t,i),this._updatePipeline()},i.enableAllCompositeMode=function(t){this.Lo(t),this._updatePipeline()},i.isEnabled=function(){return 0!==this.Do()},i.reset=function(){this._activate(),this._updatePipeline()},i._activate=function(){this._singleMode=0,this.Lo(!0),this._lightingWithAlbedo=!0,this._csmLayerColoration=!1},i._updatePipeline=function(){var t=T.director.root,i=t.pipeline,n=this.Do();i.macros.CC_USE_DEBUG_VIEW!==n&&(i.macros.CC_USE_DEBUG_VIEW=n,t.onGlobalPipelineStateChanged())},i.Po=function(t,i){i?this._compositeModeValue|=1<<t:this._compositeModeValue&=~(1<<t)},i.Lo=function(t){for(var i=0;i<17;i++)t?this._compositeModeValue|=1<<i:this._compositeModeValue&=~(1<<i)},i.Do=function(){if(0!==this._singleMode)return 1;if(!0!==this._lightingWithAlbedo||!1!==this._csmLayerColoration)return 2;for(var t=0;t<17;t++)if(!this.isCompositeModeEnabled(t))return 2;return 0},r(t,[{key:"singleMode",get:function(){return this._singleMode},set:function(t){this._singleMode=t,this._updatePipeline()}},{key:"lightingWithAlbedo",get:function(){return this._lightingWithAlbedo},set:function(t){this._lightingWithAlbedo=t,this._updatePipeline()}},{key:"csmLayerColoration",get:function(){return this._csmLayerColoration},set:function(t){this._csmLayerColoration=t,this._updatePipeline()}},{key:"debugViewType",get:function(){return this.Do()}}]),t}()),YR=function(){function t(){this.Bo=200,this.Fo=0,this.Ih=new eh,this.Uo=window.DeviceMotionEvent||window.DeviceOrientationEvent,wh.browserType===hh.MOBILE_QQ&&(this.Uo=window.DeviceOrientationEvent),this.xo=this.Uo===window.DeviceMotionEvent?"devicemotion":"deviceorientation",this.Go=this.jo.bind(this)}var i=t.prototype;return i.dt=function(){this.Fo=performance.now(),window.addEventListener(this.xo,this.Go,!1)},i.Ho=function(){this.Fo=0,window.removeEventListener(this.xo,this.Go,!1)},i.jo=function(t){var i=performance.now();if(!(i-this.Fo<this.Bo)){this.Fo=i;var n=0,r=0,s=0;if(this.Uo===window.DeviceMotionEvent){var e=t.accelerationIncludingGravity;n=.1*((null==e?void 0:e.x)||0),r=.1*((null==e?void 0:e.y)||0),s=.1*((null==e?void 0:e.z)||0)}else{var h=t;n=(h.gamma||0)/90*.981,r=-(h.beta||0)/90*.981,s=(h.alpha||0)/90*.981}if(_h.isFrameRotated){var u=n;n=-r,r=u}var o=n;90===window.orientation?(n=-r,r=o):-90===window.orientation?(n=r,r=-o):180===window.orientation&&(n=-n,r=-r),wh.os===ch.ANDROID&&wh.browserType!==hh.MOBILE_QQ&&(n=-n,r=-r);var c=performance.now(),a=new nE(n,r,s,c),f=new YA(a);this.Ih.emit("devicemotion",f)}},i.start=function(){var t=this;window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(i){"granted"===i&&t.dt()})).catch((function(t){W(t)})):this.dt()},i.stop=function(){this.Ho()},i.setInterval=function(t){this.Bo=t},i.on=function(t,i,n){this.Ih.on(t,i,n)},t}(),KR=function(){},qR=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.getValue=function(){throw new Error("Method not implemented.")},i}(KR),QR=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.getValue=function(){throw new Error("Method not implemented.")},i}(KR),JR=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.getValue=function(){throw new Error("Method not implemented.")},i}(KR),ZR=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.getValue=function(){throw new Error("Method not implemented.")},i}(KR),tM=function(t){function i(i){var n;return(n=t.call(this)||this).positive=i.positive,n.negative=i.negative,n}return e(i,t),i.prototype.getValue=function(){var t=this.positive.getValue(),i=this.negative.getValue();return Math.abs(t)>Math.abs(i)?t:-i},i}(qR),iM=function(t){function i(i){var n;return(n=t.call(this)||this).up=i.up,n.down=i.down,n.left=i.left,n.right=i.right,n.xAxis=new tM({positive:n.right,negative:n.left}),n.yAxis=new tM({positive:n.up,negative:n.down}),n}return e(i,t),i.prototype.getValue=function(){return new Ms(this.xAxis.getValue(),this.yAxis.getValue())},i}(QR);!function(t){function i(i){var n;return(n=t.call(this)||this).up=i.up,n.down=i.down,n.left=i.left,n.right=i.right,n.forward=i.forward,n.backward=i.backward,n.xAxis=new tM({positive:n.right,negative:n.left}),n.yAxis=new tM({positive:n.up,negative:n.down}),n.zAxis=new tM({positive:n.forward,negative:n.backward}),n}e(i,t),i.prototype.getValue=function(){return new Ir(this.xAxis.getValue(),this.yAxis.getValue(),this.zAxis.getValue())}}(JR);var nM,rM=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.getValue=function(){return t.prototype.getValue.call(this)},i}(qR),sM=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(iM),eM=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(iM),hM=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.getValue=function(){return t.prototype.getValue.call(this)},i}(ZR),uM=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.getValue=function(){return t.prototype.getValue.call(this)},i}(JR),oM=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.getValue=function(){return t.prototype.getValue.call(this)},i}(qR),cM="left",aM="right",fM=[];!function(t){t[t.HAND_LEFT=1]="HAND_LEFT",t[t.HAND_RIGHT=4]="HAND_RIGHT",t[t.AIM_LEFT=2]="AIM_LEFT",t[t.AIM_RIGHT=5]="AIM_RIGHT"}(nM||(nM={}));var vM,lM,dM,wM,gM,pM=function(){function t(t){var i;this.Vo=-1,this.$o=!1,this.zo=((i={})[nM.HAND_LEFT]={position:Ir.ZERO,orientation:Qr.IDENTITY},i[nM.HAND_RIGHT]={position:Ir.ZERO,orientation:Qr.IDENTITY},i[nM.AIM_LEFT]={position:Ir.ZERO,orientation:Qr.IDENTITY},i[nM.AIM_RIGHT]={position:Ir.ZERO,orientation:Qr.IDENTITY},i),this.Vo=t,this.Wo()}t._init=function(){wh.hasFeature(fh.EVENT_GAMEPAD)&&t.dt()},t._on=function(i,n,r){t.Ih.on(i,n,r)},t.Xo=function(i){var n=t.all.findIndex((function(t){return t.deviceId===i}));-1!==n&&hi(t.all,n)},t.Yo=function(i,n){var r=t.all.find((function(t){return t.deviceId===i}));return r||(r=new t(i),t.all.push(r)),r.$o=n,r},t.Ko=function(i){t.qo=setInterval((function(){O.director&&O.Director&&(clearInterval(t.qo),t.qo=-1,i())}),50)},t.Qo=function(){for(var i=0,n=0,r=t.Jo.length;n<r;n++)t.Jo[n]&&i++;t.Zo=i},t.dt=function(){t.Ko((function(){t.Jo=t.tc(),t.Qo(),O.director.on(O.Director.EVENT_BEGIN_FRAME,t.nc)})),window.addEventListener("gamepadconnected",(function(i){t.Jo[i.gamepad.index]=i.gamepad,t.Qo();var n=t.Yo(i.gamepad.index,!0);t.Ih.emit("gamepad-change",new ZA("gamepad-change",n))})),window.addEventListener("gamepaddisconnected",(function(i){t.Jo[i.gamepad.index]=null,t.Qo();var n=t.Yo(i.gamepad.index,!1);t.Xo(i.gamepad.index),t.Ih.emit("gamepad-change",new ZA("gamepad-change",n))}))},t.rc=function(i){if(0!==t.Zo){var n=t.tc();if(n){for(var r=0;r<n.length;++r){var s=n[r];if(s){var e=t.Jo[s.index];if(e){for(var h=void 0,u=e.buttons,o=0;o<u.length;++o){var c=u[o],a=s.buttons[o];if(Math.abs(c.value-a.value)>.01){h=t.Yo(s.index,!0);break}}if(h){i.push(h);continue}for(var f=e.axes,v=0;v<f.length;++v){var l=f[v],d=s.axes[v];if(Math.abs(l-d)>.01){h=t.Yo(s.index,!0);break}}if(h){i.push(h);continue}}}}t.Jo=n}}},t.nc=function(){fM.length=0,t.rc(fM),t.sc(fM);for(var i=0;i<fM.length;++i){var n=fM[i];t.Ih.emit("gamepad-input",new ZA("gamepad-input",n))}t.ec()},t.sc=function(){},t.hc=function(t,i){if(!t&&!i)return!1;if(!t||!i)return!0;for(var n=i.buttons,r=0;r<n.length;++r){var s=n[r];if(0!==t.buttons[r].value||0!==s)return!0}for(var e=i.axes,h=0;h<e.length;++h){var u=e[h];if(0!==t.axes[h]||0!==u)return!0}return!1},t.uc=function(t){if(t){for(var i={buttons:new Array(t.buttons.length),axes:new Array(t.axes.length)},n=0;n<t.buttons.length;++n)i.buttons[n]=t.buttons[n].value;for(var r=0;r<t.axes.length;++r)i.axes[r]=t.axes[r];return i}},t.ec=function(){},t.oc=function(){var t;return null==(t=globalThis.__globalXR)?void 0:t.webxrGamepadMap},t.tc=function(){return"function"==typeof navigator.getGamepads?navigator.getGamepads():"function"==typeof navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]},t.ac=function(i){for(var n=t.tc(),r=0;r<n.length;++r){var s=n[r];if(s&&s.index===i)return s}};var i=t.prototype;return i.fc=function(t){var i=Math.abs(t);return t>0?{negative:0,positive:i}:t<0?{negative:i,positive:0}:{negative:0,positive:0}},i.vc=function(t){t.code!==nM.HAND_LEFT&&t.code!==nM.AIM_LEFT&&t.code!==nM.HAND_RIGHT&&t.code!==nM.AIM_RIGHT||(this.zo[t.code]={position:new Ir(t.position.x,t.position.y,t.position.z),orientation:new Qr(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)})},i.Wo=function(){var i=this;this.lc=new rM,this.lc.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(cM);return r&&r.buttons.length>5?r.buttons[5].value:0}var s=t.ac(i.deviceId);return s?s.buttons[3].value:0},this.dc=new rM,this.dc.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(aM);return r&&r.buttons.length>5?r.buttons[5].value:0}var s=t.ac(i.deviceId);return s?s.buttons[1].value:0},this.wc=new rM,this.wc.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(cM);return r&&r.buttons.length>4?r.buttons[4].value:0}var s=t.ac(i.deviceId);return s?s.buttons[2].value:0},this.gc=new rM,this.gc.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(aM);return r&&r.buttons.length>4?r.buttons[4].value:0}var s=t.ac(i.deviceId);return s?s.buttons[0].value:0},this._c=new rM,this._c.getValue=function(){var n=t.ac(i.deviceId);return n?n.buttons[4].value:0},this.yc=new rM,this.yc.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(cM);return r&&r.buttons.length>0?r.buttons[0].value:0}var s=t.ac(i.deviceId);return s?s.buttons[6].value:0},this.mc=new rM,this.mc.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(cM);if(r){if(r.buttons.length>3&&0!==r.buttons[3].value)return r.buttons[3].value;if(r.buttons.length>2&&0!==r.buttons[2].value)return r.buttons[2].value}return 0}var s=t.ac(i.deviceId);return s?s.buttons[10].value:0},this.bc=new rM,this.bc.getValue=function(){var n=t.ac(i.deviceId);return n?n.buttons[5].value:0},this.kc=new rM,this.kc.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(aM);return r&&r.buttons.length>0?r.buttons[0].value:0}var s=t.ac(i.deviceId);return s?s.buttons[7].value:0},this.Ac=new rM,this.Ac.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(aM);if(r){if(r.buttons.length>3&&0!==r.buttons[3].value)return r.buttons[3].value;if(r.buttons.length>2&&0!==r.buttons[2].value)return r.buttons[2].value}return 0}var s=t.ac(i.deviceId);return s?s.buttons[11].value:0},this.Ec=new rM,this.Ec.getValue=function(){var n=t.ac(i.deviceId);return n?n.buttons[8].value:0},this.Tc=new rM,this.Tc.getValue=function(){var n=t.ac(i.deviceId);return n?n.buttons[9].value:0};var n=new rM;n.getValue=function(){var n=t.ac(i.deviceId);return n?n.buttons[12].value:0};var r=new rM;r.getValue=function(){var n=t.ac(i.deviceId);return n?n.buttons[13].value:0};var s=new rM;s.getValue=function(){var n=t.ac(i.deviceId);return n?n.buttons[14].value:0};var e=new rM;e.getValue=function(){var n=t.ac(i.deviceId);return n?n.buttons[15].value:0},this.Oc=new sM({up:n,down:r,left:s,right:e});var h=new rM;h.getValue=function(){if(-1===i.deviceId)return 0;var n=t.ac(i.deviceId);return n?i.fc(n.axes[1]).negative:0};var u=new rM;u.getValue=function(){if(-1===i.deviceId)return 0;var n=t.ac(i.deviceId);return n?i.fc(n.axes[1]).positive:0};var o=new rM;o.getValue=function(){if(-1===i.deviceId)return 0;var n=t.ac(i.deviceId);return n?i.fc(n.axes[0]).negative:0};var c=new rM;c.getValue=function(){if(-1===i.deviceId)return 0;var n=t.ac(i.deviceId);return n?i.fc(n.axes[0]).positive:0},this.Sc=new eM({up:h,down:u,left:o,right:c});var a=new rM;a.getValue=function(){if(-1===i.deviceId)return 0;var n=t.ac(i.deviceId);return n?i.fc(n.axes[3]).negative:0};var f=new rM;f.getValue=function(){if(-1===i.deviceId)return 0;var n=t.ac(i.deviceId);return n?i.fc(n.axes[3]).positive:0};var v=new rM;v.getValue=function(){if(-1===i.deviceId)return 0;var n=t.ac(i.deviceId);return n?i.fc(n.axes[2]).negative:0};var l=new rM;l.getValue=function(){if(-1===i.deviceId)return 0;var n=t.ac(i.deviceId);return n?i.fc(n.axes[2]).positive:0},this.Ic=new eM({up:a,down:f,left:v,right:l}),this.Rc=new rM,this.Rc.getValue=function(){return 0},this.Mc=new rM,this.Mc.getValue=function(){return i.deviceId,0},this.Cc=new rM,this.Cc.getValue=function(){if(-1===i.deviceId){var n,r=null==(n=t.oc())?void 0:n.get(aM);if(r&&r.buttons.length>1)return r.buttons[1].value}return 0},this.Nc=new uM,this.Nc.getValue=function(){return i.zo[nM.HAND_LEFT].position},this.Pc=new hM,this.Pc.getValue=function(){return i.zo[nM.HAND_LEFT].orientation},this.Lc=new uM,this.Lc.getValue=function(){return i.zo[nM.HAND_RIGHT].position},this.Dc=new hM,this.Dc.getValue=function(){return i.zo[nM.HAND_RIGHT].orientation},this.Bc=new uM,this.Bc.getValue=function(){return i.zo[nM.AIM_LEFT].position},this.Fc=new hM,this.Fc.getValue=function(){return i.zo[nM.AIM_LEFT].orientation},this.Uc=new uM,this.Uc.getValue=function(){return i.zo[nM.AIM_RIGHT].position},this.xc=new hM,this.xc.getValue=function(){return i.zo[nM.AIM_RIGHT].orientation}},r(t,[{key:"buttonNorth",get:function(){return this.lc}},{key:"buttonEast",get:function(){return this.dc}},{key:"buttonWest",get:function(){return this.wc}},{key:"buttonSouth",get:function(){return this.gc}},{key:"buttonL1",get:function(){return this._c}},{key:"buttonL2",get:function(){return this.yc}},{key:"buttonL3",get:function(){return this.mc}},{key:"buttonR1",get:function(){return this.bc}},{key:"buttonR2",get:function(){return this.kc}},{key:"buttonR3",get:function(){return this.Ac}},{key:"buttonShare",get:function(){return this.Ec}},{key:"buttonOptions",get:function(){return this.Tc}},{key:"dpad",get:function(){return this.Oc}},{key:"leftStick",get:function(){return this.Sc}},{key:"rightStick",get:function(){return this.Ic}},{key:"buttonStart",get:function(){return this.Rc}},{key:"gripLeft",get:function(){return this.Mc}},{key:"gripRight",get:function(){return this.Cc}},{key:"handLeftPosition",get:function(){return this.Nc}},{key:"handLeftOrientation",get:function(){return this.Pc}},{key:"handRightPosition",get:function(){return this.Lc}},{key:"handRightOrientation",get:function(){return this.Dc}},{key:"aimLeftPosition",get:function(){return this.Bc}},{key:"aimLeftOrientation",get:function(){return this.Fc}},{key:"aimRightPosition",get:function(){return this.Uc}},{key:"aimRightOrientation",get:function(){return this.xc}},{key:"deviceId",get:function(){return this.Vo}},{key:"connected",get:function(){return this.$o}}]),t}();pM.all=[],pM.xr=null,pM.Ih=new eh,pM.Jo=[],pM.Gc=null,pM.qo=-1,pM.Zo=0,function(t){t[t.BUTTON_EAST=0]="BUTTON_EAST",t[t.BUTTON_SOUTH=1]="BUTTON_SOUTH",t[t.BUTTON_WEST=2]="BUTTON_WEST",t[t.BUTTON_NORTH=3]="BUTTON_NORTH",t[t.BUTTON_TRIGGER_LEFT=4]="BUTTON_TRIGGER_LEFT",t[t.BUTTON_TRIGGER_RIGHT=5]="BUTTON_TRIGGER_RIGHT",t[t.TRIGGER_LEFT=6]="TRIGGER_LEFT",t[t.TRIGGER_RIGHT=7]="TRIGGER_RIGHT",t[t.GRIP_LEFT=8]="GRIP_LEFT",t[t.GRIP_RIGHT=9]="GRIP_RIGHT",t[t.BUTTON_LEFT_STICK=10]="BUTTON_LEFT_STICK",t[t.LEFT_STICK_UP=11]="LEFT_STICK_UP",t[t.LEFT_STICK_DOWN=12]="LEFT_STICK_DOWN",t[t.LEFT_STICK_LEFT=13]="LEFT_STICK_LEFT",t[t.LEFT_STICK_RIGHT=14]="LEFT_STICK_RIGHT",t[t.BUTTON_RIGHT_STICK=15]="BUTTON_RIGHT_STICK",t[t.RIGHT_STICK_UP=16]="RIGHT_STICK_UP",t[t.RIGHT_STICK_DOWN=17]="RIGHT_STICK_DOWN",t[t.RIGHT_STICK_LEFT=18]="RIGHT_STICK_LEFT",t[t.RIGHT_STICK_RIGHT=19]="RIGHT_STICK_RIGHT",t[t.ROKID_MENU=20]="ROKID_MENU",t[t.ROKID_START=21]="ROKID_START"}(vM||(vM={})),function(t){t[t.KET_CLICK=0]="KET_CLICK",t[t.KET_STICK=1]="KET_STICK",t[t.KET_GRAB=2]="KET_GRAB",t[t.KET_TOUCH=3]="KET_TOUCH"}(lM||(lM={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.A=1]="A",t[t.B=2]="B",t[t.X=3]="X",t[t.Y=4]="Y",t[t.L1=5]="L1",t[t.R1=6]="R1",t[t.MINUS=7]="MINUS",t[t.PLUS=8]="PLUS",t[t.L3=9]="L3",t[t.R3=10]="R3",t[t.MENU=11]="MENU",t[t.START=12]="START",t[t.TRIGGER_LEFT=13]="TRIGGER_LEFT",t[t.TRIGGER_RIGHT=14]="TRIGGER_RIGHT"}(dM||(dM={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.X=1]="X",t[t.Y=2]="Y",t[t.LEFT_STICK_X=3]="LEFT_STICK_X",t[t.LEFT_STICK_Y=4]="LEFT_STICK_Y",t[t.RIGHT_STICK_X=5]="RIGHT_STICK_X",t[t.RIGHT_STICK_Y=6]="RIGHT_STICK_Y",t[t.L2=7]="L2",t[t.R2=8]="R2",t[t.LEFT_GRIP=9]="LEFT_GRIP",t[t.RIGHT_GRIP=10]="RIGHT_GRIP"}(wM||(wM={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.A=1]="A",t[t.B=2]="B",t[t.X=3]="X",t[t.Y=4]="Y",t[t.LEFT_TRIGGER=5]="LEFT_TRIGGER",t[t.RIGHT_TRIGGER=6]="RIGHT_TRIGGER",t[t.LEFT_THUMBSTICK=7]="LEFT_THUMBSTICK",t[t.RIGHT_THUMBSTICK=8]="RIGHT_THUMBSTICK"}(gM||(gM={}));var _M,yM={1:vM.BUTTON_EAST,2:vM.BUTTON_SOUTH,3:vM.BUTTON_NORTH,4:vM.BUTTON_WEST,9:vM.BUTTON_LEFT_STICK,10:vM.BUTTON_RIGHT_STICK,11:vM.ROKID_MENU,12:vM.ROKID_START,13:vM.BUTTON_TRIGGER_LEFT,14:vM.BUTTON_TRIGGER_RIGHT},mM=function(){function t(){var t,i,n=this;this.Ih=new eh,this.jc=((t={})[vM.BUTTON_SOUTH]=0,t[vM.BUTTON_EAST]=0,t[vM.BUTTON_WEST]=0,t[vM.BUTTON_NORTH]=0,t[vM.BUTTON_TRIGGER_LEFT]=0,t[vM.BUTTON_TRIGGER_RIGHT]=0,t[vM.TRIGGER_LEFT]=0,t[vM.TRIGGER_RIGHT]=0,t[vM.GRIP_LEFT]=0,t[vM.GRIP_RIGHT]=0,t[vM.LEFT_STICK_UP]=0,t[vM.LEFT_STICK_DOWN]=0,t[vM.LEFT_STICK_LEFT]=0,t[vM.LEFT_STICK_RIGHT]=0,t[vM.RIGHT_STICK_UP]=0,t[vM.RIGHT_STICK_DOWN]=0,t[vM.RIGHT_STICK_LEFT]=0,t[vM.RIGHT_STICK_RIGHT]=0,t[vM.BUTTON_LEFT_STICK]=0,t[vM.BUTTON_RIGHT_STICK]=0,t[vM.ROKID_MENU]=0,t[vM.ROKID_START]=0,t),this.Hc=((i={})[gM.UNDEFINE]=0,i[gM.A]=0,i[gM.B]=0,i[gM.X]=0,i[gM.Y]=0,i[gM.LEFT_TRIGGER]=0,i[gM.RIGHT_TRIGGER]=0,i[gM.LEFT_THUMBSTICK]=0,i[gM.RIGHT_THUMBSTICK]=0,i),this.Wo(),window.addEventListener("xr-remote-input",(function(t){var i=t,r=i.detail.keyEventType,s=i.detail.stickAxisCode,e=i.detail.stickAxisValue,h=i.detail.stickKeyCode,u=i.detail.isButtonPressed,o=i.detail.touchCode,c=i.detail.touchValue;if(r===lM.KET_CLICK){var a=yM[h];n.jc[a]=u?1:0}else if(r===lM.KET_STICK||r===lM.KET_GRAB){var f,v,l;switch(s){case wM.LEFT_STICK_X:f=vM.LEFT_STICK_LEFT,v=vM.LEFT_STICK_RIGHT,l=n.fc(e);break;case wM.LEFT_STICK_Y:f=vM.LEFT_STICK_DOWN,v=vM.LEFT_STICK_UP,l=n.fc(e);break;case wM.RIGHT_STICK_X:f=vM.RIGHT_STICK_LEFT,v=vM.RIGHT_STICK_RIGHT,l=n.fc(e);break;case wM.RIGHT_STICK_Y:f=vM.RIGHT_STICK_DOWN,v=vM.RIGHT_STICK_UP,l=n.fc(e);break;case wM.L2:n.jc[vM.TRIGGER_LEFT]=e;break;case wM.R2:n.jc[vM.TRIGGER_RIGHT]=e;break;case wM.LEFT_GRIP:n.jc[vM.GRIP_LEFT]=e;break;case wM.RIGHT_GRIP:n.jc[vM.GRIP_RIGHT]=e}f&&v&&l&&(n.jc[f]=l.negative,n.jc[v]=l.positive)}else if(r===lM.KET_TOUCH)switch(o){case gM.A:case gM.B:case gM.X:case gM.Y:case gM.LEFT_TRIGGER:case gM.RIGHT_TRIGGER:case gM.LEFT_THUMBSTICK:case gM.RIGHT_THUMBSTICK:n.Hc[o]=c}n.Ih.emit("handle-input",new tE("handle-input",n))}))}var i=t.prototype;return i.fc=function(t){var i=Math.abs(t);return t>0?{negative:0,positive:i}:t<0?{negative:i,positive:0}:{negative:0,positive:0}},i._on=function(t,i,n){this.Ih.on(t,i,n)},i.Wo=function(){var t=this;this.lc=new rM,this.lc.getValue=function(){return t.jc[vM.BUTTON_NORTH]},this.dc=new rM,this.dc.getValue=function(){return t.jc[vM.BUTTON_EAST]},this.wc=new rM,this.wc.getValue=function(){return t.jc[vM.BUTTON_WEST]},this.gc=new rM,this.gc.getValue=function(){return t.jc[vM.BUTTON_SOUTH]},this.Vc=new rM,this.Vc.getValue=function(){return t.jc[vM.BUTTON_TRIGGER_LEFT]},this.$c=new rM,this.$c.getValue=function(){return t.jc[vM.BUTTON_TRIGGER_RIGHT]},this.zc=new rM,this.zc.getValue=function(){return t.jc[vM.TRIGGER_LEFT]},this.Wc=new rM,this.Wc.getValue=function(){return t.jc[vM.TRIGGER_RIGHT]},this.Mc=new rM,this.Mc.getValue=function(){return t.jc[vM.GRIP_LEFT]},this.Cc=new rM,this.Cc.getValue=function(){return t.jc[vM.GRIP_RIGHT]},this.Xc=new rM,this.Xc.getValue=function(){return t.jc[vM.BUTTON_LEFT_STICK]};var i=new rM;i.getValue=function(){return t.jc[vM.LEFT_STICK_UP]};var n=new rM;n.getValue=function(){return t.jc[vM.LEFT_STICK_DOWN]};var r=new rM;r.getValue=function(){return t.jc[vM.LEFT_STICK_LEFT]};var s=new rM;s.getValue=function(){return t.jc[vM.LEFT_STICK_RIGHT]},this.Sc=new eM({up:i,down:n,left:r,right:s}),this.Yc=new rM,this.Yc.getValue=function(){return t.jc[vM.BUTTON_RIGHT_STICK]};var e=new rM;e.getValue=function(){return t.jc[vM.RIGHT_STICK_UP]};var h=new rM;h.getValue=function(){return t.jc[vM.RIGHT_STICK_DOWN]};var u=new rM;u.getValue=function(){return t.jc[vM.RIGHT_STICK_LEFT]};var o=new rM;o.getValue=function(){return t.jc[vM.RIGHT_STICK_RIGHT]},this.Ic=new eM({up:e,down:h,left:u,right:o}),this.Tc=new rM,this.Tc.getValue=function(){return t.jc[vM.ROKID_MENU]},this.Rc=new rM,this.Rc.getValue=function(){return t.jc[vM.ROKID_START]},this.Nc=new uM,this.Nc.getValue=function(){return Ir.ZERO},this.Pc=new hM,this.Pc.getValue=function(){return Qr.IDENTITY},this.Lc=new uM,this.Lc.getValue=function(){return Ir.ZERO},this.Dc=new hM,this.Dc.getValue=function(){return Qr.IDENTITY},this.Bc=new uM,this.Bc.getValue=function(){return Ir.ZERO},this.Fc=new hM,this.Fc.getValue=function(){return Qr.IDENTITY},this.Uc=new uM,this.Uc.getValue=function(){return Ir.ZERO},this.xc=new hM,this.xc.getValue=function(){return Qr.IDENTITY},this.Kc=new oM,this.Kc.getValue=function(){return t.Hc[gM.A]},this.qc=new oM,this.qc.getValue=function(){return t.Hc[gM.B]},this.Qc=new oM,this.Qc.getValue=function(){return t.Hc[gM.X]},this.Jc=new oM,this.Jc.getValue=function(){return t.Hc[gM.Y]},this.Zc=new oM,this.Zc.getValue=function(){return t.Hc[gM.LEFT_TRIGGER]},this.ta=new oM,this.ta.getValue=function(){return t.Hc[gM.RIGHT_TRIGGER]},this.na=new oM,this.na.getValue=function(){return t.Hc[gM.LEFT_THUMBSTICK]},this.ra=new oM,this.ra.getValue=function(){return t.Hc[gM.RIGHT_THUMBSTICK]}},r(t,[{key:"buttonNorth",get:function(){return this.lc}},{key:"buttonEast",get:function(){return this.dc}},{key:"buttonWest",get:function(){return this.wc}},{key:"buttonSouth",get:function(){return this.gc}},{key:"buttonTriggerLeft",get:function(){return this.Vc}},{key:"buttonTriggerRight",get:function(){return this.$c}},{key:"triggerLeft",get:function(){return this.zc}},{key:"triggerRight",get:function(){return this.Wc}},{key:"gripLeft",get:function(){return this.Mc}},{key:"gripRight",get:function(){return this.Cc}},{key:"leftStick",get:function(){return this.Sc}},{key:"rightStick",get:function(){return this.Ic}},{key:"buttonLeftStick",get:function(){return this.Xc}},{key:"buttonRightStick",get:function(){return this.Yc}},{key:"buttonOptions",get:function(){return this.Tc}},{key:"buttonStart",get:function(){return this.Rc}},{key:"handLeftPosition",get:function(){return this.Nc}},{key:"handLeftOrientation",get:function(){return this.Pc}},{key:"handRightPosition",get:function(){return this.Lc}},{key:"handRightOrientation",get:function(){return this.Dc}},{key:"aimLeftPosition",get:function(){return this.Bc}},{key:"aimLeftOrientation",get:function(){return this.Fc}},{key:"aimRightPosition",get:function(){return this.Uc}},{key:"aimRightOrientation",get:function(){return this.xc}},{key:"touchButtonA",get:function(){return this.Kc}},{key:"touchButtonB",get:function(){return this.qc}},{key:"touchButtonX",get:function(){return this.Qc}},{key:"touchButtonY",get:function(){return this.Jc}},{key:"touchButtonTriggerLeft",get:function(){return this.Zc}},{key:"touchButtonTriggerRight",get:function(){return this.ta}},{key:"touchButtonThumbStickLeft",get:function(){return this.na}},{key:"touchButtonThumbStickRight",get:function(){return this.ra}}]),t}();!function(t){t[t.VIEW_LEFT=0]="VIEW_LEFT",t[t.VIEW_RIGHT=3]="VIEW_RIGHT",t[t.HEAD_MIDDLE=6]="HEAD_MIDDLE"}(_M||(_M={}));var bM,kM=function(){function t(){var t;this.Ih=new eh,this.qo=-1,this.zo=((t={})[_M.VIEW_LEFT]={position:Ir.ZERO,orientation:Qr.IDENTITY},t[_M.VIEW_RIGHT]={position:Ir.ZERO,orientation:Qr.IDENTITY},t[_M.HEAD_MIDDLE]={position:Ir.ZERO,orientation:Qr.IDENTITY},t),this.Wo(),this.dt()}var i=t.prototype;return i.Ko=function(){var t=this;return new Promise((function(i){t.qo=setInterval((function(){O.director&&O.Director&&(clearInterval(t.qo),t.qo=-1,i())}),50)}))},i.dt=function(){var t=this;this.Ko().then((function(){O.director.on(O.Director.EVENT_BEGIN_FRAME,t.sa,t)})).catch((function(){}))},i.sa=function(){var t,i=null==(t=globalThis.__globalXR)?void 0:t.webxrHmdPoseInfos;if(i){for(var n=0;n<i.length;++n){var r=i[n];this.vc(r)}this.Ih.emit("hmd-pose-input",new iE("hmd-pose-input",this))}},i._on=function(t,i,n){this.Ih.on(t,i,n)},i.vc=function(t){t.code!==_M.VIEW_LEFT&&t.code!==_M.VIEW_RIGHT&&t.code!==_M.HEAD_MIDDLE||(this.zo[t.code]={position:new Ir(t.position.x,t.position.y,t.position.z),orientation:new Qr(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w)})},i.Wo=function(){var t=this;this.ea=new uM,this.ea.getValue=function(){return t.zo[_M.VIEW_LEFT].position},this.ha=new hM,this.ha.getValue=function(){return t.zo[_M.VIEW_LEFT].orientation},this.ua=new uM,this.ua.getValue=function(){return t.zo[_M.VIEW_RIGHT].position},this.oa=new hM,this.oa.getValue=function(){return t.zo[_M.VIEW_RIGHT].orientation},this.ca=new uM,this.ca.getValue=function(){return t.zo[_M.HEAD_MIDDLE].position},this.fa=new hM,this.fa.getValue=function(){return t.zo[_M.HEAD_MIDDLE].orientation}},r(t,[{key:"viewLeftPosition",get:function(){return this.ea}},{key:"viewLeftOrientation",get:function(){return this.ha}},{key:"viewRightPosition",get:function(){return this.ua}},{key:"viewRightOrientation",get:function(){return this.oa}},{key:"headMiddlePosition",get:function(){return this.ca}},{key:"headMiddleOrientation",get:function(){return this.fa}}]),t}(),AM=function(){function t(){this.Ih=new eh,this.Wo()}var i=t.prototype;return i._on=function(t,i,n){this.Ih.on(t,i,n)},i.Wo=function(){this.va=new uM,this.va.getValue=function(){return Ir.ZERO},this.la=new hM,this.la.getValue=function(){return Qr.IDENTITY}},r(t,[{key:"handheldPosition",get:function(){return this.va}},{key:"handheldOrientation",get:function(){return this.la}}]),t}(),EM={Backspace:8,Tab:9,Enter:13,ShiftLeft:16,ControlLeft:17,AltLeft:18,ShiftRight:2e3,ControlRight:2001,AltRight:2002,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDecimal:110,NumpadDivide:111,NumpadEnter:2003,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,Semicolon:186,Equal:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222},TM=function(){function t(){this.Ih=new eh,this.dt()}var i=t.prototype;return i.dispatchKeyboardDownEvent=function(t){this.da(t)},i.dispatchKeyboardUpEvent=function(t){this.wa(t)},i.on=function(t,i,n){this.Ih.on(t,i,n)},i.dt=function(){var t=document.getElementById("GameCanvas");null==t||t.addEventListener("keydown",this.da.bind(this)),null==t||t.addEventListener("keyup",this.wa.bind(this))},i.ga=function(t,i){var n,r=(n=t.code,EM[n]||0);return new KA(r,i)},i.da=function(t){if(t.stopPropagation(),t.preventDefault(),t.repeat){var i=this.ga(t,"key-pressing");this.Ih.emit("key-pressing",i)}else{var n=this.ga(t,"keydown");this.Ih.emit("keydown",n)}},i.wa=function(t){var i=this.ga(t,"keyup");t.stopPropagation(),t.preventDefault(),this.Ih.emit("keyup",i)},t}(),OM=function(){function t(){this.Dr=void 0,this.Ih=new eh,this.pa=!1,this.gu=!1,this._a=new Ms,this.$u=void 0,this.zu=void 0,this.Wu=void 0,wh.hasFeature(fh.EVENT_MOUSE)&&(this.Dr=document.getElementById("GameCanvas"),this.Dr||W("failed to access canvas"),this.$u=this.ya("mouse-down"),this.zu=this.ya("mouse-move"),this.Wu=this.ya("mouse-up"),this.dt())}var i=t.prototype;return i.dispatchMouseDownEvent=function(t){this.$u(t)},i.dispatchMouseMoveEvent=function(t){this.zu(t)},i.dispatchMouseUpEvent=function(t){this.Wu(t)},i.dispatchScrollEvent=function(t){this.Xu(t)},i.on=function(t,i,n){this.Ih.on(t,i,n)},i.ma=function(){var t=this.Dr,i=null==t?void 0:t.getBoundingClientRect();return i?new ee(i.x,i.y,i.width,i.height):new ee(0,0,0,0)},i.ka=function(t){var i=this.ma(),n=_h.devicePixelRatio,r=this.pa?this._a.x/n+t.movementX:t.clientX-i.x,s=this.pa?this._a.y/n-t.movementY:i.y+i.height-t.clientY;return new Ms(r*=n,s*=n)},i.dt=function(){var t,i,n,r,s,e,h=this;window.addEventListener("mousedown",(function(){h.gu=!0})),null==(t=this.Dr)||t.addEventListener("mousedown",this.$u),null==(i=this.Dr)||i.addEventListener("mousemove",this.zu),window.addEventListener("mouseup",this.Wu),null==(n=this.Dr)||n.addEventListener("mouseup",this.Wu),null==(r=this.Dr)||r.addEventListener("wheel",this.Xu.bind(this)),this.Aa(),null==(s=this.Dr)||s.addEventListener("mouseleave",this.Yu.bind(this)),null==(e=this.Dr)||e.addEventListener("mouseenter",this.Ku.bind(this))},i.Aa=function(){var t=this,i=function(){var i=t.Dr;document.pointerLockElement===i||document.mozPointerLockElement===i?t.pa=!0:t.pa=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",i,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",i,!1)},i.ya=function(t){var i=this;return function(n){var r,s=i.ka(n),e=n.button,h=n.buttons,u=e;switch(t){case"mouse-down":null==(r=i.Dr)||r.focus(),i.gu=!0;break;case"mouse-up":i.gu=!1;break;case"mouse-move":u=1&h?qA.BUTTON_LEFT:2&h?qA.BUTTON_RIGHT:4&h?qA.BUTTON_MIDDLE:qA.BUTTON_MISSING}var o=new qA(t,!1,i._a);o.setLocation(s.x,s.y),o.setButton(u),o.movementX=n.movementX,o.movementY=n.movementY,i._a.set(s.x,s.y),n.stopPropagation(),n.target===i.Dr&&n.preventDefault(),i.Ih.emit(t,o)}},i.Xu=function(t){var i="mouse-wheel",n=this.ka(t),r=t.button,s=new qA(i,!1,this._a);s.setLocation(n.x,n.y),s.setButton(r),s.movementX=t.movementX,s.movementY=t.movementY,s.setScrollData(5*t.deltaX,5*-t.deltaY),this._a.set(n.x,n.y),t.stopPropagation(),t.target===this.Dr&&t.preventDefault(),this.Ih.emit(i,s)},i.Yu=function(){var t="mouse-leave-window",i=new qA(t,!1);this.Ih.emit(t,i)},i.Ku=function(){var t="mouse-enter-window",i=new qA(t,!1);this.Ih.emit(t,i)},i.dispatchEventsInCache=function(){},t}(),SM=new Ms,IM=new(function(){function t(){this.Ea=new Map,this.Ta=8}var i=t.prototype;return i.Oa=function(t,i,n){if(this.Ea.has(t))tt(2301);else{if(!this.Sa(t)){var r=new eE(i,n,t);return this.Ea.set(t,r),this.Ia(r,i,n),r}tt(2300)}},i.releaseTouch=function(t){this.Ea.has(t)&&this.Ea.delete(t)},i.getTouch=function(t){return this.Ea.get(t)},i.getOrCreateTouch=function(t,i,n){var r=this.getTouch(t);return r?this.Ia(r,i,n):r=this.Oa(t,i,n),r},i.getAllTouches=function(){var t=[];return this.Ea.forEach((function(i){i&&t.push(i)})),t},i.getTouchCount=function(){return this.Ea.size},i.Ia=function(t,i,n){t.getLocation(SM),t.setPrevPoint(SM),t.setPoint(i,n)},i.Sa=function(t){var i=this;if(this.Ea.has(t))return!1;var n=Si.ENABLE_MULTI_TOUCH?this.Ta:1;if(this.Ea.size<n)return!1;var r=performance.now();return this.Ea.forEach((function(t){r-t.lastModified>Si.TOUCH_TIMEOUT&&(tt(2302,t.getID()),i.releaseTouch(t.getID()))})),n>=this.Ea.size},t}()),RM=function(){function t(){this.Dr=void 0,this.Ih=new eh,wh.hasFeature(fh.INPUT_TOUCH)&&(this.Dr=document.getElementById("GameCanvas"),this.Dr||W("failed to access canvas"),this.dt())}var i=t.prototype;return i.dt=function(){var t,i,n,r;null==(t=this.Dr)||t.addEventListener("touchstart",this.ya("touch-start")),null==(i=this.Dr)||i.addEventListener("touchmove",this.ya("touch-move")),null==(n=this.Dr)||n.addEventListener("touchend",this.ya("touch-end")),null==(r=this.Dr)||r.addEventListener("touchcancel",this.ya("touch-cancel"))},i.ya=function(t){var i=this;return function(n){for(var r,s=i.ma(),e=[],h=n.changedTouches.length,u=0;u<h;++u){var o=n.changedTouches[u],c=o.identifier;if(null!==c){var a=i.ka(o,s),f=IM.getOrCreateTouch(c,a.x,a.y);f&&("touch-end"!==t&&"touch-cancel"!==t||IM.releaseTouch(c),e.push(f))}}if(n.stopPropagation(),n.target===i.Dr&&n.preventDefault(),"touch-start"===t&&(null==(r=i.Dr)||r.focus()),e.length>0){var v=new JA(e,!1,t,IM.getAllTouches());i.Ih.emit(t,v)}}},i.ma=function(){var t=this.Dr,i=null==t?void 0:t.getBoundingClientRect();return i?new ee(i.x,i.y,i.width,i.height):new ee(0,0,0,0)},i.ka=function(t,i){var n=t.clientX-i.x,r=i.y+i.height-t.clientY;if(_h.isFrameRotated){var s=n;n=i.height-r,r=s}var e=_h.devicePixelRatio;return new Ms(n*=e,r*=e)},i.on=function(t,i,n){this.Ih.on(t,i,n)},i.dispatchEventsInCache=function(){},t}(),MM=function(){function t(t){this.priority=0,this.Ra=t}var i=t.prototype;return i.onThrowException=function(){},i.dispatchEvent=function(t){return this.Ra.emit(t.type,t),!0},t}(),CM=((bM={})["mouse-down"]="touch-start",bM["mouse-move"]="touch-move",bM["mouse-up"]="touch-end",bM),NM=t("e4",function(){function t(){this.Ih=new eh,this.Ma=new RM,this.Ca=new OM,this.Na=new TM,this.Pa=new YR,this.La=[],this.Da=[],this.Ba=[],this.Fa=[],this.Ua=[],this.xa=[],this.Ga=!1,this.ja=[],this.Ha=new mM,this.Va=new kM,this.$a=new AM,this.dt(),this.za=new MM(this.Ih),this._registerEventDispatcher(this.za),pM._init()}var i=t.prototype;return i.Wa=function(t){var i,n;null==(i=(n=this.Ca).dispatchMouseDownEvent)||i.call(n,t)},i.Xa=function(t){var i,n;null==(i=(n=this.Ca).dispatchMouseMoveEvent)||i.call(n,t)},i.Ya=function(t){var i,n;null==(i=(n=this.Ca).dispatchMouseUpEvent)||i.call(n,t)},i.Ka=function(t){var i,n;null==(i=(n=this.Ca).dispatchScrollEvent)||i.call(n,t)},i.qa=function(t){var i,n;null==(i=(n=this.Na).dispatchKeyboardDownEvent)||i.call(n,t)},i.Qa=function(t){var i,n;null==(i=(n=this.Na).dispatchKeyboardUpEvent)||i.call(n,t)},i.on=function(t,i,n){return this.Ih.on(t,i,n),i},i.once=function(t,i,n){return this.Ih.once(t,i,n),i},i.off=function(t,i,n){this.Ih.off(t,i,n)},i.getTouch=function(t){return IM.getTouch(t)},i.getAllTouches=function(){return IM.getAllTouches()},i.getTouchCount=function(){return IM.getTouchCount()},i.setAccelerometerEnabled=function(t){t?this.Pa.start():this.Pa.stop()},i.setAccelerometerInterval=function(t){this.Pa.setInterval(t)},i.Ja=function(t){var i=CM[t.type],n=IM.getOrCreateTouch(0,t.getLocationX(),t.getLocationY());if(n){var r=[n],s=new JA(r,!1,i,"touch-end"===i?[]:r);s.windowId=t.windowId,"touch-end"===i&&IM.releaseTouch(0),this.Za(s)}},i._registerEventDispatcher=function(t){this.ja.push(t),this.ja.sort((function(t,i){return i.priority-t.priority}))},i.tf=function(t){for(var i=this.ja.length,n=0;n<i;++n){var r=this.ja[n];try{if(!r.dispatchEvent(t))break}catch(t){throw this._clearEvents(),r.onThrowException(),t}}},i.dt=function(){var t=this,i=t.Ma,n=t.Ca,r=t.Na,s=t.Ha;if(bh.hasFeature(bh.Feature.INPUT_TOUCH)&&(i.on("touch-start",(function(i){t.Za(i)})),i.on("touch-move",(function(i){t.Za(i)})),i.on("touch-end",(function(i){t.Za(i)})),i.on("touch-cancel",(function(i){t.Za(i)}))),bh.hasFeature(bh.Feature.EVENT_MOUSE)&&(n.on("mouse-down",(function(i){t.Ga=!0,t.Ja(i),t.if(i)})),n.on("mouse-move",(function(i){t.Ga&&t.Ja(i),t.if(i)})),n.on("mouse-up",(function(i){t.Ga=!1,t.Ja(i),t.if(i)})),n.on("mouse-wheel",(function(i){t.if(i)})),n.on("mouse-leave-window",(function(i){t.if(i)})),n.on("mouse-enter-window",(function(i){t.if(i)}))),bh.hasFeature(bh.Feature.EVENT_KEYBOARD)){var e=t.La;r.on("keydown",(function(i){t.nf(i,e)})),r.on("key-pressing",(function(i){t.nf(i,e)})),r.on("keyup",(function(i){t.nf(i,e)}))}if(bh.hasFeature(bh.Feature.EVENT_ACCELEROMETER)){var h=t.Da;t.Pa.on("devicemotion",(function(i){t.nf(i,h)}))}if(bh.hasFeature(bh.Feature.EVENT_GAMEPAD)){var u=t.Ba;pM._on("gamepad-change",(function(i){t.nf(i,u)})),pM._on("gamepad-input",(function(i){t.nf(i,u)})),pM._on("handle-pose-input",(function(i){t.nf(i,u)}))}if(bh.hasFeature(bh.Feature.EVENT_HANDLE)){var o=t.Fa;s._on("handle-input",(function(i){t.nf(i,o)})),s._on("handle-pose-input",(function(i){t.nf(i,o)}))}if(bh.hasFeature(bh.Feature.EVENT_HMD)){var c=t.Ua;t.Va._on("hmd-pose-input",(function(i){t.nf(i,c)}))}if(bh.hasFeature(bh.Feature.EVENT_HANDHELD)){var a=t.xa;t.$a._on("handheld-pose-input",(function(i){t.nf(i,a)}))}},i._clearEvents=function(){this.La.length=0,this.Da.length=0,this.Ba.length=0,this.Fa.length=0,this.Ua.length=0},i.nf=function(t){this.tf(t)},i.if=function(t){this.tf(t)},i.Za=function(t){for(var i=t.getTouches(),n=i.length,r=0;r<n;++r)t.touch=i[r],t.propagationStopped=t.propagationImmediateStopped=!1,this.tf(t)},i._frameDispatchEvents=function(){},t}());NM.EventType={TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_LEAVE:"mouse-leave-window",MOUSE_ENTER:"mouse-enter-window",MOUSE_WHEEL:"mouse-wheel",KEY_DOWN:"keydown",KEY_PRESSING:"key-pressing",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",GAMEPAD_INPUT:"gamepad-input",GAMEPAD_CHANGE:"gamepad-change",HANDLE_INPUT:"handle-input",HANDLE_POSE_INPUT:"handle-pose-input",HMD_POSE_INPUT:"hmd-pose-input",HANDHELD_POSE_INPUT:"handheld-pose-input"};var PM=t("e3",new NM),LM=t("e6",function(t){function i(){var i;return i=t.call(this)||this,PM.on("mouse-down",(function(t){i.emit("mouse-down",t)})),PM.on("mouse-move",(function(t){i.emit("mouse-move",t)})),PM.on("mouse-up",(function(t){i.emit("mouse-up",t)})),PM.on("mouse-wheel",(function(t){i.emit("mouse-wheel",t)})),PM.on("touch-start",(function(t){i.emit("touch-start",t.touch,t)})),PM.on("touch-move",(function(t){i.emit("touch-move",t.touch,t)})),PM.on("touch-end",(function(t){i.emit("touch-end",t.touch,t)})),PM.on("touch-cancel",(function(t){i.emit("touch-cancel",t.touch,t)})),PM.on("keydown",(function(t){i.emit("keydown",t)})),PM.on("key-pressing",(function(t){i.emit("keydown",t)})),PM.on("keyup",(function(t){i.emit("keyup",t)})),PM.on("devicemotion",(function(t){i.emit("devicemotion",t)})),i}e(i,t);var n=i.prototype;return n.setAccelerometerEnabled=function(t){PM.setAccelerometerEnabled(t)},n.setAccelerometerInterval=function(t){PM.setAccelerometerInterval(t)},n.on=function(i,n,r,s){return t.prototype.on.call(this,i,n,r,s),n},n.off=function(i,n,r){t.prototype.off.call(this,i,n,r)},i}(eh));LM.EventType=rE,T.SystemEvent=LM;var DM=t("e5",new LM);T.systemEvent=DM;var BM={VERTICAL:0,HORIZONTAL:1},FM={ORTHO:0,PERSPECTIVE:1},UM={F1_8:0,F2_0:1,F2_2:2,F2_5:3,F2_8:4,F3_2:5,F3_5:6,F4_0:7,F4_5:8,F5_0:9,F5_6:10,F6_3:11,F7_1:12,F8_0:13,F9_0:14,F10_0:15,F11_0:16,F13_0:17,F14_0:18,F16_0:19,F18_0:20,F20_0:21,F22_0:22},xM={ISO100:0,ISO200:1,ISO400:2,ISO800:3},GM={D1:0,D2:1,D4:2,D8:3,D15:4,D30:5,D60:6,D125:7,D250:8,D500:9,D1000:10,D2000:11,D4000:12},jM=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],HM=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],VM=[100,200,400,800],$M=Rr(),zM=Rr(),WM=gs(),XM=[],YM=0,KM=function(){function t(t){if(this.isWindowSize=!0,this.screenScale=1,this.postProcess=null,this.usePostProcess=!1,this.pipeline="",this.pipelineSettings=null,this.rf=null,this.lu=null,this.Sr=null,this.sf=!1,this.ef=-1,this.hf=1,this.uf=10,this.af=0,this.ff=Vn(45),this.vf=1,this.lf=1e3,this.df=new xl(.2,.2,.2,1),this.wf=he(0,0,1,1),this.gf=he(0,0,1,1),this.pf=0,this._f=!0,this.yf=gs(),this.mf=gs(),this.bf=gs(),this.kf=gs(),this.Af=gs(),this.Ef=new $h,this.Tf=Rr(),this.Of=Rr(),this.Sf=0,this.If=19,this.Rf=7,this.Mf=0,this.Cf=0,this.Nf=0,this.Qh=null,this.Xn=1,this.Yn=1,this.Pf=0,this.Lf=1,this.Df=Ky,this.Bf=0,this.Ff=0,this.Uf=null,this.xf=0,this.Gf=-1,this.jf=0,this.vn=100,this.Hf=YM++,this.Rh=t,this.Vf=jM[this.If],this.Mf=HM[this.Rf],this.Nf=VM[this.Cf],this.Ef.accurate=!0,!XM.length){var i=t.capabilities.clipSpaceSignY;XM[0]=new ls(1,0,0,0,0,i),XM[1]=new ls(0,1,0,0,-i,0),XM[2]=new ls(-1,0,0,0,0,-i),XM[3]=new ls(0,-1,0,0,i,0)}}var i=t.prototype;return i.$f=function(t){if(void 0===t&&(t=!0),this.hf=this.window.width*this.wf.width/(this.window.height*this.wf.height),t){var i=this.window.swapchain;(i&&i.surfaceTransform||0)%2&&(this.hf=1/this.hf)}this._f=!0},i.initialize=function(t){void 0!==t.usage?this.vn=t.usage:this.zf(),void 0!==t.trackingType&&(this.jf=t.trackingType),void 0!==t.cameraType&&(this.Gf=t.cameraType),this.node=t.node,this.Xn=1,this.Yn=1,this.clearFlag=0,this.clearDepth=1,this.visibility=Ky,this.Sr=t.name,this.ef=t.projection,this.Sf=t.priority||0,this.hf=this.screenScale=1,this.Wf(),this.changeTargetWindow(t.window)},i.destroy=function(){var t;this.lu=null,this.detachFromScene(),this.Qh&&(this.Qh.detachCamera(this),this.window=null),this.Sr=null,null==(t=this.Uf)||t.destroy()},i.attachToScene=function(t){this.sf=!0,this.rf=t},i.detachFromScene=function(){this.sf=!1,this.rf=null},i.resize=function(t,i){this.Qh&&(this.Xn=t,this.Yn=i,this.hf=t*this.wf.width/(i*this.wf.height),this._f=!0)},i.setFixedSize=function(t,i){this.Xn=t,this.Yn=i,this.$f(),this.isWindowSize=!1},i.syncCameraEditor=function(){},i.update=function(t){var i;if(void 0===t&&(t=!1),this.lu){var n=!1,r=this.Tf,s=this.yf,e=this.mf;(this.lu.hasChangedFlags||t)&&(ls.invert(s,this.lu.worldMatrix),r.x=-s.m02,r.y=-s.m06,r.z=-s.m10,ls.multiply(s,(new ls).scale(this.lu.worldScale),s),this.lu.getWorldPosition(this.Of),n=!0);var h=null==(i=this.window)?void 0:i.swapchain,u=h&&h.surfaceTransform||0;if(this._f||this.pf!==u){this.pf=u;var o=this.Rh.capabilities.clipSpaceSignY;if(1===this.ef)ls.perspective(e,this.ff,this.hf,this.vf,this.lf,0===this.af,this.Rh.capabilities.clipSpaceMinZ,o,u);else{var c=this.uf*this.hf,a=this.uf;ls.ortho(e,-c,c,-a,a,this.vf,this.lf,this.Rh.capabilities.clipSpaceMinZ,o,u)}ls.invert(this.bf,e),n=!0,this._f=!1}n&&(ls.multiply(this.kf,e,s),ls.invert(this.Af,this.kf),this.Ef.update(this.kf,this.Af))}},i.setViewportInOrientedSpace=function(t){var i,n=t.x,r=t.width,s=t.height,e=this.Rh.capabilities.screenSpaceSignY<0?1-t.y-s:t.y,h=null==(i=this.window)?void 0:i.swapchain;switch(h&&h.surfaceTransform||0){case 1:this.wf.x=1-e-s,this.wf.y=n,this.wf.width=s,this.wf.height=r;break;case 2:this.wf.x=1-n-r,this.wf.y=1-e-s,this.wf.width=r,this.wf.height=s;break;case 3:this.wf.x=e,this.wf.y=1-n-r,this.wf.width=s,this.wf.height=r;break;case 0:this.wf.x=n,this.wf.y=e,this.wf.width=r,this.wf.height=s}this.gf.x=n,this.gf.y=e,this.gf.width=r,this.gf.height=s,this.resize(this.width,this.height)},i.initGeometryRenderer=function(){if(!this.Uf){var t,i=T.internal.GeometryRenderer;this.Uf=i?new i:null,null==(t=this.Uf)||t.activate(this.Rh)}},i.changeTargetWindow=function(t){void 0===t&&(t=null),this.Qh&&this.Qh.detachCamera(this);var i=t||T.director.root.mainWindow;if(i){i.attachCamera(this),this.window=i;var n=i.swapchain;(n&&n.surfaceTransform||0)%2?this.resize(i.height,i.width):this.resize(i.width,i.height)}},i.detachCamera=function(){this.Qh&&this.Qh.detachCamera(this)},i.screenPointToRay=function(t,i,n){if(!this.lu)return null;var r=this.width,s=this.height,e=this.gf.x*r,h=this.gf.y*s,u=this.gf.width*r,o=this.gf.height*s,c=1===this.ef,a=this.Rh.capabilities.clipSpaceSignY,f=hs[this.pf];Ir.set($M,(i-e)/u*2-1,(n-h)/o*2-1,c?1:-1);var v=$M.x,l=$M.y;return $M.x=v*f[0]+l*f[2]*a,$M.y=v*f[1]+l*f[3]*a,Ir.transformMat4(c?$M:t.o,$M,this.Af),c?(this.lu.getWorldPosition(zM),Ie.fromPoints(t,zM,$M)):Ir.transformQuat(t.d,Ir.FORWARD,this.lu.worldRotation),t},i.screenToWorld=function(t,i){var n=this.width,r=this.height,s=this.gf.x*n,e=this.gf.y*r,h=this.gf.width*n,u=this.gf.height*r,o=this.Rh.capabilities.clipSpaceSignY,c=hs[this.pf];if(1===this.ef){Ir.set(t,(i.x-s)/h*2-1,(i.y-e)/u*2-1,1);var a=t.x,f=t.y;t.x=a*c[0]+f*c[2]*o,t.y=a*c[1]+f*c[3]*o,Ir.transformMat4(t,t,this.Af),this.lu&&this.lu.getWorldPosition($M),Ir.lerp(t,$M,t,Hn(this.vf/this.lf,1,i.z))}else{Ir.set(t,(i.x-s)/h*2-1,(i.y-e)/u*2-1,2*i.z-1);var v=t.x,l=t.y;t.x=v*c[0]+l*c[2]*o,t.y=v*c[1]+l*c[3]*o,Ir.transformMat4(t,t,this.Af)}return t},i.worldToScreen=function(t,i){var n=this.Rh.capabilities.clipSpaceSignY,r=hs[this.pf];Ir.transformMat4(t,i,this.kf);var s=t.x,e=t.y;t.x=s*r[0]+e*r[2]*n,t.y=s*r[1]+e*r[3]*n;var h=this.width,u=this.height,o=this.gf.x*h,c=this.gf.y*u,a=this.gf.width*h,f=this.gf.height*u;return t.x=o+.5*(t.x+1)*a,t.y=c+.5*(t.y+1)*f,t.z=.5*t.z+.5,t},i.worldMatrixToScreen=function(t,i,n,r){ls.multiply(t,this.kf,i),ls.multiply(t,XM[this.pf],t);var s=n/2,e=r/2;return ls.identity(WM),ls.transform(WM,WM,Ir.set($M,s,e,0)),ls.scale(WM,WM,Ir.set($M,s,e,1)),ls.multiply(t,WM,t),t},i.calculateObliqueMat=function(t){var i=new $s(Math.sign(t.x),Math.sign(t.y),1,1).transformMat4(this.bf),n=new $s(this.mf.m03,this.mf.m07,this.mf.m11,this.mf.m15),r=2/$s.dot(t,i),s=t.multiplyScalar(r).subtract(n);this.mf.m02=s.x,this.mf.m06=s.y,this.mf.m10=s.z,this.mf.m14=s.w},i.getClipSpaceMinz=function(){return this.Rh.capabilities.clipSpaceMinZ},i.setExposure=function(t){this.Bf=.833333/Math.pow(2,t)},i.Wf=function(){var t=Math.log2(this.Vf*this.Vf/this.Mf*100/this.Nf);this.setExposure(t)},i.zf=function(){this.vn=100},r(t,[{key:"name",get:function(){return this.Sr}},{key:"scene",get:function(){return this.rf}},{key:"node",get:function(){return this.lu},set:function(t){this.lu=t}},{key:"systemWindowId",get:function(){return this.xf}},{key:"window",get:function(){return this.Qh},set:function(t){this.Qh=t}},{key:"enabled",get:function(){return this.sf},set:function(t){this.sf=t}},{key:"visibility",get:function(){return this.Df},set:function(t){this.Df=t}},{key:"priority",get:function(){return this.Sf},set:function(t){this.Sf=t}},{key:"width",get:function(){return this.Xn}},{key:"height",get:function(){return this.Yn}},{key:"position",get:function(){return this.Of},set:function(t){this.Of=t}},{key:"forward",get:function(){return this.Tf},set:function(t){this.Tf=t}},{key:"aperture",get:function(){return this.If},set:function(t){this.If=t,this.Vf=jM[this.If],this.Wf()}},{key:"apertureValue",get:function(){return this.Vf}},{key:"shutter",get:function(){return this.Rf},set:function(t){this.Rf=t,this.Mf=HM[this.Rf],this.Wf()}},{key:"shutterValue",get:function(){return this.Mf}},{key:"iso",get:function(){return this.Cf},set:function(t){this.Cf=t,this.Nf=VM[this.Cf],this.Wf()}},{key:"isoValue",get:function(){return this.Nf}},{key:"exposure",get:function(){return this.Bf}},{key:"clearFlag",get:function(){return this.Pf},set:function(t){this.Pf=t}},{key:"clearColor",get:function(){return this.df},set:function(t){this.df.x=t.x,this.df.y=t.y,this.df.z=t.z,this.df.w=t.w}},{key:"clearDepth",get:function(){return this.Lf},set:function(t){this.Lf=t}},{key:"clearStencil",get:function(){return this.Ff},set:function(t){this.Ff=t}},{key:"projectionType",get:function(){return this.ef},set:function(t){this.ef=t,this._f=!0}},{key:"aspect",get:function(){return this.hf}},{key:"orthoHeight",get:function(){return this.uf},set:function(t){this.uf=t,this._f=!0}},{key:"fovAxis",get:function(){return this.af},set:function(t){this.af=t,this._f=!0}},{key:"fov",get:function(){return this.ff},set:function(t){this.ff=t,this._f=!0}},{key:"nearClip",get:function(){return this.vf},set:function(t){this.vf=t,this._f=!0}},{key:"farClip",get:function(){return this.lf},set:function(t){this.lf=t,this._f=!0}},{key:"viewport",get:function(){return this.wf},set:function(t){st(8302),this.setViewportInOrientedSpace(t)}},{key:"frustum",get:function(){return this.Ef},set:function(t){this.Ef=t}},{key:"matView",get:function(){return this.yf}},{key:"matProj",get:function(){return this.mf}},{key:"matProjInv",get:function(){return this.bf}},{key:"matViewProj",get:function(){return this.kf}},{key:"matViewProjInv",get:function(){return this.Af}},{key:"cameraId",get:function(){return this.Hf}},{key:"surfaceTransform",get:function(){return this.pf}},{key:"geometryRenderer",get:function(){return this.Uf}},{key:"cameraType",get:function(){return this.Gf},set:function(t){this.Gf=t}},{key:"trackingType",get:function(){return this.jf},set:function(t){this.jf=t}},{key:"cameraUsage",get:function(){return this.vn},set:function(t){this.vn=t}}],[{key:"standardExposureValue",get:function(){return 1/38400}},{key:"standardLightMeterScale",get:function(){return 1e4}}]),t}(),qM=new kd(null),QM=function(){function t(){this._device=null,this._passes=null,this._shaders=null,this._subMesh=null,this._patches=null,this._priority=128,this._inputAssembler=null,this._descriptorSet=null,this._worldBoundDescriptorSet=null,this._instancedAttributeBlock={buffer:null,views:[],attributes:[]},this._instancedWorldMatrixIndex=-1,this._instancedSHIndex=-1,this._useReflectionProbeType=0}var i=t.prototype;return i.initialize=function(t,i,n){void 0===n&&(n=null),T.director.root,this._device=kw.gfxDevice,qM.layout=i[0].localSetLayout,this._inputAssembler=this._device.createInputAssembler(t.iaInfo),this._descriptorSet=this._device.createDescriptorSet(qM);var r=T.director.root.pipeline.pipelineSceneData.getOcclusionQueryPass();if(r){var s=new kd(null);s.layout=r.localSetLayout,this._worldBoundDescriptorSet=this._device.createDescriptorSet(s)}this._subMesh=t,this._patches=n?n.sort():null,this._passes=i,this._flushPassInfo(),this.priority=128},i.destroy=function(){this._descriptorSet.destroy(),this._descriptorSet=null,this._inputAssembler.destroy(),this._inputAssembler=null,this._worldBoundDescriptorSet&&this._worldBoundDescriptorSet.destroy(),this._worldBoundDescriptorSet=null,this.priority=128,this._patches=null,this._subMesh=null,this._passes=null,this._shaders=null},i.update=function(){for(var t=0;t<this._passes.length;++t)this._passes[t].update();this._descriptorSet.update(),this._worldBoundDescriptorSet&&this._worldBoundDescriptorSet.update()},i.Xf=function(){var t=this._passes;t&&(t.forEach((function(t){t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()})),this._flushPassInfo())},i.onPipelineStateChanged=function(){this.Xf()},i.onMacroPatchesStateChanged=function(t){(t||this._patches)&&(t&&(t=t.sort(),this._patches&&t.length===this._patches.length&&JSON.stringify(t)===JSON.stringify(this._patches))||(this._patches=t,this.Xf()))},i.onGeometryChanged=function(){if(this._subMesh){var t=this._subMesh.drawInfo;if(this._inputAssembler&&t){var i=this._inputAssembler.drawInfo;Object.keys(t).forEach((function(n){i[n]=t[n]})),this._inputAssembler.drawInfo=i}}},i.getInstancedAttributeIndex=function(t){for(var i=this.instancedAttributeBlock.attributes,n=0;n<i.length;n++)if(i[n].name===t)return n;return-1},i.updateInstancedWorldMatrix=function(t,i){var n=this.instancedAttributeBlock.views,r=n[i],s=n[i+1],e=n[i+2];r[0]=t.m00,r[1]=t.m01,r[2]=t.m02,r[3]=t.m12,s[0]=t.m04,s[1]=t.m05,s[2]=t.m06,s[3]=t.m13,e[0]=t.m08,e[1]=t.m09,e[2]=t.m10,e[3]=t.m14},i.updateInstancedSH=function(t,i){for(var n=this.instancedAttributeBlock.views,r=0,s=i;s<i+3;s++)for(var e=0;e<4;e++)n[s][e]=t[r++]},i.UpdateInstancedAttributes=function(t){this.instancedWorldMatrixIndex=-1,this.instancedSHIndex=-1;var i=this.passes[0];if(i.device.hasFeature(1)){for(var n=0,r=0;r<t.length;r++){var s=t[r];s.isInstanced&&(n+=Fd[s.format].size)}var e=this.instancedAttributeBlock;e.buffer=new Uint8Array(n),e.views.length=e.attributes.length=0;for(var h=0,u=0;u<t.length;u++){var o=t[u];if(o.isInstanced){var c=new ud;c.format=o.format,c.name=o.name,c.isNormalized=o.isNormalized,c.location=o.location,e.attributes.push(c);var a=Fd[o.format],f=new(Wd(a))(e.buffer.buffer,h,a.count);e.views.push(f),h+=a.size}}1===i.batchingScheme&&i.getInstancedBuffer().destroy(),this.instancedWorldMatrixIndex=this.getInstancedAttributeIndex(Z_),this.instancedSHIndex=this.getInstancedAttributeIndex(ty)}},i._flushPassInfo=function(){var t=this._passes;if(t){this._shaders||(this._shaders=[]),this._shaders.length=t.length;for(var i=0,n=t.length;i<n;i++)this._shaders[i]=t[i].getShaderVariant(this.patches)}},r(t,[{key:"passes",get:function(){return this._passes},set:function(t){t.length>8?ht(12004,8):(this._passes=t,this._flushPassInfo(),this._descriptorSet&&(this._descriptorSet.destroy(),qM.layout=t[0].localSetLayout,this._descriptorSet=this._device.createDescriptorSet(qM)))}},{key:"shaders",get:function(){return this._shaders}},{key:"subMesh",get:function(){return this._subMesh},set:function(t){this._inputAssembler.destroy(),this._inputAssembler=this._device.createInputAssembler(t.iaInfo),this._subMesh=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"worldBoundDescriptorSet",get:function(){return this._worldBoundDescriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"instancedAttributeBlock",get:function(){return this._instancedAttributeBlock}},{key:"instancedWorldMatrixIndex",get:function(){return this._instancedWorldMatrixIndex},set:function(t){this._instancedWorldMatrixIndex=t}},{key:"instancedSHIndex",get:function(){return this._instancedSHIndex},set:function(t){this._instancedSHIndex=t}},{key:"useReflectionProbeType",get:function(){return this._useReflectionProbeType},set:function(t){this._useReflectionProbeType=t}}]),t}(),JM=new ls,ZM=[{name:"CC_RECEIVE_SHADOW",value:!0}],tC=[{name:"CC_USE_LIGHTMAP",value:1}],iC=[{name:"CC_USE_LIGHTMAP",value:2}],nC=[{name:"CC_LIGHT_MAP_VERSION",value:2}],rC=[{name:"CC_USE_LIGHT_PROBE",value:!0}],sC=new Ql(2,2,0,2,2,2),eC=new Ql(2,2,2,2,2,2),hC=function(){function t(){this.type=0,this.scene=null,this.isDynamicBatching=!1,this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._localDataUpdated=!0,this._localData=new Float32Array(56),this._localBuffer=null,this._localSHData=null,this._localSHBuffer=null,this.Yf=null,this.Kf=zs(),this.qf=-1,this.Qf=Rr(1/0,1/0,1/0),this.Jf=!1,this._worldBoundBuffer=null,this._receiveShadow=!1,this._castShadow=!1,this._receiveDirLight=!0,this._shadowBias=0,this._shadowNormalBias=0,this._reflectionProbeId=-1,this._reflectionProbeBlendId=-1,this._reflectionProbeBlendWeight=0,this._enabled=!0,this._visFlags=M_.Enum.NONE,this._priority=0,this._bakeToReflectionProbe=!0,this._reflectionProbeType=0,this._device=kw.gfxDevice}var i=t.prototype;return i.initialize=function(){this._inited||(this._receiveShadow=!0,this.castShadow=!1,this.enabled=!0,this.visFlags=M_.Enum.NONE,this._inited=!0,this._bakeToReflectionProbe=!0,this._reflectionProbeType=0)},i.destroy=function(){for(var t=this._subModels,i=0;i<t.length;i++)this._subModels[i].destroy();this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._localSHBuffer&&(this._localSHBuffer.destroy(),this._localSHBuffer=null),this._worldBoundBuffer&&(this._worldBoundBuffer.destroy(),this._worldBoundBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._localDataUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1},i.attachToScene=function(t){this.scene=t,this._localDataUpdated=!0},i.detachFromScene=function(){this.scene=null},i.updateTransform=function(){var t=this.transform;if(t.hasChangedFlags||t.isTransformDirty()){t.updateWorldTransform(),this._localDataUpdated=!0;var i=this._worldBounds;this._modelBounds&&i&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,i)}},i.updateWorldBound=function(){var t=this.transform;if(null!==t){t.updateWorldTransform(),this._localDataUpdated=!0;var i=this._worldBounds;this._modelBounds&&i&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,i)}},i.updateUBOs=function(t){for(var i=this._subModels,n=0;n<i.length;n++)i[n].update();this._updateStamp=t,this.updateSHUBOs();var r=this.node.scene.globals.shadows,s=r.enabled&&r.type===bA.Planar;if(this._localDataUpdated){this._localDataUpdated=!1;for(var e=this.transform._mat,h=!1,u=0;u<i.length;u++){var o=i[u],c=o.instancedWorldMatrixIndex;c>=0?o.updateInstancedWorldMatrix(e,c):h=!0}(h||s)&&this._localBuffer&&(ls.toArray(this._localData,e,0),ls.invert(JM,e),ls.transpose(JM,JM),ls.toArray(this._localData,JM,16),this._localBuffer.update(this._localData))}},i.Zf=function(){this._localDataUpdated=!0},i.showTetrahedron=function(){return this.tv()},i.tv=function(){if(!this.Jf)return!1;var t=vA().lightProbes;return!(!t||t.empty()||!this._worldBounds)},i.iv=function(){if(this._localSHData){for(var t=this._subModels,i=!1,n=0;n<t.length;n++){var r=t[n],s=r.instancedSHIndex;s>=0?r.updateInstancedSH(this._localSHData,s):i=!0}i&&this._localSHBuffer&&this._localSHBuffer.update(this._localSHData)}},i.clearSHUBOs=function(){if(this._localSHData){for(var t=0;t<28;t++)this._localSHData[t]=0;this.iv()}},i.updateSHUBOs=function(){if(this.tv()){var t=this._worldBounds.center;if(!t.equals(this.Qf,Fn)){var i=[],n=new $s,r=T.director.root.pipeline.pipelineSceneData.lightProbes;if(this.Qf.set(t),this.qf=r.data.getInterpolationWeights(t,this.qf,n),r.data.getInterpolationSHCoefficients(this.qf,n,i)&&this._localSHData){var s=T.internal.SH;s.reduceRinging(i,r.reduceRinging),s.updateUBOData(this._localSHData,0,i),this.iv()}}}},i.createBoundingShape=function(t,i){t&&i&&(this._modelBounds||(this._modelBounds=Mh.create()),this._worldBounds||(this._worldBounds=Mh.create()),Mh.fromPoints(this._modelBounds,t,i),this._worldBounds.copy(this._modelBounds))},i.rv=function(){return new QM},i.initSubModel=function(t,i,n){this.initialize(),null==this._subModels[t]?this._subModels[t]=this.rv():this._subModels[t].destroy(),this._subModels[t].initialize(i,n.passes,this.getMacroPatches(t)),this._updateAttributesAndBinding(t)},i.setSubModelMesh=function(t,i){this._subModels[t]&&(this._subModels[t].subMesh=i)},i.setSubModelMaterial=function(t,i){this._subModels[t]&&(this._subModels[t].passes=i.passes,this._updateAttributesAndBinding(t))},i.onGlobalPipelineStateChanged=function(){for(var t=this._subModels,i=0;i<t.length;i++)t[i].onPipelineStateChanged()},i.onMacroPatchesStateChanged=function(){for(var t=this._subModels,i=0;i<t.length;i++)t[i].onMacroPatchesStateChanged(this.getMacroPatches(i))},i.onGeometryChanged=function(){for(var t=this._subModels,i=0;i<t.length;i++)t[i].onGeometryChanged()},i.initLightingmap=function(t,i){this.Yf=t,this.Kf=i},i.updateLightingmap=function(t,i){$s.toArray(this._localData,i,32),this._localDataUpdated=!0,this.Yf=t,this.Kf=i,this.onMacroPatchesStateChanged(),t||(t=Fk.get("empty-texture"));var n=t.getGFXTexture();if(n)for(var r=this._device.getSampler(t.mipmaps.length>1?eC:sC),s=this._subModels,e=0;e<s.length;e++){var h=s[e].descriptorSet;h.bindTexture(Iy,n),h.bindSampler(Iy,r),h.update()}},i.updateReflectionProbeCubemap=function(t){this._localDataUpdated=!0,this.onMacroPatchesStateChanged(),t||(t=Fk.get("default-cube-texture"));var i=t.getGFXTexture();if(i)for(var n=this._device.getSampler(t.getSamplerInfo()),r=this._subModels,s=0;s<r.length;s++){var e=r[s].descriptorSet;e&&(e.bindSampler(Dy,n),e.bindTexture(Dy,i),e.update())}},i.updateReflectionProbeBlendCubemap=function(){},i.updateReflectionProbePlanarMap=function(t){this._localDataUpdated=!0,this.onMacroPatchesStateChanged();var i=this._device.getSampler(new Ql(2,2,0,2,2,2));if(t||(t=Fk.get("empty-texture").getGFXTexture()),t)for(var n=this._subModels,r=0;r<n.length;r++){var s=n[r].descriptorSet;s&&(s.bindTexture(xy,t),s.bindSampler(xy,i),s.update())}},i.updateReflectionProbeDataMap=function(t){this._localDataUpdated=!0,this.onMacroPatchesStateChanged(),t||(t=Fk.get("empty-texture"));var i=t.getGFXTexture();if(i)for(var n=this._subModels,r=0;r<n.length;r++){var s=n[r].descriptorSet;s&&(s.bindTexture(15,i),s.bindSampler(15,t.getGFXSampler()),s.update())}},i.updateLocalShadowBias=function(){var t=this._localData;t[36]=this._shadowBias,t[37]=this._shadowNormalBias,this._localDataUpdated=!0},i.updateReflectionProbeId=function(){var t=this._localData;t[38]=this._reflectionProbeId,t[39]=this._reflectionProbeBlendId;var i=null,n=null;if(T.internal.reflectionProbeManager&&(i=T.internal.reflectionProbeManager.getProbeById(this._reflectionProbeId),n=T.internal.reflectionProbeManager.getProbeById(this._reflectionProbeBlendId)),i){if(1===i.probeType)t[40]=i.node.up.x,t[41]=i.node.up.y,t[42]=i.node.up.z,t[43]=1,t[44]=1,t[45]=0,t[46]=0,t[47]=1;else{t[40]=i.node.worldPosition.x,t[41]=i.node.worldPosition.y,t[42]=i.node.worldPosition.z,t[43]=0,t[44]=i.size.x,t[45]=i.size.y,t[46]=i.size.z;var r=i.isRGBE()?1e3:0;t[47]=i.cubemap?i.cubemap.mipmapLevel+r:1+r}if(3===this._reflectionProbeType||4===this._reflectionProbeType)if(n){t[48]=n.node.worldPosition.x,t[49]=n.node.worldPosition.y,t[50]=n.node.worldPosition.z,t[51]=this.reflectionProbeBlendWeight,t[52]=n.size.x,t[53]=n.size.y,t[54]=n.size.z;var s=n.isRGBE()?1e3:0;t[55]=n.cubemap?n.cubemap.mipmapLevel+s:1+s}else 4===this._reflectionProbeType&&(t[51]=this.reflectionProbeBlendWeight)}this._localDataUpdated=!0},i.getMacroPatches=function(){var t=this.receiveShadow?ZM:null;if(null!=this.Yf&&this.node&&this.node.scene){var i=this.node.scene.globals;if(!i.disableLightmap){var n=i.bakedWithStationaryMainLight?iC:tC;t=t?t.concat(n):n,i.bakedWithHighpLightmap&&(t=t.concat(nC))}}this.Jf&&(t=t?t.concat(rC):rC);var r=[{name:"CC_USE_REFLECTION_PROBE",value:this._reflectionProbeType}];t=t?t.concat(r):r;var s=[{name:"CC_DISABLE_DIRECTIONAL_LIGHT",value:!this._receiveDirLight}];return t?t.concat(s):s},i._updateAttributesAndBinding=function(t){var i=this._subModels[t];if(i){this._initLocalDescriptors(t),this._updateLocalDescriptors(t,i.descriptorSet),this._initLocalSHDescriptors(t),this._updateLocalSHDescriptors(t,i.descriptorSet),this._initWorldBoundDescriptors(t),i.worldBoundDescriptorSet&&this._updateWorldBoundDescriptors(t,i.worldBoundDescriptorSet);var n=[],r=new Set;i.passes.forEach((function(t){t.getShaderVariant(i.patches).attributes.forEach((function(t){r.has(t.name)||(n.push(t),r.add(t.name))}))})),this._updateInstancedAttributes(n,i)}},i._updateInstancedAttributes=function(t,i){i.UpdateInstancedAttributes(t),this._localDataUpdated=!0},i._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new $l(18,1,224,224)))},i._initLocalSHDescriptors=function(){this.Jf&&(this._localSHData||(this._localSHData=new Float32Array(28)),this._localSHBuffer||(this._localSHBuffer=this._device.createBuffer(new $l(18,1,112,112))))},i._initWorldBoundDescriptors=function(){this._worldBoundBuffer||(this._worldBoundBuffer=this._device.createBuffer(new $l(18,1,J_.SIZE,J_.SIZE)))},i._updateLocalDescriptors=function(t,i){this._localBuffer&&i.bindBuffer(0,this._localBuffer)},i._updateLocalSHDescriptors=function(t,i){this._localSHBuffer&&i.bindBuffer(6,this._localSHBuffer)},i._updateWorldBoundDescriptors=function(t,i){this._worldBoundBuffer&&i.bindBuffer(J_.BINDING,this._worldBoundBuffer)},r(t,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"localSHBuffer",get:function(){return this._localSHBuffer}},{key:"worldBoundBuffer",get:function(){return this._worldBoundBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"useLightProbe",get:function(){return this.Jf},set:function(t){this.Jf=t,this.onMacroPatchesStateChanged()}},{key:"tetrahedronIndex",get:function(){return this.qf},set:function(t){this.qf=t}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t,this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveDirLight",get:function(){return this._receiveDirLight},set:function(t){this._receiveDirLight=t,this.onMacroPatchesStateChanged()}},{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"transform",get:function(){return this._transform},set:function(t){this._transform=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"bakeToReflectionProbe",get:function(){return this._bakeToReflectionProbe},set:function(t){this._bakeToReflectionProbe=t}},{key:"reflectionProbeType",get:function(){return this._reflectionProbeType},set:function(t){this._reflectionProbeType=t;for(var i=this._subModels,n=0;n<i.length;n++)i[n].useReflectionProbeType=t;this.onMacroPatchesStateChanged()}},{key:"reflectionProbeId",get:function(){return this._reflectionProbeId},set:function(t){this._reflectionProbeId=t}},{key:"reflectionProbeBlendId",get:function(){return this._reflectionProbeBlendId},set:function(t){this._reflectionProbeBlendId=t}},{key:"reflectionProbeBlendWeight",get:function(){return this._reflectionProbeBlendWeight},set:function(t){this._reflectionProbeBlendWeight=t}}]),t}();function uC(t,i){i<1e3?i=1e3:i>15e3&&(i=15e3);var n=i*i,r=(.860117757+.000154118254*i+1.28641212e-7*n)/(1+.000842420235*i+7.08145163e-7*n),s=(.317398726+422806245e-13*i+4.20481691e-8*n)/(1-289741816e-13*i+1.61456053e-7*n),e=2*r-8*s+4,h=3*r/e,u=2*s/e,o=1/u*h,c=1/u*(1-h-u);t.x=3.2404542*o-1.5371385+-.4985314*c,t.y=-.969266*o+1.8760108+.041556*c,t.z=.0556434*o-.2040259+1.0572252*c}var oC,cC={DIRECTIONAL:0,SPHERE:1,SPOT:2,POINT:3,RANGED_DIRECTIONAL:4,UNKNOWN:5},aC=function(t){return 4*Math.PI*Math.PI*t*t},fC=function(){function t(){this._baked=!1,this._color=Rr(1,1,1),this._colorTemp=6550,this._colorTempRGB=Rr(1,1,1),this.sv=Rr(1,1,1),this._scene=null,this._node=null,this._name=null,this._useColorTemperature=!1,this._type=5,this._visibility=Ky}var i=t.prototype;return i.initialize=function(){this.color=Rr(1,1,1),this.colorTemperature=6550},i.attachToScene=function(t){this._scene=t},i.detachFromScene=function(){this._scene=null},i.destroy=function(){this._name=null,this._node=null},i.update=function(){},r(t,[{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"color",get:function(){return this._color},set:function(t){this._color.set(t),this._useColorTemperature&&Ir.multiply(this.sv,this._color,this._colorTempRGB)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,t&&Ir.multiply(this.sv,this._color,this._colorTempRGB)}},{key:"colorTemperature",get:function(){return this._colorTemp},set:function(t){this._colorTemp=t,uC(this._colorTempRGB,this._colorTemp),this._useColorTemperature&&Ir.multiply(this.sv,this._color,this._colorTempRGB)}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"finalColor",get:function(){return this.sv}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t}},{key:"node",get:function(){return this._node},set:function(t){this._node=t,this._node&&(this._node.hasChangedFlags|=2)}},{key:"type",get:function(){return this._type}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"scene",get:function(){return this._scene}}]),t}(),vC=new Ir(0,0,-1),lC=new Ir,dC=function(t){function i(){var i;return(i=t.call(this)||this)._dir=new Ir(1,-1,-1),i._illuminanceHDR=lA.SUN_ILLUM,i._illuminanceLDR=1,i._shadowEnabled=!1,i._shadowPcf=kA.HARD,i._shadowBias=1e-5,i._shadowNormalBias=0,i._shadowSaturation=1,i._shadowDistance=50,i._shadowInvisibleOcclusionRange=200,i._csmLevel=AA.LEVEL_4,i._csmNeedUpdate=!1,i._csmLayerLambda=.75,i._csmOptimizationMode=EA.DisableRotationFix,i._csmLayersTransition=!1,i._csmTransitionRange=.05,i._shadowFixedArea=!1,i._shadowNear=.1,i._shadowFar=10,i._shadowOrthoSize=5,i._type=0,i}e(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.illuminance=lA.SUN_ILLUM,this.direction=new Ir(1,-1,-1)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Ir.transformQuat(lC,vC,this._node.worldRotation))},n.ev=function(){var t=T.director.root,i=t.pipeline;this._shadowEnabled?(this._shadowFixedArea||!i.pipelineSceneData.csmSupported?i.macros.CC_DIR_LIGHT_SHADOW_TYPE=1:this.csmLevel>1&&i.pipelineSceneData.csmSupported?(i.macros.CC_DIR_LIGHT_SHADOW_TYPE=2,i.macros.CC_CASCADED_LAYERS_TRANSITION=this._csmLayersTransition):i.macros.CC_DIR_LIGHT_SHADOW_TYPE=1,i.macros.CC_DIR_SHADOW_PCF_TYPE=this._shadowPcf):i.macros.CC_DIR_LIGHT_SHADOW_TYPE=0,t.onGlobalPipelineStateChanged()},r(i,[{key:"direction",get:function(){return this._dir},set:function(t){Ir.normalize(this._dir,t)}},{key:"illuminance",get:function(){return vA().isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){vA().isHDR?this.illuminanceHDR=t:this.illuminanceLDR=t}},{key:"illuminanceHDR",get:function(){return this._illuminanceHDR},set:function(t){this._illuminanceHDR=t}},{key:"illuminanceLDR",get:function(){return this._illuminanceLDR},set:function(t){this._illuminanceLDR=t}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t,this.ev()}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t,this.ev()}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}},{key:"shadowSaturation",get:function(){return this._shadowSaturation},set:function(t){this._shadowSaturation=t}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(t){this._shadowDistance=Math.min(t,OA.MAX_FAR)}},{key:"shadowInvisibleOcclusionRange",get:function(){return this._shadowInvisibleOcclusionRange},set:function(t){this._shadowInvisibleOcclusionRange=Math.min(t,OA.MAX_FAR)}},{key:"csmLevel",get:function(){return this._csmLevel},set:function(t){this._csmLevel=t,this.ev()}},{key:"csmNeedUpdate",get:function(){return this._csmNeedUpdate},set:function(t){this._csmNeedUpdate=t}},{key:"csmLayerLambda",get:function(){return this._csmLayerLambda},set:function(t){this._csmLayerLambda=t}},{key:"csmOptimizationMode",get:function(){return this._csmOptimizationMode},set:function(t){this._csmOptimizationMode=t}},{key:"shadowFixedArea",get:function(){return this._shadowFixedArea},set:function(t){this._shadowFixedArea=t,this.ev()}},{key:"shadowNear",get:function(){return this._shadowNear},set:function(t){this._shadowNear=t}},{key:"shadowFar",get:function(){return this._shadowFar},set:function(t){this._shadowFar=Math.min(t,OA.MAX_FAR)}},{key:"shadowOrthoSize",get:function(){return this._shadowOrthoSize},set:function(t){this._shadowOrthoSize=t}},{key:"csmLayersTransition",get:function(){return this._csmLayersTransition},set:function(t){this._csmLayersTransition=t,this.ev()}},{key:"csmTransitionRange",get:function(){return this._csmTransitionRange},set:function(t){this._csmTransitionRange=t}}]),i}(fC),wC=function(t){function i(){var i;return(i=t.call(this)||this)._needUpdate=!1,i._size=.15,i._range=1,i._luminanceHDR=0,i._luminanceLDR=0,i._pos=new Ir,i._aabb=Mh.create(),i._type=1,i}e(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.range=1,this.luminanceHDR=1700/aC(.15),this.luminanceLDR=1},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var t=this._range;Mh.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,t,t,t),this._needUpdate=!1}},r(i,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return vA().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){vA().isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",set:function(t){this._luminanceLDR=t}},{key:"aabb",get:function(){return this._aabb}}]),i}(fC),gC=new Ir(0,0,-1),pC=new Qr,_C=new ls,yC=new ls,mC=new ls,bC=new ls,kC=function(t){function i(){var i;return(i=t.call(this)||this)._dir=new Ir(1,-1,-1),i._range=5,i._spotAngle=Math.cos(Math.PI/6),i._angleAttenuationStrength=0,i._pos=new Ir,i._aabb=Mh.create(),i._frustum=$h.create(),i._angle=0,i._needUpdate=!1,i._size=.15,i._luminanceHDR=0,i._luminanceLDR=0,i._shadowEnabled=!1,i._shadowPcf=kA.HARD,i._shadowBias=1e-5,i._shadowNormalBias=0,i._type=2,i}e(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.luminanceHDR=1700/aC(.15),this.luminanceLDR=1,this.range=Math.cos(Math.PI/6),this._dir.set(new Ir(1,-1,-1))},n.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Ir.transformQuat(this._dir,gC,this._node.getWorldRotation(pC)),Ir.normalize(this._dir,this._dir),Mh.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(_C),ls.invert(_C,_C),ls.perspective(yC,this._angle,1,.001,this._range),ls.multiply(mC,yC,_C),this._frustum.update(mC,bC),this._needUpdate=!1)},r(i,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return vA().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){vA().isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",get:function(){return this._luminanceLDR},set:function(t){this._luminanceLDR=t}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._angle=t,this._spotAngle=Math.cos(.5*t),this._needUpdate=!0}},{key:"angleAttenuationStrength",get:function(){return this._angleAttenuationStrength},set:function(t){this._angleAttenuationStrength=t,this._needUpdate=!0}},{key:"angle",get:function(){return this._angle}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}}]),i}(fC),AC=function(t){function i(){var i;return(i=t.call(this)||this).hv=!1,i.ov=1,i.cv=0,i.fv=0,i.vv=Rr(),i.lv=Mh.create(),i._type=3,i}e(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.range=1,this.luminanceHDR=1700/aC(1),this.luminanceLDR=1},n.update=function(){if(this._node&&(this._node.hasChangedFlags||this.hv)){this._node.getWorldPosition(this.vv);var t=this.ov;Mh.set(this.lv,this.vv.x,this.vv.y,this.vv.z,t,t,t),this.hv=!1}},r(i,[{key:"position",get:function(){return this.vv}},{key:"range",get:function(){return this.ov},set:function(t){this.ov=t,this.hv=!0}},{key:"luminance",get:function(){return vA().isHDR?this.cv:this.fv},set:function(t){vA().isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this.cv},set:function(t){this.cv=t}},{key:"luminanceLDR",set:function(t){this.fv=t}},{key:"aabb",get:function(){return this.lv}}]),i}(fC),EC=new Ir(0,0,-1),TC=function(t){function i(){var i;return(i=t.call(this)||this).dv=new Ir(0,0,-1),i.vv=new Ir(0,0,0),i.wv=new Ir(1,1,1),i.gv=new Ir(1,0,0),i.pv=lA.SUN_ILLUM,i._v=1,i._type=4,i}e(i,t);var n=i.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.illuminance=lA.SUN_ILLUM},n.update=function(){this._node&&this._node.hasChangedFlags&&(this._node.getWorldPosition(this.vv),this._node.getWorldScale(this.wv),Ir.transformQuat(this.dv,EC,this._node.worldRotation),Ir.transformQuat(this.gv,Ir.RIGHT,this._node.worldRotation))},r(i,[{key:"direction",get:function(){return this.dv}},{key:"right",get:function(){return this.gv}},{key:"position",get:function(){return this.vv}},{key:"scale",get:function(){return this.wv}},{key:"illuminance",get:function(){return vA().isHDR?this.pv:this._v},set:function(t){vA().isHDR?this.illuminanceHDR=t:this.illuminanceLDR=t}},{key:"illuminanceHDR",get:function(){return this.pv},set:function(t){this.pv=t}},{key:"illuminanceLDR",get:function(){return this._v},set:function(t){this._v=t}}]),i}(fC),OC={SKYBOX:14,SOLID_COLOR:7},SC={CUBE:0,PLANAR:1},IC=[Rr(0,-90,0),Rr(0,90,0),Rr(90,0,0),Rr(-90,0,0),Rr(0,0,0),Rr(0,180,0)],RC=Rr(),MC=function(){function t(t){this.bakedCubeTextures=[],this.realtimePlanarTexture=null,this._resolution=256,this._clearFlag=14,this._backgroundColor=new Qs(0,0,0,255),this._visibility=Ky,this._probeType=0,this._cubemap=null,this._size=Rr(1,1,1),this.yv=null,this.mv=0,this.bv=!1,this.kv=!1,this.lu=null,this.Av=null,this.Ev=null,this.Tv=Rr(),this.Ov=ss(),this.Tf=Rr(),this.Sv=Rr(),this._previewSphere=null,this._previewPlane=null,this.mv=t}var i=t.prototype;return i.initialize=function(t,i){this.lu=t,this.Av=i,this.node.getWorldPosition(RC);var n=this._size;this.Ev=Mh.create(RC.x,RC.y,RC.z,n.x,n.y,n.z),this.Iv(i)},i.initBakedTextures=function(){if(0===this.bakedCubeTextures.length)for(var t=0;t<6;t++){var i=this.Rv(this._resolution,this._resolution);this.bakedCubeTextures.push(i)}},i.captureCubemap=function(){this.initBakedTextures(),this.Mv(),this.kv=!0},i.renderPlanarReflection=function(t){if(t){if(!this.realtimePlanarTexture){var i=T.view.getDesignResolutionSize();this.realtimePlanarTexture=this.Rv(i.width,i.height),T.internal.reflectionProbeManager.updatePlanarMap(this,this.realtimePlanarTexture.getGFXTexture())}this.Cv(t),this.Nv(t),this.kv=!0}},i.switchProbeType=function(t,i){0===t?this.kv=!1:null!==i&&this.renderPlanarReflection(i)},i.getProbeId=function(){return this.mv},i.updateProbeId=function(t){this.mv=t},i.renderArea=function(){return 1===this._probeType?new Ms(this.realtimePlanarTexture.width,this.realtimePlanarTexture.height):new Ms(this.resolution,this.resolution)},i.isFinishedRendering=function(){return!0},i.validate=function(){return null!==this.cubemap},i.destroy=function(){this.yv&&(this.yv.destroy(),this.yv=null);for(var t=0;t<this.bakedCubeTextures.length;t++)this.bakedCubeTextures[t].destroy();this.bakedCubeTextures=[],this.realtimePlanarTexture&&(this.realtimePlanarTexture.destroy(),this.realtimePlanarTexture=null)},i.enable=function(){},i.disable=function(){},i.updateCameraDir=function(t){this.cameraNode.setRotationFromEuler(IC[t]),this.camera.update(!0)},i.updateBoundingBox=function(){if(this.node){this.node.getWorldPosition(RC);var t=this._size;Mh.set(this.Ev,RC.x,RC.y,RC.z,t.x,t.y,t.z)}},i.hasFrameBuffer=function(t){if(1===this.probeType){var i;if(!this.realtimePlanarTexture)return!1;if((null==(i=this.realtimePlanarTexture.window)?void 0:i.framebuffer)===t)return!0}else{if(0===this.bakedCubeTextures.length)return!1;for(var n=0;n<this.bakedCubeTextures.length;n++){var r;if((null==(r=this.bakedCubeTextures[n].window)?void 0:r.framebuffer)===t)return!0}}return!1},i.isRGBE=function(){return!0},i.Cv=function(t){this.camera.projectionType=t.projectionType,this.camera.orthoHeight=t.orthoHeight,this.camera.nearClip=t.nearClip,this.camera.farClip=t.farClip,this.camera.fov=t.fov,this.camera.clearFlag=t.clearFlag,this.camera.clearColor=t.clearColor,this.camera.priority=t.priority-1,this.camera.resize(t.width,t.height)},i.Iv=function(t){var i=T.director.root;if(!this.yv){if(this.yv=i.createCamera(),!this.yv)return null;this.yv.initialize({name:t.name,node:t,projection:1,window:i&&i.tempWindow,priority:0,cameraType:-1,trackingType:0})}return this.yv.setViewportInOrientedSpace(new ee(0,0,1,1)),this.yv.fovAxis=0,this.yv.fov=Vn(90),this.yv.orthoHeight=10,this.yv.nearClip=1,this.yv.farClip=1e3,this.yv.clearColor=this._backgroundColor,this.yv.clearDepth=1,this.yv.clearStencil=0,this.yv.clearFlag=this._clearFlag,this.yv.visibility=this._visibility,this.yv.aperture=19,this.yv.shutter=7,this.yv.iso=0,this.yv},i.Mv=function(){this.camera.projectionType=1,this.camera.orthoHeight=10,this.camera.nearClip=1,this.camera.farClip=1e3,this.camera.fov=Vn(90),this.camera.priority=0,this.camera.resize(this.resolution,this.resolution),this.camera.visibility=this._visibility,this.camera.clearFlag=this._clearFlag,this.camera.clearColor=this._backgroundColor,this.cameraNode.worldPosition=this.node.worldPosition,this.cameraNode.worldRotation=this.node.worldRotation,this.camera.update(!0)},i.Rv=function(t,i){var n=new LA;return n.reset({width:t,height:i}),n},i.Nv=function(t){var i=Ir.dot(this.node.worldPosition,this.node.up);this.Pv(this.Tv,t.node.worldPosition,this.node.up,i),this.cameraNode.worldPosition=this.Tv,Ir.transformQuat(this.Tf,Ir.FORWARD,t.node.worldRotation),this.Pv(this.Tf,this.Tf,this.node.up,0),this.Tf.normalize(),this.Tf.negative(),Ir.transformQuat(this.Sv,Ir.UP,t.node.worldRotation),this.Pv(this.Sv,this.Sv,this.node.up,0),this.Sv.normalize(),Qr.fromViewUp(this.Ov,this.Tf,this.Sv),this.cameraNode.worldRotation=this.Ov,this.camera.update(!0);var n=new $s(this.node.up.x,this.node.up.y,this.node.up.z,-Ir.dot(this.node.up,this.node.worldPosition));n.transformMat4(this.camera.matView.clone().invert().transpose()),this.camera.calculateObliqueMat(n)},i.Pv=function(t,i,n,r){var s=Ir.clone(n);s.normalize();var e=Ir.dot(s,i)-r;return s.multiplyScalar(2*e),Ir.subtract(t,i,s),t},r(t,[{key:"probeType",get:function(){return this._probeType},set:function(t){this._probeType=t}},{key:"resolution",get:function(){return this._resolution},set:function(t){t!==this._resolution&&this.bakedCubeTextures.forEach((function(i){i.resize(t,t)})),this._resolution=t}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t,this.camera.clearFlag=this._clearFlag}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this.camera.clearColor=this._backgroundColor}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this.yv.visibility=this._visibility}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t),this.node.getWorldPosition(RC),Mh.set(this.Ev,RC.x,RC.y,RC.z,t.x,t.y,t.z)}},{key:"cubemap",get:function(){return this._cubemap},set:function(t){this._cubemap=t}},{key:"node",get:function(){return this.lu}},{key:"camera",get:function(){return this.yv}},{key:"needRefresh",get:function(){return this.bv},set:function(t){this.bv=t}},{key:"needRender",get:function(){return this.kv},set:function(t){this.kv=t}},{key:"boundingBox",get:function(){return this.Ev}},{key:"cameraNode",get:function(){return this.Av},set:function(t){this.Av=t}},{key:"previewSphere",get:function(){return this._previewSphere},set:function(t){this._previewSphere=t}},{key:"previewPlane",get:function(){return this._previewPlane},set:function(t){this._previewPlane=t}}]),t}(),CC=function(){function t(){this.Lv=1,this.Dv=[]}var i=t.prototype;return i.Bv=function(t){this.Dv.splice(0,0,t)},i.Fv=function(t){var i=this.Dv.indexOf(t);i>=0&&this.Dv.splice(i,1)},i.Uv=function(){this.Dv.length=0},r(t,[{key:"models",get:function(){return this.Dv}}]),t}(),NC=function(){function t(){this.xv=void 0,this.Gv=null,this.jv=!0,this.Hv=Rr(0,0,0),this.Vv=1,this.$v=[],this.zv=[],this.Wv=!1,this.Rh=kw.gfxDevice}var i=t.prototype;return i.Xv=function(t){this.xv=t},i.Yv=function(){this.xv=null},i.Kv=function(t){if(t.length!==this.zv.length)this.Wv=!0;else for(var i=t.length,n=0;n<i;n++)if(t[n]!==this.zv[n]){this.Wv=!0;break}this.zv=t.slice()},i.qv=function(){return this.Wv},i.Qv=function(){this.Wv=!1},i.Jv=function(){return this.zv},i.Zv=function(){this.$v.length=0},i.tl=function(t,i){this.$v.splice(t,0,i)},i.il=function(t,i){this.$v[t]=i},i.nl=function(t){this.$v.splice(t,1)},i.rl=function(t){for(var i=this.sl(t),n=-1,r=0;r<this.lodCount;++r)if(i>=this.lodDataArray[r].Lv){n=r;break}return n},i.sl=function(t){return this.Gv?(1===t.projectionType&&(i=Ir.len(this.localBoundaryCenter.transformMat4(this.Gv.worldMatrix).subtract(t.node.worldPosition))),this.el(t,i,this.hl())):0;var i},i.el=function(t,i,n){return 1===t.projectionType?n*t.matProj.m05/(2*i):n*t.matProj.m05*.5},i.hl=function(){var t=this.Gv.scale;return Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.objectSize},r(t,[{key:"localBoundaryCenter",get:function(){return this.Hv.clone()},set:function(t){this.Hv.set(t)}},{key:"lodCount",get:function(){return this.$v.length}},{key:"objectSize",get:function(){return this.Vv},set:function(t){this.Vv=t}},{key:"lodDataArray",get:function(){return this.$v}}]),t}(),PC=Object.freeze({__proto__:null,Ambient:lA,CSMLevel:AA,CSMOptimizationMode:EA,Camera:KM,CameraAperture:UM,CameraFOVAxis:BM,CameraISO:xM,CameraProjection:FM,CameraShutter:GM,CameraType:{DEFAULT:-1,LEFT_EYE:0,RIGHT_EYE:1,MAIN:2},CameraUsage:{EDITOR:0,GAME_VIEW:1,SCENE_VIEW:2,PREVIEW:3,GAME:100},ColorTemperatureToRGB:uC,DirectionalLight:dC,EnvironmentLightingType:_A,FOG_TYPE_NONE:aA,Fog:fA,FogType:cA,LODData:CC,LODGroup:NC,Light:fC,LightType:cC,Model:hC,ModelType:{DEFAULT:0,SKINNING:1,BAKED_SKINNING:2,BATCH_2D:3,PARTICLE_BATCH:4,LINE:5},Octree:IA,PCFType:kA,PointLight:AC,PostSettings:gS,ProbeClearFlag:OC,ProbeType:SC,RangedDirectionalLight:TC,ReflectionProbe:MC,SKYBOX_FLAG:8,ShadowSize:mA,ShadowType:bA,Shadows:OA,Skin:$R,SkyBoxFlagValue:{VALUE:8},Skybox:yA,SphereLight:wC,SpotLight:kC,SubModel:QM,ToneMappingType:wS,TrackingType:{NO_TRACKING:0,POSITION_AND_ROTATION:1,POSITION:2,ROTATION:3},nt2lm:aC}),LC=function(){function t(t){this.Sr="",this.ul=[],this.Dv=[],this.ol=[],this.cl=[],this.al=[],this.fl=[],this.vl=[],this.ll=[],this.dl=[],this.wl=null,this.pl=0,this._l=null,this.yl=t}t.registerCreateFunc=function(i){i._createSceneFun=function(i){return new t(i)}};var i=t.prototype;return i.initialize=function(t){return this.Sr=t.name,this._l=new BC(this),!0},i.update=function(t){var i=this.wl;i&&i.update();for(var n=this.fl,r=0;r<n.length;r++)n[r].update();for(var s=this.vl,e=0;e<s.length;e++)s[e].update();for(var h=this.ll,u=0;u<h.length;u++)h[u].update();for(var o=this.dl,c=0;c<o.length;c++)o[c].update();for(var a=this.Dv,f=0;f<a.length;f++){var v=a[f];v.enabled&&(v.updateTransform(t),v.updateUBOs(t))}this._l.updateLodState()},i.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeRangedDirLights(),this.removeModels(),this.ml(),this._l.clearCache()},i.isCulledByLod=function(t,i){return this._l.isLodModelCulled(t,i)},i.addCamera=function(t){t.attachToScene(this),this.ul.push(t),this._l.addCamera(t)},i.removeCamera=function(t){for(var i=0;i<this.ul.length;++i)if(this.ul[i]===t)return this.ul.splice(i,1),t.detachFromScene(),void this._l.removeCamera(t)},i.removeCameras=function(){var t=this;this.ul.forEach((function(i){i.detachFromScene(),t._l.removeCamera(i)})),this.ul.length=0},i.setMainLight=function(t){this.wl=t,this.wl&&this.wl.ev()},i.unsetMainLight=function(t){if(this.wl===t){var i=this.al;if(i.length)return this.setMainLight(i[i.length-1]),void(this.wl.node&&(this.wl.node.hasChangedFlags|=2));this.setMainLight(null)}},i.addDirectionalLight=function(t){t.attachToScene(this),this.al.push(t)},i.removeDirectionalLight=function(t){for(var i=0;i<this.al.length;++i)if(this.al[i]===t)return t.detachFromScene(),void this.al.splice(i,1)},i.addSphereLight=function(t){t.attachToScene(this),this.fl.push(t)},i.removeSphereLight=function(t){for(var i=0;i<this.fl.length;++i)if(this.fl[i]===t)return t.detachFromScene(),void this.fl.splice(i,1)},i.addSpotLight=function(t){t.attachToScene(this),this.vl.push(t)},i.removeSpotLight=function(t){for(var i=0;i<this.vl.length;++i)if(this.vl[i]===t)return t.detachFromScene(),void this.vl.splice(i,1)},i.removeSphereLights=function(){for(var t=0;t<this.fl.length;++t)this.fl[t].detachFromScene();this.fl.length=0},i.removeSpotLights=function(){for(var t=0;t<this.vl.length;++t)this.vl[t].detachFromScene();this.vl.length=0},i.addPointLight=function(t){t.attachToScene(this),this.ll.push(t)},i.removePointLight=function(t){for(var i=0;i<this.ll.length;++i)if(this.ll[i]===t)return t.detachFromScene(),void this.ll.splice(i,1)},i.removePointLights=function(){for(var t=0;t<this.ll.length;++t)this.ll[t].detachFromScene();this.ll.length=0},i.addRangedDirLight=function(t){t.attachToScene(this),this.dl.push(t)},i.removeRangedDirLight=function(t){for(var i=0;i<this.dl.length;++i)if(this.dl[i]===t)return t.detachFromScene(),void this.dl.splice(i,1)},i.removeRangedDirLights=function(){for(var t=0;t<this.dl.length;++t)this.dl[t].detachFromScene();this.dl.length=0},i.addModel=function(t){t.attachToScene(this),this.Dv.push(t)},i.removeModel=function(t){for(var i=0;i<this.Dv.length;++i)if(this.Dv[i]===t)return this._l.removeModel(t),t.detachFromScene(),void this.Dv.splice(i,1)},i.removeModels=function(){var t=this;this.Dv.forEach((function(i){t._l.removeModel(i),i.detachFromScene(),i.destroy()})),this.Dv.length=0},i.addBatch=function(t){this.cl.push(t)},i.removeBatch=function(t){for(var i=0;i<this.cl.length;++i)if(this.cl[i]===t)return void this.cl.splice(i,1)},i.removeBatches=function(){this.cl.length=0},i.addLODGroup=function(t){this.ol.push(t),t.Xv(this),this._l.addLodGroup(t)},i.kl=function(t){var i=this.ol.indexOf(t);i>=0&&(this.ol.splice(i,1),t.Yv(),this._l.removeLodGroup(t))},i.ml=function(){var t=this;this.ol.forEach((function(i){t._l.removeLodGroup(i)})),this.ol.length=0},i.onGlobalPipelineStateChanged=function(){this.Dv.forEach((function(t){t.onGlobalPipelineStateChanged()}))},i.generateModelId=function(){return this.pl++},r(t,[{key:"root",get:function(){return this.yl}},{key:"name",get:function(){return this.Sr}},{key:"cameras",get:function(){return this.ul}},{key:"mainLight",get:function(){return this.wl}},{key:"sphereLights",get:function(){return this.fl}},{key:"spotLights",get:function(){return this.vl}},{key:"pointLights",get:function(){return this.ll}},{key:"rangedDirLights",get:function(){return this.dl}},{key:"models",get:function(){return this.Dv}},{key:"batches",get:function(){return this.cl}},{key:"lodGroups",get:function(){return this.ol}}]),t}(),DC=function(){this.usedLevel=-1,this.lastUsedLevel=-1,this.transformDirty=!0},BC=function(){function t(t){this.Al=null,this.El=new Map,this.Tl=new Map,this.Ol=[],this.Sl=new Map,this.Al=t}var i=t.prototype;return i.addCamera=function(t){for(var i=this.Al.lodGroups,n=0;n<i.length;n++){var r=i[n].Gv.layer;if((t.visibility&r)===r){this.Tl.has(t)||this.Tl.set(t,new Map);break}}},i.removeCamera=function(t){this.Tl.has(t)&&this.Tl.delete(t)},i.addLodGroup=function(t){this.Ol.push(t);for(var i=this.Al.cameras,n=0;n<i.length;n++){var r=i[n];if(!this.Tl.has(r)){var s=t.Gv.layer;(r.visibility&s)===s&&this.Tl.set(r,new Map)}}},i.removeLodGroup=function(t){for(var i=this,n=0;n<t.lodCount;n++)t.lodDataArray[n].models.forEach((function(t){i.El.delete(t)}));for(var r,s=w(this.Tl);!(r=s()).done;)r.value[1].delete(t);this.Sl.delete(t)},i.removeModel=function(t){this.El.has(t)&&this.El.delete(t)},i.updateLodState=function(){var t=this;this.Ol.forEach((function(i){var n=t.Sl.get(i);n||(n=new Map,t.Sl.set(i,n));for(var r=0;r<i.lodCount;r++){var s=n.get(r);s||(s=[]);for(var e=i.lodDataArray[r].models,h=0;h<e.length;h++){var u=e[h],o=t.El.get(u);o||(o=new Map),t.El.set(u,o),s.push(u)}n.set(r,s)}})),this.Ol.length=0;for(var i=this.Al.lodGroups,n=function(){var n=i[r];if(n.jv){var s=n.Jv();if(s.length>0){if(n.Gv.hasChangedFlags>0)for(var e,h=w(t.Tl);!(e=h()).done;){var u=e.value,o=u[1].get(n);o||(o=new DC,u[1].set(n,o)),o.transformDirty=!0}if(n.qv()){n.Qv();var c=t.Sl.get(n);c&&(c.forEach((function(i){i.forEach((function(i){var n=t.El.get(i);n&&n.clear()}))})),s.forEach((function(i){var n=c.get(i);n&&n.forEach((function(i){var n=t.El.get(i);if(n&&i.node&&i.node.active)for(var r,s=w(t.Tl);!(r=s()).done;){var e=r.value;n.set(e[0],!0)}}))})))}return 0}for(var a,f=!1,v=w(t.Tl);!(a=v()).done;){var l=a.value,d=l[1].get(n);d||(d=new DC,l[1].set(n,d));var g=l[0].node.hasChangedFlags,p=n.Gv.hasChangedFlags;if(g>0||p>0||d.transformDirty){d.transformDirty&&(d.transformDirty=!1);var _=n.rl(l[0]);_!==d.usedLevel&&(d.lastUsedLevel=d.usedLevel,d.usedLevel=_,f=!0)}}var y=t.Sl.get(n);if(!y)return 0;n.qv()?(n.Qv(),y.forEach((function(i){i.forEach((function(i){var n=t.El.get(i);n&&n.clear()}))})),f=!0):f&&t.Tl.forEach((function(i){var r=i.get(n);if(r&&r.usedLevel!==r.lastUsedLevel){var s=y.get(r.lastUsedLevel);s&&s.forEach((function(i){var n=t.El.get(i);n&&n.clear()}))}})),f&&t.Tl.forEach((function(i,r){var s=i.get(n);if(s){var e=s.usedLevel,h=y.get(e);h&&h.forEach((function(i){var n=t.El.get(i);n&&i.node&&i.node.active&&n.set(r,!0)}))}}))}},r=0;r<i.length;r++)n()},i.isLodModelCulled=function(t,i){var n=this.El.get(i);return!!n&&!n.has(t)},i.clearCache=function(){this.Sl.clear(),this.El.clear(),this.Tl.clear(),this.Ol.length=0},i.Il=function(t,i){var n=t.Gv.layer;return(i.visibility&n)===n},t}(),FC=((oC={})[Ti.PORTRAIT]=0,oC[Ti.LANDSCAPE_RIGHT]=1,oC[Ti.PORTRAIT_UPSIDE_DOWN]=2,oC[Ti.LANDSCAPE_LEFT]=3,oC),UC=0,xC=function(){var t=i.prototype;function i(){this._title="",this._width=1,this._height=1,this._swapchain=null,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null,this._device=null,this._renderWindowId=UC++,this._isResized=!0,this._colorName="Color"+this._renderWindowId,this._depthStencilName="DepthStencil"+this._renderWindowId}return t.isRenderWindowResized=function(){return this._isResized},t.setRenderWindowResizeHandled=function(){this._isResized=!1},i.registerCreateFunc=function(t){t._createWindowFun=function(){return new i}},t.initialize=function(t,i){if(void 0!==i.title&&(this._title=i.title),void 0!==i.swapchain&&(this._swapchain=i.swapchain),this._width=i.width,this._height=i.height,this._device=t,this._renderPass=t.createRenderPass(i.renderPassInfo),i.swapchain)this._swapchain=i.swapchain,this._colorTextures.push(i.swapchain.colorTexture),this._depthStencilTexture=i.swapchain.depthStencilTexture;else{for(var n=0;n<i.renderPassInfo.colorAttachments.length;n++){var r=new Kl(1,21,i.renderPassInfo.colorAttachments[n].format,this._width,this._height);i.externalFlag&&(8&i.externalFlag||4&i.externalFlag)&&(r.flags|=i.externalFlag,r.externalRes=i.externalResLow?i.externalResLow:0),this._colorTextures.push(t.createTexture(r))}i.renderPassInfo.depthStencilAttachment&&0!==i.renderPassInfo.depthStencilAttachment.format&&(this._depthStencilTexture=t.createTexture(new Kl(1,36,i.renderPassInfo.depthStencilAttachment.format,this._width,this._height)),this._hasOffScreenAttachments=!0)}return this._framebuffer=t.createFramebuffer(new yd(this._renderPass,this._colorTextures,this._depthStencilTexture)),!0},t.destroy=function(){this.clearCameras(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var t=0;t<this._colorTextures.length;t++){var i=this._colorTextures[t];i&&i.destroy()}this._colorTextures.length=0,this._device=null},t.resize=function(t,i){if(this._swapchain)this._swapchain.resize(t,i,FC[_h.orientation]),this._width=this._swapchain.width,this._height=this._swapchain.height;else{for(var n=0;n<this._colorTextures.length;n++)this._colorTextures[n].resize(t,i);this._depthStencilTexture&&this._depthStencilTexture.resize(t,i),this._width=t,this._height=i}this.framebuffer&&(this.framebuffer.destroy(),this._framebuffer=this._device.createFramebuffer(new yd(this._renderPass,this._colorTextures,this._depthStencilTexture))),this._cameras.forEach((function(n){n.resize(t,i)})),this._isResized=!0},t.extractRenderCameras=function(t){for(var i=0;i<this._cameras.length;i++){var n=this._cameras[i];n.enabled&&(n.update(),t.push(n))}},t.attachCamera=function(t){for(var i=0;i<this._cameras.length;i++)if(this._cameras[i]===t)return;this._cameras.push(t),this.sortCameras(),this._isResized=!0},t.detachCamera=function(t){for(var i=0;i<this._cameras.length;++i)if(this._cameras[i]===t)return void this._cameras.splice(i,1)},t.clearCameras=function(){this._cameras.length=0},t.sortCameras=function(){this._cameras.sort((function(t,i){return t.priority-i.priority}))},r(i,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"swapchain",get:function(){return this._swapchain}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"cameras",get:function(){return this._cameras}},{key:"renderWindowId",get:function(){return this._renderWindowId}},{key:"colorName",get:function(){return this._colorName}},{key:"depthStencilName",get:function(){return this._depthStencilName}}]),i}(),GC=t("ah",function(){function t(t){var i=this;this._createSceneFun=null,this._createWindowFun=null,this.Rl=[],this.Ml=null,this.Cl=null,this.Nl=null,this.Pl=!0,this.Ll=null,this.Dl=new WR,this.Bl=null,this.Fl=null,this.Ul=null,this.xl=[],this.Gl=new Map,this.jl=null,this.Hl=new Map,this.Vl=new XR,this.$l=0,this.zl=0,this.Wl=0,this.Xl=0,this.Yl=!1,this.Kl=0,this.ql=0,this.Ql=[],this.Rh=t,this.Jl=T.internal.DataPoolManager&&new T.internal.DataPoolManager(t),LC.registerCreateFunc(this),xC.registerCreateFunc(this),this.jl=new xe((function(){return new KM(i.Rh)}),4,(function(t){return t.destroy()}))}var i=t.prototype;return i.initialize=function(){var t,i=kw.swapchain,n=new ad;n.format=i.colorTexture.format;var r=new fd;r.format=i.depthStencilTexture.format,r.depthStoreOp=1,r.stencilStoreOp=1;var s=new dd([n],r);this.Ml=this.createWindow({title:"rootMainWindow",width:i.width,height:i.height,renderPassInfo:s,swapchain:i}),this.Cl=this.Ml;var e=Oi.querySettings("animation","customJointTextureLayouts")||[];null==(t=this.Jl)||t.jointTexturePool.registerCustomTextureLayouts(e),this.Zl()},i.destroy=function(){this.destroyScenes(),this.Ll&&(this.Ll.destroy(),this.Ll=null,this.Dl=null),this.Ul&&(this.Ul.destroy(),this.Ul=null),this.Cl=null,this.Ml=null,this.dataPoolManager.clear(),T.rendering&&T.rendering.destroy()},i.resize=function(t,i){this.Rl.forEach((function(n){n.swapchain&&n.resize(t,i)}))},i.setRenderPipeline=function(t){var i=T.internal,n=T.director,r=T.rendering,s=T.legacy_rendering;if(void 0===r&&void 0===s)return ht(1223),!1;var e=!1;if(t)this.Fl=r.createCustomPipeline(),e=!0,this.Ll=this.Fl,z("Using custom pipeline: "+Si.CUSTOM_PIPELINE_NAME);else{var h=s.createDefaultPipeline();e=!0,z("Using legacy pipeline"),this.Bl=h,this.Ll=this.Bl,this.Dl=this.Bl,this.Pl=!1}if((3!==Oi.querySettings("rendering","renderMode")||this.Bl)&&!this.Ll.activate(this.Ml.swapchain))return e&&this.Ll.destroy(),this.Bl=null,this.Fl=null,this.Ll=null,this.Dl=null,!1;var u=n.getScene();return u&&u.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this.Ul&&i.Batcher2D&&(this.Ul=new i.Batcher2D(this),!this.Ul.initialize())&&(this.destroy(),1))},i.onGlobalPipelineStateChanged=function(){for(var t=0;t<this.xl.length;t++)this.xl[t].onGlobalPipelineStateChanged();vA().skybox.enabled&&vA().skybox.model.onGlobalPipelineStateChanged(),this.Ll.onGlobalPipelineStateChanged()},i.activeWindow=function(t){this.Cl=t},i.resetCumulativeTime=function(){this.Kl=0},i.frameMove=function(t){this.ql=t,++this.zl,this.Kl+=t,this.$l+=t,this.$l>1&&(this.Wl=this.zl,this.zl=0,this.$l=0),this.td(),this.nd(),this.rd()},i.createWindow=function(t){var i=this._createWindowFun(this);return i.initialize(this.device,t),this.Rl.push(i),i},i.destroyWindow=function(t){for(var i=0;i<this.Rl.length;++i)if(this.Rl[i]===t)return t.destroy(),void this.Rl.splice(i,1)},i.destroyWindows=function(){this.Rl.forEach((function(t){t.destroy()})),this.Rl.length=0},i.createScene=function(t){var i=this._createSceneFun(this);return i.initialize(t),this.xl.push(i),i},i.destroyScene=function(t){for(var i=0;i<this.xl.length;++i)if(this.xl[i]===t)return t.destroy(),void this.xl.splice(i,1)},i.destroyScenes=function(){this.xl.forEach((function(t){t.destroy()})),this.xl.length=0},i.createModel=function(t){var i=this.Gl.get(t);i||(this.Gl.set(t,new xe((function(){return new t}),10,(function(t){return t.destroy()}))),i=this.Gl.get(t));var n=i.alloc();return n.initialize(),n},i.destroyModel=function(t){var i=this.Gl.get(t.constructor);i?(i.free(t),t.scene&&t.scene.removeModel(t)):st(1300,t.constructor.name),t.destroy()},i.createCamera=function(){return this.jl.alloc()},i.createLight=function(t){var i=this.Hl.get(t);i||(this.Hl.set(t,new xe((function(){return new t}),4,(function(t){return t.destroy()}))),i=this.Hl.get(t));var n=i.alloc();return n.initialize(),n},i.destroyLight=function(t){if(t.scene)switch(t.type){case 0:t.scene.removeDirectionalLight(t);break;case 1:t.scene.removeSphereLight(t);break;case 2:t.scene.removeSpotLight(t);break;case 3:t.scene.removePointLight(t);break;case 4:t.scene.removeRangedDirLight(t)}t.destroy()},i.recycleLight=function(t){var i=this.Hl.get(t.constructor);if(i&&(i.free(t),t.scene))switch(t.type){case 0:t.scene.removeDirectionalLight(t);break;case 1:t.scene.removeSphereLight(t);break;case 2:t.scene.removeSpotLight(t);break;case 3:t.scene.removePointLight(t);break;case 4:t.scene.removeRangedDirLight(t)}},i.sd=function(){},i.td=function(){for(var t=0;t<this.xl.length;++t)this.xl[t].removeBatches();this.Ql.length=0},i.nd=function(){for(var t=T.director,i=this.Rl,n=this.Ql,r=0;r<i.length;r++)i[r].extractRenderCameras(n);if(this.Ll&&n.length>0){this.Rh.acquire([kw.swapchain]);var s=this.xl,e=t.getTotalFrames();this.Ul&&(this.Ul.update(),this.Ul.uploadBuffers());for(var h=0;h<s.length;h++)s[h].update(e)}},i.rd=function(){var t=T.director,i=T.Director,n=this.Ql;if(this.Ll&&n.length>0){t.emit(i.EVENT_BEFORE_COMMIT),n.sort((function(t,i){return t.priority-i.priority}));for(var r=0;r<n.length;++r){var s;null==(s=n[r].geometryRenderer)||s.update()}t.emit(i.EVENT_BEFORE_RENDER),this.Ll.render(n),t.emit(i.EVENT_AFTER_RENDER),this.Rh.present()}this.Ul&&this.Ul.reset()},i.Zl=function(){var t=Math.max((288+J_.COUNT)/4,100),i=Math.floor((kw.gfxDevice.capabilities.maxVertexUniformVectors-t)/3);oy(i=i<256?i:256)},r(t,[{key:"device",get:function(){return this.Rh}},{key:"mainWindow",get:function(){return this.Ml}},{key:"curWindow",get:function(){return this.Cl},set:function(t){this.Cl=t}},{key:"tempWindow",get:function(){return this.Nl},set:function(t){this.Nl=t}},{key:"windows",get:function(){return this.Rl}},{key:"usesCustomPipeline",get:function(){return this.Pl}},{key:"pipeline",get:function(){return this.Ll}},{key:"customPipeline",get:function(){return this.Fl}},{key:"pipelineEvent",get:function(){return this.Dl}},{key:"batcher2D",get:function(){return this.Ul}},{key:"scenes",get:function(){return this.xl}},{key:"debugView",get:function(){return this.Vl}},{key:"cumulativeTime",get:function(){return this.Kl}},{key:"frameTime",get:function(){return this.ql}},{key:"frameCount",get:function(){return this.zl}},{key:"fps",get:function(){return this.Wl}},{key:"fixedFPS",get:function(){return this.Xl},set:function(t){t>0&&(this.Xl=t)}},{key:"dataPoolManager",get:function(){return this.Jl}},{key:"useDeferredPipeline",get:function(){return this.Yl}},{key:"cameraList",get:function(){return this.Ql}}]),t}());function jC(t,i){if(!i){var n=O.director.getScene();if(!n)return null;i=n}return i.getChildByPath(t)}T.Root=GC,Tn.Attr.setClassAttr(Xg,"target","type","Object"),Tn.Attr.setClassAttr(Xg,"target","ctor",WE),O.find=jC;var HC=hi,VC=65536,$C=2048;function zC(t,i){for(var n=i.constructor._executionOrder,r=i._id,s=0,e=t.length-1,h=e>>>1;s<=e;h=s+e>>>1){var u=t[h],o=u.constructor._executionOrder;if(o>n)e=h-1;else if(o<n)s=h+1;else{var c=u._id;if(c>r)e=h-1;else{if(!(c<r))return h;s=h+1}}}return~s}function WC(t,i){for(var n=t.array,r=t.i+1;r<n.length;){var s=n[r];s.node._activeInHierarchy?++r:(t.removeAt(r),i&&(s._objFlags&=~i))}}var XC=function(){function t(t){var i=si;this._zero=new i([]),this._neg=new i([]),this._pos=new i([]),this._invoke=t}return r(t,[{key:"zero",get:function(){return this._zero}},{key:"neg",get:function(){return this._neg}},{key:"pos",get:function(){return this._pos}}]),t}();function YC(t,i){return t.constructor._executionOrder-i.constructor._executionOrder}XC.stableRemoveInactive=WC;var KC=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.add=function(t){var i=t.constructor._executionOrder;(0===i?this._zero:i<0?this._neg:this._pos).array.push(t)},n.remove=function(t){var i=t.constructor._executionOrder;(0===i?this._zero:i<0?this._neg:this._pos).fastRemove(t)},n.cancelInactive=function(t){WC(this._zero,t),WC(this._neg,t),WC(this._pos,t)},n.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(YC),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var i=this._pos;i.array.length>0&&(i.array.sort(YC),this._invoke(i),i.array.length=0)},i}(XC),qC=function(t){function i(i){return t.call(this,i)||this}e(i,t);var n=i.prototype;return n.add=function(t){var i=t.constructor._executionOrder;if(0===i)this._zero.array.push(t);else{var n=i<0?this._neg.array:this._pos.array,r=zC(n,t);r<0&&n.splice(~r,0,t)}},n.remove=function(t){var i=t.constructor._executionOrder;if(0===i)this._zero.fastRemove(t);else{var n=i<0?this._neg:this._pos,r=zC(n.array,t);r>=0&&n.removeAt(r)}},n.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},i}(XC);function QC(t,i,n){var r="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}",s=i?Function("it","dt",r):Function("it",r);return JC(Function("c","dt",t),s,n)}function JC(t,i,n){return function(r,s){try{i(r,s)}catch(i){O._throw(i);var e=r.array;for(n&&(e[r.i]._objFlags|=n),++r.i;r.i<e.length;++r.i)try{t(e[r.i],s)}catch(t){O._throw(t),n&&(e[r.i]._objFlags|=n)}}}}var ZC=QC("c.start();c._objFlags|="+VC,!1,VC),tN=QC("c.update(dt)",!0),iN=QC("c.lateUpdate(dt)",!0),nN=function(t){var i=O.director._compScheduler,n=t.array;for(t.i=0;t.i<n.length;++t.i){var r=n[t.i];r._enabled&&(r.onEnable(),!r.node._activeInHierarchy||i._onEnabled(r))}},rN=function(){function t(){this.ed=[],this.unscheduleAll()}var i=t.prototype;return i.unscheduleAll=function(){this.startInvoker=new KC(ZC),this.updateInvoker=new qC(tN),this.lateUpdateInvoker=new qC(iN),this.hd=!1},i._onEnabled=function(t){O.director.getScheduler().resumeTarget(t),t._objFlags|=$C,this.hd?this.ed.push(t):this.ud(t)},i._onDisabled=function(t){O.director.getScheduler().pauseTarget(t),t._objFlags&=-2049;var i=this.ed.indexOf(t);i>=0?HC(this.ed,i):(!t.internalStart||t._objFlags&VC||this.startInvoker.remove(t),t.internalUpdate&&this.updateInvoker.remove(t),t.internalLateUpdate&&this.lateUpdateInvoker.remove(t))},i.enableComp=function(t,i){if(!(t._objFlags&$C)){if(t.internalOnEnable){if(i)return void i.add(t);if(t.internalOnEnable(),!t.node.activeInHierarchy)return}this._onEnabled(t)}},i.disableComp=function(t){t._objFlags&$C&&(t.internalOnDisable&&t.internalOnDisable(),this._onDisabled(t))},i.startPhase=function(){this.hd=!0,this.startInvoker.invoke(),this.ad()},i.updatePhase=function(t){this.updateInvoker.invoke(t)},i.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this.hd=!1,this.ad()},i.ad=function(){this.ed.length>0&&(this.fd(),this.startInvoker.invoke())},i.ud=function(t){"function"!=typeof t.internalStart||t._objFlags&VC||this.startInvoker.add(t),"function"==typeof t.internalUpdate&&this.updateInvoker.add(t),"function"==typeof t.internalLateUpdate&&this.lateUpdateInvoker.add(t)},i.fd=function(){for(var t=this.ed,i=0,n=t.length;i<n;i++)this.ud(t[i]);t.length=0},t}(),sN=8192,eN=32768,hN=16384,uN=function(t){function i(i){return t.call(this,i)||this}e(i,t);var n=i.prototype;return n.add=function(t){this._zero.array.push(t)},n.remove=function(t){this._zero.fastRemove(t)},n.cancelInactive=function(t){XC.stableRemoveInactive(this._zero,t)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},i}(XC),oN=QC("c.__preload();"),cN=QC("c.onLoad();c._objFlags|="+hN,!1,hN),aN=new ri(4);function fN(t,i,n){ht(3817,t.name,n),z("Corrupted component value:",i),i?t._removeComponent(i):ei(t.oo(),n)}aN.get=function(){var t=this._get()||{preload:new uN(oN),onLoad:new KC(cN),onEnable:new KC(nN)};t.preload.zero.i=-1;var i=t.onLoad;return i.zero.i=-1,i.neg.i=-1,i.pos.i=-1,(i=t.onEnable).zero.i=-1,i.neg.i=-1,i.pos.i=-1,t};var vN=t("d1",function(){function t(){this.reset()}var i=t.prototype;return i.reset=function(){this._activatingStack=[]},i.activateNode=function(t,i){if(i){var n=aN.get();n&&(this._activatingStack.push(n),this._activateNodeRecursively(t,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),aN.put(n))}else{this._deactivateNodeRecursively(t);for(var r,s=w(this._activatingStack);!(r=s()).done;){var e=r.value;e.preload.cancelInactive(sN),e.onLoad.cancelInactive(eN),e.onEnable.cancelInactive(2048)}}t.emit("active-in-hierarchy-changed",t)},i.activateComp=function(t,i,n,r){if(qe(t,!0)&&(t._objFlags&sN||(t._objFlags|=sN,t.internalPreload&&(i?i.add(t):t.internalPreload())),t._objFlags&eN||(t._objFlags|=eN,t.internalOnLoad?n?n.add(t):(t.internalOnLoad(),t._objFlags|=hN):t._objFlags|=hN),t._enabled)){if(!t.node.activeInHierarchy)return;O.director._compScheduler.enableComp(t,r)}},i.destroyComp=function(t){O.director._compScheduler.disableComp(t),t.internalOnDestroy&&t._objFlags&hN&&t.internalOnDestroy()},i._activateNodeRecursively=function(t,i,n,r){if(256&t._objFlags)ht(3816,t.name);else{t.ro(!0);for(var s=t.components.length,e=0;e<s;++e){var h=t.components[e];h instanceof O.Component?this.activateComp(h,i,n,r):(fN(t,h,e),--e,--s)}for(var u=0,o=t.children.length;u<o;++u){var c=t.children[u];c.active&&this._activateNodeRecursively(c,i,n,r)}t._onPostActivated(!0)}},i._deactivateNodeRecursively=function(t){t._objFlags|=256,t.ro(!1);for(var i=t.components.length,n=0;n<i;++n){var r=t.components[n];if(r._enabled&&(O.director._compScheduler.disableComp(r),t.activeInHierarchy))return void(t._objFlags&=-257)}for(var s=0,e=t.children.length;s<e;++s){var h=t.children[s];if(h.activeInHierarchy&&(this._deactivateNodeRecursively(h),t.activeInHierarchy))return void(t._objFlags&=-257)}t._onPostActivated(!1),t._objFlags&=-257},t}()),lN=Tn.Attr.DELIMETER+"default",dN=Tn.IDENTIFIER_RE,wN="var ",gN="o",pN={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},_N=Tn.escapeForJS,yN=function(){function t(t,i){this.varName=t,this.expression=i}return t.prototype.toString=function(){return wN+this.varName+"="+this.expression+";"},t}();function mN(t,i){return i instanceof yN?new yN(i.varName,t+i.expression):t+i}function bN(t,i,n){Array.isArray(n)?(n[0]=mN(i,n[0]),t.push(n)):t.push(mN(i,n)+";")}var kN=function(){function t(t){this.vd=[],this.ld=t}var i=t.prototype;return i.setTargetExp=function(t){this.ld=t},i.append=function(t,i){this.vd.push([t,i])},i.writeCode=function(t){var i;if(this.vd.length>1)t.push("t="+this.ld+";"),i="t";else{if(1!==this.vd.length)return;i=this.ld}for(var n=0;n<this.vd.length;n++){var r=this.vd[n];bN(t,i+AN(r[0])+"=",r[1])}},t}();function AN(t){return dN.test(t)?"."+t:"["+_N(t)+"]"}kN.pool=new ri((function(t){t.vd.length=0,t.ld=null}),1),kN.pool.get=function(t){var i=this._get()||new kN;return i.setTargetExp(t),i};var EN,TN,ON,SN,IN,RN,MN=function(){function t(t,i){var n;this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.parent=i,this.funcModuleCache=It(),xt(this.funcModuleCache,pN),this.codeArray.push(wN+gN+",t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(n=wN+this.globalVariables.join(",")+";");var r=Pv(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",r)(this.objs,this.funcs);for(var s=0,e=this.objsToClear_iN$t.length;s<e;++s)this.objsToClear_iN$t[s]._iN$t=null;this.objsToClear_iN$t.length=0}var i=t.prototype;return i.getFuncModule=function(t,i){var n=Rt(t);if(n){var r=this.funcModuleCache[n];if(r)return r;if(void 0===r){var s=-1!==n.indexOf(".");if(s)try{if(s=t===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(t){}}}var e=this.funcs.indexOf(t);e<0&&(e=this.funcs.length,this.funcs.push(t));var h="F["+e+"]";return i&&(h="("+h+")"),this.funcModuleCache[n]=h,h},i.getObjRef=function(t){var i=this.objs.indexOf(t);return i<0&&(i=this.objs.length,this.objs.push(t)),"O["+i+"]"},i.setValueType=function(t,i,n,r){var s=kN.pool.get(r),e=i.constructor.__props__;e||(e=Object.keys(i));for(var h=0;h<e.length;h++){var u=e[h],o=n[u];if(i[u]!==o){var c=this.enumerateField(n,u,o);s.append(u,c)}}s.writeCode(t),kN.pool.put(s)},i.enumerateCCClass=function(t,i,n){for(var r=n.__values__,s=Tn.Attr.getClassAttrs(n),e=0;e<r.length;e++){var h=r[e],u=i[h],o=s[h+lN];if(!CN(o,u))if("object"==typeof u&&u instanceof T.ValueType&&(o=Tn.getDefault(o))&&o.constructor===u.constructor){var c=gN+AN(h);this.setValueType(t,o,u,c)}else this.setObjProp(t,i,h,u)}},i.instantiateArray=function(t){if(0===t.length)return"[]";var i="a"+ ++this.localVariableId,n=[new yN(i,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)bN(n,i+"["+r+"]=",this.enumerateField(t,r,t[r]));return n},i.instantiateTypedArray=function(t){var i=t.constructor.name;if(0===t.length)return"new "+i;var n="a"+ ++this.localVariableId,r=[new yN(n,"new "+i+"("+t.length+")")];t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t);for(var s=0;s<t.length;++s)0!==t[s]&&bN(r,n+"["+s+"]=",t[s]);return r},i.enumerateField=function(t,i,n){if("object"==typeof n&&n){var r=n._iN$t;if(r){var s=r.globalVar;if(!s){s=r.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(s);var e=r.source[0];r.source[0]=mN(s+"=",e)}return s}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?_N(n):("_objFlags"===i&&Ke(t)&&(n&=-4192741),n)},i.setObjProp=function(t,i,n,r){bN(t,gN+AN(n)+"=",this.enumerateField(i,n,r))},i.enumerateObject=function(t,i){var n=i.constructor;if(On(n))this.enumerateCCClass(t,i,n);else for(var r in i)if(Object.prototype.hasOwnProperty.call(i,r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var s=i[r];"object"==typeof s&&s&&s===i._iN$t||this.setObjProp(t,i,r,s)}},i.instantiateObj=function(t){if(t instanceof T.ValueType)return Tn.getNewValueTypeCode(t);if(t instanceof T.Asset)return this.getObjRef(t);if(1&t._objFlags)return null;var i,n=t.constructor;if(On(n)){if(this.parent)if(this.parent instanceof T.Component){if(t instanceof T.Node||t instanceof T.Component)return this.getObjRef(t)}else if(this.parent instanceof T.Node)if(t instanceof T.Node){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof T.Component){var r;if(null==(r=t.node)||!r.isChildOf(this.parent))return this.getObjRef(t)}i=new yN(gN,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)i=new yN(gN,"{}");else{if(n)return this.getObjRef(t);i=new yN(gN,"Object.create(null)")}var s=[i];return t._iN$t={globalVar:"",source:s},this.objsToClear_iN$t.push(t),this.enumerateObject(s,t),["(function(){",s,"return o;})();"]},t}();function CN(t,i){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===i)return!0;if(t&&i&&"object"==typeof t&&"object"==typeof i&&t.constructor===i.constructor)if(t instanceof T.ValueType){if(t.equals(i))return!0}else{if(Array.isArray(t))return 0===t.length&&0===i.length;if(t.constructor===Object)return kt(t)&&kt(i)}return!1}var NN=_i({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),PN=t("d2",_o("cc.Prefab")((RN=function(t){function i(){var i;return(i=t.call(this)||this).data=ON&&ON(),i.optimizationPolicy=SN&&SN(),i.persistent=IN&&IN(),i.dd=null,i.wd=0,i}e(i,t);var n=i.prototype;return n.createNode=function(t){var i=O.instantiate(this);i.name=this.name,t(null,i)},n.compileCreateFunction=function(){var t,i;this.dd=(i=(t=this.data)instanceof T.Node&&t,new MN(t,i).result)},n._doInstantiate=function(t){return this.data._prefab||st(3700),this.dd||this.compileCreateFunction(),this.dd(t)},n._instantiate=function(){var t;return this.optimizationPolicy!==NN.SINGLE_INSTANCE&&(this.optimizationPolicy===NN.MULTI_INSTANCE||this.wd+1>=i.OptimizationPolicyThreshold)?(t=this._doInstantiate(),this.data._instantiate(t)):t=this.data._instantiate(),++this.wd,t},n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.data=new WE,this.data.name="(Missing Node)";var n=new O._PrefabInfo;n.asset=this,n.root=this.data,this.data._prefab=n},n.validate=function(){return!!this.data},n.onLoaded=function(){var t=this.data;lR(t),fR(t)},i}(rg),RN.OptimizationPolicy=NN,RN.OptimizationPolicyThreshold=3,ON=uo((TN=RN).prototype,"data",[Co],(function(){return null})),SN=uo(TN.prototype,"optimizationPolicy",[Co],(function(){return NN.AUTO})),IN=uo(TN.prototype,"persistent",[Co],(function(){return!1})),EN=TN))||EN);Et(PN,"_utils",bR),O.Prefab=PN,Mt(O,"cc._Prefab","Prefab");var LN=function(){function t(){this.gd=[],this.pd=[],this._d=0}var i=t.prototype;return i.yd=function(t){-1===t._internalId&&(t._internalId=this.gd.length,this.gd.push(t))},i.md=function(t){if(-1!==t._internalId){var i=t._internalId;this.gd[this.gd.length-1]._internalId=i,hi(this.gd,i),t._internalId=-1,t._dirtyVersion===this._d&&(oi(this.pd,t),t._dirtyVersion=-1)}},i.bd=function(t){t._dirtyVersion!==this._d&&-1!==t._internalId&&(this.pd.push(t),t._dirtyVersion=this._d)},i.kd=function(){for(var t=this.pd,i=0;i<this.pd.length;i++)t[i].updateRenderer();this.pd.length=0,this._d++},t}(),DN=new LN,BN=t("dp",{INIT:"director_init",RESET:"director_reset",BEFORE_SCENE_LOADING:"director_before_scene_loading",BEFORE_SCENE_LAUNCH:"director_before_scene_launch",AFTER_SCENE_LAUNCH:"director_after_scene_launch",BEFORE_UPDATE:"director_before_update",AFTER_UPDATE:"director_after_update",BEFORE_DRAW:"director_before_draw",AFTER_DRAW:"director_after_draw",BEFORE_COMMIT:"director_before_commit",BEFORE_RENDER:"director_before_render",AFTER_RENDER:"director_after_render",BEFORE_PHYSICS:"director_before_physics",AFTER_PHYSICS:"director_after_physics",BEGIN_FRAME:"director_begin_frame",END_FRAME:"director_end_frame"}),FN=t("dq",function(t){function i(){var i;return(i=t.call(this)||this)._compScheduler=new rN,i._nodeActivator=new vN,i.Ad=!1,i.Ed=!1,i.yl=null,i.Td="",i.rf=null,i.Od=0,i.Ai=new Ev,i.Sd=[],i.Id={},i}e(i,t);var n=i.prototype;return n.end=function(){var t=this;this.once("director_end_frame",(function(){t.purgeDirector()}))},n.pause=function(){this.Ed=!0},n.purgeDirector=function(){this.Ai.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),qe(this.rf)&&this.rf.destroy(),this.rf=null,this.stopAnimation(),Pk.releaseAll()},n.reset=function(){for(var t in this.purgeDirector(),this.Id)this.removePersistRootNode(this.Id[t]);var i=this.getScene();i&&i.destroy(),this.emit("director_reset"),this.startAnimation()},n.runSceneImmediate=function(t,i,n){var r=this;t instanceof AR&&(t=t.scene),ot(t instanceof kR,1216),t.mo();for(var s=Object.keys(this.Id).map((function(t){return r.Id[t]})),e=0;e<s.length;e++){var h=s[e];h.emit("scene-changed-for-persists",t.renderScene);var u=t.uuid===h._originalSceneId&&t.getChildByUuid(h.uuid);if(u){var o=u.siblingIndex;h.hideFlags&=-9,h.hideFlags|=8&u.hideFlags,u._destroyImmediate(),t.insertChild(h,o)}else h.hideFlags|=8,h.parent=t}var c=this.rf;qe(c)&&c.destroy(),vb._autoRelease(c,t,this.Id),this.rf=null,We._deferredDestroy(),i&&i(),this.emit("director_before_scene_launch",t),this.rf=t,t.ko(),this.yl&&this.yl.resetCumulativeTime(),this.startAnimation(),n&&n(null,t),this.emit("director_after_scene_launch",t)},n.runScene=function(t,i,n){var r=this;t instanceof AR&&(t=t.scene),ot(Boolean(t),1205),ot(t instanceof kR,1216),this.once("director_end_frame",(function(){r.runSceneImmediate(t,i,n)}))},n.loadScene=function(t,i,n){var r=this;if(this.Td)return st(1208,t,this.Td),!1;var s=Pk.bundles.find((function(i){return!!i.getSceneInfo(t)}));return s?(this.emit("director_before_scene_loading",t),this.Td=t,console.time("LoadScene "+t),s.loadScene(t,(function(s,e){console.timeEnd("LoadScene "+t),r.Td="",s?(X(s),i&&i(s)):r.runSceneImmediate(e,n,i)})),!0):(ht(1209,t),!1)},n.preloadScene=function(t,i,n){var r=Pk.bundles.find((function(i){return!!i.getSceneInfo(t)}));if(r)r.preloadScene(t,null,i,n);else{var s='Can not preload the scene "'+t+'" because it is not in the build settings.';n&&n(new Error(s)),X("preloadScene: "+s)}},n.resume=function(){this.Ed=!1},n.getScene=function(){return this.rf},n.getDeltaTime=function(){return T.game.deltaTime},n.getTotalTime=function(){return T.game.totalTime},n.getCurrentTime=function(){return T.game.frameStartTime},n.getTotalFrames=function(){return this.Od},n.isPaused=function(){return this.Ed},n.getScheduler=function(){return this.Ai},n.setScheduler=function(t){this.Ai!==t&&(this.unregisterSystem(this.Ai),this.Ai=t,this.registerSystem(Ev.ID,t,200))},n.registerSystem=function(t,i,n){i.id=t,i.priority=n,this.Sd.push(i),this.Sd.sort(_v.sortByPriority)},n.unregisterSystem=function(t){oi(this.Sd,t),this.Sd.sort(_v.sortByPriority)},n.getSystem=function(t){return this.Sd.find((function(i){return i.id===t}))},n.getAnimationManager=function(){return this.getSystem(T.AnimationManager.ID)},n.startAnimation=function(){this.Ad=!1},n.stopAnimation=function(){this.Ad=!0},n.mainLoop=function(){var t;t=T.game._calculateDT(!1),this.tick(t)},n.tick=function(t){if(!this.Ad){if(this.emit("director_begin_frame"),PM._frameDispatchEvents(),!this.Ed){this.emit("director_before_update"),this._compScheduler.startPhase(),this._compScheduler.updatePhase(t);for(var i=0;i<this.Sd.length;++i)this.Sd[i].update(t);this._compScheduler.lateUpdatePhase(t),this.emit("director_after_update"),We._deferredDestroy();for(var n=0;n<this.Sd.length;++n)this.Sd[n].postUpdate(t)}this.emit("director_before_draw"),DN.kd(),this.yl.frameMove(t),this.emit("director_after_draw"),WE.resetHasChangedFlags(),WE.clearNodeArray(),Ue.update(t),this.emit("director_end_frame"),this.Od++}},n.buildRenderPipeline=function(){if(this.yl){var t=this.yl.customPipeline,i=this.yl.cameraList;t.beginSetup();var n=T.rendering.getCustomPipeline(Si.CUSTOM_PIPELINE_NAME);T.rendering.dispatchResizeEvents(i,n,t),n.setup(i,t),t.endSetup()}},n.Rd=function(){""!==Si.CUSTOM_PIPELINE_NAME&&T.rendering&&this.yl&&this.yl.usesCustomPipeline&&this.on("director_before_scene_launch",T.rendering.forceResizeAllWindows,T.rendering)},n.init=function(){this.Od=0,this.Ed=!1,this.registerSystem(Ev.ID,this.Ai,200),this.yl=new GC(kw.gfxDevice),this.yl.initialize({}),this.Rd();for(var t=0;t<this.Sd.length;t++)this.Sd[t].init();this.emit("director_init")},n.addPersistRootNode=function(t){if(WE.isNode(t)&&t.uuid){var i=t.uuid;if(!this.Id[i]){var n=this.rf;if(qe(n))if(t.parent){if(!(t.parent instanceof kR))return void st(3801);if(t.parent!==n)return void st(3802);t._originalSceneId=n.uuid}else t.parent=n,t._originalSceneId=n.uuid;this.Id[i]=t,t._persistNode=!0,vb._addPersistNodeRef(t)}}else st(3800)},n.removePersistRootNode=function(t){var i=t.uuid||"";t===this.Id[i]&&(delete this.Id[i],t._persistNode=!1,t._originalSceneId="",vb._removePersistNodeRef(t))},n.isPersistRootNode=function(t){return!!t._persistNode},r(i,[{key:"root",get:function(){return this.yl}}]),i}(eh));FN.EVENT_INIT="director_init",FN.EVENT_RESET="director_reset",FN.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",FN.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",FN.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",FN.EVENT_BEFORE_UPDATE="director_before_update",FN.EVENT_AFTER_UPDATE="director_after_update",FN.EVENT_BEFORE_DRAW="director_before_draw",FN.EVENT_AFTER_DRAW="director_after_draw",FN.EVENT_BEFORE_COMMIT="director_before_commit",FN.EVENT_BEFORE_RENDER="director_before_render",FN.EVENT_AFTER_RENDER="director_after_render",FN.EVENT_BEFORE_PHYSICS="director_before_physics",FN.EVENT_AFTER_PHYSICS="director_after_physics",FN.EVENT_BEGIN_FRAME="director_begin_frame",FN.EVENT_END_FRAME="director_end_frame",FN.instance=void 0,T.Director=FN,T.DirectorEvent=BN;var UN,xN=t("dr",FN.instance=T.director=new FN),GN=ne(),jN=((UN={})[Si.ORIENTATION_AUTO]=Ti.AUTO,UN[Si.ORIENTATION_LANDSCAPE]=Ti.LANDSCAPE,UN[Si.ORIENTATION_PORTRAIT]=Ti.PORTRAIT,UN),HN=t("eQ",function(t){function i(){var i;(i=t.call(this)||this)._designResolutionSize=ne(0,0),i.Md=1,i.Cd=1,i.Nd=he(),i.Pd=he(),i.Ld=!1,i.Dd=!1,i.Bd=null;var n=VN,r=$N;return i.Fd=new JN(n.EQUAL_TO_FRAME,r.EXACT_FIT),i.Ud=new JN(n.EQUAL_TO_FRAME,r.SHOW_ALL),i.xd=new JN(n.EQUAL_TO_FRAME,r.NO_BORDER),i.Gd=new JN(n.EQUAL_TO_FRAME,r.FIXED_HEIGHT),i.jd=new JN(n.EQUAL_TO_FRAME,r.FIXED_WIDTH),i.Hd=i.Ud,i}e(i,t);var n=i.prototype;return n.init=function(){var t=mh.windowSize,i=t.width,n=t.height;this._designResolutionSize.width=i,this._designResolutionSize.height=n,this.Nd.width=i,this.Nd.height=n,this.Pd.width=i,this.Pd.height=n,GN.width=this.Pd.width,GN.height=this.Pd.height,kh.init(this.Pd),this.resizeWithBrowserSize(!0);var r=Oi.querySettings("screen","designResolution");r&&this.setDesignResolutionSize(Number(r.width),Number(r.height),r.policy||JN.FIXED_HEIGHT),mh.on("window-resize",this.Vd,this),mh.on("fullscreen-change",this.Vd,this)},n.resizeWithBrowserSize=function(t){_h.handleResizeEvent=t},n.setResizeCallback=function(t){"function"!=typeof t&&null!=t||(this.Bd=t)},n.setOrientation=function(t){_h.orientation=jN[t]},n.adjustViewportMeta=function(){},n.enableRetina=function(t){this.Dd=!!t},n.isRetinaEnabled=function(){return this.Dd},n.enableAutoFullScreen=function(t){t!==this.Ld&&(this.Ld=t,t&&mh.requestFullScreen().catch((function(){})))},n.isAutoFullScreenEnabled=function(){return this.Ld},n.setCanvasSize=function(t,i){_h.resolutionScale=1;var n=_h.devicePixelRatio,r=new ie(t*n,i*n);mh.windowSize=r},n.getCanvasSize=function(){return mh.windowSize},n.getFrameSize=function(){var t=_h.devicePixelRatio,i=mh.windowSize;return i.width/=t,i.height/=t,i},n.setFrameSize=function(t,i){var n=_h.devicePixelRatio;mh.windowSize=new ie(t*n,i*n)},n.getVisibleSize=function(){return new ie(this.Pd.width,this.Pd.height)},n.getVisibleSizeInPixel=function(){return new ie(this.Pd.width*this.Md,this.Pd.height*this.Cd)},n.getVisibleOrigin=function(){return new Ms(this.Pd.x,this.Pd.y)},n.getVisibleOriginInPixel=function(){return new Ms(this.Pd.x*this.Md,this.Pd.y*this.Cd)},n.getResolutionPolicy=function(){return this.Hd},n.$d=function(t){if(t instanceof JN)this.Hd=t;else{var i=JN;t===i.EXACT_FIT&&(this.Hd=this.Fd),t===i.SHOW_ALL&&(this.Hd=this.Ud),t===i.NO_BORDER&&(this.Hd=this.xd),t===i.FIXED_HEIGHT&&(this.Hd=this.Gd),t===i.FIXED_WIDTH&&(this.Hd=this.jd)}},n.setResolutionPolicy=function(t){this.$d(t);var i=ZN.getDesignResolutionSize();ZN.setDesignResolutionSize(i.width,i.height,t)},n.setDesignResolutionSize=function(t,i,n){if(t>0&&i>0){this.$d(n);var r=this.Hd;r&&r.preApply(this),this._designResolutionSize.width=t,this._designResolutionSize.height=i;var s=r.apply(this,this._designResolutionSize);if(s.scale&&2===s.scale.length&&(this.Md=s.scale[0],this.Cd=s.scale[1]),s.viewport){var e=this.Nd,h=this.Pd,u=s.viewport;e.x=u.x,e.y=u.y,e.width=u.width,e.height=u.height,h.x=0,h.y=0,h.width=u.width/this.Md,h.height=u.height/this.Cd}r.postApply(this),GN.width=this.Pd.width,GN.height=this.Pd.height,kh.init(this.Pd),this.emit("design-resolution-changed")}else ht(2200)},n.getDesignResolutionSize=function(){return new ie(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(t,i,n){document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(t,i,n)},n.getViewportRect=function(){return this.Nd},n.getScaleX=function(){return this.Md},n.getScaleY=function(){return this.Cd},n.getDevicePixelRatio=function(){return _h.devicePixelRatio},n.convertToLocationInView=function(t,i,n,r){void 0===r&&(r=new Ms);var s=_h.devicePixelRatio*(t-n.left),e=_h.devicePixelRatio*(n.top+n.height-i);return _h.isFrameRotated?(r.x=mh.windowSize.width-e,r.y=s):(r.x=s,r.y=e),r},n.zt=function(t){var i=this.Nd;t.x=(t.x-i.x)/this.Md,t.y=(t.y-i.y)/this.Cd},n.Vd=function(t,i,n){T.director.root.resize(t,i,void 0===n||0===n?1:n);var r=this._designResolutionSize,s=r.width,e=r.height;t>0&&i>0?this.setDesignResolutionSize(s,e,this.Hd):Y(!1,"_updateAdaptResult Invalid size."),this.emit("canvas-resize"),this.Bd&&this.Bd()},i}(sh(_v)));HN.instance=void 0;var VN=function(){function t(){this.name="ContainerStrategy"}var i=t.prototype;return i.preApply=function(){},i.apply=function(){},i.postApply=function(){},i._setupCanvas=function(){var t=T.game.canvas;if(t){var i=mh.windowSize;t.width!==i.width&&(t.width=i.width),t.height!==i.height&&(t.height=i.height)}},t}();VN.EQUAL_TO_FRAME=void 0,VN.PROPORTION_TO_FRAME=void 0;var $N=function(){function t(){this.name="ContentStrategy",this.zd={scale:[1,1],viewport:null},this._strategy=JN.UNKNOWN}var i=t.prototype;return i.preApply=function(){},i.apply=function(){return{scale:[1,1]}},i.postApply=function(){},i._buildResult=function(t,i,n,r,s,e){Math.abs(t-n)<2&&(n=t),Math.abs(i-r)<2&&(r=i);var h=new ee(Math.round((t-n)/2),Math.round((i-r)/2),n,r),u=this.zd;return u.scale=[s,e],u.viewport=h,u},r(t,[{key:"strategy",get:function(){return this._strategy}}]),t}(),zN=function(t){function i(){var i;return(i=t.call(this)||this).name="EqualToFrame",i}return e(i,t),i.prototype.apply=function(){_h.isProportionalToFrame=!1,this._setupCanvas()},i}(VN),WN=function(t){function i(){var i;return(i=t.call(this)||this).name="ProportionalToFrame",i}return e(i,t),i.prototype.apply=function(){_h.isProportionalToFrame=!0,this._setupCanvas()},i}(VN);VN.EQUAL_TO_FRAME=new zN,VN.PROPORTION_TO_FRAME=new WN;var XN=function(t){function i(){var i;return(i=t.call(this)||this).name="ExactFit",i._strategy=JN.EXACT_FIT,i}return e(i,t),i.prototype.apply=function(t,i){var n=mh.windowSize,r=n.width,s=n.height,e=r/i.width,h=s/i.height;return this._buildResult(r,s,r,s,e,h)},i}($N),YN=function(t){function i(){var i;return(i=t.call(this)||this).name="ShowAll",i._strategy=JN.SHOW_ALL,i}return e(i,t),i.prototype.apply=function(t,i){var n,r,s=mh.windowSize,e=s.width,h=s.height,u=i.width,o=i.height,c=e/u,a=h/o,f=0;return c<a?(n=e,r=o*(f=c)):(n=u*(f=a),r=h),this._buildResult(e,h,n,r,f,f)},i}($N),KN=function(t){function i(){var i;return(i=t.call(this)||this).name="NoBorder",i._strategy=JN.NO_BORDER,i}return e(i,t),i.prototype.apply=function(t,i){var n,r,s,e=mh.windowSize,h=e.width,u=e.height,o=i.width,c=i.height,a=h/o,f=u/c;return a<f?(r=o*(n=f),s=u):(r=h,s=c*(n=a)),this._buildResult(h,u,r,s,n,n)},i}($N),qN=function(t){function i(){var i;return(i=t.call(this)||this).name="FixedHeight",i._strategy=JN.FIXED_HEIGHT,i}return e(i,t),i.prototype.apply=function(t,i){var n=mh.windowSize,r=n.width,s=n.height,e=s/i.height,h=r,u=s;return this._buildResult(r,s,h,u,e,e)},i}($N),QN=function(t){function i(){var i;return(i=t.call(this)||this).name="FixedWidth",i._strategy=JN.FIXED_WIDTH,i}return e(i,t),i.prototype.apply=function(t,i){var n=mh.windowSize,r=n.width,s=n.height,e=r/i.width,h=r,u=s;return this._buildResult(r,s,h,u,e,e)},i}($N),JN=t("eR",function(){function t(t,i){this.name="ResolutionPolicy",this._containerStrategy=t,this.Wd=i}var i=t.prototype;return i.preApply=function(t){this.Wd.preApply(t)},i.apply=function(t,i){return this._containerStrategy.apply(t,i),this.Wd.apply(t,i)},i.postApply=function(t){this.Wd.postApply(t)},i.setContainerStrategy=function(t){this._containerStrategy=t},i.setContentStrategy=function(t){this.Wd=t},i.getContentStrategy=function(){return this.Wd},r(t,[{key:"canvasSize",get:function(){return mh.windowSize}}]),t}());JN.EXACT_FIT=0,JN.NO_BORDER=1,JN.SHOW_ALL=2,JN.FIXED_HEIGHT=3,JN.FIXED_WIDTH=4,JN.UNKNOWN=5,JN.ContainerStrategy=VN,JN.ContentStrategy=$N,T.ResolutionPolicy=JN,$N.EXACT_FIT=new XN,$N.SHOW_ALL=new YN,$N.NO_BORDER=new KN,$N.FIXED_HEIGHT=new qN,$N.FIXED_WIDTH=new QN;var ZN=t("eS",HN.instance=T.view=new HN);xN.registerSystem("view",ZN,0),T.winSize=GN;var tP=new Ms;function iP(t,i,n,r){t.setProperty(i,n,r)}var nP=function(){var t=i.prototype;function i(){this.Xd=void 0,this.Yd=0,this.Kd=void 0,this.qd=void 0,this.Qd=void 0,this.Jd=void 0,this.Zd=void 0,this.tw=void 0,this.iw=void 0,this.nw=void 0,this.rw=void 0,this.sw=void 0,this.hw=void 0,this.uw=!1,this.ow=void 0,this.cw=void 0,this.aw=void 0,this.fw=void 0,this.lw=void 0,this.ww=void 0,this.gw=void 0,this.pw=void 0,this._w=1920,this.yw=1080,this.mw=140,this.bw=200,this.kw=0,this.Aw=0,this.Ew=.5,this.Tw=1/6+2.5/6,this.Ow=24,this.Sw=24,this.Iw=.5,this.Rw=32,this.Mw=4,this.Cw=1}return t.init=function(){var t,i,n,r,s,e,h,u=this,o=JN.SHOW_ALL,c=Oi.querySettings("screen","designResolution");if(null!==c&&(o=c.policy),this.Xd={Nw:null!==(t=o)&&void 0!==t?t:JN.SHOW_ALL,Pw:null!==(i=Oi.querySettings("splashScreen","displayRatio"))&&void 0!==i?i:.4,Lw:null!==(n=Oi.querySettings("splashScreen","totalTime"))&&void 0!==n?n:3e3,Dw:null!==(r=Oi.querySettings("splashScreen","watermarkLocation"))&&void 0!==r?r:"default",Bw:null===(s=Oi.querySettings("splashScreen","autoFit"))||void 0===s||s,Fw:null!==(e=Oi.querySettings("splashScreen","logo"))&&void 0!==e?e:void 0,Uw:null!==(h=Oi.querySettings("splashScreen","background"))&&void 0!==h?h:void 0},this.Yd=0,!(this.Xd.Lw<=0||void 0===this.Xd.Fw||void 0===this.Xd.Uw)){this.Kd=T.director.root.device,this.qd=T.director.root.mainWindow.swapchain,this.xw(),this.Gw(),"default"===this.Xd.Fw.type&&this.jw();var a=Promise.resolve(),f=Promise.resolve();return"custom"===this.Xd.Uw.type&&(a=new Promise((function(t,i){u.cw=new I.Image,u.cw.onload=function(){u.Hw(),t()},u.cw.onerror=function(){i()},u.cw.src=u.Xd.Uw.base64}))),"none"!==this.Xd.Fw.type&&(f=new Promise((function(t,i){u.lw=new I.Image,u.lw.onload=function(){u.Vw(),t()},u.lw.onerror=function(){i()},u.lw.src=u.Xd.Fw.base64}))),Promise.all([a,f])}return this.Xd.Lw=0,Promise.resolve([])},t.xw=function(){var t,i=null==(t=this.Xd.Uw)?void 0:t.color;this.sw=i?[new xl(i.x,i.y,i.z,i.w)]:[new xl(0,0,0,1)];var n=this.Kd,r=this.qd,s=n.capabilities;this.rw=new Cl(0,0,r.width,r.height),this.Zd=n.commandBuffer;var e=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]);this.iw=n.createBuffer(new $l(10,1,64,16)),this.iw.update(e);var h=new Uint16Array([0,1,2,1,3,2]);this.nw=n.createBuffer(new $l(6,1,12,2)),this.nw.update(h);var u=[new ud("a_position",21),new ud("a_texCoord",21)],o=new cd(u,[this.iw],this.nw);this.tw=n.createInputAssembler(o),this.hw=new ls,ls.ortho(this.hw,-1,1,-1,1,-1,1,s.clipSpaceMinZ,s.clipSpaceSignY,r.surfaceTransform),this.uw=bh.isMobile},t.Gw=function(){this.uw?(this._w=812,this.yw=375,this.mw=70,this.bw=100,this.Ow=12,this.Sw=this.Ow+this.Mw,this.Iw=.5,this.Rw=16):(this._w=1920,this.yw=1080,this.mw=140,this.bw=200,this.Ow=24,this.Sw=this.Ow+this.Mw,this.Iw=.5,this.Rw=32),this.Ew=.5,this.Tw=1/6+2.5/6,this.$w()},t.$w=function(){var t=this.qd.width,i=this.qd.height,n=this.uw?375:1080,r=this.uw?812:1920;if(t>i){var s=r;r=n,n=s}this.Cw=t/i>16/9?i/r:t/n},t.update=function(t){var i=this.Xd,n=this.Kd,r=this.qd,s=n.capabilities;ls.ortho(this.hw,-1,1,-1,1,-1,1,s.clipSpaceMinZ,s.clipSpaceSignY,r.surfaceTransform);var e=r.width,h=r.height;this.$w(),this.Yd+=1e3*t;var u=Tc(jn(this.Yd/i.Lw)),o=1,c=1,a=this.cw;if("custom"===i.Uw.type){i.Nw===JN.FIXED_WIDTH?(o=e,c=e/a.width*a.height):i.Nw===JN.FIXED_HEIGHT?(o=h/a.height*a.width,c=h):i.Nw===JN.SHOW_ALL?a.width/this.yw>e/h?(o=e,c=e/a.width*a.height):(o=h/a.height*a.width,c=h):i.Nw===JN.NO_BORDER?a.width/a.height>e/h?(o=h/a.height*a.width,c=h):(o=e,c=e/a.width*a.height):(o=e,c=h);var f=this.ow;iP(f,"resolution",tP.set(e,h),0),iP(f,"scale",tP.set(o,c),0),iP(f,"translate",tP.set(.5*e,.5*h),0),iP(f,"percent",1),iP(f,"u_projection",this.hw),f.passes[0].update()}var v=h*this.Tw;if("none"!==this.Xd.Fw.type){c=.185*h*i.Pw,o=this.kw*(.185*h/this.Aw)*i.Pw;var l=this.fw;iP(l,"resolution",tP.set(e,h),0),iP(l,"scale",tP.set(o,c),0),iP(l,"translate",tP.set(e*this.Ew,v),0),iP(l,"percent",u),iP(l,"u_projection",this.hw),l.passes[0].update()}if("default"===this.Xd.Fw.type&&this.gw){var d=this.pw.width,w=this.pw.height;o=d,c=w;var g=v-(.5*this.Aw*i.Pw+this.Rw)*this.Cw-.5*w,p=this.gw;iP(p,"resolution",tP.set(e,h),0),iP(p,"scale",tP.set(o,c),0),iP(p,"translate",tP.set(e*this.Iw,g),0),iP(p,"percent",u),iP(p,"u_projection",this.hw),p.passes[0].update()}this.zw()},t.Hw=function(){var t=this.Kd;this.ow=new hA,this.ow.initialize({effectName:"util/splash-screen"});var i=new Ql;i.addressU=2,i.addressV=2,i.addressW=2,this.Jd=t.getSampler(i),this.aw=t.createTexture(new Kl(1,6,35,this.cw.width,this.cw.height));var n=this.ow.passes[0],r=n.getBinding("mainTexture");n.bindTexture(r,this.aw),this.Qd=n.getShaderVariant();var s=n.descriptorSet;s.bindSampler(r,this.Jd),s.update();var e=new Fl,h=e.texExtent;h.width=this.cw.width,h.height=this.cw.height,h.depth=1,t.copyTexImagesToTexture([this.cw],this.aw,[e])},t.Vw=function(){var t=this.Kd;this.fw=new hA,this.fw.initialize({effectName:"util/splash-screen"});var i=new Ql;i.addressU=2,i.addressV=2,i.addressW=2,this.Jd=t.getSampler(i),this.ww=t.createTexture(new Kl(1,6,35,this.lw.width,this.lw.height));var n=this.fw.passes[0],r=n.getBinding("mainTexture");n.bindTexture(r,this.ww),this.Qd=n.getShaderVariant();var s=n.descriptorSet;s.bindSampler(r,this.Jd),s.update();var e=new Fl,h=e.texExtent;h.width=this.lw.width,h.height=this.lw.height,h.depth=1,t.copyTexImagesToTexture([this.lw],this.ww,[e]);var u=this.lw.width/this.lw.height;u<1?(this.kw=this.mw,this.Aw=this.mw/u):(this.kw=this.bw*u,this.Aw=this.bw)},t.jw=function(){var t=I.document.createElement("canvas");t.height=this.Sw*this.Cw,t.style.width=""+t.width,t.style.height=""+t.height;var i="Created with Cocos",n=t.getContext("2d");n.font=this.Ow*this.Cw+"px Arial",n.textBaseline="top",n.textAlign="center",n.fillStyle="#707070";var r=n.measureText(i).width+10;t.width=r,n.font=this.Ow*this.Cw+"px Arial",n.textBaseline="top",n.textAlign="center",n.fillStyle="#707070",n.fillText(i,t.width/2,0);var s=new Fl,e=s.texExtent;e.width=t.width,e.height=t.height,e.depth=1,this.pw=this.Kd.createTexture(new Kl(1,6,35,t.width,t.height)),this.Kd.copyTexImagesToTexture([t],this.pw,[s]),this.gw=new hA,this.gw.initialize({effectName:"util/splash-screen"});var h=this.gw.passes[0],u=h.getBinding("mainTexture");h.bindTexture(u,this.pw),h.descriptorSet.update()},t.zw=function(){var t=this.Kd,i=this.qd;this.hw;var n=this.ow,r=this.fw,s=this.gw,e=this.Xd,h=this.tw;if(t.capabilities,!bh.isXR||xr.entry.isRenderAllowable())for(var u=bh.isXR?2:1,o=0;o<u;o++){t.enableAutoBarrier(!0),t.acquire([i]);var c=this.Zd,a=T.director.root.mainWindow.framebuffer,f=this.rw;if(f.width=i.width,f.height=i.height,c.begin(),c.beginRenderPass(a.renderPass,a,f,this.sw,1,0),T.director.root.pipeline,"custom"===e.Uw.type){var v=n.passes[0],l=nA.getOrCreatePipelineState(t,v,this.Qd,a.renderPass,h);c.bindPipelineState(l),c.bindDescriptorSet(1,v.descriptorSet),c.bindInputAssembler(h),c.draw(h)}if("none"!==e.Fw.type){var d=r.passes[0],w=nA.getOrCreatePipelineState(t,d,this.Qd,a.renderPass,h);c.bindPipelineState(w),c.bindDescriptorSet(1,d.descriptorSet),c.bindInputAssembler(h),c.draw(h)}if("default"===e.Fw.type&&s){var g=this.gw.passes[0],p=nA.getOrCreatePipelineState(t,g,this.Qd,a.renderPass,h);c.bindPipelineState(p),c.bindDescriptorSet(1,g.descriptorSet),c.bindInputAssembler(h),c.draw(h)}c.endRenderPass(),c.end(),t.flushCommands([c]),t.queue.submit([c]),t.present(),t.enableAutoBarrier(!O.rendering)}},t.Ww=function(){this.Kd=null,this.qd=null,this.sw=null,this.cw&&(this.cw.destroy&&this.cw.destroy(),this.cw=null),this.ow&&(this.ow.destroy(),this.ow=null),this.aw&&(this.aw.destroy(),this.aw=null),this.lw&&(this.lw.destroy&&this.lw.destroy(),this.lw=null),this.fw&&(this.fw.destroy(),this.fw=null),this.ww&&(this.ww.destroy(),this.ww=null),this.rw=null,this.Zd=null,this.Qd=null,this.tw&&(this.tw.destroy(),this.tw=null),this.iw&&(this.iw.destroy(),this.iw=null),this.nw&&(this.nw.destroy(),this.nw=null),this.Jd=null,this.gw&&(this.gw.destroy(),this.gw=null),this.pw&&(this.pw.destroy(),this.pw=null),this.Xd=null},i.createInstance=function(){return i.Xw=new i,i.Xw},i.releaseInstance=function(){i.Xw&&(i.Xw.Ww(),i.Xw=null)},r(i,[{key:"isFinished",get:function(){return this.Yd>=this.Xd.Lw}},{key:"curTime",get:function(){return this.Yd},set:function(t){this.Yd=t}}],[{key:"instance",get:function(){return i.Xw}}]),i}();nP.Xw=null,T.internal.SplashScreen=nP;var rP=function(){function t(){var t=this;this.Yw=0,this.Kw=null,this.qw=60,this.ql=0,this.Qw=0,this.Jw=!1,this.zl=0,this.Ni=null,this.Zw=void 0,this.tg=void 0,this._handleRAF=function(){var i=performance.now(),n=i-t.Qw,r=Math.floor(n/t.ql);r<0&&(t.Qw=i,t.zl=0),r<t.zl?t.Yw=t.Zw.call(window,t._handleRAF):(t.zl=r+1,t.Ni&&t.Ni())},this.ql=1e3/this.qw,this.Zw=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,this.tg=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame}var i=t.prototype;return i.start=function(){var t=this;if(!this.Jw){var i=void 0===this.Zw||A;this.Qw=performance.now(),this.Yw=this.ig((function n(){i&&(t.Qw=performance.now()),t.Jw&&(t.Yw=t.ig(n)),t.Kw&&t.Kw()})),this.Jw=!0,this.zl=0}},i.stop=function(){this.Jw&&(this.ng(this.Yw),this.Yw=0,this.Jw=!1,this.zl=0)},i.ig=function(t){if(void 0===this.Zw){var i=performance.now(),n=Math.max(0,i-this.Qw),r=Math.max(0,this.ql-n);return setTimeout(t,r)}return this.Ni=t,this.Zw.call(window,this._handleRAF)},i.ng=function(t){void 0===this.tg?clearTimeout(t):t&&this.tg.call(window,t)},r(t,[{key:"targetFrameRate",get:function(){return this.qw},set:function(t){this.qw!==t&&(this.qw=t,this.ql=1e3/this.qw,this.Jw&&(this.stop(),this.start()))}},{key:"onTick",get:function(){return this.Kw},set:function(t){this.Kw=t}}]),t}(),sP=new(function(){function t(){this.M=null}return t.prototype.init=function(t){var i=this;return void 0===t&&(t=""),O.rendering&&O.rendering.enableEffectImport&&t?new Promise((function(n,r){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="arraybuffer",s.onload=function(){i.M=s.response,n()},s.onerror=function(){r(new Error("request effect settings failed!"))},s.send(null)})):Promise.resolve()},r(t,[{key:"data",get:function(){return this.M}}]),t}());O.effectSettings=sP;var eP=Oi.querySettings.bind(Oi),hP=t("ds",function(t){function n(){var i;return(i=t.call(this)||this).frame=null,i.container=null,i.canvas=null,i.renderType=-1,i.eventTargetOn=t.prototype.on,i.eventTargetOnce=t.prototype.once,i.config={},i.onStart=null,i.frameTime=1e3/60,i._isCloning=!1,i.sg=!1,i.eg=!1,i.hg=!1,i.Ed=!0,i.ug=!1,i.og=60,i.ag=null,i.fg=0,i.Qw=0,i.vg=0,i.lg=!1,i.dg=!0,i.onPreBaseInitDelegate=new vh,i.onPostBaseInitDelegate=new vh,i.onPreInfrastructureInitDelegate=new vh,i.onPostInfrastructureInitDelegate=new vh,i.onPreSubsystemInitDelegate=new vh,i.onPostSubsystemInitDelegate=new vh,i.onPreProjectInitDelegate=new vh,i.onPostProjectInitDelegate=new vh,i}e(n,t);var s=n.prototype;return s.setFrameRate=function(t){this.frameRate=t},s.getFrameRate=function(){return this.frameRate},s.step=function(){xN.tick(this._calculateDT(!0))},s.wg=function(){this.Ed||(this.ug=!0,this.pause())},s.gg=function(){this.ug&&(this.resume(),this.ug=!1)},s.pause=function(){var t;this.Ed||(this.Ed=!0,null==(t=this.ag)||t.stop(),this.emit(n.EVENT_PAUSE))},s.resume=function(){var t;this.Ed&&(PM._clearEvents(),this.Ed=!1,null==(t=this.ag)||t.start(),this.emit(n.EVENT_RESUME))},s.isPaused=function(){return this.Ed},s.restart=function(){var t=this;return new Promise((function(t){xN.once("director_end_frame",(function(){return t()}))})).then((function(){xN.reset(),T.Object._deferredDestroy(),t.pause(),t.resume(),t.dg=!0})).then((function(){return nP.createInstance().init()})).then((function(){t.pg(n.EVENT_RESTART)}))},s.end=function(){wh.close()},s.on=function(t,i,n,r){return this._g(t)&&i.call(n),this.eventTargetOn(t,i,n,r)},s.once=function(t,i,n){return this._g(t)?i.call(n):this.eventTargetOnce(t,i,n)},s._g=function(t){return this.eg&&t===n.EVENT_ENGINE_INITED||this.sg&&t===n.EVENT_GAME_INITED||this.hg&&t===n.EVENT_RENDERER_INITED},s.init=function(t){var r=this;return this.yg(t),Promise.resolve().then((function(){return r.emit(n.EVENT_PRE_BASE_INIT),r.onPreBaseInitDelegate.dispatch()})).then((function(){q(t.debugMode||0)})).then((function(){return bh.init()})).then((function(){r.mg()})).then((function(){return Oi.init(t.settingsPath,t.overrideSettings)})).then((function(){return r.emit(n.EVENT_POST_BASE_INIT),r.onPostBaseInitDelegate.dispatch()})).then((function(){return r.emit(n.EVENT_PRE_INFRASTRUCTURE_INIT),r.onPreInfrastructureInitDelegate.dispatch()})).then((function(){Si.init(),r.kg();var t={frame:document.querySelector("#GameDiv"),container:document.querySelector("#Cocos3dGameContainer"),canvas:document.querySelector("#GameCanvas")};return r.canvas=t.canvas,r.frame=t.frame,r.container=t.container,mh.init(),Mv.init(),kw.init(r.canvas,L_)})).then((function(){if(eP("rendering","customPipeline")){if(!T.rendering)return void ht(12109);Si.CUSTOM_PIPELINE_NAME||(Si.CUSTOM_PIPELINE_NAME="Builtin")}else T.rendering=void 0;Pk.init(),Fk.init(),M_.init(),r.Ag()})).then((function(){return r.emit(n.EVENT_POST_INFRASTRUCTURE_INIT),r.onPostInfrastructureInitDelegate.dispatch()})).then((function(){return r.emit(n.EVENT_PRE_SUBSYSTEM_INIT),r.onPreSubsystemInitDelegate.dispatch()})).then((function(){return sP.init(eP("rendering","effectSettingsPath"))})).then((function(){if(T.rendering&&T.rendering.enableEffectImport)if(3!==eP("rendering","renderMode")){var t=sP.data;null!==t?T.rendering.init(kw.gfxDevice,t):ht(1102)}else T.rendering.init(kw.gfxDevice,null)})).then((function(){var t=eP("scripting","scriptPackages");return t?Promise.all(t.map((function(t){return i.import(t)}))):Promise.resolve([])})).then((function(){return xN.init(),Fk.loadBuiltinAssets()})).then((function(){return r.emit(n.EVENT_POST_SUBSYSTEM_INIT),r.onPostSubsystemInitDelegate.dispatch()})).then((function(){z("Cocos Creator v"+S),r.emit(n.EVENT_ENGINE_INITED),r.eg=!0})).then((function(){return r.emit(n.EVENT_PRE_PROJECT_INIT),r.onPreProjectInitDelegate.dispatch()})).then((function(){var t=eP("plugins","jsList"),i=Promise.resolve();return t&&t.forEach((function(t){i=i.then((function(){return i="src/"+t,new Promise((function(t,n){var r;function s(t){t.filename===i&&(r=t.error)}window.addEventListener("error",s);var e=document.createElement("script");e.charset="utf-8",e.async=!0,e.crossOrigin="anonymous",e.addEventListener("error",(function(){window.removeEventListener("error",s),n(Error("Error loading "+i))})),e.addEventListener("load",(function(){window.removeEventListener("error",s),document.head.removeChild(e),r?n(r):t()})),e.src=i.replace("#","%23"),document.head.appendChild(e)}));var i}))})),i})).then((function(){return r._loadProjectBundles()})).then((function(){return r.Eg()})).then((function(){return r.Tg()})).then((function(){return r.Og()})).then((function(){return Fk.compileBuiltinMaterial(),nP.createInstance().init()})).then((function(){return r.emit(n.EVENT_POST_PROJECT_INIT),r.onPostProjectInitDelegate.dispatch()})).then((function(){r.sg=!0,r.pg(n.EVENT_GAME_INITED)}))},s.kg=function(){},s.yg=function(t){var i=t.overrideSettings=t.overrideSettings||{};"showFPS"in t&&(i.profiling=i.profiling||{},i.profiling.showFPS=t.showFPS),"frameRate"in t&&(i.screen=i.screen||{},i.screen.frameRate=t.frameRate),"renderMode"in t&&(i.rendering=i.rendering||{},i.rendering.renderMode=t.renderMode),"renderPipeline"in t&&(i.rendering=i.rendering||{},i.rendering.renderPipeline=t.renderPipeline),"assetOptions"in t&&(i.assets=i.assets||{},Object.assign(i.assets,t.assetOptions)),"customJointTextureLayouts"in t&&(i.animation=i.animation||{},i.animation.customJointTextureLayouts=t.customJointTextureLayouts),"physics"in t&&(i.physics=i.physics||{},Object.assign(i.physics,t.physics)),"orientation"in t&&(i.screen=i.screen||{},i.screen.orientation=t.orientation),"exactFitScreen"in t&&(i.screen=i.screen||{},i.screen.exactFitScreen=t.exactFitScreen)},s.Og=function(){var t=eP("assets","preloadAssets");return t?Promise.all(t.map((function(t){return new Promise((function(i,n){Pk.loadAny(t,(function(t){t?n(t):i()}))}))}))):Promise.resolve([])},s.Eg=function(){return new Promise((function(t){t()}))},s._loadProjectBundles=function(){var t=eP("assets","preloadBundles");return t?Promise.all(t.map((function(t){var i=t.bundle,n=t.version;return new Promise((function(t,r){var s={};n&&(s.version=n),Pk.loadBundle(i,s,(function(i){i?r(i):t()}))}))}))):Promise.resolve([])},s.run=function(t){t&&(this.onStart=t),this.sg&&this.resume()},s._calculateDT=function(t){if(this.lg=t,t)return this.Qw=performance.now(),this.frameTime/1e3;var i=performance.now();return this.vg=i>this.Qw?(i-this.Qw)/1e3:0,this.vg>n.DEBUG_DT_THRESHOLD&&(this.vg=this.frameTime/1e3),this.Qw=i,this.vg},s.Sg=function(){var t=this;if(this.sg)if(nP.instance&&!nP.instance.isFinished)nP.instance.update(this._calculateDT(!1));else if(this.dg){nP.releaseInstance(),this.dg=!1;var i,n=eP("launch","launchScene");n?xN.loadScene(n,(function(){tt(1103,n),t.fg=performance.now(),xN.startAnimation(),null==t.onStart||t.onStart()})):(this.fg=performance.now(),xN.startAnimation(),null==(i=this.onStart)||i.call(this))}else xN.tick(this._calculateDT(!1))},s.Ag=function(){var t,i=null!==(t=eP("screen","frameRate"))&&void 0!==t?t:60;Y("number"==typeof i),this.ag=new rP,this.ag.onTick=this.Sg.bind(this),this.frameRate=i},s.mg=function(){wh.on("show",this.Ig,this),wh.on("hide",this.Rg,this),wh.on("close",this.Mg,this)},s.Rg=function(){this.emit(n.EVENT_HIDE),this.wg()},s.Ig=function(){this.emit(n.EVENT_SHOW),this.gg()},s.Mg=function(){this.emit(n.EVENT_CLOSE),wh.exit()},s.addPersistRootNode=function(t){xN.addPersistRootNode(t)},s.removePersistRootNode=function(t){xN.removePersistRootNode(t)},s.isPersistRootNode=function(t){return xN.isPersistRootNode(t)},s.Tg=function(){var t=eP("rendering","customPipeline");return this.Cg(!!t)},s.Cg=function(t){xN.root.setRenderPipeline(t)?(this.hg=!0,this.pg(n.EVENT_RENDERER_INITED)):ht(1222)},s.pg=function(t){this.emit(t)},r(n,[{key:"inited",get:function(){return this.sg}},{key:"frameRate",get:function(){return this.og},set:function(t){"number"!=typeof t&&(t=parseInt(t,10),Number.isNaN(t)&&(t=60)),this.og=t,this.frameTime=1e3/t,this.ag&&(this.ag.targetFrameRate=this.og)}},{key:"deltaTime",get:function(){return this.lg?this.frameTime/1e3:this.vg}},{key:"totalTime",get:function(){return performance.now()-this.fg}},{key:"frameStartTime",get:function(){return this.Qw}}]),n}(eh));hP.EVENT_HIDE="game_on_hide",hP.EVENT_SHOW="game_on_show",hP.EVENT_LOW_MEMORY="game_on_low_memory",hP.EVENT_GAME_INITED="game_inited",hP.EVENT_ENGINE_INITED="engine_inited",hP.EVENT_RENDERER_INITED="renderer_inited",hP.EVENT_PRE_BASE_INIT="pre_base_init",hP.EVENT_POST_BASE_INIT="post_base_init",hP.EVENT_PRE_INFRASTRUCTURE_INIT="pre_infrastructure_init",hP.EVENT_POST_INFRASTRUCTURE_INIT="post_infrastructure_init",hP.EVENT_PRE_SUBSYSTEM_INIT="pre_subsystem_init",hP.EVENT_POST_SUBSYSTEM_INIT="post_subsystem_init",hP.EVENT_PRE_PROJECT_INIT="pre_project_init",hP.EVENT_POST_PROJECT_INIT="post_project_init",hP.EVENT_RESTART="game_on_restart",hP.EVENT_PAUSE="game_on_pause",hP.EVENT_RESUME="game_on_resume",hP.EVENT_CLOSE="game_on_close",hP.RENDER_TYPE_CANVAS=0,hP.RENDER_TYPE_WEBGL=1,hP.RENDER_TYPE_OPENGL=2,hP.RENDER_TYPE_HEADLESS=3,hP.DEBUG_DT_THRESHOLD=1,T.Game=hP;var uP=t("dt",T.game=new hP),oP=t("X",function(t){function i(){var i;return(i=t.call(this)||this)._atlases=[],i._atlasIndex=-1,i.Ng=5,i.Pg=2048,i.Lg=512,i.Dg=!0,i.sf=!1,i}e(i,t);var n=i.prototype;return n.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return!t&&this._atlasIndex<this.maxAtlasCount&&(t=new S_(this.Pg,this.Pg),this._atlases.push(t)),t},n.Bg=function(){this.reset()},n.init=function(){this.enabled=!Si.CLEANUP_IMAGE_CACHE},n.insertSpriteFrame=function(t){if(!this.sf||this._atlasIndex>=this.Ng||!t||t.original)return null;if(!t.packable)return null;var i=t.texture.getSamplerInfo();if(2!==i.minFilter||2!==i.magFilter||0!==i.mipFilter)return null;var n=this._atlases[this._atlasIndex];n||(n=this.newAtlas());var r=n?n.insertSpriteFrame(t):null;return!r&&this._atlasIndex<this.Ng?(n=this.newAtlas())?n.insertSpriteFrame(t):null:r},n.reset=function(){for(var t=0,i=this._atlases.length;t<i;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},n.deleteAtlasSpriteFrame=function(t){if(t.original){for(var i=this._atlases.length-1;i>=0;i--)this._atlases[i].removeSpriteFrame(t);var n=t.original._texture;this.deleteAtlasTexture(n)}},n.deleteAtlasTexture=function(t){if(t)for(var i=this._atlases.length-1;i>=0;i--)this._atlases[i].deleteInnerTexture(t),this._atlases[i].isEmpty()&&(this._atlases[i].destroy(),this._atlases.splice(i,1),this._atlasIndex--)},n.packToDynamicAtlas=function(t,i){if(this.sf&&i&&!i.original&&i.packable&&i.texture&&i.texture.width>0&&i.texture.height>0){var n=this.insertSpriteFrame(i);n&&i._setDynamicAtlasFrame(n)}},r(i,[{key:"enabled",get:function(){return this.sf},set:function(t){this.sf!==t&&(t?(this.reset(),xN.on("director_before_scene_launch",this.Bg,this)):(this.reset(),xN.off("director_before_scene_launch",this.Bg,this)),this.sf=t)}},{key:"maxAtlasCount",get:function(){return this.Ng},set:function(t){this.Ng=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this.Dg},set:function(t){this.Dg=t}},{key:"textureSize",get:function(){return this.Pg},set:function(t){this.Pg=t}},{key:"maxFrameSize",get:function(){return this.Lg},set:function(t){this.Lg=t}}]),i}(_v));oP.instance=void 0;var cP=t("Y",oP.instance=new oP);xN.registerSystem("dynamicAtlasManager",cP,0),T.internal.dynamicAtlasManager=cP;var aP={positions:"a_position",normals:"a_normal",uvs:"a_texCoord",colors:"a_color"},fP=function(){function t(){this.Fg=[],this.Ls=0}var i=t.prototype;return i.Ug=function(t){if(0!==t){var i=this.Ls%t;if(0!==i){var n=t-i;this.Fg.push(n),this.Ls+=n}}},i.xg=function(t){var i=this.Ls;return this.Fg.push(t),this.Ls+=t.byteLength,i},i.Gg=function(){return this.Ls},i.jg=function(){var t=new Uint8Array(this.Ls),i=0;return this.Fg.forEach((function(n){"number"==typeof n?i+=n:(t.set(new Uint8Array(n),i),i+=n.byteLength)})),t.buffer},t}();function vP(t,i){return new lP(t,i)}var lP=function(){function t(t,i){if(this.Hg=[],this.Vg=t,this.Vg.struct.morph){var n=this.Vg.struct.primitives.length;this.Hg=new Array(n).fill(null);for(var r=0;r<n;++r){var s=this.Vg.struct.morph.subMeshMorphs[r];s&&(s.targets.length>60?this.Hg[r]=new wP(this.Vg,r,this.Vg.struct.morph,i):this.Hg[r]=new dP(this.Vg,r,this.Vg.struct.morph,i))}}}return t.prototype.createInstance=function(){for(var t=this,i=this.Vg.struct.primitives.length,n=new Array(i),r=0;r<i;++r){var s,e;n[r]=null!==(s=null==(e=this.Hg[r])?void 0:e.createInstance())&&void 0!==s?s:null}return{setWeights:function(t,i){var r;null==(r=n[t])||r.setWeights(i)},requiredPatches:function(i){t.Vg.struct.morph;var r=t.Vg.struct.morph.subMeshMorphs[i],s=n[i];if(null===s)return null;var e=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:r.targets.length}];return r.attributes.includes("a_position")&&e.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),r.attributes.includes("a_normal")&&e.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),r.attributes.includes("a_tangent")&&e.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),e.push.apply(e,s.requiredPatches()),e},adaptPipelineState:function(t,i){var r;null==(r=n[t])||r.adaptPipelineState(i)},destroy:function(){n.forEach((function(t){t&&t.destroy()}))}}},t}(),dP=function(){function t(t,i,n,r){this.Lr=r;var s=n.subMeshMorphs[i];this.$g=s,yP(t,i,r);var e=t.struct.vertexBundles[t.struct.primitives[i].vertexBundelIndices[0]].view.count;this.zg=e;var h=s.targets.length,u=_P(r,e*h);this.Wg={width:u.width,height:u.height},this.Kn=s.attributes.map((function(i,n){var r=u.create(),h=r.valueView;return s.targets.forEach((function(i,r){for(var s=i.displacements[n],u=new Float32Array(t.data.buffer,t.data.byteOffset+s.offset,s.count),o=e*r*4,c=0;c<e;++c)h[o+4*c+0]=u[3*c+0],h[o+4*c+1]=u[3*c+1],h[o+4*c+2]=u[3*c+2]})),r.updatePixels(),{name:i,morphTexture:r}}))}var i=t.prototype;return i.destroy=function(){this.Kn.forEach((function(t){t.morphTexture.destroy()}))},i.createInstance=function(){var t=this,i=new pP(this.Lr,this.$g.targets.length);return i.setMorphTextureInfo(this.Wg.width,this.Wg.height),i.setVerticesCount(this.zg),i.commit(),{setWeights:function(t){i.setWeights(t),i.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(n){for(var r=0;r<t.Kn.length;++r){var s=t.Kn[r],e=void 0;switch(s.name){case"a_position":e=8;break;case"a_normal":e=9;break;case"a_tangent":e=10;break;default:st(16374)}void 0!==e&&(n.bindSampler(e,s.morphTexture.sampler),n.bindTexture(e,s.morphTexture.texture))}n.bindBuffer(cy.BINDING,i.buffer),n.update()},destroy:function(){}}},t}(),wP=function(){function t(t,i,n,r){this.Kn=[],this.Lr=r;var s=n.subMeshMorphs[i];yP(t,i,r),this.Kn=s.attributes.map((function(i,n){return{name:i,targets:s.targets.map((function(i){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+i.displacements[n].offset,i.displacements[n].count)}}))}}))}return t.prototype.createInstance=function(){return new gP(this,this.Kn[0].targets[0].displacements.length/3,this.Lr)},r(t,[{key:"data",get:function(){return this.Kn}}]),t}(),gP=function(){function t(t,i,n){this.Yh=t,this.Xg=new pP(n,0);var r=_P(n,i);this.Xg.setMorphTextureInfo(r.width,r.height),this.Xg.commit(),this.Kn=this.Yh.data.map((function(t){var i=r.create();return{attributeName:t.name,morphTexture:i}}))}var i=t.prototype;return i.setWeights=function(t){for(var i=0;i<this.Kn.length;++i){var n=this.Kn[i],r=n.morphTexture.valueView,s=this.Yh.data[i];t.length,s.targets.length;for(var e=0;e<s.targets.length;++e){var h=s.targets[e].displacements,u=t[e],o=h.length/3;if(0===e)for(var c=0;c<o;++c)r[4*c+0]=h[3*c+0]*u,r[4*c+1]=h[3*c+1]*u,r[4*c+2]=h[3*c+2]*u;else if(0!==u)for(var a=0;a<o;++a)r[4*a+0]+=h[3*a+0]*u,r[4*a+1]+=h[3*a+1]*u,r[4*a+2]+=h[3*a+2]*u}n.morphTexture.updatePixels()}},i.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},i.adaptPipelineState=function(t){for(var i=0;i<this.Kn.length;++i){var n=this.Kn[i],r=void 0;switch(n.attributeName){case"a_position":r=8;break;case"a_normal":r=9;break;case"a_tangent":r=10;break;default:st(16374)}void 0!==r&&(t.bindSampler(r,n.morphTexture.sampler),t.bindTexture(r,n.morphTexture.texture))}t.bindBuffer(cy.BINDING,this.Xg.buffer),t.update()},i.destroy=function(){this.Xg.destroy();for(var t=0;t<this.Kn.length;++t)this.Kn[t].morphTexture.destroy()},t}(),pP=function(){function t(t,i){this.Yg=i,this.Kg=new DataView(new ArrayBuffer(256)),this.qg=t.createBuffer(new $l(18,3,256,256))}var i=t.prototype;return i.destroy=function(){this.qg.destroy()},i.setWeights=function(t){t.length,this.Yg;for(var i=T.sys.isLittleEndian,n=0;n<t.length;++n)this.Kg.setFloat32(0+4*n,t[n],i)},i.setMorphTextureInfo=function(t,i){var n=T.sys.isLittleEndian;this.Kg.setFloat32(240,t,n),this.Kg.setFloat32(244,i,n)},i.setVerticesCount=function(t){var i=T.sys.isLittleEndian;this.Kg.setFloat32(248,t,i)},i.commit=function(){this.qg.update(this.Kg.buffer)},r(t,[{key:"buffer",get:function(){return this.qg}}]),t}();function _P(t,i){var n,r,s,e;2&t.getFormatFeatures(44)?(n=i,s=16,r=44,e=Float32Array):(n=4*i,s=4,r=35,e=Uint8Array);var h=mP(n),u=h.width,o=h.height;return{width:u,height:o,create:function(){var i=new ArrayBuffer(u*o*s),n=new Float32Array(i),h=e===Float32Array?n:new e(i),c=new mg({width:u,height:o,_data:h,_compressed:!1,format:r}),a=new f_;a.setFilters(1,1),a.setMipFilter(0),a.setWrapMode(2,2,2),a.image=c,a.getGFXTexture()||st(16375);var f=t.getSampler(a.getSamplerInfo());return{get texture(){return a.getGFXTexture()},get sampler(){return f},get valueView(){return n},destroy:function(){a.destroy()},updatePixels:function(){a.uploadData(h)}}}}}function yP(t,i,n){t.renderingSubMeshes[i].enableVertexIdChannel(n)}function mP(t){t<5&&(t=5);var i=M(Jn(t)),n=i>>1;return{width:1<<(1&i?n+1:n),height:1<<n}}function bP(t,n){return(r=t,new Promise((function(t,n){try{r=new URL(r,i.meta.url).href,fetch(r).then((function(i){return i.arrayBuffer().then(t)})).catch((function(){}))}catch(t){n(t)}}))).then((function(t){return WebAssembly.instantiate(t,n)}));var r}var kP={},AP={};(function(){function t(t){throw t}var i=void 0,n=this;function r(t,r){var s,e=t.split("."),h=n;!(e[0]in h)&&h.execScript&&h.execScript("var "+e[0]);for(;e.length&&(s=e.shift());)e.length||r===i?h=h[s]?h[s]:h[s]={}:h[s]=r}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function e(t){var i,n,r,e,h,u,o,c,a,f,v=t.length,l=0,d=Number.POSITIVE_INFINITY;for(c=0;c<v;++c)t[c]>l&&(l=t[c]),t[c]<d&&(d=t[c]);for(i=1<<l,n=new(s?Uint32Array:Array)(i),r=1,e=0,h=2;r<=l;){for(c=0;c<v;++c)if(t[c]===r){for(u=0,o=e,a=0;a<r;++a)u=u<<1|1&o,o>>=1;for(f=r<<16|c,a=u;a<i;a+=h)n[a]=f;++e}++r,e<<=1,h<<=1}return[n,l,d]}function h(i,n){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.j=0,this.input=s?new Uint8Array(i):i,this.k=!1,this.e=o,this.o=!1,!n&&(n={})||(n.index&&(this.a=n.index),n.bufferSize&&(this.h=n.bufferSize),n.bufferType&&(this.e=n.bufferType),n.resize&&(this.o=n.resize)),this.e){case u:this.b=32768,this.c=new(s?Uint8Array:Array)(32768+this.h+258);break;case o:this.b=0,this.c=new(s?Uint8Array:Array)(this.h);break;default:t(Error("invalid inflate mode"))}}var u=0,o=1,c={q:u,p:o};h.prototype.i=function(){for(;!this.k;){var n=I(this,3);switch(1&n&&(this.k=!0),n>>>=1){case 0:var r=this.input,h=this.a,c=this.c,a=this.b,f=r.length,v=i,d=c.length,w=i;switch(this.d=this.f=0,h+1>=f&&t(Error("invalid uncompressed block header: LEN")),v=r[h++]|r[h++]<<8,h+1>=f&&t(Error("invalid uncompressed block header: NLEN")),v===~(r[h++]|r[h++]<<8)&&t(Error("invalid uncompressed block header: length verify")),h+v>r.length&&t(Error("input buffer is broken")),this.e){case u:for(;a+v>c.length;){if(v-=w=d-a,s)c.set(r.subarray(h,h+w),a),a+=w,h+=w;else for(;w--;)c[a++]=r[h++];this.b=a,c=N(this),a=this.b}break;case o:for(;a+v>c.length;)c=P(this,{m:2});break;default:t(Error("invalid inflate mode"))}if(s)c.set(r.subarray(h,h+v),a),a+=v,h+=v;else for(;v--;)c[a++]=r[h++];this.a=h,this.b=a,this.c=c;break;case 1:switch(this.e){case o:C(this,T,S);break;case u:M(this,T,S);break;default:t(Error("invalid inflate mode"))}break;case 2:var g,p,_,y,m=I(this,5)+257,b=I(this,5)+1,k=I(this,4)+4,A=new(s?Uint8Array:Array)(l.length),E=i,O=i,L=i,D=i,B=i;for(B=0;B<k;++B)A[l[B]]=I(this,3);if(!s)for(B=k,k=A.length;B<k;++B)A[l[B]]=0;for(g=e(A),E=new(s?Uint8Array:Array)(m+b),B=0,y=m+b;B<y;)switch(O=R(this,g),O){case 16:for(D=3+I(this,2);D--;)E[B++]=L;break;case 17:for(D=3+I(this,3);D--;)E[B++]=0;L=0;break;case 18:for(D=11+I(this,7);D--;)E[B++]=0;L=0;break;default:L=E[B++]=O}switch(p=e(s?E.subarray(0,m):E.slice(0,m)),_=e(s?E.subarray(m):E.slice(m)),this.e){case o:C(this,p,_);break;case u:M(this,p,_);break;default:t(Error("invalid inflate mode"))}break;default:t(Error("unknown BTYPE: "+n))}}switch(this.e){case u:var F,U,x,G,j,H,V=0,$=this.c,z=this.g,W=new(s?Uint8Array:Array)(this.j+(this.b-32768));if(0===z.length)F=s?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);else{for(x=0,G=z.length;x<G;++x)for(j=0,H=(U=z[x]).length;j<H;++j)W[V++]=U[j];for(x=32768,G=this.b;x<G;++x)W[V++]=$[x];this.g=[],F=this.buffer=W}return F;case o:var X,Y=this.b;return s?this.o?(X=new Uint8Array(Y)).set(this.c.subarray(0,Y)):X=this.c.subarray(0,Y):(this.c.length>Y&&(this.c.length=Y),X=this.c),this.buffer=X;default:t(Error("invalid inflate mode"))}};var a,f,v=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=s?new Uint16Array(v):v,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],w=s?new Uint16Array(d):d,g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],p=s?new Uint8Array(g):g,_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],y=s?new Uint16Array(_):_,m=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=s?new Uint8Array(m):m,k=new(s?Uint8Array:Array)(288);for(a=0,f=k.length;a<f;++a)k[a]=143>=a?8:255>=a?9:279>=a?7:8;var A,E,T=e(k),O=new(s?Uint8Array:Array)(30);for(A=0,E=O.length;A<E;++A)O[A]=5;var S=e(O);function I(i,n){var r,s=i.f,e=i.d,h=i.input,u=i.a;for(u+(n-e+7>>3)>=h.length&&t(Error("input buffer is broken"));e<n;)s|=h[u++]<<e,e+=8;return r=s&(1<<n)-1,i.f=s>>>n,i.d=e-n,i.a=u,r}function R(i,n){for(var r,s,e=i.f,h=i.d,u=i.input,o=i.a,c=u.length,a=n[0],f=n[1];h<f&&!(o>=c);)e|=u[o++]<<h,h+=8;return(s=(r=a[e&(1<<f)-1])>>>16)>h&&t(Error("invalid code length: "+s)),i.f=e>>s,i.d=h-s,i.a=o,65535&r}function M(t,i,n){var r=t.c,s=t.b;t.l=i;for(var e,h,u,o,c=r.length-258;256!==(e=R(t,i));)if(256>e)s>=c&&(t.b=s,r=N(t),s=t.b),r[s++]=e;else for(o=w[h=e-257],0<p[h]&&(o+=I(t,p[h])),e=R(t,n),u=y[e],0<b[e]&&(u+=I(t,b[e])),s>=c&&(t.b=s,r=N(t),s=t.b);o--;)r[s]=r[s++-u];for(;8<=t.d;)t.d-=8,t.a--;t.b=s}function C(t,i,n){var r=t.c,s=t.b;t.l=i;for(var e,h,u,o,c=r.length;256!==(e=R(t,i));)if(256>e)s>=c&&(c=(r=P(t)).length),r[s++]=e;else for(o=w[h=e-257],0<p[h]&&(o+=I(t,p[h])),e=R(t,n),u=y[e],0<b[e]&&(u+=I(t,b[e])),s+o>c&&(c=(r=P(t)).length);o--;)r[s]=r[s++-u];for(;8<=t.d;)t.d-=8,t.a--;t.b=s}function N(t){var i,n,r=new(s?Uint8Array:Array)(t.b-32768),e=t.b-32768,h=t.c;if(s)r.set(h.subarray(32768,r.length));else for(i=0,n=r.length;i<n;++i)r[i]=h[i+32768];if(t.g.push(r),t.j+=r.length,s)h.set(h.subarray(e,e+32768));else for(i=0;32768>i;++i)h[i]=h[e+i];return t.b=32768,h}function P(t,i){var n,r,e,h=t.input.length/t.a+1|0,u=t.input,o=t.c;return i&&("number"==typeof i.m&&(h=i.m),"number"==typeof i.r&&(h+=i.r)),r=2>h?(e=(u.length-t.a)/t.l[2]/2*258|0)<o.length?o.length+e:o.length<<1:o.length*h,s?(n=new Uint8Array(r)).set(o):n=o,t.c=n,t.c}function L(i,n){var r,s;this.input=i,this.a=0,!n&&(n={})||(n.index&&(this.a=n.index),n.verify&&(this.s=n.verify)),r=i[this.a++],s=i[this.a++],(15&r)===D?this.method=D:t(Error("unsupported compression method")),0!=((r<<8)+s)%31&&t(Error("invalid fcheck flag:"+((r<<8)+s)%31)),32&s&&t(Error("fdict flag is not supported")),this.n=new h(i,{index:this.a,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}L.prototype.i=function(){var i,n,r=this.input;if(i=this.n.i(),this.a=this.n.a,this.s){n=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;var s=i;if("string"==typeof s){var e,h,u=s.split("");for(e=0,h=u.length;e<h;e++)u[e]=(255&u[e].charCodeAt(0))>>>0;s=u}for(var o,c=1,a=0,f=s.length,v=0;0<f;){f-=o=1024<f?1024:f;do{a+=c+=s[v++]}while(--o);c%=65521,a%=65521}n!==(a<<16|c)>>>0&&t(Error("invalid adler-32 checksum"))}return i};var D=8;r("Zlib.Inflate",L),r("Zlib.Inflate.prototype.decompress",L.prototype.i);var B,F,U,x,G={ADAPTIVE:c.p,BLOCK:c.q};if(Object.keys)B=Object.keys(G);else for(F in B=[],U=0,G)B[U++]=F;for(U=0,x=B.length;U<x;++U)r("Zlib.Inflate.BufferType."+(F=B[U]),G[F])}).call(AP);var EP,TP,OP,SP,IP,RP=AP.Zlib;RP.Inflate=RP.Inflate,RP.Inflate.BufferType=RP.Inflate.BufferType,RP.Inflate.prototype.decompress=RP.Inflate.prototype.decompress;var MP=Ir.add,CP=Ir.multiplyScalar,NP=Ir.subtract,PP=Mh.transform,LP=Mh.fromPoints,DP=Ir.max,BP=Ir.min,FP=Ir.transformQuat,UP=Ir.transformMat4;function xP(t){switch(t){case 1:default:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}}var GP=new Ir,jP=new Ir,HP=new Uint8Array,VP=_o("cc.Mesh")((TP=function(t){function i(i){var n;return(n=t.call(this,i)||this).morphRendering=null,n._struct=OP&&OP(),n._hash=SP&&SP(),n.M=HP,n.Qg=!1,n._allowDataAccess=IP&&IP(),n.Jg=!1,n.Zg=null,n.tp=new Map,n.ip=null,n}e(i,t);var n=i.prototype;return n.onLoaded=function(){this.initialize()},n.initialize=function(){if(!this.Qg){this.Qg=!0;var t={struct:this.struct,data:this.data};if(t.struct.compressed&&(t=qP(t)),this.struct.encoded&&(t=KP(t)),!this.struct.quantized||16&kw.gfxDevice.getFormatFeatures(29)||(t=QP(t)),this._struct=t.struct,this.M=t.data,this._struct.dynamic){for(var i=kw.gfxDevice,n=[],r=[],s=0;s<this._struct.vertexBundles.length;s++){var e=this._struct.vertexBundles[s],h=i.createBuffer(new $l(10,1,e.view.length,e.view.stride));n.push(h)}for(var u=0;u<this._struct.primitives.length;u++){var o=this._struct.primitives[u],c=o.indexView,a=null;c&&(a=i.createBuffer(new $l(6,1,c.length,c.stride)));for(var f=[],v=0;v<o.vertexBundelIndices.length;v++){var l=o.vertexBundelIndices[v];f.push(n[l])}for(var d=[],w=0;w<o.vertexBundelIndices.length;w++)for(var g=o.vertexBundelIndices[w],p=this._struct.vertexBundles[g].attributes,_=0;_<p.length;_++){var y=p[_],m=new ud;m.copy(y),d.push(m)}var b=new jA(f,d,o.primitiveMode,a);b.drawInfo=new Wl,b.mesh=this,b.subMeshIdx=u,r.push(b)}this.Zg=r}else{for(var k=this.M.buffer,A=kw.gfxDevice,E=this.np(A,k),T=[],O=[],S=0;S<this._struct.primitives.length;S++){var I=this._struct.primitives[S];if(0!==I.vertexBundelIndices.length){var R=null,M=void 0;if(I.indexView){var C=I.indexView,N=C.stride,P=C.length;if(4===N&&!A.hasFeature(0)){var L=this._struct.vertexBundles[I.vertexBundelIndices[0]].view.count;if(L>=65536){st(10001,L,65536);continue}N>>=1,P>>=1}R=A.createBuffer(new $l(4,1,P,N)),T.push(R),M=new(xP(C.stride))(k,C.offset,C.count),C.stride!==N&&(M=xP(N).from(M)),R.update(M)}var D=I.vertexBundelIndices.map((function(t){return E[t]})),B=[];if(I.vertexBundelIndices.length>0)for(var F=I.vertexBundelIndices[0],U=this._struct.vertexBundles[F].attributes,x=0;x<U.length;++x){var G=U[x];B[x]=new ud(G.name,G.format,G.isNormalized,G.stream,G.isInstanced,G.location)}var j=new jA(D,B,I.primitiveMode,R);j.mesh=this,j.subMeshIdx=S,O.push(j)}}this.Zg=O,this._struct.morph&&(this.morphRendering=vP(this,A)),this.Jg=!0,this._allowDataAccess||this.rp()}}},n.updateSubMesh=function(t,i){if(this._struct.dynamic)if(t>=this._struct.primitives.length)st(14201);else{var n=[];if(i.positions.length>0&&n.push(i.positions),i.normals&&i.normals.length>0&&n.push(i.normals),i.uvs&&i.uvs.length>0&&n.push(i.uvs),i.tangents&&i.tangents.length>0&&n.push(i.tangents),i.colors&&i.colors.length>0&&n.push(i.colors),i.customAttributes)for(var r=0;r<i.customAttributes.length;r++)n.push(i.customAttributes[r].values);for(var s=this._struct.dynamic,e=s.info,h=this._struct.primitives[t],u=this.Zg[t],o=u.drawInfo,c=0;c<n.length;c++){var a=n[c],f=this._struct.vertexBundles[h.vertexBundelIndices[c]],v=f.view.stride,l=a.byteLength/v,d=a.byteLength,w=new Uint8Array(this.M.buffer,f.view.offset,d),g=new Uint8Array(a.buffer,a.byteOffset,d),p=u.vertexBuffers[c];e.maxSubMeshVertices,d>0&&(w.set(g),p.update(g,d)),f.view.count=l,o.vertexCount=l}if(h.indexView){var _=h.indexView,y=_.stride,m=2===y?i.indices16.length:i.indices32.length,b=m*y,k=new Uint8Array(this.M.buffer,_.offset,b),A=2===y?new Uint8Array(i.indices16.buffer,i.indices16.byteOffset,b):new Uint8Array(i.indices32.buffer,i.indices32.byteOffset,b),E=u.indexBuffer;e.maxSubMeshIndices,b>0&&(k.set(A),E.update(A,b)),_.count=m,o.indexCount=m}if(i.minPos&&i.maxPos){var T=Rr(i.minPos.x,i.minPos.y,i.minPos.z),O=Rr(i.maxPos.x,i.maxPos.y,i.maxPos.z);s.bounds[t]||(s.bounds[t]=new Mh),LP(s.bounds[t],T,O);var S=Rr(),I=Rr();s.bounds.forEach((function(t){t&&(t.getBoundary(S,I),BP(T,S,T),DP(O,I,O))})),this._struct.minPosition=Rr(T.x,T.y,T.z),this._struct.maxPosition=Rr(O.x,O.y,O.z)}u.invalidateGeometricInfo()}else st(14200)},n.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},n.destroyRenderingMesh=function(){if(this.Zg){for(var t=0;t<this.Zg.length;t++)this.Zg[t].destroy();this.Zg=null,this.Qg=!1,this.Jg=!1}},n.assign=function(t,i){this.reset({struct:t,data:i})},n.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this.M=t.data,this._hash=0},n.getBoneSpaceBounds=function(t){if(this.tp.has(t.hash))return this.tp.get(t.hash);var i=[];this.tp.set(t.hash,i);for(var n=[],r=t.bindposes,s=0;s<r.length;s++)i.push(new Mh(1/0,1/0,1/0,-1/0,-1/0,-1/0)),n.push(!1);for(var e=this._struct.primitives,h=0;h<e.length;h++){var u=this.readAttribute(h,"a_joints"),o=this.readAttribute(h,"a_weights"),c=this.readAttribute(h,"a_position");if(u&&o&&c)for(var a=Math.min(u.length/4,o.length/4,c.length/3),f=0;f<a;f++){Ir.set(GP,c[3*f+0],c[3*f+1],c[3*f+2]);for(var v=0;v<4;++v){var l=4*f+v,d=u[l];if(!(0===o[l]||d>=r.length)){UP(jP,GP,r[d]),n[d]=!0;var w=i[d];BP(w.center,w.center,jP),DP(w.halfExtents,w.halfExtents,jP)}}}}for(var g=0;g<r.length;g++){var p=i[g];n[g]?LP(p,p.center,p.halfExtents):i[g]=null}return i},n.merge=function(t,i,n){if(n&&!this.validateMergingMesh(t))return!1;var r=new Ir,s=i&&new Qr,e=i&&new Mh;if(s&&i.getRotation(s),!this.Qg){var h=JSON.parse(JSON.stringify(t._struct)),u=t.M.slice();if(i){h.maxPosition&&h.minPosition&&(MP(e.center,h.maxPosition,h.minPosition),CP(e.center,e.center,.5),NP(e.halfExtents,h.maxPosition,h.minPosition),CP(e.halfExtents,e.halfExtents,.5),PP(e,e,i),MP(h.maxPosition,e.center,e.halfExtents),NP(h.minPosition,e.center,e.halfExtents));for(var o=0;o<h.vertexBundles.length;o++)for(var c=h.vertexBundles[o],a=0;a<c.attributes.length;a++)if("a_position"===c.attributes[a].name||"a_normal"===c.attributes[a].name){var f=c.attributes[a].format,v=new DataView(u.buffer,c.view.offset+$P(c.attributes,a)),l=XP(v,f),d=YP(v,f);if(!l||!d)continue;for(var g=c.view.count,p=c.view.stride,_=WP(f),y=0;y<g;y++){var m=y*p,b=m+_,k=b+_;switch(r.set(l(m),l(b),l(k)),c.attributes[a].name){case"a_position":r.transformMat4(i);break;case"a_normal":FP(r,r,s)}d(m,r.x),d(b,r.y),d(k,r.z)}}}return this.reset({struct:h,data:u}),this.initialize(),!0}for(var A,E,T,O,S,I=new fP,R=0,M=0,C=0,N=0,P=0,L=0,D=0,B=0,F=!1,U=new Array(this._struct.vertexBundles.length),x=0;x<this._struct.vertexBundles.length;++x){var G=this._struct.vertexBundles[x],j=t._struct.vertexBundles[x];C=G.view.offset,N=j.view.offset,M=G.view.stride,R=G.view.count+j.view.count,A=new ArrayBuffer(R*M),E=new Uint8Array(A),C+=(T=this.M.subarray(C,C+G.view.length)).length,N+=(O=t.M.subarray(N,N+j.view.length)).length,E.set(T),P=0;for(var H,V=w(G.attributes);!(H=V()).done;){var $=H.value;D=0,F=!1;for(var z,W=w(j.attributes);!(z=W()).done;){var X=z.value;if($.name===X.name&&$.format===X.format){F=!0;break}D+=Fd[X.format].size}if(F){B=Fd[$.format].size,L=G.view.length+P;for(var Y=0;Y<j.view.count;++Y){if(S=O.subarray(D,D+B),E.set(S,L),("a_position"===$.name||"a_normal"===$.name)&&i){var K=new Float32Array(E.buffer,L,3);switch(r.set(K[0],K[1],K[2]),$.name){case"a_position":r.transformMat4(i);break;case"a_normal":FP(r,r,s)}K[0]=r.x,K[1]=r.y,K[2]=r.z}L+=G.view.stride,D+=j.view.stride}}P+=Fd[$.format].size}U[x]={attributes:G.attributes,view:{offset:I.Gg(),length:A.byteLength,count:R,stride:M}},I.xg(A)}for(var q,Q,J,Z=0,tt=2,it=new Array(this._struct.primitives.length),nt=0;nt<this._struct.primitives.length;++nt){var rt=this._struct.primitives[nt],st=t._struct.primitives[nt];it[nt]={primitiveMode:rt.primitiveMode,vertexBundelIndices:rt.vertexBundelIndices};for(var et,ht=0,ut=w(rt.vertexBundelIndices);!(et=ut()).done;){var ot=et.value;ht=Math.max(ht,this._struct.vertexBundles[ot].view.count)}if(rt.indexView&&st.indexView){Z=rt.indexView.count,Z+=st.indexView.count,C=rt.indexView.offset,N=st.indexView.offset,tt=Z<256?1:Z<65536?2:4;var ct=new ArrayBuffer(Z*tt);if(q=2===tt?new Uint16Array(ct):1===tt?new Uint8Array(ct):new Uint32Array(ct),Q=2===rt.indexView.stride?new Uint16Array(this.M.buffer,C,rt.indexView.count):1===rt.indexView.stride?new Uint8Array(this.M.buffer,C,rt.indexView.count):new Uint32Array(this.M.buffer,C,rt.indexView.count),tt===rt.indexView.stride)q.set(Q);else for(var at=0;at<rt.indexView.count;++at)q[at]=Q[at];C+=rt.indexView.length,J=2===st.indexView.stride?new Uint16Array(t.M.buffer,N,st.indexView.count):1===st.indexView.stride?new Uint8Array(t.M.buffer,N,st.indexView.count):new Uint32Array(t.M.buffer,N,st.indexView.count);for(var ft=0;ft<st.indexView.count;++ft)q[rt.indexView.count+ft]=ht+J[ft];N+=st.indexView.length,it[nt].indexView={offset:I.Gg(),length:ct.byteLength,count:Z,stride:tt},I.Ug(tt),I.xg(ct)}}var vt={vertexBundles:U,primitives:it,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return vt.minPosition&&t._struct.minPosition&&vt.maxPosition&&t._struct.maxPosition&&(i?(MP(e.center,t._struct.maxPosition,t._struct.minPosition),CP(e.center,e.center,.5),NP(e.halfExtents,t._struct.maxPosition,t._struct.minPosition),CP(e.halfExtents,e.halfExtents,.5),PP(e,e,i),MP(r,e.center,e.halfExtents),DP(vt.maxPosition,vt.maxPosition,r),NP(r,e.center,e.halfExtents),BP(vt.minPosition,vt.minPosition,r)):(BP(vt.minPosition,vt.minPosition,t._struct.minPosition),DP(vt.maxPosition,vt.maxPosition,t._struct.maxPosition))),this.reset({struct:vt,data:new Uint8Array(I.jg())}),this.initialize(),!0},n.validateMergingMesh=function(t){if(this._struct.dynamic||t._struct.dynamic)return!1;if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var i=0;i<this._struct.vertexBundles.length;++i){var n=this._struct.vertexBundles[i],r=t._struct.vertexBundles[i];if(n.attributes.length!==r.attributes.length)return!1;for(var s=0;s<n.attributes.length;++s)if(n.attributes[s].format!==r.attributes[s].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var e=0;e<this._struct.primitives.length;++e){var h=this._struct.primitives[e],u=t._struct.primitives[e];if(h.vertexBundelIndices.length!==u.vertexBundelIndices.length)return!1;for(var o=0;o<h.vertexBundelIndices.length;++o)if(h.vertexBundelIndices[o]!==u.vertexBundelIndices[o])return!1;if(h.primitiveMode!==u.primitiveMode)return!1;if(h.indexView){if(void 0===u.indexView)return!1}else if(u.indexView)return!1}return!0},n.readAttribute=function(t,i){var n=this,r=null;return this.sp(t,i,(function(t,i){var s=t.view.count,e=t.attributes[i].format,h=Wd(Fd[e]);if(0!==s){var u=new DataView(n.M.buffer,t.view.offset+$P(t.attributes,i)),o=Fd[e],c=XP(u,e);if(h&&c){for(var a=o.count,f=new h(s*a),v=t.view.stride,l=0;l<s;++l)for(var d=0;d<a;++d)f[a*l+d]=c(v*l+f.BYTES_PER_ELEMENT*d);r=f}}})),r},n.copyAttribute=function(t,i,n,r,s){var e=this,h=!1;return this.sp(t,i,(function(t,i){var u=t.view.count;if(0!==u){var o=t.attributes[i].format,c=new DataView(e.M.buffer,t.view.offset+$P(t.attributes,i)),a=new DataView(n,s),f=Fd[o],v=XP(c,o),l=YP(a,o);if(v&&l){for(var d=f.count,w=t.view.stride,g=WP(o),p=r,_=g,y=0;y<u;++y)for(var m=0;m<d;++m)l(p*y+_*m,v(w*y+g*m));h=!0}}else h=!0})),h},n.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var i=this._struct.primitives[t];if(!i.indexView)return null;var n=i.indexView.stride;return new(1===n?Uint8Array:2===n?Uint16Array:Uint32Array)(this.M.buffer,i.indexView.offset,i.indexView.count)},n.copyIndices=function(t,i){if(t>=this._struct.primitives.length)return!1;var n=this._struct.primitives[t];if(!n.indexView)return!1;for(var r=n.indexView.count,s=1===n.indexView.stride?6:2===n.indexView.stride?9:12,e=XP(new DataView(this.M.buffer),s),h=0;h<r;++h)i[h]=e(n.indexView.offset+Fd[s].size*h);return!0},n.readAttributeFormat=function(t,i){var n=null;return this.sp(t,i,(function(t,i){var r=t.attributes[i].format;n=Fd[r]})),n},n.sp=function(t,i,n){if(!(t>=this._struct.primitives.length))for(var r=this._struct.primitives[t].vertexBundelIndices,s=0;s<r.length;s++){var e=r[s],h=this._struct.vertexBundles[e],u=h.attributes.findIndex((function(t){return t.name===i}));if(!(u<0)){n(h,u);break}}},n.np=function(t,i){return this._struct.vertexBundles.map((function(n){var r=t.createBuffer(new $l(8,1,n.view.length,n.view.stride)),s=new Uint8Array(i,n.view.offset,n.view.length);return r.update(s),r}))},n.initDefault=function(i){t.prototype.initDefault.call(this,i),this.reset({struct:{vertexBundles:[],primitives:[]},data:HP})},n.rp=function(){this.M=HP},r(i,[{key:"_nativeAsset",get:function(){return this.M.buffer},set:function(t){this.M=new Uint8Array(t)}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this.M}},{key:"hash",get:function(){return this._hash||(this._hash=Sv(this.M,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this.ip?this.ip:this.ip=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this.Zg}},{key:"allowDataAccess",get:function(){return this._allowDataAccess},set:function(t){this._allowDataAccess=t,this.Jg&&!this._allowDataAccess&&this.rp()}}]),i}(rg),OP=uo(TP.prototype,"_struct",[Co],(function(){return{vertexBundles:[],primitives:[]}})),SP=uo(TP.prototype,"_hash",[Co],(function(){return 0})),IP=uo(TP.prototype,"_allowDataAccess",[Co],(function(){return!0})),EP=TP))||EP;function $P(t,i){for(var n=0,r=0;r<i;++r){var s=t[r];n+=Fd[s.format].size}return n}T.Mesh=VP;var zP=bh.isLittleEndian;function WP(t){var i=Fd[t];return i.size/i.count}function XP(t,i){var n=Fd[i],r=n.size/n.count;switch(n.type){case 1:case 3:switch(r){case 1:return function(i){return t.getUint8(i)};case 2:return function(i){return t.getUint16(i,zP)};case 4:return function(i){return t.getUint32(i,zP)}}break;case 2:case 4:switch(r){case 1:return function(i){return t.getInt8(i)};case 2:return function(i){return t.getInt16(i,zP)};case 4:return function(i){return t.getInt32(i,zP)}}break;case 6:switch(r){case 2:return function(i){return t.getUint16(i,zP)};case 4:return function(i){return t.getFloat32(i,zP)}}}return null}function YP(t,i){var n=Fd[i],r=n.size/n.count;switch(n.type){case 1:case 3:switch(r){case 1:return function(i,n){return t.setUint8(i,n)};case 2:return function(i,n){return t.setUint16(i,n,zP)};case 4:return function(i,n){return t.setUint32(i,n,zP)}}break;case 2:case 4:switch(r){case 1:return function(i,n){return t.setInt8(i,n)};case 2:return function(i,n){return t.setInt16(i,n,zP)};case 4:return function(i,n){return t.setInt32(i,n,zP)}}break;case 6:switch(r){case 2:return function(i,n){return t.setUint16(i,n,zP)};case 4:return function(i,n){return t.setFloat32(i,n,zP)}}}return null}function KP(t){if(!t.struct.encoded)return t;var i=function(t){t<0&&ht(14204,t)},n=JSON.parse(JSON.stringify(t.struct)),r=new fP;r.Ug(0);for(var s,e=w(n.vertexBundles);!(s=e()).done;){var h=s.value,u=h.view,o=u.count*u.stride,c=new Uint8Array(o),a=new Uint8Array(t.data.buffer,u.offset,u.length);i(kP.ep(c,u.count,u.stride,a)),r.Ug(u.stride);var f={offset:r.Gg(),length:c.byteLength,count:u.count,stride:u.stride};h.view=f,r.xg(c)}for(var v,l=w(n.primitives);!(v=l()).done;){var d=v.value;if(void 0!==d.indexView){var g=d.indexView,p=g.count*g.stride,_=new Uint8Array(p),y=new Uint8Array(t.data.buffer,g.offset,g.length);i(kP.hp(_,g.count,g.stride,y)),r.Ug(g.stride);var m={offset:r.Gg(),length:_.byteLength,count:g.count,stride:g.stride};d.indexView=m,r.xg(_)}}return{struct:n,data:new Uint8Array(r.jg())}}function qP(t){var i=new RP.Inflate(t.data).decompress();return t.data=i,t.struct.compressed=!1,t}function QP(t){var i=JSON.parse(JSON.stringify(t.struct)),n=new fP;function r(t,i,n,r,s,e,h){for(var u=0;u<n;u++)for(var o=0;o<r;o++)i(h*u+s*o,t(e*u+s*o))}function s(t,i,n,r,s,e){for(var h=0;h<n;h++)for(var u=0;u<r;u++)i(e*h+4*u,fr(t(s*h+2*u)))}n.Ug(0);for(var e=0;e<i.vertexBundles.length;++e){for(var h=i.vertexBundles[e],u=h.view,o=h.attributes,c=t.struct.vertexBundles[e].attributes,a=[],f=[],v=[],l=0;l<o.length;++l){var d=o[l],g=XP(new DataView(t.data.buffer,u.offset+$P(c,l)),d.format),p=!0;switch(d.format){case 8:d.format=11;break;case 18:d.format=21;break;case 29:d.format=32;break;case 41:d.format=44;break;default:p=!1}a.push(Fd[d.format].size),f.push(p),v.push(g)}for(var _=a.reduce((function(t,i){return t+i}),0),y=new Uint8Array(_*u.count),m=0;m<o.length;++m){var b=o[m],k=v[m],A=YP(new DataView(y.buffer,$P(o,m)),b.format),E=f[m],T=Fd[b.format];E?s(k,A,u.count,T.count,u.stride,_):r(k,A,u.count,T.count,T.size/T.count,u.stride,_)}n.Ug(_);var O={offset:n.Gg(),length:y.byteLength,count:u.count,stride:_};h.view=O,n.xg(y)}for(var S,I=w(i.primitives);!(S=I()).done;){var R=S.value;if(void 0!==R.indexView){var M=R.indexView,C=new Uint8Array(t.data.buffer,M.offset,M.length);n.Ug(M.stride);var N={offset:n.Gg(),length:C.byteLength,count:M.count,stride:M.stride};R.indexView=N,n.xg(C)}}var P=new Uint8Array(n.jg());return i.quantized=!1,{struct:i,data:P}}var JP=[new ud("a_position",32),new ud("a_normal",32),new ud("a_texCoord",21),new ud("a_tangent",44),new ud("a_color",44)],ZP=new Ir;function tL(t,i,n){n=n||{};var r,s=[],e=0,h=[],u=0,o=t.positions.slice();if(o.length>0){r=null,t.attributes&&(r=t.attributes.find((function(t){return"a_position"===t.name}))||null),r||(r=JP[0]),s.push(r);var c=Fd[r.format];u=Math.max(u,Math.floor(o.length/c.count)),h.push({offset:e,data:o,attribute:r}),e+=c.size}if(t.normals&&t.normals.length>0){r=null,t.attributes&&(r=t.attributes.find((function(t){return"a_normal"===t.name}))||null),r||(r=JP[1]);var a=Fd[r.format];s.push(r),u=Math.max(u,Math.floor(t.normals.length/a.count)),h.push({offset:e,data:t.normals,attribute:r}),e+=a.size}if(t.uvs&&t.uvs.length>0){r=null,t.attributes&&(r=t.attributes.find((function(t){return"a_texCoord"===t.name}))||null),r||(r=JP[2]);var f=Fd[r.format];s.push(r),u=Math.max(u,Math.floor(t.uvs.length/f.count)),h.push({offset:e,data:t.uvs,attribute:r}),e+=f.size}if(t.tangents&&t.tangents.length>0){r=null,t.attributes&&(r=t.attributes.find((function(t){return"a_tangent"===t.name}))||null),r||(r=JP[3]);var v=Fd[r.format];s.push(r),u=Math.max(u,Math.floor(t.tangents.length/v.count)),h.push({offset:e,data:t.tangents,attribute:r}),e+=v.size}if(t.colors&&t.colors.length>0){r=null,t.attributes&&(r=t.attributes.find((function(t){return"a_color"===t.name}))||null),r||(r=JP[4]);var l=Fd[r.format];s.push(r),u=Math.max(u,Math.floor(t.colors.length/l.count)),h.push({offset:e,data:t.colors,attribute:r}),e+=l.size}if(t.customAttributes)for(var d=0;d<t.customAttributes.length;d++){var w=t.customAttributes[d],g=Fd[w.attr.format];s.push(w.attr),u=Math.max(u,Math.floor(w.values.length/g.count)),h.push({offset:e,data:w.values,attribute:w.attr}),e+=g.size}var p=new fP,_=new ArrayBuffer(u*e),y=new DataView(_);h.forEach((function(t){FA(y,t.data,t.attribute.format,t.offset,e)})),p.Ug(0);var m={attributes:s,view:{offset:p.Gg(),length:_.byteLength,count:u,stride:e}};p.xg(_);var b=null,k=0;if(t.indices){var A=t.indices;k=A.length,b=new ArrayBuffer(2*k),FA(new DataView(b),A,9)}var E={primitiveMode:t.primitiveMode||7,vertexBundelIndices:[0]};b&&(p.Ug(2),E.indexView={offset:p.Gg(),length:b.byteLength,count:k,stride:2},p.xg(b));var T=t.minPos;if(!T&&n.calculateBounds){T=Ir.set(new Ir,1/0,1/0,1/0);for(var O=0;O<u;++O)Ir.set(ZP,o[3*O+0],o[3*O+1],o[3*O+2]),Ir.min(T,T,ZP)}var S=t.maxPos;if(!S&&n.calculateBounds){S=Ir.set(new Ir,-1/0,-1/0,-1/0);for(var I=0;I<u;++I)Ir.set(ZP,o[3*I+0],o[3*I+1],o[3*I+2]),Ir.max(S,S,ZP)}var R={vertexBundles:[m],primitives:[E]};return T&&(R.minPosition=new Ir(T.x,T.y,T.z)),S&&(R.maxPosition=new Ir(S.x,S.y,S.z)),i||(i=new VP),i.reset({struct:R,data:new Uint8Array(p.jg())}),i}function iL(t,i){if(i>0){var n=t%i;if(0!==n)return i-n}return 0}function nL(t,i,n,r){r=r||{maxSubMeshes:1,maxSubMeshVertices:1024,maxSubMeshIndices:1024};var s=[],e=0;if(i.positions.length>0&&s.push(new ud("a_position",32,!1,e++,!1,0)),i.normals&&i.normals.length>0&&s.push(new ud("a_normal",32,!1,e++,!1,0)),i.uvs&&i.uvs.length>0&&s.push(new ud("a_texCoord",21,!1,e++,!1,0)),i.tangents&&i.tangents.length>0&&s.push(new ud("a_tangent",44,!1,e++,!1,0)),i.colors&&i.colors.length>0&&s.push(new ud("a_color",44,!1,e++,!1,0)),i.customAttributes)for(var h=0;h<i.customAttributes.length;h++){var u=i.customAttributes[h],o=new ud;o.copy(u.attr),o.stream=e++,s.push(o)}for(var c=[],a=[],f=0,v=0;v<r.maxSubMeshes;v++){for(var l,d={vertexBundelIndices:[],primitiveMode:i.primitiveMode||7},g=w(s);!(l=g()).done;){var p=l.value,_=Fd[p.format],y=r.maxSubMeshVertices*_.size,m={view:{offset:f,length:y,count:0,stride:_.size},attributes:[p]},b=c.length;d.vertexBundelIndices.push(b),c.push(m),f+=y}var k=0;if(i.indices16&&i.indices16.length>0?k=2:i.indices32&&i.indices32.length>0&&(k=4),k>0){f+=iL(f,k);var A=r.maxSubMeshIndices*k,E={offset:f,length:A,count:0,stride:k};d.indexView=E,f+=A}a.push(d)}var T={info:{maxSubMeshes:r.maxSubMeshes,maxSubMeshVertices:r.maxSubMeshVertices,maxSubMeshIndices:r.maxSubMeshIndices},bounds:[]};T.bounds.length=r.maxSubMeshes;var O={struct:{vertexBundles:c,primitives:a,dynamic:T},data:new Uint8Array(f)};return n||(n=new VP),n.reset(O),n.initialize(),n.updateSubMesh(t,i),n}var rL,sL,eL,hL,uL,oL=function(){function t(){}return t.createMesh=function(t,i,n){return tL(t,i,n)},t.createDynamicMesh=function(t,i,n,r){return nL(t,i,n,r)},t.decodeMesh=function(t){return KP(t)},t.inflateMesh=function(t){return qP(t)},t}(),cL=Object.freeze({__proto__:null,MeshUtils:oL,createMesh:tL,find:jC,mapBuffer:xA,readBuffer:UA,readMesh:function(t,i){void 0===i&&(i=0);var n={positions:[]},r=new DataView(t.data.buffer,t.data.byteOffset,t.data.byteLength),s=t.struct,e=s.primitives[i];e.vertexBundelIndices.forEach((function(t){var i=s.vertexBundles[t],e=i.view.offset,h=i.view,u=h.length,o=h.stride;i.attributes.forEach((function(t){var i=aP[t.name];i&&(n[i]=(n[i]||[]).concat(UA(r,t.format,e,u,o))),e+=Fd[t.format].size}))}));var h=e.indexView;return n.indices=UA(r,Gv["R"+8*h.stride+"UI"],h.offset,h.length),n},toPPM:function(t,i,n){return"P3 "+i+" "+n+" 255\n"+t.filter((function(t,i){return i%4<3})).toString()+"\n"},writeBuffer:FA}),aL=Rr(),fL=gs(),vL=Ir.transformMat4,lL=Ir.toArray,dL=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],wL=(t("b",{UV_UPDATED:"uv_updated"}),t("c",_o("cc.SpriteFrame")((sL=function(t){function i(i){var n;return(n=t.call(this,i)||this).vertices=null,n.uv=[],n.unbiasUV=[],n.uvSliced=[],n._rect=he(),n._trimmedBorder=zs(),n._offset=Cs(),n._originalSize=ne(),n._rotated=!1,n._capInsets=[0,0,0,0],n._atlasUuid="",n._texture=void 0,n._isFlipUVY=!1,n._isFlipUVX=!1,n._original=null,n._packable=!0,n._pixelsToUnit=100,n._pivot=Cs(.5,.5),n._meshType=0,n._extrude=0,n._customOutLine=[],n._mesh=null,n._minPos=Rr(),n._maxPos=Rr(),n}e(i,t),i.createWithImage=function(t){var n=t instanceof mg?t:new mg(t),r=new f_;r.image=n;var s=new i;return s.texture=r,s};var n=i.prototype;return n.textureLoaded=function(){return!!this.texture},n.isRotated=function(){return this._rotated},n.setRotated=function(t){this.rotated=t},n.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},n.setRect=function(t){this.rect=t},n.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},n.setOriginalSize=function(t){this.originalSize=t},n.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},n.setOffset=function(t){this.offset=t},n.getGFXTexture=function(){return this._texture.getGFXTexture()},n.getGFXSampler=function(){return this._texture.getGFXSampler()},n.getHash=function(){return this._texture.getHash()},n.getSamplerInfo=function(){return this._texture.getSamplerInfo()},n.reset=function(t,i){void 0===i&&(i=!1);var n=this,r=!1;if(i&&(n._originalSize.set(0,0),n._rect.set(0,0,0,0),n._offset.set(0,0),n._capInsets=[0,0,0,0],n._rotated=!1,r=!0),t){t.texture&&(n._rect.set(0,0,t.texture.width,t.texture.height),n._refreshTexture(t.texture),n.checkRect(n._texture)),t.originalSize&&n._originalSize.set(t.originalSize),t.rect&&n._rect.set(t.rect),t.offset&&n._offset.set(t.offset);var s=n._capInsets;void 0!==t.borderTop&&(s[1]=t.borderTop),void 0!==t.borderBottom&&(s[3]=t.borderBottom),void 0!==t.borderLeft&&(s[0]=t.borderLeft),void 0!==t.borderRight&&(s[2]=t.borderRight),void 0!==t.isRotate&&(n._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(n._isFlipUVY=!!t.isFlipUv),r=!0}r&&n.texture&&n.cp(),n.fp()},n.checkRect=function(t){var i=this._rect,n=i.x,r=i.y;return this._rotated?(n+=i.height,r+=i.width):(n+=i.width,r+=i.height),n>t.width?(ht(3300,this.name+"/"+t.name,n,t.width),!1):!(r>t.height&&(ht(3301,this.name+"/"+t.name,r,t.height),1))},n.fp=function(){var t=this,i=t._originalSize.width,n=t._originalSize.height,r=.5*(i-t._rect.width),s=.5*(n-t._rect.height),e=t._offset,h=t._trimmedBorder;h.x=e.x+r,h.y=e.x-r,h.z=e.y+s,h.w=e.y-s},n.ensureMeshData=function(){this._mesh||(this._initVertices(),this._createMesh())},n.destroy=function(){return this._packable&&cP&&cP.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},n._calculateSlicedUV=function(){var t=this,i=t._rect,n=t.texture,r=t._capInsets,s=n.width,e=n.height,h=r[0],u=r[2],o=i.width-h-u,c=r[1],a=r[3],f=i.height-c-a,v=t.uvSliced;if(v.length=0,t._rotated){dL[0].u=i.x/s,dL[1].u=(i.x+a)/s,dL[2].u=(i.x+a+f)/s,dL[3].u=(i.x+i.height)/s,dL[3].v=i.y/e,dL[2].v=(i.y+h)/e,dL[1].v=(i.y+h+o)/e,dL[0].v=(i.y+i.width)/e;for(var l=0;l<4;++l)for(var d=dL[l],w=0;w<4;++w){var g=dL[3-w];v.push({u:d.u,v:g.v})}}else{dL[0].u=i.x/s,dL[1].u=(i.x+h)/s,dL[2].u=(i.x+h+o)/s,dL[3].u=(i.x+i.width)/s,dL[3].v=i.y/e,dL[2].v=(i.y+c)/e,dL[1].v=(i.y+c+f)/e,dL[0].v=(i.y+i.height)/e;for(var p=0;p<4;++p)for(var _=dL[p],y=0;y<4;++y){var m=dL[y];v.push({u:m.u,v:_.v})}}this.emit("uv_updated",this)},n.cp=function(){var t=fi,i=this,n=i._rect,r=i.uv,s=i.unbiasUV,e=i.texture,h=e.width,u=e.height;if(i._rotated){var o=0===h?0:n.x/h,c=0===h?1:(n.x+n.height)/h,a=0===u?0:n.y/u,f=0===u?1:(n.y+n.width)/u;i._isFlipUVX&&i._isFlipUVY?t(r,c,f,c,a,o,f,o,a):i._isFlipUVX?t(r,c,a,c,f,o,a,o,f):i._isFlipUVY?t(r,o,f,o,a,c,f,c,a):t(r,o,a,o,f,c,a,c,f);var v=0===h?0:n.x/h,l=0===h?1:(n.x+n.height)/h,d=0===u?0:n.y/u,w=0===u?1:(n.y+n.width)/u;i._isFlipUVX&&i._isFlipUVY?t(s,l,w,l,d,v,w,v,d):i._isFlipUVX?t(s,l,d,l,w,v,d,v,w):i._isFlipUVY?t(s,v,w,v,d,l,w,l,d):t(s,v,d,v,w,l,d,l,w)}else{var g=0===h?0:n.x/h,p=0===h?1:(n.x+n.width)/h,_=0===u?1:(n.y+n.height)/u,y=0===u?0:n.y/u;i._isFlipUVX&&i._isFlipUVY?t(r,p,y,g,y,p,_,g,_):i._isFlipUVX?t(r,p,_,g,_,p,y,g,y):i._isFlipUVY?t(r,g,y,p,y,g,_,p,_):t(r,g,_,p,_,g,y,p,y);var m=0===h?0:n.x/h,b=0===h?1:(n.x+n.width)/h,k=0===u?1:(n.y+n.height)/u,A=0===u?0:n.y/u;i._isFlipUVX&&i._isFlipUVY?t(s,b,A,m,A,b,k,m,k):i._isFlipUVX?t(s,b,k,m,k,b,A,m,A):i._isFlipUVY?t(s,m,A,b,A,m,k,b,k):t(s,m,k,b,k,m,A,b,A)}i._calculateSlicedUV()},n._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this.cp())},n._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this.cp())},n.vp=function(){var t=cP;if(t){var i=this._texture;if(i instanceof f_&&!i.isCompressed){var n=this.width,r=this.height;if(!i.image||n>t.maxFrameSize||r>t.maxFrameSize)this._packable=!1;else{var s=I.HTMLCanvasElement;i.image&&i.image instanceof s&&(this._packable=!0)}}else this._packable=!1}},n._serialize=function(){return null},n._deserialize=function(t){var i=this,n=t,r=n.rect;r&&(i._rect=new ee(r.x,r.y,r.width,r.height));var s=n.offset;n.offset&&(i._offset=Cs(s.x,s.y));var e=n.originalSize;n.originalSize&&(i._originalSize=ne(e.width,e.height)),i._rotated=!!n.rotated,i._name=n.name,i._packable=!!n.packable,i._pixelsToUnit=n.pixelsToUnit;var h=n.pivot;h&&(i._pivot=Cs(h.x,h.y)),i._meshType=n.meshType;var u=n.capInsets;if(u){var o=i._capInsets;o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3]}var c=n.vertices;if(c){i.vertices||(i.vertices={rawPosition:[],positions:[],indexes:c.indexes,uv:c.uv,nuv:c.nuv,minPos:Rr(c.minPos.x,c.minPos.y,c.minPos.z),maxPos:Rr(c.maxPos.x,c.maxPos.y,c.maxPos.z)}),i.vertices.rawPosition.length=0;for(var a=c.rawPosition,f=0;f<a.length;f+=3)i.vertices.rawPosition.push(Rr(a[f],a[f+1],a[f+2]));i._updateMeshVertices()}},n.clone=function(){var t,n,r,s,e,h=this,u=new i,o=h.vertices;return u.vertices=o?{rawPosition:o.rawPosition.slice(0),positions:o.positions.slice(0),indexes:o.indexes.slice(0),uv:o.uv.slice(0),nuv:o.nuv.slice(0),minPos:o.minPos.clone(),maxPos:o.maxPos.clone()}:null,(t=u.uv).splice.apply(t,[0,u.uv.length].concat(h.uv)),(n=u.unbiasUV).splice.apply(n,[0,u.unbiasUV.length].concat(h.unbiasUV)),(r=u.uvSliced).splice.apply(r,[0,u.uvSliced.length].concat(h.uvSliced)),u._rect.set(h._rect),u._trimmedBorder.set(h._trimmedBorder),u._offset.set(h._offset),u._originalSize.set(h._originalSize),u._rotated=h._rotated,(s=u._capInsets).splice.apply(s,[0,u._capInsets.length].concat(h._capInsets)),u._atlasUuid=h._atlasUuid,u._texture=h._texture,u._isFlipUVX=h._isFlipUVX,u._isFlipUVY=h._isFlipUVY,h._original?u._original={_texture:h._original._texture,_x:h._original._x,_y:h._original._y}:u._original=null,u._packable=h._packable,u._pixelsToUnit=h._pixelsToUnit,u._pivot.set(h._pivot),u._meshType=h._meshType,u._extrude=h._extrude,(e=u._customOutLine).splice.apply(e,[0,u._customOutLine.length].concat(h._customOutLine)),u._minPos=h._minPos,u._maxPos=h._maxPos,h._mesh&&u._createMesh(),u},n._refreshTexture=function(t){var i=this;i._texture=t;var n=i._texture,r={},s=!1;0!==i._rect.width&&0!==i._rect.height&&i.checkRect(n)||(r.rect=he(0,0,n.width,n.height),s=!0),(0===i._originalSize.width||0===i._originalSize.height||s)&&(r.originalSize=ne(n.width,n.height),s=!0),s&&i.reset(r),i.vp(),i._mesh&&i._updateMesh()},n.onLoaded=function(){this.fp()},n.initDefault=function(i){t.prototype.initDefault.call(this,i);var n=new f_;n.initDefault(),this._refreshTexture(n),this.cp()},n.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},n._initVertices=function(){var t=this;if(t.vertices){var i=t.vertices;i.rawPosition.length=0,i.positions.length=0,i.indexes.length=0,i.uv.length=0,i.nuv.length=0,i.minPos.set(0,0,0),i.maxPos.set(0,0,0)}else t.vertices={rawPosition:[],positions:[],indexes:[],uv:[],nuv:[],minPos:Rr(),maxPos:Rr()};var n=t.vertices;if(1===t._meshType);else{var r=t.texture,s=r.width,e=r.height,h=t.rect,u=h.width,o=h.height,c=h.x,a=e-h.y-o,f=u/2,v=o/2,l=0===s?0:c/s,d=0===s?1:(c+u)/s,w=0===e?1:(a+o)/e,g=0===e?0:a/e,p=n.uv,_=n.nuv,y=n.rawPosition,m=n.indexes;aL.set(-f,-v,0),y.push(aL.clone()),p.push(c,a+o),_.push(l,g),n.minPos.set(aL),aL.set(f,-v,0),y.push(aL.clone()),p.push(c+u,a+o),_.push(d,g),aL.set(-f,v,0),y.push(aL.clone()),p.push(c,a),_.push(l,w),aL.set(f,v,0),y.push(aL.clone()),p.push(c+u,a),_.push(d,w),n.maxPos.set(aL),m.push(0,1,2,2,1,3)}this._updateMeshVertices()},n._updateMeshVertices=function(){fL.identity();var t=1/this._pixelsToUnit,i=Rr(-(this._pivot.x-.5)*this.rect.width*t,-(this._pivot.y-.5)*this.rect.height*t,0);fL.transform(i),i.set(t,t,1),fL.scale(i);for(var n=this.vertices,r=0;r<n.rawPosition.length;r++){var s=n.rawPosition[r];vL(i,s,fL),lL(n.positions,i,3*r)}vL(this._minPos,n.minPos,fL),vL(this._maxPos,n.maxPos,fL)},n._createMesh=function(){this._mesh=tL({primitiveMode:7,positions:this.vertices.positions,uvs:this.vertices.nuv,indices:this.vertices.indexes,minPos:this._minPos,maxPos:this._maxPos,attributes:[new ud("a_position",32),new ud("a_texCoord",21)]})},n._updateMesh=function(){this._mesh&&this._mesh.destroy(),this._initVertices(),this._createMesh()},r(i,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this.cp(),this.fp())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this.cp(),this.fp())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this.fp()}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this.cp())}},{key:"texture",get:function(){return this._texture},set:function(t){t?t!==this._texture&&this.reset({texture:t},!0):st(3122,this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){globalThis.Build?this._texture=t:t&&(this._refreshTexture(t),this.cp())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this.cp()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this.cp()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}},{key:"pixelsToUnit",get:function(){return this._pixelsToUnit}},{key:"pivot",get:function(){return this._pivot}},{key:"mesh",get:function(){return this._mesh}},{key:"trimmedBorder",get:function(){return this._trimmedBorder}}]),i}(rg),sL.EVENT_UV_UPDATED="uv_updated",sL.MeshType={RECT:0,POLYGON:1},rL=sL))||rL));T.SpriteFrame=wL;var gL,pL=t("a",_o("cc.SpriteAtlas")((hL=function(t){function i(i){var n;return(n=t.call(this,i)||this).spriteFrames=uL&&uL(),n}e(i,t);var n=i.prototype;return n.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var i=this.spriteFrames[t[0]];return i&&i.texture}return null},n.getSpriteFrame=function(t){var i=this.spriteFrames[t];return i?(i.name||(i.name=t),i):null},n.getSpriteFrames=function(){var t=[],i=this.spriteFrames;for(var n in i)t.push(i[n]);return t},n._serialize=function(){return null},n._deserialize=function(t,i){var n=t;this._name=n.name;var r=n.spriteFrames;this.spriteFrames=It();for(var s=0;s<r.length;s+=2)i.result.push(this.spriteFrames,r[s],r[s+1],ni(wL))},i}(rg),uL=uo(hL.prototype,"spriteFrames",[Co],(function(){return It()})),eL=hL))||eL);T.SpriteAtlas=pL;var _L,yL,mL,bL=t("F",_o("cc.Font")(gL=function(t){function i(i){return t.call(this,i)||this}return e(i,t),i}(rg))||gL);T.Font=bL;var kL=t("T",_o("cc.TTFFont")((yL=function(t){function i(){var i;return(i=t.call(this)||this)._fontFamily=mL&&mL(),i}return e(i,t),i.prototype.initDefault=function(i){this._fontFamily="Arial",t.prototype.initDefault.call(this,i)},r(i,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:Yf(this._native),__isNative__:!0}}}]),i}(bL),mL=uo(yL.prototype,"_fontFamily",[Co],(function(){return null})),y(yL.prototype,"_nativeAsset",[ac,tc],Object.getOwnPropertyDescriptor(yL.prototype,"_nativeAsset"),yL.prototype),y(yL.prototype,"_nativeDep",[ac],Object.getOwnPropertyDescriptor(yL.prototype,"_nativeDep"),yL.prototype),_L=yL))||_L);T.TTFFont=kL;var AL={},EL=t("u",.26),TL=0,OL=t("v",(EL+1)/2-EL);function SL(){return TL}var IL=new ri(2);IL.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var RL=t("x",function(){function t(t){this.lp=0,this.dp=0,this.wp={},this.gp=null,this.pp=null,this.dp=t}var i=t.prototype;return i.moveToHead=function(t){t.next=this.gp,t.prev=null,this.gp&&(this.gp.prev=t),this.gp=t,this.pp||(this.pp=t),this.lp++,this.wp[t.key]=t},i.put=function(t,i){var n=IL.get();if(n.key=t,n.value=i,this.lp>=this.dp){var r=this.pp;delete this.wp[r.key],this.lp--,this.pp=r.prev,this.pp.next=null,r.prev=null,r.next=null,IL.put(r)}this.moveToHead(n)},i.remove=function(t){t.prev?t.prev.next=t.next:this.gp=t.next,t.next?t.next.prev=t.prev:this.pp=t.prev,delete this.wp[t.key],this.lp--},i.get=function(t){var i=this.wp[t];return i?(this.remove(i),this.moveToHead(i),i.value):null},i.clear=function(){this.lp=0,this.wp={},this.gp=null,this.pp=null},i.has=function(t){return!!this.wp[t]},i.delete=function(t){var i=this.wp[t];this.remove(i)},t}()),ML=new RL(100),CL=/([a-zA-Z0-9--]+|\S)/,NL=/^[!,.:;'}\]%\?>]/,PL="[a-zA-Z0-9--iI]",LL=new RegExp("("+PL+"+|\\S)$"),DL=new RegExp(PL+"+$"),BL=new RegExp("^"+PL);function FL(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function UL(t){var i=t.charCodeAt(0);return i>=9&&i<=13||32===i||133===i||160===i||5760===i||i>=8192&&i<=8202||8232===i||8233===i||8239===i||8287===i||12288===i}function xL(t,i,n){var r=(n||t.font)+""+i,s=ML.get(r);if(null!==s)return s;var e=t.measureText(i),h=e&&e.width||0;return ML.put(r,h),h}function GL(t){for(var i=t.length,n=0,r=0,s=0;s<i;s++)8205!==(r=t.charCodeAt(s))&&(r>=55296&&r<=56319&&(r=t.charCodeAt(s+1))>=56320&&r<=57343?((s+2>=i||8205!==t.charCodeAt(s+2))&&n++,s++):n++);return n}function jL(t,i){for(var n=t.length,r=0,s=0,e=0,h=0,u=0;u<n;u++)if(8205!==(h=t.charCodeAt(u)))if(h>=55296&&h<=56319&&(r++,(h=t.charCodeAt(u+1))>=56320&&h<=57343)){if(r++,u+2>=n||8205!==t.charCodeAt(u+2)){if(i===s)return t.slice(e,e+r);e+=r,s++,r=0}u++}else{if(i===s)return t.charAt(u);e=u+1,s++,r=0}else r++;return""}function HL(t,i){var n=jL(t,i);if(1===n.length)return""+n.charCodeAt(0);for(var r="",s=0;s<n.length;s++)r+=""+n.charCodeAt(s);return""+r}function VL(t,i){if(i>=t.length)return t.length;for(var n=i,r=t[n];n>=0&&(""===r&&(r=t[--n]),r>="\udc00"&&r<="\udfff"&&n-1>=0&&(r=t[--n]),r>="\ud800"&&r<="\udbff")&&n-1>=0&&""===t[n-1];)r=t[--n];return n}function $L(t,i){for(var n=i,r=i,s=t[r];r<t.length;)if(""===s&&(n++,(s=t[++r])>="\ud800"&&s<="\udbff"&&(n++,s=t[++r])),s>="\ud800"&&s<="\udbff")n++,s=t[++r];else{if(!(s>="\udc00"&&s<="\udfff"))break;if(s=t[++r],!(r<t.length&&""===t[r]))break;n++,s=t[r]}return n}function zL(t,i,n){var r=VL(t,i);r<i&&(r=$L(t,i)+1);var s=n;if(void 0!==n){s=$L(t,n=Math.max(0,n-1));var e=VL(t,n);e<r||e===r&&i>r?s=r:s+=1}return t.substring(r,s)}function WL(t){return BL.exec(t)}function XL(t){return DL.exec(t)}function YL(t,i,n,r){var s=[];if(0===t.length||n<0)return s.push(""),s;for(var e=t;i>n&&e.length>1;){for(var h=e.length*(n/i)|0,u=zL(e,h),o=i-r(u),c=u,a=0,f=0;o>n&&f++<100;)h*=n/o,o=i-r(u=zL(e,h|=0));for(f=0;u&&o<=n&&f++<100;){var v=CL.exec(u);c=u,o=i-r(u=zL(e,h+=a=v?v[0].length:1))}0==(h-=a)?(h=1,c=zL(e,1)):1===h&&e[0]>="\ud800"&&e[0]<="\udbff"&&(h=2,c=zL(e,2));var l=zL(e,0,h),d=void 0;NL.test(c||u)&&(0==(h-=(d=LL.exec(l))?d[0].length:0)&&(h=1),c=zL(e,h),l=zL(e,0,h)),BL.test(c)&&(d=DL.exec(l))&&l!==d[0]&&(c=zL(e,h-=d[0].length),l=zL(e,0,h)),(0===s.length||(l=l.trim()).length>0)&&s.push(l),i=r(e=c||u)}return(0===s.length||(e=e.trim()).length>0)&&s.push(e),s}var KL,qL=I.document,QL=null,JL=-1,ZL="BES bswy:->@123",tD=Object.create(null),iD=[],nD=3e3,rD=function(){if(void 0===KL)if("FontFace"in I){var t=/Gecko.*Firefox\/(\d+)/.exec(I.navigator.userAgent),i=/OS X.*Version\/10\..*Safari/.exec(I.navigator.userAgent)&&/Apple/.exec(I.navigator.vendor);KL=t?parseInt(t[1],10)>42:!i}else KL=!1;return KL};function sD(){for(var t=!0,i=Date.now(),n=iD.length-1;n>=0;n--){var r=iD[n],s=r.fontFamilyName;if(i-r.startTime>nD)st(4933,s),r.onComplete(null,s),iD.splice(n,1);else{var e=r.refWidth,h="40px "+s;QL.font=h,e!==xL(QL,ZL,h)?(iD.splice(n,1),r.onComplete(null,s)):t=!1}}t&&(clearInterval(JL),JL=-1)}function eD(t,i,n){var r=hD(t);if(tD[r])n(null,r);else{if(!QL){var s=qL.createElement("canvas");s.width=100,s.height=100,QL=s.getContext("2d")}var e="40px "+r,h=qL.createElement("style");h.type="text/css";var u="";Number.isNaN(r)?u+="@font-face { font-family:"+r+"; src:":u+='@font-face { font-family:"'+r+'"; src:',u+='url("'+t+'");',h.textContent=u+"}",qL.body.appendChild(h);var o,c,a,f,v,l,d=qL.createElement("div"),w=d.style;if(w.fontFamily=r,d.innerHTML=".",w.position="absolute",w.left="-100px",w.top="-100px",qL.body.appendChild(d),rD())o=Date.now(),c=r,a=n,f=new Promise((function(t,i){!function n(){Date.now()-o>=nD?i():qL.fonts.load("40px "+c).then((function(i){i.length>=1?t():setTimeout(n,100)}),(function(){i()}))}()})),v=null,l=new Promise((function(t,i){v=setTimeout(i,nD)})),Promise.race([l,f]).then((function(){v&&(clearTimeout(v),v=null),a(null,c)}),(function(){st(4933,c),a(null,c)}));else{var g={fontFamilyName:r,refWidth:xL(QL,ZL,e),onComplete:n,startTime:Date.now()};iD.push(g),-1===JL&&(JL=setInterval(sD,100))}tD[r]=h}}function hD(t){var i=t.lastIndexOf(".ttf");if(-1===i)return t;var n,r=t.lastIndexOf("/");return-1!==(n=-1===r?t.substring(0,i)+"_LABEL":t.substring(r+1,i)+"_LABEL").indexOf(" ")&&(n='"'+n+'"'),n}function uD(t,i,n,r){var s=new kL;s._nativeUrl=t,s._nativeAsset=i,r(null,s)}Yb.register({".font":eD,".eot":eD,".ttf":eD,".woff":eD,".svg":eD,".ttc":eD}),uk.register({".font":uD,".eot":uD,".ttf":uD,".woff":uD,".svg":uD,".ttc":uD});var oD,cD,aD,fD,vD,lD,dD,wD,gD,pD=/^(click)(\s)*=|(param)(\s)*=/,_D=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,yD=t("t",function(){function t(){this._p=[],this.yp=[],this.mp=[],this._p.push([/&lt;/g,"<"]),this._p.push([/&gt;/g,">"]),this._p.push([/&amp;/g,"&"]),this._p.push([/&quot;/g,'"']),this._p.push([/&apos;/g,"'"])}var i=t.prototype;return i.parse=function(t){this.mp.length=0,this.yp.length=0;for(var i=0,n=t.length;i<n;){var r=t.indexOf(">",i),s=-1;if(r>=0&&(s=t.lastIndexOf("<",r))<i-1&&(s=t.indexOf("<",r+1),r=t.indexOf(">",s+1)),s<0)this.yp.pop(),this.bp(t.substring(i)),i=n;else{var e=t.substring(i,s),h=t.substring(s+1,r);""===h&&(e=t.substring(i,r+1)),this.bp(e),-1===r?r=s:"/"===t.charAt(s+1)?this.yp.pop():this.kp(h),i=r+1}}return this.mp},i.Ap=function(t){t=t.trim();var i={},n=/^(color|size)(\s)*=/.exec(t),r="",s=0,e="";if(n){if(r=n[0],""===(t=t.substring(r.length).trim()))return i;switch(s=t.indexOf(" "),r[0]){case"c":i.color=s>-1?t.substring(0,s).trim():t;break;case"s":i.size=parseInt(t)}return s>-1&&(e=t.substring(s+1).trim(),i.event=this.Ep(e)),i}if((n=/^(br(\s)*\/)/.exec(t))&&n[0].length>0&&(r=n[0].trim()).startsWith("br")&&"/"===r[r.length-1])return i.isNewLine=!0,this.mp.push({text:"",style:{isNewLine:!0}}),i;var h="",u=-1;if((n=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&n[0].length>0&&(r=n[0].trim()).startsWith("img")&&"/"===r[r.length-1]){var o;n=_D.exec(t);for(var c=!1;n;){var a=(r=(t=t.substring(t.indexOf(n[0]))).substring(0,n[0].length)).length;if(r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),h=t.substring(a).trim(),u="src"===r?this.Tp(h):-1,o=(s=h.indexOf(" ",u+1>=h.length?-1:u+1))>-1?h.substring(0,s):h,t=h.substring(s).trim(),o.endsWith("/")&&(o=o.slice(0,-1)),"src"===r){switch(o.charCodeAt(0)){case 34:case 39:c=!0,o=o.slice(1,-1)}i.isImage=!0,i.src=o}else if("height"===r)i.imageHeight=parseInt(o);else if("width"===r)i.imageWidth=parseInt(o);else if("align"===r){switch(o.charCodeAt(0)){case 34:case 39:o=o.slice(1,-1)}i.imageAlign=o.toLowerCase()}else"offset"===r?i.imageOffset=o:"click"===r&&(i.event=this.Ep(r+"="+o));i.event&&"param"===r&&(i.event[r]=o.replace(/^"|"$/g,"")),n=_D.exec(t)}return c&&i.isImage&&this.mp.push({text:"",style:i}),{}}if(n=/^(outline(\s)*[^>]*)/.exec(t)){var f={color:"#ffffff",width:1};if(t=n[0].substring(7).trim()){var v,l=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(n=l.exec(t);n;)r=(t=t.substring(t.indexOf(n[0]))).substring(0,n[0].length),v=(s=(h=t.substring(r.length).trim()).indexOf(" "))>-1?h.substring(0,s):h,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=h.substring(s).trim(),"click"===r?i.event=this.Ep(r+"="+v):"color"===r?f.color=v:"width"===r&&(f.width=parseInt(v)),i.event&&"param"===r&&(i.event[r]=v.replace(/^"|"$/g,"")),n=l.exec(t)}i.outline=f}if((n=/^(on|u|b|i)(\s)*/.exec(t))&&n[0].length>0){switch(r=n[0],t=t.substring(r.length).trim(),r[0]){case"u":i.underline=!0;break;case"i":i.italic=!0;break;case"b":i.bold=!0}if(""===t)return i;i.event=this.Ep(t)}return i},i.Tp=function(t){var i=-1,n=-1,r=t.indexOf("'"),s=t.indexOf('"'),e=s>-1&&(s<r||-1===r);return r>-1&&(r<s||-1===s)?(i=r,n=t.indexOf("'",i+1>=t.length?-1:i+1)):e&&(i=s,n=t.indexOf('"',i+1>=t.length?-1:i+1)),n},i.Ep=function(t){for(var i={},n=0,r=!1,s=pD.exec(t);s;){var e=s[0],h="";if(r=!1,'"'===(t=t.substring(e.length).trim()).charAt(0))(n=t.indexOf('"',1))>-1&&(h=t.substring(1,n).trim(),r=!0),n++;else if("'"===t.charAt(0))(n=t.indexOf("'",1))>-1&&(h=t.substring(1,n).trim(),r=!0),n++;else{var u=/(\S)+/.exec(t);n=(h=u?u[0]:"").length}r&&(i[e=e.substring(0,e.length-1).trim()]=h),t=t.substring(n).trim(),s=pD.exec(t)}return i},i.kp=function(t){var i=this.Ap(t);if(0===this.yp.length)this.yp.push(i);else{if(i.isNewLine||i.isImage)return;var n=this.yp[this.yp.length-1];for(var r in n)i[r]||(i[r]=n[r]);this.yp.push(i)}},i.bp=function(t){0!==t.length&&(t=this.Op(t),this.yp.length>0?this.mp.push({text:t,style:this.yp[this.yp.length-1]}):this.mp.push({text:t}))},i.Op=function(t){for(var i,n=w(this._p);!(i=n()).done;){var r=i.value,s=r[0],e=r[1];t=t.replace(s,e)}return t},t}()),mD=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},bD=function(){function t(t){this.letterDefinitions={},this._texture=null,this.texture=t}var i=t.prototype;return i.addLetterDefinitions=function(t,i){this.letterDefinitions[t]=i},i.cloneLetterDefinition=function(){var t={};for(var i in this.letterDefinitions){var n=new mD;xt(n,this.letterDefinitions[i]),t[i]=n}return t},i.getTexture=function(){return this._texture},i.getLetter=function(t){return this.letterDefinitions[t]},i.getLetterDefinitionForChar=function(t){var i=HL(t,0),n=null;return Object.prototype.hasOwnProperty.call(this.letterDefinitions,i)&&(n=this.letterDefinitions[i]),n},i.clear=function(){this.letterDefinitions={}},r(t,[{key:"texture",get:function(){return this._texture},set:function(t){var i=this._texture;i!==t&&(i&&(i.decRef(!1),i.refCount<=0&&i.destroy()),t&&t.addRef(),this._texture=t)}}]),t}(),kD=t("B",(oD=_o("cc.BitmapFont"),cD=ic(wL),oD((fD=function(t){function i(){var i;return(i=t.call(this)||this).fntDataStr=vD&&vD(),i.spriteFrame=lD&&lD(),i.fontSize=dD&&dD(),i.fntConfig=wD&&wD(),i}return e(i,t),i.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new bD(t.texture));var i=this.fntConfig;if(i){var n=i.fontDefDictionary;for(var r in n){var s=n[r],e=new mD,h=s.rect;e.offsetX=s.xOffset,e.offsetY=s.yOffset,e.w=h.width,e.h=h.height,e.u=h.x,e.v=h.y,e.valid=!0,e.xAdvance=s.xAdvance,this.fontDefDictionary.addLetterDefinitions(r,e)}}else st(16376)},i}(bL),vD=uo(fD.prototype,"fntDataStr",[Co],(function(){return""})),lD=uo(fD.prototype,"spriteFrame",[cD],(function(){return null})),dD=uo(fD.prototype,"fontSize",[Co],(function(){return-1})),wD=uo(fD.prototype,"fntConfig",[Co],(function(){return null})),aD=fD))||aD));T.BitmapFont=kD;var AD,ED=t("L",_o("cc.LabelAtlas")(gD=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(kD))||gD);T.LabelAtlas=ED;var TD=function(){function t(){this.Sp=[]}t.Ip=function(){return AD||(AD=new t),AD};var i=t.prototype;return i.ci=function(){var t=this.Sp.pop();if(!t){var i=I.document.createElement("canvas"),n=i.getContext("2d");t={canvas:i,context:n}}return t},i.fi=function(t){this.Sp.length>=Si.MAX_LABEL_CANVAS_POOL_SIZE||this.Sp.push(t)},t}(),OD=Qs.WHITE.clone(),SD="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",ID=SL(),RD=function(){function t(t,i){this.image=null,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.char=t,this.labelInfo=i,this.hash=""+HL(t,0)+i.hash}var i=t.prototype;return i.updateRenderData=function(){this.Rp(),this.Mp()},i.destroy=function(){this.image=null,TD.Ip().fi(this.data),this.data=null},i.Rp=function(){if(this.data=TD.Ip().ci(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){var t=this.labelInfo.fontScale;this.context.font=this.labelInfo.fontDesc;var i=xL(this.context,this.char,this.labelInfo.fontDesc),n=2*this.labelInfo.margin+2;this.width=parseFloat(i.toFixed(2))*t+n,this.height=(1+EL)*this.labelInfo.fontSize*t+n,this.offsetY=-this.labelInfo.fontSize*EL*t/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new mg),this.image.reset(this.canvas)},i.Mp=function(){if(this.context&&this.canvas){var t=this.context,i=this.labelInfo,n=this.canvas.width,r=this.canvas.height,s=i.fontScale;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,n,r),t.fillStyle=SD,t.fillRect(0,0,n,r),t.font=i.fontDesc.replace(/(\d+)(\.\d+)?(px|em|rem|pt)/g,(function(t,i,n,r){return(+i*s+(+n||0)*s).toString()+r}));var e=i.fontSize*s,h=n/2,u=r/2+e*OL+e*ID,o=i.color;if(t.lineJoin="round",t.fillStyle="rgba("+o.r+", "+o.g+", "+o.b+", 1)",i.isOutlined){var c=i.out||OD;t.strokeStyle="rgba("+c.r+", "+c.g+", "+c.b+", "+c.a/255+")",t.lineWidth=2*i.margin*s,t.strokeText(this.char,h,u)}t.fillText(this.char,h,u)}},t}(),MD=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.initWithSize=function(t,i,n){void 0===n&&(n=35),this.reset({width:t,height:i,format:n})},n.drawTextureAt=function(t,i,n){var r=this.getGFXTexture();if(t&&r){var s=this._getGFXDevice();if(s){var e=new Fl;e.texOffset.x=i,e.texOffset.y=n,e.texExtent.width=t.width,e.texExtent.height=t.height,s.copyTexImagesToTexture([t.data],r,[e])}else st(16363)}},i}(f_),CD=function(){function t(t,i){this.Re=0,this.Me=0,this.Ce=0,this.Xn=0,this.Yn=0,this.Cp=0,this.Np=!1;var n=new MD;n.initWithSize(t,i),this.fontDefDictionary=new bD(n),this.Cp=1,this.Xn=t,this.Yn=i,xN.on("director_before_scene_launch",this.beforeSceneLoad,this)}var i=t.prototype;return i.insertLetterTexture=function(t){var i=t.image,n=xN.root.device;if(!i||!this.fontDefDictionary||!n)return null;var r=i.width,s=i.height;if(this.Re+r+0>this.Xn&&(this.Re=0,this.Me=this.Ce),this.Me+s>this.Ce&&(this.Ce=this.Me+s+0),this.Ce>this.Yn)return st(12100),null;if(!this.fontDefDictionary.texture)return null;this.fontDefDictionary.texture.drawTextureAt(i,this.Re,this.Me),this.Np=!0;var e=new mD;return e.u=this.Re+this.Cp,e.v=this.Me+this.Cp,e.valid=!0,e.w=t.width-2,e.h=t.height-2,e.xAdvance=e.w,e.offsetY=t.offsetY,this.Re+=r+0,this.fontDefDictionary.addLetterDefinitions(t.hash,e),e},i.update=function(){this.Np&&(this.Np=!1)},i.reset=function(){this.Re=0,this.Me=0,this.Ce=0,this.fontDefDictionary.clear()},i.destroy=function(){this.reset();var t=this.fontDefDictionary;t&&t.texture&&(t.texture=null)},i.getTexture=function(){return this.fontDefDictionary.getTexture()},i.beforeSceneLoad=function(){this.clearAllCache()},i.clearAllCache=function(){this.destroy();var t=new MD;t.initWithSize(this.Xn,this.Yn),this.fontDefDictionary.texture=t},i.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},i.getLetterDefinitionForChar=function(t,i){var n=HL(t,0)+i.hash,r=this.fontDefDictionary.letterDefinitions[n];if(!r){var s=new RD(t,i);s.updateRenderData(),r=this.insertLetterTexture(s),s.destroy()}return r},r(t,[{key:"width",get:function(){return this.Xn}},{key:"height",get:function(){return this.Yn}}]),t}(),ND={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:Qs.WHITE.clone(),isOutlined:!1,out:Qs.WHITE.clone(),margin:0,fontScale:1};function PD(t){var i=t.color.toHEX(),n="";return t.isOutlined&&t.margin>0&&(n=n+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+i+n}var LD="a_position",DD="a_color",BD="a_texCoord",FD="a_color2",UD=[new ud(LD,32)],xD=[new ud(LD,32),new ud(DD,44)],GD=[new ud(LD,32),new ud(BD,21),new ud(DD,44)],jD=[new ud(LD,32),new ud(BD,21),new ud(DD,35,!0)],HD=[new ud(LD,32),new ud(BD,21),new ud(DD,44),new ud(FD,44)],VD=[new ud(LD,32),new ud(BD,21),new ud(DD,35,!0),new ud(FD,35,!0)];function $D(t){for(var i=0,n=0;n<t.length;n++){var r=t[n];i+=Fd[r.format].count}return i}function zD(t){for(var i=0,n=0;n<t.length;n++){var r=t[n];i+=Fd[r.format].size}return i}T.internal.vfmtPosUvColor=GD,T.internal.vfmtPosUvTwoColor=HD,T.internal.vfmtPosUvColor4B=jD,T.internal.vfmtPosUvTwoColor4B=VD;var WD=t("M",function(){var t=i.prototype;function i(){this._byteOffset=0,this._vertexOffset=0,this._indexOffset=0,this._dirty=!1,this._floatsPerVertex=0,this._vData=null,this._iData=null,this.Pp=0,this.Lp=0,this.Dp=0,this.Kn=null,this.Bp=[],this.eu=null,this.Fp=0}return t.initSharedBuffer=function(){},t.syncSharedBufferToNative=function(){},t.initialize=function(t,i,n,r){this.Lp=n,this.Dp=r,this.Kn=i,this.floatsPerVertex=zD(i)>>2,this.Lp,this._floatsPerVertex,at(9005),this.vData&&this.iData||(this.vData=new Float32Array(this.Lp),this.iData=new Uint16Array(this.Dp)),this.Bp.push(this.Up(t))},t.reset=function(){this.Fp=0,this.dirty=!1},t.destroy=function(){this.reset(),this.Kn=null,this.eu=null,this.vData=null,this.iData=null;for(var t=0;t<this.Bp.length;++t){var i=this.Bp[t],n=i.vertexBuffers[0];n&&n.destroy();var r=i.indexBuffer;r&&r.destroy(),i.ia.destroy()}this.Bp.length=0},t.setDirty=function(){this.dirty=!0},t.request=function(){return st(9002),!1},t.requireFreeIA=function(t){return this.Bp.length<=this.Fp&&this.Bp.push(this.Up(t)),this.Bp[this.Fp++].ia},t.recycleIA=function(t){for(var i=this.Bp,n=0;n<this.Fp;++n)if(t===i[n].ia){var r=i[n];return i[n]=i[--this.Fp],void(i[this.Fp]=r)}},t.checkCapacity=function(t,i){var n=(this.vertexOffset+t)*this._floatsPerVertex,r=this.indexOffset+i;return!(n>this.Lp||r>this.Dp)},t.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=bh.$t,i=t?this.Fp:1;if(t&&i/this.Bp.length<.5){for(var n=i/.5,r=this.Bp.length-1;r>=n;r--){var s=this.Bp[r];s.vertexBuffers[0]&&s.vertexBuffers[0].destroy(),s.indexBuffer&&s.indexBuffer.destroy(),s.ia.destroy()}this.Bp.length=n}for(var e=this.byteOffset,h=this.indexOffset,u=0;u<i;++u){var o=this.Bp[u],c=new Float32Array(this.vData.buffer,0,e>>2),a=new Uint16Array(this.iData.buffer,0,h),f=o.vertexBuffers[0];e>f.size&&f.resize(e),f.update(c),2*h>o.indexBuffer.size&&o.indexBuffer.resize(2*h),o.indexBuffer.update(a)}this.dirty=!1}},t.Up=function(t){var i,n,r;if(bh.$t||!this.Bp[0]){var s=this.Pp=4*this._floatsPerVertex,e=t.createBuffer(new $l(10,3,s,s));r=t.createBuffer(new $l(6,3,2,2)),n=[e],this.eu=new cd(this.Kn,n,r),i=t.createInputAssembler(this.eu)}else i=t.createInputAssembler(this.eu),n=this.eu.vertexBuffers,r=this.eu.indexBuffer;return{ia:i,vertexBuffers:n,indexBuffer:r}},r(i,[{key:"attributes",get:function(){return this.Kn}},{key:"vertexFormatBytes",get:function(){return this.Pp}},{key:"byteOffset",get:function(){return this._byteOffset},set:function(t){this._byteOffset=t}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(t){this._vertexOffset=t}},{key:"indexOffset",get:function(){return this._indexOffset},set:function(t){this._indexOffset=t}},{key:"dirty",get:function(){return this._dirty},set:function(t){this._dirty=t}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex},set:function(t){this._floatsPerVertex=t}},{key:"vData",get:function(){return this._vData},set:function(t){this._vData=t}},{key:"iData",get:function(){return this._iData},set:function(t){this._iData=t}},{key:"nativeObj",get:function(){return this._nativeObj}},{key:"sharedBuffer",get:function(){return this._sharedBuffer}}]),i}()),XD=function(){function t(t,i){this._buffers=[],this._device=t,this._attributes=i,this._floatsPerVertex=zD(i)>>2,this._vertexFormatBytes=4*this._floatsPerVertex}var i=t.prototype;return i.initialize=function(){},i.reset=function(){},i.request=function(){},i.appendBuffers=function(){},i.uploadBuffers=function(){},i.destroy=function(){this._attributes.length=0},r(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t}(),YD=new xe((function(){return{offset:0,length:0}}),32),KD=function(){function t(t,i,n,r,s,e){this.vertexAccessor=t,this.bufferId=i,this.meshBuffer=n,this.vertexOffset=r,this.vb=s,this.indexCount=e,t.getMeshBuffer(i)}return t.prototype.setIndexBuffer=function(){},r(t,[{key:"ib",get:function(){return this.xp}}]),t}(),qD=function(t){function i(n,r,s,e){var h;return(h=t.call(this,n,r)||this).Gp=[],h.jp=0,h.Hp=0,h.ps=0,h.jp=s||Math.floor(1024*Si.BATCHER2D_MEM_INCREMENT/h._vertexFormatBytes),h.Hp=e||h.jp*i.IB_SCALE,h.ps=i.generateID(),h.Vp(),h}e(i,t);var n=i.prototype;return n.destroy=function(){for(var i=0;i<this._buffers.length;++i){this._buffers[i].destroy();for(var n=this.Gp[i],r=0;r<n.length;++r)YD.free(n[r])}this._buffers.length=0,this.Gp.length=0,t.prototype.destroy.call(this)},n.reset=function(){for(var t=0;t<this._buffers.length;++t){var i=this._buffers[t];i.indexOffset=0,i.reset()}},n.getVertexBuffer=function(t){return this._buffers[t].vData},n.getIndexBuffer=function(t){return this._buffers[t].iData},n.getMeshBuffer=function(t){return this._buffers[t]},n.uploadBuffers=function(){for(var t=0;t<this._buffers.length;++t){var i=this.Gp[t][0],n=this._buffers[t];(!i||i.length<n.vData.byteLength)&&n.uploadBuffers()}},n.appendIndices=function(t,i){var n=this._buffers[t];if(i.length){var r=n.indexOffset+i.length;if(n.iData.length<r){var s=Math.floor(1.25*r),e=new Uint16Array(s);e.set(n.iData),n.iData=e}n.iData.set(i,n.indexOffset),n.indexOffset+=i.length}},n.allocateChunk=function(t,i){var n=t*this.vertexFormatBytes;if(t>this.jp||i>this.Hp)return ht(9004,n),null;for(var r,s=null,e=0,h=-1,u=null,o=0;o<this._buffers.length;++o){s=this._buffers[o],r=this.Gp[o];for(var c=0;c<r.length;++c)if(r[c].length>=n){u=r[c],e=o,h=c;break}if(u)break}if(u||(e=this.Vp(),(s=this._buffers[e])&&(h=0,u=this.Gp[e][h])),u){var a=u.offset/this.vertexFormatBytes,f=new Float32Array(s.vData.buffer,u.offset,n>>2).fill(0);return this.$p(e,h,u,n),new KD(this,e,s,a,f,i)}return null},n.recycleChunk=function(t){var i=this.Gp[t.bufferId],n=this._buffers[t.bufferId],r=t.vertexOffset*this.vertexFormatBytes,s=t.vb.byteLength;if(0!==s){for(var e=!1,h=0,u=null,o=i[h];o&&o.offset<r;)u=o,o=i[++h];if(u&&0==r-(u.offset+u.length)&&(u.length+=s,r=u.offset,s=u.length,o&&o.offset-(r+s)==0&&(u.length+=o.length,i.splice(h,1),YD.free(o),o=null),e=!0),!e&&o){if(0==o.offset-(r+s))o.offset=r,o.length+=s;else{var c=YD.alloc();c.offset=r,c.length=s,i.splice(h,0,c)}e=!0}if(e)r+s===n.byteOffset&&(n.byteOffset=r);else{var a=YD.alloc();a.offset=r,a.length=s,i.push(a)}}},n.$p=function(t,i,n,r){var s=n.length-r,e=n.offset+r,h=this._buffers[t];h.byteOffset<e&&(h.byteOffset=e),ot(s>=0,9004,t,n.offset,n.length),0===s?(this.Gp[t].splice(i,1),YD.free(n)):(n.offset+=r,n.length=s)},n.Vp=function(){ot(this._buffers.length===this.Gp.length,9003);var t=new WD,i=this.jp*this._floatsPerVertex;t.initialize(this._device,this._attributes,i,this.Hp),this._buffers.push(t);var n=YD.alloc();n.offset=0,n.length=t.vData.byteLength;var r=[n];return this.Gp.push(r),xN.root.batcher2D.syncMeshBuffersToNative(this.id,this._buffers),this._buffers.length-1},i.generateID=function(){return i.ID_COUNT++},r(i,[{key:"id",get:function(){return this.ps}}]),i}(XD);qD.IB_SCALE=4,qD.ID_COUNT=0,function(){function t(){this.zp=-1,this.Wp=-1,this.Xp=0,this.Yp=0,this.Kp=null,this.xp=null,this.qp=null,this.Qp=null,this.Jp=!1,this.Zp=0,this.t_=0,this.i_=0,this.n_=!1,this.r_=null,this.s_=null,this.e_=null,this.wn=0,this.h_=!1,this.u_=null,this.o_=0,this.f_=null,this.v_=null}var i=t.prototype;i.kh=function(){},i.l_=function(){},i.d_=function(t){this.zp=t},i.w_=function(t){this.Wp=t},i.g_=function(t,i){this.Wp=i,this.zp=t},i.p_=function(t){this.Xp=t},i.__=function(t){this.Yp=t},i.y_=function(){},i.m_=function(){},i.b_=function(){},i.k_=function(){},i.A_=function(t){this.Zp=t},i.E_=function(){},i.T_=function(t){this.Jp=t},i.O_=function(t){this.i_=t},i.S_=function(t){this.n_=t},i.I_=function(){},i.R_=function(t){this.r_=t},i.M_=function(t){this.s_=t},i.C_=function(t){this.e_=t},i.N_=function(){},i.P_=function(t){this.o_=t},i.L_=function(t){this.f_=t},i.D_=function(t){this.wn=t},i.B_=function(){},i.F_=function(){},r(t,[{key:"nativeObj",get:function(){return this.U_}},{key:"render2dBuffer",get:function(){return this.v_}}])}();var QD,JD,ZD,tB,iB,nB,rB,sB,eB,hB,uB,oB=zD(GD)>>2,cB=t("p",function(){function t(t){void 0===t&&(t=GD),this.chunk=null,this._renderDrawInfo=null,this._material=null,this._dataHash=0,this._isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=GD,this._drawInfoType=0,this._multiOwner=!1,this._batcher=null,this._floatStride=t===GD?oB:zD(t)>>2,this._vertexFormat=t}var i=t.prototype;return i.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},i.initRenderDrawInfo=function(){},i.removeRenderDrawInfo=function(){},i.x_=function(){},r(t,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}},{key:"drawInfoType",get:function(){return this._drawInfoType},set:function(t){this._drawInfoType=t}},{key:"renderDrawInfo",get:function(){return this._renderDrawInfo}},{key:"material",get:function(){return this._material},set:function(t){this._material=t}},{key:"dataHash",get:function(){return this._dataHash},set:function(t){this._dataHash=t}},{key:"multiOwner",get:function(){return this._multiOwner},set:function(t){this._multiOwner=t}},{key:"batcher",get:function(){return this._batcher||(this._batcher=xN.root.batcher2D),this._batcher}}]),t}()),aB=t("q",function(t){function i(i,n){var r;return void 0===i&&(i=GD),void 0===n&&(n=null),(r=t.call(this,i)||this)._vertDirty=!0,r._textureHash=0,r.indices=null,r.layer=0,r.nodeDirty=!0,r.passDirty=!0,r.textureDirty=!0,r.hashDirty=!0,r.M=[],r.G_=null,r._accessor=null,r.vertexRow=1,r.vertexCol=1,n||(n=r.batcher.switchBufferAccessor(r._vertexFormat)),r._accessor=n,r}e(i,t),i.add=function(t,n){void 0===t&&(t=GD),void 0===n&&(n=null);var r=new i(t,n);return n||(n=xN.root.batcher2D.switchBufferAccessor(r._vertexFormat)),r._accessor=n,r},i.remove=function(t){t.clear(),t._accessor=null};var n=i.prototype;return n.resize=function(t,i){t===this._vc&&i===this._ic&&this.chunk||(this._vc=t,this._ic=i,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,i),this.updateHash())},n.x_=function(){},n.j_=function(){},n.H_=function(){},n.resizeAndCopy=function(t,i){if(t!==this._vc||i!==this._ic||!this.chunk){this._vc=t,this._ic=i;var n=this.chunk;this.chunk=this._accessor.allocateChunk(t,i),n&&(this.chunk.vb.set(n.vb),this._accessor.recycleChunk(n)),this.updateHash()}},n.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},n.updateNode=function(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0},n.updatePass=function(t){this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0},n.updateTexture=function(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0},n.updateHash=function(){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.textureHash;this.dataHash=Sv(t,666),this.hashDirty=!1},n.updateRenderData=function(t,i){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0),this.nodeDirty){var n=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==n&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=i,this.textureHash=i.getHash(),this.textureDirty=!1,this.hashDirty=!0),this.hashDirty&&this.updateHash()},n.clear=function(){this.resize(0,0),this.M.length=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.frame=null,this.textureHash=0,this.dataHash=0},i.createStaticVBAccessor=function(t,i,n){var r=xN.root.device;return new qD(r,t,i,n)},r(i,[{key:"dataLength",get:function(){return this.M.length},set:function(t){var i=this.M;if(i.length!==t){for(var n=i.length;n<t;n++)i.push({x:0,y:0,z:0,u:0,v:0,color:Qs.WHITE.clone()});i.length=t}this.H_()}},{key:"data",get:function(){return this.M}},{key:"vertDirty",get:function(){return this._vertDirty},set:function(t){this._vertDirty=t}},{key:"textureHash",get:function(){return this._textureHash},set:function(t){this._textureHash=t}},{key:"frame",get:function(){return this.G_},set:function(t){this.G_=t}},{key:"accessor",get:function(){return this._accessor}}]),i}(cB)),fB=t("r",function(t){function i(i){var n;return void 0===i&&(i=GD),(n=t.call(this,i)||this)._isMeshBuffer=!0,n.vertexStart=0,n.vertexRange=0,n.indexStart=0,n.indexRange=0,n.lastFilledIndex=0,n.lastFilledVertex=0,n.frame=null,n.V_=0,n.Qn=[],n.Jn=null,n.Bp=null,n.eu=null,n.vData=new Float32Array(256*n.stride),n.iData=new Uint16Array(1536),n}e(i,t),i.add=function(t){void 0===t&&(t=GD);var n=new i;return n._floatStride=t===GD?oB:zD(t)>>2,n._vertexFormat=t,n},i.remove=function(t){t.clear()};var n=i.prototype;return n.request=function(t,i){var n=this.V_+t*this.stride;return!!this.reserve(t,i)&&(this._vc+=t,this._ic+=i,this.V_=n,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},n.reserve=function(t,i){var n=this.V_+t*this.stride,r=this.indexCount+i;if(t+this.vertexCount>65535)return!1;var s=this.vData.byteLength,e=this.iData.length,h=this.vData.length,u=this.iData.length;if(n>s||r>e){for(;s<n||e<r;)s=4*(h*=2),e=u*=2;this._reallocBuffer(h,u)}return!0},n.resize=function(t,i){var n=t*this.stride;t>=0&&i>=0&&n<=this.vData.byteLength&&this.iData.length,this._vc=t,this._ic=i,this.V_=n,this.updateRange(0,t,0,i)},n.updateRange=function(t,i,n,r){i>=0&&r>=0&&i<=this._vc&&this._ic,this.vertexStart=t,this.indexStart=n,this.vertexRange=i,this.indexRange=r},n.requestIA=function(t){this._initIAInfo(t);var i=this.Bp.add();return i.firstIndex=this.indexStart,i.indexCount=this.indexRange,i},n.uploadBuffers=function(){if(0!==this.V_&&this.Qn[0]&&this.Jn){var t=this._ic,i=new Float32Array(this.vData.buffer,0,this.V_>>2),n=new Uint16Array(this.iData.buffer,0,t),r=this.Qn[0];this.V_>r.size&&r.resize(this.V_),r.update(i);var s=t<<1;s>this.Jn.size&&this.Jn.resize(s),this.Jn.update(n)}},n.freeIAPool=function(){this.Bp&&this.Bp.reset()},n.reset=function(){this._vc=0,this._ic=0,this.V_=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},n.clear=function(){this.reset(),this.Bp&&this.Bp.destroy(),this.Qn[0]&&(this.Qn[0].destroy(),this.Qn=[]),this.eu=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},n._initIAInfo=function(t){var i=this;if(!this.eu){var n=this.stride,r=this.Qn;r.length||r.push(t.createBuffer(new $l(10,1,n,n))),this.Jn||(this.Jn=t.createBuffer(new $l(6,1,2,2))),this.eu=new cd(this._vertexFormat,r,this.Jn),this.Bp=new Ge((function(){return t.createInputAssembler(i.eu)}),1,(function(t){t.destroy()}))}},n._reallocBuffer=function(t,i){var n=this.vData;this.vData=new Float32Array(t),n&&this.vData.set(n,0);var r=this.iData;this.iData=new Uint16Array(i),r&&this.iData.set(r,0)},n.x_=function(){},n.z_=function(){},r(i,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this.V_>>>2}}]),i}(cB)),vB=new Ms,lB=new Ms,dB=new Ir,wB=new ls,gB=new ls,pB=new ls,_B=new ls(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),yB=new ee,mB=t("e",_o("cc.UITransform")(QD=mo(110)(QD=bo((iB=function(t){function i(){var i;return(i=t.call(this)||this)._priority=0,i._contentSize=ZD&&ZD(),i._anchorPoint=tB&&tB(),i}e(i,t);var n=i.prototype;return n.__preload=function(){this.node._uiProps.uiTransformComp=this},n.onLoad=function(){this.node.parent&&i.W_(this.node.parent)},n.onEnable=function(){this.node.on("parent-changed",this._parentChanged,this),this.X_()},n.onDisable=function(){this.node.off("parent-changed",this._parentChanged,this)},n.onDestroy=function(){this.node._uiProps.uiTransformComp=null},n.setContentSize=function(t,i){var n,r,s=this._contentSize;if(void 0===i){if(xn(t.width,s.width,Fn)&&xn(t.height,s.height,Fn))return;n=t.width,r=t.height}else{if(xn(t,s.width,Fn)&&xn(i,s.height,Fn))return;n=t,r=i}s.width=n,s.height=r,this.node.emit("size-changed"),this.X_()},n.setAnchorPoint=function(t,i){var n=this._anchorPoint;if(void 0===i){if(t.x===n.x&&t.y===n.y)return;n.x=t.x,n.y=t.y}else{if(t===n.x&&i===n.y)return;n.x=t,n.y=i}this.node.emit("anchor-changed",this._anchorPoint),this.X_()},n.isHit=function(t){for(var i=this._contentSize.width,n=this._contentSize.height,r=vB,s=lB,e=this._getRenderScene().cameras,h=0;h<e.length;h++){var u=e[h];if(u.visibility&this.node.layer){u.node.getWorldRT(wB);var o=wB.m12,c=wB.m13,a=kh.center;if(wB.m12=a.x-(wB.m00*o+wB.m04*c),wB.m13=a.y-(wB.m01*o+wB.m05*c),ls.invert(wB,wB),Ms.transformMat4(r,t,wB),this.node.getWorldMatrix(pB),ls.invert(wB,pB),!ls.strictEquals(wB,_B)){Ms.transformMat4(s,r,wB),s.x+=this._anchorPoint.x*i,s.y+=this._anchorPoint.y*n;var f=!1;if(s.x>=0&&s.y>=0&&s.x<=i&&s.y<=n&&(f=this.Y_(r)),f)return!0}}}return!1},n.hitTest=function(t,i){void 0===i&&(i=0);for(var n=this._contentSize.width,r=this._contentSize.height,s=dB,e=vB,h=lB,u=this._getRenderScene().cameras,o=0;o<u.length;o++){var c=u[o];if(c.visibility&this.node.layer&&(!c.window||c.window.swapchain)&&c.systemWindowId===i&&(Ir.set(s,t.x,t.y,0),c.screenToWorld(s,s),Ms.set(e,s.x,s.y),this.node.getWorldMatrix(pB),ls.invert(wB,pB),!ls.strictEquals(wB,_B))){Ms.transformMat4(h,e,wB),h.x+=this._anchorPoint.x*n,h.y+=this._anchorPoint.y*r;var a=!1;if(h.x>=0&&h.y>=0&&h.x<=n&&h.y<=r&&(a=this.Y_(e)),a)return!0}}return!1},n.Y_=function(t){var i,n,r=null==(i=this.node)||null==(n=i.eventProcessor)?void 0:n.maskList;if(r)for(var s=this.node,e=r.length,h=0,u=0;s&&u<e;++h,s=s.parent){var o=r[u];if(h===o.index){if(s!==o.comp.node){r.length=u;break}var c=o.comp;if(c&&c._enabled&&!c.isHit(t))return!1;u++}else if(h>o.index){r.length=u;break}}return!0},n.convertToNodeSpaceAR=function(t,i){return this.node.getWorldMatrix(pB),ls.invert(wB,pB),i||(i=new Ir),Ir.transformMat4(i,t,wB)},n.convertToWorldSpaceAR=function(t,i){return this.node.getWorldMatrix(pB),i||(i=new Ir),Ir.transformMat4(i,t,pB)},n.getBoundingBox=function(){var t=new ee;return this._selfBoundingBox(t),ls.fromSRT(gB,this.node.rotation,this.node.position,this.node.scale),t.transformMat4(gB),t},n.getBoundingBoxToWorld=function(){for(var t=new ee,n=this.node.children,r=0;r<n.length;++r){var s=n[r];if(s&&s.active){var e=s.getComponent(i);e&&e.contentSize.width&&e.contentSize.height&&(e._selfBoundingBox(yB),yB.transformMat4(s.worldMatrix),0===t.width?t.set(yB):ee.union(t,t,yB))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(yB),yB.transformMat4(this.node.worldMatrix),0===t.width?t.set(yB):ee.union(t,t,yB)),t},n.getBoundingBoxTo=function(t){var n=new ee,r=this.node.children;ls.invert(wB,t);for(var s=0;s<r.length;++s){var e=r[s];if(e&&e.active){var h=e.getComponent(i);h&&h.contentSize.width&&h.contentSize.height&&(h._selfBoundingBox(yB),ls.multiply(gB,e.worldMatrix,wB),yB.transformMat4(gB),0===n.width?n.set(yB):ee.union(n,n,yB))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(yB),ls.multiply(gB,this.node.worldMatrix,wB),yB.transformMat4(gB),0===n.width?n.set(yB):ee.union(n,n,yB)),n},n.getComputeAABB=function(t){var i=this._contentSize.width,n=this._contentSize.height;yB.set(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n),yB.transformMat4(this.node.worldMatrix);var r=yB.x+.5*yB.width,s=yB.y+.5*yB.height,e=this.node.worldPosition.z,h=yB.width/2,u=yB.height/2;return null!=t?(Mh.set(t,r,s,e,h,u,.001),t):new Mh(r,s,e,h,u,.001)},n._selfBoundingBox=function(t){var i=this._contentSize.width,n=this._contentSize.height;return t.set(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n),t},n._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&i.W_(this.node.parent)},n.X_=function(){var t=this.node._uiProps.uiComp;t&&t.vo()},i.W_=function(t){var n=t.uuid;i.K_.has(n)||i.K_.set(n,t)},i.q_=function(t){var i=t.children;i&&i.sort((function(t,i){var n=t.qu(),r=i.qu(),s=(n?n._priority:0)-(r?r._priority:0);return 0===s?t.siblingIndex-i.siblingIndex:s}))},i.Q_=function(){i.K_.forEach((function(t){i.q_(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),i.K_.clear()},i.J_=function(){i.K_.clear()},r(i,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit("size-changed"),this.X_())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit("size-changed"),this.X_())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit("size-changed"),this.X_())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit("anchor-changed",this._anchorPoint),this.X_())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit("anchor-changed",this._anchorPoint),this.X_())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit("anchor-changed",this._anchorPoint),this.X_())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?st(6706):(this._priority=t,this.node.parent&&i.W_(this.node.parent)))}},{key:"visibility",get:function(){var t=xN.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=xN.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),i}(Kg),iB.EventType=WA,iB.K_=new Map,ZD=uo((JD=iB).prototype,"_contentSize",[Co],(function(){return new ie(100,100)})),tB=uo(JD.prototype,"_anchorPoint",[Co],(function(){return new Ms(.5,.5)})),QD=JD))||QD)||QD)||QD);xN.on("director_after_update",mB.Q_),xN.on("director_before_scene_launch",mB.J_);var bB={parent:null,owner:null,subModelIdx:0},kB=bo,AB=ic,EB=t("dl",(nB=_o("cc.Renderer"),rB=AB(hA),sB=AB([hA]),nB(eB=kB((hB=function(t){function i(){var i;return(i=t.call(this)||this)._materials=uB&&uB(),i._materialInstances=[],i}e(i,t);var n=i.prototype;return n.getMaterial=function(t){return this.getSharedMaterial(t)},n.setMaterial=function(t,i){this.setSharedMaterial(t,i)},n.getSharedMaterial=function(t){return t<0||t>=this._materials.length?null:this._materials[t]},n.setSharedMaterial=function(t,i,n){if(void 0===n&&(n=!1),t&&t instanceof wA&&ht(12012),n||this._materials[i]!==t){this._materials[i]=t;var r=this._materialInstances[i];r&&(r.destroy(),this._materialInstances[i]=null),this._onMaterialModified(i,this._materials[i])}},n.getMaterialInstance=function(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){bB.parent=this._materials[t],bB.owner=this,bB.subModelIdx=t;var i=new wA(bB);bB.parent=null,bB.owner=null,bB.subModelIdx=0,this.setMaterialInstance(i,t)}return this._materialInstances[t]},n.setMaterialInstance=function(t,i){if("number"==typeof t){st(12007);var n=t;t=i,i=n}var r=this._materialInstances[i];t&&t.parent?t!==r&&(this._materialInstances[i]=t,this._onMaterialModified(i,t)):(t!==this._materials[i]||r)&&this.setSharedMaterial(t,i)},n.getRenderMaterial=function(t){return this._materialInstances[t]||this._materials[t]},n._onMaterialModified=function(){},n.qh=function(){},n._clearMaterials=function(){},r(i,[{key:"sharedMaterial",get:function(){return this.getSharedMaterial(0)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var i=0;i<t.length;i++)t[i]!==this._materials[i]&&this.setSharedMaterial(t[i],i);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setSharedMaterial(null,n);this._materials.splice(t.length)}}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(t){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==t)&&this.setMaterialInstance(t,0)}},{key:"materials",get:function(){for(var t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances},set:function(t){for(var i=t.length,n=this._materials.length,r=i;r<n;r++)this.setMaterialInstance(null,r);this._materials.length=i,this._materialInstances.length=i;for(var s=0;s<i;s++)this._materialInstances[s]!=t[s]&&this.setMaterialInstance(t[s],s)}}]),i}(Kg),y(hB.prototype,"sharedMaterials",[rB],Object.getOwnPropertyDescriptor(hB.prototype,"sharedMaterials"),hB.prototype),uB=uo(hB.prototype,"_materials",[sB],(function(){return[]})),eB=hB))||eB)||eB)),TB=function(){var t=i.prototype;function i(){this.Z_=0,this.ty=[],this.lu=null,this.iy=null,this.ny=0,this.sy=!0,this.sf=!1,this.h_=!1,this.ey=0,this.hy=Qs.WHITE.clone()}return t.Fh=function(){},t.uy=function(t){this.h_=t},t.oy=function(){},t.vy=function(){},t.ly=function(){},t.wy=function(){},t.gy=function(){},t.py=function(){},t.yy=function(t){this.ey=t},t.my=function(){},t.ky=function(){return null},t.Ay=function(t){this.lu=t},t.Ey=function(t){this.iy=t},t.Ty=function(t){this.ny=t},t.Oy=function(){},r(i,[{key:"nativeObj",get:function(){return this.U_}},{key:"renderDrawInfoArr",get:function(){return this.ty}},{key:"renderEntityType",get:function(){return this.Z_}},{key:"color",get:function(){return this.hy},set:function(t){this.hy=t}},{key:"colorDirty",get:function(){return this.sy},set:function(t){this.sy=t}},{key:"enabled",get:function(){return this.sf},set:function(t){this.sf=t}}]),i}(),OB={default:0};uP.on(hP.EVENT_POST_SUBSYSTEM_INIT,(function(){xB.init()}));var SB,IB,RB,MB,CB,NB,PB,LB,DB,BB,FB,UB,xB=t("Z",function(){function t(){}return t.getSortingPriority=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),(t+32768<<16|i+32768)>>>0},t.getDefaultPriority=function(){return this.getSortingPriority(OB.default,0)},t.getLayerIndex=function(t){void 0===t&&(t=0);var i=0;return this.Sy.has(t)?i=this.Sy.get(t):ht(2105),i},t.getLayerIndexByName=function(t){var i=this.getLayerByName(t);return this.getLayerIndex(i)},t.getLayerName=function(t){void 0===t&&(t=0);var i="";return this.Iy.has(t)?i=this.Iy.get(t):ht(2105),i},t.getLayerByName=function(t){for(var i=this.Iy.size,n=this.Iy.keys(),r=0,s=0;s<i;s++)if(r=n.next().value,this.Iy.get(r)===t)return r;return ht(2106),0},t.isLayerValid=function(t){return!!this.Sy.has(t)||(ht(2105),!1)},t.getBuiltinLayers=function(){return[{id:0,name:"default",value:0}]},t.init=function(){var i=Oi.querySettings("engine","sortingLayers");i&&0!==i.length||(i=this.getBuiltinLayers()),t.Ry();for(var n=0;n<i.length;n++){var r=i[n];t.setLayer(r.id,r.name,r.value),t.Enum[r.name]=r.id}_i.update(t.Enum),_i.sortList(t.Enum,(function(i,n){return t.getLayerIndex(i.value)-t.getLayerIndex(n.value)}))},t.setLayer=function(t,i,n){this.Iy.set(t,i),this.Sy.set(t,n)},t.Ry=function(){for(var i=Object.keys(t.Enum),n=0;n<i.length;n++)delete t.Enum[t.Enum[i[n]]],delete t.Enum[i[n]];t.Sy.clear(),t.Iy.clear()},t}());xB.Iy=new Map,xB.Sy=new Map,xB.Enum=_i(OB),bi(el),bi(hl),bi(ul),t("I",{ADD_COLOR:0,ADD_COLOR_AND_TEXTURE:1,GRAYSCALE:2,USE_ALPHA_SEPARATED:3,USE_ALPHA_SEPARATED_AND_GRAY:4});var GB=t("d",(SB=_o("cc.UIRenderer"),IB=yo(mB),RB=ic(hA),MB=ic(hA),SB(CB=IB((UB=function(t){function i(){var i;return(i=t.call(this)||this)._renderData=null,i._materials=PB&&PB(),i._customMaterial=LB&&LB(),i._srcBlendFactor=DB&&DB(),i._dstBlendFactor=BB&&BB(),i._color=FB&&FB(),i._stencilStage=0,i._assembler=null,i._postAssembler=null,i._renderFlag=!0,i._instanceMaterialType=-1,i._srcBlendFactorCache=2,i._dstBlendFactorCache=4,i._dirtyVersion=-1,i._internalId=-1,i.My=-1,i.Sf=0,i.Cy=0,i._lastParent=null,i._renderEntity=i.createRenderEntity(),i.priority=xB.getDefaultPriority(),i}e(i,t);var n=i.prototype;return n.Ny=function(t){this._renderData=t},n.getFillColorType=function(){return this.Cy},n.setFillColorType=function(t){this.Cy=t},n.onLoad=function(){this._renderEntity.Ay(this.node)},n.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},n.onEnable=function(){this.node.on("anchor-changed",this._nodeStateChange,this),this.node.on("size-changed",this._nodeStateChange,this),this.node.on("parent-changed",this._colorDirty,this),!this._renderData&&this._flushAssembler&&this._flushAssembler(),this.updateMaterial(),this._colorDirty(),DN.yd(this),this.vo()},n.onRestore=function(){this.updateMaterial(),this.vo()},n.Py=function(){if(this.destroyRenderData(),this._materials)for(var t=0;t<this._materials.length;t++)this.setSharedMaterial(null,t,!0)},n.onDisable=function(){this.node.off("anchor-changed",this._nodeStateChange,this),this.node.off("size-changed",this._nodeStateChange,this),this.node.off("parent-changed",this._colorDirty,this),this.Py(),DN.md(this),this._renderFlag=!1,this._renderEntity.enabled=!1},n.onDestroy=function(){this._renderEntity.Ay(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.Py()},n.markForUpdateRenderData=function(t){void 0===t&&(t=!0),this.vo(t)},n.vo=function(t){if(void 0===t&&(t=!0),t){var i=this._renderData;i&&(i.vertDirty=!0),DN.bd(this)}},n.requestRenderData=function(t){void 0===t&&(t=0);var i=aB.add();return i.initRenderDrawInfo(this,t),this._renderData=i,i},n.destroyRenderData=function(){this.renderEntity.gy(),this._renderData&&(aB.remove(this._renderData),this._renderData=null)},n.updateRenderer=function(){var t=this._assembler;t&&t.updateRenderData&&t.updateRenderData(this),this._renderFlag=this._canRender(),this._renderEntity.enabled=this._renderFlag},n.fillBuffers=function(t){this._renderFlag&&this._render(t)},n.postUpdateAssembler=function(t){this._postAssembler&&this._renderFlag&&this._postRender(t)},n._render=function(){},n._postRender=function(){},n._canRender=function(){return null!==this.getSharedMaterial(0)&&this._enabled&&this._color.a>0},n._postCanRender=function(){},n.updateMaterial=function(){if(this._customMaterial)this.getSharedMaterial(0)!==this._customMaterial&&this.setSharedMaterial(this._customMaterial,0);else{var t=this._updateBuiltinMaterial();this.setSharedMaterial(t,0),2!==this.stencilStage&&6!==this.stencilStage||this.getMaterialInstance(0).recompileShaders({USE_ALPHA_TEST:!0}),this._updateBlendFunc()}},n._updateColor=function(){this.node._uiProps.colorDirty=!0,this.Ly(!0),this.setEntityColor(this._color);var t=this._assembler;if(t){t.updateColor&&t.updateColor(this);var i=this._renderFlag;if(this._renderFlag=this._canRender(),this.setEntityEnabled(this._renderFlag),i!==this._renderFlag){var n=this.renderData;n&&(n.vertDirty=!0)}}},n.Ly=function(){},n.setEntityColor=function(){},n.setEntityOpacity=function(){},n.setEntityEnabled=function(){},n._updateBlendFunc=function(){var t=this.getRenderMaterial(0).passes[0].blendState.targets[0];if(this._dstBlendFactorCache=t.blendDst,this._srcBlendFactorCache=t.blendSrc,this._dstBlendFactorCache!==this._dstBlendFactor||this._srcBlendFactorCache!==this._srcBlendFactor){(t=this.getMaterialInstance(0).passes[0].blendState.targets[0]).blend=!0,t.blendDstAlpha=4,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor;var i=this.getMaterialInstance(0).passes[0];i.blendState.setTarget(0,t),i.Dh(),this._dstBlendFactorCache=this._dstBlendFactor,this._srcBlendFactorCache=this._srcBlendFactor}},n._nodeStateChange=function(){this._renderData&&this.vo();for(var t=0;t<this.node.children.length;++t){var n=this.node.children[t].getComponent(i);n&&n.vo()}},n._colorDirty=function(){this.node._uiProps.colorDirty=!0,this.Ly(!0)},n._onMaterialModified=function(i,n){this._renderData&&(this.vo(),this._renderData.passDirty=!0),t.prototype._onMaterialModified.call(this,i,n)},n._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case 0:t=Fk.get("ui-base-material");break;case 2:t=Fk.get("ui-sprite-gray-material");break;case 3:t=Fk.get("ui-sprite-alpha-sep-material");break;case 4:t=Fk.get("ui-sprite-gray-alpha-sep-material");break;default:t=Fk.get("ui-sprite-material")}return t},n.setNodeDirty=function(){this._renderData&&(this._renderData.nodeDirty=!0)},n.setTextureDirty=function(){this._renderData&&(this._renderData.textureDirty=!0)},n.createRenderEntity=function(){return new TB(0)},r(i,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var i=0;i<t.length;i++)t[i]!==this._materials[i]&&this.setSharedMaterial(t[i],i);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setSharedMaterial(null,n);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"stencilStage",get:function(){return this._stencilStage},set:function(t){this._stencilStage=t,this._renderEntity.Ty(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t}},{key:"priority",get:function(){return this.Sf},set:function(t){this.Sf=t}},{key:"batcher",get:function(){return xN.root.batcher2D}},{key:"renderEntity",get:function(){return this._renderEntity}},{key:"_useVertexOpacity",get:function(){return 1===this.Cy},set:function(){this.setFillColorType(1)}},{key:"useVertexOpacity",get:function(){return 1===this.Cy}}]),i}(EB),UB.BlendState=el,UB.Assembler=null,UB.PostAssembler=null,y((NB=UB).prototype,"sharedMaterials",[ac],Object.getOwnPropertyDescriptor(NB.prototype,"sharedMaterials"),NB.prototype),y(NB.prototype,"customMaterial",[RB],Object.getOwnPropertyDescriptor(NB.prototype,"customMaterial"),NB.prototype),PB=uo(NB.prototype,"_materials",[ac],(function(){return[]})),LB=uo(NB.prototype,"_customMaterial",[MB],(function(){return null})),DB=uo(NB.prototype,"_srcBlendFactor",[Co],(function(){return 2})),BB=uo(NB.prototype,"_dstBlendFactor",[Co],(function(){return 4})),FB=uo(NB.prototype,"_color",[Co],(function(){return Qs.WHITE.clone()})),CB=NB))||CB)||CB));T.internal.UIRenderer=GB;var jB,HB,VB,$B,zB,WB,XB,YB,KB,qB,QB,JB,ZB,tF,iF,nF,rF,sF,eF,hF,uF,oF,cF,aF,fF,vF,lF,dF,wF,gF,pF,_F,yF,mF,bF=function(){function t(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor=Qs.WHITE.clone(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor=Qs.BLACK.clone(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0,this.color=Qs.WHITE.clone(),this.fontSize=40,this.actualFontSize=0,this.isSystemFontUsed=!1,this.originFontSize=0,this.bmfontScale=1,this.fontFamily="Arial",this.fontDesc="",this.fntConfig=null,this.spriteFrame=null,this.fontScale=1}return t.prototype.reset=function(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor.set(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor.set(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0},t}(),kF=function(){function t(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions=new ie,this.horizontalKerning=[],this.numberOfLines=1,this.linesOffsetX=[],this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth=[]}return t.prototype.reset=function(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions.set(),this.horizontalKerning.length=0,this.numberOfLines=1,this.linesOffsetX.length=0,this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth.length=0},t}(),AF=function(){function t(){this.parsedString=[],this.nodeContentSize=ie.ZERO.clone(),this.canvasSize=new ie,this.canvasPadding=new ee,this.contentSizeExtend=ie.ZERO.clone(),this.startPosition=Ms.ZERO.clone()}return t.prototype.reset=function(){this.parsedString.length=0,this.nodeContentSize.set(0,0),this.canvasSize.set(),this.canvasPadding.set(),this.contentSizeExtend.set(),this.startPosition.set()},t}(),EF=function(){function t(){this.quadCount=0,this.vertexBuffer=[],this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5}return t.prototype.reset=function(){this.quadCount=0,this.vertexBuffer.length=0,this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5},t}();Qs.WHITE.clone();var TF=t("H",{LEFT:0,CENTER:1,RIGHT:2});bi(TF);var OF=t("V",{TOP:0,CENTER:1,BOTTOM:2});bi(OF);var SF=t("O",{NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});bi(SF);var IF=t("n",{NONE:0,BITMAP:1,CHAR:2});bi(IF);var RF,MF,CF,NF,PF,LF,DF,BF,FF,UF,xF,GF,jF,HF,VF,$F,zF,WF,XF,YF,KF=t("o",(jB=_o("cc.Label"),HB=mo(110),VB=ic(TF),$B=ic(OF),zB=ic(SF),WB=ic(bL),XB=ic(IF),jB(YB=HB((mF=function(t){function i(){var i;return(i=t.call(this)||this)._string=qB&&qB(),i._horizontalAlign=QB&&QB(),i._verticalAlign=JB&&JB(),i._actualFontSize=ZB&&ZB(),i._fontSize=tF&&tF(),i._fontFamily=iF&&iF(),i._lineHeight=nF&&nF(),i._overflow=rF&&rF(),i._enableWrapText=sF&&sF(),i._font=eF&&eF(),i._isSystemFontUsed=hF&&hF(),i._spacingX=uF&&uF(),i._isItalic=oF&&oF(),i._isBold=cF&&cF(),i._isUnderline=aF&&aF(),i._underlineHeight=fF&&fF(),i._cacheMode=vF&&vF(),i._enableOutline=lF&&lF(),i._outlineColor=dF&&dF(),i._outlineWidth=wF&&wF(),i._enableShadow=gF&&gF(),i._shadowColor=pF&&pF(),i._shadowOffset=_F&&_F(),i._shadowBlur=yF&&yF(),i._N$file=null,i._texture=null,i._ttfSpriteFrame=null,i._userDefinedFont=null,i._assemblerData=null,i._fontAtlas=null,i._letterTexture=null,i._contentWidth=0,i._textStyle=null,i._textLayout=null,i._textRenderData=null,i._textLayoutData=null,i._ttfSpriteFrame=null,i._textStyle=new bF,i._textLayout=new kF,i._textLayoutData=new AF,i._textRenderData=new EF,i}e(i,t);var n=i.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()},n.Dy=function(){if(this._ttfSpriteFrame){this._ttfSpriteFrame._resetDynamicAtlasFrame();var t=this._ttfSpriteFrame.texture;if(this._ttfSpriteFrame.destroy(),t){var i=t;i.image&&i.image.destroy(),t.destroy()}this._ttfSpriteFrame=null}},n._onPreDestroy=function(){t.prototype._onPreDestroy.call(this),this._isOnLoadCalled||this.Dy()},n.onDestroy=function(){this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this.Dy(),this.By(),t.prototype.onDestroy.call(this)},n.By=function(){var t=this._letterTexture;t&&(t.decRef(!1),t.refCount<=0&&t.destroy()),this._letterTexture=null},n.updateRenderData=function(t){void 0===t&&(t=!1),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture()),this._assembler&&this._assembler.updateRenderData(this)},n._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},n._updateColor=function(){t.prototype._updateColor.call(this),this.vo()},n.setEntityColor=function(){},n._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var i=this._font;if(i&&i instanceof kD){var n=i.spriteFrame;if(!n||!n.texture)return!1}return!0},n._flushAssembler=function(){var t=i.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t,this.textStyle.reset(),this.textLayout.reset(),this.textLayoutData.reset(),this.textRenderData.reset()),this.renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.renderData.material=this.material,this._updateColor())},n._applyFontTexture=function(){this.vo();var t=this._font;if(t instanceof kD){var i=t.spriteFrame;i&&i.texture&&(this._texture=i,this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(2===this.cacheMode){var n=this._letterTexture,r=this._assembler.getAssemblerData();r!==n&&(this.By(),r&&r.addRef()),this._texture=this._letterTexture=r}else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new wL,this._assemblerData=this._assembler.getAssemblerData();var s=new mg(this._assemblerData.canvas),e=new f_;e.image=s,this._ttfSpriteFrame.texture=e}2!==this.cacheMode&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}},n.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(2!==this.cacheMode){var i=this._texture.texture;if(i instanceof Tg){var n=i.getPixelFormat();t=1026===n||1025===n||1024===n}}this._instanceMaterialType=t?3:1,this.updateMaterial()}},n._updateBlendFunc=function(){t.prototype._updateBlendFunc.call(this)},r(i,[{key:"string",get:function(){return this._string},set:function(t){t=null==t?"":t.toString(),this._string!==t&&(this._string=t,this.vo())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.vo())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.vo())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.vo())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.vo())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.vo())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.vo())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.vo())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this.vo())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.vo())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this.destroyRenderData(),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){var i=this._cacheMode;i!==t&&(1!==i||this._font instanceof kD||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),2===i&&(this._ttfSpriteFrame=null,this.By()),this._cacheMode=t,this.updateRenderData(!0))}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.vo())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.vo())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.vo())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.vo())}},{key:"enableOutline",get:function(){return this._enableOutline},set:function(t){this._enableOutline!==t&&(this._enableOutline=t,this.vo())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(t){this._outlineColor!==t&&(this._outlineColor.set(t),this.vo())}},{key:"outlineWidth",get:function(){return this._outlineWidth},set:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this.vo())}},{key:"enableShadow",get:function(){return this._enableShadow},set:function(t){this._enableShadow!==t&&(this._enableShadow=t,this.vo())}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor!==t&&(this._shadowColor.set(t),this.vo())}},{key:"shadowOffset",get:function(){return this._shadowOffset},set:function(t){this._shadowOffset!==t&&(this._shadowOffset.set(t),this.vo())}},{key:"shadowBlur",get:function(){return this._shadowBlur},set:function(t){this._shadowBlur!==t&&(this._shadowBlur=t,this.vo())}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof kD?this._font.fontSize:-1}},{key:"textStyle",get:function(){return this._textStyle}},{key:"textLayout",get:function(){return this._textLayout}},{key:"textRenderData",get:function(){return this._textRenderData}},{key:"textLayoutData",get:function(){return this._textLayoutData}},{key:"contentWidth",get:function(){return this._contentWidth},set:function(t){this._contentWidth=t}}]),i}(GB),mF.HorizontalAlign=TF,mF.VerticalAlign=OF,mF.Overflow=SF,mF.CacheMode=IF,mF._canvasPool=TD.Ip(),y((KB=mF).prototype,"horizontalAlign",[VB],Object.getOwnPropertyDescriptor(KB.prototype,"horizontalAlign"),KB.prototype),y(KB.prototype,"verticalAlign",[$B],Object.getOwnPropertyDescriptor(KB.prototype,"verticalAlign"),KB.prototype),y(KB.prototype,"overflow",[zB],Object.getOwnPropertyDescriptor(KB.prototype,"overflow"),KB.prototype),y(KB.prototype,"font",[WB],Object.getOwnPropertyDescriptor(KB.prototype,"font"),KB.prototype),y(KB.prototype,"cacheMode",[XB],Object.getOwnPropertyDescriptor(KB.prototype,"cacheMode"),KB.prototype),qB=uo(KB.prototype,"_string",[Co],(function(){return"label"})),QB=uo(KB.prototype,"_horizontalAlign",[Co],(function(){return 1})),JB=uo(KB.prototype,"_verticalAlign",[Co],(function(){return 1})),ZB=uo(KB.prototype,"_actualFontSize",[Co],(function(){return 0})),tF=uo(KB.prototype,"_fontSize",[Co],(function(){return 40})),iF=uo(KB.prototype,"_fontFamily",[Co],(function(){return"Arial"})),nF=uo(KB.prototype,"_lineHeight",[Co],(function(){return 40})),rF=uo(KB.prototype,"_overflow",[Co],(function(){return 0})),sF=uo(KB.prototype,"_enableWrapText",[Co],(function(){return!0})),eF=uo(KB.prototype,"_font",[Co],(function(){return null})),hF=uo(KB.prototype,"_isSystemFontUsed",[Co],(function(){return!0})),uF=uo(KB.prototype,"_spacingX",[Co],(function(){return 0})),oF=uo(KB.prototype,"_isItalic",[Co],(function(){return!1})),cF=uo(KB.prototype,"_isBold",[Co],(function(){return!1})),aF=uo(KB.prototype,"_isUnderline",[Co],(function(){return!1})),fF=uo(KB.prototype,"_underlineHeight",[Co],(function(){return 2})),vF=uo(KB.prototype,"_cacheMode",[Co],(function(){return 0})),lF=uo(KB.prototype,"_enableOutline",[Co],(function(){return!1})),dF=uo(KB.prototype,"_outlineColor",[Co],(function(){return new Qs(0,0,0,255)})),wF=uo(KB.prototype,"_outlineWidth",[Co],(function(){return 2})),gF=uo(KB.prototype,"_enableShadow",[Co],(function(){return!1})),pF=uo(KB.prototype,"_shadowColor",[Co],(function(){return new Qs(0,0,0,255)})),_F=uo(KB.prototype,"_shadowOffset",[Co],(function(){return new Ms(2,2)})),yF=uo(KB.prototype,"_shadowBlur",[Co],(function(){return 2})),YB=KB))||YB)||YB));T.Label=KF;var qF={SIMPLE:0,SLICED:1,TILED:2,FILLED:3};bi(qF);var QF={HORIZONTAL:0,VERTICAL:1,RADIAL:2};bi(QF);var JF={CUSTOM:0,TRIMMED:1,RAW:2};bi(JF);var ZF,tU=t("g",(RF=_o("cc.Sprite"),MF=mo(110),CF=ic(pL),NF=ic(wL),PF=ic(qF),LF=ic(QF),DF=ic(JF),RF(BF=MF((YF=function(t){function i(){var i;return(i=t.call(this)||this)._spriteFrame=UF&&UF(),i._type=xF&&xF(),i._fillType=GF&&GF(),i._sizeMode=jF&&jF(),i._fillCenter=HF&&HF(),i._fillStart=VF&&VF(),i._fillRange=$F&&$F(),i._isTrimmedMode=zF&&zF(),i._useGrayscale=WF&&WF(),i._atlas=XF&&XF(),i}e(i,t);var n=i.prototype;return n.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this)},n.onEnable=function(){t.prototype.onEnable.call(this),this.Fy();var i=this._spriteFrame;i&&(this.Uy(),1===this._type&&i.on("uv_updated",this.Uy,this))},n.onDisable=function(){t.prototype.onDisable.call(this),this._spriteFrame&&1===this._type&&this._spriteFrame.off("uv_updated",this.Uy,this)},n.onDestroy=function(){t.prototype.onDestroy.call(this)},n.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var i=this._atlas.getSpriteFrame(t);this.spriteFrame=i}else st(16377)},n.changeMaterialForDefine=function(){var t,i=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);var n=!1;if(t instanceof Tg){var r=t.getPixelFormat();n=1026===r||1025===r||1024===r}n&&this.grayscale?this._instanceMaterialType=4:n?this._instanceMaterialType=3:this.grayscale?this._instanceMaterialType=2:this._instanceMaterialType=1,i!==this._instanceMaterialType&&this.updateMaterial()},n._updateBuiltinMaterial=function(){var i=t.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&this.spriteFrame.texture instanceof LA){var n="rt-"+i.name,r=Fk.get(n);r||((r=new hA(n)).copy(i,{defines:{SAMPLE_FROM_RT:!0}}),Fk.addAsset(n,r)),i=r}return i},n._render=function(t){t.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)},n._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var i=this._spriteFrame;return!(!i||!i.texture)},n._flushAssembler=function(){var t=this,n=i.Assembler.getAssembler(t);t._assembler!==n&&(t.destroyRenderData(),t._assembler=n),t._renderData||n&&n.createData&&((t._renderData=n.createData(t)).material=t.getRenderMaterial(0),t.vo(),t.spriteFrame&&n.updateUVs(t),t._updateColor());var r=t._spriteFrame;r&&(1===t._type?r.on("uv_updated",t.Uy,t):r.off("uv_updated",t.Uy,t))},n.xy=function(){var t=this,i=t._spriteFrame;if(i){var n=t.node._uiProps;if(2===t._sizeMode){var r=i.originalSize;n.uiTransformComp.setContentSize(r)}else if(1===t._sizeMode){var s=i.rect;n.uiTransformComp.setContentSize(s.width,s.height)}}},n.Gy=function(){},n.Fy=function(){var t=this._spriteFrame,i=this.getRenderMaterial(0);t&&i&&this.vo(),this.renderData&&(this.renderData.material=i)},n.Uy=function(){this._assembler&&this._assembler.updateUVs(this)},n._applySpriteFrame=function(t){var i=this,n=i._spriteFrame;t&&1===i._type&&t.off("uv_updated",i.Uy,i);var r=!1;n&&(t&&t.texture===n.texture||(r=!0),r&&(i.renderData&&(i.renderData.textureDirty=!0),(!!t&&t.texture instanceof LA)!=n.texture instanceof LA&&(i._instanceMaterialType=-1),i.changeMaterialForDefine()),i.xy(),1===i._type&&n.on("uv_updated",i.Uy,i))},r(i,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var i=this._spriteFrame;this._spriteFrame=t,this.vo(),this._applySpriteFrame(i)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(2===t||2===this._fillType?this.destroyRenderData():this.renderData&&this.vo(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,3===this._type&&this.renderData&&this.vo()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=Gn(t,0,1),3===this._type&&this.renderData&&(this.vo(),this.Uy())}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=Gn(t,-1,1),3===this._type&&this.renderData&&(this.vo(),this.Uy())}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,0===this._type&&this.renderData&&this.vo(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this.changeMaterialForDefine(),this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,0!==t&&this.xy())}}]),i}(GB),YF.FillType=QF,YF.Type=qF,YF.SizeMode=JF,YF.EventType={SPRITE_FRAME_CHANGED:"spriteframe-changed"},y((FF=YF).prototype,"spriteAtlas",[CF],Object.getOwnPropertyDescriptor(FF.prototype,"spriteAtlas"),FF.prototype),y(FF.prototype,"spriteFrame",[NF],Object.getOwnPropertyDescriptor(FF.prototype,"spriteFrame"),FF.prototype),y(FF.prototype,"type",[PF],Object.getOwnPropertyDescriptor(FF.prototype,"type"),FF.prototype),y(FF.prototype,"fillType",[LF],Object.getOwnPropertyDescriptor(FF.prototype,"fillType"),FF.prototype),y(FF.prototype,"sizeMode",[DF],Object.getOwnPropertyDescriptor(FF.prototype,"sizeMode"),FF.prototype),UF=uo(FF.prototype,"_spriteFrame",[Co],(function(){return null})),xF=uo(FF.prototype,"_type",[Co],(function(){return 0})),GF=uo(FF.prototype,"_fillType",[Co],(function(){return 0})),jF=uo(FF.prototype,"_sizeMode",[Co],(function(){return 1})),HF=uo(FF.prototype,"_fillCenter",[Co],(function(){return new Ms(0,0)})),VF=uo(FF.prototype,"_fillStart",[Co],(function(){return 0})),$F=uo(FF.prototype,"_fillRange",[Co],(function(){return 0})),zF=uo(FF.prototype,"_isTrimmedMode",[Co],(function(){return!0})),WF=uo(FF.prototype,"_useGrayscale",[Co],(function(){return!1})),XF=uo(FF.prototype,"_atlas",[Co],(function(){return null})),BF=FF))||BF)||BF));T.Sprite=tU;var iU,nU=t("h",_o("cc.UIMeshRenderer")(ZF=mo(110)(ZF=function(t){function i(){var i;return(i=t.call(this)||this).jy=null,i._dirtyVersion=-1,i._internalId=-1,i.stencilStage=0,i._renderData=null,i._renderEntity=new TB(1),i}e(i,t);var n=i.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){DN.yd(this),this.vo()},n.onDisable=function(){DN.md(this),this.renderEntity.enabled=this._canRender()},n.onLoad=function(){this.node.qu()||this.node.addComponent("cc.UITransform"),this.jy=this.getComponent("cc.ModelRenderer"),this.jy?this.renderEntity.Ay(this.node):st(16378,this.node?this.node.name:"")},n.onDestroy=function(){this.renderEntity.Ay(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.jy=this.getComponent("cc.ModelRenderer"),this.jy&&(this.jy._sceneGetter=null)},n._render=function(t){if(this.jy){var i=this.jy._collectModels();this.jy._detachFromScene();for(var n=0;n<i.length;n++)i[n].enabled&&t.commitModel(this,i[n],this.jy.material);return!0}return!1},n.fillBuffers=function(t){this.enabled&&this._render(t)},n.updateRenderer=function(){},n.Hy=function(){},n.postUpdateAssembler=function(){},n.update=function(){this.Vy()},n.Vy=function(){if(this.jy)for(var t=this.jy.sharedMaterials.length,i=0;i<t;i++){var n=this.jy.getMaterialInstance(i);if(null!=n)for(var r=n.passes,s=r.length,e=0;e<s;e++)r[e].Fh(244),n.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},e)}},n.markForUpdateRenderData=function(t){void 0===t&&(t=!0),this.vo(t)},n.vo=function(){DN.bd(this)},n.setNodeDirty=function(){},n.setTextureDirty=function(){},n._canRender=function(){return this.enabled&&null!==this.jy},r(i,[{key:"modelComponent",get:function(){return this.jy}},{key:"renderEntity",get:function(){return this._renderEntity}},{key:"renderData",get:function(){return this._renderData}}]),i}(Kg))||ZF)||ZF);T.UIMeshRenderer=nU;var rU=t("i",_o("cc.LabelOutline")(iU=mo(110)(iU=yo(KF)(iU=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.onEnable=function(){this.node.getComponent(KF).enableOutline=!0},n.onDisable=function(){this.node.getComponent(KF).enableOutline=!1},r(i,[{key:"color",get:function(){return this.node.getComponent(KF).outlineColor},set:function(t){this.node.getComponent(KF).outlineColor=t}},{key:"width",get:function(){return this.node.getComponent(KF).outlineWidth},set:function(t){this.node.getComponent(KF).outlineWidth=t}}]),i}(Kg))||iU)||iU)||iU);T.LabelOutline=rU;var sU,eU,hU,uU,oU,cU,aU=M_.Enum.NONE|M_.Enum.UI_3D,fU=function(){function t(){this.$y=null,this.zy=null,this.Jd=null,this.Wy=null,this.Xy=!1,this.Yy=0,this.Ky=0,this.qy=[],this.Qy=[],this.Jy=aU,this.Zy=null,this.tm=null}var i=t.prototype;return i.Ww=function(){this.qy=[]},i.l_=function(){this.Zy=null,this.tm=null,this.zy=null,this.Jd=null,this.Yy=0,this.Ky=0,this.$y=null,this.Xy=!1,this.Wy=null,this.Jy=aU},i.im=function(t,i,n,r){if(t){var s=t.passes;if(!s)return;this.Qy.length=s.length;for(var e=0;e<s.length;e++){this.qy[e]||(this.qy[e]=new $k(T.director.root));var h=s[e],u=this.qy[e];h.update(),i||(i=h.depthStencilState,n=0),u.Lh(h,i,n),this.Qy[e]=u.getShaderVariant(r)}}},r(t,[{key:"passes",get:function(){return this.qy}},{key:"shaders",get:function(){return this.Qy}}]),t}(),vU=(t("j",_o("cc.UIStaticBatch")(sU=mo(110)((eU=function(t){function i(){var i;return(i=t.call(this)||this)._init=!1,i._bufferAccessor=null,i._dirty=!0,i.nm=[],i}e(i,t);var n=i.prototype;return n.postUpdateAssembler=function(){},n.markAsDirty=function(){},n._requireDrawBatch=function(){var t=new fU;return t.Xy=!0,this.nm.push(t),t},n._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var t=this._getBatcher(),i=0;i<this.nm.length;i++)this.nm[i].Ww(t)}this.nm.length=0,this._init=!1},n._getBatcher=function(){return xN.root&&xN.root.batcher2D?xN.root.batcher2D:(st(9301),null)},r(i,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this.nm}}]),i}(GB),y(eU.prototype,"color",[ac],Object.getOwnPropertyDescriptor(eU.prototype,"color"),eU.prototype),sU=eU))||sU)||sU),t("k",_o("cc.LabelShadow")(hU=mo(110)(hU=yo(KF)(hU=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.onEnable=function(){this.node.getComponent(KF).enableShadow=!0},n.onDisable=function(){this.node.getComponent(KF).enableShadow=!1},r(i,[{key:"color",get:function(){return this.node.getComponent(KF).shadowColor},set:function(t){this.node.getComponent(KF).shadowColor=t}},{key:"offset",get:function(){return this.node.getComponent(KF).shadowOffset},set:function(t){this.node.getComponent(KF).shadowOffset=t}},{key:"blur",get:function(){return this.node.getComponent(KF).shadowBlur},set:function(t){this.node.getComponent(KF).shadowBlur=t}}]),i}(Kg))||hU)||hU)||hU),t("m",_o("cc.UIOpacity")(uU=mo(110)(uU=bo((oU=function(t){function i(){var i;return(i=t.call(this)||this)._opacity=cU&&cU(),i}e(i,t);var n=i.prototype;return n.onEnable=function(){this.rm(this._opacity/255)},n.onDisable=function(){this.rm(1)},n.rm=function(t){this.node._uiProps.localOpacity=t},r(i,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=Gn(t,0,255),this._opacity=t,this.rm(t/255))}}]),i}(Kg),cU=uo(oU.prototype,"_opacity",[Co],(function(){return 255})),uU=oU))||uU)||uU)||uU),["left","center","right"]),lU=2048,dU=SL(),wU=(1/255).toFixed(3),gU=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},pU=function(){function t(){this.Gs=null,this.Dr=null,this.sm=null,this.hm=[],this.um=new ee,this.om=100,this.am=1;var t=this.sm=TD.Ip().ci();this.Dr=t.canvas,this.Gs=t.context}var i=t.prototype;return i.destroy=function(){TD.Ip().fi(this.sm),this.sm=null,this.Dr=null,this.Gs=null,this.hm.length=0},i.processingString=function(t,i,n,r,s,e){if(t)i.fntConfig?this.am=1:this.am=this.fm(i.originFontSize,i.fontScale),ND.fontScale=this.am,this.vm(n,r),this.lm(i),this.dm(i,n,s),this.wm(i,n,r,s);else{var h=0;for(this.am=this.fm(i.fontSize,i.fontScale),this.gm(i,r),this.pm(i,n,r,s);(r.canvasSize.width>lU||r.canvasSize.height>lU)&&h<=3;){if(++h>3)this.am=1;else{var u=Math.max(r.canvasSize.width,r.canvasSize.height),o=lU/u;this.am*=o,this.am=Math.max(1,this.am)}this.gm(i,r),this.pm(i,n,r,s)}}e&&(e=r.parsedString)},i.generateRenderInfo=function(t,i,n,r,s,e,h){t?(this._m(i,n,r),this.ym(t,i,n,r,s,e,h)):(this.km(i,n,r),this.Mp(i,n,r,s),this.ym(t,i,n,r,s,e,h))},i.setCanvasUsed=function(t,i){this.Dr=t,this.Gs=i},i.fm=function(t,i){var n=i,r=this.om;return n*t>r&&t<r&&(n=r/t),n<1&&(n=1),n},i.pm=function(t,i,n,r){if(this.Gs){t.actualFontSize=t.fontSize*this.am;var s=r.split("\n"),e=n.parsedString=s,h=this.Am(t.actualFontSize,t.fontFamily,t.isBold,t.isItalic);this.Gs.font=t.fontDesc=h;var u=n.canvasSize,o=n.nodeContentSize,c=n.canvasPadding,a=n.contentSizeExtend,f=this.am;switch(i.overFlow){case 0:for(var v=0,l=0;l<s.length;++l){var d=xL(this.Gs,s[l],h);v=v>d?v:d}var w=v,g=(e.length+EL)*this.Em(i.lineHeight,t.actualFontSize,t.fontSize);u.width=w+c.width*f,u.height=g+c.height*f,o.width=(w+a.width*f)/f,o.height=(g+a.height*f)/f;break;case 2:this.Tm(s,t,i,n),this.Om(s,t,i,n),u.width=o.width*f,u.height=o.height*f;break;case 1:this.Om(s,t,i,n),u.width=o.width*f,u.height=o.height*f;break;case 3:this.Om(s,t,i,n);var p=(n.parsedString.length+EL)*this.Em(i.lineHeight,t.actualFontSize,t.fontSize);u.width=o.width*f,u.height=p+c.height*f,o.height=(p+a.height*f)/f}}},i.Am=function(t,i,n,r){var s=t.toString()+"px ";return s+=i,n&&(s="bold "+s),r&&(s="italic "+s),s},i.Em=function(t,i,n){return 0===t?i:t*i/n},i.Tm=function(t,i,n,r){if(this.Gs){var s=this.Am(i.actualFontSize,i.fontFamily,i.isBold,i.isItalic);this.Gs.font=s;var e=this.Sm(t,this.Gs,s),h=0,u=0,o=0,c=i.actualFontSize,a=r.canvasSize,f=r.nodeContentSize,v=r.canvasPadding,l=this.am;if(n.wrapping){var d=f.width*l,w=f.height*l;if(d<0||w<0)return;u=w+1;for(var g=0,p=0|i.actualFontSize+1,_=0;g<p;){if((_=g+p+1>>1)<=0){tt(4003);break}c=_,s=this.Am(c,i.fontFamily,i.isBold,i.isItalic),this.Gs.font=s;var y=this.Em(n.lineHeight,c,i.fontSize);for(u=0,h=0;h<t.length;++h){var m=xL(this.Gs,t[h],s);u+=YL(t[h],m,d,this.Im(this.Gs,s)).length*y}u>w?p=_-1:g=_}0===g?tt(4003):(c=g,s=this.Am(c,i.fontFamily,i.isBold,i.isItalic),this.Gs.font=s)}else{for(u=t.length*this.Em(n.lineHeight,c,i.fontSize),h=0;h<t.length;++h)o<e[h]&&(o=e[h]);var b=(a.width-v.width)*l/o,k=a.height*l/u;c=i.actualFontSize*Math.min(1,b,k)|0,s=this.Am(c,i.fontFamily,i.isBold,i.isItalic),this.Gs.font=s}i.actualFontSize=c,i.fontDesc=s}},i.Om=function(t,i,n,r){if(n.wrapping&&this.Gs){var s=[],e=r.nodeContentSize.width*this.am,h=this.Am(i.actualFontSize,i.fontFamily,i.isBold,i.isItalic);this.Gs.font=h;for(var u=0;u<t.length;++u){var o=xL(this.Gs,t[u],h),c=YL(t[u],o,e,this.Im(this.Gs,h));s=s.concat(c)}r.parsedString=s,i.fontDesc=h}},i.Im=function(t,i){return function(n){return xL(t,n,i)}},i.Sm=function(t,i,n){return t.map((function(t){return xL(i,t,n)}))},i.gm=function(t,i){var n=0,r=0,s=0,e=0,h=0,u=i.contentSizeExtend,o=i.canvasPadding;if(u.width=u.height=0,t.isOutlined&&(n=r=s=e=h=t.outlineWidth,u.width=u.height=2*h),t.hasShadow){var c=t.shadowBlur+h,a=t.shadowOffsetX,f=t.shadowOffsetY;s=Math.max(s,-a+c),e=Math.max(e,a+c),n=Math.max(n,f+c),r=Math.max(r,-f+c)}if(t.isItalic){var v=t.fontSize*Math.tan(.20943951);e+=v,u.width+=v}o.x=s,o.y=n,o.width=s+e,o.height=n+r},i.km=function(t,i,n){var r=n.canvasSize;r.width=Math.min(r.width,lU),r.height=Math.min(r.height,lU);var s=this.Dr,e=this.Gs;s.width=r.width,s.height=r.height,e.font=t.fontDesc,e.textAlign=vU[i.horizontalAlign],e.textBaseline="alphabetic"},i.Rm=function(t,i,n){var r=0,s=n.canvasSize,e=n.canvasPadding;2===i.horizontalAlign?r=s.width-e.width:1===i.horizontalAlign&&(r=(s.width-e.width)/2);var h=this.Em(i.lineHeight,t.actualFontSize,t.fontSize)*(n.parsedString.length-1),u=t.actualFontSize*(1-EL/2);if(0!==i.verticalAlign){var o=h+e.height+t.actualFontSize-s.height;2===i.verticalAlign?u-=o+=EL/2*t.actualFontSize:u-=o/2}u+=dU*t.actualFontSize,n.startPosition.set(r+e.x,u+e.y)},i.Mp=function(t,i,n,r){var s=this.Gs,e=this.Dr;if(s&&e){s.clearRect(0,0,e.width,e.height),s.font=t.fontDesc,this.Rm(t,i,n);var h=this.Em(i.lineHeight,t.actualFontSize,t.fontSize);s.lineJoin="round",t.isOutlined?(s.fillStyle="rgba("+t.outlineColor.r+", "+t.outlineColor.g+", "+t.outlineColor.b+", "+wU+")",s.fillRect(0,0,e.width,e.height)):(s.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+wU+")",s.fillRect(0,0,e.width,e.height)),s.fillStyle="rgb("+t.color.r+", "+t.color.g+", "+t.color.b+")";var u=n.startPosition,o=new Ms(u.x,u.y),c=o.x,a=0;this.Mm(o,h,t,i,n);for(var f=n.parsedString,v=0;v<f.length;++v)a=o.y+v*h,t.hasShadow&&(this.Cm(t),s.fillText(f[v],c,a)),t.isOutlined&&(this.Nm(t),s.strokeText(f[v],c,a)),t.hasShadow&&!t.isOutlined||s.fillText(f[v],c,a);t.hasShadow&&(s.shadowColor="transparent"),this.Pm(r)}},i.Pm=function(t){var i,n=this.Dr;t.texture&&n&&(i=t.texture instanceof wL?t.texture.texture:t.texture,0!==n.width&&0!==n.height&&(i.getGFXTexture(),i.getGFXSampler(),i.reset({width:n.width,height:n.height,mipmapLevel:1}),i.uploadData(n),i.setWrapMode(2,2),t.texture instanceof wL&&(t.texture.rect=new ee(0,0,n.width,n.height),t.texture.cp()),T.director.root&&T.director.root.batcher2D&&T.director.root.batcher2D._s(i.getHash())))},i.Mm=function(t,i,n,r,s){if(n.hasShadow||n.isOutlined||n.isUnderline){for(var e=this.Gs,h=s.parsedString,u=h.length>1&&n.hasShadow,o=this.Im(this.Gs,n.fontDesc),c=0,a=0,f=0;f<h.length;++f)if(c=t.x,a=t.y+f*i,u&&(n.hasShadow&&(this.Cm(n),e.fillText(h[f],c,a)),n.isOutlined&&(this.Nm(n),e.strokeText(h[f],c,a)),n.hasShadow&&!n.isOutlined||e.fillText(h[f],c,a)),n.isUnderline){var v=o(h[f]),l=new Ms;2===r.horizontalAlign?l.x=t.x-v:1===r.horizontalAlign?l.x=t.x-v/2:l.x=t.x,l.y=a+n.actualFontSize/8,e.fillRect(l.x,l.y,v,n.underlineHeight*this.am)}u&&(e.shadowColor="transparent")}},i.Nm=function(t){var i=this.Gs;i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0,i.strokeStyle="rgba("+t.outlineColor.r+", "+t.outlineColor.g+", "+t.outlineColor.b+", "+t.outlineColor.a/255+")",i.lineWidth=2*t.outlineWidth*this.am},i.Cm=function(t){var i=this.Gs,n=this.am;i.shadowColor="rgba("+t.shadowColor.r+", "+t.shadowColor.g+", "+t.shadowColor.b+", "+t.shadowColor.a/255+")",i.shadowBlur=t.shadowBlur*n,i.shadowOffsetX=t.shadowOffsetX*n,i.shadowOffsetY=-t.shadowOffsetY*n},i.ym=function(t,i,n,r,s,e,h){t?this.Lm(i,n,r,s,e,h):(this.Dm(s),h(i,r,s))},i.Dm=function(t){var i=t.vertexBuffer,n=t.quadCount;if(i.length!==n){for(var r=i.length;r<n;r++)i.push({x:0,y:0,z:0,u:0,v:0,color:Qs.WHITE.clone()});i.length=n}},i.vm=function(t,i){var n=i.nodeContentSize,r=n.width,s=n.height;3===t.overFlow&&(s=0),0===t.overFlow&&(r=0,s=0),t.textWidthTemp=r,t.textHeightTemp=s,t.textDimensions.width=r,t.textDimensions.height=s,t.maxLineWidth=r},i.lm=function(t){t.bmfontScale=t.actualFontSize/(t.originFontSize*this.am)},i.dm=function(t,i,n){var r=n,s=r.length;if(t.fntConfig){var e=t.fntConfig.kerningDict,h=i.horizontalKerning;if(e&&0!==e.length)for(var u=-1,o=0;o<s;++o){var c=r.charCodeAt(o),a=e[u<<16|65535&c]||0;h[o]=o<s-1?a:0,u=c}}},i.wm=function(t,i,n,r){this.Bm(t,i,n,r,this.Fm),2===i.overFlow&&(t.fontSize>0&&this.Um(t,i,n,r,this)&&this.xm(t,i,n,r,this.Um),t.fontSize>0&&this.Gm(i,n)&&this.xm(t,i,n,r,this.jm)),this.Hm(n,r)},i.Hm=function(t,i){for(var n=[],r="",s=0,e=0,h=GL(i);s<h;++s){var u=this.hm[s];u.valid&&(e===u.line?r+=u.char:(n=n.concat(r),e=u.line,r=""))}n=n.concat(r),t.parsedString=n},i.Bm=function(t,i,n,r,s){i.linesWidth.length=0;for(var e=r,h=e.length,u=0,o=0,c=0,a=0,f=0,v=0,l=0,d=null,w=0;w<h;){var g=jL(e,w);if("\n"!==g){for(var p=s(t,i,e,w,h),_=v,y=l,m=f,b=o,k=!1,A=new Ms,E=0;E<p;++E){var T=w+E;if("\r"!==(g=jL(e,T)))if(d=ND.fontAtlas.getLetterDefinitionForChar(g,ND)){var O=b+d.offsetX*t.bmfontScale-ND.margin;if(i.wrapping&&i.maxLineWidth>0&&o>0&&O+d.w*t.bmfontScale>i.maxLineWidth&&!UL(g)){i.linesWidth.push(f),f=0,u++,o=0,c-=i.lineHeight*this.Vm(t,i)+0,k=!0;break}A.x=O,A.y=c-d.offsetY*t.bmfontScale,this.$m(A,g,T,u),T+1<i.horizontalKerning.length&&T<h-1&&(b+=i.horizontalKerning[T+1]*t.bmfontScale),b+=d.xAdvance*t.bmfontScale+i.spacingX,m=A.x+d.w*t.bmfontScale,_<A.y&&(_=A.y),y>A.y-d.h*t.bmfontScale&&(y=A.y-d.h*t.bmfontScale)}else this.zm(T,g),null!=t.fntConfig?tt(16354,t.fntConfig.atlasName,g):tt(16355,t.fontFamily,g);else this.zm(T,g)}k||(o=b,v<_&&(v=_),l>y&&(l=y),a<(f=m)&&(a=f),w+=p)}else i.linesWidth.push(f),f=0,u++,o=0,c-=i.lineHeight*this.Vm(t,i)+0,this.zm(w,g),w++}i.linesWidth.push(f),i.numberOfLines=u+1,i.textDesiredHeight=i.numberOfLines*i.lineHeight*this.Vm(t,i),i.numberOfLines>1&&(i.textDesiredHeight+=0*(i.numberOfLines-1));var S=n.nodeContentSize;return S.width=i.textWidthTemp,S.height=i.textHeightTemp,i.textWidthTemp<=0&&(S.width=parseFloat(a.toFixed(2))+2*ND.margin),i.textHeightTemp<=0&&(S.height=parseFloat(i.textDesiredHeight.toFixed(2))+2*ND.margin),i.tailoredTopY=S.height,i.tailoredBottomY=0,v>0&&(i.tailoredTopY=S.height+v),l<-i.textDesiredHeight&&(i.tailoredBottomY=i.textDesiredHeight+l),!0},i.zm=function(t,i){var n=this.hm;if(t>=n.length){var r=new gU;n.push(r)}n[t].char=i,n[t].hash=""+HL(i,0)+ND.hash,n[t].valid=!1},i.$m=function(t,i,n,r){var s=this.hm;if(n>=s.length){var e=new gU;s.push(e)}var h=""+HL(i,0)+ND.hash;s[n].line=r,s[n].char=i,s[n].hash=h,s[n].valid=ND.fontAtlas.getLetter(h).valid,s[n].x=t.x,s[n].y=t.y},i.Fm=function(t,i,n,r,s){var e=jL(n,r);if(FL(e)||"\n"===e||UL(e))return 1;var h=ND.fontAtlas,u=1,o=h.getLetterDefinitionForChar(e,ND);if(!o)return u;for(var c=o.xAdvance*t.bmfontScale+i.spacingX,a=r+1;a<s&&(e=jL(n,a),o=h.getLetterDefinitionForChar(e,ND));++a){if(c+o.offsetX*t.bmfontScale+o.w*t.bmfontScale>i.maxLineWidth&&!UL(e)&&i.maxLineWidth>0)return u;if(c+=o.xAdvance*t.bmfontScale+i.spacingX,"\n"===e||UL(e)||FL(e))break;u++}return u},i._m=function(t,i,n){var r=n.nodeContentSize;switch(i.linesOffsetX.length=0,i.letterOffsetY=0,i.horizontalAlign){case 0:for(var s=0;s<i.numberOfLines;++s)i.linesOffsetX.push(0);break;case 1:for(var e=0,h=i.linesWidth.length;e<h;e++)i.linesOffsetX.push((r.width-i.linesWidth[e])/2);break;case 2:for(var u=0,o=i.linesWidth.length;u<o;u++)i.linesOffsetX.push(r.width-i.linesWidth[u])}if(i.letterOffsetY=r.height,0!==i.verticalAlign){var c=r.height-i.textDesiredHeight+i.lineHeight*this.Vm(t,i)-t.originFontSize*this.am*t.bmfontScale;2===i.verticalAlign?i.letterOffsetY-=c:i.letterOffsetY-=c/2}},i.Vm=function(t,i){return 2===i.overFlow?t.bmfontScale:1},i.Um=function(t,i,n){return i.textDesiredHeight>n.nodeContentSize.height},i.jm=function(t,i,n,r,s){for(var e=!1,h=0,u=GL(r);h<u;++h){var o=s.hm[h];if(o.valid){var c=ND.fontAtlas.getLetterDefinitionForChar(o.char,ND);if(!c)continue;var a=o.x+c.w*t.bmfontScale,f=o.line;if(i.textWidthTemp>0){var v=n.nodeContentSize;if(i.wrapping){if(i.linesWidth[f]>v.width&&(a>v.width||a<0)){e=!0;break}}else if(a>v.width){e=!0;break}}}}return e},i.Gm=function(t,i){for(var n=0,r=t.linesWidth.length;n<r;++n)if(t.linesWidth[n]>i.nodeContentSize.width)return!0;return!1},i.xm=function(t,i,n,r,s){for(var e=0,h=0|t.actualFontSize,u=0;e<h;){var o=u=e+h+1>>1;if(o<=0)break;t.bmfontScale=o/(t.originFontSize*this.am),this.Bm(t,i,n,r,this.Fm),this._m(t,i,n),s(t,i,n,r,this)?h=u-1:e=u}e>=0&&this.Wm(t,i,n,r,e)},i.Wm=function(t,i,n,r,s){var e=!0;s||(s=.1,e=!1),t.actualFontSize=s,e&&(this.lm(t),this.Bm(t,i,n,r,this.Fm))},i.Lm=function(t,i,n,r,s,e){for(var h=ND.fontAtlas,u=t.spriteFrame?t.spriteFrame.texture:h.getTexture(),o=n.nodeContentSize,c=r.uiTransAnchorX*o.width,a=r.uiTransAnchorY*o.height,f=0,v=GL(s);f<v;++f){var l=this.hm[f];if(l.valid){var d=h.getLetter(l.hash);if(d){var w=this.um;w.height=d.h,w.width=d.w,w.x=d.u,w.y=d.v;var g=l.y+i.letterOffsetY;if(i.textHeightTemp>0){if(g>i.tailoredTopY){var p=g-i.tailoredTopY;w.y+=p,w.height-=p,g-=p}g-w.height*t.bmfontScale<i.tailoredBottomY&&1===i.overFlow&&(w.height=g<i.tailoredBottomY?0:(g-i.tailoredBottomY)/t.bmfontScale)}var _=l.line,y=l.x+d.w/2*t.bmfontScale+i.linesOffsetX[_];if(i.textWidthTemp>0&&this.Xm(i,n,y,_)&&1===i.overFlow&&(w.width=0),w.height>0&&w.width>0){var m=this.Ym(t),b=l.x+i.linesOffsetX[l.line],k=r.quadCount;r.quadCount+=4,this.Dm(r),e(t,n,r,k,u,w,m,b-c,g-a)}}else st(16353)}}return!0},i.Xm=function(t,i,n,r){var s=i.nodeContentSize,e=t.linesWidth[r],h=n>s.width||n<0;return t.wrapping?e>s.width&&h:h},i.Ym=function(t){var i=t.spriteFrame;if(!i)return!1;var n=i.isRotated(),r=i.getOriginalSize(),s=i.getRect(),e=i.getOffset(),h=e.x+(r.width-s.width)/2,u=e.y-(r.height-s.height)/2,o=this.um;if(n){var c=o.x;o.x=s.x+s.height-o.y-o.height-u,o.y=c+s.y-h,o.y<0&&(o.height+=u)}else o.x+=s.x-h,o.y+=s.y+u;return n},t}();pU.instance=void 0,pU.instance=new pU;var _U=new CD(64,64),yU=new bD(null),mU=null,bU=null,kU=null,AU=null,EU=null,TU=function(){function t(){}var i=t.prototype;return i.updateProcessingData=function(t,i,n,r,s,e){t.fontSize=s.fontSize,t.actualFontSize=s.fontSize,t.originFontSize=kU?kU.fontSize:s.fontSize,i.horizontalAlign=s.horizontalAlign,i.verticalAlign=s.verticalAlign,i.spacingX=s.spacingX;var h=s.overflow;i.overFlow=h,i.lineHeight=s.lineHeight;var u=n.nodeContentSize;u.width=e.width,u.height=e.height,0===h?(i.wrapping=!1,u.width+=2*ND.margin,u.height+=2*ND.margin):3===h?(i.wrapping=!0,u.height+=2*ND.margin):i.wrapping=s.enableWrapText,r.uiTransAnchorX=e.anchorX,r.uiTransAnchorY=e.anchorY,ND.lineHeight=s.lineHeight,ND.fontSize=s.fontSize,t.spriteFrame=AU,t.fntConfig=kU,t.fontFamily=ND.fontFamily,t.color.set(s.color)},i.updateRenderData=function(t){if(t.renderData&&mU!==t){if(t.renderData.vertDirty){bU=(mU=t).node.qu();var i=t.renderData,n=pU.instance,r=t.textStyle,s=t.textLayout,e=t.textLayoutData,h=t.textRenderData;r.fontScale=ZN.getScaleX(),this._updateFontFamily(t),this.updateProcessingData(r,s,e,h,t,bU),this._updateLabelInfo(t),r.fontDesc=ND.fontDesc,n.processingString(!0,r,s,e,t.string),h.quadCount=0,n.generateRenderInfo(!0,r,s,e,h,t.string,this.generateVertexData),i.dataLength!==h.quadCount&&(this.resetRenderData(t),i.dataLength=h.quadCount,i.resize(i.dataLength,i.dataLength/2*3));for(var u=i.data,o=0,c=h.quadCount;o<c;o++)u[o]=h.vertexBuffer[o];var a=i.indexCount;this.createQuadIndices(a),i.chunk.setIndexBuffer(EU),mU.actualFontSize=r.actualFontSize,bU.setContentSize(e.nodeContentSize),this.updateUVs(t),i.vertDirty=!1,mU=null,this._resetProperties()}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},i.updateUVs=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,r=i.vertexCount,s=i.floatStride,e=i.data,h=3,u=0;u<r;u++){var o=e[u];n[h]=o.u,n[h+1]=o.v,h+=s}},i.updateColor=function(t){t.renderData},i.resetRenderData=function(t){var i=t.renderData;i&&(i.dataLength=0,i.resize(0,0))},i.generateVertexData=function(t,i,n,r,s,e,h,u,o){var c=r,a=t.bmfontScale,f=n.vertexBuffer,v=s.width,l=s.height,d=e.width,w=e.height,g=0,p=0,_=0,y=0;h?(g=e.x/v,y=(e.x+w)/v,p=(e.y+d)/l,_=e.y/l,f[c].u=g,f[c].v=_,f[c+1].u=g,f[c+1].v=p,f[c+2].u=y,f[c+2].v=_,f[c+3].u=y,f[c+3].v=p):(g=e.x/v,y=(e.x+d)/v,p=(e.y+w)/l,_=e.y/l,f[c].u=g,f[c].v=p,f[c+1].u=y,f[c+1].v=p,f[c+2].u=g,f[c+2].v=_,f[c+3].u=y,f[c+3].v=_),f[c].x=u,f[c].y=o-w*a,f[c+1].x=u+d*a,f[c+1].y=o-w*a,f[c+2].x=u,f[c+2].y=o,f[c+3].x=u+d*a,f[c+3].y=o},i._updateFontFamily=function(t){var i=t.font;AU=i.spriteFrame,kU=i.fntConfig,ND.fontAtlas=i.fontDefDictionary,ND.fontAtlas||(2===t.cacheMode?ND.fontAtlas=_U:ND.fontAtlas=yU),cP.packToDynamicAtlas(t,AU)},i._updateLabelInfo=function(){ND.hash="",ND.margin=0},i._resetProperties=function(){kU=null,AU=null,ND.hash="",ND.margin=0},i.createQuadIndices=function(t){if(t%6==0){var i=t/6;EU=new Uint16Array(t);for(var n=0,r=0;r<i;r++)EU[n++]=0+4*r,EU[n++]=1+4*r,EU[n++]=2+4*r,EU[n++]=1+4*r,EU[n++]=3+4*r,EU[n++]=2+4*r}else ht(16308)},t}(),OU=new Qs(255,255,255,255),SU=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.createData=function(t){var i=t.requestRenderData();return i.resize(0,0),i},n.fillBuffers=function(t){var i=t.node;OU.set(t.color),OU.a=255*i._uiProps.opacity,Ew(i,0,t.renderData,OU)},i}(TU),IU=new SU,RU=null,MU=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.getAssemblerData=function(){return RU||(RU=new CD(1024,1024)),RU.getTexture()},n._updateFontFamily=function(t){ND.fontAtlas=RU,ND.fontFamily=this._getFontFamily(t),t.enableOutline&&t.outlineWidth>0?(ND.isOutlined=!0,ND.margin=t.outlineWidth,ND.out=t.outlineColor.clone(),ND.out.a=t.outlineColor.a*t.color.a/255):(ND.isOutlined=!1,ND.margin=0)},n._getFontFamily=function(t){var i="Arial";return t.useSystemFont?i=t.fontFamily||"Arial":t.font&&(i=t.font._nativeAsset||"Arial"),i},n._updateLabelInfo=function(t){ND.fontDesc=this._getFontDesc(),ND.color.set(t.color),ND.hash=PD(ND)},n._getFontDesc=function(){return ND.fontSize.toString()+"px "+ND.fontFamily},i}(TU),CU=new Qs(255,255,255,255),NU=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.createData=function(t){var i=t.requestRenderData();return i.resize(0,0),i},n.fillBuffers=function(t){if(t.renderData){var i=t.node;CU.a=255*i._uiProps.opacity,Ew(i,0,t.renderData,CU)}},n.updateColor=function(t){t.renderData},i}(MU),PU=new NU;KF.Overflow;var LU=function(){function t(){}var i=t.prototype;return i.updateProcessingData=function(t,i,n,r,s,e){t.isSystemFontUsed=s.useSystemFont,t.fontSize=s.fontSize,n.nodeContentSize.width=n.canvasSize.width=e.width,n.nodeContentSize.height=n.canvasSize.height=e.height,i.lineHeight=s.lineHeight,i.overFlow=s.overflow,0===s.overflow?i.wrapping=!1:3===s.overflow?i.wrapping=!0:i.wrapping=s.enableWrapText,t.isBold=s.isBold,t.isItalic=s.isItalic,t.isUnderline=s.isUnderline,t.underlineHeight=s.underlineHeight,s.enableOutline&&s.outlineWidth>0?(t.isOutlined=!0,t.outlineColor.set(s.outlineColor),t.outlineWidth=s.outlineWidth):t.isOutlined=!1,s.enableShadow&&(s.shadowBlur>0||!xn(s.shadowOffset.x,0)||!xn(s.shadowOffset.y,0))?(t.hasShadow=!0,t.shadowColor.set(s.shadowColor),t.shadowBlur=s.shadowBlur,t.shadowOffsetX=s.shadowOffset.x,t.shadowOffsetY=s.shadowOffset.y):t.hasShadow=!1,t.color.set(s.color),r.texture=s.spriteFrame,r.uiTransAnchorX=e.anchorX,r.uiTransAnchorY=e.anchorY,i.horizontalAlign=s.horizontalAlign,i.verticalAlign=s.verticalAlign},i.getAssemblerData=function(){var t=KF._canvasPool.ci();return t.canvas.width=t.canvas.height=1,t},i.resetAssemblerData=function(t){t&&KF._canvasPool.fi(t)},i.updateRenderData=function(t){var i=t.renderData;if(i){if(i.vertDirty){var n=t.node.qu(),r=pU.instance,s=t.textStyle,e=t.textLayout,h=t.textLayoutData,u=t.textRenderData;s.fontScale=ZN.getScaleX(),this.updateProcessingData(s,e,h,u,t,n),r.setCanvasUsed(t.assemblerData.canvas,t.assemblerData.context),s.fontFamily=this._updateFontFamily(t),this._resetDynamicAtlas(t),r.processingString(!1,s,e,h,t.string),r.generateRenderInfo(!1,s,e,h,u,t.string,this.generateVertexData),i.textureDirty=!0,this._calDynamicAtlas(t,h),t.actualFontSize=s.actualFontSize,n.setContentSize(h.nodeContentSize);var o=i.data,c=u.vertexBuffer;o[0]=c[0],o[1]=c[1],o[2]=c[2],o[3]=c[3],this.updateUVs(t),i.vertDirty=!1,t.contentWidth=h.nodeContentSize.width}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},i.generateVertexData=function(t,i,n){var r=n.vertexBuffer,s=i.nodeContentSize,e=s.width,h=s.height,u=n.uiTransAnchorX*e,o=n.uiTransAnchorY*h;r[0].x=-u,r[0].y=-o,r[1].x=e-u,r[1].y=-o,r[2].x=-u,r[2].y=h-o,r[3].x=e-u,r[3].y=h-o},i.updateVertexData=function(){},i.updateUVs=function(){},i._updateFontFamily=function(t){return t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},i._calDynamicAtlas=function(t,i){if(!(1!==t.cacheMode||i.canvasSize.width<=0||i.canvasSize.height<=0)){var n=t.ttfSpriteFrame;cP.packToDynamicAtlas(t,n)}},i._resetDynamicAtlas=function(t){if(1===t.cacheMode){var i=t.ttfSpriteFrame;cP.deleteAtlasSpriteFrame(i),i._resetDynamicAtlasFrame()}},t}(),DU=Qs.WHITE.clone(),BU=Uint16Array.from([0,1,2,1,3,2]),FU=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.createData=function(t){var i=t.requestRenderData();i.dataLength=4,i.resize(4,6),t.textRenderData.quadCount=4;for(var n=i.chunk.vb,r=i.floatStride,s=[{u:0,v:1},{u:1,v:1},{u:0,v:0},{u:1,v:0}],e=3,h=0,u=i.dataLength;h<u;++h)n[e]=s[h].u,n[e+1]=s[h].v,e+=r;for(var o=5,c=0;c<i.dataLength;c++)Qs.toArray(n,DU,o),o+=r;return i.chunk.setIndexBuffer(BU),i},n.fillBuffers=function(t){var i=t.renderData;if(i){for(var n=i.chunk,r=i.data,s=t.node,e=n.vb,h=s.worldMatrix,u=i.floatStride,o=0,c=r.length,a=0;a<c;a++){var f=r[a],v=f.x,l=f.y,d=h.m03*v+h.m07*l+h.m15;d=d?1/d:1,e[0+(o=a*u)]=(h.m00*v+h.m04*l+h.m12)*d,e[o+1]=(h.m01*v+h.m05*l+h.m13)*d,e[o+2]=(h.m02*v+h.m06*l+h.m14)*d}var w=n.vertexOffset,g=n.meshBuffer,p=n.meshBuffer.iData,_=g.indexOffset;p[_++]=w,p[_++]=w+1,p[_++]=w+2,p[_++]=w+2,p[_++]=w+1,p[_++]=w+3,g.indexOffset+=6}},n.updateVertexData=function(t){var i=t.renderData;if(i){var n=t.node.qu(),r=n.width,s=n.height,e=n.anchorX*r,h=n.anchorY*s,u=i.data;u[0].x=-e,u[0].y=-h,u[1].x=r-e,u[1].y=-h,u[2].x=-e,u[2].y=s-h,u[3].x=r-e,u[3].y=s-h}},n.updateUVs=function(t){var i=t.renderData;if(i&&t.ttfSpriteFrame)for(var n=i.chunk.vb,r=t.ttfSpriteFrame.uv,s=i.floatStride,e=3,h=0;h<i.dataLength;++h){var u=2*h;n[e]=r[u],n[e+1]=r[u+1],e+=s}},n.updateColor=function(){},i}(LU),UU=new FU,xU=t("l",{getAssembler:function(t){var i=UU;return t.font instanceof kD?i=IU:2===t.cacheMode&&(i=PU),i}});KF.Assembler=xU,tU.FillType;var GU=new ls,jU=Uint16Array.from([0,1,2,1,3,2]),HU=function(){function t(){}var i=t.prototype;return i.updateRenderData=function(t){var i=t.spriteFrame;cP.packToDynamicAtlas(t,i);var n=t.renderData;if(n&&i){if(!n.vertDirty)return;var r=t.fillStart,s=t.fillRange;s<0&&(r+=s,s=-s),s=(s=(s=r+s)>1?1:s)<0?0:s;var e=(r=(r=r>1?1:r)<0?0:r)+(s=(s-=r)<0?0:s);e=e>1?1:e,this.updateUVs(t,r,e),this.Km(t,r,e),n.updateRenderData(t,i)}},i.updateUVs=function(t,i,n){var r=t.spriteFrame,s=t.renderData;if(s){var e=s.chunk.vb,h=r.width,u=r.height,o=r.rect,c=0,a=0,f=0,v=0,l=0,d=0,w=0,g=0,p=0,_=0;r.isRotated()?(c=o.x/h,a=(o.y+o.width)/u,f=l=c,w=p=(o.x+o.height)/h,d=_=a,v=g=o.y/u):(c=o.x/h,a=(o.y+o.height)/u,f=w=c,l=p=(o.x+o.width)/h,v=d=a,g=_=o.y/u);var y=s.floatStride,m=3;switch(t.fillType){case 0:e[m]=f+(l-f)*i,e[m+1]=v+(d-v)*i,e[m+=y]=f+(l-f)*n,e[m+1]=v+(d-v)*n,e[m+=y]=w+(p-w)*i,e[m+1]=g+(_-g)*i,e[m+=y]=w+(p-w)*n,e[m+1]=g+(_-g)*n;break;case 1:e[m]=f+(w-f)*i,e[m+1]=v+(g-v)*i,e[m+=y]=l+(p-l)*i,e[m+1]=d+(_-d)*i,e[m+=y]=f+(w-f)*n,e[m+1]=v+(g-v)*n,e[m+=y]=l+(p-l)*n,e[m+1]=d+(_-d)*n;break;default:ht(2626)}}},i.Km=function(t,i,n){var r=t.renderData;if(r){var s=r.data,e=t.node.qu(),h=e.width,u=e.height,o=e.anchorX*h,c=e.anchorY*u,a=-o,f=-c,v=h-o,l=u-c,d=0;switch(t.fillType){case 0:d=a+(v-a)*n,a+=(v-a)*i,v=d;break;case 1:d=f+(l-f)*n,f+=(l-f)*i,l=d;break;default:ht(2626)}s[0].x=a,s[0].y=f,s[1].x=v,s[1].y=f,s[2].x=a,s[2].y=l,s[3].x=v,s[3].y=l}},i.createData=function(t){var i=t.requestRenderData();return i.dataLength=4,i.resize(4,6),i.chunk.setIndexBuffer(jU),i.data.forEach((function(t){t.z=0})),i},i.qm=function(t,i){t.node.getWorldMatrix(GU);var n=t.renderData;if(n)for(var r=n.floatStride,s=t.renderData.data,e=i.vb,h=0,u=0;u<4;u++){var o=s[u],c=o.x,a=o.y,f=GU.m03*c+GU.m07*a+GU.m15;f=f?1/f:1,e[h=u*r]=(GU.m00*c+GU.m04*a+GU.m12)*f,e[h+1]=(GU.m01*c+GU.m05*a+GU.m13)*f,e[h+2]=(GU.m02*c+GU.m06*a+GU.m14)*f}},i.fillBuffers=function(t){var i=t.renderData;if(i){var n=i.chunk;(t.My!==t.node.flagChangedVersion||i.vertDirty)&&(this.qm(t,n),i.vertDirty=!1,t.My=t.node.flagChangedVersion),n.bufferId;var r=n.vertexOffset,s=n.meshBuffer,e=n.meshBuffer.iData,h=s.indexOffset;e[h++]=r,e[h++]=r+1,e[h++]=r+2,e[h++]=r+2,e[h++]=r+1,e[h++]=r+3,s.indexOffset+=6}},i.updateColor=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,r=i.floatStride,s=5,e=t.color,h=e.r/255,u=e.g/255,o=e.b/255,c=t.node._uiProps.opacity,a=0;a<4;a++)n[s]=h,n[s+1]=u,n[s+2]=o,n[s+3]=c,s+=r},t}(),VU=new HU,$U=2*Math.PI,zU=1e-6,WU=new ls,XU=[new Ms,new Ms,new Ms,new Ms],YU=new Array(4),KU=new Array(8),qU=[new Ms,new Ms,new Ms,new Ms],QU=[new Ms,new Ms,new Ms,new Ms],JU=new Ms,ZU=[new Ms,new Ms,new Ms,new Ms];function tx(t,i,n,r,s,e,h){var u=Math.sin(e);u=Math.abs(u)>zU?u:0;var o=Math.cos(e),c=0,a=0;if(0!==(o=Math.abs(o)>zU?o:0)){if(c=u/o,(t-s.x)*o>0){var f=s.y+c*(t-s.x);h[0].x=t,h[0].y=f}if((i-s.x)*o>0){var v=s.y+c*(i-s.x);h[2].x=i,h[2].y=v}}if(0!==u){if(a=o/u,(r-s.y)*u>0){var l=s.x+a*(r-s.y);h[3].x=l,h[3].y=r}if((n-s.y)*u>0){var d=s.x+a*(n-s.y);h[1].x=d,h[1].y=n}}}function ix(t){var i=t.node.qu(),n=i.width,r=i.height,s=i.anchorX*n,e=i.anchorY*r,h=-s,u=-e,o=n-s,c=r-e,a=YU;a[0]=h,a[1]=u,a[2]=o,a[3]=c;var f=t.fillCenter,v=JU.x=Math.min(Math.max(0,f.x),1)*(o-h)+h,l=JU.y=Math.min(Math.max(0,f.y),1)*(c-u)+u;XU[0].x=XU[3].x=h,XU[1].x=XU[2].x=o,XU[0].y=XU[1].y=u,XU[2].y=XU[3].y=c,ZU.forEach((function(t){Ms.set(t,0,0)})),v!==a[0]&&Ms.set(ZU[0],3,0),v!==a[2]&&Ms.set(ZU[2],1,2),l!==a[1]&&Ms.set(ZU[1],0,1),l!==a[3]&&Ms.set(ZU[3],2,3)}function nx(t){var i=t.width,n=t.height,r=t.getRect(),s=0,e=0,h=0,u=0,o=KU;t.isRotated()?(s=r.x/i,e=(r.x+r.height)/i,h=r.y/n,u=(r.y+r.width)/n,o[0]=o[2]=s,o[4]=o[6]=e,o[3]=o[7]=u,o[1]=o[5]=h):(s=r.x/i,e=(r.x+r.width)/i,h=r.y/n,u=(r.y+r.height)/n,o[0]=o[4]=s,o[2]=o[6]=e,o[1]=o[3]=u,o[5]=o[7]=h)}function rx(t,i){var n=i.x-t.x,r=i.y-t.y;if(0===n&&0===r)return 0;if(0===n)return r>0?.5*Math.PI:1.5*Math.PI;var s=Math.atan(r/n);return n<0&&(s+=Math.PI),s}function sx(t,i,n,r,s){var e=YU,h=e[0],u=e[1],o=e[2],c=e[3];t[i].x=n.x,t[i].y=n.y,t[i+1].x=r.x,t[i+1].y=r.y,t[i+2].x=s.x,t[i+2].y=s.y,ex((n.x-h)/(o-h),(n.y-u)/(c-u),t,i),ex((r.x-h)/(o-h),(r.y-u)/(c-u),t,i+1),ex((s.x-h)/(o-h),(s.y-u)/(c-u),t,i+2)}function ex(t,i,n,r){var s=KU,e=s[0]+(s[2]-s[0])*t,h=s[4]+(s[6]-s[4])*t,u=s[1]+(s[3]-s[1])*t,o=s[5]+(s[7]-s[5])*t,c=n[r];c.u=e+(h-e)*i,c.v=u+(o-u)*i}for(var hx=function(){function t(){}var i=t.prototype;return i.createData=function(t){return t.requestRenderData()},i.updateRenderData=function(t){var i=t.spriteFrame;cP.packToDynamicAtlas(t,i),this.updateUVs(t);var n=t.renderData;if(n&&i){if(!n.vertDirty)return;var r=n.data,s=t.fillStart,e=t.fillRange;for(e<0&&(s+=e,e=-e);s>=1;)s-=1;for(;s<0;)s+=1;var h=(s*=$U)+(e*=$U);ix(t),nx(i),tx(YU[0],YU[2],YU[1],YU[3],JU,s,qU),tx(YU[0],YU[2],YU[1],YU[3],JU,s+e,QU);for(var u=0,o=0;o<4;++o){var c=ZU[o];if(c)if(e>=$U)n.dataLength=u+3,sx(r,u,JU,XU[c.x],XU[c.y]),u+=3;else{var a=rx(JU,XU[c.x]),f=rx(JU,XU[c.y]);f<a&&(f+=$U),a-=$U,f-=$U;for(var v=0;v<3;++v)a>=h||(a>=s?(n.dataLength=u+3,sx(r,u,JU,XU[c.x],f>=h?QU[o]:XU[c.y]),u+=3):f>s&&(f<=h?(n.dataLength=u+3,sx(r,u,JU,qU[o],XU[c.y]),u+=3):(n.dataLength=u+3,sx(r,u,JU,qU[o],QU[o]),u+=3))),a+=$U,f+=$U}}0===u&&(n.dataLength=0),n.resize(u,u),n.updateRenderData(t,i)}},i.Qm=function(){},i.fillBuffers=function(t){var i=t.node,n=t.renderData;if(n){var r=n.chunk;(t.My!==i.flagChangedVersion||n.vertDirty)&&(this.Jm(t,r),n.vertDirty=!1,t.My=i.flagChangedVersion),this.Zm(t),r.bufferId;for(var s=r.vertexOffset,e=r.meshBuffer,h=r.meshBuffer.iData,u=e.indexOffset,o=0;o<n.indexCount;o++)h[u+o]=s+o;e.indexOffset+=n.indexCount,e.setDirty()}},i.tb=function(){},i.Jm=function(t,i){t.node.getWorldMatrix(WU);var n=t.renderData;if(n)for(var r=n.floatStride,s=t.renderData.data,e=i.vb,h=n.vertexCount,u=0,o=0;o<h;o++){var c=s[o],a=c.x,f=c.y,v=WU.m03*a+WU.m07*f+WU.m15;v=v?1/v:1,e[u+0]=(WU.m00*a+WU.m04*f+WU.m12)*v,e[u+1]=(WU.m01*a+WU.m05*f+WU.m13)*v,e[u+2]=(WU.m02*a+WU.m06*f+WU.m14)*v,e[u+3]=c.u,e[u+4]=c.v,u+=r}},i.updateUVs=function(t){var i=t.renderData;i&&(i.vertDirty=!0,t.vo())},i.Zm=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,r=i.floatStride,s=i.vertexCount,e=5,h=t.color,u=h.r/255,o=h.g/255,c=h.b/255,a=t.node._uiProps.opacity,f=0;f<s;f++)n[e]=u,n[e+1]=o,n[e+2]=c,n[e+3]=a,e+=r},i.updateColor=function(){},t}(),ux=new hx,ox=Uint16Array.from([0,1,2,1,3,2]),cx=function(){function t(){}var i=t.prototype;return i.createData=function(t){var i=t.requestRenderData();return i.dataLength=4,i.resize(4,6),i.chunk.setIndexBuffer(ox),i},i.updateRenderData=function(t){var i=t.spriteFrame;cP.packToDynamicAtlas(t,i),this.updateUVs(t);var n=t.renderData;n&&i&&(n.vertDirty&&this.Km(t),n.updateRenderData(t,i))},i.ib=function(t,i){var n=t.renderData;if(n)for(var r=i.vb,s=n.data,e=t.node.worldMatrix,h=e.m00,u=e.m01,o=e.m02,c=e.m03,a=e.m04,f=e.m05,v=e.m06,l=e.m07,d=e.m12,w=e.m13,g=e.m14,p=e.m15,_=n.floatStride,y=0,m=s.length,b=0;b<m;++b){var k=s[b],A=k.x,E=k.y,T=c*A+l*E+p;T=T?1/T:1,r[0+(y=b*_)]=(h*A+a*E+d)*T,r[y+1]=(u*A+f*E+w)*T,r[y+2]=(o*A+v*E+g)*T}},i.fillBuffers=function(t){if(null!==t){var i=t.renderData;if(i){var n=i.chunk;(t.My!==t.node.flagChangedVersion||i.vertDirty)&&(this.ib(t,n),i.vertDirty=!1,t.My=t.node.flagChangedVersion);var r=n.vertexOffset,s=n.meshBuffer,e=n.meshBuffer.iData,h=s.indexOffset,u=r;e[h++]=u,e[h++]=u+1,e[h++]=u+2,e[h++]=u+1,e[h++]=u+3,e[h++]=u+2,s.indexOffset+=6}}},i.Km=function(t){var i=t.renderData;if(i){var n=t.node.qu(),r=i.data,s=n.width,e=n.height,h=n.anchorX*s,u=n.anchorY*e,o=0,c=0,a=0,f=0;if(t.trim)o=-h,c=-u,a=s-h,f=e-u;else{var v=t.spriteFrame,l=v.originalSize,d=s/l.width,w=e/l.height,g=v.trimmedBorder;o=g.x*d-h,c=g.z*w-u,a=s+g.y*d-h,f=e+g.w*w-u}r[0].x=o,r[0].y=c,r[1].x=a,r[1].y=c,r[2].x=o,r[2].y=f,r[3].x=a,r[3].y=f,i.vertDirty=!0}},i.updateUVs=function(t){var i=t.renderData;if(t.spriteFrame&&i)for(var n=i.chunk.vb,r=t.spriteFrame.uv,s=i.floatStride,e=3,h=0;h<i.dataLength;++h){var u=2*h;n[e]=r[u],n[e+1]=r[u+1],e+=s}},i.updateColor=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,r=5,s=t.color,e=s.r/255,h=s.g/255,u=s.b/255,o=s.a/255,c=0;c<4;c++,r+=i.floatStride)n[r]=e,n[r+1]=h,n[r+2]=u,n[r+3]=o},t}(),ax=new cx,fx=[],vx=0;vx<4;vx++)fx.push({x:0,y:0,z:0,u:0,v:0,color:new Qs});var lx,dx,wx,gx,px,_x,yx,mx=function(){function t(){this.nb=void 0}var i=t.prototype;return i.createData=function(t){var i=t.requestRenderData();i.dataLength=16,i.resize(16,54);var n=this.nb=new Uint16Array(54);return this.Qm(4,4),i.chunk.setIndexBuffer(n),i},i.Qm=function(t,i){for(var n=0,r=this.nb,s=0;s<t-1;s++)for(var e=0;e<i-1;e++){var h=s*i+e;r[n++]=h,r[n++]=h+1,r[n++]=h+i,r[n++]=h+1,r[n++]=h+1+i,r[n++]=h+i}},i.updateRenderData=function(t){var i=t.spriteFrame;cP.packToDynamicAtlas(t,i),this.updateUVs(t);var n=t.renderData;n&&i&&(n.vertDirty&&this.Km(t),n.updateRenderData(t,i))},i.Km=function(t){var i=t.renderData;if(i){var n=i.data,r=t.node.qu(),s=r.width,e=r.height,h=r.anchorX*s,u=r.anchorY*e,o=t.spriteFrame,c=o.insetLeft,a=o.insetRight,f=o.insetTop,v=o.insetBottom,l=s-c-a,d=e-f-v,w=s/(c+a),g=e/(f+v);w=Number.isNaN(w)||w>1?1:w,g=Number.isNaN(g)||g>1?1:g,l=l<0?0:l,d=d<0?0:d,fx[0].x=-h,fx[0].y=-u,fx[1].x=c*w-h,fx[1].y=v*g-u,fx[2].x=fx[1].x+l,fx[2].y=fx[1].y+d,fx[3].x=s-h,fx[3].y=e-u;for(var p=0;p<4;p++)for(var _=0;_<4;_++){var y=4*p+_;y<i.dataLength&&p<fx.length&&_<fx.length&&(n[y].x=fx[_].x,n[y].y=fx[p].y)}}},i.fillBuffers=function(t){var i=t.renderData;if(i){var n=i.chunk;(t.My!==t.node.flagChangedVersion||i.vertDirty)&&(this.qm(t,n),i.vertDirty=!1,t.My=t.node.flagChangedVersion),n.bufferId;for(var r=n.vertexOffset,s=n.meshBuffer,e=n.meshBuffer.iData,h=s.indexOffset,u=0;u<3;++u)for(var o=0;o<3;++o){var c=r+4*u+o;e[h++]=c,e[h++]=c+1,e[h++]=c+4,e[h++]=c+1,e[h++]=c+5,e[h++]=c+4}s.indexOffset=h}},i.qm=function(t,i){var n=t.renderData;if(n)for(var r=n.floatStride,s=n.data,e=i.vb,h=t.node.worldMatrix,u=h.m00,o=h.m01,c=h.m02,a=h.m03,f=h.m04,v=h.m05,l=h.m06,d=h.m07,w=h.m12,g=h.m13,p=h.m14,_=h.m15,y=0,m=0;m<4;++m)for(var b=s[4*m],k=0;k<4;++k){var A=s[k].x,E=b.y,T=a*A+d*E+_;T=T?1/T:1,e[0+(y=(4*m+k)*r)]=(u*A+f*E+w)*T,e[y+1]=(o*A+v*E+g)*T,e[y+2]=(c*A+l*E+p)*T}},i.updateUVs=function(t){var i=t.renderData;if(t.spriteFrame&&i)for(var n=i.chunk.vb,r=i.floatStride,s=t.spriteFrame.uvSliced,e=3,h=0;h<16;h++)n[e]=s[h].u,n[e+1]=s[h].v,e+=r},i.updateColor=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,r=i.floatStride,s=5,e=t.color,h=e.r/255,u=e.g/255,o=e.b/255,c=t.node._uiProps.opacity,a=0;a<16;a++)n[s]=h,n[s+1]=u,n[s+2]=o,n[s+3]=c,s+=r},t}(),bx=new mx,kx=new ls,Ax=0,Ex=[];function Tx(t){return t&&(t.insetTop>0||t.insetBottom>0||t.insetLeft>0||t.insetRight>0)?2:0}var Ox=function(){function t(){}var i=t.prototype;return i.createData=function(t){return t.requestRenderData()},i.updateRenderData=function(t){var i=t.renderData;if(i){var n=t.spriteFrame;if(n&&i&&(cP.packToDynamicAtlas(t,n),i.vertDirty)){var r=t.node.qu(),s=Math.abs(r.width),e=Math.abs(r.height),h=n.getRect(),u=n.insetLeft,o=n.insetRight,c=h.width-u-o,a=n.insetTop,f=n.insetBottom,v=h.height-a-f,l=s-u-o,d=e-a-f;l=l>0?l:0,d=d>0?d:0;var w=0===c?l:l/c,g=0===v?d:d/v,p=Tx(n),_=Math.ceil(g+p),y=Math.ceil(w+p);i.dataLength=4*_*y,this.rb(t,l,d,_,y),i.resize(_*y*4,_*y*6),i.updateRenderData(t,n)}}},i.Qm=function(){},i.updateUVs=function(t){var i=t.renderData;i&&(i.vertDirty=!0,t.vo())},i.fillBuffers=function(t){var i=t.node,n=t.renderData;if(n){var r=n.chunk;if(null!==r){(t.My!==i.flagChangedVersion||n.vertDirty)&&(this.Jm(t,r),n.vertDirty=!1,t.My=i.flagChangedVersion),this.Zm(t),r.bufferId;for(var s=r.vertexOffset,e=r.meshBuffer,h=r.meshBuffer.iData,u=e.indexOffset,o=0;o<n.indexCount;o+=6)h[u++]=s,h[u++]=s+1,h[u++]=s+2,h[u++]=s+1,h[u++]=s+3,h[u++]=s+2,s+=4,e.indexOffset+=6;e.setDirty()}}},i.tb=function(t){var i=t.renderData;if(i)for(var n=i.floatStride,r=i.data,s=i.chunk.vb,e=0;e<r.length;e++){var h=e*n;s[h+3]=r[e].u,s[h+4]=r[e].v}},i.Jm=function(t,i){var n=t.renderData;if(n){t.node.getWorldMatrix(kx);for(var r=n.floatStride,s=n.data,e=i.vb,h=s.length,u=0;u<h;u++){var o=s[u].x,c=s[u].y,a=s[u].z,f=kx.m03*o+kx.m07*c+kx.m11*a+kx.m15;f=f?1/f:1;var v=u*r;e[v]=(kx.m00*o+kx.m04*c+kx.m08*a+kx.m12)*f,e[v+1]=(kx.m01*o+kx.m05*c+kx.m09*a+kx.m13)*f,e[v+2]=(kx.m02*o+kx.m06*c+kx.m10*a+kx.m14)*f}this.tb(t)}},i.rb=function(t,i,n,r,s){var e=t.node.qu(),h=t.renderData;if(h){var u,o,c=h.data,a=t.spriteFrame,f=a.rect,v=Math.abs(e.width),l=Math.abs(e.height),d=e.anchorX*v,w=e.anchorY*l,g=a.insetLeft,p=a.insetRight,_=f.width-g-p,y=a.insetTop,m=a.insetBottom,b=f.height-y-m,k=e.width/(g+p)>1?1:e.width/(g+p),A=e.height/(y+m)>1?1:e.height/(y+m);u=_>0?Math.floor(1e3*i)/1e3%_==0?_:i%_:i,o=b>0?Math.floor(1e3*n)/1e3%b==0?b:n%b:n,Ex.length=0,Ax=Math.max(r+1,s+1);for(var E=0;E<Ax;E++)Ex.push({x:0,y:0,z:0,u:0,v:0,color:new Qs});var T=Tx(a);if(0===T)for(var O=0;O<Ax;O++)Ex[O].x=O>=s?v-d:O*_-d,Ex[O].y=O>=r?l-w:O*b-w;else for(var S=0;S<Ax;S++)0===S?Ex[S].x=-d:1===S?Ex[S].x=g*k-d:S>1&&S<s-1?Ex[S].x=_>0?g*k-d+_*(S-1):g+i-d:S===s-1?Ex[S].x=g*k-d+u+_*(S-2):S>=s&&(Ex[S].x=Math.min(g+i+p,v)-d),0===S?Ex[S].y=-w:1===S?Ex[S].y=m*A-w:S>1&&S<r-1?Ex[S].y=b>0?m*A-w+b*(S-1):m+n-w:S===r-1?Ex[S].y=m*A-w+o+b*(S-2):S>=r&&(Ex[S].y=Math.min(m+n+y,l)-w);for(var I=0,R=0,M=0,C=0,N=0;N<r;++N){M=Ex[N].y,C=Ex[N+1].y;for(var P=0;P<s;++P){I=Ex[P].x,R=Ex[P+1].x;var L=4*(N*s+P);c[L].x=I,c[L].y=M,c[L+1].x=R,c[L+1].y=M,c[L+2].x=I,c[L+2].y=C,c[L+3].x=R,c[L+3].y=C}}var D=a.rotated;a.uv;var B=a.uvSliced;lx=B[0],dx=B[1],wx=B[2],gx=B[3],px=B[4],_x=B[8],yx=B[12];for(var F=0,U=0,x=0===_?i:i/_,G=0===b?n:n/b,j=[],H=[],V=0;V<r;++V){U=n>b?n>=(T>0?V:V+1)*b?1:G%1:G;for(var $=0;$<s;++$){F=i>_?i>=(T>0?$:$+1)*_?1:x%1:x,D?(0===T?(j[0]=px.u,j[1]=px.u,j[2]=px.u+(_x.u-px.u)*U,H[0]=dx.v,H[1]=dx.v+(wx.v-dx.v)*F,H[2]=dx.v):(0===V?(j[0]=lx.u,j[1]=lx.u,j[2]=px.u):V<r-1?(j[0]=px.u,j[1]=px.u,j[2]=px.u+(_x.u-px.u)*U):V===r-1&&(j[0]=_x.u,j[1]=_x.u,j[2]=yx.u),0===$?(H[0]=lx.v,H[1]=dx.v,H[2]=lx.v):$<s-1?(H[0]=dx.v,H[1]=dx.v+(wx.v-dx.v)*F,H[2]=dx.v):$===s-1&&(H[0]=wx.v,H[1]=gx.v,H[2]=wx.v)),j[3]=j[2],H[3]=H[1]):(0===T?(j[0]=dx.u,j[1]=dx.u+(wx.u-dx.u)*F,j[2]=dx.u,H[0]=px.v,H[1]=px.v,H[2]=px.v+(_x.v-px.v)*U):(0===$?(j[0]=lx.u,j[1]=dx.u,j[2]=lx.u):$<s-1?(j[0]=dx.u,j[1]=dx.u+(wx.u-dx.u)*F,j[2]=dx.u):$===s-1&&(j[0]=wx.u,j[1]=gx.u,j[2]=wx.u),0===V?(H[0]=lx.v,H[1]=lx.v,H[2]=px.v):V<r-1?(H[0]=px.v,H[1]=px.v,H[2]=px.v+(_x.v-px.v)*U):V===r-1&&(H[0]=_x.v,H[1]=_x.v,H[2]=yx.v)),j[3]=j[1],H[3]=H[2]);var z=4*(V*s+$);c[z].u=j[0],c[z].v=H[0],c[z+1].u=j[1],c[z+1].v=H[1],c[z+2].u=j[2],c[z+2].v=H[2],c[z+3].u=j[3],c[z+3].v=H[3]}}}},i.Zm=function(t){var i=t.renderData;if(i)for(var n=i.chunk.vb,r=i.floatStride,s=i.vertexCount,e=5,h=t.color,u=h.r/255,o=h.g/255,c=h.b/255,a=t.node._uiProps.opacity,f=0;f<s;f++)n[e]=u,n[e+1]=o,n[e+2]=c,n[e+3]=a,e+=r},i.updateColor=function(){},t}(),Sx=new Ox;tU.Type,tU.FillType;var Ix=t("s",{getAssembler:function(t){var i=ax,n=t;switch(n.type){case 1:i=bx;break;case 2:i=Sx;break;case 3:i=2===n.fillType?ux:VU}return i}});tU.Assembler=Ix;var Rx=t("S",function(){function t(){this.sb=[],this.eb={stencilTest:!0,func:7,stencilMask:65535,writeMask:65535,failOp:1,zFailOp:1,passOp:1,ref:1},this.hb=0,this.ub=new Map,this.ob=new Map}var i=t.prototype;return i.pushMask=function(t){this.sb.push(t)},i.clear=function(t){return 2!==t.stencilStage?5:1},i.enableMask=function(){this.stage=3},i.exitMask=function(){0!==this.sb.length&&(this.sb.pop(),0===this.sb.length?this.stage=0:this.stage=3)},i.getWriteMask=function(){return 1<<this.sb.length-1},i.getExitWriteMask=function(){return 1<<this.sb.length},i.cb=function(){for(var t=0,i=0;i<this.sb.length;++i)t+=1<<i;return t},i.getMaskStackSize=function(){return this.sb.length},i.reset=function(){this.sb.length=0,this.stage=0},i.destroy=function(){this.ub.forEach((function(t){t.destroy()})),this.ub.clear()},i.getStencilStage=function(t,i){var n=0,r=!1,s=!1,e=1,h=this.ub;if(i&&i.passes[0]){var u=i.passes[0].depthStencilState,o=0,c=0;u.depthTest&&(o=1),u.depthWrite&&(c=1),n=o|c<<1|u.depthFunc<<2|t<<6|this.sb.length<<9,r=u.depthTest,s=u.depthWrite,e=u.depthFunc,h=this.ob}else n=t<<16|this.sb.length;if(h&&h.has(n))return h.get(n);this.fb(t);var a=this.eb,f=new uw(r,s,e,a.lb,a.wb,a.gb,a.pb,a._b,a.yb,a.mb,a.kb,a.lb,a.wb,a.gb,a.pb,a._b,a.yb,a.mb,a.kb);return h.set(n,f),f},i.getStencilHash=function(t){return t<<8|this.sb.length},i.fb=function(t){var i=this.eb;0===t?(i.lb=!1,i.wb=7,i._b=1,i.gb=i.pb=65535,i.kb=1):(i.lb=!0,3===t?(i.wb=2,i._b=1,i.gb=i.kb=this.cb(),i.pb=this.getWriteMask()):1===t?(i.wb=0,i._b=0,i.pb=i.gb=i.kb=this.getWriteMask()):5===t||2===t?(i.wb=0,i._b=2,i.pb=i.gb=i.kb=this.getWriteMask()):6===t&&(i.wb=0,i._b=0,i.pb=i.gb=i.kb=this.getWriteMask()))},r(t,[{key:"stage",get:function(){return this.hb},set:function(t){this.hb=t}},{key:"pattern",get:function(){return this.eb}}]),t}());Rx.sharedManager=null,Rx.sharedManager=new Rx;var Mx=["mouse-down","mouse-move","mouse-up","mouse-wheel","mouse-leave-window","mouse-enter-window"],Cx=["touch-start","touch-move","touch-end","touch-cancel"],Nx=function(t){return!!(128&t._objFlags||1&t._objFlags)},Px=function(){function t(){this.priority=1,this.Ab=!1,this.Eb=0,this.Tb=[],this.Ob=[],this.Sb=[],PM._registerEventDispatcher(this);var t=RE.callbacksInvoker;t.on(0,this.Ib,this),t.on(1,this.Rb,this),t.on(2,this.Mb,this)}var i=t.prototype;return i.onThrowException=function(){this.Eb=0},i.dispatchEvent=function(t){var i=t.type;return Cx.includes(i)?this.Cb(t):!Mx.includes(i)||this.Nb(t)},i.Ib=function(t){0===this.Eb?this.Tb.includes(t)||(this.Tb.push(t),this.Ab=!0):this.Ob.includes(t)||this.Ob.push(t),ui(this.Sb,t)},i.Rb=function(t){0===this.Eb?(ui(this.Tb,t),this.Ab=!0):this.Sb.includes(t)||this.Sb.push(t),ui(this.Ob,t)},i.Nb=function(t){this.Eb++,this.Pb();for(var i=this.Tb,n=i.length,r=!0,s=0;s<n;++s){var e=i[s];if(e.isEnabled&&e.shouldHandleEventMouse&&e.Vu(t)){if(r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}return--this.Eb<=0&&this.Lb(),r},i.Cb=function(t){this.Eb++,this.Pb();for(var i=this.Tb,n=i.length,r=t.touch,s=!0,e=0;e<n;++e){var h=i[e];if(h.isEnabled&&h.shouldHandleEventTouch)if("touch-start"===t.type){if(h.Qu(t)){if(h.isEnabled)h.claimedTouchIdList.push(r.getID());else{var u=new JA([t.touch],!0,"touch-cancel");u.touch=t.touch,h.dispatchEvent(u),h.claimedTouchIdList.length=0}if(s=!1,!t.preventSwallow)break;t.preventSwallow=!1}}else if(h.claimedTouchIdList.length>0){var o=h.claimedTouchIdList.indexOf(r.getID());if(-1!==o){if(h.Qu(t),"touch-end"!==t.type&&"touch-cancel"!==t.type||(ei(h.claimedTouchIdList,o),t.preventSwallow||this.Db(e+1,r.getID())),s=!1,!t.preventSwallow)break;t.preventSwallow=!1}}}return--this.Eb<=0&&this.Lb(),s},i.Db=function(t,i){for(var n=this.Tb,r=n.length,s=t;s<r;++s){var e=n[s],h=e.claimedTouchIdList.indexOf(i);-1!==h&&ei(e.claimedTouchIdList,h)}},i.Lb=function(){for(var t=this.Ob,i=t.length,n=0;n<i;++n)this.Ib(t[n]);t.length=0;for(var r=this.Sb,s=r.length,e=0;e<s;++e)this.Rb(r[e]);r.length=0},i.Pb=function(){if(this.Ab){for(var t=this.Tb,i=t.length,n=0;n<i;++n){var r=t[n],s=r.node;if(s._uiProps){var e=s.qu();r.cachedCameraPriority=e.cameraPriority}}t.sort(this.Bb),this.Ab=!1}},i.Bb=function(t,i){var n=t.node,r=i.node;if(!(i&&r&&!Nx(r)&&r.activeInHierarchy&&r.qu()))return-1;if(!t||!n||Nx(n)||!n.activeInHierarchy||!n.qu())return 1;if(t.cachedCameraPriority!==i.cachedCameraPriority)return i.cachedCameraPriority-t.cachedCameraPriority;for(var s=n,e=r,h=!1;(null==(u=s.parent)?void 0:u.uuid)!==(null==(o=e.parent)?void 0:o.uuid);){var u,o,c,a,f,v;s=null===(null==(c=s)||null==(a=c.parent)?void 0:a.parent)?(h=!0)&&r:s&&s.parent,e=null===(null==(f=e)||null==(v=f.parent)?void 0:v.parent)?(h=!0)&&n:e&&e.parent}if(s.uuid===e.uuid){if(s.uuid===r.uuid)return-1;if(s.uuid===n.uuid)return 1}var l=s?s.siblingIndex:0,d=e?e.siblingIndex:0;return h?l-d:d-l},i.Mb=function(){this.Ab=!0},t}();function Lx(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function Dx(t,i){return Math.ceil(t/i)*i}new Px;var Bx=function(){function t(t){this.hs=0,this.Fb=0,this.Ns=[],this.Ub=0,this.xb=[],this.Gb=new Fl,this.jb=new Fl,this.Hb=new Fl,this.Vb=null,this.$b=Uint8Array,this.zb=4,this.Wb=1,this.Rh=t}var i=t.prototype;return i.initialize=function(t){var i=Fd[t.format];this.hs=t.format,this.Fb=i.size,this.zb=i.count,this.$b=Wd(i),this.Vb=t.roundUpFn||null,this.Wb=t.alignment||1,t.inOrderFree&&(this.alloc=this.Xb)},i.destroy=function(){for(var t=0;t<this.Ub;++t)this.Ns[t].texture.destroy();this.Ns.length=0,this.xb.length=0},i.alloc=function(t,i){t=Dx(t,this.Wb);var n=-1,r=-1;if(void 0!==i&&(n=i,r=this.Yb(t,n)),r<0)for(var s=0;s<this.Ub&&(n=s,!((r=this.Yb(t,n))>=0));++s);if(r>=0){var e=this.Ns[n];e.start+=t;var h={chunkIdx:n,start:r,end:r+t,texture:e.texture};return this.xb.push(h),h}var u=Math.sqrt(t/this.Fb),o=this.Vb&&this.Vb(u,this.Fb)||Math.max(1024,Lx(u)),c=this.Ns[this.createChunk(o)];c.start+=t;var a={chunkIdx:this.Ub-1,start:0,end:t,texture:c.texture};return this.xb.push(a),a},i.free=function(t){for(var i=0;i<this.xb.length;++i)if(this.xb[i]===t)return this.Ns[t.chunkIdx].end=t.end,void this.xb.splice(i,1)},i.createChunk=function(t){var i=t*t*this.Fb;K("TextureBufferPool: Allocate chunk "+this.Ub+", size: "+i+", format: "+this.hs);var n={texture:this.Rh.createTexture(new Kl(1,6,this.hs,t,t)),size:i,start:0,end:i};return this.Ns[this.Ub]=n,this.Ub++},i.update=function(t,i){var n=[],r=[],s=t.start/this.Fb,e=i.byteLength/this.Fb,h=s%t.texture.width,u=Math.floor(s/t.texture.width),o=Math.min(t.texture.width-h,e),c=0;h>0&&(this.Gb.texOffset.x=h,this.Gb.texOffset.y=u,this.Gb.texExtent.width=o,this.Gb.texExtent.height=1,n.push(new this.$b(i,c*this.Fb,o*this.zb)),r.push(this.Gb),h=0,u+=1,e-=o,c+=o),e>0&&(this.jb.texOffset.x=h,this.jb.texOffset.y=u,e>t.texture.width?(this.jb.texExtent.width=t.texture.width,this.jb.texExtent.height=Math.floor(e/t.texture.width),o=this.jb.texExtent.width*this.jb.texExtent.height):(o=e,this.jb.texExtent.width=o,this.jb.texExtent.height=1),n.push(new this.$b(i,c*this.Fb,o*this.zb)),r.push(this.jb),h=0,u+=this.jb.texExtent.height,e-=o,c+=o),e>0&&(this.Hb.texOffset.x=h,this.Hb.texOffset.y=u,this.Hb.texExtent.width=e,this.Hb.texExtent.height=1,n.push(new this.$b(i,c*this.Fb,e*this.zb)),r.push(this.Hb)),this.Rh.copyBuffersToTexture(n,t.texture,r)},i.Yb=function(t,i){var n=this.Ns[i],r=!1,s=n.start;if(s+t<=n.size)r=!0;else{s=0;for(var e=this.xb.filter((function(t){return t.chunkIdx===i})).sort((function(t,i){return t.start-i.start})),h=0;h<e.length;h++){var u=e[h];if(s+t<=u.start){r=!0;break}s=u.end}!r&&s+t<=n.size&&(r=!0)}return r?s:-1},i.Xb=function(t){t=Dx(t,this.Wb);for(var i=0;i<this.Ub;++i){var n=this.Ns[i],r=!1,s=n.start;if(s+t<=n.end?r=!0:s>n.end?s+t<=n.size?r=!0:t<=n.end&&(n.start=s=0,r=!0):s===n.end&&(n.start=s=0,n.end=n.size,t<=n.end&&(r=!0)),r){n.start+=t;var e={chunkIdx:i,start:s,end:s+t,texture:n.texture};return this.xb.push(e),e}}var h=Math.sqrt(t/this.Fb),u=this.Vb&&this.Vb(h,this.Fb)||Math.max(1024,Lx(h)),o=this.Ns[this.createChunk(u)];o.start+=t;var c={chunkIdx:this.Ub,start:0,end:t,texture:o.texture};return this.xb.push(c),c},t}(),Fx=Object.freeze({__proto__:null,BatchingSchemes:{NONE:0,INSTANCING:1},MaterialInstance:wA,Pass:$k,PassInstance:dA,PassStage:{DEFAULT:1,FORWARD:2,SHADOWCAST:4},RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderScene:LC,RenderWindow:xC,TextureBufferPool:Bx,createIA:function(t,i){if(!i.positions)return ht(16306),null;for(var n=[],r=i.positions.length/3,s=0;s<r;++s)n.push(i.positions[3*s],i.positions[3*s+1],i.positions[3*s+2]),i.normals&&n.push(i.normals[3*s],i.normals[3*s+1],i.normals[3*s+2]),i.uvs&&n.push(i.uvs[2*s],i.uvs[2*s+1]),i.colors&&n.push(i.colors[3*s],i.colors[3*s+1],i.colors[3*s+2]);var e=[];e.push(new ud("a_position",32)),i.normals&&e.push(new ud("a_normal",32)),i.uvs&&e.push(new ud("a_texCoord",21)),i.colors&&e.push(new ud("a_color",32));var h=t.createBuffer(new $l(10,1,4*n.length,4*n.length/r));h.update(new Float32Array(n));var u=null;return i.indices&&(u=t.createBuffer(new $l(6,1,2*i.indices.length,2))).update(new Uint16Array(i.indices)),t.createInputAssembler(new cd(e,[h],u))},customizeType:fm,genHandle:hm,getBindingFromHandle:om,getCountFromHandle:cm,getDefaultFromType:gm,getDeviceShaderVersion:Bm,getOffsetFromHandle:am,getStringFromType:pm,getTypeFromHandle:um,nearestPOT:Lx,overrideMacros:_m,programLib:$m,scene:PC,type2reader:vm,type2validator:dm,type2writer:lm});t("ag",Fx);var Ux=0;function xx(t){Ux=t}var Gx,jx,Hx,Vx,$x,zx,Wx=new kd(null),Xx=new ls,Yx=new Ge((function(){return{uiRenderer:null,finalOpacity:0,opacityDirty:!1}}),128),Kx=function(){function t(t){var i=this;this.Kb=[],this.qb=null,this.Qb=new Map,this.Jb=-1,this.Zb=0,this.tk=new hA,this.ik=null,this.nk=this.tk,this.rk=null,this.sk=null,this.ek=null,this.hk=null,this.uk=null,this.ck=0,this.ak=0,this.fk=0,this.vk=null,this.lk=0,this.dk=!1,this.wk=!1,this.gk=null,this.pk=0,this._k=0,this.yk=1,this.mk=0,this.kk=new Qx,this.Ak=[],this.Ek=null,this.Tk=null,this.Ok=null,this.Sk=[],this.yl=t,this.device=t.device,this.cl=new je(64),this.Ik=new xe((function(){return new fU}),128,(function(t){return t.Ww(i)}))}var i=t.prototype;return i.Rk=function(){return this.Sk},i.initialize=function(){return!0},i.destroy=function(){this.Sk.length=0;for(var t=0;t<this.cl.length;t++)this.cl.array[t]&&this.cl.array[t].Ww(this);this.cl.destroy();for(var i,n=w(this.Qb.values());!(i=n()).done;)i.value.destroy();this.Qb.clear(),this.Ik&&this.Ik.destroy(),this.kk.Ww(),Rx.sharedManager.destroy(),this.Ek&&this.Ok&&(T.director.root.destroyModel(this.Ek),this.Ok.destroy()),this.Tk&&this.Tk.destroy()},i.Mk=function(){},i.addScreen=function(t){this.Kb.push(t),this.Kb.sort(this.Ck)},i.removeScreen=function(t){var i=this.Kb.indexOf(t);-1!==i&&this.Kb.splice(i,1)},i.sortScreens=function(){this.Kb.sort(this.Ck)},i.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var i=t.scene.renderScene.cameras,n=0;n<i.length;n++){var r=i[n];if(r.visibility&t.layer)return r}return null},i.update=function(){for(var t=this.Kb,i=0,n=0;n<t.length;++n){var r=t[n],s=r._getRenderScene();if(r.enabledInHierarchy&&s){this.mk=0,this.yk=1,this.walk(r.node),Ux>0&&this.Nk(),this.autoMergeBatches(this.hk),this.resetRenderStates();var e=0;if(this.cl.length>i)for(;i<this.cl.length;++i){var h=this.cl.array[i];if(h.$y)for(var u=h.$y.subModels,o=0;o<u.length;o++)u[o].priority=e++;else h.tm=this.kk.Pk(h);s.addBatch(h)}}}Ux>0&&Yx.reset()},i.uploadBuffers=function(){if(this.cl.length>0){for(var t=this.Ak.length,i=0;i<t;i++)this.Ak[i].uploadBuffers();for(var n,r=w(this.Qb.values());!(n=r()).done;){var s=n.value;s.uploadBuffers(),s.reset()}this.kk.Fi()}},i.reset=function(){for(var t=0;t<this.cl.length;++t){var i=this.cl.array[t];i.Xy||(i.l_(),this.Ik.free(i))}for(var n,r=w(this.Qb.values());!(n=r()).done;)n.value.reset();for(var s=this.Ak.length,e=0;e<s;e++)this.Ak[e].freeIAPool();this.Ak.length=0,this.qb=null,this.Jb=-1,this.Zb=0,this.lk=0,this.fk=0,this.ik=null,this.nk=this.tk,this.rk=null,this.sk=null,this.hk=null,this.uk=null,this.cl.clear(),Rx.sharedManager.reset()},i.switchBufferAccessor=function(t){void 0===t&&(t=GD);var i=t===GD?36:zD(t);if(!this.qb||this.qb.vertexFormatBytes!==i){var n=this.Qb.get(i);n||(n=new qD(this.device,t),this.Qb.set(i,n)),this.qb=n,this.Jb=-1}return this.qb},i.registerBufferAccessor=function(t,i){this.Qb.set(t,i)},i.updateBuffer=function(t,i){var n=this.switchBufferAccessor(t);this.Jb!==i&&(this.Jb=i,this.Zb=n.getMeshBuffer(i).indexOffset)},i.commitComp=function(t,i,n,r,s){var e,h=0,u=-1;if(i&&i.chunk){if(!i.isValid())return;h=i.dataHash,e=i.material,u=i.chunk.bufferId}2===t.stencilStage||6===t.stencilStage?this.Lk(t):t.stencilStage=Rx.sharedManager.stage;var o=t.stencilStage;this.lk===h&&0!==h&&this.nk===e&&this.vk===o||(this.autoMergeBatches(this.hk),i&&!i._isMeshBuffer&&this.updateBuffer(i.vertexFormat,u),this.ik=i,this.lk=i?i.dataHash:0,this.hk=t,this.uk=s,this.nk=t.getRenderMaterial(0),this.vk=o,this.fk=t.node.layer,n?(this.rk=n.getGFXTexture(),this.sk=n.getGFXSampler(),this.ck=n.getHash(),this.ak=this.sk.hash):(this.rk=null,this.sk=null,this.ck=0,this.ak=0)),r.fillBuffers&&r.fillBuffers(t,this)},i.commitIA=function(t,i,n,r,s){this.nk!==this.tk&&(this.autoMergeBatches(this.hk),this.resetRenderStates());var e=null,h=0;t&&(t.stencilStage=Rx.sharedManager.stage,e=null!==t.customMaterial?Rx.sharedManager.getStencilStage(t.stencilStage,r):Rx.sharedManager.getStencilStage(t.stencilStage),h=Rx.sharedManager.getStencilHash(t.stencilStage));var u=this.ek?this.ek._requireDrawBatch():this.Ik.alloc();u.Jy=t.node.layer,u.Zy=i,u.Wy=s||null,n&&(u.zy=n.getGFXTexture(),u.Jd=n.getGFXSampler(),u.Yy=n.getHash(),u.Ky=u.Jd.hash),u.im(r||null,e,h,null),this.cl.push(u)},i.commitMiddleware=function(t,i,n,r,s,e,h){var u=s.getGFXTexture();h&&this.wk&&this.gk===i&&this.rk===u&&this.nk.hash===e.hash&&this.pk+this._k===n&&this.fk===t.node.layer?this._k+=r:(this.autoMergeBatches(this.hk),this.resetRenderStates(),this.hk=t,this.rk=u,this.sk=s.getGFXSampler(),this.ck=s.getHash(),this.fk=t.node.layer,this.ak=this.sk.hash,this.lk=0,this.uk=h?null:t.node,this.wk=h,this.gk=i,this.nk=e,this.pk=n,this._k=r),this.dk=!0},i.commitModel=function(t,i,n){this.nk!==this.tk&&(this.autoMergeBatches(this.hk),this.resetRenderStates());var r=null,s=0;n&&(2===t.stencilStage||6===t.stencilStage?this.Lk(t):t.stencilStage=Rx.sharedManager.stage,r=Rx.sharedManager.getStencilStage(t.stencilStage,n),s=Rx.sharedManager.getStencilHash(t.stencilStage));var e=T.director.getTotalFrames();i&&(i.updateTransform(e),i.updateUBOs(e));for(var h=0;h<i.subModels.length;h++){var u=this.Ik.alloc(),o=i.subModels[h];u.Jy=t.node.layer,u.$y=i,u.zy=null,u.Jd=null,u.Wy=null,r||(r=null),u.im(n,r,s,o.patches),u.Zy=o.inputAssembler,u.$y.visFlags=u.Jy,u.tm=o.descriptorSet,this.cl.push(u)}},i.setupStaticBatch=function(t,i){this.finishMergeBatches(),this.qb=i,this.currStaticRoot=t},i.endStaticBatch=function(){this.finishMergeBatches(),this.currStaticRoot=null,this.qb=null,this.switchBufferAccessor()},i.commitStaticBatch=function(t){this.cl.concat(t.drawBatchList),this.finishMergeBatches()},i.autoMergeBatches=function(t){if(this.dk)this.Dk(t);else{var i=this.nk;if(i){var n,r=this.ik,s=this.qb;if(r&&r._isMeshBuffer)n=r.requestIA(this.device),-1===this.Ak.indexOf(r)&&this.Ak.push(r);else if(s){var e=this.Jb,h=s.getMeshBuffer(e);if(!h)return;var u=h.indexOffset-this.Zb;if(u<=0)return;this.Zb,h.indexOffset,h.setDirty(),(n=h.requireFreeIA(this.device)).firstIndex=this.Zb,n.indexCount=u,this.Zb=h.indexOffset}if(this.Jb=-1,n&&this.rk){var o=null,c=0;t&&(o=null!==t.customMaterial?Rx.sharedManager.getStencilStage(t.stencilStage,i):Rx.sharedManager.getStencilStage(t.stencilStage),c=Rx.sharedManager.getStencilHash(t.stencilStage));var a=this.ek?this.ek._requireDrawBatch():this.Ik.alloc();a.Jy=this.fk,a.zy=this.rk,a.Jd=this.sk,a.Zy=n,a.Wy=this.uk,a.Yy=this.ck,a.Ky=this.ak,a.im(i,o,c,null),this.cl.push(a)}}}},i.Dk=function(t){var i,n;t.stencilStage=Rx.sharedManager.stage,n=null!==t.customMaterial?Rx.sharedManager.getStencilStage(t.stencilStage,this.nk):Rx.sharedManager.getStencilStage(t.stencilStage),i=Rx.sharedManager.getStencilHash(t.stencilStage);var r=this.ek?this.ek._requireDrawBatch():this.Ik.alloc();r.Jy=t.node.layer;var s=this.gk.requireFreeIA(this.device);s.firstIndex=this.pk,s.indexCount=this._k,r.Zy=s,r.Wy=this.uk,r.zy=this.rk,r.Jd=this.sk,r.Yy=this.ck,r.Ky=this.ak,r.im(this.nk||null,n,i,null),this.cl.push(r),this.dk=!1,this.gk=null},i.forceMergeBatches=function(t,i,n){this.nk=t,i?(this.rk=i.getGFXTexture(),this.sk=i.getGFXSampler(),this.ck=i.getHash(),this.ak=this.sk.hash):(this.rk=this.sk=null,this.ck=this.ak=0),this.fk=n.node.layer,this.autoMergeBatches(n)},i.resetRenderStates=function(){this.nk=this.tk,this.ik=null,this.rk=null,this.hk=null,this.uk=null,this.ck=0,this.ak=0,this.fk=0},i.finishMergeBatches=function(){this.autoMergeBatches(),this.resetRenderStates()},i.flushMaterial=function(t){this.nk=t},i.Bk=function(t,i,n){var r=t?t.renderData:null,s=r?r.vertexCount:0;if(t&&t.enabledInHierarchy&&t.fillBuffers(this),n&&s>0){0===t.getFillColorType()&&Tw(r,i);var e=r.getMeshBuffer();e&&e.setDirty()}},i.Fk=function(t,i,n){var r=this.Rk(),s=Yx.add();return s.uiRenderer=t,s.finalOpacity=i,s.opacityDirty=n,r.push(s),s},i.Nk=function(){var t=this.Rk(),i=t.length;if(0!==i){t.sort((function(t,i){return t.uiRenderer.priority-i.uiRenderer.priority}));for(var n=0;n<i;n++){var r=t[n],s=r.uiRenderer;s&&(this.Bk(s,r.finalOpacity,r.opacityDirty),s.enabledInHierarchy&&s.postUpdateAssembler(this)),r.finalOpacity=1,r.opacityDirty=!1,r.uiRenderer=null}t.length=0}},i.walk=function(t,i){if(void 0===i&&(i=0),t.activeInHierarchy){var n=t.children,r=t._uiProps,s=r.uiComp,e=this.yk,h=e,u=s&&s.color?s.color.a/255:1;this.yk=h*=u*r.localOpacity,r.wu(h);var o=!xn(h,0,Fn);if(o){if(r.colorDirty&&this.mk++,s&&(Ux>0?(2!==s.stencilStage&&6!==s.stencilStage||(this.Nk(),this.autoMergeBatches(this.hk),this.resetRenderStates()),this.Fk(s,h,!!this.mk)):this.Bk(s,h,!!this.mk)),n.length>0&&!t._static)for(var c=0;c<n.length;++c){var a=n[c];this.walk(a,i)}r.colorDirty&&(this.mk--,r.colorDirty=!1)}this.yk=e,s&&s.enabledInHierarchy&&(!o||2!==s.stencilStage&&6!==s.stencilStage||(Ux>0&&this.Nk(),Rx.sharedManager.getMaskStackSize()>0&&(this.autoMergeBatches(this.hk),this.resetRenderStates(),Rx.sharedManager.exitMask()))),i+=1}},i.Ck=function(t,i){return t.node.siblingIndex-i.node.siblingIndex},i._s=function(t){this.kk.Uk(t)},i.xk=function(){if(!this.Ek){this.Tk=Fk.get("default-clear-stencil"),this.Ek=T.director.root.createModel(hC);var t=zD(UD),i=kw.gfxDevice,n=i.createBuffer(new $l(10,1,4*t,t)),r=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);n.update(r);var s=i.createBuffer(new $l(6,1,12,2)),e=new Uint16Array([0,1,2,2,1,3]);s.update(e),this.Ok=new jA([n],UD,7,s),this.Ok.subMeshIdx=0,this.Ek.initSubModel(0,this.Ok,this.Tk)}},i.Lk=function(t){this.autoMergeBatches(this.hk),this.resetRenderStates(),this.xk(),this.Ek.node=this.Ek.transform=t.node;var i=Rx.sharedManager;i.pushMask(1);var n=i.clear(t),r=null,s=0,e=this.Tk;e&&(r=i.getStencilStage(n,e),s=i.getStencilHash(n));var h=this.Ek,u=T.director.getTotalFrames();h&&(h.updateTransform(u),h.updateUBOs(u));for(var o=0;o<h.subModels.length;o++){var c=this.Ik.alloc(),a=h.subModels[o];c.Jy=t.node.layer,c.$y=h,c.zy=null,c.Jd=null,c.Wy=null,r||(r=null),c.im(e,r,s,a.patches),c.Zy=a.inputAssembler,c.$y.visFlags=c.Jy,c.tm=a.descriptorSet,this.cl.push(c)}i.enableMask()},i.syncMeshBuffersToNative=function(){},r(t,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"currBufferAccessor",get:function(){return this.qb||(this.qb=this.switchBufferAccessor()),this.qb}},{key:"batches",get:function(){return this.cl}},{key:"currStaticRoot",set:function(t){this.ek=t}},{key:"currIsStatic",set:function(){}}]),t}(),qx=function(){var t=i.prototype;function i(){this.Gk=null,this.Hn=null,this.gs=0,this.jk=0,this.Kg=null,this.Hk=!0;var t=kw.gfxDevice;this.Vk=new Float32Array(56),this.Kg=t.createBuffer(new $l(18,3,224,224))}return t.Pk=function(){return this.Gk},t.Se=function(t){var i=kw.gfxDevice;this.Hn=t.Wy,this.gs=t.Yy,this.jk=t.Ky,Wx.layout=t.passes[0].localSetLayout,this.Gk=i.createDescriptorSet(Wx),this.Gk.bindBuffer(0,this.Kg),this.Gk.bindTexture(12,t.zy),this.Gk.bindSampler(12,t.Jd),this.Gk.update(),this.Hk=!0},t.$k=function(t){t!==this.Hn&&(this.Hn=t,this.Hk=!0,this.zk())},t.Wk=function(t,i,n){return this.Hn===t&&this.gs===i&&this.jk===n},t.Xk=function(){this.Hn=null,this.gs=0,this.jk=0},t.Ww=function(){this.Kg&&(this.Kg.destroy(),this.Kg=null),this.Gk&&(this.Gk.destroy(),this.Gk=null),this.Vk=null},t.Yk=function(){return this.Hn&&this.Hn.isValid},t.zk=function(){var t=this.Hn;if((t.hasChangedFlags||t.isTransformDirty())&&(t.updateWorldTransform(),this.Hk=!0),this.Hk){var i=t.worldMatrix;ls.toArray(this.Vk,i,0),ls.invert(Xx,i),ls.transpose(Xx,Xx);var n=ls.determinant(Xx),r=1/Math.sqrt(n);ls.multiplyScalar(Xx,Xx,r),ls.toArray(this.Vk,Xx,16),this.Kg.update(this.Vk),this.Hk=!1}},i}(),Qx=function(){function t(){this.kk=new Map,this.Kk=new Map,this.qk=[],this.Qk=new xe((function(){return new qx}),16,(function(t){return t.Ww()}))}var i=t.prototype;return i.Pk=function(t){if(t.Wy){for(var i=this.qk,n=0,r=i.length;n<r;n++){var s=i[n];if(s.Wk(t.Wy,t.Yy,t.Ky))return s.Pk()}var e=this.Qk.alloc();return e.Se(t),this.qk.push(e),e.Pk()}var h=t.Yy^t.Ky;if(this.kk.has(h))return this.kk.get(h);Wx.layout=t.passes[0].localSetLayout;var u=kw.gfxDevice.createDescriptorSet(Wx);return u.bindTexture(12,t.zy),u.bindSampler(12,t.Jd),u.update(),this.kk.set(h,u),this.Kk.set(t.Yy,h),u},i.Fi=function(){var t=this.qk,i=t.length;if(0!==i){for(var n=[],r=0;r<i;r++){var s=t[r];if(s.Yk())s.zk();else{s.Xk();var e=t.indexOf(s);n.push(e)}}for(var h=n.length-1;h>=0;h--){var u=n[h],o=t[u];t.splice(u,1),this.Qk.free(o)}}},i.Xk=function(){for(var t=this.qk,i=t.length,n=0;n<i;n++){var r=t[n];this.Qk.free(r)}this.qk.length=0},i.Uk=function(t){var i=this.Kk.get(t);i&&this.kk.has(i)&&(this.kk.get(i).destroy(),this.kk.delete(i),this.Kk.delete(t))},i.Ww=function(){for(var t,i=w(this.kk.values());!(t=i()).done;)t.value.destroy();this.kk.clear(),this.Kk.clear(),this.qk.length=0,this.Qk.destroy()},t}();T.internal.Batcher2D=Kx;var Jx,Zx,tG,iG,nG,rG,sG,eG,hG,uG,oG,cG,aG,fG,vG,lG,dG,wG,gG,pG,_G,yG,mG,bG,kG,AG,EG,TG,OG,SG,IG,RG,MG,CG,NG,PG,LG=_o("cc.PostProcess")(Gx=bo((zx=function(t){function i(){var i;return(i=t.call(this)||this).global=Hx&&Hx(),i._shadingScale=Vx&&Vx(),i.enableShadingScaleInEditor=$x&&$x(),i.settings=new Map,i}e(i,t);var n=i.prototype;return n.addSetting=function(t){this.settings.set(t.constructor,t)},n.removeSetting=function(t){this.settings.delete(t.constructor)},n.getSetting=function(t){return this.settings.get(t)},n.onEnable=function(){i.all.push(this)},n.onDisable=function(){var t=i.all.indexOf(this);-1!==t&&i.all.splice(t,1)},r(i,[{key:"shadingScale",get:function(){return this._shadingScale},set:function(t){this._shadingScale=t}}]),i}(Kg),zx.all=[],Hx=uo((jx=zx).prototype,"global",[ko,Co],(function(){return!0})),Vx=uo(jx.prototype,"_shadingScale",[Co],(function(){return 1})),y(jx.prototype,"shadingScale",[ko],Object.getOwnPropertyDescriptor(jx.prototype,"shadingScale"),jx.prototype),$x=uo(jx.prototype,"enableShadingScaleInEditor",[ko,Co],(function(){return!1})),Gx=jx))||Gx)||Gx,DG=new Ir,BG=_i(FM),FG=_i(BM),UG=_i(UM),xG=_i(GM),GG=_i(xM),jG=_i({SKYBOX:14,SOLID_COLOR:7,DEPTH_ONLY:6,DONT_CLEAR:0}),HG=t("dj",(Jx=_o("cc.Camera"),Zx=ic(M_.BitMask),tG=ic(jG),iG=ic(BG),nG=ic(FG),rG=ic(UG),sG=ic(xG),eG=ic(GG),hG=ic(LA),uG=ic(LG),Jx((NG=function(t){function i(){var i;return(i=t.call(this)||this)._projection=aG&&aG(),i._priority=fG&&fG(),i._fov=vG&&vG(),i._fovAxis=lG&&lG(),i._orthoHeight=dG&&dG(),i._near=wG&&wG(),i._far=gG&&gG(),i._color=pG&&pG(),i._depth=_G&&_G(),i._stencil=yG&&yG(),i._clearFlags=mG&&mG(),i._rect=bG&&bG(),i._aperture=kG&&kG(),i._shutter=AG&&AG(),i._iso=EG&&EG(),i._screenScale=TG&&TG(),i._visibility=OG&&OG(),i._targetTexture=SG&&SG(),i._postProcess=IG&&IG(),i._usePostProcess=RG&&RG(),i._camera=null,i._inEditorMode=!1,i._flows=void 0,i._cameraType=MG&&MG(),i._trackingType=CG&&CG(),i}e(i,t);var n=i.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=1,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(t,i,n){return n||(n=Ie.create()),this._camera&&this._camera.screenPointToRay(n,t,i),n},n.worldToScreen=function(t,i){return i||(i=new Ir),this._camera&&this._camera.worldToScreen(i,t),i},n.screenToWorld=function(t,i){return i||(i=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(i,t),i},n.convertToUINode=function(t,i,n){if(n||(n=new Ir),!this._camera)return n;this.worldToScreen(t,DG);var r=i.getComponent("cc.UITransform"),s=T.view,e=s.getVisibleSize(),h=DG.x-.5*this._camera.width,u=DG.y-.5*this._camera.height;return DG.x=h/s.getScaleX()+.5*e.width,DG.y=u/s.getScaleY()+.5*e.height,r&&r.convertToNodeSpaceAR(DG,n),n},n._createCamera=function(){this._camera||(this._camera=T.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?T.director.root&&T.director.root.mainWindow:T.director.root&&T.director.root.tempWindow,priority:this._priority,cameraType:this.cameraType,trackingType:this.trackingType}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=Vn(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso,this._camera.postProcess=this._postProcess,this._camera.usePostProcess=this._usePostProcess,this._camera.update()),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._checkTargetTextureEvent=function(t){var i=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){i._camera&&i._camera.setFixedSize(t.width,t.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},r(i,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,this.fov=0===t?this._fov*this._camera.aspect:this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=Vn(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&this._camera.setViewportInOrientedSpace(t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var i=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(i),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit("tex-change",this)}}},{key:"usePostProcess",get:function(){return this._usePostProcess},set:function(t){this._usePostProcess=t,this._camera&&(this._camera.usePostProcess=t)}},{key:"postProcess",get:function(){return this._postProcess},set:function(t){this._postProcess=t,this._camera&&(this._camera.postProcess=t)}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){if(this._inEditorMode=t,this._camera){var i=T.director.root;this._camera.changeTargetWindow(t?i&&i.mainWindow:i&&i.tempWindow)}}},{key:"cameraType",get:function(){return this._cameraType},set:function(t){this._cameraType!==t&&(this._cameraType=t,this.camera&&(this.camera.cameraType=t))}},{key:"trackingType",get:function(){return this._trackingType},set:function(t){this._trackingType!==t&&(this._trackingType=t,this.camera&&(this.camera.trackingType=t))}}]),i}(Kg),NG.ProjectionType=BG,NG.FOVAxis=FG,NG.ClearFlag=jG,NG.Aperture=UG,NG.Shutter=xG,NG.ISO=GG,NG.TARGET_TEXTURE_CHANGE="tex-change",aG=uo((cG=NG).prototype,"_projection",[Co],(function(){return BG.PERSPECTIVE})),fG=uo(cG.prototype,"_priority",[Co],(function(){return 0})),vG=uo(cG.prototype,"_fov",[Co],(function(){return 45})),lG=uo(cG.prototype,"_fovAxis",[Co],(function(){return FG.VERTICAL})),dG=uo(cG.prototype,"_orthoHeight",[Co],(function(){return 10})),wG=uo(cG.prototype,"_near",[Co],(function(){return 1})),gG=uo(cG.prototype,"_far",[Co],(function(){return 1e3})),pG=uo(cG.prototype,"_color",[Co],(function(){return new Qs("#333333")})),_G=uo(cG.prototype,"_depth",[Co],(function(){return 1})),yG=uo(cG.prototype,"_stencil",[Co],(function(){return 0})),mG=uo(cG.prototype,"_clearFlags",[Co],(function(){return jG.SOLID_COLOR})),bG=uo(cG.prototype,"_rect",[Co],(function(){return new ee(0,0,1,1)})),kG=uo(cG.prototype,"_aperture",[Co],(function(){return UG.F16_0})),AG=uo(cG.prototype,"_shutter",[Co],(function(){return xG.D125})),EG=uo(cG.prototype,"_iso",[Co],(function(){return GG.ISO100})),TG=uo(cG.prototype,"_screenScale",[Co],(function(){return 1})),OG=uo(cG.prototype,"_visibility",[Co],(function(){return Ky})),SG=uo(cG.prototype,"_targetTexture",[Co],(function(){return null})),IG=uo(cG.prototype,"_postProcess",[Co],(function(){return null})),RG=uo(cG.prototype,"_usePostProcess",[Co],(function(){return!1})),MG=uo(cG.prototype,"_cameraType",[Co],(function(){return-1})),CG=uo(cG.prototype,"_trackingType",[Co],(function(){return 0})),y(cG.prototype,"visibility",[Zx],Object.getOwnPropertyDescriptor(cG.prototype,"visibility"),cG.prototype),y(cG.prototype,"clearFlags",[tG],Object.getOwnPropertyDescriptor(cG.prototype,"clearFlags"),cG.prototype),y(cG.prototype,"projection",[iG],Object.getOwnPropertyDescriptor(cG.prototype,"projection"),cG.prototype),y(cG.prototype,"fovAxis",[nG],Object.getOwnPropertyDescriptor(cG.prototype,"fovAxis"),cG.prototype),y(cG.prototype,"aperture",[rG],Object.getOwnPropertyDescriptor(cG.prototype,"aperture"),cG.prototype),y(cG.prototype,"shutter",[sG],Object.getOwnPropertyDescriptor(cG.prototype,"shutter"),cG.prototype),y(cG.prototype,"iso",[eG],Object.getOwnPropertyDescriptor(cG.prototype,"iso"),cG.prototype),y(cG.prototype,"targetTexture",[hG],Object.getOwnPropertyDescriptor(cG.prototype,"targetTexture"),cG.prototype),y(cG.prototype,"usePostProcess",[ko],Object.getOwnPropertyDescriptor(cG.prototype,"usePostProcess"),cG.prototype),y(cG.prototype,"postProcess",[uG],Object.getOwnPropertyDescriptor(cG.prototype,"postProcess"),cG.prototype),oG=cG))||oG));T.Camera=HG;var VG,$G,zG,WG,XG,YG,KG,qG,QG,JG=t("R",_o("cc.RenderRoot2D")(PG=mo(100)(PG=yo(mB)(PG=bo(PG=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.onEnable=function(){T.director.root.batcher2D.addScreen(this)},n.onDisable=function(){T.director.root.batcher2D.removeScreen(this)},n.onDestroy=function(){T.director.root.batcher2D.removeScreen(this)},i}(Kg))||PG)||PG)||PG)||PG),ZG=new Ir,tj=t("C",(VG=_o("cc.Canvas"),$G=mo(100),zG=ic(HG),WG=ic(HG),VG(XG=$G(XG=bo((YG=function(t){function i(){var i;return(i=t.call(this)||this)._cameraComponent=KG&&KG(),i._alignCanvasWithScreen=qG&&qG(),i.vv=new Ir,i.Jk=0,i._thisOnCameraResized=i._onResizeCamera.bind(v(i)),i}e(i,t);var n=i.prototype;return n.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on("tex-change",this._thisOnCameraResized)),this._onResizeCamera(),ZN.on("canvas-resize",this._thisOnCameraResized,this),ZN.on("design-resolution-changed",this._thisOnCameraResized,this)},n.onEnable=function(){t.prototype.onEnable.call(this),this._cameraComponent&&this._cameraComponent.node.on("tex-change",this._thisOnCameraResized)},n.onDisable=function(){t.prototype.onDisable.call(this),this._cameraComponent&&this._cameraComponent.node.off("tex-change",this._thisOnCameraResized)},n.onDestroy=function(){t.prototype.onDestroy.call(this),ZN.off("canvas-resize",this._thisOnCameraResized,this),ZN.off("design-resolution-changed",this._thisOnCameraResized,this)},n._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture)this._cameraComponent.orthoHeight=kh.height/2;else{var t=mh.windowSize;this._cameraComponent.orthoHeight=t.height/ZN.getScaleY()/2}this.node.getWorldPosition(ZG),this._cameraComponent.node.setWorldPosition(ZG.x,ZG.y,1e3)}},n.Zk=function(){if(this._cameraComponent){var t,i=null==(t=this.cameraComponent)?void 0:t.priority;return 0===this.Jk?i|1<<30:-1073741825&i}return 0},r(i,[{key:"renderMode",get:function(){return this.Jk},set:function(t){this.Jk=t,this._cameraComponent&&(this._cameraComponent.priority=this.Zk())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]),i}(JG),y(YG.prototype,"cameraComponent",[zG],Object.getOwnPropertyDescriptor(YG.prototype,"cameraComponent"),YG.prototype),KG=uo(YG.prototype,"_cameraComponent",[WG],(function(){return null})),qG=uo(YG.prototype,"_alignCanvasWithScreen",[Co],(function(){return!0})),XG=YG))||XG)||XG)||XG));function ij(t,i,n){var r=t.o,s=t.d,e=1/s.x,h=1/s.y,u=1/s.z,o=(i.x-r.x)*e,c=(n.x-r.x)*e,a=(i.y-r.y)*h,f=(n.y-r.y)*h,v=(i.z-r.z)*u,l=(n.z-r.z)*u,d=Math.max(Math.max(Math.min(o,c),Math.min(a,f)),Math.min(v,l)),w=Math.min(Math.min(Math.max(o,c),Math.max(a,f)),Math.max(v,l));return w<0||d>w?0:d>0?d:w}T.Canvas=tj,t("U",_o("cc.UIComponent")(QG=yo(mB)(QG=mo(110)(QG=bo(QG=function(t){function i(){var i;return(i=t.call(this)||this)._lastParent=null,i.stencilStage=0,i}e(i,t);var n=i.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){},n.onDisable=function(){},n.onDestroy=function(){var t=this.node._uiProps;t.uiComp===this&&(t.uiComp=null)},n.postUpdateAssembler=function(){},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},i}(Kg))||QG)||QG)||QG)||QG);var nj,rj,sj,ej,hj,uj,oj,cj,aj=(nj=Re.create(),rj={distance:1/0,doubleSided:!1,mode:2},sj=0,ej=function(t,i,n,r,s,e){1===t?(sj>i||0===sj)&&(sj=i,e&&(0===e.length?e.push({distance:i,vertexIndex0:n/3,vertexIndex1:r/3,vertexIndex2:s/3}):(e[0].distance=i,e[0].vertexIndex0=n/3,e[0].vertexIndex1=r/3,e[0].vertexIndex2=s/3))):(sj=i,e&&e.push({distance:i,vertexIndex0:n/3,vertexIndex1:r/3,vertexIndex2:s/3}))},hj=function(t,i,n,r,s){if(7===n)for(var e=i.length,h=0;h<e;h+=3){var u=3*i[h],o=3*i[h+1],c=3*i[h+2];Ir.set(nj.a,t[u],t[u+1],t[u+2]),Ir.set(nj.b,t[o],t[o+1],t[o+2]),Ir.set(nj.c,t[c],t[c+1],t[c+2]);var a=Xu.rayTriangle(r,nj,s.doubleSided);if(!(0===a||a>s.distance)&&(ej(s.mode,a,u,o,c,s.result),2===s.mode))return a}else if(8===n)for(var f=i.length-2,v=0,l=0;l<f;l+=1){var d=3*i[l-v],w=3*i[l+v+1],g=3*i[l+2];Ir.set(nj.a,t[d],t[d+1],t[d+2]),Ir.set(nj.b,t[w],t[w+1],t[w+2]),Ir.set(nj.c,t[g],t[g+1],t[g+2]),v=~v;var p=Xu.rayTriangle(r,nj,s.doubleSided);if(!(0===p||p>s.distance)&&(ej(s.mode,p,d,w,g,s.result),2===s.mode))return p}else if(9===n){var _=i.length-1,y=3*i[0];Ir.set(nj.a,t[y],t[y+1],t[y+2]);for(var m=1;m<_;m+=1){var b=3*i[m],k=3*i[m+1];Ir.set(nj.b,t[b],t[b+1],t[b+2]),Ir.set(nj.c,t[k],t[k+1],t[k+2]);var A=Xu.rayTriangle(r,nj,s.doubleSided);if(!(0===A||A>s.distance)&&(ej(s.mode,A,y,b,k,s.result),2===s.mode))return A}}return sj},function(t,i,n){if(sj=0,0===i.geometricInfo.positions.length)return sj;var r=void 0===n?rj:n;if(ij(t,i.geometricInfo.boundingBox.min,i.geometricInfo.boundingBox.max)){var s=i.primitiveMode,e=i.geometricInfo,h=e.positions,u=e.indices;hj(h,u,s,t,r)}return sj}),fj=function(){var t=0,i={distance:1/0,doubleSided:!1,mode:2};return function(n,r,s){t=0;var e=void 0===s?i:s,h=r.renderingSubMeshes.length,u=r.struct.minPosition,o=r.struct.maxPosition;if(u&&o&&!ij(n,u,o))return t;for(var c=0;c<h;c++){var a=r.renderingSubMeshes[c],f=aj(n,a,e);if(f)if(1===e.mode)(0===t||t>f)&&(t=f,e.subIndices&&(e.subIndices[0]=c));else if(t=f,e.subIndices&&e.subIndices.push(c),2===e.mode)return f}return t&&1===e.mode&&(e.result&&(e.result[0].distance=t,e.result.length=1),e.subIndices&&(e.subIndices.length=1)),t}}(),vj=function(){var t=0,i={distance:1/0,doubleSided:!1,mode:2},n=new Ie,r=new ls;return function(s,e,h){t=0;var u=void 0===h?i:h,o=e.worldBounds;if(o&&!Xu.rayAABB(s,o))return t;Ie.copy(n,s),e.node&&(ls.invert(r,e.node.getWorldMatrix(r)),Ir.transformMat4(n.o,s.o,r),Ir.transformMat4Normal(n.d,s.d,r));for(var c=e.subModels,a=0;a<c.length;a++){var f=c[a].subMesh,v=aj(n,f,u);if(v)if(1===u.mode)(0===t||t>v)&&(t=v,u.subIndices&&(u.subIndices[0]=a));else if(t=v,u.subIndices&&u.subIndices.push(a),2===u.mode)return v}return t&&1===u.mode&&(u.result&&(u.result[0].distance=t,u.result.length=1),u.subIndices&&(u.subIndices.length=1)),t}}();Xu.rayModel=vj,Xu.raySubMesh=aj,Xu.rayMesh=fj,Uk("specular-pass");var lj,dj,wj,gj,pj,_j,yj,mj,bj,kj,Aj,Ej,Tj,Oj,Sj,Ij,Rj,Mj,Cj,Nj,Pj,Lj,Dj=t("dk",_o("cc.ModelRenderer")((oj=function(t){function i(){var i;return(i=t.call(this)||this)._visFlags=cj&&cj(),i._models=[],i._priority=0,i}e(i,t);var n=i.prototype;return n._collectModels=function(){return this._models},n.onEnable=function(){this._updatePriority()},n._attachToScene=function(){},n._detachFromScene=function(){},n._onVisibilityChange=function(){},n._updatePriority=function(){if(this._models.length>0)for(var t=0;t<this._models.length;t++)this._models[t].priority=this._priority},r(i,[{key:"visibility",get:function(){return this._visFlags},set:function(t){this._visFlags=t,this._onVisibilityChange(t)}},{key:"priority",get:function(){return this._priority},set:function(t){t!==this._priority&&(this._priority=t,this._updatePriority())}}]),i}(EB),cj=uo(oj.prototype,"_visFlags",[Co],(function(){return M_.Enum.NONE})),uj=oj))||uj),Bj=Co,Fj=ic;t("dn",(lj=_o("cc.PrefabLink"),dj=Fj(PN),lj((gj=function(t){function i(){var i;return(i=t.call(this)||this).prefab=pj&&pj(),i}return e(i,t),i}(Kg),pj=uo(gj.prototype,"prefab",[dj,Bj],(function(){return null})),wj=gj))||wj)),t("f",(_j=_o("cc.SpriteRenderer"),yj=mo(100),mj=ic(wL),_j(bj=yj((kj=function(t){function i(){var i;return(i=t.call(this)||this)._spriteFrame=Aj&&Aj(),i._mode=Ej&&Ej(),i._color=Tj&&Tj(),i._flipX=Oj&&Oj(),i._flipY=Sj&&Sj(),i._size=Ij&&Ij(),i.u_=null,i}e(i,t);var n=i.prototype;return n.onLoad=function(){this._spriteFrame&&(this._spriteFrame.mesh||this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels()},n.onRestore=function(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene()},n.onEnable=function(){t.prototype.onEnable.call(this),this.u_||this._updateModels(),this._attachToScene()},n.onDisable=function(){this.u_&&this._detachFromScene()},n.onDestroy=function(){this.u_&&(T.director.root.destroyModel(this.u_),this.u_=null,this._models.length=0)},n._updateModels=function(){if(this._spriteFrame){var t=this.u_;if(t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this.u_){var i=this._spriteFrame.mesh;this.u_.createBoundingShape(i.struct.minPosition,i.struct.maxPosition),this._updateModelParams(),this._onUpdateLocalDescriptorSet()}}},n._createModel=function(){var t=this.u_=T.director.root.createModel(hC);t.visFlags=this.visibility,t.node=t.transform=this.node,this._models.length=0,this._models.push(this.u_)},n._updateModelParams=function(){if(this._spriteFrame&&this.u_){this._spriteFrame.ensureMeshData();var t=this._spriteFrame.mesh;this.node.hasChangedFlags|=1,this.u_.transform.hasChangedFlags|=1;var i=t?t.renderingSubMeshes:null;if(i)for(var n=i.length,r=0;r<n;++r){var s=this.getRenderMaterial(r);s&&!s.isValid&&(s=null);var e=i[r];e&&this.u_.initSubModel(r,e,s||this._getBuiltinMaterial())}this.u_.enabled=!0}},n._getBuiltinMaterial=function(){return Fk.get("missing-material")},n._onMaterialModified=function(i,n){t.prototype._onMaterialModified.call(this,i,n),this._spriteFrame&&this.u_&&this.u_.inited&&this.qh(i,n||this._getBuiltinMaterial())},n.qh=function(t,i){this.u_&&this.u_.inited&&(this.u_.setSubModelMaterial(t,i),this._onUpdateLocalDescriptorSet())},n._onUpdateLocalDescriptorSet=function(){if(this._spriteFrame&&this.u_&&this.u_.inited)for(var t=this._spriteFrame.getGFXTexture(),i=this._spriteFrame.getGFXSampler(),n=this.u_.subModels,r=0;r<n.length;r++){var s=n[r].descriptorSet;s.bindTexture(12,t),s.bindSampler(12,i),s.update()}},n._attachToScene=function(){if(this.node.scene&&this.u_){var t=this._getRenderScene();null!==this.u_.scene&&this._detachFromScene(),t.addModel(this.u_)}},n._detachFromScene=function(){this.u_&&this.u_.scene&&this.u_.scene.removeModel(this.u_)},r(i,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame,this._spriteFrame=t,this._spriteFrame&&(this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels(),this.enabledInHierarchy&&this._attachToScene())}},{key:"model",get:function(){return this.u_}}]),i}(Dj),y(kj.prototype,"spriteFrame",[mj],Object.getOwnPropertyDescriptor(kj.prototype,"spriteFrame"),kj.prototype),Aj=uo(kj.prototype,"_spriteFrame",[Co],(function(){return null})),Ej=uo(kj.prototype,"_mode",[Co],(function(){return 0})),Tj=uo(kj.prototype,"_color",[Co],(function(){return Qs.WHITE.clone()})),Oj=uo(kj.prototype,"_flipX",[Co],(function(){return!1})),Sj=uo(kj.prototype,"_flipY",[Co],(function(){return!1})),Ij=uo(kj.prototype,"_size",[Co],(function(){return new Ms})),bj=kj))||bj)||bj)),T.UI={MeshBuffer:WD,spriteAssembler:Ix,labelAssembler:xU,RenderData:aB,MeshRenderData:fB},t("$",(Rj=_o("cc.Sorting"),Mj=ic(xB.Enum),Rj(Cj=bo((y((Nj=function(t){function i(){var i;return(i=t.call(this)||this)._sortingLayer=Pj&&Pj(),i._sortingOrder=Lj&&Lj(),i.tA=null,i}e(i,t);var n=i.prototype;return n.__preload=function(){this.tA=this.getComponent("cc.ModelRenderer"),this.tA||st(16301,this.node.name),this._updateSortingPriority()},n._updateSortingPriority=function(){var t=xB.getLayerIndex(this._sortingLayer),i=xB.getSortingPriority(t,this._sortingOrder);this.tA&&this.tA.isValid&&(this.tA.priority=i)},r(i,[{key:"sortingLayer",get:function(){return this._sortingLayer},set:function(t){t!==this._sortingLayer&&xB.isLayerValid(t)&&(this._sortingLayer=t,this._updateSortingPriority())}},{key:"sortingOrder",get:function(){return this._sortingOrder},set:function(t){t!==this._sortingOrder&&(this._sortingOrder=Gn(t,-32768,32767),this._updateSortingPriority())}}]),i}(Kg)).prototype,"sortingLayer",[Mj],Object.getOwnPropertyDescriptor(Nj.prototype,"sortingLayer"),Nj.prototype),Pj=uo(Nj.prototype,"_sortingLayer",[Co],(function(){return xB.Enum.default})),Lj=uo(Nj.prototype,"_sortingOrder",[Co],(function(){return 0})),Cj=Nj))||Cj)||Cj));var Uj,xj,Gj,jj,Hj,Vj="cc.animation.",$j=Symbol("CreateEval");_o(Vj+"EmbeddedPlayer")((Uj=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).begin=xj&&xj(),i.end=Gj&&Gj(),i.reconciledSpeed=jj&&jj(),i.playable=Hj&&Hj(),i}return e(i,t),i}(fc),xj=uo(Uj.prototype,"begin",[Co],(function(){return 0})),Gj=uo(Uj.prototype,"end",[Co],(function(){return 0})),jj=uo(Uj.prototype,"reconciledSpeed",[Co],(function(){return!1})),Hj=uo(Uj.prototype,"playable",[Co],(function(){return null})),Uj));var zj=function(){},Wj=function(){function t(t){this.iA=t}return t.prototype.setTime=function(){},r(t,[{key:"randomAccess",get:function(){return this.iA}}]),t}(),Xj=function(){function t(){this.Jw=!1,this.nA=!1,this.rA=!1}var i=t.prototype;return i.play=function(){this.Jw?this.nA?(this.nA=!1,this.onResume()):this.onError(at(3912)):(this.Jw=!0,this.onPlay())},i.stop=function(){this.Jw&&(this.Jw=!1,this.onStop(),this.nA=!1)},i.pause=function(){this.Jw&&!this.nA&&(this.nA=!0,this.onPause())},i.resume=function(){this.Jw&&this.nA&&(this.nA=!1,this.onResume())},i.step=function(){this.pause(),this.rA=!0,this.Jw||this.play()},i.update=function(){},i.onPlay=function(){},i.onPause=function(){},i.onResume=function(){},i.onStop=function(){},i.onError=function(){},r(t,[{key:"isPlaying",get:function(){return this.Jw}},{key:"isPaused",get:function(){return this.nA}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),Yj={Default:0,Normal:1,Reverse:36,Loop:2,LoopReverse:38,PingPong:22,PingPongReverse:54};bi(Yj);var Kj=function(){function t(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}return t.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},t}(),qj=function(){function t(t){this.weight=0,this.sA=void 0,this.eA=[],this.sA=t}var i=t.prototype;return i.destroy=function(){for(var t=0;t<this.eA.length;++t)this.sA.destroyWriter(this.eA[t]);this.eA.length=0},i.createPoseWriter=function(t,i,n){var r=this.sA.createWriter(t,i,this,n);return this.eA.push(r),r},t}();function Qj(){return T.director.getAnimationManager()}var Jj={PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"};bi(Jj);var Zj,tH,iH,nH=t("a2",function(t){function i(i,n){var r;return void 0===n&&(n=""),(r=t.call(this)||this).duration=1,r.time=0,r.frameRate=0,r._targetNode=null,r._curveLoaded=!1,r.hA=void 0,r.uA=1,r.oA=!1,r.Ci=null,r.cA=1,r.fA=1,r.Ri=0,r.vA=0,r.lA=!1,r.Sr=void 0,r.dA=NaN,r.gA=null,r.pA=new Kj,r._A=!1,r.yA={weight:0},r.mA=0,r.bA=1,r.kA=null,r.AA=1,r.EA=void 0,r.TA=void 0,r.OA=void 0,r._doNotCreateEval=!1,r.hA=i,r.Sr=n||i&&i.name,r.SA={min:0,max:i.duration},r.mA=i.duration,i.duration||K("Clip "+i.name+" has zero duration."),r}e(i,t);var n=i.prototype;return n.initialize=function(t,i,n){if(!this._curveLoaded){this._curveLoaded=!0,this.kA&&(this.kA.destroy(),this.kA=null),this.EA&&(this.EA=void 0),this.TA&&(this.TA=void 0),this.OA&&(this.OA.destroy(),this.OA=void 0),this._targetNode=t;var r=this.hA;if(this.duration=r.duration,this.bA=1/this.duration,this.uA=r.speed,this.wrapMode=r.wrapMode,this.frameRate=r.sample,this.SA.min=0,this.SA.max=r.duration,this.mA=r.duration,2&~this.wrapMode?this.repeatCount=1:this.repeatCount=1/0,!this._doNotCreateEval){var s,e,h,u=null!==(s=null!=i?i:null==(e=Qj())?void 0:e.blendState)&&void 0!==s?s:null;u&&(this.kA=new qj(u)),this.EA=r.createEvaluator({target:t,pose:null!==(h=this.kA)&&void 0!==h?h:void 0,mask:n})}r.containsAnyEvent()&&(this.TA=r.createEventEvaluator(this._targetNode)),r.containsAnyEmbeddedPlayer()&&(this.OA=r.createEmbeddedPlayerEvaluator(this._targetNode),this.OA.notifyHostSpeedChanged(this.uA))}},n.destroy=function(){this.isMotionless||Qj().removeAnimation(this),this.kA&&(this.kA.destroy(),this.kA=null),this.EA=void 0},n.emit=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];Qj().pushDelayEvent(this.IA,this,i)},n.on=function(t,i,n){return this.Ci&&this.Ci.isValid?this.Ci.on(t,i,n):null},n.once=function(t,i,n){return this.Ci&&this.Ci.isValid?this.Ci.once(t,i,n):null},n.off=function(t,i,n){this.Ci&&this.Ci.isValid&&this.Ci.off(t,i,n)},n.allowLastFrameEvent=function(t){this._A=t},n._setEventTarget=function(t){this.Ci=t},n.setTime=function(t){this.lA=!1,this.time=t||0;var i,n=this.RA(t,this.pA);null==(i=this.TA)||i.ignore(n.ratio,n.direction)},n.update=function(t){this.vA>0&&(this.vA-=t,this.vA>0)||(this.lA?this.time+=t*this.uA:this.lA=!0,this.MA())},n.sample=function(){var t=this.RA(this.time,this.pA);return this._sampleCurves(t.time),this.CA(t),this.NA(t),t},n.onPlay=function(){var t;this.setTime(this.PA()),this.vA=this.Ri,this.LA(),this.emit("play",this),null==(t=this.OA)||t.notifyHostPlay(this.current)},n.onStop=function(){var t;this.isPaused||this.DA(),this.emit("stop",this),null==(t=this.OA)||t.notifyHostStop()},n.onResume=function(){var t;this.LA(),this.emit("resume",this),null==(t=this.OA)||t.notifyHostPlay(this.current)},n.onPause=function(){var t;this.DA(),this.emit("pause",this),null==(t=this.OA)||t.notifyHostPause(this.current)},n._sampleCurves=function(t){var i=this.kA,n=this.EA;i&&(i.weight=this.weight),n&&n.evaluate(t)},n.MA=function(){this.oA?this.BA():this.FA()},n.FA=function(){var t,i=this.sample();this._A&&(t=this.gA?this.gA:this.gA=new Kj(i),this.repeatCount>1&&(0|i.iterations)>(0|t.iterations)&&this.emit("lastframe",this),t.set(i)),i.stopped&&(this.stop(),this.emit("finished",this))},n.BA=function(){var t=this.SA.min,i=this.mA,n=0,r=0;if(0!==i&&((n=this.time%i)<0&&(n+=i),r=(t+n)*this.bA),this._sampleCurves(t+n),this.TA||this.OA){var s=this.RA(this.time,this.pA);this.CA(s),this.NA(s)}this._A&&(Number.isNaN(this.dA)&&(this.dA=r),(this.time>0&&this.dA>r||this.time<0&&this.dA<r)&&this.emit("lastframe",this),this.dA=r)},n.UA=function(t){var i=this.wrapMode,n=!1;return 22&~i||(t-(0|t)==0&&t>0&&(t-=1),1&t&&(n=!n)),36&~i||(n=!n),n},n.RA=function(t,i){i=i||new Kj;var n=this.SA.min,r=this.mA,s=this.repeatCount;if(0===r)return i.time=0,i.ratio=0,i.direction=1,i.stopped=!!Number.isFinite(s),i.iterations=0,i;var e=!1,h=(t-=n)>0?t/r:-t/r;if(h>=s){h=s,e=!0;var u=s-(0|s);0===u&&(u=1),t=u*r*(t>0?1:-1)}if(t>r){var o=t%r;t=0===o?r:o}else t<0&&0!=(t%=r)&&(t+=r);var c=!1,a=4&this.cA;a&&(c=this.UA(h));var f=c?-1:1;return this.speed<0&&(f*=-1),a&&c&&(t=r-t),i.time=n+t,i.ratio=i.time/this.duration,i.direction=f,i.stopped=e,i.iterations=h,i},n.PA=function(){return this.SA.min},n.CA=function(t){var i;null==(i=this.TA)||i.sample(t.ratio,t.direction,t.iterations)},n.NA=function(t){var i;null==(i=this.OA)||i.evaluate(t.time,Math.trunc(t.iterations))},n.IA=function(t,i){this.Ci&&this.Ci.isValid&&this.Ci.emit(t,t,i)},n.LA=function(){Qj().addAnimation(this)},n.DA=function(){Qj().removeAnimation(this)},r(i,[{key:"clip",get:function(){return this.hA}},{key:"name",get:function(){return this.Sr}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this.cA},set:function(t){var i;this.cA=t,this.time=0,this.repeatCount=2&t?1/0:1,null==(i=this.TA)||i.setWrapMode(t)}},{key:"repeatCount",get:function(){return this.fA},set:function(t){this.fA=t;var i=4&this.cA,n=!(36&~this.wrapMode);this.oA=t===1/0&&!i&&!n}},{key:"delay",get:function(){return this.Ri},set:function(t){this.vA=this.Ri=t}},{key:"playbackRange",get:function(){return this.SA},set:function(t){t.max,t.min,this.SA.min=Math.max(t.min,0),this.SA.max=Math.min(t.max,this.duration),this.mA=this.SA.max-this.SA.min,this.setTime(0)}},{key:"speed",get:function(){return this.uA},set:function(t){var i;this.uA=t,null==(i=this.OA)||i.notifyHostSpeedChanged(t)}},{key:"current",get:function(){return this.RA(this.time).time}},{key:"ratio",get:function(){return 0===this.duration?0:this.current/this.duration}},{key:"weight",get:function(){return this.AA},set:function(t){this.AA=t,this.kA&&(this.kA.weight=t)}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),i}(Xj));T.AnimationState=nH,_o(Vj+"EmbeddedAnimationClipPlayable")((Zj=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).path=tH&&tH(),i.clip=iH&&iH(),i}return e(i,t),i.prototype.instantiate=function(t){var i=this.clip,n=this.path;if(!i)return null;var r=t.getChildByPath(n);if(!r)return ht(3938,n,t.getPathInHierarchy(),i.name),null;var s=new nH(i);return s.initialize(r),new eH(s)},i}(zj),tH=uo(Zj.prototype,"path",[Co],(function(){return""})),iH=uo(Zj.prototype,"clip",[Co],(function(){return null})),Zj));var rH,sH,eH=function(t){function i(i){var n;return(n=t.call(this,!0)||this).xA=void 0,n.xA=i,n}e(i,t);var n=i.prototype;return n.destroy=function(){this.xA.destroy()},n.play=function(){this.xA.play()},n.pause=function(){this.xA.pause()},n.stop=function(){this.xA.stop()},n.setSpeed=function(t){this.xA.speed=t},n.setTime=function(t){this.xA.time=t},i}(Wj);_o(Vj+"EmbeddedParticleSystemPlayable")((rH=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).path=sH&&sH(),i}return e(i,t),i.prototype.instantiate=function(t){var i=t.getChildByPath(this.path);if(!i)return W("Hierarchy path "+this.path+" does not exists."),null;var n=ti("cc.ParticleSystem");if(!n)return W("Particle system is required for embedded particle system player."),null;var r=i.getComponent(n);return r?new vH(r):(W(this.path+" does not includes a particle system component."),null)},i}(zj),sH=uo(rH.prototype,"path",[Co],(function(){return""})),rH));var hH,uH,oH,cH,aH,fH,vH=function(t){function i(i){var n;return(n=t.call(this,!1)||this).GA=void 0,n.GA=i,n}e(i,t);var n=i.prototype;return n.destroy=function(){},n.play=function(){this.GA.play()},n.pause=function(){this.GA.stopEmitting()},n.stop=function(){this.GA.stopEmitting()},n.setSpeed=function(t){this.GA.simulationSpeed=t},i}(Wj);function lH(t){return"string"==typeof t||"number"==typeof t}var dH,wH,gH,pH,_H,yH,mH,bH,kH,AH,EH,TH,OH,SH,IH,RH,MH,CH=_o("cc.animation.HierarchyPath")((uH=function(){function t(t){this.path=oH&&oH(),this.path=t||""}return t.prototype.get=function(t){return t instanceof WE?t.getChildByPath(this.path)||(st(3926,t.name,this.path),null):(st(3925),null)},t}(),oH=uo(uH.prototype,"path",[Co],(function(){return""})),hH=uH))||hH,NH=_o("cc.animation.ComponentPath")((aH=function(){function t(t){this.component=fH&&fH(),this.component=t||""}return t.prototype.get=function(t){return t instanceof WE?t.getComponent(this.component)||(st(3928,t.name,this.component),null):(st(3927),null)},t}(),fH=uo(aH.prototype,"component",[Co],(function(){return""})),cH=aH))||cH,PH=Symbol("NormalizedFollow"),LH=Symbol("ConvertAsTrsPath"),DH=Symbol("TrackBinding"),BH=_o(Vj+"TrackPath")((wH=function(){function t(){this._paths=gH&&gH()}var i=t.prototype;return i.toProperty=function(t){return this._paths.push(t),this},i.toElement=function(t){return this._paths.push(t),this},i.toHierarchy=function(t){return this._paths.push(new CH(t)),this},i.toComponent=function(t){var i=new NH("string"==typeof t?t:Rt(t));return this._paths.push(i),this},i.toCustomized=function(t){return this._paths.push(t),this},i.append=function(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];var s=(t=this._paths).concat.apply(t,n.map((function(t){return t._paths})));return this._paths=s,this},i.isPropertyAt=function(t){return"string"==typeof this._paths[t]},i.parsePropertyAt=function(t){return this._paths[t]},i.isElementAt=function(t){return"number"==typeof this._paths[t]},i.parseElementAt=function(t){return this._paths[t]},i.isHierarchyAt=function(t){return this._paths[t]instanceof CH},i.parseHierarchyAt=function(t){return this.isHierarchyAt(t),this._paths[t].path},i.isComponentAt=function(t){return this._paths[t]instanceof NH},i.parseComponentAt=function(t){return this.isComponentAt(t),this._paths[t].component},i.slice=function(i,n){var r=new t;return r._paths=this._paths.slice(i,n),r},i.trace=function(t,i,n){var r,s;return null!==(r=i)&&void 0!==r||(i=0),null!==(s=n)&&void 0!==s||(n=this._paths.length),this[PH](t,i,n)},i[LH]=function(){for(var t,i=this._paths,n=i.length,r=0,s="";r<n;++r){var e=i[r];if(!(e instanceof CH))break;e.path&&(s?s+="/"+e.path:s=e.path)}if(r===n)return null;if(r!==n-1)return null;switch(i[r]){case"position":case"scale":case"rotation":case"eulerAngles":t=i[r];break;default:return null}return{node:s,property:t}},i[PH]=function(t,i,n){for(var r=this._paths,s=t,e=i;e<n;++e){var h=r[e];if(lH(h)){if(!(h in s))return st(3929,h),null;s=s[h]}else s=h.get(s);if(null===s)break}return s},r(t,[{key:"length",get:function(){return this._paths.length}}]),t}(),gH=uo(wH.prototype,"_paths",[Co],(function(){return[]})),dH=wH))||dH,FH=_o(Vj+"TrackBinding")(pH=Do((bH=function(){function t(){this.path=yH&&yH(),this.proxy=mH&&mH()}var i=t.prototype;return i.parseTrsPath=function(){return this.proxy?null:this.path[LH]()},i.createRuntimeBinding=function(i,n,r){var s=this.path,e=this.proxy,h=s.length,u=h-1;if(0===h||!s.isPropertyAt(u)&&!s.isElementAt(u)||e){if(e){var o=s[PH](i,0,h);if(null===o)return null;var c=e.forTarget(o);if(!c)return null;var a={setValue:function(t){c.set(t)}},f=c.get;return f&&(a.getValue=function(){return f.call(c)}),a}return ht(3921),null}var v=s.isPropertyAt(u)?s.parsePropertyAt(u):s.parseElementAt(u),l=s[PH](i,0,h-1);if(null===l)return null;if(n&&l instanceof WE&&UH(v))return n.createPoseWriter(l,v,r);var d=t.jA.get(l.constructor);d||(d=new Map,t.jA.set(l.constructor,d));var w=d.get(v);return w||(w={setValue:Function("value","this.target."+v+" = value;"),getValue:Function("return this.target."+v+";")},d.set(v,w)),{target:l,setValue:w.setValue,getValue:w.getValue}},i.isMaskedOff=function(t){var i=this.parseTrsPath();if(!i)return!1;for(var n=t.joints[Symbol.iterator](),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.path===i.node)return!s.enabled}return!1},t}(),bH.jA=new WeakMap,yH=uo((_H=bH).prototype,"path",[Co],(function(){return new BH})),mH=uo(_H.prototype,"proxy",[Co],null),pH=_H))||pH)||pH;function UH(t){return"position"===t||"rotation"===t||"scale"===t||"eulerAngles"===t}var xH,GH,jH=_o(Vj+"Track")((AH=function(){function t(){this._binding=EH&&EH()}var i=t.prototype;return i.channels=function(){return[]},i.range=function(){for(var t,i={min:1/0,max:-1/0},n=w(this.channels());!(t=n()).done;){var r=t.value;i.min=Math.min(i.min,r.curve.rangeMin),i.max=Math.max(i.max,r.curve.rangeMax)}return i},r(t,[{key:"path",get:function(){return this._binding.path},set:function(t){this._binding.path=t}},{key:"proxy",get:function(){return this._binding.proxy},set:function(t){this._binding.proxy=t}},{key:DH,get:function(){return this._binding}}]),t}(),EH=uo(AH.prototype,"_binding",[Co],(function(){return new FH})),kH=AH))||kH,HH=_o(Vj+"Channel")((OH=function(){function t(t){this.name="",this._curve=SH&&SH(),this._curve=t}return r(t,[{key:"curve",get:function(){return this._curve}}]),t}(),SH=uo(OH.prototype,"_curve",[Co],null),TH=OH))||TH,VH=_o(Vj+"SingleChannelTrack")((RH=function(t){function i(){var i;return(i=t.call(this)||this)._channel=MH&&MH(),i._channel=new HH(i.createCurve()),i}e(i,t);var n=i.prototype;return n.channels=function(){return[this._channel]},n.createCurve=function(){throw new Error("Not impl")},n[$j]=function(){var t=this._channel.curve;return new $H(t)},r(i,[{key:"channel",get:function(){return this._channel}}]),i}(jH),MH=uo(RH.prototype,"_channel",[Co],null),IH=RH))||IH,$H=function(){function t(t){this.HA=t}return t.prototype.evaluate=function(t){return this.HA.evaluate(t)},r(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),zH=Co;_o(Vj+"RealArrayTrack")((xH=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._channels=GH&&GH(),i}e(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[$j]=function(){return new eV(this._channels.map((function(t){return t.curve})))},r(i,[{key:"elementCount",get:function(){return this._channels.length},set:function(t){var i=this._channels.length;if(t<i)this._channels.splice(t);else if(t>i){var n;(n=this._channels).push.apply(n,Array.from({length:t-i},(function(){return new HH(new pa)})))}}}]),i}(jH),GH=uo(xH.prototype,"_channels",[zH],(function(){return[]})),xH));var WH,XH,YH,KH,qH,QH,JH,ZH,tV,iV,nV,rV,sV,eV=function(){function t(t){this.VA=t,this.zd=new Array(t.length).fill(0)}return t.prototype.evaluate=function(t){for(var i=this.zd,n=i.length,r=0;r<n;++r)i[r]=this.VA[r].evaluate(t);return this.zd},r(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),hV=_o("cc.animation.UniformProxyFactory")((XH=function(){function t(t,i){this.passIndex=YH&&YH(),this.uniformName=KH&&KH(),_(this,"channelIndex",qH,this),this.passIndex=i||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){if(t instanceof hA){var i=this.passIndex,n=this.uniformName,r=this.channelIndex;if(i<0||i>=t.passes.length)st(3941,t.name,i);else{var s=t.passes[i],e=s.getHandle(n);if(e){if(um(e)<26){var h=void 0===r?e:s.getHandle(n,r,13);return h?uV(s,n)?{set:function(t){s.setUniformArray(h,t)}}:{set:function(t){s.setUniform(h,t)}}:void st(3943,t.name,i,n,r)}var u=om(e),o=s.properties[n],c=o&&o.value?""+o.value+pm(o.type):gm(o.type),a=Fk.get(c);return a||(W("Illegal texture default value: "+c+"."),a=Fk.get("default-texture")),{set:function(t){t||(t=a);var i=t.getGFXTexture();i&&i.width&&i.height&&(s.bindTexture(u,i),t instanceof Tg&&s.bindSampler(u,kw.gfxDevice.getSampler(t.getSamplerInfo())))}}}st(3942,t.name,i,n)}}else st(3940,t)},t}(),YH=uo(XH.prototype,"passIndex",[Co],(function(){return 0})),KH=uo(XH.prototype,"uniformName",[Co],(function(){return""})),qH=y(XH.prototype,"channelIndex",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),WH=XH))||WH;function uV(t,i){for(var n,r=w(t.shaderInfo.blocks);!(n=r()).done;)for(var s,e=w(n.value.members);!(s=e()).done;){var h=s.value;if(h.name===i)return h.count>1}return!1}var oV,cV,aV,fV,vV,lV=_o("cc.animation.MorphWeightValueProxy")((JH=function(){function t(){this.subMeshIndex=ZH&&ZH(),this.shapeIndex=tV&&tV()}return t.prototype.forTarget=function(t){var i=this;return{set:function(n){t.setWeight(n,i.subMeshIndex,i.shapeIndex)}}},t}(),ZH=uo(JH.prototype,"subMeshIndex",[Co],(function(){return 0})),tV=uo(JH.prototype,"shapeIndex",[Co],(function(){return 0})),QH=JH))||QH,dV=_o("cc.animation.MorphWeightsValueProxy")((nV=function(){function t(){this.subMeshIndex=rV&&rV()}return t.prototype.forTarget=function(t){var i=this;return{set:function(n){t.setWeights(n,i.subMeshIndex)}}},t}(),rV=uo(nV.prototype,"subMeshIndex",[Co],(function(){return 0})),iV=nV))||iV,wV=_o("cc.animation.MorphWeightsAllValueProxy")(sV=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(i){for(var n,r,s=null!==(n=null==(r=t.mesh)?void 0:r.struct.primitives.length)&&void 0!==n?n:0,e=0;e<s;++e)t.setWeights(i,e)}}},t}())||sV;function gV(t,i,n,r){var s,e,h,u,o,c=new i,a=new i,f=new i,v=_o(t)((e=function(){function t(t,n,r){this.dataPoint=h&&h(),this.inTangent=u&&u(),this.outTangent=o&&o(),this.dataPoint=t||new i,this.inTangent=n||new i,this.outTangent=r||new i}var s=t.prototype;return s.lerp=function(t,i,s){var e=this.dataPoint,h=t.dataPoint;a=n(a,this.inTangent,s),f=n(f,t.outTangent,s);var u=i*i*i,o=i*i,v=u-2*o+i,l=-2*u+3*o,d=u-o;return c=n(c,e,2*u-3*o+1),c=r(c,c,a,v),c=r(c,c,h,l),c=r(c,c,f,d)},s.getNoLerp=function(){return this.dataPoint},t}(),h=uo(e.prototype,"dataPoint",[Co],(function(){return new i})),u=uo(e.prototype,"inTangent",[Co],(function(){return new i})),o=uo(e.prototype,"outTangent",[Co],(function(){return new i})),s=e))||s;if(i===Qr){var l=v.prototype.lerp;v.prototype.lerp=function(t,i,n){var r=l.call(this,t,i,n);return Qr.normalize(r,r),r}}return v}var pV,_V,yV,mV,bV,kV=gV("cc.CubicSplineVec2Value",Ms,Ms.multiplyScalar,Ms.scaleAndAdd),AV=gV("cc.CubicSplineVec3Value",Ir,Ir.multiplyScalar,Ir.scaleAndAdd),EV=gV("cc.CubicSplineVec4Value",$s,$s.multiplyScalar,$s.scaleAndAdd),TV=gV("cc.CubicSplineQuatValue",Qr,Qr.multiplyScalar,Qr.scaleAndAdd),OV=_o("cc.CubicSplineNumberValue")((cV=function(){function t(t,i,n){this.dataPoint=aV&&aV(),this.inTangent=fV&&fV(),this.outTangent=vV&&vV(),this.dataPoint=t,this.inTangent=i,this.outTangent=n}var i=t.prototype;return i.lerp=function(t,i,n){var r=this.dataPoint,s=t.dataPoint,e=i*i*i,h=i*i;return r*(2*e-3*h+1)+this.outTangent*n*(e-2*h+i)+s*(-2*e+3*h)+t.inTangent*n*(e-h)},i.getNoLerp=function(){return this.dataPoint},t}(),aV=uo(cV.prototype,"dataPoint",[Co],(function(){return 0})),fV=uo(cV.prototype,"inTangent",[Co],(function(){return 0})),vV=uo(cV.prototype,"outTangent",[Co],(function(){return 0})),oV=cV))||oV,SV=_o(Vj+"RealTrack")(pV=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.createCurve=function(){return new pa},i}(VH))||pV;function IV(t){return 0===t.keyFramesCount?void 0:t}var RV,MV,CV,NV,PV,LV,DV,BV,FV=["X","Y","Z","W"],UV=_o(Vj+"VectorTrack")((yV=function(t){function i(){var i;(i=t.call(this)||this)._channels=mV&&mV(),i._nComponents=bV&&bV(),i._channels=new Array(4);for(var n=0;n<i._channels.length;++n){var r=new HH(new pa);r.name=FV[n],i._channels[n]=r}return i}e(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[$j]=function(){switch(this._nComponents){default:case 2:return new xV(IV(this._channels[0].curve),IV(this._channels[1].curve));case 3:return new GV(IV(this._channels[0].curve),IV(this._channels[1].curve),IV(this._channels[2].curve));case 4:return new jV(IV(this._channels[0].curve),IV(this._channels[1].curve),IV(this._channels[2].curve),IV(this._channels[3].curve))}},r(i,[{key:"componentsCount",get:function(){return this._nComponents},set:function(t){this._nComponents=t}}]),i}(jH),mV=uo(yV.prototype,"_channels",[Co],null),bV=uo(yV.prototype,"_nComponents",[Co],(function(){return 4})),_V=yV))||_V,xV=function(){function t(t,i){this.zd=new Ms,this.Re=t,this.Me=i}return t.prototype.evaluate=function(t,i){return i&&Ms.copy(this.zd,i),this.Re&&(this.zd.x=this.Re.evaluate(t)),this.Me&&(this.zd.y=this.Me.evaluate(t)),this.zd},r(t,[{key:"requiresDefault",get:function(){return!this.Re||!this.Me}}]),t}(),GV=function(){function t(t,i,n){this.zd=new Ir,this.Re=t,this.Me=i,this.$A=n}return t.prototype.evaluate=function(t,i){var n=this.Re,r=this.Me,s=this.$A,e=this.zd;return i&&Ir.copy(e,i),n&&(e.x=n.evaluate(t)),r&&(e.y=r.evaluate(t)),s&&(e.z=s.evaluate(t)),e},r(t,[{key:"requiresDefault",get:function(){return!this.Re||!this.Me||!this.$A}}]),t}(),jV=function(){function t(t,i,n,r){this.zd=new $s,this.Re=t,this.Me=i,this.$A=n,this.zA=r}return t.prototype.evaluate=function(t,i){return i&&$s.copy(this.zd,i),this.Re&&(this.zd.x=this.Re.evaluate(t)),this.Me&&(this.zd.y=this.Me.evaluate(t)),this.$A&&(this.zd.z=this.$A.evaluate(t)),this.zA&&(this.zd.w=this.zA.evaluate(t)),this.zd},r(t,[{key:"requiresDefault",get:function(){return!(this.Re&&this.Me&&this.$A&&this.zA)}}]),t}(),HV=_o(Vj+"QuatTrack")(RV=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.createCurve=function(){return new wf},n[$j]=function(){return new VV(this.channels()[0].curve)},i}(VH))||RV,VV=function(){function t(t){this.zd=new Qr,this.HA=t}return t.prototype.evaluate=function(t){return this.HA.evaluate(t,this.zd),this.zd},r(t,[{key:"requiresDefault",get:function(){return!1}}]),t}(),$V=["Red","Green","Blue","Alpha"],zV=_o(Vj+"ColorTrack")((CV=function(t){function i(){var i;(i=t.call(this)||this)._channels=NV&&NV(),i._channels=new Array(4);for(var n=0;n<i._channels.length;++n){var r=new HH(new pa);r.name=$V[n],i._channels[n]=r}return i}e(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[$j]=function(){return new WV(IV(this._channels[0].curve),IV(this._channels[1].curve),IV(this._channels[2].curve),IV(this._channels[3].curve))},i}(jH),NV=uo(CV.prototype,"_channels",[Co],null),MV=CV))||MV,WV=function(){function t(t,i,n,r){this.zd=new Qs,this.Re=t,this.Me=i,this.$A=n,this.zA=r}return t.prototype.evaluate=function(t,i){return i&&Qs.copy(this.zd,i),this.Re&&(this.zd.r=this.Re.evaluate(t)),this.Me&&(this.zd.g=this.Me.evaluate(t)),this.$A&&(this.zd.b=this.$A.evaluate(t)),this.zA&&(this.zd.a=this.zA.evaluate(t)),this.zd},r(t,[{key:"requiresDefault",get:function(){return!(this.Re&&this.Me&&this.$A&&this.zA)}}]),t}(),XV=["Width","Height"],YV=_o(Vj+"SizeTrack")((LV=function(t){function i(){var i;(i=t.call(this)||this)._channels=DV&&DV(),i._channels=new Array(2);for(var n=0;n<i._channels.length;++n){var r=new HH(new pa);r.name=XV[n],i._channels[n]=r}return i}e(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[$j]=function(){return new KV(IV(this._channels[0].curve),IV(this._channels[1].curve))},i}(jH),DV=uo(LV.prototype,"_channels",[Co],null),PV=LV))||PV,KV=function(){function t(t,i){this.zd=new ie,this.Xn=t,this.Yn=i}return t.prototype.evaluate=function(t,i){return i&&(this.zd.x=i.x,this.zd.y=i.y),this.Xn&&(this.zd.width=this.Xn.evaluate(t)),this.Yn&&(this.zd.height=this.Yn.evaluate(t)),this.zd},r(t,[{key:"requiresDefault",get:function(){return!this.Xn||!this.Yn}}]),t}(),qV=_o(Vj+"ObjectTrack")(BV=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.createCurve=function(){return new Ef},i}(VH))||BV,QV=Symbol("[[Owner]]");function JV(t){t[QV]}var ZV,t$,i$,n$,r$,s$,e$,h$,u$,o$,c$,a$,f$,v$=Symbol("CreateInstance"),l$=function(){function t(t){this.WA=[],this.type=t}return t.prototype.bind=function(t,i){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];return this.WA.push({fn:t,thisArg:i,args:r}),this.getValue()},r(t,[{key:"value",get:function(){return this.getValue()},set:function(t){this.setValue(t);for(var i,n=w(this.WA);!(i=n()).done;){var r=i.value,s=r.fn,e=r.thisArg,h=r.args;s.call.apply(s,[e,t].concat(h))}}}]),t}(),d$=_o("cc.animation.PlainVariable")((t$=function(){function t(t){if(this._type=i$&&i$(),this._value=n$&&n$(),void 0!==t)switch(this._type=t,t){default:break;case 0:case 3:this._value=0;break;case 1:this._value=!1}}return t.prototype[v$]=function(){return new w$(this._type,this._value)},r(t,[{key:"type",get:function(){return this._type}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),i$=uo(t$.prototype,"_type",[Co],(function(){return 0})),n$=uo(t$.prototype,"_value",[Co],(function(){return 0})),ZV=t$))||ZV,w$=function(t){function i(i,n){var r;return(r=t.call(this,i)||this).XA=void 0,r.XA=n,r}e(i,t);var n=i.prototype;return n.getValue=function(){return this.XA},n.setValue=function(t){this.XA=t},i}(l$),g$=_o("cc.animation.TriggerVariable")((s$=function(){function t(){this._flags=e$&&e$()}return t.prototype[v$]=function(){return new p$(this.value,this.resetMode)},r(t,[{key:"type",get:function(){return 2}},{key:"value",get:function(){return!!(1&this._flags)},set:function(t){t?this._flags|=1:this._flags&=-2}},{key:"resetMode",get:function(){return(6&this._flags)>>1},set:function(t){this._flags&=-7,this._flags|=t<<1}}]),t}(),e$=uo(s$.prototype,"_flags",[Co],(function(){return 0})),r$=s$))||r$,p$=function(t){function i(i,n){var r;return(r=t.call(this,2)||this).resetMode=0,r.XA=void 0,r.resetMode=n,r.XA=i,r}e(i,t);var n=i.prototype;return n.getValue=function(){return this.XA},n.setValue=function(t){this.XA=t},i}(l$),_$=_o("cc.animation.Vec3Variable")((u$=function(){function t(){this._value=o$&&o$()}return t.prototype[v$]=function(){return new y$(this.value)},r(t,[{key:"type",get:function(){return 4}},{key:"value",get:function(){return this._value},set:function(t){Ir.copy(this._value,t)}}]),t}(),o$=uo(u$.prototype,"_value",[Co],(function(){return new Ir})),h$=u$))||h$,y$=function(t){function i(i){var n;return(n=t.call(this,4)||this).XA=new Ir,Ir.copy(n.XA,i),n}e(i,t);var n=i.prototype;return n.getValue=function(){return this.XA},n.setValue=function(t){Ir.copy(this.XA,t)},i}(l$),m$=_o("cc.animation.QuatVariable")((a$=function(){function t(){this._value=f$&&f$()}return t.prototype[v$]=function(){return new b$(this._value)},r(t,[{key:"type",get:function(){return 5}},{key:"value",get:function(){return this._value},set:function(t){Qr.copy(this._value,t)}}]),t}(),f$=uo(a$.prototype,"_value",[Co],(function(){return new Qr})),c$=a$))||c$,b$=function(t){function i(i){var n;return(n=t.call(this,5)||this).XA=new Qr,Qr.copy(n.XA,i),n}e(i,t);var n=i.prototype;return n.getValue=function(){return this.XA},n.setValue=function(t){Qr.copy(this.XA,t)},i}(l$);function k$(t,i){var n;switch(t){case 0:case 3:case 1:n=new d$(t);break;case 2:n=new g$;break;case 4:n=new _$;break;case 5:n=new m$;break;default:throw new Error("Unknown variable type "+t)}return void 0!==i&&(n.value=i),n}var A$,E$,T$,O$,S$,I$,R$=function(t){function i(i){var n;return(n=t.call(this,i+" transition is invalid")||this).name="TransitionRejectError",n}return e(i,t),i}(a(Error)),M$=function(t){function i(i){return t.call(this,"Graph variable "+i+" is not defined")||this}return e(i,t),i}(a(Error)),C$=function(t){function i(i,n,r){return t.call(this,"Expect graph variable "+i+" to have type '"+n+"' instead of received '"+(null!=r?r:typeof r)+"'")||this}return e(i,t),i}(a(Error)),N$=1,P$=-4192741,L$=[];function D$(t){return"function"==typeof t._instantiate}function B$(t){var i;if(Ke(t)){if(D$(t))return T.game._isCloning=!0,i=t._instantiate(null,!0),T.game._isCloning=!1,i;if(t instanceof T.Asset)throw new TypeError(at(6903))}return T.game._isCloning=!0,i=F$(t),T.game._isCloning=!1,i}function F$(t,i){var n;x$(t,n=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),i);for(var r=0,s=L$.length;r<s;++r)L$[r]._iN$t=null;return L$.length=0,n}function U$(t,i,n,r){for(var s=t.__values__,e=0;e<s.length;e++){var h=s[e],u=i[h];if("object"==typeof u&&u){var o=n[h];o instanceof ki&&o.constructor===u.constructor?o.set(u):n[h]=u._iN$t||G$(u,r)}else n[h]=u}}function x$(t,i,n){Et(t,"_iN$t",i,!0),L$.push(t);var r=t.constructor;if(On(r))U$(r,t,i,n);else for(var s in t)if(t.hasOwnProperty(s)&&(95!==s.charCodeAt(0)||95!==s.charCodeAt(1)||"__type__"===s||"__prefab"===s)){var e=t[s];if("object"==typeof e&&e){if(e===i)continue;i[s]=e._iN$t||G$(e,n)}else i[s]=e}Ke(t)&&(i._objFlags&=P$)}function G$(t,i){if(t instanceof ki)return t.clone();if(t instanceof T.Asset)return t;var n;if(ArrayBuffer.isView(t)){var r=t.length;n=new t.constructor(r),t._iN$t=n,L$.push(t);for(var s=0;s<r;++s)n[s]=t[s];return n}if(Array.isArray(t)){var e=t.length;n=new Array(e),t._iN$t=n,L$.push(t);for(var h=0;h<e;++h){var u=t[h];n[h]="object"==typeof u&&u?u._iN$t||G$(u,i):u}return n}if(t._objFlags&N$)return null;var o,c=t.constructor;if(On(c)){if(i)if(i instanceof Kg){if(t instanceof WE||t instanceof Kg)return t}else if(i instanceof WE)if(t instanceof WE){if(!(t.isChildOf(i)||"object"==typeof(o=t[He])&&o.mountedRoot))return t}else if(t instanceof Kg&&t.node&&!t.node.isChildOf(i))return t;n=new c}else if(c===Object)n={};else{if(c)return t;n=Object.create(null)}return x$(t,n,i),n}function j$(t){var i=t[He];if("object"==typeof i&&i){var n=i;return null==n.clone?void 0:n.clone(t)}}B$._clone=F$,T.instantiate=B$;var H$,V$,$$,z$=Symbol("[[Outgoing transitions]]"),W$=Symbol("[[Incoming transitions]]"),X$=_o,Y$=Co,K$=X$("cc.animation.State")((E$=function(t){function i(){var i;return(i=t.call(this)||this).name=T$&&T$(),i[z$]=[],i[W$]=[],i}return e(i,t),i.prototype.copyTo=function(t){t.name=this.name,t[He]=j$(this)},i}(fc),T$=uo(E$.prototype,"name",[Y$],(function(){return""})),A$=E$))||A$,q$=X$(Vj+"InteractiveState")((S$=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._components=I$&&I$(),i}e(i,t);var n=i.prototype;return n.addComponent=function(t){var i=new t;return this._components.push(i),i},n.removeComponent=function(t){ui(this._components,t)},n.instantiateComponents=function(){return this._components.map((function(t){return B$(t)}))},n.copyTo=function(i){t.prototype.copyTo.call(this,i),i._components=this.instantiateComponents()},r(i,[{key:"components",get:function(){return this._components}}]),i}(K$),I$=uo(S$.prototype,"_components",[Y$],(function(){return[]})),O$=S$))||O$;function Q$(t,i,n){for(var r=t.components,s=r.length,e=0;e<s;++e){var h=r[e],u=h[i];"function"==typeof u&&u.apply(h,n)}}var J$,Z$,tz,iz,nz,rz,sz,ez,hz,uz=_o(Vj+"AnimationGraphEventBinding")((V$=function(){function t(){this.methodName=$$&&$$()}var i=t.prototype;return i.emit=function(t){this.methodName&&Q$(t,this.methodName,[])},i.copyTo=function(t){return t.methodName=this.methodName,this},r(t,[{key:"isBound",get:function(){return!!this.methodName}}]),t}(),$$=uo(V$.prototype,"methodName",[Co],(function(){return""})),H$=V$))||H$,oz=_o("cc.animation.Motion")((Z$=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).motion=tz&&tz(),i.speed=iz&&iz(),i.speedMultiplier=nz&&nz(),i.speedMultiplierEnabled=rz&&rz(),i.transitionInEventBinding=sz&&sz(),i.transitionOutEventBinding=ez&&ez(),i}e(i,t);var n=i.prototype;return n.__callOnAfterDeserializeRecursive=function(){var t;null==(t=this.motion)||t.__callOnAfterDeserializeRecursive()},n.copyTo=function(i){var n,r;return t.prototype.copyTo.call(this,i),i.motion=null!==(n=null==(r=this.motion)?void 0:r.clone())&&void 0!==n?n:null,i.speed=this.speed,i.speedMultiplier=this.speedMultiplier,i.speedMultiplierEnabled=this.speedMultiplierEnabled,this.transitionInEventBinding.copyTo(i.transitionInEventBinding),this.transitionOutEventBinding.copyTo(i.transitionOutEventBinding),this},i}(q$),tz=uo(Z$.prototype,"motion",[Co],(function(){return null})),iz=uo(Z$.prototype,"speed",[Co],(function(){return 1})),nz=uo(Z$.prototype,"speedMultiplier",[Co],(function(){return""})),rz=uo(Z$.prototype,"speedMultiplierEnabled",[Co],(function(){return!1})),sz=uo(Z$.prototype,"transitionInEventBinding",[Co],(function(){return new uz})),ez=uo(Z$.prototype,"transitionOutEventBinding",[Co],(function(){return new uz})),J$=Z$))||J$,cz=Symbol("[[OnAfterDeserialized]]"),az=_o(Vj+"AnimationGraphLike")(hz=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(rg))||hz;function fz(t,i,n){var r=Object.prototype.propertyIsEnumerable;if(!r.call(t,i))return t;if(n in t)return t;var s={};return"symbol"==typeof i?(Object.entries(t).forEach((function(t){var i=t[0],n=t[1];s[i]=n})),Object.getOwnPropertySymbols(t).forEach((function(e){r.call(t,e)&&(s[e===i?n:e]=t[e])}))):(Object.entries(t).forEach((function(t){var r=t[0],e=t[1];s[r===i?n:r]=e})),Object.getOwnPropertySymbols(t).forEach((function(i){r.call(t,i)&&(s[i]=t[i])}))),s}var vz,lz,dz,wz,gz,pz,_z,yz,mz=function(){var t=!1;try{t=[]instanceof function(){function t(){}return t[Symbol.hasInstance]=function(t){return Array.isArray(t)},t}()}catch(i){t=!1}return t?function(t){function i(){throw new Error("This function can not be called as a constructor.")}return Object.defineProperty(i,Symbol.hasInstance,{value:function(i){return i instanceof t}}),i}:function(t){return t}}(),bz=_o(Vj+"PoseGraphNodeShell")((lz=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._bindings=dz&&dz(),i}e(i,t);var n=i.prototype;return n.getBindings=function(){return this._bindings},n.addBinding=function(t,i,n){this.YA(new Az(t,i,n))},n.deleteBinding=function(t){var i=this.KA(t);i>=0&&this._bindings.splice(i,1)},n.moveArrayElementBindingForward=function(t,i,n){for(var r=this._bindings,s=[],e=0;e<r.length;++e){var h=r[e],u=h.inputPath,o=u[0],c=u[1];o===t&&(void 0===c?-1:c)>=i&&(s.push(h),r.splice(e,1))}for(var a=0,f=s;a<f.length;a++){var v=f[a],l=v.inputPath,d=l[0],w=l[1],g=void 0===w?-1:w;this.addBinding([d,g+(n?-1:1)],v.producer,v.outputIndex)}},n.deleteBindingTo=function(t){for(var i=this._bindings,n=0;n<i.length;++n)i[n].producer===t&&i.splice(n,1)},n.findBinding=function(t){var i=this.KA(t);return i>=0?this._bindings[i]:void 0},n.KA=function(t){return this._bindings.findIndex((function(i){return kz(i.inputPath,t)}))},n.YA=function(t){var i=this._bindings.findIndex((function(i){return kz(i.inputPath,t.inputPath)}));i>=0?this._bindings[i]=t:this._bindings.push(t)},i}(fc),dz=uo(lz.prototype,"_bindings",[Co],(function(){return[]})),vz=lz))||vz;function kz(t,i){var n=t[0],r=t[1],s=i[0],e=i[1];return n===s&&r===e}var Az=_o(Vj+"PoseGraphNodeInputBinding")((gz=function(){function t(t,i,n){this._inputPath=pz&&pz(),this._producer=_z&&_z(),this._outputIndex=yz&&yz(),this._inputPath=t,this._producer=i,void 0!==n&&(this._outputIndex=n)}return r(t,[{key:"inputPath",get:function(){return this._inputPath}},{key:"producer",get:function(){return this._producer}},{key:"outputIndex",get:function(){return this._outputIndex}}]),t}(),pz=uo(gz.prototype,"_inputPath",[Co],null),_z=uo(gz.prototype,"_producer",[Co],null),yz=uo(gz.prototype,"_outputIndex",[Co],(function(){return 0})),wz=gz))||wz,Ez=function(t){function i(i){return t.call(this,"Can not add the specified "+i.toString()+" since it has already been added into another graph.")||this}return e(i,t),i}(a(Error)),Tz=function(t){function i(i){return t.call(this,"Can not perform specified operation on "+i.toString()+" since it has not been added in to graph.")||this}return e(i,t),i}(a(Error)),Oz=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(fc),Sz=new WeakMap;function Iz(t){var i=Sz.get(t);if(i)return i;var n={};return Sz.set(t,n),n}function Rz(t){return function(i){if(Ht(i,Oz)||(X("This kind of decorator should only be applied to pose graph node classes."),0)){var n=Iz(i);t(n)}}}var Mz=function(t){return Rz((function(i){i.category=t}))},Cz=function(t){return Rz((function(i){i.factory=t}))},Nz=function(t){return void 0===t&&(t=!0),Rz((function(i){i.hide=t}))},Pz=function(t){return Rz((function(i){var n;Object.assign(null!==(n=i.appearance)&&void 0!==n?n:i.appearance={},t)}))};var Lz=["arraySyncGroup"],Dz=function(){function t(){this.qA=new WeakMap}var i=t.prototype;return i.setPropertyNodeInputRecord=function(t,i,n){var r=this.qA.get(t);r||(r={properties:{}},this.qA.set(t,r)),n.arraySyncGroup;var s=f(n,Lz),e=n.arraySyncGroup;if(e){var h,u;r.arraySyncGroups||(r.arraySyncGroups={});var o=null!==(u=(h=r.arraySyncGroups)[e])&&void 0!==u?u:h[e]={members:[]};o.members.includes(i)||o.members.push(i),s.arraySyncGroup=o}r.properties[i]=Object.freeze(s)},i.getInputKeys=function(t){var i=this,n=[];return function r(s){if(s){r(jt(s));var e=i.qA.get(s);if(e)for(var h=function(){var i=o[u][0];if(n.findIndex((function(t){var n=t[0];return i===n}))>=0)return 1;var r=t[i];if(Array.isArray(r))for(var s=0;s<r.length;++s)n.push([i,s]);else n.push([i])},u=0,o=Object.entries(e.properties);u<o.length;u++)h()}}(t.constructor),n},i.isPoseInput=function(t,i){var n=i[0],r=this.QA(t.constructor,n);return!!r&&5===r.type},i.getInputMetadata=function(t,i){var n=i[0],r=i[1],s=void 0===r?-1:r,e=this.QA(t.constructor,n);if(e){var h=t[n];if(Array.isArray(h)){if(s<0||s>=h.length)return;var u,o,c=null!==(u=null==(o=e.getArrayElementDisplayName)?void 0:o.call(t,s))&&void 0!==u?u:e.displayName;return{type:e.type,displayName:c,deletable:!(e.arraySyncGroup&&e.arraySyncGroupFollower),insertPoint:!0}}return{type:e.type,displayName:e.displayName}}},i.hasInput=function(t,i){var n=i[0],r=i[1],s=void 0===r?-1:r;if(!this.QA(t.constructor,n))return!1;var e=t[n];return!Array.isArray(e)||!(s<0||s>=e.length)},i.getInputInsertInfos=function(t){for(var i={},n=t.constructor;n;n=jt(n)){var r=this.qA.get(n);if(r)for(var s in r.properties){var e=r.properties[s],h=t[s];if(Array.isArray(h)){if(e.arraySyncGroup&&e.arraySyncGroupFollower)continue;i[s]={displayName:s}}}}return i},i.deleteInput=function(t,i,n){var r=n[0],s=n[1],e=void 0===s?-1:s,h=this.QA(i.constructor,r);if(h){var u=i[r];if(Array.isArray(u)&&!(e<0||e>=u.length)){var o=h.arraySyncGroup;o?this.JA(t,i,o,u.length,e):Fz(t,i,n)}}},i.insertInput=function(t,i,n){var r=n,s=this.QA(i.constructor,r);if(s){var e=i[r];if(Array.isArray(e)){var h=e.length,u=s.arraySyncGroup;u?this.ZA(t,i,u,e.length,h):Bz(t,i,[r,h],Uz(s.type))}}},i.QA=function(t,i){if(t){var n=this.qA.get(t);if(n){var r=n.properties[i];if(r)return r}return this.QA(jt(t),i)}},i.ZA=function(t,i,n,r,s){for(var e=0;e<n.members.length;++e){var h=n.members[e],u=this.QA(i.constructor,h),o=i[h];Array.isArray(o)&&o.length===r&&Bz(t,i,[h,s],Uz(u.type))}},i.JA=function(t,i,n,r,s){for(var e=0;e<n.members.length;++e){var h=n.members[e];this.QA(i.constructor,h);var u=i[h];Array.isArray(u)&&u.length===r&&Fz(t,i,[h,s])}},t}();function Bz(t,i,n,r){var s=t.getShell(i);if(!s)throw new Tz(i);var e=n[0],h=n[1],u=void 0===h?-1:h,o=i[e];Array.isArray(o)&&(o.splice(u,0,r),s.moveArrayElementBindingForward(e,u+1,!1))}function Fz(t,i,n){var r=t.getShell(i);if(!r)throw new Tz(i);var s=n[0],e=n[1],h=void 0===e?-1:e,u=i[s];Array.isArray(u)&&(h<0||h>=u.length||(r.deleteBinding(n),u.splice(h,1),r.moveArrayElementBindingForward(s,h+1,!0)))}function Uz(t){switch(t){default:case 0:case 1:return 0;case 2:return!1;case 5:return null;case 3:return new Ir;case 4:return new Qr}}var xz,Gz=new Dz;bi({NO:0,LOCAL:1,COMPONENT:2});var jz,Hz,Vz,$z,zz,Wz,Xz=_o(Vj+"PoseNode")(xz=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).tE=void 0,i}e(i,t);var n=i.prototype;return n.update=function(t){var i;null==(i=this.tE)||i.evaluate(),this.doUpdate(t)},n.evaluate=function(t,i){var n=this.doEvaluate(t),r=n._poseTransformSpace;switch(i){default:case 0:break;case 1:1===r&&t._poseTransformsSpaceComponentToLocal(n),n._poseTransformSpace;break;case 2:0===r&&t._poseTransformsSpaceLocalToComponent(n),n._poseTransformSpace}return n},i.evaluateDefaultPose=function(t,i){switch(i){default:case 0:case 1:return t.pushDefaultedPose();case 2:return t.pushDefaultedPoseInComponentSpace()}},n._setDependencyEvaluation=function(t){this.tE=t},n._forceEvaluateEvaluation=function(){var t;null==(t=this.tE)||t.evaluate()},i}(Oz))||xz,Yz=function(t){function i(i){var n;return(n=t.call(this)||this).iE=[],n.iE=i,n}e(i,t);var n=i.prototype;return n.getOutputType=function(t){return this.iE[t]},n.link=function(){},r(i,[{key:"outputCount",get:function(){return this.iE.length}}]),i}(Oz),Kz=function(t){function i(i){return t.call(this,[i])||this}return e(i,t),i.prototype.selfEvaluate=function(t){t[0]=this.selfEvaluateDefaultOutput()},i}(Yz);function qz(t){return function(i,n){var r=i.constructor;5!==t.type||Ht(r,Xz)?Ht(r,Xz)||Ht(r,Yz)?Qz(t)(i,n):X("@input can be only applied to fields of subclasses of PoseNode or PureValueNode."):X("@input specifying pose input can be only applied to fields of subclasses of PoseNode.")}}function Qz(t){return function(i,n){if("string"==typeof n){var r=i.constructor;Gz.setPropertyNodeInputRecord(r,n,t),So(i,n).__internalFlags|=3}else X("@input can be only applied to string-named fields.")}}var Jz,Zz,tW,iW,nW,rW,sW,eW,hW,uW,oW,cW,aW,fW,vW,lW,dW,wW,gW,pW,_W,yW,mW,bW,kW,AW,EW,TW,OW,SW,IW,RW,MW,CW,NW,PW,LW,DW,BW,FW,UW,xW,GW,jW,HW,VW,$W,zW,WW,XW,YW,KW,qW,QW,JW,ZW,tX,iX,nX,rX,sX=(jz=_o(Vj+"PoseGraphOutputNode"),Hz=Pz({themeColor:"#CD3A58",inline:!0}),Vz=Qz({type:5}),jz($z=Hz((zz=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return _(i=t.call.apply(t,[this].concat(r))||this,"pose",Wz,v(i)),i}return e(i,t),i}(Oz),Wz=y(zz.prototype,"pose",[Co,Vz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$z=zz))||$z)||$z),eX=_o(Vj+"PoseGraph")((Zz=function(t){function i(){var i;return(i=t.call(this)||this)._outputNode=tW&&tW(),i._nodes=iW&&iW(),i._shells=nW&&nW(),i._shellMap=rW&&rW(),i.addNode(i._outputNode),i}e(i,t);var n=i.prototype;return n.__callOnAfterDeserializeRecursive=function(){this._nodes.length,this._shells.length;for(var t=0;t<this._nodes.length;++t){var i=this._nodes[t],n=this._shells[t];this._shellMap.set(i,n),null==i.__callOnAfterDeserializeRecursive||i.__callOnAfterDeserializeRecursive()}},n.nodes=function(){return this._nodes.values()},n.addNode=function(t){if(this._shellMap.has(t))throw new Ez(t);var i=new bz;return this._shells.push(i),this._nodes.push(t),this._shellMap.set(t,i),t},n.removeNode=function(t){if(t!==this._outputNode){var i=this._nodes.indexOf(t);if(!(i<0)){this._shellMap.has(t);for(var n,r=w(this._shells);!(n=r()).done;)n.value.deleteBindingTo(t);ei(this._shells,i),ei(this._nodes,i),this._shellMap.delete(t)}}else X("Can not remove the output node.")},n.getShell=function(t){return this._shellMap.get(t)},r(i,[{key:"outputNode",get:function(){return this._outputNode}}]),i}(fc),tW=uo(Zz.prototype,"_outputNode",[Co],(function(){return new sX})),iW=uo(Zz.prototype,"_nodes",[Co],(function(){return[]})),nW=uo(Zz.prototype,"_shells",[Co],(function(){return[]})),rW=uo(Zz.prototype,"_shellMap",[Co],(function(){return new Map})),Jz=Zz))||Jz,hX=_o(Vj+"Transition")((eW=function(t){function i(i,n,r){var s;return(s=t.call(this)||this).from=hW&&hW(),s.to=uW&&uW(),s.conditions=oW&&oW(),s[QV]=void 0,s.from=i,s.to=n,r&&(s.conditions=r),s}return e(i,t),i.prototype.copyTo=function(t){t.conditions=this.conditions.map((function(t){return t.clone()}))},i}(fc),hW=uo(eW.prototype,"from",[Co],null),uW=uo(eW.prototype,"to",[Co],null),oW=uo(eW.prototype,"conditions",[Co],(function(){return[]})),sW=eW))||sW,uX=_o(Vj+"DurationalTransition")((aW=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).destinationStart=fW&&fW(),i.relativeDestinationStart=vW&&vW(),i.startEventBinding=lW&&lW(),i.endEventBinding=dW&&dW(),i[QV]=void 0,i}return e(i,t),i.prototype.copyTo=function(i){t.prototype.copyTo.call(this,i),i.destinationStart=this.destinationStart,i.relativeDestinationStart=this.relativeDestinationStart,this.startEventBinding.copyTo(i.startEventBinding),this.endEventBinding.copyTo(i.endEventBinding)},i}(hX),fW=uo(aW.prototype,"destinationStart",[Co],(function(){return 0})),vW=uo(aW.prototype,"relativeDestinationStart",[Co],(function(){return!1})),lW=uo(aW.prototype,"startEventBinding",[Co],(function(){return new uz})),dW=uo(aW.prototype,"endEventBinding",[Co],(function(){return new uz})),cW=aW))||cW,oX=_o(Vj+"AnimationTransition")((gW=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).duration=pW&&pW(),i.relativeDuration=_W&&_W(),i.exitConditionEnabled=yW&&yW(),i._exitCondition=mW&&mW(),i}return e(i,t),i.prototype.copyTo=function(i){t.prototype.copyTo.call(this,i),i.duration=this.duration,i.relativeDuration=this.relativeDuration,i.exitConditionEnabled=this.exitConditionEnabled,i.exitCondition=this.exitCondition},r(i,[{key:"exitCondition",get:function(){return this._exitCondition},set:function(t){this._exitCondition=t}}]),i}(uX),pW=uo(gW.prototype,"duration",[Co],(function(){return.3})),_W=uo(gW.prototype,"relativeDuration",[Co],(function(){return!1})),yW=uo(gW.prototype,"exitConditionEnabled",[Co],(function(){return!0})),mW=uo(gW.prototype,"_exitCondition",[Co],(function(){return 1})),wW=gW))||wW;function cX(t){return t instanceof oX}var aX,fX=_o(Vj+"EmptyState")(bW=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(K$))||bW,vX=_o(Vj+"EmptyStateTransition")((AW=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).duration=EW&&EW(),i}return e(i,t),i.prototype.copyTo=function(i){t.prototype.copyTo.call(this,i),i.duration=this.duration},i}(uX),EW=uo(AW.prototype,"duration",[Co],(function(){return.3})),kW=AW))||kW,lX=_o(Vj+"ProceduralPoseState")((OW=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).graph=SW&&SW(),i.transitionInEventBinding=IW&&IW(),i.transitionOutEventBinding=RW&&RW(),i}e(i,t);var n=i.prototype;return n.__callOnAfterDeserializeRecursive=function(){this.graph.__callOnAfterDeserializeRecursive()},n.copyTo=function(i){return t.prototype.copyTo.call(this,i),this.transitionInEventBinding.copyTo(i.transitionInEventBinding),this.transitionOutEventBinding.copyTo(i.transitionOutEventBinding),this},i}(K$),SW=uo(OW.prototype,"graph",[Co],(function(){return new eX})),IW=uo(OW.prototype,"transitionInEventBinding",[Co],(function(){return new uz})),RW=uo(OW.prototype,"transitionOutEventBinding",[Co],(function(){return new uz})),TW=OW))||TW,dX=mz(lX),wX=_o(Vj+"ProceduralPoseTransition")((CW=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).duration=NW&&NW(),i}return e(i,t),i.prototype.copyTo=function(i){t.prototype.copyTo.call(this,i),i.duration=this.duration},i}(uX),NW=uo(CW.prototype,"duration",[Co],(function(){return.3})),MW=CW))||MW,gX=mz(wX),pX=_o("cc.animation.StateMachine")((LW=function(t){e(n,t);var i=n.prototype;function n(i){var n;return(n=t.call(this)||this)._states=DW&&DW(),n._transitions=BW&&BW(),n._entryState=FW&&FW(),n._exitState=UW&&UW(),n._anyState=xW&&xW(),n._allowEmptyStates=!0,n._allowEmptyStates=null!=i&&i,n._entryState=n.nE(new K$),n._entryState.name="Entry",n._exitState=n.nE(new K$),n._exitState.name="Exit",n._anyState=n.nE(new K$),n._anyState.name="Any",n}return i.__callOnAfterDeserializeRecursive=function(){this[cz]();for(var t=this._states.length,i=0;i<t;++i){var n=this._states[i];n instanceof _X?n.stateMachine.__callOnAfterDeserializeRecursive():(n instanceof lX||n instanceof oz)&&n.__callOnAfterDeserializeRecursive()}},i[cz]=function(){this._states.forEach((function(){})),this._transitions.forEach((function(t){t.from[z$].push(t),t.to[W$].push(t)}))},i.states=function(){return this._states},i.transitions=function(){return this._transitions},i.getTransitionsBetween=function(t,i){return JV(t),JV(i),t[z$].filter((function(t){return t.to===i}))},i.getOutgoings=function(t){return JV(t),t[z$]},i.getIncomings=function(t){return JV(t),t[W$]},i.addMotion=function(){return this.nE(new oz)},i.addSubStateMachine=function(){return this.nE(new _X(this._allowEmptyStates))},i.addEmpty=function(){if(!this._allowEmptyStates)throw new Error("Empty states are now allowed in this state machine.");return this.nE(new fX)},i.addProceduralPoseState=function(){return this.nE(new lX)},i.remove=function(t){JV(t),t!==this.entryState&&t!==this.exitState&&t!==this.anyState&&(this.eraseTransitionsIncludes(t),ui(this._states,t))},i.connect=function(t,i,n){if(JV(t),JV(i),i===this.entryState)throw new R$("to-entry");if(i===this.anyState)throw new R$("to-any");if(t===this.exitState)throw new R$("from-exit");var r=t instanceof oz||t===this._anyState?new oX(t,i,n):t instanceof fX?new vX(t,i,n):t instanceof lX?new wX(t,i,n):new hX(t,i,n);return this._transitions.push(r),t[z$].push(r),i[W$].push(r),r},i.disconnect=function(t,i){JV(t),JV(i);for(var n=t[z$],r=i[W$],s=this._transitions,e=n.filter((function(t){return t.to===i})),h=e.length,u=function(){var t=e[o];ui(n,t),ui(s,t),ci(r,(function(i){return i===t}))},o=0;o<h;++o)u()},i.removeTransition=function(t){ui(this._transitions,t),ci(t.from[z$],(function(i){return i===t})),ci(t.to[W$],(function(i){return i===t}))},i.eraseOutgoings=function(t){var i=this;JV(t);for(var n=t[z$],r=function(){var t=n[s],r=t.to;ui(i._transitions,t),ci(r[W$],(function(i){return i===t}))},s=0;s<n.length;++s)r();n.length=0},i.eraseIncomings=function(t){var i=this;JV(t);for(var n=t[W$],r=function(){var t=n[s],r=t.from;ui(i._transitions,t),ci(r[z$],(function(i){return i===t}))},s=0;s<n.length;++s)r();n.length=0},i.eraseTransitionsIncludes=function(t){this.eraseIncomings(t),this.eraseOutgoings(t)},i.adjustTransitionPriority=function(t,i){var n=t.from;if(0!==i){var r=n[z$],s=r.indexOf(t),e=Gn(s+i,0,r.length-1),h=this._transitions,u=h.indexOf(t);if(e>s)for(var o=s+1;o<=e;++o){var c=r[o],a=h.indexOf(c);h[u]=c,u=a}else if(s>e)for(var f=s-1;f>=e;--f){var v=r[f],l=h.indexOf(v);h[u]=v,u=l}h[u]=t,Iv(r,s,e)}},i.copyTo=function(t){for(var i,n=t._states.filter((function(i){switch(i){case t._entryState:case t._exitState:case t._anyState:return!0;default:return!1}})),r=w(n);!(i=r()).done;){var s=i.value;t.remove(s)}for(var e,h=new Map,u=w(this._states);!(e=u()).done;){var o=e.value;switch(o){case this._entryState:h.set(o,t._entryState);break;case this._exitState:h.set(o,t._exitState);break;case this._anyState:h.set(o,t._anyState);break;default:if(o instanceof oz||o instanceof _X||o instanceof fX||o instanceof lX){if(o instanceof fX&&!t._allowEmptyStates)continue;var c=B$(o);t.nE(c),h.set(o,c)}}}for(var a,f=w(this._transitions);!(a=f()).done;){var v=a.value;if(t._allowEmptyStates||!(v.from instanceof fX||v.to instanceof fX)){var l=h.get(v.from),d=h.get(v.to),g=t.connect(l,d);g.conditions=v.conditions.map((function(t){return t.clone()})),v.copyTo(g)}}},i.clone=function(){var t=new n(this._allowEmptyStates);return this.copyTo(t),t},i.nE=function(t){return this._states.push(t),t},r(n,[{key:"allowEmptyStates",get:function(){return this._allowEmptyStates}},{key:"entryState",get:function(){return this._entryState}},{key:"exitState",get:function(){return this._exitState}},{key:"anyState",get:function(){return this._anyState}}]),n}(fc),DW=uo(LW.prototype,"_states",[Co],(function(){return[]})),BW=uo(LW.prototype,"_transitions",[Co],(function(){return[]})),FW=uo(LW.prototype,"_entryState",[Co],null),UW=uo(LW.prototype,"_exitState",[Co],null),xW=uo(LW.prototype,"_anyState",[Co],null),PW=LW))||PW,_X=_o("cc.animation.SubStateMachine")((jW=function(t){function i(i){var n;return(n=t.call(this)||this)._stateMachine=HW&&HW(),n._stateMachine=new pX(i),n}return e(i,t),i.prototype.copyTo=function(i){t.prototype.copyTo.call(this,i),this._stateMachine.copyTo(i._stateMachine)},r(i,[{key:"stateMachine",get:function(){return this._stateMachine}}]),i}(q$),HW=uo(jW.prototype,"_stateMachine",[Co],null),GW=jW))||GW,yX=_o(Vj+"PoseGraphStash")(($W=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).graph=zW&&zW(),i}return e(i,t),i}(fc),zW=uo($W.prototype,"graph",[Co],(function(){return new eX})),VW=$W))||VW,mX=_o("cc.animation.Layer")((XW=function(){var t=i.prototype;function i(){this[QV]=void 0,this._stateMachine=YW&&YW(),this.name=KW&&KW(),this.weight=qW&&qW(),this.mask=QW&&QW(),this.additive=JW&&JW(),this._stashes=ZW&&ZW(),this._stateMachine=new pX(!0)}return t.__callOnAfterDeserializeRecursive=function(){for(var t in this.stateMachine._allowEmptyStates=!0,this.stateMachine.__callOnAfterDeserializeRecursive(),this._stashes)this._stashes[t].graph.__callOnAfterDeserializeRecursive()},t.stashes=function(){return Object.entries(this._stashes)},t.getStash=function(t){return this._stashes[t]},t.addStash=function(t){return this._stashes[t]=new yX},t.removeStash=function(t){delete this._stashes[t]},t.renameStash=function(t,i){this._stashes=fz(this._stashes,t,i)},r(i,[{key:"stateMachine",get:function(){return this._stateMachine}}]),i}(),YW=uo(XW.prototype,"_stateMachine",[Co],null),KW=uo(XW.prototype,"name",[Co],(function(){return""})),qW=uo(XW.prototype,"weight",[Co],(function(){return 1})),QW=uo(XW.prototype,"mask",[Co],(function(){return null})),JW=uo(XW.prototype,"additive",[Co],(function(){return!1})),ZW=uo(XW.prototype,"_stashes",[Co],(function(){return{}})),WW=XW))||WW,bX=_o("cc.animation.AnimationGraph")((iX=function(t){function i(){var i;return(i=t.call(this)||this)._layers=nX&&nX(),i._variables=rX&&rX(),i}e(i,t);var n=i.prototype;return n.onLoaded=function(){for(var t=this._layers,i=t.length,n=0;n<i;++n)t[n].__callOnAfterDeserializeRecursive()},n.addLayer=function(){var t=new mX;return this._layers.push(t),t},n.removeLayer=function(t){ei(this._layers,t)},n.moveLayer=function(t,i){Iv(this._layers,t,i)},n.addVariable=function(t,i,n){var r=k$(i,n);return this._variables[t]=r,r},n.removeVariable=function(t){delete this._variables[t]},n.getVariable=function(t){return this._variables[t]},n.renameVariable=function(t,i){this._variables=fz(this._variables,t,i)},r(i,[{key:"layers",get:function(){return this._layers}},{key:"variables",get:function(){return Object.entries(this._variables)}}]),i}(az),nX=uo(iX.prototype,"_layers",[Co],(function(){return[]})),rX=uo(iX.prototype,"_variables",[Co],(function(){return{}})),tX=iX))||tX,kX=Symbol("[[createEval]]"),AX=_o(Vj+"MotionBase")(aX=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.__callOnAfterDeserializeRecursive=function(){},i}(fc))||aX,EX=Symbol("BakeNodeCurves"),TX=t("el",function(){function t(){}return t.getOrExtract=function(i){var n=t.Sp.get(i);if(!n||n.samples!==i.sample){n&&T.director.root.dataPoolManager.releaseAnimationClip(i);var r=Math.ceil(i.sample*i.duration)+1,s=i.sample;n=i[EX](0,s,r),t.Sp.set(i,n)}return n},t.destroy=function(i){t.Sp.delete(i)},t}());TX.Sp=new Map;var OX=t("a4",function(){function t(t){var i,n;this.ratios=void 0,this.rE=void 0,this.ratios=t;for(var r=!0,s=1,e=t.length;s<e;s++)if(i=t[s]-t[s-1],1===s)n=i;else if(Math.abs(i-n)>1e-6){r=!1;break}this.rE=r?MX:io}return t.prototype.sample=function(t){return this.rE(this.ratios,t)},t}());T.RatioSampler=OX;var SX=t("a5",function(){function t(i,n){this.types=void 0,this.type=null,this.sE=[],this.eE=void 0,this.hE=void 0,this.Ss=void 0,this.hE=n,this.sE=i.values;var r=function(i){return"string"==typeof i?i:Array.isArray(i)?i[0]===i[1]&&i[2]===i[3]?t.Linear:t.Bezier(i):t.Linear};if(void 0!==i.easingMethod)this.type=r(i.easingMethod);else if(Array.isArray(i.easingMethods))this.types=i.easingMethods.map(r);else if(void 0!==i.easingMethods){this.types=new Array(this.sE.length).fill(null);for(var s=0,e=Object.keys(i.easingMethods);s<e.length;s++){var h=e[s];this.types[h]=r(i.easingMethods[h])}}else this.type=null;var u=i.values[0];(void 0===i.interpolate||i.interpolate)&&(this.eE=FX(u)),void 0!==i._arrayLength&&(this.Ss=new Array(i._arrayLength))}t.Bezier=function(t){return t};var i=t.prototype;return i.hasLerp=function(){return!!this.eE},i.valueAt=function(t){if(void 0===this.Ss){var i=this.sE[t];return i&&i.getNoLerp?i.getNoLerp():i}for(var n=0;n<this.Ss.length;++n)this.Ss[n]=this.sE[this.Ss.length*t+n];return this.Ss},i.valueBetween=function(t,i,n,r,s){if(this.eE){var e=this.types?this.types[i]:this.type,h=s-n,u=(t-n)/h;if(e&&(u=RX(u,e)),void 0===this.Ss){var o=this.sE[i],c=this.sE[r];return this.eE(o,c,u,h*this.hE)}for(var a=0;a<this.Ss.length;++a){var f=this.sE[this.Ss.length*i+a],v=this.sE[this.Ss.length*r+a];this.Ss[a]=this.eE(f,v,u,h*this.hE)}return this.Ss}if(void 0===this.Ss)return this.valueAt(i);for(var l=0;l<this.Ss.length;++l)this.Ss[l]=this.sE[this.Ss.length*i+l];return this.Ss},i.empty=function(){return 0===this.sE.length},i.constant=function(){return 1===this.sE.length},t}());function IX(t,i,n){var r=i.sample(n);if(r<0)if((r=~r)<=0)r=0;else{if(!(r>=i.ratios.length))return t.valueBetween(n,r-1,i.ratios[r-1],r,i.ratios[r]);r=i.ratios.length-1}return t.valueAt(r)}function RX(t,i){if("string"==typeof i){var n=fa[i];n?t=n(t):ht(3906,i)}else Array.isArray(i)&&(t=ff(i,t));return t}function MX(t,i){var n=t.length-1;if(0===n)return 0;var r=t[0];if(i<r)return 0;var s=t[n];if(i>s)return n;var e=(i=(i-r)/(s-r))/(1/n),h=0|e,u=1e-6;return e-h<u?h:h+1-e<u?h+1:~(h+1)}SX.Linear=null,T.AnimCurve=SX,t("a6",function(){function t(){this.events=[]}return t.prototype.add=function(t,i){this.events.push({func:t||"",params:i||[]})},t}()),T.sampleAnimationCurve=IX;var CX,NX,PX,LX,DX,BX,FX=function(){function t(t){var i=new t;return function(n,r,s){return t.lerp(i,n,r,s),i}}function i(t,i,n,r){return t.lerp(i,n,r)}return function(n){if(null!==n){if("number"==typeof n)return Hn;if("object"==typeof n&&n.constructor){if(n instanceof Qr)return r=new Qr,function(t,i,n){return Qr.slerp(r,t,i,n)};if(n instanceof ki)return t(n.constructor);if(n.constructor===Number)return Hn;if("function"==typeof n.lerp)return i}var r}}}(),UX=_o(Vj+"UntypedTrackChannel")((NX=function(t){function i(){var i;return(i=t.call(this,new pa)||this).property=PX&&PX(),i}return e(i,t),i}(HH),PX=uo(NX.prototype,"property",[Co],(function(){return""})),CX=NX))||CX,xX=_o(Vj+"UntypedTrack")((DX=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._channels=BX&&BX(),i}e(i,t);var n=i.prototype;return n.channels=function(){return this._channels},n[$j]=function(){throw new Error("UntypedTrack should be handled specially. Please file an issue.")},n.createLegacyEval=function(t){var i=this,n=function(t){var n;return null==(n=i._channels.find((function(i){return i.property===t})))?void 0:n.curve};switch(!0){default:throw new Error(at(3931));case t instanceof Ms:return new xV(n("x"),n("y"));case t instanceof Ir:return new GV(n("x"),n("y"),n("z"));case t instanceof $s:return new jV(n("x"),n("y"),n("z"),n("w"));case t instanceof Qs:return new WV(n("r"),n("g"),n("b"),n("a"));case t instanceof ie:return new KV(n("width"),n("height"))}},n.addChannel=function(t){var i=new UX;return i.property=t,this._channels.push(i),i},n.upgrade=function(t){var i=this,n=function(t,n){var r=i.channels().find((function(i){return i.property===t}));r&&(n.name=r.name,n.curve.assignSorted(Array.from(r.curve.times()),Array.from(r.curve.values())))},r=t(this.path,this.proxy);switch(r){default:case"size":break;case"vec2":case"vec3":case"vec4":var s=new UV;s.path=this.path,s.proxy=this.proxy,s.componentsCount="vec2"===r?2:"vec3"===r?3:4;var e=s.channels(),h=e[0],u=e[1],o=e[2],c=e[3];switch(r){case"vec4":n("w",c);case"vec3":n("z",o);default:n("x",h),n("y",u)}return s;case"color":var a=new zV,f=a.channels(),v=f[0],l=f[1],d=f[2],w=f[3];return n("r",v),n("g",l),n("b",d),n("a",w),n("x",v),n("y",l),n("z",d),n("w",w),a}return null},i}(jH),BX=uo(DX.prototype,"_channels",[Co],(function(){return[]})),LX=DX))||LX,GX=function(){function t(t){this.uE=[],this.VA=[],this.oE=[],this.cE=[],this.fE=void 0,this.M=null,this.hE=void 0,this.hE=t}var i=t.prototype;return i.getPropertyCurves=function(){return this.fE||this._createPropertyCurves(),this.fE},i.toTracks=function(){for(var t,i=[],n=this.keys,r=this.curves,s=this.commonTargets,e=function(t,i,n){for(var r,s=new BH,e=w(i);!(r=e()).done;){var h=r.value;"string"==typeof h?s.toProperty(h):"number"==typeof h?s.toElement(h):h instanceof CH?s.toHierarchy(h.path):h instanceof NH?s.toComponent(h.component):s.toCustomized(h)}t.path=s,t.proxy=n},h=s.map((function(t){var n=new xX;return e(n,t.modifiers,t.valueAdapter),i.push(n),n})),u=function(){var r,s=t.value,u=s.data,o=u.values;if(0===o.length)return 0;var c=u.keys<0?[0]:n[u.keys],a=o[0],f=null===(r=u.interpolate)||void 0===r||r;u._arrayLength;var v,l=new HX(u,c.length),d=function(t){e(t,s.modifiers,s.valueAdapter)};if("number"==typeof s.commonTarget){if(!o.every((function(t){return"number"==typeof t})))return st(3932),0;if(s.valueAdapter||1!==s.modifiers.length||"string"!=typeof s.modifiers[0])return st(3933),0;var w=s.modifiers[0],g=h[s.commonTarget].addChannel(w).curve;v=g}!function(){if("number"==typeof a){if(!o.every((function(t){return"number"==typeof t})))return void st(3934);var t;if(v)t=v;else{var n=new SV;d(n),i.push(n),t=n.channel.curve}var r=f?0:1;return t.assignSorted(c,o.map((function(t){return{value:t,interpolationMode:r}}))),void l.convert(t)}if("object"==typeof a)switch(!0){default:break;case jX(o,Ms):case jX(o,Ir):case jX(o,$s):var s=a instanceof Ms?2:a instanceof Ir?3:4,e=new UV;d(e),e.componentsCount=s;var h=e.channels(),u=h[0].curve,w=h[1].curve,g=h[2].curve,p=h[3].curve,_=f?0:1,y=function(t){return{value:t,interpolationMode:_}};switch(s){case 4:p.assignSorted(c,o.map((function(t){return y(t.w)}))),l.convert(p);case 3:g.assignSorted(c,o.map((function(t){return y(t.z)}))),l.convert(g);default:u.assignSorted(c,o.map((function(t){return y(t.x)}))),l.convert(u),w.assignSorted(c,o.map((function(t){return y(t.y)}))),l.convert(w)}return void i.push(e);case jX(o,Qr):var m=new HV;d(m);var b=f?0:1;return m.channel.curve.assignSorted(c,o.map((function(t){return{value:Qr.clone(t),interpolationMode:b}}))),l.convertQuatCurve(m.channel.curve),void i.push(m);case jX(o,Qs):var k=new zV;d(k);var A=k.channels(),E=A[0].curve,T=A[1].curve,O=A[2].curve,S=A[3].curve,I=f?0:1,R=function(t){return{value:t,interpolationMode:I}};return E.assignSorted(c,o.map((function(t){return R(t.r)}))),l.convert(E),T.assignSorted(c,o.map((function(t){return R(t.g)}))),l.convert(T),O.assignSorted(c,o.map((function(t){return R(t.b)}))),l.convert(O),S.assignSorted(c,o.map((function(t){return R(t.a)}))),l.convert(S),void i.push(k);case jX(o,ie):var M=new YV;d(M);var C=M.channels(),N=C[0].curve,P=C[1].curve,L=f?0:1,D=function(t){return{value:t,interpolationMode:L}};return N.assignSorted(c,o.map((function(t){return D(t.width)}))),l.convert(N),P.assignSorted(c,o.map((function(t){return D(t.height)}))),l.convert(P),void i.push(M);case jX(o,OV):l.nil;var B=new SV;d(B);var F=f?2:1;return B.channel.curve.assignSorted(c,o.map((function(t){return{value:t.dataPoint,leftTangent:t.inTangent,rightTangent:t.outTangent,interpolationMode:F}}))),void i.push(B);case jX(o,kV):case jX(o,AV):case jX(o,EV):l.nil;var U=a instanceof kV?2:a instanceof AV?3:4,x=new UV;d(x),x.componentsCount=U;var G=x.channels(),j=G[0],H=G[1],V=G[2],$=G[3],z=f?0:1,W=function(t,i,n){return{value:t,leftTangent:i,rightTangent:n,interpolationMode:z}};switch(U){case 4:$.curve.assignSorted(c,o.map((function(t){return W(t.dataPoint.w,t.inTangent.w,t.outTangent.w)})));case 3:V.curve.assignSorted(c,o.map((function(t){return W(t.dataPoint.z,t.inTangent.z,t.outTangent.z)})));default:j.curve.assignSorted(c,o.map((function(t){return W(t.dataPoint.y,t.inTangent.y,t.outTangent.y)}))),H.curve.assignSorted(c,o.map((function(t){return W(t.dataPoint.x,t.inTangent.x,t.outTangent.x)})))}return void i.push(x);case o.every((function(t){return t instanceof TV})):st(3935)}var X=new qV;d(X),X.channel.curve.assignSorted(c,o),i.push(X)}()},o=w(r);!(t=o()).done;)u();return i},i._createPropertyCurves=function(){var t=this;this.cE=this.uE.map((function(i){return new OX(i.map((function(i){return i/t.hE})))})),this.fE=this.VA.map((function(i){return{curve:new SX(i.data,t.hE),modifiers:i.modifiers,valueAdapter:i.valueAdapter,sampler:t.cE[i.data.keys],commonTarget:i.commonTarget}}))},r(t,[{key:"keys",get:function(){return this.uE},set:function(t){this.uE=t}},{key:"curves",get:function(){return this.VA},set:function(t){this.VA=t,delete this.fE}},{key:"commonTargets",get:function(){return this.oE},set:function(t){this.oE=t}},{key:"data",get:function(){return this.M}}]),t}();function jX(t,i){return t.every((function(t){return t instanceof i}))}var HX=function(){function t(t,i){this.vE=void 0;var n=t.easingMethods;Array.isArray(n)?0===n.length&&0!==i?this.vE=new Array(i).fill(null):this.vE=n:this.vE=void 0===n?new Array(i).fill(t.easingMethod):Array.from({length:i},(function(t,i){var r;return null!==(r=n[i])&&void 0!==r?r:null}))}var i=t.prototype;return i.convert=function(t){var i,n,r,s,e,h,u,o,c,a,f,v,l,d,w,g,p,_,y,m,b,k,A=this.vE;if(A){var E=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(A)&&A.length;for(var T=E-1,O=0;O<T;++O){var S=A[O];S&&(Array.isArray(S)?(n=S,r=t.getKeyframeTime(O),s=t.getKeyframeValue(O),e=t.getKeyframeTime(O+1),h=t.getKeyframeValue(O+1),u=void 0,o=void 0,c=void 0,a=void 0,f=void 0,v=void 0,l=void 0,d=void 0,w=void 0,g=void 0,p=void 0,_=void 0,y=void 0,m=void 0,b=void 0,k=void 0,u=n[0],o=n[1],c=n[2],a=n[3],f=s.value,v=3*(e-r),l=3*(h.value-f),g=(1-c)*v,p=(1-a)*l,_=1/3,y=(w=o*l)/(d=u*v),m=Math.sqrt(d*d+w*w)*_,b=p/g,k=Math.sqrt(g*g+p*p)*_,s.interpolationMode=2,s.tangentWeightMode=0===(i=s.tangentWeightMode)?2:1===i?3:i,s.rightTangent=y,s.rightTangentWeight=m,h.tangentWeightMode=gY(h.tangentWeightMode),h.leftTangent=b,h.leftTangentWeight=k):VX(S,t,O))}}}},i.convertQuatCurve=function(t){var i=this.vE;if(i){var n=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(i)&&i.length;for(var r=n-1,s=0;s<r;++s){var e=i[s];e&&(Array.isArray(e)?t.getKeyframeValue(s).easingMethod=e.slice():$X(e,t,s))}}}},r(t,[{key:"nil",get:function(){return!this.vE||this.vE.every((function(t){return null==t}))}}]),t}();function VX(t,i,n){i.keyFramesCount;var r=i.getKeyframeValue(n),s=wY[t];1===s?r.interpolationMode=1:(r.interpolationMode=0,r.easingMethod=s)}function $X(t,i,n){i.keyFramesCount;var r=i.getKeyframeValue(n),s=wY[t];r.easingMethod=s}var zX,WX,XX,YX,KX,qX,QX,JX,ZX,tY,iY,nY,rY,sY,eY,hY,uY,oY,cY,aY,fY,vY,lY,dY,wY={constant:1,linear:0,quadIn:2,quadOut:3,quadInOut:4,quadOutIn:5,cubicIn:6,cubicOut:7,cubicInOut:8,cubicOutIn:9,quartIn:10,quartOut:11,quartInOut:12,quartOutIn:13,quintIn:14,quintOut:15,quintInOut:16,quintOutIn:17,sineIn:18,sineOut:19,sineInOut:20,sineOutIn:21,expoIn:22,expoOut:23,expoInOut:24,expoOutIn:25,circIn:26,circOut:27,circInOut:28,circOutIn:29,elasticIn:30,elasticOut:31,elasticInOut:32,elasticOutIn:33,backIn:34,backOut:35,backInOut:36,backOutIn:37,bounceIn:38,bounceOut:39,bounceInOut:40,bounceOutIn:41,smooth:42,fade:43};function gY(t){return 0===t?1:2===t?3:t}var pY=_o,_Y=Co;function yY(){throw new Error("split() only valid in Editor.")}pY(Vj+"ExoticAnimation")((zX=function(){function t(){this._nodeAnimations=WX&&WX()}var i=t.prototype;return i.createEvaluator=function(t){return new IY(this._nodeAnimations,t)},i.createEvaluatorForAnimationGraph=function(t){return new CY(this._nodeAnimations,t)},i.addNodeAnimation=function(t){var i=new mY(t);return this._nodeAnimations.push(i),i},i.collectAnimatedJoints=function(){return Array.from(new Set(this._nodeAnimations.map((function(t){return t.path}))))},i.split=function(){return yY()},i.toHashString=function(){return this._nodeAnimations.map((function(t){return t.toHashString()})).join("\n")},t}(),WX=uo(zX.prototype,"_nodeAnimations",[_Y],(function(){return[]})),zX));var mY=pY(Vj+"ExoticNodeAnimation")((YX=function(){function t(t){this._path=KX&&KX(),this._position=qX&&qX(),this._rotation=QX&&QX(),this._scale=JX&&JX(),this._path=t}var i=t.prototype;return i.createPosition=function(t,i){this._position=new OY(t,new EY(i))},i.createRotation=function(t,i){this._rotation=new OY(t,new TY(i))},i.createScale=function(t,i){this._scale=new OY(t,new EY(i))},i.createEvaluator=function(t){return new RY(this._path,this._position,this._rotation,this._scale,t)},i.createEvaluatorForAnimationGraph=function(t){var i=t.bindTransform(this._path);return i?new NY(i,this._position,this._rotation,this._scale):null},i.split=function(){return yY()},i.toHashString=function(){var t,i,n,r,s,e;return this._path+"\n"+(null!==(t=null==(i=this._position)?void 0:i.toHashString())&&void 0!==t?t:"")+(null!==(n=null==(r=this._scale)?void 0:r.toHashString())&&void 0!==n?n:"")+(null!==(s=null==(e=this._rotation)?void 0:e.toHashString())&&void 0!==s?s:"")},r(t,[{key:"path",get:function(){return this._path}}]),t}(),KX=uo(YX.prototype,"_path",[_Y],(function(){return""})),qX=uo(YX.prototype,"_position",[_Y],(function(){return null})),QX=uo(YX.prototype,"_rotation",[_Y],(function(){return null})),JX=uo(YX.prototype,"_scale",[_Y],(function(){return null})),XX=YX))||XX;function bY(t){return t.toPrecision(2)}function kY(t){return t.map((function(t){return Number.parseFloat(bY(t))})).join(" ")}var AY=pY(Vj+"ExoticVectorLikeTrackValues")((tY=function(){function t(t){this._values=iY&&iY(),this._isQuantized=nY&&nY(),this._values=t}var i=t.prototype;return i.quantize=function(t){this._isQuantized,this._values=jY(this._values,t),this._isQuantized=!0},i.toHashString=function(){var t=this._isQuantized,i=this._values;return t+" "+(t?i.toHashString():kY(i))},r(t,[{key:"precision",get:function(){return this._isQuantized?this._values.originalPrecision:DY(this._values)}}]),t}(),iY=uo(tY.prototype,"_values",[_Y],null),nY=uo(tY.prototype,"_isQuantized",[_Y],(function(){return!1})),ZX=tY))||ZX,EY=pY(Vj+"ExoticVec3TrackValues")(rY=function(t){function i(){return t.apply(this,arguments)||this}e(i,t),i.imitate=function(t,n){var r=new i(t);return n._isQuantized&&r.quantize(n._values.quantizationType),r};var n=i.prototype;return n.get=function(t,i){var n=this._values;this._isQuantized?$Y(n,t,i):Ir.fromArray(i,n,3*t)},n.lerp=function(t,i,n,r,s,e){var h=this._values;this._isQuantized?($Y(h,t,r),$Y(h,i,s)):(Ir.fromArray(r,h,3*t),Ir.fromArray(s,h,3*i)),Ir.lerp(e,r,s,n)},i}(AY))||rY,TY=pY(Vj+"ExoticQuatTrackValues")(sY=function(t){function i(){return t.apply(this,arguments)||this}e(i,t),i.imitate=function(t,n){var r=new i(t);return n._isQuantized&&r.quantize(n._values.quantizationType),r};var n=i.prototype;return n.get=function(t,i){var n=this._values;this._isQuantized?zY(n,t,i):Qr.fromArray(i,n,4*t)},n.lerp=function(t,i,n,r,s,e){var h=this._values;this._isQuantized?(zY(h,t,r),zY(h,i,s)):(Qr.fromArray(r,h,4*t),Qr.fromArray(s,h,4*i)),Qr.slerp(e,r,s,n)},i}(AY))||sY,OY=pY(Vj+"ExoticTrack")((hY=function(){function t(t,i){this.times=uY&&uY(),this.values=oY&&oY(),this.times=t,this.values=i}return t.prototype.toHashString=function(){var t=this.times,i=this.values;return"times: "+kY(t)+"; values: "+i.toHashString()},t}(),uY=uo(hY.prototype,"times",[_Y],null),oY=uo(hY.prototype,"values",[_Y],null),eY=hY))||eY;function SY(t,i){t.length,t.length;var n=0,r=0,s=io(t,i);if(s>=0)n=s;else{var e=~s,h=e-1;n=h;var u=t[e],o=t[h];r=(i-o)/(u-o)}return{index:n,ratio:r}}!function(){function t(){this.lE()}var i=t.prototype;i.calculate=function(t,i,n){if(this.lE(),!(i>n)){var r=t.length;if(r){var s=t[0],e=t[r-1],h=0,u=0;if(i<s);else if(i>=e)h=r-1,u=0;else{var o=SY(t,i);h=o.index,u=o.ratio}var c=0,a=0;if(n<s);else if(n>=e)c=r-1,a=0;else{var f=SY(t,n);c=f.index,a=f.ratio}var v=!u,l=!a;h!==c||u!==a?(v||(this.preLerpIndex=h,this.preLerpRatio=u),this.directKeyframesBegin=v?h:h+1,this.directKeyframesEnd=c+1,l||(this.postLerpIndex=c,this.postLerpRatio=a)):v?(this.directKeyframesBegin=h,this.directKeyframesEnd=h+1):(this.preLerpIndex=h,this.preLerpRatio=u)}}},i.lE=function(){this.preLerpIndex=-1,this.preLerpRatio=0,this.directKeyframesBegin=0,this.directKeyframesEnd=0,this.postLerpIndex=-1,this.postLerpRatio=0},r(t,[{key:"keyframesCount",get:function(){var t=this.preLerpIndex,i=this.directKeyframesBegin;return 0+(t<0?0:1)+(this.directKeyframesEnd-i)+(this.postLerpIndex<0?0:1)}}])}();var IY=function(){function t(t,i){this.dE=void 0,this.dE=t.map((function(t){return t.createEvaluator(i)}))}return t.prototype.evaluate=function(t){this.dE.forEach((function(i){i.evaluate(t)}))},t}(),RY=function(){function t(t,i,n,r,s){this.Of=null,this.wE=null,this.wv=null,i&&(this.Of=VY(i.times,i.values,Ir,t,"position",s)),n&&(this.wE=VY(n.times,n.values,Qr,t,"rotation",s)),r&&(this.wv=VY(r.times,r.values,Ir,t,"scale",s))}return t.prototype.evaluate=function(t){if(this.Of){var i=this.Of.evaluator.evaluate(t);this.Of.runtimeBinding.setValue(i)}if(this.wE){var n=this.wE.evaluator.evaluate(t);this.wE.runtimeBinding.setValue(n)}if(this.wv){var r=this.wv.evaluator.evaluate(t);this.wv.runtimeBinding.setValue(r)}},t}(),MY=function(){function t(t,i,n){this.gE=void 0,this.pE={just:!1,index:-1,nextIndex:-1,ratio:0},this.sE=void 0,this._E=void 0,this.yE=void 0,this.mE=void 0,this.gE=t,this.sE=i,this._E=new n,this.yE=new n,this.mE=new n}return t.prototype.evaluate=function(t){var i=this.gE,n=this.sE,r=this.mE;if(0===i.length)return r;var s=PY(i,t,this.pE);return s.just?n.get(s.index,r):n.lerp(s.index,s.nextIndex,s.ratio,this._E,this.yE,r),r},t}(),CY=function(){function t(t,i){this.dE=void 0,this.dE=t.map((function(t){return t.createEvaluatorForAnimationGraph(i)})).filter((function(t){return!!t}))}var i=t.prototype;return i.destroy=function(){for(var t=this.dE,i=t.length,n=0;n<i;++n)t[n].destroy()},i.evaluate=function(t,i){for(var n=this.dE,r=n.length,s=0;s<r;++s)n[s].evaluate(t,i)},t}(),NY=function(){function t(t,i,n,r){this.Of=null,this.wE=null,this.wv=null,this.bE=void 0,this.bE=t,i&&(this.Of=new MY(i.times,i.values,Ir)),n&&(this.wE=new MY(n.times,n.values,Qr)),r&&(this.wv=new MY(r.times,r.values,Ir))}var i=t.prototype;return i.destroy=function(){this.bE.destroy()},i.evaluate=function(t,i){var n=this.bE.index,r=this.Of,s=this.wE,e=this.wv,h=i.transforms;if(r){var u=r.evaluate(t);h.setPosition(n,u)}if(s){var o=s.evaluate(t);h.setRotation(n,o)}if(e){var c=e.evaluate(t);h.setScale(n,c)}},t}();function PY(t,i,n){var r=t.length,s=t[0],e=t[r-1];if(i<s)n.just=!0,n.index=0;else if(i>e)n.just=!0,n.index=r-1;else{var h=io(t,i);if(h>=0)n.just=!0,n.index=h;else{var u=~h,o=u-1,c=t[o],a=t[u],f=(i-t[o])/(a-c);n.just=!1,n.index=o,n.nextIndex=u,n.ratio=f}}return n}var LY={uint8:Uint8Array,uint16:Uint16Array};function DY(t){switch(t.BYTES_PER_ELEMENT){default:case 4:return 0;case 8:return 1}}var BY,FY,UY,xY,GY=pY(Vj+"QuantizedFloatArray")((aY=function(){function t(t,i,n,r){void 0===r&&(r=0),this.originalPrecision=fY&&fY(),this.min=vY&&vY(),this.extent=lY&&lY(),this.values=dY&&dY(),this.originalPrecision=t,this.values=i,this.extent=n,this.min=r}return t.prototype.toHashString=function(){var t=this.originalPrecision,i=this.min,n=this.extent,r=this.values;return t+" "+bY(i)+" "+bY(n)+" "+r.join(" ")},r(t,[{key:"quantizationType",get:function(){switch(this.values.BYTES_PER_ELEMENT){default:case 1:return"uint8";case 2:return"uint16"}}}]),t}(),fY=uo(aY.prototype,"originalPrecision",[_Y],null),vY=uo(aY.prototype,"min",[_Y],null),lY=uo(aY.prototype,"extent",[_Y],null),dY=uo(aY.prototype,"values",[_Y],null),cY=aY))||cY;function jY(t,i){var n=LY[i],r=1<<n.BYTES_PER_ELEMENT,s=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;t.forEach((function(t){s=Math.min(t,s),e=Math.max(t,e)}));var h=e-s,u=n.from(t,(function(t){return(t-s)/h*r}));return new GY(DY(t),u,h,s)}function HY(t,i){return t.values[i]/(1<<t.values.BYTES_PER_ELEMENT)*t.extent+t.min}function VY(t,i,n,r,s,e){var h=new FH;h.path=(new BH).toHierarchy(r).toProperty(s);var u=e(h);return u?{runtimeBinding:u,evaluator:new MY(t,i,n)}:null}function $Y(t,i,n){Ir.set(n,HY(t,3*i+0),HY(t,3*i+1),HY(t,3*i+2))}function zY(t,i,n){Qr.set(n,HY(t,4*i+0),HY(t,4*i+1),HY(t,4*i+2),HY(t,4*i+3))}var WY,XY,YY,KY,qY,QY,JY,ZY,tK,iK,nK,rK,sK,eK,hK,uK,oK,cK,aK,fK=_o(Vj+"AuxiliaryCurveEntry")((FY=function(){this.name=UY&&UY(),this.curve=xY&&xY()},UY=uo(FY.prototype,"name",[Co],(function(){return""})),xY=uo(FY.prototype,"curve",[Co],(function(){return new pa})),BY=FY))||BY,vK=Symbol("SearchForRootBonePath"),lK=Symbol("ExoticAnimation"),dK=Symbol("[[EmbeddedPlayerCount]]"),wK=Symbol("[[GetEmbeddedPlayers]]"),gK=Symbol("[[AddEmbeddedPlayer]]"),pK=Symbol("[[RemoveEmbeddedPlayer]]"),_K=Symbol("[[ClearEmbeddedPlayers]]"),yK=Symbol("[[Additive Settings]]"),mK=t("a1",_o("cc.AnimationClip")((hK=function(t){function i(i){var n;return(n=t.call(this,i)||this).sample=YY&&YY(),n.speed=KY&&KY(),n.wrapMode=qY&&qY(),n.enableTrsBlending=QY&&QY(),n._duration=JY&&JY(),n._hash=ZY&&ZY(),n.kE=0,n._tracks=tK&&tK(),n._exoticAnimation=iK&&iK(),n.AE=void 0,n.EE=!1,n._events=nK&&nK(),n._embeddedPlayers=rK&&rK(),n._additiveSettings=sK&&sK(),n._auxiliaryCurveEntries=eK&&eK(),n.TE={ratios:[],eventGroups:[]},n}e(i,t),i.createWithSpriteFrames=function(t,n){var r=new i;r.sample=n||r.sample,r.duration=t.length/r.sample;var s=1/r.sample,e=new qV;return e.path=(new BH).toComponent("cc.Sprite").toProperty("spriteFrame"),e.channels()[0].curve.assignSorted(t.map((function(t,i){return[s*i,t]}))),r.addTrack(e),r};var n=i.prototype;return n.onLoaded=function(){this.kE=this.sample,this.events=this._events},n.range=function(){for(var t={min:1/0,max:-1/0},i=this._tracks,n=i.length,r=0;r<n;++r){var s=i[r].range();t.min=Math.min(t.min,s.min),t.max=Math.max(t.max,s.max)}return t},n.getTrack=function(t){return this._tracks[t]},n.addTrack=function(t){var i=this._tracks.length;return this._tracks.push(t),i},n.removeTrack=function(t){this._tracks.splice(t,1)},n.clearTracks=function(){this._tracks.length=0},n.containsAnyEvent=function(){return 0!==this._events.length},n.createEventEvaluator=function(t){return new NK(t,this.TE.ratios,this.TE.eventGroups,this.wrapMode)},n.containsAnyEmbeddedPlayer=function(){return 0!==this._embeddedPlayers.length},n.createEmbeddedPlayerEvaluator=function(t){return new AK(this._embeddedPlayers,t)},n.createEvaluator=function(t){var i=this,n=t.target;return this.OE(n,(function(r){if(!t.mask||!r.isMaskedOff(t.mask)){var s=r.createRuntimeBinding(n,i.enableTrsBlending?t.pose:void 0,!1);return null!=s?s:void 0}}),t.rootMotion)},n.destroy=function(){var i,n=null==(i=T.director.root)?void 0:i.dataPoolManager;return n&&n.releaseAnimationClip(this),TX.destroy(this),t.prototype.destroy.call(this)},n[EX]=function(t,i,n){for(var r=1/i,s=this.SE(),e=s.length,h={},u=0;u<e;++u)h[s[u]]={transforms:Array.from({length:n},(function(){return new ls}))};var o=s.reduce((function(t,i){return t[i]=new OK,t}),{});for(var c in o){var a=o[c],f=c.lastIndexOf("/");if(f>=0){var v=c.substring(0,f),l=o[v];l&&(a.parent=l)}}for(var d=this.OE(void 0,(function(t){var i=t.parseTrsPath();if(i){var n=o[i.node];if(n)return MK(n,i.property)}}),void 0),w=0;w<n;++w){var g=t+r*w;d.evaluate(g);for(var p=0;p<e;++p){var _=s[p];ls.copy(h[_].transforms[w],o[_].globalTransform)}for(var y=0;y<e;++y){var m=s[y];o[m].invalidate()}}return{samples:i,frames:n,joints:h}},n.upgradeUntypedTracks=function(t){for(var i=[],n=[],r=this._tracks,s=r.length,e=0;e<s;++e){var h=r[e];if(h instanceof xX){var u=h.upgrade(t);u&&(i.push(u),n.push(h))}}for(var o=n.length,c=0;c<o;++c)ui(r,n[c]);r.push.apply(r,i)},n[vK]=function(){return this.RE()},n.getPropertyCurves=function(){return this.ME().getPropertyCurves()},n.updateEventDatas=function(){this.events=this._events},n.hasEvents=function(){return 0!==this.events.length},n.syncLegacyData=function(){this.AE&&(this.CE(this.AE),this.AE=void 0)},n[wK]=function(){return this._embeddedPlayers},n[gK]=function(t){this._embeddedPlayers.push(t)},n[pK]=function(t){var i=this._embeddedPlayers.indexOf(t);i>=0&&this._embeddedPlayers.splice(i,1)},n[_K]=function(){this._embeddedPlayers.length=0},n.getAuxiliaryCurveNames_experimental=function(){return this._auxiliaryCurveEntries.map((function(t){return t.name}))},n.hasAuxiliaryCurve_experimental=function(t){return!!this.NE(t)},n.addAuxiliaryCurve_experimental=function(t){var i=this.NE(t);return i||((i=new fK).name=t,this._auxiliaryCurveEntries.push(i)),i.curve},n.getAuxiliaryCurve_experimental=function(t){return this.NE(t).curve},n.renameAuxiliaryCurve_experimental=function(t,i){var n=this.NE(t);n&&(n.name=i)},n.removeAuxiliaryCurve_experimental=function(t){ci(this._auxiliaryCurveEntries,(function(i){return i.name===t}))},n._trySyncLegacyData=function(){this.EE&&(this.EE=!1,this.syncLegacyData())},n.OE=function(t,i,n){this.EE&&(this.EE=!1,this.syncLegacyData());var r,s=[];n&&(r=this.PE(t,n,s));for(var e,h=[],u=this._tracks,o=u.length,c=0;c<o;++c){var a=u[c];if(!s.includes(a)&&!Array.from(a.channels()).every((function(t){return 0===t.curve.keyFramesCount}))){var f=i(a[DH]);if(f){var v=void 0;if(a instanceof xX){if(!f.getValue){ht(3930);continue}var l=f.getValue();v=a.createLegacyEval(l)}else v=a[$j]();h.push(new kK(f,v))}}}return this._exoticAnimation&&(e=this._exoticAnimation.createEvaluator(i)),new EK(h,e,r)},n.PE=function(t,i,n){if(t instanceof WE){var r=this.RE();if(r){var s=t.getChildByPath(r);if(s){for(var e=new TK,h=[],u=this._tracks,o=u.length,c=0;c<o;++c){var a=u[c],f=a[DH].parseTrsPath();if(f&&f.node===r){n.push(a);var v=MK(e,f.property);if(v){var l=a[$j]();h.push(new kK(v,l))}}}return new IK(s,this._duration,e,h)}st(3924)}else st(3923)}else ht(3920)},n.RE=function(){var t=this._tracks.map((function(t){var i=t[DH].parseTrsPath();if(i){var n=i.node;return{path:n,rank:n.split("/").length}}return{path:"",rank:0}}));t.sort((function(t,i){return t.rank-i.rank}));var i=t.findIndex((function(t){return 0!==t.rank}));if(i<0)return"";for(var n=t.length,r=t[i],s=!0,e=i+1;e<n;++e){var h=t[e];if(h.rank!==r.rank)break;if(h.path!==r.path){s=!1;break}}return s?r.path:""},n.ME=function(){return this.AE||(this.AE=this.LE()),this.AE},n.LE=function(){var t=new GX(this._duration);return t.keys=[],t.curves=[],t.commonTargets=[],t},n.CE=function(t){for(var i=t.toTracks(),n=i.length,r=0;r<n;++r)this.addTrack(i[r])},n.SE=function(){for(var t=new Set,i=this._tracks,n=i.length,r=0;r<n;++r){var s=i[r][DH].parseTrsPath();s&&t.add(s.node)}if(this._exoticAnimation)for(var e=this._exoticAnimation.collectAnimatedJoints(),h=e.length,u=0;u<h;++u)t.add(e[u]);return Array.from(t)},n.NE=function(t){return this._auxiliaryCurveEntries.find((function(i){return i.name===t}))},r(i,[{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"tracksCount",get:function(){return this._tracks.length}},{key:"tracks",get:function(){return this._tracks}},{key:"hash",get:function(){var t,i;if(this._hash)return this._hash;var n="Exotic:"+(null!==(t=null==(i=this._exoticAnimation)?void 0:i.toHashString())&&void 0!==t?t:"");return this._hash=Sv(n,666)}},{key:"events",get:function(){return this._events},set:function(t){var i=this;this._events=t;for(var n=[],r=[],s=this.events.sort((function(t,i){return t.frame-i.frame})),e=s.length,h=function(){var t=s[u],e=t.frame/i._duration,h=n.findIndex((function(t){return t===e}));h<0&&(h=n.length,n.push(e),r.push({events:[]})),r[h].events.push({functionName:t.func,parameters:t.params})},u=0;u<e;++u)h();this.TE={ratios:n,eventGroups:r}}},{key:lK,get:function(){return this._exoticAnimation}},{key:lK,set:function(t){this._exoticAnimation=t}},{key:"isAdditive_experimental",get:function(){return this._additiveSettings.enabled}},{key:yK,get:function(){return this._additiveSettings}},{key:"keys",get:function(){return this.ME().keys}},{key:"keys",set:function(t){this.EE=!0,this.ME().keys=t}},{key:"curves",get:function(){return this.EE=!0,this.ME().curves}},{key:"curves",set:function(t){this.ME().curves=t}},{key:"commonTargets",get:function(){return this.ME().commonTargets}},{key:"commonTargets",set:function(t){this.EE=!0,this.ME().commonTargets=t}},{key:"data",get:function(){return this.ME().data}},{key:"eventGroups",get:function(){return this.TE.eventGroups}},{key:dK,get:function(){return this._embeddedPlayers.length}},{key:"auxiliaryCurveCount_experimental",get:function(){return this._auxiliaryCurveEntries.length}}]),i}(rg),hK.WrapMode=Yj,YY=uo((XY=hK).prototype,"sample",[Co],(function(){return 60})),KY=uo(XY.prototype,"speed",[Co],(function(){return 1})),qY=uo(XY.prototype,"wrapMode",[Co],(function(){return Yj.Normal})),QY=uo(XY.prototype,"enableTrsBlending",[Co],(function(){return!1})),JY=uo(XY.prototype,"_duration",[Co],(function(){return 0})),ZY=uo(XY.prototype,"_hash",[Co],(function(){return 0})),tK=uo(XY.prototype,"_tracks",[Co],(function(){return[]})),iK=uo(XY.prototype,"_exoticAnimation",[Co],(function(){return null})),nK=uo(XY.prototype,"_events",[Co],(function(){return[]})),rK=uo(XY.prototype,"_embeddedPlayers",[Co],(function(){return[]})),sK=uo(XY.prototype,"_additiveSettings",[Co],(function(){return new bK})),eK=uo(XY.prototype,"_auxiliaryCurveEntries",[Co],(function(){return[]})),WY=XY))||WY),bK=_o("cc.AnimationClipAdditiveSettings")((oK=function(){this.enabled=cK&&cK(),this.refClip=aK&&aK()},cK=uo(oK.prototype,"enabled",[Co],(function(){return!1})),aK=uo(oK.prototype,"refClip",[Co],(function(){return null})),uK=oK))||uK;T.AnimationClip=mK;var kK=function(){function t(t,i){this.DE=void 0,this.BE=void 0,this.FE=!0,this.DE=t,this.BE=i,this.FE=!!t.getValue&&i.requiresDefault}return t.prototype.evaluate=function(t){var i=this.DE,n=this.BE,r=this.FE?i.getValue():void 0,s=n.evaluate(t,r);i.setValue(s)},t}(),AK=function(){function t(t,i){this.UE=t,this.xE=t.map((function(t){var n=t.playable;if(!n)return null;var r=n.instantiate(i);return r?{instantiatedPlayer:r,entered:!1,hostPauseTime:0,lastIterations:0}:null}))}var i=t.prototype;return i.destroy=function(){for(var t=this.xE,i=t.length,n=0;n<i;++n){var r;null==(r=t[n])||r.instantiatedPlayer.destroy()}this.xE.length=0},i.evaluate=function(t,i){for(var n=this.UE,r=this.xE,s=n.length,e=0;e<s;++e){var h=r[e];if(h){var u=h.entered,o=h.instantiatedPlayer,c=h.lastIterations,a=n[e],f=a.begin,v=a.end;if(t>=f&&t<=v?u?i!==c&&(o.stop(),o.play(),h.entered=!0):(o.play(),h.entered=!0):u&&(o.stop(),h.entered=!1),h.lastIterations=i,h.entered){var l=t-f;h.instantiatedPlayer.setTime(l)}}}},i.notifyHostSpeedChanged=function(t){for(var i=this.UE,n=this.xE,r=i.length,s=0;s<r;++s){var e=n[s];if(e){var h=e.instantiatedPlayer;i[s].reconciledSpeed&&h.setSpeed(t)}}},i.notifyHostPlay=function(t){for(var i=this.UE,n=this.xE,r=i.length,s=0;s<r;++s){var e=n[s];if(e){var h=i[s],u=h.begin,o=h.end,c=e.instantiatedPlayer;if(e.entered){var a=e.hostPauseTime;if(c.randomAccess||xn(a,t,1e-5)){var f=Gn(t,u,o);c.play(),c.setTime(f-u)}else c.stop()}}}},i.notifyHostPause=function(t){for(var i=this.UE,n=this.xE,r=i.length,s=0;s<r;++s){var e=n[s];if(e){var h=e.instantiatedPlayer;e.entered&&(h.pause(),e.hostPauseTime=t)}}},i.notifyHostStop=function(){for(var t=this.UE,i=this.xE,n=t.length,r=0;r<n;++r){var s=i[r];if(s){var e=s.instantiatedPlayer;s.entered&&(s.entered=!1,e.stop())}}},t}(),EK=function(){function t(t,i,n){this.GE=void 0,this.jE=[],this.HE=void 0,this.jE=t,this.GE=i,this.HE=n}var i=t.prototype;return i.evaluate=function(t){for(var i=this.jE,n=this.GE,r=i.length,s=0;s<r;++s)i[s].evaluate(t);n&&n.evaluate(t)},i.evaluateRootMotion=function(t,i){var n=this.HE;n&&n.evaluate(t,i)},t}(),TK=function(){function t(){this.position=new Ir,this.scale=new Ir(1,1,1),this.rotation=new Qr,this.eulerAngles=new Ir}return t.prototype.getTransform=function(t){ls.fromRTS(t,this.rotation,this.position,this.scale)},t}(),OK=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).parent=null,i.Np=!0,i.Hn=new ls,i}return e(i,t),i.prototype.invalidate=function(){this.Np=!0},r(i,[{key:"globalTransform",get:function(){var t=this.Hn;return this.Np&&(this.Np=!1,ls.fromRTS(t,this.rotation,this.position,this.scale),this.parent&&ls.multiply(t,this.parent.globalTransform,t)),this.Hn}}]),i}(TK),SK=new ls,IK=function(){function t(t,i,n,r){this.VE=new ls,this.$E=new ls,this.zE=new ls,this.WE=new ls,this.XE=new ls,this.YE=new Ir,this.KE=new Qr,this.qE=new Ir,this.QE=t,this.hE=i,this.JE=n,this.ZE=r}var i=t.prototype;return i.evaluate=function(t,i){var n=this.tT(t,i,this.XE),r=this.YE,s=this.KE,e=this.qE,h=this.QE;ls.toSRT(n,s,r,e),Ir.add(r,r,h.position),h.setPosition(r),Qr.multiply(s,s,h.rotation),h.setRotation(s),Ir.multiply(e,e,h.scale),h.setScale(e)},i.tT=function(t,i,n){var r=this.hE,s=r-t,e=this.iT(t,this.zE);if(i<s){var h=this.iT(t+i,this.WE);RK(n,e,h)}else{ls.identity(n);var u=function(t,i){RK(SK,t,i),ls.multiply(n,n,SK)},o=i-s,c=Math.floor(o/r),a=o-c*r,f=this.iT(0,this.VE),v=this.iT(r,this.$E),l=this.iT(a,this.WE);u(e,v),RK(SK,f,v);for(var d=0;d<c;++d)ls.multiply(n,n,SK);u(f,l)}return n},i.iT=function(t,i){for(var n=this.ZE,r=n.length,s=0;s<r;++s)n[s].evaluate(t);return this.JE.getTransform(i),i},t}();function RK(t,i,n){ls.invert(t,i),ls.multiply(t,n,t)}function MK(t,i){switch(i){default:return;case"position":return{setValue:function(i){Ir.copy(t.position,i)}};case"rotation":return{setValue:function(i){Qr.copy(t.rotation,i)}};case"scale":return{setValue:function(i){Ir.copy(t.scale,i)}};case"eulerAngles":return{setValue:function(i){Ir.copy(t.eulerAngles,i)}}}}var CK,NK=function(){function t(t,i,n,r){this.nT=-1,this.dA=0,this.rT=0,this.sT=-1,this.eT=!1,this.hT=t,this.uT=i,this.oT=n,this.cA=r}var i=t.prototype;return i.setWrapMode=function(t){this.cA=t},i.ignore=function(t,i){this.sT=-1,this.eT=!1;var n=LK(t,this.uT);n<0&&(n=~n-1,i<0&&(n+=1),this.sT=n)},i.reset=function(){this.nT=-1,this.dA=0,this.rT=0,this.sT=-1,this.eT=!1},i.sample=function(t,i,n){if(0!==this.oT.length){var r=this.oT.length,s=LK(t,this.uT);if(s<0&&(s=~s-1,i<0&&(s+=1)),this.sT!==s&&(this.sT=-1),!this.eT)return this.eT=!0,this.cT(s,!1),this.nT=s,this.dA=n,void(this.rT=i);var e=this.cA,h=PK(n),u=PK(this.dA),o=this.nT,c=this.rT,a=-1!==u&&h!==u;if(o===s&&a&&1===r)this.cT(0,!1);else if(o!==s||a){i=c;do{if(o!==s){if(-1===i&&0===o&&s>0?(22&~e?o=r:i*=-1,u++):1===i&&o===r-1&&s<r-1&&(22&~e?o=-1:i*=-1,u++),o===s)break;if(u>h)break}o+=i,this.cT(o,!0)}while(o!==s&&o>-1&&o<r)}this.nT=s,this.dA=n,this.rT=i}},i.cT=function(t,i){i?Qj().pushDelayEvent(this.fT,this,[t]):this.fT(t)},i.fT=function(t){if(this.hT&&this.hT.isValid){var i=this.oT;if(!(t<0||t>=i.length||this.sT===t))for(var n=i[t],r=n.events.length,s=0;s<r;++s){var e=n.events[s];Q$(this.hT,e.functionName,e.parameters)}}},t}();function PK(t){return t-(0|t)==0&&(t-=1),0|t}function LK(t,i){return io(i,t)}function DK(t,i,n,r,s,e){if(0===i)return e.time=0,e.ratio=0,e.direction=1,e.stopped=!!Number.isFinite(r),e.iterations=0,e;var h=!1,u=t>0?t/i:-t/i;if(u>=r){u=r,h=!0;var o=r-(0|r);0===o&&(o=1),t=o*i*(t>0?1:-1)}if(t>i){var c=t%i;t=0===c?i:c}else t<0&&0!=(t%=i)&&(t+=i);var a=!1,f=4&n;f&&(a=BK(n,u));var v=a?-1:1;return f&&a&&(t=i-t),e.time=t,e.ratio=e.time/i,e.direction=v,e.stopped=h,e.iterations=u,e}function BK(t,i){var n=!1;return 22&~t||(i-(0|i)==0&&i>0&&(i-=1),1&i&&(n=!n)),36&~t||(n=!n),n}var FK=new Ir,UK=new Ir,xK=new Qr;new Qr;var GK,jK,HK=function(){function t(){this.Of=new Ir,this.wE=new Qr,this.wv=Ir.clone(Ir.ONE)}return t.clone=function(i){var n=new t;return t.copy(n,i),n},t.setIdentity=function(t){return Ir.copy(t.Of,Ir.ZERO),Qr.copy(t.wE,Qr.IDENTITY),Ir.copy(t.wv,Ir.ONE),t},t.copy=function(t,i){return Ir.copy(t.Of,i.Of),Qr.copy(t.wE,i.wE),Ir.copy(t.wv,i.wv),t},t.equals=function(t,i,n){return Ir.equals(t.Of,i.Of,n)&&Qr.equals(t.wE,i.wE,n)&&Ir.equals(t.wv,i.wv,n)},t.strictEquals=function(t,i){return Ir.strictEquals(t.Of,i.Of)&&Qr.strictEquals(t.wE,i.wE)&&Ir.strictEquals(t.wv,i.wv)},t.lerp=function(i,n,r,s){return 0===s?t.copy(i,n):1===s?t.copy(i,r):(Ir.lerp(i.Of,n.Of,r.Of,s),Qr.slerp(i.wE,n.wE,r.wE,s),Ir.lerp(i.wv,n.wv,r.wv,s),i)},t.multiply=function(t,i,n){var r=Qr.multiply(xK,i.wE,n.wE),s=Ir.multiply(FK,n.wv,i.wv),e=Ir.multiply(UK,n.Of,i.wv);return Ir.transformQuat(e,e,i.wE),Ir.add(e,e,i.Of),Ir.copy(t.Of,e),Qr.copy(t.wE,r),Ir.copy(t.wv,s),t},t.invert=function(t,i){var n=t.wE,r=t.wv,s=t.Of;return Qr.invert(n,i.wE),VK(r,i.wv,Fn),Ir.negate(s,i.Of),Ir.multiply(s,s,r),Ir.transformQuat(s,s,n),t},t.fromMatrix=function(t,i){return ls.toSRT(i,t.wE,t.Of,t.wv),t},t.toMatrix=function(t,i){return ls.fromSRT(t,i.wE,i.Of,i.wv)},r(t,[{key:"position",get:function(){return this.Of},set:function(t){Ir.copy(this.Of,t)}},{key:"rotation",get:function(){return this.wE},set:function(t){Qr.copy(this.wE,t)}},{key:"scale",get:function(){return this.wv},set:function(t){Ir.copy(this.wv,t)}}]),t}();function VK(t,i,n){var r=i.x,s=i.y,e=i.z;return Ir.set(t,Math.abs(r)<=n?0:1/r,Math.abs(s)<=n?0:1/s,Math.abs(e)<=n?0:1/e)}function $K(t,i,n){return Ir.subtract(t.position,i.position,n.position),YK(t.rotation,n.rotation,i.rotation),Ir.subtract(t.scale,i.scale,n.scale),t}CK=HK,HK.IDENTITY=Object.freeze(new CK),HK.ZERO=Object.freeze(function(){var t=new CK;return Ir.copy(t.Of,Ir.ZERO),Qr.set(t.wE,0,0,0,0),Ir.copy(t.wv,Ir.ZERO),t}()),HK.calculateRelative=(GK=new Qr,jK=new Ir,function(t,i,n){var r=Qr.invert(GK,n.wE),s=VK(jK,n.wv,Fn),e=Ir.subtract(UK,i.Of,n.Of);return Ir.transformQuat(e,e,r),Ir.multiply(e,e,s),Ir.copy(t.Of,e),Qr.multiply(t.wE,r,i.wE),Ir.multiply(t.wv,i.wv,s),t});var zK,WK,XK=(zK=new Qr,function(t,i,n,r){Ir.scaleAndAdd(t.position,i.position,n.position,r);var s=Qr.slerp(zK,Qr.IDENTITY,n.rotation,r);return Qr.multiply(t.rotation,s,i.rotation),Ir.scaleAndAdd(t.scale,i.scale,n.scale,r),t}),YK=(WK=new Qr,function(t,i,n){var r=Qr.invert(WK,i);return Qr.multiply(t,n,r)}),KK=Object.freeze(function(){var t=new HK;return t.position=Ir.ZERO,t.rotation=Qr.IDENTITY,t.scale=Ir.ZERO,t}()),qK=function(){function t(t,i){this.transforms=void 0,this.auxiliaryCurves=void 0,this._poseTransformSpace=0,this.transforms=t,this.auxiliaryCurves=i}return t._create=function(i,n){return new t(i,n)},t}(),QK=function(){function t(t){this.vT=new Uint16Array(t)}return r(t,[{key:"involvedTransforms",get:function(){return this.vT}}]),t}();function JK(t,i,n,r){void 0===r&&(r=void 0),ZK(t.transforms,i.transforms,n,r),sq(t.auxiliaryCurves,i.auxiliaryCurves,n)}function ZK(t,i,n,r){void 0===r&&(r=void 0);var s=t.length;if(t.length,0!==n)if(1!==n)if(r)for(var e=0;e<r.involvedTransforms.length;++e){var h=r.involvedTransforms[e];rq(t,i,n,h)}else for(var u=0;u<s;++u)rq(t,i,n,u);else r?tq(t,i,r):t.set(i)}function tq(t,i,n){t.length,t.length;for(var r=0;r<n.involvedTransforms.length;++r){var s=n.involvedTransforms[r];t.copyRange(s,i,s,1)}}var iq,nq,rq=(iq=new HK,nq=new HK,function(t,i,n,r){var s=t.getTransform(r,nq),e=i.getTransform(r,iq);HK.lerp(s,s,e,n),t.setTransform(r,s)});function sq(t,i,n){var r=i.length;t.length;for(var s=0;s<r;++s)t[s]=Hn(t[s],i[s],n)}var eq=function(){var t=new HK,i=new HK;return function(n,r,s){var e=r.getTransform(s,t),h=n.getTransform(s,i);$K(h,h,e),n.setTransform(s,h)}}();function hq(t,i){var n=t.length;i.length;for(var r=0;r<n;++r)eq(t,i,r)}function uq(t,i){t.length,i.length;for(var n=0;n<t.length;++n)t[n]-=i[n]}function oq(t,i,n,r){void 0===r&&(r=void 0),aq(t.transforms,i.transforms,n,r),fq(t.auxiliaryCurves,i.auxiliaryCurves,n)}var cq=function(){var t=new HK,i=new HK;return function(n,r,s,e){var h=r.getTransform(e,t),u=n.getTransform(e,i);XK(u,u,h,s),n.setTransform(e,u)}}();function aq(t,i,n,r){void 0===r&&(r=void 0);var s=t.length;if(i.length,r)for(var e=0;e<r.involvedTransforms.length;++e){var h=r.involvedTransforms[e];cq(t,i,n,h)}else for(var u=0;u<s;++u)cq(t,i,n,u)}function fq(t,i,n){t.length,i.length;for(var r=0;r<t.length;++r)t[r]+=i[r]*n}var vq=new Ir,lq=new Qr,dq=function(){function t(t){this._transformHandle=t}return t.prototype.destroy=function(){this._transformHandle.destroy()},t}(),wq=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.setValue=function(t,i){i.transforms.setPosition(this._transformHandle.index,t)},n.getValue=function(t){return t.transforms.getPosition(this._transformHandle.index,vq)},i}(dq),gq=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.setValue=function(t,i){i.transforms.setRotation(this._transformHandle.index,t)},n.getValue=function(t){return t.transforms.getRotation(this._transformHandle.index,lq)},i}(dq),pq=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.setValue=function(t,n){var r=Qr.fromEuler(i.lT,t.x,t.y,t.z);n.transforms.setRotation(this._transformHandle.index,r)},n.getValue=function(t){var i=t.transforms.getRotation(this._transformHandle.index,lq);return Qr.toEuler(vq,i)},i}(dq);pq.lT=new Qr;var _q=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.setValue=function(t,i){i.transforms.setScale(this._transformHandle.index,t)},n.getValue=function(t){return t.transforms.getScale(this._transformHandle.index,vq)},i}(dq),yq=function(){function t(t){this.dT=t}var i=t.prototype;return i.destroy=function(){this.dT.destroy()},i.setValue=function(t,i){i.auxiliaryCurves[this.dT.index]=t},i.getValue=function(t){return t.auxiliaryCurves[this.dT.index]},t}();function mq(t,i){switch(i){case"position":return new wq(t);case"rotation":return new gq(t);case"eulerAngles":return new pq(t);case"scale":return new _q(t)}}var bq=function(){function t(t){this.binding=t}var i=t.prototype;return i.destroy=function(){},i.setValue=function(t){this.binding.setValue(t)},i.getValue=function(){var t,i,n;return null!==(t=null==(i=(n=this.binding).getValue)?void 0:i.call(n))&&void 0!==t?t:void 0},t}(),kq=function(){function t(t,i){this.DE=void 0,this.wT=void 0,this.DE=t,this.wT=i}var i=t.prototype;return i.destroy=function(){this.DE.destroy()},i.evaluate=function(t,i){var n=this.wT,r=this.DE,s=n.requiresDefault?r.getValue(i):void 0,e=n.evaluate(t,s);r.setValue(e,i)},t}();function Aq(t,i,n){var r=Eq(i[DH],n);return null!=r?r:void 0}function Eq(t,i){var n=i.origin,r=t.path,s=t.proxy,e=r.length,h=e-1;if(0!==e&&(r.isPropertyAt(h)||r.isElementAt(h))&&!s){var u=r.isPropertyAt(h)?r.parsePropertyAt(h):r.parseElementAt(h),o=r[PH](n,0,e-1);if(null===o)return null;if(o instanceof WE&&UH(u)){var c=function(){for(var t=[],i=o;i&&i!==n;i=i.parent)t.unshift(i.name);return i===n?t.join("/"):void 0}();if("string"==typeof c){var a=i.bindTransform(c);if(!a)return;return mq(a,u)}}}var f=t.createRuntimeBinding(i.origin,void 0,!1);return f?new bq(f):null}var Tq=function(){function t(t,i){this.DE=t,this.HA=i}return t.prototype.evaluate=function(t,i){var n=this.HA,r=this.DE,s=i,e=n.evaluate(t);r.setValue(e,s)},t}();function Oq(t,i){return t.isAdditive_experimental?new iQ(t,i):new tQ(t,i)}var Sq,Iq,Rq,Mq,Cq,Nq,Pq,Lq,Dq,Bq,Fq,Uq,xq,Gq,jq,Hq,Vq,$q,zq,Wq,Xq,Yq,Kq,qq,Qq,Jq,Zq,tQ=function(){function t(t,i){this.gT=[],this.pT=void 0,this._T=[],t._trySyncLegacyData();for(var n,r,s=[],e=[],h=t.tracks,u=t[lK],o=w(h);!(r=o()).done;){var c=r.value;if(!(c instanceof xX||Array.from(c.channels()).every((function(t){return 0===t.curve.keyFramesCount})))){var a=Aq(0,c,i);if(a){var f=c[$j](),v=new kq(a,f);s.push(v)}}}u&&(n=u.createEvaluatorForAnimationGraph(i));for(var l=t.getAuxiliaryCurveNames_experimental(),d=l.length,g=0;g<d;++g){var p=l[g],_=t.getAuxiliaryCurve_experimental(p),y=i.bindAuxiliaryCurve(p),m=new yq(y);e.push(new Tq(m,_))}this.gT=s,this.pT=n,this._T=e}var i=t.prototype;return i.destroy=function(){var t;null==(t=this.pT)||t.destroy();for(var i=this.gT,n=i.length,r=0;r<n;++r)i[r].destroy()},i.evaluate=function(t,i){for(var n=this.gT,r=this.pT,s=this._T,e=i.pushDefaultedPose(),h=n.length,u=0;u<h;++u)n[u].evaluate(t,e);r&&r.evaluate(t,e);for(var o=s.length,c=0;c<o;++c)s[c].evaluate(t,e);return e},t}(),iQ=function(){function t(t,i){this.EA=void 0,this.yT=void 0,this.EA=new tQ(t,i);var n=t[yK].refClip;n&&n!==t&&(this.yT=new tQ(n,i))}var i=t.prototype;return i.destroy=function(){var t;this.EA.destroy(),null==(t=this.yT)||t.destroy()},i.evaluate=function(t,i){var n,r,s=this.EA.evaluate(t,i);return r=this.yT?this.yT.evaluate(0,i):this.EA.evaluate(0,i),hq((n=s).transforms,r.transforms),uq(n.auxiliaryCurves,r.auxiliaryCurves),i.popPose(),s},t}(),nQ=ic,rQ=(Sq=_o("cc.animation.ClipMotion"),Iq=nQ(mK),Sq((Mq=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).clip=Cq&&Cq(),i}e(i,t);var n=i.prototype;return n[kX]=function(t,i){return this.clip?new eQ(t,this.clip,i):null},n.clone=function(){var t=new i;return t.clip=this.clip,t[He]=j$(this),t},i}(AX),Cq=uo(Mq.prototype,"clip",[Iq,Co],(function(){return null})),Rq=Mq))||Rq),sQ=Symbol("EvaluatePort"),eQ=function(){function t(t,i,n){var r,s;this.OA=null,this.mT=null,this.kT=new Kj,this.hE=0,this.AT=void 0,this.ET=i,this.AT=n;var e=null!==(r=null==(s=t.clipOverrides)?void 0:s.get(i))&&void 0!==r?r:i;this.TT(e,t)}var i=t.prototype;return i.createPort=function(){return new hQ(this)},i.getClipStatuses=function(t){var i=this,n=!1;return{next:function(){return n?{done:!0,value:void 0}:(n=!0,{done:!1,value:{__DEBUG_ID__:i.__DEBUG__ID__,clip:i.hA,weight:t}})}}},i[sQ]=function(t,i){var n,r,s=this.hE,e=this.hA.duration,h=this.EA,u=s*t,o=this.hA.wrapMode,c=DK(u,s,o,2&~o?1:1/0,0,this.kT),a=c.ratio*e,f=h.evaluate(a,i);return null==(n=this.mT)||n.sample(c.ratio,c.direction,c.iterations),null==(r=this.OA)||r.evaluate(a,Math.trunc(c.iterations)),f},i.overrideClips=function(t){var i,n=this.ET,r=null==(i=t.clipOverrides)?void 0:i.get(n);r&&this.TT(r,t)},i.reenter=function(){var t;null==(t=this.mT)||t.reset()},i.TT=function(t,i){var n;null==(n=this.EA)||n.destroy(),this.mT=null,this.OA&&(this.OA.destroy(),this.OA=null),this.hA=t,this.hE=0===t.speed?0:t.duration/t.speed,this.EA=Oq(t,i),this.mT=t.createEventEvaluator(i.origin),!this.AT&&t.containsAnyEmbeddedPlayer()&&(this.OA=t.createEmbeddedPlayerEvaluator(i.origin))},r(t,[{key:"duration",get:function(){return this.hE}}]),t}(),hQ=function(){function t(t){this.OT=void 0,this.OT=t}var i=t.prototype;return i.evaluate=function(t,i){return this.OT[sQ](t,i)},i.reenter=function(){this.OT.reenter()},t}(),uQ=_o,oQ=Co,cQ=uQ(Vj+"AnimationBlendItem")((Pq=function(){function t(){this.motion=Lq&&Lq()}var i=t.prototype;return i.clone=function(){var i=new t;return this._copyTo(i),i},i._copyTo=function(t){var i,n;return t.motion=null!==(i=null==(n=this.motion)?void 0:n.clone())&&void 0!==i?i:null,t},t}(),Lq=uo(Pq.prototype,"motion",[oQ],(function(){return null})),Nq=Pq))||Nq,aQ=uQ(Vj+"AnimationBlend")((Bq=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).name=Fq&&Fq(),i}return e(i,t),i.prototype.copyTo=function(t){t.name=this.name,t[He]=j$(this)},i}(AX),Fq=uo(Bq.prototype,"name",[oQ],(function(){return""})),Dq=Bq))||Dq,fQ=function(){function t(t,i,n,r,s){this.ST=r.map((function(n){var r,s;return null!==(r=null==(s=n.motion)?void 0:s[kX](t,i))&&void 0!==r?r:null})),this.IT=new Array(this.ST.length).fill(0),this.RT=[].concat(s)}var i=t.prototype;return i.createPort=function(){return new vQ(this,this.ST.map((function(t){var i;return null!==(i=null==t?void 0:t.createPort())&&void 0!==i?i:null})))},i.getChildWeight=function(t){return this.IT[t]},i.getChildMotionEval=function(t){return this.ST[t]},i.getClipStatuses=function(t){var i,n=this.ST,r=this.IT,s=n.length,e=0;return{next:function(){for(;;){if(i){var h=i.next();if(!h.done)return h}if(e>=s)return{done:!0,value:void 0};var u=n[e];i=null==u?void 0:u.getClipStatuses(t*r[e]),++e}}}},i.__evaluatePort=function(t,i,n){for(var r=this.ST.length,s=0,e=null,h=0;h<r;++h){var u,o=this.IT[h];if(o){var c=null==(u=t.childPorts[h])?void 0:u.evaluate(i,n);c&&(s+=o,e?(s&&JK(e,c,o/s),n.popPose()):e=c)}}return e||n.pushDefaultedPose()},i.overrideClips=function(t){for(var i=0;i<this.ST.length;++i){var n;null==(n=this.ST[i])||n.overrideClips(t)}},i.setInput=function(t,i){this.RT[i]=t,this.doEval()},i.doEval=function(){this.eval(this.IT,this.RT)},r(t,[{key:"childCount",get:function(){return this.IT.length}},{key:"duration",get:function(){for(var t=0,i=0;i<this.ST.length;++i){var n,r;t+=(null!==(n=null==(r=this.ST[i])?void 0:r.duration)&&void 0!==n?n:0)*this.IT[i]}return t}}]),t}(),vQ=function(){function t(t,i){this.childPorts=[],this.MT=void 0,this.MT=t,this.childPorts=i}var i=t.prototype;return i.evaluate=function(t,i){return this.MT.__evaluatePort(this,t,i)},i.reenter=function(){for(var t=this.childPorts,i=t.length,n=0;n<i;++n){var r;null==(r=t[n])||r.reenter()}},t}(),lQ=_o,dQ=Co,wQ=lQ(Vj+"BindableNumber")((xq=function(){function t(t){void 0===t&&(t=0),this.variable=Gq&&Gq(),this.value=jq&&jq(),this.value=t}return t.prototype.clone=function(){var i=new t;return i.value=this.value,i.variable=this.variable,i},t}(),Gq=uo(xq.prototype,"variable",[dQ],(function(){return""})),jq=uo(xq.prototype,"value",[dQ],(function(){return 0})),Uq=xq))||Uq,gQ=lQ(Vj+"BindableBoolean")((Vq=function(){function t(t){void 0===t&&(t=!1),this.variable=$q&&$q(),this.value=zq&&zq(),this.value=t}return t.prototype.clone=function(){var i=new t;return i.value=this.value,i.variable=this.variable,i},t}(),$q=uo(Vq.prototype,"variable",[dQ],(function(){return""})),zq=uo(Vq.prototype,"value",[dQ],(function(){return!1})),Hq=Vq))||Hq;function pQ(t,i,n,r,s){var e=i.variable,h=i.value;if(!e)return h;var u=t.getVar(e);if(!_Q(u,e))return h;if(u.type!==n)throw new C$(e,"number");for(var o=arguments.length,c=new Array(o>5?o-5:0),a=5;a<o;a++)c[a-5]=arguments[a];return u.bind.apply(u,[r,s].concat(c))}function _Q(t,i){if(t)return!0;throw new M$(i)}function yQ(t,i,n){if(t!==i)throw new C$(n,"number")}function mQ(t,i){if(2!==t)throw new C$(i,"trigger")}function bQ(t,i,n){if(t.fill(0),0===i.length);else if(n<=i[0])t[0]=1;else if(n>=i[i.length-1])t[t.length-1]=1;else{for(var r=0,s=1;s<i.length;++s)if(i[s]>n){r=s;break}var e=i[r-1],h=i[r],u=h-e;t[r-1]=(h-n)/u,t[r]=(n-e)/u}}var kQ,AQ,EQ=_o,TQ=Co,OQ=EQ(Vj+"AnimationBlend1DItem")((Xq=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).threshold=Yq&&Yq(),i}e(i,t);var n=i.prototype;return n.clone=function(){var t=new i;return this._copyTo(t),t},n._copyTo=function(i){return t.prototype._copyTo.call(this,i),i.threshold=this.threshold,i},i}(cQ),Yq=uo(Xq.prototype,"threshold",[TQ],(function(){return 0})),Wq=Xq))||Wq,SQ=EQ("cc.animation.AnimationBlend1D")((Zq=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._items=Qq&&Qq(),i.param=Jq&&Jq(),i}e(i,t);var n=i.prototype;return n.clone=function(){var t=new i;return this.copyTo(t),t._items=this._items.map((function(t){return t.clone()})),t.param=this.param.clone(),t},n[kX]=function(t,i){var n=new IQ(t,i,this,this._items,this._items.map((function(t){return t.threshold})),0),r=pQ(t,this.param,0,n.setInput,n,0);return n.setInput(r,0),n},r(i,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t).sort((function(t,i){return t.threshold-i.threshold}))}}]),i}(aQ),Zq.Item=OQ,Qq=uo((qq=Zq).prototype,"_items",[TQ],(function(){return[]})),Jq=uo(qq.prototype,"param",[TQ],(function(){return new wQ})),Kq=qq))||Kq,IQ=function(t){function i(i,n,r,s,e,h){var u;return(u=t.call(this,i,n,r,s,[h])||this).CT=e,u.doEval(),u}return e(i,t),i.prototype.eval=function(t,i){var n=i[0];bQ(t,this.CT,n)},i}(fQ),RQ=(kQ=new Ms,AQ={wA:0,wB:0},function(t,i,n){if(t.length,i.length,0!==i.length)if(1!==i.length)if(Ms.strictEquals(n,Ms.ZERO)){var r=i.findIndex((function(t){return Ms.strictEquals(t,Ms.ZERO)}));r>=0?t[r]=1:t.fill(1/i.length)}else{for(var s=-1,e=-1,h=-1,u=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,c=n.x,a=n.y,f=0;f<i.length;++f){var v=i[f];if(Ms.equals(v,Ms.ZERO))h=f;else{var l=Ms.normalize(kQ,v),d=Ms.dot(l,n);l.x*a-l.y*c>0?d>=o&&(o=d,s=f):d>=u&&(u=d,e=f)}}var w=0;if(s<0||e<0)w=1;else{var g=(E=i[s],T=i[e],O=n,S=AQ,(I=Ms.cross(E,T))?(S.wA=Ms.cross(O,T)/I,S.wB=Ms.cross(O,E)/-I):(S.wA=0,S.wB=0),S),p=g.wA,_=g.wB,y=0,m=0,b=p+_;b>1?(y=p/b,m=_/b):b<0?(y=0,m=0,w=1):(y=p,m=_,w=1-b),t[s]=y,t[e]=m}if(w>0)if(h>=0)t[h]=w;else for(var k=w/t.length,A=0;A<t.length;++A)t[A]+=k}else t[0]=1;var E,T,O,S,I});function MQ(t,i,n){CQ(t,i,n,HQ)}function CQ(t,i,n,r){t.fill(0);for(var s=new Ms(0,0),e=new Ms(0,0),h=0,u=i.length,o=0;o<u;++o){for(var c=Number.MAX_VALUE,a=!1,f=0;f<u;++f)if(o!==f){r(i[o],i[f],n,s,e);var v=1-Ms.dot(s,e)/Ms.lengthSqr(e);if(v<0){a=!0;break}c=Math.min(c,v)}a||(t[o]=c,h+=c)}h>0&&t.forEach((function(i,n){return t[n]=i/h}))}var NQ,PQ,LQ,DQ,BQ,FQ,UQ,xQ,GQ,jQ,HQ=function(t,i,n,r,s){Ms.subtract(r,n,t),Ms.subtract(s,i,t)},VQ=function(){function t(i){for(var n=t.NT,r=i.length,s=this.PT=new Array(r).fill(0),e=this.LT=i.map((function(t,i){var n=Ms.copy(new Ms,t),r=Ms.len(n);return s[i]=r,xn(r,0,1e-5)||Ms.multiplyScalar(n,n,1/r),n})),h=this.DT=new Float32Array(3*r*r),u=0;u<r;++u)for(var o=s[u],c=e[u],a=0;a<r;++a)if(u!==a){var f=s[a],v=e[a],l=(o+f)/2,d=3*(r*u+a);h[d+0]=(f-o)/l,h[d+1]=$Q(c,v)*n,h[d+2]=l}this.BT=new Float32Array(r)}return t.prototype.interpolate=function(i,n){var r=this.LT,s=this.PT,e=this.DT,h=this.BT,u=t.FT,o=t.UT,c=t.xT,a=t.NT,f=r.length;if(i.length,0!==f)if(1!==f){var v=n,l=Ms.len(v),d=h;if(Ms.equals(v,Ms.ZERO))for(var w=0;w<f;++w)d[w]=0;else for(var g=Ms.multiplyScalar(u,v,1/l),p=0;p<f;++p){var _=r[p];Ms.equals(_,Ms.ZERO)?d[p]=0:d[p]=$Q(_,g)*a}for(var y=0,m=0;m<f;++m){for(var b=s[m],k=r[m],A=Number.POSITIVE_INFINITY,E=0;E<f;++E)if(m!==E){var T=r[E],O=3*(f*m+E),S=e[O+0],I=e[O+1],R=e[O+2],M=I,C=d[m];Ms.equals(k,Ms.ZERO)?M=d[E]:Ms.equals(T,Ms.ZERO)?M=d[m]:Ms.equals(v,Ms.ZERO)&&(C=M);var N=Ms.set(o,S,M),P=Ms.set(c,(l-b)/R,C),L=1-Ms.dot(P,N)/Ms.lengthSqr(N);if(L<=0){A=0;break}A=Math.min(A,L)}i[m]=A,y+=A}if(y>0)for(var D=0;D<f;++D)i[D]/=y;else for(var B=1/f,F=0;F<f;++F)i[F]=B}else i[0]=1},t}();function $Q(t,i){var n=Ms.angle(t,i);return t.x*i.y-t.y*i.x<0?-n:n}VQ.FT=new Ms,VQ.UT=new Ms,VQ.xT=new Ms,VQ.NT=1;var zQ=_o,WQ=Co,XQ={SIMPLE_DIRECTIONAL:0,FREEFORM_CARTESIAN:1,FREEFORM_DIRECTIONAL:2};bi(XQ);var YQ,KQ,qQ,QQ,JQ,ZQ,tJ=zQ(Vj+"AnimationBlend2DItem")((PQ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).threshold=LQ&&LQ(),i}e(i,t);var n=i.prototype;return n.clone=function(){var t=new i;return this._copyTo(t),t},n._copyTo=function(i){return t.prototype._copyTo.call(this,i),Ms.copy(i.threshold,this.threshold),i},i}(cQ),LQ=uo(PQ.prototype,"threshold",[WQ],(function(){return new Ms})),NQ=PQ))||NQ,iJ=zQ("cc.animation.AnimationBlend2D")((jQ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._items=FQ&&FQ(),i.paramX=UQ&&UQ(),i.paramY=xQ&&xQ(),i._algorithm=GQ&&GQ(),i.GT=void 0,i}e(i,t);var n=i.prototype;return n.__callOnAfterDeserializeRecursive=function(){this.jT()},n.clone=function(){var t=new i;return this.copyTo(t),t._items=this._items.map((function(t){var i;return null!==(i=null==t?void 0:t.clone())&&void 0!==i?i:null})),t.paramX=this.paramX.clone(),t.paramY=this.paramY.clone(),t.algorithm=this._algorithm,t},n[kX]=function(t,i){var n,r=this.algorithm;2===r?(this.GT,n=new rJ(t,i,this,this._items,this.GT,[0,0])):n=new nJ(t,i,this,this._items,this._items.map((function(t){return t.threshold})),r,[0,0]);var s=pQ(t,this.paramX,0,n.setInput,n,0),e=pQ(t,this.paramY,0,n.setInput,n,1);return n.setInput(s,0),n.setInput(e,1),n},n.jT=function(){2===this._algorithm?this.GT=new VQ(this._items.map((function(t){return t.threshold}))):this.GT=void 0},r(i,[{key:"algorithm",get:function(){return this._algorithm},set:function(t){t!==this._algorithm&&(this._algorithm=t,this.jT())}},{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t),this.jT()}}]),i}(aQ),jQ.Algorithm=XQ,jQ.Item=tJ,FQ=uo((BQ=jQ).prototype,"_items",[WQ],(function(){return[]})),UQ=uo(BQ.prototype,"paramX",[WQ],(function(){return new wQ})),xQ=uo(BQ.prototype,"paramY",[WQ],(function(){return new wQ})),GQ=uo(BQ.prototype,"_algorithm",[WQ],(function(){return 0})),DQ=BQ))||DQ,nJ=function(t){function i(i,n,r,s,e,h,u){var o;return(o=t.call(this,i,n,r,s,u)||this).CT=void 0,o.HT=void 0,o.XA=new Ms,o.CT=e,o.HT=h,o.doEval(),o}return e(i,t),i.prototype.eval=function(t,i){var n=i[0],r=i[1];switch(Ms.set(this.XA,n,r),t.fill(0),this.HT){case 0:RQ(t,this.CT,this.XA);break;case 1:MQ(t,this.CT,this.XA)}},i}(fQ),rJ=function(t){function i(i,n,r,s,e,h){var u;return(u=t.call(this,i,n,r,s,h)||this).VT=void 0,u.XA=new Ms,u.VT=e,u.doEval(),u}return e(i,t),i.prototype.eval=function(t,i){var n=i[0],r=i[1];Ms.set(this.XA,n,r),t.fill(0),this.VT.interpolate(t,this.XA)},i}(fQ),sJ=_o,eJ=Co,hJ=sJ(Vj+"AnimationBlendDirectItem")((KQ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).weight=qQ&&qQ(),i}e(i,t);var n=i.prototype;return n.clone=function(){var t=new i;return this._copyTo(t),t},n._copyTo=function(i){return t.prototype._copyTo.call(this,i),i.weight=this.weight,i},i}(cQ),qQ=uo(KQ.prototype,"weight",[eJ],(function(){return new wQ(0)})),YQ=KQ))||YQ;sJ("cc.animation.AnimationBlendDirect")((ZQ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._items=JQ&&JQ(),i}e(i,t);var n=i.prototype;return n.clone=function(){var t=new i;return this.copyTo(t),t._items=this._items.map((function(t){var i;return null!==(i=null==t?void 0:t.clone())&&void 0!==i?i:null})),t},n[kX]=function(t,i){for(var n=new FJ(t,i,this,this._items,new Array(this._items.length).fill(0)),r=0;r<this._items.length;++r){var s=pQ(t,this._items[r].weight,0,n.setInput,n,r);n.setInput(s,r)}return n},r(i,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),i}(aQ),ZQ.Item=hJ,JQ=uo((QQ=ZQ).prototype,"_items",[eJ],(function(){return[]})),QQ));var uJ,oJ,cJ,aJ,fJ,vJ,lJ,dJ,wJ,gJ,pJ,_J,yJ,mJ,bJ,kJ,AJ,EJ,TJ,OJ,SJ,IJ,RJ,MJ,CJ,NJ,PJ,LJ,DJ,BJ,FJ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).doEval(),i}return e(i,t),i.prototype.eval=function(t,i){for(var n=t.length,r=0;r<n;++r)t[r]=i[r]},i}(fQ),UJ=_o("cc.JointMask")((oJ=function(){this.path=cJ&&cJ(),this.enabled=aJ&&aJ()},cJ=uo(oJ.prototype,"path",[Co],(function(){return""})),aJ=uo(oJ.prototype,"enabled",[Co],(function(){return!0})),uJ=oJ))||uJ,xJ=(fJ=_o(Vj+"AnimationMask"),vJ=ic(UJ),fJ((dJ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._jointMasks=wJ&&wJ(),i}e(i,t);var n=i.prototype;return n.addJoint=function(t,i){this.removeJoint(t);var n=new UJ;n.path=t,n.enabled=i,this._jointMasks.push(n)},n.removeJoint=function(t){ci(this._jointMasks,(function(i){return i.path===t}))},n.clear=function(){this._jointMasks.length=0},n.filterDisabledNodes=function(t){for(var i=this._jointMasks,n=i.length,r=new Set,s=0;s<n;++s){var e=i[s],h=e.path;if(!e.enabled){var u=t.getChildByPath(h);u&&r.add(u)}}return r},n.isExcluded=function(t){var i,n;return!(null===(i=null==(n=this._jointMasks.find((function(i){return i.path===t})))?void 0:n.enabled)||void 0===i||i)},r(i,[{key:"joints",get:function(){return this._jointMasks},set:function(t){this.clear();for(var i,n=w(t);!(i=n()).done;){var r=i.value;this.addJoint(r.path,r.enabled)}}}]),i}(rg),wJ=uo(dJ.prototype,"_jointMasks",[Co],(function(){return[]})),y(dJ.prototype,"joints",[vJ],Object.getOwnPropertyDescriptor(dJ.prototype,"joints"),dJ.prototype),lJ=dJ))||lJ),GJ=_o(Vj+"ClipOverrideEntry")((_J=function(){this.original=yJ&&yJ(),this.substitution=mJ&&mJ()},yJ=uo(_J.prototype,"original",[Co],(function(){return null})),mJ=uo(_J.prototype,"substitution",[Co],(function(){return null})),pJ=_J))||pJ,jJ=(bJ=_o(Vj+"AnimationGraphVariant"),kJ=ic(bX),bJ((EJ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._graph=TJ&&TJ(),i._clipOverrides=OJ&&OJ(),i}return e(i,t),r(i,[{key:"original",get:function(){return this._graph},set:function(t){this._graph=t}},{key:"clipOverrides",get:function(){return this._clipOverrides}}]),i}(az),y(EJ.prototype,"original",[kJ],Object.getOwnPropertyDescriptor(EJ.prototype,"original"),EJ.prototype),TJ=uo(EJ.prototype,"_graph",[Co],(function(){return null})),OJ=uo(EJ.prototype,"_clipOverrides",[Co],(function(){return new HJ})),AJ=EJ))||AJ),HJ=_o(Vj+"ClipOverrideMap")((gJ=Symbol.iterator,IJ=function(){function t(){this._entries=RJ&&RJ()}var i=t.prototype;return i[gJ]=function(){return this._entries[Symbol.iterator]()},i.has=function(t){return!!this._entries.find((function(i){return i.original===t}))},i.get=function(t){var i=this._entries.find((function(i){return i.original===t}));return null==i?void 0:i.substitution},i.set=function(t,i){var n=this._entries.find((function(i){return i.original===t}));if(n)n.substitution=i;else{var r=new GJ;r.original=t,r.substitution=i,this._entries.push(r)}},i.delete=function(t){ci(this._entries,(function(i){return i.original===t}))},i.clear=function(){this._entries.length=0},r(t,[{key:"size",get:function(){return this._entries.length}}]),t}(),RJ=uo(IJ.prototype,"_entries",[Co],(function(){return[]})),SJ=IJ))||SJ,VJ="i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes/",$J=VJ+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_blend/",zJ={listEntries:function(t){return[].concat(t.animationGraph.layers[t.layerIndex].stashes()).map((function(t){var i=t[0];return{arg:i,menu:i}}))},create:function(t){var i=new WJ;return i.stashName=t,i}},WJ=_o(Vj+"PoseNodeUseStashedPose")(MJ=Mz(VJ)(MJ=Cz(zJ)(MJ=Pz({inline:!0})((CJ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).stashName=NJ&&NJ(),i.$T=void 0,i}e(i,t);var n=i.prototype;return n.bind=function(t){var i=this.stashName;if(i){var n=t.stashView.bindStash(i);this.$T=n}},n.settle=function(){},n.reenter=function(){var t;null==(t=this.$T)||t.reenter()},n.doUpdate=function(t){var i;null==(i=this.$T)||i.requestUpdate(t)},n.doEvaluate=function(t){var i,n;return null!==(i=null==(n=this.$T)?void 0:n.evaluate(t))&&void 0!==i?i:t.pushDefaultedPose()},i}(Xz),NJ=uo(CJ.prototype,"stashName",[Co],(function(){return""})),MJ=CJ))||MJ)||MJ)||MJ)||MJ,XJ=Co;_o(Vj+"UnaryCondition")((BJ=function(){function t(){this.operator=LJ&&LJ(),this.operand=DJ&&DJ()}var i=t.prototype;return i.clone=function(){var i=new t;return i.operator=this.operator,i.operand=this.operand.clone(),i},i[kX]=function(t){var i=this.operator,n=this.operand,r=new iZ(i,!1),s=pQ(t,n,1,r.setOperand,r);return r.reset(s),r},t}(),BJ.Operator={TRUTHY:0,FALSY:1},LJ=uo((PJ=BJ).prototype,"operator",[XJ],(function(){return 0})),DJ=uo(PJ.prototype,"operand",[XJ],(function(){return new gQ})),PJ));var YJ,KJ,qJ,QJ,JJ,ZJ,tZ,iZ=function(){function t(t,i){this.zT=t,this.WT=i,this.OT()}var i=t.prototype;return i.reset=function(t){this.setOperand(t)},i.setOperand=function(t){this.WT=t,this.OT()},i.eval=function(){return this.zd},i.OT=function(){var t=this.WT;switch(this.zT){default:case 0:this.zd=!!t;break;case 1:this.zd=!t}},t}(),nZ=function(){},rZ=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return function(){}},sZ=Co,eZ=_o(Vj+"TCVariableBinding")(YJ=rZ(0,3)((KJ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).type=qJ&&qJ(),i.variableName=QJ&&QJ(),i}e(i,t);var n=i.prototype;return n.getValueType=function(){return this.type},n.bind=function(t){var i=t.getVar(this.variableName);if(i)return new hZ(i)},i}(nZ),qJ=uo(KJ.prototype,"type",[sZ,Po],(function(){return 0})),QJ=uo(KJ.prototype,"variableName",[sZ],(function(){return""})),YJ=KJ))||YJ)||YJ,hZ=function(){function t(t){this.XT=t}return t.prototype.evaluate=function(){return this.XT.value},t}(),uZ=Co;_o(Vj+"TCAuxiliaryCurveBinding")(JJ=rZ(0)((ZJ=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).curveName=tZ&&tZ(),i}e(i,t);var n=i.prototype;return n.getValueType=function(){return 0},n.bind=function(t){var i=t.getEvaluationTimeAuxiliaryCurveView();return new cZ(i,this.curveName)},i}(nZ),tZ=uo(ZJ.prototype,"curveName",[uZ],(function(){return""})),JJ=ZJ))||JJ);var oZ,cZ=function(){function t(t,i){this.Os=t,this.YT=i}return t.prototype.evaluate=function(){return this.Os.get(this.YT)},t}();_o(Vj+"TCStateWeightBinding")(oZ=rZ(0)(oZ=void(oZ=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.getValueType=function(){return 0},n.bind=function(){return new fZ},i}(nZ))||oZ)||oZ);var aZ,fZ=function(){function t(){}return t.prototype.evaluate=function(t){return t.sourceStateWeight},t}();_o(Vj+"TCStateMotionTimeBinding")(aZ=rZ(0)(aZ=void(aZ=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.getValueType=function(){return 0},n.bind=function(){return new _Z},i}(nZ))||aZ)||aZ);var vZ,lZ,dZ,wZ,gZ,pZ,_Z=function(){function t(){}return t.prototype.evaluate=function(t){return t.sourceStateMotionTimeNormalized},t}(),yZ=Co;_o(Vj+"BinaryCondition")((pZ=function(){function t(){this.operator=lZ&&lZ(),this.lhs=dZ&&dZ(),this.lhsBinding=wZ&&wZ(),this.rhs=gZ&&gZ()}var i=t.prototype;return i.clone=function(){var i=new t;return i.operator=this.operator,i.lhs=this.lhs,i.lhsBinding=B$(this.lhsBinding),i.rhs=this.rhs,i},i[kX]=function(t){var i,n=null==(i=this.lhsBinding)?void 0:i.bind(t);return new EZ(this.operator,this.lhs,this.rhs,n)},t}(),pZ.Operator={EQUAL_TO:0,NOT_EQUAL_TO:1,LESS_THAN:2,LESS_THAN_OR_EQUAL_TO:3,GREATER_THAN:4,GREATER_THAN_OR_EQUAL_TO:5},lZ=uo((vZ=pZ).prototype,"operator",[yZ],(function(){return 0})),dZ=uo(vZ.prototype,"lhs",[yZ],(function(){return 0})),wZ=uo(vZ.prototype,"lhsBinding",[yZ],(function(){return new eZ})),gZ=uo(vZ.prototype,"rhs",[yZ],(function(){return 0})),vZ));var mZ,bZ,kZ,AZ,EZ=function(){function t(t,i,n,r){this.zT=t,this.KT=r,this.qT=i,this.QT=n}return t.prototype.eval=function(t){var i,n,r=null!==(i=null==(n=this.KT)?void 0:n.evaluate(t))&&void 0!==i?i:this.qT,s=this.QT;switch(this.zT){default:case 0:return r===s;case 1:return r!==s;case 2:return r<s;case 3:return r<=s;case 4:return r>s;case 5:return r>=s}},t}(),TZ=Co,OZ=_o(Vj+"TriggerCondition")((bZ=function(){function t(){this.trigger=kZ&&kZ()}var i=t.prototype;return i.clone=function(){var i=new t;return i.trigger=this.trigger,i},i[kX]=function(t){var i=new SZ(!1),n=t.getVar(this.trigger);return _Q(n,this.trigger)&&(mQ(n.type,this.trigger),i.setTrigger(n.bind(i.setTrigger,i))),i},t}(),kZ=uo(bZ.prototype,"trigger",[TZ],(function(){return""})),mZ=bZ))||mZ,SZ=function(){function t(t){this.JT=!1,this.JT=t}var i=t.prototype;return i.setTrigger=function(t){this.JT=t},i.eval=function(){return this.JT},t}(),IZ=_o(Vj+"StateMachineComponent")(AZ=function(){function t(){}var i=t.prototype;return i.onMotionStateEnter=function(){},i.onMotionStateExit=function(){},i.onMotionStateUpdate=function(){},i.onStateMachineEnter=function(){},i.onStateMachineExit=function(){},t}())||AZ,RZ=10,MZ=Ir.fromArray,CZ=Ir.toArray,NZ=Qr.fromArray,PZ=Qr.toArray,LZ=function(){function t(t,i,n){this.M=void 0,this.M=void 0===t?new Float64Array:"number"==typeof t?new Float64Array(RZ*t):new Float64Array(t,i,"number"==typeof n?RZ*n:void 0)}var i=t.prototype;return i.getTransform=function(t,i){var n=this.M,r=i.position,s=i.rotation,e=i.scale,h=RZ*t;return MZ(r,n,h),NZ(s,n,h+3),MZ(e,n,h+7),i},i.getPosition=function(t,i){var n=this.M;return MZ(i,n,RZ*t),i},i.getRotation=function(t,i){var n=this.M;return NZ(i,n,RZ*t+3),i},i.getScale=function(t,i){var n=this.M;return MZ(i,n,RZ*t+7),i},i.setTransform=function(t,i){var n=this.M,r=i.position,s=i.rotation,e=i.scale,h=RZ*t;CZ(n,r,h),PZ(n,s,h+3),CZ(n,e,h+7)},i.setPosition=function(t,i){var n=this.M;CZ(n,i,RZ*t)},i.setRotation=function(t,i){var n=this.M;PZ(n,i,RZ*t+3)},i.setScale=function(t,i){var n=this.M;CZ(n,i,RZ*t+7)},i.copyWithin=function(t,i,n){this.M.copyWithin(t*RZ,i*RZ,"number"==typeof n?n*RZ:void 0)},i.fill=function(t,i,n){var r,s,e=this.length;if(null!==(r=i)&&void 0!==r||(i=0),null!==(s=n)&&void 0!==s||(n=e),!(i>=e)){this.setTransform(i,t);for(var h=i+1;h<n;++h)this.copyWithin(h,i,i+1)}},i.fillZero=function(t,i){this.M.fill(0,"number"==typeof t?t*RZ:void 0,"number"==typeof i?i*RZ:void 0)},i.set=function(t,i){this.M.set(t.M,"number"==typeof i?i*RZ:void 0)},i.slice=function(i,n){var r=this.M.slice("number"==typeof i?i*RZ:void 0,"number"==typeof n?n*RZ:void 0);return new t(r.buffer,r.byteOffset,r.length/RZ)},i.copyRange=function(t,i,n,r){for(var s=RZ*r,e=this.M,h=RZ*t,u=i.M,o=RZ*n,c=0;c<s;++c)e[h+c]=u[o+c]},r(t,[{key:"buffer",get:function(){return this.M.buffer}},{key:"byteLength",get:function(){return this.M.byteLength}},{key:"byteOffset",get:function(){return this.M.byteOffset}},{key:"length",get:function(){return this.M.length/RZ}}],[{key:"BYTES_PER_ELEMENT",get:function(){return 80}}]),t}(),DZ=Symbol(""),BZ=Symbol(""),FZ=function(t){this.buffer=void 0,this.useCount=0,this.buffer=new ArrayBuffer(t)},UZ=function(){function t(t,i){this.ZT=!1,this.tO=[],this.iO=0,this.nO=t,this.rO=i}var i=t.prototype;return i.debugLock=function(){this.ZT,this.ZT=!0},i.debugUnlock=function(){this.ZT,this.ZT=!1},i.getPageMemory=function(t){return t>=0&&this.tO.length,this.tO[t].buffer},i.pushPage=function(t){var i=t[DZ];this.tO.length,i===this.tO.length&&this.sO(),this.tO.length;var n=this.tO[i];return++n.useCount,++t[DZ],n},i.popPage=function(t){var i=t[DZ]-1,n=this.tO[i];n.useCount,--n.useCount,--t[DZ],0===n.useCount&&(this.tO.length,this.tO.pop())},i.createAllocator=function(t){var i=new GZ(this,t);return++this.iO,i},i.destroyAllocator=function(t){for(var i=t[DZ],n=0;n<i;++n){var r=this.tO[n];r.useCount,--r.useCount}this.iO,--this.iO,0===this.iO&&this.nO[BZ](this)},i.sO=function(){var t=new FZ(this.rO);this.tO.push(t)},r(t,[{key:"pageSize",get:function(){return this.rO}},{key:"debugLocking",get:function(){return this.ZT}},{key:"allocatorCount",get:function(){return this.iO}}]),t}(),xZ=function(t,i){this.buffer=t,this.byteOffset=i},GZ=function(){function t(t,i){this[DZ]=0,this.eO=0,this.hO=[],this.uO=t,this.oO=i;var n=Math.floor(this.uO.pageSize/i);this.eO=n}var i=t.prototype;return i.destroy=function(){this.hO.length,this.uO.debugLocking,this.uO.destroyAllocator(this)},i.debugLock=function(){this.uO.debugLock()},i.debugUnlock=function(){this.uO.debugUnlock()},i.push=function(){var t=this.oO,i=this.hO,n=this.eO,r=i.length,s=0,e=0;0===t?(0===this[DZ]&&this.uO.pushPage(this),this[DZ]):(r===n*this[DZ]&&(this.uO.pushPage(this),this[DZ]),e=(r-(s=r%n))/n,this[DZ]);var h=this.uO.getPageMemory(e),u=new xZ(h,t*s);return this.hO.push(u),u},i.pop=function(){var t=this.hO,i=this.eO,n=t.length-1;0===this.oO?(this[DZ],0===n&&this.uO.popPage(this)):0==n%i&&this.uO.popPage(this),this.hO.pop()},r(t,[{key:"isEmpty",get:function(){return 0===this.hO.length}}]),t}(),jZ=function(){function t(t){this.ao=new Map,this.CT=t,t.every((function(t,i,n){return 0===i||t>n[i-1]}))}var i=t.prototype;return i.createAllocator=function(t){var i=t,n=this.cO(i),r=this.ao.get(n);return r||(r=new UZ(this,n),this.ao.set(n,r)),r.createAllocator(i)},i[BZ]=function(t){for(var i,n=w(this.ao);!(i=n()).done;){var r=i.value,s=r[0];if(r[1]===t){this.ao.delete(s);break}}},i.cO=function(t){var i=io(this.CT,t),n=t;return i>=0?n=this.CT[i]:(i=~i)===this.CT.length||(i>=0&&this.CT.length,n=this.CT[i]),n},r(t,[{key:"isEmpty",get:function(){return 0===this.ao.size}}]),t}(),HZ=function(){function t(t,i){this.fO=[],this.vO=0,this.lO=void 0,this.dO=t,this.wO=i;var n=VZ(t,i,1);this.lO=$Z.createAllocator(n)}var i=t.prototype;return i.destroy=function(){this.vO;for(var t=0;t<this.fO.length;++t)this.lO.pop();return this.fO.length=0,this.lO.destroy()},i.push=function(){0===this.vO&&this.lO.debugLock(),this.vO===this.fO.length&&(this.gO(),this.vO,this.fO.length);var t=this.fO[this.vO];return++this.vO,t},i.pop=function(){this.vO,--this.vO,0===this.vO&&this.lO.debugUnlock()},i.gO=function(){var t=this.lO.push(),i=LZ.BYTES_PER_ELEMENT*this.dO,n=t.byteOffset,r=new LZ(t.buffer,n,this.dO),s=new Float64Array(t.buffer,n+i,this.wO),e=qK._create(r,s);this.fO.push(e)},r(t,[{key:"allocatedCount",get:function(){return this.vO}},{key:"top",get:function(){return this.vO,this.fO[this.vO-1]}}]),t}();function VZ(t,i,n){return(LZ.BYTES_PER_ELEMENT*t+8*i)*n}var $Z=new jZ([VZ(128,10,4)]);function zZ(t,i){for(var n=t.length,r=0;r<n&&i(t[r],r,t);++r);if(r===n)return n;for(var s=r,e=r+1;e<n;++e){var h=t[e];if(i(h,e,t)){var u=h;t[e]=t[s],t[s]=u,++s}}return s}var WZ,XZ,YZ,KZ,qZ,QZ,JZ,ZZ,t0=Symbol("PoseHeapAllocator"),i0=function(){function t(t,i){this.dO=0,this.pO=0,this.tO=[],this.vO=0,this._O=0,this.dO=t,this.pO=i}var i=t.prototype;return i.allocatePose=function(){++this.vO;for(var t=this.tO,i=t.length,n=this._O;n<i;++n){var r=t[n],s=r.tryAllocate();if(s)return s[t0].pageIndex=n,0===r.freeCount&&++this._O,s}var e=this.yO();return this._O=e[t0].pageIndex,e},i.destroyPose=function(t){var i=this.tO;i.length;var n=t[t0].pageIndex,r=i[n];r.deallocate(t),--this.vO,n<this._O&&(r.freeCount,this._O=n)},i.yO=function(){var t=new e0(this.dO,this.pO,4),i=this.tO.length;this.tO.push(t);var n=t.tryAllocate();return n[t0].pageIndex=i,n},r(t,[{key:"allocatedCount",get:function(){return this.vO}}]),t}(),n0=function(){function t(){this.ps=-1}return r(t,[{key:"pageIndex",get:function(){return this.ps>>s0},set:function(t){this.ps&=r0,this.ps|=t<<s0}},{key:"poseIndex",get:function(){return this.ps&r0},set:function(t){this.ps&=-8,this.ps|=t}}]),t}(),r0=7,s0=3,e0=function(){function t(t,i,n){this.Ts=void 0,this.mO=15,this.fO=void 0,this.kO=0,this.dO=t,this.pO=i,this.AO=n;var r=(LZ.BYTES_PER_ELEMENT*t+8*i)*n;this.Ts=new ArrayBuffer(r),this.fO=new Array(n).fill(null),this.kO=n}var i=t.prototype;return i.tryAllocate=function(){var t,i=this.fO,n=this.mO,r=this.AO,s=h0(n);if(s>=r)return null;s>=0&&i.length;var e=null!==(t=i[s])&&void 0!==t?t:i[s]=this.EO(s);return e[t0].poseIndex=s,this.mO&=~(1<<s),this.kO,--this.kO,e},i.deallocate=function(t){var i=this.fO,n=t[t0].poseIndex;n>=0&&i.length,i[n],this.mO|=1<<n,this.kO,this.AO,++this.kO},i.EO=function(t){var i=LZ.BYTES_PER_ELEMENT*this.dO,n=(i+8*this.pO)*t,r=new LZ(this.Ts,n,this.dO),s=new Float64Array(this.Ts,n+i,this.pO),e=qK._create(r,s);return e[t0]=new n0,e},r(t,[{key:"capacity",get:function(){return this.AO}},{key:"freeCount",get:function(){return this.kO}}]),t}();function h0(t){return 0===t?1/0:Math.log2(t&-t)}function u0(t,i){if(t.name===i)return t;for(var n=t.children.length,r=0;r<n;++r){var s=u0(t.children[r],i);if(s)return s}return null}var o0=function(){function t(t,i,n,r){var s=this;this.TO=void 0,this.OO=void 0,this.SO=void 0,this.IO=[],this.RO=function(t){return s.MO(t)},this.CO=!1,this.PO=void 0,this.LO=void 0,this.DO=void 0,this.BO=r,this.TO=t,this.OO=i,this.SO=n,this.IO=[!1]}var i=t.prototype;return i.bindTransform=function(t){var i=this.TO.getChildByPath(t);return i?this.OO.getOrCreateTransformBinding(i):null},i.bindTransformByName=function(t){var i=u0(this.TO,t);return i?this.OO.getOrCreateTransformBinding(i):null},i.getBoneChildren=function(t){var i=u0(this.TO,t);return i?i.children.map((function(t){return t.name})):[]},i.getParentBoneNameByName=function(t){var i,n=u0(this.TO,t);return n?n===this.TO?"":null==(i=n.parent)?void 0:i.name:null},i.bindAuxiliaryCurve=function(t){return this.OO.getOrCreateAuxiliaryCurveBinding(t)},i.getEvaluationTimeAuxiliaryCurveView=function(){return this.OO.auxiliaryCurveRegistry},i.getVar=function(t){return this.SO[t]},i._pushAdditiveFlag=function(t){this.IO.push(t)},i._popAdditiveFlag=function(){this.IO.length,this.IO.pop()},i._integrityCheck=function(){return 1===this.IO.length},i._setLayerWideContextProperties=function(t,i){this.CO,this.CO=!0,this.PO=t,this.LO=i},i._unsetLayerWideContextProperties=function(){this.CO,this.CO=!1,this.PO=void 0,this.LO=void 0},i._setClipOverrides=function(t){this.DO=t},i.MO=function(t){var i=this.SO[t];i&&(i.value=!1)},r(t,[{key:"origin",get:function(){return this.TO}},{key:"controller",get:function(){return this.BO}},{key:"triggerResetter",get:function(){return this.RO}},{key:"clipOverrides",get:function(){return this.DO}},{key:"additive",get:function(){var t=this.IO;return t[t.length-1]}},{key:"stashView",get:function(){return this.PO,this.PO}},{key:"motionSyncManager",get:function(){return this.LO,this.LO}}]),t}(),c0=new HK,a0=function(){function t(){this.FO=new Map}var i=t.prototype;return i.names=function(){return this.FO.keys()},i.has=function(t){return this.FO.has(t)},i.get=function(t){var i;return null!==(i=this.FO.get(t))&&void 0!==i?i:0},i.set=function(t,i){this.FO.set(t,i)},t}(),f0=(WZ=function(){},XZ=function(){},YZ=function(){},KZ=function(){},qZ=function(){},QZ=function(){},JZ=function(){},ZZ=function(){function t(t,i){this.TO=void 0,this.UO=void 0,this.xO=[],this.jO=[],this.HO=[],this.VO=!1,this.$O=-1,this.zO=-1,this.TO=t,this.UO=i}var i=t.prototype;return i.getOrCreateTransformBinding=function(t){for(var i=this.TO,n=!1,r=t;r;r=r.parent)if(r===i){n=!0;break}if(!n)return null;var s=this._getOrCreateTransformBinding(t);if(t!==i)for(var e=t.parent;e!==i;e=e.parent)this._getOrCreateTransformBinding(e);return s},i._getOrCreateTransformBinding=function(t){var i=this.jO,n=i.findIndex((function(i){return i.node===t}));if(n>=0){var r=i[n];return++r.refCount,r.handle}for(var s=0,e=function(t){var n=i.findIndex((function(i){return i.node===t}));if(n>=0)return s=n+1,1},h=t.parent;h&&!e(h);h=h.parent);for(var u=s;u<i.length;++u)++i[u].handle.index;var o=new v0(new D0(this,s),t);return i.splice(s,0,o),o.handle},i.getOrCreateAuxiliaryCurveBinding=function(t){var i=this.xO,n=i.findIndex((function(i){return i.name===t}));if(n>=0){var r=i[n];return++r.refCount,r.handle}var s=i.length,e=new l0(new B0(this,s),t);return i.push(e),e.handle},i.createEvaluationContext=function(){return this.VO,new L0(this.transformCount,this.auxiliaryCurveCount,this.HO.slice(),this.TO)},i.resetPoseStashAllocator=function(t){this.VO,t._reset(this.transformCount,this.auxiliaryCurveCount)},i.createTransformFilter=function(t){for(var i,n=this.TO,r=[],s=w(this.jO);!(i=s()).done;){var e=i.value,h=e.node,u=e.handle,o=c(n,h);if(void 0===o)X(h.getPathInHierarchy()+" is not a child of "+n.getPathInHierarchy());else if(t.isExcluded(o))continue;r.push(u.index)}return r.sort(),new QK(r);function c(t,i){for(var n=[],r=i;r;r=r.parent){if(r===t)return n.join("/");n.unshift(r.name)}}},i.fetchDefaultTransforms=function(t){var i=this.jO.length;t.length;for(var n=0;n<i;++n){var r=this.jO[n].defaultTransform;t.setTransform(n,r)}},i.apply=function(t){var i=t.transforms,n=t.auxiliaryCurves,r=this.jO.length;i.length;for(var s=0;s<r;++s){var e=i.getTransform(s,c0);this.jO[s].node.setRTS(e.rotation,e.position,e.scale)}for(var h=this.xO.length,u=0;u<h;++u){var o=this.xO[u].name,c=n[u];this.UO.set(o,c)}},i._destroyTransformHandle=function(t){t>=0&&this.jO.length;var i=this.jO[t];i.refCount,--i.refCount},i._destroyAuxiliaryCurveHandle=function(t){t>=0&&this.xO.length;var i=this.xO[t];i.refCount,--i.refCount},i.startBind=function(){this.VO=!0,this.$O=this.jO.length,this.zO=this.xO.length},i.endBind=function(){var t=this.jO,i=this.xO,n=0;if(d0(t),t.length!==this.$O){n|=1;for(var r=t.length,s=0;s<r;++s)t[s].order=s}else{for(var e=t.length,h=!1,u=0;u<e;++u){var o=t[u];o.order!==u&&(h=!0,o.order=u)}h&&(n|=2)}d0(i),i.length!==this.zO&&(n|=4);var c=this.HO,a=this.TO;c.length=t.length;for(var f=function(){var i=t[v].node;if(i===a)return c[v]=-1,1;var n=i.parent;if(n===a){var r=t.findIndex((function(t){return t.node===n}));c[v]=r>=0?r:-1}else{var s=t.findIndex((function(t){return t.node===n}));c[v]=s}},v=0;v<t.length;++v)f();return this.VO=!1,n},r(t,[{key:"transformCount",get:function(){return this.jO.length}},{key:"auxiliaryCurveCount",get:function(){return this.xO.length}},{key:"auxiliaryCurveRegistry",get:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(){return this.UO}))}]),t}(),y(ZZ.prototype,"getOrCreateTransformBinding",[WZ],Object.getOwnPropertyDescriptor(ZZ.prototype,"getOrCreateTransformBinding"),ZZ.prototype),y(ZZ.prototype,"_getOrCreateTransformBinding",[XZ],Object.getOwnPropertyDescriptor(ZZ.prototype,"_getOrCreateTransformBinding"),ZZ.prototype),y(ZZ.prototype,"getOrCreateAuxiliaryCurveBinding",[YZ],Object.getOwnPropertyDescriptor(ZZ.prototype,"getOrCreateAuxiliaryCurveBinding"),ZZ.prototype),y(ZZ.prototype,"_destroyTransformHandle",[KZ],Object.getOwnPropertyDescriptor(ZZ.prototype,"_destroyTransformHandle"),ZZ.prototype),y(ZZ.prototype,"_destroyAuxiliaryCurveHandle",[qZ],Object.getOwnPropertyDescriptor(ZZ.prototype,"_destroyAuxiliaryCurveHandle"),ZZ.prototype),y(ZZ.prototype,"startBind",[QZ],Object.getOwnPropertyDescriptor(ZZ.prototype,"startBind"),ZZ.prototype),y(ZZ.prototype,"endBind",[JZ],Object.getOwnPropertyDescriptor(ZZ.prototype,"endBind"),ZZ.prototype),ZZ),v0=function(t,i){this.order=-1,this.refCount=1,this.handle=void 0,this.node=void 0,this.defaultTransform=void 0,this.handle=t,this.node=i;var n=new HK;n.position=i.position,n.rotation=i.rotation,n.scale=i.scale,this.defaultTransform=n},l0=function(t,i){this.refCount=1,this.handle=void 0,this.name=void 0,this.handle=t,this.name=i};function d0(t){var i=zZ(t,(function(t){return t.refCount,t.refCount>0}));if(t.length,i!==t.length){for(var n=0;n<i;++n)t[n].handle.index=n;t.splice(i,t.length-i)}}var w0,g0,p0,_0,y0,m0,b0,k0,A0,E0,T0,O0,S0,I0,R0,M0=Symbol("[[DefaultTransforms]]"),C0=function(){function t(t){this.OO=t}return t.prototype.createTransformFilter=function(t){return this.OO.createTransformFilter(t)},r(t,[{key:"transformCount",get:function(){return this.OO.transformCount}}]),t}(),N0=new HK,P0=new HK,L0=function(){function t(t,i,n,r){this[M0]=void 0,this.WO=void 0,this.HO=void 0,this.XO=void 0,this.YO=new HK,this.WO=new HZ(t,i),this.HO=n,this.XO=r,this[M0]=new LZ(t)}var i=t.prototype;return i.destroy=function(){this.WO.destroy()},i.pushDefaultedPose=function(){var t=this.WO.push();return t.transforms.set(this[M0]),t._poseTransformSpace=0,t.auxiliaryCurves.fill(0),t},i.pushDefaultedPoseInComponentSpace=function(){var t=this.pushDefaultedPose();return this._poseTransformsSpaceLocalToComponent(t),t},i.pushZeroDeltaPose=function(){var t=this.WO.push();return t.transforms.fill(KK),t._poseTransformSpace=0,t.auxiliaryCurves.fill(0),t},i.pushDuplicatedPose=function(t){var i=this.WO.push();return i.transforms.set(t.transforms),i._poseTransformSpace=t._poseTransformSpace,i.auxiliaryCurves.set(t.auxiliaryCurves),i},i.popPose=function(){this.WO.pop()},i._isStackTopPose_debugging=function(t){return t===this.WO.top},i._poseTransformsSpaceLocalToComponent=function(t){for(var i=t.transforms,n=i.length,r=0;r<n;++r){var s=this.HO[r];if(!(s<0)){var e=i.getTransform(r,N0),h=i.getTransform(s,P0);HK.multiply(e,h,e),i.setTransform(r,e)}}t._poseTransformSpace=1},i._poseTransformsSpaceComponentToLocal=function(t){for(var i=t.transforms,n=i.length-1;n>=0;--n){var r=this.HO[n];if(!(r<0)){var s=i.getTransform(n,N0),e=i.getTransform(r,P0);HK.calculateRelative(s,s,e),i.setTransform(n,s)}}t._poseTransformSpace=0},i._convertPoseSpaceTransformToTargetSpace=function(t,i,n,r){var s=n._poseTransformSpace;switch(i){default:break;case 0:1===s?HK.multiply(t,this.KO(),t):HK.multiply(t,this.qO(P0,n,r),t);break;case 1:1===s||HK.multiply(t,this.QO(P0,n,r),t);break;case 2:if(1===s){var e=this.HO[r];if(e>=0){var h=n.transforms.getTransform(e,P0),u=HK.invert(h,h);HK.multiply(t,u,t)}}break;case 3:var o=n.transforms.getTransform(r,P0),c=HK.invert(o,o);HK.multiply(t,c,t)}return t},i._convertTransformToPoseTransformSpace=function(t,i,n,r){var s=n._poseTransformSpace;switch(i){default:break;case 0:if(1===s){var e=HK.invert(P0,this.KO());HK.multiply(t,e,t)}else{var h=this.qO(P0,n,r),u=HK.invert(h,h);HK.multiply(t,u,t)}break;case 1:if(1===s);else{var o=this.QO(P0,n,r),c=HK.invert(o,o);HK.multiply(t,c,t)}break;case 2:if(1===s){var a=this.HO[r];if(a>=0){var f=n.transforms.getTransform(a,P0);HK.multiply(t,f,t)}}break;case 3:var v=n.transforms.getTransform(r,P0);HK.multiply(t,v,t)}return t},i.KO=function(){var t=this.YO,i=this.XO;return t.position=i.worldPosition,t.rotation=i.worldRotation,t.scale=i.worldScale,t},i.QO=function(t,i,n){var r=this.HO;HK.setIdentity(t);for(var s=r[n];s>=0;s=r[s]){var e=i.transforms.getTransform(s,N0);HK.multiply(t,e,t)}return t},i.qO=function(t,i,n){return this.QO(t,i,n),HK.multiply(t,this.KO(),t),t},r(t,[{key:"allocatedPoseCount",get:function(){return this.WO.allocatedCount}},{key:"parentTable",get:function(){return this.HO}},{key:"_stackSize_debugging",get:function(){return this.WO.allocatedCount}}]),t}(),D0=function(){function t(t,i){this.index=-1,this.MT=void 0,this.MT=t,this.index=i}return t.prototype.destroy=function(){this.MT._destroyTransformHandle(this.index)},t}(),B0=function(){function t(t,i){this.index=-1,this.MT=void 0,this.MT=t,this.index=i}return t.prototype.destroy=function(){this.MT._destroyAuxiliaryCurveHandle(this.index)},t}(),F0=function(){function t(){this.Gs={deltaTime:0,indicativeWeight:0}}var i=t.prototype;return i.generate=function(t,i){return this.Gs.deltaTime=t,this.Gs.indicativeWeight=i,this.Gs},i.forkSubWeight=function(t,i){this.Gs.deltaTime=t.deltaTime,this.Gs.indicativeWeight=t.indicativeWeight*i},t}(),U0=function(){function t(){this.JO=null}var i=t.prototype;return i._reset=function(t,i){this.JO=new i0(t,i)},i.allocatePose=function(){return this.JO,this.JO.allocatePose()},i.destroyPose=function(t){return this.JO,this.JO.destroyPose(t)},r(t,[{key:"allocatedPoseCount",get:function(){return this.JO,this.JO.allocatedCount}}]),t}(),x0=_o(Vj+"MotionSyncInfo")((g0=function(){this.group=p0&&p0()},p0=uo(g0.prototype,"group",[Co],(function(){return""})),w0=g0))||w0;function G0(t){return{listEntries:function(){return[{arg:{type:"clip-motion"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_clip_motion"},{arg:{type:"animation-blend-1d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_1d"},{arg:{type:"animation-blend-2d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_2d"}]},create:function(i){var n=null;switch(i.type){case"clip-motion":n=new rQ;break;case"animation-blend-1d":n=new SQ;break;case"animation-blend-2d":n=new iJ}return t(n)}}}var j0=1e-5,H0=(_0=_o(Vj+"PoseNodePlayMotion"),y0=Mz(VJ),m0=Cz(G0((function(t){var i=new H0;return i.motion=t,i}))),b0=Pz({themeColor:"#227F9B"}),k0=qz({type:0}),A0=qz({type:0}),_0(E0=y0(E0=m0(E0=b0((T0=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).motion=O0&&O0(),i.syncInfo=S0&&S0(),_(i,"startTime",I0,v(i)),_(i,"speedMultiplier",R0,v(i)),i.ZO=null,i.tS=void 0,i}e(i,t);var n=i.prototype;return n.bind=function(t){var i=this.motion;if(i){var n=i[kX](t,!1);n&&(this.ZO=new V0(n,n.createPort()),this.syncInfo.group&&(this.tS=t.motionSyncManager.register(this.syncInfo)))}},n.settle=function(){},n.reenter=function(){if(this.ZO){var t=this.tS,i=this.ZO.motionEval.duration;this._forceEvaluateEvaluation();var n=i<j0?0:jn(this.startTime/i);t?t.notifyRenter(n):this.ZO.normalizedTime=n,this.ZO.lastIndicativeWeight=0}},n.doUpdate=function(t){if(this.ZO){var i=t.deltaTime,n=this.tS,r=this.ZO.motionEval.duration,s=0;r>j0&&(s=i*this.speedMultiplier/r),n?n.notifyUpdate(s,t.indicativeWeight):this.ZO.normalizedTime+=s,this.ZO.lastIndicativeWeight=t.indicativeWeight}},n.doEvaluate=function(t){if(this.ZO){var i=this.tS?this.tS.getSyncedEnterTime():this.ZO.normalizedTime;return this.ZO.motionEvalPort.evaluate(i,t)}return t.pushDefaultedPose()},r(i,[{key:"lastIndicativeWeight",get:function(){var t,i;return null!==(t=null==(i=this.ZO)?void 0:i.lastIndicativeWeight)&&void 0!==t?t:0}},{key:"elapsedMotionTime",get:function(){var t,i;return null!==(t=null==(i=this.ZO)?void 0:i.normalizedTime)&&void 0!==t?t:0}}]),i}(Xz),O0=uo(T0.prototype,"motion",[Co],(function(){return new rQ})),S0=uo(T0.prototype,"syncInfo",[Co],(function(){return new x0})),I0=y(T0.prototype,"startTime",[Co,k0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R0=y(T0.prototype,"speedMultiplier",[Co,A0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),E0=T0))||E0)||E0)||E0)||E0),V0=function(t,i){this.normalizedTime=0,this.lastIndicativeWeight=0,this.motionEval=t,this.motionEvalPort=i};function $0(t){return t instanceof Xz||t instanceof Yz}var z0=function(){function t(t,i){this.iS=t,this.nS=i}var i=t.prototype;return i.bind=function(t){var i;null==(i=this.iS)||i.bind(t)},i.settle=function(t){var i;null==(i=this.iS)||i.settle(t)},i.reenter=function(){var t;null==(t=this.iS)||t.reenter()},i.update=function(t){var i;null==(i=this.iS)||i.update(t)},i.evaluate=function(t){var i,n;return null!==(i=null==(n=this.iS)?void 0:n.evaluate(t,1))&&void 0!==i?i:null},i.countMotionTime=function(){var t=this.nS;if(!t)return 0;for(var i=0,n=Number.NEGATIVE_INFINITY,r=0;r<t.length;++r){var s=t[r],e=s.elapsedMotionTime,h=s.lastIndicativeWeight;h>n&&(n=h,i=e)}return i},t}();function W0(t,i,n){void 0===n&&(n=!1);var r=t.outputNode,s=t.getShell(r).getBindings();if(s.length,0===s.length)return new z0(void 0,n?[]:void 0);var e=s[0];e.outputIndex,e.producer;var h=new Map,u=X0(t,e.producer,h,i);return new z0(u,n?Array.from(h.values()).filter((function(t){return t instanceof H0})):void 0)}function X0(t,i,n,r){var s=t.getShell(i),e=n.get(i);if(e)return e;var h=B$(i);"__callOnAfterDeserializeRecursive"in h&&h.__callOnAfterDeserializeRecursive(),h instanceof Yz&&h.link(r);for(var u,o=h,c=[],a=w(s.getBindings());!(u=a()).done;){var f=u.value,v=f.producer,l=f.outputIndex,d=f.inputPath;if($0(v)){var g=X0(t,v,n,r);if(g instanceof Xz)q0(o,d,g,l);else{var p=t1(o,d,g,l);p&&c.push(p)}}else W("There's a input bound to a node with unrecognized type.")}var _,y=new Y0(c);return o instanceof Xz?(o._setDependencyEvaluation(y),_=o):_=new K0(o,y),n.set(i,_),_}var Y0=function(){function t(t){this.rS=void 0,this.rS=t}return t.prototype.evaluate=function(){for(var t,i=w(this.rS);!(t=i()).done;)t.value.evaluate()},t}(),K0=function(){function t(t,i){this._outputs=void 0,this.lu=t,this.sS=i,this._outputs=new Array(t.outputCount)}var i=t.prototype;return i.getDefaultOutput=function(){return this.getOutput(0)},i.getOutput=function(t){return this._outputs[t]},i.evaluate=function(){var t=this.lu;this.sS.evaluate(),t.selfEvaluate(this._outputs)},r(t,[{key:"node",get:function(){return this.lu}},{key:"outputCount",get:function(){return this._outputs.length}}]),t}();function q0(t,i,n,r){var s=i[0],e=i[1],h=void 0===e?-1:e;if(s in t)if(0===r){var u=t[s];if(h<0)return null!==u?void W("Invalid binding: consumer node's input "+s+" should be leaved as evaluation before evaluation."):void(t[s]=n);Array.isArray(u)?h>=u.length?W("Invalid binding: consumer node's input "+s+" have length "+u.length+" but the binding specified "+h):null===u[h]?u[h]=n:W("Invalid binding: consumer node's input "+s+"["+h+"] should be leaved as null before evaluation"):W("Invalid binding: consumer node's input "+s+" should be an array.")}else W("Node "+n.toString()+" does not have specified output "+r+".");else W("Invalid binding: consumer node has no property "+s)}var Q0,J0=function(){function t(t,i,n,r){this.eS=t,this.hS=i,this.uS=n,this.oS=r}return t.prototype.evaluate=function(){this.uS.evaluate(),this.eS[this.hS]=this.uS.getOutput(this.oS)},t}(),Z0=function(){function t(t,i,n,r,s){this.eS=t,this.hS=i,this.cS=n,this.uS=r,this.oS=s}return t.prototype.evaluate=function(){this.uS.evaluate(),this.eS[this.hS][this.cS]=this.uS.getOutput(this.oS)},t}();function t1(t,i,n,r){var s=i[0],e=i[1],h=void 0===e?-1:e;if(s in t){var u=t[s];if(h<0)return new J0(t,s,n,r);if(Array.isArray(u)){if(!(h>=u.length))return new Z0(t,s,h,n,r);W("Invalid binding: consumer node's input "+s+" have length "+u.length+" but the binding specified "+h)}else W("Invalid binding: consumer node's input "+s+" should be an array.")}else W("Invalid binding: consumer node has no property "+s)}var i1=function(){function t(t,i,n){this.passthroughWeight=1,this.fS=[],this.vS=[],this.lS=void 0,this.dS=void 0,this.wS=void 0,this.gS=[],this.pS=[],this._S=C1.createPool(4),this.yS=new F0,this.mS=new M1,this.kS=!1,this.kS=n.additive,this.name=i,this.BO=n.controller;var r=this.AS(t,null,n,i),s=r.entry,e=r.exit;this.lS=s,this.dS=e,this.wS=s,s.increaseActiveReference(),this.MO=n.triggerResetter}var i=t.prototype;return i.settle=function(t){for(var i=this.vS,n=i.length,r=0;r<n;++r)i[r].settle(t)},i.reenter=function(){for(var t,i=w(this.pS);!(t=i()).done;){var n=t.value;n.destination.decreaseActiveReference(),this._S.free(n)}this.pS.length=0,this.lS.increaseActiveReference(),this.wS.decreaseActiveReference(),this.wS=this.lS},i.update=function(t){this.exited,this.ES(),this.TS(),this.SS(t.deltaTime),this.IS(t)},i.evaluate=function(t){return this.MS(t)||this.CS(t)},i.getCurrentStateStatus=function(){var t=this.wS;return 3===t.kind||5===t.kind?t.getStatus():null},i.getCurrentClipStatuses=function(){var t=this.wS;return 3===t.kind?t.getClipStatuses(t.absoluteWeight):s1},i.getCurrentTransition=function(t){var i=this.pS;if(0===i.length)return!1;var n=i[i.length-1],r=1===i.length?this.wS:i[i.length-2].destination,s=n.getAbsoluteDuration(r);return t.duration=s,t.time=n.normalizedElapsedTime*s,!0},i.getNextStateStatus=function(){var t=this.pS;if(0===t.length)return null;var i=t[t.length-1].destination;switch(i.kind){default:break;case 5:case 3:return i.getStatus()}return null},i.getNextClipStatuses=function(){var t,i=this.pS;if(0===i.length)return s1;var n=i[i.length-1],r=n.destination;return 3===r.kind&&null!==(t=r.getClipStatuses(n.destination.absoluteWeight))&&void 0!==t?t:s1},i.overrideClips=function(t){for(var i=this.fS,n=i.length,r=0;r<n;++r)i[r].overrideClips(t)},i.AS=function(t,i,n,r){for(var s,e,h,u=this,o=Array.from(t.states()),c=o.map((function(i){if(i instanceof oz){var r=new c1(i,n);return u.fS.push(r),r}if(i===t.entryState)return s=new S1(i,0,i.name);if(i===t.exitState)return h=new S1(i,1,i.name);if(i===t.anyState)return e=new S1(i,2,i.name);if(i instanceof fX)return new I1(i);if(i instanceof dX){var o=new R1(i,n);return u.vS.push(o),o}return null})),a={components:null,parent:i,entry:s,exit:h,any:e},f=0;f<o.length;++f){var v=c[f];v&&(v.stateMachine=a)}for(var l=o.map((function(t){if(t instanceof _X){var i=u.AS(t.stateMachine,a,n,r+"/"+t.name);return i.components=new o1(t),i}return null})),d=0;d<o.length;++d){var g=o[d],p=t.getOutgoings(g),_=void 0;if(g instanceof _X){var y=l[d];_=y.exit}else{var m=c[d];_=m}for(var b,k=function(){var t,i=b.value,r=i.to,s=o.findIndex((function(t){return t===i.to}));if(r instanceof _X)t=l[s].entry;else{var e=c[s];t=e instanceof c1?e.entry:e}var h={conditions:i.conditions.map((function(t){return t[kX](n)})),to:t,triggers:void 0,duration:0,normalizedDuration:!1,destinationStart:0,relativeDestinationStart:!1,exitCondition:0,exitConditionEnabled:!1,activated:!1,startEventBinding:void 0,endEventBinding:void 0};(cX(i)||i instanceof vX||i instanceof gX)&&(h.duration=i.duration,h.destinationStart=i.destinationStart,h.relativeDestinationStart=i.relativeDestinationStart,i.startEventBinding.isBound&&(h.startEventBinding=i.startEventBinding),i.endEventBinding.isBound&&(h.endEventBinding=i.endEventBinding),cX(i)&&(h.normalizedDuration=i.relativeDuration,h.exitConditionEnabled=i.exitConditionEnabled,h.exitCondition=i.exitCondition)),h.conditions.forEach((function(t,n){var r,s=i.conditions[n];s instanceof OZ&&s.trigger&&(null!==(r=h.triggers)&&void 0!==r?r:h.triggers=[]).push(s.trigger)})),_.addTransition(h)},A=w(p);!(b=A()).done;)k()}return a},i.ES=function(){var t=this.gS,i=this.pS;t.length;for(var n=0===i.length?this.wS:i[i.length-1].destination,r=0;;++r){if(r>=16){st(14e3,16,"");break}var s=this.NS(n);if(!s)break;var e=s.to,h=n;if(n=e,n1(e)){if(e===h)break;this.PS(t,s),t.length=0}else t.push(s)}t.length=0},i.TS=function(){var t=this.wS,i=this.pS;t.resetTickFlagsAndWeight();for(var n=0;n<i.length;++n)i[n].destination.resetTickFlagsAndWeight()},i.IS=function(t){var i=this.wS,n=this.pS;this.yS,this.LS(i,t);for(var r=0;r<n.length;++r){var s=n[r].destination;this.LS(s,t)}},i.LS=function(t,i){var n=this.yS;if(!t.testTickFlag(1))if(t.setTickFlag(1),3===t.kind)t.update(i.deltaTime,this.BO);else if(5===t.kind){var r=n.generate(i.deltaTime,i.indicativeWeight*t.absoluteWeight);t.update(r)}},i.MS=function(t){var i,n=this.wS,r=this.pS,s=1,e=null,h=0;if(3===n.kind)e=null!==(i=n.evaluate(t))&&void 0!==i?i:this.CS(t);else if(5===n.kind){var u;e=null!==(u=n.evaluate(t))&&void 0!==u?u:this.CS(t)}else s-=n.absoluteWeight,e=null;e&&(h=n.absoluteWeight),n.setTickFlag(2);for(var o=0;o<r.length;++o){var c=r[o].destination;if(!c.testTickFlag(2)){c.setTickFlag(2);var a,f=c.absoluteWeight,v=void 0;4===c.kind?(s-=f,v=null):v=null!==(a=c.evaluate(t))&&void 0!==a?a:this.CS(t),v&&(e&&(h+=f)?(JK(e,v,f/h),t.popPose()):e=v)}}return this.passthroughWeight=s,e},i.CS=function(t){return this.kS?t.pushZeroDeltaPose():t.pushDefaultedPose()},i.NS=function(t){var i=this.DS(t,t);if(i)return i;if(3===t.kind||5===t.kind){var n=this.BS(t);if(n)return n}return null},i.BS=function(t){for(var i=t.stateMachine;null!==i;i=i.parent){var n=this.DS(i.any,t);if(n)return n}return null},i.DS=function(t,i){t===i||t.kind,this.mS.set(i);for(var n=t.outgoingTransitions,r=n.length,s=0;s<r;++s){var e=n[s];if(!e.activated){var h=e.conditions,u=h.length;if(0===u){if(0===t.kind||1===t.kind)return e;if(!e.exitConditionEnabled)continue}if(3===i.kind&&e.exitConditionEnabled){var o=i.duration*e.exitCondition;if(i.time<o)break}for(var c=!0,a=0;a<u;++a)if(!h[a].eval(this.mS)){c=!1;break}if(c)return e}}return null},i.PS=function(t,i){var n=i.to;n1(n);var r=this._S.alloc();r.reset(t,i),this.pS.push(r);for(var s=r.path.length,e=0;e<s;++e){var h=r.path[e];this.FS(h)}for(var u=0;u<r.path.length;++u){var o=r.path[u];this.US(o.to)}this.pS.length;var c=1===this.pS.length?this.wS:this.pS[this.pS.length-2].destination;c instanceof h1&&c.transitionOutEventBinding&&this.IA(c.transitionOutEventBinding),i.startEventBinding&&this.IA(i.startEventBinding),n instanceof h1&&n.transitionInEventBinding&&this.IA(n.transitionInEventBinding)},i.SS=function(t){for(var i=this.pS,n=i.length-1,r=1,s=n;n>=0;--n){var e=i[n],h=0===n?this.wS:i[n-1].destination;if(e.update(t,h),e.done){this.xS(s);break}var u=e.normalizedElapsedTime*r;e.destination.increaseAbsoluteWeight(u),r*=1-e.normalizedElapsedTime,s=n-1}this.wS.increaseAbsoluteWeight(r)},i.xS=function(t){var i=this.pS,n=this._S;t>=0&&i.length;var r=t+1,s=i[t],e=s.destination;s.path.length;var h=s.path[s.path.length-1];h.endEventBinding&&this.IA(h.endEventBinding),this.GS(this.wS);for(var u=0;u<=t;++u){var o=i[u];u!==t&&o.destination.decreaseActiveReference();for(var c=u===t?o.path.length-1:o.path.length,a=0;a<c;++a){var f=o.path[a];this.GS(f.to)}n.free(o)}if(t===i.length-1)i.length=0;else{for(var v=t+1;v<i.length;++v)i[v-r]=i[v];i.length-=r}this.wS.decreaseActiveReference(),this.wS=e},i.FS=function(t){var i=t.triggers;if(i)for(var n=i.length,r=0;r<n;++r){var s=i[r];this.MO(s)}},i.MO=function(t){(0,this.jS)(t)},i.US=function(t){var i,n=this.BO;switch(t.kind){default:break;case 3:t.components.callMotionStateEnterMethods(n,t.getStatus());break;case 0:null==(i=t.stateMachine.components)||i.callStateMachineEnterMethods(n)}},i.GS=function(t){var i,n=this.BO;switch(t.kind){default:break;case 3:t.components.callMotionStateExitMethods(n,t.getStatus());break;case 1:null==(i=t.stateMachine.components)||i.callStateMachineExitMethods(n)}},i.IA=function(t){t.emit(this.BO.node)},r(t,[{key:"exited",get:function(){return this.wS===this.dS}}]),t}();function n1(t){return 3===t.kind||4===t.kind||5===t.kind}var r1={next:function(){return{done:!0,value:void 0}}},s1=((Q0={})[Symbol.iterator]=function(){return r1},Q0),e1=function(){function t(t){this.name=void 0,this.outgoingTransitions=[],this.HS=0,this.VS=0,this.$S=0,this.name=t.name}var i=t.prototype;return i.setPrefix_debug=function(t){this.__DEBUG_ID__=""+t+this.name},i.addTransition=function(t){this.outgoingTransitions.push(t)},i.increaseActiveReference=function(){0===this.HS&&(this.$S=0,this.VS=0),++this.HS},i.decreaseActiveReference=function(){--this.HS},i.resetTickFlagsAndWeight=function(){this.zS(),this.$S=0,this.VS=0},i.increaseAbsoluteWeight=function(t){this.$S+=t},i.testTickFlag=function(t){return!!(this.VS&t)},i.setTickFlag=function(t){this.testTickFlag(t),u1[t],this.VS|=t},i.zS=function(){this.HS},r(t,[{key:"absoluteWeight",get:function(){return this.$S}},{key:"activeReferenceCount",get:function(){return this.HS}}]),t}(),h1=function(t){function i(i){var n;return(n=t.call(this,i)||this).transitionInEventBinding=void 0,n.transitionOutEventBinding=void 0,i.transitionInEventBinding.isBound&&(n.transitionInEventBinding=i.transitionInEventBinding),i.transitionOutEventBinding.isBound&&(n.transitionOutEventBinding=i.transitionOutEventBinding),n}return e(i,t),i}(e1),u1={UPDATED:1,EVALUATED:2},o1=function(){function t(t){this.WS=t.instantiateComponents()}var i=t.prototype;return i.callMotionStateEnterMethods=function(t,i){this.XS("onMotionStateEnter",t,i)},i.callMotionStateUpdateMethods=function(t,i){this.XS("onMotionStateUpdate",t,i)},i.callMotionStateExitMethods=function(t,i){this.XS("onMotionStateExit",t,i)},i.callStateMachineEnterMethods=function(t){this.YS("onStateMachineEnter",t)},i.callStateMachineExitMethods=function(t){this.YS("onStateMachineExit",t)},i.XS=function(t,i,n){for(var r=this.WS,s=r.length,e=0;e<s;++e){var h=r[e];h[t]!==IZ.prototype[t]&&h[t](i,n)}},i.YS=function(t,i){for(var n=this.WS,r=n.length,s=0;s<r;++s){var e=n[s];e[t]!==IZ.prototype[t]&&e[t](i)}},t}(),c1=function(){function t(t,i){var n,r;this.KS=null,this.qS=1,this.uA=1,this.QS=void 0,this.JS=void 0;var s=t.name;if(this.qS=t.speed,this.ZS(1),t.speedMultiplierEnabled&&t.speedMultiplier){var e=t.speedMultiplier,h=i.getVar(e);if(_Q(h,e)){yQ(h.type,0,e),h.bind(this.ZS,this);var u=h.value;this.ZS(u)}}var o=null!==(n=null==(r=t.motion)?void 0:r[kX](i,!1))&&void 0!==n?n:null;o&&Object.defineProperty(o,"__DEBUG_ID__",{value:s}),this.KS=o,this.QS=new a1(this,t,null==o?void 0:o.createPort()),this.JS=new a1(this,t,null==o?void 0:o.createPort()),this.components=new o1(t)}var i=t.prototype;return i.setPrefix_debug=function(t){this.QS.setPrefix_debug(t),this.JS.setPrefix_debug(t)},i.addTransition=function(t){t.to===this.QS?this.QS.addTransition(s({},t,{to:this.JS})):this.QS.addTransition(t),this.JS.addTransition(t)},i.getClipStatuses=function(t){var i,n=this.KS;return n?((i={})[Symbol.iterator]=function(){return n.getClipStatuses(t)},i):s1},i.overrideClips=function(t){var i;null==(i=this.KS)||i.overrideClips(t)},i.ZS=function(t){this.uA=this.qS*t},r(t,[{key:"duration",get:function(){var t,i;return null!==(t=null==(i=this.KS)?void 0:i.duration)&&void 0!==t?t:0}},{key:"speed",get:function(){return this.uA}},{key:"entry",get:function(){return this.QS}},{key:"stateMachine",get:function(){return this.tI},set:function(t){this.tI=t,this.QS.stateMachine=t,this.JS.stateMachine=t}}]),t}(),a1=function(t){function i(i,n,r){var s;return(s=t.call(this,n)||this).kind=3,s.iI=void 0,s.nI=0,s.rI=void 0,s.sI={progress:0},s.iI=i,s.rI=r,s}e(i,t);var n=i.prototype;return n.reenter=function(t){var i;this.nI=t,null==(i=this.rI)||i.reenter()},n.getStatus=function(){var t=this.sI;return t.progress=v1(this.nI),t},n.getClipStatuses=function(t){return this.iI.getClipStatuses(t)},n.update=function(t,i){this.nI=f1(this.nI,this.duration,t*this.iI.speed),this.iI.components.callMotionStateUpdateMethods(i,this.getStatus())},n.evaluate=function(t){var i,n;return null!==(i=null==(n=this.rI)?void 0:n.evaluate(this.nI,t))&&void 0!==i?i:null},r(i,[{key:"duration",get:function(){return this.iI.duration}},{key:"components",get:function(){return this.iI.components}},{key:"normalizedTime",get:function(){return this.nI}},{key:"time",get:function(){return this.nI*this.iI.duration}}]),i}(h1);function f1(t,i,n){return 0===i?0:t+n/i}function v1(t){var i=t-Math.trunc(t);return i>=0?i:1+i}var l1,d1,w1,g1,p1,_1,y1,m1,b1,k1,A1,E1,T1,O1,S1=function(t){function i(i,n){var r;return(r=t.call(this,i)||this).kind=void 0,r.kind=n,r}return e(i,t),i}(e1),I1=function(t){function i(i){var n;return(n=t.call(this,i)||this).kind=4,n}return e(i,t),i}(e1),R1=function(t){function i(i,n){var r;(r=t.call(this,i)||this).kind=5,r.elapsedTime=0,r.statusCache={progress:0},r.eI=void 0,r.sI={progress:0},r.hI=0;var s=W0(i.graph,n,!0);return s.bind(n),r.eI=s,r.sI.progress=0,r}e(i,t);var n=i.prototype;return n.settle=function(t){this.eI.settle(t)},n.reenter=function(){this.sI.progress=0,this.eI.reenter()},n.update=function(t){this.hI+=t.deltaTime,this.eI.update(t)},n.evaluate=function(t){var i;return null!==(i=this.eI.evaluate(t))&&void 0!==i?i:null},n.getStatus=function(){return this.sI.progress=v1(this.hI),this.sI},n.countMotionTime=function(){return this.eI.countMotionTime()},i}(h1),M1=function(){function t(){this.sourceStateWeight=0,this.uI=void 0}var i=t.prototype;return i.set=function(t){this.uI=t,n1(t)?(t.activeReferenceCount,this.sourceStateWeight=t.absoluteWeight):this.sourceStateWeight=0},i.unset=function(){this.uI=void 0,this.sourceStateWeight=0},r(t,[{key:"sourceStateMotionTimeNormalized",get:function(){var t=this.uI;switch(t&&(3===t.kind||5===t.kind)&&t.activeReferenceCount,t.kind){case 3:return t.normalizedTime;case 5:return t.countMotionTime();default:return 0}}}]),t}(),C1=function(){function t(){this.normalizedElapsedTime=0,this.path=[],this.oI=1}var i=t.prototype;return i.getAbsoluteDuration=function(t){return this.aI(t)*this.oI},i.update=function(t,i){if(n1(i)){var n=this.getAbsoluteDuration(i);if(n<=0)this.normalizedElapsedTime=1;else{var r=this.normalizedElapsedTime*n,s=n-r,e=jn((r+Math.min(s,t))/n);this.normalizedElapsedTime=e}}else this.normalizedElapsedTime=1},t.createPool=function(i){return new xe((function(){return new t}),i,void 0)},i.reset=function(t,i){var n=i.to;n1(n),this.normalizedElapsedTime=0,this.destination=n,this.path=[].concat(t,[i]);var r=n.activeReferenceCount;if(n.increaseActiveReference(),0===r)if(3===n.kind){var s=this.path[0],e=s.destinationStart,h=s.relativeDestinationStart?e:0===n.duration?0:e/n.duration;n.reenter(h)}else 5===n.kind&&n.reenter();n.activeReferenceCount,this.oI=1-n.absoluteWeight},i.aI=function(t){this.path.length;var i=this.path[0],n=i.duration;return i.normalizedDuration?(3===t.kind?t.duration:1)*n:n},r(t,[{key:"done",get:function(){return xn(this.normalizedElapsedTime,1,1e-6)}}]),t}();_o(Vj+"PoseNodeStateMachine")(l1=Mz(VJ)(l1=Pz({themeColor:"#CCCCCC",inline:!0})((d1=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).name=w1&&w1(),i.stateMachine=g1&&g1(),i.fI=void 0,i}e(i,t);var n=i.prototype;return n.__callOnAfterDeserializeRecursive=function(){this.stateMachine._allowEmptyStates=!1,this.stateMachine.__callOnAfterDeserializeRecursive()},n.bind=function(t){this.fI,this.fI=new i1(this.stateMachine,"",t)},n.settle=function(t){var i;null==(i=this.fI)||i.settle(t)},n.reenter=function(){var t;null==(t=this.fI)||t.reenter()},n.doUpdate=function(t){var i=this.fI;i.update(t),i.passthroughWeight},n.doEvaluate=function(t){var i=this.fI,n=i.evaluate(t);return i.passthroughWeight,n},i}(Xz),w1=uo(d1.prototype,"name",[Co],(function(){return""})),g1=uo(d1.prototype,"stateMachine",[Co],(function(){return new pX(!1)})),l1=d1))||l1)||l1);var N1,P1,L1,D1,B1,F1,U1,x1,G1,j1,H1,V1,$1,z1,W1,X1,Y1,K1,q1,Q1,J1,Z1,t2,i2,n2,r2,s2,e2,h2,u2,o2=(p1=_o(Vj+"PoseNodeSampleMotion"),_1=Mz(VJ),y1=Cz(G0((function(t){var i=new o2;return i.motion=t,i}))),m1=Pz({themeColor:"#D97721"}),b1=qz({type:0}),p1(k1=_1(k1=y1(k1=m1((A1=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).motion=E1&&E1(),_(i,"time",T1,v(i)),i.useNormalizedTime=O1&&O1(),i.ZO=null,i}e(i,t);var n=i.prototype;return n.bind=function(t){var i=this.motion;if(i){var n=i[kX](t,!0);if(n){var r=new c2(n,n.createPort());this.ZO=r}}},n.settle=function(){},n.reenter=function(){},n.doUpdate=function(){},n.doEvaluate=function(t){var i=this.ZO;if(!i)return t.pushDefaultedPose();var n=this.time,r=this.useNormalizedTime?n:n/i.motionEval.duration;return i.motionEvalPort.evaluate(jn(r),t)},i}(Xz),E1=uo(A1.prototype,"motion",[Co],(function(){return new rQ})),T1=y(A1.prototype,"time",[Co,b1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O1=uo(A1.prototype,"useNormalizedTime",[Co],(function(){return!1})),k1=A1))||k1)||k1)||k1)||k1),c2=function(t,i){this.motionEval=t,this.motionEvalPort=i};function a2(t){return t<1e-5}N1=_o(Vj+"PoseNodeAdditivelyBlend"),P1=Mz($J),L1=Pz({themeColor:"#72A869"}),D1=qz({type:5}),B1=qz({type:5}),F1=qz({type:0}),N1(U1=P1(U1=L1((x1=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return _(i=t.call.apply(t,[this].concat(r))||this,"basePose",G1,v(i)),_(i,"additivePose",j1,v(i)),_(i,"ratio",H1,v(i)),i}e(i,t);var n=i.prototype;return n.bind=function(t){var i,n;null==(i=this.basePose)||i.bind(t),t._pushAdditiveFlag(!0),null==(n=this.additivePose)||n.bind(t),t._popAdditiveFlag()},n.settle=function(t){var i,n;null==(i=this.basePose)||i.settle(t),null==(n=this.additivePose)||n.settle(t)},n.reenter=function(){var t,i;null==(t=this.basePose)||t.reenter(),null==(i=this.additivePose)||i.reenter()},n.doUpdate=function(t){var i,n;null==(i=this.basePose)||i.update(t),null==(n=this.additivePose)||n.update(t)},n.doEvaluate=function(t){var i,n,r=null!==(i=null==(n=this.basePose)?void 0:n.evaluate(t,1))&&void 0!==i?i:t.pushDefaultedPose();return this.additivePose?(oq(r,this.additivePose.evaluate(t,1),this.ratio),t.popPose(),r):r},i}(Xz),G1=y(x1.prototype,"basePose",[Co,D1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j1=y(x1.prototype,"additivePose",[Co,B1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),H1=y(x1.prototype,"ratio",[Co,F1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),U1=x1))||U1)||U1),V1=_o(Vj+"PoseNodeBlendInProportion"),$1=Mz($J),z1=Pz({themeColor:"#72A869"}),W1=qz({type:5,arraySyncGroup:"blend-item"}),X1=qz({type:0,arraySyncGroup:"blend-item",arraySyncGroupFollower:!0}),V1(Y1=$1(Y1=z1((K1=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return _(i=t.call.apply(t,[this].concat(r))||this,"poses",q1,v(i)),_(i,"proportions",Q1,v(i)),i.yS=new F0,i}e(i,t);var n=i.prototype;return n.bind=function(t){for(var i,n=w(this.poses);!(i=n()).done;){var r=i.value;null==r||r.bind(t)}},n.settle=function(t){for(var i,n=w(this.poses);!(i=n()).done;){var r=i.value;null==r||r.settle(t)}},n.reenter=function(){for(var t,i=w(this.poses);!(t=i()).done;){var n=t.value;null==n||n.reenter()}},n.doUpdate=function(t){for(var i=this.yS,n=this.poses.length,r=0;r<n;++r){var s,e=this.proportions[r];if(!a2(e)){var h=i.generate(t.deltaTime,t.indicativeWeight*e);null==(s=this.poses[r])||s.update(h)}}},n.doEvaluate=function(t){for(var i=this.poses.length,n=0,r=null,s=0;s<i;++s){var e,h=this.proportions[s];if(!a2(h)){var u=null==(e=this.poses[s])?void 0:e.evaluate(t,1);u&&(n+=h,r?(n&&JK(r,u,h/n),t.popPose()):r=u)}}return r||t.pushDefaultedPose()},i}(Xz),q1=y(K1.prototype,"poses",[Co,W1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q1=y(K1.prototype,"proportions",[Co,X1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Y1=K1))||Y1)||Y1);var f2,v2,l2,d2,w2,g2,p2,_2,y2=(J1=_o(Vj+"PoseNodeBlendTwoPoseBase"),Z1=Nz(!0),t2=qz({type:5}),i2=qz({type:5}),n2=qz({type:0}),J1(r2=Z1((s2=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return _(i=t.call.apply(t,[this].concat(r))||this,"pose0",e2,v(i)),_(i,"pose1",h2,v(i)),_(i,"ratio",u2,v(i)),i.yS=new F0,i}e(i,t);var n=i.prototype;return n.bind=function(t){var i,n;null==(i=this.pose0)||i.bind(t),null==(n=this.pose1)||n.bind(t)},n.settle=function(t){var i,n;null==(i=this.pose0)||i.settle(t),null==(n=this.pose1)||n.settle(t)},n.reenter=function(){var t,i;null==(t=this.pose0)||t.reenter(),null==(i=this.pose1)||i.reenter()},n.doUpdate=function(t){var i=this.pose0,n=this.pose1,r=this.yS,s=this.ratio,e=r.generate(t.deltaTime,t.indicativeWeight*(1-s));null==i||i.update(e);var h=r.generate(t.deltaTime,t.indicativeWeight*s);null==n||n.update(h)},n.doEvaluate=function(t){var n,r,s,e;if(!this.pose0||!this.pose1)return i.evaluateDefaultPose(t,1);var h=null!==(n=null==(r=this.pose0)?void 0:r.evaluate(t,1))&&void 0!==n?n:i.evaluateDefaultPose(t,1),u=null!==(s=null==(e=this.pose1)?void 0:e.evaluate(t,1))&&void 0!==s?s:i.evaluateDefaultPose(t,1);return this.doBlend(h,u,this.ratio),t.popPose(),h},i}(Xz),e2=y(s2.prototype,"pose0",[Co,t2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h2=y(s2.prototype,"pose1",[Co,i2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u2=y(s2.prototype,"ratio",[Co,n2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),r2=s2))||r2)||r2);_o(Vj+"PoseNodeBlendTwoPose")(f2=Mz($J)(f2=Pz({themeColor:"#72A869"})(f2=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.doBlend=function(t,i,n){return JK(t,i,n)},i}(y2))||f2)||f2),v2=_o(Vj+"PoseNodeFilteringBlend"),l2=Mz($J),d2=Pz({themeColor:"#72A869"}),w2=ic(xJ),v2(g2=l2(g2=d2((p2=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).mask=_2&&_2(),i.vI=void 0,i}e(i,t);var n=i.prototype;return n.settle=function(i){if(t.prototype.settle.call(this,i),this.mask){var n=i.createTransformFilter(this.mask);this.vI=n}},n.doBlend=function(t,i,n){JK(t,i,n,this.vI)},i}(y2),_2=uo(p2.prototype,"mask",[Co,w2],(function(){return null})),g2=p2))||g2)||g2);var m2,b2,k2,A2,E2,T2,O2,S2,I2,R2,M2,C2,N2,P2,L2,D2,B2,F2,U2,x2,G2,j2,H2,V2,$2,z2,W2,X2,Y2,K2,q2,Q2=VJ+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_choose/",J2=1e-5,Z2=_o(Vj+"PoseNodeChoosePoseBase")(m2=Nz()((b2=function(t){function i(i){var n;return void 0===i&&(i=0),(n=t.call(this)||this)._poses=k2&&k2(),n._fadeInDurations=A2&&A2(),n.yS=new F0,n.lI=void 0,n._poses.length=i,n._poses.fill(null),n._fadeInDurations.length=i,n._fadeInDurations.fill(0),n}e(i,t);var n=i.prototype;return n.bind=function(t){for(var i,n=w(this._poses);!(i=n()).done;){var r=i.value;null==r||r.bind(t)}var s=new t3(this._poses.length,this.getChosenIndex());this.lI=s},n.settle=function(t){for(var i,n=w(this._poses);!(i=n()).done;){var r=i.value;null==r||r.settle(t)}},n.reenter=function(){for(var t,i=w(this._poses);!(t=i()).done;){var n=t.value;null==n||n.reenter()}},n.doUpdate=function(t){var i=this._poses,n=this.lI;if(n.update(t.deltaTime,this.getChosenIndex(),this._fadeInDurations),!n.allWeightsAreZero()){var r=i.length,s=n.items;s.length;for(var e=0;e<r;++e){var h=s[e].weight;if(!a2(h)){var u=i[e],o=this.yS.generate(t.deltaTime,t.indicativeWeight*h);null==u||u.update(o)}}}},n.doEvaluate=function(t){var n=this._poses,r=this.lI,s=n.length;r.items.length,n.length;var e=null;if(!r.allWeightsAreZero())for(var h=0,u=0;u<s;++u){var o,c=r.items[u].weight;if(!a2(c)){var a=null==(o=n[u])?void 0:o.evaluate(t,1);a&&(h+=c,e?(h&&JK(e,a,c/h),t.popPose()):e=a)}}return e||i.evaluateDefaultPose(t,1)},n.getChosenIndex=function(){return 0},i}(Xz),k2=uo(b2.prototype,"_poses",[Co],(function(){return[]})),A2=uo(b2.prototype,"_fadeInDurations",[Co],(function(){return[]})),m2=b2))||m2)||m2,t3=function(){function t(t,i){this.dI=void 0,this.wI=-1,this.gI=0,this.pI=0;var n=Array.from({length:t},(function(){return new i3}));i>=0&&i<t&&(n[i].selfSourceWeight=1,n[i].selfTargetWeight=1,n[i].weight=1),this.dI=n}var i=t.prototype;return i.allWeightsAreZero=function(){return this.wI<0},i.update=function(t,i,n){if(this._I(i,n),!(this.wI<0)){var r=this.gI,s=this.pI,e=this.dI;if(!(r>=s)){var h=e.length,u=0,o=0;t>s-r?(this.gI=s,o=1):(this.gI+=t,o=this.gI/s);for(var c=0;c<h;++c){var a=e[c],f=Hn(a.selfSourceWeight,a.selfTargetWeight,o);u+=f,a.weight=f}if(!a2(u))for(var v=0;v<h;++v)e[v].weight/=u}}},i._I=function(t,i){var n=this.dI,r=this.wI,s=n.length;if(s&&t!==r&&!(t<0||t>=s)){var e=Math.max(i[t],0);if(e<J2)for(var h=0;h<s;++h){var u=n[h];h===t?(u.selfSourceWeight=1,u.selfTargetWeight=1,u.weight=1):(u.selfSourceWeight=0,u.selfTargetWeight=0,u.weight=0)}else for(var o=this.pI<J2?1:this.gI/this.pI,c=0;c<s;++c){var a=n[c];a.selfSourceWeight=Hn(a.selfSourceWeight,a.selfTargetWeight,o),a.selfTargetWeight=c===t?1:0}this.wI=t,this.gI=0,this.pI=e}},r(t,[{key:"items",get:function(){return this.dI}}]),t}(),i3=function(){this.selfSourceWeight=0,this.selfTargetWeight=0,this.weight=0};E2=_o(Vj+"PoseNodeChoosePoseByBoolean"),T2=Mz(Q2),O2=Pz({themeColor:"#D07979"}),S2=qz({type:5}),I2=qz({type:5}),R2=qz({type:0}),M2=qz({type:0}),C2=qz({type:2}),E2(N2=T2(N2=O2((P2=function(t){function i(){var i;return _(i=t.call(this,2)||this,"choice",L2,v(i)),i}return e(i,t),i.prototype.getChosenIndex=function(){return this.choice?0:1},r(i,[{key:"truePose",get:function(){return this._poses[0]},set:function(t){this._poses[0]=t}},{key:"falsePose",get:function(){return this._poses[1]},set:function(t){this._poses[1]=t}},{key:"trueFadeInDuration",get:function(){return this._fadeInDurations[0]},set:function(t){this._fadeInDurations[0]=t}},{key:"falseFadeInDuration",get:function(){return this._fadeInDurations[1]},set:function(t){this._fadeInDurations[1]=t}}]),i}(Z2),y(P2.prototype,"truePose",[S2],Object.getOwnPropertyDescriptor(P2.prototype,"truePose"),P2.prototype),y(P2.prototype,"falsePose",[I2],Object.getOwnPropertyDescriptor(P2.prototype,"falsePose"),P2.prototype),y(P2.prototype,"trueFadeInDuration",[R2],Object.getOwnPropertyDescriptor(P2.prototype,"trueFadeInDuration"),P2.prototype),y(P2.prototype,"falseFadeInDuration",[M2],Object.getOwnPropertyDescriptor(P2.prototype,"falseFadeInDuration"),P2.prototype),L2=y(P2.prototype,"choice",[Co,C2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),N2=P2))||N2)||N2),D2=_o(Vj+"PoseNodeChoosePoseByIndex"),B2=Mz(Q2),F2=Pz({themeColor:"#D07979"}),U2=qz({type:5,arraySyncGroup:"choose-item"}),x2=qz({type:0,arraySyncGroup:"choose-item",arraySyncGroupFollower:!0}),G2=qz({type:1}),D2(j2=B2(j2=F2((H2=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return _(i=t.call.apply(t,[this].concat(r))||this,"choice",V2,v(i)),i}return e(i,t),i.prototype.getChosenIndex=function(){return this.choice},r(i,[{key:"poses",get:function(){return this._poses},set:function(t){this._poses=t}},{key:"fadeInDurations",get:function(){return this._fadeInDurations},set:function(t){this._fadeInDurations=t}}]),i}(Z2),y(H2.prototype,"poses",[U2],Object.getOwnPropertyDescriptor(H2.prototype,"poses"),H2.prototype),y(H2.prototype,"fadeInDurations",[x2],Object.getOwnPropertyDescriptor(H2.prototype,"fadeInDurations"),H2.prototype),V2=y(H2.prototype,"choice",[Co,G2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j2=H2))||j2)||j2);var n3={VALUE:0,AUXILIARY_CURVE:1};bi(n3);var r3,s3,e3,h3,u3,o3,c3=($2=_o(Vj+"IntensitySpecification"),z2=ic(n3),$2((X2=function(){function t(){this.type=Y2&&Y2(),this.value=K2&&K2(),this.auxiliaryCurveName=q2&&q2(),this.dT=void 0}var i=t.prototype;return i.bind=function(t){if(1===this.type&&this.auxiliaryCurveName){var i=t.bindAuxiliaryCurve(this.auxiliaryCurveName);this.dT=i}},i.evaluate=function(t){return 1===this.type&&this.dT?t.auxiliaryCurves[this.dT.index]:this.value},t}(),Y2=uo(X2.prototype,"type",[z2,Co],(function(){return 0})),K2=uo(X2.prototype,"value",[Co],(function(){return 1})),q2=uo(X2.prototype,"auxiliaryCurveName",[Co],(function(){return""})),W2=X2))||W2),a3=function(){this.transformIndex=-1,this.transform=new HK},f3=function(){function t(){this.T=new xe((function(){return new a3}),3),this.Ss=new je(3),this.yI=-1}var i=t.prototype;return i.push=function(t,i){var n=this.T.alloc();n.transformIndex=t,HK.copy(n.transform,i),this.Ss.push(n)},i.clear=function(){for(var t=this.Ss.length,i=0;i<t;++i){var n=this.Ss.get(i);this.T.free(n)}this.Ss.clear()},r(t,[{key:"length",get:function(){return this.Ss.length}},{key:"array",get:function(){return this.Ss.array}}]),t}(),v3=function(){function t(t){this.mI=[],this.mI=new Array(t)}var i=t.prototype;return i.clear=function(){this.mI.fill(!1)},i.test=function(t){return this.mI[t]},i.set=function(t){this.mI[t]=!0},i.unset=function(t){this.mI[t]=!1},t}(),l3=new HK,d3=new HK;function w3(t,i,n,r){var s=n.length;if(0!==s)if(0!==i._poseTransformSpace){i._poseTransformSpace,r.clear();for(var e=n.array[0].transformIndex,h=e,u=0;u<s;++u){var o=n.array[u].transformIndex;r.set(o),h=o}for(var c=e;c<i.transforms.length;++c){var a=t.parentTable[c];a<0||r.test(a)&&(r.set(c),h=c)}for(var f=h;f>=e;--f)if(r.test(f)){var v=t.parentTable[f];if(v>=0){var l=i.transforms.getTransform(f,l3),d=i.transforms.getTransform(v,d3);HK.calculateRelative(l,l,d),i.transforms.setTransform(f,l)}}for(var w=0;w<s;++w){var g=n.array[w],p=g.transformIndex,_=g.transform;i.transforms.setTransform(p,_),r.unset(p)}for(var y=e;y<=h;++y)if(r.test(y)){var m=t.parentTable[y],b=i.transforms.getTransform(y,l3),k=i.transforms.getTransform(m,d3);HK.multiply(b,k,b),i.transforms.setTransform(y,b)}}else for(var A=0;A<s;++A){var E=n.array[A],T=E.transformIndex,O=E.transform;i.transforms.setTransform(T,O)}}var g3,p3,_3,y3,m3,b3,k3,A3,E3,T3,O3,S3,I3,R3,M3,C3,N3,P3,L3=(r3=_o(Vj+"PoseNodeModifyPoseBase"),s3=Nz(),e3=qz({type:5}),r3(h3=s3((u3=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return _(i=t.call.apply(t,[this].concat(r))||this,"pose",o3,v(i)),i.kI=new f3,i.AI=new v3(0),i}e(i,t);var n=i.prototype;return n.settle=function(t){var i;null==(i=this.pose)||i.settle(t),this.AI=new v3(t.transformCount)},n.reenter=function(){var t;null==(t=this.pose)||t.reenter()},n.bind=function(t){var i;null==(i=this.pose)||i.bind(t)},n.doUpdate=function(t){var i;null==(i=this.pose)||i.update(t)},n.doEvaluate=function(t){var i,n,r=this.getPoseTransformSpaceRequirement(),s=null!==(i=null==(n=this.pose)?void 0:n.evaluate(t,r))&&void 0!==i?i:Xz.evaluateDefaultPose(t,r),e=this.kI;return e.length,this.modifyPose(t,s,e),w3(t,s,e,this.AI),e.clear(),s},i}(Xz),o3=y(u3.prototype,"pose",[Co,e3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h3=u3))||h3)||h3),D3={WORLD:0,COMPONENT:1,PARENT:2,LOCAL:3};bi(D3);var B3={LEAVE_UNCHANGED:0,REPLACE:1,ADD:2};bi(B3);var F3=1e-5,U3=new HK;g3=_o(Vj+"PoseNodeApplyTransform"),p3=Mz(VJ),_3=Pz({themeColor:"#72A869"}),y3=ic(B3),m3=qz({type:3}),b3=ic(B3),k3=qz({type:4}),A3=ic(D3),E3=qz({type:0}),g3(T3=p3(T3=_3((O3=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).node=S3&&S3(),i.positionOperation=I3&&I3(),_(i,"position",R3,v(i)),i.rotationOperation=M3&&M3(),_(i,"rotation",C3,v(i)),i.intensity=N3&&N3(),i.transformSpace=P3&&P3(),i.bE=null,i}e(i,t);var n=i.prototype;return n.bind=function(i){var n=this.node;if(t.prototype.bind.call(this,i),n){var r=i.bindTransformByName(n);r?(this.bE=r,this.intensity.bind(i)):X("Failed to bind transform "+n)}},n.getPoseTransformSpaceRequirement=function(){return 0},n.modifyPose=function(t,i,n){var r=this.bE;if(!r)return i;var s=this.intensity.evaluate(i);if(s<F3)return i;var e=xn(s,1,F3),h=r.index,u=i.transforms.getTransform(h,U3),o=this.rotationOperation;if(0!==o){var c=this.rotation,a=this.transformSpace;switch(t._convertPoseSpaceTransformToTargetSpace(u,a,i,h),o){default:case 1:t5(u,c,s,e);break;case 2:i5(u,c,s,e)}t._convertTransformToPoseTransformSpace(u,a,i,h)}var f=this.positionOperation;if(0!==f){var v=this.position,l=this.transformSpace;switch(t._convertPoseSpaceTransformToTargetSpace(u,l,i,h),f){default:case 1:Q3(u,v,s,e);break;case 2:J3(u,v,s,e)}t._convertTransformToPoseTransformSpace(u,l,i,h)}return n.push(h,u),i},r(i,[{key:"intensityValue",get:function(){return this.intensity.value},set:function(t){this.intensity.value=t}}]),i}(L3),S3=uo(O3.prototype,"node",[Co],(function(){return""})),I3=uo(O3.prototype,"positionOperation",[Co,y3],(function(){return 0})),R3=y(O3.prototype,"position",[Co,m3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ir}}),M3=uo(O3.prototype,"rotationOperation",[Co,b3],(function(){return 0})),C3=y(O3.prototype,"rotation",[Co,k3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qr}}),N3=uo(O3.prototype,"intensity",[Co],(function(){return new c3})),P3=uo(O3.prototype,"transformSpace",[Co,A3],(function(){return 0})),y(O3.prototype,"intensityValue",[E3],Object.getOwnPropertyDescriptor(O3.prototype,"intensityValue"),O3.prototype),T3=O3))||T3)||T3);var x3,G3,j3,H3,V3,$3,z3,W3,X3,Y3,K3,q3=(x3=new Ir,G3=new Ir,{replace:function(t,i,n,r){if(r)t.position=i;else{var s=Ir.copy(x3,t.position);Ir.lerp(s,s,i,n),t.position=s}},add:function(t,i,n,r){var s=G3;r?Ir.copy(s,i):Ir.slerp(s,Ir.ZERO,i,n),Ir.add(s,t.position,s),t.position=s}}),Q3=q3.replace,J3=q3.add,Z3=function(){var t=new Qr,i=new Qr;return{replace:function(i,n,r,s){if(s)i.rotation=n;else{var e=Qr.copy(t,i.rotation);Qr.slerp(e,e,n,r),i.rotation=e}},add:function(n,r,s,e){var h=Qr.copy(t,n.rotation),u=i;e?Qr.copy(u,r):Qr.slerp(u,Qr.IDENTITY,r,s),Qr.multiply(u,u,h),n.rotation=u}}}(),t5=Z3.replace,i5=Z3.add,n5=new HK,r5={LOCAL:0,COMPONENT:1};bi(r5),j3=_o(Vj+"PoseNodeCopyTransform"),H3=Mz(VJ),V3=Pz({themeColor:"#72A869"}),$3=ic(r5),j3(z3=H3(z3=V3((W3=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).sourceNodeName=X3&&X3(),i.targetNodeName=Y3&&Y3(),i.space=K3&&K3(),i.ZO=void 0,i}e(i,t);var n=i.prototype;return n.bind=function(i){t.prototype.bind.call(this,i);var n=i.bindTransformByName(this.sourceNodeName),r=i.bindTransformByName(this.targetNodeName);if(!n||!r)return null==n||n.destroy(),void(null==r||r.destroy());this.ZO=new l5(n,r)},n.modifyPose=function(t,i){var n=this.ZO;if(n){var r=n.hSource.index,s=n.hTarget.index,e=i.transforms.getTransform(r,n5);i.transforms.setTransform(s,e)}},n.getPoseTransformSpaceRequirement=function(){return 1===this.space?2:1},i}(L3),X3=uo(W3.prototype,"sourceNodeName",[Co],(function(){return""})),Y3=uo(W3.prototype,"targetNodeName",[Co],(function(){return""})),K3=uo(W3.prototype,"space",[Co,$3],(function(){return 1})),z3=W3))||z3)||z3);var s5,e5,h5,u5,o5,c5,a5,f5,v5,l5=function(t,i){this.hSource=t,this.hTarget=i},d5={LEAVE_UNCHANGED:0,REPLACE:1,ADD:2};bi(d5),s5=_o(Vj+"PoseNodeSetAuxiliaryCurve"),e5=Mz(VJ),h5=qz({type:0}),u5=ic(d5),s5(o5=e5((c5=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).curveName=a5&&a5(),_(i,"curveValue",f5,v(i)),i.flag=v5&&v5(),i.dT=void 0,i}e(i,t);var n=i.prototype;return n.bind=function(i){t.prototype.bind.call(this,i),this.curveName&&(this.dT=i.bindAuxiliaryCurve(this.curveName))},n.getPoseTransformSpaceRequirement=function(){return 0},n.modifyPose=function(t,i){var n=this.dT;if(n)switch(this.flag){case 1:i.auxiliaryCurves[n.index]=this.curveValue;break;case 2:i.auxiliaryCurves[n.index]+=this.curveValue}},i}(L3),a5=uo(c5.prototype,"curveName",[Co],(function(){return""})),f5=y(c5.prototype,"curveValue",[Co,h5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v5=uo(c5.prototype,"flag",[Co,u5],(function(){return 1})),o5=c5))||o5);var w5,g5,p5,_5,y5,m5,b5,k5,A5,E5,T5,O5,S5,I5,R5,M5,C5,N5,P5,L5,D5,B5,F5,U5,x5,G5,j5,H5,V5,$5,z5,W5,X5,Y5,K5,q5,Q5,J5,Z5,t6,i6,n6,r6=function(t){function i(){var i;return(i=t.call(this)||this).EI=null,i.TI=new Set,i}e(i,t);var n=i.prototype;return n.getMacroPatches=function(i){var n=t.prototype.getMacroPatches.call(this,i);if(this.EI){var r=this.EI.requiredPatches(i);if(r)return r.concat(null!=n?n:[])}return n},n.initSubModel=function(i,n,r){return t.prototype.initSubModel.call(this,i,n,this.OI(r))},n.destroy=function(){t.prototype.destroy.call(this),this.EI=null},n.setSubModelMaterial=function(i,n){return t.prototype.setSubModelMaterial.call(this,i,this.OI(n))},n.setMorphRendering=function(t){this.EI=t},n._updateLocalDescriptors=function(i,n){t.prototype._updateLocalDescriptors.call(this,i,n),this.EI&&this.EI.adaptPipelineState(i,n)},n.OI=function(t){return t},i}(hC),s6=_o,e6=mo,h6=ic,u6=No,o6=Co,c6=Uk("specular-pass");function a6(t){var i=t.passes,n=T.rendering;im()&&(c6=n.getPhaseID(n.getPassID("specular-pass"),"default"));for(var r=0;r<i.length;r++)if((!n||!n.enableEffectImport)&&i[r].phase===c6||im()&&i[r].phaseID===c6)return r;return-1}var f6,v6,l6,d6,w6,g6,p6,_6,y6,m6,b6,k6,A6,E6,T6,O6,S6,I6,R6,M6,C6,N6,P6,L6,D6=_i({OFF:0,ON:1}),B6=_i({OFF:0,ON:1}),F6=(w5=s6("cc.ModelBakeSettings"),g5=u6("_recieveShadow"),p5=h6(qi),_5=h6(Ji),y5=h6(Ji),m5=h6(_i({NONE:0,BAKED_CUBEMAP:1,PLANAR_REFLECTION:2,BLEND_PROBES:3,BLEND_PROBES_AND_SKYBOX:4})),b5=h6(Ji),w5((L5=function(t){function i(){var i;return(i=t.call(this)||this).texture=E5&&E5(),i.uvParam=T5&&T5(),i._bakeable=O5&&O5(),i._castShadow=S5&&S5(),i._receiveShadow=I5&&I5(),i._lightmapSize=R5&&R5(),i._useLightProbe=M5&&M5(),i._bakeToLightProbe=C5&&C5(),i._reflectionProbeType=N5&&N5(),i._bakeToReflectionProbe=P5&&P5(),i.probeCubemap=null,i.probeBlendCubemap=null,i.probePlanarmap=null,i}return e(i,t),r(i,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}},{key:"useLightProbe",get:function(){return this._useLightProbe},set:function(t){this._useLightProbe=t,this.emit("use_light_probe_changed")}},{key:"bakeToLightProbe",get:function(){return this._bakeToLightProbe},set:function(t){this._bakeToLightProbe=t}},{key:"reflectionProbe",get:function(){return this._reflectionProbeType},set:function(t){this._reflectionProbeType=t,this.emit("reflection_probe_changed")}},{key:"bakeToReflectionProbe",get:function(){return this._bakeToReflectionProbe},set:function(t){this._bakeToReflectionProbe=t,this.emit("bake_to_reflection_probe_changed")}}]),i}(eh),L5.USE_LIGHT_PROBE_CHANGED="use_light_probe_changed",L5.REFLECTION_PROBE_CHANGED="reflection_probe_changed",L5.BAKE_TO_REFLECTION_PROBE_CHANGED="bake_to_reflection_probe_changed",E5=uo((A5=L5).prototype,"texture",[o6],(function(){return null})),T5=uo(A5.prototype,"uvParam",[o6],(function(){return new $s})),O5=uo(A5.prototype,"_bakeable",[o6],(function(){return!1})),S5=uo(A5.prototype,"_castShadow",[o6],(function(){return!1})),I5=uo(A5.prototype,"_receiveShadow",[g5],(function(){return!1})),R5=uo(A5.prototype,"_lightmapSize",[o6],(function(){return 64})),M5=uo(A5.prototype,"_useLightProbe",[o6],(function(){return!1})),C5=uo(A5.prototype,"_bakeToLightProbe",[o6],(function(){return!0})),N5=uo(A5.prototype,"_reflectionProbeType",[o6],(function(){return 0})),P5=uo(A5.prototype,"_bakeToReflectionProbe",[o6],(function(){return!0})),y(A5.prototype,"lightmapSize",[p5],Object.getOwnPropertyDescriptor(A5.prototype,"lightmapSize"),A5.prototype),y(A5.prototype,"useLightProbe",[_5],Object.getOwnPropertyDescriptor(A5.prototype,"useLightProbe"),A5.prototype),y(A5.prototype,"bakeToLightProbe",[y5],Object.getOwnPropertyDescriptor(A5.prototype,"bakeToLightProbe"),A5.prototype),y(A5.prototype,"reflectionProbe",[m5],Object.getOwnPropertyDescriptor(A5.prototype,"reflectionProbe"),A5.prototype),y(A5.prototype,"bakeToReflectionProbe",[b5],Object.getOwnPropertyDescriptor(A5.prototype,"bakeToReflectionProbe"),A5.prototype),k5=A5))||k5),U6=(D5=s6("cc.MeshRenderer"),B5=e6(100),F5=h6(Qi),U5=h6(Qi),x5=h6(D6),G5=h6(B6),j5=h6(VP),H5=h6(Ji),D5(V5=B5((n6=function(t){e(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this).bakeSettings=z5&&z5(),i._mesh=W5&&W5(),i._shadowCastingMode=X5&&X5(),i._shadowReceivingMode=Y5&&Y5(),i._shadowBias=K5&&K5(),i._shadowNormalBias=q5&&q5(),i._reflectionProbeId=Q5&&Q5(),i._reflectionProbeBlendId=J5&&J5(),i._reflectionProbeBlendWeight=Z5&&Z5(),i._enabledGlobalStandardSkinObject=t6&&t6(),i._reflectionProbeDataMap=null,i.SI=[],i._modelType=hC,i._model=null,i.II=null,i._enableMorph=i6&&i6(),Oi.querySettings("rendering","highQualityMode")&&(i._shadowCastingMode=D6.ON,i.bakeSettings.castShadow=!0,i.bakeSettings.receiveShadow=!0),i}return i.onUpdateReceiveDirLight=function(t,i){void 0===i&&(i=!1),this._model&&(i?this._model.receiveDirLight=!1:this.node&&(t&this.node.layer)===this.node.layer||t&this._model.visFlags?this._model.receiveDirLight=!0:this._model.receiveDirLight=!1)},i.No=function(){this._enabledGlobalStandardSkinObject=!1},i.onLoad=function(){this._mesh&&this._mesh.initialize(),this.RI()||this.MI(),this.CI(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateUseLightProbe(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this.NI()},i.onRestore=function(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateUseLightProbe(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this.NI()},i.onEnable=function(){t.prototype.onEnable.call(this),this.node.on("mobility-changed",this.onMobilityChanged,this),this.node.on("light-probe-baking-changed",this.onLightProbeBakingChanged,this),this.bakeSettings.on("use_light_probe_changed",this.onUseLightProbeChanged,this),this.bakeSettings.on("reflection_probe_changed",this.onReflectionProbeChanged,this),this.bakeSettings.on("bake_to_reflection_probe_changed",this.onBakeToReflectionProbeChanged,this),this._model||this._updateModels(),this._model.onGlobalPipelineStateChanged(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateUseLightProbe(),this._updateReceiveDirLight(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData(),this.NI(),this._attachToScene()},i.onDisable=function(){this._model&&this._detachFromScene(),this.node.off("mobility-changed",this.onMobilityChanged,this),this.node.off("light-probe-baking-changed",this.onLightProbeBakingChanged,this),this.bakeSettings.off("use_light_probe_changed",this.onUseLightProbeChanged,this),this.bakeSettings.off("reflection_probe_changed",this.onReflectionProbeChanged,this),this.bakeSettings.off("bake_to_reflection_probe_changed",this.onBakeToReflectionProbeChanged,this)},i.onDestroy=function(){this._model&&(T.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this.II&&this.II.destroy()},i.onGeometryChanged=function(){if(this._model&&this._mesh){var t=this._mesh.struct;this._model.createBoundingShape(t.minPosition,t.maxPosition),this._model.updateWorldBound(),this._model.onGeometryChanged()}},i.getWeight=function(t,i){this.SI.length;var n=this.SI[t];return n.length,n[i]},i.setWeights=function(t,i){var n=this.SI;i>=n.length||n[i].length===t.length&&(n[i]=t.slice(0),this.LI(i))},i.setWeight=function(t,i,n){var r=this.SI;if(!(i>=r.length)){var s=r[i];n>=s.length||(s[n]=t,this.LI(i))}},i.setInstancedAttribute=function(t,i){if(this.model)for(var n=this.model.subModels,r=0;r<n.length;r++)for(var s=n[r].instancedAttributeBlock,e=s.attributes,h=s.views,u=0;u<e.length;u++)if(e[u].name===t){h[u].set(i);break}},i._updateLightmap=function(t,i,n,r,s){this.bakeSettings.texture=t,this.bakeSettings.uvParam.x=i,this.bakeSettings.uvParam.y=n,this.bakeSettings.uvParam.z=r,this.bakeSettings.uvParam.w=s,this._onUpdateLightingmap(),this._updateReceiveDirLight()},i.updateProbeCubemap=function(t){this.bakeSettings.probeCubemap&&this.bakeSettings.probeCubemap===t||(this.bakeSettings.probeCubemap=t,null!==this.model&&this.model.updateReflectionProbeCubemap(this.bakeSettings.probeCubemap))},i.updateProbeBlendCubemap=function(t){this.bakeSettings.probeBlendCubemap&&this.bakeSettings.probeBlendCubemap===t||(this.bakeSettings.probeBlendCubemap=t,null!==this.model&&this.model.updateReflectionProbeBlendCubemap(this.bakeSettings.probeBlendCubemap))},i.updateProbePlanarMap=function(t){this.bakeSettings.probePlanarmap!==t&&(this.bakeSettings.probePlanarmap=t,null!==this.model&&this.model.updateReflectionProbePlanarMap(this.bakeSettings.probePlanarmap))},i.updateReflectionProbeDataMap=function(t){this._reflectionProbeDataMap=t,null!==this.model&&this.model.updateReflectionProbeDataMap(t)},i.updateReflectionProbeId=function(t){this._reflectionProbeId=t,this.model&&(this.model.reflectionProbeId=t),this._onUpdateLocalShadowBiasAndProbeId()},i.updateReflectionProbeBlendId=function(t){this._reflectionProbeBlendId=t,this.model&&(this.model.reflectionProbeBlendId=t),this._onUpdateLocalShadowBiasAndProbeId()},i.updateReflectionProbeBlendWeight=function(t){this._reflectionProbeBlendWeight=t,this.model&&(this.model.reflectionProbeBlendWeight=t),this._onUpdateLocalReflectionProbeData()},i._updateReflectionProbeTexture=function(){if(this.model){var t=this.bakeSettings,i=t.reflectionProbe,n=t.probeBlendCubemap,r=t.probePlanarmap,s=t.probeCubemap;1===i?(this.model.updateReflectionProbeCubemap(s),this.model.updateReflectionProbePlanarMap(null),this.model.updateReflectionProbeBlendCubemap(null)):3===i||4===i?(this.model.updateReflectionProbeCubemap(s),this.model.updateReflectionProbeBlendCubemap(n),this.model.updateReflectionProbePlanarMap(null)):2===i?(this.model.updateReflectionProbePlanarMap(r),this.model.updateReflectionProbeCubemap(null),this.model.updateReflectionProbeBlendCubemap(null)):(this.model.updateReflectionProbeCubemap(null),this.model.updateReflectionProbePlanarMap(null),this.model.updateReflectionProbeBlendCubemap(null))}},i._updateModels=function(){if(this.enabledInHierarchy){var t=this._model;if(t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model){if(this._mesh){var i=this._mesh.struct;this._model.createBoundingShape(i.minPosition,i.maxPosition),this._model.updateWorldBound()}this._model.initLightingmap(this.bakeSettings.texture,this.bakeSettings.uvParam),this._updateUseLightProbe(),this._updateUseReflectionProbeType(),this._updateModelParams(),this._onUpdateLightingmap(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData()}}},i._updateReceiveDirLight=function(){if(this._model){var t=this.node.scene;if(t&&t.renderScene){var i=t.renderScene.mainLight;if(i){var n=i.visibility;if(i.node)if(i.node.mobility===zA.Static){var r=this.node.scene.globals,s=r.lightProbeInfo.data,e=!1;this.bakeSettings.texture&&!r.disableLightmap&&(e=!0),s&&s.hasCoefficients()&&this._model.useLightProbe&&(e=!0),this.onUpdateReceiveDirLight(n,e)}else this.onUpdateReceiveDirLight(n)}}}},i._createModel=function(){var t=this.II&&this._modelType===hC?r6:this._modelType,i=this._model=T.director.root.createModel(t);i.visFlags=this.visibility,i.node=i.transform=this.node,this._models.length=0,this._models.push(i),this.II&&i instanceof r6&&i.setMorphRendering(this.II)},i._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=1,this._model.transform.hasChangedFlags|=1,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,i=this._mesh.renderingSubMeshes;if(i)for(var n=0;n<t;++n){var r=this.getRenderMaterial(n);r&&!r.isValid&&(r=null);var s=i[n];s&&this._model.initSubModel(n,s,r||this._getBuiltinMaterial())}this._model.enabled=!0}},i._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.bakeSettings.texture,this.bakeSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.bakeSettings.uvParam.x,this.bakeSettings.uvParam.y,this.bakeSettings.uvParam.z,this.bakeSettings.uvParam.w])},i._onUpdateLocalShadowBiasAndProbeId=function(){null!==this.model&&(this.model.updateLocalShadowBias(),this.model.updateReflectionProbeId()),this.setInstancedAttribute("a_localShadowBiasAndProbeId",[this._shadowBias,this._shadowNormalBias,this._reflectionProbeId,this._reflectionProbeBlendId])},i._onUpdateLocalReflectionProbeData=function(){1!==this.bakeSettings.reflectionProbe&&3!==this.bakeSettings.reflectionProbe&&4!==this.bakeSettings.reflectionProbe||(null!==this.model&&this.model.updateReflectionProbeId(),this.setInstancedAttribute("a_reflectionProbeData",[this._reflectionProbeBlendWeight,0,0,0]))},i._onUpdateReflectionProbeDataMap=function(){null!==this.model&&this.model.updateReflectionProbeDataMap(this._reflectionProbeDataMap)},i._onMaterialModified=function(t,i){this._model&&this._model.inited&&(this.qh(t,i||this._getBuiltinMaterial()),this.NI())},i.qh=function(t,i){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,i),this._onUpdateLightingmap(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateReflectionProbeTexture(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData())},i._onMeshChanged=function(){},i._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,i=0;i<t.length;++i)this._onMaterialModified(i,null)},i._getBuiltinMaterial=function(){return Fk.get("missing-material")},i._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},i._updateShadowBias=function(){this._model&&(this._model.shadowBias=this._shadowBias)},i._updateShadowNormalBias=function(){this._model&&(this._model.shadowNormalBias=this._shadowNormalBias)},i._updateCastShadow=function(){this._model&&(this._shadowCastingMode===D6.OFF?this._model.castShadow=!1:(this._shadowCastingMode,D6.ON,this._shadowCastingMode,this._model.castShadow=!0))},i._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===B6.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},i.onMobilityChanged=function(){this._updateUseLightProbe(),this._updateReceiveDirLight()},i.onLightProbeBakingChanged=function(){this._updateReceiveDirLight()},i.onUseLightProbeChanged=function(){this._updateUseLightProbe()},i.onReflectionProbeChanged=function(){this._updateUseReflectionProbe(),this._onUpdateLocalShadowBiasAndProbeId();var t=T.internal.reflectionProbeManager,i=this._model;1===this.bakeSettings.reflectionProbe||3===this.bakeSettings.reflectionProbe||4===this.bakeSettings.reflectionProbe?(t.selectReflectionProbe(i),t.getUsedReflectionProbe(i,!1)||st(16302)):2===this.bakeSettings.reflectionProbe&&(t.DI(i),t.getUsedReflectionProbe(i,!0)||st(16302))},i.onBakeToReflectionProbeChanged=function(){this._updateBakeToReflectionProbe()},i._updateUseLightProbe=function(){if(this._model){var t=this.node;this._mesh&&t&&t.mobility===zA.Movable&&this.bakeSettings.useLightProbe?this._model.useLightProbe=!0:this._model.useLightProbe=!1}},i._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var i=this._materials[t];if(i)for(var n=0;n<i.passes.length;++n)if(i.passes[n].batchingScheme)return!0}return!1},i._updateUseReflectionProbe=function(){this._model&&(this._model.reflectionProbeType=this.bakeSettings.reflectionProbe,this._updateReflectionProbeTexture())},i._updateUseReflectionProbeType=function(){this._model&&(this._model.reflectionProbeType=this.bakeSettings.reflectionProbe)},i._updateBakeToReflectionProbe=function(){this._model&&(this._model.bakeToReflectionProbe=this.bakeSettings.bakeToReflectionProbe)},i.CI=function(){if(this.II&&(this.II.destroy(),this.II=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){this.II=this._mesh.morphRendering.createInstance();for(var t=this._mesh.struct.primitives.length,i=0;i<t;++i)this.LI(i);this._model&&this._model instanceof r6&&this._model.setMorphRendering(this.II)}},i.MI=function(){var t=this._mesh;if(this.SI.length=0,t){var i=t.struct.morph;if(i){var n=i.weights;this.SI=i.subMeshMorphs.map((function(t){return t?t.weights?t.weights.slice(0):n?(n.length,t.targets.length,n.slice(0)):new Array(t.targets.length).fill(0):[]}))}}},i.RI=function(){var t=this._mesh,i=this.SI;if(!t||!t.struct.morph)return 0===i.length;var n=t.struct.morph;return n.subMeshMorphs.length===i.length&&i.every((function(t,i){var r,s,e=t.length;return(null!==(r=null==(s=n.subMeshMorphs[i])?void 0:s.targets.length)&&void 0!==r?r:0)===e}))},i.LI=function(t){var i;null==(i=this.II)||i.setWeights(t,this.SI[t])},i.NI=function(){var t=vA();if(this._enabledGlobalStandardSkinObject&&(t.standardSkinMeshRenderer=this,t.standardSkinModel=this.model),!t.skinMaterialModel&&this._model)for(var i=this._model.subModels,n=0;n<i.length;n++)if(!(a6(i[n])<0))return void(t.skinMaterialModel=this._model)},r(n,[{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t,this._updateShadowBias(),this._onUpdateLocalShadowBiasAndProbeId()}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t,this._updateShadowNormalBias(),this._onUpdateLocalShadowBiasAndProbeId()}},{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"shadowCastingModeForInspector",get:function(){return this.shadowCastingMode===D6.ON},set:function(t){this.shadowCastingMode=!0===t?D6.ON:D6.OFF}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"receiveShadowForInspector",get:function(){return this._shadowReceivingMode===B6.ON},set:function(t){this._shadowReceivingMode=!0===t?B6.ON:B6.OFF,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var i=this._mesh,n=this._mesh=t;null==n||n.initialize(),this.MI(),this.CI(),this._onMeshChanged(i),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateUseLightProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}},{key:"isGlobalStandardSkinObject",get:function(){return this._enabledGlobalStandardSkinObject},set:function(t){vA().standardSkinMeshRenderer=t?this:null,this._enabledGlobalStandardSkinObject=t}}]),n}(Dj),n6.ShadowCastingMode=D6,n6.ShadowReceivingMode=B6,z5=uo(($5=n6).prototype,"bakeSettings",[o6],(function(){return new F6})),W5=uo($5.prototype,"_mesh",[o6],(function(){return null})),X5=uo($5.prototype,"_shadowCastingMode",[o6],(function(){return D6.OFF})),Y5=uo($5.prototype,"_shadowReceivingMode",[o6],(function(){return B6.ON})),K5=uo($5.prototype,"_shadowBias",[o6],(function(){return 0})),q5=uo($5.prototype,"_shadowNormalBias",[o6],(function(){return 0})),Q5=uo($5.prototype,"_reflectionProbeId",[o6],(function(){return-1})),J5=uo($5.prototype,"_reflectionProbeBlendId",[o6],(function(){return-1})),Z5=uo($5.prototype,"_reflectionProbeBlendWeight",[o6],(function(){return 0})),t6=uo($5.prototype,"_enabledGlobalStandardSkinObject",[o6],(function(){return!1})),y($5.prototype,"shadowBias",[F5],Object.getOwnPropertyDescriptor($5.prototype,"shadowBias"),$5.prototype),y($5.prototype,"shadowNormalBias",[U5],Object.getOwnPropertyDescriptor($5.prototype,"shadowNormalBias"),$5.prototype),y($5.prototype,"shadowCastingMode",[x5],Object.getOwnPropertyDescriptor($5.prototype,"shadowCastingMode"),$5.prototype),y($5.prototype,"receiveShadow",[G5],Object.getOwnPropertyDescriptor($5.prototype,"receiveShadow"),$5.prototype),y($5.prototype,"mesh",[j5],Object.getOwnPropertyDescriptor($5.prototype,"mesh"),$5.prototype),y($5.prototype,"isGlobalStandardSkinObject",[H5],Object.getOwnPropertyDescriptor($5.prototype,"isGlobalStandardSkinObject"),$5.prototype),i6=uo($5.prototype,"_enableMorph",[o6],(function(){return!0})),V5=$5))||V5)||V5),x6=(f6=_o("cc.Skeleton"),v6=ic([Zi]),l6=ic([ls]),f6((w6=function(t){function i(i){var n;return(n=t.call(this,i)||this)._joints=g6&&g6(),n._bindposes=p6&&p6(),n._hash=_6&&_6(),n.BI=null,n}e(i,t);var n=i.prototype;return n.destroy=function(){var i,n;return null==(i=T.director.root)||null==(n=i.dataPoolManager)||n.releaseSkeleton(this),t.prototype.destroy.call(this)},n.validate=function(){return this.joints.length>0&&this.bindposes.length>0},r(i,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this.BI){this.BI=[];for(var t=0;t<this._bindposes.length;t++){var i=new ls;ls.invert(i,this._bindposes[t]),this.BI.push(i)}}return this.BI}},{key:"hash",get:function(){if(!this._hash){for(var t="",i=0;i<this._bindposes.length;i++){var n=this._bindposes[i];t+=n.m00.toPrecision(2)+" "+n.m01.toPrecision(2)+" "+n.m02.toPrecision(2)+" "+n.m03.toPrecision(2)+" "+n.m04.toPrecision(2)+" "+n.m05.toPrecision(2)+" "+n.m06.toPrecision(2)+" "+n.m07.toPrecision(2)+" "+n.m08.toPrecision(2)+" "+n.m09.toPrecision(2)+" "+n.m10.toPrecision(2)+" "+n.m11.toPrecision(2)+" "+n.m12.toPrecision(2)+" "+n.m13.toPrecision(2)+" "+n.m14.toPrecision(2)+" "+n.m15.toPrecision(2)+"\n"}this._hash=Sv(t,666)}return this._hash}}]),i}(rg),g6=uo(w6.prototype,"_joints",[v6],(function(){return[]})),p6=uo(w6.prototype,"_bindposes",[l6],(function(){return[]})),_6=uo(w6.prototype,"_hash",[Co],(function(){return 0})),d6=w6))||d6);T.Skeleton=x6;var G6,j6,H6,V6,$6,z6,W6,X6,Y6,K6,q6,Q6,J6,Z6,t4,i4,n4,r4,s4,e4,h4,u4,o4,c4,a4,f4,v4,l4,d4,w4,g4,p4,_4,y4,m4,b4,k4,A4,E4,T4,O4,S4,I4,R4,M4,C4,N4,P4,L4,D4,B4,F4,U4,x4,G4,j4,H4,V4,$4,z4,W4,X4,Y4,K4,q4,Q4,J4,Z4,t8,i8,n8,r8,s8,e8,h8,u8,o8,c8,a8,f8,v8,l8,d8,w8,g8,p8,_8,y8,m8,b8,k8,A8,E8,T8,O8,S8,I8=new Ir,R8=_i({LUMINOUS_FLUX:0,LUMINANCE:1}),M8=_o("cc.StaticLightSettings")((m6=function(){function t(){this._baked=b6&&b6(),this._editorOnly=k6&&k6(),this._castShadow=A6&&A6()}return r(t,[{key:"editorOnly",get:function(){return this._editorOnly},set:function(t){this._editorOnly=t}},{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}}]),t}(),b6=uo(m6.prototype,"_baked",[Co],(function(){return!1})),k6=uo(m6.prototype,"_editorOnly",[Co],(function(){return!1})),A6=uo(m6.prototype,"_castShadow",[Co],(function(){return!1})),y6=m6))||y6,C8=(E6=_o("cc.Light"),T6=ic(M8),O6=ic(M_.BitMask),E6((L6=function(t){function i(){var i;return(i=t.call(this)||this)._color=R6&&R6(),i._useColorTemperature=M6&&M6(),i._colorTemperature=C6&&C6(),i._staticSettings=N6&&N6(),i._visibility=P6&&P6(),i._type=5,i._lightType=void 0,i._light=null,i._lightType=fC,i}e(i,t);var n=i.prototype;return n.onLoad=function(){this._createLight()},n.onEnable=function(){this._attachToScene()},n.onDisable=function(){this._detachFromScene()},n.onDestroy=function(){this._destroyLight()},n._createLight=function(){this._light||(this._light=T.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node,this._light.baked=this.baked,this._light.visibility=this.visibility},n._destroyLight=function(){this._light&&(T.director.root.recycleLight(this._light),this._light=null)},n._attachToScene=function(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){var t=this._getRenderScene();switch(this._type){case 0:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case 1:t.addSphereLight(this._light);break;case 2:t.addSpotLight(this._light);break;case 3:t.addPointLight(this._light);break;case 4:t.addRangedDirLight(this._light)}}},n._detachFromScene=function(){if(this._light&&this._light.scene){var t=this._light.scene;switch(this._type){case 0:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case 1:t.removeSphereLight(this._light);break;case 2:t.removeSpotLight(this._light);break;case 3:t.removePointLight(this._light);break;case 4:t.removeRangedDirLight(this._light)}}},n._onUpdateReceiveDirLight=function(){},r(i,[{key:"color",get:function(){return this._color},set:function(t){this._color=t.clone(),this._light&&(I8.x=t.r/255,I8.y=t.g/255,I8.z=t.b/255,this._light.color=I8)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}},{key:"colorTemperature",get:function(){return this._colorTemperature},set:function(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}},{key:"staticSettings",get:function(){return this._staticSettings},set:function(t){this._staticSettings=t}},{key:"type",get:function(){return this._type}},{key:"baked",get:function(){return this.staticSettings.baked},set:function(t){this.staticSettings.baked=t,null!==this._light&&(this._light.baked=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._light&&(this._light.visibility=t),this._onUpdateReceiveDirLight()}}]),i}(Kg),L6.Type=cC,L6.PhotometricTerm=R8,R6=uo((I6=L6).prototype,"_color",[Co],(function(){return Qs.WHITE.clone()})),M6=uo(I6.prototype,"_useColorTemperature",[Co],(function(){return!1})),C6=uo(I6.prototype,"_colorTemperature",[Co],(function(){return 6550})),N6=uo(I6.prototype,"_staticSettings",[Co],(function(){return new M8})),P6=uo(I6.prototype,"_visibility",[Co],(function(){return Ky})),y(I6.prototype,"staticSettings",[T6],Object.getOwnPropertyDescriptor(I6.prototype,"staticSettings"),I6.prototype),y(I6.prototype,"visibility",[O6],Object.getOwnPropertyDescriptor(I6.prototype,"visibility"),I6.prototype),S6=I6))||S6),N8=ko,P8=Co,L8=No,D8=ic;G6=_o("cc.DirectionalLight"),j6=L8("_illuminance"),H6=D8(qi),V6=N8({group:{name:"DynamicShadowSettings",displayOrder:1}}),$6=D8(Ji),z6=N8({group:{name:"DynamicShadowSettings",displayOrder:5}}),W6=D8(kA),X6=N8({group:{name:"DynamicShadowSettings",displayOrder:6}}),Y6=D8(Qi),K6=N8({group:{name:"DynamicShadowSettings",displayOrder:7}}),q6=D8(Qi),Q6=N8({group:{name:"DynamicShadowSettings",displayOrder:8}}),J6=D8(Qi),Z6=N8({group:{name:"DynamicShadowSettings",displayOrder:9}}),t4=D8(Qi),i4=N8({group:{name:"DynamicShadowSettings",displayOrder:22}}),n4=D8(Qi),r4=N8({group:{name:"DynamicShadowSettings",displayOrder:10}}),s4=D8(AA),e4=N8({group:{name:"DynamicShadowSettings",displayOrder:11}}),h4=D8(Ji),u4=N8({group:{name:"DynamicShadowSettings",displayOrder:12}}),o4=D8(Qi),c4=N8({group:{name:"DynamicShadowSettings",displayOrder:13}}),a4=D8(EA),f4=N8({group:{name:"DynamicShadowSettings",displayOrder:14}}),v4=D8(Ji),l4=N8({group:{name:"DynamicShadowSettings",displayOrder:15}}),d4=D8(Qi),w4=N8({group:{name:"DynamicShadowSettings",displayOrder:16}}),g4=D8(Qi),p4=N8({group:{name:"DynamicShadowSettings",displayOrder:17}}),_4=D8(Qi),y4=N8({group:{name:"DynamicShadowSettings",displayOrder:19}}),m4=D8(Ji),b4=N8({group:{name:"DynamicShadowSettings",displayOrder:20}}),k4=D8(Ji),A4=N8({group:{name:"DynamicShadowSettings",displayOrder:21}}),E4=D8(Qi),G6((T4=function(t){function i(){var i;return(i=t.call(this)||this)._illuminanceHDR=O4&&O4(),i._illuminanceLDR=S4&&S4(),i._shadowEnabled=I4&&I4(),i._shadowPcf=R4&&R4(),i._shadowBias=M4&&M4(),i._shadowNormalBias=C4&&C4(),i._shadowSaturation=N4&&N4(),i._shadowDistance=P4&&P4(),i._shadowInvisibleOcclusionRange=L4&&L4(),i._csmLevel=D4&&D4(),i._csmLayerLambda=B4&&B4(),i._csmOptimizationMode=F4&&F4(),i._csmAdvancedOptions=U4&&U4(),i._csmLayersTransition=x4&&x4(),i._csmTransitionRange=G4&&G4(),i._shadowFixedArea=j4&&j4(),i._shadowNear=H4&&H4(),i._shadowFar=V4&&V4(),i._shadowOrthoSize=$4&&$4(),i._lightType=dC,Oi.querySettings("rendering","highQualityMode")&&(i._shadowPcf=kA.SOFT_2X,i._shadowDistance=50,i.enableCSM=!0,i.staticSettings.castShadow=!0),i}e(i,t);var n=i.prototype;return n._createLight=function(){if(t.prototype._createLight.call(this),this._type=0,this._light){var i=this._light;i.illuminanceHDR=this._illuminanceHDR,i.illuminanceLDR=this._illuminanceLDR,i.shadowEnabled=this._shadowEnabled,i.shadowPcf=this._shadowPcf,i.shadowBias=this._shadowBias,i.shadowNormalBias=this._shadowNormalBias,i.shadowSaturation=this._shadowSaturation,i.shadowDistance=this._shadowDistance,i.shadowInvisibleOcclusionRange=this._shadowInvisibleOcclusionRange,i.shadowFixedArea=this._shadowFixedArea,i.shadowNear=this._shadowNear,i.shadowFar=this._shadowFar,i.shadowOrthoSize=this._shadowOrthoSize,i.csmLevel=this._csmLevel,i.csmLayerLambda=this._csmLayerLambda,i.csmOptimizationMode=this._csmOptimizationMode,i.csmLayersTransition=this._csmLayersTransition,i.csmTransitionRange=this._csmTransitionRange}},n._onUpdateReceiveDirLight=function(){if(this._light){t.prototype._onUpdateReceiveDirLight.call(this);var i=this.node.scene;if(i&&i.renderScene&&i.renderScene.mainLight===this._light)for(var n=i.renderScene.models,r=0;r<n.length;r++){var s=n[r];if(s.node){var e=s.node.getComponent(U6);e&&e.onUpdateReceiveDirLight(this._visibility)}}}},r(i,[{key:"illuminance",get:function(){return vA().isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){vA().isHDR?(this._illuminanceHDR=t,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR)):(this._illuminanceLDR=t,this._light&&(this._light.illuminanceLDR=this._illuminanceLDR))}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t,this._light&&(this._light.shadowEnabled=this._shadowEnabled)}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t,this._light&&(this._light.shadowPcf=this._shadowPcf)}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t,this._light&&(this._light.shadowBias=this._shadowBias)}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t,this._light&&(this._light.shadowNormalBias=this._shadowNormalBias)}},{key:"shadowSaturation",get:function(){return this._shadowSaturation},set:function(t){this._shadowSaturation=Gn(t,0,1),this._light&&(this._light.shadowSaturation=this._shadowSaturation)}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(t){this._shadowDistance=Math.min(t,OA.MAX_FAR),this._shadowDistance/.1<10&&st(15003,this._shadowDistance),this._light&&(this._light.shadowDistance=this._shadowDistance,this._light.csmNeedUpdate=!0)}},{key:"shadowInvisibleOcclusionRange",get:function(){return this._shadowInvisibleOcclusionRange},set:function(t){this._shadowInvisibleOcclusionRange=Math.min(t,OA.MAX_FAR),this._light&&(this._light.shadowInvisibleOcclusionRange=this._shadowInvisibleOcclusionRange)}},{key:"csmLevel",get:function(){return this._csmLevel},set:function(t){this._csmLevel=t,this._light&&(this._light.csmLevel=this._csmLevel,this._light.csmNeedUpdate=!0)}},{key:"enableCSM",get:function(){return this._csmLevel>AA.LEVEL_1},set:function(t){this._csmLevel=t?AA.LEVEL_4:AA.LEVEL_1,this._light&&(this._light.csmLevel=this._csmLevel,this._light.csmNeedUpdate=!0)}},{key:"csmLayerLambda",get:function(){return this._csmLayerLambda},set:function(t){this._csmLayerLambda=t,this._light&&(this._light.csmLayerLambda=this._csmLayerLambda,this._light.csmNeedUpdate=!0)}},{key:"csmOptimizationMode",get:function(){return this._csmOptimizationMode},set:function(t){this._csmOptimizationMode=t,this._light&&(this._light.csmOptimizationMode=this._csmOptimizationMode)}},{key:"shadowFixedArea",get:function(){return this._shadowFixedArea},set:function(t){this._shadowFixedArea=t,this._light&&(this._light.shadowFixedArea=this._shadowFixedArea)}},{key:"shadowNear",get:function(){return this._shadowNear},set:function(t){this._shadowNear=t,this._light&&(this._light.shadowNear=this._shadowNear)}},{key:"shadowFar",get:function(){return this._shadowFar},set:function(t){this._shadowFar=Math.min(t,OA.MAX_FAR),this._light&&(this._light.shadowFar=this._shadowFar)}},{key:"shadowOrthoSize",get:function(){return this._shadowOrthoSize},set:function(t){this._shadowOrthoSize=t,this._light&&(this._light.shadowOrthoSize=this._shadowOrthoSize)}},{key:"csmAdvancedOptions",get:function(){return this._csmAdvancedOptions},set:function(t){this._csmAdvancedOptions=t}},{key:"csmLayersTransition",get:function(){return this._csmLayersTransition},set:function(t){this._csmLayersTransition=t,this._light&&(this._light.csmLayersTransition=t)}},{key:"csmTransitionRange",get:function(){return this._csmTransitionRange},set:function(t){this._csmTransitionRange=t,this._light&&(this._light.csmTransitionRange=t)}}]),i}(C8),O4=uo(T4.prototype,"_illuminanceHDR",[N8,j6],(function(){return 65e3})),S4=uo(T4.prototype,"_illuminanceLDR",[P8],(function(){return 65e3*KM.standardExposureValue})),I4=uo(T4.prototype,"_shadowEnabled",[P8],(function(){return!1})),R4=uo(T4.prototype,"_shadowPcf",[P8],(function(){return kA.HARD})),M4=uo(T4.prototype,"_shadowBias",[P8],(function(){return 1e-5})),C4=uo(T4.prototype,"_shadowNormalBias",[P8],(function(){return 0})),N4=uo(T4.prototype,"_shadowSaturation",[P8],(function(){return 1})),P4=uo(T4.prototype,"_shadowDistance",[P8],(function(){return 50})),L4=uo(T4.prototype,"_shadowInvisibleOcclusionRange",[P8],(function(){return 200})),D4=uo(T4.prototype,"_csmLevel",[P8],(function(){return AA.LEVEL_4})),B4=uo(T4.prototype,"_csmLayerLambda",[P8],(function(){return.75})),F4=uo(T4.prototype,"_csmOptimizationMode",[P8],(function(){return EA.RemoveDuplicates})),U4=uo(T4.prototype,"_csmAdvancedOptions",[P8],(function(){return!1})),x4=uo(T4.prototype,"_csmLayersTransition",[P8],(function(){return!1})),G4=uo(T4.prototype,"_csmTransitionRange",[P8],(function(){return.05})),j4=uo(T4.prototype,"_shadowFixedArea",[P8],(function(){return!1})),H4=uo(T4.prototype,"_shadowNear",[P8],(function(){return.1})),V4=uo(T4.prototype,"_shadowFar",[P8],(function(){return 10})),$4=uo(T4.prototype,"_shadowOrthoSize",[P8],(function(){return 5})),y(T4.prototype,"illuminance",[H6],Object.getOwnPropertyDescriptor(T4.prototype,"illuminance"),T4.prototype),y(T4.prototype,"shadowEnabled",[V6,$6],Object.getOwnPropertyDescriptor(T4.prototype,"shadowEnabled"),T4.prototype),y(T4.prototype,"shadowPcf",[z6,W6],Object.getOwnPropertyDescriptor(T4.prototype,"shadowPcf"),T4.prototype),y(T4.prototype,"shadowBias",[X6,Y6],Object.getOwnPropertyDescriptor(T4.prototype,"shadowBias"),T4.prototype),y(T4.prototype,"shadowNormalBias",[K6,q6],Object.getOwnPropertyDescriptor(T4.prototype,"shadowNormalBias"),T4.prototype),y(T4.prototype,"shadowSaturation",[Q6,J6],Object.getOwnPropertyDescriptor(T4.prototype,"shadowSaturation"),T4.prototype),y(T4.prototype,"shadowDistance",[Z6,t4],Object.getOwnPropertyDescriptor(T4.prototype,"shadowDistance"),T4.prototype),y(T4.prototype,"shadowInvisibleOcclusionRange",[i4,n4],Object.getOwnPropertyDescriptor(T4.prototype,"shadowInvisibleOcclusionRange"),T4.prototype),y(T4.prototype,"csmLevel",[r4,s4],Object.getOwnPropertyDescriptor(T4.prototype,"csmLevel"),T4.prototype),y(T4.prototype,"enableCSM",[e4,h4],Object.getOwnPropertyDescriptor(T4.prototype,"enableCSM"),T4.prototype),y(T4.prototype,"csmLayerLambda",[u4,o4],Object.getOwnPropertyDescriptor(T4.prototype,"csmLayerLambda"),T4.prototype),y(T4.prototype,"csmOptimizationMode",[c4,a4],Object.getOwnPropertyDescriptor(T4.prototype,"csmOptimizationMode"),T4.prototype),y(T4.prototype,"shadowFixedArea",[f4,v4],Object.getOwnPropertyDescriptor(T4.prototype,"shadowFixedArea"),T4.prototype),y(T4.prototype,"shadowNear",[l4,d4],Object.getOwnPropertyDescriptor(T4.prototype,"shadowNear"),T4.prototype),y(T4.prototype,"shadowFar",[w4,g4],Object.getOwnPropertyDescriptor(T4.prototype,"shadowFar"),T4.prototype),y(T4.prototype,"shadowOrthoSize",[p4,_4],Object.getOwnPropertyDescriptor(T4.prototype,"shadowOrthoSize"),T4.prototype),y(T4.prototype,"csmAdvancedOptions",[y4,m4],Object.getOwnPropertyDescriptor(T4.prototype,"csmAdvancedOptions"),T4.prototype),y(T4.prototype,"csmLayersTransition",[b4,k4],Object.getOwnPropertyDescriptor(T4.prototype,"csmLayersTransition"),T4.prototype),y(T4.prototype,"csmTransitionRange",[A4,E4],Object.getOwnPropertyDescriptor(T4.prototype,"csmTransitionRange"),T4.prototype),T4)),z4=_o("cc.SphereLight"),W4=No("_luminance"),X4=ic(qi),Y4=ic(qi),K4=ic(R8),q4=ic(Qi),Q4=ic(Qi),z4((J4=function(t){function i(){var i;return(i=t.call(this)||this)._size=Z4&&Z4(),i._luminanceHDR=t8&&t8(),i._luminanceLDR=i8&&i8(),i._term=n8&&n8(),i._range=r8&&r8(),i._lightType=wC,i}return e(i,t),i.prototype._createLight=function(){t.prototype._createLight.call(this),this._type=1,this.size=this._size,this.range=this._range,this._light&&(this._light.luminanceHDR=this._luminanceHDR,this._light.luminanceLDR=this._luminanceLDR)},r(i,[{key:"luminousFlux",get:function(){return vA().isHDR?this._luminanceHDR*aC(this._size):this._luminanceLDR},set:function(t){var i=0;vA().isHDR?(this._luminanceHDR=t/aC(this._size),i=this._luminanceHDR):(this._luminanceLDR=t,i=this._luminanceLDR),this._light&&(this._light.luminance=i)}},{key:"luminance",get:function(){return vA().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){vA().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),i}(C8),Z4=uo(J4.prototype,"_size",[Co],(function(){return.15})),t8=uo(J4.prototype,"_luminanceHDR",[Co,W4],(function(){return 1700/aC(.15)})),i8=uo(J4.prototype,"_luminanceLDR",[Co],(function(){return 1700/aC(.15)*KM.standardExposureValue*KM.standardLightMeterScale})),n8=uo(J4.prototype,"_term",[Co],(function(){return R8.LUMINOUS_FLUX})),r8=uo(J4.prototype,"_range",[Co],(function(){return 1})),y(J4.prototype,"luminousFlux",[X4],Object.getOwnPropertyDescriptor(J4.prototype,"luminousFlux"),J4.prototype),y(J4.prototype,"luminance",[Y4],Object.getOwnPropertyDescriptor(J4.prototype,"luminance"),J4.prototype),y(J4.prototype,"term",[K4],Object.getOwnPropertyDescriptor(J4.prototype,"term"),J4.prototype),y(J4.prototype,"size",[q4],Object.getOwnPropertyDescriptor(J4.prototype,"size"),J4.prototype),y(J4.prototype,"range",[Q4],Object.getOwnPropertyDescriptor(J4.prototype,"range"),J4.prototype),J4));var B8,F8,U8,x8,G8,j8,H8,V8,$8,z8,W8,X8,Y8,K8,q8,Q8,J8,Z8=ic,t9=Co,i9=No,n9=ko;s8=_o("cc.SpotLight"),e8=i9("_luminance"),h8=Z8(R8),u8=Z8(Qi),o8=n9({group:{name:"DynamicShadowSettings",displayOrder:1}}),c8=Z8(Ji),a8=n9({group:{name:"DynamicShadowSettings",displayOrder:2}}),f8=Z8(kA),v8=n9({group:{name:"DynamicShadowSettings",displayOrder:3}}),l8=Z8(Qi),d8=n9({group:{name:"DynamicShadowSettings",displayOrder:4}}),w8=Z8(Qi),s8((g8=function(t){function i(){var i;return(i=t.call(this)||this)._size=p8&&p8(),i._luminanceHDR=_8&&_8(),i._luminanceLDR=y8&&y8(),i._term=m8&&m8(),i._range=b8&&b8(),i._spotAngle=k8&&k8(),i._angleAttenuationStrength=A8&&A8(),i._shadowEnabled=E8&&E8(),i._shadowPcf=T8&&T8(),i._shadowBias=O8&&O8(),i._shadowNormalBias=S8&&S8(),i._lightType=kC,i}return e(i,t),i.prototype._createLight=function(){if(t.prototype._createLight.call(this),this._type=2,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle,this.angleAttenuationStrength=this._angleAttenuationStrength,this._light){var i=this._light;i.luminanceHDR=this._luminanceHDR,i.luminanceLDR=this._luminanceLDR,i.shadowEnabled=this._shadowEnabled,i.shadowPcf=this._shadowPcf,i.shadowBias=this._shadowBias,i.shadowNormalBias=this._shadowNormalBias}},r(i,[{key:"luminousFlux",get:function(){return vA().isHDR?this._luminanceHDR*aC(this._size):this._luminanceLDR},set:function(t){var i=0;vA().isHDR?(this._luminanceHDR=t/aC(this._size),i=this._luminanceHDR):(this._luminanceLDR=t,i=this._luminanceLDR),this._light&&(this._light.luminance=i)}},{key:"luminance",get:function(){return vA().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){vA().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light&&(this._light.spotAngle=Vn(t))}},{key:"angleAttenuationStrength",get:function(){return this._angleAttenuationStrength},set:function(t){this._angleAttenuationStrength=t,this._light&&(this._light.angleAttenuationStrength=t)}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t,this._light&&(this._light.shadowEnabled=t)}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t,this._light&&(this._light.shadowPcf=t)}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t,this._light&&(this._light.shadowBias=t)}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t,this._light&&(this._light.shadowNormalBias=t)}}]),i}(C8),p8=uo(g8.prototype,"_size",[t9],(function(){return.15})),_8=uo(g8.prototype,"_luminanceHDR",[t9,e8],(function(){return 1700/aC(.15)})),y8=uo(g8.prototype,"_luminanceLDR",[t9],(function(){return 1700/aC(.15)*KM.standardExposureValue*KM.standardLightMeterScale})),m8=uo(g8.prototype,"_term",[t9],(function(){return R8.LUMINOUS_FLUX})),b8=uo(g8.prototype,"_range",[t9],(function(){return 1})),k8=uo(g8.prototype,"_spotAngle",[t9],(function(){return 60})),A8=uo(g8.prototype,"_angleAttenuationStrength",[t9],(function(){return 0})),E8=uo(g8.prototype,"_shadowEnabled",[t9],(function(){return!1})),T8=uo(g8.prototype,"_shadowPcf",[t9],(function(){return kA.HARD})),O8=uo(g8.prototype,"_shadowBias",[t9],(function(){return 1e-5})),S8=uo(g8.prototype,"_shadowNormalBias",[t9],(function(){return 0})),y(g8.prototype,"term",[h8],Object.getOwnPropertyDescriptor(g8.prototype,"term"),g8.prototype),y(g8.prototype,"size",[u8],Object.getOwnPropertyDescriptor(g8.prototype,"size"),g8.prototype),y(g8.prototype,"shadowEnabled",[o8,c8],Object.getOwnPropertyDescriptor(g8.prototype,"shadowEnabled"),g8.prototype),y(g8.prototype,"shadowPcf",[a8,f8],Object.getOwnPropertyDescriptor(g8.prototype,"shadowPcf"),g8.prototype),y(g8.prototype,"shadowBias",[v8,l8],Object.getOwnPropertyDescriptor(g8.prototype,"shadowBias"),g8.prototype),y(g8.prototype,"shadowNormalBias",[d8,w8],Object.getOwnPropertyDescriptor(g8.prototype,"shadowNormalBias"),g8.prototype),g8)),B8=_o("cc.PointLight"),F8=No("_luminance"),U8=ic(qi),x8=ic(qi),G8=ic(R8),j8=ic(Qi),B8((H8=function(t){function i(){var i;return(i=t.call(this)||this)._luminanceHDR=V8&&V8(),i._luminanceLDR=$8&&$8(),i._term=z8&&z8(),i._range=W8&&W8(),i._lightType=AC,i}return e(i,t),i.prototype._createLight=function(){t.prototype._createLight.call(this),this._type=3,this.range=this._range,this._light&&(this._light.luminanceHDR=this._luminanceHDR,this._light.luminanceLDR=this._luminanceLDR)},r(i,[{key:"luminousFlux",get:function(){return vA().isHDR?this._luminanceHDR*aC(1):this._luminanceLDR},set:function(t){var i=0;vA().isHDR?(this._luminanceHDR=t/aC(1),i=this._luminanceHDR):(this._luminanceLDR=t,i=this._luminanceLDR),this._light&&(this._light.luminance=i)}},{key:"luminance",get:function(){return vA().isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){vA().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),i}(C8),V8=uo(H8.prototype,"_luminanceHDR",[Co,F8],(function(){return 1700/aC(.15)})),$8=uo(H8.prototype,"_luminanceLDR",[Co],(function(){return 1700/aC(.15)*KM.standardExposureValue*KM.standardLightMeterScale})),z8=uo(H8.prototype,"_term",[Co],(function(){return R8.LUMINOUS_FLUX})),W8=uo(H8.prototype,"_range",[Co],(function(){return 1})),y(H8.prototype,"luminousFlux",[U8],Object.getOwnPropertyDescriptor(H8.prototype,"luminousFlux"),H8.prototype),y(H8.prototype,"luminance",[x8],Object.getOwnPropertyDescriptor(H8.prototype,"luminance"),H8.prototype),y(H8.prototype,"term",[G8],Object.getOwnPropertyDescriptor(H8.prototype,"term"),H8.prototype),y(H8.prototype,"range",[j8],Object.getOwnPropertyDescriptor(H8.prototype,"range"),H8.prototype),H8)),X8=_o("cc.RangedDirectionalLight"),Y8=No("_illuminance"),K8=ic(qi),X8((q8=function(t){function i(){var i;return(i=t.call(this)||this)._illuminanceHDR=Q8&&Q8(),i._illuminanceLDR=J8&&J8(),i._lightType=TC,i}return e(i,t),i.prototype._createLight=function(){t.prototype._createLight.call(this),this._type=4,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR,this._light.illuminanceLDR=this._illuminanceLDR)},r(i,[{key:"illuminance",get:function(){return vA().isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){vA().isHDR?(this._illuminanceHDR=t,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR)):(this._illuminanceLDR=t,this._light&&(this._light.illuminanceLDR=this._illuminanceLDR))}}]),i}(C8),Q8=uo(q8.prototype,"_illuminanceHDR",[ko,Y8],(function(){return 65e3})),J8=uo(q8.prototype,"_illuminanceLDR",[Co],(function(){return 65e3*KM.standardExposureValue})),y(q8.prototype,"illuminance",[K8],Object.getOwnPropertyDescriptor(q8.prototype,"illuminance"),q8.prototype),q8));var r9=new ls;function s9(t,i,n){for(ls.identity(n);t!==i;)ls.fromRTS(r9,t.rotation,t.position,t.scale),ls.multiply(n,r9,n),t=t.parent;return n}var e9=new Ql(1,1,0,2,2,2),h9=function(t,i,n){t[i+0]=n.m00,t[i+1]=n.m01,t[i+2]=n.m02,t[i+3]=n.m12,t[i+4]=n.m04,t[i+5]=n.m05,t[i+6]=n.m06,t[i+7]=n.m13,t[i+8]=n.m08,t[i+9]=n.m09,t[i+10]=n.m10,t[i+11]=n.m14};function u9(t){return 2&t.getFormatFeatures(44)?44:35}function o9(t,i){var n=4/Math.sqrt(i);return 12*Math.ceil(Math.max(480*n,t)/12)}new Qr,new Qr,new Ir,new Qr,new Ir;var c9=new Ir,a9=new Ir,f9=new Ir,v9=new Ir,l9=new ls,d9=new ls,w9=new Mh,g9=Number.MAX_SAFE_INTEGER,p9=function(){function t(t){this.Rh=void 0,this.T=void 0,this.FI=new Map,this.Fb=void 0,this.xI=void 0,this.GI=void 0,this.jI=new Map,this.Rh=t;var i=u9(this.Rh);this.Fb=Fd[i].size,this.xI=48/this.Fb,this.T=new Bx(t),this.T.initialize({format:i,roundUpFn:o9}),this.GI=new Bx(t),this.GI.initialize({format:i,roundUpFn:o9})}var i=t.prototype;return i.clear=function(){this.T.destroy(),this.FI.clear()},i.registerCustomTextureLayouts=function(t){for(var i=0;i<t.length;i++){var n=t[i],r=n.textureLength;2&this.Rh.getFormatFeatures(44)||(r*=2);for(var s=this.GI.createChunk(r),e=0;e<n.contents.length;e++){var h=n.contents[e],u=h.skeleton;this.jI.set(u,s);for(var o=0;o<h.clips.length;o++){var c=h.clips[o];this.jI.set(u^c,s)}}}},i.getDefaultPoseTexture=function(t,i,n){var r=0^t.hash,s=this.FI.get(r)||null;if(s&&s.bounds.has(i.hash))return s.refCount++,s;var e=t.joints,h=t.bindposes,u=null,o=!1,c=e.length;if(s)s.refCount++;else{var a=12*c,f=this.jI.get(r),v=void 0!==f?this.GI.alloc(4*a,f):this.T.alloc(4*a);if(!v)return s;s={pixelOffset:v.start/this.Fb,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:v},u=new Float32Array(a),o=!0}Ir.set(f9,g9,g9,g9),Ir.set(v9,-g9,-g9,-g9);for(var l=i.getBoneSpaceBounds(t),d=0,w=0;d<c;d++,w+=12){var g=n.getChildByPath(e[d]),p=g?s9(g,n,l9):t.inverseBindposes[d],_=l[d];_&&(Mh.transform(w9,_,p),w9.getBoundary(c9,a9),Ir.min(f9,f9,c9),Ir.max(v9,v9,a9)),o&&(g&&ls.multiply(p,p,h[d]),h9(u,w,g?p:ls.IDENTITY))}var y=[new Mh];return s.bounds.set(i.hash,y),Mh.fromPoints(y[0],f9,v9),o&&(this.T.update(s.handle,u.buffer),this.FI.set(r,s)),s},i.getSequencePoseTexture=function(t,i,n,r){var s=t.hash^i.hash,e=this.FI.get(s)||null;if(e&&e.bounds.has(n.hash))return e.refCount++,e;var h=t.joints,u=t.bindposes,o=TX.getOrExtract(i).frames,c=null,a=!1,f=h.length;if(e)e.refCount++;else{var v=12*f*o,l=this.jI.get(s),d=void 0!==l?this.GI.alloc(4*v,l):this.T.alloc(4*v);if(!d)return null;var w=this.HI(t,i,r);e={pixelOffset:d.start/this.Fb,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:i.hash,readyToBeDeleted:!1,handle:d,animInfos:w},c=new Float32Array(v),a=!0}var g=n.getBoneSpaceBounds(t),p=[];e.bounds.set(n.hash,p);for(var _=0;_<o;_++)p.push(new Mh(g9,g9,g9,-g9,-g9,-g9));for(var y=0,m=0;y<o;y++){for(var b=p[y],k=0;k<f;k++,m+=12){var A=e.animInfos[k],E=A.curveData,T=A.downstream,O=A.bindposeIdx,S=A.bindposeCorrection,I=void 0,R=!0;E&&T?I=ls.multiply(l9,E[y],T):E?I=E[y]:T?I=T:(I=t.inverseBindposes[O],R=!1);var M=g[k];if(M){var C=S?ls.multiply(d9,I,S):I;Mh.transform(w9,M,C),w9.getBoundary(c9,a9),Ir.min(b.center,b.center,c9),Ir.max(b.halfExtents,b.halfExtents,a9)}a&&(R&&ls.multiply(l9,I,u[O]),h9(c,m,R?l9:ls.IDENTITY))}Mh.fromPoints(b,b.center,b.halfExtents)}return a&&(this.T.update(e.handle,c.buffer),this.FI.set(s,e)),e},i.releaseHandle=function(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){var i=t.skeletonHash^t.clipHash;(void 0!==this.jI.get(i)?this.GI:this.T).free(t.handle),this.FI.get(i)===t&&this.FI.delete(i)}},i.releaseSkeleton=function(t){for(var i=this.FI.values(),n=i.next();!n.done;){var r=n.value;r.skeletonHash===t.hash&&(r.readyToBeDeleted=!0,r.refCount?this.FI.delete(r.skeletonHash^r.clipHash):this.releaseHandle(r)),n=i.next()}},i.releaseAnimationClip=function(t){for(var i=this.FI.values(),n=i.next();!n.done;){var r=n.value;r.clipHash===t.hash&&(r.readyToBeDeleted=!0,r.refCount?this.FI.delete(r.skeletonHash^r.clipHash):this.releaseHandle(r)),n=i.next()}},i.HI=function(t,i,n){for(var r=[],s=t.joints,e=t.bindposes,h=s.length,u=TX.getOrExtract(i),o=0;o<h;o++){for(var c=s[o],a=u.joints[c],f=n.getChildByPath(c),v=void 0,l=void 0;!a;){var d=c.lastIndexOf("/");if(c=c.substring(0,d),a=u.joints[c],f?(v||(v=new ls),ls.fromRTS(l9,f.rotation,f.position,f.scale),ls.multiply(v,l9,v),f=f.parent):l=c,d<0)break}var w=o,g=void 0;if(void 0!==l&&a){w=o-1;for(var p=0;p<h;p++)if(s[p]===l){w=p,g=new ls,ls.multiply(g,e[p],t.inverseBindposes[o]);break}}r.push({curveData:a&&a.transforms,downstream:v,bindposeIdx:w,bindposeCorrection:g})}return r},r(t,[{key:"pixelsPerJoint",get:function(){return this.xI}}]),t}(),_9=function(){function t(t){this.T=new Map,this.Rh=void 0,this.Rh=t}var i=t.prototype;return i.getData=function(t){void 0===t&&(t="-1");var i=this.T.get(t);if(i)return i;var n=this.Rh.createBuffer(new $l(18,3,ey.SIZE,ey.SIZE)),r=new Float32Array([0,0,0,0]);n.update(r);var s={buffer:n,data:r,dirty:!1,dirtyForJSB:new Uint8Array([0]),currentClip:null};return this.T.set(t,s),s},i.destroy=function(t){var i=this.T.get(t);i&&(i.buffer.destroy(),this.T.delete(t))},i.switchClip=function(t,i){return t.currentClip=i,t.data[0]=0,t.buffer.update(t.data),t.dirty=!1,t},i.clear=function(){for(var t,i=w(this.T.values());!(t=i()).done;)t.value.buffer.destroy();this.T.clear()},t}(),y9=[],m9=new Map;function b9(t,i){for(var n=0,r=ls.IDENTITY;t;){if(t.stamp===i||t.stamp+1===i&&!t.node.hasChangedFlags){r=t.world,t.stamp=i;break}t.stamp=i,y9[n++]=t,t=t.parent}for(;n>0;){t=y9[--n],y9[n]=null;var s=t.node;ls.fromRTS(t.local,s.rotation,s.position,s.scale),r=ls.multiply(t.world,r,t.local)}return r}function k9(t,i){for(var n,r=null,s=0;t!==i;){var e=t.uuid;if(m9.has(e)){r=m9.get(e);break}r={node:t,local:new ls,world:new ls,stamp:-1,parent:null},m9.set(e,r),y9[s++]=r,t=t.parent,r=null}for(;s>0;)n=y9[--s],y9[s]=null,n.parent=r,r=n;return r}function A9(t){for(var i=m9.get(t.uuid)||null;i;)m9.delete(i.node.uuid),i=i.parent}var E9=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_REAL_TIME_JOINT_TEXTURE",value:!1}],T9=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_REAL_TIME_JOINT_TEXTURE",value:!0}];function O9(t,i,n,r){for(var s=0;s<n.length;s++){for(var e=n[s],h=-1,u=0;u<e.length;u++)if(e[u]===r){h=u;break}h>=0&&(i.push(s),t.push(h))}}var S9=new Ir,I9=new Ir,R9=new Ir,M9=new Ir,C9=new ls,N9=new Mh,P9=function(){this._format=44,this._textures=[],this._buffers=[]};P9.WIDTH=256,P9.HEIGHT=3;var L9,D9,B9,F9,U9,x9,G9,j9,H9,V9,$9,z9,W9,X9,Y9,K9,q9,Q9,J9,Z9,t7,i7,n7,r7,s7,e7,h7,u7,o7,c7,a7,f7,v7=function(t){function i(){var i;return(i=t.call(this)||this).nr=[],i.VI=[],i.$I=[],i.zI=null,i.WI=new P9,i.XI=!1,i.type=1,i}e(i,t);var n=i.prototype;return n.destroy=function(){if(this.bindSkeleton(),this.nr.length){for(var i=0;i<this.nr.length;i++)this.nr[i].destroy();this.nr.length=0}this.VI.length=0,this.WI._textures.forEach((function(t){t.destroy()})),this.WI._textures.length=0,this.WI._buffers.length=0,t.prototype.destroy.call(this)},n.uploadAnimation=function(){},n.bindSkeleton=function(t,i,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null);for(var r=0;r<this.$I.length;r++)A9(this.$I[r].target);if(this.zI=null,this.$I.length=0,t&&i&&n){this.XI=!1,uy.JOINT_UNIFORM_CAPACITY<t.joints.length&&(this.XI=!0),this.transform=i;var s=n.getBoneSpaceBounds(t),e=n.struct.jointMaps;this.YI(e&&e.length||1),this.zI=n.jointBufferIndices,this.KI();for(var h=0;h<t.joints.length;h++){var u=s[h],o=i.getChildByPath(t.joints[h]);if(u&&o){var c=k9(o,i),a=t.bindposes[h],f=[],v=[];e?O9(f,v,e,h):(f.push(h),v.push(0)),this.$I.push({indices:f,buffers:v,bound:u,target:o,bindpose:a,transform:c})}}}},n.updateTransform=function(t){var i=this.transform;(i.hasChangedFlags||i.isTransformDirty())&&(i.updateWorldTransform(),this._localDataUpdated=!0),Ir.set(S9,1/0,1/0,1/0),Ir.set(I9,-1/0,-1/0,-1/0);for(var n=0;n<this.$I.length;n++){var r=this.$I[n],s=r.bound,e=b9(r.transform,t);Mh.transform(N9,s,e),N9.getBoundary(R9,M9),Ir.min(S9,S9,R9),Ir.max(I9,I9,M9)}var h=this._worldBounds;this._modelBounds&&h&&(Mh.fromPoints(this._modelBounds,S9,I9),this._modelBounds.transform(i._mat,i._pos,i._rot,i._scale,this._worldBounds))},n.updateUBOs=function(i){t.prototype.updateUBOs.call(this,i);for(var n=0;n<this.$I.length;n++){var r=this.$I[n],s=r.indices,e=r.buffers,h=r.transform,u=r.bindpose;ls.multiply(C9,h.world,u);for(var o=0;o<e.length;o++)h9(this.VI[e[o]],12*s[o],C9)}if(this.XI)this.qI();else for(var c=0;c<this.nr.length;c++)this.nr[c].update(this.VI[c]);return!0},n.initSubModel=function(i,n,r){var s=n.vertexBuffers,e=n.iaInfo;e.vertexBuffers=n.jointMappedBuffers,t.prototype.initSubModel.call(this,i,n,r),e.vertexBuffers=s},n.getMacroPatches=function(i){var n=t.prototype.getMacroPatches.call(this,i),r=E9;return this.XI&&(r=T9),n?r.concat(n):r},n._updateLocalDescriptors=function(i,n){t.prototype._updateLocalDescriptors.call(this,i,n);var r=this.zI[i];if(this.XI)this.QI(r,n);else{var s=this.nr[r];s&&n.bindBuffer(uy.BINDING,s)}},n._updateInstancedAttributes=function(i,n){0!==n.passes[0].batchingScheme&&st(3936,this.node.getPathInHierarchy()),t.prototype._updateInstancedAttributes.call(this,i,n)},n.YI=function(t){if(this.nr.length){for(var i=0;i<this.nr.length;i++)this.nr[i].destroy();this.nr.length=0}if(this.VI.length&&(this.VI.length=0),this.XI)for(var n=0;n<t;n++){var r=P9.WIDTH;this.VI[n]=new Float32Array(12*r)}else for(var s=0;s<t;s++){this.nr[s]=this._device.createBuffer(new $l(18,3,uy.SIZE,uy.SIZE));var e=uy.JOINT_UNIFORM_CAPACITY;this.VI[s]=new Float32Array(12*e)}},n.KI=function(){if(this.WI._textures.length&&(this.WI._textures.forEach((function(t){t.destroy()})),this.WI._textures.length=0),this.WI._buffers.length=0,this.XI){var t=xN.root.device,i=P9.WIDTH,n=P9.HEIGHT;!(2&t.getFormatFeatures(44))&&(this.WI._format=35,i=4*P9.WIDTH);for(var r=this.WI._textures,s=this.WI._buffers,e=this.WI._format,h=0;h<this.VI.length;h++){s[h]=new Float32Array(4*P9.HEIGHT*P9.WIDTH);var u=s[h],o=44===e?u:new Uint8Array(u.buffer),c=new mg({width:i,height:n,_data:o,_compressed:!1,format:e}),a=new f_;a.setFilters(1,1),a.setMipFilter(0),a.setWrapMode(2,2,2),a.image=c,r[h]=a}}},n.QI=function(t,i){if(this.XI){var n=this.WI._textures[t];if(n){var r=n.getGFXTexture(),s=n.getGFXSampler();i.bindTexture(7,r),i.bindSampler(7,s)}}},n.qI=function(){if(this.XI)for(var t=this.WI._textures,i=this.WI._buffers,n=0;n<t.length;n++){for(var r=i[n],s=this.VI[n],e=s.length/12,h=0,u=0,o=0;o<e;o++)u=4*o,r[u++]=s[h++],r[u++]=s[h++],r[u++]=s[h++],r[u++]=s[h++],u=4*(o+P9.WIDTH),r[u++]=s[h++],r[u++]=s[h++],r[u++]=s[h++],r[u++]=s[h++],u=4*(o+2*P9.WIDTH),r[u++]=s[h++],r[u++]=s[h++],r[u++]=s[h++],r[u++]=s[h++];var c=44===this.WI._format?r:new Uint8Array(r.buffer);t[n].uploadData(c)}},i}(r6),l7=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],d7=function(t){function i(){var i;(i=t.call(this)||this).uploadedAnim=void 0,i.JI=void 0,i.ZI=null,i.Vg=null,i.tR=void 0,i.iR=-1,i.type=2,i.tR=T.director.root.dataPoolManager;var n=new Float32Array(4),r=i.tR.jointAnimationInfo.getData();return i.JI={buffer:null,jointTextureInfo:n,animInfo:r,texture:null,boundsInfo:null},i}e(i,t);var n=i.prototype;return n.destroy=function(){this.uploadedAnim=void 0,this.JI.boundsInfo=null,this.JI.buffer&&(this.JI.buffer.destroy(),this.JI.buffer=null),this._applyJointTexture(),t.prototype.destroy.call(this)},n.bindSkeleton=function(t,i,n){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null),this.ZI=t,this.Vg=n,t&&i&&n){this.transform=i;var r=this.tR;this.JI.animInfo=r.jointAnimationInfo.getData(i.uuid),this.JI.buffer||(this.JI.buffer=this._device.createBuffer(new $l(18,1,sy.SIZE,sy.SIZE)))}},n.updateTransform=function(i){if(t.prototype.updateTransform.call(this,i),this.uploadedAnim){var n=this.JI,r=n.animInfo,s=n.boundsInfo[r.data[0]],e=this._worldBounds;if(e&&s){var h=this.transform;s.transform(h._mat,h._pos,h._rot,h._scale,e)}}},n.updateUBOs=function(i){t.prototype.updateUBOs.call(this,i);for(var n=this.JI.animInfo,r=!1,s=this.iR,e=0;e<this._subModels.length;e++){var h=this._subModels[e];s>=0?h.instancedAttributeBlock.views[s][0]=n.data[0]:r=!0}return r&&n.dirty&&(n.buffer.update(n.data),n.dirty=!1),!0},n.getMacroPatches=function(i){var n=t.prototype.getMacroPatches.call(this,i);return n?n.concat(l7):l7},n.uploadAnimation=function(t){if(this.ZI&&this.Vg&&this.uploadedAnim!==t){this.uploadedAnim=t;var i=this.tR,n=null;t?(n=i.jointTexturePool.getSequencePoseTexture(this.ZI,t,this.Vg,this.transform),this.JI.boundsInfo=n&&n.bounds.get(this.Vg.hash),this._modelBounds=null):(n=i.jointTexturePool.getDefaultPoseTexture(this.ZI,this.Vg,this.transform),this.JI.boundsInfo=null,this._modelBounds=n&&n.bounds.get(this.Vg.hash)[0]),this._applyJointTexture(n)}},n._applyJointTexture=function(t){void 0===t&&(t=null);var i=this.JI.texture;if(i&&i!==t&&this.tR.jointTexturePool.releaseHandle(i),this.JI.texture=t,t){var n=this.JI,r=n.buffer,s=n.jointTextureInfo;s[0]=t.handle.texture.width,s[1]=this.ZI.joints.length,s[2]=t.pixelOffset+.1,s[3]=1/s[0],this.nR(),r&&r.update(s);for(var e=t.handle.texture,h=0;h<this._subModels.length;++h)this._subModels[h].descriptorSet.bindTexture(7,e)}},n._updateLocalDescriptors=function(i,n){t.prototype._updateLocalDescriptors.call(this,i,n);var r=this.JI,s=r.buffer,e=r.texture,h=r.animInfo;if(n.bindBuffer(sy.BINDING,s),n.bindBuffer(ey.BINDING,h.buffer),e){var u=this._device.getSampler(e9);n.bindTexture(7,e.handle.texture),n.bindSampler(7,u)}},n._updateInstancedAttributes=function(i,n){t.prototype._updateInstancedAttributes.call(this,i,n),this.iR=n.getInstancedAttributeIndex(hy),this.nR()},n.nR=function(){for(var t=this.JI,i=t.jointTextureInfo,n=t.animInfo,r=this.iR,s=0;s<this._subModels.length;s++){var e=this._subModels[s].instancedAttributeBlock.views;if(r>=0&&e.length>0){var h=e[r];h[0]=n.data[0],h[1]=i[1],h[2]=i[2]}}},i}(r6),w7=(L9=_o("cc.SkinnedMeshRenderer"),D9=mo(100),B9=ic(x6),F9=ic(WE),U9=ic(x6),x9=ic(WE),L9(G9=D9((j9=function(t){function i(){var i;return(i=t.call(this)||this)._skeleton=H9&&H9(),i._skinningRoot=V9&&V9(),i._clip=null,i.associatedAnimation=null,i._modelType=d7,i}e(i,t);var n=i.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this),this.rR()},n.onDestroy=function(){this.associatedAnimation&&(this.associatedAnimation.notifySkinnedMeshRemoved(this),this.associatedAnimation),t.prototype.onDestroy.call(this)},n.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},n.setUseBakedAnimation=function(t,i){void 0===t&&(t=!0),void 0===i&&(i=!1);var n=t?d7:v7;(i||this._modelType!==n)&&(this._modelType=n,this._model&&(T.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateUseLightProbe(),this.enabledInHierarchy&&this._attachToScene()))},n.setSharedMaterial=function(i,n){t.prototype.setSharedMaterial.call(this,i,n),this._modelType===v7&&this.getMaterialInstance(n)},n._updateModelParams=function(){this.Gh(),t.prototype._updateModelParams.call(this)},n.rR=function(){var t=this._skinningRoot;if(t){for(var i=!1,n=this.node;n;n=n.parent)if(n===t){i=!0;break}if(i){var r=t.getComponent("cc.SkeletalAnimation");r&&r.enabledInHierarchy?r.notifySkinnedMeshAdded(this):this.setUseBakedAnimation(!1)}}},n.Gh=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},r(i,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this.Gh())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){t!==this._skinningRoot&&(this._skinningRoot=t,this.rR(),this.Gh())}},{key:"model",get:function(){return this._model}}]),i}(U6),H9=uo(j9.prototype,"_skeleton",[B9],(function(){return null})),V9=uo(j9.prototype,"_skinningRoot",[F9],(function(){return null})),y(j9.prototype,"skeleton",[U9],Object.getOwnPropertyDescriptor(j9.prototype,"skeleton"),j9.prototype),y(j9.prototype,"skinningRoot",[x9],Object.getOwnPropertyDescriptor(j9.prototype,"skinningRoot"),j9.prototype),G9=j9))||G9)||G9),g7=new ud("a_batch_id",11),p7=new ud("a_batch_uv",21),_7=Fd[g7.format].size+Fd[p7.format].size,y7=($9=_o("cc.SkinnedMeshUnit"),z9=ic(VP),W9=ic(x6),X9=ic(hA),Y9=ic(w7),$9((q9=function(){function t(){this.mesh=Q9&&Q9(),this.skeleton=J9&&J9(),this.material=Z9&&Z9(),this._localTransform=t7&&t7(),this._offset=i7&&i7(),this._size=n7&&n7()}return r(t,[{key:"offset",get:function(){return this._offset},set:function(t){Ms.copy(this._offset,t)}},{key:"size",get:function(){return this._size},set:function(t){Ms.copy(this._size,t)}},{key:"copyFrom",get:function(){return null},set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getSharedMaterial(0),t.skinningRoot&&s9(t.node,t.skinningRoot,this._localTransform))}}]),t}(),Q9=uo(q9.prototype,"mesh",[z9],(function(){return null})),J9=uo(q9.prototype,"skeleton",[W9],(function(){return null})),Z9=uo(q9.prototype,"material",[X9],(function(){return null})),t7=uo(q9.prototype,"_localTransform",[Co],(function(){return new ls})),i7=uo(q9.prototype,"_offset",[Co],(function(){return new Ms(0,0)})),n7=uo(q9.prototype,"_size",[Co],(function(){return new Ms(1,1)})),y(q9.prototype,"copyFrom",[Y9],Object.getOwnPropertyDescriptor(q9.prototype,"copyFrom"),q9.prototype),K9=q9))||K9),m7=new ls;new ls;var b7,k7,A7,E7,T7,O7,S7,I7,R7,M7,C7,N7,P7,L7,D7,B7,F7=new Ir;r7=_o("cc.SkinnedMeshBatchRenderer"),s7=mo(100),e7=ic([Zi]),h7=ic([y7]),r7(u7=s7((o7=function(t){function i(){var i;return(i=t.call(this)||this).atlasSize=c7&&c7(),i.batchableTextureNames=a7&&a7(),i.units=f7&&f7(),i.rr={},i.sR=null,i}e(i,t);var n=i.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},n.onDestroy=function(){for(var i in this.rr)this.rr[i].destroy();this.rr={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},n._onMaterialModified=function(i){this.cookMaterials(),t.prototype._onMaterialModified.call(this,i,this.getMaterialInstance(i))},n.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},n.cookMaterials=function(){var t=this;this.sR||(this.sR=this.getSharedMaterial(0));var i=this.getMaterialInstance(0);if(i&&this.sR&&this.sR.effectAsset){i.copy(this.sR),this.resizeAtlases();for(var n=i.effectAsset.techniques[i.technique],r=function(r){var s=n.passes[r];if(!s.properties)return 1;var e=function(n){if(s.properties[n].type>=26){var e=null;t.batchableTextureNames.find((function(t){return t===n}))?((e=t.rr[n])||(e=t.createTexture(n)),t.cookTextures(e,n,r)):t.units.some((function(t){return e=t.material&&t.material.getProperty(n,r)})),e&&i.setProperty(n,e,r)}else{for(var h=[],u=0;u<t.units.length;u++){var o=t.units[u];o.material&&h.push(o.material.getProperty(n.slice(0,-3),r))}i.setProperty(n,h,r)}};for(var h in s.properties)e(h)},s=0;s<n.passes.length;s++)r(s)}else W("incomplete batch material!")},n.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],i=[],n=0;n<this.units.length;n++){var r=this.units[n];if(r&&r.skeleton){var s=r.skeleton;ls.invert(m7,r._localTransform);for(var e=function(){var n=s.joints[h];if(t.findIndex((function(t){return t===n}))>=0)return 1;t.push(n),i.push(ls.multiply(new ls,s.bindposes[h]||ls.IDENTITY,m7))},h=0;h<s.joints.length;h++)e()}}var u=Array.from(Array(t.length).keys()).sort((function(i,n){return t[i]>t[n]?1:t[i]<t[n]?-1:0})),o=new x6;o.joints=t.map((function(t,i,n){return n[u[i]]})),o.bindposes=i.map((function(t,i,n){return n[u[i]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=o}else W("no skinning root specified!")},n.cookMeshes=function(){for(var t=this,i=!1,n=0;n<this.units.length;n++)if(this.units[n].mesh){i=!0;break}if(i&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new VP;for(var r=0,s=0,e=0,h=0,u=0,o=0,c=0,a=0,f=0,v=0,l=new Array(this.units.length),d=this.units.length,w=0;w<d;w++){var g=this.units[w];g&&g.skeleton&&(l[w]=g.skeleton.joints.map((function(i){return t._skeleton.joints.findIndex((function(t){return i===t}))})))}for(var p=function(){var i=t.units[_];if(!i||!i.mesh||!i.mesh.data)return 1;var n=t.eR(_,i.mesh),d=new DataView(n.data.buffer);ls.invert(m7,i._localTransform),ls.transpose(m7,m7);for(var w=i.offset,g=i.size,p=function(){var t=n.struct.vertexBundles[y];r=t.view.offset,s=0;for(var p=0;p<t.attributes.length;p++){var m=t.attributes[p];if("a_position"===m.name){s=m.format;break}r+=Fd[m.format].size}if(s){for(var b=UA(d,s,r,t.view.length,t.view.stride),k=0;k<b.length;k+=3)Ir.fromArray(F7,b,k),Ir.transformMat4(F7,F7,i._localTransform),Ir.toArray(b,F7,k);FA(d,b,s,r,t.view.stride)}e=t.view.offset,h=0;for(var A=0;A<t.attributes.length;A++){var E=t.attributes[A];if("a_normal"===E.name){h=E.format;break}e+=Fd[E.format].size}if(h){for(var T=UA(d,h,e,t.view.length,t.view.stride),O=0;O<T.length;O+=3)Ir.fromArray(F7,T,O),Ir.transformMat4Normal(F7,F7,m7),Ir.toArray(T,F7,O);FA(d,T,h,e,t.view.stride)}u=t.view.offset,o=0;for(var S=0;S<t.attributes.length;S++){var I=t.attributes[S];if("a_tangent"===I.name){o=I.format;break}u+=Fd[I.format].size}if(o){for(var R=UA(d,o,u,t.view.length,t.view.stride),M=0;M<R.length;M+=3)Ir.fromArray(F7,R,M),Ir.transformMat4Normal(F7,F7,m7),Ir.toArray(R,F7,M);FA(d,R,o,u,t.view.stride)}c=t.view.offset,a=0;for(var C=0;C<t.attributes.length;C++){var N=t.attributes[C];if("a_batch_uv"===N.name){a=N.format;break}c+=Fd[N.format].size}a&&xA(d,(function(t,i){var n,r=0===i?"x":"y";return(t=(n=t)-Math.floor(n))*g[r]+w[r]}),a,c,t.view.length,t.view.stride,d);var P=l[_];if(!P)return 1;f=t.view.offset,v=0;for(var L=0;L<t.attributes.length;L++){var D=t.attributes[L];if("a_joints"===D.name){v=D.format;break}f+=Fd[D.format].size}v&&xA(d,(function(t){return P[t]}),v,f,t.view.length,t.view.stride,d)},y=0;y<n.struct.vertexBundles.length;y++)p();t._mesh.merge(n)},_=0;_<d;_++)p();this._onMeshChanged(this._mesh),this._updateModels()}},n.cookTextures=function(t,i,n){for(var r=[],s=[],e=[],h=[],u=0;u<this.units.length;u++){var o=this.units[u];if(o.material){var c=o.material.getProperty(i,n);if(c&&c.image&&c.image.data){var a=new Fl;a.texOffset.x=o.offset.x*this.atlasSize,a.texOffset.y=o.offset.y*this.atlasSize,a.texExtent.width=o.size.x*this.atlasSize,a.texExtent.height=o.size.y*this.atlasSize;var f=c.image.data;ArrayBuffer.isView(f)?(e.push(f),h.push(a)):(r.push(f),s.push(a))}}}var v=t.getGFXTexture(),l=T.director.root.device;e.length>0&&l.copyBuffersToTexture(e,v,h),r.length>0&&l.copyTexImagesToTexture(r,v,s)},n.createTexture=function(t){var i=new f_;return i.setFilters(2,2),i.setMipFilter(1),i.reset({width:this.atlasSize,height:this.atlasSize,format:35}),this.rr[t]=i,i},n.resizeAtlases=function(){for(var t in this.rr)this.rr[t].reset({width:this.atlasSize,height:this.atlasSize,format:35})},n.eR=function(t,i){for(var n=JSON.parse(JSON.stringify(i.struct)),r={},s=0;s<i.struct.primitives.length;s++){for(var e=i.struct.primitives[s],h=0,u=0,o=0;o<e.vertexBundelIndices.length;o++){var c=i.struct.vertexBundles[e.vertexBundelIndices[o]];h=c.view.offset,u=0;for(var a=0;a<c.attributes.length;a++){var f=c.attributes[a];if("a_texCoord"===f.name){u=f.format;break}h+=Fd[f.format].size}if(u)break}if(void 0===r[o]){r[o]=[u,h];var v=n.vertexBundles[o];v.attributes.push(g7),v.attributes.push(p7),v.view.offset=0,v.view.length+=v.view.count*_7,v.view.stride+=_7}}for(var l=0,d=0;d<n.vertexBundles.length;d++)l+=n.vertexBundles[d].view.length;for(var w=0;w<n.primitives.length;w++){var g=n.primitives[w];g.indexView&&(g.indexView.offset=l,l+=g.indexView.length)}var p=new Uint8Array(l),_=i.data,y=new DataView(p.buffer),m=new DataView(_.buffer),b=T.sys.isLittleEndian;for(var k in r)for(var A=n.vertexBundles[k],E=i.struct.vertexBundles[k],O=r[k],S=UA(m,O[0],O[1],E.view.length,E.view.stride),I=E.view,R=A.view,M=I.stride,C=R.stride,N=I.offset,P=R.offset,L=0;L<R.count;L++){var D=_.subarray(N,N+M);p.set(D,P),y.setFloat32(P+M,t),y.setFloat32(P+M+4,S[2*L],b),y.setFloat32(P+M+8,S[2*L+1],b),P+=C,N+=M}for(var B=0;B<n.primitives.length;B++){var F=i.struct.primitives[B],U=n.primitives[B];if(F.indexView&&U.indexView)for(var x=F.indexView.stride,G=U.indexView.stride,j=F.indexView.offset,H=U.indexView.offset,V=0;V<U.indexView.count;V++){var $=_.subarray(j,j+x);p.set($,H),H+=G,j+=x}}var z=new VP;return z.reset({struct:n,data:p}),z},r(i,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),i}(w7),c7=uo(o7.prototype,"atlasSize",[Co],(function(){return 1024})),a7=uo(o7.prototype,"batchableTextureNames",[e7,Co],(function(){return[]})),f7=uo(o7.prototype,"units",[h7,Co],(function(){return[]})),y(o7.prototype,"mesh",[ac],Object.getOwnPropertyDescriptor(o7.prototype,"mesh"),o7.prototype),y(o7.prototype,"skeleton",[ac],Object.getOwnPropertyDescriptor(o7.prototype,"skeleton"),o7.prototype),u7=o7))||u7);var U7=[.25,.125,.01],x7=(b7=_o("cc.LOD"),k7=ic([U6]),A7=ic(Qi),E7=ic([U6]),T7=ic([qi]),b7((S7=function(){function t(){this._screenUsagePercentage=I7&&I7(),this._renderers=R7&&R7(),this.hR=new CC,this.uR=void 0,this.hR.Lv=this._screenUsagePercentage,this.uR=null}var i=t.prototype;return i.insertRenderer=function(t,i){(t<0||t>this._renderers.length)&&(t=this._renderers.length),this._renderers.splice(t,0,i);var n=!1;return i.model&&(n=!0,this.hR.Bv(i.model)),this.uR&&n&&this.uR(),i},i.deleteRenderer=function(t){var i,n=this._renderers.splice(t,1),r=n.length>0?null==(i=n[0])?void 0:i.model:null;return r&&this.hR.Fv(r),n[0]},i.getRenderer=function(t){return this._renderers[t]||null},i.setRenderer=function(t,i){t<0||t>=this.rendererCount?X("setRenderer to LOD error, index out of range"):(this.deleteRenderer(t),this.insertRenderer(t,i))},r(t,[{key:"screenUsagePercentage",get:function(){return this._screenUsagePercentage},set:function(t){this._screenUsagePercentage=t,this.hR.Lv=t}},{key:"renderers",get:function(){return this._renderers},set:function(t){if(t!==this._renderers){var i=!1;this._renderers.length=0,this.hR.Uv();for(var n=0;n<t.length;n++){var r;this._renderers[n]=t[n];var s=null==(r=t[n])?void 0:r.model;s&&(i=!0,this.hR.Bv(s))}this.uR&&i&&this.uR()}}},{key:"triangleCount",get:function(){var t=[];return this._renderers.forEach((function(i){var n=0;if(i&&i.mesh){var r=i.mesh.struct.primitives;null==r||r.forEach((function(t){t&&t.indexView&&(n+=t.indexView.count)}))}t.push(n/3)})),t}},{key:"rendererCount",get:function(){return this._renderers.length}},{key:"lodData",get:function(){return this.hR}},{key:"modelAddedCallback",set:function(t){this.uR=t}}]),t}(),I7=uo(S7.prototype,"_screenUsagePercentage",[Co],(function(){return 1})),R7=uo(S7.prototype,"_renderers",[k7,Co],(function(){return[]})),y(S7.prototype,"screenUsagePercentage",[A7],Object.getOwnPropertyDescriptor(S7.prototype,"screenUsagePercentage"),S7.prototype),y(S7.prototype,"renderers",[E7],Object.getOwnPropertyDescriptor(S7.prototype,"renderers"),S7.prototype),y(S7.prototype,"triangleCount",[T7],Object.getOwnPropertyDescriptor(S7.prototype,"triangleCount"),S7.prototype),O7=S7))||O7);M7=_o("cc.LODGroup"),C7=ic(Qi),N7=ic([x7]),M7((P7=function(t){function i(){var i;return(i=t.call(this)||this)._localBoundaryCenter=L7&&L7(),i._objectSize=D7&&D7(),i._LODs=B7&&B7(),i._lodGroup=new NC,i.oR=!1,i.cR=[],i}e(i,t);var n=i.prototype;return n.fR=function(){0===this.objectSize&&this.recalculateBounds()},n.insertLOD=function(t,i,n){if((t<0||t>this.lodCount)&&(t=this.lodCount),n||(n=new x7),n.modelAddedCallback=this.fR.bind(this),!i){var r=this.getLOD(t-1),s=this.getLOD(t);if(r&&s)i=(r.screenUsagePercentage+s.screenUsagePercentage)/2;else if(r&&!s)(i=r.screenUsagePercentage/2)>.01&&(i=.01);else if(s&&!r){i=s.screenUsagePercentage;var e=this.getLOD(t+1);s.screenUsagePercentage=(i+(e?e.screenUsagePercentage:0))/2}else i=U7[0]}return n.screenUsagePercentage=i,this._LODs.splice(t,0,n),this._lodGroup.tl(t,n.lodData),this.vR(),this.node&&this.lR(this.node),n},n.eraseLOD=function(t){if(t<0||t>=this.lodCount)return W("eraseLOD error, index out of range"),null;var i=this._LODs[t];return i?(this._LODs.splice(t,1),this._lodGroup.nl(t),this.vR(),this.lR(this.node),i):(W("eraseLOD error, LOD not exist at specified index."),null)},n.getLOD=function(t){return t<0||t>=this.lodCount?(W("getLOD error, index out of range"),null):this._LODs[t]},n.setLOD=function(t,i){t<0||t>=this.lodCount?W("setLOD error, index out of range"):(this._LODs[t]=i,i.modelAddedCallback=this.fR.bind(this),this.lodGroup.il(t,i.lodData),this.vR())},n.recalculateBounds=function(){for(var t=new Ir,i=new Ir,n=null,r=new Ir,s=0;s<this.lodCount;++s){var e=this.getLOD(s);if(e)for(var h=0;h<e.rendererCount;++h){var u,o,c=e.getRenderer(h);if(c){null==(u=c.model)||u.updateWorldBound();var a=null==(o=c.model)?void 0:o.worldBounds;a&&(a.getBoundary(t,i),n?(Ir.min(n,n,t),Ir.max(r,r,i)):(n=t.clone(),r=i.clone()))}}}if(n){var f=n,v=new Ir(.5*(r.x+f.x),.5*(r.y+f.y),.5*(r.z+f.z)),l=new Ir(.5*(r.x-f.x),.5*(r.y-f.y),.5*(r.z-f.z)),d=function(t,i,n){var r,s,e=new Array(new Ir(t.x-i.x,t.y-i.y,t.z-i.z),new Ir(t.x-i.x,t.y+i.y,t.z-i.z),new Ir(t.x+i.x,t.y+i.y,t.z-i.z),new Ir(t.x+i.x,t.y-i.y,t.z-i.z),new Ir(t.x-i.x,t.y-i.y,t.z+i.z),new Ir(t.x-i.x,t.y+i.y,t.z+i.z),new Ir(t.x+i.x,t.y+i.y,t.z+i.z),new Ir(t.x+i.x,t.y-i.y,t.z+i.z));s=(r=e[0].transformMat4(n)).clone();for(var h=1;h<8;++h){var u=e[h].transformMat4(n);r=Ir.min(r,r,u),s=Ir.max(s,s,u)}return[r,s]}(v,l,this.node.worldMatrix.clone().invert()),w=d[0],g=d[1];v.set(.5*(g.x+w.x),.5*(g.y+w.y),.5*(g.z+w.z)),l.set(.5*(g.x-w.x),.5*(g.y-w.y),.5*(g.z-w.z)),this.localBoundaryCenter=v,this.objectSize=2*Math.max(l.x,l.y,l.z)}else this.localBoundaryCenter=new Ir(0,0,0),this.objectSize=0;this.lR(this.node)},n.resetObjectSize=function(){if(1!==this.objectSize){0===this.objectSize&&(this.objectSize=1);var t=1/this.objectSize;this.objectSize=1;for(var i=0;i<this.lodCount;++i){var n=this.getLOD(i);n&&(n.screenUsagePercentage*=t)}this.lR(this.node)}},n.forceLOD=function(t){this.cR=t<0?[]:[t],this.lodGroup.Kv(this.cR)},n.forceLODs=function(){},n.onLoad=function(){this._lodGroup.Gv=this.node,this._lodGroup.objectSize=this._objectSize,this._lodGroup.localBoundaryCenter=this._localBoundaryCenter,this.oR||(this.node.on("component-removed",this._onRemove,this),this.oR=!0),this.dR()},n._onRemove=function(t){t===this&&this.onDisable()},n.dR=function(){if(this.lodCount<1)for(var t=U7.length,i=0;i<t;i++)this.insertLOD(i,U7[i])},n.onRestore=function(){this.dR(),this.enabledInHierarchy&&this.wR()},n.onEnable=function(){var t=this;this.wR(),0===this.objectSize&&this.recalculateBounds(),this.lodGroup.Kv(this.cR),this.lodCount>0&&this._lodGroup.lodCount<1&&this._LODs.forEach((function(i,n){i.lodData.Lv=i.screenUsagePercentage;var r=i.renderers;if(null!==r&&r.length>0)for(var s=0;s<r.length;s++){var e=i.lodData,h=r[s];e&&h&&h.model&&e.Bv(h.model)}t._lodGroup.tl(n,i.lodData)}))},n.onDisable=function(){this.gR(),this.lodGroup.Kv([])},n.wR=function(){if(this.node&&this.node.scene){var t=this._getRenderScene();this._lodGroup.xv&&this.gR(),t.addLODGroup(this._lodGroup)}},n.gR=function(){this._lodGroup.xv&&this._lodGroup.xv.kl(this._lodGroup)},n.lR=function(){},n.vR=function(){this.gR(),this.wR()},r(i,[{key:"localBoundaryCenter",get:function(){return this._localBoundaryCenter.clone()},set:function(t){this._localBoundaryCenter.set(t),this._lodGroup.localBoundaryCenter=t}},{key:"lodCount",get:function(){return this._LODs.length}},{key:"objectSize",get:function(){return this._objectSize},set:function(t){this._objectSize=t,this._lodGroup.objectSize=t}},{key:"LODs",get:function(){return this._LODs},set:function(t){var i=this;t!==this._LODs?(this._LODs.length=0,this.lodGroup.Zv(),t.forEach((function(t,n){i.lodGroup.tl(n,t.lodData),i._LODs[n]=t,t.modelAddedCallback=i.fR.bind(i)})),this.vR()):this.vR()}},{key:"lodGroup",get:function(){return this._lodGroup}}]),i}(Kg),L7=uo(P7.prototype,"_localBoundaryCenter",[Co],(function(){return new Ir(0,0,0)})),D7=uo(P7.prototype,"_objectSize",[Co],(function(){return 0})),B7=uo(P7.prototype,"_LODs",[Co],(function(){return[]})),y(P7.prototype,"objectSize",[C7],Object.getOwnPropertyDescriptor(P7.prototype,"objectSize"),P7.prototype),y(P7.prototype,"LODs",[N7],Object.getOwnPropertyDescriptor(P7.prototype,"LODs"),P7.prototype),P7));var G7,j7,H7,V7,$7,z7,W7,X7,Y7,K7,q7,Q7,J7,Z7,ttt,itt,ntt,rtt,stt,ett,htt,utt,ott=M_.makeMaskExclude([M_.BitMask.UI_2D,M_.BitMask.UI_3D,M_.BitMask.GIZMOS,M_.BitMask.EDITOR,M_.BitMask.SCENE_GIZMO,M_.BitMask.PROFILER,M_.Enum.IGNORE_RAYCAST]),ctt=function(){function t(){this.pR=[],this._R=new Map,this.yR=new Map,this.mR=!0,this.kR=null,this.AR=!1}var i=t.prototype;return i.ER=function(){this.AR||(T.director.on(T.DirectorEvent.BEFORE_UPDATE,this.onUpdateProbes,this),this.AR=!0)},i.onUpdateProbes=function(){if(0!==this.pR.length){var t=T.director.getScene();if(t&&t.renderScene)for(var i=t.renderScene.models,n=0;n<i.length;n++){var r=i[n];r.node&&r.node.layer&ott&&(1===r.reflectionProbeType||this.TR(r)?this.selectReflectionProbe(r):2===r.reflectionProbeType&&this.DI(r))}}},i.filterModelsForPlanarReflection=function(){if(0!==this.pR.length){var t=T.director.getScene();if(t&&t.renderScene)for(var i=t.renderScene.models,n=0;n<i.length;n++){var r=i[n];r.node&&r.node.layer&ott&&2===r.reflectionProbeType&&this.DI(r)}}},i.OR=function(t){for(var i,n=w(this.yR.entries());!(i=n()).done;){var r=i.value;r[1]===t&&this.SR(r[0],null,null)}},i.IR=function(t){-1===this.pR.indexOf(t)&&(this.pR.push(t),this.updateProbeData())},i.RR=function(t){for(var i=0;i<this.pR.length;i++)if(this.pR[i]===t){var n=this.pR.splice(i,1);n[0]&&this.MR(n[0]);break}this.updateProbeData()},i.CR=function(t){if(0===this.pR.length)return!1;for(var i=0;i<this.pR.length;i++)if(this.pR[i].getProbeId()===t)return!0;return!1},i.NR=function(){for(var t=0;;){if(!this.CR(t))return t;t++}},i.getProbes=function(){return this.pR},i.getProbeById=function(t){for(var i=0;i<this.pR.length;i++)if(this.pR[i].getProbeId()===t)return this.pR[i];return null},i.PR=function(){this.pR=[]},i.LR=function(t){for(var i=0;i<this.pR.length;i++)if(this.pR[i].camera===t)return this.pR[i];return null},i.updateBakedCubemap=function(t){var i=this.DR(t);if(t.cubemap){for(var n=0;n<i.length;n++){var r=i[n];this.BR(r,t)}if(t.needRefresh=!1,0===i.length)for(var s,e=w(this._R.entries());!(s=e()).done;){var h=s.value;h[0].reflectionProbeBlendId===t.getProbeId()&&this.FR(h[0],t)}}},i.updatePlanarMap=function(t,i){if(t.node&&t.node.scene){for(var n=this.DR(t),r=0;r<n.length;r++)this.SR(n[r],i,t);if(t.previewPlane){var s=t.previewPlane.getComponent(U6);s&&s.updateProbePlanarMap(i)}}},i.DI=function(t){if(t.node&&t.worldBounds&&2===t.reflectionProbeType){for(var i=0;i<this.pR.length;i++){var n=this.pR[i];1===n.probeType&&t.node.layer&ott&&(t.updateWorldBound(),Xu.aabbWithAABB(t.worldBounds,n.boundingBox)?this.yR.set(t,n):this.yR.has(t)&&this.yR.get(t)===n&&(this.yR.delete(t),this.SR(t,null,null)))}for(var r=0;r<this.pR.length;r++)1===this.pR[r].probeType&&(this.pR[r].realtimePlanarTexture?this.updatePlanarMap(this.pR[r],this.pR[r].realtimePlanarTexture.getGFXTexture()):this.updatePlanarMap(this.pR[r],null))}},i.selectReflectionProbe=function(t){if(t.node&&t.worldBounds&&t.node.layer&ott){t.updateWorldBound();var i=this.UR(t);i?this._R.has(t)?(this._R.get(t)!==i&&this._R.set(t,i),i.needRefresh=!0):(this._R.set(t,i),i.needRefresh=!0):(this.BR(t,null),this._R.delete(t))}for(var n=0;n<this.pR.length;n++)(this.pR[n].needRefresh&&0===this.pR[n].probeType||this.TR(t))&&this.updateBakedCubemap(this.pR[n])},i.updatePreviewSphere=function(t){if(t&&t.previewSphere){var i=t.previewSphere.getComponent(U6);i&&(i.updateProbeCubemap(t.cubemap),i.updateReflectionProbeId(t.getProbeId()))}},i.updatePreviewPlane=function(t){t&&t.previewPlane&&t.previewPlane.getComponent(U6)&&t.realtimePlanarTexture&&this.updatePlanarMap(t,t.realtimePlanarTexture.getGFXTexture())},i.updateProbeData=function(){if(0!==this.pR.length){var t=this.getMaxProbeId(),i=t+1;this.kR&&this.kR.destroy();for(var n=new Float32Array(12*i),r=0,s=0;s<=t;s++){var e=this.getProbeById(s);if(e){if(0===e.probeType){n[r]=e.node.worldPosition.x,n[r+1]=e.node.worldPosition.y,n[r+2]=e.node.worldPosition.z,n[r+3]=0,n[r+4]=e.size.x,n[r+5]=e.size.y,n[r+6]=e.size.z,n[r+7]=0;var h=e.isRGBE()?1e3:0;n[r+8]=e.cubemap?e.cubemap.mipmapLevel+h:1+h}else n[r]=e.node.up.x,n[r+1]=e.node.up.y,n[r+2]=e.node.up.z,n[r+3]=1,n[r+4]=1,n[r+5]=1,n[r+6]=0,n[r+7]=0,n[r+8]=1;r+=12}else r+=12}var u=new Uint8Array(n.buffer),o=new mg({_data:u,_compressed:!1,width:12,height:i,format:35});this.kR=new f_,this.kR.setFilters(0,0),this.kR.setMipFilter(0),this.kR.setWrapMode(2,2,2),this.kR.image=o,this.kR.uploadData(u);for(var c=0;c<this.pR.length;c++)for(var a=this.pR[c],f=this.DR(a),v=0;v<f.length;v++){var l=f[v].node.getComponent(U6);l&&l.updateReflectionProbeDataMap(this.kR)}}},i.getMaxProbeId=function(){return 0===this.pR.length?-1:1===this.pR.length?this.pR[0].getProbeId():(this.pR.sort((function(t,i){return t.getProbeId()-i.getProbeId()})),this.pR[this.pR.length-1].getProbeId())},i.getUsedReflectionProbe=function(t,i){if(i){if(this.yR.has(t))return this.yR.get(t)}else if(this._R.has(t))return this._R.get(t);return null},i.setReflectionProbe=function(t,i,n){void 0===n&&(n=null),i&&(this._R.set(t,i),this.BR(t,i),n&&this.xR(t,i,n))},i.GR=function(){if(0!==this.pR.length){var t=T.director.getScene();if(t&&t.renderScene)for(var i=t.renderScene.models,n=0;n<i.length;n++){var r=i[n];r.node&&r.node.layer&ott&&(1===r.reflectionProbeType||2===r.reflectionProbeType||this.TR(r))&&r.updateReflectionProbeId()}}},i.UR=function(t){if(!t.node||!t.worldBounds||0===this.pR.length)return null;for(var i,n=null,r=1/0,s=w(this.pR);!(i=s()).done;){var e=i.value;if(0===e.probeType&&e.validate()&&Xu.aabbWithAABB(t.worldBounds,e.boundingBox)){var h=Ir.distance(t.node.worldPosition,e.node.worldPosition);h<r&&(r=h,n=e)}}return n},i.jR=function(t){if(!t||!t.node||!t.worldBounds||this.pR.length<2)return null;for(var i=[],n=0;n<this.pR.length;n++)0===this.pR[n].probeType&&this.pR[n].validate()&&Xu.aabbWithAABB(t.worldBounds,this.pR[n].boundingBox)&&i.push(this.pR[n]);return i.sort((function(i,n){return Ir.distance(t.node.worldPosition,i.node.worldPosition)-Ir.distance(t.node.worldPosition,n.node.worldPosition)})),i.length>1?i[1]:null},i.DR=function(t){var i=[],n=this._R;1===t.probeType&&(n=this.yR);for(var r,s=w(n.entries());!(r=s()).done;){var e=r.value;e[1]===t&&i.push(e[0])}return i},i.MR=function(t){for(var i,n=w(this._R.keys());!(i=n()).done;){var r=i.value,s=this._R.get(r);void 0!==s&&s===t&&(this._R.delete(r),this.selectReflectionProbe(r))}for(var e,h=w(this.yR.keys());!(e=h()).done;){var u=e.value,o=this.yR.get(u);void 0!==o&&o===t&&(this.yR.delete(u),this.DI(u))}},i.BR=function(t,i){var n=t.node;if(n){var r=n.getComponent(U6);if(r&&(r.updateProbeCubemap(i?i.cubemap:null),r.updateReflectionProbeId(i&&i.cubemap?i.getProbeId():-1),i&&(r.updateReflectionProbeDataMap(this.kR),this.TR(t)))){var s=this.jR(t);this.xR(t,i,s)}}},i.SR=function(t,i,n){var r=t.node.getComponent(U6);r&&(r.updateProbePlanarMap(i),n?(r.updateReflectionProbeId(n.getProbeId()),r.updateReflectionProbeDataMap(this.kR)):r.updateReflectionProbeId(-1))},i.TR=function(t){return 3===t.reflectionProbeType||4===t.reflectionProbeType},i.xR=function(t,i,n){var r=t.node;if(r){var s=r.getComponent(U6);s&&(s.updateReflectionProbeBlendId(-1),4===t.reflectionProbeType&&s.updateReflectionProbeBlendWeight(this.HR(t,i,n)))}},i.FR=function(t,i){var n=t.node;if(n&&this.TR(t)){var r=n.getComponent(U6);r&&r.updateProbeBlendCubemap(i.cubemap)}},i.HR=function(t,i,n){if(n){var r=Ir.distance(t.node.worldPosition,i.node.worldPosition),s=Ir.distance(t.node.worldPosition,n.node.worldPosition);return 1-s/(r+s)}return 3===t.reflectionProbeType?0:4===t.reflectionProbeType?this.VR(t.worldBounds,i.boundingBox):0},i.VR=function(t,i){if(!t)return 1;var n=new Ir,r=new Ir,s=new Ir,e=new Ir;if(Ir.subtract(n,t.center,t.halfExtents),Ir.add(r,t.center,t.halfExtents),Ir.subtract(s,i.center,i.halfExtents),Ir.add(e,i.center,i.halfExtents),n.x<=e.x&&r.x>=s.x&&n.y<=e.y&&r.y>=s.y&&n.z<=e.z&&r.z>=s.z){var h=new Ir;Ir.multiplyScalar(h,t.halfExtents,2);var u=n.x+h.x<=e.x&&r.x+h.x>=s.x,o=n.x-h.x<=e.x&&r.x-h.x>=s.x,c=n.y+h.y<=e.y&&r.y+h.y>=s.y,a=n.y-h.y<=e.y&&r.y-h.y>=s.y,f=n.z+h.z<=e.z&&r.z+h.z>=s.z,v=n.z-h.z<=e.z&&r.z-h.z>=s.z,l=[];if(!u){var d=r.x-e.x;l.push(d/h.x)}if(!o){var w=Math.abs(n.x-s.x);l.push(w/h.x)}if(!c){var g=r.y-e.y;l.push(g/h.y)}if(!a){var p=Math.abs(n.y-s.y);l.push(p/h.y)}if(!f){var _=r.z-e.z;l.push(_/h.z)}if(!v){var y=Math.abs(n.z-s.z);l.push(y/h.z)}return l.length>0?(l.sort((function(t,i){return i-t})),l[0]):0}return 1},r(t,[{key:"updateForRuntime",get:function(){return this.mR},set:function(t){this.mR=t}}]),t}();ctt.probeManager=void 0,ctt.probeManager=new ctt,T.internal.reflectionProbeManager=ctt.probeManager,new Ir,new Ir,new Ir,new Ir,new Ir,new Ir,new Ir,new Ir,new Ir,new Ir,new Ir,new Ir,new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir(0,0,0),new Ir;var att=Rr();G7=_o("cc.ReflectionProbe"),j7=ic(Ir),H7=ic(_i(SC)),V7=ic(_i({Low_256x256:256,Medium_512x512:512,High_768x768:768})),$7=ic(_i(OC)),z7=ic(Qs),W7=ic(M_.BitMask),X7=ic(HG),Y7=ic(Ji),K7=ic(tb),G7((utt=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._lastSize=Rr(),i._resolution=Q7&&Q7(),i._clearFlag=J7&&J7(),i._backgroundColor=Z7&&Z7(),i._visibility=ttt&&ttt(),i._probeType=itt&&itt(),i._cubemap=ntt&&ntt(),i._size=rtt&&rtt(),i._sourceCamera=stt&&stt(),i._probeId=ett&&ett(),i._fastBake=htt&&htt(),i._probe=null,i._previewSphere=null,i._previewPlane=null,i.$R=Rr(),i.Of=Rr(),i}e(i,t);var n=i.prototype;return n.onLoad=function(){this.zR()},n.WR=function(){this.probe&&this.sourceCamera&&1===this.probeType&&this.probe.renderPlanarReflection(this.sourceCamera.camera)},n.onEnable=function(){if(this._probe){var t=ctt.probeManager.getProbeById(this._probeId);null!==t&&t!==this._probe&&(this._probeId=ctt.probeManager.NR(),this._probe.updateProbeId(this._probeId)),ctt.probeManager.IR(this._probe),ctt.probeManager.onUpdateProbes(),this._probe.enable()}mh.on("window-resize",this.WR,this),mh.on("fullscreen-change",this.WR,this)},n.onDisable=function(){this._probe&&(ctt.probeManager.RR(this._probe),this._probe.disable()),mh.off("window-resize",this.WR,this),mh.off("fullscreen-change",this.WR,this)},n.start=function(){this._sourceCamera&&1===this.probeType&&(this.probe.renderPlanarReflection(this.sourceCamera.camera),ctt.probeManager.filterModelsForPlanarReflection()),ctt.probeManager.updateProbeData(),this.node.getWorldPosition(this.Of)},n.onDestroy=function(){this.probe&&this.probe.destroy()},n.update=function(){this.probe&&(1===this.probeType&&this.sourceCamera&&(7&this.sourceCamera.node.hasChangedFlags||!this.$R.equals(this.sourceCamera.node.getWorldPosition()))&&(this.$R=this.sourceCamera.node.getWorldPosition(),this.probe.renderPlanarReflection(this.sourceCamera.camera)),1&this.node.hasChangedFlags&&(this.probe.updateBoundingBox(),ctt.probeManager.onUpdateProbes(),ctt.probeManager.updateProbeData()),this.node.getWorldPosition(att),this.Of.equals(att)||(this.Of.set(att),this.probe.updateBoundingBox(),ctt.probeManager.updateProbeData(),ctt.probeManager.GR()))},n.clearBakedCubemap=function(){this.cubemap=null,ctt.probeManager.updateBakedCubemap(this.probe),ctt.probeManager.updatePreviewSphere(this.probe)},n.zR=function(){if((-1===this._probeId||ctt.probeManager.CR(this._probeId))&&(this._probeId=ctt.probeManager.NR()),this._probe=new MC(this._probeId),this._probe){var t=new WE("ReflectionProbeCamera");t.hideFlags|=1032,this.node.scene.addChild(t),this._probe.initialize(this.node,t),this.enabled&&ctt.probeManager.IR(this._probe),this._probe.resolution=this._resolution,this._probe.clearFlag=this._clearFlag,this._probe.backgroundColor=this._backgroundColor,this._probe.visibility=this._visibility,this._probe.probeType=this._probeType,this._probe.size=this._size,this._probe.cubemap=this._cubemap}},r(i,[{key:"size",get:function(){return this._size},set:function(t){var i;this._size.set(t),(i=this._size).x=Math.abs(i.x),i.y=Math.abs(i.y),i.z=Math.abs(i.z),this.probe.size=this._size,this.probe&&(this.probe.updateBoundingBox(),ctt.probeManager.onUpdateProbes(),ctt.probeManager.updateProbeData(),ctt.probeManager.GR())}},{key:"probeType",get:function(){return this._probeType},set:function(t){if(this.probe.probeType=t,t!==this._probeType){var n=this._size.clone(),r=Ir.equals(this._lastSize,Ir.ZERO);this._probeType=t,0===this._probeType?(r&&this._size.set(i.YR),this.probe.switchProbeType(t,null),ctt.probeManager.OR(this.probe)):(r&&this._size.set(i.KR),this._sourceCamera?this.probe.switchProbeType(t,this._sourceCamera.camera):W("the reflection camera is invalid, please set the reflection camera")),r||this._size.set(this._lastSize),this._lastSize.set(n),this.size=this._size}}},{key:"resolution",get:function(){return this._resolution},set:function(t){this._resolution=t,this.probe.resolution=t}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t,this.probe.clearFlag=this._clearFlag}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this.probe.backgroundColor=this._backgroundColor}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this.probe.visibility=this._visibility}},{key:"sourceCamera",get:function(){return this._sourceCamera},set:function(t){this._sourceCamera=t,t&&(this.visibility=t.visibility,this.clearFlag=t.clearFlags,this.backgroundColor=t.clearColor,1===this.probeType&&this.probe.switchProbeType(this.probeType,t.camera))}},{key:"fastBake",get:function(){return this._fastBake},set:function(t){this._fastBake=t}},{key:"cubemap",get:function(){return this._cubemap},set:function(t){this._cubemap=t,this.probe.cubemap=t,ctt.probeManager.onUpdateProbes()}},{key:"probe",get:function(){return this._probe}},{key:"previewSphere",get:function(){return this._previewSphere},set:function(t){this._previewSphere=t,this.probe&&(this.probe.previewSphere=t,this._previewSphere&&ctt.probeManager.updatePreviewSphere(this.probe))}},{key:"previewPlane",get:function(){return this._previewPlane},set:function(t){this._previewPlane=t,this.probe&&(this.probe.previewPlane=t,this._previewPlane&&ctt.probeManager.updatePreviewPlane(this.probe))}}]),i}(Kg),utt.YR=Rr(1,1,1),utt.KR=Rr(5,.5,5),Q7=uo((q7=utt).prototype,"_resolution",[Co],(function(){return 256})),J7=uo(q7.prototype,"_clearFlag",[Co],(function(){return 14})),Z7=uo(q7.prototype,"_backgroundColor",[Co],(function(){return new Qs(0,0,0,255)})),ttt=uo(q7.prototype,"_visibility",[Co],(function(){return Ky})),itt=uo(q7.prototype,"_probeType",[Co],(function(){return 0})),ntt=uo(q7.prototype,"_cubemap",[Co],(function(){return null})),rtt=uo(q7.prototype,"_size",[Co],(function(){return Rr(1,1,1)})),stt=uo(q7.prototype,"_sourceCamera",[Co],(function(){return null})),ett=uo(q7.prototype,"_probeId",[Co],(function(){return-1})),htt=uo(q7.prototype,"_fastBake",[Co],(function(){return!1})),y(q7.prototype,"size",[j7],Object.getOwnPropertyDescriptor(q7.prototype,"size"),q7.prototype),y(q7.prototype,"probeType",[H7],Object.getOwnPropertyDescriptor(q7.prototype,"probeType"),q7.prototype),y(q7.prototype,"resolution",[V7],Object.getOwnPropertyDescriptor(q7.prototype,"resolution"),q7.prototype),y(q7.prototype,"clearFlag",[$7],Object.getOwnPropertyDescriptor(q7.prototype,"clearFlag"),q7.prototype),y(q7.prototype,"backgroundColor",[z7],Object.getOwnPropertyDescriptor(q7.prototype,"backgroundColor"),q7.prototype),y(q7.prototype,"visibility",[W7],Object.getOwnPropertyDescriptor(q7.prototype,"visibility"),q7.prototype),y(q7.prototype,"sourceCamera",[X7],Object.getOwnPropertyDescriptor(q7.prototype,"sourceCamera"),q7.prototype),y(q7.prototype,"fastBake",[Y7],Object.getOwnPropertyDescriptor(q7.prototype,"fastBake"),q7.prototype),y(q7.prototype,"cubemap",[K7],Object.getOwnPropertyDescriptor(q7.prototype,"cubemap"),q7.prototype),q7)),O.utils=cL;var ftt,vtt,ltt,dtt,wtt,gtt,ptt,_tt,ytt,mtt,btt,ktt,Att,Ett,Ttt,Ott,Stt,Itt,Rtt,Mtt,Ctt,Ntt,Ptt=function(){var t,i,n=new Qr,r=new Ir,s=new Ir,e=new Ir,h=(t=new Ir,i=new Ir,function(n,r,s,e,h){return Qr.rotationTo(n,Ir.subtract(t,s,r).normalize(),Ir.subtract(i,h,e).normalize())});return function(t,i,u,o,c){var a=Ir.copy(r,null!=c?c:i.position),f=t.position,v=i.position,l=u.position;u.rotation;var d=s,w=e;Ltt(f,v,l,o,a,d,w);var g=h(n,f,v,f,d);Qr.multiply(g,g,t.rotation),t.rotation=g;var p=h(n,v,l,d,w);Qr.multiply(p,p,i.rotation),i.rotation=p,i.position=d,u.position=w}}(),Ltt=(ftt=new Ir,vtt=new Ir,ltt=new Ir,function(t,i,n,r,s,e,h){var u=Ir.distance(t,i),o=Ir.distance(i,n),c=Ir.distance(t,r),a=Ir.subtract(ftt,r,t);a.normalize();var f=u+o;if(c>=f)return Ir.scaleAndAdd(e,t,a,u),void Ir.scaleAndAdd(h,t,a,f);Ir.copy(h,r);var v=Gn((u*u+c*c-o*o)/(2*u*c),-1,1),l=Ir.subtract(vtt,s,t),d=Ir.projectOnPlane(ltt,l,a);d.normalize();var w=u*v,g=u*u-w*w,p=Math.sqrt(g);Ir.scaleAndAdd(e,t,a,w),Ir.scaleAndAdd(e,e,d,p)}),Dtt=VJ+"/i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes_ik/",Btt=new HK,Ftt=new HK,Utt=new HK,xtt=new Ir,Gtt=new Ir,jtt=new HK,Htt={NONE:0,VALUE:1,BONE:2};bi(Htt);var Vtt=(dtt=_o(Vj+"PoseNodeTwoBoneIKSolver.TargetSpecification"),wtt=ic(Htt),gtt=ic(D3),dtt((_tt=function(){function t(t){this.type=ytt&&ytt(),this.targetPosition=mtt&&mtt(),this.targetPositionSpace=btt&&btt(),this.targetBone=ktt&&ktt(),this.qR=void 0,this.QR=void 0,void 0!==t&&(this.type=t)}var i=t.prototype;return i.bind=function(t,i){var n;this.qR=i,2===this.type&&this.targetBone&&(this.QR=null!==(n=t.bindTransformByName(this.targetBone))&&void 0!==n?n:void 0)},i.evaluate=function(t,i,n){if(this.qR,this.QR)i.transforms.getPosition(this.QR.index,t);else if(0===this.type)i.transforms.getPosition(this.qR.index,t);else{var r=HK.setIdentity(jtt);r.position=this.targetPosition,n._convertTransformToPoseTransformSpace(r,this.targetPositionSpace,i,this.qR.index),Ir.copy(t,r.position)}return t},t}(),ytt=uo(_tt.prototype,"type",[Co,wtt],(function(){return 1})),mtt=uo(_tt.prototype,"targetPosition",[Co],(function(){return new Ir})),btt=uo(_tt.prototype,"targetPositionSpace",[Co,gtt],(function(){return 0})),ktt=uo(_tt.prototype,"targetBone",[Co],(function(){return""})),ptt=_tt))||ptt);Att=_o(Vj+"PoseNodeTwoBoneIKSolver"),Ett=Mz(Dtt),Ttt=qz({type:3}),Ott=qz({type:3}),Att(Stt=Ett((Itt=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).debug=Rtt&&Rtt(),i.endEffectorBoneName=Mtt&&Mtt(),i.endEffectorTarget=Ctt&&Ctt(),i.poleTarget=Ntt&&Ntt(),i.ZO=void 0,i}e(i,t);var n=i.prototype;return n.bind=function(i){if(t.prototype.bind.call(this,i),this.endEffectorBoneName){var n=i.getParentBoneNameByName(this.endEffectorBoneName),r=n?i.getParentBoneNameByName(n):"";if(n&&r){var s=i.bindTransformByName(this.endEffectorBoneName),e=i.bindTransformByName(n),h=i.bindTransformByName(r);s&&e&&h?(this.endEffectorTarget.bind(i,s),this.poleTarget.bind(i,e),this.ZO=new sit(s,e,h)):(null==s||s.destroy(),null==e||e.destroy(),null==h||h.destroy())}}},n.getPoseTransformSpaceRequirement=function(){return 2},n.modifyPose=function(t,i,n){var r=this.ZO;if(r){var s=r.hRoot.index,e=r.hMiddle.index,h=r.hEndEffector.index,u=i.transforms.getTransform(s,Btt),o=i.transforms.getTransform(e,Ftt),c=i.transforms.getTransform(h,Utt),a=this.endEffectorTarget.evaluate(xtt,i,t),f=this.poleTarget.evaluate(Gtt,i,t);Ptt(u,o,c,a,f,this.debug?this:void 0),n.push(s,u),n.push(e,o),n.push(h,c)}},r(i,[{key:"endEffectorTargetPosition",get:function(){return this.endEffectorTarget.targetPosition},set:function(t){Ir.copy(this.endEffectorTarget.targetPosition,t)}},{key:"poleTargetPosition",get:function(){return this.poleTarget.targetPosition},set:function(t){Ir.copy(this.poleTarget.targetPosition,t)}}]),i}(L3),Rtt=uo(Itt.prototype,"debug",[Co],(function(){return!1})),Mtt=uo(Itt.prototype,"endEffectorBoneName",[Co],(function(){return""})),Ctt=uo(Itt.prototype,"endEffectorTarget",[Co],(function(){return new Vtt(1)})),y(Itt.prototype,"endEffectorTargetPosition",[Ttt],Object.getOwnPropertyDescriptor(Itt.prototype,"endEffectorTargetPosition"),Itt.prototype),Ntt=uo(Itt.prototype,"poleTarget",[Co],(function(){return new Vtt(0)})),y(Itt.prototype,"poleTargetPosition",[Ott],Object.getOwnPropertyDescriptor(Itt.prototype,"poleTargetPosition"),Itt.prototype),Stt=Itt))||Stt);var $tt,ztt,Wtt,Xtt,Ytt,Ktt,qtt,Qtt,Jtt,Ztt,tit,iit,nit,rit,sit=function(t,i,n){this.hEndEffector=t,this.hMiddle=i,this.hRoot=n},eit={FLOAT:0,INTEGER:1,BOOLEAN:2,VEC3:3,QUAT:4,POSE:5},hit={listEntries:function(t){for(var i,n=[],r=w(t.animationGraph.variables);!(i=r()).done;){var s=i.value,e=s[0],h=s[1].type;if(2!==h){var u=void 0;switch(h){default:break;case 0:u=0;break;case 3:u=1;break;case 1:u=2;break;case 4:u=3;break;case 5:u=4}void 0!==u&&n.push({arg:{name:e,type:u},menu:e})}}return n},create:function(t){var i;switch(t.type){default:throw new Error("Bad create node arg: "+eit[t.type]);case 0:i=new oit;break;case 1:i=new cit;break;case 2:i=new ait;break;case 3:i=new fit;break;case 4:i=new vit}return i.variableName=t.name,i}},uit=_o(Vj+"PVNodeGetVariableBase")($tt=Cz(hit)((ztt=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).variableName=Wtt&&Wtt(),i._varInstance=void 0,i}return e(i,t),i.prototype.link=function(t){this._varInstance=t.getVar(this.variableName)},i}(Kz),Wtt=uo(ztt.prototype,"variableName",[Co],(function(){return""})),$tt=ztt))||$tt)||$tt,oit=_o(Vj+"PVNodeGetVariableFloat")(Xtt=Nz()(Xtt=Pz({inline:!0,themeColor:"#8471CF"})(Xtt=function(t){function i(){return t.call(this,0)||this}return e(i,t),i.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},i}(uit))||Xtt)||Xtt)||Xtt,cit=_o(Vj+"PVNodeGetVariableInteger")(Ytt=Nz()(Ytt=Pz({inline:!0,themeColor:"#2A90DC"})(Ytt=function(t){function i(){return t.call(this,1)||this}return e(i,t),i.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},i}(uit))||Ytt)||Ytt)||Ytt,ait=_o(Vj+"PVNodeGetVariableBoolean")(Ktt=Nz()(Ktt=Pz({inline:!0,themeColor:"#D07979"})(Ktt=function(t){function i(){return t.call(this,2)||this}return e(i,t),i.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},i}(uit))||Ktt)||Ktt)||Ktt,fit=_o(Vj+"PVNodeGetVariableVec3")(qtt=Nz()(qtt=Pz({inline:!0,themeColor:"#D97721"})(qtt=function(t){function i(){return t.call(this,3)||this}return e(i,t),i.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},i}(uit))||qtt)||qtt)||qtt,vit=_o(Vj+"PVNodeGetVariableQuat")(Qtt=Nz()(Qtt=Pz({inline:!0,themeColor:"#B169C4"})(Qtt=function(t){function i(){return t.call(this,4)||this}return e(i,t),i.prototype.selfEvaluateDefaultOutput=function(){var t;return null==(t=this._varInstance)?void 0:t.value},i}(uit))||Qtt)||Qtt)||Qtt,lit=function(){function t(){this.JR=[]}var i=t.prototype;return i.register=function(t){var i=t.group,n=this.JR.find((function(t){return t.name===i}));return n||(n=new dit(i),this.JR.push(n)),n.addMember()},i.sync=function(){for(var t,i=w(this.JR);!(t=i()).done;)t.value.sync()},t}(),dit=function(){function t(t){this.ZR=void 0,this.tM=[],this.name=t}var i=t.prototype;return i.addMember=function(){var t=new wit;return this.tM.push(t),t},i.sync=function(){var t=this.tM,i=t.length,n=this.ZR;if(this.ZR=void 0,!t.every((function(t){return!t.active}))){t.sort((function(t,i){var n=t.active?t.weight:-1;return(i.active?i.weight:-1)-n}));var r=0,s=t[0].weight;if(t[r]!==n)for(var e=0;e<i;++e){var h=t[e];if(!h.active||!xn(h.weight,s,1e-6))break;if(h===n){r=e;break}}t[r].active,this.ZR=t[r];for(var u=t[r].normalizedTime,o=0;o<i;++o){var c=t[o];if(!c.active)break;c.normalizedTime=u,c.reset()}}},t}(),wit=function(){function t(){this.normalizedTime=0,this.weight=0,this.active=!1}var i=t.prototype;return i.notifyRenter=function(t){this.reset(),this.normalizedTime=t},i.notifyUpdate=function(t,i){this.normalizedTime+=t,this.active?this.weight+=i:(this.active=!0,this.weight=i)},i.reset=function(){this.active=!1,this.weight=0},i.getSyncedEnterTime=function(){return this.normalizedTime},t}(),git=function(){function t(t){this.iM=0,this.eI=void 0,this.nM=0,this.rM=null,this.yS=new F0,this.JO=t}var i=t.prototype;return i.set=function(t,i){this.iM;var n=W0(t.graph,i);n.bind(i),this.eI=n,this.iM=1},i.settle=function(t){1===this.iM||this.iM,this.eI,this.eI.settle(t),this.iM=2},i.reset=function(){switch(this.iM){case 2:case 4:break;case 3:this.iM=4;break;case 6:case 8:this.rM&&(this.JO.destroyPose(this.rM),this.rM=null),this.nM=0,this.iM=3}},i.reenter=function(){switch(this.iM){default:this.iM;break;case 3:case 6:break;case 2:case 4:this.iM=3,this.eI,this.eI.reenter()}},i.requestUpdate=function(t){var i=t.deltaTime;if(4===this.iM||3===this.iM||5===this.iM||this.iM,this.eI,5!==this.iM){var n=Math.max(0,i-this.nM);if(6!==this.iM||!xn(n,0,1e-8)){this.iM=5,this.nM=Math.max(i,this.nM);var r=this.yS.generate(n,t.indicativeWeight);this.eI.update(r),this.iM=6}}},i.evaluate=function(t){switch(this.iM){default:this.iM;break;case 7:this.iM=8;break;case 8:break;case 6:var i;this.rM,this.iM=7;var n=null==(i=this.eI)?void 0:i.evaluate(t);if(this.iM=8,n){var r=this.JO.allocatePose();r.transforms.set(n.transforms),r.auxiliaryCurves.set(n.auxiliaryCurves),this.rM=r,t.popPose()}this.iM=8}return this.iM,this.eI,this.rM?t.pushDuplicatedPose(this.rM):null},t}(),pit=function(){function t(t){this.JO=void 0,this.sM={},this.JO=t}var i=t.prototype;return i.bindStash=function(t){return this.sM[t]},i.getStash=function(t){return this.sM[t]},i.addStash=function(t){this.sM[t]=new git(this.JO)},i.setStash=function(t,i,n){this.sM,this.sM[t].set(i,n)},i.reset=function(){for(var t in this.sM)this.sM[t].reset()},i.settle=function(t){for(var i in this.sM)this.sM[i].settle(t)},t}(),_it=function(t){function i(i,n,r){var s;(s=t.call(this)||this).eM=void 0;var e=i.layers.map((function(t){return new yit(t,n,r)}));return s.eM=e,s}e(i,t);var n=i.prototype;return n.reenter=function(){},n.bind=function(){},n.settle=function(t){for(var i=this.eM,n=i.length,r=0;r<n;++r)i[r].settle(t)},n.getLayerWeight=function(t){return t>=0&&this.eM.length,this.eM[t].weight},n.setLayerWeight=function(t,i){t>=0&&this.eM.length,this.eM[t].weight=i},n.getLayerTopLevelStateMachineEvaluation=function(t){return this.eM[t].stateMachineEvaluation},n.overrideClips=function(t){for(var i=this.eM,n=i.length,r=0;r<n;++r){var s=i[r];t._pushAdditiveFlag(s.additive),s.stateMachineEvaluation.overrideClips(t),t._popAdditiveFlag()}},n.doUpdate=function(t){for(var i=this.eM,n=i.length,r=0;r<n;++r)i[r].update(t)},n.doEvaluate=function(t){for(var i=t.pushDefaultedPose(),n=this.eM,r=n.length,s=0;s<r;++s){var e=n[s],h=e.stateMachineEvaluation.evaluate(t),u=e.weight*e.stateMachineEvaluation.passthroughWeight,o=e.transformFilter;e.additive?oq(i,h,u,o):JK(i,h,u,o),t.popPose(),e.postEvaluate()}return i},r(i,[{key:"layerCount",get:function(){return this.eM.length}}]),i}(Xz),yit=function(){function t(t,i,n){var r;this.additive=!1,this.weight=0,this.hM=void 0,this.uM=void 0,this.LO=void 0,this.oM=void 0,this.transformFilter=void 0;for(var s,e=new pit(n),h=w(t.stashes());!(s=h()).done;){var u=s.value,o=u[0];u[1],e.addStash(o)}this.uM=e;var c=new lit;this.LO=c,i._setLayerWideContextProperties(e,c);for(var a,f=w(t.stashes());!(a=f()).done;){var v=a.value,l=v[0],d=v[1];e.setStash(l,d,i)}this.weight=t.weight;var g=this.additive=t.additive;this.oM=null!==(r=t.mask)&&void 0!==r?r:void 0,i._pushAdditiveFlag(g),this.hM=new i1(t.stateMachine,t.name,i),i._popAdditiveFlag(),i._unsetLayerWideContextProperties()}var i=t.prototype;return i.settle=function(t){this.oM&&(this.transformFilter=t.createTransformFilter(this.oM)),this.uM.settle(t),this.hM.settle(t)},i.update=function(t){this.stateMachineEvaluation.update(t),this.LO.sync()},i.postEvaluate=function(){this.uM.reset()},r(t,[{key:"stateMachineEvaluation",get:function(){return this.hM}}]),t}(),mit=function(){function t(t,i,n,r){this.fM={duration:0,time:0},this.iS=void 0,this.vM={},this.lM=!1,this.UO=new a0,this.dM=void 0,this.wM=void 0,this.gM=void 0,this.pM=new F0;for(var s,e=w(t.variables);!(s=e()).done;){var h=s.value,u=h[0],o=h[1][v$]();this.vM[u]=o,o instanceof p$&&1===o.resetMode&&(this.lM=!0)}var c=new f0(i,this.UO);this.dM=c;var a=new o0(i,c,this.vM,n);a._setClipOverrides(null!=r?r:void 0),this.wM=a;var f=new C0(c);this.gM=f,c.startBind();var v=new U0;this._M=v,this.iS=new _it(t,a,v),this.yl=i,this.yM()}var i=t.prototype;return i.destroy=function(){this.mM.destroy()},i._destroyAfterException_debugging=function(){var t=this.mM._stackSize_debugging;if(0!==t)for(var i=0;i<t;++i)this.mM.popPose();this.mM.destroy()},i.update=function(t){var i=this.mM,n=this.dM,r=this.pM,s=this.iS,e=r.generate(t,1);s.update(e);var h=s.evaluate(i,1);if(this.lM){var u=this.vM;for(var o in u){var c=u[o];c instanceof p$&&1===c.resetMode&&(c.value=!1)}}n.apply(h),i.popPose()},i.getVariables=function(){return Object.entries(this.vM)},i.getCurrentStateStatus=function(t){return this.iS.getLayerTopLevelStateMachineEvaluation(t).getCurrentStateStatus()},i.getCurrentClipStatuses=function(t){return this.iS.getLayerTopLevelStateMachineEvaluation(t).getCurrentClipStatuses()},i.getCurrentTransition=function(t){var i=this.fM;return this.iS.getLayerTopLevelStateMachineEvaluation(t).getCurrentTransition(i)?i:null},i.getNextStateStatus=function(t){return this.iS.getLayerTopLevelStateMachineEvaluation(t).getNextStateStatus()},i.getNextClipStatuses=function(t){return this.iS.getLayerTopLevelStateMachineEvaluation(t).getNextClipStatuses()},i.getValue=function(t){var i=this.vM[t];return i?i.value:void 0},i.setValue=function(t,i){var n=this.vM[t];n&&(n.value=i)},i.getLayerWeight=function(t){return this.iS.getLayerWeight(t)},i.setLayerWeight=function(t,i){this.iS.setLayerWeight(t,i)},i.overrideClips=function(t){this.dM.startBind(),this.wM._setClipOverrides(t),this.iS.overrideClips(this.wM),this.kM()},i.getAuxiliaryCurveValue=function(t){return this.UO.get(t)},i.yM=function(){var t=this.dM;t.endBind(),this.AM();var i=t.createEvaluationContext();this.mM=i,t.fetchDefaultTransforms(i[M0]),t.resetPoseStashAllocator(this._M)},i.kM=function(){var t=this.dM,i=t.endBind();if(0!==i){(1&i||2&i)&&this.AM();var n=!1;if(1&i||4&i){var r=t.createEvaluationContext();this.mM.destroy(),this.mM=r,n=!0,t.resetPoseStashAllocator(this._M)}(n||1&i||2&i)&&t.fetchDefaultTransforms(this.mM[M0])}},i.AM=function(){this.iS.settle(this.gM)},r(t,[{key:"layerCount",get:function(){return this.iS.layerCount}}]),t}(),bit=ic,kit=Co,Ait=No,Eit=(Jtt=_o("cc.animation.AnimationController"),Ztt=bit(az),tit=Ait("graph"),Jtt((nit=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._graph=rit&&rit(),i.EM=null,i}e(i,t);var n=i.prototype;return n.__preload=function(){var t=this.graph;if(t){var i,n=null;if(t instanceof jJ){if(!t.original)return;i=t.original,n=t.clipOverrides}else i=t;var r=new mit(i,this.node,this,n);this.EM=r}},n.onDestroy=function(){var t;null==(t=this.EM)||t.destroy()},n.update=function(t){var i;null==(i=this.EM)||i.update(t)},n.getVariables=function(){return this.EM.getVariables()},n.setValue=function(t,i){return this.setValue_experimental(t,i)},n.setValue_experimental=function(t,i){this.EM.setValue(t,i)},n.getValue=function(t){var i=this.getValue_experimental(t);return"object"==typeof i?void 0:i},n.getValue_experimental=function(t){return this.EM.getValue(t)},n.getCurrentStateStatus=function(t){return this.EM.getCurrentStateStatus(t)},n.getCurrentClipStatuses=function(t){return this.EM.getCurrentClipStatuses(t)},n.getCurrentTransition=function(t){return this.EM.getCurrentTransition(t)},n.getNextStateStatus=function(t){return this.EM.getNextStateStatus(t)},n.getNextClipStatuses=function(t){return this.EM.getNextClipStatuses(t)},n.getLayerWeight=function(t){return this.EM.getLayerWeight(t)},n.setLayerWeight=function(t,i){return this.EM.setLayerWeight(t,i)},n.overrideClips_experimental=function(t){this.EM.overrideClips(t)},n.getAuxiliaryCurveValue_experimental=function(t){var i=this.EM;return i?i.getAuxiliaryCurveValue(t):0},r(i,[{key:"graph",get:function(){return this._graph},set:function(t){this._graph=t}},{key:"layerCount",get:function(){var t,i;return null!==(t=null==(i=this.EM)?void 0:i.layerCount)&&void 0!==t?t:0}}]),i}(Kg),y(nit.prototype,"graph",[Ztt],Object.getOwnPropertyDescriptor(nit.prototype,"graph"),nit.prototype),rit=uo(nit.prototype,"_graph",[kit,tit],(function(){return null})),iit=nit))||iit);t("a0",Object.freeze({__proto__:null,AnimationController:Eit,ColorTrack:zV,ComponentPath:NH,CubicSplineNumberValue:OV,CubicSplineQuatValue:TV,CubicSplineVec2Value:kV,CubicSplineVec3Value:AV,CubicSplineVec4Value:EV,HierarchyPath:CH,MorphWeightValueProxy:lV,MorphWeightsAllValueProxy:wV,MorphWeightsValueProxy:dV,ObjectTrack:qV,QuatTrack:HV,RealTrack:SV,SizeTrack:YV,StateMachineComponent:IZ,Track:jH,TrackPath:BH,UniformProxyFactory:hV,VariableType:{FLOAT:0,BOOLEAN:1,TRIGGER:2,INTEGER:3,VEC3_experimental:4,QUAT_experimental:5},VectorTrack:UV,isCustomPath:function(t,i){return t instanceof i},isPropertyPath:lH}));var Tit,Oit,Sit=function(){function t(){this._nodeBlendStates=new Map}var i=t.prototype;return i.createWriter=function(t,i,n,r){var s=this.ref(t,i);return new Iit(t,i,s,n,r)},i.destroyWriter=function(t){var i=t;this.deRef(i.node,i.property)},i.ref=function(t,i){var n=this._nodeBlendStates.get(t);return n||(n=this.createNodeBlendState(),this._nodeBlendStates.set(t,n)),n.refProperty(t,i)},i.deRef=function(t,i){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(i),n.empty&&this._nodeBlendStates.delete(t))},i.apply=function(){this._nodeBlendStates.forEach((function(t,i){t.apply(i)}))},t}(),Iit=function(){function t(t,i,n,r,s){this._node=t,this._property=i,this._propertyBlendState=n,this._host=r,this._constants=s}var i=t.prototype;return i.getValue=function(){return this._node[this._property]},i.setValue=function(t){var i=this._propertyBlendState,n=this._host.weight;i.blend(t,n)},r(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}(),Rit=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new Ir}var i=t.prototype;return i.blend=function(t,i){this.accumulatedWeight=Lit(this.result,this.result,this.accumulatedWeight,t,i)},i.reset=function(){this.accumulatedWeight=0,Ir.zero(this.result)},t}(),Mit=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new Qr}var i=t.prototype;return i.blend=function(t,i){this.accumulatedWeight=Dit(this.result,this.result,this.accumulatedWeight,t,i)},i.reset=function(){this.accumulatedWeight=0,Qr.identity(this.result)},t}(),Cit=function(){function t(){this._transformApplyFlags=0,this._properties={}}var i=t.prototype;return i.refProperty=function(t,i){var n,r,s,e=this._properties;switch(i){default:case"position":case"scale":case"eulerAngles":s=null!==(n=e[i])&&void 0!==n?n:e[i]=this._createVec3BlendState(t[i]);break;case"rotation":s=null!==(r=e[i])&&void 0!==r?r:e[i]=this._createQuatBlendState(t.rotation)}return++s.refCount,s},i.deRefProperty=function(t){var i=this._properties,n=i[t];n&&(--n.refCount,n.refCount>0||delete i[t])},i.apply=function(t){var i,n,r,s=this._transformApplyFlags,e=this._properties,h=e.position,u=e.scale,o=e.rotation,c=e.eulerAngles;s&&(h&&1&s&&(i=h.result),u&&4&s&&(n=u.result),c&&8&s&&(r=c.result),o&&2&s&&(r=o.result),(r||i||n)&&t.setRTS(r,i,n),this._transformApplyFlags=0)},r(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}(),Nit=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.apply=function(i){var n=this._properties,r=n.position,s=n.scale,e=n.rotation,h=n.eulerAngles;r&&r.accumulatedWeight&&(this._transformApplyFlags|=1,r.accumulatedWeight<1&&r.blend(i.position,1-r.accumulatedWeight)),s&&s.accumulatedWeight&&(this._transformApplyFlags|=4,s.accumulatedWeight<1&&s.blend(i.scale,1-s.accumulatedWeight)),h&&h.accumulatedWeight&&(this._transformApplyFlags|=8,h.accumulatedWeight<1&&h.blend(i.eulerAngles,1-h.accumulatedWeight)),e&&e.accumulatedWeight&&(this._transformApplyFlags|=2,e.accumulatedWeight<1&&e.blend(i.rotation,1-e.accumulatedWeight)),t.prototype.apply.call(this,i),null==r||r.reset(),null==s||s.reset(),null==e||e.reset(),null==h||h.reset()},n._createVec3BlendState=function(){return new Rit},n._createQuatBlendState=function(){return new Mit},i}(Cit),Pit=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.createNodeBlendState=function(){return new Nit},i}(Sit);function Lit(t,i,n,r,s){var e=n+s;if(1!==s||n){if(e){var h=s/e;Ir.lerp(t,t,r,h)}}else Ir.copy(t,r);return e}function Dit(t,i,n,r,s){var e=n+s;if(1!==s||n){if(e){var h=s/e;Qr.slerp(t,i,r,h)}}else Qr.copy(t,r);return e}var Bit=t("a9",_o((Oit=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).TM=new si([]),i.OM=new si([]),i.SM=[],i.IM=new Pit,i.RM=[],i}e(i,t);var n=i.prototype;return n.addCrossFade=function(t){-1===this.OM.array.indexOf(t)&&this.OM.push(t)},n.removeCrossFade=function(t){var i=this.OM.array.indexOf(t);i>=0?this.OM.fastRemoveAt(i):ht(3907)},n.update=function(t){var i=this.SM,n=this.OM,r=this.RM,s=n.array;for(n.i=0;n.i<s.length;++n.i)s[n.i].update(t);var e=this.TM,h=e.array;for(e.i=0;e.i<h.length;++e.i){var u=h[e.i];u.isMotionless||u.update(t)}this.IM.apply();for(var o=xN.getTotalFrames(),c=0,a=r.length;c<a;c++){var f=r[c],v=f.target,l=f.transform;v.matrix=b9(l,o)}for(var d=0,w=i.length;d<w;d++){var g=i[d];g.fn.apply(g.thisArg,g.args)}i.length=0},n.destruct=function(){},n.addAnimation=function(t){-1===this.TM.array.indexOf(t)&&this.TM.push(t)},n.removeAnimation=function(t){var i=this.TM.array.indexOf(t);i>=0?this.TM.fastRemoveAt(i):ht(3907)},n.pushDelayEvent=function(t,i,n){this.SM.push({fn:t,thisArg:i,args:n})},n.addSockets=function(t,i){for(var n=this,r=function(){var r=i[s];if(n.RM.find((function(t){return t.target===r.target})))return 1;var e=t.getChildByPath(r.path),h=r.target&&e&&k9(e,t);h&&n.RM.push({target:r.target,transform:h})},s=0;s<i.length;++s)r()},n.removeSockets=function(t,i){for(var n=0;n<i.length;++n)for(var r=i[n],s=0;s<this.RM.length;++s){var e=this.RM[s];if(e.target===r.target){A9(e.transform.node),this.RM[s]=this.RM[this.RM.length-1],this.RM.length--;break}}},r(i,[{key:"blendState",get:function(){return this.IM}},{key:"animationStates",get:function(){return this.TM.array}}]),i}(_v),Oit.ID="animation",Tit=Oit))||Tit);xN.on("director_init",(function(){var t=new Bit;xN.registerSystem(Bit.ID,t,200)})),T.AnimationManager=Bit;var Fit,Uit,xit,Git,jit,Hit,Vit,$it,zit,Wit,Xit,Yit,Kit,qit,Qit=function(t){function i(i){var n;return(n=t.call(this)||this).MM=[],n.CM=[],n.NM=!1,n.Ai=null!=i?i:Qj(),n}e(i,t);var n=i.prototype;return n.update=function(t){if(!this.isMotionless){var i=this.MM,n=this.CM;if(1===i.length&&1===n.length){var r=i[0].state;r&&(r.weight=1)}else this.PM(t);1===i.length&&1===n.length&&this.LM()}},n.crossFade=function(t,i){var n;0===this.MM.length&&(i=0),0===i&&this.clear();var r=this.MM.find((function(i){return i.state===t}));r?null!=(n=r.state)&&n.isMotionless&&r.state.play():(r={state:t,reference:0},t&&t.play(),this.MM.push(r)),++r.reference,this.CM.unshift({easeDuration:i,easeTime:0,target:r}),this.isMotionless||this.DM()},n.clear=function(){for(var t=0;t<this.MM.length;++t){var i=this.MM[t].state;i&&i.stop()}this.MM.length=0,this.CM.length=0},n.onPlay=function(){t.prototype.onPlay.call(this),this.DM()},n.onPause=function(){t.prototype.onPause.call(this);for(var i=0;i<this.MM.length;++i){var n=this.MM[i].state;n&&n.pause()}this.LM()},n.onResume=function(){t.prototype.onResume.call(this);for(var i=0;i<this.MM.length;++i){var n=this.MM[i].state;n&&n.resume()}this.DM()},n.onStop=function(){t.prototype.onStop.call(this),this.clear()},n.PM=function(t){for(var i=this.MM,n=this.CM,r=0;r<i.length;++r){var s=i[r].state;s&&(s.weight=0)}for(var e=1,h=n.length,u=0;u<n.length;++u){var o=n[u];o.easeTime+=t;var c=0===o.easeDuration?1:jn(o.easeTime/o.easeDuration),a=c*e;if(e*=1-c,o.target.state&&(o.target.state.weight+=a),o.easeTime>=o.easeDuration){h=u+1,o.easeTime=o.easeDuration;break}}if(h!==n.length){for(var f=h;f<n.length;++f){var v=n[f];--v.target.reference,v.target.reference<=0&&(v.target.state&&v.target.state.stop(),ui(this.MM,v.target))}n.splice(h)}},n.DM=function(){this.NM||(this.Ai.addCrossFade(this),this.NM=!0)},n.LM=function(){this.NM&&(this.Ai.removeCrossFade(this),this.NM=!1)},i}(Xj),Jit=t("a3",(Fit=_o("cc.Animation"),Uit=mo(99),xit=ic([mK]),Git=ic(mK),jit=ic([mK]),Fit(Hit=Uit((Xit=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).playOnLoad=$it&&$it(),i._crossFade=new Qit,i._nameToState=It(!0),i._clips=zit&&zit(),i._defaultClip=Wit&&Wit(),i.BM=!1,i}e(i,t);var n=i.prototype;return n.onLoad=function(){for(var t in this.clips=this._clips,this._nameToState)this._nameToState[t].initialize(this.node)},n.start=function(){this.playOnLoad&&!this.BM&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var t in this._crossFade.stop(),this._nameToState)this._nameToState[t].destroy();this._nameToState=It(!0)},n.play=function(t){if(this.BM=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)},n.crossFade=function(t,i){void 0===i&&(i=.3),this.BM=!0;var n=this._nameToState[t];n&&this.doPlayOrCrossFade(n,i)},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getState=function(t){var i=this._nameToState[t];return i&&!i.curveLoaded&&i.initialize(this.node),i||null},n.createState=function(t,i){return i=i||t.name,this.removeState(i),this._doCreateState(t,i)},n.removeState=function(t){var i=this._nameToState[t];i&&(i.allowLastFrameEvent(!1),i.stop(),delete this._nameToState[t])},n.addClip=function(t,i){return ai(this._clips,t)||this._clips.push(t),this.createState(t,i)},n.removeClip=function(t,i){var n;for(var r in this._nameToState){var s=this._nameToState[r];if(s.clip===t){n=s;break}}if(t===this._defaultClip){if(!i)return void st(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!i)return void st(3903);n.stop()}this._clips=this._clips.filter((function(i){return i!==t})),n&&delete this._nameToState[n.name]},n.on=function(i,n,r,s){var e=t.prototype.on.call(this,i,n,r,s);return"lastframe"===i&&this.FM(),e},n.once=function(i,n,r){var s=t.prototype.once.call(this,i,n,r);return"lastframe"===i&&this.FM(),s},n.off=function(i,n,r){t.prototype.off.call(this,i,n,r),"lastframe"===i&&this.UM()},n._createState=function(t,i){return new nH(t,i)},n._doCreateState=function(t,i){var n=this._createState(t,i);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener("lastframe")),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n.doPlayOrCrossFade=function(t,i){this._crossFade.play(),this._crossFade.crossFade(t,i)},n.xM=function(t){for(var i in this._nameToState){var n=this._nameToState[i];Zit(t,n.clip)&&(n.stop(),delete this._nameToState[i])}},n.FM=function(){if(this.hasEventListener("lastframe"))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)},n.UM=function(){if(!this.hasEventListener("lastframe"))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)},r(i,[{key:"clips",get:function(){return this._clips},set:function(t){var i=this;this._crossFade&&this._crossFade.clear(),this._clips.forEach((function(t){t&&i.xM(t)})),t.forEach((function(t){t&&i.createState(t)}));var n=t.find((function(t){return Zit(t,i._defaultClip)}));this._defaultClip=n||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){this._defaultClip=t,t&&(this._clips.findIndex((function(i){return Zit(i,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),i}(sh(Kg)),Xit.EventType=Jj,y((Vit=Xit).prototype,"clips",[xit],Object.getOwnPropertyDescriptor(Vit.prototype,"clips"),Vit.prototype),y(Vit.prototype,"defaultClip",[Git],Object.getOwnPropertyDescriptor(Vit.prototype,"defaultClip"),Vit.prototype),$it=uo(Vit.prototype,"playOnLoad",[Co],(function(){return!1})),zit=uo(Vit.prototype,"_clips",[jit],(function(){return[]})),Wit=uo(Vit.prototype,"_defaultClip",[Co],(function(){return null})),Hit=Vit))||Hit)||Hit));function Zit(t,i){return t===i||!!t&&!!i&&t._uuid===i._uuid&&t._uuid}T.Animation=Jit,T.AnimationComponent=Jit,qt(Jit,"cc.AnimationComponent"),function(t){t.PLAYED="play",t.PAUSED="pause",t.STOPPED="stop",t.SEEKED="seeked",t.ENDED="ended",t.INTERRUPTION_BEGIN="interruptionBegin",t.INTERRUPTION_END="interruptionEnd",t.USER_GESTURE="on_gesture"}(Yit||(Yit={})),function(t){t[t.DOM_AUDIO=0]="DOM_AUDIO",t[t.WEB_AUDIO=1]="WEB_AUDIO",t[t.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",t[t.NATIVE_AUDIO=3]="NATIVE_AUDIO",t[t.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(Kit||(Kit={})),function(t){t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.STOPPED=3]="STOPPED",t[t.INTERRUPTED=4]="INTERRUPTED"}(qit||(qit={}));var tnt=t("ae",function(){function t(){this.GM=void 0,this.jM=1;for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];if(2===i.length)this.GM=i[0],this.jM=i[1];else{var r=i[0],s=i[1],e=i[2];this.GM=new s(r),this.jM=e}}return t.prototype.getData=function(t){return this.GM[t]*this.jM},r(t,[{key:"length",get:function(){return this.GM.length}}]),t}());function int(t){for(var i=t.HM.length,n=t.HM.slice(),r=[],s=!1,e=i-1;e>=0;e--){var h=n[e];if("stop"===h.op){r.push(h);break}if("seek"===h.op)s||(r.push(h),s=!0);else{if(s){r.push(h);break}0===r.length&&r.push(h)}}t.HM=r.reverse()}var nnt,rnt=0;function snt(t,i){var n;i.invoking||(i.invoking=!0,(n=i.func).call.apply(n,[t].concat(i.args)).then((function(){i.invoking=!1,t.HM.shift(),t.Ih.emit(i.id.toString()),t.Ih.off(i.id.toString()),int(t);var n=t.HM[0];n&&snt(t,n)})).catch((function(){})))}function ent(t,i,n){var r=n.value;n.value=function(){for(var t=this,n=arguments.length,s=new Array(n),e=0;e<n;e++)s[e]=arguments[e];return new Promise((function(n){var e=rnt++,h=t;h.HM.push({op:i,id:e,func:r,args:s,invoking:!1}),h.Ih.once(e.toString(),n),snt(h,h.HM[0])}))}}function hnt(t){return new Promise((function(i){var n=t.play();return void 0===n?i():(n.then(i).catch((function(){var n=function n(){t.play().then((function(){null==r||r.removeEventListener("touchend",n,{capture:!0}),null==r||r.removeEventListener("mouseup",n,{capture:!0})})).catch((function(){})),i()},r=document.getElementById("GameCanvas");null==r||r.addEventListener("touchend",n,{capture:!0}),null==r||r.addEventListener("mouseup",n,{capture:!0})})),null)}))}var unt,ont,cnt=function(){function t(t,i){this.VM=void 0,this.$M=void 0,this.zM=void 0,this.VM=t,t.volume=i}var i=t.prototype;return i.play=function(){var t=this;hnt(this.VM).then((function(){null==t.onPlay||t.onPlay()})).catch((function(){}))},i.stop=function(){this.VM.pause()},r(t,[{key:"onPlay",get:function(){return this.$M},set:function(t){this.$M=t}},{key:"onEnd",get:function(){return this.zM},set:function(t){this.zM&&this.VM.removeEventListener("ended",this.zM),this.zM=t,t&&this.VM.addEventListener("ended",t)}}]),t}(),ant=(nnt=function(){function t(t){var i=this;this.VM=void 0,this.iM=qit.INIT,this.WM=void 0,this.Ih=new eh,this.HM=[],this.VM=t,uP.on(hP.EVENT_PAUSE,this.XM,this),uP.on(hP.EVENT_RESUME,this.YM,this),this.WM=function(){i.seek(0).catch((function(){})),i.iM=qit.INIT,i.Ih.emit(Yit.ENDED)},this.VM.addEventListener("ended",this.WM)}var i=t.prototype;return i.destroy=function(){uP.off(hP.EVENT_PAUSE,this.XM,this),uP.off(hP.EVENT_RESUME,this.YM,this),this.VM.removeEventListener("ended",this.WM),this.VM=null},t.load=function(i){return new Promise((function(n,r){t.loadNative(i).then((function(i){n(new t(i))})).catch(r)}))},t.loadNative=function(t){return new Promise((function(i,n){var r=document.createElement("audio"),s="canplaythrough";wh.os===ch.IOS?s="loadedmetadata":wh.browserType===hh.FIREFOX&&(s="canplay");var e=setTimeout((function(){0===r.readyState?o():u()}),8e3),h=function(){clearTimeout(e),r.removeEventListener(s,u,!1),r.removeEventListener("error",o,!1)},u=function(){h(),i(r)},o=function(){h(),n(new Error("load audio failure - "+t))};r.addEventListener(s,u,!1),r.addEventListener("error",o,!1),r.src=t}))},t.loadOneShotAudio=function(i,n){return new Promise((function(r,s){t.loadNative(i).then((function(t){var i=new cnt(t,n);r(i)})).catch(s)}))},i.XM=function(){var t=this;this.iM===qit.PLAYING&&this.pause().then((function(){t.iM=qit.INTERRUPTED,t.Ih.emit(Yit.INTERRUPTION_BEGIN)})).catch((function(){}))},i.YM=function(){var t=this;this.iM===qit.INTERRUPTED&&this.play().then((function(){t.Ih.emit(Yit.INTERRUPTION_END)})).catch((function(){}))},i.getPCMData=function(){},i.seek=function(t){return t=Gn(t,0,this.duration),this.VM.currentTime=t,Promise.resolve()},i.play=function(){var t=this;return new Promise((function(i){hnt(t.VM).then((function(){t.iM=qit.PLAYING,i()})).catch((function(){}))}))},i.pause=function(){return this.VM.pause(),this.iM=qit.PAUSED,Promise.resolve()},i.stop=function(){var t=this;return new Promise((function(i){t.VM.pause(),t.VM.currentTime=0,t.iM=qit.STOPPED,i()}))},i.onInterruptionBegin=function(t){this.Ih.on(Yit.INTERRUPTION_BEGIN,t)},i.offInterruptionBegin=function(t){this.Ih.off(Yit.INTERRUPTION_BEGIN,t)},i.onInterruptionEnd=function(t){this.Ih.on(Yit.INTERRUPTION_END,t)},i.offInterruptionEnd=function(t){this.Ih.off(Yit.INTERRUPTION_END,t)},i.onEnded=function(t){this.Ih.on(Yit.ENDED,t)},i.offEnded=function(t){this.Ih.off(Yit.ENDED,t)},r(t,[{key:"src",get:function(){return this.VM?this.VM.src:""}},{key:"type",get:function(){return Kit.DOM_AUDIO}},{key:"state",get:function(){return this.iM}},{key:"loop",get:function(){return this.VM.loop},set:function(t){this.VM.loop=t}},{key:"volume",get:function(){return this.VM.volume},set:function(t){t=jn(t),this.VM.volume=t}},{key:"duration",get:function(){return this.VM.duration}},{key:"currentTime",get:function(){return this.VM.currentTime}},{key:"sampleRate",get:function(){return 0}}]),t}(),y(nnt.prototype,"seek",[ent],Object.getOwnPropertyDescriptor(nnt.prototype,"seek"),nnt.prototype),y(nnt.prototype,"play",[ent],Object.getOwnPropertyDescriptor(nnt.prototype,"play"),nnt.prototype),y(nnt.prototype,"pause",[ent],Object.getOwnPropertyDescriptor(nnt.prototype,"pause"),nnt.prototype),y(nnt.prototype,"stop",[ent],Object.getOwnPropertyDescriptor(nnt.prototype,"stop"),nnt.prototype),nnt),fnt=function(){function t(t){this.KM=void 0,this.Qw=0,this.qM=0,this.nA=!0,this.KM=t}var i=t.prototype;return i.destroy=function(){this.KM=void 0},i.QM=function(){return performance.now()/1e3},i.JM=function(){var t=this.QM()-this.Qw,i=this.qM+t;return i>=this.duration&&(this.Qw=this.QM(),this.qM=0),i%this.duration},i.start=function(){this.nA=!1,this.Qw=this.QM()},i.pause=function(){this.nA||(this.nA=!0,this.qM=this.JM())},i.stop=function(){this.nA=!0,this.qM=0},i.seek=function(t){this.Qw=this.QM(),this.qM=Gn(t,0,this.duration)},r(t,[{key:"duration",get:function(){return this.KM.duration}},{key:"currentTime",get:function(){return this.nA?this.qM:this.JM()}}]),t}(),vnt=new(function(){function t(){this.ZM={}}var i=t.prototype;return i.tC=function(t,i){this.ZM[t]?st(5204,t):this.ZM[t]={iC:1,nC:i}},i.rC=function(t){var i=this.ZM[t];i?i.iC++:st(5203,t)},i.sC=function(t){var i=this.ZM[t];return null==i?void 0:i.nC},i.eC=function(t){var i=this.ZM[t];i?--i.iC<=0&&delete this.ZM[t]:st(5203,t)},t}()),lnt=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,dnt="on-context-running",wnt=function(){function t(){var t=this;this.Ih=void 0,this.Gs=void 0,this.hC=!1,this.Gs=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),this.Ih=new eh,this.Gs.onstatechange=function(){"running"===t.Gs.state?(t.hC=!0,t.Ih.emit(dnt)):t.hC=!1}}var i=t.prototype;return i.onceRunning=function(t,i){this.Ih.once(dnt,t,i)},i.offRunning=function(t,i){this.Ih.off(dnt,t,i)},i.decodeAudioData=function(t){var i=this;return new Promise((function(n,r){var s=i.Gs.decodeAudioData(t,(function(t){n(t)}),(function(t){console.error("failed to load Web Audio",t)}));null==s||s.catch(r)}))},i.runContext=function(){var t=this;return new Promise((function(i){if(t.isRunning)i();else{var n=t.Gs;if(n.resume){if("suspended"===n.state)n.resume().catch((function(t){W("runContext error",t)}));else if("running"===n.state)return void i();var r=document.getElementById("GameCanvas"),s=function t(){n.resume().then((function(){null==r||r.removeEventListener("touchend",t,{capture:!0}),null==r||r.removeEventListener("mouseup",t,{capture:!0}),i()})).catch((function(t){W("onGesture resume error",t)}))};null==r||r.addEventListener("touchend",s,{capture:!0}),null==r||r.addEventListener("mouseup",s,{capture:!0})}else i()}}))},i.createBufferSource=function(t,i){var n=this.Gs.createBufferSource();return void 0!==t&&(n.buffer=t),void 0!==i&&(n.loop=i),n},i.createGain=function(t){void 0===t&&(t=1);var i=this.Gs.createGain();return this.setGainValue(i,t),i},i.setGainValue=function(t,i){if(t.gain.setTargetAtTime)try{t.gain.setTargetAtTime(i,this.Gs.currentTime,0)}catch(n){t.gain.setTargetAtTime(i,this.Gs.currentTime,.01)}else t.gain.value=i},i.connectContext=function(t){this.Gs&&t.connect(this.Gs.destination)},r(t,[{key:"isRunning",get:function(){return this.hC}},{key:"currentTime",get:function(){return this.Gs.currentTime}}]),t}();wnt.support=!!lnt,wnt.support&&(ont=new wnt);var gnt,pnt,_nt,ynt,mnt=function(){function t(t,i,n){this.hE=void 0,this.uC=void 0,this.$M=void 0,this.oC=0,this.fC=void 0,this.zM=void 0,this.hE=t.duration,this.fC=n,this.uC=ont.createBufferSource(t,!1);var r=ont.createGain(i);this.uC.connect(r),ont.connectContext(r)}var i=t.prototype;return i.play=function(){var t=this;this.uC.start(),ont.runContext().then((function(){null==t.onPlay||t.onPlay(),t.oC=window.setTimeout((function(){vnt.eC(t.fC),null==t.onEnd||t.onEnd()}),1e3*t.hE)})).catch((function(t){W("play error",t)}))},i.stop=function(){clearTimeout(this.oC),vnt.eC(this.fC),this.uC.stop(),this.uC.disconnect(),this.uC.buffer=null},r(t,[{key:"onPlay",get:function(){return this.$M},set:function(t){this.$M=t}},{key:"onEnd",get:function(){return this.zM},set:function(t){this.zM=t}}]),t}(),bnt=(unt=function(){function t(t,i){this.vC=void 0,this.lC=void 0,this.dC=void 0,this.wC=void 0,this.oC=0,this.gC=1,this.pC=!1,this.iM=qit.INIT,this._C=void 0,this.yC=void 0,this.Ih=new eh,this.HM=[],this.lC=t,this._C=new fnt(t),this.wC=ont.createGain(),ont.connectContext(this.wC),this.vC=i,uP.on(hP.EVENT_PAUSE,this.XM,this),uP.on(hP.EVENT_RESUME,this.YM,this)}var i=t.prototype;return i.destroy=function(){window.clearTimeout(this.oC),this._C.destroy(),this.lC&&(this.lC=null),vnt.eC(this.vC),uP.off(hP.EVENT_PAUSE,this.XM,this),uP.off(hP.EVENT_RESUME,this.YM,this),this.mC()},t.load=function(i){return new Promise((function(n,r){t.loadNative(i).then((function(r){n(new t(r,i))})).catch(r)}))},t.loadNative=function(t){return new Promise((function(i,n){var r=vnt.sC(t);if(r)return vnt.rC(t),void i(r);var s=new XMLHttpRequest,e="load audio failed: "+t+", status: ";s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(){200===s.status||0===s.status?ont.decodeAudioData(s.response).then((function(n){vnt.tC(t,n),i(n)})).catch((function(i){W("loadNative error",t,i)})):n(new Error(""+e+s.status+"(no response)"))},s.onerror=function(){n(new Error(""+e+s.status+"(error)"))},s.ontimeout=function(){n(new Error(""+e+s.status+"(time out)"))},s.onabort=function(){n(new Error(""+e+s.status+"(abort)"))},s.send(null)}))},t.loadOneShotAudio=function(i,n){return new Promise((function(r,s){t.loadNative(i).then((function(t){var s=new mnt(t,n,i);r(s)})).catch(s)}))},i.getPCMData=function(t){return new tnt(this.lC.getChannelData(t),1)},i.XM=function(){var t=this;this.iM===qit.PLAYING&&this.pause().then((function(){t.iM=qit.INTERRUPTED,t.Ih.emit(Yit.INTERRUPTION_BEGIN)})).catch((function(t){W("_onInterruptedBegin error",t)}))},i.YM=function(){var t=this;this.iM===qit.INTERRUPTED&&this.play().then((function(){t.Ih.emit(Yit.INTERRUPTION_END)})).catch((function(t){W("_onInterruptedEnd error",t)}))},i.mC=function(){this.yC&&(ont.offRunning(this.yC),this.yC=void 0)},i.seek=function(t){var i=this;return new Promise((function(n){i.mC(),i._C.seek(t),i.iM===qit.PLAYING?i.bC().then(n).catch((function(t){W("seek error",t)})):n()}))},i.play=function(){return this.mC(),this.bC()},i.bC=function(){var t=this;return new Promise((function(i){ont.isRunning?(t.kC(),i()):(t.mC(),t.yC=function(){t.kC(),i()},ont.onceRunning(t.yC),ont.runContext().catch((function(t){W("doPlay error",t)})))}))},i.kC=function(){var t=this;this.AC(),this.dC=ont.createBufferSource(this.lC,this.loop),this.dC.connect(this.wC),this.dC.loop=this.pC,this.dC.start(0,this._C.currentTime),this.iM=qit.PLAYING,this._C.start(),window.clearTimeout(this.oC),this.oC=window.setTimeout((function i(){t.loop?t.oC=window.setTimeout(i,1e3*t.lC.duration):(t._C.stop(),t.Ih.emit(Yit.ENDED),t.iM=qit.INIT)}),1e3*(this.lC.duration-this._C.currentTime))},i.AC=function(){try{this.dC&&(this.dC.stop(),this.dC.disconnect(),this.dC.buffer=null,this.dC=void 0)}catch(t){}},i.pause=function(){return this.mC(),this.iM===qit.PLAYING&&this.dC?(this._C.pause(),this.iM=qit.PAUSED,window.clearTimeout(this.oC),this.AC(),Promise.resolve()):Promise.resolve()},i.stop=function(){return this.mC(),this.dC?(this._C.stop(),this.iM=qit.STOPPED,window.clearTimeout(this.oC),this.AC(),Promise.resolve()):(this._C.stop(),this.iM=qit.STOPPED,Promise.resolve())},i.onInterruptionBegin=function(t){this.Ih.on(Yit.INTERRUPTION_BEGIN,t)},i.offInterruptionBegin=function(t){this.Ih.off(Yit.INTERRUPTION_BEGIN,t)},i.onInterruptionEnd=function(t){this.Ih.on(Yit.INTERRUPTION_END,t)},i.offInterruptionEnd=function(t){this.Ih.off(Yit.INTERRUPTION_END,t)},i.onEnded=function(t){this.Ih.on(Yit.ENDED,t)},i.offEnded=function(t){this.Ih.off(Yit.ENDED,t)},r(t,[{key:"sampleRate",get:function(){return this.lC.sampleRate}},{key:"src",get:function(){return this.vC}},{key:"type",get:function(){return Kit.WEB_AUDIO}},{key:"state",get:function(){return this.iM}},{key:"loop",get:function(){return this.pC},set:function(t){this.pC=t,this.dC&&(this.dC.loop=t)}},{key:"volume",get:function(){return this.gC},set:function(t){t=jn(t),this.gC=t,ont.setGainValue(this.wC,t)}},{key:"duration",get:function(){return this.lC.duration}},{key:"currentTime",get:function(){return this._C.currentTime}}]),t}(),y(unt.prototype,"seek",[ent],Object.getOwnPropertyDescriptor(unt.prototype,"seek"),unt.prototype),y(unt.prototype,"play",[ent],Object.getOwnPropertyDescriptor(unt.prototype,"play"),unt.prototype),y(unt.prototype,"pause",[ent],Object.getOwnPropertyDescriptor(unt.prototype,"pause"),unt.prototype),y(unt.prototype,"stop",[ent],Object.getOwnPropertyDescriptor(unt.prototype,"stop"),unt.prototype),unt),knt=function(){function t(t){this.EC=void 0,this.EC=t}var i=t.prototype;return i.play=function(){this.EC.play()},i.stop=function(){this.EC.stop()},r(t,[{key:"onPlay",get:function(){return this.EC.onPlay},set:function(t){this.EC.onPlay=t}},{key:"onEnd",get:function(){return this.EC.onEnd},set:function(t){this.EC.onEnd=t}}]),t}(),Ant=function(){function t(t){this.TC=void 0,this.TC=t}t.load=function(i,n){return new Promise((function(r,s){(null==n?void 0:n.audioLoadMode)!==Kit.DOM_AUDIO&&wnt.support?bnt.load(i).then((function(i){r(new t(i))})).catch(s):(wnt.support||st(5201),ant.load(i).then((function(i){r(new t(i))})).catch(s))}))};var i=t.prototype;return i.destroy=function(){this.TC.destroy()},t.loadNative=function(t,i){return(null==i?void 0:i.audioLoadMode)!==Kit.DOM_AUDIO&&wnt.support?bnt.loadNative(t):(wnt.support||st(5201),ant.loadNative(t))},t.loadOneShotAudio=function(t,i,n){return new Promise((function(r,s){(null==n?void 0:n.audioLoadMode)!==Kit.DOM_AUDIO&&wnt.support?bnt.loadOneShotAudio(t,i).then((function(t){r(new knt(t))})).catch(s):(wnt.support||st(5201),ant.loadOneShotAudio(t,i).then((function(t){r(new knt(t))})).catch(s))}))},i.getPCMData=function(t){return this.TC.getPCMData(t)},i.seek=function(t){return this.TC.seek(t)},i.play=function(){return this.TC.play()},i.pause=function(){return this.TC.pause()},i.stop=function(){return this.TC.stop()},i.onInterruptionBegin=function(t){this.TC.onInterruptionBegin(t)},i.offInterruptionBegin=function(t){this.TC.offInterruptionBegin(t)},i.onInterruptionEnd=function(t){this.TC.onInterruptionEnd(t)},i.offInterruptionEnd=function(t){this.TC.offInterruptionEnd(t)},i.onEnded=function(t){this.TC.onEnded(t)},i.offEnded=function(t){this.TC.offEnded(t)},r(t,[{key:"src",get:function(){return this.TC.src}},{key:"type",get:function(){return this.TC.type}},{key:"state",get:function(){return this.TC.state}},{key:"loop",get:function(){return this.TC.loop},set:function(t){this.TC.loop=t}},{key:"volume",get:function(){return this.TC.volume},set:function(t){this.TC.volume=t}},{key:"duration",get:function(){return this.TC.duration}},{key:"currentTime",get:function(){return this.TC.currentTime}},{key:"sampleRate",get:function(){return this.TC.sampleRate}}]),t}();Ant.maxAudioChannel=24;var Ent=t("ad",_o("cc.AudioClip")((ynt=function(t){function i(i){var n;return(n=t.call(this,i)||this)._duration=_nt&&_nt(),n._loadMode=Kit.UNKNOWN_AUDIO,n._meta=null,n.TC=null,n}e(i,t);var n=i.prototype;return n.destroy=function(){var i,n=t.prototype.destroy.call(this);return null==(i=this.TC)||i.destroy(),this.TC=null,this._meta&&(this._meta.player=null),n},n.validate=function(){return!!this._meta},n.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},n.getCurrentTime=function(){return this.TC?this.TC.currentTime:0},n.getVolume=function(){return this.TC?this.TC.volume:0},n.getLoop=function(){return!!this.TC&&this.TC.loop},n.setCurrentTime=function(t){var i;null==(i=this.TC)||i.seek(t).catch((function(){}))},n.setVolume=function(t){this.TC&&(this.TC.volume=t)},n.setLoop=function(t){this.TC&&(this.TC.loop=t)},n.play=function(){var t;null==(t=this.TC)||t.play().catch((function(){}))},n.pause=function(){var t;null==(t=this.TC)||t.pause().catch((function(){}))},n.stop=function(){var t;null==(t=this.TC)||t.stop().catch((function(){}))},n.playOneShot=function(t){void 0===t&&(t=1),this._nativeAsset&&Ant.loadOneShotAudio(this._nativeAsset.url,t).then((function(t){t.play()})).catch((function(){}))},r(i,[{key:"duration",set:function(t){this._duration=t}},{key:"_nativeAsset",get:function(){return this._meta},set:function(t){this._meta=t,t?(this._loadMode=t.type,this.TC=t.player):(this._meta=null,this._loadMode=Kit.UNKNOWN_AUDIO,this._duration=0)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this.TC?this.TC.state:qit.INIT}}]),i}(rg),ynt.AudioType=Kit,_nt=uo((pnt=ynt).prototype,"_duration",[Co],(function(){return 0})),y(pnt.prototype,"_nativeDep",[ac],Object.getOwnPropertyDescriptor(pnt.prototype,"_nativeDep"),pnt.prototype),gnt=pnt))||gnt);function Tnt(t,i,n){Ant.load(t,{audioLoadMode:i.audioLoadMode}).then((function(i){var r={player:i,url:t,duration:i.duration,type:i.type};n(null,r)})).catch((function(t){n(t)}))}function Ont(t,i,n,r){var s=new Ent;s._nativeUrl=t,s._nativeAsset=i,s.duration=i.duration,r(null,s)}T.AudioClip=Ent,Yb.register({".mp3":Tnt,".ogg":Tnt,".wav":Tnt,".m4a":Tnt}),uk.register({".mp3":Ont,".ogg":Ont,".wav":Ont,".m4a":Ont});var Snt,Int,Rnt,Mnt,Cnt,Nnt,Pnt,Lnt,Dnt,Bnt,Fnt=new(function(){function t(){this.OC=[],this.SC=[]}var i=t.prototype;return i.IC=function(t,i){return t.findIndex((function(t){return t.RC===i}))},i.MC=function(t,i){var n=this.IC(t,i);if(n>-1)return t[n].CC=performance.now(),!1;var r={RC:i,CC:performance.now()};return t.push(r),!0},i.NC=function(t){t instanceof Ant?this.MC(this.SC,t):this.MC(this.OC,t)},i.PC=function(t,i){var n=this.IC(t,i);return-1!==n&&(hi(t,n),!0)},i.LC=function(t){t instanceof Ant?this.PC(this.SC,t):this.PC(this.OC,t)},i.DC=function(){var t;this.SC.length+this.OC.length<Ant.maxAudioChannel||(this.OC.length>0?this.OC.forEach((function(i){(!t||i.CC<t.CC)&&(t=i)})):this.SC.forEach((function(i){(!t||i.CC<t.CC)&&(t=i)})),t&&(t.RC.stop(),this.LC(t.RC)))},i.BC=function(){this.OC.forEach((function(t){t.RC.stop()})),this.SC.forEach((function(t){t.RC.pause().catch((function(){}))}))},i.FC=function(){this.SC.forEach((function(t){t.RC.play().catch((function(){}))}))},t}()),Unt="audiosource-loaded",xnt=t("ac",(Snt=_o("cc.AudioSource"),Int=ic(Ent),Rnt=ic(Ent),Snt((Bnt=function(t){function i(){var i;return(i=t.call(this)||this)._clip=Nnt&&Nnt(),i._player=null,i.xC=!1,i._loop=Pnt&&Pnt(),i._playOnAwake=Lnt&&Lnt(),i._volume=Dnt&&Dnt(),i.GC=-1,i.jC=[],i.HC=!1,i.VC=null,i}e(i,t);var n=i.prototype;return n.$C=function(){this._player&&(Fnt.LC(this._player),this.zC(),this._player.destroy(),this._player=null)},n.WC=function(){var t=this,i=this._clip;if(this.VC!==i)return i?void(i._nativeAsset?(this.HC=!1,this.VC=i,this.jC.length=0,Ant.load(i._nativeAsset.url,{audioLoadMode:i.loadMode}).then((function(n){var r;t.VC===i?(t.HC=!0,t.$C(),t._player=n,t._syncStates(),null==(r=t.node)||r.emit(Unt)):n.destroy()})).catch((function(){}))):console.error("Invalid audio clip")):(this.VC=null,void this.$C())},n.XC=function(){var t=this;if(!this.xC&&this._player){var i=this._player;i.onEnded((function(){var n;Fnt.LC(i),null==(n=t.node)||n.emit("ended",t)})),i.onInterruptionBegin((function(){Fnt.LC(i)})),i.onInterruptionEnd((function(){t._player===i&&Fnt.NC(i)})),this.xC=!0}},n.zC=function(){this._player&&this.xC&&(this._player.offEnded(),this._player.offInterruptionBegin(),this._player.offInterruptionEnd(),this.xC=!1)},n.onLoad=function(){this.WC()},n.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},n.onDisable=function(){var t=this.YC();null!=t&&t._persistNode||this.pause()},n.onDestroy=function(){this.stop(),this.clip=null},n.getPCMData=function(t){var i=this;return new Promise((function(n){if(0!==t&&1!==t)return W("Only support channel index 0 or 1 to get buffer"),void n(void 0);var r;i._player?n(i._player.getPCMData(t)):null==(r=i.node)||r.once(Unt,(function(){var r;n(null==(r=i._player)?void 0:r.getPCMData(t))}))}))},n.getSampleRate=function(){var t=this;return new Promise((function(i){var n;t._player?i(t._player.sampleRate):null==(n=t.node)||n.once(Unt,(function(){i(t._player.sampleRate)}))}))},n.YC=function(){for(var t,i,n=this.node,r=null==(t=n)||null==(i=t.parent)?void 0:i.parent;r;){var s,e,h;r=null==(e=n=null==(s=n)?void 0:s.parent)||null==(h=e.parent)?void 0:h.parent}return n},n.play=function(){var t=this;if(this.HC||!this.clip){var i;this.XC(),Fnt.DC(),this.state===qit.PLAYING&&(null==(i=this._player)||i.stop().catch((function(){})));var n=this._player;n&&(n.play().then((function(){var i;null==(i=t.node)||i.emit("started",t)})).catch((function(){Fnt.LC(n)})),Fnt.NC(n))}else this.jC.push({op:"play",params:null})},n.pause=function(){var t;this.HC||!this.clip?null==(t=this._player)||t.pause().catch((function(){})):this.jC.push({op:"pause",params:null})},n.stop=function(){this.HC||!this.clip?this._player&&(this._player.stop().catch((function(){})),Fnt.LC(this._player)):this.jC.push({op:"stop",params:null})},n.playOneShot=function(t,i){var n;void 0===i&&(i=1),t._nativeAsset?Ant.loadOneShotAudio(t._nativeAsset.url,this._volume*i,{audioLoadMode:t.loadMode}).then((function(t){n=t,Fnt.DC(),t.onEnd=function(){Fnt.LC(t)},t.play(),Fnt.NC(t)})).catch((function(){n&&Fnt.LC(n)})):console.error("Invalid audio clip")},n._syncStates=function(){var t=this;this._player&&(this._player.loop=this._loop,this._player.volume=this._volume,this.jC.forEach((function(i){var n;"seek"===i.op?(t.GC=i.params&&i.params[0],t._player&&t._player.seek(t.GC).catch((function(){}))):null==(n=t[i.op])||n.call(t)})),this.jC.length=0)},r(i,[{key:"clip",get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this.WC())}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._player&&(this._player.loop=t)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"volume",get:function(){return this._volume},set:function(t){Number.isNaN(t)?W("illegal audio volume!"):(t=Gn(t,0,1),this._player?(this._player.volume=t,this._volume=this._player.volume):this._volume=t)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this.GC<0?0:this.GC},set:function(t){var i;Number.isNaN(t)?W("illegal audio time!"):(t=Gn(t,0,this.duration),this.HC||!this.clip?(this.GC=t,null==(i=this._player)||i.seek(this.GC).catch((function(){}))):this.jC.push({op:"seek",params:[t]}))}},{key:"duration",get:function(){var t,i;return null!==(t=null==(i=this._clip)?void 0:i.getDuration())&&void 0!==t?t:this._player?this._player.duration:0}},{key:"state",get:function(){return this._player?this._player.state:qit.INIT}},{key:"playing",get:function(){return this.state===i.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return Ant.maxAudioChannel}}]),i}(Kg),Bnt.AudioState=qit,Bnt.EventType={STARTED:"started",ENDED:"ended"},Nnt=uo((Cnt=Bnt).prototype,"_clip",[Int],(function(){return null})),Pnt=uo(Cnt.prototype,"_loop",[Co],(function(){return!1})),Lnt=uo(Cnt.prototype,"_playOnAwake",[Co],(function(){return!0})),Dnt=uo(Cnt.prototype,"_volume",[Co],(function(){return 1})),y(Cnt.prototype,"clip",[Rnt],Object.getOwnPropertyDescriptor(Cnt.prototype,"clip"),Cnt.prototype),Mnt=Cnt))||Mnt));T.AudioSourceComponent=xnt,qt(xnt,"cc.AudioSourceComponent"),O.log=z,O.warn=W,O.error=X,O.assert=Y,O._throw=Q,O.logID=tt,O.warnID=st,O.errorID=ht,O.assertID=ot,O.debug=dt,O.path={join:Xf,extname:Yf,mainFileName:Kf,basename:qf,dirname:Qf,changeExtname:Jf,changeBasename:Zf,_normalize:tv,stripSep:iv,get sep(){return nv()}};var Gnt,jnt,Hnt=t("dR",function(){function t(t){this.T=[],this.poolHandlerComp=t}var i=t.prototype;return i.size=function(){return this.T.length},i.clear=function(){for(var t=this.T.length,i=0;i<t;++i)this.T[i].destroy();this.T.length=0},i.put=function(t){if(t&&-1===this.T.indexOf(t)){t.removeFromParent();var i=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;i&&i.unuse&&i.unuse(),this.T.push(t)}},i.get=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var r=this.T.length-1;if(r<0)return null;var s=this.T[r];this.T.length=r;var e=this.poolHandlerComp?s.getComponent(this.poolHandlerComp):null;return e&&e.reuse&&e.reuse(arguments),s},t}());O.NodePool=Hnt;var Vnt=null!==(Gnt=globalThis.jsb)&&void 0!==Gnt?Gnt:{};t("e7",{DownloaderHints:Vnt.DownloaderHints,Downloader:Vnt.Downloader,zipUtils:Vnt.zipUtils,fileUtils:Vnt.fileUtils,DebugRenderer:Vnt.DebugRenderer,copyTextToClipboard:null==(jnt=Vnt.copyTextToClipboard)?void 0:jnt.bind(Vnt),garbageCollect:Vnt.garbageCollect,reflection:Vnt.reflection,bridge:Vnt.bridge,jsbBridgeWrapper:Vnt.jsbBridgeWrapper,AssetsManager:Vnt.AssetsManager,EventAssetsManager:Vnt.EventAssetsManager,Manifest:Vnt.Manifest,saveImageData:Vnt.saveImageData,process:Vnt.process,adpf:Vnt.adpf}),O.renderer=Fx;var $nt=function(){function t(t,i,n,r){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=!1),void 0===r&&(r=null),this.light=t,this.probe=r,this.level=i,this.culledByLight=n}return t.prototype.reset=function(t,i,n,r){this.light=t,this.probe=r,this.level=i,this.culledByLight=n},t}(),znt=function(){function t(t,i,n,r,s){void 0===t&&(t=""),void 0===i&&(i=""),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=1),this.source=t,this.target=i,this.resolveFlags=n,this.mode=r,this.mode1=s}return t.prototype.reset=function(t,i,n,r,s){this.source=t,this.target=i,this.resolveFlags=n,this.mode=r,this.mode1=s},t}(),Wnt=function(){function t(t,i,n,r,s,e,h,u,o,c){void 0===t&&(t=""),void 0===i&&(i=""),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=0),this.source=t,this.target=i,this.mipLevels=n,this.numSlices=r,this.sourceMostDetailedMip=s,this.sourceFirstSlice=e,this.sourcePlaneSlice=h,this.targetMostDetailedMip=u,this.targetFirstSlice=o,this.targetPlaneSlice=c}return t.prototype.reset=function(t,i,n,r,s,e,h,u,o,c){this.source=t,this.target=i,this.mipLevels=n,this.numSlices=r,this.sourceMostDetailedMip=s,this.sourceFirstSlice=e,this.sourcePlaneSlice=h,this.targetMostDetailedMip=u,this.targetFirstSlice=o,this.targetPlaneSlice=c},t}(),Xnt=function(){function t(t,i,n,r,s,e,h){void 0===t&&(t=new Uint8Array(0)),void 0===i&&(i=""),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),this.source=t,this.target=i,this.mipLevels=n,this.numSlices=r,this.targetMostDetailedMip=s,this.targetFirstSlice=e,this.targetPlaneSlice=h}return t.prototype.reset=function(t,i,n,r,s,e){this.target=t,this.mipLevels=i,this.numSlices=n,this.targetMostDetailedMip=r,this.targetFirstSlice=s,this.targetPlaneSlice=e},t}(),Ynt=function(){function t(t,i,n,r,s,e,h){void 0===t&&(t=""),void 0===i&&(i=""),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),this.source=t,this.target=i,this.mipLevels=n,this.numSlices=r,this.targetMostDetailedMip=s,this.targetFirstSlice=e,this.targetPlaneSlice=h}return t.prototype.reset=function(t,i,n,r,s,e,h){this.source=t,this.target=i,this.mipLevels=n,this.numSlices=r,this.targetMostDetailedMip=s,this.targetFirstSlice=e,this.targetPlaneSlice=h},t}(),Knt=function(){function t(){this.numRenderPasses=0,this.numManagedTextures=0,this.totalManagedTextures=0,this.numUploadBuffers=0,this.numUploadBufferViews=0,this.numFreeUploadBuffers=0,this.numFreeUploadBufferViews=0,this.numDescriptorSets=0,this.numFreeDescriptorSets=0,this.numInstancingBuffers=0,this.numInstancingUniformBlocks=0}return t.prototype.reset=function(){this.numRenderPasses=0,this.numManagedTextures=0,this.totalManagedTextures=0,this.numUploadBuffers=0,this.numUploadBufferViews=0,this.numFreeUploadBuffers=0,this.numFreeUploadBufferViews=0,this.numDescriptorSets=0,this.numFreeDescriptorSets=0,this.numInstancingBuffers=0,this.numInstancingUniformBlocks=0},t}();function qnt(t){return new Ge((function(){return new t}),16)}var Qnt,Jnt,Znt,trt=function(){function t(){this.KC=qnt($nt),this.qC=qnt(znt),this.QC=qnt(Wnt),this.JC=qnt(Xnt),this.ZC=qnt(Ynt),this.tN=qnt(Knt)}var i=t.prototype;return i.reset=function(){this.KC.reset(),this.qC.reset(),this.QC.reset(),this.JC.reset(),this.ZC.reset(),this.tN.reset()},i.createLightInfo=function(t,i,n,r){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=!1),void 0===r&&(r=null);var s=this.KC.add();return s.reset(t,i,n,r),s},i.createResolvePair=function(t,i,n,r,s){void 0===t&&(t=""),void 0===i&&(i=""),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=1);var e=this.qC.add();return e.reset(t,i,n,r,s),e},i.createCopyPair=function(t,i,n,r,s,e,h,u,o,c){void 0===t&&(t=""),void 0===i&&(i=""),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===o&&(o=0),void 0===c&&(c=0);var a=this.QC.add();return a.reset(t,i,n,r,s,e,h,u,o,c),a},i.createUploadPair=function(t,i,n,r,s,e){void 0===t&&(t=""),void 0===i&&(i=4294967295),void 0===n&&(n=4294967295),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0);var h=this.JC.add();return h.reset(t,i,n,r,s,e),h},i.createMovePair=function(t,i,n,r,s,e,h){void 0===t&&(t=""),void 0===i&&(i=""),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0);var u=this.ZC.add();return u.reset(t,i,n,r,s,e,h),u},i.createPipelineStatistics=function(){var t=this.tN.add();return t.reset(),t},t}(),irt=function(){function t(t,i){this.source=void 0,this.target=void 0,this.source=t,this.target=i}return t.prototype.equals=function(t){return this.source===t.source&&this.target===t.target},t}(),nrt=function(){function t(t){this.target=void 0,this.target=t}return t.prototype.equals=function(t){return this.target===t.target},t}();Qnt=Symbol.iterator;var rrt=function(){function t(t,i){this.iterator=void 0,this.source=void 0,this.iterator=t,this.source=i}var i=t.prototype;return i[Qnt]=function(){return this},i.next=function(){var t=this.iterator.next();return t.done?{value:void 0,done:!0}:{value:new irt(this.source,t.value.target),done:!1}},t}();Jnt=Symbol.iterator;var srt=function(){function t(t,i){this.iterator=void 0,this.source=void 0,this.iterator=t,this.source=i}var i=t.prototype;return i[Jnt]=function(){return this},i.next=function(){var t=this.iterator.next();return t.done?{value:void 0,done:!0}:{value:new irt(t.value.target,this.source),done:!1}},t}();Znt=Symbol.iterator;var ert=function(){function t(t,i){this.graph=void 0,this.iterator=void 0,this.graph=t,this.iterator=i}var i=t.prototype;return i[Znt]=function(){return this},i.next=function(){var t=this.iterator.next();return t.done?{value:void 0,done:!0}:{value:this.graph.target(t.value),done:!1}},t}();function hrt(t,i){if(i===t.N)return"";for(var n=[];i!==t.N;i=t.getParent(i))n.push(t.vertexName(i));for(var r="",s=n.length;s-- >0;)r+="/",r+=n[s];return r}function urt(t,i,n){var r=t.N,s=n.split("/");if(0===s.length)return i;var e=i,h=0;""===s[0]&&(e=r,++h);for(var u=h;u!==s.length;++u){var o=s[u];if(""!==o&&"."!==o)if(".."!==o){if((e=t.locateChild(e,o))===r)return r}else{if(e===r)return r;e=t.getParent(e)}}return e}var ort=function(){function t(){}return t.prototype.terminate=function(){return!1},t}();function crt(t){var i=t.v().next();return i.done?t.N:i.value}var art=function(t,i,n){this.v=void 0,this.e=void 0,this.iter=void 0,this.v=t,this.e=i,this.iter=n};function frt(t,i,n,r,s){var e=null,h=null,u=new Array;for(r.put(i,1),n.discoverVertex(i,t),h=t.oe(i),s.terminate(i,t)?u.push(new art(i,null,null)):u.push(new art(i,null,h));u.length;){var o=u.pop();if(i=o.v,e=o.e,h=o.iter,null!==e&&n.finishEdge(e,t),h)for(var c=h.next();!c.done;c=h.next()){var a=c.value,f=a.target;n.examineEdge(a,t);var v=r.get(f);if(0===v){if(n.treeEdge(a,t),e=a,u.push(new art(i,e,h)),i=f,r.put(i,1),n.discoverVertex(i,t),h=t.oe(i),s.terminate(i,t))break}else 1===v?n.backEdge(a,t):n.forwardOrCrossEdge(a,t),n.finishEdge(a,t)}r.put(i,4),n.finishVertex(i,t)}}function vrt(t,i,n,r){if(void 0===r&&(r=null),null!==(r=r||crt(t))&&0!==t.nv()){for(var s,e=w(t.v());!(s=e()).done;){var h=s.value;n.put(h,0),i.initializeVertex(h,t)}var u=new ort;r!==crt(t)&&(i.startVertex(r,t),frt(t,r,i,n,u));for(var o,c=w(t.v());!(o=c()).done;){var a=o.value;0===n.get(a)&&(i.startVertex(a,t),frt(t,a,i,n,u))}}}var lrt=function(){function t(){}var i=t.prototype;return i.initializeVertex=function(){},i.startVertex=function(){},i.discoverVertex=function(){},i.examineEdge=function(){},i.treeEdge=function(){},i.backEdge=function(){},i.forwardOrCrossEdge=function(){},i.finishEdge=function(){},i.finishVertex=function(){},t}(),drt=function(){function t(t){this.g=void 0,this.g=t,this.N=t.N}var i=t.prototype;return i.edge=function(t,i){return this.g.reference(t,i)},i.source=function(t){return this.g.parent(t)},i.target=function(t){return this.g.child(t)},i.oe=function(t){return this.g.children(t)},i.od=function(t){return this.g.numChildren(t)},i.v=function(){return this.g.v()},i.nv=function(){return this.g.nv()},t}();function wrt(t){t.x=0,t.y=0,t.z=0,t.w=0}function grt(t){t.left=0,t.top=0,t.width=0,t.height=0,t.minDepth=0,t.maxDepth=1}var prt=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=i,this.z=n,this.w=r}return t.prototype.reset=function(t,i,n,r){this.x=t,this.y=i,this.z=n,this.w=r},t}(),_rt=function(){function t(t,i,n,r,s,e,h,u){void 0===t&&(t=""),void 0===i&&(i=2),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=7),void 0===h&&(h=new xl),void 0===u&&(u=0),this.slotName1="",this.slotID=0,this.slotName=t,this.accessType=i,this.attachmentType=n,this.loadOp=r,this.storeOp=s,this.clearFlags=e,this.clearColor=h,this.shaderStageFlags=u}return t.prototype.reset=function(t,i,n,r,s,e,h){this.slotName=t,this.slotName1="",this.accessType=i,this.attachmentType=n,this.loadOp=r,this.storeOp=s,this.clearFlags=e,wrt(this.clearColor),this.slotID=0,this.shaderStageFlags=h},t}(),yrt=function(){function t(t,i,n,r,s,e){void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=new prt),void 0===e&&(e=0),this.plane=0,this.name=t,this.accessType=i,this.clearFlags=n,this.clearValueType=r,this.clearValue=s,this.shaderStageFlags=e}return t.prototype.reset=function(t,i,n,r,s){this.name=t,this.accessType=i,this.plane=0,this.clearFlags=n,this.clearValueType=r,this.clearValue.reset(0,0,0,0),this.shaderStageFlags=s},t}(),mrt=function(){function t(){this.dimension=0,this.alignment=0,this.width=0,this.height=0,this.depthOrArraySize=0,this.mipLevels=0,this.format=0,this.sampleCount=1,this.textureFlags=0,this.flags=0,this.viewType=1}return t.prototype.reset=function(){this.dimension=0,this.alignment=0,this.width=0,this.height=0,this.depthOrArraySize=0,this.mipLevels=0,this.format=0,this.sampleCount=1,this.textureFlags=0,this.flags=0,this.viewType=1},t}(),brt=function(){function t(t){void 0===t&&(t=0),this.residency=t}return t.prototype.reset=function(t){this.residency=t},t}(),krt=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this.renderWindow=null,this.currentID=0,this.numBackBuffers=0,this.generation=4294967295,this.swapchain=t,this.isDepthStencil=i}return t.prototype.reset=function(t,i){this.swapchain=t,this.renderWindow=null,this.currentID=0,this.numBackBuffers=0,this.generation=4294967295,this.isDepthStencil=i},t}(),Art=function(){function t(){this.states=0}return t.prototype.reset=function(){this.states=0},t}(),Ert=function(){function t(t){void 0===t&&(t=null),this.fenceValue=0,this.buffer=t}return t.prototype.reset=function(t){this.buffer=t,this.fenceValue=0},t}(),Trt=function(){function t(t){void 0===t&&(t=null),this.fenceValue=0,this.buffer=t}return t.prototype.reset=function(t){this.buffer=t,this.fenceValue=0},t}(),Ort=function(){function t(t){void 0===t&&(t=null),this.fenceValue=0,this.texture=t}return t.prototype.reset=function(t){this.texture=t,this.fenceValue=0},t}(),Srt=function(){function t(t){void 0===t&&(t=null),this.fenceValue=0,this.texture=t}return t.prototype.reset=function(t){this.texture=t,this.fenceValue=0},t}(),Irt=function(){function t(){this.unused=0}return t.prototype.reset=function(){this.unused=0},t}(),Rrt=function(){function t(){this.rasterViews=new Map,this.computeViews=new Map,this.resolvePairs=[]}return t.prototype.reset=function(){this.rasterViews.clear(),this.computeViews.clear(),this.resolvePairs.length=0},t}(),Mrt=function(){this.o=[],this.i=[]},Crt=function(){function t(){this.N=4294967295,this.x=[],this._names=[],this._subpasses=[]}var i=t.prototype;return i.edge=function(t,i){for(var n,r=w(this.x[t].o);!(n=r()).done;)if(i===n.value.target)return!0;return!1},i.source=function(t){return t.source},i.target=function(t){return t.target},i.oe=function(t){return new rrt(this.x[t].o.values(),t)},i.od=function(t){return this.x[t].o.length},i.ie=function(t){return new srt(this.x[t].i.values(),t)},i.id=function(t){return this.x[t].i.length},i.d=function(t){return this.od(t)+this.id(t)},i.adj=function(t){return new ert(this,this.oe(t))},i.v=function(){return this.x.keys()},i.nv=function(){return this.x.length},i.ne=function(){for(var t,i=0,n=w(this.v());!(t=n()).done;){var r=t.value;i+=this.od(r)}return i},i.clear=function(){this._names.length=0,this._subpasses.length=0,this.x.length=0},i.addVertex=function(t,i){var n=new Mrt,r=this.x.length;return this.x.push(n),this._names.push(t),this._subpasses.push(i),r},i.addEdge=function(t,i){return this.x[t].o.push(new nrt(i)),this.x[i].i.push(new nrt(t)),new irt(t,i)},i.vertexName=function(t){return this._names[t]},i.getName=function(t){return this._names[t]},i.setName=function(t,i){this._names[t]=i},i.getSubpass=function(t){return this._subpasses[t]},t}(),Nrt=function(){function t(t,i,n){void 0===t&&(t=4294967295),void 0===i&&(i=1),void 0===n&&(n=0),this.rasterViews=new Map,this.computeViews=new Map,this.resolvePairs=[],this.viewport=new Ul,this.showStatistics=!1,this.subpassID=t,this.count=i,this.quality=n}return t.prototype.reset=function(t,i,n){this.rasterViews.clear(),this.computeViews.clear(),this.resolvePairs.length=0,grt(this.viewport),this.subpassID=t,this.count=i,this.quality=n,this.showStatistics=!1},t}(),Prt=function(){function t(t){void 0===t&&(t=4294967295),this.rasterViews=new Map,this.computeViews=new Map,this.subpassID=t}return t.prototype.reset=function(t){this.rasterViews.clear(),this.computeViews.clear(),this.subpassID=t},t}(),Lrt=function(){function t(){this.rasterViews=new Map,this.computeViews=new Map,this.attachmentIndexMap=new Map,this.textures=new Map,this.subpassGraph=new Crt,this.width=0,this.height=0,this.count=1,this.quality=0,this.viewport=new Ul,this.versionName="",this.version=0,this.hashValue=0,this.showStatistics=!1}return t.prototype.reset=function(){this.rasterViews.clear(),this.computeViews.clear(),this.attachmentIndexMap.clear(),this.textures.clear(),this.subpassGraph.clear(),this.width=0,this.height=0,this.count=1,this.quality=0,grt(this.viewport),this.versionName="",this.version=0,this.hashValue=0,this.showStatistics=!1},t}(),Drt=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.clearColors=[],this.clearDepth=0,this.clearStencil=0,this.renderPass=t,this.framebuffer=i}return t.prototype.reset=function(t,i){this.renderPass=t,this.framebuffer=i,this.clearColors.length=0,this.clearDepth=0,this.clearStencil=0},t}(),Brt=function(){function t(){this.format=0}return t.prototype.reset=function(){this.format=0},t}(),Frt=function(){function t(){this.textureView=null,this.format=0,this.indexOrFirstMipLevel=0,this.numMipLevels=0,this.firstArraySlice=0,this.numArraySlices=0,this.firstPlane=0,this.numPlanes=0}return t.prototype.reset=function(){this.textureView=null,this.format=0,this.indexOrFirstMipLevel=0,this.numMipLevels=0,this.firstArraySlice=0,this.numArraySlices=0,this.firstPlane=0,this.numPlanes=0},t}(),Urt=function(t,i){this.o=[],this.i=[],this.t=void 0,this.j=void 0,this.id=t,this.object=i,this.t=t,this.j=i},xrt=function(){function t(){this.N=4294967295,this.x=[],this._names=[],this._descs=[],this._traits=[],this._states=[],this._samplerInfo=[],this._valueIndex=new Map,this.renderPasses=new Map,this.nextFenceValue=0,this.version=0}var i=t.prototype;return i.edge=function(t,i){for(var n,r=w(this.x[t].o);!(n=r()).done;)if(i===n.value.target)return!0;return!1},i.source=function(t){return t.source},i.target=function(t){return t.target},i.oe=function(t){return new rrt(this.x[t].o.values(),t)},i.od=function(t){return this.x[t].o.length},i.ie=function(t){return new srt(this.x[t].i.values(),t)},i.id=function(t){return this.x[t].i.length},i.d=function(t){return this.od(t)+this.id(t)},i.adj=function(t){return new ert(this,this.oe(t))},i.v=function(){return this.x.keys()},i.nv=function(){return this.x.length},i.ne=function(){for(var t,i=0,n=w(this.v());!(t=n()).done;){var r=t.value;i+=this.od(r)}return i},i.clear=function(){this.renderPasses.clear(),this.nextFenceValue=0,this.version=0,this._valueIndex.clear(),this._names.length=0,this._descs.length=0,this._traits.length=0,this._states.length=0,this._samplerInfo.length=0,this.x.length=0},i.addVertex=function(t,i,n,r,s,e,h,u){void 0===u&&(u=4294967295);var o=new Urt(t,i),c=this.x.length;return this.x.push(o),this._names.push(n),this._descs.push(r),this._traits.push(s),this._states.push(e),this._samplerInfo.push(h),this._valueIndex.set(n,c),4294967295!==u&&this.addEdge(u,c),c},i.addEdge=function(t,i){return this.x[t].o.push(new nrt(i)),this.x[i].i.push(new nrt(t)),new irt(t,i)},i.vertexName=function(t){return this._names[t]},i.getName=function(t){return this._names[t]},i.setName=function(t,i){this._names[t]=i},i.getDesc=function(t){return this._descs[t]},i.getTraits=function(t){return this._traits[t]},i.getStates=function(t){return this._states[t]},i.getSampler=function(t){return this._samplerInfo[t]},i.h=function(t,i){return this.x[i].t===t},i.w=function(t){return this.x[t].t},i.object=function(t){return this.x[t].j},i.value=function(t,i){if(this.x[i].t===t)return this.x[i].j;throw Error("value id not match")},i.visitVertex=function(t,i){var n=this.x[i];switch(n.t){case 0:return t.managed(n.j);case 1:return t.managedBuffer(n.j);case 2:return t.managedTexture(n.j);case 3:return t.persistentBuffer(n.j);case 4:return t.persistentTexture(n.j);case 5:return t.framebuffer(n.j);case 6:return t.swapchain(n.j);case 7:return t.formatView(n.j);case 8:return t.subresourceView(n.j);default:throw Error("polymorphic type not found")}},i.j=function(t){return this.x[t].j},i.reference=function(t,i){for(var n,r=w(this.x[t].o);!(n=r()).done;)if(i===n.value.target)return!0;return!1},i.parent=function(t){return t.source},i.child=function(t){return t.target},i.children=function(t){return new rrt(this.x[t].o.values(),t)},i.numChildren=function(t){return this.x[t].o.length},i.getParent=function(t){if(4294967295===t)return 4294967295;var i=this.x[t].i;return 0===i.length?4294967295:i[0].target},i.addReference=function(t,i){return this.addEdge(t,i)},i.contains=function(t){return this._valueIndex.has(t)},i.vertex=function(t){return this._valueIndex.get(t)},i.find=function(t){var i=this._valueIndex.get(t);return void 0===i?4294967295:i},t}(),Grt=function(){function t(){this.computeViews=new Map,this.textures=new Map}return t.prototype.reset=function(){this.computeViews.clear(),this.textures.clear()},t}(),jrt=function(){function t(){this.resolvePairs=[]}return t.prototype.reset=function(){this.resolvePairs.length=0},t}(),Hrt=function(){function t(){this.copyPairs=[],this.uploadPairs=[]}return t.prototype.reset=function(){this.copyPairs.length=0,this.uploadPairs.length=0},t}(),Vrt=function(){function t(){this.movePairs=[]}return t.prototype.reset=function(){this.movePairs.length=0},t}(),$rt=function(){function t(){this.computeViews=new Map}return t.prototype.reset=function(){this.computeViews.clear()},t}(),zrt=function(){function t(t,i,n){void 0===t&&(t=""),void 0===i&&(i=7),void 0===n&&(n=new xl),this.slotName=t,this.clearFlags=i,this.clearColor=n}return t.prototype.reset=function(t,i){this.slotName=t,this.clearFlags=i,wrt(this.clearColor)},t}(),Wrt=function(){function t(t,i,n){void 0===t&&(t=1),void 0===i&&(i=4294967295),void 0===n&&(n=4294967295),this.viewport=null,this.hint=t,this.phaseID=i,this.passLayoutID=n}return t.prototype.reset=function(t,i,n){this.hint=t,this.phaseID=i,this.passLayoutID=n,this.viewport=null},t}(),Xrt=function(){function t(t,i,n,r,s,e){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=new $nt),void 0===s&&(s=1),void 0===e&&(e=null),this.scene=t,this.camera=i,this.light=r,this.flags=n,this.cullingFlags=s,this.shadingLight=e}return t.prototype.reset=function(t,i,n,r,s){this.scene=t,this.camera=i,this.light.reset(null,0,!1,null),this.flags=n,this.cullingFlags=r,this.shadingLight=s},t}(),Yrt=function(){function t(t,i,n,r,s){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),this.material=t,this.passID=i,this.threadGroupCountX=n,this.threadGroupCountY=r,this.threadGroupCountZ=s}return t.prototype.reset=function(t,i,n,r,s){this.material=t,this.passID=i,this.threadGroupCountX=n,this.threadGroupCountY=r,this.threadGroupCountZ=s},t}(),Krt=function(){function t(t,i,n,r,s){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=null),void 0===s&&(s=0),this.models=[],this.material=t,this.passID=i,this.sceneFlags=n,this.camera=r,this.blitType=s}return t.prototype.reset=function(t,i,n,r,s){this.material=t,this.passID=i,this.sceneFlags=n,this.camera=r,this.blitType=s,this.models.length=0},t}(),qrt=function(){function t(){this.constants=new Map,this.buffers=new Map,this.textures=new Map,this.samplers=new Map,this.custom=""}return t.prototype.reset=function(){this.constants.clear(),this.buffers.clear(),this.textures.clear(),this.samplers.clear(),this.custom=""},t}(),Qrt=function(t,i){this.o=[],this.i=[],this.c=[],this.p=[],this.t=void 0,this.j=void 0,this.id=t,this.object=i,this.t=t,this.j=i},Jrt=function(){function t(){this.N=4294967295,this.x=[],this._names=[],this._layoutNodes=[],this._data=[],this._valid=[],this.index=new Map,this.sortedVertices=[],this.globalRenderData=new qrt}var i=t.prototype;return i.edge=function(t,i){for(var n,r=w(this.x[t].o);!(n=r()).done;)if(i===n.value.target)return!0;return!1},i.source=function(t){return t.source},i.target=function(t){return t.target},i.oe=function(t){return new rrt(this.x[t].o.values(),t)},i.od=function(t){return this.x[t].o.length},i.ie=function(t){return new srt(this.x[t].i.values(),t)},i.id=function(t){return this.x[t].i.length},i.d=function(t){return this.od(t)+this.id(t)},i.adj=function(t){return new ert(this,this.oe(t))},i.v=function(){return this.x.keys()},i.nv=function(){return this.x.length},i.ne=function(){for(var t,i=0,n=w(this.v());!(t=n()).done;){var r=t.value;i+=this.od(r)}return i},i.clear=function(){this.index.clear(),this.sortedVertices.length=0,this.globalRenderData.reset(),this._names.length=0,this._layoutNodes.length=0,this._data.length=0,this._valid.length=0,this.x.length=0},i.addVertex=function(t,i,n,r,s,e,h){void 0===h&&(h=4294967295);var u=new Qrt(t,i),o=this.x.length;return this.x.push(u),this._names.push(n),this._layoutNodes.push(r),this._data.push(s),this._valid.push(e),4294967295!==h&&(this.x[h].c.push(new nrt(o)),u.p.push(new nrt(h))),o},i.addEdge=function(t,i){return this.x[t].o.push(new nrt(i)),this.x[i].i.push(new nrt(t)),new irt(t,i)},i.vertexName=function(t){return this._names[t]},i.getName=function(t){return this._names[t]},i.setName=function(t,i){this._names[t]=i},i.getLayout=function(t){return this._layoutNodes[t]},i.setLayout=function(t,i){this._layoutNodes[t]=i},i.getData=function(t){return this._data[t]},i.getValid=function(t){return this._valid[t]},i.setValid=function(t,i){this._valid[t]=i},i.h=function(t,i){return this.x[i].t===t},i.w=function(t){return this.x[t].t},i.object=function(t){return this.x[t].j},i.value=function(t,i){if(this.x[i].t===t)return this.x[i].j;throw Error("value id not match")},i.visitVertex=function(t,i){var n=this.x[i];switch(n.t){case 0:return t.rasterPass(n.j);case 1:return t.rasterSubpass(n.j);case 2:return t.computeSubpass(n.j);case 3:return t.compute(n.j);case 4:return t.resolve(n.j);case 5:return t.copy(n.j);case 6:return t.move(n.j);case 7:return t.raytrace(n.j);case 8:return t.queue(n.j);case 9:return t.scene(n.j);case 10:return t.blit(n.j);case 11:return t.dispatch(n.j);case 12:return t.clear(n.j);case 13:return t.viewport(n.j);default:throw Error("polymorphic type not found")}},i.j=function(t){return this.x[t].j},i.reference=function(t,i){for(var n,r=w(this.x[t].c);!(n=r()).done;)if(i===n.value.target)return!0;return!1},i.parent=function(t){return t.source},i.child=function(t){return t.target},i.children=function(t){return new rrt(this.x[t].c.values(),t)},i.numChildren=function(t){return this.x[t].c.length},i.getParent=function(t){if(4294967295===t)return 4294967295;var i=this.x[t].p;return 0===i.length?4294967295:i[0].target},i.addReference=function(t,i){return this.x[t].c.push(new nrt(i)),this.x[i].p.push(new nrt(t)),new irt(t,i)},t}();function Zrt(t){return new Ge((function(){return new t}),16)}var tst=function(){function t(t){this.renderCommon=void 0,this.iN=Zrt(prt),this.nN=Zrt(_rt),this.rN=Zrt(yrt),this.sN=Zrt(mrt),this.eN=Zrt(brt),this.hN=Zrt(krt),this.uN=Zrt(Art),this.oN=Zrt(Ert),this.fN=Zrt(Trt),this.vN=Zrt(Ort),this.lN=Zrt(Srt),this.dN=Zrt(Irt),this.wN=Zrt(Rrt),this.gN=Zrt(Crt),this.pN=Zrt(Nrt),this._N=Zrt(Prt),this.qC=Zrt(Lrt),this.yN=Zrt(Drt),this.mN=Zrt(Brt),this.kN=Zrt(Frt),this.AN=Zrt(xrt),this.QC=Zrt(Grt),this.EN=Zrt(jrt),this.TN=Zrt(Hrt),this.ZC=Zrt(Vrt),this.SN=Zrt($rt),this.IN=Zrt(zrt),this.RN=Zrt(Wrt),this.MN=Zrt(Xrt),this.CN=Zrt(Yrt),this.NN=Zrt(Krt),this.PN=Zrt(qrt),this.LN=Zrt(Jrt),this.renderCommon=t}var i=t.prototype;return i.reset=function(){this.iN.reset(),this.nN.reset(),this.rN.reset(),this.sN.reset(),this.eN.reset(),this.hN.reset(),this.uN.reset(),this.oN.reset(),this.fN.reset(),this.vN.reset(),this.lN.reset(),this.dN.reset(),this.wN.reset(),this.gN.reset(),this.pN.reset(),this._N.reset(),this.qC.reset(),this.yN.reset(),this.mN.reset(),this.kN.reset(),this.AN.reset(),this.QC.reset(),this.EN.reset(),this.TN.reset(),this.ZC.reset(),this.SN.reset(),this.IN.reset(),this.RN.reset(),this.MN.reset(),this.CN.reset(),this.NN.reset(),this.PN.reset(),this.LN.reset()},i.createClearValue=function(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var s=this.iN.add();return s.reset(t,i,n,r),s},i.createRasterView=function(t,i,n,r,s,e,h){void 0===t&&(t=""),void 0===i&&(i=2),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=7),void 0===h&&(h=0);var u=this.nN.add();return u.reset(t,i,n,r,s,e,h),u},i.createComputeView=function(t,i,n,r,s){void 0===t&&(t=""),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0);var e=this.rN.add();return e.reset(t,i,n,r,s),e},i.createResourceDesc=function(){var t=this.sN.add();return t.reset(),t},i.createResourceTraits=function(t){void 0===t&&(t=0);var i=this.eN.add();return i.reset(t),i},i.createRenderSwapchain=function(t,i){void 0===t&&(t=null),void 0===i&&(i=!1);var n=this.hN.add();return n.reset(t,i),n},i.createResourceStates=function(){var t=this.uN.add();return t.reset(),t},i.createManagedBuffer=function(t){void 0===t&&(t=null);var i=this.oN.add();return i.reset(t),i},i.createPersistentBuffer=function(t){void 0===t&&(t=null);var i=this.fN.add();return i.reset(t),i},i.createManagedTexture=function(t){void 0===t&&(t=null);var i=this.vN.add();return i.reset(t),i},i.createPersistentTexture=function(t){void 0===t&&(t=null);var i=this.lN.add();return i.reset(t),i},i.createManagedResource=function(){var t=this.dN.add();return t.reset(),t},i.createSubpass=function(){var t=this.wN.add();return t.reset(),t},i.createSubpassGraph=function(){var t=this.gN.add();return t.clear(),t},i.createRasterSubpass=function(t,i,n){void 0===t&&(t=4294967295),void 0===i&&(i=1),void 0===n&&(n=0);var r=this.pN.add();return r.reset(t,i,n),r},i.createComputeSubpass=function(t){void 0===t&&(t=4294967295);var i=this._N.add();return i.reset(t),i},i.createRasterPass=function(){var t=this.qC.add();return t.reset(),t},i.createPersistentRenderPassAndFramebuffer=function(t,i){void 0===t&&(t=null),void 0===i&&(i=null);var n=this.yN.add();return n.reset(t,i),n},i.createFormatView=function(){var t=this.mN.add();return t.reset(),t},i.createSubresourceView=function(){var t=this.kN.add();return t.reset(),t},i.createResourceGraph=function(){var t=this.AN.add();return t.clear(),t},i.createComputePass=function(){var t=this.QC.add();return t.reset(),t},i.createResolvePass=function(){var t=this.EN.add();return t.reset(),t},i.createCopyPass=function(){var t=this.TN.add();return t.reset(),t},i.createMovePass=function(){var t=this.ZC.add();return t.reset(),t},i.createRaytracePass=function(){var t=this.SN.add();return t.reset(),t},i.createClearView=function(t,i){void 0===t&&(t=""),void 0===i&&(i=7);var n=this.IN.add();return n.reset(t,i),n},i.createRenderQueue=function(t,i,n){void 0===t&&(t=1),void 0===i&&(i=4294967295),void 0===n&&(n=4294967295);var r=this.RN.add();return r.reset(t,i,n),r},i.createSceneData=function(t,i,n,r,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=null);var e=this.MN.add();return e.reset(t,i,n,r,s),e},i.createDispatch=function(t,i,n,r,s){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0);var e=this.CN.add();return e.reset(t,i,n,r,s),e},i.createBlit=function(t,i,n,r,s){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=null),void 0===s&&(s=0);var e=this.NN.add();return e.reset(t,i,n,r,s),e},i.createRenderData=function(){var t=this.PN.add();return t.reset(),t},i.createRenderGraph=function(){var t=this.LN.add();return t.clear(),t},t}(),ist=function(){this.subpass=0};function nst(t,i){i.name=t.s(),i.type=t.n(),i.count=t.n()}function rst(t,i){var n;i.set=t.n(),i.binding=t.n(),i.name=t.s(),n=t.n(),i.members.length=n;for(var r=0;r!==n;++r){var s=new Jl;nst(t,s),i.members[r]=s}i.count=t.n()}function sst(t,i){i.binding=t.n(),i.descriptorType=t.n(),i.count=t.n(),i.stageFlags=t.n()}function est(t,i){var n=t.n();i.bindings.length=n;for(var r=0;r!==n;++r){var s=new md;sst(t,s),i.bindings[r]=s}}var hst=function(){};hst.type=0,hst.isWebGPU=!1;var ust=function(){function t(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),this.descriptorID=t,this.type=i,this.count=n}return t.prototype.reset=function(t,i,n){this.descriptorID=t,this.type=i,this.count=n},t}(),ost=function(){function t(t,i,n,r,s,e,h){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),this.offset=0,this.descriptors=[],this.type=t,this.visibility=i,this.capacity=n,this.accessType=r,this.viewDimension=s,this.sampleType=e,this.format=h}return t.prototype.reset=function(t,i,n,r,s,e,h){this.type=t,this.visibility=i,this.offset=0,this.capacity=n,this.accessType=r,this.viewDimension=s,this.sampleType=e,this.format=h,this.descriptors.length=0},t}(),cst=function(){function t(t,i,n,r,s){void 0===t&&(t=4294967295),void 0===i&&(i=0),void 0===n&&(n=[]),void 0===r&&(r=new Map),void 0===s&&(s=new Map),this.uniformBlockCapacity=0,this.samplerTextureCapacity=0,this.slot=t,this.capacity=i,this.descriptorBlocks=n,this.uniformBlocks=r,this.bindingMap=s}return t.prototype.reset=function(t,i){this.slot=t,this.capacity=i,this.uniformBlockCapacity=0,this.samplerTextureCapacity=0,this.descriptorBlocks.length=0,this.uniformBlocks.clear(),this.bindingMap.clear()},t}(),ast=function(){function t(t,i,n){void 0===t&&(t=new cst),void 0===i&&(i=null),void 0===n&&(n=null),this.descriptorSetLayoutInfo=new bd,this.descriptorSetLayoutData=t,this.descriptorSetLayout=i,this.descriptorSet=n}return t.prototype.reset=function(t,i){this.descriptorSetLayoutData.reset(4294967295,0),this.descriptorSetLayoutInfo.bindings.length=0,this.descriptorSetLayout=t,this.descriptorSet=i},t}(),fst=function(){function t(){this.descriptorSets=new Map,this.descriptorGroups=new Map}var i=t.prototype;return i.reset=function(){this.descriptorSets.clear(),this.descriptorGroups.clear()},i.getSets=function(){return hst.isWebGPU?this.descriptorGroups:this.descriptorSets},i.getSet=function(t){return hst.isWebGPU?this.descriptorGroups.get(t):this.descriptorSets.get(t)},t}(),vst=function(){function t(){this.descriptorBindings=new Map}return t.prototype.reset=function(){this.descriptorBindings.clear()},t}(),lst=function(){function t(){this.layoutData=new Map,this.bindingData=new Map}return t.prototype.reset=function(){this.layoutData.clear(),this.bindingData.clear()},t}(),dst=function(){function t(){this.passes=[]}return t.prototype.reset=function(){this.passes.length=0},t}(),wst=function(){function t(){this.techniques=new Map}return t.prototype.reset=function(){this.techniques.clear()},t}(),gst=function(){function t(){this.layout=new fst,this.pipelineLayout=null}return t.prototype.reset=function(){this.layout.reset(),this.pipelineLayout=null},t}(),pst=function(){function t(){this.descriptorVisibility=new Map}return t.prototype.reset=function(){this.descriptorVisibility.clear()},t}(),_st=function(){function t(){this.rootSignature="",this.shaderPrograms=[],this.shaderIndex=new Map,this.pipelineLayout=null}return t.prototype.reset=function(){this.rootSignature="",this.shaderPrograms.length=0,this.shaderIndex.clear(),this.pipelineLayout=null},t}(),yst=function(t,i){this.o=[],this.i=[],this.t=void 0,this.j=void 0,this.id=t,this.object=i,this.t=t,this.j=i},mst=function(){function t(){this.N=4294967295,this.x=[],this._names=[],this._updateFrequencies=[],this._layouts=[],this.valueNames=[],this.attributeIndex=new Map,this.constantIndex=new Map,this.shaderLayoutIndex=new Map,this.effects=new Map,this.constantMacros=""}var i=t.prototype;return i.edge=function(t,i){for(var n,r=w(this.x[t].o);!(n=r()).done;)if(i===n.value.target)return!0;return!1},i.source=function(t){return t.source},i.target=function(t){return t.target},i.oe=function(t){return new rrt(this.x[t].o.values(),t)},i.od=function(t){return this.x[t].o.length},i.ie=function(t){return new srt(this.x[t].i.values(),t)},i.id=function(t){return this.x[t].i.length},i.d=function(t){return this.od(t)+this.id(t)},i.adj=function(t){return new ert(this,this.oe(t))},i.v=function(){return this.x.keys()},i.nv=function(){return this.x.length},i.ne=function(){for(var t,i=0,n=w(this.v());!(t=n()).done;){var r=t.value;i+=this.od(r)}return i},i.clear=function(){this.valueNames.length=0,this.attributeIndex.clear(),this.constantIndex.clear(),this.shaderLayoutIndex.clear(),this.effects.clear(),this.constantMacros="",this._names.length=0,this._updateFrequencies.length=0,this._layouts.length=0,this.x.length=0},i.addVertex=function(t,i,n,r,s,e){void 0===e&&(e=4294967295);var h=new yst(t,i),u=this.x.length;return this.x.push(h),this._names.push(n),this._updateFrequencies.push(r),this._layouts.push(s),4294967295!==e&&this.addEdge(e,u),u},i.addEdge=function(t,i){return this.x[t].o.push(new nrt(i)),this.x[i].i.push(new nrt(t)),new irt(t,i)},i.vertexName=function(t){return this._names[t]},i.getName=function(t){return this._names[t]},i.getUpdate=function(t){return this._updateFrequencies[t]},i.setUpdate=function(t,i){this._updateFrequencies[t]=i},i.getLayout=function(t){return this._layouts[t]},i.h=function(t,i){return this.x[i].t===t},i.w=function(t){return this.x[t].t},i.object=function(t){return this.x[t].j},i.value=function(t,i){if(this.x[i].t===t)return this.x[i].j;throw Error("value id not match")},i.visitVertex=function(t,i){var n=this.x[i];switch(n.t){case 0:return t.renderStage(n.j);case 1:return t.renderPhase(n.j);default:throw Error("polymorphic type not found")}},i.j=function(t){return this.x[t].j},i.reference=function(t,i){for(var n,r=w(this.x[t].o);!(n=r()).done;)if(i===n.value.target)return!0;return!1},i.parent=function(t){return t.source},i.child=function(t){return t.target},i.children=function(t){return new rrt(this.x[t].o.values(),t)},i.numChildren=function(t){return this.x[t].o.length},i.getParent=function(t){if(4294967295===t)return 4294967295;var i=this.x[t].i;return 0===i.length?4294967295:i[0].target},i.addReference=function(t,i){return this.addEdge(t,i)},i.locateChild=function(t,i){if(4294967295===t){for(var n,r=w(this.x.keys());!(n=r()).done;){var s=n.value;if(0===this.x[s].i.length&&this._names[s]===i)return s}return 4294967295}for(var e,h=w(this.x[t].o);!(e=h()).done;){var u=e.value.target;if(i===this._names[u])return u}return 4294967295},i.locate=function(t){return urt(this,4294967295,t)},i.locateRelative=function(t,i){return void 0===i&&(i=4294967295),urt(this,i,t)},i.path=function(t){return hrt(this,t)},t}();function bst(t,i){i.descriptorID=t.n(),i.type=t.n(),i.count=t.n()}function kst(t,i){var n;i.type=t.n(),i.visibility=t.n(),i.offset=t.n(),i.capacity=t.n(),i.accessType=t.n(),i.viewDimension=t.n(),i.sampleType=t.n(),i.format=t.n(),n=t.n(),i.descriptors.length=n;for(var r=0;r!==n;++r){var s=new ust;bst(t,s),i.descriptors[r]=s}}function Ast(t,i){i.slot=t.n(),i.capacity=t.n(),i.uniformBlockCapacity=t.n(),i.samplerTextureCapacity=t.n();var n=0;n=t.n(),i.descriptorBlocks.length=n;for(var r=0;r!==n;++r){var s=new ost;kst(t,s),i.descriptorBlocks[r]=s}n=t.n();for(var e=0;e!==n;++e){var h=t.n(),u=new Zl;rst(t,u),i.uniformBlocks.set(h,u)}n=t.n();for(var o=0;o!==n;++o){var c=t.n(),a=t.n();i.bindingMap.set(c,a)}}function Est(t,i){Ast(t,i.descriptorSetLayoutData),est(t,i.descriptorSetLayoutInfo)}function Tst(t,i){var n=0;n=t.n();for(var r=0;r!==n;++r){var s=t.n(),e=new ast;Est(t,e),i.descriptorSets.set(s,e)}n=t.n();for(var h=0;h!==n;++h){var u=t.n(),o=new ast;Est(t,o),i.descriptorGroups.set(u,o)}}function Ost(t,i){var n;n=t.n();for(var r=0;r!==n;++r){var s=t.n(),e=t.n();i.descriptorBindings.set(s,e)}}function Sst(t,i){var n=0;n=t.n();for(var r=0;r!==n;++r){var s=t.n(),e=new cst;Ast(t,e),i.layoutData.set(s,e)}n=t.n();for(var h=0;h!==n;++h){var u=t.n(),o=new vst;Ost(t,o),i.bindingData.set(u,o)}}function Ist(t,i){var n;n=t.n(),i.passes.length=n;for(var r=0;r!==n;++r){var s=new lst;Sst(t,s),i.passes[r]=s}}function Rst(t,i){var n;n=t.n();for(var r=0;r!==n;++r){var s=t.s(),e=new dst;Ist(t,e),i.techniques.set(s,e)}}function Mst(t,i){Tst(t,i.layout)}function Cst(t,i){var n;n=t.n();for(var r=0;r!==n;++r){var s=t.n(),e=t.n();i.descriptorVisibility.set(s,e)}}function Nst(t,i){i.rootSignature=t.s();var n=0;n=t.n(),i.shaderPrograms.length=n;for(var r=0;r!==n;++r){var s=new gst;Mst(t,s),i.shaderPrograms[r]=s}n=t.n();for(var e=0;e!==n;++e){var h=t.s(),u=t.n();i.shaderIndex.set(h,u)}}function Pst(t,i){var n=t.n();t.n(),t.n(),t.n();for(var r=0;r!==n;++r){var s=t.n(),e=t.n(),h=t.s(),u=t.n(),o=new fst;switch(Tst(t,o),s){case 0:var c=new pst;Cst(t,c),i.addVertex(0,c,h,u,o,e);break;case 1:var a=new _st;Nst(t,a),i.addVertex(1,a,h,u,o,e)}}var f=0;f=t.n(),i.valueNames.length=f;for(var v=0;v!==f;++v)i.valueNames[v]=t.s();f=t.n();for(var l=0;l!==f;++l){var d=t.s(),w=t.n();i.attributeIndex.set(d,w)}f=t.n();for(var g=0;g!==f;++g){var p=t.s(),_=t.n();i.constantIndex.set(p,_)}f=t.n();for(var y=0;y!==f;++y){var m=t.s(),b=t.n();i.shaderLayoutIndex.set(m,b)}f=t.n();for(var k=0;k!==f;++k){var A=t.s(),E=new wst;Rst(t,E),i.effects.set(A,E)}}var Lst=function(){function t(t){this.colors=void 0,this.colors=new Array(t)}var i=t.prototype;return i.get=function(t){return this.colors[t]},i.put=function(t,i){this.colors[t]=i},t}();function Dst(t){switch(t){case 1:case 5:case 9:case 13:return 1;case 6:case 14:case 10:case 2:return 2;case 15:case 3:case 11:case 7:return 3;case 4:case 16:case 12:case 8:case 17:return 4;case 18:case 20:return 6;case 19:case 23:return 8;case 21:return 9;case 22:case 24:return 12;case 25:return 16;default:return 0}}function Bst(t,i){var n=1;return 1&t||0!==i||(n=8&t?1:0),6&~t&&1===i&&(2&t||(n=0),4&t||(n=0)),n}function Fst(t,i,n,r,s,e){void 0===r&&(r=null),void 0===s&&(s=0),void 0===e&&(e=void 0),e=e||new Cl;var h=t?t.viewport:new Cl(0,0,1,1),u=i,o=n;if(e.x=h.x*u,e.y=h.y*o,e.width=h.width*u,e.height=h.height*o,r)switch(r.type){case 0:var c=r;if(c.shadowFixedArea||c.csmLevel===AA.LEVEL_1)e.x=0,e.y=0,e.width=u,e.height=o;else{var a=T.director.root.device.capabilities.screenSpaceSignY;e.x=s%2*.5*u,e.y=a>0?.5*(1-Math.floor(s/2))*o:.5*Math.floor(s/2)*o,e.width=.5*u,e.height=.5*o}break;case 2:e.x=0,e.y=0,e.width=u,e.height=o}return e}function Ust(t,i,n,r,s){var e="Camera"+s,h=n.renderArea(),u=h.x,o=h.y,c=n.camera,a="reflectionProbePassColor"+e,f="reflectionProbePassDS"+e;i.containsResource(a)||(i.addRenderWindow(a,35,u,o,r),i.addDepthStencil(f,55,u,o,3)),i.updateRenderWindow(a,r),i.updateDepthStencil(f,u,o);var v=i.addRenderPass(u,o,"default");v.name="ReflectionProbePass"+s,v.setViewport(new Ul(0,0,u,o)),v.addRenderTarget(a,Bst(c.clearFlag,0),0,new xl(c.clearColor.x,c.clearColor.y,c.clearColor.z,c.clearColor.w)),v.addDepthStencil(f,Bst(c.clearFlag,1),0,c.clearDepth,c.clearStencil,c.clearFlag);var l=v.addQueue(1,"reflect-map"),d=new $nt;d.probe=n,l.addSceneOfCamera(t,d,8193),xst(l,c,i)}function xst(t,i,n){var r=T.director.root.pipeline,s=n.pipelineSceneData,e=s.skybox;t.setMat4("cc_matView",i.matView),t.setMat4("cc_matViewInv",i.node.worldMatrix),t.setMat4("cc_matProj",i.matProj),t.setMat4("cc_matProjInv",i.matProjInv),t.setMat4("cc_matViewProj",i.matViewProj),t.setMat4("cc_matViewProjInv",i.matViewProjInv),t.setVec4("cc_cameraPos",new $s(i.position.x,i.position.y,i.position.z,r.getCombineSignY())),t.setVec4("cc_surfaceTransform",new $s(i.surfaceTransform,0,Math.cos(Vn(e.getRotationAngle())),Math.sin(Vn(e.getRotationAngle())))),t.setVec4("cc_screenScale",new $s(s.shadingScale,s.shadingScale,1/s.shadingScale,1/s.shadingScale)),t.setVec4("cc_exposure",new $s(i.exposure,1/i.exposure,s.isHDR?1:0,1/KM.standardExposureValue))}function Gst(t,i,n){n instanceof qd?t.bindBuffer(i,n):n instanceof gw?t.bindTexture(i,n):n instanceof dw&&t.bindSampler(i,n)}function jst(t,i,n){Gst(t,i,n)}function Hst(t,i){for(var n,r=w(i.descriptorSetLayoutData.descriptorBlocks);!(n=r()).done;)for(var s=n.value,e=0;e!==s.descriptors.length;++e)if(t===s.descriptors[e].descriptorID)return s.offset+e;return-1}new Mh(0,0,0,.5,.5,.5),new Mh;var Vst=function(){function t(t,i){void 0===i&&(i=2),this.DN=[],this.BN=0,this.Kd=void 0,this.currUniform=void 0,this.yl=void 0;var n=(this.yl=T.director.root).device;this.Kd=n,this.currUniform=new Float32Array(t/4);for(var r=0;r<i;r++){var s=new $l(18,3,t,t);this.DN.push(this.Kd.createBuffer(s))}}var i=t.prototype;return i.getCurrentBuffer=function(){var t=T.director;return this.BN=t.getTotalFrames()%this.DN.length,this.DN[this.BN]},i.updateData=function(t){this.currUniform.set(t)},i.updateBuffer=function(t,i){var n=i.descriptorSet,r=this.getCurrentBuffer();r.update(this.currUniform),jst(n,t,r)},t}(),$st=new Map,zst=new Map,Wst=new Map;function Xst(t){var i=Wst.get(t);if(i)return i;var n=T.director.root.pipeline,r=n.layoutGraph.locateChild(n.layoutGraph.N,t),s=n.layoutGraph.getLayout(r).getSet(3);return Wst.set(t,s),s}function Yst(t,i,n,r){void 0===r&&(r="default"),eet(r,i,n,t)}function Kst(t,i){var n=T.director.root.pipeline.layoutGraph,r=n.locateChild(4294967295,i),s=n.getLayout(r).getSet(3).descriptorSetLayoutData,e=n.attributeIndex.get(t);return s.uniformBlocks.get(e)}function qst(t,i,n){var r=Kst(i,n);if(!r)return-1;for(var s,e=0,h=w(r.members);!(s=h()).done;){var u=s.value,o=Dst(u.type);if(u.name===t)return e;e+=o*u.count}return-1}var Qst=new Map,Jst=function(){this.offset=-1,this.buffer=[],this.blockId=-1},Zst=new Map;function tet(t,i,n){var r=!1;if(n<0||n>t.length)return r;for(var s=Math.min(i.length,t.length-n),e=0;e<s;e++)t[n+e]!==i[e]&&(t[n+e]=i[e],r=!0);return r}function iet(t,i){var n=Qst.get(t);if(n)return n;n=[],T.director.root.pipeline.layoutGraph;var r=0,s=Kst(t,i);if(!s)return null;for(var e,h=w(s.members);!(e=h()).done;){var u=e.value;r+=Dst(u.type)*u.count}return n.length=r,n.fill(0),Qst.set(t,n),n}function net(t,i){var n=$st.get(t);n||($st.set(t,new Vst(4*i.length,2)),n=$st.get(t)),n.updateData(i)}function ret(t,i,n,r,s){var e=t.blockId,h=t.buffer,u=tet(h,i,t.offset),o=Hst(e,n),c=n.descriptorSet;if(u||!c.getBuffer(o)&&-1!==o){var a=""+e+o+s+r;zst.set(a,o),net(a,h)}}function set(t,i,n,r,s){var e=Hst(t,s);if(-1!==e){var h=""+t+e+n+i;zst.set(h,e),net(h,r)}}function eet(t,i,n,r){var s=r.constants,e=r.samplers,h=r.textures,u=r.buffers,o=T.director.root.pipeline.layoutGraph,c=Xst(t);zst.clear();for(var a,f=function(){var r=a.value,s=r[0],e=r[1],h=Zst.get(s);if(h)ret(h,e,c,i,n);else for(var u,f=Array.from(o.constantIndex).find((function(t){return t[0],t[1]===s}))[0],v=w(o.attributeIndex);!(u=v()).done;){var l=u.value,d=l[0],g=l[1],p=iet(d,t);if(p){var _=qst(f,d,t);-1!==_?(Zst.set(s,new Jst),(h=Zst.get(s)).buffer=p,h.blockId=g,h.offset=_,ret(h,e,c,i,n)):set(g,i,n,p,c)}}},v=w(s);!(a=v()).done;)f();for(var l,d=c.descriptorSet,g=w(h);!(l=g()).done;){var p=l.value,_=p[0],y=p[1],m=Hst(_,c);if(-1!==m){var b=d.getTexture(m);y===b&&(b.gpuTexture||b.gpuTextureView&&b.gpuTextureView.gpuTexture)||jst(d,m,y)}}for(var k,A=w(e);!(k=A()).done;){var E=k.value,O=E[0],S=E[1],I=Hst(O,c);-1!==I&&d.getSampler(I)!==S&&jst(d,I,S)}for(var R,M=w(zst);!(R=M()).done;){var C=R.value,N=C[0],P=C[1];$st.get(N).updateBuffer(P,c)}for(var L,D=w(u);!(L=D()).done;){var B=L.value,F=B[0],U=B[1],x=Hst(F,c);-1!==x&&(d.getBuffer(x)||jst(d,x,U))}}function het(t){return t+"-"}function uet(t){for(var i=0,n=0;n<t.length;n++)i=(i<<5)-i+t.charCodeAt(n),i|=0;return i}function oet(t){return!!t}function cet(t,i){return t+(i-1)&~(i-1)}function aet(t,i,n,r,s,e){var h=new Float32Array(4),u=0,o=0,c=0,a=0;if(t&&1===t.type){var f=t;h[0]=f.position.x,h[1]=f.position.y,h[2]=f.position.z,h[3]=1,u=f.size,o=f.range,c=f.luminanceHDR,a=f.luminanceLDR}else if(t&&2===t.type){var v=t;h[0]=v.position.x,h[1]=v.position.y,h[2]=v.position.z,h[3]=2,u=v.size,o=v.range,c=v.luminanceHDR,a=v.luminanceLDR}else if(t&&3===t.type){var l=t;h[0]=l.position.x,h[1]=l.position.y,h[2]=l.position.z,h[3]=3,u=0,o=l.range,c=l.luminanceHDR,a=l.luminanceLDR}else if(t&&4===t.type){var d=t;h[0]=d.position.x,h[1]=d.position.y,h[2]=d.position.z,h[3]=4,u=0,o=0,c=d.illuminanceHDR,a=d.illuminanceLDR}var w=e+0;s.set(h,w),w=e+8,h.set([u,o,0,0]),s.set(h,w),w=e+4;var g=t?t.color:new xl;if(t&&t.useColorTemperature){var p=t.colorTemperatureRGB;s[w++]=g.x*p.x,s[w++]=g.y*p.y,s[w++]=g.z*p.z}else s[w++]=g.x,s[w++]=g.y,s[w++]=g.z;switch(s[w]=i?c*n*1e4:a,t?t.type:5){case 1:case 3:s[e+8+2]=0,s[e+8+3]=0;break;case 2:var _=t;s[e+8+2]=_.spotAngle,s[e+8+3]=r&&r.enabled&&_.shadowEnabled&&r.type===bA.ShadowMap?1:0,w=e+12;var y=_.direction;s[w++]=y.x,s[w++]=y.y,s[w]=y.z,s[e+16+0]=0,s[e+16+1]=0,s[e+16+2]=0,s[e+16+3]=_.angleAttenuationStrength;break;case 4:var m=t,b=m.right;s[e+8+0]=b.x,s[e+8+1]=b.y,s[e+8+2]=b.z,s[e+8+3]=0;var k=m.direction;s[e+12+0]=k.x,s[e+12+1]=k.y,s[e+12+2]=k.z,s[e+12+3]=0;var A=m.scale;s[e+16+0]=.5*A.x,s[e+16+1]=.5*A.y,s[e+16+2]=.5*A.z,s[e+16+3]=0}}function fet(t){for(var i,n="",r=w(t.rasterViews);!(i=r()).done;){var s=i.value,e=s[0],h=s[1];n+=het(e),n+=het(h.slotName),n+=het(h.accessType),n+=het(h.attachmentType),n+=het(h.loadOp),n+=het(h.storeOp),n+=het(h.clearFlags),n+=het(h.clearColor.x),n+=het(h.clearColor.y),n+=het(h.clearColor.z),n+=het(h.clearColor.w),n+=het(h.slotID),n+=het(h.shaderStageFlags)}for(var u,o=w(t.computeViews);!(u=o()).done;){var c=u.value,a=c[0],f=c[1];n+=het(a);for(var v,l=w(f);!(v=l()).done;){var d=v.value;n+=het(d.name),n+=het(d.accessType),n+=het(d.clearFlags),n+=het(d.clearValueType),n+=het(d.clearValue.x),n+=het(d.clearValue.y),n+=het(d.clearValue.z),n+=het(d.clearValue.w),n+=het(d.shaderStageFlags)}}n+=het(t.showStatistics?1:0),t.hashValue=uet(n)}var vet=new $s,det=new Ir,wet=new xl,get=new ls,pet=new ls;function _et(t,i){var n=i.skybox,r=T.director.root,s=r.pipeline;if(n.reflectionMap){var e=n.reflectionMap.getGFXTexture(),h=r.device.getSampler(n.reflectionMap.getSamplerInfo());t.setTexture("cc_environment",e),t.setSampler("cc_environment",h)}else{var u=n.envmap?n.envmap:Fk.get("default-cube-texture");if(u){var o=u.getGFXTexture(),c=r.device.getSampler(u.getSamplerInfo());t.setTexture("cc_environment",o),t.setSampler("cc_environment",c)}}var a=n.diffuseMap?n.diffuseMap:Fk.get("default-cube-texture");if(a){var f=a.getGFXTexture(),v=r.device.getSampler(a.getSamplerInfo());t.setTexture("cc_diffuseMap",f),t.setSampler("cc_diffuseMap",v)}t.hasSampler("cc_shadowMap")||t.setSampler("cc_shadowMap",s.defaultSampler),t.hasTexture("cc_shadowMap")||t.setTexture("cc_shadowMap",s.defaultShadowTexture),t.hasSampler("cc_spotShadowMap")||t.setSampler("cc_spotShadowMap",s.defaultSampler),t.hasTexture("cc_spotShadowMap")||t.setTexture("cc_spotShadowMap",s.defaultShadowTexture)}function yet(t,i,n,r){var s,e=T.director.root.pipeline,h=n.shadows,u=n.skybox,o=n.shadingScale;i&&(t.setMat4("cc_matView",i.matView),t.setMat4("cc_matViewInv",i.node.worldMatrix),t.setMat4("cc_matProj",i.matProj),t.setMat4("cc_matProjInv",i.matProjInv),t.setMat4("cc_matViewProj",i.matViewProj),t.setMat4("cc_matViewProjInv",i.matViewProjInv),vet.set(i.surfaceTransform,i.cameraUsage,Math.cos(Vn(u.getRotationAngle())),Math.sin(Vn(u.getRotationAngle()))),t.setVec4("cc_surfaceTransform",vet),vet.set(i.exposure,1/i.exposure,n.isHDR?1:0,1/KM.standardExposureValue),t.setVec4("cc_exposure",vet)),i?vet.set(i.position.x,i.position.y,i.position.z,e.getCombineSignY()):vet.set(0,0,0,e.getCombineSignY()),t.setVec4("cc_cameraPos",vet),vet.set(n.shadingScale,n.shadingScale,1/n.shadingScale,1/n.shadingScale),t.setVec4("cc_screenScale",vet);var c=r&&r.mainLight;if(c){var a=c.shadowEnabled&&h.type===bA.ShadowMap?1:0;vet.set(c.direction.x,c.direction.y,c.direction.z,a),t.setVec4("cc_mainLitDir",vet);var f=c.color.x,v=c.color.y,l=c.color.z;c.useColorTemperature&&(f*=c.colorTemperatureRGB.x,v*=c.colorTemperatureRGB.y,l*=c.colorTemperatureRGB.z);var d=c.illuminance;n.isHDR&&i&&(d*=i.exposure),vet.set(f,v,l,d),t.setVec4("cc_mainLitColor",vet)}else vet.set(0,0,1,0),t.setVec4("cc_mainLitDir",vet),vet.set(0,0,0,0),t.setVec4("cc_mainLitColor",vet);var w=n.ambient,g=w.skyColor;n.isHDR?g.w=w.skyIllum*(i?i.exposure:1):g.w=w.skyIllum,vet.set(g.x,g.y,g.z,g.w),t.setVec4("cc_ambientSky",vet),vet.set(w.groundAlbedo.x,w.groundAlbedo.y,w.groundAlbedo.z,u.envmap?null==(s=u.envmap)?void 0:s.mipmapLevel:1),t.setVec4("cc_ambientGround",vet);var p=n.fog,_=p.colorArray;vet.set(_.x,_.y,_.z,_.z),t.setVec4("cc_fogColor",vet),vet.set(p.fogStart,p.fogEnd,p.fogDensity,0),t.setVec4("cc_fogBase",vet),vet.set(p.fogTop,p.fogRange,p.fogAtten,0),t.setVec4("cc_fogAdd",vet),i&&(vet.set(i.nearClip,i.farClip,i.getClipSpaceMinz(),0),t.setVec4("cc_nearFar",vet),vet.set(i.viewport.x,i.viewport.y,o*i.window.width*i.viewport.z,o*i.window.height*i.viewport.w),t.setVec4("cc_viewPort",vet))}var met=function(){function t(t,i,n,r,s,e){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),this.subModel=void 0,this.priority=void 0,this.hash=void 0,this.depth=void 0,this.shaderID=void 0,this.passIndex=void 0,this.subModel=t,this.priority=i,this.hash=n,this.depth=r,this.shaderID=s,this.passIndex=e}return t.prototype.update=function(t,i,n,r,s,e){void 0===t&&(t=null),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),this.subModel=t,this.priority=i,this.hash=n,this.depth=r,this.shaderID=s,this.passIndex=e},t}(),bet=new Ge((function(){return new met}),8),ket="CC_USE_RGBE_OUTPUT";function Aet(t,i){for(var n=t.passes,r=0;r<n.length;r++)if(n[r].phaseID===i)return r;return-1}var Eet=function(){function t(){var t;this.probeMap=new Array,this.defaultId=(t=T.rendering).getPhaseID(t.getPassID("default"),"default")}var i=t.prototype;return i.clear=function(){this.probeMap.length=0},i.applyMacro=function(){for(var t,i=w(this.probeMap);!(t=i()).done;){var n=t.value,r=[{name:ket,value:!0}];n.patches&&(r=r.concat(n.patches)),n.onMacroPatchesStateChanged(r)}},i.removeMacro=function(){for(var t,i=w(this.probeMap);!(t=i()).done;){var n=t.value;if(n.patches){var r=n.patches.filter((function(t){return t.name!==ket}));0===r.length?n.onMacroPatchesStateChanged(null):n.onMacroPatchesStateChanged(r)}}},i.addToProbeQueue=function(t,i){for(var n=t.subModels,r=0;r<n.length;r++){var s=n[r];if(!s.passes[0].blendState.targets[0].blend){var e=Aet(s,i),h=!0;e<0&&(e=Aet(s,i=this.defaultId),h=!1),e<0||h||this.probeMap.push(s)}}},t}();function Tet(t,i,n,r){var s=T.director.root.pipeline,e=s.device,h=s.pipelineSceneData,u=h.shadows;if(u.type!==bA.Planar){var o=h.csmLayers,c=Zy(e)?0:1,a=s.device.capabilities;switch(u.enabled&&u.type===bA.ShadowMap&&n&&n.node&&0===n.type&&o.update(h,i),n.type){case 0:var f=n;if(u.enabled&&f&&f.shadowEnabled&&u.type===bA.ShadowMap){var v,l,d,w=.1,g=0,p=0;if(f.shadowFixedArea||f.csmLevel===AA.LEVEL_1)v=o.specialLayer.matShadowView,l=o.specialLayer.matShadowProj,d=o.specialLayer.matShadowViewProj,f.shadowFixedArea?(w=f.shadowNear,g=f.shadowFar,p=0):(w=.1,g=o.specialLayer.shadowCameraFar,p=1),vet.set(0,c,f.shadowNormalBias,0),t.setVec4("cc_shadowLPNNInfo",vet);else{var _=o.layers[r];v=_.matShadowView,l=_.matShadowProj,d=_.matShadowViewProj,w=_.splitCameraNear,g=_.splitCameraFar,p=f.csmLevel}t.setMat4("cc_matLightView",v),vet.set(l.m10,l.m14,l.m11,l.m15),t.setVec4("cc_shadowProjDepthInfo",vet),vet.set(l.m00,l.m05,1/l.m00,1/l.m05),t.setVec4("cc_shadowProjInfo",vet),t.setMat4("cc_matLightViewProj",d),vet.set(w,g,0,1-f.shadowSaturation),t.setVec4("cc_shadowNFLSInfo",vet),vet.set(0,c,f.shadowNormalBias,p),t.setVec4("cc_shadowLPNNInfo",vet),vet.set(u.size.x,u.size.y,f.shadowPcf,f.shadowBias),t.setVec4("cc_shadowWHPBInfo",vet)}break;case 2:var y=n;if(u.enabled&&y&&y.shadowEnabled){ls.invert(get,y.node.getWorldMatrix()),t.setMat4("cc_matLightView",get),ls.perspective(pet,y.angle,1,.001,y.range,!0,a.clipSpaceMinZ,a.clipSpaceSignY,0);var m=pet.clone().invert(),b=pet.clone();ls.multiply(get,pet,get),t.setMat4("cc_matLightViewProj",get),vet.set(.01,n.range,0,0),t.setVec4("cc_shadowNFLSInfo",vet),vet.set(u.size.x,u.size.y,y.shadowPcf,y.shadowBias),t.setVec4("cc_shadowWHPBInfo",vet),vet.set(2,c,y.shadowNormalBias,0),t.setVec4("cc_shadowLPNNInfo",vet),vet.set(b.m10,b.m14,b.m11,b.m15),t.setVec4("cc_shadowProjDepthInfo",vet),vet.set(m.m10,m.m14,m.m11,m.m15),t.setVec4("cc_shadowInvProjDepthInfo",vet),vet.set(b.m00,b.m05,1/b.m00,1/b.m05),t.setVec4("cc_shadowProjInfo",vet)}break;case 1:vet.set(u.size.x,u.size.y,1,0),t.setVec4("cc_shadowWHPBInfo",vet),vet.set(1,c,0,0),t.setVec4("cc_shadowLPNNInfo",vet);break;case 3:vet.set(u.size.x,u.size.y,1,0),t.setVec4("cc_shadowWHPBInfo",vet),vet.set(3,c,0,0),t.setVec4("cc_shadowLPNNInfo",vet)}wet.set(u.shadowColor.x,u.shadowColor.y,u.shadowColor.z,u.shadowColor.w),t.setColor("cc_shadowColor",wet)}}function Oet(t,i){var n=t.size.x;switch(i.shadowPcf){case kA.HARD:return 0;case kA.SOFT:return 1/(.5*n);case kA.SOFT_2X:return 2/(.5*n);case kA.SOFT_4X:return 3/(.5*n)}return 0}function Iet(t,i){var n=T.director,r=n.root.pipeline,s=r.device,e=n.getScene(),h=i&&i.scene?i.scene.mainLight:e?e.renderScene.mainLight:null,u=r.pipelineSceneData,o=u.shadows,c=u.csmLayers,a=u.csmSupported,f=Zy(s)?0:1;if(h&&o.enabled){if(o.type===bA.ShadowMap){if(h.shadowEnabled){if(h.shadowFixedArea||h.csmLevel===AA.LEVEL_1||!a){var v=c.specialLayer.matShadowView,l=c.specialLayer.matShadowProj,d=c.specialLayer.matShadowViewProj,w=h.shadowNear,g=h.shadowFar;t.setMat4("cc_matLightView",v),vet.set(l.m10,l.m14,l.m11,l.m15),t.setVec4("cc_shadowProjDepthInfo",vet),vet.set(l.m00,l.m05,1/l.m00,1/l.m05),t.setVec4("cc_shadowProjInfo",vet),t.setMat4("cc_matLightViewProj",d),vet.set(w,g,0,1-h.shadowSaturation),t.setVec4("cc_shadowNFLSInfo",vet),vet.set(0,f,h.shadowNormalBias,0),t.setVec4("cc_shadowLPNNInfo",vet)}else{for(var p=Oet(o,h),_=0;_<h.csmLevel;_++){var y=c.layers[_],m=y.matShadowView;vet.set(m.m00,m.m04,m.m08,p),t.setVec4("cc_csmViewDir0",vet,_),vet.set(m.m01,m.m05,m.m09,y.splitCameraNear),t.setVec4("cc_csmViewDir1",vet,_),vet.set(m.m02,m.m06,m.m10,y.splitCameraFar),t.setVec4("cc_csmViewDir2",vet,_);var b=y.csmAtlas;t.setVec4("cc_csmAtlas",b,_);var k=y.matShadowViewProj;t.setMat4("cc_matCSMViewProj",k,_);var A=y.matShadowProj;vet.set(A.m10,A.m14,A.m11,A.m15),t.setVec4("cc_csmProjDepthInfo",vet,_),vet.set(A.m00,A.m05,1/A.m00,1/A.m05),t.setVec4("cc_csmProjInfo",vet,_)}vet.set(h.csmTransitionRange,0,0,0),t.setVec4("cc_csmSplitsInfo",vet),vet.set(.1,h.shadowDistance,0,1-h.shadowSaturation),t.setVec4("cc_shadowNFLSInfo",vet),vet.set(0,f,h.shadowNormalBias,h.csmLevel),t.setVec4("cc_shadowLPNNInfo",vet)}vet.set(o.size.x,o.size.y,h.shadowPcf,h.shadowBias),t.setVec4("cc_shadowWHPBInfo",vet)}}else Ir.normalize(det,o.normal),vet.set(det.x,det.y,det.z,-o.distance),t.setVec4("cc_planarNDInfo",vet),vet.set(0,0,0,o.planeBias),t.setVec4("cc_shadowWHPBInfo",vet);t.setMathColor("cc_shadowColor",o.shadowColor)}}var Ret=function(){function t(t,i){this._data=void 0,this._lg=void 0,this._vertID=-1,this._currBlock=void 0,this._currStage="",this._currFrequency=3,this._currCount=void 0,this._currConstant=[],this._data=t,this._lg=i}var i=t.prototype;return i.setMat4=function(i,n,r){void 0===r&&(r=0),t.setMat4(this._lg,this._data,i,n,r)},t.setMat4=function(i,n,r,s,e){void 0===e&&(e=0);var h=t.getConstantInfo(i,n,r);ls.toArray(h.dataArr,s,16*e),n.constants.set(h.constantID,h.dataArr)},i.setQuaternion=function(i,n,r){void 0===r&&(r=0),t.setQuaternion(this._lg,this._data,i,n,r)},t.setQuaternion=function(i,n,r,s,e){void 0===e&&(e=0);var h=t.getConstantInfo(i,n,r);Qr.toArray(h.dataArr,s,4*e),n.constants.set(h.constantID,h.dataArr)},i.setColor=function(i,n,r){void 0===r&&(r=0),t.setColor(this._lg,this._data,i,n,r)},t.setColor=function(i,n,r,s,e){void 0===e&&(e=0);var h=t.getConstantInfo(i,n,r),u=4*e;h.dataArr[0+u]=s.x,h.dataArr[1+u]=s.y,h.dataArr[2+u]=s.z,h.dataArr[3+u]=s.w,n.constants.set(h.constantID,h.dataArr)},i.setMathColor=function(i,n,r){void 0===r&&(r=0),t.setMathColor(this._lg,this._data,i,n,r)},t.setMathColor=function(i,n,r,s,e){void 0===e&&(e=0);var h=t.getConstantInfo(i,n,r);Qs.toArray(h.dataArr,s,4*e),n.constants.set(h.constantID,h.dataArr)},t.getConstantInfo=function(t,i,n){var r=t.constantIndex.get(n);if(void 0===r)throw new Error("Constant with name "+n+" not found.");return{constantID:r,dataArr:i.constants.get(r)||[]}},i.setVec4=function(i,n,r){void 0===r&&(r=0),t.setVec4(this._lg,this._data,i,n,r)},t.setVec4=function(i,n,r,s,e){void 0===e&&(e=0);var h=t.getConstantInfo(i,n,r);$s.toArray(h.dataArr,s,4*e),n.constants.set(h.constantID,h.dataArr)},i.setVec2=function(i,n,r){void 0===r&&(r=0),t.setVec2(this._lg,this._data,i,n,r)},t.setVec2=function(i,n,r,s,e){void 0===e&&(e=0);var h=t.getConstantInfo(i,n,r);Ms.toArray(h.dataArr,s,2*e),n.constants.set(h.constantID,h.dataArr)},i.setFloat=function(i,n,r){void 0===r&&(r=0),t.setFloat(this._lg,this._data,i,n,r)},t.setFloat=function(i,n,r,s,e){void 0===e&&(e=0);var h=t.getConstantInfo(i,n,r);h.dataArr[0+e]=s,n.constants.set(h.constantID,h.dataArr)},i.setArrayBuffer=function(i,n){t.setArrayBuffer(this._lg,this._data,i,n)},t.setArrayBuffer=function(){throw new Error("Method not implemented.")},i.setBuffer=function(i,n){t.setBuffer(this._lg,this._data,i,n)},t.setBuffer=function(t,i,n,r){var s=t.attributeIndex.get(n);i.buffers.set(s,r)},i.setTexture=function(i,n){t.setTexture(this._lg,this._data,i,n)},t.setTexture=function(t,i,n,r){var s=t.attributeIndex.get(n);i.textures.set(s,r)},i.setReadWriteBuffer=function(i,n){t.setReadWriteBuffer(this._lg,this._data,i,n)},t.setReadWriteBuffer=function(t,i,n,r){var s=t.attributeIndex.get(n);i.buffers.set(s,r)},i.setReadWriteTexture=function(i,n){t.setReadWriteTexture(this._lg,this._data,i,n)},t.setReadWriteTexture=function(t,i,n,r){var s=t.attributeIndex.get(n);i.textures.set(s,r)},i.setSampler=function(i,n){t.setSampler(this._lg,this._data,i,n)},t.setSampler=function(t,i,n,r){var s=t.attributeIndex.get(n);i.samplers.set(s,r)},i.getParentLayout=function(){var t=T.director.root.pipeline,i=t.renderGraph.getParent(this._vertID);return t.renderGraph.getLayout(i)},i.getCurrentLayout=function(){return T.director.root.pipeline.renderGraph.getLayout(this._vertID)},i.setBuiltinCameraConstants=function(t){var i=T.director.root.pipeline;this.getParentLayout(),yet(this,t,i.pipelineSceneData,t.scene)},i.setBuiltinDirectionalLightFrustumConstants=function(t,i,n){void 0===n&&(n=0),Tet(this,t,i,n)},i.setBuiltinSpotLightFrustumConstants=function(t){Tet(this,null,t,0)},i.setBuiltinDirectionalLightConstants=function(){Iet(this,null,this.getParentLayout())},i.setBuiltinSphereLightConstants=function(t,i){var n=T.director.root.pipeline.pipelineSceneData;vet.set(t.position.x,t.position.y,t.position.z,1),this.setVec4("cc_lightPos",vet),vet.set(t.size,t.range,0,0),this.setVec4("cc_lightSizeRangeAngle",vet);var r=n.isHDR;if(vet.set(t.color.x,t.color.y,t.color.z,0),t.useColorTemperature){var s=t.finalColor;vet.x=s.x,vet.y=s.y,vet.z=s.z}vet.w=r?t.luminance*i.exposure*1e4:t.luminance,this.setVec4("cc_lightColor",vet)},i.setBuiltinSpotLightConstants=function(t,i){var n=T.director.root.pipeline.pipelineSceneData,r=n.shadows;vet.set(t.position.x,t.position.y,t.position.z,2),this.setVec4("cc_lightPos",vet),vet.set(t.size,t.range,t.spotAngle,r.enabled&&t.shadowEnabled&&r.type===bA.ShadowMap?1:0),this.setVec4("cc_lightSizeRangeAngle",vet),vet.set(t.direction.x,t.direction.y,t.direction.z,0),this.setVec4("cc_lightDir",vet);var s=n.isHDR;if(vet.set(t.color.x,t.color.y,t.color.z,0),t.useColorTemperature){var e=t.finalColor;vet.x=e.x,vet.y=e.y,vet.z=e.z}vet.w=s?t.luminance*i.exposure*1e4:t.luminance,this.setVec4("cc_lightColor",vet),vet.set(0,0,0,t.angleAttenuationStrength),this.setVec4("cc_lightBoundingSizeVS",vet)},i.setBuiltinPointLightConstants=function(t,i){var n=T.director.root.pipeline.pipelineSceneData;vet.set(t.position.x,t.position.y,t.position.z,3),this.setVec4("cc_lightPos",vet),vet.set(0,t.range,0,0),this.setVec4("cc_lightSizeRangeAngle",vet);var r=n.isHDR;if(t.useColorTemperature){var s=t.finalColor;vet.x=s.x,vet.y=s.y,vet.z=s.z}vet.w=r?t.luminance*i.exposure*1e4:t.luminance,vet.set(t.color.x,t.color.y,t.color.z,0),this.setVec4("cc_lightColor",vet)},i.setBuiltinRangedDirectionalLightConstants=function(t,i){var n=T.director.root.pipeline.pipelineSceneData;vet.set(t.position.x,t.position.y,t.position.z,4),this.setVec4("cc_lightPos",vet),vet.set(t.right.x,t.right.y,t.right.z,0),this.setVec4("cc_lightSizeRangeAngle",vet),vet.set(t.direction.x,t.direction.y,t.direction.z,0),this.setVec4("cc_lightDir",vet);var r=t.scale;vet.set(.5*r.x,.5*r.y,.5*r.z,0),this.setVec4("cc_lightBoundingSizeVS",vet);var s=n.isHDR;if(vet.set(t.color.x,t.color.y,t.color.z,0),t.useColorTemperature){var e=t.finalColor;vet.x=e.x,vet.y=e.y,vet.z=e.z}vet.w=s?t.illuminance*i.exposure:t.illuminance,this.setVec4("cc_lightColor",vet)},i.hasSampler=function(t){var i=this._lg.constantIndex.get(t);return void 0!==i&&this._data.samplers.has(i)},i.hasTexture=function(t){var i=this._lg.constantIndex.get(t);return void 0!==i&&this._data.textures.has(i)},i.setCustomBehavior=function(){throw new Error("Method not implemented.")},r(t,[{key:"name",get:function(){return""},set:function(){}}]),t}(),Met=function(){function t(){this.instances=new Array}var i=t.prototype;return i.empty=function(){return 0===this.instances.length},i.clear=function(){this.instances.length=0},i.add=function(t,i,n,r){var s=t.subModels[n],e=s.passes[r].priority,h=s.priority,u=s.shaders[r].typedID,o=e<<16|h<<8|r,c=t.priority,a=bet.add();a.update(s,c,o,i,u,r),this.instances.push(a)},i.sortOpaqueOrCutout=function(){this.instances.sort((function(t,i){return t.hash!==i.hash?t.hash-i.hash:t.depth!==i.depth?t.depth-i.depth:t.shaderID-i.shaderID}))},i.sortTransparent=function(){this.instances.sort((function(t,i){return t.priority!==i.priority?t.priority-i.priority:t.hash!==i.hash?t.hash-i.hash:t.depth!==i.depth?i.depth-t.depth:t.shaderID-i.shaderID}))},i.recordCommandBuffer=function(t,i,n,r,s,e){void 0===r&&(r=null),void 0===s&&(s=0),void 0===e&&(e=null);for(var h,u=w(this.instances);!(h=u()).done;){var o=h.value,c=o.subModel,a=o.passIndex,f=c.inputAssembler,v=c.passes[a],l=c.shaders[a],d=nA.getOrCreatePipelineState(t,v,l,i,f);n.bindPipelineState(d),n.bindDescriptorSet(1,v.descriptorSet),r&&n.bindDescriptorSet(0,r,[s]),e?n.bindDescriptorSet(2,c.descriptorSet,e):n.bindDescriptorSet(2,c.descriptorSet),n.bindInputAssembler(f),n.draw(f)}},t}(),Cet=function(){function t(){this.passInstances=new Map,this.instanceBuffers=new Array}var i=t.prototype;return i.empty=function(){return 0===this.passInstances.size},i.add=function(t,i,n){if(void 0===this.passInstances.get(t)){var r=this.passInstances.size;r>=this.instanceBuffers.length&&this.instanceBuffers.push(new Gk(t)),this.passInstances.set(t,r);var s=this.instanceBuffers[r];s.pass=t,s.instances}this.instanceBuffers[this.passInstances.get(t)].merge(i,n)},i.clear=function(){this.passInstances.clear(),this.instanceBuffers.forEach((function(t){t.clear()}))},i.sort=function(){this.instanceBuffers=this.instanceBuffers.sort(xk)},i.uploadBuffers=function(t){for(var i,n=w(this.passInstances.entries());!(i=n()).done;){var r=i.value;r[0];var s=r[1],e=this.instanceBuffers[s];e.hasPendingModels&&e.uploadBuffers(t)}},i.recordCommandBuffer=function(t,i,n,r,s){void 0===n&&(n=null),void 0===r&&(r=0),void 0===s&&(s=null);for(var e,h=w(this.instanceBuffers);!(e=h()).done;){var u=e.value;if(u.hasPendingModels){var o=u.instances,c=u.pass;i.bindDescriptorSet(1,c.descriptorSet);for(var a,f=null,v=w(o);!(a=v()).done;){var l=a.value;if(l.count){var d=nA.getOrCreatePipelineState(kw.gfxDevice,c,l.shader,t,l.ia);f!==d&&(i.bindPipelineState(d),f=d),n&&i.bindDescriptorSet(0,n,[r]),s?i.bindDescriptorSet(2,l.descriptorSet,s):i.bindDescriptorSet(2,l.descriptorSet,u.dynamicOffsets),i.bindInputAssembler(l.ia),i.draw(l.ia)}}}}},t}(),Net=function(){function t(t,i,n){void 0===t&&(t=4294967295),void 0===i&&(i=4294967295),void 0===n&&(n=4294967295),this.frustumCulledResultID=void 0,this.lightBoundsCulledResultID=void 0,this.renderQueueTarget=void 0,this.frustumCulledResultID=t,this.lightBoundsCulledResultID=i,this.renderQueueTarget=n}return t.prototype.update=function(t,i,n){void 0===t&&(t=4294967295),void 0===i&&(i=4294967295),void 0===n&&(n=4294967295),this.frustumCulledResultID=t,this.lightBoundsCulledResultID=i,this.renderQueueTarget=n},t}();function Pet(t,i,n,r,s,e){var h;if(s&&e&&(h=nA.getOrCreatePipelineState(kw.gfxDevice,n,s,i,e)),h){var u=e;t.bindPipelineState(h),t.bindDescriptorSet(1,n.descriptorSet),t.bindDescriptorSet(2,r),t.bindInputAssembler(u),t.draw(u)}}var Let=function(){function t(){this.probeQueue=new Eet,this.opaqueQueue=new Met,this.transparentQueue=new Met,this.opaqueInstancingQueue=new Cet,this.transparentInstancingQueue=new Cet,this.camera=null,this.sceneFlags=0,this.lightByteOffset=4294967295}var i=t.prototype;return i.sort=function(){this.opaqueQueue.sortOpaqueOrCutout(),this.transparentQueue.sortTransparent(),this.opaqueInstancingQueue.sort(),this.transparentInstancingQueue.sort()},i.update=function(){this.probeQueue.clear(),this.opaqueQueue.clear(),this.transparentQueue.clear(),this.opaqueInstancingQueue.clear(),this.transparentInstancingQueue.clear(),this.camera=null,this.sceneFlags=0,this.lightByteOffset=4294967295},i.empty=function(){return this.opaqueQueue.empty()&&this.transparentQueue.empty()&&this.opaqueInstancingQueue.empty()&&this.transparentInstancingQueue.empty()},i.recordCommands=function(t,i,n){var r=4294967295===this.lightByteOffset?null:[this.lightByteOffset];3&n&&(this.opaqueQueue.recordCommandBuffer(kw.gfxDevice,i,t,null,0,r),this.opaqueInstancingQueue.recordCommandBuffer(i,t,null,0,r)),4&n&&(this.transparentInstancingQueue.recordCommandBuffer(i,t,null,0,r),this.transparentQueue.recordCommandBuffer(kw.gfxDevice,i,t,null,0,r))},t}(),Det=4294967295;function Bet(t){switch(t){case 0:return 1;case 1:return 2;case 2:return 16;case 3:return 32;case 4:return 64;case 5:return 4;case 6:return 8;case 7:return 128;case 8:return 256;default:return X("DescriptorType not found"),256}}function Fet(t){switch(t){case 1:return 0;case 2:return 1;case 16:return 2;case 32:return 3;case 64:return 4;case 4:return 5;case 8:return 6;case 128:return 7;case 256:return 8;default:return X("DescriptorTypeOrder not found"),8}}function Uet(t,i){return t.locateChild(t.N,i||"default")}function xet(t,i,n){return t.locateChild(i,n)}function Get(t,i,n){return void 0===n?t.locateChild(i,"default"):"number"==typeof n?t.locateChild(i,n.toString()):t.locateChild(i,n)}var jet,Het,Vet=new Map([["cc_lightPos",1],["cc_lightColor",1],["cc_lightSizeRangeAngle",1],["cc_lightDir",1],["cc_lightBoundingSizeVS",1]]);function $et(t){for(var i,n=0,r=w(t);!(i=r()).done;){var s=i.value;if(s.count)n+=zd(s.type)*s.count;else{var e=Vet.get(s.name);if(void 0===e)if("cc_joints"!==s.name)X("Invalid uniform count: "+s.name);else{var h=zd(s.type)*uy.LAYOUT.members[0].count;Y(h!==uy.SIZE),n+=h}else n+=zd(s.type)*e}}return Y(!!n),n}function zet(t,i){var n=JSON.parse(t[0]),r=JSON.parse(i[0]);return 1e4*n.updateFrequency+1e3*n.parameterType+100*n.descriptorType+n.visibility-(1e4*r.updateFrequency+1e3*r.parameterType+100*r.descriptorType+r.visibility)}function Wet(t,i){var n=JSON.parse(t[0]),r=JSON.parse(i[0]);return 1e9*n.updateFrequency+1e8*n.parameterType+1e7*n.descriptorType+1e6*n.visibility+1e5*n.accessType+1e4*n.viewDimension+1e3*n.sampleType+n.format-(1e9*r.updateFrequency+1e8*r.parameterType+1e7*r.descriptorType+1e6*r.visibility+1e5*r.accessType+1e4*r.viewDimension+1e3*r.sampleType+r.format)}function Xet(t,i){var n=t.attributeIndex.get(i);if(void 0===n){var r=t.valueNames.length;return t.attributeIndex.set(i,r),t.valueNames.push(i),r}return n}function Yet(t,i){i.bindings.length=0;for(var n=0;n<t.descriptorBlocks.length;++n)for(var r=t.descriptorBlocks[n],s=r.offset,e=0;e<r.descriptors.length;++e){var h=r.descriptors[e],u=new md;u.binding=s,u.descriptorType=Bet(r.type),u.count=h.count,u.stageFlags=r.visibility,u.access=r.accessType,u.viewDimension=r.viewDimension,u.sampleType=r.sampleType,u.format=r.format,u.immutableSamplers=[],i.bindings.push(u),s+=h.count}}function Ket(t,i){var n=new bd;return Yet(i,n),t?t.createDescriptorSetLayout(n):null}function qet(t,i){for(var n=0;n<i._layouts.length;++n)i.getLayout(n).getSets().forEach((function(i){var n=i,r=n.descriptorSetLayoutData;if(t){var s=Ket(t,r);s&&(n.descriptorSetLayout=s,n.descriptorSet=t.createDescriptorSet(new kd(s)))}else Yet(r,n.descriptorSetLayoutInfo)}))}function Qet(t,i){var n=JSON.stringify(i),r=t.get(n);if(r)return r;var s=new ost(i.descriptorType,i.visibility,0);return t.set(n,s),s}function Jet(t,i){var n=JSON.stringify(i),r=t.get(n);if(r)return r;var s=new ost(i.descriptorType,i.visibility,0,i.accessType,i.viewDimension,i.sampleType,i.format);return t.set(n,s),s}function Zet(t){switch(t){case 26:case 33:case 39:return 2;case 28:case 35:case 41:return 4;case 29:case 36:case 42:return 5;case 31:case 38:case 44:return 9;case 30:case 37:case 43:return 8;default:return 0}}function tht(t,i,n,r){for(var s=new Map,e=new Map,h=0;h<r.blocks.length;h++){var u=r.blocks[h],o=hst.isWebGPU?Jet(s,{updateFrequency:i,parameterType:4,descriptorType:0,visibility:u.stageFlags,accessType:1,viewDimension:1,sampleType:0,format:0}):Qet(s,{updateFrequency:i,parameterType:4,descriptorType:0,visibility:u.stageFlags}),c=Xet(t,u.name);o.descriptors.push(new ust(c,0,1)),e.set(c,new Zl(n,4294967295,u.name,u.members,1))}for(var a=0;a<r.samplerTextures.length;a++){var f=r.samplerTextures[a],v=hst.isWebGPU?Jet(s,{updateFrequency:i,parameterType:4,descriptorType:2,visibility:f.stageFlags,accessType:1,viewDimension:Zet(f.type),sampleType:f.sampleType,format:0}):Qet(s,{updateFrequency:i,parameterType:4,descriptorType:2,visibility:f.stageFlags}),l=Xet(t,f.name);v.descriptors.push(new ust(l,f.type,f.count))}for(var d=0;d<r.samplers.length;d++){var g=r.samplers[d],p=hst.isWebGPU?Jet(s,{updateFrequency:i,parameterType:4,descriptorType:3,visibility:g.stageFlags,accessType:1,viewDimension:0,sampleType:0,format:0}):Qet(s,{updateFrequency:i,parameterType:4,descriptorType:3,visibility:g.stageFlags}),_=Xet(t,g.name);p.descriptors.push(new ust(_,32,g.count))}for(var y=0;y<r.textures.length;y++){var m=r.textures[y],b=hst.isWebGPU?Jet(s,{updateFrequency:i,parameterType:4,descriptorType:4,visibility:m.stageFlags,accessType:1,viewDimension:Zet(m.type),sampleType:m.sampleType,format:0}):Qet(s,{updateFrequency:i,parameterType:4,descriptorType:4,visibility:m.stageFlags}),k=Xet(t,m.name);b.descriptors.push(new ust(k,m.type,m.count))}for(var A=0;A<r.buffers.length;A++){var E=r.buffers[A],T=hst.isWebGPU?Jet(s,{updateFrequency:i,parameterType:4,descriptorType:5,visibility:E.stageFlags,accessType:1,viewDimension:1,sampleType:0,format:0}):Qet(s,{updateFrequency:i,parameterType:4,descriptorType:5,visibility:E.stageFlags}),O=Xet(t,E.name);T.descriptors.push(new ust(O,0,1))}for(var S=0;S<r.images.length;S++){var I=r.images[S],R=hst.isWebGPU?Jet(s,{updateFrequency:i,parameterType:4,descriptorType:7,visibility:I.stageFlags,accessType:1,viewDimension:Zet(I.type),sampleType:0,format:0}):Qet(s,{updateFrequency:i,parameterType:4,descriptorType:7,visibility:I.stageFlags}),M=Xet(t,I.name);R.descriptors.push(new ust(M,I.type,I.count))}for(var C=0;C<r.subpassInputs.length;C++){var N=r.subpassInputs[C],P=hst.isWebGPU?Jet(s,{updateFrequency:i,parameterType:4,descriptorType:8,visibility:N.stageFlags,accessType:1,viewDimension:4,sampleType:0,format:0}):Qet(s,{updateFrequency:i,parameterType:4,descriptorType:8,visibility:N.stageFlags}),L=Xet(t,N.name);P.descriptors.push(new ust(L,0,N.count))}for(var D,B=hst.isWebGPU?Array.from(s).sort(Wet):Array.from(s).sort(zet),F=new cst(n,0),U=0,x=w(B);!(D=x()).done;){var G=D.value,j=G[0],H=G[1],V=JSON.parse(j);H.offset=U;for(var $,z=w(H.descriptors);!($=z()).done;){var W=$.value;if(0===V.descriptorType){var K=e.get(W.descriptorID);if(!K){X("Uniform block not found for "+W.descriptorID);continue}Y(4294967295===K.binding),K.binding=H.capacity,F.uniformBlocks.set(W.descriptorID,K)}void 0!==F.bindingMap.get(W.descriptorID)&&X("Duplicated descriptor "+W.descriptorID),F.bindingMap.set(W.descriptorID,H.offset+H.capacity),H.capacity+=W.count}U+=H.capacity,F.capacity+=H.capacity,0===V.descriptorType||1===V.descriptorType?F.uniformBlockCapacity+=H.capacity:2===V.descriptorType&&(F.samplerTextureCapacity+=H.capacity),F.descriptorBlocks.push(H)}return F}function iht(t,i){i.bindings.length=0;for(var n=0;n<t.descriptorBlocks.length;++n)for(var r=t.descriptorBlocks[n],s=r.offset,e=0;e<r.descriptors.length;++e){var h=r.descriptors[e],u=new md;u.binding=s,u.descriptorType=Bet(r.type),u.count=h.count,u.stageFlags=r.visibility,u.access=r.accessType,u.viewDimension=r.viewDimension,u.sampleType=r.sampleType,u.format=r.format,u.immutableSamplers=[],i.bindings.push(u),s+=h.count}}function nht(t,i,n){var r=t.getSet(i);r&&r.descriptorSetLayout?n.setLayouts.push(r.descriptorSetLayout):n.setLayouts.push(jet)}function rht(t,i){hst.type=8===t.gfxAPI?1:0,hst.isWebGPU=8===t.gfxAPI,jet=t.createDescriptorSetLayout(new bd),Het=t.createPipelineLayout(new Ad);for(var n,r=w(i.v());!(n=r()).done;)for(var s,e=n.value,h=w(i.getLayout(e).getSets());!(s=h()).done;){var u=s.value;u[0];var o=u[1];null!==o.descriptorSetLayout&&W("descriptor set layout already initialized. It will be overwritten"),iht(o.descriptorSetLayoutData,o.descriptorSetLayoutInfo),o.descriptorSetLayout=t.createDescriptorSetLayout(o.descriptorSetLayoutInfo)}for(var c,a=w(i.v());!(c=a()).done;){var f=c.value;if(i.h(1,f)){var v=i.getParent(f),l=f,d=i.getLayout(v),g=i.getLayout(l),p=new Ad;nht(d,3,p),nht(g,2,p),nht(g,1,p),nht(g,0,p),i.j(l).pipelineLayout=t.createPipelineLayout(p)}}}function sht(t){for(var i,n=w(t.v());!(i=n()).done;)for(var r,s=i.value,e=w(t.getLayout(s).getSets());!(r=e()).done;){var h=r.value;h[0];var u=h[1];null!==u.descriptorSetLayout&&u.descriptorSetLayout.destroy()}Het.destroy(),jet.destroy()}function eht(){return jet}function hht(){return Het}function uht(t,i,n,r){if(r<3){var s=t.getLayout(n).getSet(r);return s?s.descriptorSetLayout?s.descriptorSetLayout:(X("descriptor set layout not initialized"),jet):jet}Y(3===r),Y(i===t.getParent(n));var e=t.getLayout(i).getSet(r);return e?e.descriptorSetLayout?e.descriptorSetLayout:(X("descriptor set layout not initialized"),jet):jet}function oht(t,i,n,r){if(r<3){var s=t.getLayout(n).getSet(r);return s?s.descriptorSetLayout?s.descriptorSetLayout:(X("descriptor set layout not initialized"),null):null}Y(3===r),Y(i===t.getParent(n));var e=t.getLayout(i).getSet(r);return e?e.descriptorSetLayout?e.descriptorSetLayout:(X("descriptor set layout not initialized"),null):null}function cht(t,i,n){Y(i!==t.N);var r=t.j(i).shaderIndex.get(n);return void 0===r?Det:r}function aht(t,i){var n=t.attributeIndex.get(i);return void 0===n?Det:n}function fht(t,i){return i>=t.valueNames.length?"":t.valueNames[i]}var vht=function(){this.frustumCullingKeyRecycle=new Ge((function(){return new mht}),8),this.frustumCullingsRecycle=new Ge((function(){return new Oht}),8),this.lightBoundsCullingRecycle=new Ge((function(){return new kht}),8),this.lightBoundsCullingResultRecycle=new Ge((function(){return new Aht}),8),this.lightBoundsCullingKeyRecycle=new Ge((function(){return new bht}),8),this.renderQueueRecycle=new Ge((function(){return new Let}),8),this.renderQueueQueryRecycle=new Ge((function(){return new Net}),8)},lht=M_.makeMaskExclude([M_.BitMask.UI_2D,M_.BitMask.UI_3D,M_.BitMask.GIZMOS,M_.BitMask.EDITOR,M_.BitMask.SCENE_GIZMO,M_.BitMask.PROFILER]),dht=new WeakMap,wht="",ght=0;function pht(t){return dht.has(t)||dht.set(t,++ght),dht.get(t)}function _ht(t,i,n){void 0===n&&(n=-1),wht="";var r=t.camera,s=t.light.light,e=t.light.level,h=t.light.probe,u=t.shadingLight;return wht+=het(r?pht(r):0),wht+=het(h?pht(h):0),wht+=het(-1===n&&s?pht(s):0),wht+=het(-1!==n&&u?pht(u):0),wht+=het(-1===n?e:0),wht+=het(i?1:0),wht+=het(n)}var yht,mht=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this.sceneData=null,this.castShadows=!1,this.sceneData=t,this.castShadows=i}return t.prototype.update=function(t,i){this.sceneData=t,this.castShadows=i},t}(),bht=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=-1),this.sceneData=null,this.frustumCullingID=-1,this.sceneData=t,this.frustumCullingID=i}return t.prototype.update=function(t,i){void 0===t&&(t=null),void 0===i&&(i=-1),this.sceneData=t,this.frustumCullingID=i},t}(),kht=function(){function t(){this.resultKeyIndex=new Map,this.resultIndex=new Map}return t.prototype.update=function(){this.resultIndex.clear(),this.resultKeyIndex.clear()},t}(),Aht=function(){function t(){this.instances=[],this.lightByteOffset=4294967295}return t.prototype.update=function(){return this.instances.length=0,this.lightByteOffset=4294967295,this},t}();function Eht(t,i,n){return t+"-"+i+"-"+n}function Tht(t){var i=t.split("-");return[parseInt(i[0]),parseInt(i[1]),parseInt(i[2])]}var Oht=function(){function t(){this.resultIndex=new Map,this.resultKeyIndex=new Map}return t.prototype.update=function(){this.resultIndex.clear(),this.resultKeyIndex.clear()},t}();function Sht(t,i){return t&&(i&t.layer)===t.layer}function Iht(t,i){return!!(i&t.visFlags)}function Rht(t,i){return Sht(t.node,i)||Iht(t,i)}function Mht(t){return oet((t.node.layer&lht)===t.node.layer||lht&t.visFlags)}var Cht=new Mh;function Nht(t,i,n){var r=t.worldBounds,s=yht.shadows;return n&&s.type===bA.Planar?(Mh.transform(Cht,r,s.matLight),!Xu.aabbFrustum(Cht,i)):!Xu.aabbFrustum(r,i)}function Pht(t,i,n,r,s,e){var h,u,o=yht.skybox,c=o.model,a=i.visibility,f=8&i.clearFlag;!r&&o&&o.enabled&&c&&f&&e.push(c);for(var v,l=w(t.models);!(v=l()).done;){var d=v.value;if(d.enabled&&d.node&&(!r||d.castShadow)&&!t.isCulledByLod(i,d)){var g=d.worldBounds;if(s)if(0===s.probeType){if(!Rht(d,a))continue;if(g&&(h=g,u=s.boundingBox,!Xu.aabbWithAABB(h,u)))continue;e.push(d)}else Mht(d)&&e.push(d);else{if(!Rht(d,a))continue;if(g&&Nht(d,n,r))continue;e.push(d)}}}}var Lht=new Ir;function Dht(t,i){var n=0;return i.node&&(Ir.subtract(Lht,i.worldBounds?i.worldBounds.center:i.node.worldPosition,t.position),n=Ir.dot(Lht,t.forward)),n}function Bht(t,i,n,r,s,e,h){var u=h.probeQueue;r&&u.addToProbeQueue(e,t);for(var o=e.subModels,c=o.length,a=yht.skybox.model,f=Dht(s,e),v=0;v<c;++v){var l=o[v],d=l.passes,w=d.length;u.probeMap.includes(l)&&(t=u.defaultId);for(var g=0;g<w;++g)if(e!==a||v||g||!i){var p=d[g];if(t===p.phaseID){var _=p.blendState.targets[0].blend;!n&&_||!i&&!_||(1===p.batchingScheme?_?h.transparentInstancingQueue.add(p,l,g):h.opaqueInstancingQueue.add(p,l,g):_?h.transparentQueue.add(e,f,v,g):h.opaqueQueue.add(e,f,v,g))}}else h.opaqueQueue.add(e,f,v,g)}}var Fht,Uht=new Mh(0,0,0,.5,.5,.5),xht=new Mh,Ght=function(){function t(){this.frustumCullings=new Map,this.frustumCullingResults=[],this.lightBoundsCullings=new Map,this.lightBoundsCullingResults=[],this.renderQueueIndex=new Map,this.renderQueues=[],this.renderQueueQueryIndex=new Map,this.cullingPools=new vht,this.numFrustumCulling=0,this.numLightBoundsCulling=0,this.numRenderQueues=0,this.layoutGraph=void 0,this.renderGraph=void 0,this.enableLightCulling=!0,this.kFilterMask=8200,this.kDrawMask=7,this.kAllMask=this.kFilterMask|this.kDrawMask}var i=t.prototype;return i.resetPool=function(){var t=this.cullingPools;t.frustumCullingKeyRecycle.reset(),t.frustumCullingsRecycle.reset(),t.lightBoundsCullingRecycle.reset(),t.lightBoundsCullingResultRecycle.reset(),t.lightBoundsCullingKeyRecycle.reset(),t.renderQueueRecycle.reset(),t.renderQueueQueryRecycle.reset(),bet.reset()},i.clear=function(){this.resetPool(),this.frustumCullings.clear(),this.frustumCullingResults.length=0,this.lightBoundsCullings.clear(),this.lightBoundsCullingResults.length=0,this.renderQueueIndex.clear(),this.renderQueues.length=0,this.renderQueueQueryIndex.clear(),this.numLightBoundsCulling=0,this.numFrustumCulling=0,this.numRenderQueues=0},i.buildRenderQueues=function(t,i,n){this.layoutGraph=i,this.renderGraph=t,yht=n,this.FN(t),this.UN(n),this.xN(),this.GN()},i.jN=function(t,i){var n;if(!(4&t.cullingFlags))return 4294967295;if(0===(null==(n=t.shadingLight)?void 0:n.type))return 4294967295;if(!this.enableLightCulling)return 4294967295;var r=t.scene,s=this.lightBoundsCullings.get(r);if(!s){var e=this.cullingPools.lightBoundsCullingRecycle.add();e.update(),this.lightBoundsCullings.set(r,e),s=this.lightBoundsCullings.get(r)}var h=_ht(t,!1,i),u=s.resultIndex.get(h);if(void 0!==u)return u;var o=this.numLightBoundsCulling++;this.numLightBoundsCulling>this.lightBoundsCullingResults.length&&this.lightBoundsCullingResults.push(this.cullingPools.lightBoundsCullingResultRecycle.add().update()),s.resultIndex.set(h,o);var c=this.cullingPools.lightBoundsCullingKeyRecycle.add();return c.update(t,i),s.resultKeyIndex.set(h,c),o},i.HN=function(t){var i=this.renderGraph.j(t),n=i.scene,r=this.frustumCullings.get(n);if(!r){var s=this.cullingPools.frustumCullingsRecycle.add();s.update(),this.frustumCullings.set(n,s),r=this.frustumCullings.get(n)}var e=oet(8&i.flags),h=_ht(i,e),u=r.resultIndex.get(h);if(void 0!==u)return u;var o=this.numFrustumCulling++;this.numFrustumCulling>this.frustumCullingResults.length&&this.frustumCullingResults.push([]),r.resultIndex.set(h,o);var c=this.cullingPools.frustumCullingKeyRecycle.add();return c.update(i,e),r.resultKeyIndex.set(h,c),o},i.VN=function(t,i,n){var r=this.renderQueueIndex.get(t);if(void 0!==r)return this.renderQueues[r].sceneFlags|=i&this.kDrawMask,r;var s=this.numRenderQueues++;if(this.numRenderQueues>this.renderQueues.length){var e=this.cullingPools.renderQueueRecycle.add();e.update(),this.renderQueues.push(e)}var h=this.renderQueues[s];return this.renderQueueIndex.set(t,s),h.camera=n,h.sceneFlags=i&this.kAllMask,s},i.FN=function(t){for(var i,n=w(t.v());!(i=n()).done;){var r=i.value;if(t.h(9,r)&&t.getValid(r)){var s=t.j(r);if(s.scene){var e=this.HN(r),h=this.jN(s,e),u=t.getParent(r),o=Eht(e,h,t.j(u).phaseID),c=this.VN(o,s.flags,s.camera),a=this.cullingPools.renderQueueQueryRecycle.add();a.update(e,h,c),this.renderQueueQueryIndex.set(r,a)}}}},i.uploadInstancing=function(t){for(var i=0;i!==this.numRenderQueues;++i){var n=this.renderQueues[i];n.opaqueInstancingQueue.uploadBuffers(t),n.transparentInstancingQueue.uploadBuffers(t)}},i.$N=function(t){var i=this.renderGraph,n=i.getParent(t);return i.j(n).phaseID},i.zN=function(t,i,n,r){var s=t.csmLayers,e=n.csmLevel,h=t.shadows;return h.type===bA.Planar?i.frustum:(h.enabled&&h.type===bA.ShadowMap&&n&&n.node&&s.update(t,i),n.shadowFixedArea||e===AA.LEVEL_1?s.specialLayer.validFrustum:s.layers[r].validFrustum)},i.UN=function(t){for(var i,n=w(this.frustumCullings);!(i=n()).done;)for(var r,s=i.value,e=s[0],h=s[1],u=w(h.resultIndex);!(r=u()).done;){var o=r.value,c=o[0],a=o[1],f=h.resultKeyIndex.get(c),v=f.sceneData,l=v.light.light,d=v.light.level,g=f.castShadows,p=v.light.probe,_=p?p.camera:v.camera,y=this.frustumCullingResults[a];if(p)Pht(e,_,_.frustum,g,p,y);else if(l)switch(l.type){case 2:Pht(e,_,l.frustum,g,null,y);break;case 0:Pht(e,_,this.zN(t,_,l,d),g,null,y)}else Pht(e,_,_.frustum,g,null,y)}},i.WN=function(t,i,n){for(var r,s=t.aabb,e=w(i);!(r=e()).done;){var h=r.value,u=h.worldBounds;u&&!Xu.aabbWithAABB(u,s)||n.push(h)}},i.XN=function(t,i,n){for(var r,s=t.aabb,e=t.frustum,h=w(i);!(r=h()).done;){var u=r.value,o=u.worldBounds;(!o||Xu.aabbWithAABB(s,o)&&Xu.aabbFrustum(o,e))&&n.push(u)}},i.YN=function(t,i,n){for(var r,s=t.aabb,e=w(i);!(r=e()).done;){var h=r.value,u=h.worldBounds;u&&!Xu.aabbWithAABB(s,u)||n.push(h)}},i.KN=function(t,i,n){Uht.transform(t.node.worldMatrix,null,null,null,xht);for(var r,s=w(i);!(r=s()).done;){var e=r.value,h=e.worldBounds;h&&!Xu.aabbWithAABB(xht,h)||n.push(e)}},i.xN=function(){for(var t,i=w(this.lightBoundsCullings);!(t=i()).done;){var n=t.value;n[0];for(var r,s=n[1],e=w(s.resultIndex);!(r=e()).done;){var h=r.value,u=h[0],o=h[1],c=s.resultKeyIndex.get(u),a=c.sceneData,f=c.frustumCullingID,v=this.frustumCullingResults[f],l=this.lightBoundsCullingResults[o];switch(a.shadingLight.type){case 1:var d=a.shadingLight;this.WN(d,v,l.instances);break;case 2:var g=a.shadingLight;this.XN(g,v,l.instances);break;case 3:var p=a.shadingLight;this.YN(p,v,l.instances);break;case 4:var _=a.shadingLight;this.KN(_,v,l.instances)}}}},i.qN=function(t,i){return 4294967295!==t?t<this.lightBoundsCullingResults.length?this.lightBoundsCullingResults[t].instances:[]:i<this.frustumCullingResults.length?this.frustumCullingResults[i]:[]},i.GN=function(){for(var t,i=w(this.renderQueueIndex);!(t=i()).done;){var n=t.value,r=n[0],s=n[1],e=this.renderQueues[s],h=Tht(r),u=h[0],o=h[1],c=h[2],a=oet(4&e.sceneFlags),f=oet(3&e.sceneFlags),v=oet(8&e.sceneFlags),l=oet(8192&e.sceneFlags);if(v||a||f||l){for(var d,g=this.qN(o,u),p=e.camera,_=w(g);!(d=_()).done;)Bht(c,f,a,l,p,d.value,e);e.sort()}}},t}(),jht=function(){function t(){this.QN=void 0,this.JN=void 0,this.Kd=null,this.ZN=0,this.tP=16,this.iP=4294967295,this.nP=!1,this.rP=void 0,this.sP=null,this.eP=[],this.hP=new Map}var i=t.prototype;return i.init=function(t,i,n){this.Kd=i,this.JN=t;var r=this.JN.localLayoutData,s=t.layoutGraph.attributeIndex.get("CCForwardLight"),e=r.uniformBlocks.get(s);this.ZN=cet($et(e.members),this.Kd.capabilities.uboOffsetAlignment),this.tP=n,this.iP=t.localLayoutData.bindingMap.get(s);var h=this.ZN*this.tP;this.rP=this.Kd.createBuffer(new $l(18,3,h,this.ZN)),this.sP=this.Kd.createBuffer(new zl(this.rP,0,this.ZN)),this.QN=new Float32Array(h/4),this.nP=!0},i.buildLights=function(t,i,n){for(var r,s=w(t.lightBoundsCullings);!(r=s()).done;){var e=r.value;e[0];for(var h,u=e[1],o=w(u.resultIndex);!(h=o()).done;){var c=h.value,a=c[0],f=c[1],v=u.resultKeyIndex.get(a).sceneData,l=1;if(v.camera)l=v.camera.exposure;else{if(!v.light.probe||!v.light.probe.camera)throw new Error("Unexpected situation: No camera or probe found.");l=v.light.probe.camera.exposure}var d=this.addLight(v.shadingLight,i,l,n);t.lightBoundsCullingResults[f].lightByteOffset=d}}for(var g,p=w(t.renderQueueQueryIndex);!(g=p()).done;){var _=g.value;_[0];var y=_[1];if(4294967295!==y.lightBoundsCulledResultID){var m=t.lightBoundsCullingResults[y.lightBoundsCulledResultID].lightByteOffset;t.renderQueues[y.renderQueueTarget].lightByteOffset=m}}},i.tryUpdateRenderSceneLocalDescriptorSet=function(t){if(t.lightBoundsCullings.size){for(var i,n=w(t.frustumCullings);!(i=n()).done;){var r=i.value,s=r[0];r[1];for(var e,h=w(s.models);!(e=h()).done;){var u=e.value;if(!u)throw new Error("Unexpected null model.");for(var o,c=w(u.subModels);!(o=c()).done;){var a=o.value.descriptorSet,f=a.getBuffer(this.iP);(this.nP||f!==this.sP)&&(a.bindBuffer(this.iP,this.sP),a.update())}}}this.nP=!1}},i.clear=function(){this.QN.fill(0),this.eP.length=0,this.hP.clear()},i.addLight=function(t,i,n,r){var s=this.hP.get(t);if(void 0!==s)return s;if(this.eP.length===this.tP){this.nP=!0,this.tP*=2;var e=this.ZN*this.tP;this.rP.resize(e),this.sP=this.Kd.createBuffer(new zl(this.rP,0,this.ZN));var h=this.QN;this.QN=new Float32Array(e/4),this.QN.set(h)}var u=this.eP.length;this.eP[u]=t,this.hP.set(t,u);var o=this.ZN/4*u;return aet(t,i,n,r,this.QN,o,this.ZN),u*this.ZN},i.buildLightBuffer=function(t){t.updateBuffer(this.rP,this.QN,this.eP.length*this.ZN/4)},t}(),Hht=function(){function t(t){void 0===t&&(t=""),this.name=void 0,this.name=t,Fht&&Fht.pipeline.resourceUses.push(t)}var i=t.prototype;return i.checkTexture=function(t){var i=Fht.deviceTextures.get(t);if(!i)return!1;var n=Fht.resourceGraph.getDesc(Fht.resourceGraph.vertex(t)),r=n.width,s=n.height,e=function(t,i){return t===r&&i===s};return i.texture?e(i.texture.width,i.texture.height):!!i.swapchain&&e(i.swapchain.width,i.swapchain.height)},i.createDeviceTex=function(t){var i,n=Fht.deviceTextures.get(this.name);n&&this.checkTexture(this.name)||(null!=(i=n)&&i.texture&&n.texture.destroy(),n=new $ht(this.name,t),Fht.deviceTextures.set(this.name,n))},i.checkBuffer=function(t){var i=Fht.deviceBuffers.get(t),n=Fht.resourceGraph.vertex(this.name),r=Fht.resourceGraph.getDesc(n);return i.buffer.size>=r.width},i.createDeviceBuf=function(t){var i,n=Fht.deviceBuffers.get(this.name);n&&this.checkBuffer(this.name)||(null!=(i=n)&&i.buffer&&n.buffer.destroy(),n=new Wht(this.name,t),Fht.deviceBuffers.set(this.name,n))},i.managed=function(t){this.createDeviceTex(t)},i.managedBuffer=function(t){this.createDeviceBuf(t)},i.managedTexture=function(){},i.persistentBuffer=function(t){this.createDeviceBuf(t)},i.persistentTexture=function(t){this.createDeviceTex(t)},i.framebuffer=function(t){this.createDeviceTex(t)},i.swapchain=function(t){this.createDeviceTex(t)},i.formatView=function(){},i.subresourceView=function(){},r(t,[{key:"resName",set:function(t){this.name=t}}]),t}(),Vht=function(){function t(t){this._name=void 0,this._name=t}return r(t,[{key:"name",get:function(){return this._name}}]),t}(),$ht=function(t){function i(i,n){var r;(r=t.call(this,i)||this)._texture=null,r._swapchain=null,r._framebuffer=null,r._desc=null,r._trait=null;var s=Fht.resourceGraph,e=s.vertex(i);return r._desc=s.getDesc(e),r._trait=s.getTraits(e),n instanceof gw?r._texture=n:n instanceof iw?r._framebuffer=n:n instanceof krt?r._swapchain=n.swapchain:r.uP(r._desc),r}e(i,t);var n=i.prototype;return n.uP=function(t){var i=1;switch(t.dimension){case 1:i=0;break;case 3:i=2}var n=[[16,16],[32,32],[64,64],[8,4],[4,8],[256,1],[512,2]].reduce((function(i,n){var r=n[0],s=n[1];return t.flags&r?i|s:i}),0);this._texture=Fht.device.createTexture(new Kl(i,n,t.format,t.width,t.height))},n.release=function(){var t,i;null==(t=this.framebuffer)||t.destroy(),this._framebuffer=null,null==(i=this.texture)||i.destroy(),this._texture=null},r(i,[{key:"texture",get:function(){return this._texture}},{key:"framebuffer",get:function(){return this._framebuffer},set:function(t){this._framebuffer=t}},{key:"description",get:function(){return this._desc}},{key:"trait",get:function(){return this._trait}},{key:"swapchain",get:function(){return this._swapchain}}]),i}(Vht);function zht(t){var i=T.director.root.pipeline.pipelineSceneData;return!!(i.shadows.enabled&&i.shadows.type===bA.ShadowMap&&t&&8&t.flags)}var Wht=function(t){function i(i){var n;(n=t.call(this,i)||this).Ts=null;var r=Fht.resourceGraph,s=r.vertex(i),e=r.getDesc(s),h=new $l(n.oP(e.flags),1,e.width);return n.Ts=Fht.device.createBuffer(h),n}e(i,t);var n=i.prototype;return n.oP=function(t){return[[2,64],[1,16],[4,32],[256,1],[512,2]].reduce((function(i,n){var r=n[0],s=n[1];return t&r?i|s:i}),0)},n.release=function(){var t;null==(t=this.Ts)||t.destroy(),this.Ts=null},r(i,[{key:"buffer",get:function(){return this.Ts}}]),i}(Vht),Xht=new Float32Array(4),Yht=function(){function t(t){this.cP=!1,this.fP=!1,this.vP=void 0,this.lP=null,this.dP=void 0,this.wP=null,this.gP=1e4,this.pP=void 0,this.vP=t}var i=t.prototype;return i._createQuadInputAssembler=function(){return Fht.blit.pipelineIAData},i.createScreenQuad=function(){this.lP||(this.lP=this._createQuadInputAssembler())},i._P=function(t){var i=this;if(t.scene){for(var n,r=Fht.pipeline,s=Fht.commandBuffer,e=t.scene.sphereLights,h=t.scene.spotLights,u=t.exposure,o=ry.LIGHTS_PER_PASS,c=$s.length,a=c*o,f=De.create(0,0,0,1),v=0,l=function(n,s){if(!(v>=o)&&(De.set(f,n.position.x,n.position.y,n.position.z,n.range),Xu.sphereFrustum(f,t.frustum))){if(Ir.toArray(Xht,n.position),Xht[3]=s?1:0,i.pP.set(Xht,v*c+0*a),Ir.toArray(Xht,n.color),n.useColorTemperature){var e=n.colorTemperatureRGB;Xht[0]*=e.x,Xht[1]*=e.y,Xht[2]*=e.z}Xht[3]=r.pipelineSceneData.isHDR?n.luminance*u*i.gP:n.luminance,i.pP.set(Xht,v*c+1*a),Xht[0]=n.size,Xht[1]=n.range,Xht[2]=s?n.spotAngle:0,i.pP.set(Xht,v*c+2*a),s&&(Ir.toArray(Xht,n.direction),i.pP.set(Xht,v*c+3*a)),v++}},d=w(e);!(n=d()).done;)l(n.value,!1);for(var g,p=w(h);!(g=p()).done;)l(g.value,!0);var _=3*a+3;this.pP.set([v],_),s.updateBuffer(this.wP,this.pP)}},i.update=function(){64&this.blit.sceneFlags&&this.blit.camera&&!this.fP&&(this._P(this.blit.camera),this.fP=!0,this.cP=!1),this.cP||(this.dP.update(),this.cP=!0)},i.reset=function(){this.cP=!1,this.fP=!1},i.createStageDescriptor=function(){var t=this.blit,i=t.material.passes[t.passID],n=Fht.device;if(this.dP=Fht.blit.stageDescs.get(i)||n.createDescriptorSet(new kd(i.localSetLayout)),Fht.blit.stageDescs.set(i,this.dP),64&this.blit.sceneFlags){this.wP=Fht.blit.lightVolumeBuffer;var r=Fht.blit.deferredLitsBufView;this.pP=Fht.blit.lightBufferData,this.pP.fill(0),this.dP.bindBuffer(ny.BINDING,r)}this.dP.bindBuffer(Q_.BINDING,Fht.blit.emptyLocalUBO)},r(t,[{key:"screenQuad",get:function(){return this.lP}},{key:"blit",get:function(){return this.vP},set:function(t){this.vP=t}},{key:"stageDesc",get:function(){return this.dP}}]),t}(),Kht=function(){function t(){this.yP=void 0,this.mP=0,this.kP=Uk("default"),this.AP=null,this.EP=null,this.TP=-1,this.OP=!1,this.SP=!1,this.IP=!1,this.RP=-1}var i=t.prototype;return i.preRecord=function(){},i.postRecord=function(){},i.init=function(t,i,n){this.reset(),this.queueHint=i.hint,this.queueId=n,this.yP=t,this.kP=T.rendering.getPhaseID(t.passID,Fht.renderGraph.getLayout(n))},i.reset=function(){this.OP=!1,this.SP=!1,this.IP=!1},i.record=function(){this.EP&&this.EP.descriptorSet&&Fht.commandBuffer.bindDescriptorSet(3,this.EP.descriptorSet)},r(t,[{key:"phaseID",get:function(){return this.kP}},{key:"layoutID",get:function(){return this.TP},set:function(t){this.TP=t;var i=Fht.layoutGraph;this.AP=i.h(1,t)?i.j(t):null;var n=i.getLayout(t);this.EP=n.getSet(2)}},{key:"descSetData",get:function(){return this.EP}},{key:"renderPhase",get:function(){return this.AP}},{key:"queueId",get:function(){return this.RP},set:function(t){this.RP=t}},{key:"isUpdateUBO",get:function(){return this.OP},set:function(t){this.OP=t}},{key:"isUploadInstance",get:function(){return this.SP},set:function(t){this.SP=t}},{key:"isUploadBatched",get:function(){return this.IP},set:function(t){this.IP=t}},{key:"queueHint",get:function(){return this.mP},set:function(t){this.mP=t}},{key:"devicePass",get:function(){return this.yP}}]),t}(),qht=function(){function t(){this.MP=[],this.yP=void 0,this.mP=0,this.CP=void 0,this.kP=Uk("default"),this.AP=null,this.EP=null,this.wf=null,this.NP=null,this.TP=-1,this.OP=!1,this.SP=!1,this.IP=!1,this.PP=null,this.RP=-1}var i=t.prototype;return i.init=function(t,i,n){this.reset(),this.CP=i,this.queueHint=i.hint;var r=this.wf=i.viewport;r&&(this.NP=new Cl(r.left,r.top,r.width,r.height)),this.queueId=n,this.yP=t,this.kP=T.rendering.getPhaseID(t.passID,Fht.renderGraph.getLayout(n))},i.createBlitDesc=function(t){this.PP||(this.PP=new Yht(t)),this.PP.createScreenQuad(),this.PP.createStageDescriptor()},i.setScene=function(t,i,n){var r=Fht.pools.addDeviceScene();return r.init(this,t,i,n),this.MP.push(r),r},i.reset=function(){var t;this.MP.length=0,this.OP=!1,this.SP=!1,this.IP=!1,null==(t=this.PP)||t.reset()},i.preRecord=function(){},i.record=function(){this.EP&&this.EP.descriptorSet&&Fht.commandBuffer.bindDescriptorSet(3,this.EP.descriptorSet),this.MP.forEach((function(t){t.record()}))},i.postRecord=function(){},r(t,[{key:"phaseID",get:function(){return this.kP}},{key:"layoutID",get:function(){return this.TP},set:function(t){this.TP=t;var i=Fht.layoutGraph;this.AP=i.h(1,t)?i.j(t):null;var n=i.getLayout(t);this.EP=n.getSet(2)}},{key:"descSetData",get:function(){return this.EP}},{key:"renderPhase",get:function(){return this.AP}},{key:"viewport",get:function(){return this.wf}},{key:"scissor",get:function(){return this.NP}},{key:"queueId",get:function(){return this.RP},set:function(t){this.RP=t}},{key:"isUpdateUBO",get:function(){return this.OP},set:function(t){this.OP=t}},{key:"isUploadInstance",get:function(){return this.SP},set:function(t){this.SP=t}},{key:"isUploadBatched",get:function(){return this.IP},set:function(t){this.IP=t}},{key:"graphQueue",get:function(){return this.CP}},{key:"blitDesc",get:function(){return this.PP}},{key:"renderScenes",get:function(){return this.MP}},{key:"queueHint",get:function(){return this.mP},set:function(t){this.mP=t}},{key:"devicePass",get:function(){return this.yP}}]),t}(),Qht=function(){function t(t,i,n){this._layoutID=0,this._vertID=-1,this.LP=-1,this._stage=null,this._layout=void 0,this._inputName=void 0,this._descriptorSet=null,this._inputName=n[0],this._layoutID=t,this._vertID=i;var r=Fht.layoutGraph;this._stage=r.j(t),this._layout=r.getLayout(t);var s=this._layout.getSet(3);if(s){var e=s.descriptorSet,h=Fht.deviceTextures.get(this._inputName),u=null==h?void 0:h.texture,o=Fht.deviceBuffers.get(this._inputName),c=null==o?void 0:o.buffer;if(!u&&!c)throw Error("Could not find texture with resource name "+this._inputName);this.LP=Fht.resourceGraph.vertex(this._inputName);for(var a,f=Fht.resourceGraph.getSampler(this.LP),v=w(n[1]);!(a=v()).done;){var l=a.value.name,d=r.attributeIndex.get(l);void 0!==d&&this.DP(e,d,u,c,f,n[1][0].accessType)}}}return t.prototype.DP=function(t,i,n,r,s,e){for(var h,u=this._layout.getSet(3),o=Fht.resourceGraph.getDesc(this.LP),c=w(u.descriptorSetLayoutData.descriptorBlocks);!(h=c()).done;)for(var a=h.value,f=0;f<a.descriptors.length;++f)if(i===a.descriptors[f].descriptorID){var v=a.offset;if(n){t.bindTexture(v+f,n);var l=Fht.renderGraph.getData(this._vertID).samplers.get(i)||Fht.device.getSampler(s);t.bindSampler(v+f,l)}else if(4&o.flags){var d=0!==e?8388608:32768;t.bindBuffer(a.offset+f,r,0,d)}else t.bindBuffer(v+f,r);this._descriptorSet||(this._descriptorSet=t);break}},r(t,[{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"layoutID",get:function(){return this._layoutID}},{key:"vertID",get:function(){return this._vertID}},{key:"stage",get:function(){return this._stage}},{key:"layout",get:function(){return this._layout}}]),t}(),Jht=new Ul,Zht=new Cl,tut=new Hht,iut=function(){function t(t,i){this._renderPass=void 0,this._framebuffer=void 0,this._clearColor=[],this._deviceQueues=new Map,this._clearDepth=1,this._clearStencil=0,this._passID=void 0,this._rasterID=void 0,this._rasterPass=void 0,this._layoutName=void 0,this._viewport=null,this.ir=null,this.BP=0,this._rasterID=t,this._rasterPass=i;var n=Fht.device;this._layoutName=Fht.renderGraph.getLayout(t),this._passID=T.rendering.getPassID(this._layoutName);var r=new fd;r.format=55;for(var s,e=[],h=[],u=null,o=null,c=null,a=w(i.rasterViews);!(s=a()).done;){var f=s.value,v=f[0],l=f[1],d=Fht.deviceTextures.get(v);if(d){var g=Fht.resourceGraph,p=g.vertex(v),_=g.object(p);if(d.framebuffer&&_ instanceof iw&&d.framebuffer!==_)d.framebuffer=_;else if(d.texture){var y=g.getDesc(p);d.texture.width===y.width&&d.texture.height===y.height||d.texture.resize(y.width,y.height)}}else this.visitResource(v),d=Fht.deviceTextures.get(v);if(o||(o=d.swapchain),c||(c=d.framebuffer),0===l.attachmentType){d.swapchain||d.framebuffer||h.push(d.texture);var m=new ad;m.format=d.description.format,m.sampleCount=d.description.sampleCount,m.loadOp=l.loadOp,m.storeOp=l.storeOp,m.barrier=n.getGeneralBarrier(new gd(0===l.loadOp?2097152:0,0===l.storeOp?2097152:0));var b=new xl;b.copy(l.clearColor),this._clearColor.push(b),e.push(m)}else 1===l.attachmentType&&(r.depthStoreOp=l.storeOp,r.stencilStoreOp=l.storeOp,r.depthLoadOp=l.loadOp,r.stencilLoadOp=l.loadOp,r.barrier=n.getGeneralBarrier(new gd(0===l.loadOp?4194304:0,0===l.storeOp?4194304:0)),d.swapchain||d.framebuffer?d.swapchain&&(u=d.swapchain.depthStencilTexture):u=d.texture,this._clearDepth=l.clearColor.x,this._clearStencil=l.clearColor.y)}if(0===e.length){var k=new ad;e.push(k)}if(0===h.length&&!o&&!c){var A=n.createTexture(new Kl);h.push(A)}var E=new dd;E.colorAttachments=e,(o?o.depthStencilTexture:u)&&(E.depthStencilAttachment=r),this._renderPass=n.createRenderPass(E),this.FP(c,o?[o.colorTexture]:h,o?o.depthStencilTexture:u)}var i=t.prototype;return i.addIdxOfRD=function(){this.BP++},i.visitResource=function(t){var i=Fht.resourceGraph,n=i.vertex(t);tut.resName=t,i.visitVertex(tut,n)},i.addQueue=function(t){this._deviceQueues.set(t.queueId,t)},i.preRecord=function(){Fht.passDescriptorSet=Xst(this.layoutName).descriptorSet},i._applyRenderLayout=function(t){var i=Fht.renderGraph.getLayout(this._rasterID);if(i){var n=Fht.layoutGraph,r=n.locateChild(n.N,i);4294967295!==r&&(this.ir=new Qht(r,this._rasterID,t))}},i.getGlobalDescData=function(){var t=Fht.layoutGraph.locateChild(Fht.layoutGraph.N,"default");return Fht.layoutGraph.getLayout(t).getSet(3)},i._applyViewport=function(){this._viewport=null;var t=this._rasterPass.viewport;0===t.left&&0===t.top&&0===t.width&&0===t.height||(this._viewport=t)},i.beginPass=function(){var t=this.framebuffer.colorTextures[0];this._applyViewport(t);var i=Fht.commandBuffer;this._viewport?(Zht.x=this._viewport.left,Zht.y=this._viewport.top,Zht.width=this._viewport.width,Zht.height=this._viewport.height):(Zht.y=Zht.x=0,Zht.width=t.width,Zht.height=t.height),i.beginRenderPass(this.renderPass,this.framebuffer,Zht,this.clearColor,this.clearDepth,this.clearStencil),Fht.passDescriptorSet&&i.bindDescriptorSet(0,Fht.passDescriptorSet)},i.endPass=function(){Fht.commandBuffer.endRenderPass()},i.record=function(){this.beginPass();for(var t,i=w(this._deviceQueues.values());!(t=i()).done;)t.value.record();this.endPass()},i.postRecord=function(){},i.xP=function(t){for(var i,n=w(t.computeViews);!(i=n()).done;){var r=i.value;this._applyRenderLayout(r)}this.renderLayout&&this.renderLayout.descriptorSet&&this.renderLayout.descriptorSet.update()},i.processRenderLayout=function(){this.xP(this._rasterPass)},i.FP=function(t,i,n){(t||i.length)&&(this._framebuffer&&t!==this._framebuffer&&this._framebuffer.destroy(),this._framebuffer=t||Fht.device.createFramebuffer(new yd(this._renderPass,i,n)))},i.resetResource=function(t,i){var n,r,s,e;this._rasterID=t,this._rasterPass=i,this._layoutName=Fht.renderGraph.getLayout(t),this._passID=T.rendering.getPassID(this._layoutName),this._deviceQueues.clear(),this.BP=0;for(var h,u=null,o=[],c=this._framebuffer,a=null!==(n=null==c?void 0:c.depthStencilTexture)&&void 0!==n?n:null,f=c?a:null,v=null!==(r=null==c?void 0:c.width)&&void 0!==r?r:0,l=null!==(s=null==c?void 0:c.height)&&void 0!==s?s:0,d=0,g=0,p=w(i.rasterViews);!(h=p()).done;){var _=h.value,y=_[0];if(2!==_[1].attachmentType){var m=Fht.resourceGraph.getDesc(Fht.resourceGraph.vertex(y));d=m.width,g=m.height;break}}for(var b,k=(null==c?void 0:c.colorTextures.some((function(t){return!t||0===t.getTextureHandle()})))||a&&0===a.getTextureHandle(),A=d!==v||g!==l||null!==(e=null==c?void 0:c.needRebuild)&&void 0!==e&&e||k,E=w(i.rasterViews);!(b=E()).done;){var O=b.value,S=O[0],I=O[1],R=Fht.deviceTextures.get(S);R||(this.visitResource(S),R=Fht.deviceTextures.get(S));var M=Fht.resourceGraph,C=M.vertex(S),N=M.object(C),P=M.getDesc(C);if(R.framebuffer&&N instanceof iw&&(R.framebuffer!==N||N!==this._framebuffer))u=this._framebuffer=R.framebuffer=N;else if(R.texture&&A){var L=R.texture;L.resize(P.width,P.height),0===I.attachmentType?o.push(L):1===I.attachmentType&&(f=L)}}this.FP(u,o,f)},r(t,[{key:"indexOfRD",get:function(){return this.BP}},{key:"rasterID",get:function(){return this._rasterID}},{key:"layoutName",get:function(){return this._layoutName}},{key:"passID",get:function(){return this._passID}},{key:"renderLayout",get:function(){return this.ir}},{key:"renderPass",get:function(){return this._renderPass}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"clearColor",get:function(){return this._clearColor}},{key:"clearDepth",get:function(){return this._clearDepth}},{key:"clearStencil",get:function(){return this._clearStencil}},{key:"deviceQueues",get:function(){return this._deviceQueues}},{key:"viewport",get:function(){return this._viewport}}]),t}(),nut=function(){function t(){this._id=void 0,this._pass=void 0}return t.prototype.applyInfo=function(t,i){this._id=t,this._pass=i},r(t,[{key:"id",get:function(){return this._id}},{key:"pass",get:function(){return this._pass}}]),t}(),rut=function(){function t(t){this._deviceQueues=[],this._passID=void 0,this._layoutName=void 0,this._viewport=null,this.GP=void 0,this.ir=null,this.GP=t,this._layoutName=Fht.renderGraph.getLayout(t.id),this._passID=T.rendering.getPassID(this._layoutName);for(var i,n=w(t.pass.computeViews);!(i=n()).done;){var r=i.value,s=Fht.deviceTextures.get(r[0]);s||(this.visitResource(r[0]),s=Fht.deviceTextures.get(r[0])),this._applyRenderLayout(r)}this.renderLayout&&this.renderLayout.descriptorSet&&this.renderLayout.descriptorSet.update()}var i=t.prototype;return i.preRecord=function(){Fht.passDescriptorSet=Xst(this.layoutName).descriptorSet},i.postRecord=function(){},i.visitResource=function(t){var i=Fht.resourceGraph,n=i.vertex(t);tut.resName=t,i.visitVertex(tut,n)},i.addQueue=function(t){this._deviceQueues.push(t)},i._applyRenderLayout=function(t){var i=Fht.renderGraph.getLayout(this.GP.id);if(i){var n=Fht.layoutGraph,r=n.locateChild(n.N,i);4294967295!==r&&(this.ir=new Qht(r,this.GP.id,t))}},i.getGlobalDescData=function(){var t=Fht.layoutGraph.locateChild(Fht.layoutGraph.N,"default");return Fht.layoutGraph.getLayout(t).getSet(3)},i.record=function(){var t=Fht.commandBuffer;Fht.passDescriptorSet&&t.bindDescriptorSet(0,Fht.passDescriptorSet);for(var i,n=w(this._deviceQueues);!(i=n()).done;)i.value.record();Yst(Fht.renderGraph.getData(this.GP.id),-1,0,Fht.renderGraph.getLayout(this.GP.id))},i.resetResource=function(t,i){this.GP.applyInfo(t,i),this._layoutName=Fht.renderGraph.getLayout(t),this._passID=T.rendering.getPassID(this._layoutName),this._deviceQueues.length=0;for(var n,r=w(this.GP.pass.computeViews);!(n=r()).done;){var s=n.value;this._applyRenderLayout(s)}this.renderLayout&&this.renderLayout.descriptorSet&&this.renderLayout.descriptorSet.update()},r(t,[{key:"layoutName",get:function(){return this._layoutName}},{key:"passID",get:function(){return this._passID}},{key:"renderLayout",get:function(){return this.ir}},{key:"deviceQueues",get:function(){return this._deviceQueues}},{key:"computePassInfo",get:function(){return this.GP}}]),t}(),sut=new Ul,eut=function(){function t(){this._currentQueue=void 0,this._renderPass=void 0,this._scene=null,this._camera=null,this._sceneData=void 0,this._blit=void 0,this._sceneID=-1}var i=t.prototype;return i.preRecord=function(){this._blit&&0===this._blit.blitType&&(this._currentQueue.createBlitDesc(this._blit),this._currentQueue.blitDesc.update()),Fht.lightResource.buildLightBuffer(Fht.commandBuffer),Fht.lightResource.tryUpdateRenderSceneLocalDescriptorSet(Fht.culling)},i.postRecord=function(){},i.init=function(t,i,n,r){this._currentQueue=t,this._sceneData=n,this._blit=r,this._sceneID=i,this._renderPass=t.devicePass.renderPass;var s=n&&n.camera?n.camera:r&&r.camera?r.camera:null;s&&(this._scene=s.scene,this._camera=s)},i._record3D=function(){for(var t,i=this._blit,n=Fht.device,r=Fht.commandBuffer,s=w(i.models);!(t=s()).done;)for(var e,h=w(t.value.subModels);!(e=h()).done;)for(var u=e.value,o=u.inputAssembler,c=u.passes.length,a=0;a<c;++a){var f=u.passes[a],v=u.shaders[a],l=nA.getOrCreatePipelineState(n,f,v,this._renderPass,o);r.bindPipelineState(l),r.bindDescriptorSet(1,f.descriptorSet),r.bindDescriptorSet(2,u.descriptorSet),r.bindInputAssembler(o),r.draw(o)}},i._recordUI=function(){for(var t=this.camera.scene.batches,i=0;i<t.length;i++){var n=t[i],r=!1;if(this.camera.visibility&n.Jy&&(r=!0),r)for(var s=n.shaders.length,e=0;e<s;e++){var h=n.passes[e];if(h.phaseID===this._currentQueue.phaseID){var u=n.shaders[e],o=n.Zy,c=n.tm;Pet(Fht.commandBuffer,this._renderPass,h,c,u,o)}}}},i._showProfiler=function(){var t=Zht,i=Fht.pipeline.profiler;if(i&&i.enabled&&Fht.passShowStatistics){var n=Fht.profilerDescriptorSet,r=this._renderPass,s=Fht.commandBuffer,e=i.subModels[0],h=e.passes[0],u=e.inputAssembler;Jht.width=t.width,Jht.height=t.height,s.setViewport(Jht),s.setScissor(t),s.bindDescriptorSet(0,n),Pet(s,r,h,e.descriptorSet,e.shaders[0],u)}},i.jP=function(){if(this.blit){var t=this.blit,i=t.material.passes[t.passID];i.update();var n=i.getShaderVariant(),r=this._currentQueue.blitDesc,s=r.screenQuad.quadIA;Pet(Fht.commandBuffer,this._renderPass,i,r.stageDesc,n,s)}},i._updateGlobal=function(t,i){var n=this._currentQueue.devicePass;n.addIdxOfRD(),Yst(t,i,n.indexOfRD,Fht.renderGraph.getLayout(n.rasterID))},i._updateRenderData=function(){var t;if(!this._currentQueue.isUpdateUBO){var i=this._currentQueue.devicePass,n=i.rasterID,r=Fht.renderGraph.getData(n),s=this.sceneID;this._updateGlobal(Fht.renderGraph.globalRenderData,s),this._updateGlobal(r,s);var e=this._currentQueue.queueId,h=Fht.renderGraph.getData(e);this._updateGlobal(h,s);var u=Fht.renderGraph.getData(s);u&&this._updateGlobal(u,s),i.processRenderLayout(),null==(t=Fht.passDescriptorSet)||t.update(),this._currentQueue.isUpdateUBO=!0}},i.HP=function(){var t=this._currentQueue.viewport;if(t)Fht.commandBuffer.setViewport(t),Fht.commandBuffer.setScissor(this._currentQueue.scissor);else if(!this._currentQueue.devicePass.viewport){var i=this._currentQueue.devicePass.framebuffer.colorTextures[0],n=this.sceneData?this.sceneData.light:null,r=zht(this.sceneData)&&this.sceneData&&n.light?Fst(this.camera,i.width,i.height,n.light,n.level):Fst(this.camera,i.width,i.height);sut.left=r.x,sut.top=r.y,sut.width=r.width,sut.height=r.height,Fht.commandBuffer.setViewport(sut),Fht.commandBuffer.setScissor(r)}},i.record=function(){var t=this._currentQueue.devicePass,i=Fht.culling;if(this._updateRenderData(),this.HP(),this.blit)switch(this.blit.blitType){case 0:this.jP();break;case 1:this._recordUI();break;case 2:this._showProfiler();break;case 3:this._record3D()}else{var n,r=i.renderQueueQueryIndex.get(this.sceneID),s=i.renderQueues[r.renderQueueTarget],e=this.sceneData,h=oet(8192&e.flags);h&&s.probeQueue.applyMacro(),s.recordCommands(Fht.commandBuffer,this._renderPass,e.flags),h&&s.probeQueue.removeMacro(),512&e.flags&&(null==(n=this.camera.geometryRenderer)||n.render(t.renderPass,Fht.commandBuffer,Fht.pipeline.pipelineSceneData))}},r(t,[{key:"blit",get:function(){return this._blit}},{key:"sceneData",get:function(){return this._sceneData}},{key:"sceneID",get:function(){return this._sceneID}},{key:"camera",get:function(){return this._camera}}]),t}(),hut=function(){function t(){this.deviceQueuePool=void 0,this.computeQueuePool=void 0,this.passPool=void 0,this.deviceScenePool=void 0,this.deviceQueuePool=new Ge((function(){return new qht}),16),this.deviceScenePool=new Ge((function(){return new eut}),16),this.computeQueuePool=new Ge((function(){return new Kht}),16),this.passPool=new Ge((function(){return{priority:0,hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64)}var i=t.prototype;return i.addDeviceQueue=function(){return this.deviceQueuePool.add()},i.addComputeQueue=function(){return this.computeQueuePool.add()},i.addDeviceScene=function(){return this.deviceScenePool.add()},i.reset=function(){this.deviceQueuePool.reset(),this.computeQueuePool.reset(),this.deviceScenePool.reset()},t}(),uut=new Cl,out=function(){function t(t){this.VP=void 0,this.Gs=void 0,this.Xn=void 0,this.Yn=void 0,this.wP=void 0,this.pP=void 0,this.$P=void 0,this.zP=void 0,this.WP=new Map,this.Gs=t,this.Xn=t.width,this.Yn=t.height,this.VP=this.XP();var i=this.YP(0,new Cl(0,0,t.width,t.height));this.VP.quadVB.update(i),this.KP(),this.zP=t.device.createBuffer(new $l(18,1,224,224))}var i=t.prototype;return i.resize=function(t,i){if(t!==this.Xn||i!==this.Yn){uut.y=uut.x=0,uut.width=t,uut.height=i;var n=this.YP(0,uut);this.VP.quadVB.update(n)}},i.KP=function(){var t=this.Gs.root.device,i=80*ry.LIGHTS_PER_PASS;i=Math.ceil(i/t.capabilities.uboOffsetAlignment)*t.capabilities.uboOffsetAlignment,this.wP=t.createBuffer(new $l(18,3,i,t.capabilities.uboOffsetAlignment)),this.$P=t.createBuffer(new zl(this.wP,0,i)),this.pP=new Float32Array(i/4)},i.YP=function(t,i){var n=i.x/this.Gs.width,r=(i.x+i.width)/this.Gs.width,s=i.y/this.Gs.height,e=(i.y+i.height)/this.Gs.height;if(this.Gs.root.device.capabilities.screenSpaceSignY>0){var h=[e,s];s=h[0],e=h[1]}var u=new Float32Array(16),o=function(t,i,n,r,s,e,h,o,c,a,f,v,l,d,w,g){u.set([t,i,n,r,s,e,h,o,c,a,f,v,l,d,w,g])};switch(t){case 0:o(-1,-1,n,e,1,-1,r,e,-1,1,n,s,1,1,r,s);break;case 1:o(-1,-1,r,e,1,-1,r,s,-1,1,n,e,1,1,n,s);break;case 2:o(-1,-1,n,s,1,-1,r,s,-1,1,n,e,1,1,r,e);break;case 3:o(-1,-1,n,s,1,-1,n,e,-1,1,r,s,1,1,r,e)}return u},i.XP=function(){var t=new uA,i=T.director.root.device,n=i.createBuffer(new $l(10,3,64,16));if(!n)return t;var r=i.createBuffer(new $l(6,1,12,2));if(!r)return t;var s=new Uint16Array(6);s[0]=0,s[1]=1,s[2]=2,s[3]=1,s[4]=3,s[5]=2,r.update(s.buffer);var e=new Array(2);e[0]=new ud("a_position",21),e[1]=new ud("a_texCoord",21);var h=i.createInputAssembler(new cd(e,[n],r));return t.quadIB=r,t.quadVB=n,t.quadIA=h,t},r(t,[{key:"pipelineIAData",get:function(){return this.VP}},{key:"deferredLitsBufView",get:function(){return this.$P}},{key:"lightVolumeBuffer",get:function(){return this.wP}},{key:"lightBufferData",get:function(){return this.pP}},{key:"stageDescs",get:function(){return this.WP}},{key:"emptyLocalUBO",get:function(){return this.zP}}]),t}(),cut=function(){function t(t,i,n,r,s,e,h,u){void 0===u&&(u=null),this.device=void 0,this.pipeline=void 0,this.commandBuffer=void 0,this.pipelineSceneData=void 0,this.resourceGraph=void 0,this.devicePasses=new Map,this.deviceTextures=new Map,this.deviceBuffers=new Map,this.layoutGraph=void 0,this.root=void 0,this.pools=void 0,this.blit=void 0,this.culling=void 0,this.lightResource=new jht,this.renderGraph=void 0,this.width=void 0,this.height=void 0,this.cullCamera=void 0,this.passDescriptorSet=void 0,this.profilerDescriptorSet=void 0,this.passShowStatistics=!1,this.pipeline=t,this.device=i,this.commandBuffer=i.commandBuffer,this.pipelineSceneData=t.pipelineSceneData,this.resourceGraph=n,this.renderGraph=r,this.root=O.director.root,this.layoutGraph=s,this.width=e,this.height=h,this.pools=new hut,this.blit=new out(this),this.culling=new Ght,this.passDescriptorSet=u,this.profilerDescriptorSet=Xst("default").descriptorSet}var i=t.prototype;return i.reset=function(){this.culling.clear(),this.pools.reset(),this.cullCamera=null,this.lightResource.clear(),this.passShowStatistics=!1},i.resize=function(t,i){this.width=t,this.height=i,this.blit.resize(t,i)},t}(),aut=function(){function t(t,i,n,r,s,e){this._context=void 0,this.qP=void 0,Fht=this._context=new cut(t,i,n,new Jrt,r,s,e);var h=T.rendering.programLib;Fht.lightResource.init(h,i,16)}var i=t.prototype;return i.resize=function(t,i){Fht.resize(t,i)},i.QP=function(){for(var t,i=Fht.pipeline.resourceUses,n=[],r=Fht.deviceTextures,s=w(r);!(t=s()).done;){var e=t.value,h=e[0];e[1];var u=Fht.resourceGraph.vertex(h),o=Fht.resourceGraph.getTraits(u);i.includes(h)||0!==o.residency||n.push(h)}for(var c=0,a=n;c<a.length;c++){var f=a[c];r.get(f).release(),r.delete(f)}for(var v,l=[],d=Fht.deviceBuffers,g=w(d);!(v=g()).done;){var p=v.value,_=p[0];p[1];var y=Fht.resourceGraph.vertex(_),m=Fht.resourceGraph.getTraits(y);i.includes(_)||0!==m.residency||l.push(_)}for(var b=0,k=l;b<k.length;b++){var A=k[b];d.get(A).release(),d.delete(A)}i.length=0},i.execute=function(t){Fht.renderGraph=t,Fht.reset();var i=Fht.commandBuffer,n=Fht.culling;n.buildRenderQueues(t,Fht.layoutGraph,Fht.pipelineSceneData),Fht.lightResource.buildLights(n,Fht.pipelineSceneData.isHDR,Fht.pipelineSceneData.shadows),this.QP(),i.begin(),n.uploadInstancing(i),this.qP||(this.qP=new dut),vrt(this.qP.graphView,this.qP,this.qP.colorMap),i.end(),Fht.device.queue.submit([i])},i.release=function(){Fht.devicePasses.clear();for(var t,i=w(Fht.deviceTextures);!(t=i()).done;){var n=t.value;n[0],n[1].release()}Fht.deviceTextures.clear();for(var r,s=w(Fht.deviceBuffers);!(r=s()).done;){var e=r.value;e[0],e[1].release()}Fht.deviceBuffers.clear()},t}(),fut=function(){function t(){this.queueID=4294967295,this.sceneID=4294967295,this.passID=4294967295,this.dispatchID=4294967295,this.currPass=void 0,this.currQueue=void 0,this.rg=void 0,this.rg=Fht.renderGraph}var i=t.prototype;return i._isRasterPass=function(t){return Fht.renderGraph.h(0,t)},i.isComputePass=function(t){return Fht.renderGraph.h(3,t)},i.isDispatch=function(t){return Fht.renderGraph.h(11,t)},i._isQueue=function(t){return Fht.renderGraph.h(8,t)},i._isScene=function(t){return Fht.renderGraph.h(9,t)},i._isBlit=function(t){return Fht.renderGraph.h(10,t)},i.applyID=function(t){this._isRasterPass(t)?this.passID=t:this._isQueue(t)?this.queueID=t:this._isScene(t)||this._isBlit(t)?this.sceneID=t:this.isComputePass(t)?this.passID=t:this.isDispatch(t)&&(this.dispatchID=t)},t}(),vut=function(t){function i(){return t.call(this)||this}e(i,t);var n=i.prototype;return n.clear=function(){},n.viewport=function(){},n.rasterPass=function(t){if(this.rg.getValid(this.passID)){var i=Fht.devicePasses,n=t.hashValue;this.currPass=i.get(n),this.currPass?this.currPass.resetResource(this.passID,t):(this.currPass=new iut(this.passID,t),i.set(n,this.currPass)),this.currPass.preRecord()}},n.rasterSubpass=function(){},n.computeSubpass=function(){},n.resolve=function(){},n.move=function(){},n.raytrace=function(){},n.compute=function(t){if(this.rg.getValid(this.passID)){Fht.devicePasses;var i=new nut;i.applyInfo(this.passID,t),this.currPass=new rut(i),this.currPass.preRecord(),this.currPass.record()}},n.copy=function(t){if(t.uploadPairs.length)for(var i,n=w(t.uploadPairs);!(i=n()).done;){var r=i.value,s=Fht.deviceBuffers,e=Fht.resourceGraph,h=e.vertex(r.target);tut.resName=r.target,e.visitVertex(tut,h);var u=s.get(r.target);Fht.device.commandBuffer.updateBuffer(u.buffer,r.source,r.source.byteLength)}},n.queue=function(t){if(this.rg.getValid(this.queueID)){var i;this.currPass instanceof iut?((i=Fht.pools.addDeviceQueue()).init(this.currPass,t,this.queueID),this.currQueue=i,this.currPass.addQueue(i)):((i=Fht.pools.addComputeQueue()).init(this.currPass,t,this.queueID),this.currQueue=i,this.currPass.addQueue(i));var n=this.rg.getLayout(this.queueID);if(n){var r=Fht.layoutGraph;if(this.currPass.renderLayout){var s=r.locateChild(this.currPass.renderLayout.layoutID,n);this.currQueue.layoutID=s}}this.currQueue.preRecord()}},n.scene=function(t){this.rg.getValid(this.sceneID)&&this.currQueue.setScene(this.sceneID,t).preRecord()},n.blit=function(t){this.rg.getValid(this.sceneID)&&this.currQueue.setScene(this.sceneID,void 0,t).preRecord()},n.dispatch=function(t){var i,n=null,r=this.currPass,s=null==(i=t.material)?void 0:i.passes[t.passID];null==s||s.update();var e=null==s?void 0:s.getShaderVariant();if(null!==s&&null!==e){var h=new aw(e,null==s?void 0:s.pipelineLayout);h.bindPoint=1,n=kw.gfxDevice.createPipelineState(h)}var u=Fht.commandBuffer;if(n){u.bindPipelineState(n);var o=r.renderLayout.descriptorSet;u.bindDescriptorSet(0,o)}var c=t.threadGroupCountX,a=t.threadGroupCountY,f=t.threadGroupCountZ;u.dispatch(new Xl(c,a,f))},i}(fut),lut=function(t){function i(){return t.call(this)||this}e(i,t);var n=i.prototype;return n.clear=function(){},n.viewport=function(){},n.rasterPass=function(t){var i=Fht.devicePasses,n=t.hashValue,r=i.get(n);r&&(this.currPass=r,Fht.passShowStatistics=t.showStatistics,this.currPass.record())},n.rasterSubpass=function(){},n.computeSubpass=function(){},n.resolve=function(){},n.compute=function(){},n.copy=function(){},n.move=function(){},n.raytrace=function(){},n.queue=function(){},n.scene=function(){},n.blit=function(){},n.dispatch=function(){},i}(fut),dut=function(t){function i(){var i;return(i=t.call(this)||this).JP=void 0,i.ZP=void 0,i.tL=void 0,i.iL=void 0,i.JP=new vut,i.ZP=new lut,i.tL=new drt(Fht.renderGraph),i.iL=new Lst(Fht.renderGraph.nv()),i}e(i,t);var n=i.prototype;return n.discoverVertex=function(t,i){var n=i.g;this.JP.applyID(t),n.visitVertex(this.JP,t)},n.finishVertex=function(t,i){i.g.visitVertex(this.ZP,t)},r(i,[{key:"graphView",get:function(){return this.tL}},{key:"colorMap",get:function(){return this.iL}}]),i}(lrt),wut=new Map,gut=function(){function t(t){this.queueID=4294967295,this.sceneID=4294967295,this.passID=4294967295,this.dispatchID=4294967295,this.resID=4294967295,this.context=void 0,this.nL=null,this.rL=void 0,this.context=t,this.rL=new _ut(this.context)}var i=t.prototype;return i._isRasterPass=function(t){return this.context.renderGraph.h(0,t)},i._isCopyPass=function(t){return this.context.renderGraph.h(5,t)},i._isCompute=function(t){return this.context.renderGraph.h(3,t)},i._isDispatch=function(t){return this.context.renderGraph.h(11,t)},i._isQueue=function(t){return this.context.renderGraph.h(8,t)},i._isShadowMap=function(t){var i=this._getSceneData(t);return!!i&&i.light&&!!i.light.light&&!!(8&i.flags)},i._getSceneData=function(t){return this.context.renderGraph.h(9,t)?this.context.renderGraph.j(t):null},i._isScene=function(t){return this.context.renderGraph.h(9,t)},i._isBlit=function(t){return this.context.renderGraph.h(10,t)},i.sL=function(t,i){var n=this.context.resourceContext,r=n.get(t),s=this.context.resourceGraph;if(r){var e=r.rasters;if(e.get(this.passID)===i)return;for(var h,u=r.computes,o=w(e);!(h=o()).done;){var c=h.value;c[0],c[1],this.passID}for(var a,f=w(u);!(a=f()).done&&!(a.value[0]>this.passID););e.set(this.passID,i)}else{var v=s.vertex(t);s.getTraits(v).residency;var l=new yut;n.set(t,l),l.rasters.set(this.passID,i)}},i.eL=function(){var t=this.context.renderGraph,i=this.context.resourceContext,n=this.resID,r=this.context.resourceGraph.vertexName(n);wut.clear();for(var s,e=this.nL,h=t.getValid(this.passID),u=w(e.rasterViews);!(s=u()).done;){var o=s.value,c=o[0],a=o[1];c!==r||0===a.accessType?2!==a.accessType&&wut.set(c,a):(this.sL(c,a),t.setValid(this.passID,!0),t.setValid(this.queueID,!0),t.setValid(this.sceneID,!0))}if(!h&&t.getValid(this.sceneID)){for(var f,v=w(e.rasterViews);!(f=v()).done;){var l=f.value,d=l[0];l[1],but.pipeline.resourceUses.push(d)}for(var g,p,_,y=w(wut);!(_=y()).done;){var m=_.value,b=m[0];m[1],4294967295!==(p=(g=this.context.resourceGraph).find(b))&&(this.rL.resID=p,g.visitVertex(this.rL,p))}for(var k,A=w(e.computeViews);!(k=A()).done;){var E=k.value,T=E[0],O=E[1],S=i.get(T);S||(S=new yut,i.set(T,S));var I=S.computes,R=I.get(this.passID);R?R.push(O):I.set(this.passID,[O]),4294967295!==(p=(g=this.context.resourceGraph).find(T))&&(this.rL.resID=p,g.visitVertex(this.rL,p))}fet(e)}},i.applyID=function(t,i){this.resID=i,this._isRasterPass(t)||this._isCopyPass(t)||this._isCompute(t)?this.passID=t:this._isQueue(t)?this.queueID=t:this._isScene(t)||this._isBlit(t)?this.sceneID=t:this._isDispatch(t)&&(this.dispatchID=t)},i.rasterPass=function(t){this.nL=t},i.rasterSubpass=function(){},i.computeSubpass=function(){},i.compute=function(t){this.nL=t,but.renderGraph.setValid(this.passID,!0)},i.resolve=function(){},i.copy=function(t){var i=but.renderGraph;if(!i.getValid(this.passID)){var n=this.context.resourceGraph;this.nL=t;for(var r,s,e=this.resID,h=n.vertexName(e),u=w(t.copyPairs);!(s=u()).done;){var o=s.value;o.target===h&&(i.setValid(this.passID,!0),4294967295!==(r=n.find(o.source))&&(this.rL.resID=r,n.visitVertex(this.rL,r)))}}},i.move=function(){},i.raytrace=function(){},i.queue=function(){},i.scene=function(){this.eL()},i.blit=function(){this.eL()},i.dispatch=function(){var t=this.context.renderGraph;t.setValid(this.queueID,!0),t.setValid(this.dispatchID,!0)},i.clear=function(){},i.viewport=function(){},t}(),put=function(t){function i(i,n){var r;return(r=t.call(this)||this).iL=void 0,r.tL=void 0,r.hL=void 0,r.uL=4294967295,r.uL=n,r.hL=new gut(i),r.tL=new drt(i.renderGraph),r.iL=new Lst(i.renderGraph.nv()),r}return e(i,t),i.prototype.discoverVertex=function(t,i){var n=i.g;this.hL.applyID(t,this.resId),n.visitVertex(this.hL,t)},r(i,[{key:"resId",get:function(){return this.uL},set:function(t){this.uL=t,this.iL.colors.length=but.renderGraph.nv()}},{key:"graphView",get:function(){return this.tL}},{key:"colorMap",get:function(){return this.iL}}]),i}(lrt),_ut=function(){function t(t){this.Gs=void 0,this.resID=4294967295,this.oL=void 0,this.Gs=t}var i=t.prototype;return i.managedBuffer=function(){},i.managedTexture=function(){},i.managed=function(){this.dependency()},i.persistentBuffer=function(){},i.dependency=function(){this.oL?this.oL.resId=this.resID:this.oL=new put(this.Gs,this.resID),vrt(this.oL.graphView,this.oL,this.oL.colorMap)},i.persistentTexture=function(){this.dependency()},i.framebuffer=function(){this.dependency()},i.swapchain=function(){this.dependency()},i.formatView=function(){},i.subresourceView=function(){},t}(),yut=function(){this.rasters=new Map,this.computes=new Map},mut=function(){function t(){this.resourceGraph=void 0,this.pipeline=void 0,this.renderGraph=void 0,this.layoutGraph=void 0,this.resourceContext=void 0}return t.prototype.set=function(t,i,n,r){this.pipeline=t,this.resourceGraph=i,this.renderGraph=n,this.layoutGraph=r,this.resourceContext||(this.resourceContext=new Map),this.resourceContext.clear()},t}(),but=new mut;!function(t){function i(i){var n;return(n=t.call(this)||this).iL=void 0,n.fL=void 0,n.rL=void 0,n.iL=new Lst(i.resourceGraph.nv()),n.fL=i.resourceGraph,n.rL=new _ut(i),n}e(i,t),i.prototype.discoverVertex=function(t){var i=this.fL.getTraits(t);0!==i.residency&&1!==i.residency&&(this.rL.resID=t,this.fL.visitVertex(this.rL,t))},r(i,[{key:"colorMap",get:function(){return this.iL}}])}(lrt);var kut,Aut,Eut=new $s,Tut=new Ql(1,1,0,2,2,2),Out=function(){function t(){var t=this;this.renderData=new qrt,this.layoutGraph=new mst,this.rg=new Jrt,this.vertId=-1,this.sceneData=new Xrt,this.resourceGraph=new xrt,this.computePass=new Grt,this.rasterPass=new Lrt,this.rasterSubpass=new Nrt,this.renderQueue=new Wrt,this.sceneBuilder=new Ge((function(){return new Cut(t.renderData,t.layoutGraph,t.rg,t.vertId,t.sceneData)}),16),this.renderPassBuilder=new Ge((function(){return new Lut(t.renderData,t.rg,t.layoutGraph,t.resourceGraph,t.vertId,t.rasterPass,t.getPipelineSceneData())}),16),this.computeQueueBuilder=new Ge((function(){return new Dut(t.renderData,t.rg,t.layoutGraph,t.vertId,t.renderQueue,t.getPipelineSceneData())}),16),this.renderQueueBuilder=new Ge((function(){return new Nut(t.renderData,t.rg,t.layoutGraph,t.vertId,t.renderQueue,t.getPipelineSceneData())}),16),this.renderSubpassBuilder=new Ge((function(){return new Put(t.renderData,t.rg,t.layoutGraph,t.vertId,t.rasterSubpass,t.getPipelineSceneData())}),16),this.computePassBuilder=new Ge((function(){return new But(t.renderData,t.rg,t.layoutGraph,t.resourceGraph,t.vertId,t.computePass,t.getPipelineSceneData())}),16),this.samplerInfo=new Ge((function(){return new Ql}),16),this.color=new Ge((function(){return new xl}),16),this.renderCommonObjectPool=new trt,this.renderGraphPool=new tst(this.renderCommonObjectPool),this.viewport=new Ge((function(){return new Ul}),16)}var i=t.prototype;return i.getPipelineSceneData=function(){return O.director.root.pipeline.pipelineSceneData},i.createColor=function(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var s=this.color.add();return s.set(t,i,n,r),s},i.createSamplerInfo=function(t,i,n,r,s,e,h,u){void 0===t&&(t=2),void 0===i&&(i=2),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===e&&(e=0),void 0===h&&(h=0),void 0===u&&(u=7);var o=this.samplerInfo.add();return o.minFilter=t,o.magFilter=i,o.mipFilter=n,o.addressU=r,o.addressV=s,o.addressW=e,o.maxAnisotropy=h,o.cmpFunc=u,o},i.reset=function(){this.sceneBuilder.reset(),this.renderPassBuilder.reset(),this.computePassBuilder.reset(),this.computeQueueBuilder.reset(),this.renderCommonObjectPool.reset(),this.renderGraphPool.reset(),this.viewport.reset(),this.samplerInfo.reset(),this.color.reset(),this.renderQueueBuilder.reset(),this.renderSubpassBuilder.reset()},t}();function Sut(t,i){switch(t){case 1:return i>1?4:0;case 2:return i>1?5:1;case 3:return 2;case 0:return 1}return 1}function Iut(t){switch(t){case 0:case 4:return 1;case 1:case 5:case 3:return 2;case 2:return 3}return 2}var Rut=new hA,Mut=new qrt,Cut=function(t){function i(i,n,r,s,e){var h;return(h=t.call(this,i,n)||this).vL=void 0,h.rf=void 0,h.vL=r,h.rf=e,h._vertID=s,h}e(i,t);var n=i.prototype;return n.update=function(t,i,n,r,s){this._data=t,this._lg=i,this.vL=n,this.rf=s,this._vertID=r},n.useLightFrustum=function(t,i,n){if(void 0===i&&(i=0),void 0===n&&(n=void 0),this.rf.light.light=t,this.rf.light.level=i,this.rf.light.culledByLight=!0,n&&(this.rf.camera=n),!(32768&this.rf.flags)){var r=this.vL.getParent(this._vertID),s=this.vL.getParent(r);this.vL.getLayout(s),Tet(this,this.rf.camera,t,i)}},i}(Ret),Nut=function(t){function i(i,n,r,s,e,h){var u;return(u=t.call(this,i,r)||this).vL=void 0,u.pn=void 0,u.Ll=void 0,u.vL=n,u._vertID=s,u.pn=e,u.Ll=h,u}e(i,t);var n=i.prototype;return n.update=function(t,i,n,r,s,e){this._data=t,this._lg=n,this.vL=i,this._vertID=r,this.pn=s,this.Ll=e},n.setArrayBuffer=function(){throw new Error("Method not implemented.")},n.addSceneOfCamera=function(t,i,n){void 0===n&&(n=0);var r=i.light;this.addScene(t,n,r)},n.addScene=function(t,i,n,r){void 0===i&&(i=0),void 0===n&&(n=null),void 0===r&&(r=void 0);var s=Aut.createSceneData(r||t.scene,t,i,!n||8&i?1:5,n),e=Aut.createRenderData(),h=this.vL.addVertex(9,s,"Scene","",e,!0,this._vertID);32768&i||(this.getParentLayout(),yet(this,t,this.Ll,r||t.scene),n&&0!==n.type?Tet(this,t,n,0):8&i||Iet(this,t));var u=this.vL.getParent(this._vertID);if(16&i){var o=this.vL.addVertex(8,this.pn,"UI Queue","default",this._data,!0,u);this.vL.addVertex(10,Aut.createBlit(Rut,this.vL.N,0,t,1),"UI","",Mut,!0,o)}1024&i&&this.addProfiler(t);var c=kut.sceneBuilder.add();return c.update(e,this._lg,this.vL,h,s),c},n.addFullscreenQuad=function(t,i,n,r){void 0===n&&(n=0),void 0===r&&(r="Quad"),this.vL.addVertex(10,Aut.createBlit(t,i,n,null),r,"",Aut.createRenderData(),!0,this._vertID),this.getParentLayout();var s=T.director.getScene();yet(this,null,this.Ll,s?s.renderScene:null),8&n||Iet(this,null)},n.addCameraQuad=function(t,i,n,r){void 0===r&&(r=0),this.vL.addVertex(10,Aut.createBlit(i,n,r,t),"CameraQuad","",Aut.createRenderData(),!0,this._vertID),this.getParentLayout();var s=T.director.getScene();yet(this,t,this.Ll,t.scene||(s?s.renderScene:null)),8&r||Iet(this,t)},n.addDraw3D=function(t,i,n){void 0===n&&(n=32768);for(var r,s=Aut.createBlit(Rut,this.vL.N,0,t,3),e=w(i);!(r=e()).done;){var h=r.value;s.models.push(h)}this.vL.addVertex(10,s,"Draw3D","",Aut.createRenderData(),!0,this._vertID),32768&n||(this.getParentLayout(),yet(this,t,this.Ll,t.scene),8&n||Iet(this,t))},n.addDraw2D=function(t){this.getParentLayout(),yet(this,t,this.Ll,t.scene),this.vL.addVertex(10,Aut.createBlit(Rut,this.vL.N,0,t,1),"Draw2D","",Mut,!0,this._vertID)},n.addProfiler=function(t){var i=this.vL.getParent(this._vertID),n=this.vL.addVertex(8,this.pn,"UI Queue","default",this._data,!0,i),r=this.vL.addVertex(10,Aut.createBlit(Rut,this.vL.N,0,t,2),"Profiler","",Mut,!0,n),s=this.vL.getData(r);Ret.setMat4(this._lg,s,"cc_matProj",t.matProj)},n.clearRenderTarget=function(t,i){void 0===i&&(i=new xl);var n=Aut.createClearView(t,1);n.clearColor.copy(i),this.vL.addVertex(12,[n],"ClearRenderTarget","",Aut.createRenderData(),!0,this._vertID)},n.setViewport=function(t){var i=kut.viewport.add();this.pn.viewport=i.copy(t)},n.addCustomCommand=function(){throw new Error("Method not implemented.")},r(i,[{key:"name",get:function(){return this.vL.getName(this._vertID)},set:function(t){this.vL.setName(this._vertID,t)}}]),i}(Ret),Put=function(t){function i(i,n,r,s,e,h){var u;(u=t.call(this,i,r)||this).vL=void 0,u.TP=void 0,u.lL=void 0,u.Ll=void 0,u.vL=n,u._vertID=s,u.lL=e,u.Ll=h;var o=u.vL.getLayout(u._vertID);return u.TP=r.locateChild(r.N,o),u}e(i,t);var n=i.prototype;return n.update=function(t,i,n,r,s,e){this._data=t,this._lg=n,this.vL=i,this._vertID=r,this.lL=s,this.Ll=e;var h=this.vL.getLayout(this._vertID);this.TP=n.locateChild(n.N,h)},n.addRenderTarget=function(){throw new Error("Method not implemented.")},n.setCustomShaderStages=function(){throw new Error("Method not implemented.")},n.setArrayBuffer=function(){throw new Error("Method not implemented.")},n.addDepthStencil=function(){throw new Error("Method not implemented.")},n.addTexture=function(){throw new Error("Method not implemented.")},n.addStorageBuffer=function(){throw new Error("Method not implemented.")},n.addStorageImage=function(){throw new Error("Method not implemented.")},n.setViewport=function(){throw new Error("Method not implemented.")},n.addQueue=function(t,i){void 0===t&&(t=1),void 0===i&&(i="default");var n=this._lg.locateChild(this.TP,i),r=Aut.createRenderQueue(t,n),s=Aut.createRenderData(),e=this.vL.addVertex(8,r,"",i,s,!0,this._vertID),h=kut.renderQueueBuilder.add();return h.update(s,this.vL,this._lg,e,r,this.Ll),h},r(i,[{key:"name",get:function(){return this.vL.getName(this._vertID)},set:function(t){this.vL.setName(this._vertID,t)}},{key:"showStatistics",get:function(){return this.lL.showStatistics},set:function(t){this.lL.showStatistics=t}}]),i}(Ret),Lut=function(t){function i(i,n,r,s,e,h,u){var o;(o=t.call(this,i,r)||this).vL=void 0,o.TP=void 0,o.dL=void 0,o.Ll=void 0,o.fL=void 0,o.vL=n,o.fL=s,o._vertID=e,o.dL=h,o.Ll=u;var c=o.vL.getLayout(o._vertID);return o.TP=r.locateChild(r.N,c),o}e(i,t);var n=i.prototype;return n.update=function(t,i,n,r,s,e,h){this.vL=i,this._lg=n,this.fL=r,this._vertID=s,this.dL=e,this.Ll=h,this._data=t;var u=this.vL.getLayout(this._vertID);this.TP=n.locateChild(n.N,u)},n.setCustomShaderStages=function(){throw new Error("Method not implemented.")},n.setArrayBuffer=function(){throw new Error("Method not implemented.")},n.setVersion=function(t,i){this.dL.versionName=t,this.dL.version=i},n.addRenderTarget=function(t,i,n,r){void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=new xl);var s=1;0===i&&(s=0);var e=Aut.createRasterView("",2,0,i,n,s);e.clearColor.copy(r),this.dL.rasterViews.set(t,e)},n.addDepthStencil=function(t,i,n,r,s,e){void 0===i&&(i=1),void 0===n&&(n=0),void 0===r&&(r=1),void 0===s&&(s=0),void 0===e&&(e=6);var h=Aut.createRasterView("",2,1,i,n,e);h.clearColor.set(r,s,0,0),this.dL.rasterViews.set(t,h)},n.resolveRenderTarget=function(){},n.resolveDepthStencil=function(){},n.wL=function(t,i,n){var r,s=Aut.createComputeView(n);s.accessType=i,this.dL.computeViews.has(t)?null==(r=this.dL.computeViews.get(t))||r.push(s):this.dL.computeViews.set(t,[s])},n.addTexture=function(t,i,n){if(void 0===n&&(n=null),this.wL(t,0,i),n){var r=this._lg.attributeIndex.get(i);this._data.samplers.set(r,n)}},n.addStorageBuffer=function(t,i,n){this.wL(t,i,n)},n.addStorageImage=function(t,i,n){this.wL(t,i,n)},n.addRenderSubpass=function(t){void 0===t&&(t="");var i="Raster",n=this.dL.subpassGraph.nv();this.dL.subpassGraph.addVertex(i,Aut.createSubpass());var r=Aut.createRasterSubpass(n,1,0),s=Aut.createRenderData(),e=this.vL.addVertex(1,r,i,t,s,!0),h=kut.renderSubpassBuilder.add();return h.update(s,this.vL,this._lg,e,r,this.Ll),h},n.addQueue=function(t,i){void 0===t&&(t=1),void 0===i&&(i="default");var n=this._lg.locateChild(this.TP,i),r=Aut.createRenderQueue(t,n),s=Aut.createRenderData(),e=this.vL.addVertex(8,r,"",i,s,!0,this._vertID),h=kut.renderQueueBuilder.add();return h.update(s,this.vL,this._lg,e,r,this.Ll),h},n.addFullscreenQuad=function(t,i,n,r){void 0===n&&(n=0),void 0===r&&(r="FullscreenQuad");var s=Aut.createRenderQueue(3),e=this.vL.addVertex(8,s,"Queue","",Aut.createRenderData(),!0,this._vertID);this.vL.addVertex(10,Aut.createBlit(t,i,n,null),r,"",Aut.createRenderData(),!0,e)},n.addCameraQuad=function(t,i,n,r,s){void 0===s&&(s="CameraQuad");var e=Aut.createRenderQueue(3),h=this.vL.addVertex(8,e,"Queue","",Aut.createRenderData(),!0,this._vertID);this.vL.addVertex(10,Aut.createBlit(i,n,r,t),s,"",Aut.createRenderData(),!0,h)},n.setViewport=function(t){this.dL.viewport.copy(t)},r(i,[{key:"name",get:function(){return this.vL.getName(this._vertID)},set:function(t){this.vL.setName(this._vertID,t)}},{key:"showStatistics",get:function(){return this.dL.showStatistics},set:function(t){this.dL.showStatistics=t}}]),i}(Ret),Dut=function(t){function i(i,n,r,s,e,h){var u;return(u=t.call(this,i,r)||this).vL=void 0,u.pn=void 0,u.Ll=void 0,u.vL=n,u._vertID=s,u.pn=e,u.Ll=h,u}e(i,t);var n=i.prototype;return n.update=function(t,i,n,r,s,e){this._data=t,this._lg=n,this.vL=i,this._vertID=r,this.pn=s,this.Ll=e},n.setArrayBuffer=function(){throw new Error("Method not implemented.")},n.addDispatch=function(t,i,n,r,s,e){void 0===r&&(r=null),void 0===s&&(s=0),void 0===e&&(e="Dispatch"),this.vL.addVertex(11,Aut.createDispatch(r,s,t,i,n),e,"",Aut.createRenderData(),!0,this._vertID)},r(i,[{key:"name",get:function(){return this.vL.getName(this._vertID)},set:function(t){this.vL.setName(this._vertID,t)}}]),i}(Ret),But=function(t){function i(i,n,r,s,e,h,u){var o;(o=t.call(this,i,r)||this).vL=void 0,o.fL=void 0,o.TP=void 0,o.dL=void 0,o.Ll=void 0,o.vL=n,o.fL=s,o._vertID=e,o.dL=h,o.Ll=u;var c=o.vL.getLayout(o._vertID);return o.TP=r.locateChild(r.N,c),o}e(i,t);var n=i.prototype;return n.update=function(t,i,n,r,s,e,h){this._data=t,this.vL=i,this._lg=n,this.fL=r,this._vertID=s,this.dL=e,this.Ll=h;var u=this.vL.getLayout(this._vertID);this.TP=n.locateChild(n.N,u)},n.setCustomShaderStages=function(){throw new Error("Method not implemented.")},n.setArrayBuffer=function(){throw new Error("Method not implemented.")},n.addTexture=function(){throw new Error("Method not implemented.")},n.addStorageBuffer=function(t,i,n){this.wL(t,i,n)},n.addStorageImage=function(t,i,n){this.wL(t,i,n)},n.addMaterialTexture=function(){throw new Error("Method not implemented.")},n.addQueue=function(t){void 0===t&&(t="default");var i=this._lg.locateChild(this.TP,t),n=Aut.createRenderQueue(1,i),r=Aut.createRenderData(),s=this.vL.addVertex(8,n,"",t,r,!0,this._vertID),e=kut.computeQueueBuilder.add();return e.update(r,this.vL,this._lg,s,n,this.Ll),e},n.wL=function(t,i,n){var r,s=Aut.createComputeView(n);s.accessType=i,this.dL.computeViews.has(t)?null==(r=this.dL.computeViews.get(t))||r.push(s):this.dL.computeViews.set(t,[s])},r(i,[{key:"name",get:function(){return this.vL.getName(this._vertID)},set:function(t){this.vL.setName(this._vertID,t)}}]),i}(Ret);!function(){function t(t,i,n){this.vL=void 0,this.gL=void 0,this.dL=void 0,this.vL=t,this.gL=i,this.dL=n}var i=t.prototype;i.setCustomBehavior=function(){throw new Error("Method not implemented.")},i.addPair=function(t){this.dL.movePairs.push(t)},r(t,[{key:"name",get:function(){return this.vL.getName(this.gL)},set:function(t){this.vL.setName(this.gL,t)}}])}(),function(){function t(t,i,n){this.vL=void 0,this.gL=void 0,this.dL=void 0,this.vL=t,this.gL=i,this.dL=n}var i=t.prototype;i.addPair=function(){throw new Error("Method not implemented.")},i.setCustomBehavior=function(){throw new Error("Method not implemented.")},r(t,[{key:"name",get:function(){return this.vL.getName(this.gL)},set:function(t){this.vL.setName(this.gL,t)}}])}();var Fut=function(t){function i(i){var n;return(n=t.call(this,new qrt,i)||this).globalDSManager=void 0,n.descriptorSetLayout=void 0,n.descriptorSet=void 0,n.Xn=0,n.Yn=0,n.pL=!1,n._L=new hA,n.Rh=void 0,n.yL=void 0,n.mL=null,n.kL={},n.AL=new zR,n.EL="",n.TL=1,n.OL=null,n.ul=[],n.SL=[],n.fL=new xrt,n.vL=null,n.IL=null,n.RL=null,n.ML="",n.CL=void 0,n.NL=0,n.vL=new Jrt,n._data=n.vL.globalRenderData,n}e(i,t);var n=i.prototype;return n.addCustomBuffer=function(){throw new Error("Method not implemented.")},n.addCustomTexture=function(){throw new Error("Method not implemented.")},n.tryAddRenderWindowDepthStencil=function(t,i,n,r){n&&(r?this.addDepthStencilImpl(n,r.depthStencilTexture.format,t,i,4,r):this.addDepthStencilImpl(n,55,t,i,0))},n.addRenderWindow=function(t,i,n,r,s,e){var h=this.fL.find(t);if(4294967295!==h)return this.updateRenderWindow(t,s,e),h;this.tryAddRenderWindowDepthStencil(n,r,e,s.swapchain);var u=new mrt;return u.dimension=2,u.width=n,u.height=r,u.depthOrArraySize=1,u.mipLevels=1,u.format=s.framebuffer.colorTextures[0].format,u.flags=16,s.swapchain?this.fL.addVertex(6,new krt(s.swapchain),t,u,new brt(4),new Art,new Ql):(u.sampleCount=s.framebuffer.colorTextures[0].info.samples,this.fL.addVertex(5,s.framebuffer,t,u,new brt(3),new Art,new Ql))},n.updateRenderWindow=function(t,i,n){var r=this.resourceGraph.vertex(t),s=this.resourceGraph.getDesc(r);s.width=i.width,s.height=i.height,this.resourceGraph.object(r)!==i.framebuffer&&(this.resourceGraph.x[r].j=i.framebuffer),this.tryAddRenderWindowDepthStencil(i.width,i.height,n,i.swapchain)},n.updateStorageBuffer=function(t,i,n){void 0===n&&(n=0);var r=this.resourceGraph.vertex(t),s=this.resourceGraph.getDesc(r);s.width=i,0!==n&&(s.format=n)},n.updateRenderTarget=function(t,i,n,r){void 0===r&&(r=0);var s=this.resourceGraph.vertex(t),e=this.resourceGraph.getDesc(s);e.width=i,e.height=n,0!==r&&(e.format=r)},n.updateDepthStencil=function(t,i,n,r){void 0===r&&(r=0);var s=this.resourceGraph.find(t);4294967295!==s&&this.updateDepthStencilImpl(s,i,n,r)},n.updateStorageTexture=function(t,i,n,r){void 0===r&&(r=0);var s=this.resourceGraph.vertex(t),e=this.resourceGraph.getDesc(s);e.width=i,e.height=n,0!==r&&(e.format=r)},n.updateShadingRateTexture=function(t,i,n){var r=this.resourceGraph.vertex(t),s=this.resourceGraph.getDesc(r);s.width=i,s.height=n},n.addBuffer=function(t,i,n,r){var s=this.fL.find(t);if(4294967295!==s)return this.updateBuffer(t,i),s;var e=new mrt;return e.dimension=0,e.width=i,e.flags=n,this.fL.addVertex(0,new Irt,t,e,new brt(r),new Art,new Ql(2,2,0,2,2,2))},n.updateBuffer=function(t,i){this.updateResource(t,0,i,0,0,0,0,1)},n.addExternalTexture=function(){throw new Error("Method not implemented.")},n.updateExternalTexture=function(){throw new Error("Method not implemented.")},n.addTexture=function(t,i,n,r,s,e,h,u,o,c,a){var f=this.fL.find(t);if(4294967295!==f)return this.updateTexture(t,n,r,s,e,h,u,o),f;var v=new mrt;return v.dimension=Iut(i),v.width=r,v.height=s,v.depthOrArraySize=3===v.dimension?e:h,v.mipLevels=u,v.format=n,v.sampleCount=o,v.flags=c,v.viewType=i,this.fL.addVertex(0,new Irt,t,v,new brt(a),new Art,new Ql(2,2,0,2,2,2))},n.updateTexture=function(t,i,n,r,s,e,h,u){this.updateResource(t,i,n,r,s,e,h,u)},n.addResource=function(t,i,n,r,s,e,h,u,o,c,a){var f=this.fL.find(t);return 4294967295!==f?(this.updateResource(t,n,r,s,e,h,u,o),f):0===i?this.addBuffer(t,r,c,a):this.addTexture(t,Sut(i,h),n,r,s,e,h,u,o,c,a)},n.updateResource=function(t,i,n,r,s,e,h,u){var o=this.resourceGraph.vertex(t),c=this.resourceGraph.getDesc(o);c.width=n,c.height=r,c.depthOrArraySize=3===c.dimension?s:e,c.mipLevels=h,0!==i&&(c.format=i),c.sampleCount=u},n.containsResource=function(t){return this.fL.contains(t)},n.addResolvePass=function(){throw new Error("Method not implemented.")},n.addComputePass=function(t){var i=Aut.createComputePass(),n=Aut.createRenderData(),r=this.vL.addVertex(3,i,"Compute",t,n,!0),s=kut.computePassBuilder.add();return s.update(n,this.vL,this._lg,this.fL,r,i,this.AL),T.director.root.pipeline,s},n.addUploadPass=function(t){for(var i,n=Aut.createCopyPass(),r=w(t);!(i=r()).done;){var s=i.value;n.uploadPairs.push(s)}this.vL.addVertex(5,n,"UploadPass","",Aut.createRenderData(),!0)},n.addCopyPass=function(t){for(var i,n=w(t);!(i=n()).done;){var r=i.value,s=r.target,e=this.resourceGraph.find(s),h=this.resourceGraph.getDesc(e),u=this.addRenderPass(h.width,h.height,"copy-pass");u.addRenderTarget(s,1,0,kut.createColor()),u.setFloat("flip",this.getCombineSignY()),u.addTexture(r.source,"outputResultMap"),u.addQueue(0).addFullscreenQuad(this._L,0,0)}},n._generateConstantMacros=function(){var t="";t+="#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE "+(3&this.Rh.getFormatFeatures(44)?1:0)+"\n",t+="#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS "+this.Rh.capabilities.maxVertexUniformVectors+"\n",t+="#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS "+this.Rh.capabilities.maxFragmentUniformVectors+"\n",t+="#define CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT "+(this.Rh.hasFeature(5)?1:0)+"\n",t+="#define CC_PLATFORM_ANDROID_AND_WEBGL "+(wh.os===ch.ANDROID&&wh.isBrowser?1:0)+"\n",t+="#define CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES "+(Si.ENABLE_WEBGL_HIGHP_STRUCT_VALUES?1:0)+"\n",t+="#define CC_JOINT_UNIFORM_CAPACITY "+uy.JOINT_UNIFORM_CAPACITY+"\n",this.EL=t,this._lg.constantMacros=this.EL},n.setCustomPipelineName=function(t){this.ML=t,"Deferred"===this.ML&&(this.pL=!0)},n.getGlobalDescriptorSetData=function(){var t=this.layoutGraph.locateChild(this.layoutGraph.N,"default");return this.layoutGraph.getLayout(t).getSet(3)},n.PL=function(){var t=this.Rh;this.NL=.5*t.capabilities.screenSpaceSignY+.5<<1|.5*t.capabilities.clipSpaceSignY+.5},n.getCombineSignY=function(){return this.NL},n.LL=function(){this._L.initialize({effectName:"pipeline/copy-pass"});for(var t=0;t<this._L.passes.length;++t)this._L.passes[t].tryCompile()},n.activate=function(){this.Rh=kw.gfxDevice,kut=new Out,Aut=kut.renderGraphPool,qet(this.Rh,this._lg),this.LL(),this.setMacroBool("CC_USE_HDR",this.AL.isHDR),this.setMacroBool("CC_USE_FLOAT_OUTPUT",Si.ENABLE_FLOAT_OUTPUT&&tm(this.Rh)),this._generateConstantMacros(!1),this.AL.activate(this.Rh),this.PL();var t=Zy(this.Rh)?0:1;this.setMacroInt("CC_SHADOWMAP_FORMAT",t);var n=6===this.Rh.gfxAPI?1:0;this.setMacroInt("CC_SHADOWMAP_USE_LINEAR_DEPTH",n);var r=T.director.root;return this.yL=r.device.getSampler(Tut),this.pipelineSceneData.csmSupported=this.device.capabilities.maxFragmentUniformVectors>=i.CSM_UNIFORM_VECTORS+i.GLOBAL_UNIFORM_VECTORS,this.setMacroBool("CC_SUPPORT_CASCADED_SHADOW_MAP",this.pipelineSceneData.csmSupported),this.setMacroInt("CC_SHADOW_TYPE",0),this.setMacroInt("CC_DIR_SHADOW_PCF_TYPE",kA.HARD),this.setMacroInt("CC_DIR_LIGHT_SHADOW_TYPE",0),this.setMacroBool("CC_CASCADED_LAYERS_TRANSITION",!1),this.usesDeferredPipeline&&this.setMacroInt("CC_PIPELINE_TYPE",1),!0},n.destroy=function(){var t;return null==(t=this.AL)||t.destroy(),!0},n.getMacroString=function(t){var i=this.kL[t];return void 0===i?"":i},n.getMacroInt=function(t){var i=this.kL[t];return void 0===i?0:i},n.getMacroBool=function(t){var i=this.kL[t];return void 0!==i&&i},n.getSamplerInfo=function(t){if(this.containsResource(t)){var i=this.fL.vertex(t);return this.fL.getSampler(i)}return null},n.setMacroString=function(t,i){this.kL[t]=i},n.setMacroInt=function(t,i){this.kL[t]=i},n.setMacroBool=function(t,i){this.kL[t]=i},n.onGlobalPipelineStateChanged=function(){var t=T.rendering.getCustomPipeline(Si.CUSTOM_PIPELINE_NAME);t&&("function"==typeof t.onGlobalPipelineStateChanged&&t.onGlobalPipelineStateChanged(),T.rendering.forceResizeAllWindows())},n.beginSetup=function(){this.vL||(this.vL=new Jrt,this._data=this.vL.globalRenderData),kut.reset()},n.endSetup=function(){this.compile()},n.addStorageBuffer=function(t,i,n,r){void 0===r&&(r=0);var s=this.fL.find(t);if(4294967295!==s)return this.updateStorageBuffer(t,n,i),s;var e=new mrt;return e.dimension=0,e.width=n,e.height=1,e.depthOrArraySize=1,e.mipLevels=1,e.format=i,e.flags=4,2===r?this.fL.addVertex(3,new Trt,t,e,new brt(2),new Art,new Ql):this.fL.addVertex(1,new Ert,t,e,new brt(r),new Art,new Ql)},n.addRenderTarget=function(t,i,n,r,s){void 0===s&&(s=0);var e=this.fL.find(t);if(4294967295!==e)return this.updateRenderTarget(t,n,r,i),e;var h=new mrt;return h.dimension=2,h.width=n,h.height=r,h.depthOrArraySize=1,h.mipLevels=1,h.format=i,h.sampleCount=1,h.flags=24,this.fL.addVertex(0,new Irt,t,h,new brt(s),new Art,new Ql(2,2,0,2,2,2))},n.updateDepthStencilImpl=function(t,i,n,r,s){var e=this.resourceGraph.getDesc(t);if(e.width=i,e.height=n,s){var h=this.resourceGraph.j(t);h.swapchain=s,e.format=h.swapchain.depthStencilTexture.format}else 0!==r&&(e.format=r)},n.addDepthStencilImpl=function(t,i,n,r,s,e){var h=this.fL.find(t);if(4294967295!==h)return this.updateDepthStencilImpl(h,n,r,i,e),h;var u=new mrt;return u.dimension=2,u.width=n,u.height=r,u.depthOrArraySize=1,u.mipLevels=1,u.format=i,u.sampleCount=1,u.flags=40,e?this.fL.addVertex(6,new krt(e,!0),t,u,new brt(s),new Art,new Ql(1,1,0)):this.fL.addVertex(0,new Irt,t,u,new brt(s),new Art,new Ql(1,1,0))},n.addDepthStencil=function(t,i,n,r,s){return void 0===s&&(s=0),this.addDepthStencilImpl(t,i,n,r,s)},n.addStorageTexture=function(t,i,n,r,s){void 0===s&&(s=0);var e=this.fL.find(t);if(4294967295!==e)return this.updateStorageTexture(t,n,r,i),e;var h=new mrt;return h.dimension=2,h.width=n,h.height=r,h.depthOrArraySize=1,h.mipLevels=1,h.format=i,h.flags=12,this.fL.addVertex(0,new Irt,t,h,new brt(s),new Art,new Ql(1,1,0))},n.addShadingRateTexture=function(t,i,n,r){void 0===r&&(r=0);var s=this.fL.find(t);if(4294967295!==s)return this.addShadingRateTexture(t,i,n),s;var e=new mrt;return e.dimension=2,e.width=i,e.height=n,e.depthOrArraySize=1,e.mipLevels=1,e.format=6,e.flags=140,this.fL.addVertex(0,new Irt,t,e,new brt(r),new Art,new Ql(2,2,0,2,2,2))},n.beginFrame=function(){T.director.buildRenderPipeline()},n.update=function(){},n.endFrame=function(){var t;null==(t=this.renderGraph)||t.clear()},n.compile=function(){if(!this.vL)throw new Error("RenderGraph cannot be built without being created");this.vL.x.forEach((function(t){0===t.t&&fet(t.j)}))},n.execute=function(){if(!this.vL)throw new Error("Cannot run without creating rendergraph");this.RL||(this.RL=new aut(this,this.Rh,this.fL,this.layoutGraph,this.width,this.height)),this.RL.resize(this.width,this.height),this.RL.execute(this.vL)},n._applySize=function(t){var i=this,n=this.Xn,r=this.Yn;t.forEach((function(t){var s=t.window;n=Math.max(s.width,n),r=Math.max(s.height,r),i.ul.includes(t)||i.ul.push(t)})),n===this.Xn&&r===this.Yn||(this.Xn=n,this.Yn=r)},n.render=function(t){0!==t.length&&(this._applySize(t),sA(t),this.beginFrame(),this.execute(),this.endFrame())},n.addBuiltinReflectionProbePass=function(t){var i=T.internal.reflectionProbeManager;if(i){var n=i.getProbes();if(0!==n.length)for(var r=0;r<n.length;r++){var s=n[r];s.needRender&&1===n[r].probeType&&Ust(t,this,s,s.realtimePlanarTexture.window,0)}}},n.addRenderPassImpl=function(t,i,n,r,s){void 0===r&&(r=1),void 0===s&&(s=0);var e=Aut.createRasterPass();e.viewport.width=t,e.viewport.height=i,e.count=r,e.quality=s;var h=Aut.createRenderData(),u=this.vL.addVertex(0,e,"Raster",n,h,!0),o=kut.renderPassBuilder.add();return o.update(h,this.vL,this._lg,this.fL,u,e,this.AL),this._updateRasterPassConstants(o,t,i,n),_et(o,this.AL),o},n.addRenderPass=function(t,i,n){return void 0===n&&(n="default"),this.addRenderPassImpl(t,i,n)},n.addMultisampleRenderPass=function(t,i,n,r,s){return void 0===s&&(s="default"),this.addRenderPassImpl(t,i,s,n,r)},n.getDescriptorSetLayout=function(t,i){var n=this._lg,r=n.shaderLayoutIndex.get(t);return n.getLayout(r).getSet(i).descriptorSetLayout},n._updateRasterPassConstants=function(t,i,n){var r=T.director,s=r.root,e=i,h=n;s.pipeline.layoutGraph,Eut.set(s.cumulativeTime,s.frameTime,r.getTotalFrames()),t.setVec4("cc_time",Eut),Eut.set(e,h,1/e,1/h),t.setVec4("cc_screenSize",Eut),Eut.set(e,h,1/e,1/h),t.setVec4("cc_nativeSize",Eut);var u=s.debugView;if(Eut.set(0,0,0,0),u){for(var o=[u.singleMode,0,0,0],c=0;c<17;c++){var a=c%8;o[1+(c>>3)]+=(u.isCompositeModeEnabled(c)?1:0)*Math.pow(10,a)}o[3]+=(u.lightingWithAlbedo?1:0)*Math.pow(10,6),o[3]+=(u.csmLayerColoration?1:0)*Math.pow(10,7),Eut.set(o[0],o[1],o[2],o[3])}t.setVec4("cc_debug_view_mode",Eut)},r(i,[{key:"type",get:function(){return 0}},{key:"capabilities",get:function(){return new ist}},{key:"enableCpuLightCulling",get:function(){return!this.RL||this.RL._context.culling.enableLightCulling},set:function(t){this.RL&&(this.RL._context.culling.enableLightCulling=t)}},{key:"name",get:function(){return"WebPipeline"}},{key:"globalDescriptorSetData",get:function(){return this.CL}},{key:"defaultSampler",get:function(){return this.yL}},{key:"defaultShadowTexture",get:function(){return Jy(this.device)}},{key:"device",get:function(){return this.Rh}},{key:"lightingMode",get:function(){return this.TL},set:function(t){this.TL=t}},{key:"usesDeferredPipeline",get:function(){return this.pL}},{key:"macros",get:function(){return this.kL}},{key:"profilerDescriptorSet",get:function(){return this.mL}},{key:"commandBuffers",get:function(){return[this.Rh.commandBuffer]}},{key:"pipelineSceneData",get:function(){return this.AL}},{key:"constantMacros",get:function(){return this.EL}},{key:"profiler",get:function(){return this.OL},set:function(t){this.OL=t}},{key:"geometryRenderer",get:function(){throw new Error("Method not implemented.")}},{key:"shadingScale",get:function(){return this.AL.shadingScale},set:function(t){this.AL.shadingScale=t}},{key:"width",get:function(){return this.Xn}},{key:"height",get:function(){return this.Yn}},{key:"renderGraph",get:function(){return this.vL}},{key:"resourceGraph",get:function(){return this.fL}},{key:"layoutGraph",get:function(){return this._lg}},{key:"resourceUses",get:function(){return this.SL}}]),i}(Ret);Fut.MAX_BLOOM_FILTER_PASS_NUM=6,Fut.CSM_UNIFORM_VECTORS=61,Fut.GLOBAL_UNIFORM_VECTORS=64,function(){function t(){this.capacity=0,this.size=0,this.buffer=void 0,this.dataView=void 0,this.capacity=4096,this.buffer=new Uint8Array(this.capacity),this.dataView=new DataView(this.buffer.buffer)}var i=t.prototype;i.b=function(t){var i=this.size+1;i>this.capacity&&this.reserve(i),this.dataView.setUint8(this.size,t?1:0),this.size=i},i.n=function(t){var i=this.size+8;i>this.capacity&&this.reserve(i),this.dataView.setFloat64(this.size,t,!0),this.size=i},i.s=function(t){this.n(t.length);var i=this.size+t.length;i>this.capacity&&this.reserve(i);for(var n=0;n<t.length;n++)this.dataView.setUint8(this.size+n,t.charCodeAt(n));this.size=i},i.reserve=function(t){var i=Math.max(t,2*this.capacity),n=this.buffer;this.buffer=new Uint8Array(i),this.buffer.set(n),this.dataView=new DataView(this.buffer.buffer),this.capacity=i},r(t,[{key:"data",get:function(){return this.buffer.buffer.slice(0,this.size)}}])}();var Uut=function(){function t(t,i){this.offset=0,this.dataView=void 0,this.dataView=new DataView(t,i)}var i=t.prototype;return i.b=function(){return 0!==this.dataView.getUint8(this.offset++)},i.n=function(){var t=this.dataView.getFloat64(this.offset,!0);return this.offset+=8,t},i.s=function(){var t=this.n(),i=String.fromCharCode.apply(null,Array.from(new Uint8Array(this.dataView.buffer,this.offset,t)));return this.offset+=t,i},t}(),xut=function(t,i,n,r,s){this.programInfo=t,this.shaderInfo=i,this.attributes=n,this.blockSizes=r,this.handleMap=s},Gut=function(){this.programInfos=new Map,this.programProxies=new Map},jut=[2,1,3,0];function Hut(t,i){var n=s({},i);return n.effectName=t,Mm(n),n}function Vut(t,i){for(var n,r=w(t.blocks);!(n=r()).done;){var s=n.value;if(s.name===i)return{set:s.set,binding:s.binding}}for(var e,h=w(t.buffers);!(e=h()).done;){var u=e.value;if(u.name===i)return{set:u.set,binding:u.binding}}for(var o,c=w(t.samplerTextures);!(o=c()).done;){var a=o.value;if(a.name===i)return{set:a.set,binding:a.binding}}for(var f,v=w(t.samplers);!(f=v()).done;){var l=f.value;if(l.name===i)return{set:l.set,binding:l.binding}}for(var d,g=w(t.textures);!(d=g()).done;){var p=d.value;if(p.name===i)return{set:p.set,binding:p.binding}}for(var _,y=w(t.images);!(_=y()).done;){var m=_.value;if(m.name===i)return{set:m.set,binding:m.binding}}for(var b,k=w(t.subpassInputs);!(b=k()).done;){var A=b.value;if(A.name===i)return{set:A.set,binding:A.binding}}throw X("binding not found in shaderInfo!")}function $ut(t,i){for(var n=i,r=/layout\s*\(([^)])+\)\s+uniform\s+(\b\w+\b\s+)?sampler(\w+)\s+(\b\w+\b)/g,s=r.exec(n);s;){var e=Vut(t,s[4]),h="layout(set = "+e.set+", binding = "+e.binding+") uniform "+(s[2]?s[2]:"")+" sampler"+s[3]+" "+s[4];n=n.replace(s[0],h),s=r.exec(n)}for(var u=/layout\s*\(([^)]+)\)\s*(readonly|writeonly)?\s*\b((uniform\s*|buffer\s*|image2D\s*){1,2})\b\s*(\b\w+\b)\s*[{;]/g,o=u.exec(n);o;){var c=Vut(t,o[5]),a=c.set,f=c.binding,v=o[2]?o[2]:"",l=" {";o[3].includes("image")&&(l=";");var d=o[1],w="layout("+(d=(d=d.replace(/set\s*=\s*\d+/g,"set = "+a)).replace(/binding\s*=\s*\d+/g,"binding = "+f))+") "+v+" "+o[3]+" "+o[5]+l;n=n.replace(o[0],w),o=u.exec(n)}return n}function zut(t,i){"glsl4"===Bm(kw.gfxDevice)&&(i.glsl4.vert&&(i.glsl4.vert=$ut(t,i.glsl4.vert)),i.glsl4.frag&&(i.glsl4.frag=$ut(t,i.glsl4.frag)),i.glsl4.compute&&(i.glsl4.compute=$ut(t,i.glsl4.compute)))}function Wut(t,i){zut(t,i);for(var n,r=jut[1],s=w(i.blocks);!(n=s()).done;){for(var e,h=n.value,u=!1,o=w(t.blocks);!(e=o()).done;){var c=e.value;if(c.set===r&&c.name===h.name){h.binding=c.binding,u=!0;break}}u||X("Block "+h.name+" not found in shader "+t.name)}}function Xut(t,i,n,r,s){for(var e,h=w(t.descriptorBlocks);!(e=h()).done;){var u=e.value,o=u.visibility,c=u.offset;switch(u.type){case 0:for(var a,f=w(i.blocks);!(a=f()).done;){var v=a.value;v.stageFlags===o&&(s.push(Sm(v.members)),r.blocks.push(new Zl(n,c,v.name,v.members.map((function(t){return new Jl(t.name,t.type,t.count)})),1)),++c)}break;case 1:case 6:break;case 2:for(var l,d=w(i.samplerTextures);!(l=d()).done;){var g=l.value;g.stageFlags===o&&(r.samplerTextures.push(new td(n,c,g.name,g.type,g.count)),++c)}break;case 3:for(var p,_=w(i.samplers);!(p=_()).done;){var y=p.value;y.stageFlags===o&&(r.samplers.push(new id(n,c,y.name,y.count)),++c)}break;case 4:for(var m,b=w(i.textures);!(m=b()).done;){var k=m.value;k.stageFlags===o&&(r.textures.push(new nd(n,c,k.name,k.type,k.count)),++c)}break;case 5:for(var A,E=w(i.buffers);!(A=E()).done;){var T=A.value;T.stageFlags===o&&(r.buffers.push(new sd(n,c,T.name,1,T.memoryAccess)),++c)}break;case 7:for(var O,S=w(i.images);!(O=S()).done;){var I=O.value;I.stageFlags===o&&(r.images.push(new rd(n,c,I.name,I.type,I.count,I.memoryAccess)),++c)}break;case 8:for(var R,M=w(i.subpassInputs);!(R=M()).done;){var C=R.value;C.stageFlags===o&&(r.subpassInputs.push(new ed(n,C.binding,C.name,C.count)),++c)}}}}function Yut(t,i,n,r,s){for(var e,h=w(i.descriptorBlocks);!(e=h()).done;){var u=e.value,o=u.offset;switch(u.type){case 0:for(var c,a=w(u.descriptors);!(c=a()).done;){var f=c.value,v=i.uniformBlocks.get(f.descriptorID);void 0!==v?(s.push(Sm(v.members)),r.blocks.push(new Zl(n,o,t[f.descriptorID],v.members.map((function(t){return new Jl(t.name,t.type,t.count)})),1)),++o):X("Failed to find uniform block "+f.descriptorID+" in layout")}o!==u.offset+u.capacity&&X("Uniform buffer binding mismatch for set "+n);break;case 1:case 6:break;case 2:for(var l,d=w(u.descriptors);!(l=d()).done;){var g=l.value;r.samplerTextures.push(new td(n,o,t[g.descriptorID],g.type,g.count)),++o}break;case 3:for(var p,_=w(u.descriptors);!(p=_()).done;){var y=p.value;r.samplers.push(new id(n,o,t[y.descriptorID],y.count)),++o}break;case 4:for(var m,b=w(u.descriptors);!(m=b()).done;){var k=m.value;r.textures.push(new nd(n,o,t[k.descriptorID],k.type,k.count)),++o}break;case 5:for(var A,E=w(u.descriptors);!(A=E()).done;){var T=A.value;r.buffers.push(new sd(n,o,t[T.descriptorID],1,3)),++o}break;case 7:for(var O,S=w(u.descriptors);!(O=S()).done;){var I=O.value;r.images.push(new rd(n,o,t[I.descriptorID],I.type,I.count,3)),++o}break;case 8:for(var R,M=w(u.descriptors);!(R=M()).done;){var C=R.value;r.subpassInputs.push(new ed(n,o,t[C.descriptorID],C.count)),++o}}}}function Kut(t,i,n,r){for(var s=jut[0],e=function(){var e=t.blocks[h],u=i.layouts[e.name],o=u&&i.bindings.find((function(t){return t.binding===u.binding}));if(!(u&&o&&o.descriptorType&Ud))return console.warn("builtin UBO '"+e.name+"' not available!"),1;r.push(Sm(e.members)),n.blocks.push(new Zl(s,o.binding,e.name,e.members.map((function(t){return new Jl(t.name,t.type,t.count)})),1))},h=0;h<t.blocks.length;h++)e();for(var u=function(){var r=t.samplerTextures[o],e=i.layouts[r.name],h=e&&i.bindings.find((function(t){return t.binding===e.binding}));if(!(e&&h&&h.descriptorType&xd))return console.warn("builtin samplerTexture '"+r.name+"' not available!"),1;n.samplerTextures.push(new td(s,h.binding,r.name,r.type,r.count))},o=0;o<t.samplerTextures.length;o++)u()}function qut(t){for(var i,n=0,r=w(t.bindings);!(i=r()).done;){var s=i.value;1!==s.descriptorType&&2!==s.descriptorType||(n+=s.count)}return n}function Qut(t){for(var i,n=0,r=w(t.bindings);!(i=r()).done;){var s=i.value;1!==s.descriptorType&&2!==s.descriptorType&&(n+=s.count)}return n}function Jut(t,i){for(var n,r=w(i);!(n=r()).done;){var s=n.value;s.flattened=t[s.set]+s.binding}}function Zut(t,i,n){for(var r,s=w(n);!(r=s()).done;){var e=r.value;e.flattened=t[e.set]+e.binding-i[e.set]}}function tot(t,i,n){var r,s,e,h,u=new Array(4),o=(null==(r=t[3])?void 0:r.uniformBlockCapacity)||0,c=(null==(s=t[2])?void 0:s.uniformBlockCapacity)||0,a=(null==(e=t[1])?void 0:e.uniformBlockCapacity)||0,f=i?qut(i):(null==(h=t[0])?void 0:h.uniformBlockCapacity)||0;u[jut[3]]=o,u[jut[2]]=c,u[jut[1]]=a,u[jut[0]]=f;var v=0+o,l=v+c,d=l+f,w=new Array(4);w[jut[3]]=0,w[jut[2]]=v,w[jut[1]]=d,w[jut[0]]=l,Jut(w,n.blocks);var g,p,_,y=0+((null==(g=t[3])?void 0:g.samplerTextureCapacity)||0),m=y+((null==(p=t[2])?void 0:p.samplerTextureCapacity)||0),b=m+(i?Qut(i):(null==(_=t[0])?void 0:_.samplerTextureCapacity)||0),k=new Array(4);k[jut[3]]=0,k[jut[2]]=y,k[jut[1]]=b,k[jut[0]]=m,Zut(k,u,n.samplerTextures)}function iot(t,i,n,r,s,e){var h=[null,null,null,null],u=null,o=new od,c=[],a=i.getSet(3);a&&(h[3]=a.descriptorSetLayoutData,Yut(t.valueNames,a.descriptorSetLayoutData,jut[3],o,c));var f=n.getSet(2);f&&(h[2]=f.descriptorSetLayoutData,Yut(t.valueNames,f.descriptorSetLayoutData,jut[2],o,c));var v=r.descriptors[1];if(s){var l=s.layout.getSet(1);l&&(h[1]=l.descriptorSetLayoutData,Yut(t.valueNames,l.descriptorSetLayoutData,jut[1],o,c))}else{var d=n.getSet(1);d&&(h[1]=d.descriptorSetLayoutData,Xut(d.descriptorSetLayoutData,v,jut[1],o,c))}var w=r.descriptors[0];if(s)if(e)u=P_,Kut(w,P_,o,c);else{var g=s.layout.getSet(0);g&&(h[0]=g.descriptorSetLayoutData,Yut(t.valueNames,g.descriptorSetLayoutData,jut[0],o,c))}else{var p=n.getSet(0);p&&(h[0]=p.descriptorSetLayoutData,Xut(p.descriptorSetLayoutData,w,jut[0],o,c))}return tot(h,u,o),o.stages.push(new hd(1,"")),o.stages.push(new hd(16,"")),[o,c]}var not=function(){function t(t,i){void 0===i&&(i=null),this.shader=void 0,this.pipelineState=null,this.shader=t,this.pipelineState=i}return r(t,[{key:"name",get:function(){return this.shader.name}}]),t}();function rot(t,i){for(var n in t.layouts){var r=t.layouts[n];if(r.binding===i){Y(r.name===n);var s=0;return(r instanceof td||r instanceof rd)&&(s=r.type),[r.name,s]}}return X("descriptor not found"),["",0]}function sot(t,i){for(var n,r=new cst,s=w(i.bindings);!(n=s()).done;){var e=n.value,h=rot(i,e.binding),u=h[0],o=h[1],c=Xet(t,u),a=Fet(e.descriptorType),f=new ost(a,e.stageFlags,e.count,e.access,e.viewDimension,e.sampleType,e.format);f.offset=e.binding,f.descriptors.push(new ust(c,o,e.count)),r.descriptorBlocks.push(f),void 0!==r.bindingMap.get(c)&&X("duplicate descriptor name '"+u+"'"),r.bindingMap.set(c,e.binding);var v=i.layouts[u];v instanceof Zl&&r.uniformBlocks.set(c,v)}return r}function eot(t,i,n,r,s,e){var h=s.layout.getSets(),u=tht(n,1,jut[1],i.descriptors[1]),o=new ast(u);if(iht(o.descriptorSetLayoutData,o.descriptorSetLayoutInfo),h.set(1,o),e){var c=sot(n,P_),a=new ast(c);if(iht(a.descriptorSetLayoutData,a.descriptorSetLayoutInfo),P_.bindings.length!==a.descriptorSetLayoutInfo.bindings.length)X("local descriptor set layout inconsistent");else for(var f=0;f!==P_.bindings.length;++f){var v=P_.bindings[f],l=a.descriptorSetLayoutInfo.bindings[f];v.binding===l.binding&&v.descriptorType===l.descriptorType&&v.count===l.count&&v.stageFlags===l.stageFlags||X("local descriptor set layout inconsistent")}h.set(0,a)}else{var d=tht(n,0,jut[0],i.descriptors[0]),w=new ast(d);iht(w.descriptorSetLayoutData,w.descriptorSetLayoutInfo),h.set(0,w)}var g=r.shaderPrograms.length;r.shaderIndex.set(t,g),r.shaderPrograms.push(s)}function hot(t,i,n,r,s){Y(s<2);var e=i.j(n),h=e.shaderIndex.get(r);if(void 0===h)return eht();var u=e.shaderPrograms[h].layout.getSet(s);return void 0===u?eht():(u.descriptorSetLayout||(u.descriptorSetLayout=t.createDescriptorSetLayout(u.descriptorSetLayoutInfo)),u.descriptorSetLayout)}function uot(t,i,n,r,s){Y(s<2);var e=i.j(n),h=e.shaderIndex.get(r);if(void 0===h)return null;var u=e.shaderPrograms[h].layout.getSet(s);return void 0===u?null:(u.descriptorSetLayout||(u.descriptorSetLayout=t.createDescriptorSetLayout(u.descriptorSetLayoutInfo)),u.descriptorSetLayout)}function oot(t,i,n){var r=n.program,s=Uet(t,n.pass);if(s===Det)return X("Invalid render pass, program: "+r),[Det,Det,Det,null,Det];var e=n.subpass&&""!==n.subpass&&!0,h=e?xet(t,s,n.subpass):Det;if(e&&h===Det)return X("Invalid render subpass, program: "+r),[Det,Det,Det,null,Det];var u=Get(t,h===Det?s:h,n.phase);if(u===Det)return X("Invalid render phase, program: "+r),[Det,Det,Det,null,Det];for(var o=null,c=Det,a=0;a<i.shaders.length;++a){var f=i.shaders[a];if(f.name===r){o=f,c=a;break}}return[s,h,u,o,c]}function cot(t){return void 0===t.descriptors?(X("No descriptors in shader: "+t.name+", please reimport ALL effects"),1):0}var aot=function(){function t(t){this.layoutGraph=void 0,this.phases=new Map,this.mergeHighFrequency=!1,this.fixedLocal=!0,this.localLayoutData=new cst,this.localDescriptorSetLayout=null,this.pipeline=null,this.device=null,this.layoutGraph=t;for(var i,n=w(t.v());!(i=n()).done;){var r=i.value;t.h(1,r)&&this.phases.set(r,new Gut)}}var i=t.prototype;return i.init=function(t){if(this.device!==t){this.device=t;var i=Math.floor((this.device.capabilities.maxVertexUniformVectors-38)/3);i=i<256?i:256,uy.initLayout(i);for(var n,r=this.layoutGraph,s=w(r.v());!(n=s()).done;)for(var e,h=n.value,u=w(r.getLayout(h).getSets());!(e=u()).done;){var o=e.value;o[0];var c=o[1];iht(c.descriptorSetLayoutData,c.descriptorSetLayoutInfo),c.descriptorSetLayout=this.device.createDescriptorSetLayout(c.descriptorSetLayoutInfo),Y(!!c.descriptorSetLayout),c.descriptorSet=this.device.createDescriptorSet(new kd(c.descriptorSetLayout)),Y(!!c.descriptorSet)}for(var a,f=w(r.v());!(a=f()).done;){var v=a.value;if(r.h(1,v)){var l=v,d=r.getParent(l),g=r.getLayout(d),p=r.getLayout(l),_=new Ad;nht(g,3,_),nht(p,2,_),nht(p,1,_),nht(p,0,_),r.j(l).pipelineLayout=this.device.createPipelineLayout(_)}}var y=P_;this.localLayoutData=sot(r,y);var m,b=new bd;iht(this.localLayoutData,b),this.localDescriptorSetLayout=this.device.createDescriptorSetLayout(b),Y(!!this.localDescriptorSetLayout);for(var k,A=0,E=w(this.localLayoutData.descriptorBlocks);!(k=E()).done;){var T=k.value;if(0===T.type||1===T.type)for(var O,S=w(T.descriptors);!(O=S()).done;)A+=O.value.count}Y(7===A),m=this.device,this.layoutGraph.constantMacros,m.getFormatFeatures(44),m.capabilities.maxVertexUniformVectors,m.capabilities.maxFragmentUniformVectors,m.hasFeature(5),uy.JOINT_UNIFORM_CAPACITY}},i.addEffect=function(t){for(var i,n=this,r=this.layoutGraph,s=w(t.techniques);!(i=s()).done;)for(var e,h=function(){var i=e.value,s=i.program,h=oot(r,t,i),u=h[0],o=h[1],c=h[2],a=h[3];if(null===a||cot(a))return X("program: "+s+" not found"),1;Y(u!==Det&&c!==Det);var f=o===Det?u:o,v=r.getLayout(f),l=r.getLayout(c),d=n.phases.get(c);void 0===d&&(d=new Gut,n.phases.set(c,d));var w=d.programInfos,g=Hut(t.name,a),p=null;if(!n.mergeHighFrequency){var _=r.j(c);p=new gst,eot(s,a,r,_,p,n.fixedLocal)}var y=iot(r,v,l,a,p,n.fixedLocal),m=y[0],b=y[1];Wut(m,g);var k=Im(m),A=[];g.attributes.forEach((function(t){A.push(new ud(t.name,t.format,t.isNormalized,0,t.isInstanced,t.location))}));var E=new xut(g,m,A,b,k);w.set(a.name,E)},u=w(i.value.passes);!(e=u()).done;)h()},i.precompileEffect=function(t,i){for(var n,r=this,s=this.layoutGraph,e=w(i.techniques);!(n=e()).done;)for(var h,u=function(){var n=h.value,e=n.program,u=oot(s,i,n),o=u[0];u[1];var c=u[2],a=u[3],f=u[4];if(null===a||cot(a))return X("program: "+e+" not valid"),0;Y(o!==Det&&c!==Det&&f!==Det);var v=i.combinations[f];if(!v)return 0;Cm(v).forEach((function(i){return r.getProgramVariant(t,c,e,i)}))},o=w(n.value.passes);!(h=o()).done;)u()},i.getProgramInfo=function(t,i){return Y(t!==Det),this.phases.get(t).programInfos.get(i).programInfo},i.getShaderInfo=function(t,i){return Y(t!==Det),this.phases.get(t).programInfos.get(i).shaderInfo},i.getKey=function(t,i,n){Y(t!==Det);var r=this.phases.get(t);if(void 0===r)return X("Invalid render phase, program: "+i),"";var s=r.programInfos.get(i);return void 0===s?(X("Invalid program, program: "+i),""):Em(s.programInfo,n)},i.getProgramVariant=function(t,i,n,r,s){var e;void 0===s&&(s=null),Object.assign(r,null==(e=this.pipeline)?void 0:e.macros),Y(i!==Det);var h=this.phases.get(i);if(void 0===h)return X("Invalid render phase, program: "+n),null;var u=h.programInfos.get(n);if(void 0===u)return X("Invalid program, program: "+n),null;var o=u.programInfo;null===s&&(s=Em(o,r));var c=h.programProxies,a=c.get(s);if(void 0!==a)return a;var f=mm(r,o.defines),v=this.layoutGraph.constantMacros+o.constantMacros+f.reduce((function(t,i){return t+"#define "+i.name+" "+i.value+"\n"}),""),l=o.glsl3,d=Bm(t);d?l=o[d]:ht(16346);var w=u.shaderInfo;l.compute?(w.stages[0].source=v+l.compute,w.stages[0].stage=32,w.stages.length=1):(w.stages[0].source=v+l.vert,w.stages[1].source=v+l.frag),w.attributes=Am(o,u.attributes,r),w.name=bm(n,f);var g=t.createShader(w),p=new not(g);return c.set(s,p),p},i.getMaterialDescriptorSetLayout=function(t,i,n){if(this.mergeHighFrequency){Y(i!==Det);var r=this.layoutGraph.getParent(i);return uht(this.layoutGraph,r,i,1)}return hot(t,this.layoutGraph,i,n,1)},i.getLocalDescriptorSetLayout=function(t,i,n){if(this.mergeHighFrequency){Y(i!==Det);var r=this.layoutGraph.getParent(i);return uht(this.layoutGraph,r,i,0)}return hot(t,this.layoutGraph,i,n,0)},i.getBlockSizes=function(t,i){Y(t!==Det);var n=this.phases.get(t);if(!n)return X("Invalid render phase, program: "+i),[];var r=n.programInfos.get(i);return r?r.blockSizes:(X("Invalid program, program: "+i),[])},i.getHandleMap=function(t,i){Y(t!==Det);var n=this.phases.get(t);if(!n)return X("Invalid render phase, program: "+i),{};var r=n.programInfos.get(i);return r?r.handleMap:(X("Invalid program, program: "+i),{})},i.getPipelineLayout=function(t,i,n){if(this.mergeHighFrequency)return Y(i!==Det),this.layoutGraph.j(i).pipelineLayout;var r=this.layoutGraph,s=r.j(i),e=s.shaderIndex.get(n);if(void 0===e)return hht();var h=s.shaderPrograms[e];if(h.pipelineLayout)return h.pipelineLayout;var u=r.getParent(i);if(u===Det)return hht();var o=new Ad,c=oht(this.layoutGraph,u,i,3);c&&o.setLayouts.push(c);var a=oht(this.layoutGraph,u,i,2);a&&o.setLayouts.push(a);var f=uot(t,r,i,n,1);f&&o.setLayouts.push(f);var v=uot(t,r,i,n,0);return v&&o.setLayouts.push(v),h.pipelineLayout=t.createPipelineLayout(o),h.pipelineLayout},i.getProgramID=function(t,i){return cht(this.layoutGraph,t,i)},i.getDescriptorNameID=function(t){return aht(this.layoutGraph,t)},i.getDescriptorName=function(t){return fht(this.layoutGraph,t)},t}(),fot=null,vot=!1;function lot(){vot=!0}var dot=[],wot=4294967295,got=new mst,pot=new aot(got),_ot=new Map,yot=Object.freeze({__proto__:null,AccessType:{READ:0,READ_WRITE:1,WRITE:2},AttachmentType:{RENDER_TARGET:0,DEPTH_STENCIL:1,SHADING_RATE:2},ClearValueType:{NONE:0,FLOAT_TYPE:1,INT_TYPE:2},CopyPair:Wnt,INVALID_ID:wot,LightInfo:$nt,LightingMode:{NONE:0,DEFAULT:1,CLUSTERED:2},MovePair:Ynt,ParameterType:{CONSTANTS:0,CBV:1,UAV:2,SRV:3,TABLE:4,SSV:5},PipelineCapabilities:ist,PipelineStatistics:Knt,PipelineType:{BASIC:0,STANDARD:1},QueueHint:{NONE:0,OPAQUE:1,MASK:2,BLEND:3,RENDER_OPAQUE:1,RENDER_CUTOUT:2,RENDER_TRANSPARENT:3},RenderCommonObjectPool:trt,ResolveFlags:{NONE:0,COLOR:1,DEPTH:2,STENCIL:4},ResolvePair:znt,ResourceDimension:{BUFFER:0,TEXTURE1D:1,TEXTURE2D:2,TEXTURE3D:3},ResourceFlags:{NONE:0,UNIFORM:1,INDIRECT:2,STORAGE:4,SAMPLED:8,COLOR_ATTACHMENT:16,DEPTH_STENCIL_ATTACHMENT:32,INPUT_ATTACHMENT:64,SHADING_RATE:128,TRANSFER_SRC:256,TRANSFER_DST:512},ResourceResidency:{MANAGED:0,MEMORYLESS:1,PERSISTENT:2,EXTERNAL:3,BACKBUFFER:4},SceneFlags:{NONE:0,OPAQUE:1,MASK:2,BLEND:4,OPAQUE_OBJECT:1,CUTOUT_OBJECT:2,TRANSPARENT_OBJECT:4,SHADOW_CASTER:8,UI:16,DEFAULT_LIGHTING:32,VOLUMETRIC_LIGHTING:64,CLUSTERED_LIGHTING:128,PLANAR_SHADOW:256,GEOMETRY:512,PROFILER:1024,DRAW_INSTANCING:2048,DRAW_NON_INSTANCING:4096,REFLECTION_PROBE:8192,GPU_DRIVEN:16384,NON_BUILTIN:32768,ALL:4294967295},SubpassCapabilities:{NONE:0,INPUT_DEPTH_STENCIL:1,INPUT_COLOR:2,INPUT_COLOR_MRT:4,HETEROGENEOUS_SAMPLE_COUNT:8},TaskType:{SYNC:0,ASYNC:1},UpdateFrequency:{PER_INSTANCE:0,PER_BATCH:1,PER_PHASE:2,PER_PASS:3,COUNT:4},UploadPair:Xnt,completePhaseName:function(t){return"number"==typeof t?t.toString():"string"==typeof t?t:"default"},createCustomPipeline:function(){var t=new Fut(got),i=Si.CUSTOM_PIPELINE_NAME;return t.setCustomPipelineName(i),pot.pipeline=t,t},customPipelineBuilderMap:_ot,defaultWindowResize:function(t,i,n,r){t.addRenderWindow(i.colorName,36,n,r,i),t.addDepthStencil(i.depthStencilName,55,n,r);var s=i.renderWindowId,e=Zy(t.device)?11:35,h=t.pipelineSceneData.shadows.size;t.addRenderTarget("ShadowMap"+s,e,h.x,h.y),t.addDepthStencil("ShadowDepth"+s,55,h.x,h.y)},destroy:function(){sht(got)},dispatchResizeEvents:function(t,i,n){if(i.windowResize){for(var r,s=w(t);!(r=s()).done;){var e=r.value;if(e.window.isRenderWindowResized()||vot){var h=Math.max(Math.floor(e.window.width),1),u=Math.max(Math.floor(e.window.height),1);i.windowResize(n,e.window,e,h,u),dot.push(e.window)}}for(var o,c=w(dot);!(o=c()).done;)o.value.setRenderWindowResizeHandled();dot.length=0,vot=!1}},enableEffectImport:!0,forceResizeAllWindows:lot,getCustomPipeline:function(t){var i=_ot.get(t);return i||(i=_ot.get("Forward")),i},getEditorPipelineSettings:function(){return fot},getPassID:function(t){return Uet(got,t)},getPhaseID:function(t,i){return Get(got,t,i)},getSubpassID:function(t,i){return xet(got,t,i)},init:function(t,i){if(i&&i.byteLength>=8){var n=new Uint8Array(i);if(new DataView(n.buffer,n.byteOffset,8).getUint32(0)===wot){var r=new RP.Inflate(new Uint8Array(n.buffer,n.byteOffset+8)).decompress();Pst(new Uut(r.buffer,r.byteOffset),got)}else Pst(new Uut(n.buffer,n.byteOffset),got)}rht(t,got)},loadCopyPair:function(t,i){i.source=t.s(),i.target=t.s(),i.mipLevels=t.n(),i.numSlices=t.n(),i.sourceMostDetailedMip=t.n(),i.sourceFirstSlice=t.n(),i.sourcePlaneSlice=t.n(),i.targetMostDetailedMip=t.n(),i.targetFirstSlice=t.n(),i.targetPlaneSlice=t.n()},loadLightInfo:function(t,i){i.level=t.n(),i.culledByLight=t.b()},loadMovePair:function(t,i){i.source=t.s(),i.target=t.s(),i.mipLevels=t.n(),i.numSlices=t.n(),i.targetMostDetailedMip=t.n(),i.targetFirstSlice=t.n(),i.targetPlaneSlice=t.n()},loadPipelineStatistics:function(t,i){i.numRenderPasses=t.n(),i.numManagedTextures=t.n(),i.totalManagedTextures=t.n(),i.numUploadBuffers=t.n(),i.numUploadBufferViews=t.n(),i.numFreeUploadBuffers=t.n(),i.numFreeUploadBufferViews=t.n(),i.numDescriptorSets=t.n(),i.numFreeDescriptorSets=t.n(),i.numInstancingBuffers=t.n(),i.numInstancingUniformBlocks=t.n()},loadResolvePair:function(t,i){i.source=t.s(),i.target=t.s(),i.resolveFlags=t.n(),i.mode=t.n(),i.mode1=t.n()},packRGBE:function(t){var i=Math.max(Math.max(t.x,t.y),t.z),n=128;i>1e-4&&(n=Math.log(i)/Math.log(1.1),n=Gn((n=Math.ceil(n))+128,0,255));var r=1/Math.pow(1.1,n-128),s=Zs(t.multiplyScalar(r),new Ir(0,0,0),new Ir(1,1,1));s.multiplyScalar(255);var e,h,u=te(s).add((e=s.subtract(te(s)))<(h=new Ir(.5,.5,.5))?h:e);return new $s(u.x/255,u.y/255,u.z/255,n/255)},programLib:pot,saveCopyPair:function(t,i){t.s(i.source),t.s(i.target),t.n(i.mipLevels),t.n(i.numSlices),t.n(i.sourceMostDetailedMip),t.n(i.sourceFirstSlice),t.n(i.sourcePlaneSlice),t.n(i.targetMostDetailedMip),t.n(i.targetFirstSlice),t.n(i.targetPlaneSlice)},saveLightInfo:function(t,i){t.n(i.level),t.b(i.culledByLight)},saveMovePair:function(t,i){t.s(i.source),t.s(i.target),t.n(i.mipLevels),t.n(i.numSlices),t.n(i.targetMostDetailedMip),t.n(i.targetFirstSlice),t.n(i.targetPlaneSlice)},savePipelineStatistics:function(t,i){t.n(i.numRenderPasses),t.n(i.numManagedTextures),t.n(i.totalManagedTextures),t.n(i.numUploadBuffers),t.n(i.numUploadBufferViews),t.n(i.numFreeUploadBuffers),t.n(i.numFreeUploadBufferViews),t.n(i.numDescriptorSets),t.n(i.numFreeDescriptorSets),t.n(i.numInstancingBuffers),t.n(i.numInstancingUniformBlocks)},saveResolvePair:function(t,i){t.s(i.source),t.s(i.target),t.n(i.resolveFlags),t.n(i.mode),t.n(i.mode1)},setCustomPipeline:function(t,i){_ot.set(t,i),lot()},setEditorPipelineSettings:function(t){fot=t,vot=!0}});t("e8",yot),O.rendering=yot;var mot=function(t){function i(){var i;return(i=t.call(this)||this).DL=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.ir=t.layout;var i=t.layout.gpuDescriptorSetLayout,n=i.BL,r=i.FL,s=i.UL;this.nr=Array(s).fill(null),this.rr=Array(s).fill(null),this.Cn=Array(s).fill(null);var e=[];this.DL={xL:e,FL:r};for(var h=0;h<n.length;++h)for(var u=n[h],o=0;o<u.count;o++){var c={GL:u.descriptorType,jL:null,HL:null,VL:null};e.push(c)}},n.destroy=function(){this.ir=null,this.DL=null},n.update=function(){if(this.sr&&this.DL){for(var t=this.DL.xL,i=0;i<t.length;++i)if(t[i].GL&Ud){var n=this.nr[i];n&&(t[i].jL=n.gpuBuffer||n.gpuBufferView)}else t[i].GL&xd&&(this.rr[i]&&(t[i].HL=this.rr[i].gpuTexture),this.Cn[i]&&(t[i].VL=this.Cn[i].gpuSampler));this.sr=!1}},r(i,[{key:"gpuDescriptorSet",get:function(){return this.DL}}]),i}(rw),bot=Math.max,kot=Math.min;function Aot(t){switch(t){case 4:case 6:case 14:case 16:case 24:case 25:case 27:case 36:case 35:case 37:case 39:case 51:case 53:case 56:case 58:case 60:case 61:case 62:case 63:case 64:case 66:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 79:case 81:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:default:return 5121;case 5:case 7:case 15:case 17:case 26:case 28:case 38:case 40:case 65:case 67:case 80:case 82:return 5120;case 8:case 18:case 29:case 41:return 36193;case 9:case 19:case 30:case 42:return 5123;case 10:case 20:case 31:case 43:return 5122;case 11:case 21:case 32:case 44:case 48:case 69:case 68:return 5126;case 12:case 22:case 33:case 45:case 52:case 54:return 5125;case 13:case 23:case 34:case 46:return 5124;case 47:return 33635;case 49:return 32820;case 50:return 32819;case 55:return 34042}}function Eot(t){switch(t){case 47:return 36194;case 49:return 32855;case 50:return 32854;case 41:return 34842;case 44:return 34836;case 37:return 35907;case 54:return 33189;case 55:return 34041;default:return ht(16309),6408}}function Tot(t){switch(t){case 1:return 6406;case 2:return 6409;case 3:return 6410;case 24:case 29:case 32:case 47:return 6407;case 36:case 35:case 37:case 41:case 44:case 49:case 50:return 6408;case 54:return 6402;case 55:return 34041;case 56:return 33776;case 57:return 33777;case 58:return 35916;case 59:return 35917;case 60:return 33778;case 61:return 35918;case 62:return 33779;case 63:return 35919;case 72:return 36196;case 73:return 37492;case 74:return 37493;case 75:return 37494;case 76:return 37495;case 77:return 37496;case 78:return 37497;case 79:return 37488;case 80:return 37489;case 81:return 37490;case 82:return 37491;case 83:return 35841;case 84:return 35843;case 85:return 35840;case 86:return 35842;case 89:return 37808;case 90:return 37809;case 91:return 37810;case 92:return 37811;case 93:return 37812;case 94:return 37813;case 95:return 37814;case 96:return 37815;case 97:return 37816;case 98:return 37817;case 99:return 37818;case 100:return 37819;case 101:return 37820;case 102:return 37821;case 103:return 37840;case 104:return 37841;case 105:return 37842;case 106:return 37843;case 107:return 37844;case 108:return 37845;case 109:return 37846;case 110:return 37847;case 111:return 37848;case 112:return 37849;case 113:return 37850;case 114:return 37851;case 115:return 37852;case 116:return 37853;default:return ht(16310),6408}}function Oot(t){switch(t){case 1:return 35670;case 2:return 35671;case 3:return 35672;case 4:return 35673;case 5:return 5124;case 6:return 35667;case 7:return 35668;case 8:return 35669;case 9:return 5125;case 13:return 5126;case 14:return 35664;case 15:return 35665;case 16:return 35666;case 17:return 35674;case 21:return 35675;case 25:return 35676;case 28:return 35678;case 31:return 35680;default:return ht(16311),0}}function Sot(t){switch(t){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:return Int32Array;case 13:case 14:case 15:case 16:case 17:case 21:case 25:return Float32Array;default:return ht(16312),Float32Array}}function Iot(t){switch(t){case 35670:return 1;case 35671:return 2;case 35672:return 3;case 35673:return 4;case 5124:return 5;case 35667:return 6;case 35668:return 7;case 35669:return 8;case 5125:return 9;case 5126:return 13;case 35664:return 14;case 35665:return 15;case 35666:return 16;case 35674:return 17;case 35675:return 21;case 35676:return 25;case 35678:return 28;case 35680:return 31;default:return ht(16313),0}}function Rot(t){switch(t){case 35670:case 5124:case 5125:case 5126:case 35678:case 35680:return 4;case 35671:case 35667:case 35664:return 8;case 35672:case 35668:case 35665:return 12;case 35673:case 35669:case 35666:case 35674:return 16;case 35675:return 36;case 35676:return 64;default:return ht(16314),0}}function Mot(t){switch(t){case 35674:return 2;case 35675:return 3;case 35676:return 4;default:return 1}}var Cot=[512,513,514,515,516,517,518,519],Not=[0,7680,7681,7682,7683,5386,34055,34056],Pot=[32774,32778,32779,32775,32776],Lot=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];function Dot(t,i){var n=t.gl,r=t.stateCache,s=2&i.$L?35048:35044;if(8&i.zL){i.WL=34962;var e=n.createBuffer();e&&(i.XL=e,i.YL>0&&(t.extensions.KL&&r.qL&&(t.extensions.QL.bindVertexArrayOES(null),r.qL=null),Wot.gpuInputAssembler=null,r.JL!==i.XL&&(n.bindBuffer(34962,i.XL),r.JL=i.XL),n.bufferData(34962,i.YL,s),n.bindBuffer(34962,null),r.JL=null))}else if(4&i.zL){i.WL=34963;var h=n.createBuffer();h&&(i.XL=h,i.YL>0&&(t.extensions.KL&&r.qL&&(t.extensions.QL.bindVertexArrayOES(null),r.qL=null),Wot.gpuInputAssembler=null,r.ZL!==i.XL&&(n.bindBuffer(34963,i.XL),r.ZL=i.XL),n.bufferData(34963,i.YL,s),n.bindBuffer(34963,null),r.ZL=null))}else 16&i.zL?(i.WL=0,i.tD&&(i.vf32=new Float32Array(i.tD.buffer))):(64&i.zL||2&i.zL||1&i.zL||ht(16315),i.WL=0)}function Bot(t,i){var n=t.gl,r=t.stateCache;if(i.XL){switch(i.WL){case 34962:t.extensions.KL&&r.qL&&(t.extensions.QL.bindVertexArrayOES(null),r.qL=null),Wot.gpuInputAssembler=null,n.bindBuffer(34962,null),r.JL=null;break;case 34963:t.extensions.KL&&r.qL&&(t.extensions.QL.bindVertexArrayOES(null),r.qL=null),Wot.gpuInputAssembler=null,n.bindBuffer(34963,null),r.ZL=null}n.deleteBuffer(i.XL),i.XL=null}}function Fot(t,i,n,r,s){if(16&i.zL)ArrayBuffer.isView(n)?i.vf32.set(n,r/4):i.vf32.set(new Float32Array(n),r/4);else if(64&i.zL){i.nD.iD();for(var e=n.drawInfos,h=0;h<e.length;++h)i.nD.rD(r+h,e[h])}else{var u=n,o=t.gl,c=t.stateCache;switch(i.WL){case 34962:t.extensions.KL&&c.qL&&(t.extensions.QL.bindVertexArrayOES(null),c.qL=null),Wot.gpuInputAssembler=null,c.JL!==i.XL&&(o.bindBuffer(34962,i.XL),c.JL=i.XL);break;case 34963:t.extensions.KL&&c.qL&&(t.extensions.QL.bindVertexArrayOES(null),c.qL=null),Wot.gpuInputAssembler=null,c.ZL!==i.XL&&(o.bindBuffer(34963,i.XL),c.ZL=i.XL);break;default:return void ht(16316)}wh.os===ch.IOS&&2&i.$L&&0===r&&s===u.byteLength?o.bufferData(i.WL,u,o.DYNAMIC_DRAW):s===u.byteLength?o.bufferSubData(i.WL,r,u):o.bufferSubData(i.WL,r,u.slice(0,s))}}function Uot(t,i){var n=t.gl,r=t.stateCache;i.sD=i.eD=Tot(i.hD),i.uD=Aot(i.hD);var s=i.oD,e=i.cD;switch(i.GL){case 1:i.WL=3553;var h=bot(s,e);if(h>t.capabilities.maxTextureSize&&ht(9100,h,t.capabilities.maxTextureSize),t.textureExclusive[i.hD]||t.extensions.aD||!Fd[i.hD].hasDepth){if(i.fD=n.createTexture(),i.YL>0){var u=r.vD[r.lD];if(u.fD!==i.fD&&(n.bindTexture(3553,i.fD),u.fD=i.fD),Fd[i.hD].isCompressed)for(var o=0;o<i.dD;++o){var c=Hd(i.hD,s,e,1),a=new Uint8Array(c);n.compressedTexImage2D(3553,o,i.eD,s,e,0,a),s=bot(1,s>>1),e=bot(1,e>>1)}else for(var f=0;f<i.dD;++f)n.texImage2D(3553,f,i.eD,s,e,0,i.sD,i.uD,null),s=bot(1,s>>1),e=bot(1,e>>1);i.wD?(i.gD=10497,i.pD=10497):(i.gD=33071,i.pD=33071),i._D=9729,i.yD=9729,n.texParameteri(i.WL,10242,i.gD),n.texParameteri(i.WL,10243,i.pD),n.texParameteri(i.WL,10241,i._D),n.texParameteri(i.WL,10240,i.yD)}}else i.eD=Eot(i.hD),i.mD=n.createRenderbuffer(),i.YL>0&&(r.mD!==i.mD&&(n.bindRenderbuffer(36161,i.mD),r.mD=i.mD),n.renderbufferStorage(36161,i.eD,s,e));break;case 3:i.WL=34067;var v=bot(s,e);if(v>t.capabilities.maxCubeMapTextureSize&&ht(9100,v,t.capabilities.maxTextureSize),i.fD=n.createTexture(),i.YL>0){var l=r.vD[r.lD];if(l.fD!==i.fD&&(n.bindTexture(34067,i.fD),l.fD=i.fD),Fd[i.hD].isCompressed)for(var d=0;d<6;++d){s=i.oD,e=i.cD;for(var w=0;w<i.dD;++w){var g=Hd(i.hD,s,e,1),p=new Uint8Array(g);n.compressedTexImage2D(34069+d,w,i.eD,s,e,0,p),s=bot(1,s>>1),e=bot(1,e>>1)}}else for(var _=0;_<6;++_){s=i.oD,e=i.cD;for(var y=0;y<i.dD;++y)n.texImage2D(34069+_,y,i.eD,s,e,0,i.sD,i.uD,null),s=bot(1,s>>1),e=bot(1,e>>1)}i.wD?(i.gD=10497,i.pD=10497):(i.gD=33071,i.pD=33071),i._D=9729,i.yD=9729,n.texParameteri(i.WL,10242,i.gD),n.texParameteri(i.WL,10243,i.pD),n.texParameteri(i.WL,10241,i._D),n.texParameteri(i.WL,10240,i.yD)}break;default:ht(16317),i.GL=1,i.WL=3553}}function xot(t,i){var n=t.gl,r=t.stateCache;if(i.fD){var s=r.vD,e=r.lD;n.deleteTexture(i.fD);for(var h=0;h<s.length;h++)s[h].fD===i.fD&&(n.activeTexture(33984+h),e=h,n.bindTexture(i.WL,null),s[h].fD=null);r.lD=e,i.fD=null}if(i.mD){var u=r.mD;n.deleteRenderbuffer(i.mD),u===i.mD&&(n.bindRenderbuffer(36161,null),r.mD=null),i.mD=null}}function Got(t,i){if(i.YL){var n=t.gl,r=t.stateCache,s=i.oD,e=i.cD;switch(i.GL){case 1:i.WL=3553;var h=bot(s,e);if(h>t.capabilities.maxTextureSize&&ht(9100,h,t.capabilities.maxTextureSize),i.mD)r.mD!==i.mD&&(n.bindRenderbuffer(36161,i.mD),r.mD=i.mD),n.renderbufferStorage(36161,i.eD,s,e);else if(i.fD){var u=r.vD[r.lD];if(u.fD!==i.fD&&(n.bindTexture(3553,i.fD),u.fD=i.fD),Fd[i.hD].isCompressed)for(var o=0;o<i.dD;++o){var c=Hd(i.hD,s,e,1),a=new Uint8Array(c);n.compressedTexImage2D(3553,o,i.eD,s,e,0,a),s=bot(1,s>>1),e=bot(1,e>>1)}else for(var f=0;f<i.dD;++f)n.texImage2D(3553,f,i.eD,s,e,0,i.sD,i.uD,null),s=bot(1,s>>1),e=bot(1,e>>1)}break;case 3:i.WL=34067;var v=bot(s,e);v>t.capabilities.maxCubeMapTextureSize&&ht(9100,v,t.capabilities.maxTextureSize);var l=r.vD[r.lD];if(l.fD!==i.fD&&(n.bindTexture(34067,i.fD),l.fD=i.fD),Fd[i.hD].isCompressed)for(var d=0;d<6;++d){s=i.oD,e=i.cD;for(var w=0;w<i.dD;++w){var g=Hd(i.hD,s,e,1),p=new Uint8Array(g);n.compressedTexImage2D(34069+d,w,i.eD,s,e,0,p),s=bot(1,s>>1),e=bot(1,e>>1)}}else for(var _=0;_<6;++_){s=i.oD,e=i.cD;for(var y=0;y<i.dD;++y)n.texImage2D(34069+_,y,i.eD,s,e,0,i.sD,i.uD,null),s=bot(1,s>>1),e=bot(1,e>>1)}break;default:ht(16317),i.GL=1,i.WL=3553}}}function jot(t,i){for(var n=0;n<i.kD.length;++n)if(i.kD[n].AD)return void(i.ED=!1);var r=t.gl,s=t.stateCache,e=[],h=r.createFramebuffer();if(h){i.TD=h,s.TD!==i.TD&&r.bindFramebuffer(36160,i.TD);for(var u=0;u<i.kD.length;++u){var o=i.kD[u];o&&(o.fD?r.framebufferTexture2D(36160,36064+u,o.WL,o.fD,0):r.framebufferRenderbuffer(36160,36064+u,36161,o.mD),e.push(36064+u),i.oD=kot(i.oD,o.oD),i.cD=kot(i.cD,o.cD))}var c=i.OD;if(c){var a=Fd[c.hD].hasStencil?33306:36096;c.fD?r.framebufferTexture2D(36160,a,c.WL,c.fD,0):r.framebufferRenderbuffer(36160,a,36161,c.mD),i.oD=kot(i.oD,c.oD),i.cD=kot(i.cD,c.cD)}t.extensions.SD&&t.extensions.SD.drawBuffersWEBGL(e);var f=r.checkFramebufferStatus(36160);if(36053!==f)switch(f){case 36054:ht(16318);break;case 36055:ht(16319);break;case 36057:ht(16320);break;case 36061:ht(16321)}s.TD!==i.TD&&r.bindFramebuffer(36160,s.TD)}}function Hot(t,i){for(var n,r=t.gl,s=t.stateCache,e=function(){var t=i.RD[h],n=0,s="",e=1;switch(t.GL){case 1:s="VertexShader",n=35633;break;case 16:s="FragmentShader",n=35632;break;default:return ht(16322),{v:void 0}}var u=r.createShader(n);if(u&&(t.MD=u,r.shaderSource(t.MD,t.CD),r.compileShader(t.MD),!r.getShaderParameter(t.MD,35713))){ht(16323,s,i.ND),ht(16324,t.CD.replace(/^|\n/g,(function(){return"\n"+e+++" "}))),X(r.getShaderInfoLog(t.MD));for(var o=0;o<i.RD.length;o++){var c=i.RD[h];c.MD&&(r.deleteShader(c.MD),c.MD=null)}return{v:void 0}}},h=0;h<i.RD.length;h++)if(n=e())return n.v;var u=r.createProgram();if(u){i.PD=u;for(var o=0;o<i.RD.length;o++){var c=i.RD[o];r.attachShader(i.PD,c.MD)}if(r.linkProgram(i.PD),t.extensions.LD)for(var a=0;a<i.RD.length;a++){var f=i.RD[a];f.MD&&(r.detachShader(i.PD,f.MD),r.deleteShader(f.MD),f.MD=null)}if(!r.getProgramParameter(i.PD,35714))return ht(16326,i.ND),void X(r.getProgramInfoLog(i.PD));nt(16325,i.ND);var v=r.getProgramParameter(i.PD,35721);i.DD=new Array(v);for(var l=0;l<v;++l){var d=r.getActiveAttrib(i.PD,l);if(d){var w,g=d.type,p=d.name,_=d.size,y=p.indexOf("[");w=-1!==y?p.substring(0,y):p;var m=r.getAttribLocation(i.PD,w),b=Iot(g),k=Rot(g);i.DD[l]={iP:m,ND:w,GL:b,BD:k,lp:_,YL:k*_,uD:g,FD:m}}}if(i.UD.length>0){i.xD=new Array(i.UD.length);for(var A=0;A<i.UD.length;++A){var E=i.UD[A],O={GD:E.set,iP:E.binding,ND:E.name,YL:0,jD:new Array(E.members.length),HD:[]};i.xD[A]=O;for(var S=0;S<E.members.length;++S){var I=E.members[S],R=Oot(I.type),M=Rot(R),C=M*I.count;O.jD[S]={iP:-1,ND:I.name,GL:I.type,BD:M,lp:I.count,YL:C,VD:0,uD:R,FD:null,$D:null}}}}for(var N=0;N<i.zD.length;++N){var P=i.zD[N];i.WD.push(new td(P.set,P.binding,P.name,28,P.count))}if(i.WD.length>0){i.XD=new Array(i.WD.length);for(var L=0;L<i.WD.length;++L){var D=i.WD[L];i.XD[L]={GD:D.set,iP:D.binding,ND:D.name,GL:D.type,lp:D.count,YD:[],KD:null,uD:Oot(D.type),FD:null}}}for(var B=r.getProgramParameter(i.PD,35718),F=0;F<B;++F){var U=r.getActiveUniform(i.PD,F);if(U&&35678!==U.type&&35680!==U.type){var x=r.getUniformLocation(i.PD,U.name);if(t.extensions.qD(x)){var G,j=U.name.indexOf("[");G=-1!==j?U.name.substring(0,j):U.name;for(var H=0;H<i.xD.length;H++)for(var V=i.xD[H],$=0;$<V.jD.length;$++){var z=V.jD[$];if(z.ND===G){z.FD=x,z.lp=U.size,z.YL=z.BD*z.lp,z.$D=new(Sot(z.GL))(z.YL/4),V.HD.push(z);break}}}}}for(var W=0;W<i.xD.length;W++)for(var Y=i.xD[W],K=0;K<Y.jD.length;K++){var q=Y.jD[K];q.VD=Y.YL/4,Y.YL+=q.YL}var Q=[],J=[],Z=t.bindingMappings,tt=t.capabilities,it=t.stateCache.QD,rt=tt.maxTextureUnits;if(T.rendering&&T.rendering.enableEffectImport)for(var st=0;st<i.WD.length;++st){var et=i.WD[st],ut=r.getUniformLocation(i.PD,et.name);t.extensions.qD(ut)&&(Q.push(i.XD[st]),J.push(ut)),void 0===it[et.name]&&(it[et.name]=et.flattened%rt)}else{for(var ot=0,ct=0;ct<i.UD.length;++ct)i.UD[ct].set===Z.JD&&ot++;for(var at=0,ft=0;ft<i.WD.length;++ft){var vt=i.WD[ft],lt=r.getUniformLocation(i.PD,vt.name);if(t.extensions.qD(lt)&&(Q.push(i.XD[ft]),J.push(lt)),void 0===it[vt.name]){var dt=vt.binding+Z.ZD[vt.set]+at;vt.set===Z.JD&&(dt-=ot),it[vt.name]=dt%rt,at+=vt.count-1}}}if(Q.length){for(var wt=[],gt=0;gt<Q.length;++gt){var pt=Q[gt],_t=it[pt.ND];if(void 0!==_t){pt.FD=J[gt];for(var yt=0;yt<pt.lp;++yt){for(;wt[_t];)_t=(_t+1)%rt;pt.YD.push(_t),wt[_t]=!0}}}for(var mt=0,bt=0;bt<Q.length;++bt){var kt=Q[bt];if(!t.extensions.qD(kt.FD)){kt.FD=J[bt];for(var At=0;At<kt.lp;++At){for(;wt[mt];)mt=(mt+1)%rt;void 0===it[kt.ND]&&(it[kt.ND]=mt),kt.YD.push(mt),wt[mt]=!0}}}s.PD!==i.PD&&r.useProgram(i.PD);for(var Et=0;Et<Q.length;Et++){var Tt=Q[Et];Tt.KD=new Int32Array(Tt.YD),r.uniform1iv(Tt.FD,Tt.KD)}s.PD!==i.PD&&r.useProgram(s.PD)}for(var Ot=0;Ot<i.xD.length;)i.xD[Ot].HD.length?Ot++:(i.xD[Ot]=i.xD[i.xD.length-1],i.xD.length--);i.XD=Q}}function Vot(t,i){if(i.PD){var n=t.gl,r=t.stateCache;if(!t.extensions.LD)for(var s=0;s<i.RD.length;s++){var e=i.RD[s];e.MD&&(n.detachShader(i.PD,e.MD),n.deleteShader(e.MD),e.MD=null)}n.deleteProgram(i.PD),r.PD===i.PD&&(n.useProgram(null),r.PD=null),i.PD=null}}function $ot(t,i){t.gl,i.tB=new Array(i.iB.length);for(var n=[0,0,0,0,0,0,0,0],r=0;r<i.iB.length;++r){var s=i.iB[r],e=s.format,h=s.isNormalized,u=s.isInstanced,o=void 0!==s.stream?s.stream:0,c=i.nB[o],a=Aot(e),f=Fd[e].size;i.tB[r]={ND:s.name,XL:c.XL,uD:a,YL:f,lp:Fd[e].count,BD:c.BD,rB:Mot(a),sB:void 0!==h&&h,eB:void 0!==u&&u,VD:n[o]},n[o]+=f}}function zot(t,i){for(var n=t.stateCache,r=i.hB.values(),s=r.next(),e=t.extensions.QL,h=n.qL;!s.done;)e.deleteVertexArrayOES(s.value),h===s.value&&(e.bindVertexArrayOES(null),h=null),s=r.next();n.qL=h,i.hB.clear()}var Wot={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0},Xot=new Cl;function Yot(t,i,n,r,s,e,h){var u=t.gl,o=t.stateCache,c=0;if(n){var a=n.uB;Xot.x=r.x<<a,Xot.y=r.y<<a,Xot.width=r.width<<a,Xot.height=r.height<<a}if(n&&i){var f=n.TD,v=Xot.x,l=Xot.y,d=Xot.width,w=Xot.height;o.TD!==f&&(u.bindFramebuffer(36160,f),o.TD=f);var g=o.oB;g.left===v&&g.top===l&&g.width===d&&g.height===w||(u.viewport(v,l,d,w),g.left=v,g.top=l,g.width=d,g.height=w);var p=o.aB;p.x===v&&p.y===l&&p.width===d&&p.height===w||(u.scissor(v,l,d,w),p.x=v,p.y=l,p.width=d,p.height=w);var _=s.length;t.extensions.SD||(_=1);for(var y=o.fB,m=0;m<_;++m){var b=i.vB[m];if(0!==b.format)switch(b.loadOp){case 0:break;case 1:15!==o.lB.targets[0].blendColorMask&&u.colorMask(!0,!0,!0,!0);var k=s[0];u.clearColor(k.x,k.y,k.z,k.w),c|=16384}}if(i.dB&&0!==i.dB.format){switch(i.dB.depthLoadOp){case 0:break;case 1:y.depthWrite||u.depthMask(!0),u.clearDepth(e),c|=256}if(Fd[i.dB.format].hasStencil)switch(i.dB.stencilLoadOp){case 0:break;case 1:y.stencilWriteMaskFront||u.stencilMaskSeparate(1028,65535),y.stencilWriteMaskBack||u.stencilMaskSeparate(1029,65535),u.clearStencil(h),c|=1024}}if(c&&u.clear(c),16384&c){var A=o.lB.targets[0].blendColorMask;if(15!==A){var E=!!(1&A),T=!!(2&A),O=!!(4&A),S=!!(8&A);u.colorMask(E,T,O,S)}}256&c&&!y.depthWrite&&u.depthMask(!1),1024&c&&(y.stencilWriteMaskFront||u.stencilMaskSeparate(1028,0),y.stencilWriteMaskBack||u.stencilMaskSeparate(1029,0))}}function Kot(t,i,n,r,s,e){var h,u,o,c=t.gl,a=t.stateCache,f=a.fB,v=a.lB,l=i&&i.gB,d=!1;if(i&&Wot.gpuPipelineState!==i){if(Wot.gpuPipelineState=i,Wot.glPrimitive=i.pB,i.gB){var w=i.gB.PD;a.PD!==w&&(c.useProgram(w),a.PD=w,d=!0)}var g=i.hN,p=a.hN;if(g){if(p.cullMode!==g.cullMode){switch(g.cullMode){case 0:c.disable(2884);break;case 1:c.enable(2884),c.cullFace(1028);break;case 2:c.enable(2884),c.cullFace(1029)}p.cullMode=g.cullMode}var _=g.isFrontFaceCCW;p.isFrontFaceCCW!==_&&(c.frontFace(_?2305:2304),p.isFrontFaceCCW=_),p.depthBias===g.depthBias&&p.depthBiasSlop===g.depthBiasSlop||(c.polygonOffset(g.depthBias,g.depthBiasSlop),p.depthBias=g.depthBias,p.depthBiasSlop=g.depthBiasSlop),p.lineWidth!==g.lineWidth&&(c.lineWidth(g.lineWidth),p.lineWidth=g.lineWidth)}var y=i.fB;y&&(f.depthTest!==y.depthTest&&(y.depthTest?c.enable(2929):c.disable(2929),f.depthTest=y.depthTest),f.depthWrite!==y.depthWrite&&(c.depthMask(y.depthWrite),f.depthWrite=y.depthWrite),f.depthFunc!==y.depthFunc&&(c.depthFunc(Cot[y.depthFunc]),f.depthFunc=y.depthFunc),f.stencilTestFront===y.stencilTestFront&&f.stencilTestBack===y.stencilTestBack||(y.stencilTestFront||y.stencilTestBack?c.enable(2960):c.disable(2960),f.stencilTestFront=y.stencilTestFront,f.stencilTestBack=y.stencilTestBack),f.stencilFuncFront===y.stencilFuncFront&&f.stencilRefFront===y.stencilRefFront&&f.stencilReadMaskFront===y.stencilReadMaskFront||(c.stencilFuncSeparate(1028,Cot[y.stencilFuncFront],y.stencilRefFront,y.stencilReadMaskFront),f.stencilFuncFront=y.stencilFuncFront,f.stencilRefFront=y.stencilRefFront,f.stencilReadMaskFront=y.stencilReadMaskFront),f.stencilFailOpFront===y.stencilFailOpFront&&f.stencilZFailOpFront===y.stencilZFailOpFront&&f.stencilPassOpFront===y.stencilPassOpFront||(c.stencilOpSeparate(1028,Not[y.stencilFailOpFront],Not[y.stencilZFailOpFront],Not[y.stencilPassOpFront]),f.stencilFailOpFront=y.stencilFailOpFront,f.stencilZFailOpFront=y.stencilZFailOpFront,f.stencilPassOpFront=y.stencilPassOpFront),f.stencilWriteMaskFront!==y.stencilWriteMaskFront&&(c.stencilMaskSeparate(1028,y.stencilWriteMaskFront),f.stencilWriteMaskFront=y.stencilWriteMaskFront),f.stencilFuncBack===y.stencilFuncBack&&f.stencilRefBack===y.stencilRefBack&&f.stencilReadMaskBack===y.stencilReadMaskBack||(c.stencilFuncSeparate(1029,Cot[y.stencilFuncBack],y.stencilRefBack,y.stencilReadMaskBack),f.stencilFuncBack=y.stencilFuncBack,f.stencilRefBack=y.stencilRefBack,f.stencilReadMaskBack=y.stencilReadMaskBack),f.stencilFailOpBack===y.stencilFailOpBack&&f.stencilZFailOpBack===y.stencilZFailOpBack&&f.stencilPassOpBack===y.stencilPassOpBack||(c.stencilOpSeparate(1029,Not[y.stencilFailOpBack],Not[y.stencilZFailOpBack],Not[y.stencilPassOpBack]),f.stencilFailOpBack=y.stencilFailOpBack,f.stencilZFailOpBack=y.stencilZFailOpBack,f.stencilPassOpBack=y.stencilPassOpBack),f.stencilWriteMaskBack!==y.stencilWriteMaskBack&&(c.stencilMaskSeparate(1029,y.stencilWriteMaskBack),f.stencilWriteMaskBack=y.stencilWriteMaskBack));var m=i.lB;if(m){v.isA2C!==m.isA2C&&(m.isA2C?c.enable(32926):c.disable(32926),v.isA2C=m.isA2C),v.blendColor.x===m.blendColor.x&&v.blendColor.y===m.blendColor.y&&v.blendColor.z===m.blendColor.z&&v.blendColor.w===m.blendColor.w||(c.blendColor(m.blendColor.x,m.blendColor.y,m.blendColor.z,m.blendColor.w),v.blendColor.x=m.blendColor.x,v.blendColor.y=m.blendColor.y,v.blendColor.z=m.blendColor.z,v.blendColor.w=m.blendColor.w);var b=m.targets[0],k=v.targets[0];k.blend!==b.blend&&(b.blend?c.enable(3042):c.disable(3042),k.blend=b.blend),k.blendEq===b.blendEq&&k.blendAlphaEq===b.blendAlphaEq||(c.blendEquationSeparate(Pot[b.blendEq],Pot[b.blendAlphaEq]),k.blendEq=b.blendEq,k.blendAlphaEq=b.blendAlphaEq),k.blendSrc===b.blendSrc&&k.blendDst===b.blendDst&&k.blendSrcAlpha===b.blendSrcAlpha&&k.blendDstAlpha===b.blendDstAlpha||(c.blendFuncSeparate(Lot[b.blendSrc],Lot[b.blendDst],Lot[b.blendSrcAlpha],Lot[b.blendDstAlpha]),k.blendSrc=b.blendSrc,k.blendDst=b.blendDst,k.blendSrcAlpha=b.blendSrcAlpha,k.blendDstAlpha=b.blendDstAlpha),k.blendColorMask!==b.blendColorMask&&(c.colorMask(!!(1&b.blendColorMask),!!(2&b.blendColorMask),!!(4&b.blendColorMask),!!(8&b.blendColorMask)),k.blendColorMask=b.blendColorMask)}}if(i&&i._B&&l){for(var A=l.xD.length,E=i._B.yB,T=0;T<A;T++){var O=l.xD[T],S=r[O.GD],I=S&&S.FL[O.iP],R=I>=0&&S.xL[I],M=null,C=0;if(R&&R.jL){var N=R.jL,P=E[O.GD],L=P&&P[O.iP];L>=0&&(C=s[L]),"vf32"in N?M=N.vf32:(C+=N.VD,M=N.jL.vf32),C>>=2}if(M)for(var D=O.HD.length,B=0;B<D;B++){var F=O.HD[B];switch(F.uD){case 35670:case 5124:for(var U=0;U<F.$D.length;++U){var x=F.VD+C+U;if(M[x]!==F.$D[U]){for(var G=U,j=x;G<F.$D.length;++G,++j)F.$D[G]=M[j];c.uniform1iv(F.FD,F.$D);break}}break;case 35671:case 35667:for(var H=0;H<F.$D.length;++H){var V=F.VD+C+H;if(M[V]!==F.$D[H]){for(var $=H,z=V;$<F.$D.length;++$,++z)F.$D[$]=M[z];c.uniform2iv(F.FD,F.$D);break}}break;case 35672:case 35668:for(var W=0;W<F.$D.length;++W){var X=F.VD+C+W;if(M[X]!==F.$D[W]){for(var Y=W,K=X;Y<F.$D.length;++Y,++K)F.$D[Y]=M[K];c.uniform3iv(F.FD,F.$D);break}}break;case 35673:case 35669:for(var q=0;q<F.$D.length;++q){var Q=F.VD+C+q;if(M[Q]!==F.$D[q]){for(var J=q,Z=Q;J<F.$D.length;++J,++Z)F.$D[J]=M[Z];c.uniform4iv(F.FD,F.$D);break}}break;case 5126:for(var tt=0;tt<F.$D.length;++tt){var it=F.VD+C+tt;if(M[it]!==F.$D[tt]){for(var nt=tt,rt=it;nt<F.$D.length;++nt,++rt)F.$D[nt]=M[rt];c.uniform1fv(F.FD,F.$D);break}}break;case 35664:for(var st=0;st<F.$D.length;++st){var et=F.VD+C+st;if(M[et]!==F.$D[st]){for(var ht=st,ut=et;ht<F.$D.length;++ht,++ut)F.$D[ht]=M[ut];c.uniform2fv(F.FD,F.$D);break}}break;case 35665:for(var ot=0;ot<F.$D.length;++ot){var ct=F.VD+C+ot;if(M[ct]!==F.$D[ot]){for(var at=ot,ft=ct;at<F.$D.length;++at,++ft)F.$D[at]=M[ft];c.uniform3fv(F.FD,F.$D);break}}break;case 35666:for(var vt=0;vt<F.$D.length;++vt){var lt=F.VD+C+vt;if(M[lt]!==F.$D[vt]){for(var dt=vt,wt=lt;dt<F.$D.length;++dt,++wt)F.$D[dt]=M[wt];c.uniform4fv(F.FD,F.$D);break}}break;case 35674:for(var gt=0;gt<F.$D.length;++gt){var pt=F.VD+C+gt;if(M[pt]!==F.$D[gt]){for(var _t=gt,yt=pt;_t<F.$D.length;++_t,++yt)F.$D[_t]=M[yt];c.uniformMatrix2fv(F.FD,!1,F.$D);break}}break;case 35675:for(var mt=0;mt<F.$D.length;++mt){var bt=F.VD+C+mt;if(M[bt]!==F.$D[mt]){for(var kt=mt,At=bt;kt<F.$D.length;++kt,++At)F.$D[kt]=M[At];c.uniformMatrix3fv(F.FD,!1,F.$D);break}}break;case 35676:for(var Et=0;Et<F.$D.length;++Et){var Tt=F.VD+C+Et;if(M[Tt]!==F.$D[Et]){for(var Ot=Et,St=Tt;Ot<F.$D.length;++Ot,++St)F.$D[Ot]=M[St];c.uniformMatrix4fv(F.FD,!1,F.$D);break}}}}}for(var It=l.XD.length,Rt=0;Rt<It;Rt++)for(var Mt=l.XD[Rt],Ct=r[Mt.GD],Nt=Ct&&Ct.FL[Mt.iP],Pt=Nt>=0&&Ct.xL[Nt],Lt=Mt.YD.length,Dt=0;Dt<Lt;Dt++){var Bt=Mt.YD[Dt];if(Pt&&Pt.VL){if(Pt.HL&&Pt.HL.YL>0){var Ft=Pt.HL,Ut=a.vD[Bt];Ut.fD!==Ft.fD&&(a.lD!==Bt&&(c.activeTexture(33984+Bt),a.lD=Bt),Ft.fD?c.bindTexture(Ft.WL,Ft.fD):c.bindTexture(Ft.WL,t.nullTex2D.gpuTexture.fD),Ut.fD=Ft.fD);var xt=Pt.VL;Ft.wD?(h=xt.gD,u=xt.pD):(h=33071,u=33071),o=Ft.wD?Ft.dD<=1&&(9985===xt._D||9987===xt._D)?9729:xt._D:9729===xt._D||9985===xt._D||9987===xt._D?9729:9728,Ft.gD!==h&&(a.lD!==Bt&&(c.activeTexture(33984+Bt),a.lD=Bt),c.texParameteri(Ft.WL,10242,h),Ft.gD=h),Ft.pD!==u&&(a.lD!==Bt&&(c.activeTexture(33984+Bt),a.lD=Bt),c.texParameteri(Ft.WL,10243,u),Ft.pD=u),Ft._D!==o&&(a.lD!==Bt&&(c.activeTexture(33984+Bt),a.lD=Bt),c.texParameteri(Ft.WL,10241,o),Ft._D=o),Ft.yD!==xt.yD&&(a.lD!==Bt&&(c.activeTexture(33984+Bt),a.lD=Bt),c.texParameteri(Ft.WL,10240,xt.yD),Ft.yD=xt.yD)}Pt=Ct.xL[++Nt]}}}if(n&&l&&(d||Wot.gpuInputAssembler!==n)){Wot.gpuInputAssembler=n;var Gt=t.extensions.mB;if(t.extensions.KL){var jt=t.extensions.QL,Ht=n.hB.get(l.PD);if(!Ht){var Vt;Ht=jt.createVertexArrayOES(),n.hB.set(l.PD,Ht),jt.bindVertexArrayOES(Ht),c.bindBuffer(34962,null),c.bindBuffer(34963,null),a.JL=null,a.ZL=null;for(var $t=l.DD.length,zt=0;zt<$t;zt++){var Wt=l.DD[zt];Vt=null;for(var Xt=n.tB.length,Yt=0;Yt<Xt;Yt++){var Kt=n.tB[Yt];if(Kt.ND===Wt.ND){Vt=Kt;break}}if(Vt){a.JL!==Vt.XL&&(c.bindBuffer(34962,Vt.XL),a.JL=Vt.XL);for(var qt=0;qt<Vt.rB;++qt){var Qt=Wt.FD+qt,Jt=Vt.VD+Vt.YL*qt;c.enableVertexAttribArray(Qt),a.bB[Qt]=!0,c.vertexAttribPointer(Qt,Vt.lp,Vt.uD,Vt.sB,Vt.BD,Jt),Gt&&Gt.vertexAttribDivisorANGLE(Qt,Vt.eB?1:0)}}}var Zt=n.kB;Zt&&c.bindBuffer(34963,Zt.XL),jt.bindVertexArrayOES(null),c.bindBuffer(34962,null),c.bindBuffer(34963,null),a.JL=null,a.ZL=null}a.qL!==Ht&&(jt.bindVertexArrayOES(Ht),a.qL=Ht)}else{for(var ti=0;ti<t.capabilities.maxVertexAttributes;++ti)a.bB[ti]=!1;for(var ii=l.DD.length,ni=0;ni<ii;ni++){for(var ri=l.DD[ni],si=null,ei=n.tB.length,hi=0;hi<ei;hi++){var ui=n.tB[hi];if(ui.ND===ri.ND){si=ui;break}}if(si){a.JL!==si.XL&&(c.bindBuffer(34962,si.XL),a.JL=si.XL);for(var oi=0;oi<si.rB;++oi){var ci=ri.FD+oi,ai=si.VD+si.YL*oi;!a.AB[ci]&&ci>=0&&(c.enableVertexAttribArray(ci),a.AB[ci]=!0),a.bB[ci]=!0,c.vertexAttribPointer(ci,si.lp,si.uD,si.sB,si.BD,ai),Gt&&Gt.vertexAttribDivisorANGLE(ci,si.eB?1:0)}}}var fi=n.kB;fi&&a.ZL!==fi.XL&&(c.bindBuffer(34963,fi.XL),a.ZL=fi.XL);for(var vi=0;vi<t.capabilities.maxVertexAttributes;++vi)a.AB[vi]!==a.bB[vi]&&(c.disableVertexAttribArray(vi),a.AB[vi]=!1)}}if(i&&i.EB.length)for(var li=i.EB.length,di=0;di<li;di++)switch(i.EB[di]){case 1:a.hN.lineWidth!==e.lineWidth&&(c.lineWidth(e.lineWidth),a.hN.lineWidth=e.lineWidth);break;case 2:a.hN.depthBias===e.depthBiasConstant&&a.hN.depthBiasSlop===e.depthBiasSlope||(c.polygonOffset(e.depthBiasConstant,e.depthBiasSlope),a.hN.depthBias=e.depthBiasConstant,a.hN.depthBiasSlop=e.depthBiasSlope);break;case 4:var wi=e.blendConstant;v.blendColor.x===wi.x&&v.blendColor.y===wi.y&&v.blendColor.z===wi.z&&v.blendColor.w===wi.w||(c.blendColor(wi.x,wi.y,wi.z,wi.w),v.blendColor.copy(wi));break;case 16:var gi=e.stencilStatesFront,pi=e.stencilStatesBack;f.stencilWriteMaskFront!==gi.writeMask&&(c.stencilMaskSeparate(1028,gi.writeMask),f.stencilWriteMaskFront=gi.writeMask),f.stencilWriteMaskBack!==pi.writeMask&&(c.stencilMaskSeparate(1029,pi.writeMask),f.stencilWriteMaskBack=pi.writeMask);break;case 32:var _i=e.stencilStatesFront,yi=e.stencilStatesBack;f.stencilRefFront===_i.reference&&f.stencilReadMaskFront===_i.compareMask||(c.stencilFuncSeparate(1028,Cot[f.stencilFuncFront],_i.reference,_i.compareMask),f.stencilRefFront=_i.reference,f.stencilReadMaskFront=_i.compareMask),f.stencilRefBack===yi.reference&&f.stencilReadMaskBack===yi.compareMask||(c.stencilFuncSeparate(1029,Cot[f.stencilFuncBack],yi.reference,yi.compareMask),f.stencilRefBack=yi.reference,f.stencilReadMaskBack=yi.compareMask)}}function qot(t,i){var n=t.gl,r=t.extensions,s=r.mB,e=r.TB,h=Wot.gpuInputAssembler,u=Wot.glPrimitive;if(h){var o=h.kB;if(h.OB){var c=h.OB.nD;if(c.SB){for(var a=0;a<c.IB;a++)c.RB[a]=c.MB[a]*o.BD;if(e)c.CB?e.multiDrawElementsInstancedWEBGL(u,c.NB,0,h.PB,c.RB,0,c.LB,0,c.IB):e.multiDrawElementsWEBGL(u,c.NB,0,h.PB,c.RB,0,c.IB);else for(var f=0;f<c.IB;f++)c.LB[f]&&s?s.drawElementsInstancedANGLE(u,c.NB[f],h.PB,c.RB[f],c.LB[f]):n.drawElements(u,c.NB[f],h.PB,c.RB[f])}else if(e)c.CB?e.multiDrawArraysInstancedWEBGL(u,c.MB,0,c.NB,0,c.LB,0,c.IB):e.multiDrawArraysWEBGL(u,c.MB,0,c.NB,0,c.IB);else for(var v=0;v<c.IB;v++)c.LB[v]&&s?s.drawArraysInstancedANGLE(u,c.MB[v],c.NB[v],c.LB[v]):n.drawArrays(u,c.MB[v],c.NB[v])}else if(i.instanceCount&&s)if(o){if(i.indexCount>0){var l=i.firstIndex*o.BD;s.drawElementsInstancedANGLE(u,i.indexCount,h.PB,l,i.instanceCount)}}else i.vertexCount>0&&s.drawArraysInstancedANGLE(u,i.firstVertex,i.vertexCount,i.instanceCount);else if(o){if(i.indexCount>0){var d=i.firstIndex*o.BD;n.drawElements(u,i.indexCount,h.PB,d)}}else i.vertexCount>0&&n.drawArrays(u,i.firstVertex,i.vertexCount)}}function Qot(t,i,n,r){var s=t.gl,e=t.stateCache,h=e.vD[e.lD];h.fD!==n.fD&&(s.bindTexture(n.WL,n.fD),h.fD=n.fD);var u=0,o=0;switch(n.WL){case 3553:for(var c=0;c<r.length;c++){var a=r[c];s.texSubImage2D(3553,a.texSubres.mipLevel,a.texOffset.x,a.texOffset.y,n.sD,n.uD,i[u++])}break;case 34067:for(var f=0;f<r.length;f++){var v=r[f],l=v.texOffset,d=v.texSubres,w=d.baseArrayLayer+d.layerCount;for(o=d.baseArrayLayer;o<w;++o)s.texSubImage2D(34069+o,d.mipLevel,l.x,l.y,n.sD,n.uD,i[u++])}break;default:ht(16327)}1&n.DB&&n.wD&&s.generateMipmap(n.WL)}var Jot=new Uint8Array(1);function Zot(t,i,n,r,s){var e=Xd(i).height,h=Hd(i,s.width,s.height,s.depth),u=Hd(i,r.width,1,1),o=Hd(i,r.width,r.height,1),c=Hd(i,s.width,1,1),a=Wd(Fd[i]);Jot.byteLength<h&&(Jot=new Uint8Array(h));for(var f=0,v=n,l=0;l<s.depth;l++){v=n+o*l;for(var d=0;d<s.height;d+=e)Jot.subarray(f,f+c).set(new Uint8Array(t.buffer,t.byteOffset+v,c)),f+=c,v+=u}var w=h/a.BYTES_PER_ELEMENT;return ot(Number.isInteger(w),9101),new a(Jot.buffer,0,w)}function tct(t,i,n,r){var s=t.gl,e=t.stateCache,h=e.vD[e.lD];h.fD!==n.fD&&(s.bindTexture(n.WL,n.fD),h.fD=n.fD);var u=0,o=0,c=Fd[n.hD],a=Wd(c),f=c.isCompressed,v=Xd(n.hD),l=new Nl,d=new Ml,w=new Nl;switch(n.WL){case 3553:for(var g=0;g<r.length;g++){var p=r[g],_=p.texSubres.mipLevel,y=p.texOffset,m=p.texExtent,b=m.width,k=m.height,A=v.width,E=v.height,T=p.buffStride;d.x=0===y.x?0:Yd(y.x,A),d.y=0===y.y?0:Yd(y.y,E),l.width=b<A?b:Yd(b,A),l.height=k<E?b:Yd(k,E),w.width=T>0?T:l.width,w.height=p.buffTexHeight>0?p.buffTexHeight:l.height;var O=b+d.x===n.oD>>_?b:l.width,S=k+d.y===n.cD>>_?k:l.height,I=void 0,R=i[u++];if(w.width===l.width&&w.height===l.height){var M=Hd(n.hD,O,S,1)/a.BYTES_PER_ELEMENT;ot(Number.isInteger(M),9101),I=new a(R.buffer,R.byteOffset+p.buffOffset,M)}else I=Zot(R,n.hD,p.buffOffset,w,l);f?36196===n.eD||t.extensions.BB?s.compressedTexImage2D(3553,_,n.eD,O,S,0,I):s.compressedTexSubImage2D(3553,_,d.x,d.y,O,S,n.sD,I):s.texSubImage2D(3553,_,d.x,d.y,O,S,n.sD,n.uD,I)}break;case 34067:for(var C=0;C<r.length;C++){var N=r[C],P=N.texSubres.mipLevel,L=N.texOffset,D=N.texExtent,B=N.texSubres,F=D.width,U=D.height,x=v.width,G=v.height;d.x=0===L.x?0:Yd(L.x,x),d.y=0===L.y?0:Yd(L.y,G),l.width=F<x?F:Yd(F,x),l.height=U<G?F:Yd(U,G),w.width=N.buffStride>0?N.buffStride:l.width,w.height=N.buffTexHeight>0?N.buffTexHeight:l.height;var j=F+d.x===n.oD>>P?F:l.width,H=U+d.y===n.cD>>P?U:l.height,V=B.baseArrayLayer+B.layerCount;for(o=B.baseArrayLayer;o<V;++o){var $=void 0,z=i[u++];if(w.width===l.width&&w.height===l.height){var W=Hd(n.hD,j,H,1)/a.BYTES_PER_ELEMENT;ot(Number.isInteger(W),9101),$=new a(z.buffer,z.byteOffset+N.buffOffset,W)}else $=Zot(z,n.hD,N.buffOffset,w,l);f?36196===n.eD||t.extensions.BB?s.compressedTexImage2D(34069+o,P,n.eD,j,H,0,$):s.compressedTexSubImage2D(34069+o,P,d.x,d.y,j,H,n.sD,$):s.texSubImage2D(34069+o,P,d.x,d.y,j,H,n.sD,n.uD,$)}}break;default:ht(16327)}1&n.DB&&s.generateMipmap(n.WL)}function ict(t,i,n,r){var s=t.gl,e=t.stateCache,h=s.createFramebuffer();s.bindFramebuffer(36160,h);var u=0,o=0,c=1,a=1;if(3553===i.WL)for(var f=0;f<r.length;f++){var v=r[f];s.framebufferTexture2D(36160,36064,i.WL,i.fD,v.texSubres.mipLevel),u=v.texOffset.x,o=v.texOffset.y,c=v.texExtent.width,a=v.texExtent.height,s.readPixels(u,o,c,a,i.sD,i.uD,n[f])}else ht(16399);s.bindFramebuffer(36160,null),e.TD=null,s.deleteFramebuffer(h)}function nct(t,i,n,r,s){t.blitManager.FB(i,n,r,s)}var rct=function(){function t(){}return t.UB=function(i){t.se=i},r(t,null,[{key:"instance",get:function(){return t.se}}]),t}();function sct(t){return new Int32Array(t)}rct.se=null;var ect=function(){function t(){this.IB=0,this.SB=!1,this.CB=!1,this.AO=4,this.NB=sct(this.AO),this.MB=sct(this.AO),this.LB=sct(this.AO),this.RB=sct(this.AO)}var i=t.prototype;return i.iD=function(){this.IB=0,this.SB=!1,this.CB=!1},i.rD=function(t,i){this.xB(t),this.SB=i.indexCount>0,this.CB=!!i.instanceCount,this.IB=Math.max(t+1,this.IB),this.SB?(this.NB[t]=i.indexCount,this.MB[t]=i.firstIndex):(this.NB[t]=i.vertexCount,this.MB[t]=i.firstVertex),this.LB[t]=Math.max(1,i.instanceCount)},i.xB=function(t){if(!(this.AO>t)){this.AO=P(t);var i=sct(this.AO),n=sct(this.AO),r=sct(this.AO);this.RB=sct(this.AO),i.set(this.NB),n.set(this.MB),r.set(this.LB),this.NB=i,this.MB=n,this.LB=r}},t}(),hct=function(){function t(){this.GB=null,this.jB=null,this.HB=null,this.VB=null,this.$B=null,this.zB=null,this.WB=null,this.XB=null,this.DL=null,this.YB=null,this.tr=null,this.KB=null,this.qB=null;var t=rct.instance.bindingMappingInfo.maxBlockCounts[0];this.GB={ND:"Blit Pass",UD:[new Zl(0,0,"BlitParams",[new Jl("tilingOffsetSrc",16,1),new Jl("tilingOffsetDst",16,1)],1)],WD:[new td(0,t,"textureSrc",28,1)],zD:[],RD:[{GL:1,CD:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 tilingOffsetSrc;\nuniform vec4 tilingOffsetDst;\nvarying vec2 v_texCoord;\nvoid main() {\n    v_texCoord = a_texCoord * tilingOffsetSrc.xy + tilingOffsetSrc.zw;\n    gl_Position = vec4((a_position + 1.0) * tilingOffsetDst.xy - 1.0 + tilingOffsetDst.zw * 2.0, 0, 1);\n}",MD:null},{GL:16,CD:"\nprecision mediump float;\nuniform sampler2D textureSrc;\nvarying vec2 v_texCoord;\nvoid main() {\n    gl_FragColor = texture2D(textureSrc, v_texCoord);\n}",MD:null}],PD:null,DD:[],jD:[],xD:[],XD:[]},Hot(rct.instance,this.GB),this.jB={BL:[new md(0,1,1,1),new md(t,16,1,16)],QB:[],FL:[],UL:t+1};for(var i=0;i<t;i++)this.jB.FL[i]=0;this.jB.FL.push(1),this.HB={JB:[this.jB],ZB:0,tF:[0],yB:[[]]},this.VB={pB:5,gB:this.GB,_B:this.HB,hN:null,fB:new uw(!1,!1),lB:null,EB:[],iF:null},this.$B={zL:8,$L:1,YL:64,BD:16,tD:null,vf32:null,nD:new ect,WL:0,XL:null},Dot(rct.instance,this.$B),rct.instance.memoryStatus.bufferSize+=this.$B.YL;var n=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);Fot(rct.instance,this.$B,n,0,n.length),this.zB={iB:[new ud("a_position",21),new ud("a_texCoord",21)],nB:[this.$B],kB:null,OB:null,tB:[],PB:0,hB:new Map},$ot(rct.instance,this.zB),this.WB={_D:9728,yD:9728,gD:10497,pD:10497,nF:10497},this.XB={_D:9729,yD:9729,gD:10497,pD:10497,nF:10497},this.qB=new Float32Array(8),this.YB={zL:16,$L:1,YL:32,BD:32,tD:this.qB,vf32:null,nD:new ect,WL:0,XL:null},Dot(rct.instance,this.YB),rct.instance.memoryStatus.bufferSize+=this.YB.YL,this.DL={xL:[{GL:1,jL:this.YB,HL:null,VL:null},{GL:16,jL:null,HL:null,VL:null}],FL:this.jB.FL},this.tr=new Wl(4,0,0,0,0,0,0),this.KB=rct.instance.gl.createFramebuffer()}var i=t.prototype;return i.Ww=function(){this.KB&&(rct.instance.gl.deleteFramebuffer(this.KB),this.KB=null),this.$B&&(rct.instance.memoryStatus.bufferSize-=this.$B.YL,Bot(rct.instance,this.$B)),this.YB&&(rct.instance.memoryStatus.bufferSize-=this.YB.YL,Bot(rct.instance,this.YB)),this.GB&&Vot(rct.instance,this.GB),this.zB&&zot(rct.instance,this.zB)},i.FB=function(t,i,n,r){var s=rct.instance,e=s.gl,h=s.stateCache,u=h.TD;if(e.viewport(0,0,i.oD,i.cD),e.scissor(0,0,i.oD,i.cD),this.qB&&this.YB&&this.VB&&this.zB&&this.DL&&this.tr){var o=this.DL.xL[1];o.HL=t,o.VL=1===r?this.WB:this.XB;var c=Fd[i.hD],a=36064;c.hasStencil?a=33306:c.hasDepth&&(a=36096);var f=n.map((function(t,i){return i}));f.sort((function(t,i){return n[t].srcSubres.mipLevel-n[i].srcSubres.mipLevel})),h.TD!==this.KB&&(e.bindFramebuffer(36160,this.KB),h.TD=this.KB);var v=n[0].dstSubres.mipLevel;i.fD?e.framebufferTexture2D(36160,a,i.WL,i.fD,v):e.framebufferRenderbuffer(36160,a,36161,i.mD);for(var l=0;l<f.length;++l){var d=n[f[l]];t.fD&&v!==d.srcSubres.mipLevel&&(v=d.srcSubres.mipLevel,e.framebufferTexture2D(36160,a,i.WL,i.fD,v));var w=t.oD,g=t.cD,p=i.oD,_=i.cD;this.qB[0]=d.srcExtent.width/w,this.qB[1]=d.srcExtent.height/g,this.qB[2]=d.srcOffset.x/w,this.qB[3]=d.srcOffset.y/g,this.qB[4]=d.dstExtent.width/p,this.qB[5]=d.dstExtent.height/_,this.qB[6]=d.dstOffset.x/p,this.qB[7]=d.dstOffset.y/_,Fot(s,this.YB,this.qB,0,4*this.qB.length),Kot(s,this.VB,this.zB,[this.DL],[],null),qot(s,this.tr)}h.TD!==u&&(e.bindFramebuffer(36160,u),h.TD=u);var y=h.oB;e.viewport(y.left,y.top,y.width,y.height);var m=h.aB;e.scissor(m.x,m.y,m.width,m.height)}},t}(),uct=function(t){function i(){var i;return(i=t.call(this)||this).rF=null,i.sF=null,i.qB=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){if("buffer"in t){this.gn=!0;var i=t.buffer;this.vn=i.usage,this.ln=i.memUsage,this.dn=this.wn=t.range,this.nt=1,this.Xt=i.flags,this.sF={jL:i.gpuBuffer,VD:t.offset,eF:t.range}}else this.vn=t.usage,this.ln=t.memUsage,this.dn=t.size,this.wn=Math.max(t.stride||this.dn,1),this.nt=this.dn/this.wn,this.Xt=t.flags,16&this.vn&&this.dn>0&&(this.qB=new Uint8Array(this.dn)),this.rF={zL:this.vn,$L:this.ln,YL:this.dn,BD:this.wn,tD:null,vf32:null,nD:new ect,WL:0,XL:null},16&this.vn&&(this.rF.tD=this.qB),Dot(rct.instance,this.rF),rct.instance.memoryStatus.bufferSize+=this.dn},n.destroy=function(){this.rF&&(Bot(rct.instance,this.rF),rct.instance.memoryStatus.bufferSize-=this.dn,this.rF=null),this.sF&&(this.sF=null)},n.resize=function(t){if(this.gn)st(16379);else{var i,n,r,s,e,h=this.dn;h!==t&&(this.dn=t,this.nt=this.dn/this.wn,this.qB&&(this.qB=new Uint8Array(t)),this.rF&&(this.qB&&(this.rF.tD=this.qB),this.rF.YL=t,t>0&&(i=rct.instance,n=this.rF,r=i.gl,s=i.stateCache,e=2&n.$L?35048:35044,8&n.zL?(i.extensions.KL&&s.qL&&(i.extensions.QL.bindVertexArrayOES(null),s.qL=null),Wot.gpuInputAssembler=null,s.JL!==n.XL&&r.bindBuffer(34962,n.XL),n.tD?r.bufferData(34962,n.tD,e):r.bufferData(34962,n.YL,e),r.bindBuffer(34962,null),s.JL=null):4&n.zL?(i.extensions.KL&&s.qL&&(i.extensions.QL.bindVertexArrayOES(null),s.qL=null),Wot.gpuInputAssembler=null,s.ZL!==n.XL&&r.bindBuffer(34963,n.XL),n.tD?r.bufferData(34963,n.tD,e):r.bufferData(34963,n.YL,e),r.bindBuffer(34963,null),s.ZL=null):16&n.zL?n.tD&&(n.vf32=new Float32Array(n.tD.buffer)):(64&n.zL||2&n.zL||1&n.zL||ht(16315),n.WL=0),rct.instance.memoryStatus.bufferSize-=h,rct.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,i){var n;this.gn?st(16380):(n=void 0!==i?i:64&this.vn?0:t.byteLength,Fot(rct.instance,this.rF,t,0,n))},r(i,[{key:"gpuBuffer",get:function(){return this.rF}},{key:"gpuBufferView",get:function(){return this.sF}}]),i}(qd),oct=function(t){function i(){var i;return(i=t.call(this)||this).hF=!1,i.uF=null,i.oF=null,i.aF=[],i.fF=Array(8).fill(0),i.vF=new Cd,i.lF=!1,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.C=t.type,this.pn=t.queue;for(var i=rct.instance.bindingMappings.dF.length,n=0;n<i;n++)this.aF.push(null)},n.destroy=function(){},n.begin=function(){this.uF=null,this.oF=null,this.aF.length=0,this._n=0,this.yn=0,this.mn=0},n.end=function(){this.lF&&this.wF(),this.hF=!1},n.beginRenderPass=function(){ht(16401),this.hF=!0},n.endRenderPass=function(){this.hF=!1},n.bindPipelineState=function(t){var i=t.gpuPipelineState;i!==this.uF&&(this.uF=i,this.lF=!0)},n.bindDescriptorSet=function(t,i,n){var r=i.gpuDescriptorSet;if(r!==this.aF[t]&&(this.aF[t]=r,this.lF=!0),n){var s,e=null==(s=this.uF)?void 0:s._B;if(e){for(var h=this.fF,u=e.tF[t],o=0;o<n.length;o++)h[u+o]=n[o];this.lF=!0}}},n.bindInputAssembler=function(t){var i=t.gF();this.oF=i,this.lF=!0},n.setViewport=function(t){var i=this.vF.viewport;i.left===t.left&&i.top===t.top&&i.width===t.width&&i.height===t.height&&i.minDepth===t.minDepth&&i.maxDepth===t.maxDepth||(i.left=t.left,i.top=t.top,i.width=t.width,i.height=t.height,i.minDepth=t.minDepth,i.maxDepth=t.maxDepth,this.lF=!0)},n.setScissor=function(t){var i=this.vF.scissor;i.x===t.x&&i.y===t.y&&i.width===t.width&&i.height===t.height||(i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,this.lF=!0)},n.setLineWidth=function(t){this.vF.lineWidth!==t&&(this.vF.lineWidth=t,this.lF=!0)},n.setDepthBias=function(t,i,n){var r=this.vF;r.depthBiasConstant===t&&r.depthBiasClamp===i&&r.depthBiasSlope===n||(r.depthBiasConstant=t,r.depthBiasClamp=i,r.depthBiasSlope=n,this.lF=!0)},n.setBlendConstants=function(t){var i=this.vF.blendConstant;i.x===t.x&&i.y===t.y&&i.z===t.z&&i.w===t.w||(i.copy(t),this.lF=!0)},n.setDepthBound=function(t,i){var n=this.vF;n.depthMinBounds===t&&n.depthMaxBounds===i||(n.depthMinBounds=t,n.depthMaxBounds=i,this.lF=!0)},n.setStencilWriteMask=function(t,i){var n=this.vF.stencilStatesFront,r=this.vF.stencilStatesBack;1&t&&n.writeMask!==i&&(n.writeMask=i,this.lF=!0),2&t&&r.writeMask!==i&&(r.writeMask=i,this.lF=!0)},n.setStencilCompareMask=function(t,i,n){var r=this.vF.stencilStatesFront,s=this.vF.stencilStatesBack;1&t&&(r.compareMask===n&&r.reference===i||(r.reference=i,r.compareMask=n,this.lF=!0)),2&t&&(s.compareMask===n&&s.reference===i||(s.reference=i,s.compareMask=n,this.lF=!0))},n.draw=function(){ht(16328)},n.updateBuffer=function(){ht(16329)},n.copyBuffersToTexture=function(){ht(16330)},n.execute=function(){ht(16402)},n.pipelineBarrier=function(){},n.wF=function(){ht(16401)},n.blitTexture=function(){ht(16401)},i}(Qd),cct=function(t){e(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this).pF=null,i._F=[],i.yF=void 0,i}return i.mF=function(){return this.pF},i.initialize=function(t){var i,n=this;this.zn=t.renderPass,this.Wn=t.colorTextures||[];for(var r=this.$n=t.depthStencilTexture||null,s=0,e=[],h=0;h<t.colorTextures.length;++h){var u=t.colorTextures[h];u&&(e.push(u.gpuTexture),s=u.lodLevel)}var o=null;r&&(o=r.gpuTexture,s=r.lodLevel);var c=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;this.pF={iF:t.renderPass.gpuRenderPass,kD:e,OD:o,TD:null,ED:!0,get width(){return this.kD.length>0?this.kD[0].oD:this.OD?this.OD.oD:c},set width(t){c=t},get height(){return this.kD.length>0?this.kD[0].cD:this.OD?this.OD.cD:a},set height(t){a=t},uB:s},jot(rct.instance,this.pF),this.pF.kD.forEach((function(t){return n._F.push(t.fD)})),this.yF=null==(i=this.pF.OD)?void 0:i.fD,this.Xn=this.pF.oD,this.Yn=this.pF.cD},i.destroy=function(){var t,i,n,r;this.pF&&(t=rct.instance,i=this.pF,n=t.gl,r=t.stateCache,i.TD&&(n.deleteFramebuffer(i.TD),r.TD===i.TD&&(n.bindFramebuffer(36160,null),r.TD=null),i.TD=null),this.pF=null,this._F.length=0,this.yF=null)},r(n,[{key:"needRebuild",get:function(){var t=this.pF;if(t){for(var i,n=0;n<t.kD.length;n++)if(t.kD[n].fD!==this._F[n])return!0;if((null==(i=t.OD)?void 0:i.fD)!==this.yF)return!0}return!1}}]),n}(iw),act=function(t){e(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this).zB=null,i}return i.gF=function(){return this.zB},i.initialize=function(t){if(0!==t.vertexBuffers.length){if(this.Kn=t.attributes,this.qn=this.computeAttributesHash(),this.Qn=t.vertexBuffers,t.indexBuffer)this.Jn=t.indexBuffer,this.tr.indexCount=this.Jn.size/this.Jn.stride,this.tr.firstIndex=0;else{var i=this.Qn[0];this.tr.vertexCount=i.size/i.stride,this.tr.firstVertex=0,this.tr.vertexOffset=0}this.tr.instanceCount=0,this.tr.firstInstance=0,this.Zn=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),r=0;r<t.vertexBuffers.length;++r){var s=t.vertexBuffers[r];s.gpuBuffer&&(n[r]=s.gpuBuffer)}var e=null,h=0;if(t.indexBuffer&&(e=t.indexBuffer.gpuBuffer))switch(e.BD){case 1:h=5121;break;case 2:h=5123;break;case 4:h=5125;break;default:ht(16332)}var u=null;t.indirectBuffer&&(u=t.indirectBuffer.gpuBuffer),this.zB={iB:t.attributes,nB:n,kB:e,OB:u,tB:[],PB:h,hB:new Map},$ot(rct.instance,this.zB)}else ht(16331)},i.destroy=function(){var t=rct.instance;this.zB&&t.extensions.KL&&zot(t,this.zB),this.zB=null},n}(nw),fct=function(t){function i(){var i;return(i=t.call(this)||this).jB=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){Array.prototype.push.apply(this.hr,t.bindings);for(var i=0,n=-1,r=[],s=0;s<this.hr.length;s++){var e=this.hr[s];r.push(i),i+=e.count,e.binding>n&&(n=e.binding)}this.ur=Array(n+1).fill(-1);for(var h=this.cr=Array(n+1).fill(-1),u=0;u<this.hr.length;u++){var o=this.hr[u];this.ur[o.binding]=u,h[o.binding]=r[u]}for(var c=[],a=0;a<this.hr.length;a++){var f=this.hr[a];if(10&f.descriptorType)for(var v=0;v<f.count;v++)c.push(f.binding)}this.jB={BL:this.hr,QB:c,FL:h,UL:i}},n.destroy=function(){this.hr.length=0},r(i,[{key:"gpuDescriptorSetLayout",get:function(){return this.jB}}]),i}(sw),vct=function(t){function i(){var i;return(i=t.call(this)||this).HB=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){Array.prototype.push.apply(this.vr,t.setLayouts);for(var i=[],n=[],r=0,s=[],e=0;e<this.vr.length;e++){for(var h=this.vr[e],u=h.gpuDescriptorSetLayout.QB,o=Array(h.bindingIndices.length).fill(-1),c=0;c<u.length;c++){var a=u[c];o[a]<0&&(o[a]=r+c)}n.push(h.gpuDescriptorSetLayout),i.push(o),s.push(r),r+=u.length}this.HB={JB:n,yB:i,ZB:r,tF:s}},n.destroy=function(){this.vr.length=0},r(i,[{key:"gpuPipelineLayout",get:function(){return this.HB}}]),i}(ew),lct=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],dct=function(t){function i(){var i;return(i=t.call(this)||this).VB=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.wr=t.primitive,this.lr=t.shader,this.dr=t.pipelineLayout;var i=this.yr;if(t.blendState){var n=t.blendState,r=n.targets;r&&r.forEach((function(t,n){i.setTarget(n,t)})),void 0!==n.isA2C&&(i.isA2C=n.isA2C),void 0!==n.isIndepend&&(i.isIndepend=n.isIndepend),void 0!==n.blendColor&&(i.blendColor=n.blendColor)}Object.assign(this.pr,t.rasterizerState),Object.assign(this._r,t.depthStencilState),this.gr=t.inputState,this.zn=t.renderPass,this.mr=t.dynamicStates;for(var s=[],e=0;e<31;e++)this.mr&1<<e&&s.push(1<<e);this.VB={pB:lct[t.primitive],gB:t.shader.gpuShader,_B:t.pipelineLayout.gpuPipelineLayout,hN:t.rasterizerState,fB:t.depthStencilState,lB:t.blendState,iF:t.renderPass.gpuRenderPass,EB:s}},n.destroy=function(){this.VB=null},r(i,[{key:"gpuPipelineState",get:function(){return this.VB}}]),i}(fw),wct=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.beginRenderPass=function(t,i,n,r,s,e){Yot(rct.instance,t.gpuRenderPass,i.mF(),n,r,s,e),this.hF=!0},n.draw=function(t){if(this.hF){this.lF&&this.wF();var i="drawInfo"in t?t.drawInfo:t;qot(rct.instance,i),++this._n,this.yn+=i.instanceCount;var n=i.indexCount||i.vertexCount;if(this.uF)switch(this.uF.pB){case 4:this.mn+=n/3*Math.max(i.instanceCount,1);break;case 5:case 6:this.mn+=(n-2)*Math.max(i.instanceCount,1)}}else ht(16328)},n.setViewport=function(t){var i=rct.instance,n=i.stateCache,r=i.gl;n.oB.left===t.left&&n.oB.top===t.top&&n.oB.width===t.width&&n.oB.height===t.height||(r.viewport(t.left,t.top,t.width,t.height),n.oB.left=t.left,n.oB.top=t.top,n.oB.width=t.width,n.oB.height=t.height)},n.setScissor=function(t){var i=rct.instance,n=i.stateCache,r=i.gl;n.aB.x===t.x&&n.aB.y===t.y&&n.aB.width===t.width&&n.aB.height===t.height||(r.scissor(t.x,t.y,t.width,t.height),n.aB.x=t.x,n.aB.y=t.y,n.aB.width=t.width,n.aB.height=t.height)},n.updateBuffer=function(t,i,n){if(this.hF)ht(16329);else{var r,s=t.gpuBuffer;s&&(r=void 0!==n?n:64&t.usage?0:i.byteLength,Fot(rct.instance,s,i,0,r))}},n.copyBuffersToTexture=function(t,i,n){if(this.hF)ht(16330);else{var r=i.gpuTexture;r&&tct(rct.instance,t,r,n)}},n.execute=function(){ht(16402)},n.wF=function(){Kot(rct.instance,this.uF,this.oF,this.aF,this.fF,this.vF),this.lF=!1},n.blitTexture=function(t,i,n,r){var s=t.gpuTexture,e=i.gpuTexture;nct(rct.instance,s,e,n,r)},i}(oct),gct=function(t){function i(){var i;return(i=t.call(this)||this).bF=0,i.kF=0,i.AF=0,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.C=t.type},n.destroy=function(){},n.submit=function(t){for(var i=t.length,n=0;n<i;n++){var r=t[n];this.bF+=r.numDrawCalls,this.kF+=r.numInstances,this.AF+=r.numTris}},n.l_=function(){this.bF=0,this.kF=0,this.AF=0},i}(vw),pct=function(t){function i(){var i;return(i=t.call(this)||this).EF=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.kr=t.colorAttachments,this.Ar=t.depthStencilAttachment,this.Er=t.subpasses,this.EF={vB:this.kr,dB:this.Ar},this.Tr=this.computeHash()},n.destroy=function(){this.EF=null},r(i,[{key:"gpuRenderPass",get:function(){return this.EF}}]),i}(lw),_ct=[10497,33648,33071,33071],yct=function(t){function i(i,n){var r;(r=t.call(this,i,n)||this).TF=null;var s,e,h=r.Or.minFilter,u=r.Or.magFilter,o=r.Or.mipFilter;s=2===h||3===h?2===o||3===o?9987:1===o?9985:9729:2===o||3===o?9986:1===o?9984:9728,e=2===u||3===u?9729:9728;var c=_ct[r.Or.addressU],a=_ct[r.Or.addressV],f=_ct[r.Or.addressW];return r.TF={_D:s,yD:e,gD:c,pD:a,nF:f},r}return e(i,t),r(i,[{key:"gpuSampler",get:function(){return this.TF}}]),i}(dw),mct=function(t){function i(){var i;return(i=t.call(this)||this).GB=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.Sr=t.name,this.Ir=t.stages,this.Kn=t.attributes,this.Rr=t.blocks,this.Cn=t.samplers,this.GB={ND:t.name,UD:t.blocks.slice(),WD:t.samplerTextures.slice(),zD:t.subpassInputs.slice(),RD:new Array(t.stages.length),PD:null,DD:[],jD:[],xD:[],XD:[]};for(var i=0;i<t.stages.length;++i){var n=t.stages[i];this.GB.RD[i]={GL:n.stage,CD:n.source,MD:null}}},n.destroy=function(){this.GB&&(Vot(rct.instance,this.GB),this.GB=null)},r(i,[{key:"gpuShader",get:function(){return null===this.GB.PD&&Hot(rct.instance,this.GB),this.GB}}]),i}(ww),bct=function(){function t(){this.JL=null,this.ZL=null,this.qL=null,this.lD=0,this.vD=[],this.mD=null,this.TD=null,this.oB=new Ul,this.aB=new Cl(0,0,0,0),this.hN=new hw,this.fB=new uw,this.lB=new cw,this.PD=null,this.AB=[],this.bB=[],this.QD={}}return t.prototype.Se=function(t,i){for(var n=0;n<t;++n)this.vD.push({fD:null});this.AB.length=i,this.AB.fill(!1),this.bB.length=i,this.bB.fill(!1)},t}(),kct=function(t){function i(){var i;return(i=t.call(this)||this).OF=null,i.SF=0,i}e(i,t);var n=i.prototype;return n.initialize=function(t,i){var n=this,r=rct.instance,s=t,e=t;"texture"in t&&(s=e.texture.info,n.Nr=!0);var h=n.Or;h.copy(s);var u=n.Mr;n.Cr=Gd(h.width)&&Gd(h.height),n.dn=Vd(h.format,n.width,n.height,n.depth,h.levelCount)*h.layerCount,n.Nr?(u.copy(e),n.SF=e.baseLevel,n.OF=e.texture.OF):(n.OF={GL:s.type,hD:s.format,zL:s.usage,oD:s.width,cD:s.height,IF:s.depth,YL:n.dn,RF:s.layerCount,dD:s.levelCount,MF:s.samples,DB:s.flags,wD:n.Cr,WL:0,eD:0,sD:0,uD:0,CF:0,fD:null,mD:null,gD:0,pD:0,_D:0,yD:0,AD:i||!1},n.OF.AD||(Uot(r,n.OF),r.memoryStatus.textureSize+=n.dn),u.texture=n,u.type=t.type,u.format=t.format,u.baseLevel=0,u.levelCount=t.levelCount,u.baseLayer=0,u.layerCount=t.layerCount)},n.destroy=function(){var t=this,i=rct.instance;!t.Nr&&t.OF&&(xot(i,t.OF),i.memoryStatus.textureSize-=t.dn,t.OF=null)},n.getTextureHandle=function(){var t=this.OF;return t?t.fD?t.fD:t.mD?t.mD:0:0},n.resize=function(t,n){var r=this,s=rct.instance,e=r.Or;if(e.width!==t||e.height!==n){e.levelCount===i.getLevelCount(e.width,e.height)?e.levelCount=i.getLevelCount(t,n):e.levelCount>1&&(e.levelCount=Math.min(e.levelCount,i.getLevelCount(t,n)));var h=r.dn;e.width=t,e.height=n,r.dn=Vd(e.format,r.width,r.height,r.depth,e.levelCount)*e.layerCount;var u=r.OF;!r.Nr&&u&&(u.oD=t,u.cD=n,u.YL=r.dn,u.AD||(Got(s,u),s.memoryStatus.textureSize-=h,s.memoryStatus.textureSize+=r.dn))}},n.initAsSwapchainTexture=function(t){var i=new Kl;i.format=t.format,i.usage=Fd[t.format].hasDepth?32:16,i.width=t.width,i.height=t.height,this.initialize(i,!0)},r(i,[{key:"gpuTexture",get:function(){return this.OF}},{key:"lodLevel",get:function(){return this.SF}}]),i}(gw),Act="webglcontextlost";function Ect(t){t.activeTexture(33984),t.pixelStorei(3333,1),t.pixelStorei(3317,1),t.pixelStorei(37440,!1),t.bindFramebuffer(36160,null),t.enable(3089),t.enable(2884),t.cullFace(1029),t.frontFace(2305),t.disable(32823),t.polygonOffset(0,0),t.enable(2929),t.depthMask(!0),t.depthFunc(513),t.depthRange(0,1),t.stencilFuncSeparate(1028,519,1,65535),t.stencilOpSeparate(1028,7680,7680,7680),t.stencilMaskSeparate(1028,65535),t.stencilFuncSeparate(1029,519,1,65535),t.stencilOpSeparate(1029,7680,7680,7680),t.stencilMaskSeparate(1029,65535),t.disable(2960),t.disable(32926),t.disable(3042),t.blendEquationSeparate(32774,32774),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}function Tct(t,i){for(var n=["","WEBKIT_","MOZ_"],r=0;r<n.length;++r){var s=t.getExtension(n[r]+i);if(s)return s}return null}function Oct(t){var i={NF:Tct(t,"EXT_texture_filter_anisotropic"),PF:Tct(t,"EXT_blend_minmax"),LF:Tct(t,"EXT_frag_depth"),DF:Tct(t,"EXT_shader_texture_lod"),BF:Tct(t,"EXT_sRGB"),QL:Tct(t,"OES_vertex_array_object"),FF:Tct(t,"EXT_color_buffer_half_float"),UF:Tct(t,"WEBGL_color_buffer_float"),xF:Tct(t,"WEBGL_compressed_texture_etc1"),GF:Tct(t,"WEBGL_compressed_texture_etc"),jF:Tct(t,"WEBGL_compressed_texture_pvrtc"),HF:Tct(t,"WEBGL_compressed_texture_s3tc"),VF:Tct(t,"WEBGL_compressed_texture_s3tc_srgb"),$F:Tct(t,"WEBGL_debug_shaders"),SD:Tct(t,"WEBGL_draw_buffers"),zF:Tct(t,"WEBGL_lose_context"),aD:Tct(t,"WEBGL_depth_texture"),WF:Tct(t,"OES_texture_half_float"),XF:Tct(t,"OES_texture_half_float_linear"),YF:Tct(t,"OES_texture_float"),KF:Tct(t,"OES_texture_float_linear"),qF:Tct(t,"OES_standard_derivatives"),QF:Tct(t,"OES_element_index_uint"),mB:Tct(t,"ANGLE_instanced_arrays"),JF:Tct(t,"WEBGL_debug_renderer_info"),TB:null,ZF:null,LD:!0,BB:!1,qD:function(t){return!!t},KL:!1};return wh.os===ch.IOS&&14===wh.osMainVersion&&wh.isBrowser||(i.ZF=Tct(t,"WEBGL_compressed_texture_astc")),wh.os!==ch.ANDROID&&wh.os!==ch.IOS&&(i.TB=Tct(t,"WEBGL_multi_draw")),wh.browserType===hh.UC&&(i.mB=null),wh.os===ch.IOS&&wh.osMainVersion<=10&&(i.LD=!1),i.QL&&(i.KL=!0),i}function Sct(t){var i=null;try{var n={alpha:Si.ENABLE_TRANSPARENT_CANVAS,antialias:Si.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};i=t.getContext("webgl",n)}catch(t){return null}return i}var Ict=function(t){function i(){var i;return(i=t.call(this)||this).tU=new bct,i.iU=null,i.nU=null,i.Dr=null,i.rU=null,i.sU=null,i.eU=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){var i=this;i.Dr=t.windowHandle,i.rU=i.hU.bind(i),i.Dr.addEventListener(Act,i.rU);var n=rct.instance,r=n.gl,s=n.capabilities;i.tU.Se(s.maxTextureUnits,s.maxVertexAttributes),i.sU=Oct(r),Ect(r);var e=55,h=r.getParameter(3414),u=r.getParameter(3415);h&&u?e=55:h&&(e=54),i.Vn=new kct,i.Vn.initAsSwapchainTexture({swapchain:i,format:35,width:t.width,height:t.height}),i.$n=new kct,i.$n.initAsSwapchainTexture({swapchain:i,format:e,width:t.width,height:t.height}),i.iU=n.createTexture(new Kl(1,4,35,2,2,1)),i.nU=n.createTexture(new Kl(3,4,35,2,2,1,6));var o=new Fl;o.texExtent.width=2,o.texExtent.height=2;var c=new Uint8Array(i.iU.size);c.fill(0),n.copyBuffersToTexture([c],i.iU,[o]),o.texSubres.layerCount=6,n.copyBuffersToTexture([c,c,c,c,c,c],i.nU,[o]),i.eU=new hct},n.destroy=function(){var t=this;t.Dr&&t.rU&&(t.Dr.removeEventListener(Act,t.rU),t.rU=null),t.iU&&(t.iU.destroy(),t.iU=null),t.nU&&(t.nU.destroy(),t.nU=null),t.eU&&(t.eU.Ww(),t.eU=null),t.sU=null,t.Dr=null},n.resize=function(t,i){var n=this;n.Vn.width===t&&n.Vn.height===i||(K("Resizing swapchain: "+t+"x"+i),n.Dr.width=t,n.Dr.height=i,n.Vn.resize(t,i),n.$n.resize(t,i))},n.hU=function(t){st(11e3),W(t)},r(i,[{key:"extensions",get:function(){return this.sU}},{key:"blitManager",get:function(){return this.eU}}]),i}(tw);function Rct(t,i,n){for(var r=0;r<i.length;++r)t[i[r]]=n}function Mct(t,i,n){for(var r=0;r<i.length;++r)t[i[r]]|=n}function Cct(t,i,n){for(var r=0;r<i.length;++r)t[i[r]]=n}var Nct=t("e9",function(t){function i(){var i;return(i=t.call(this)||this).Br=null,i.Gs=null,i.uU=null,i.oU=new Array(117),i}e(i,t);var n=i.prototype;return n.initialize=function(t){rct.UB(this),this.kn=6;var i=this.Mn=t.bindingMappingInfo,n=[],r=[],s=i.setIndices[0];n[s]=0,r[s]=0;for(var e=1;e<i.setIndices.length;++e){var h=i.setIndices[e],u=i.setIndices[e-1];n[h]=i.maxBlockCounts[u]+n[u],r[h]=i.maxSamplerTextureCounts[u]+r[u]}for(var o=0;o<i.setIndices.length;++o){var c=i.setIndices[o];r[c]-=i.maxBlockCounts[c]}this.uU={dF:n,ZD:r,JD:i.setIndices[i.setIndices.length-1]};var a=this.Gs=Sct(Jd.Bn);if(!a)return ht(16333),!1;this.pn=this.createQueue(new Od(0)),this.Sn=this.createCommandBuffer(new Td(this.pn));var f=a.getParameter.bind(a),v=this.Rn;v.maxVertexAttributes=f(34921),v.maxVertexUniformVectors=f(36347),v.maxFragmentUniformVectors=f(36349),v.maxTextureUnits=f(34930),v.maxVertexTextureUnits=f(35660),v.maxTextureSize=f(3379),v.maxCubeMapTextureSize=f(34076),v.maxArrayTextureLayers=0,v.max3DTextureSize=0,v.maxUniformBufferBindings=16;var l=a.getSupportedExtensions(),d="";l&&l.forEach((function(t){d+=t+" "}));var w=Oct(a);w.JF?(this.An=f(w.JF.UNMASKED_RENDERER_WEBGL),this.En=f(w.JF.UNMASKED_VENDOR_WEBGL)):(this.An=f(7937),this.En=f(7936));var g=f(7938),p=this.Tn;p.fill(!1),this.cU(w),w.PF&&(p[3]=!0),w.QF&&(p[0]=!0),w.mB&&(p[1]=!0),w.SD&&(p[2]=!0);var _="";return this.getFormatFeatures(72)&&(_+="etc1 "),this.getFormatFeatures(73)&&(_+="etc2 "),this.getFormatFeatures(56)&&(_+="dxt "),this.getFormatFeatures(83)&&(_+="pvrtc "),this.getFormatFeatures(89)&&(_+="astc "),K("WebGL device initialized."),K("RENDERER: "+this.An),K("VENDOR: "+this.En),K("VERSION: "+g),K("COMPRESSED_FORMAT: "+_),K("EXTENSIONS: "+d),!0},n.destroy=function(){this.pn&&(this.pn.destroy(),this.pn=null),this.Sn&&(this.Sn.destroy(),this.Sn=null),this.Br=null},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this.pn;this._n=t.bF,this.yn=t.kF,this.mn=t.AF,t.l_()},n.cU=function(t){var i=this.On;i.fill(0);var n=this.oU;n.fill(!0),Rct(i,[24,47,35,50,49],7),Rct(i,[54,55],1),Cct(n,[47,50,49,54,55],!1),Mct(i,[7,17,28,40,6,16,27,39,7,17,28,40,6,16,27,39,11,21,32,44],16),t.BF&&(i[25]=7,i[37]=7,n[37]=!1),t.aD&&(i[54]|=7,i[55]|=7),t.UF&&(i[32]|=1,i[44]|=1,n[32]=!1,n[44]=!1),t.FF&&(i[29]|=1,i[41]|=1,n[29]=!1,n[41]=!1),t.YF&&(i[32]|=3,i[44]|=3),t.WF&&(i[29]|=3,i[41]|=3),t.KF&&(i[32]|=4,i[44]|=4),t.XF&&(i[29]|=4,i[41]|=4),t.xF&&(i[72]=6),t.GF&&Rct(i,[73,77,74,78,75,76],6),t.HF&&Rct(i,[56,57,58,59,60,61,62,63],6),t.jF&&Mct(i,[83,84,85,86],6),t.ZF&&Mct(i,[89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116],6)},n.createCommandBuffer=function(t){var i=new(0===t.type?wct:oct);return i.initialize(t),i},n.createSwapchain=function(t){var i=new Ict;return this.Br=i,i.initialize(t),i},n.createBuffer=function(t){var i=new uct;return i.initialize(t),i},n.createTexture=function(t){var i=new kct;return i.initialize(t),i},n.createDescriptorSet=function(t){var i=new mot;return i.initialize(t),i},n.createShader=function(t){var i=new mct;return i.initialize(t),i},n.createInputAssembler=function(t){var i=new act;return i.initialize(t),i},n.createRenderPass=function(t){var i=new pct;return i.initialize(t),i},n.createFramebuffer=function(t){var i=new cct;return i.initialize(t),i},n.createDescriptorSetLayout=function(t){var i=new fct;return i.initialize(t),i},n.createPipelineLayout=function(t){var i=new vct;return i.initialize(t),i},n.createPipelineState=function(t){var i=new dct;return i.initialize(t),i},n.createQueue=function(t){var i=new gct;return i.initialize(t),i},n.getSampler=function(t){var i=dw.computeHash(t);return this.Cn.has(i)||this.Cn.set(i,new yct(t,i)),this.Cn.get(i)},n.getSwapchains=function(){return[this.Br]},n.getGeneralBarrier=function(t){var i=pw.computeHash(t);return this.Nn.has(i)||this.Nn.set(i,new pw(t,i)),this.Nn.get(i)},n.getTextureBarrier=function(t){var i=_w.computeHash(t);return this.Pn.has(i)||this.Pn.set(i,new _w(t,i)),this.Pn.get(i)},n.getBufferBarrier=function(t){var i=yw.computeHash(t);return this.Ln.has(i)||this.Ln.set(i,new yw(t,i)),this.Ln.get(i)},n.copyBuffersToTexture=function(t,i,n){tct(this,t,i.gpuTexture,n)},n.copyTextureToBuffers=function(t,i,n){ict(this,t.gpuTexture,i,n)},n.copyTexImagesToTexture=function(t,i,n){Qot(this,t,i.gpuTexture,n)},r(i,[{key:"gl",get:function(){return this.Gs}},{key:"extensions",get:function(){return this.Br.extensions}},{key:"stateCache",get:function(){return this.Br.tU}},{key:"nullTex2D",get:function(){return this.Br.iU}},{key:"nullTexCube",get:function(){return this.Br.nU}},{key:"textureExclusive",get:function(){return this.oU}},{key:"bindingMappings",get:function(){return this.uU}},{key:"blitManager",get:function(){return this.Br.blitManager}}]),i}(Jd));O.WebGLDevice=Nct;var Pct=function(t){function i(){var i;return(i=t.call(this)||this).DL=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.ir=t.layout;var i=t.layout.fU(),n=i.BL,r=i.FL,s=i.UL;this.nr=Array(s).fill(null),this.rr=Array(s).fill(null),this.Cn=Array(s).fill(null);var e=[];this.DL={xL:e,FL:r};for(var h=0;h<n.length;++h)for(var u=n[h],o=0;o<u.count;o++){var c={GL:u.descriptorType,jL:null,vU:null,VL:null};e.push(c)}},n.destroy=function(){this.ir=null,this.DL=null},n.update=function(){if(this.sr&&this.DL){for(var t=this.DL.xL,i=0;i<t.length;++i)t[i].GL&Ud?this.nr[i]&&(t[i].jL=this.nr[i].lU()):t[i].GL&xd&&(this.rr[i]&&(t[i].vU=this.rr[i].gpuTextureView),this.Cn[i]&&(t[i].VL=this.Cn[i].gpuSampler));this.sr=!1}},r(i,[{key:"gpuDescriptorSet",get:function(){return this.DL}}]),i}(rw),Lct=[10497,33648,33071,33071],Dct=new Float32Array(4),Bct=Math.max,Fct=Math.min;function Uct(t){switch(t){case 4:case 6:case 14:case 16:case 24:case 25:case 27:case 36:case 35:case 37:case 39:case 56:case 58:case 60:case 61:case 62:case 63:case 64:case 66:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 79:case 81:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:default:return 5121;case 5:case 7:case 15:case 17:case 26:case 28:case 38:case 40:case 65:case 67:case 80:case 82:return 5120;case 8:case 18:case 29:case 41:return 5131;case 9:case 19:case 30:case 42:return 5123;case 10:case 20:case 31:case 43:return 5122;case 11:case 21:case 32:case 44:case 53:case 54:case 69:case 68:return 5126;case 12:case 22:case 33:case 45:return 5125;case 13:case 23:case 34:case 46:return 5124;case 47:return 33635;case 48:return 35899;case 49:return 32820;case 50:return 32819;case 51:case 52:return 33640;case 55:return 34042}}function xct(t){switch(t){case 1:return 6406;case 2:return 6409;case 3:return 6410;case 4:return 33321;case 5:return 36756;case 6:return 33330;case 7:return 33329;case 14:return 33323;case 15:return 36757;case 16:return 33336;case 17:return 33335;case 24:return 32849;case 26:return 36758;case 27:return 36221;case 28:return 36239;case 36:case 35:return 32856;case 38:return 36759;case 39:return 36220;case 40:return 36238;case 10:return 33331;case 9:return 33332;case 8:return 33325;case 20:return 33337;case 19:return 33338;case 18:return 33327;case 31:return 36233;case 30:return 36215;case 29:return 34843;case 43:return 36232;case 42:return 36214;case 41:return 34842;case 13:return 33333;case 12:return 33334;case 11:return 33326;case 23:return 33339;case 22:return 33340;case 21:return 33328;case 34:return 36227;case 33:return 36209;case 32:return 34837;case 46:return 36226;case 45:return 36208;case 44:return 34836;case 47:return 36194;case 49:return 32855;case 50:return 32854;case 25:return 35905;case 37:return 35907;case 51:return 32857;case 52:return 36975;case 48:return 35898;case 54:return 36012;case 55:return 35056;case 56:return 33776;case 57:return 33777;case 58:return 35916;case 59:return 35917;case 60:return 33778;case 61:return 35918;case 62:return 33779;case 63:return 35919;case 72:return 36196;case 73:return 37492;case 74:return 37493;case 75:return 37494;case 76:return 37495;case 77:return 37496;case 78:return 37497;case 79:return 37488;case 80:return 37489;case 81:return 37490;case 82:return 37491;case 83:return 35841;case 84:return 35843;case 85:return 35840;case 86:return 35842;case 89:return 37808;case 90:return 37809;case 91:return 37810;case 92:return 37811;case 93:return 37812;case 94:return 37813;case 95:return 37814;case 96:return 37815;case 97:return 37816;case 98:return 37817;case 99:return 37818;case 100:return 37819;case 101:return 37820;case 102:return 37821;case 103:return 37840;case 104:return 37841;case 105:return 37842;case 106:return 37843;case 107:return 37844;case 108:return 37845;case 109:return 37846;case 110:return 37847;case 111:return 37848;case 112:return 37849;case 113:return 37850;case 114:return 37851;case 115:return 37852;case 116:return 37853;default:return ht(16309),6408}}function Gct(t){switch(t){case 1:return 6406;case 2:return 6409;case 3:return 6410;case 4:case 5:case 6:case 7:case 9:case 10:case 8:case 12:case 13:case 11:return 6403;case 14:case 15:case 16:case 17:case 19:case 20:case 18:case 22:case 23:case 21:return 33319;case 24:case 26:case 27:case 28:case 30:case 31:case 29:case 33:case 34:case 32:case 48:case 47:case 25:return 6407;case 36:case 35:case 38:case 39:case 40:case 42:case 43:case 41:case 45:case 46:case 44:case 51:case 49:case 50:case 37:return 6408;case 54:return 6402;case 55:return 34041;case 56:return 33776;case 57:return 33777;case 58:return 35916;case 59:return 35917;case 60:return 33778;case 61:return 35918;case 62:return 33779;case 63:return 35919;case 72:return 36196;case 73:return 37492;case 74:return 37493;case 75:return 37494;case 76:return 37495;case 77:return 37496;case 78:return 37497;case 79:return 37488;case 80:return 37489;case 81:return 37490;case 82:return 37491;case 83:return 35841;case 84:return 35843;case 85:return 35840;case 86:return 35842;case 89:return 37808;case 90:return 37809;case 91:return 37810;case 92:return 37811;case 93:return 37812;case 94:return 37813;case 95:return 37814;case 96:return 37815;case 97:return 37816;case 98:return 37817;case 99:return 37818;case 100:return 37819;case 101:return 37820;case 102:return 37821;case 103:return 37840;case 104:return 37841;case 105:return 37842;case 106:return 37843;case 107:return 37844;case 108:return 37845;case 109:return 37846;case 110:return 37847;case 111:return 37848;case 112:return 37849;case 113:return 37850;case 114:return 37851;case 115:return 37852;case 116:return 37853;default:return ht(16310),6408}}function jct(t){switch(t){case 1:return 35670;case 2:return 35671;case 3:return 35672;case 4:return 35673;case 5:return 5124;case 6:return 35667;case 7:return 35668;case 8:return 35669;case 9:return 5125;case 13:return 5126;case 14:return 35664;case 15:return 35665;case 16:return 35666;case 17:return 35674;case 18:return 35685;case 19:return 35686;case 20:return 35687;case 21:return 35675;case 22:return 35688;case 23:return 35689;case 24:return 35690;case 25:return 35676;case 28:return 35678;case 29:return 36289;case 30:return 35679;case 31:return 35680;default:return ht(16311),0}}function Hct(t){switch(t){case 35670:return 1;case 35671:return 2;case 35672:return 3;case 35673:return 4;case 5124:return 5;case 35667:return 6;case 35668:return 7;case 35669:return 8;case 5125:return 9;case 36294:return 10;case 36295:return 11;case 36296:return 12;case 5126:return 13;case 35664:return 14;case 35665:return 15;case 35666:return 16;case 35674:return 17;case 35685:return 18;case 35686:return 19;case 35687:return 20;case 35675:return 21;case 35688:return 22;case 35689:return 23;case 35690:return 24;case 35676:return 25;case 35678:return 28;case 36289:return 29;case 35679:return 30;case 35680:return 31;default:return ht(16313),0}}function Vct(t){switch(t){case 35670:case 5124:case 5125:case 5126:case 35678:case 36289:case 36292:case 35679:case 35680:case 36298:case 36303:case 36299:case 36300:case 36306:case 36311:case 36307:case 36308:return 4;case 35671:case 35667:case 36294:case 35664:return 8;case 35672:case 35668:case 36295:case 35665:return 12;case 35673:case 35669:case 36296:case 35666:case 35674:return 16;case 35685:case 35687:return 24;case 35686:case 35689:return 32;case 35675:return 36;case 35688:case 35690:return 48;case 35676:return 64;default:return ht(16314),0}}function $ct(t){switch(t){case 35674:case 35685:case 35686:return 2;case 35687:case 35675:case 35688:return 3;case 35689:case 35690:case 35676:return 4;default:return 1}}var zct=[512,513,514,515,516,517,518,519],Wct=[0,7680,7681,7682,7683,5386,34055,34056],Xct=[32774,32778,32779,32775,32776],Yct=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];function Kct(t,i){var n=t.gl,r=t.dU(),s=2&i.$L?35048:35044;if(8&i.zL){i.WL=34962;var e=n.createBuffer();e&&(i.XL=e,i.YL>0&&(t.extensions.KL&&r.qL&&(n.bindVertexArray(null),r.qL=null),cat.wU=null,r.JL!==i.XL&&(n.bindBuffer(34962,i.XL),r.JL=i.XL),n.bufferData(34962,i.YL,s),n.bindBuffer(34962,null),r.JL=null))}else if(4&i.zL){i.WL=34963;var h=n.createBuffer();h&&(i.XL=h,i.YL>0&&(t.extensions.KL&&r.qL&&(n.bindVertexArray(null),r.qL=null),cat.wU=null,r.ZL!==i.XL&&(n.bindBuffer(34963,i.XL),r.ZL=i.XL),n.bufferData(34963,i.YL,s),n.bindBuffer(34963,null),r.ZL=null))}else if(16&i.zL){i.WL=35345;var u=n.createBuffer();u&&i.YL>0&&(i.XL=u,r.gU!==i.XL&&(n.bindBuffer(35345,i.XL),r.gU=i.XL),n.bufferData(35345,i.YL,s),n.bindBuffer(35345,null),r.gU=null)}else 64&i.zL||2&i.zL||1&i.zL||ht(16315),i.WL=0}function qct(t,i){var n=t.gl,r=t.dU(),s=t.extensions.KL;if(i.XL){switch(i.WL){case 34962:s&&r.qL&&(n.bindVertexArray(null),r.qL=null),cat.wU=null,n.bindBuffer(34962,null),r.JL=null;break;case 34963:s&&r.qL&&(n.bindVertexArray(null),r.qL=null),cat.wU=null,n.bindBuffer(34963,null),r.ZL=null;break;case 35345:n.bindBuffer(35345,null),r.gU=null}n.deleteBuffer(i.XL),i.XL=null}}function Qct(t,i){var n=t.gl,r=t.dU(),s=2&i.$L?35048:35044;8&i.zL?(t.extensions.KL&&r.qL&&(n.bindVertexArray(null),r.qL=null),cat.wU=null,r.JL!==i.XL&&n.bindBuffer(34962,i.XL),i.tD?n.bufferData(34962,i.tD,s):n.bufferData(34962,i.YL,s),n.bindBuffer(34962,null),r.JL=null):4&i.zL?(t.extensions.KL&&r.qL&&(n.bindVertexArray(null),r.qL=null),cat.wU=null,r.ZL!==i.XL&&n.bindBuffer(34963,i.XL),i.tD?n.bufferData(34963,i.tD,s):n.bufferData(34963,i.YL,s),n.bindBuffer(34963,null),r.ZL=null):16&i.zL?(r.gU!==i.XL&&n.bindBuffer(35345,i.XL),n.bufferData(35345,i.YL,s),n.bindBuffer(35345,null),r.gU=null):(64&i.zL||2&i.zL||1&i.zL||ht(16315),i.WL=0)}function Jct(t,i,n,r,s){if(64&i.zL){i.nD.iD();for(var e=n.drawInfos,h=0;h<e.length;++h)i.nD.rD(r+h,e[h])}else{var u=n,o=t.gl,c=t.dU();switch(i.WL){case 34962:t.extensions.KL&&c.qL&&(o.bindVertexArray(null),c.qL=null),cat.wU=null,c.JL!==i.XL&&(o.bindBuffer(34962,i.XL),c.JL=i.XL),wh.os===ch.IOS&&2&i.$L&&0===r&&s===u.byteLength?o.bufferData(i.WL,u,o.DYNAMIC_DRAW):s===u.byteLength?o.bufferSubData(i.WL,r,u):o.bufferSubData(i.WL,r,u.slice(0,s));break;case 34963:t.extensions.KL&&c.qL&&(o.bindVertexArray(null),c.qL=null),cat.wU=null,c.ZL!==i.XL&&(o.bindBuffer(34963,i.XL),c.ZL=i.XL),wh.os===ch.IOS&&2&i.$L&&0===r&&s===u.byteLength?o.bufferData(i.WL,u,o.DYNAMIC_DRAW):s===u.byteLength?o.bufferSubData(i.WL,r,u):o.bufferSubData(i.WL,r,u.slice(0,s));break;case 35345:c.gU!==i.XL&&(o.bindBuffer(35345,i.XL),c.gU=i.XL),wh.os===ch.IOS&&2&i.$L&&0===r&&s===u.byteLength?o.bufferData(i.WL,u,o.DYNAMIC_DRAW):s===u.byteLength?o.bufferSubData(i.WL,r,u):o.bufferSubData(i.WL,r,new Float32Array(u,0,s/4));break;default:ht(16316)}}}function Zct(t,i){var n=t.gl,r=t.dU(),s=t.capabilities;i.eD=xct(i.hD),i.sD=Gct(i.hD),i.uD=Uct(i.hD);var e=i.oD,h=i.cD,u=i.IF,o=i.RF;switch(i.GL){case 1:i.WL=3553;var c=Bct(e,h);if(c>s.maxTextureSize&&ht(9100,c,s.maxTextureSize),1===i.MF){if(i.fD=n.createTexture(),i.YL>0){var a=r.vD[r.lD];if(a.fD!==i.fD&&(n.bindTexture(3553,i.fD),a.fD=i.fD),Fd[i.hD].isCompressed)for(var f=0;f<i.dD;++f){var v=Hd(i.hD,e,h,1),l=new Uint8Array(v);n.compressedTexImage2D(3553,f,i.eD,e,h,0,l),e=Bct(1,e>>1),h=Bct(1,h>>1)}else 128&i.DB?n.texImage2D(3553,0,i.eD,e,h,0,i.sD,i.uD,null):n.texStorage2D(3553,i.dD,i.eD,e,h)}}else i.mD=n.createRenderbuffer(),i.YL>0&&(r.mD!==i.mD&&(n.bindRenderbuffer(36161,i.mD),r.mD=i.mD),n.renderbufferStorageMultisample(36161,i.MF,i.eD,i.oD,i.cD));break;case 5:i.WL=35866;var d=Bct(e,h);if(d>s.maxTextureSize&&ht(9100,d,s.maxTextureSize),o>s.maxArrayTextureLayers&&ht(9100,o,s.maxArrayTextureLayers),i.fD=n.createTexture(),i.YL>0){var w=r.vD[r.lD];if(w.fD!==i.fD&&(n.bindTexture(35866,i.fD),w.fD=i.fD),Fd[i.hD].isCompressed)for(var g=0;g<i.dD;++g){var p=Hd(i.hD,e,h,o),_=new Uint8Array(p);n.compressedTexImage3D(35866,g,i.eD,e,h,o,0,_),e=Bct(1,e>>1),h=Bct(1,h>>1)}else n.texStorage3D(35866,i.dD,i.eD,e,h,o)}break;case 2:i.WL=32879;var y=Bct(Bct(e,h),u);if(y>s.max3DTextureSize&&ht(9100,y,s.max3DTextureSize),i.fD=n.createTexture(),i.YL>0){var m=r.vD[r.lD];if(m.fD!==i.fD&&(n.bindTexture(32879,i.fD),m.fD=i.fD),Fd[i.hD].isCompressed)for(var b=0;b<i.dD;++b){var k=Hd(i.hD,e,h,u),A=new Uint8Array(k);n.compressedTexImage3D(32879,b,i.eD,e,h,u,0,A),e=Bct(1,e>>1),h=Bct(1,h>>1)}else n.texStorage3D(32879,i.dD,i.eD,e,h,u)}break;case 3:i.WL=34067;var E=Bct(e,h);if(E>s.maxCubeMapTextureSize&&ht(9100,E,s.maxTextureSize),i.fD=n.createTexture(),i.YL>0){var T=r.vD[r.lD];if(T.fD!==i.fD&&(n.bindTexture(34067,i.fD),T.fD=i.fD),Fd[i.hD].isCompressed)for(var O=0;O<i.dD;++O){for(var S=Hd(i.hD,e,h,1),I=new Uint8Array(S),R=0;R<6;++R)n.compressedTexImage2D(34069+R,O,i.eD,e,h,0,I);e=Bct(1,e>>1),h=Bct(1,h>>1)}else n.texStorage2D(34067,i.dD,i.eD,e,h)}break;default:ht(16317),i.GL=1,i.WL=3553}}function tat(t,i){var n=t.gl,r=t.dU();if(i.fD){var s=r.vD,e=r.lD;n.deleteTexture(i.fD);for(var h=0;h<s.length;++h)s[h].fD===i.fD&&(n.activeTexture(33984+h),e=h,n.bindTexture(i.WL,null),s[h].fD=null);r.lD=e,i.fD=null}if(i.mD){var u=r.mD;n.deleteRenderbuffer(i.mD),u===i.mD&&(n.bindRenderbuffer(36161,null),r.mD=null),i.mD=null}}function iat(t,i){if(i.YL){var n=t.gl,r=t.dU(),s=t.capabilities,e=i.oD,h=i.cD,u=i.IF,o=i.RF;switch(i.GL){case 1:i.WL=3553;var c=Bct(e,h);if(c>s.maxTextureSize&&ht(9100,c,s.maxTextureSize),1===i.MF){var a=r.vD[r.lD];if(a.fD!==i.fD&&(n.bindTexture(3553,i.fD),a.fD=i.fD),Fd[i.hD].isCompressed)for(var f=0;f<i.dD;++f){var v=Hd(i.hD,e,h,1),l=new Uint8Array(v);n.compressedTexImage2D(3553,f,i.eD,e,h,0,l),e=Bct(1,e>>1),h=Bct(1,h>>1)}else tat(t,i),Zct(t,i)}else i.mD&&(r.mD!==i.mD&&(n.bindRenderbuffer(36161,i.mD),r.mD=i.mD),n.renderbufferStorageMultisample(36161,i.MF,i.eD,i.oD,i.cD));break;case 5:i.WL=35866;var d=Bct(e,h);if(d>s.maxTextureSize&&ht(9100,d,s.maxTextureSize),o>s.maxArrayTextureLayers&&ht(9100,o,s.maxArrayTextureLayers),i.fD=n.createTexture(),i.YL>0){var w=r.vD[r.lD];if(w.fD!==i.fD&&(n.bindTexture(35866,i.fD),w.fD=i.fD),Fd[i.hD].isCompressed)for(var g=0;g<i.dD;++g){var p=Hd(i.hD,e,h,o),_=new Uint8Array(p);n.compressedTexImage3D(35866,g,i.eD,e,h,o,0,_),e=Bct(1,e>>1),h=Bct(1,h>>1)}else n.texStorage3D(35866,i.dD,i.eD,e,h,o)}break;case 2:i.WL=32879;var y=Bct(Bct(e,h),u);if(y>s.max3DTextureSize&&ht(9100,y,s.max3DTextureSize),i.fD=n.createTexture(),i.YL>0){var m=r.vD[r.lD];if(m.fD!==i.fD&&(n.bindTexture(32879,i.fD),m.fD=i.fD),Fd[i.hD].isCompressed)for(var b=0;b<i.dD;++b){var k=Hd(i.hD,e,h,u),A=new Uint8Array(k);n.compressedTexImage3D(32879,b,i.eD,e,h,u,0,A),e=Bct(1,e>>1),h=Bct(1,h>>1)}else n.texStorage3D(32879,i.dD,i.eD,e,h,u)}break;case 3:i.GL=3,i.WL=34067;var E=Bct(e,h);E>s.maxCubeMapTextureSize&&ht(9100,E,s.maxTextureSize);var T=r.vD[r.lD];if(T.fD!==i.fD&&(n.bindTexture(34067,i.fD),T.fD=i.fD),Fd[i.hD].isCompressed)for(var O=0;O<6;++O){e=i.oD,h=i.cD;for(var S=0;S<i.dD;++S){var I=Hd(i.hD,e,h,1),R=new Uint8Array(I);n.compressedTexImage2D(34069+O,S,i.eD,e,h,0,R),e=Bct(1,e>>1),h=Bct(1,h>>1)}}else tat(t,i),Zct(t,i);break;default:ht(16317),i.GL=1,i.WL=3553}}}function nat(t,i){for(var n=t.gl,r=i.pU.values().next();!r.done;){n.deleteSampler(r.value);for(var s=t.dU()._U,e=0;e<s.length;++e)s[e]===r.value&&(n.bindSampler(e,null),s[e]=null)}i.pU.clear()}function rat(t,i){for(var n=t.dU(),r=0;r<i.yU.length;++r)if(i.yU[r].HL.AD)return void(i.ED=!1);var s=t.gl,e=[],h=s.createFramebuffer();if(h){i.TD=h,n.TD!==i.TD&&s.bindFramebuffer(36160,i.TD);for(var u=0;u<i.yU.length;++u){var o=i.yU[u],c=o.HL;c&&(c.fD?s.framebufferTexture2D(36160,36064+u,c.WL,c.fD,o.mU):s.framebufferRenderbuffer(36160,36064+u,36161,c.mD),e.push(36064+u),i.oD=Fct(i.oD,c.oD>>o.mU),i.cD=Fct(i.cD,c.cD>>o.mU))}var a=i.kU;if(a){var f=a.HL,v=Fd[f.hD].hasStencil?33306:36096;f.fD?s.framebufferTexture2D(36160,v,f.WL,f.fD,i.kU.mU):s.framebufferRenderbuffer(36160,v,36161,f.mD),i.oD=Fct(i.oD,f.oD>>a.mU),i.cD=Fct(i.cD,f.cD>>a.mU)}s.drawBuffers(e);var l=s.checkFramebufferStatus(36160);if(36053!==l)switch(l){case 36054:ht(16318);break;case 36055:ht(16319);break;case 36057:ht(16320);break;case 36061:ht(16321)}n.TD!==i.TD&&s.bindFramebuffer(36160,n.TD)}}function sat(t,i){var n=t.gl,r=t.dU();i.TD&&(n.deleteFramebuffer(i.TD),r.TD===i.TD&&(n.bindFramebuffer(36160,null),r.TD=null),i.TD=null)}function eat(t,i){for(var n,r=t.gl,s=t.dU(),e=t.capabilities,h=function(){var t=i.RD[u],n=0,s="",e=1;switch(t.GL){case 1:s="VertexShader",n=35633;break;case 16:s="FragmentShader",n=35632;break;default:return ht(16322),{v:void 0}}var h=r.createShader(n);if(h&&(t.MD=h,r.shaderSource(t.MD,"#version 300 es\n"+t.CD),r.compileShader(t.MD),!r.getShaderParameter(t.MD,35713))){ht(16323,s,i.ND),ht(16324,t.CD.replace(/^|\n/g,(function(){return"\n"+e+++" "}))),X(r.getShaderInfoLog(t.MD));for(var o=0;o<i.RD.length;o++){var c=i.RD[u];c.MD&&(r.deleteShader(c.MD),c.MD=null)}return{v:void 0}}},u=0;u<i.RD.length;u++)if(n=h())return n.v;var o=r.createProgram();if(o){i.PD=o;for(var c=!(!T.rendering||!T.rendering.enableEffectImport),a=0;a<i.RD.length;a++){var f=i.RD[a];r.attachShader(i.PD,f.MD)}r.linkProgram(i.PD);for(var v=0;v<i.RD.length;v++){var l=i.RD[v];l.MD&&(r.detachShader(i.PD,l.MD),r.deleteShader(l.MD),l.MD=null)}if(!r.getProgramParameter(i.PD,35714))return ht(16326,i.ND),void X(r.getProgramInfoLog(i.PD));nt(16325,i.ND);var d=r.getProgramParameter(i.PD,35721);i.DD=new Array(d);for(var w=0;w<d;++w){var g=r.getActiveAttrib(i.PD,w);if(g){var p,_=g.name.indexOf("[");p=-1!==_?g.name.substring(0,_):g.name;var y=r.getAttribLocation(i.PD,p),m=Hct(g.type),b=Vct(g.type);i.DD[w]={ND:p,GL:m,BD:b,lp:g.size,YL:b*g.size,uD:g.type,FD:y}}}var k,A,E,O,S=r.getProgramParameter(i.PD,35382);if(S){i.xD=new Array(S);for(var I=0;I<S;++I){var R=(k=r.getActiveUniformBlockName(i.PD,I)).indexOf("[");-1!==R&&(k=k.substring(0,R)),O=null;for(var M=0;M<i.UD.length;M++)if(i.UD[M].name===k){O=i.UD[M];break}if(O){A=I,E=r.getActiveUniformBlockParameter(i.PD,A,35392);var C=c?O.flattened:O.binding+(t.bindingMappings.dF[O.set]||0);r.uniformBlockBinding(i.PD,A,C),i.xD[I]={GD:O.set,iP:O.binding,AU:A,ND:k,YL:E,EU:C}}else ht(16404,k)}}for(var N=0;N<i.zD.length;++N){var P=i.zD[N];i.WD.push(new td(P.set,P.binding,P.name,28,P.count))}if(i.WD.length>0){i.XD=new Array(i.WD.length);for(var L=0;L<i.WD.length;++L){var D=i.WD[L];i.XD[L]={GD:D.set,iP:D.binding,ND:D.name,GL:D.type,lp:D.count,YD:[],KD:null,uD:jct(D.type),FD:null}}}var B=[],F=[],U=s.QD;if(c)for(var x=0;x<i.WD.length;++x){var G=i.WD[x],j=r.getUniformLocation(i.PD,G.name);j&&-1!==j.id&&(B.push(i.XD[x]),F.push(j)),void 0===U[G.name]&&(U[G.name]=G.flattened%e.maxTextureUnits)}else{for(var H=0,V=0;V<i.UD.length;++V)i.UD[V].set===t.bindingMappings.JD&&H++;for(var $=0,z=0;z<i.WD.length;++z){var W=i.WD[z],Y=r.getUniformLocation(i.PD,W.name);if(Y&&-1!==Y.id&&(B.push(i.XD[z]),F.push(Y)),void 0===U[W.name]){var K=W.binding+t.bindingMappings.ZD[W.set]+$;W.set===t.bindingMappings.JD&&(K-=H),U[W.name]=K%e.maxTextureUnits,$+=W.count-1}}}if(B.length){for(var q=[],Q=0;Q<B.length;++Q){var J=B[Q],Z=U[J.ND];if(void 0!==Z){J.FD=F[Q];for(var tt=0;tt<J.lp;++tt){for(;q[Z];)Z=(Z+1)%e.maxTextureUnits;J.YD.push(Z),q[Z]=!0}}}for(var it=0,rt=0;rt<B.length;++rt){var st=B[rt];if(!st.FD){for(st.FD=F[rt];q[it];)it++;for(var et=0;et<st.lp;++et){for(;q[it];)it=(it+1)%e.maxTextureUnits;void 0===U[st.ND]&&(U[st.ND]=it),st.YD.push(it),q[it]=!0}}}s.PD!==i.PD&&r.useProgram(i.PD);for(var ut=0;ut<B.length;ut++){var ot=B[ut];ot.KD=new Int32Array(ot.YD),r.uniform1iv(ot.FD,ot.KD)}s.PD!==i.PD&&r.useProgram(s.PD)}i.XD=B}}function hat(t,i){var n=t.gl,r=t.dU();i.PD&&(n.deleteProgram(i.PD),r.PD===i.PD&&(n.useProgram(null),r.PD=null),i.PD=null)}function uat(t,i){t.gl,i.tB=new Array(i.iB.length);for(var n=[0,0,0,0,0,0,0,0],r=0;r<i.iB.length;++r){var s=i.iB[r],e=void 0!==s.stream?s.stream:0,h=i.nB[e],u=Uct(s.format),o=Fd[s.format].size;i.tB[r]={ND:s.name,XL:h.XL,uD:u,YL:o,lp:Fd[s.format].count,BD:h.BD,rB:$ct(u),sB:void 0!==s.isNormalized&&s.isNormalized,eB:void 0!==s.isInstanced&&s.isInstanced,VD:n[e]},n[e]+=o}}function oat(t,i){for(var n=t.gl,r=t.dU(),s=i.hB.values(),e=s.next(),h=r.qL;!e.done;)n.deleteVertexArray(e.value),h===e.value&&(n.bindVertexArray(null),h=null),e=s.next();r.qL=h,i.hB.clear()}var cat={TU:null,wU:null,pB:0,OU:[]};function aat(t,i,n,r,s,e,h){var u=t.gl,o=t.dU(),c=0;if(n&&i){o.TD!==n.TD&&(u.bindFramebuffer(36160,n.TD),o.TD=n.TD),o.oB.left===r.x&&o.oB.top===r.y&&o.oB.width===r.width&&o.oB.height===r.height||(u.viewport(r.x,r.y,r.width,r.height),o.oB.left=r.x,o.oB.top=r.y,o.oB.width=r.width,o.oB.height=r.height),o.aB.x===r.x&&o.aB.y===r.y&&o.aB.width===r.width&&o.aB.height===r.height||(u.scissor(r.x,r.y,r.width,r.height),o.aB.x=r.x,o.aB.y=r.y,o.aB.width=r.width,o.aB.height=r.height),cat.OU.length=0;for(var a=0;a<s.length;++a){var f=i.vB[a];if(0!==f.format)switch(f.loadOp){case 0:break;case 1:if(15!==o.lB.targets[0].blendColorMask&&u.colorMask(!0,!0,!0,!0),1===i.vB.length){var v=s[0];u.clearColor(v.x,v.y,v.z,v.w),c|=16384}else Dct[0]=s[a].x,Dct[1]=s[a].y,Dct[2]=s[a].z,Dct[3]=s[a].w,u.clearBufferfv(6144,a,Dct);break;case 2:cat.OU.push(36064+a)}}if(i.dB&&0!==i.dB.format){switch(i.dB.depthLoadOp){case 0:break;case 1:o.fB.depthWrite||u.depthMask(!0),u.clearDepth(e),c|=256;break;case 2:cat.OU.push(36096)}if(Fd[i.dB.format].hasStencil)switch(i.dB.stencilLoadOp){case 0:break;case 1:o.fB.stencilWriteMaskFront||u.stencilMaskSeparate(1028,65535),o.fB.stencilWriteMaskBack||u.stencilMaskSeparate(1029,65535),u.clearStencil(h),c|=1024;break;case 2:cat.OU.push(36128)}}if(n.TD&&cat.OU.length&&u.invalidateFramebuffer(36160,cat.OU),c&&u.clear(c),16384&c){var l=o.lB.targets[0].blendColorMask;if(15!==l){var d=!!(1&l),w=!!(2&l),g=!!(4&l),p=!!(8&l);u.colorMask(d,w,g,p)}}256&c&&!o.fB.depthWrite&&u.depthMask(!1),1024&c&&(o.fB.stencilWriteMaskFront||u.stencilMaskSeparate(1028,0),o.fB.stencilWriteMaskBack||u.stencilMaskSeparate(1029,0))}}function fat(t,i,n,r,s,e){var h=t.gl,u=t.capabilities,o=t.dU(),c=o.hN,a=o.fB,f=o.lB,v=f.blendColor,l=i&&i.gB,d=!1;if(i&&cat.TU!==i){if(cat.TU=i,cat.pB=i.pB,l){var w=l.PD;o.PD!==w&&(h.useProgram(w),o.PD=w,d=!0)}var g=i.hN;if(g){if(c.cullMode!==g.cullMode){switch(g.cullMode){case 0:h.disable(2884);break;case 1:h.enable(2884),h.cullFace(1028);break;case 2:h.enable(2884),h.cullFace(1029)}c.cullMode=g.cullMode}var p=g.isFrontFaceCCW;c.isFrontFaceCCW!==p&&(h.frontFace(p?2305:2304),c.isFrontFaceCCW=p),c.depthBias===g.depthBias&&c.depthBiasSlop===g.depthBiasSlop||(h.polygonOffset(g.depthBias,g.depthBiasSlop),c.depthBias=g.depthBias,c.depthBiasSlop=g.depthBiasSlop),c.lineWidth!==g.lineWidth&&(h.lineWidth(g.lineWidth),c.lineWidth=g.lineWidth)}var _=i.fB;_&&(a.depthTest!==_.depthTest&&(_.depthTest?h.enable(2929):h.disable(2929),a.depthTest=_.depthTest),a.depthWrite!==_.depthWrite&&(h.depthMask(_.depthWrite),a.depthWrite=_.depthWrite),a.depthFunc!==_.depthFunc&&(h.depthFunc(zct[_.depthFunc]),a.depthFunc=_.depthFunc),a.stencilTestFront===_.stencilTestFront&&a.stencilTestBack===_.stencilTestBack||(_.stencilTestFront||_.stencilTestBack?h.enable(2960):h.disable(2960),a.stencilTestFront=_.stencilTestFront,a.stencilTestBack=_.stencilTestBack),a.stencilFuncFront===_.stencilFuncFront&&a.stencilRefFront===_.stencilRefFront&&a.stencilReadMaskFront===_.stencilReadMaskFront||(h.stencilFuncSeparate(1028,zct[_.stencilFuncFront],_.stencilRefFront,_.stencilReadMaskFront),a.stencilFuncFront=_.stencilFuncFront,a.stencilRefFront=_.stencilRefFront,a.stencilReadMaskFront=_.stencilReadMaskFront),a.stencilFailOpFront===_.stencilFailOpFront&&a.stencilZFailOpFront===_.stencilZFailOpFront&&a.stencilPassOpFront===_.stencilPassOpFront||(h.stencilOpSeparate(1028,Wct[_.stencilFailOpFront],Wct[_.stencilZFailOpFront],Wct[_.stencilPassOpFront]),a.stencilFailOpFront=_.stencilFailOpFront,a.stencilZFailOpFront=_.stencilZFailOpFront,a.stencilPassOpFront=_.stencilPassOpFront),a.stencilWriteMaskFront!==_.stencilWriteMaskFront&&(h.stencilMaskSeparate(1028,_.stencilWriteMaskFront),a.stencilWriteMaskFront=_.stencilWriteMaskFront),a.stencilFuncBack===_.stencilFuncBack&&a.stencilRefBack===_.stencilRefBack&&a.stencilReadMaskBack===_.stencilReadMaskBack||(h.stencilFuncSeparate(1029,zct[_.stencilFuncBack],_.stencilRefBack,_.stencilReadMaskBack),a.stencilFuncBack=_.stencilFuncBack,a.stencilRefBack=_.stencilRefBack,a.stencilReadMaskBack=_.stencilReadMaskBack),a.stencilFailOpBack===_.stencilFailOpBack&&a.stencilZFailOpBack===_.stencilZFailOpBack&&a.stencilPassOpBack===_.stencilPassOpBack||(h.stencilOpSeparate(1029,Wct[_.stencilFailOpBack],Wct[_.stencilZFailOpBack],Wct[_.stencilPassOpBack]),a.stencilFailOpBack=_.stencilFailOpBack,a.stencilZFailOpBack=_.stencilZFailOpBack,a.stencilPassOpBack=_.stencilPassOpBack),a.stencilWriteMaskBack!==_.stencilWriteMaskBack&&(h.stencilMaskSeparate(1029,_.stencilWriteMaskBack),a.stencilWriteMaskBack=_.stencilWriteMaskBack));var y=i.lB;if(y){f.isA2C!==y.isA2C&&(y.isA2C?h.enable(32926):h.disable(32926),f.isA2C=y.isA2C);var m=y.blendColor;v.x===m.x&&v.y===m.y&&v.z===m.z&&v.w===m.w||(h.blendColor(m.x,m.y,m.z,m.w),v.x=m.x,v.y=m.y,v.z=m.z,v.w=m.w);var b=y.targets[0],k=o.lB.targets[0];k.blend!==b.blend&&(b.blend?h.enable(3042):h.disable(3042),k.blend=b.blend),k.blendEq===b.blendEq&&k.blendAlphaEq===b.blendAlphaEq||(h.blendEquationSeparate(Xct[b.blendEq],Xct[b.blendAlphaEq]),k.blendEq=b.blendEq,k.blendAlphaEq=b.blendAlphaEq),k.blendSrc===b.blendSrc&&k.blendDst===b.blendDst&&k.blendSrcAlpha===b.blendSrcAlpha&&k.blendDstAlpha===b.blendDstAlpha||(h.blendFuncSeparate(Yct[b.blendSrc],Yct[b.blendDst],Yct[b.blendSrcAlpha],Yct[b.blendDstAlpha]),k.blendSrc=b.blendSrc,k.blendDst=b.blendDst,k.blendSrcAlpha=b.blendSrcAlpha,k.blendDstAlpha=b.blendDstAlpha),k.blendColorMask!==b.blendColorMask&&(h.colorMask(!!(1&b.blendColorMask),!!(2&b.blendColorMask),!!(4&b.blendColorMask),!!(8&b.blendColorMask)),k.blendColorMask=b.blendColorMask)}}if(i&&i._B&&l){for(var A=l.xD.length,E=i._B.yB,T=0;T<A;T++){var O=l.xD[T],S=r[O.GD],I=S&&S.FL[O.iP],R=I>=0&&S.xL[I];if(R&&R.jL){var M=E[O.GD],C=M&&M[O.iP],N=R.jL.SU;C>=0&&(N+=s[C]),o.IU[O.EU]===R.jL.XL&&o.RU[O.EU]===N||(N?h.bindBufferRange(35345,O.EU,R.jL.XL,N,R.jL.YL):h.bindBufferBase(35345,O.EU,R.jL.XL),o.gU=o.IU[O.EU]=R.jL.XL,o.RU[O.EU]=N)}}for(var P=l.XD.length,L=0;L<P;L++)for(var D=l.XD[L],B=r[D.GD],F=B&&B.FL[D.iP],U=F>=0&&B.xL[F],x=0;x<D.YD.length;x++){var G=D.YD[x],j=o.vD[G];if(U&&U.vU&&U.vU.HL&&U.VL){var H=U.vU,V=H.HL,$=H.mU,z=$+H.MU;if(V.YL>0){j.fD!==V.fD&&(o.lD!==G&&(h.activeTexture(33984+G),o.lD=G),V.fD?h.bindTexture(V.WL,V.fD):h.bindTexture(V.WL,t.nullTex2D.gpuTexture.fD),j.fD=V.fD);var W=U.VL.CU(t,$,z);o._U[G]!==W&&(h.bindSampler(G,W),o._U[G]=W)}U=B.xL[++F]}}}if(n&&l&&(d||cat.wU!==n))if(cat.wU=n,t.extensions.KL){var X=n.hB.get(l.PD);if(!X){var Y;X=h.createVertexArray(),n.hB.set(l.PD,X),h.bindVertexArray(X),h.bindBuffer(34962,null),h.bindBuffer(34963,null),o.JL=null,o.ZL=null;for(var K=0;K<l.DD.length;K++){var q=l.DD[K];Y=null;for(var Q=0;Q<n.tB.length;Q++){var J=n.tB[Q];if(J.ND===q.ND){Y=J;break}}if(Y){o.JL!==Y.XL&&(h.bindBuffer(34962,Y.XL),o.JL=Y.XL);for(var Z=0;Z<Y.rB;++Z){var tt=q.FD+Z,it=Y.VD+Y.YL*Z;h.enableVertexAttribArray(tt),o.bB[tt]=!0,h.vertexAttribPointer(tt,Y.lp,Y.uD,Y.sB,Y.BD,it),h.vertexAttribDivisor(tt,Y.eB?1:0)}}}var nt=n.kB;nt&&h.bindBuffer(34963,nt.XL),h.bindVertexArray(null),h.bindBuffer(34962,null),h.bindBuffer(34963,null),o.JL=null,o.ZL=null}o.qL!==X&&(h.bindVertexArray(X),o.qL=X)}else{for(var rt=0;rt<u.maxVertexAttributes;++rt)o.bB[rt]=!1;for(var st=0;st<l.DD.length;st++){for(var et=l.DD[st],ht=null,ut=0;ut<n.tB.length;ut++){var ot=n.tB[ut];if(ot.ND===et.ND){ht=ot;break}}if(ht){o.JL!==ht.XL&&(h.bindBuffer(34962,ht.XL),o.JL=ht.XL);for(var ct=0;ct<ht.rB;++ct){var at=et.FD+ct,ft=ht.VD+ht.YL*ct;!o.AB[at]&&at>=0&&(h.enableVertexAttribArray(at),o.AB[at]=!0),o.bB[at]=!0,h.vertexAttribPointer(at,ht.lp,ht.uD,ht.sB,ht.BD,ft),h.vertexAttribDivisor(at,ht.eB?1:0)}}}var vt=n.kB;vt&&o.ZL!==vt.XL&&(h.bindBuffer(34963,vt.XL),o.ZL=vt.XL);for(var lt=0;lt<u.maxVertexAttributes;++lt)o.AB[lt]!==o.bB[lt]&&(h.disableVertexAttribArray(lt),o.AB[lt]=!1)}if(i&&i.EB.length)for(var dt=i.EB.length,wt=0;wt<dt;wt++)switch(i.EB[wt]){case 1:c.lineWidth!==e.lineWidth&&(h.lineWidth(e.lineWidth),c.lineWidth=e.lineWidth);break;case 2:c.depthBias===e.depthBiasConstant&&o.hN.depthBiasSlop===e.depthBiasSlope||(h.polygonOffset(e.depthBiasConstant,e.depthBiasSlope),c.depthBias=e.depthBiasConstant,c.depthBiasSlop=e.depthBiasSlope);break;case 4:var gt=e.blendConstant;v.x===gt.x&&v.y===gt.y&&v.z===gt.z&&v.w===gt.w||(h.blendColor(gt.x,gt.y,gt.z,gt.w),v.copy(gt));break;case 16:var pt=e.stencilStatesFront,_t=e.stencilStatesBack;a.stencilWriteMaskFront!==pt.writeMask&&(h.stencilMaskSeparate(1028,pt.writeMask),a.stencilWriteMaskFront=pt.writeMask),a.stencilWriteMaskBack!==_t.writeMask&&(h.stencilMaskSeparate(1029,_t.writeMask),a.stencilWriteMaskBack=_t.writeMask);break;case 32:var yt=e.stencilStatesFront,mt=e.stencilStatesBack;a.stencilRefFront===yt.reference&&a.stencilReadMaskFront===yt.compareMask||(h.stencilFuncSeparate(1028,zct[a.stencilFuncFront],yt.reference,yt.compareMask),a.stencilRefFront=yt.reference,a.stencilReadMaskFront=yt.compareMask),a.stencilRefBack===mt.reference&&a.stencilReadMaskBack===mt.compareMask||(h.stencilFuncSeparate(1029,zct[a.stencilFuncBack],mt.reference,mt.compareMask),a.stencilRefBack=mt.reference,a.stencilReadMaskBack=mt.compareMask)}}function vat(t,i){var n=t.gl,r=cat.wU,s=cat.pB,e=t.extensions.TB;if(r){var h=r.kB;if(r.OB){var u=r.OB.nD;if(u.SB){for(var o=0;o<u.IB;o++)u.RB[o]=u.MB[o]*h.BD;if(e)u.CB?e.multiDrawElementsInstancedWEBGL(s,u.NB,0,r.PB,u.RB,0,u.LB,0,u.IB):e.multiDrawElementsWEBGL(s,u.NB,0,r.PB,u.RB,0,u.IB);else for(var c=0;c<u.IB;c++)u.LB[c]?n.drawElementsInstanced(s,u.NB[c],r.PB,u.RB[c],u.LB[c]):n.drawElements(s,u.NB[c],r.PB,u.RB[c])}else if(e)u.CB?e.multiDrawArraysInstancedWEBGL(s,u.MB,0,u.NB,0,u.LB,0,u.IB):e.multiDrawArraysWEBGL(s,u.MB,0,u.NB,0,u.IB);else for(var a=0;a<u.IB;a++)u.LB[a]?n.drawArraysInstanced(s,u.MB[a],u.NB[a],u.LB[a]):n.drawArrays(s,u.MB[a],u.NB[a])}else if(i.instanceCount)if(h){if(i.indexCount>0){var f=i.firstIndex*h.BD;n.drawElementsInstanced(s,i.indexCount,r.PB,f,i.instanceCount)}}else i.vertexCount>0&&n.drawArraysInstanced(s,i.firstVertex,i.vertexCount,i.instanceCount);else if(h){if(i.indexCount>0){var v=i.firstIndex*h.BD;n.drawElements(s,i.indexCount,r.PB,v)}}else i.vertexCount>0&&n.drawArrays(s,i.firstVertex,i.vertexCount)}}function lat(t,i){if(t.length>1||i.length>1)return!1;if(t[0]instanceof HTMLVideoElement){var n=t[0];return 0===i[0].texOffset.x&&0===i[0].texOffset.y&&i[0].texExtent.width===n.videoWidth&&i[0].texExtent.height===n.videoHeight}return!1}function dat(t,i,n,r){var s=t.gl,e=t.dU(),h=e.vD[e.lD];h.fD!==n.fD&&(s.bindTexture(n.WL,n.fD),h.fD=n.fD);var u=0,o=0;switch(n.WL){case 3553:if(128&n.DB||lat(i,r))s.texImage2D(3553,r[0].texSubres.mipLevel,n.eD,r[0].texExtent.width,r[0].texExtent.height,0,n.sD,n.uD,i[0]);else for(var c=0;c<r.length;c++){var a=r[c];s.texSubImage2D(3553,a.texSubres.mipLevel,a.texOffset.x,a.texOffset.y,n.sD,n.uD,i[u++])}break;case 34067:for(var f=0;f<r.length;f++){var v=r[f],l=v.texSubres,d=v.texOffset,w=l.baseArrayLayer+l.layerCount;for(o=l.baseArrayLayer;o<w;++o)s.texSubImage2D(34069+o,l.mipLevel,d.x,d.y,n.sD,n.uD,i[u++])}break;default:ht(16327)}1&n.DB&&s.generateMipmap(n.WL)}var wat=new Uint8Array(1);function gat(t,i,n,r,s){var e=Xd(i).height,h=Hd(i,s.width,s.height,s.depth),u=Hd(i,r.width,1,1),o=Hd(i,r.width,r.height,1),c=Hd(i,s.width,1,1),a=Wd(Fd[i]);wat.byteLength<h&&(wat=new Uint8Array(h));for(var f=0,v=n,l=0;l<s.depth;l++){v=n+o*l;for(var d=0;d<s.height;d+=e)wat.subarray(f,f+c).set(new Uint8Array(t.buffer,t.byteOffset+v,c)),f+=c,v+=u}var w=h/a.BYTES_PER_ELEMENT;return ot(Number.isInteger(w),9101),new a(wat.buffer,0,w)}function pat(t,i,n,r){var s=t.gl,e=t.dU(),h=e.vD[e.lD];h.fD!==n.fD&&(s.bindTexture(n.WL,n.fD),h.fD=n.fD);var u=0,o=0,c=Fd[n.hD],a=Wd(c),f=c.isCompressed,v=Xd(n.hD),l=new Nl,d=new Ml,w=new Nl;switch(n.WL){case 3553:for(var g=0;g<r.length;g++){var p=r[g],_=p.texSubres.mipLevel,y=p.texOffset,m=p.texExtent,b=m.width,k=m.height,A=v.width,E=v.height,T=p.buffStride;d.x=0===y.x?0:Yd(y.x,A),d.y=0===y.y?0:Yd(y.y,E),l.width=b<A?b:Yd(b,A),l.height=k<E?b:Yd(k,E),w.width=T>0?T:l.width,w.height=p.buffTexHeight>0?p.buffTexHeight:l.height;var O=b+d.x===n.oD>>_?b:l.width,S=k+d.y===n.cD>>_?k:l.height,I=void 0,R=i[u++];if(w.width===l.width&&w.height===l.height){var M=Hd(n.hD,O,S,1)/a.BYTES_PER_ELEMENT;ot(Number.isInteger(M),9101),I=new a(R.buffer,R.byteOffset+p.buffOffset,M)}else I=gat(R,n.hD,p.buffOffset,w,l);f?36196!==n.eD?s.compressedTexSubImage2D(3553,_,d.x,d.y,O,S,n.sD,I):s.compressedTexImage2D(3553,_,n.eD,O,S,0,I):s.texSubImage2D(3553,_,d.x,d.y,O,S,n.sD,n.uD,I)}break;case 35866:for(var C=0;C<r.length;C++){var N=r[C],P=N.texSubres.mipLevel,L=N.texOffset,D=N.texExtent,B=D.width,F=D.height,U=v.width,x=v.height,G=N.buffStride,j=N.texSubres;d.x=0===L.x?0:Yd(L.x,U),d.y=0===L.y?0:Yd(L.y,x),l.width=B<U?B:Yd(B,U),l.height=F<x?B:Yd(F,x),l.depth=1,w.width=G>0?G:l.width,w.height=N.buffTexHeight>0?N.buffTexHeight:l.height;var H=B+d.x===n.oD>>P?B:l.width,V=F+d.y===n.cD>>P?F:l.height,$=j.baseArrayLayer+j.layerCount;for(o=j.baseArrayLayer;o<$;++o){d.z=o;var z=void 0,W=i[u++];if(w.width===l.width&&w.height===l.height){var X=Hd(n.hD,H,V,1)/a.BYTES_PER_ELEMENT;ot(Number.isInteger(X),9101),z=new a(W.buffer,W.byteOffset+N.buffOffset,X)}else z=gat(W,n.hD,N.buffOffset,w,l);f?36196!==n.eD?s.compressedTexSubImage3D(35866,P,d.x,d.y,d.z,H,V,l.depth,n.sD,z):s.compressedTexImage3D(35866,P,n.eD,H,V,l.depth,0,z):s.texSubImage3D(35866,P,d.x,d.y,d.z,H,V,l.depth,n.sD,n.uD,z)}}break;case 32879:for(var Y=0;Y<r.length;Y++){var K=r[Y],q=K.texSubres.mipLevel,Q=K.texOffset,J=K.texExtent,Z=J.width,tt=J.height,it=v.width,nt=v.height,rt=K.buffStride;d.x=0===Q.x?0:Yd(Q.x,it),d.y=0===Q.y?0:Yd(Q.y,nt),d.z=Q.z,l.width=Z<it?Z:Yd(Z,it),l.height=tt<nt?Z:Yd(tt,nt),l.depth=J.depth,w.width=rt>0?rt:l.width,w.height=K.buffTexHeight>0?K.buffTexHeight:l.height;var st=Z+d.x===n.oD>>q?Z:l.width,et=tt+d.y===n.cD>>q?tt:l.height,ut=void 0,ct=i[u++];if(w.width===l.width&&w.height===l.height){var at=Hd(n.hD,st,et,l.depth)/a.BYTES_PER_ELEMENT;ot(Number.isInteger(at),9101),ut=new a(ct.buffer,ct.byteOffset+K.buffOffset,at)}else ut=gat(ct,n.hD,K.buffOffset,w,l);f?36196!==n.eD?s.compressedTexSubImage3D(35866,q,d.x,d.y,d.z,st,et,l.depth,n.sD,ut):s.compressedTexImage3D(35866,q,n.eD,st,et,l.depth,0,ut):s.texSubImage3D(35866,q,d.x,d.y,d.z,st,et,l.depth,n.sD,n.uD,ut)}break;case 34067:for(var ft=0;ft<r.length;ft++){var vt=r[ft],lt=vt.texSubres.mipLevel,dt=vt.texOffset,wt=vt.texExtent,gt=wt.width,pt=wt.height,_t=v.width,yt=v.height,mt=vt.buffStride,bt=vt.texSubres;d.x=0===dt.x?0:Yd(dt.x,_t),d.y=0===dt.y?0:Yd(dt.y,yt),l.width=gt<_t?gt:Yd(gt,_t),l.height=pt<yt?gt:Yd(pt,yt),w.width=mt>0?mt:l.width,w.height=vt.buffTexHeight>0?vt.buffTexHeight:l.height;var kt=gt+d.x===n.oD>>lt?gt:l.width,At=pt+d.y===n.cD>>lt?pt:l.height,Et=bt.baseArrayLayer+bt.layerCount;for(o=bt.baseArrayLayer;o<Et;++o){var Tt=void 0,Ot=i[u++];if(w.width===l.width&&w.height===l.height){var St=Hd(n.hD,kt,At,1)/a.BYTES_PER_ELEMENT;ot(Number.isInteger(St),9101),Tt=new a(Ot.buffer,Ot.byteOffset+vt.buffOffset,St)}else Tt=gat(Ot,n.hD,vt.buffOffset,w,l);f?36196!==n.eD?s.compressedTexSubImage2D(34069+o,lt,d.x,d.y,kt,At,n.sD,Tt):s.compressedTexImage2D(34069+o,lt,n.eD,kt,At,0,Tt):s.texSubImage2D(34069+o,lt,d.x,d.y,kt,At,n.sD,n.uD,Tt)}}break;default:ht(16327)}1&n.DB&&s.generateMipmap(n.WL)}function _at(t,i,n,r){var s=t.gl,e=t.dU(),h=s.createFramebuffer();s.bindFramebuffer(36160,h);var u=0,o=0,c=1,a=1;if(3553===i.WL)for(var f=0;f<r.length;f++){var v=r[f];s.framebufferTexture2D(36160,36064,i.WL,i.fD,v.texSubres.mipLevel),u=v.texOffset.x,o=v.texOffset.y,c=v.texExtent.width,a=v.texExtent.height,s.readPixels(u,o,c,a,i.sD,i.uD,n[f])}else ht(16399);s.bindFramebuffer(36160,null),e.TD=null,s.deleteFramebuffer(h)}function yat(t,i,n,r,s){var e=t.gl,h=t.dU(),u=t.blitManager;if(u){var o=2===s||3===s?9729:9728,c=u.srcFramebuffer,a=u.dstFramebuffer,f=h.NU,v=h.TD,l=r[0].srcSubres.mipLevel,d=r[0].dstSubres.mipLevel,w=function(t){var i=0,n=36064;return t.hasStencil?n=33306:t.hasDepth&&(n=36096),t.hasDepth||t.hasStencil?(t.hasDepth&&(i|=256),t.hasStencil&&(i|=1024)):i|=16384,{mask:i,attachment:n}},g=r.map((function(t,i){return i}));g.sort((function(t,i){return r[t].srcSubres.mipLevel-r[i].srcSubres.mipLevel}));var p=w(Fd[i.format]),_=p.mask,y=p.attachment,m=w(Fd[n.hD]).attachment;h.NU!==c&&(e.bindFramebuffer(36008,c),h.NU=c),h.TD!==a&&(e.bindFramebuffer(36009,a),h.TD=a),i.glTexture?e.framebufferTexture2D(36008,y,i.glTarget,i.glTexture,l):e.framebufferRenderbuffer(36008,y,36161,i.glRenderbuffer),n.fD?e.framebufferTexture2D(36009,m,n.WL,n.fD,d):e.framebufferRenderbuffer(36009,m,36161,n.mD);for(var b=0;b<g.length;b++){var k=r[g[b]];i.glTexture&&l!==k.srcSubres.mipLevel&&(l=k.srcSubres.mipLevel,e.framebufferTexture2D(36008,y,i.glTarget,i.glTexture,l)),n.fD&&d!==k.dstSubres.mipLevel&&(d=k.dstSubres.mipLevel,e.framebufferTexture2D(36009,m,n.WL,n.fD,d)),e.blitFramebuffer(k.srcOffset.x,k.srcOffset.y,k.srcOffset.x+k.srcExtent.width,k.srcOffset.y+k.srcExtent.height,k.dstOffset.x,k.dstOffset.y,k.dstOffset.x+k.dstExtent.width,k.dstOffset.y+k.dstExtent.height,_,o)}h.NU!==f&&(e.bindFramebuffer(36008,f),h.NU=f),h.TD!==v&&(e.bindFramebuffer(36009,v),h.TD=v)}}var mat=function(){function t(){}return t.UB=function(i){t.se=i},r(t,null,[{key:"instance",get:function(){return t.se}}]),t}();mat.se=null;var bat=function(){function t(){this.NB=void 0,this.MB=void 0,this.LB=void 0,this.IB=0,this.SB=!1,this.CB=!1,this.RB=void 0,this.AO=4,this.NB=new Int32Array(4),this.MB=new Int32Array(4),this.LB=new Int32Array(4),this.RB=new Int32Array(4)}var i=t.prototype;return i.iD=function(){this.IB=0,this.SB=!1,this.CB=!1},i.rD=function(t,i){this.xB(t),this.SB=i.indexCount>0,this.CB=!!i.instanceCount,this.IB=Math.max(t+1,this.IB),this.SB?(this.NB[t]=i.indexCount,this.MB[t]=i.firstIndex):(this.NB[t]=i.vertexCount,this.MB[t]=i.firstVertex),this.LB[t]=Math.max(1,i.instanceCount)},i.xB=function(t){if(!(this.AO>t)){this.AO=Jn(t);var i=new Int32Array(this.AO),n=new Int32Array(this.AO),r=new Int32Array(this.AO);this.RB=new Int32Array(this.AO),i.set(this.NB),n.set(this.MB),r.set(this.LB),this.NB=i,this.MB=n,this.LB=r}},t}(),kat=function(){function t(){this.PU=void 0,this.LU=void 0;var t=mat.instance.gl;this.PU=t.createFramebuffer(),this.LU=t.createFramebuffer()}return t.prototype.Ww=function(){var t=mat.instance.gl;t.deleteFramebuffer(this.PU),t.deleteFramebuffer(this.LU)},r(t,[{key:"srcFramebuffer",get:function(){return this.PU}},{key:"dstFramebuffer",get:function(){return this.LU}}]),t}(),Aat=function(t){function i(){var i;return(i=t.call(this)||this).rF=null,i}e(i,t);var n=i.prototype;return n.lU=function(){return this.rF},n.initialize=function(t){if("buffer"in t){this.gn=!0;var i=t.buffer;this.vn=i.usage,this.ln=i.memUsage,this.dn=this.wn=t.range,this.nt=1,this.Xt=i.flags,this.rF={zL:this.vn,$L:this.ln,YL:this.dn,BD:this.wn,tD:null,nD:i.lU().nD,WL:i.lU().WL,XL:i.lU().XL,SU:t.offset}}else this.vn=t.usage,this.ln=t.memUsage,this.dn=t.size,this.wn=Math.max(t.stride||this.dn,1),this.nt=this.dn/this.wn,this.Xt=t.flags,this.rF={zL:this.vn,$L:this.ln,YL:this.dn,BD:this.wn,tD:null,nD:new bat,WL:0,XL:null,SU:0},Kct(mat.instance,this.rF),mat.instance.memoryStatus.bufferSize+=this.dn},n.destroy=function(){this.rF&&(this.gn||(qct(mat.instance,this.rF),mat.instance.memoryStatus.bufferSize-=this.dn),this.rF=null)},n.resize=function(t){if(this.gn)st(16379);else{var i=this.dn;i!==t&&(this.dn=t,this.nt=this.dn/this.wn,this.rF&&(this.rF.YL=t,t>0&&(Qct(mat.instance,this.rF),mat.instance.memoryStatus.bufferSize-=i,mat.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,i){var n;this.gn?st(16380):(n=void 0!==i?i:64&this.vn?0:t.byteLength,Jct(mat.instance,this.rF,t,0,n))},i}(qd),Eat=function(t){function i(){var i;return(i=t.call(this)||this).hF=!1,i.uF=null,i.aF=[],i.oF=null,i.fF=Array(8).fill(0),i.vF=new Cd,i.DU=!1,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.C=t.type,this.pn=t.queue;for(var i=mat.instance.bindingMappings.dF.length,n=0;n<i;n++)this.aF.push(null)},n.destroy=function(){},n.begin=function(){this.uF=null,this.oF=null,this.aF.length=0,this._n=0,this.yn=0,this.mn=0},n.end=function(){this.DU&&this.wF(),this.hF=!1},n.beginRenderPass=function(){ht(16401),this.hF=!0},n.endRenderPass=function(){this.hF=!1},n.bindPipelineState=function(t){var i=t.gpuPipelineState;i!==this.uF&&(this.uF=i,this.DU=!0)},n.bindDescriptorSet=function(t,i,n){var r=i.gpuDescriptorSet;if(r!==this.aF[t]&&(this.aF[t]=r,this.DU=!0),n){var s,e=null==(s=this.uF)?void 0:s._B;if(e){for(var h=this.fF,u=e.tF[t],o=0;o<n.length;o++)h[u+o]=n[o];this.DU=!0}}},n.bindInputAssembler=function(t){var i=t.gpuInputAssembler;this.oF=i,this.DU=!0},n.setViewport=function(t){var i=this.vF.viewport;i.left===t.left&&i.top===t.top&&i.width===t.width&&i.height===t.height&&i.minDepth===t.minDepth&&i.maxDepth===t.maxDepth||(i.left=t.left,i.top=t.top,i.width=t.width,i.height=t.height,i.minDepth=t.minDepth,i.maxDepth=t.maxDepth,this.DU=!0)},n.setScissor=function(t){var i=this.vF.scissor;i.x===t.x&&i.y===t.y&&i.width===t.width&&i.height===t.height||(i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,this.DU=!0)},n.setLineWidth=function(t){this.vF.lineWidth!==t&&(this.vF.lineWidth=t,this.DU=!0)},n.setDepthBias=function(t,i,n){var r=this.vF;r.depthBiasConstant===t&&r.depthBiasClamp===i&&r.depthBiasSlope===n||(r.depthBiasConstant=t,r.depthBiasClamp=i,r.depthBiasSlope=n,this.DU=!0)},n.setBlendConstants=function(t){var i=this.vF.blendConstant;i.x===t.x&&i.y===t.y&&i.z===t.z&&i.w===t.w||(i.copy(t),this.DU=!0)},n.setDepthBound=function(t,i){var n=this.vF;n.depthMinBounds===t&&n.depthMaxBounds===i||(n.depthMinBounds=t,n.depthMaxBounds=i,this.DU=!0)},n.setStencilWriteMask=function(t,i){var n=this.vF.stencilStatesFront,r=this.vF.stencilStatesBack;1&t&&n.writeMask!==i&&(n.writeMask=i,this.DU=!0),2&t&&r.writeMask!==i&&(r.writeMask=i,this.DU=!0)},n.setStencilCompareMask=function(t,i,n){var r=this.vF.stencilStatesFront,s=this.vF.stencilStatesBack;1&t&&(r.compareMask===n&&r.reference===i||(r.reference=i,r.compareMask=n,this.DU=!0)),2&t&&(s.compareMask===n&&s.reference===i||(s.reference=i,s.compareMask=n,this.DU=!0))},n.draw=function(){ht(16328)},n.updateBuffer=function(){ht(16329)},n.copyBuffersToTexture=function(){ht(16330)},n.execute=function(){ht(16402)},n.pipelineBarrier=function(){},n.wF=function(){ht(16401),this.DU=!1},n.blitTexture=function(){ht(16401)},i}(Qd),Tat=function(t){function i(){var i;return(i=t.call(this)||this).pF=null,i.BU=[],i.FU=void 0,i}e(i,t);var n=i.prototype;return n.mF=function(){return this.pF},n.initialize=function(t){var i,n=this;this.zn=t.renderPass,this.Wn=t.colorTextures||[],this.$n=t.depthStencilTexture||null;for(var r=[],s=0;s<t.colorTextures.length;s++){var e=t.colorTextures[s];e&&r.push(e.gpuTextureView)}var h=null;t.depthStencilTexture&&(h=t.depthStencilTexture.gpuTextureView);var u=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;this.pF={iF:t.renderPass.UU(),yU:r,kU:h,TD:null,ED:!0,get width(){return this.yU.length>0?this.yU[0].HL.oD:this.kU?this.kU.HL.oD:u},set width(t){u=t},get height(){return this.yU.length>0?this.yU[0].HL.cD:this.kU?this.kU.HL.cD:o},set height(t){o=t}},rat(mat.instance,this.pF),this.pF.yU.forEach((function(t){return n.BU.push(t.HL.fD)})),this.FU=null==(i=this.pF.kU)?void 0:i.HL.fD,this.Xn=this.pF.oD,this.Yn=this.pF.cD},n.destroy=function(){this.pF&&(sat(mat.instance,this.pF),this.pF=null,this.BU.length=0,this.FU=null)},r(i,[{key:"needRebuild",get:function(){var t=this.mF();if(t){for(var i,n=0;n<t.yU.length;n++)if(t.yU[n].HL.fD!==this.BU[n])return!0;if((null==(i=t.kU)?void 0:i.HL.fD)!==this.FU)return!0}return!1}}]),i}(iw),Oat=function(t){function i(){var i;return(i=t.call(this)||this).zB=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){if(0!==t.vertexBuffers.length){if(this.Kn=t.attributes,this.qn=this.computeAttributesHash(),this.Qn=t.vertexBuffers,t.indexBuffer)this.Jn=t.indexBuffer,this.tr.indexCount=this.Jn.size/this.Jn.stride,this.tr.firstIndex=0;else{var i=this.Qn[0];this.tr.vertexCount=i.size/i.stride,this.tr.firstVertex=0,this.tr.vertexOffset=0}this.tr.instanceCount=0,this.tr.firstInstance=0,this.Zn=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),r=0;r<t.vertexBuffers.length;++r){var s=t.vertexBuffers[r];s.lU()&&(n[r]=s.lU())}var e=null,h=0;if(t.indexBuffer&&(e=t.indexBuffer.lU()))switch(e.BD){case 1:h=5121;break;case 2:h=5123;break;case 4:h=5125;break;default:ht(16332)}var u=null;t.indirectBuffer&&(u=t.indirectBuffer.lU()),this.zB={iB:t.attributes,nB:n,kB:e,OB:u,tB:[],PB:h,hB:new Map},uat(mat.instance,this.zB)}else ht(16331)},n.destroy=function(){var t=mat.instance;this.zB&&t.extensions.KL&&oat(t,this.zB),this.zB=null},r(i,[{key:"gpuInputAssembler",get:function(){return this.zB}}]),i}(nw),Sat=function(t){e(n,t);var i=n.prototype;function n(){var i;return(i=t.call(this)||this).jB=null,i}return i.fU=function(){return this.jB},i.initialize=function(t){Array.prototype.push.apply(this.hr,t.bindings);for(var i=0,n=-1,r=[],s=0;s<this.hr.length;s++){var e=this.hr[s];r.push(i),i+=e.count,e.binding>n&&(n=e.binding)}this.ur=Array(n+1).fill(-1);for(var h=this.cr=Array(n+1).fill(-1),u=0;u<this.hr.length;u++){var o=this.hr[u];this.ur[o.binding]=u,h[o.binding]=r[u]}for(var c=[],a=0;a<this.hr.length;a++){var f=this.hr[a];if(10&f.descriptorType)for(var v=0;v<f.count;v++)c.push(f.binding)}this.jB={BL:this.hr,QB:c,FL:h,UL:i}},i.destroy=function(){this.hr.length=0},n}(sw),Iat=function(t){function i(){var i;return(i=t.call(this)||this).HB=null,i}e(i,t);var n=i.prototype;return n.xU=function(){return this.HB},n.initialize=function(t){Array.prototype.push.apply(this.vr,t.setLayouts);for(var i=[],n=[],r=0,s=[],e=0;e<this.vr.length;e++){for(var h=this.vr[e],u=h.fU(),o=u.QB,c=Array(h.bindingIndices.length).fill(-1),a=0;a<o.length;a++){var f=o[a];c[f]<0&&(c[f]=r+a)}n.push(u),i.push(c),s.push(r),r+=o.length}this.HB={JB:n,yB:i,ZB:r,tF:s}},n.destroy=function(){this.vr.length=0},i}(ew),Rat=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],Mat=function(t){function i(){var i;return(i=t.call(this)||this).VB=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.wr=t.primitive,this.lr=t.shader,this.dr=t.pipelineLayout;var i=this.yr;if(t.blendState){var n=t.blendState,r=n.targets;r&&r.forEach((function(t,n){i.setTarget(n,t)})),void 0!==n.isA2C&&(i.isA2C=n.isA2C),void 0!==n.isIndepend&&(i.isIndepend=n.isIndepend),void 0!==n.blendColor&&(i.blendColor=n.blendColor)}Object.assign(this.pr,t.rasterizerState),Object.assign(this._r,t.depthStencilState),this.gr=t.inputState,this.zn=t.renderPass,this.mr=t.dynamicStates;for(var s=[],e=0;e<31;e++)this.mr&1<<e&&s.push(1<<e);this.VB={pB:Rat[t.primitive],gB:t.shader.gpuShader,_B:t.pipelineLayout.xU(),hN:t.rasterizerState,fB:t.depthStencilState,lB:t.blendState,iF:t.renderPass.UU(),EB:s}},n.destroy=function(){this.VB=null},r(i,[{key:"gpuPipelineState",get:function(){return this.VB}}]),i}(fw),Cat=function(t){function i(){return t.call(this)||this}e(i,t);var n=i.prototype;return n.beginRenderPass=function(t,i,n,r,s,e){aat(mat.instance,t.UU(),i.mF(),n,r,s,e),this.hF=!0},n.draw=function(t){if(this.hF){this.DU&&this.wF();var i="drawInfo"in t?t.drawInfo:t;vat(mat.instance,i),++this._n,this.yn+=i.instanceCount;var n=i.indexCount||i.vertexCount;if(this.uF)switch(this.uF.pB){case 4:this.mn+=n/3*Math.max(i.instanceCount,1);break;case 5:case 6:this.mn+=(n-2)*Math.max(i.instanceCount,1)}}else ht(16328)},n.setViewport=function(t){var i=mat.instance.gl,n=mat.instance.dU();n.oB.left===t.left&&n.oB.top===t.top&&n.oB.width===t.width&&n.oB.height===t.height||(i.viewport(t.left,t.top,t.width,t.height),n.oB.left=t.left,n.oB.top=t.top,n.oB.width=t.width,n.oB.height=t.height)},n.setScissor=function(t){var i=mat.instance.gl,n=mat.instance.dU();n.aB.x===t.x&&n.aB.y===t.y&&n.aB.width===t.width&&n.aB.height===t.height||(i.scissor(t.x,t.y,t.width,t.height),n.aB.x=t.x,n.aB.y=t.y,n.aB.width=t.width,n.aB.height=t.height)},n.updateBuffer=function(t,i,n){if(this.hF)ht(16329);else{var r,s=t.lU();s&&(r=void 0!==n?n:64&t.usage?0:i.byteLength,Jct(mat.instance,s,i,0,r))}},n.copyBuffersToTexture=function(t,i,n){if(this.hF)ht(16330);else{var r=i.gpuTexture;r&&pat(mat.instance,t,r,n)}},n.execute=function(){ht(16402)},n.wF=function(){fat(mat.instance,this.uF,this.oF,this.aF,this.fF,this.vF),this.DU=!1},n.blitTexture=function(t,i,n,r){var s=t.gpuTexture,e=i.gpuTexture;yat(mat.instance,s,e,n,r)},i}(Eat),Nat=function(t){function i(){var i;return(i=t.call(this)||this).bF=0,i.kF=0,i.AF=0,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.C=t.type},n.destroy=function(){},n.submit=function(t){for(var i=0;i<t.length;i++){var n=t[i];this.bF+=n.numDrawCalls,this.kF+=n.numInstances,this.AF+=n.numTris}},n.l_=function(){this.bF=0,this.kF=0,this.AF=0},i}(vw),Pat=function(t){function i(){var i;return(i=t.call(this)||this).EF=null,i}e(i,t);var n=i.prototype;return n.UU=function(){return this.EF},n.initialize=function(t){this.kr=t.colorAttachments,this.Ar=t.depthStencilAttachment,this.Er=t.subpasses,this.EF={vB:this.kr,dB:this.Ar},this.Tr=this.computeHash()},n.destroy=function(){this.EF=null},i}(lw),Lat=function(t){function i(i,n){var r,s,e;return(r=t.call(this,i,n)||this).TF=null,r.TF={pU:new Map,GU:r.Or.minFilter,jU:r.Or.magFilter,HU:r.Or.mipFilter,VU:r.Or.addressU,$U:r.Or.addressV,zU:r.Or.addressW,_D:0,yD:0,gD:0,pD:0,nF:0,CU:function(t,i,n){var r=t.gl,s=i<<16|n;if(!this.pU.has(s)){var e=r.createSampler();if(e){this.pU.set(s,e);var h=r.samplerParameteri.bind(r),u=r.samplerParameterf.bind(r);h(e,10241,this._D),h(e,10240,this.yD),h(e,10242,this.gD),h(e,10243,this.pD),h(e,32882,this.nF),u(e,33082,i),u(e,33083,n)}}return this.pU.get(s)}},s=mat.instance,e=r.TF,s.gl,2===e.GU||3===e.GU?2===e.HU||3===e.HU?e._D=9987:1===e.HU?e._D=9985:e._D=9729:2===e.HU||3===e.HU?e._D=9986:1===e.HU?e._D=9984:e._D=9728,2===e.jU||3===e.jU?e.yD=9729:e.yD=9728,e.gD=Lct[e.VU],e.pD=Lct[e.$U],e.nF=Lct[e.zU],r}return e(i,t),i.prototype.destroy=function(){this.TF&&(nat(mat.instance,this.TF),this.TF=null)},r(i,[{key:"gpuSampler",get:function(){return this.TF}}]),i}(dw),Dat=function(t){function i(){var i;return(i=t.call(this)||this).GB=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){this.Sr=t.name,this.Ir=t.stages,this.Kn=t.attributes,this.Rr=t.blocks,this.Cn=t.samplers,this.GB={ND:t.name,UD:t.blocks.slice(),WD:t.samplerTextures.slice(),zD:t.subpassInputs.slice(),RD:new Array(t.stages.length),PD:null,DD:[],jD:[],xD:[],XD:[]};for(var i=0;i<t.stages.length;++i){var n=t.stages[i];this.GB.RD[i]={GL:n.stage,CD:n.source,MD:null}}},n.destroy=function(){this.GB&&(hat(mat.instance,this.GB),this.GB=null)},r(i,[{key:"gpuShader",get:function(){return null===this.GB.PD&&eat(mat.instance,this.GB),this.GB}}]),i}(ww),Bat=function(){function t(){this.JL=null,this.ZL=null,this.gU=null,this.IU=[],this.RU=[],this.qL=null,this.lD=0,this.vD=[],this._U=[],this.mD=null,this.TD=null,this.NU=null,this.oB=new Ul,this.aB=new Cl(0,0,0,0),this.hN=new hw,this.fB=new uw,this.lB=new cw,this.PD=null,this.AB=[],this.bB=[],this.QD={}}return t.prototype.Se=function(t,i,n){for(var r=0;r<t;++r)this.vD.push({fD:null});this._U.length=t,this._U.fill(null),this.IU.length=i,this.IU.fill(null),this.RU.length=i,this.RU.fill(0),this.AB.length=n,this.AB.fill(!1),this.bB.length=n,this.bB.fill(!1)},t}(),Fat=function(t){function i(){var i;return(i=t.call(this)||this).OF=null,i.WU=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t,i){var n=this,r=mat.instance,s=n.Or,e=n.Mr,h=t,u=t;if("texture"in t&&(h=u.texture.info,n.Nr=!0),s.copy(h),n.Cr=Gd(s.width)&&Gd(s.height),n.dn=Vd(s.format,n.width,n.height,n.depth,s.levelCount)*s.layerCount,n.Nr){var o;if(e.copy(u),n.OF=u.texture.OF,(null==(o=n.OF)?void 0:o.hD)!==h.format)return void tt(16403);n.WU={HL:n.OF,GL:u.type,hD:u.format,mU:u.baseLevel,MU:u.levelCount}}else n.OF={GL:h.type,hD:h.format,zL:h.usage,oD:h.width,cD:h.height,IF:h.depth,YL:n.dn,RF:h.layerCount,dD:h.levelCount,MF:h.samples,DB:h.flags,wD:n.Cr,WL:0,eD:0,sD:0,uD:0,CF:0,fD:null,mD:null,gD:0,pD:0,_D:0,yD:0,AD:i||!1},n.OF.AD||(Zct(r,n.OF),r.memoryStatus.textureSize+=n.dn),e.texture=n,e.type=t.type,e.format=t.format,e.baseLevel=0,e.levelCount=t.levelCount,e.baseLayer=0,e.layerCount=t.layerCount,n.WU={HL:n.OF,GL:e.type,hD:e.format,mU:e.baseLevel,MU:e.levelCount}},n.destroy=function(){var t=this,i=mat.instance;!t.Nr&&t.OF&&(tat(i,t.OF),i.memoryStatus.textureSize-=t.dn,t.OF=null)},n.getTextureHandle=function(){var t=this.OF;return t?t.fD?t.fD:t.mD?t.mD:0:0},n.resize=function(t,n){var r=this,s=mat.instance,e=r.Or;if(e.width!==t||e.height!==n){e.levelCount===i.getLevelCount(e.width,e.height)?e.levelCount=i.getLevelCount(t,n):e.levelCount>1&&(e.levelCount=Math.min(e.levelCount,i.getLevelCount(t,n)));var h=r.dn;e.width=t,e.height=n,r.dn=Vd(e.format,r.width,r.height,r.depth,e.levelCount)*e.layerCount;var u=r.OF;!r.Nr&&u&&(u.oD=t,u.cD=n,u.YL=r.dn,u.AD||(iat(s,u),s.memoryStatus.textureSize-=h,s.memoryStatus.textureSize+=r.dn))}},n.initAsSwapchainTexture=function(t){var i=new Kl;i.format=t.format,i.usage=Fd[t.format].hasDepth?32:16,i.width=t.width,i.height=t.height,this.initialize(i,!0)},r(i,[{key:"gpuTexture",get:function(){return this.OF}},{key:"gpuTextureView",get:function(){return this.WU}}]),i}(gw),Uat="webglcontextlost";function xat(t){t.activeTexture(33984),t.pixelStorei(3333,1),t.pixelStorei(3317,1),t.pixelStorei(37440,!1),t.bindFramebuffer(36160,null),t.enable(3089),t.enable(2884),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.enable(2929),t.depthMask(!0),t.depthFunc(513),t.stencilFuncSeparate(1028,519,1,65535),t.stencilOpSeparate(1028,7680,7680,7680),t.stencilMaskSeparate(1028,65535),t.stencilFuncSeparate(1029,519,1,65535),t.stencilOpSeparate(1029,7680,7680,7680),t.stencilMaskSeparate(1029,65535),t.disable(2960),t.disable(32926),t.disable(3042),t.blendEquationSeparate(32774,32774),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}function Gat(t,i){for(var n=["","WEBKIT_","MOZ_"],r=0;r<n.length;++r){var s=t.getExtension(n[r]+i);if(s)return s}return null}function jat(t){var i={NF:Gat(t,"EXT_texture_filter_anisotropic"),FF:Gat(t,"EXT_color_buffer_half_float"),XU:Gat(t,"EXT_color_buffer_float"),xF:Gat(t,"WEBGL_compressed_texture_etc1"),GF:Gat(t,"WEBGL_compressed_texture_etc"),jF:Gat(t,"WEBGL_compressed_texture_pvrtc"),ZF:Gat(t,"WEBGL_compressed_texture_astc"),HF:Gat(t,"WEBGL_compressed_texture_s3tc"),VF:Gat(t,"WEBGL_compressed_texture_s3tc_srgb"),$F:Gat(t,"WEBGL_debug_shaders"),zF:Gat(t,"WEBGL_lose_context"),JF:Gat(t,"WEBGL_debug_renderer_info"),XF:Gat(t,"OES_texture_half_float_linear"),KF:Gat(t,"OES_texture_float_linear"),TB:null,KL:!0};return wh.os!==ch.ANDROID&&wh.os!==ch.IOS&&(i.TB=Gat(t,"WEBGL_multi_draw")),i}function Hat(t){var i=null;try{var n={alpha:Si.ENABLE_TRANSPARENT_CANVAS,antialias:Si.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};i=t.getContext("webgl2",n)}catch(t){return null}return i}var Vat=function(t){function i(){var i;return(i=t.call(this)||this).tU=new Bat,i.iU=null,i.nU=null,i.Dr=null,i.YU=null,i.sU=null,i.eU=null,i}e(i,t);var n=i.prototype;return n.initialize=function(t){var i=this;i.Dr=t.windowHandle,i.YU=i.hU.bind(i),i.Dr.addEventListener(Uat,i.hU);var n=mat.instance,r=n.gl,s=n.capabilities;i.tU.Se(s.maxTextureUnits,s.maxUniformBufferBindings,s.maxVertexAttributes),i.sU=jat(r),xat(r);var e=55,h=r.getParameter(3414),u=r.getParameter(3415);h&&u?e=55:h&&(e=54),i.Vn=new Fat,i.Vn.initAsSwapchainTexture({swapchain:i,format:35,width:t.width,height:t.height}),i.$n=new Fat,i.$n.initAsSwapchainTexture({swapchain:i,format:e,width:t.width,height:t.height}),i.iU=n.createTexture(new Kl(1,4,35,2,2,0)),i.nU=n.createTexture(new Kl(3,4,35,2,2,0,6));var o=new Fl;o.texExtent.width=2,o.texExtent.height=2;var c=new Uint8Array(i.iU.size);c.fill(0),n.copyBuffersToTexture([c],i.iU,[o]),o.texSubres.layerCount=6,n.copyBuffersToTexture([c,c,c,c,c,c],i.nU,[o]),i.eU=new kat},n.destroy=function(){var t=this;t.Dr&&t.YU&&(t.Dr.removeEventListener(Uat,t.YU),t.YU=null),t.iU&&(t.iU.destroy(),t.iU=null),t.nU&&(t.nU.destroy(),t.nU=null),t.eU&&(t.eU.Ww(),t.eU=null),t.sU=null,t.Dr=null},n.resize=function(t,i){var n=this;n.Vn.width===t&&n.Vn.height===i||(K("Resizing swapchain: "+t+"x"+i),n.Dr.width=t,n.Dr.height=i,n.Vn.resize(t,i),n.$n.resize(t,i))},n.hU=function(t){st(11e3),W(t)},r(i,[{key:"extensions",get:function(){return this.sU}},{key:"blitManager",get:function(){return this.eU}}]),i}(tw);function $at(t,i,n){for(var r=0;r<i.length;++r)t[i[r]]=n}function zat(t,i,n){for(var r=0;r<i.length;++r)t[i[r]]=n}var Wat=t("ea",function(t){function i(){var i;return(i=t.call(this)||this).Br=null,i.Gs=null,i.uU=null,i.oU=new Array(117),i}e(i,t);var n=i.prototype;return n.dU=function(){return this.Br.tU},n.initialize=function(t){mat.UB(this),this.kn=7;var i=this.Mn=t.bindingMappingInfo,n=[],r=[],s=i.setIndices[0];n[s]=0,r[s]=0;for(var e=1;e<i.setIndices.length;++e){var h=i.setIndices[e],u=i.setIndices[e-1];n[h]=i.maxBlockCounts[u]+n[u],r[h]=i.maxSamplerTextureCounts[u]+r[u]}for(var o=0;o<i.setIndices.length;++o){var c=i.setIndices[o];r[c]-=i.maxBlockCounts[c]}this.uU={dF:n,ZD:r,JD:i.setIndices[i.setIndices.length-1]};var a=this.Gs=Hat(Jd.Bn);if(!a)return ht(16405),!1;this.pn=this.createQueue(new Od(0)),this.Sn=this.createCommandBuffer(new Td(this.pn));var f=a.getParameter.bind(a),v=this.Rn;if(v.maxVertexAttributes=f(34921),v.maxVertexUniformVectors=f(36347),wh.os===ch.IOS){var l=v.maxVertexUniformVectors;bh.browserType===hh.WECHAT?v.maxVertexUniformVectors=l<256?l:256:bh.browserType===hh.SAFARI&&(v.maxVertexUniformVectors=l<512?l:512)}v.maxFragmentUniformVectors=f(36349),v.maxTextureUnits=f(34930),v.maxVertexTextureUnits=f(35660),v.maxUniformBufferBindings=f(35375),v.maxUniformBlockSize=f(35376),v.maxTextureSize=f(3379),v.maxCubeMapTextureSize=f(34076),v.maxArrayTextureLayers=f(35071),v.max3DTextureSize=f(32883),v.uboOffsetAlignment=f(35380);var d=a.getSupportedExtensions(),w="";d&&d.forEach((function(t){w+=t+" "}));var g=jat(a);g.JF?(this.An=f(g.JF.UNMASKED_RENDERER_WEBGL),this.En=f(g.JF.UNMASKED_VENDOR_WEBGL)):(this.An=f(7937),this.En=f(7936));var p=f(7938),_=this.Tn;_.fill(!1),this.cU(g),_[0]=!0,_[1]=!0,_[2]=!0,_[3]=!0;var y="";return this.getFormatFeatures(72)&&(y+="etc1 "),this.getFormatFeatures(73)&&(y+="etc2 "),this.getFormatFeatures(56)&&(y+="dxt "),this.getFormatFeatures(83)&&(y+="pvrtc "),this.getFormatFeatures(89)&&(y+="astc "),K("WebGL2 device initialized."),K("RENDERER: "+this.An),K("VENDOR: "+this.En),K("VERSION: "+p),K("COMPRESSED_FORMAT: "+y),K("EXTENSIONS: "+w),!0},n.destroy=function(){this.pn&&(this.pn.destroy(),this.pn=null),this.Sn&&(this.Sn.destroy(),this.Sn=null);for(var t=this.Cn.values(),i=t.next();!i.done;)i.value.destroy(),i=t.next();this.Br=null},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this.pn;this._n=t.bF,this.yn=t.kF,this.mn=t.AF,t.l_()},n.cU=function(t){var i=this.On,n=this.oU;i.fill(0),n.fill(!0);var r=31;$at(i,[4,14,24,35],r),$at(i,[5,15,26,38,47,50,49,51,25,37,48,53,54,55],r=15),i[52]=15,$at(i,[8,18,29,41],r=27),$at(i,[11,21,32,44],r=26),i[52]=15,$at(i,[7,6,10,9,13,12,17,16,20,19,23,22,28,27,31,30,34,33,40,39,43,42,46,45],r=31),zat(n,[4,14,24,47,50,49,35,51,52,37,7,6,10,9,13,12,17,16,20,19,23,22,40,39,43,42,46,45,54,55],!1),t.XU&&(i[11]|=1,i[21]|=1,i[44]|=1,zat(n,[11,21,44],!1)),t.FF&&zat(n,[8,18,41],!1),t.KF&&(i[32]|=4,i[44]|=4,i[11]|=4,i[21]|=4),t.XF&&(i[29]|=4,i[41]|=4,i[8]|=4,i[18]|=4),t.xF&&(i[72]=6),t.GF&&$at(i,[73,77,74,78,75,76],6),t.HF&&$at(i,[56,57,58,59,60,61,62,63],6),t.jF&&$at(i,[83,84,85,86],6),t.ZF&&$at(i,[89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116],6)},n.createCommandBuffer=function(t){var i=new(0===t.type?Cat:Eat);return i.initialize(t),i},n.createSwapchain=function(t){var i=new Vat;return this.Br=i,i.initialize(t),i},n.createBuffer=function(t){var i=new Aat;return i.initialize(t),i},n.createTexture=function(t){var i=new Fat;return i.initialize(t),i},n.createDescriptorSet=function(t){var i=new Pct;return i.initialize(t),i},n.createShader=function(t){var i=new Dat;return i.initialize(t),i},n.createInputAssembler=function(t){var i=new Oat;return i.initialize(t),i},n.createRenderPass=function(t){var i=new Pat;return i.initialize(t),i},n.createFramebuffer=function(t){var i=new Tat;return i.initialize(t),i},n.createDescriptorSetLayout=function(t){var i=new Sat;return i.initialize(t),i},n.createPipelineLayout=function(t){var i=new Iat;return i.initialize(t),i},n.createPipelineState=function(t){var i=new Mat;return i.initialize(t),i},n.createQueue=function(t){var i=new Nat;return i.initialize(t),i},n.getSampler=function(t){var i=dw.computeHash(t);return this.Cn.has(i)||this.Cn.set(i,new Lat(t,i)),this.Cn.get(i)},n.getSwapchains=function(){return[this.Br]},n.getGeneralBarrier=function(t){var i=pw.computeHash(t);return this.Nn.has(i)||this.Nn.set(i,new pw(t,i)),this.Nn.get(i)},n.getTextureBarrier=function(t){var i=_w.computeHash(t);return this.Pn.has(i)||this.Pn.set(i,new _w(t,i)),this.Pn.get(i)},n.getBufferBarrier=function(t){var i=yw.computeHash(t);return this.Ln.has(i)||this.Ln.set(i,new yw(t,i)),this.Ln.get(i)},n.copyBuffersToTexture=function(t,i,n){pat(this,t,i.gpuTexture,n)},n.copyTextureToBuffers=function(t,i,n){_at(this,t.gpuTexture,i,n)},n.copyTexImagesToTexture=function(t,i,n){dat(this,t,i.gpuTexture,n)},r(i,[{key:"gl",get:function(){return this.Gs}},{key:"extensions",get:function(){return this.Br.extensions}},{key:"nullTex2D",get:function(){return this.Br.iU}},{key:"nullTexCube",get:function(){return this.Br.nU}},{key:"textureExclusive",get:function(){return this.oU}},{key:"bindingMappings",get:function(){return this.uU}},{key:"blitManager",get:function(){return this.Br.blitManager}}]),i}(Jd));O.WebGL2Device=Wat;var Xat={BUTT:0,ROUND:1,SQUARE:2};bi(Xat);var Yat={BEVEL:0,ROUND:1,MITER:2};bi(Yat),bi({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});var Kat=Math.PI,qat=Math.min,Qat=Math.max,Jat=Math.cos,Zat=Math.sin,tft=Math.abs,ift=Math.sign,nft=.5522847493;function rft(t,i,n,r,s,e,h){var u,o,c=0,a=0,f=0,v=0,l=0,d=0,w=0,g=0,p=0,_=0,y=0,m=0,b=0,k=0;if(a=e-s,h=h||!1)if(tft(a)>=2*Kat)a=2*Kat;else for(;a<0;)a+=2*Kat;else if(tft(a)>=2*Kat)a=2*-Kat;else for(;a>0;)a-=2*Kat;for(o=0|Qat(1,qat(tft(a)/(.5*Kat)+.5,5)),f=tft(4/3*(1-Jat(u=a/o/2))/Zat(u)),h||(f=-f),k=0;k<=o;k++)d=i+(v=Jat(c=s+a*(k/o)))*r,w=n+(l=Zat(c))*r,g=-l*r*f,p=v*r*f,0===k?t.KU(d,w):t.qU(_+m,y+b,d-g,w-p,d,w),_=d,y=w,m=g,b=p}function sft(t,i,n,r,s){t.KU(i-r,n),t.qU(i-r,n+s*nft,i-r*nft,n+s,i,n+s),t.qU(i+r*nft,n+s,i+r,n+s*nft,i+r,n),t.qU(i+r,n-s*nft,i+r*nft,n-s,i,n-s),t.qU(i-r*nft,n-s,i-r,n-s*nft,i-r,n),t.QU()}function eft(t,i,n,r,s,e){if(e<.1)t.JU(i,n,r,s);else{var h=qat(e,.5*tft(r))*ift(r),u=qat(e,.5*tft(s))*ift(s);t.KU(i,n+u),t.ZU(i,n+s-u),t.qU(i,n+s-u*(1-nft),i+h*(1-nft),n+s,i+h,n+s),t.ZU(i+r-h,n+s),t.qU(i+r-h*(1-nft),n+s,i+r,n+s-u*(1-nft),i+r,n+s-u),t.ZU(i+r,n+u),t.qU(i+r,n+u*(1-nft),i+r-h*(1-nft),n,i+r-h,n),t.ZU(i+h,n),t.qU(i+h*(1-nft),n,i,n+u*(1-nft),i,n+u),t.QU()}}function hft(t,i,n,r,s,e,h,u,o,c,a){var f,v,l,d,w,g,p,_,y,m,b,k,A,E,T,O;c>10||(w=.5*(e+u),g=.5*(h+o),p=.5*((f=.5*(i+r))+(l=.5*(r+e))),_=.5*((v=.5*(n+s))+(d=.5*(s+h))),((T=tft((r-u)*(E=o-n)-(s-o)*(A=u-i)))+(O=tft((e-u)*E-(h-o)*A)))*(T+O)<t.tx*(A*A+E*E)?t.ix(u,o,0===a?4|a:a):(hft(t,i,n,f,v,p,_,b=.5*(p+(y=.5*(l+w))),k=.5*(_+(m=.5*(d+g))),c+1,0),hft(t,b,k,y,m,w,g,u,o,c+1,a)))}var uft,oft,cft,aft,fft,vft,lft,dft,wft,gft,pft,_ft,yft,mft=function(t){function i(i,n){var r;return(r=t.call(this,i,n)||this).dx=0,r.dy=0,r.dmx=0,r.dmy=0,r.flags=0,r.len=0,r}return e(i,t),i.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},i}(Ms),bft=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[]}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points.length=0},t}(),kft=function(){function t(t){this.nx=0,this.sx=!1,this.hx=0,this.ux=0,this.ox=[],this.tx=.25,this.vx=.01,this.lx=Qs.WHITE.clone(),this.wx=0,this.gx=Qs.BLACK.clone(),this.yx=2,this.mx=0,this.bx=0,this.kx=0,this.Ax=0,this.Ex=[],this.Tx=[],this.Ox=null,this.Sx=t}var i=t.prototype;return i.KU=function(t,i){this.sx&&(this.ux=this.hx,this.sx=!1),this.Ix(),this.ix(t,i,1),this.kx=t,this.Ax=i},i.ZU=function(t,i){this.ix(t,i,1),this.kx=t,this.Ax=i},i.qU=function(t,i,n,r,s,e){var h=this.Ox,u=h.points[h.points.length-1];u&&(u.x!==t||u.y!==i||n!==s||r!==e?(hft(this,u.x,u.y,t,i,n,r,s,e,0,1),this.kx=s,this.Ax=e):this.ZU(s,e))},i.Rx=function(t,i,n,r){var s=this.kx,e=this.Ax;this.qU(s+2/3*(t-s),e+2/3*(i-e),n+2/3*(t-n),r+2/3*(i-r),n,r)},i.Mx=function(t,i,n,r,s,e){rft(this,t,i,n,r,s,e)},i.Cx=function(t,i,n,r){sft(this,t,i,n,r),this.Ox.complex=!1},i.Nx=function(t,i,n){sft(this,t,i,n,n),this.Ox.complex=!1},i.JU=function(t,i,n,r){this.KU(t,i),this.ZU(t+n,i),this.ZU(t+n,i+r),this.ZU(t,i+r),this.QU(),this.Ox.complex=!1},i.Px=function(t,i,n,r,s){eft(this,t,i,n,r,s),this.Ox.complex=!1},i.l_=function(){this.hx=0,this.ux=0,this.bx=0,this.nx=0,this.Ox=null,this.ox.length=0,this.Ex.length=0;for(var t=this.Tx,i=0,n=t.length;i<n;i++){var r=t[i];r&&fB.remove(r)}this.Tx.length=0},i.QU=function(){this.Ox.closed=!0},i.Lx=function(){var t=fB.add();return this.Tx.push(t),t},i.Dx=function(){return 0===this.Tx.length&&this.Lx(),this.Tx},i.ix=function(t,i,n){var r=this.Ox;if(r){var s=this.Ex,e=r.points,h=s[this.bx++];h?(h.x=t,h.y=i):(h=new mft(t,i),s.push(h)),h.flags=n,e.push(h)}},i.Ix=function(){var t=this.hx,i=this.ox[t];return i?i.reset():(i=new bft,this.ox.push(i)),this.hx++,this.Ox=i,i},t}(),Aft=xD.concat([new ud("a_dist",11)]),Eft=$D(Aft),Tft=zD(Aft),Oft=t("ec",(uft=_o("cc.Graphics"),oft=mo(110),cft=ic(Yat),aft=ic(Xat),uft(fft=oft((yft=function(t){function i(){var i;return(i=t.call(this)||this).impl=null,i.model=null,i._lineWidth=lft&&lft(),i._strokeColor=dft&&dft(),i._lineJoin=wft&&wft(),i._lineCap=gft&&gft(),i._fillColor=pft&&pft(),i._miterLimit=_ft&&_ft(),i._isDrawing=!1,i._isNeedUploadData=!0,i.Bx=[],i._instanceMaterialType=0,i.impl=new kft(v(i)),i}e(i,t);var n=i.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){t.prototype.onLoad.call(this),this.model=xN.root.createModel(hC),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){t.prototype.onEnable.call(this),this.Fx()},n.onDestroy=function(){this._sceneGetter=null,this.model&&(xN.root.destroyModel(this.model),this.model=null);var i=this.Bx.length;if(i>0){for(var n=0;n<i;++n)this.Bx[n].destroy();this.Bx.length=0}this.impl&&(this._isDrawing=!1,this.impl.l_(),this.impl=null),t.prototype.onDestroy.call(this)},n.moveTo=function(t,i){this.impl&&this.impl.KU(t,i)},n.lineTo=function(t,i){this.impl&&this.impl.ZU(t,i)},n.bezierCurveTo=function(t,i,n,r,s,e){this.impl&&this.impl.qU(t,i,n,r,s,e)},n.quadraticCurveTo=function(t,i,n,r){this.impl&&this.impl.Rx(t,i,n,r)},n.arc=function(t,i,n,r,s,e){this.impl&&this.impl.Mx(t,i,n,r,s,e)},n.ellipse=function(t,i,n,r){this.impl&&this.impl.Cx(t,i,n,r)},n.circle=function(t,i,n){this.impl&&this.impl.Nx(t,i,n)},n.rect=function(t,i,n,r){this.impl&&this.impl.JU(t,i,n,r)},n.roundRect=function(t,i,n,r,s){this.impl&&this.impl.Px(t,i,n,r,s)},n.fillRect=function(t,i,n,r){this.rect(t,i,n,r),this.fill()},n.clear=function(){if(this.impl){if(this.impl.l_(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++){var i=this.model.subModels[t].inputAssembler;i.indexCount=0,i.vertexCount=0}this.vo()}},n.close=function(){this.impl&&this.impl.QU()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n.Fx=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=Fk.get("ui-graphics-material"),this.setSharedMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var i=kw.gfxDevice,n=i.createBuffer(new $l(10,1,65535*Tft,Tft)),r=i.createBuffer(new $l(6,1,262140,2)),s=new jA([n],Aft,7,r);s.subMeshIdx=0,this.model.initSubModel(t,s,this.getMaterialInstance(0)),this.Bx.push(s)}}else st(4500,this.node.name)},n._uploadData=function(){var t=this.impl;if(t){var i=t&&t.Dx();if(!(i.length<=0)&&this.model){for(var n=this.model.subModels,r=0;r<i.length;r++){var s=i[r],e=n[r].inputAssembler;if(s.lastFilledVertex!==s.vertexStart){var h=new Float32Array(s.vData.buffer,0,s.vertexStart*Eft);e.vertexBuffers[0].update(h),e.vertexCount=s.vertexStart;var u=new Uint16Array(s.iData.buffer,0,s.indexStart);e.indexBuffer.update(u),e.indexCount=s.indexStart,s.lastFilledVertex=s.vertexStart,s.lastFilledIndex=s.indexStart}}this._isNeedUploadData=!1}}},n._render=function(t){if(this._isNeedUploadData){if(this.impl){var i=this.impl.Dx(),n=this.model.subModels.length;if(i.length>n)for(var r=n;r<i.length;r++)this.activeSubModel(r)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var t=i.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},n._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},n.updateRenderer=function(){t.prototype.updateRenderer.call(this)},n.createRenderEntity=function(){return new TB(1)},r(i,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.mx=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.yx=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.wx=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.gx=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.lx=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"graphicsNativeProxy",get:function(){return this._graphicsNativeProxy}}]),i}(GB),yft.LineJoin=Yat,yft.LineCap=Xat,y((vft=yft).prototype,"lineJoin",[cft],Object.getOwnPropertyDescriptor(vft.prototype,"lineJoin"),vft.prototype),y(vft.prototype,"lineCap",[aft],Object.getOwnPropertyDescriptor(vft.prototype,"lineCap"),vft.prototype),y(vft.prototype,"color",[ac],Object.getOwnPropertyDescriptor(vft.prototype,"color"),vft.prototype),lft=uo(vft.prototype,"_lineWidth",[Co],(function(){return 1})),dft=uo(vft.prototype,"_strokeColor",[Co],(function(){return Qs.BLACK.clone()})),wft=uo(vft.prototype,"_lineJoin",[Co],(function(){return 2})),gft=uo(vft.prototype,"_lineCap",[Co],(function(){return 0})),pft=uo(vft.prototype,"_fillColor",[Co],(function(){return Qs.WHITE.clone()})),_ft=uo(vft.prototype,"_miterLimit",[Co],(function(){return 10})),fft=vft))||fft)||fft));T.Graphics=Oft;var Sft=function(t,i,n){this.Ux=null,this.xx=null,this.Gx=null,this.jx=null,this.Hx=null,this.Vx=!1,this.$x=t,this.zx=i,this.Wx=n};function Ift(t,i,n,r,s){var e=0,h=null;if(s===Kft(t,i,n,r)>0)for(e=i;e<n;e+=r)h=Xft(e,t[e],t[e+1],h);else for(e=n-r;e>=i;e-=r)h=Xft(e,t[e],t[e+1],h);return h&&jft(h,h.xx)&&(Yft(h),h=h.xx),h}function Rft(t,i){if(void 0===i&&(i=null),!t)return t;i||(i=t);var n=t,r=!1;do{if(r=!1,n.Vx||!jft(n,n.xx)&&0!==Gft(n.Ux,n,n.xx))n=n.xx;else{if(Yft(n),(n=i=n.Ux)===n.xx)return null;r=!0}}while(r||n!==i);return i}function Mft(t,i,n,r,s,e,h){if(void 0===h&&(h=0),t){!h&&e&&Dft(t,r,s,e);for(var u=t,o=null,c=null;t.Ux!==t.xx;)if(o=t.Ux,c=t.xx,e?Nft(t,r,s,e):Cft(t))i.push(o.$x/n),i.push(t.$x/n),i.push(c.$x/n),Yft(t),t=c.xx,u=c.xx;else if((t=c)===u){h?1===h?Mft(t=Pft(t,i,n),i,n,r,s,e,2):2===h&&Lft(t,i,n,r,s,e):Mft(Rft(t),i,n,r,s,e,1);break}}}function Cft(t){var i=t.Ux,n=t,r=t.xx;if(Gft(i,n,r)>=0)return!1;for(var s=t.xx.xx;s!==t.Ux;){if(Uft(i.zx,i.Wx,n.zx,n.Wx,r.zx,r.Wx,s.zx,s.Wx)&&Gft(s.Ux,s,s.xx)>=0)return!1;s=s.xx}return!0}function Nft(t,i,n,r){var s=t.Ux,e=t,h=t.xx;if(Gft(s,e,h)>=0)return!1;for(var u=s.zx<e.zx?s.zx<h.zx?s.zx:h.zx:e.zx<h.zx?e.zx:h.zx,o=s.Wx<e.Wx?s.Wx<h.Wx?s.Wx:h.Wx:e.Wx<h.Wx?e.Wx:h.Wx,c=s.zx>e.zx?s.zx>h.zx?s.zx:h.zx:e.zx>h.zx?e.zx:h.zx,a=s.Wx>e.Wx?s.Wx>h.Wx?s.Wx:h.Wx:e.Wx>h.Wx?e.Wx:h.Wx,f=Fft(u,o,i,n,r),v=Fft(c,a,i,n,r),l=t.Hx;l&&l.Gx<=v;){if(l!==t.Ux&&l!==t.xx&&Uft(s.zx,s.Wx,e.zx,e.Wx,h.zx,h.Wx,l.zx,l.Wx)&&Gft(l.Ux,l,l.xx)>=0)return!1;l=l.Hx}for(l=t.jx;l&&l.Gx>=f;){if(l!==t.Ux&&l!==t.xx&&Uft(s.zx,s.Wx,e.zx,e.Wx,h.zx,h.Wx,l.zx,l.Wx)&&Gft(l.Ux,l,l.xx)>=0)return!1;l=l.jx}return!0}function Pft(t,i,n){var r=t;do{var s=r.Ux,e=r.xx.xx;!jft(s,e)&&Hft(s,r,r.xx,e)&&$ft(s,e)&&$ft(e,s)&&(i.push(s.$x/n),i.push(r.$x/n),i.push(e.$x/n),Yft(r),Yft(r.xx),r=t=e),r=r.xx}while(r!==t);return r}function Lft(t,i,n,r,s,e){var h=t;do{for(var u=h.xx.xx;u!==h.Ux;){if(h.$x!==u.$x&&xft(h,u)){var o=Wft(h,u);return h=Rft(h,h.xx),o=Rft(o,o.xx),Mft(h,i,n,r,s,e),void Mft(o,i,n,r,s,e)}u=u.xx}h=h.xx}while(h!==t)}function Dft(t,i,n,r){var s=t;do{null===s.Gx&&(s.Gx=Fft(s.zx,s.Wx,i,n,r)),s.jx=s.Ux,s.Hx=s.xx,s=s.xx}while(s!==t);s.jx.Hx=null,s.jx=null,Bft(s)}function Bft(t){var i=0,n=null,r=null,s=null,e=null,h=0,u=0,o=0,c=1;do{for(n=t,t=null,e=null,h=0;n;){for(h++,r=n,u=0,i=0;i<c&&(u++,r=r.Hx);i++);for(o=c;u>0||o>0&&r;)0===u?(s=r,r=r.Hx,o--):0!==o&&r?n.Gx<=r.Gx?(s=n,n=n.Hx,u--):(s=r,r=r.Hx,o--):(s=n,n=n.Hx,u--),e?e.Hx=s:t=s,s.jx=e,e=s;n=r}e.Hx=null,c*=2}while(h>1);return t}function Fft(t,i,n,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/s)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)/s)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Uft(t,i,n,r,s,e,h,u){return(s-h)*(i-u)-(t-h)*(e-u)>=0&&(t-h)*(r-u)-(n-h)*(i-u)>=0&&(n-h)*(e-u)-(s-h)*(r-u)>=0}function xft(t,i){return t.xx.$x!==i.$x&&t.Ux.$x!==i.$x&&!Vft(t,i)&&$ft(t,i)&&$ft(i,t)&&zft(t,i)}function Gft(t,i,n){return(i.Wx-t.Wx)*(n.zx-i.zx)-(i.zx-t.zx)*(n.Wx-i.Wx)}function jft(t,i){return t.zx===i.zx&&t.Wx===i.Wx}function Hft(t,i,n,r){return!!(jft(t,i)&&jft(n,r)||jft(t,r)&&jft(n,i))||Gft(t,i,n)>0!=Gft(t,i,r)>0&&Gft(n,r,t)>0!=Gft(n,r,i)>0}function Vft(t,i){var n=t;do{if(n.$x!==t.$x&&n.xx.$x!==t.$x&&n.$x!==i.$x&&n.xx.$x!==i.$x&&Hft(n,n.xx,t,i))return!0;n=n.xx}while(n!==t);return!1}function $ft(t,i){return Gft(t.Ux,t,t.xx)<0?Gft(t,i,t.xx)>=0&&Gft(t,t.Ux,i)>=0:Gft(t,i,t.Ux)<0||Gft(t,t.xx,i)<0}function zft(t,i){var n=t,r=!1,s=(t.zx+i.zx)/2,e=(t.Wx+i.Wx)/2;do{n.Wx>e!=n.xx.Wx>e&&s<(n.xx.zx-n.zx)*(e-n.Wx)/(n.xx.Wx-n.Wx)+n.zx&&(r=!r),n=n.xx}while(n!==t);return r}function Wft(t,i){var n=new Sft(t.$x,t.zx,t.Wx),r=new Sft(i.$x,i.zx,i.Wx),s=t.xx,e=i.Ux;return t.xx=i,i.Ux=t,n.xx=s,s.Ux=n,r.xx=n,n.Ux=r,e.xx=r,r.Ux=e,r}function Xft(t,i,n,r){var s=new Sft(t,i,n);return r?(s.xx=r.xx,s.Ux=r,r.xx.Ux=s,r.xx=s):(s.Ux=s,s.xx=s),s}function Yft(t){t.xx.Ux=t.Ux,t.Ux.xx=t.xx,t.jx&&(t.jx.Hx=t.Hx),t.Hx&&(t.Hx.jx=t.jx)}function Kft(t,i,n,r){for(var s=0,e=i,h=n-r;e<n;e+=r)s+=(t[h]-t[e])*(t[e+1]+t[h+1]),h=e;return s}function qft(t,i,n){n=n||3;var r=t.length,s=Ift(t,0,r,n,!0),e=[];if(!s)return e;var h=0,u=0,o=0,c=0,a=0,f=0,v=0;if(t.length>80*n){h=o=t[0],u=c=t[1];for(var l=n;l<r;l+=n)(a=t[l])<h&&(h=a),(f=t[l+1])<u&&(u=f),a>o&&(o=a),f>c&&(c=f);v=Math.max(o-h,c-u)}return Mft(s,e,n,h,u,v),e}for(var Qft=Math.PI,Jft=Math.min,Zft=Math.max,tvt=Math.ceil,ivt=Math.acos,nvt=Math.cos,rvt=Math.sin,svt=Math.atan2,evt=null,hvt=null,uvt=new Qs,ovt=[],cvt=0;cvt<4;cvt++)ovt.push(new Ir);function avt(t,i,n){var r=2*ivt(t/(t+n));return Zft(2,tvt(i/r))}function fvt(t,i,n){return t<i?i:t>n?n:t}var vvt,lvt,dvt,wvt,gvt,pvt,_vt,yvt,mvt,bvt,kvt=function(){function t(){}var i=t.prototype;return i.updateRenderData=function(){},i.Xx=function(t,i){if(!hvt)return null;var n=hvt.Dx(),r=n[hvt.nx];if(!r)return null;var s=r,e=s?s.vertexStart+i:0;return(e>65535||3*e>131070)&&(++hvt.nx,hvt.nx<n.length?r=n[hvt.nx]:(r=hvt.Lx(),n[hvt.nx]=r),s=r),s&&s.vertexCount<e&&s.request(i,3*i),r},i.stroke=function(t){Qs.copy(uvt,t.strokeColor),t.impl&&(this.Yx(t.impl),this.Kx(t),t.impl.sx=!0,this.end(t))},i.fill=function(t){Qs.copy(uvt,t.fillColor),this.qx(t),t.impl&&(t.impl.sx=!0),this.end(t)},i.end=function(t){t.vo()},i.Kx=function(t){var i=.5*t.lineWidth,n=t.lineCap,r=t.lineJoin,s=t.miterLimit;if(hvt=t.impl){var e=avt(i,Qft,hvt.tx);this.Qx(hvt,i,r,s);for(var h=hvt.ox,u=0,o=hvt.ux,c=hvt.hx;o<c;o++){var a=h[o],f=a.points.length;u+=1===r?2*(f+a.bevel*(e+2)+1):2*(f+5*a.bevel+1),a.closed||(u+=1===n?2*(2*e+2):12)}var v=evt=this.Xx(t,u);if(v){for(var l=v.vData,d=v.iData,w=hvt.ux,g=hvt.hx;w<g;w++){var p=h[w],_=p.points,y=_.length,m=v.vertexStart,b=void 0,k=void 0,A=0,E=0,T=p.closed;if(T?(b=_[y-1],k=_[0],A=0,E=y):(b=_[0],k=_[1],A=1,E=y-1),k=k||b,!T){var O=new mft(k.x,k.y);O.subtract(b),O.normalize();var S=O.x,I=O.y;0===n?this.Jx(b,S,I,i,0):2===n?this.Jx(b,S,I,i,i):1===n&&this.Zx(b,S,I,i,e)}for(var R=A;R<E;++R)1===r?this.tG(b,k,i,i,e):12&k.flags?this.iG(b,k,i,i):(this.nG(k.x+k.dmx*i,k.y+k.dmy*i,1),this.nG(k.x-k.dmx*i,k.y-k.dmy*i,-1)),b=k,k=_[R+1];if(T){var M=8*m;this.nG(l[M],l[M+1],1),this.nG(l[M+8],l[M+8+1],-1)}else{var C=new mft(k.x,k.y);C.subtract(b),C.normalize();var N=C.x,P=C.y;0===n?this.rG(k,N,P,i,0):2===n?this.rG(k,N,P,i,i):1===n&&this.sG(k,N,P,i,e)}for(var L=v.indexStart,D=m+2,B=v.vertexStart;D<B;D++)d[L++]=D-2,d[L++]=D-1,d[L++]=D;v.indexStart=L}evt=null,hvt=null}}},i.qx=function(t){if(hvt=t.impl){for(var i=hvt.ox,n=0,r=hvt.ux,s=hvt.hx;r<s;r++)n+=i[r].points.length;var e=evt=this.Xx(t,n);if(e){for(var h=e,u=h.vData,o=h.iData,c=hvt.ux,a=hvt.hx;c<a;c++){var f=i[c],v=f.points,l=v.length;if(0!==l){for(var d=e.vertexStart,w=0;w<l;++w)this.nG(v[w].x,v[w].y);var g=e.indexStart;if(f.complex){for(var p=[],_=d,y=e.vertexStart;_<y;_++){var m=8*_;p.push(u[m++]),p.push(u[m++]),p.push(u[m++])}var b=qft(p,0,3);if(!b||0===b.length)continue;for(var k=0,A=b.length;k<A;k++)o[g++]=b[k]+d}else for(var E=d,T=d+2,O=h.vertexStart;T<O;T++)o[g++]=E,o[g++]=T-1,o[g++]=T;h.indexStart=g}}evt=null,hvt=null}}},i.Qx=function(t,i,n,r){var s=0;i>0&&(s=1/i);for(var e=t.ox,h=t.ux,u=t.hx;h<u;h++){var o=e[h],c=o.points,a=c.length,f=c[a-1],v=c[0];o.bevel=0;for(var l=0;l<a;l++){var d,w,g=f.dy,p=-f.dx,_=v.dy,y=-v.dx;if(v.dmx=.5*(g+_),v.dmy=.5*(p+y),(d=v.dmx*v.dmx+v.dmy*v.dmy)>1e-6){var m=1/d;m>600&&(m=600),v.dmx*=m,v.dmy*=m}v.dx*f.dy-f.dx*v.dy>0&&(v.flags|=2),d*(w=Zft(11,Jft(f.len,v.len)*s))*w<1&&(v.flags|=8),1&v.flags&&(d*r*r<1||0===n||1===n)&&(v.flags|=4),12&v.flags&&o.bevel++,f=v,v=c[l+1]}}},i.Yx=function(t){for(var i=t.ox,n=t.ux,r=t.hx;n<r;n++){var s=i[n],e=s.points,h=e[e.length-1],u=e[0];e.length>2&&h.equals(u)&&(s.closed=!0,e.pop(),h=e[e.length-1]);for(var o=0,c=e.length;o<c;o++){var a=new mft(u.x,u.y);a.subtract(h),h.len=a.length(),(a.x||a.y)&&a.normalize(),h.dx=a.x,h.dy=a.y,h=u,u=e[o+1]}}},i.eG=function(t,i,n,r){var s=n.x,e=n.y,h=0,u=0,o=0,c=0;return 0!==t?(h=s+i.dy*r,u=e-i.dx*r,o=s+n.dy*r,c=e-n.dx*r):(h=o=s+n.dmx*r,u=c=e+n.dmy*r),[h,u,o,c]},i.Jx=function(t,i,n,r,s){var e=t.x-i*s,h=t.y-n*s,u=n,o=-i;this.nG(e+u*r,h+o*r,1),this.nG(e-u*r,h-o*r,-1)},i.rG=function(t,i,n,r,s){var e=t.x+i*s,h=t.y+n*s,u=n,o=-i;this.nG(e+u*r,h+o*r,1),this.nG(e-u*r,h-o*r,-1)},i.Zx=function(t,i,n,r,s){for(var e=t.x,h=t.y,u=n,o=-i,c=0;c<s;c++){var a=c/(s-1)*Qft,f=nvt(a)*r,v=rvt(a)*r;this.nG(e-u*f-i*v,h-o*f-n*v,1),this.nG(e,h,0)}this.nG(e+u*r,h+o*r,1),this.nG(e-u*r,h-o*r,-1)},i.sG=function(t,i,n,r,s){var e=t.x,h=t.y,u=n,o=-i;this.nG(e+u*r,h+o*r,1),this.nG(e-u*r,h-o*r,-1);for(var c=0;c<s;c++){var a=c/(s-1)*Qft,f=nvt(a)*r,v=rvt(a)*r;this.nG(e,h,0),this.nG(e-u*f+i*v,h-o*f+n*v,1)}},i.tG=function(t,i,n,r,s){var e=t.dy,h=-t.dx,u=i.dy,o=-i.dx,c=i.x,a=i.y;if(2&i.flags){var f=this.eG(8&i.flags,t,i,n),v=f[0],l=f[1],d=f[2],w=f[3],g=svt(-h,-e),p=svt(-o,-u);p>g&&(p-=2*Qft),this.nG(v,l,1),this.nG(c-e*r,i.y-h*r,-1);for(var _=fvt(tvt((g-p)/Qft)*s,2,s),y=0;y<_;y++){var m=g+y/(_-1)*(p-g),b=c+nvt(m)*r,k=a+rvt(m)*r;this.nG(c,a,0),this.nG(b,k,-1)}this.nG(d,w,1),this.nG(c-u*r,a-o*r,-1)}else{var A=this.eG(8&i.flags,t,i,-r),E=A[0],T=A[1],O=A[2],S=A[3],I=svt(h,e),R=svt(o,u);R<I&&(R+=2*Qft),this.nG(c+e*r,a+h*r,1),this.nG(E,T,-1);for(var M=fvt(tvt((R-I)/Qft)*s,2,s),C=0;C<M;C++){var N=I+C/(M-1)*(R-I),P=c+nvt(N)*n,L=a+rvt(N)*n;this.nG(P,L,1),this.nG(c,a,0)}this.nG(c+u*r,a+o*r,1),this.nG(O,S,-1)}},i.iG=function(t,i,n,r){var s=0,e=0,h=0,u=0,o=0,c=0,a=0,f=0,v=t.dy,l=-t.dx,d=i.dy,w=-i.dx;if(2&i.flags){var g=this.eG(8&i.flags,t,i,n);o=g[0],c=g[1],a=g[2],f=g[3],this.nG(o,c,1),this.nG(i.x-v*r,i.y-l*r,-1),this.nG(a,f,1),this.nG(i.x-d*r,i.y-w*r,-1)}else{var p=this.eG(8&i.flags,t,i,-r);s=p[0],e=p[1],h=p[2],u=p[3],this.nG(i.x+v*n,i.y+l*n,1),this.nG(s,e,-1),this.nG(i.x+d*n,i.y+w*n,1),this.nG(h,u,-1)}},i.nG=function(t,i,n){if(void 0===n&&(n=0),evt){var r=evt,s=8*r.vertexStart,e=r.vData;e[s++]=t,e[s++]=i,e[s++]=0,Qs.toArray(e,uvt,s),s+=4,e[s++]=n,r.vertexStart++}},t}(),Avt=new kvt,Evt=t("eb",{getAssembler:function(){return Avt}});Oft.Assembler=Evt,T.UI.graphicsAssembler=Evt;var Tvt=new ls,Ovt=new Ms,Svt=new ls,Ivt=[];function Rvt(t,i,n){Ivt.length=0;for(var r=2*Math.PI/n,s=0;s<n;++s)Ivt.push(new Ir(i.x*Math.cos(r*s)+t.x,i.y*Math.sin(r*s)+t.y,0));return Ivt}var Mvt=t("ed",{GRAPHICS_RECT:0,GRAPHICS_ELLIPSE:1,GRAPHICS_STENCIL:2,SPRITE_STENCIL:3});bi(Mvt);var Cvt=t("ee",(vvt=_o("cc.Mask"),lvt=mo(110),dvt=ic(Mvt),vvt(wvt=lvt((bvt=function(t){function i(){var i;return(i=t.call(this)||this)._type=pvt&&pvt(),i._inverted=_vt&&_vt(),i._segments=yvt&&yvt(),i._alphaThreshold=mvt&&mvt(),i._sprite=null,i._graphics=null,i._stencilStage=0,i}e(i,t);var n=i.prototype;return n.onLoad=function(){this.hG()},n.onEnable=function(){this.hG(),this._updateGraphics(),this._enableRender(),this.node.on("anchor-changed",this._nodeStateChange,this),this.node.on("size-changed",this._nodeStateChange,this)},n.onRestore=function(){this.hG(),this._updateGraphics()},n.onDisable=function(){this._disableRender(),this.node.off("anchor-changed",this._nodeStateChange,this),this.node.off("size-changed",this._nodeStateChange,this)},n.onDestroy=function(){this._removeMaskNode()},n.isHit=function(t){var i=this.node.qu(),n=i.contentSize,r=n.width,s=n.height,e=Ovt;this.node.getWorldMatrix(Tvt),ls.invert(Svt,Tvt),Ms.transformMat4(e,t,Svt);var h=i.anchorPoint;e.x+=h.x*r,e.y+=h.y*s;var u=!1;if(0===this.type||2===this.type||3===this.type)u=e.x>=0&&e.y>=0&&e.x<=r&&e.y<=s;else if(1===this.type){var o=r/2,c=s/2,a=e.x-.5*r,f=e.y-.5*s;u=a*a/(o*o)+f*f/(c*c)<1}return this._inverted&&(u=!u),u},n._nodeStateChange=function(){this._updateGraphics()},n.hG=function(){3!==this._type?this._createGraphics():this._createSprite()},n._createSprite=function(){if(!this._sprite){var t=this._sprite=this.node.getComponent(tU);if(!t){var i=this.node;t=this._sprite=i.addComponent(tU)}}this._sprite.stencilStage=this.inverted?6:2,this._sprite.updateMaterial()},n._createGraphics=function(){if(!this._graphics){var t=this._graphics=this.node.getComponent(Oft);if(!t){var i=this.node;t=this._graphics=i.addComponent(Oft)}t.lineWidth=1;var n=Qs.WHITE.clone();n.a=0,t.fillColor=n}this._graphics.stencilStage=this.inverted?6:2},n._updateGraphics=function(){if(this._graphics&&(0===this._type||1===this._type)){var t=this.node.qu(),i=this._graphics;i.clear();var n=t.contentSize,r=n.width,s=n.height,e=t.anchorPoint,h=-r*e.x,u=-s*e.y;if(0===this._type)i.rect(h,u,r,s);else if(1===this._type){for(var o=Rvt(new Ir(h+r/2,u+s/2,0),new Ir(r/2,s/2,0),this._segments),c=0;c<o.length;++c){var a=o[c];0===c?i.moveTo(a.x,a.y):i.lineTo(a.x,a.y)}i.close()}i.fill()}},n._enableRender=function(){this.subComp&&(this.subComp.enabled=!0)},n._disableRender=function(){this.subComp&&(this.subComp.stencilStage=0,this.subComp.updateMaterial(),this.node.activeInHierarchy&&(this.subComp.enabled=!1))},n._removeMaskNode=function(){this._sprite&&(this._sprite=null),this._graphics&&(this._graphics=null)},n.markForUpdateRenderData=function(t){void 0===t&&(t=!0),st(9007),this.subComp&&this.subComp.vo(t)},n.requestRenderData=function(){st(9007)},n.destroyRenderData=function(){st(9007)},n.updateRenderer=function(){st(9007),this.subComp&&this.subComp.updateRenderer()},n.fillBuffers=function(){st(9007)},n.postUpdateAssembler=function(){st(9007)},n.setNodeDirty=function(){st(9007),this.subComp&&this.subComp.setNodeDirty()},n.setTextureDirty=function(){st(9007),this.subComp&&this.subComp.setTextureDirty()},n.getMaterial=function(t){return st(9007),this.subComp?this.subComp.getSharedMaterial(t):null},n.setMaterial=function(t,i){st(9007),this.subComp&&this.subComp.setMaterial(t,i)},n.getMaterialInstance=function(t){return st(9007),this.subComp?this.subComp.getMaterialInstance(t):null},n.setMaterialInstance=function(t,i){st(9007),this.subComp&&this.subComp.setMaterialInstance(t,i)},n.getRenderMaterial=function(t){return st(9007),this.subComp?this.subComp.getRenderMaterial(t):null},r(i,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,3!==this._type?(this._sprite&&(this.node.removeComponent(tU),this._sprite._destroyImmediate(),this._sprite=null),this.hG(),this._updateGraphics()):(this._graphics&&(this._graphics.clear(),this.node.removeComponent(Oft),this._graphics._destroyImmediate(),this._graphics=null),this.hG()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.subComp.stencilStage=this.inverted?6:2}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=Gn(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._sprite?this._sprite.spriteFrame:null},set:function(t){this._sprite?this._sprite.spriteFrame=t:ht(16307)}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,3===this.type&&this._sprite&&this._sprite.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"subComp",get:function(){return this._graphics||this._sprite}},{key:"customMaterial",get:function(){return st(9007),this.subComp?this.subComp.customMaterial:null},set:function(t){st(9007),this.subComp&&(this.subComp.customMaterial=t)}},{key:"color",get:function(){return st(9007),this.subComp?this.subComp.color:null},set:function(t){st(9007),this.subComp&&t&&(this.subComp.color=t)}},{key:"sharedMaterial",get:function(){return st(9007),this.subComp?this.subComp.sharedMaterial:null}},{key:"sharedMaterials",get:function(){return st(9007),this.subComp?this.subComp.sharedMaterials:null},set:function(t){st(9007),this.subComp&&t&&(this.subComp.sharedMaterials=t)}},{key:"material",get:function(){return st(9007),this.subComp?this.subComp.material:null},set:function(t){st(9007),this.subComp&&(this.subComp.material=t)}},{key:"materials",get:function(){return st(9007),this.subComp?this.subComp.materials:[null]},set:function(t){st(9007),this.subComp&&(this.subComp.materials=t)}}]),i}(Kg),bvt.Type=Mvt,y((gvt=bvt).prototype,"type",[dvt],Object.getOwnPropertyDescriptor(gvt.prototype,"type"),gvt.prototype),pvt=uo(gvt.prototype,"_type",[Co],(function(){return 0})),_vt=uo(gvt.prototype,"_inverted",[Co],(function(){return!1})),yvt=uo(gvt.prototype,"_segments",[Co],(function(){return 64})),mvt=uo(gvt.prototype,"_alphaThreshold",[Co],(function(){return.1})),wvt=gvt))||wvt)||wvt));RE._maskComp=Cvt,T.Mask=Cvt;var Nvt=_i({GRAVITY:0,RADIUS:1}),Pvt=_i({FREE:0,RELATIVE:1,GROUPED:2}),Lvt=new Ms,Dvt=new Ms,Bvt=new Ms,Fvt=new Ms,Uvt=new $s,xvt=$D(GD);function Gvt(t){for(var i=0,n=t;n;)i+=n.eulerAngles.z,n=n.parent;return i}var jvt,Hvt,Vvt,$vt=function(){this.pos=new Ms(0,0),this.startPos=new Ms(0,0),this.color=new Qs(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new Ms(0,0),this.aspectRatio=1,this.dir=new Ms(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},zvt=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i.prototype.get=function(){return this._get()||new $vt},i}(ri),Wvt=new zvt((function(t){t.pos.set(Ms.ZERO),t.startPos.set(Ms.ZERO),t.color.set(0,0,0,255),t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(Ms.ZERO),t.aspectRatio=1,t.dir.set(Ms.ZERO),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),Xvt=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.renderData=null,this.uG=!0,this.oG=0,this.aG=0,this.fG=0,this.vG=t,this.particles=[],this.active=!1,this.uG=!0,this.finished=!1,this.oG=0,this.aG=0,this.uvFilled=0,this.fG=0}var i=t.prototype;return i.stop=function(){this.active=!1,this.uG=!1,this.oG=this.vG.duration,this.aG=0},i.reset=function(){this.active=!0,this.uG=!0,this.oG=0,this.aG=0,this.finished=!1;for(var t=this.particles,i=0;i<t.length;++i)Wvt.put(t[i]);t.length=0,this.renderData&&this.renderData.resize(0,0)},i.emitParticle=function(t){var i=this.vG,n=Wvt.get();this.particles.push(n),n.timeToLive=i.life+i.lifeVar*(zn()-.5)*2;var r=n.timeToLive=Math.max(0,n.timeToLive);n.pos.x=i.sourcePos.x+i.posVar.x*(zn()-.5)*2,n.pos.y=i.sourcePos.y+i.posVar.y*(zn()-.5)*2;var s,e,h,u,o=i.startColor,c=i.startColorVar,a=i.endColor,f=i.endColorVar;n.color.r=s=Gn(o.r+c.r*(zn()-.5)*2,0,255),n.color.g=e=Gn(o.g+c.g*(zn()-.5)*2,0,255),n.color.b=h=Gn(o.b+c.b*(zn()-.5)*2,0,255),n.color.a=u=Gn(o.a+c.a*(zn()-.5)*2,0,255),n.deltaColor.r=(Gn(a.r+f.r*(zn()-.5)*2,0,255)-s)/r,n.deltaColor.g=(Gn(a.g+f.g*(zn()-.5)*2,0,255)-e)/r,n.deltaColor.b=(Gn(a.b+f.b*(zn()-.5)*2,0,255)-h)/r,n.deltaColor.a=(Gn(a.a+f.a*(zn()-.5)*2,0,255)-u)/r;var v=i.startSize+i.startSizeVar*(zn()-.5)*2;if(v=Math.max(0,v),n.size=v,-1===i.endSize)n.deltaSize=0;else{var l=i.endSize+i.endSizeVar*(zn()-.5)*2;l=Math.max(0,l),n.deltaSize=(l-v)/r}var d=i.startSpin+i.startSpinVar*(zn()-.5)*2,w=i.endSpin+i.endSpinVar*(zn()-.5)*2;n.rotation=d,n.deltaRotation=(w-d)/r,n.startPos.x=t.x,n.startPos.y=t.y,n.aspectRatio=i.aspectRatio||1;var g=Vn(i.angle+this.fG+i.angleVar*(zn()-.5)*2);if(i.emitterMode===Nvt.GRAVITY){var p=i.speed+i.speedVar*(zn()-.5)*2;n.dir.x=Math.cos(g),n.dir.y=Math.sin(g),n.dir.multiplyScalar(p),n.radialAccel=i.radialAccel+i.radialAccelVar*(zn()-.5)*2,n.tangentialAccel=i.tangentialAccel+i.tangentialAccelVar*(zn()-.5)*2,i.rotationIsDir&&(n.rotation=-$n(Math.atan2(n.dir.y,n.dir.x)))}else{var _=i.startRadius+i.startRadiusVar*(zn()-.5)*2,y=i.endRadius+i.endRadiusVar*(zn()-.5)*2;n.radius=_,n.deltaRadius=-1===i.endRadius?0:(y-_)/r,n.angle=g,n.degreesPerSecond=Vn(i.rotatePerS+i.rotatePerSVar*(zn()-.5)*2)}},i.updateUVs=function(t){var i=this.renderData;if(i&&this.vG._renderSpriteFrame){for(var n=i.vData,r=this.vG._renderSpriteFrame.uv,s=t?0:this.uvFilled,e=this.particles.length,h=s;h<e;h++){var u=h*xvt*4;n[u+3]=r[0],n[u+4]=r[1],n[u+12]=r[2],n[u+13]=r[3],n[u+21]=r[4],n[u+22]=r[5],n[u+30]=r[6],n[u+31]=r[7]}this.uvFilled=e}},i.updateParticleBuffer=function(t,i,n,r){var s=n.vData,e=i.x,h=i.y,u=t.size,o=u,c=t.aspectRatio;c>1?o=u/c:u=o*c;var a=u/2,f=o/2;if(t.rotation){var v=-a,l=-f,d=a,w=f,g=-Vn(t.rotation),p=Math.cos(g),_=Math.sin(g);s[r]=v*p-l*_+e,s[r+1]=v*_+l*p+h,s[r+2]=0,s[r+9]=d*p-l*_+e,s[r+10]=d*_+l*p+h,s[r+11]=0,s[r+18]=v*p-w*_+e,s[r+19]=v*_+w*p+h,s[r+20]=0,s[r+27]=d*p-w*_+e,s[r+28]=d*_+w*p+h,s[r+29]=0}else s[r]=e-a,s[r+1]=h-f,s[r+2]=0,s[r+9]=e+a,s[r+10]=h-f,s[r+11]=0,s[r+18]=e-a,s[r+19]=h+f,s[r+20]=0,s[r+27]=e+a,s[r+28]=h+f,s[r+29]=0;var y=t.color;Uvt.x=y.r/255,Uvt.y=y.g/255,Uvt.z=y.b/255,Uvt.w=y.a/255,$s.toArray(s,Uvt,r+5),$s.toArray(s,Uvt,r+14),$s.toArray(s,Uvt,r+23),$s.toArray(s,Uvt,r+32)},i.step=function(t){var i=this.vG.assembler,n=this.vG,r=n.node,s=this.particles;if(t=t>i.maxParticleDeltaTime?i.maxParticleDeltaTime:t,r.updateWorldTransform(),n.positionType===Pvt.FREE){this.fG=Gvt(r);var e=r.worldMatrix;Lvt.x=e.m12,Lvt.y=e.m13}else n.positionType===Pvt.RELATIVE?(this.fG=r.eulerAngles.z,Lvt.x=r.position.x,Lvt.y=r.position.y):this.fG=0;if(this.active&&n.emissionRate){var h=1/n.emissionRate;for(s.length<n.totalParticles&&(this.aG+=t);s.length<n.totalParticles&&this.aG>h;)this.emitParticle(Lvt),this.aG-=h;this.oG+=t,-1!==n.duration&&n.duration<this.oG&&n.stopSystem()}var u=this.renderData;if(u){var o=s.length;u.reset(),this.requestData(4*o,6*o),o>this.uvFilled&&this.updateUVs();for(var c=0;c<s.length;){Dvt.x=Dvt.y=Bvt.x=Bvt.y=Fvt.x=Fvt.y=0;var a=s[c];if(a.timeToLive-=t,a.timeToLive>0){if(n.emitterMode===Nvt.GRAVITY){var f=Fvt,v=Dvt,l=Bvt;(a.pos.x||a.pos.y)&&(v.set(a.pos),v.normalize()),l.set(v),v.multiplyScalar(a.radialAccel);var d=l.x;l.x=-l.y,l.y=d,l.multiplyScalar(a.tangentialAccel),f.set(v),f.add(l),f.add(n.gravity),f.multiplyScalar(t),a.dir.add(f),f.set(a.dir),f.multiplyScalar(t),a.pos.add(f)}else a.angle+=a.degreesPerSecond*t,a.radius+=a.deltaRadius*t,a.pos.x=-Math.cos(a.angle)*a.radius,a.pos.y=-Math.sin(a.angle)*a.radius;a.color.r+=a.deltaColor.r*t,a.color.g+=a.deltaColor.g*t,a.color.b+=a.deltaColor.b*t,a.color.a+=a.deltaColor.a*t,a.size+=a.deltaSize*t,a.size<0&&(a.size=0),a.rotation+=a.deltaRotation*t;var w=Dvt;w.set(a.pos),n.positionType!==Pvt.GROUPED&&w.add(a.startPos);var g=xvt*c*4;this.updateParticleBuffer(a,w,u,g),++c}else{var p=s[c];c!==s.length-1&&(s[c]=s[s.length-1]),Wvt.put(p),s.length--,u.resize(u.vertexCount-4,u.indexCount-6)}}u.material=this.vG.getRenderMaterial(0),u.frame=this.vG._renderSpriteFrame,u.x_(),0!==s.length||this.active||this.uG||(this.finished=!0,n._finishedSimulation())}},i.requestData=function(t,i){if(this.renderData){var n=this.renderData.indexCount;this.renderData.request(t,i);for(var r=this.renderData.indexCount/6,s=this.renderData.iData,e=n;e<r;e++){var h=4*e;s[n++]=h,s[n++]=h+1,s[n++]=h+2,s[n++]=h+1,s[n++]=h+3,s[n++]=h+2}}},i.initDrawInfo=function(){var t;null==(t=this.renderData)||t.x_()},t}(),Yvt=Co,Kvt=t("ej",_o("cc.ParticleAsset")((Hvt=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this).spriteFrame=Vvt&&Vvt(),i}return e(i,t),i}(rg),Vvt=uo(Hvt.prototype,"spriteFrame",[Yvt],(function(){return null})),jvt=Hvt))||jvt);T.ParticleAsset=Kvt;for(var qvt=function(){function t(t){var i=this;this.lG=8,this.dG=[],this.wG=[],this.gG={indexed:[],rgb:[],grayscale:0},this.pG={},this.oD=0,this.cD=0,this._G=0,this.yG=0,this.mG=0,this.kG=0,this.AG=0,this.EG=0,this.TG=!1,this.OG=0,this.SG=null;for(var n,r=this.IG=t,s=0;;){s=this.MG();var e=function(){for(var t=[],n=0;n<4;++n)t.push(String.fromCharCode(r[i.lG++]));return t}.call(this).join("");switch(e){case"IHDR":this.oD=this.MG(),this.cD=this.MG(),this._G=r[this.lG++],this.yG=r[this.lG++],this.mG=r[this.lG++],this.kG=r[this.lG++],this.AG=r[this.lG++];break;case"acTL":this.CG={numFrames:this.MG(),numPlays:this.MG()||1/0,frames:[]};break;case"PLTE":this.dG=this.NG(s);break;case"fcTL":n&&this.CG.frames.push(n),this.lG+=4,n={width:this.MG(),height:this.MG(),xOffset:this.MG(),yOffset:this.MG(),delay:0,disposeOp:0,blendOp:0,data:[]};var h=this.PG(),u=this.PG()||100;n.delay=1e3*h/u,n.disposeOp=r[this.lG++],n.blendOp=r[this.lG++];break;case"IDAT":case"fdAT":"fdAT"===e&&(this.lG+=4,s-=4),t=(null!=n?n.data:void 0)||this.wG;for(var o=0;s>=0?o<s:o>s;s>=0?++o:--o)t.push(r[this.lG++]);break;case"tRNS":switch(this.gG={},this.yG){case 3:this.gG.indexed=this.NG(s);var c=255-this.gG.indexed.length;if(c>0)for(var a=0;c>=0?a<c:a>c;c>=0?++a:--a)this.gG.indexed.push(255);break;case 0:this.gG.grayscale=this.NG(s)[0];break;case 2:this.gG.rgb=this.NG(s)}break;case"tEXt":var f=this.NG(s),v=f.indexOf(0),l=String.fromCharCode.apply(String,f.slice(0,v));this.pG[l]=String.fromCharCode.apply(String,f.slice(v+1));break;case"IEND":n&&this.CG.frames.push(n),this.EG=function(){switch(i.yG){case 0:case 3:case 4:return 1;case 2:case 6:return 3;default:return}}.call(this);var d=this.yG;this.TG=4===d||6===d;var w=this.EG+(this.TG?1:0);return this.OG=this._G*w,this.LG=function(){switch(i.EG){case 1:return"DeviceGray";case 3:return"DeviceRGB";default:return}}.call(this),void(this.wG instanceof Uint8Array||(this.wG=new Uint8Array(this.wG)));default:this.lG+=s}if(this.lG+=4,this.lG>r.length)throw new Error(at(6017))}}var i=t.prototype;return i.NG=function(t){var i=0,n=[];for(i=0;t>=0?i<t:i>t;t>=0?++i:--i)n.push(this.IG[this.lG++]);return n},i.MG=function(){var t=this.IG;return t[this.lG++]<<24|t[this.lG++]<<16|t[this.lG++]<<8|t[this.lG++]},i.PG=function(){return this.IG[this.lG++]<<8|this.IG[this.lG++]},i.DG=function(t){if(null==t&&(t=this.wG),0===t.length)return new Uint8Array(0);t=new RP.Inflate(t,{index:0,verify:!1}).decompress();for(var i=this.OG/8,n=i*this.oD,r=new Uint8Array(n*this.cD),s=t.length,e=0,h=0,u=0,o=0,c=0,a=0,f=0,v=0,l=0,d=0,w=0,g=0,p=0,_=0,y=0,m=0,b=0,k=0,A=0;h<s;){switch(t[h++]){case 0:for(a=f=0;f<n;a=f+=1)r[u++]=t[h++];break;case 1:for(a=v=0;v<n;a=v+=1)o=t[h++],g=a<i?0:r[u-i],r[u++]=(o+g)%256;break;case 2:for(a=l=0;l<n;a=l+=1)o=t[h++],c=(a-a%i)/i,k=e&&r[(e-1)*n+c*i+a%i],r[u++]=(k+o)%256;break;case 3:for(a=d=0;d<n;a=d+=1)o=t[h++],c=(a-a%i)/i,g=a<i?0:r[u-i],k=e&&r[(e-1)*n+c*i+a%i],r[u++]=(o+Math.floor((g+k)/2))%256;break;case 4:for(a=w=0;w<n;a=w+=1)o=t[h++],c=(a-a%i)/i,g=a<i?0:r[u-i],0===e?k=A=0:(k=r[(e-1)*n+c*i+a%i],A=c&&r[(e-1)*n+(c-1)*i+a%i]),p=g+k-A,_=Math.abs(p-g),m=Math.abs(p-k),b=Math.abs(p-A),y=_<=m&&_<=b?g:m<=b?k:A,r[u++]=(o+y)%256;break;default:throw new Error(at(6018,t[h-1]))}e++}return r},i.BG=function(t,i){var n,r=this.TG,s=this.EG;this.dG.length&&(n=null!=this.SG?this.SG:this.SG=this.FG(),s=4,r=!0);var e=t.data||t,h=e.length,u=n||i,o=0,c=0,a=0,f=0;if(1===s)for(;o<h;)a=n?4*i[o/4]:c,f=u[a++],e[o++]=f,e[o++]=f,e[o++]=f,e[o++]=r?u[a++]:255,c=a;else for(;o<h;)a=n?4*i[o/4]:c,e[o++]=u[a++],e[o++]=u[a++],e[o++]=u[a++],e[o++]=r?u[a++]:255,c=a},i.FG=function(){for(var t=this.dG,i=this.gG.indexed||[],n=new Uint8Array((i.length||0)+t.length),r=0,s=0,e=0,h=0,u=0,o=t.length;u<o;h=u+=3)n[r++]=t[h],n[r++]=t[h+1],n[r++]=t[h+2],e=i[s++],n[r++]=null!=e?e:255;return n},i.UG=function(t){t.width=this.oD,t.height=this.cD;var i=t.getContext("2d");if(i){var n=i.createImageData(this.oD,this.cD);this.BG(n,this.DG(null)),i.putImageData(n,0,0)}},t}(),Qvt=function(){function t(){this.xG=!1,this.GG=[],this.jG=[],this.Dr=null}var i=t.prototype;return i.HG=function(t){return this.GG[t]},i.VG=function(t){return this.xG?this.GG[t+1]<<8|this.GG[t]:this.GG[t]<<8|this.GG[t+1]},i.$G=function(t){var i=this.GG;return this.xG?i[t+3]<<24|i[t+2]<<16|i[t+1]<<8|i[t]:i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3]},i.zG=function(){var t=this.VG(0);if(18761===t)this.xG=!0;else{if(19789!==t)throw console.log(t),TypeError(at(6019));this.xG=!1}return this.xG},i.WG=function(){if(42!==this.VG(2))throw RangeError(at(6020));return!0},i.XG=function(t){return t in Zvt?Zvt[t]:null},i.YG=function(t){return t in Jvt?Jvt[t]:(tt(6021,t),"Tag"+t)},i.KG=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},i.qG=function(t,i,n,r){var s=[],e=this.KG(i);if(e*n<=4)!1===this.xG?s.push(r>>>8*(4-e)):s.push(r);else for(var h=0;h<n;h++){var u=e*h;e>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(i)?(s.push(this.$G(r+u)),s.push(this.$G(r+u+4))):tt(8e3):s.push(this.QG(e,r+u))}return"ASCII"===i&&s.forEach((function(t,i,n){n[i]=String.fromCharCode(t)})),s},i.QG=function(t,i){if(t<=0)tt(8001);else{if(t<=1)return this.HG(i);if(t<=2)return this.VG(i);if(t<=3)return this.$G(i)>>>8;if(t<=4)return this.$G(i);tt(8002)}return 0},i.JG=function(t,i,n){n=n||0;var r=i+Math.floor(n/8),s=n+t,e=32-t,h=0,u=0;return s<=0?tt(6023):s<=8?(h=24+n,u=this.HG(r)):s<=16?(h=16+n,u=this.VG(r)):s<=32?(h=n,u=this.$G(r)):tt(6022),{bits:u<<h>>>e,byteOffset:r+Math.floor(s/8),bitOffset:s%8}},i.ZG=function(t){var i=this.VG(t),n={},r=0,s=0;for(r=t+2,s=0;s<i;r+=12,s++){var e=this.VG(r),h=this.VG(r+2),u=this.$G(r+4),o=this.$G(r+8),c=this.YG(e),a=this.XG(h),f=this.qG(c,a,u,o);n[c]={type:a,values:f}}this.jG.push(n);var v=this.$G(r);0!==v&&this.ZG(v)},i.tj=function(t,i){var n=Math.pow(2,8-i);return Math.floor(t*n+(n-1))},i.Xk=function(){this.xG=!1,this.GG=[],this.jG=[],this.Dr=null},i.ij=function(t,i){var n=this;if(i=i||I.document.createElement("canvas"),this.GG=t,this.Dr=i,this.zG(),this.WG()){var r=this.$G(4);this.jG.length=0,this.ZG(r);var s=this.jG[0],e=s.ImageWidth.values[0],h=s.ImageLength.values[0];this.Dr.width=e,this.Dr.height=h;var u=[],o=s.Compression?s.Compression.values[0]:1,c=s.SamplesPerPixel.values[0],a=[],f=0,v=!1;s.BitsPerSample.values.forEach((function(t,i){a[i]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(a[i].hasBytesPerSample=!0,a[i].bytesPerSample=t/8),f+=t}),this);var l=0;f%8==0&&(v=!0,l=f/8);var d,w=s.StripOffsets.values,g=w.length;if(s.StripByteCounts)d=s.StripByteCounts.values;else{if(tt(8003),1!==g)throw Error(at(6024));d=[Math.ceil(e*h*f/8)]}for(var p=1,_=1,y=0;y<g;y++){var m=w[y];u[y]=[];for(var b=d[y],k=0,A=0,E=1,T=!0,O=[],S=0,R=0,M=0;k<b;k+=E)switch(o){case 1:O=[];for(var C=0;C<c;C++){var N=a[C];if(!N.hasBytesPerSample){var P=this.JG(N.bitsPerSample,m+k,A);throw O.push(P.bits),k=P.byteOffset-m,A=P.bitOffset,RangeError(at(6025))}var L=N.bytesPerSample*C;O.push(this.QG(N.bytesPerSample,m+k+L))}if(u[y].push(O),!v)throw E=0,RangeError(at(6026));E=l;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(T){T=!1;var D=this.HG(m+k);D>=0&&D<=127?p=D+1:D>=-127&&D<=-1?_=1-D:T=!0}else{for(var B=this.HG(m+k),F=0;F<_;F++){var U=a[R];if(!U.hasBytesPerSample)throw RangeError(at(6025));M=M<<8*S|B,++S===U.bytesPerSample&&(O.push(M),M=S=0,R++),R===c&&(u[y].push(O),O=[],R=0)}0==--p&&(T=!0)}E=1}}var x=this.Dr.getContext("2d");if(x){x.fillStyle="rgba(255, 255, 255, 0)";var G=s.RowsPerStrip?s.RowsPerStrip.values[0]:h,j=u.length,H=h%G,V=0===H?G:H,$=G,z=0,W=s.PhotometricInterpretation.values[0],X=[],Y=0;s.ExtraSamples&&(X=s.ExtraSamples.values,Y=X.length);var K=[],q=0;s.ColorMap&&(K=s.ColorMap.values,q=Math.pow(2,a[0].bitsPerSample));for(var Q=0;Q<j;Q++){Q+1===j&&($=V);for(var J=u[Q].length,Z=z*Q,it=0,nt=0;it<$&&nt<J;it++)for(var rt=function(){var t=u[Q][nt],i=0,r=0,s=0,e=1;if(Y>0)for(var h=0;h<Y;h++)if(1===X[h]||2===X[h]){e=t[3+h]/256;break}switch(W){case 0:var o=0;a[0].hasBytesPerSample&&(o=Math.pow(16,2*a[0].bytesPerSample)),t.forEach((function(t,i,n){n[i]=o-t}));case 1:i=r=s=n.tj(t[0],a[0].bitsPerSample);break;case 2:i=n.tj(t[0],a[0].bitsPerSample),r=n.tj(t[1],a[1].bitsPerSample),s=n.tj(t[2],a[2].bitsPerSample);break;case 3:if(void 0===K)throw Error(at(6027));var c=t[0];i=n.tj(K[c],16),r=n.tj(K[q+c],16),s=n.tj(K[2*q+c],16);break;default:throw RangeError(at(6028,W))}x.fillStyle="rgba("+i+", "+r+", "+s+", "+e+")",x.fillRect(st,Z+it,1,1)},st=0;st<e;st++,nt++)rt();z=$}}}},t}(),Jvt={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},Zvt={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},tlt=new Qvt,ilt=new Array(123),nlt=0;nlt<123;++nlt)ilt[nlt]=64;for(var rlt=0;rlt<64;++rlt)ilt["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(rlt)]=rlt;var slt={name:"Jacob__Codec__Base64",decode:function(t){var i,n,r,s,e,h,u=[],o=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");o<t.length;)i=ilt[t.charCodeAt(o++)]<<2|(s=ilt[t.charCodeAt(o++)])>>4,n=(15&s)<<4|(e=ilt[t.charCodeAt(o++)])>>2,r=(3&e)<<6|(h=ilt[t.charCodeAt(o++)]),u.push(String.fromCharCode(i)),64!==e&&u.push(String.fromCharCode(n)),64!==h&&u.push(String.fromCharCode(r));return u.join("")},decodeAsArray:function(t,i){var n,r,s,e=this.decode(t),h=[];for(n=0,s=e.length/i;n<s;n++)for(h[n]=0,r=i-1;r>=0;--r)h[n]+=e.charCodeAt(n*i+r)<<8*r;return h}},elt=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(elt.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};elt.gunzip=function(t){return t.constructor===Array||t.constructor,new elt(t).gunzip()[0][0]},elt.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},elt.LITERALS=288,elt.NAMEMAX=256,elt.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],elt.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],elt.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],elt.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],elt.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],elt.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],elt.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},elt.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},elt.prototype.byteAlign=function(){this.bb=1},elt.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},elt.prototype.readBits=function(t){for(var i=0,n=t;n--;)i=i<<1|this.readBit();return t&&(i=elt.bitReverse[i]>>8-t),i},elt.prototype.flushBuffer=function(){this.bIdx=0},elt.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},elt.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},elt.prototype.Rec=function(){var t,i=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)i.b0=t;else if(i.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)i.b1=t,i.jump=null;else if(i.b1=32768,i.jump=this.Places[this.treepos],i.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},elt.prototype.CreateTree=function(t,i,n){var r;for(this.Places=t,this.treepos=0,this.flens=n,this.fmax=i,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},elt.prototype.DecodeValue=function(t){for(var i,n,r=0,s=t[r];;)if(this.readBit()){if(!(32768&s.b1))return s.b1;for(s=s.jump,i=t.length,n=0;n<i;n++)if(t[n]===s){r=n;break}}else{if(!(32768&s.b0))return s.b0;s=t[++r]}return-1},elt.prototype.DeflateLoop=function(){var t,i,n;do{var r,s;if(t=this.readBit(),0===(i=this.readBits(2)))for(this.byteAlign(),r=this.readByte(),r|=this.readByte()<<8,s=this.readByte(),65535&(r^~(s|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");r--;)e=this.readByte(),this.addBuffer(e);else if(1===i)for(;;)if((h=elt.bitReverse[this.readBits(7)]>>1)>23?(h=h<<1|this.readBit())>199?h=(h-=128)<<1|this.readBit():(h-=48)>143&&(h+=136):h+=256,h<256)this.addBuffer(h);else{if(256===h)break;for(h-=257,d=this.readBits(elt.cplext[h])+elt.cplens[h],h=elt.bitReverse[this.readBits(5)]>>3,elt.cpdext[h]>8?(w=this.readBits(8),w|=this.readBits(elt.cpdext[h]-8)<<8):w=this.readBits(elt.cpdext[h]),w+=elt.cpdist[h],h=0;h<d;h++){var e=this.buf32k[this.bIdx-w&32767];this.addBuffer(e)}}else if(2===i){var h,u,o,c,a,f=new Array(320);for(o=257+this.readBits(5),c=1+this.readBits(5),a=4+this.readBits(4),h=0;h<19;h++)f[h]=0;for(h=0;h<a;h++)f[elt.border[h]]=this.readBits(3);for(d=this.distanceTree.length,n=0;n<d;n++)this.distanceTree[n]=new elt.HufNode;if(this.CreateTree(this.distanceTree,19,f,0))return this.flushBuffer(),1;for(u=o+c,n=0;n<u;)if((h=this.DecodeValue(this.distanceTree))<16)f[n++]=h;else if(16===h){var v;if(n+(h=3+this.readBits(2))>u)return this.flushBuffer(),1;for(v=n?f[n-1]:0;h--;)f[n++]=v}else{if(n+(h=17===h?3+this.readBits(3):11+this.readBits(7))>u)return this.flushBuffer(),1;for(;h--;)f[n++]=0}for(d=this.literalTree.length,n=0;n<d;n++)this.literalTree[n]=new elt.HufNode;if(this.CreateTree(this.literalTree,o,f,0))return this.flushBuffer(),1;for(d=this.literalTree.length,n=0;n<d;n++)this.distanceTree[n]=new elt.HufNode;var l=new Array;for(n=o;n<f.length;n++)l[n-o]=f[n];if(this.CreateTree(this.distanceTree,c,l,0))return this.flushBuffer(),1;for(;;)if((h=this.DecodeValue(this.literalTree))>=256){var d,w;if(0==(h-=256))break;for(h--,d=this.readBits(elt.cplext[h])+elt.cplens[h],h=this.DecodeValue(this.distanceTree),elt.cpdext[h]>8?(w=this.readBits(8),w|=this.readBits(elt.cpdext[h]-8)<<8):w=this.readBits(elt.cpdext[h]),w+=elt.cpdist[h];d--;)e=this.buf32k[this.bIdx-w&32767],this.addBuffer(e)}else this.addBuffer(h)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},elt.prototype.unzipFile=function(t){var i;for(this.gunzip(),i=0;i<this.unzipped.length;i++)if(this.unzipped[i][1]===t)return this.unzipped[i][0]},elt.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var i=this.readByte();i|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var n=this.readByte();n|=this.readByte()<<8;var r=this.readByte();for(r|=this.readByte()<<8,e=0,this.nameBuf=[];n--;){var s=this.readByte();"/"===s|":"===s?e=0:e<elt.NAMEMAX-1&&(this.nameBuf[e++]=String.fromCharCode(s))}this.fileout||(this.fileout=this.nameBuf);for(var e=0;e<r;)s=this.readByte(),e++;8===i&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},elt.prototype.skipdir=function(){var t,i,n=[];if(8&this.gpflags&&(n[0]=this.readByte(),n[1]=this.readByte(),n[2]=this.readByte(),n[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),n[0]=this.readByte(),8!==n[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(n[0]=this.readByte(),n[2]=this.readByte(),this.len=n[0]+256*n[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];i=this.readByte();)"7"!==i&&":"!==i||(t=0),t<elt.NAMEMAX-1&&(this.nameBuf[t++]=i);if(16&this.gpflags)for(;i=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var hlt,ult,olt,clt,alt,flt,vlt,llt,dlt,wlt,glt,plt,_lt,ylt,mlt,blt,klt,Alt,Elt,Tlt,Olt,Slt,Ilt,Rlt,Mlt,Clt,Nlt,Plt,Llt,Dlt,Blt,Flt,Ult,xlt,Glt,jlt,Hlt,Vlt,$lt,zlt,Wlt,Xlt,Ylt,Klt,qlt,Qlt,Jlt,Zlt,tdt,idt,ndt,rdt,sdt={name:"Jacob__Codec"};function edt(t){var i=t.parent,n=t.getComponent(ydt);return i&&n?edt(i):t.getComponentsInChildren(ydt)}sdt.Base64=slt,sdt.GZip=elt,sdt.unzip=function(){return sdt.GZip.gunzip.apply(sdt.GZip,arguments)},sdt.unzipBase64=function(){var t=sdt.Base64.decode.apply(sdt.Base64,arguments);try{return sdt.GZip.gunzip.call(sdt.GZip,t)}catch(i){return t.slice(7)}},sdt.unzipBase64AsArray=function(t,i){i=i||1;var n,r,s,e=this.unzipBase64(t),h=[];for(n=0,s=e.length/i;n<s;n++)for(h[n]=0,r=i-1;r>=0;--r)h[n]+=e.charCodeAt(n*i+r)<<8*r;return h},sdt.unzipAsArray=function(t,i){i=i||1;var n,r,s,e=this.unzip(t),h=[];for(n=0,s=e.length/i;n<s;n++)for(h[n]=0,r=i-1;r>=0;--r)h[n]+=e.charCodeAt(n*i+r)<<8*r;return h};var hdt,udt,odt,cdt,adt,fdt,vdt,ldt,ddt,wdt,gdt,pdt=parseInt,_dt=parseFloat,ydt=t("ef",(hlt=_o("cc.ParticleSystem2D"),ult=ic(Kvt),olt=ic(wL),clt=ic(Pvt),alt=ic(Nvt),flt=No("preview"),hlt((rdt=function(t){function i(){var i;return(i=t.call(this)||this).duration=dlt&&dlt(),i.emissionRate=wlt&&wlt(),i.life=glt&&glt(),i.lifeVar=plt&&plt(),i.angle=_lt&&_lt(),i.angleVar=ylt&&ylt(),i.startSize=mlt&&mlt(),i.startSizeVar=blt&&blt(),i.endSize=klt&&klt(),i.endSizeVar=Alt&&Alt(),i.startSpin=Elt&&Elt(),i.startSpinVar=Tlt&&Tlt(),i.endSpin=Olt&&Olt(),i.endSpinVar=Slt&&Slt(),i.sourcePos=Ilt&&Ilt(),i.posVar=Rlt&&Rlt(),i.emitterMode=Mlt&&Mlt(),i.gravity=Clt&&Clt(),i.speed=Nlt&&Nlt(),i.speedVar=Plt&&Plt(),i.tangentialAccel=Llt&&Llt(),i.tangentialAccelVar=Dlt&&Dlt(),i.radialAccel=Blt&&Blt(),i.radialAccelVar=Flt&&Flt(),i.rotationIsDir=Ult&&Ult(),i.startRadius=xlt&&xlt(),i.startRadiusVar=Glt&&Glt(),i.endRadius=jlt&&jlt(),i.endRadiusVar=Hlt&&Hlt(),i.rotatePerS=Vlt&&Vlt(),i.rotatePerSVar=$lt&&$lt(),i.aspectRatio=1,i.playOnLoad=zlt&&zlt(),i.autoRemoveOnFinish=Wlt&&Wlt(),i._preview=Xlt&&Xlt(),i._custom=Ylt&&Ylt(),i._file=Klt&&Klt(),i._spriteFrame=qlt&&qlt(),i._totalParticles=Qlt&&Qlt(),i._startColor=Jlt&&Jlt(),i._startColorVar=Zlt&&Zlt(),i._endColor=tdt&&tdt(),i._endColorVar=idt&&idt(),i._positionType=ndt&&ndt(),i.nj=!0,i.rj=void 0,i.sj(),i.rj=!1,i}e(i,t);var n=i.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial(),this._updatePositionType()},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0,this.destroyRenderData()},n.sj=function(){this.ej=null,this.hj=!1,this.aspectRatio=1,this._simulator=new Xvt(this)},n.onFocusInEditor=function(){this.hj=!0;for(var t=edt(this.node),i=0;i<t.length;++i)t[i].uj()},n.onLostFocusInEditor=function(){this.hj=!1;for(var t=edt(this.node),i=0;i<t.length;++i)t[i].oj()},n.uj=function(){this._preview&&this.resetSystem()},n.oj=function(){this._preview&&(this.resetSystem(),this.stopSystem()),this.ej&&clearInterval(this.ej)},n.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},n.destroyRenderData=function(){if(this._simulator.renderData){var i=this._assembler;i&&i.removeData&&i.removeData(this._simulator.renderData),this._simulator.renderData=null}t.prototype.destroyRenderData.call(this)},n._flushAssembler=function(){var t=i.Assembler.getAssembler(this);if(this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData){var n=this._simulator,r=n.renderData;r||(r=n.renderData=this._assembler.createData(this),n.uvFilled=0,r.z_(this.renderEntity),n.initDrawInfo())}},n.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},n.addParticle=function(){},n.stopSystem=function(){this.nj=!0,this._simulator.stop()},n.resetSystem=function(){this.nj=!1,this._simulator.reset(),this.vo()},n.isFull=function(){return this.particleCount>=this.totalParticles},n._applyFile=function(){var t=this._file;if(t){if(!t)return void ht(6029);if(!this.isValid)return;this.cj=t.nativeUrl,this._custom||(this._spriteFrame!==t.spriteFrame&&(this.spriteFrame=t.spriteFrame),this._initWithDictionary(t._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():t.spriteFrame?this.spriteFrame=t.spriteFrame:this._custom&&this._initTextureWithDictionary(t._nativeAsset)}},n._initTextureWithDictionary=function(t){var i,n=this;if(t.spriteFrameUuid){var r=t.spriteFrameUuid;Pk.loadAny(r,(function(i,r){n.isValid&&(i?(t.spriteFrameUuid=void 0,n._initTextureWithDictionary(t),X(i)):n.spriteFrame=r)}))}else{var s=Zf(this.cj,t.textureFileName||"");if(t.textureFileName)Pk.loadRemote(s,(function(i,r){n.isValid&&(i?(t.textureFileName=void 0,n._initTextureWithDictionary(t),X(i)):n.spriteFrame=r?wL.createWithImage(r):wL.createWithImage(Fk.get("white-texture")))}));else if(t.textureImageData){var e=t.textureImageData;if(!(e&&e.length>0))return!1;var h=s;this.file&&(h+="-"+this.file.uuid);var u=Pk.assets.get(h);if(!u){var o=sdt.unzipBase64AsArray(e,1);if(!o)return st(6030,this._file.name),!1;var c=(i=o).length>8&&137===i[0]&&80===i[1]&&78===i[2]&&71===i[3]&&13===i[4]&&10===i[5]&&26===i[6]&&10===i[7]?1:i.length>2&&(73===i[0]&&73===i[1]||77===i[0]&&77===i[1]||255===i[0]&&216===i[1])?2:10;if(2!==c&&1!==c)return st(6031,this._file.name),!1;var a=I.document.createElement("canvas");1===c?new qvt(o).UG(a):(tlt.ij(o,a),tlt.Xk()),u=new mg(a),Pk.assets.add(h,u)}u||st(6032,this._file.name),this.spriteFrame=u?wL.createWithImage(u):wL.createWithImage(Fk.get("white-texture"))}}return!0},n._initWithDictionary=function(t){this.rj=!0,this.totalParticles=pdt(t.maxParticles||0),this.life=_dt(t.particleLifespan||0),this.lifeVar=_dt(t.particleLifespanVariance||0);var i=t.emissionRate;this.emissionRate=i||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=_dt(t.duration||0),this._srcBlendFactor=pdt(t.blendFuncSource||2),this._dstBlendFactor=pdt(t.blendFuncDestination||4);var n=this._startColor;n.r=255*_dt(t.startColorRed||0),n.g=255*_dt(t.startColorGreen||0),n.b=255*_dt(t.startColorBlue||0),n.a=255*_dt(t.startColorAlpha||0);var r=this._startColorVar;r.r=255*_dt(t.startColorVarianceRed||0),r.g=255*_dt(t.startColorVarianceGreen||0),r.b=255*_dt(t.startColorVarianceBlue||0),r.a=255*_dt(t.startColorVarianceAlpha||0);var s=this._endColor;s.r=255*_dt(t.finishColorRed||0),s.g=255*_dt(t.finishColorGreen||0),s.b=255*_dt(t.finishColorBlue||0),s.a=255*_dt(t.finishColorAlpha||0);var e=this._endColorVar;if(e.r=255*_dt(t.finishColorVarianceRed||0),e.g=255*_dt(t.finishColorVarianceGreen||0),e.b=255*_dt(t.finishColorVarianceBlue||0),e.a=255*_dt(t.finishColorVarianceAlpha||0),this.startSize=_dt(t.startParticleSize||0),this.startSizeVar=_dt(t.startParticleSizeVariance||0),this.endSize=_dt(t.finishParticleSize||0),this.endSizeVar=_dt(t.finishParticleSizeVariance||0),this.positionType=_dt(void 0!==t.positionType?t.positionType:Pvt.FREE),this.sourcePos.set(0,0),this.posVar.set(_dt(t.sourcePositionVariancex||0),_dt(t.sourcePositionVariancey||0)),this.angle=_dt(t.angle||0),this.angleVar=_dt(t.angleVariance||0),this.startSpin=_dt(t.rotationStart||0),this.startSpinVar=_dt(t.rotationStartVariance||0),this.endSpin=_dt(t.rotationEnd||0),this.endSpinVar=_dt(t.rotationEndVariance||0),this.emitterMode=pdt(t.emitterType||Nvt.GRAVITY),this.emitterMode===Nvt.GRAVITY){this.gravity.set(_dt(t.gravityx||0),_dt(t.gravityy||0)),this.speed=_dt(t.speed||0),this.speedVar=_dt(t.speedVariance||0),this.radialAccel=_dt(t.radialAcceleration||0),this.radialAccelVar=_dt(t.radialAccelVariance||0),this.tangentialAccel=_dt(t.tangentialAcceleration||0),this.tangentialAccelVar=_dt(t.tangentialAccelVariance||0);var h=t.rotationIsDir||"";null!==h?(h=h.toString().toLowerCase(),this.rotationIsDir="true"===h||"1"===h):this.rotationIsDir=!1}else{if(this.emitterMode!==Nvt.RADIUS)return st(6009),!1;this.startRadius=_dt(t.maxRadius||0),this.startRadiusVar=_dt(t.maxRadiusVariance||0),this.endRadius=_dt(t.minRadius||0),this.endRadiusVar=_dt(t.minRadiusVariance||0),this.rotatePerS=_dt(t.rotatePerSecond||0),this.rotatePerSVar=_dt(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},n._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},n._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator&&this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this.nj=!1,this.vo()):this.resetSystem()},n._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},n._updateMaterial=function(){if(this._customMaterial){this.setSharedMaterial(this._customMaterial,0);var t=this.getRenderMaterial(0).passes[0].blendState.targets[0];this._dstBlendFactor=t.blendDst,this._srcBlendFactor=t.blendSrc}var i=this.getMaterialInstance(0);i&&i.recompileShaders({USE_LOCAL:this._positionType!==Pvt.FREE}),i&&i.passes.length>0&&this._updateBlendFunc()},n._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this.vo(),this.autoRemoveOnFinish&&this.nj&&this.node.destroy()},n._canRender=function(){return t.prototype._canRender.call(this)&&!this.nj&&null!==this._renderSpriteFrame&&void 0!==this._renderSpriteFrame},n._render=function(t){this._positionType===Pvt.RELATIVE?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===Pvt.GROUPED?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)},n._updatePositionType=function(){this._positionType===Pvt.RELATIVE?(this._renderEntity.Ey(this.node.parent),this._renderEntity.uy(!0)):this.positionType===Pvt.GROUPED?(this._renderEntity.Ey(this.node),this._renderEntity.uy(!0)):(this._renderEntity.Ey(null),this._renderEntity.uy(!1))},r(i,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile(),this._updateMaterial())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"color",get:function(){return this._color},set:function(){}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial(),this._updatePositionType()}},{key:"preview",get:function(){return this._preview},set:function(t){t?this.uj():this.oj(),this._preview=t}},{key:"stopped",get:function(){return this.nj}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),i}(GB),rdt.EmitterMode=Nvt,rdt.PositionType=Pvt,rdt.DURATION_INFINITY=-1,rdt.START_SIZE_EQUAL_TO_END_SIZE=-1,rdt.START_RADIUS_EQUAL_TO_END_RADIUS=-1,y((llt=rdt).prototype,"file",[ult],Object.getOwnPropertyDescriptor(llt.prototype,"file"),llt.prototype),y(llt.prototype,"spriteFrame",[olt],Object.getOwnPropertyDescriptor(llt.prototype,"spriteFrame"),llt.prototype),dlt=uo(llt.prototype,"duration",[Co],(function(){return-1})),wlt=uo(llt.prototype,"emissionRate",[Co],(function(){return 10})),glt=uo(llt.prototype,"life",[Co],(function(){return 1})),plt=uo(llt.prototype,"lifeVar",[Co],(function(){return 0})),y(llt.prototype,"color",[ac],Object.getOwnPropertyDescriptor(llt.prototype,"color"),llt.prototype),_lt=uo(llt.prototype,"angle",[Co],(function(){return 90})),ylt=uo(llt.prototype,"angleVar",[Co],(function(){return 20})),mlt=uo(llt.prototype,"startSize",[Co],(function(){return 50})),blt=uo(llt.prototype,"startSizeVar",[Co],(function(){return 0})),klt=uo(llt.prototype,"endSize",[Co],(function(){return 0})),Alt=uo(llt.prototype,"endSizeVar",[Co],(function(){return 0})),Elt=uo(llt.prototype,"startSpin",[Co],(function(){return 0})),Tlt=uo(llt.prototype,"startSpinVar",[Co],(function(){return 0})),Olt=uo(llt.prototype,"endSpin",[Co],(function(){return 0})),Slt=uo(llt.prototype,"endSpinVar",[Co],(function(){return 0})),Ilt=uo(llt.prototype,"sourcePos",[Co],(function(){return Ms.ZERO.clone()})),Rlt=uo(llt.prototype,"posVar",[Co],(function(){return Ms.ZERO.clone()})),y(llt.prototype,"positionType",[clt],Object.getOwnPropertyDescriptor(llt.prototype,"positionType"),llt.prototype),Mlt=uo(llt.prototype,"emitterMode",[Co,alt],(function(){return Nvt.GRAVITY})),Clt=uo(llt.prototype,"gravity",[Co],(function(){return Ms.ZERO.clone()})),Nlt=uo(llt.prototype,"speed",[Co],(function(){return 180})),Plt=uo(llt.prototype,"speedVar",[Co],(function(){return 50})),Llt=uo(llt.prototype,"tangentialAccel",[Co],(function(){return 80})),Dlt=uo(llt.prototype,"tangentialAccelVar",[Co],(function(){return 0})),Blt=uo(llt.prototype,"radialAccel",[Co],(function(){return 0})),Flt=uo(llt.prototype,"radialAccelVar",[Co],(function(){return 0})),Ult=uo(llt.prototype,"rotationIsDir",[Co],(function(){return!1})),xlt=uo(llt.prototype,"startRadius",[Co],(function(){return 0})),Glt=uo(llt.prototype,"startRadiusVar",[Co],(function(){return 0})),jlt=uo(llt.prototype,"endRadius",[Co],(function(){return 0})),Hlt=uo(llt.prototype,"endRadiusVar",[Co],(function(){return 0})),Vlt=uo(llt.prototype,"rotatePerS",[Co],(function(){return 0})),$lt=uo(llt.prototype,"rotatePerSVar",[Co],(function(){return 0})),zlt=uo(llt.prototype,"playOnLoad",[Co],(function(){return!0})),Wlt=uo(llt.prototype,"autoRemoveOnFinish",[Co],(function(){return!1})),Xlt=uo(llt.prototype,"_preview",[flt],(function(){return!0})),Ylt=uo(llt.prototype,"_custom",[Co],(function(){return!1})),Klt=uo(llt.prototype,"_file",[Co],(function(){return null})),qlt=uo(llt.prototype,"_spriteFrame",[Co],(function(){return null})),Qlt=uo(llt.prototype,"_totalParticles",[Co],(function(){return 150})),Jlt=uo(llt.prototype,"_startColor",[Co],(function(){return new Qs(255,255,255,255)})),Zlt=uo(llt.prototype,"_startColorVar",[Co],(function(){return new Qs(0,0,0,0)})),tdt=uo(llt.prototype,"_endColor",[Co],(function(){return new Qs(255,255,255,0)})),idt=uo(llt.prototype,"_endColorVar",[Co],(function(){return new Qs(0,0,0,0)})),ndt=uo(llt.prototype,"_positionType",[Co],(function(){return Pvt.FREE})),vlt=llt))||vlt)),mdt=function(){function t(t,i){this.point=new Ms,this.dir=new Ms,this.distance=0,this.time=0,t&&this.point.set(t),i&&this.dir.set(i)}var i=t.prototype;return i.setPoint=function(t,i){this.point.x=t,this.point.y=i},i.setDir=function(t,i){this.dir.x=t,this.dir.y=i},t}(),bdt=t("eg",(hdt=_o("cc.MotionStreak"),udt=ic(f_),hdt((gdt=function(t){function i(){var i;return(i=t.call(this)||this)._preview=adt&&adt(),i._fadeTime=fdt&&fdt(),i._minSeg=vdt&&vdt(),i._stroke=ldt&&ldt(),i._texture=ddt&&ddt(),i._fastMode=wdt&&wdt(),i.Ex=[],i.setFillColorType(1),i}e(i,t);var n=i.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},n._flushAssembler=function(){var t=i.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material,this._updateColor())},n.onFocusInEditor=function(){this._preview&&this.reset()},n.onLostFocusInEditor=function(){this._preview&&this.reset()},n.reset=function(){this.Ex.length=0,this._renderData&&this._renderData.clear()},n.lateUpdate=function(t){this._assembler&&this._assembler.update&&this._assembler.update(this,t)},n._render=function(t){t.commitComp(this,this._renderData,this._texture,this._assembler,null)},r(i,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this.Ex}}]),i}(GB),gdt.Point=mdt,y((cdt=gdt).prototype,"texture",[udt],Object.getOwnPropertyDescriptor(cdt.prototype,"texture"),cdt.prototype),adt=uo(cdt.prototype,"_preview",[Co],(function(){return!1})),fdt=uo(cdt.prototype,"_fadeTime",[Co],(function(){return 1})),vdt=uo(cdt.prototype,"_minSeg",[Co],(function(){return 1})),ldt=uo(cdt.prototype,"_stroke",[Co],(function(){return 64})),ddt=uo(cdt.prototype,"_texture",[Co],(function(){return null})),wdt=uo(cdt.prototype,"_fastMode",[Co],(function(){return!1})),odt=cdt))||odt)),kdt=new Ms,Adt=new Ms;function Edt(t,i){return t.x=-i.y,t.y=i.x,t}var Tdt=function(){function t(){}var i=t.prototype;return i.createData=function(t){var i=t.requestRenderData();return i.dataLength=4,i.resize(16,42),i},i.update=function(t,i){var n,r=t.stroke/2,s=t.node,e=s.worldMatrix,h=e.m12,u=e.m13,o=t.points;if(o.length>1){var c=o[0],a=c.point.x-h,f=c.point.y-u;a*a+f*f<t.minSeg&&(n=c)}n||(n=new mdt,o.unshift(n)),n.setPoint(h,u),n.time=t.fadeTime+i;var v,l=0,d=t.renderData;if(!(o.length<2)&&d){this.aj(t,d);var w=t.color,g=w.r,p=w.g,_=w.b,y=s._uiProps.opacity*w.a,m=o[1];m.distance=Ms.subtract(Adt,n.point,m.point).length(),Adt.normalize(),m.setDir(Adt.x,Adt.y),n.setDir(Adt.x,Adt.y),d.dataLength=2*o.length;for(var b=d.data,k=t.fadeTime,A=!1,E=o.length-1;E>=0;E--){var T=o[E],O=T.point,S=T.dir;if(T.time-=i,T.time<0)o.splice(E,1);else{var I=T.time/k,R=o[E-1];if(!A){if(!R){o.splice(E,1);continue}O.x=R.point.x-S.x*I,O.y=R.point.y-S.y*I}A=!0,Edt(kdt,S);var M=I*y,C=l;b[C].x=O.x+kdt.x*r,b[C].y=O.y+kdt.y*r,b[C].u=1,b[C].v=I,b[C].color.set(g,p,_,M),b[C+=1].x=O.x-kdt.x*r,b[C].y=O.y-kdt.y*r,b[C].u=0,b[C].v=I,b[C].color.set(g,p,_,M),l+=2}}v=l<=2?0:3*(l-2),d.resize(l,v)}},i.fj=function(){},i.Qm=function(){},i.aj=function(t,i){i.passDirty&&i.updatePass(t),i.nodeDirty&&i.updateNode(t),i.textureDirty&&t.texture&&(i.updateTexture(t.texture),i.material=t.getRenderMaterial(0)),i.hashDirty&&i.updateHash()},i.fillBuffers=function(t){var i=t.renderData;if(i){for(var n=i.chunk,r=i.data,s=i.vertexCount,e=i.indexCount,h=n.vb,u=0,o=0;o<s;o++){var c=r[o];h[u++]=c.x,h[u++]=c.y,h[u++]=c.z,h[u++]=c.u,h[u++]=c.v,Qs.toArray(h,c.color,u),u+=4}n.bufferId;for(var a=n.vertexOffset,f=n.meshBuffer,v=n.meshBuffer.iData,l=f.indexOffset,d=0,w=e;d<w;d+=2){var g=a+d;v[l++]=g,v[l++]=g+2,v[l++]=g+1,v[l++]=g+1,v[l++]=g+2,v[l++]=g+3}f.indexOffset+=i.indexCount,f.setDirty()}},t}(),Odt=new Tdt,Sdt=t("eh",{getAssembler:function(){return Odt}});bdt.Assembler=Sdt;var Idt,Rdt,Mdt,Cdt,Ndt,Pdt,Ldt,Ddt,Bdt,Fdt,Udt,xdt,Gdt,jdt,Hdt,Vdt,$dt,zdt,Wdt,Xdt,Ydt,Kdt,qdt,Qdt,Jdt,Zdt,twt=new(function(){function t(){this.maxParticleDeltaTime=0}var i=t.prototype;return i.createData=function(){return fB.add()},i.removeData=function(t){fB.remove(t)},t}()),iwt=t("ei",{getAssembler:function(){return twt.maxParticleDeltaTime||(twt.maxParticleDeltaTime=T.game.frameTime/1e3*2),twt}});ydt.Assembler=iwt;var nwt=new yD,rwt="RICHTEXT_CHILD",swt="RICHTEXT_Image_CHILD",ewt=new Ms,hwt=new Ms,uwt=new ri((function(t){if(!T.isValid(t.node))return!1;var i=t.node.getComponent(KF);return i&&(i.outlineWidth=0),!0}),20),owt=new ri((function(t){return T.isValid(t.node)}),10);function cwt(t){return{node:new WE(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function awt(t,i){var n;t===rwt?n=uwt._get():t===swt&&(n=owt._get());var r=(n=n||cwt(t)).node;return r||(r=new WE(t)),r.hideFlags|=1032,r.active=!0,t===swt?(n.comp=r.getComponent(tU)||r.addComponent(tU),n.comp.spriteFrame=i,n.comp.type=tU.Type.SLICED,n.comp.sizeMode=0):(n.comp=r.getComponent(KF)||r.addComponent(KF),n.comp.string=i,n.comp.horizontalAlign=0,n.comp.verticalAlign=0,n.comp.underlineHeight=2),r.setPosition(0,0,0),r.qu().setAnchorPoint(.5,.5),n.node=r,n.lineCount=0,n.styleIndex=0,n.imageOffset="",n.clickParam="",n.clickHandler="",n}var fwt=t("ek",(Idt=_o("cc.RichText"),Rdt=yo(mB),Mdt=mo(110),Cdt=ic(TF),Ndt=ic(OF),Pdt=ic(Qs),Ldt=ic(bL),Ddt=ic(IF),Bdt=ic(pL),Idt(Fdt=Rdt(Fdt=Mdt((Zdt=function(t){function i(){var i;return(i=t.call(this)||this)._lineHeight=xdt&&xdt(),i._string=Gdt&&Gdt(),i._horizontalAlign=jdt&&jdt(),i._verticalAlign=Hdt&&Hdt(),i._fontSize=Vdt&&Vdt(),i._fontColor=$dt&&$dt(),i._maxWidth=zdt&&zdt(),i._fontFamily=Wdt&&Wdt(),i._font=Xdt&&Xdt(),i._isSystemFontUsed=Ydt&&Ydt(),i._userDefinedFont=Kdt&&Kdt(),i._cacheMode=qdt&&qdt(),i._imageAtlas=Qdt&&Qdt(),i._handleTouchEvent=Jdt&&Jdt(),i._textArray=[],i._segments=[],i._labelSegmentsCache=[],i._linesWidth=[],i._lineCount=1,i._labelWidth=0,i._labelHeight=0,i._layoutDirty=!0,i._lineOffsetX=0,i._labelChildrenNum=0,i._updateRichTextStatus=i._updateRichText,i}e(i,t);var n=i.prototype;return n.onLoad=function(){this.node.on("layer-changed",this._applyLayer,this),this.node.on("anchor-changed",this._updateRichTextPosition,this)},n.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},n.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},n.onRestore=function(){},n.onDestroy=function(){this._segments.forEach((function(t){t.node.removeFromParent(),t.type===rwt?uwt.put(t):t.type===swt&&owt.put(t)})),this.node.off("anchor-changed",this._updateRichTextPosition,this),this.node.off("layer-changed",this._applyLayer,this)},n._addEventListeners=function(){this.node.on("touch-end",this._onTouchEnded,this)},n._removeEventListeners=function(){this.node.off("touch-end",this._onTouchEnded,this)},n._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(i){t._applyTextAttribute(i)}))},n._createFontLabel=function(t){return awt(rwt,t)},n._createImage=function(t){return awt(swt,t)},n._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},n.vj=function(t,i){var n=[];if(t.length*this.fontSize<=1638.4)return n.push(t),n;if(this.lj(ewt,i,t),ewt.x<2048)n.push(t);else for(var r=t.split("\n"),s=0;s<r.length;s++)if(this.lj(ewt,i,r[s]),ewt.x<2048)n.push(r[s]);else{var e=this.dj(r[s],i);n.push.apply(n,e)}return n},n.dj=function(t,i){var n=[],r=t,s=0,e=r.length/2,h=r.substring(s,e),u=r.substring(e),o=this.lj(ewt,i,h),c=this.lj(hwt,i,u),a=this._maxWidth;0===this._maxWidth&&(a=2047.9);for(var f=1*a;o.x>f;){if((e/=2)<1){e*=2;break}h=h.substring(s,e),u=r.substring(e),this.lj(o,i,h)}for(var v=1e3,l=1;v&&s<t.length;){for(;v&&o.x<f;){var d=WL(u);d&&d.length>0&&(l=d[0].length),e+=l,h=r.substring(s,e),u=r.substring(e),this.lj(o,i,h),v--}for(;v&&h.length>=2&&o.x>f;)e-=l,h=r.substring(s,e),this.lj(o,i,h),l=1,v--;if(h.length>=2){var w=XL(h);w&&w.length>0&&h!==w[0]&&(e-=w[0].length,h=r.substring(s,e))}if(n.push(h),s=e,e+=h.length,h=r.substring(s,e),u=r.substring(e),this.lj(c,i,u),this.lj(o,i,h),v--,c.x<2048&&o.x<f){n.push(h),s=t.length,e=t.length,h=u,""!==u&&n.push(h);break}}return n},n._measureText=function(t,i){var n=this,r=function(i){return n.lj(ewt,t,i).x};return i?r(i):r},n.lj=function(t,i,n){var r;0===this._labelSegmentsCache.length?(r=this._createFontLabel(n),this._labelSegmentsCache.push(r)):(r=this._labelSegmentsCache[0]).node.getComponent(KF).string=n,r.styleIndex=i,this._applyTextAttribute(r);var s=r.node.qu().contentSize;return Ms.set(t,s.x,s.y),t},n._onTouchEnded=function(t){var i=this,n=this.node.getComponents(Kg);this._segments.forEach((function(r){var s=r.clickHandler,e=r.clickParam;s&&i._containsTouchLocation(r,t.touch.getUILocation())&&(n.forEach((function(i){var n=i[s];i.enabledInHierarchy&&n&&n.call(i,t,e)})),t.propagationStopped=!0)}))},n._containsTouchLocation=function(t,i){var n=t.node.getComponent(mB);return!!n&&n.getBoundingBoxToWorld().contains(i)},n._resetState=function(){for(var t=this.node.children,i=t.length-1;i>=0;i--){var n=t[i];if(n.name===rwt||n.name===swt){n.parent=null;var r=cwt(n.name);r.node=n,n.name===rwt?(r.comp=n.getComponent(KF),uwt.put(r)):(r.comp=n.getComponent(tU),owt.put(r)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},n._activateChildren=function(t){for(var i=this.node.children.length-1;i>=0;i--){var n=this.node.children[i];n.name!==rwt&&n.name!==swt||(n.active=t)}},n._addLabelSegment=function(t,i){var n;if(0===this._labelSegmentsCache.length)n=this._createFontLabel(t);else{var r=(n=this._labelSegmentsCache.pop()).node.getComponent(KF);r&&(r.string=t)}var s=n.comp;return s.verticalAlign!==this._verticalAlign&&(s.verticalAlign=this._verticalAlign),n.styleIndex=i,n.lineCount=this._lineCount,n.node.qu().setAnchorPoint(0,0),n.node.layer=this.node.layer,this.node.insertChild(n.node,this._labelChildrenNum++),this._applyTextAttribute(n),this._segments.push(n),n},n._updateRichTextWithMaxWidth=function(t,i,n){var r=i;if(this._lineOffsetX>0&&r+this._lineOffsetX>this._maxWidth)for(var s=0;this._lineOffsetX<=this._maxWidth;){var e=this._getFirstWordLen(t,s,t.length),h=t.substr(s,e),u=this._measureText(n,h);if(!(this._lineOffsetX+u<=this._maxWidth)){if(s>0){var o=t.substr(0,s);this._addLabelSegment(o,n),t=t.substr(s,t.length),r=this._measureText(n,t)}this._updateLineInfo();break}this._lineOffsetX+=u,s+=e}if(r>this._maxWidth)for(var c=YL(t,r,this._maxWidth,this._measureText(n)),a=0;a<c.length;++a){var f=c[a],v=this._addLabelSegment(f,n).node.qu().contentSize;this._lineOffsetX+=v.width,c.length>1&&a<c.length-1&&this._updateLineInfo()}else this._lineOffsetX+=r,this._addLabelSegment(t,n)},n._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},n._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},n._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var i=0;i<this._textArray.length;i++){var n=this._textArray[i],r=t[i];if(n.text!==r.text)return!0;var s=n.style,e=r.style;if(s){if(e){if(!!e.outline!=!!s.outline)return!0;if(s.size!==e.size||s.italic!==e.italic||s.isImage!==e.isImage)return!0;if(s.src!==e.src||s.imageAlign!==e.imageAlign||s.imageHeight!==e.imageHeight||s.imageWidth!==e.imageWidth||s.imageOffset!==e.imageOffset)return!0}else if(s.size||s.italic||s.isImage||s.outline)return!0}else if(e&&(e.size||e.italic||e.isImage||e.outline))return!0}return!1},n._addRichTextImageElement=function(t){if(t.style){var i=t.style,n=i.src,r=this._imageAtlas&&n&&this._imageAtlas.getSpriteFrame(n);if(r){var s=this._createImage(r),e=s.node.qu();switch(i.imageAlign){case"top":e.setAnchorPoint(0,1);break;case"center":e.setAnchorPoint(0,.5);break;default:e.setAnchorPoint(0,0)}i.imageOffset&&(s.imageOffset=i.imageOffset),s.node.layer=this.node.layer,this.node.insertChild(s.node,this._labelChildrenNum++),this._segments.push(s);var h=r.rect.clone(),u=1,o=h.width,c=h.height,a=i.imageWidth||0,f=i.imageHeight||0;f>0?(o*=u=f/c,c*=u):(o*=u=this._lineHeight/c,c*=u),a>0&&(o=a),this._maxWidth>0?(this._lineOffsetX+o>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=o):(this._lineOffsetX+=o,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),e.setContentSize(o,c),s.lineCount=this._lineCount,s.clickHandler="",s.clickParam="";var v=i.event;v&&(s.clickHandler=v.click,s.clickParam=v.param)}else st(4400)}},n._updateTextDefaultColor=function(){for(var t=0;t<this._segments.length;++t){var i,n,r=this._segments[t],s=r.node.getComponent(KF);s&&(null!=(i=this._textArray[r.styleIndex])&&null!=(n=i.style)&&n.color||(s.color=this._fontColor))}},n._updateRichText=function(){if(this.enabledInHierarchy){var t=nwt.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var i,n=!1,r=0;r<this._textArray.length;++r){var s=this._textArray[r],e=s.text;if(void 0!==e){if(""===e){if(s.style&&s.style.isNewLine){this._updateLineInfo();continue}if(s.style&&s.style.isImage&&this._imageAtlas){this._addRichTextImageElement(s);continue}}for(var h=(e=this.vj(e,r).join("\n")).split("\n"),u=0;u<h.length;++u){var o=h[u];if(""!==o)if(n=!1,this._maxWidth>0){var c=this._measureText(r,o);this._updateRichTextWithMaxWidth(o,c,r),h.length>1&&u<h.length-1&&this._updateLineInfo()}else i=this._addLabelSegment(o,r),this._lineOffsetX+=i.node.qu().width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),h.length>1&&u<h.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(e)&&u===h.length-1)continue;this._updateLineInfo(),n=!0}}}}n||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+EL)*this._lineHeight,this.node.qu().setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},n._getFirstWordLen=function(t,i,n){var r=jL(t,i);if(FL(r)||UL(r))return 1;for(var s=1,e=i+1;e<n&&!UL(r=jL(t,e))&&!FL(r);++e)s++;return s},n._updateRichTextPosition=function(){for(var t=0,i=1,n=this._lineCount,r=this.node.qu(),s=r.anchorX,e=r.anchorY,h=0;h<this._segments.length;++h){var u=this._segments[h],o=u.lineCount;o>i&&(t=0,i=o);var c=this._labelWidth*(.5*this._horizontalAlign-s);switch(this._horizontalAlign){case 0:break;case 1:c-=this._linesWidth[o-1]/2;break;case 2:c-=this._linesWidth[o-1]}var a=u.node,f=a.position;if(a.setPosition(t+c,this._lineHeight*(n-o)-this._labelHeight*e,f.z),o===i&&(t+=a.qu().width),a.getComponent(tU)){var v=a.position.clone(),l=this._lineHeight,d=this._lineHeight*(1+EL);switch(a.qu().anchorY){case 1:v.y+=l+(d-l)/2;break;case.5:v.y+=d/2;break;default:v.y+=(d-l)/2}if(u.imageOffset){var w=u.imageOffset.split(",");if(1===w.length&&w[0]){var g=parseFloat(w[0]);Number.isInteger(g)&&(v.y+=g)}else if(2===w.length){var p=parseFloat(w[0]),_=parseFloat(w[1]);Number.isInteger(p)&&(v.x+=p),Number.isInteger(_)&&(v.y+=_)}}a.position=v}var y=a.getComponent(KF);if(y&&y.enableOutline){var m=a.position.clone();m.y-=y.outlineWidth,a.position=m}}},n._convertLiteralColorValue=function(t){var i=t.toUpperCase();return Qs[i]?Qs[i]:(new Qs).fromHEX(t)},n._applyTextAttribute=function(t){var i=t.node.getComponent(KF);if(i){this._resetLabelState(i);var n,r=t.styleIndex;if(this._textArray[r]&&(n=this._textArray[r].style),n){n.color?i.color=this._convertLiteralColorValue(n.color):i.color=this._fontColor,i.isBold=!!n.bold,i.isItalic=!!n.italic,i.isUnderline=!!n.underline,n.outline&&(i.enableOutline=!0,i.outlineColor=this._convertLiteralColorValue(n.outline.color),i.outlineWidth=n.outline.width),i.fontSize=n.size||this._fontSize,t.clickHandler="",t.clickParam="";var s=n.event;s&&(t.clickHandler=s.click||"",t.clickParam=s.param||"")}i.cacheMode=this._cacheMode,this._font instanceof bL&&!this._isSystemFontUsed?i.font=this._font:i.fontFamily=this._fontFamily,i.useSystemFont=this._isSystemFontUsed,i.lineHeight=this._lineHeight,i.updateRenderData(!0)}},n._applyLayer=function(){var t=this;this._segments.forEach((function(i){i.node.layer=t.node.layer}))},n._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=this._fontColor,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},r(i,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontColor",get:function(){return this._fontColor},set:function(t){this._fontColor!==t&&(this._fontColor=t,this._updateTextDefaultColor())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),i}(Kg),Zdt.HorizontalAlign=TF,Zdt.VerticalAlign=OF,y((Udt=Zdt).prototype,"horizontalAlign",[Cdt],Object.getOwnPropertyDescriptor(Udt.prototype,"horizontalAlign"),Udt.prototype),y(Udt.prototype,"verticalAlign",[Ndt],Object.getOwnPropertyDescriptor(Udt.prototype,"verticalAlign"),Udt.prototype),y(Udt.prototype,"fontColor",[Pdt],Object.getOwnPropertyDescriptor(Udt.prototype,"fontColor"),Udt.prototype),y(Udt.prototype,"font",[Ldt],Object.getOwnPropertyDescriptor(Udt.prototype,"font"),Udt.prototype),y(Udt.prototype,"cacheMode",[Ddt],Object.getOwnPropertyDescriptor(Udt.prototype,"cacheMode"),Udt.prototype),y(Udt.prototype,"imageAtlas",[Bdt],Object.getOwnPropertyDescriptor(Udt.prototype,"imageAtlas"),Udt.prototype),xdt=uo(Udt.prototype,"_lineHeight",[Co],(function(){return 40})),Gdt=uo(Udt.prototype,"_string",[Co],(function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"})),jdt=uo(Udt.prototype,"_horizontalAlign",[Co],(function(){return 0})),Hdt=uo(Udt.prototype,"_verticalAlign",[Co],(function(){return 0})),Vdt=uo(Udt.prototype,"_fontSize",[Co],(function(){return 40})),$dt=uo(Udt.prototype,"_fontColor",[Co],(function(){return Qs.WHITE.clone()})),zdt=uo(Udt.prototype,"_maxWidth",[Co],(function(){return 0})),Wdt=uo(Udt.prototype,"_fontFamily",[Co],(function(){return"Arial"})),Xdt=uo(Udt.prototype,"_font",[Co],(function(){return null})),Ydt=uo(Udt.prototype,"_isSystemFontUsed",[Co],(function(){return!0})),Kdt=uo(Udt.prototype,"_userDefinedFont",[Co],(function(){return null})),qdt=uo(Udt.prototype,"_cacheMode",[Co],(function(){return 0})),Qdt=uo(Udt.prototype,"_imageAtlas",[Co],(function(){return null})),Jdt=uo(Udt.prototype,"_handleTouchEvent",[Co],(function(){return!0})),Fdt=Udt))||Fdt)||Fdt)||Fdt));T.RichText=fwt;var vwt=function(){function t(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new p9(t),this.jointAnimationInfo=new _9(t)}var i=t.prototype;return i.releaseSkeleton=function(t){this.jointTexturePool.releaseSkeleton(t)},i.releaseAnimationClip=function(t){this.jointTexturePool.releaseAnimationClip(t)},i.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},t}();T.internal.DataPoolManager=vwt;var lwt,dwt,wwt,gwt,pwt,_wt,ywt,mwt,bwt,kwt,Awt,Ewt,Twt,Owt,Swt,Iwt=new ls,Rwt=new ls,Mwt=t("em",function(t){function i(i,n){var r;return void 0===n&&(n=""),(r=t.call(this,i,n)||this)._frames=1,r._bakedDuration=0,r._animInfo=null,r._sockets=[],r._animInfoMgr=void 0,r._parent=null,r._curvesInited=!1,r._animInfoMgr=T.director.root.dataPoolManager.jointAnimationInfo,r}e(i,t);var n=i.prototype;return n.initialize=function(i){if(!this._curveLoaded){this._parent=i.getComponent("cc.SkeletalAnimation");var n=this._parent.useBakedAnimation;this._doNotCreateEval=n,t.prototype.initialize.call(this,i),this._curvesInited=!n;var r=TX.getOrExtract(this.clip),s=r.frames,e=r.samples;this._frames=s-1,this._animInfo=this._animInfoMgr.getData(i.uuid),this._bakedDuration=this._frames/e,this.setUseBaked(n)}},n.onPlay=function(){var i=this;t.prototype.onPlay.call(this),this._parent.useBakedAnimation&&(this._animInfoMgr.switchClip(this._animInfo,this.clip),this._parent.getUsers().forEach((function(t){t.uploadAnimation(i.clip)})))},n.setUseBaked=function(i){i?(this._sampleCurves=this.wj,this.duration=this._bakedDuration):(this._sampleCurves=t.prototype._sampleCurves,this.duration=this.clip.duration,this._curvesInited||(this._curveLoaded=!1,t.prototype.initialize.call(this,this._targetNode),this._curvesInited=!0))},n.rebuildSocketCurves=function(t){if(this._sockets.length=0,this._targetNode)for(var i=this._targetNode,n=0;n<t.length;++n){var r=t[n],s=i.getChildByPath(r.path);if(r.target){for(var e=TX.getOrExtract(this.clip),h=r.path,u=e.joints[h],o=s,c=void 0;!u;){var a=h.lastIndexOf("/");if(h=h.substring(0,a),u=e.joints[h],o&&(c||(c=ls.identity(Rwt)),ls.fromRTS(Iwt,o.rotation,o.position,o.scale),ls.multiply(c,Iwt,c),o=o.parent),a<0)break}for(var f=u&&u.transforms,v=e.frames,l=[],d=0;d<v;d++){var w;w=f&&c?ls.multiply(Iwt,f[d],c):f?f[d]:c||new ls;var g={pos:new Ir,rot:new Qr,scale:new Ir};ls.toSRT(w,g.rot,g.pos,g.scale),l.push(g)}this._sockets.push({target:r.target,frames:l})}}},n.wj=function(t){var i=t/this.duration,n=this._animInfo,r=this.clip;n.currentClip!==r&&(this._animInfoMgr.switchClip(this._animInfo,r),this._parent.getUsers().forEach((function(t){t.uploadAnimation(r)})),n.data[0]=-1);var s=i*this._frames+.5|0;if(s!==n.data[0]){n.data[0]=s,n.dirty=!0;for(var e=0;e<this._sockets.length;++e){var h=this._sockets[e],u=h.target,o=h.frames[s],c=o.pos,a=o.rot,f=o.scale;u.setRTS(a,c,f)}}},i}(nH)),Cwt=t("en",(lwt=_o("cc.SkeletalAnimation.Socket"),dwt=ic(WE),lwt((gwt=function(t,i){void 0===t&&(t=""),void 0===i&&(i=null),this.path=pwt&&pwt(),this.target=_wt&&_wt(),this.path=t,this.target=i},pwt=uo(gwt.prototype,"path",[Co],(function(){return""})),_wt=uo(gwt.prototype,"target",[dwt],(function(){return null})),wwt=gwt))||wwt));qt(Cwt,"cc.SkeletalAnimationComponent.Socket");var Nwt=new ls,Pwt=new ls;function Lwt(t,i,n){void 0===i&&(i=""),void 0===n&&(n=[]);for(var r=0;r<t.children.length;r++){var s=t.children[r];if(s){var e=i?i+"/"+s.name:s.name;n.push(e),Lwt(s,e,n)}}return n}t("eo",(ywt=_o("cc.SkeletalAnimation"),mwt=mo(99),bwt=ic([Cwt]),kwt=ic([Cwt]),ywt(Awt=mwt((Swt=function(t){function i(){for(var i,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(i=t.call.apply(t,[this].concat(r))||this)._useBakedAnimation=Twt&&Twt(),i._sockets=Owt&&Owt(),i.gj=new Set,i.pj=null,i}e(i,t);var n=i.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this);for(var i=this.node.getComponentsInChildren(w7),n=0;n<i.length;++n){var r=i[n];r.skinningRoot===this.node&&this.notifySkinnedMeshAdded(r)}},n.onDestroy=function(){t.prototype.onDestroy.call(this),T.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),Qj().removeSockets(this.node,this._sockets),this._j()},n.onEnable=function(){var i;t.prototype.onEnable.call(this),null==(i=this.pj)||i.resume()},n.onDisable=function(){var i;t.prototype.onDisable.call(this),null==(i=this.pj)||i.pause()},n.start=function(){this.sockets=this._sockets,this.yj(),t.prototype.start.call(this)},n.pause=function(){var i;this._useBakedEffectively?null==(i=this.pj)||i.pause():t.prototype.pause.call(this)},n.resume=function(){var i;this._useBakedEffectively?null==(i=this.pj)||i.resume():t.prototype.resume.call(this)},n.stop=function(){this._useBakedEffectively?this.pj&&(this.pj.stop(),this.pj=null):t.prototype.stop.call(this)},n.querySockets=function(){var t=this._defaultClip&&Object.keys(TX.getOrExtract(this._defaultClip).joints).sort().reduce((function(t,i){return i.startsWith(t[t.length-1]+"/")||t.push(i),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var i=[],n=0;n<t.length;n++){var r=t[n],s=this.node.getChildByPath(r);s&&(i.push(r),Lwt(s,r,i))}return i},n.rebuildSocketAnimations=function(){var t=this;for(var i in this._sockets.forEach((function(i){var n=t.node.getChildByPath(i.path),r=i.target;n&&r&&(r.name=i.path.substring(i.path.lastIndexOf("/")+1)+" Socket",r.parent=t.node,s9(n,t.node,Nwt),ls.fromRTS(Pwt,r.rotation,r.position,r.scale),ls.equals(Pwt,Nwt)||(r.matrix=Nwt))})),this._nameToState)this._nameToState[i].rebuildSocketCurves(this._sockets)},n.createSocket=function(t){var i=this._sockets.find((function(i){return i.path===t}));if(i)return i.target;if(!this.node.getChildByPath(t))return W("illegal socket path"),null;var n=new WE;return n.parent=this.node,this._sockets.push(new Cwt(t,n)),this.rebuildSocketAnimations(),n},n.notifySkinnedMeshAdded=function(t){var i=this._useBakedEffectively,n=t.associatedAnimation;if(n&&n.gj.delete(t),t.associatedAnimation=this,t.setUseBakedAnimation(i,!0),i){var r=this.pj;r&&t.uploadAnimation(r.clip)}this.gj.add(t)},n.notifySkinnedMeshRemoved=function(t){t.associatedAnimation===this||t.associatedAnimation,t.setUseBakedAnimation(!1),t.associatedAnimation=null,this.gj.delete(t)},n.getUsers=function(){return this.gj},n._createState=function(t,i){return new Mwt(t,i)},n._doCreateState=function(i,n){var r=t.prototype._doCreateState.call(this,i,n);return r.rebuildSocketCurves(this._sockets),r},n.doPlayOrCrossFade=function(i,n){if(this._useBakedEffectively){this.pj&&this.pj.stop();var r=i;this.pj=r,r.play()}else t.prototype.doPlayOrCrossFade.call(this,i,n)},n._j=function(){var t=this;Array.from(this.gj).forEach((function(i){t.notifySkinnedMeshRemoved(i)}))},n.yj=function(){var t=this._useBakedEffectively;for(var i in this._nameToState)this._nameToState[i].setUseBaked(t);this.gj.forEach((function(i){i.setUseBakedAnimation(t)})),t?Qj().removeSockets(this.node,this._sockets):(Qj().addSockets(this.node,this._sockets),this.pj=null),this.mj(!t)},n.mj=function(t){var i=this;this.node.children.forEach((function(n){i._sockets.find((function(t){return t.target===n}))||(n.isSkipTransformUpdate=!t)}))},r(i,[{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedEffectively){var i=Qj();i.removeSockets(this.node,this._sockets),i.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){this._useBakedAnimation=t,this.yj()}},{key:"_useBakedEffectively",get:function(){return this._useBakedAnimation}}]),i}(Jit),Swt.Socket=Cwt,y((Ewt=Swt).prototype,"sockets",[bwt],Object.getOwnPropertyDescriptor(Ewt.prototype,"sockets"),Ewt.prototype),Twt=uo(Ewt.prototype,"_useBakedAnimation",[Co],(function(){return!0})),Owt=uo(Ewt.prototype,"_sockets",[kwt],(function(){return[]})),Awt=Ewt))||Awt)||Awt));var Dwt,Bwt,Fwt,Uwt,xwt,Gwt,jwt,Hwt,Vwt=0;t("ep",(Dwt=_o("cc.Sorting2D"),Bwt=yo(GB),Fwt=ic(xB.Enum),Dwt(Uwt=bo(Uwt=Bwt((y((xwt=function(t){function i(){var i;return(i=t.call(this)||this).bj=!1,i._sortingLayer=Gwt&&Gwt(),i._sortingOrder=jwt&&jwt(),i.kj=null,i}e(i,t);var n=i.prototype;return n.__preload=function(){this.kj=this.getComponent(GB),this.kj||st(16300,this.node.name)},n.onEnable=function(){this.bj=!0,this._updateSortingPriority(),xx(++Vwt)},n.onDisable=function(){this.bj=!1,this._updateSortingPriority(),xx(--Vwt)},n._updateSortingPriority=function(){var t=this.kj;if(t&&t.isValid)if(this.bj){var i=xB.getLayerIndex(this._sortingLayer),n=xB.getSortingPriority(i,this._sortingOrder);t.priority=n}else t.priority=xB.getDefaultPriority()},r(i,[{key:"sortingLayer",get:function(){return this._sortingLayer},set:function(t){t!==this._sortingLayer&&xB.isLayerValid(t)&&(this._sortingLayer=t,this._updateSortingPriority())}},{key:"sortingOrder",get:function(){return this._sortingOrder},set:function(t){t!==this._sortingOrder&&(this._sortingOrder=Gn(t,-32768,32767),this._updateSortingPriority())}}]),i}(Kg)).prototype,"sortingLayer",[Fwt],Object.getOwnPropertyDescriptor(xwt.prototype,"sortingLayer"),xwt.prototype),Gwt=uo(xwt.prototype,"_sortingLayer",[Co],(function(){return xB.Enum.default})),jwt=uo(xwt.prototype,"_sortingOrder",[Co],(function(){return 0})),Uwt=xwt))||Uwt)||Uwt)||Uwt)),function(t,i){function n(t){for(var i in t)t[t[i]]=i}var r=t.MixBlend={setup:0,first:1,replace:2,add:3};n(r),n(r=t.MixDirection={mixIn:0,mixOut:1}),n(r=t.TimelineType={rotate:0,translate:1,scale:2,shear:3,attachment:4,color:5,deform:6,event:7,drawOrder:8,ikConstraint:9,transformConstraint:10,pathConstraintPosition:11,pathConstraintSpacing:12,pathConstraintMix:13,twoColor:14}),n(r=t.EventType={start:0,interrupt:1,end:2,complete:3,dispose:4,event:5}),n(r=t.BlendMode={Normal:0,Additive:1,Multiply:2,Screen:3}),n(r=t.TransformMode={Normal:0,OnlyTranslation:1,NoRotationOrReflection:2,NoScale:3,NoScaleOrReflection:4}),n(r=t.PositionMode={Fixed:0,Percent:1}),n(r=t.SpacingMode={Length:0,Fixed:1,Percent:2}),n(r=t.RotateMode={Tangent:0,Chain:1,ChainScale:2}),n(r=t.TextureFilter={Nearest:9728,Linear:9729,MipMap:9987,MipMapNearestNearest:9984,MipMapLinearNearest:9985,MipMapNearestLinear:9986,MipMapLinearLinear:9987}),n(r=t.TextureWrap={MirroredRepeat:33648,ClampToEdge:33071,Repeat:10497}),n(r=t.AttachmentType={Region:0,BoundingBox:1,Mesh:2,LinkedMesh:3,Path:4,Point:5,Clipping:6}),r=null;var s=3.1415927,e=2*s,h=180/s,u=h,o=s/180,c=o;t.MathUtils=(i=function(){function t(){}return t.clamp=function(t,i,n){return t<i?i:t>n?n:t},t.cosDeg=function(t){return Math.cos(t*c)},t.sinDeg=function(t){return Math.sin(t*c)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var i=Math.pow(Math.abs(t),1/3);return t<0?-i:i},t.randomTriangular=function(i,n){return t.randomTriangularWith(i,n,.5*(i+n))},t.randomTriangularWith=function(t,i,n){var r=Math.random(),s=i-t;return r<=(n-t)/s?t+Math.sqrt(r*s*(n-t)):i-Math.sqrt((1-r)*s*(i-n))},t}(),i.PI=s,i.PI2=e,i.radiansToDegrees=h,i.radDeg=u,i.degreesToRadians=o,i.degRad=c,i)}(Hwt||(Hwt={}));var $wt=Hwt;function zwt(t,i){return t?i===t.length?t:i<t.length?t.slice(0,i):new Array(i):new Array(i)}function Wwt(t,i,n){var r="_"+n;Object.defineProperty(t,n,{get:function(){var t=i.call(this),n=t.size(),s=this[r];s=zwt(s,n);for(var e=0;e<n;e++)s[e]=t.get(e);return this[r]=s,s}})}function Xwt(t,i,n){var r="_"+n;Object.defineProperty(t,n,{get:function(){var t=i.call(this),n=t.size(),s=this[r];s=zwt(s,n);for(var e=0;e<n;e++){var h=t.get(e),u=h.size(),o=s[e];o=zwt(o,u);for(var c=0;c<u;c++)o[c]=h.get(c);s[e]=o}return this[r]=s,s}})}function Ywt(t,i,n){var r="_"+n;Object.defineProperty(t,n,{value:function(){var t=i.call(this),n=t.size(),s=this[r];s=zwt(s,n);for(var e=0;e<n;e++)s[e]=t.get(e);return this[r]=s,s}})}function Kwt(t){for(var i in $wt.wasmUtil=t.SpineWasmUtil,$wt.wasmUtil.wasm=t,$wt.wasmUtil.spineWasmInit(),t){var n=t[i];$wt[i]||($wt[i]=n)}}function qwt(){var t=$wt.PathConstraintData.prototype;Wwt(t,t.getBones,"bones")}function Qwt(){var t=$wt.VertexAttachment.prototype;Wwt(t,t.getBones,"bones"),Wwt(t,t.getVertices,"vertices");var i=t.computeWorldVertices,n=new $wt.SPVectorFloat;Object.defineProperty(t,"computeWorldVertices",{value:function(t,r,s,e,h,u){var o=e.length;n.resize(o,0);for(var c=0;c<o;c++)n.set(c,e[c]);i.call(this,t,r,s,n,h,u);for(var a=0;a<o;a++)e[a]=n.get(a)}})}function Jwt(){var t=$wt.MeshAttachment.prototype;Wwt(t,t.getRegionUVs,"regionUVs"),Wwt(t,t.getUVs,"uvs"),Wwt(t,t.getTriangles,"triangles"),Wwt(t,t.getEdges,"edges")}function Zwt(){var t=$wt.PathAttachment.prototype;Wwt(t,t.getLengths,"lengths")}function tgt(){var t=$wt.RegionAttachment.prototype;Wwt(t,t.getOffset,"offset");var i=t.getUVs,n=t.setUVs,r="_uvs";Object.defineProperty(t,"uvs",{get:function(){var n=i.call(this),s=n.size(),e=t[r];e=zwt(e,s);for(var h=0;h<s;h++)e[h]=n.get(h);return t[r]=e,e},set:function(t){n.call(this,t[0],t[1],t[2],t[3],1===t[4])}});var s=t.computeWorldVertices,e=new $wt.SPVectorFloat;Object.defineProperty(t,"computeWorldVertices",{value:function(t,i,n,r){var h=i.length;e.resize(h,0);for(var u=0;u<h;u++)e.set(u,i[u]);s.call(this,t,e,n,r);for(var o=0;o<h;o++)i[o]=e.get(o)}})}function igt(){var t=$wt.IkConstraint.prototype;Wwt(t,t.getBones,"bones")}function ngt(){var t=$wt.PathConstraint.prototype;Wwt(t,t.getBones,"bones")}function rgt(){var t=$wt.TransformConstraintData.prototype;Wwt(t,t.getBones,"bones")}function sgt(){var t=$wt.TransformConstraint.prototype;Wwt(t,t.getBones,"bones")}function egt(){var t=$wt.Bone.prototype;Wwt(t,t.getChildren,"children")}function hgt(){var t=$wt.Slot.prototype;Wwt(t,t.getDeform,"deform")}function ugt(){var t=$wt.Skin.prototype;Wwt(t,t.getBones,"bones"),Wwt(t,t.getAttachments,"attachments"),Wwt(t,t.getConstraints,"constraints"),Ywt(t,t.getAttachments,"getAttachments");var i=t.getAttachmentsForSlot;Object.defineProperty(t,"getAttachmentsForSlot",{value:function(t,n){var r=i.call(this,t),s=r.size();n.length=s;for(var e=0;e<s;e++)n[e]=r.get(e);r.delete()}});var n=t.findNamesForSlot;Object.defineProperty(t,"findNamesForSlot",{value:function(t,i){var r=n.call(this,t),s=r.size();i.length=s;for(var e=0;e<s;e++)i[e]=r.get(e);r.delete()}})}function ogt(){var t=$wt.SkinEntry.prototype;[["name",t.getName],["attachment",t.getAttachment]].forEach((function(i){Tt(t,i[0],i[1])}))}function cgt(){var t=$wt.SkeletonData.prototype;Wwt(t,t.getBones,"bones"),Wwt(t,t.getSlots,"slots"),Wwt(t,t.getSkins,"skins"),Wwt(t,t.getAnimations,"animations"),Wwt(t,t.getEvents,"events"),Wwt(t,t.getIkConstraints,"ikConstraints"),Wwt(t,t.getTransformConstraints,"transformConstraints"),Wwt(t,t.getPathConstraints,"pathConstraints")}function agt(){var t=$wt.RotateTimeline.prototype;Wwt(t,t.getFrames,"frames")}function fgt(){var t=$wt.ColorTimeline.prototype;Wwt(t,t.getFrames,"frames")}function vgt(){var t=$wt.AttachmentTimeline.prototype;Wwt(t,t.getFrames,"frames"),Wwt(t,t.getAttachmentNames,"attachmentNames")}function lgt(){var t=$wt.DeformTimeline.prototype;Wwt(t,t.getFrames,"frames"),Xwt(t,t.getFrameVertices,"frameVertices")}function dgt(){var t=$wt.EventTimeline.prototype;Wwt(t,t.getFrames,"frames"),Wwt(t,t.getEvents,"events")}function wgt(){var t=$wt.DrawOrderTimeline.prototype;Wwt(t,t.getFrames,"frames")}function ggt(){var t=$wt.AnimationState.prototype;Wwt(t,t.getTracks,"tracks")}function pgt(){var t=$wt.Animation.prototype;Wwt(t,t.getTimelines,"timelines")}function _gt(){var t=$wt.Skeleton.prototype;Wwt(t,t.getBones,"bones"),Wwt(t,t.getSlots,"slots"),Wwt(t,t.getDrawOrder,"drawOrder"),Wwt(t,t.getIkConstraints,"ikConstraints"),Wwt(t,t.getTransformConstraints,"transformConstraints"),Wwt(t,t.getPathConstraints,"pathConstraints"),Wwt(t,t.getUpdateCacheList,"_updateCache")}var ygt=null,mgt=[];mgt.push((function(t){var i;Kwt(t),Wwt(i=$wt.IkConstraintData.prototype,i.getBones,"bones"),qwt(),Jwt(),Zwt(),tgt(),Qwt(),igt(),ngt(),rgt(),sgt(),egt(),hgt(),ugt(),ogt(),cgt(),agt(),fgt(),vgt(),lgt(),dgt(),wgt(),ggt(),pgt(),_gt()}));var bgt,kgt=0,Agt=0,Egt=function(){function t(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t.getListeners=function(i,n){if(!i.listener){i.listener=new t;var r=++Agt;n.setTrackEntryListener(r,i),t.Aj.set(r,i)}return i.listener},t.emitListener=function(i,n,r,s){var e=t.Ej.get(i);if(e)switch(s){case $wt.EventType.event:e.event&&e.event(n,r);break;case $wt.EventType.start:e.start&&e.start(n);break;case $wt.EventType.interrupt:e.interrupt&&e.interrupt(n);break;case $wt.EventType.end:e.end&&e.end(n);break;case $wt.EventType.dispose:e.dispose&&e.dispose(n);break;case $wt.EventType.complete:e.complete&&e.complete(n);break;default:W("emitListener doesn't handled",s)}},t.emitTrackEntryListener=function(t,i,n,r){var s=this.Aj.get(t);if(s)switch(r){case $wt.EventType.start:s.listener.start&&s.listener.start(i);break;case $wt.EventType.interrupt:s.listener.interrupt&&s.listener.interrupt(i);break;case $wt.EventType.end:s.listener.end&&s.listener.end(i);break;case $wt.EventType.dispose:s.listener.dispose&&s.listener.dispose(i),this.Aj.delete(t),s.listener=null;break;case $wt.EventType.complete:s.listener.complete&&s.listener.complete(i);break;case $wt.EventType.event:s.listener.event&&s.listener.event(i,n);break;default:W("TrackEntry doesn't handled",r)}},t.addListener=function(i){var n=++kgt;return t.Ej.set(n,i),n},t.removeListener=function(i){t.Ej.delete(i)},t}();Egt.Ej=new Map,Egt.Aj=new Map,globalThis.TrackEntryListeners=Egt;var Tgt=1/60;zD(jD);var Ogt,Sgt,Igt,Rgt,Mgt,Cgt,Ngt,Pgt,Lgt,Dgt,Bgt=zD(VD),Fgt=function(){this.a=0,this.b=0,this.c=0,this.d=0,this.worldX=0,this.worldY=0},Ugt=function(){this.vCount=0,this.iCount=0,this.vData=null,this.iData=null,this.meshes=[]},xgt=function(){this.iCount=0,this.blendMode=0,this.textureID=0},Ggt=function(){function t(t){this._instance=null,this._state=null,this._skeletonData=null,this._skeleton=null,this._privateMode=!1,this._curIndex=-1,this._isCompleted=!1,this._maxFrameIdex=0,this._frameIdx=-1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._skeletonInfo=null,this._animationName=null,this.isCompleted=!1,this.totalTime=0,this.frames=[],this._privateMode=!1,this._inited=!1,this._invalid=!0,this._instance=new $wt.SkeletonInstance,this._instance.isCache=!0,this._skeletonData=t,this._skeleton=this._instance.initSkeleton(t),this._instance.setUseTint(!0)}var i=t.prototype;return i.init=function(t,i){this._inited=!0,this._animationName=i,this._skeletonInfo=t},i.setSkin=function(t){this._skeleton&&this._skeleton.setSkinByName(t),this._instance.setSkin(t)},i.setAnimation=function(t){var i=this._skeletonData.animations,n=null;i.forEach((function(i){i.name===t&&(n=i)})),n?(this._maxFrameIdex=Math.floor(n.duration/Tgt),this._maxFrameIdex<=0&&(this._maxFrameIdex=1),this._instance.setAnimation(0,t,!1)):W("find no animation named "+t+" !!!")},i.updateToFrame=function(t){if(this._inited&&(this.begin(),this.needToUpdate(t)))do{this._frameIdx++,this.totalTime+=Tgt,this._instance.updateAnimation(Tgt);var i=this._instance.updateRenderData();this.Tj(this._frameIdx,i),this._frameIdx>=this._maxFrameIdex&&(this.isCompleted=!0)}while(this.needToUpdate(t))},i.getFrame=function(t){var i=t%this._maxFrameIdex;return this.frames[i]},i.invalidAnimationFrames=function(){this._curIndex=-1,this._isCompleted=!1,this.frames.length=0},i.Tj=function(t,i){var n=i.vCount,r=i.iCount,s=Bgt/4,e=new Uint8Array(4*s*n),h=new Uint16Array(r),u=$wt.wasmUtil.wasm.HEAPU8,o=i.vPtr,c=4*n*s;e.set(u.subarray(o,o+c));var a=i.iPtr,f=2*r;new Uint8Array(h.buffer).set(u.subarray(a,a+f));var v=new Ugt;v.vCount=n,v.iCount=r,v.vData=e,v.iData=h;for(var l=i.getData(),d=i.getTextures(),w=l.size(),g=0;g<w;g+=5){var p=new xgt;p.iCount=l.get(g+3),p.blendMode=l.get(g+4),p.textureID=d.get(g/5),v.meshes.push(p)}var _=this._skeleton.bones,y=[];_.forEach((function(t){var i=new Fgt;i.a=t.a,i.b=t.b,i.c=t.c,i.d=t.d,i.worldX=t.worldX,i.worldY=t.worldY,y.push(i)})),this.frames[t]={model:v,boneInfos:y}},i.begin=function(){if(this._invalid){var t=this._skeletonInfo,i=null==t?void 0:t.curAnimationCache;i&&i!==this&&(this._privateMode?i.invalidAllFrame():i.updateToFrame(0));var n=null==t?void 0:t.listener;this._instance.setAnimation(0,this._animationName,!1),this.bind(n),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},i.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},i.bind=function(t){var i=this;t.complete=function(t){t&&t.animation.name===i._animationName&&(i.isCompleted=!0)}},i.unbind=function(t){t.complete=null},i.needToUpdate=function(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},i.isInited=function(){return this._inited},i.isInvalid=function(){return this._invalid},i.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},i.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},i.clear=function(){this._inited=!1,this.invalidAllFrame()},i.destroy=function(){this._instance&&(this._instance.destroy(),this._instance=null)},r(t,[{key:"skeleton",get:function(){return this._skeleton}}]),t}(),jgt=function(){function t(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this.Oj=new Map,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var i=t.prototype;return i.enablePrivateMode=function(){this._privateMode=!0},i.clear=function(){this._animationPool={},this._skeletonCache={}},i.invalidAnimationCache=function(t){var i=this._skeletonCache[t];if(i&&i.skeleton){var n=i.animationsCache;for(var r in n)n[r].invalidAllFrame()}},i.destroySkeleton=function(t){var i=this;if(!this._privateMode){var n=this.Oj.get(t);if(n){if((n-=1)>0)return void this.Oj.set(t,n);this.Oj.delete(t)}}var r=this._skeletonCache[t];if(r){var s=this._privateMode?function(t,i){i.destroy()}:function(n,r){i._animationPool[t+"#"+n]=r,r.clear()},e=r.animationsCache;for(var h in e){var u=e[h];u&&s(h,u)}r.skeleton&&$wt.wasmUtil.destroySpineSkeleton(r.skeleton),delete this._skeletonCache[t]}},i.createSkeletonInfo=function(t){var i=t.uuid,n=t.getRuntimeData();if(!this._privateMode){var r=this.Oj.get(i);r?r+=1:r=1,this.Oj.set(i,r)}if(this._skeletonCache[i])return this._skeletonCache[i];var s=new $wt.Skeleton(n),e=new Egt;return this._skeletonCache[i]={skeleton:s,clipper:null,state:null,listener:e,animationsCache:{},curAnimationCache:null,assetUUID:i}},i.getSkeletonInfo=function(t){var i=t.uuid;return this._skeletonCache[i]},i.getAnimationCache=function(t,i){var n=this._skeletonCache[t];return n?n.animationsCache[i]:null},i.initAnimationCache=function(t,i,n){var r=i.getRuntimeData();if(!r)return null;var s=this._skeletonCache[t];if(!s||!s.skeleton)return null;var e=s.animationsCache,h=e[n];if(!h){var u=t+"#"+n;(h=this._animationPool[u])?delete this._animationPool[u]:(h=new Ggt(r))._privateMode=this._privateMode,h.init(s,n),e[n]=h}return h.init(s,n),h.setAnimation(n),h},i.destroyCachedAnimations=function(t){if(t){var i=this._animationPool;for(var n in i)n.includes(t)&&(i[n].destroy(),delete i[n]);var r=this._skeletonCache[t],s=r&&r.skeleton;s&&$wt.wasmUtil.destroySpineSkeleton(s),r&&delete this._skeletonCache[t]}else{var e=this._animationPool;for(var h in e)e[h].destroy(),delete e[h]}},t}();bgt=jgt,jgt.FrameTime=Tgt,jgt.sharedCache=new bgt;var Hgt=(Ogt=_o("sp.SkeletonData"),Sgt=ic([f_]),Igt=ic([Zi]),Ogt((Mgt=function(t){function i(){var i;return(i=t.call(this)||this)._skeletonJson=Cgt&&Cgt(),i.textures=Ngt&&Ngt(),i.textureNames=Pgt&&Pgt(),i.scale=Lgt&&Lgt(),i._atlasText=Dgt&&Dgt(),i.Ts=void 0,i.Sj=null,i.Ij=null,i.Rj=null,i.reset(),i}e(i,t);var n=i.prototype;return n.createNode=function(t){var i=new WE(this.name);return i.addComponent("cc.Skeleton").skeletonData=this,t(null,i)},n.reset=function(){this.Sj=null},n.resetEnums=function(){},n.getRuntimeData=function(t){if(this.Sj)return this.Sj;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||X(this.name+" no textures found!"),null;var i=this.Mj(),n=$wt.wasmUtil.querySpineSkeletonDataByUUID(i);if(n)this.Sj=n;else{for(var r=this.textures.length,s=[],e=0;e<r;++e){var h=this.textures[e];s.push(h.uuid||h.getId())}if(this._skeletonJson)this.Sj=$wt.wasmUtil.createSpineSkeletonDataWithJson(this.skeletonJsonStr,this._atlasText,this.textureNames,s),$wt.wasmUtil.registerSpineSkeletonDataWithUUID(this.Sj,i);else{var u=new Uint8Array(this._nativeAsset),o=u.length,c=$wt.wasmUtil.createStoreMemory(o);$wt.wasmUtil.wasm.HEAPU8.subarray(c,c+o).set(u),this.Sj=$wt.wasmUtil.createSpineSkeletonDataWithBinary(o,this._atlasText,this.textureNames,s),$wt.wasmUtil.registerSpineSkeletonDataWithUUID(this.Sj,i),$wt.wasmUtil.freeStoreMemory()}}return this.Sj},n.getSkinsEnum=function(){if(this.Ij)return this.Ij;var t=this.getRuntimeData(!0);if(t){for(var i=t.skins,n={},r=0;r<i.length;r++)n[i[r].name]=r;return this.Ij=_i(n)}return null},n.getAnimsEnum=function(){if(this.Rj&&Object.keys(this.Rj).length>1)return this.Rj;var t=this.getRuntimeData(!0);if(t){for(var i={"<None>":0},n=t.animations,r=0;r<n.length;r++)i[n[r].name]=r+1;return this.Rj=_i(i)}return null},n.Mj=function(){var t=[this._atlasText].concat(this.textures.map((function(t){return t.getId()}))).join("");return""+this._uuid+Sv(t,668)},n.destroy=function(){return jgt.sharedCache.destroyCachedAnimations(this._uuid),$wt.wasmUtil.destroySpineSkeletonDataWithUUID(this.Mj()),t.prototype.destroy.call(this)},n.Cj=function(){return 0===this._atlasText.length&&!this._skeletonJson&&!this._nativeAsset},r(i,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},{key:"_nativeAsset",get:function(){return this.Ts},set:function(t){this.Ts=t,this.reset()}}]),i}(rg),Cgt=uo(Mgt.prototype,"_skeletonJson",[Co],(function(){return null})),Ngt=uo(Mgt.prototype,"textures",[Co,Sgt],(function(){return[]})),Pgt=uo(Mgt.prototype,"textureNames",[Co,Igt],(function(){return[]})),Lgt=uo(Mgt.prototype,"scale",[Co],(function(){return 1})),Dgt=uo(Mgt.prototype,"_atlasText",[Co],(function(){return""})),Rgt=Mgt))||Rgt);O.internal.SpineSkeletonData=Hgt;var Vgt=function(t){function i(){var i;return(i=t.call(this)||this).Nj=new Set,i}e(i,t),i.getInstance=function(){return i.se||(i.se=new i,xN.registerSystem(i.ID,i.se,200)),i.se};var n=i.prototype;return n.add=function(t){t&&(this.Nj.has(t)||this.Nj.add(t))},n.remove=function(t){t&&this.Nj.has(t)&&this.Nj.delete(t)},n.postUpdate=function(t){this.Nj&&this.Nj.forEach((function(i){i.updateAnimation(t)}))},n.prepareRenderData=function(){this.Nj&&this.Nj.forEach((function(t){t.vo()}))},i}(_v);Vgt.ID="SKELETON",Vgt.se=void 0,O.internal.SpineSkeletonSystem=Vgt;var $gt,zgt,Wgt,Xgt,Ygt,Kgt,qgt,Qgt,Jgt,Zgt,tpt,ipt,npt,rpt,spt,ept,hpt,upt,opt,cpt,apt,fpt,vpt,lpt,dpt,wpt,gpt,ppt,_pt,ypt,mpt=new ls,bpt=function(){function t(){this._isInitialized=!1,this._skeletonBones=null,this._socketNodes=null,this.Pj=[],this._isInitialized=!1}var i=t.prototype;return i.init=function(t){var i;this._isInitialized=!1,t&&0!==(null==(i=t.socketNodes)?void 0:i.size)&&(this._skeletonBones=t._skeleton.bones,!this._skeletonBones||this._skeletonBones.length<1||(this._socketNodes=t.socketNodes,!this._socketNodes||this._socketNodes.size<=0||(this._isInitialized=!0,this._syncAttachedNode())))},i.updateSkeletonBones=function(t){this._skeletonBones=t},i.reset=function(){this._isInitialized=!1,this._skeletonBones=null,this._socketNodes=null,this.Pj.length=0},i._syncAttachedNode=function(){if(this._isInitialized){for(var t,i=this._socketNodes,n=w(i);!(t=n()).done;){var r=t.value,s=r[0],e=r[1];if(e&&e.isValid){var h=this._skeletonBones[s];h&&this.matrixHandle(e,h)}else this.Pj.push(s)}if(!(this.Pj.length<=0)){for(var u,o=w(this.Pj);!(u=o()).done;){var c=u.value;i.delete(c)}this.Pj.length=0}}},i.matrixHandle=function(t,i){var n=mpt;n.m00=i.a,n.m01=i.c,n.m04=i.b,n.m05=i.d,n.m12=i.worldX,n.m13=i.worldY,t.matrix=mpt},t}();function kpt(t){return!!t&&!t.Cj()}var Apt={UNSET:-1,REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2};bi(Apt);var Ept=Apt,Tpt={default:0};bi(Tpt);var Opt={"<None>":0};bi(Opt);var Spt=Opt,Ipt=($gt=_o("sp.Skeleton.SpineSocket"),zgt=ic(WE),$gt((Xgt=function(t,i){void 0===t&&(t=""),void 0===i&&(i=null),this.path=Ygt&&Ygt(),this.target=Kgt&&Kgt(),this.path=t,this.target=i},Ygt=uo(Xgt.prototype,"path",[Co],(function(){return""})),Kgt=uo(Xgt.prototype,"target",[zgt,Co],(function(){return null})),Wgt=Xgt))||Wgt);qt(Ipt,"sp.Skeleton.SpineSocket");var Rpt=(qgt=_o("sp.Skeleton"),Qgt=ic(Hgt),Jgt=ic(Tpt),Zgt=ic(Opt),tpt=ic(Apt),ipt=ic([Ipt]),npt=ic(hA),qgt((ypt=function(t){function i(){var i;return(i=t.call(this)||this)._skeletonData=ept&&ept(),i.defaultSkin=hpt&&hpt(),i.defaultAnimation=upt&&upt(),i._premultipliedAlpha=opt&&opt(),i._timeScale=cpt&&cpt(),i._preCacheMode=apt&&apt(),i._cacheMode=fpt&&fpt(),i._sockets=vpt&&vpt(),i._useTint=lpt&&lpt(),i._debugMesh=dpt&&dpt(),i._debugBones=wpt&&wpt(),i._debugSlots=gpt&&gpt(),i._enableBatch=ppt&&ppt(),i._runtimeData=null,i._skeleton=null,i._instance=null,i._state=null,i._textures=[],i.Lj=null,i._animationName="",i._skinName="",i._drawList=new Ge((function(){return{material:null,texture:null,indexOffset:0,indexCount:0}}),1),i._materialCache={},i.paused=!1,i._enumSkins=_i({}),i._enumAnimations=_i({}),i.attachUtil=void 0,i._socketNodes=new Map,i._cachedSockets=new Map,i._startEntry=void 0,i._endEntry=void 0,i._paused=!1,i._accTime=0,i._playCount=0,i._skeletonCache=null,i._animCache=null,i._animationQueue=[],i._headAniInfo=null,i._isAniComplete=!0,i._playTimes=0,i._curFrame=null,i._listener=null,i.Dj=null,i.Bj=void 0,i.Fj=void 0,i.Uj=null,i._vLength=0,i._vBuffer=null,i._iLength=0,i._iBuffer=null,i._model=void 0,i._tempColor={r:0,g:0,b:0,a:0},i.xj=-1,i.Gj=null,i.jj=!1,i.loop=_pt&&_pt(),i._useVertexOpacity=!0,i._startEntry={animation:{name:""},trackIndex:0},i._endEntry={animation:{name:""},trackIndex:0},i.Bj=-1,i.Fj=-1,i._instance=new $wt.SkeletonInstance,i._instance.dtRate=1*i._timeScale,i._instance.isCache=i.isAnimationCached(),i.attachUtil=new bpt,i}e(i,t);var n=i.prototype;return n.__preload=function(){t.prototype.__preload.call(this),this._updateSkeletonData(),this._updateDebugDraw()},n.onRestore=function(){this.updateMaterial(),this.vo()},n.getState=function(){return this._state},n.onEnable=function(){t.prototype.onEnable.call(this),this._flushAssembler(),Vgt.getInstance().add(this),this.jj=!0},n.onDisable=function(){t.prototype.onDisable.call(this),Vgt.getInstance().remove(this),this.jj=!1},n.onDestroy=function(){var i;this.xj>0&&(Egt.removeListener(this.xj),this.xj=-1),this._drawList.destroy(),this.destroyRenderData(),this.Hj(),this._vBuffer=null,this._iBuffer=null,this.attachUtil.reset(),null==(i=this.Gj)||i.clear(),this.Gj=null,this._cachedSockets.clear(),this._socketNodes.clear(),this._animCache=null,Vgt.getInstance().remove(this),this._instance&&(this._instance.destroy(),this._instance=null),this.Vj(this._skeletonCache),this._skeletonCache=null,t.prototype.onDestroy.call(this)},n.clearAnimation=function(t){this.isAnimationCached()||(this.clearTrack(t||0),this.setToSetupPose())},n.clearAnimations=function(){this.isAnimationCached()||(this.clearTracks(),this.setToSetupPose())},n._updateSkeletonData=function(){var t=this._skeletonData;if(!kpt(this._skeletonData))return this._runtimeData=null,this._state=null,this._skeleton=null,this._textures=[],this._refreshInspector(),void(this.jj&&Vgt.getInstance().remove(this));this._instance&&(this._instance.dtRate=1*this._timeScale),this._runtimeData=t.getRuntimeData(),this._runtimeData&&(this.setSkeletonData(this._runtimeData),this._textures=t.textures,this._refreshInspector(),this.defaultSkin&&""!==this.defaultSkin?this.setSkin(this.defaultSkin):this._skinName&&""!==this._skinName&&this.setSkin(this._skinName),this.defaultAnimation?this.animation=this.defaultAnimation.toString():this._animationName?this.animation=this._animationName:this.animation="",this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings(),this.attachUtil.init(this),this._preCacheMode=this._cacheMode)},n.setSkeletonData=function(t){var i=this._skeletonCache;if(1===this._cacheMode?this._skeletonCache=jgt.sharedCache:2===this._cacheMode?(this._skeletonCache=new jgt,this._skeletonCache.enablePrivateMode()):this._skeletonCache=null,i!==this._skeletonCache&&this.Vj(i),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&st(16410);var n=this._skeletonCache.getSkeletonInfo(this._skeletonData);this.Lj!==n&&(this.Vj(this._skeletonCache),n||2!==this._cacheMode||(this._animCache=this._skeletonCache.initAnimationCache(this.skeletonData.uuid,this._skeletonData,this._animationName)),this.Lj=this._skeletonCache.createSkeletonInfo(this._skeletonData)),this.Lj&&(this._skeleton=this.Lj.skeleton)}else this._skeleton=this._instance.initSkeleton(t),this._state=this._instance.getAnimationState(),this._instance.setPremultipliedAlpha(this._premultipliedAlpha);this.jj&&Vgt.getInstance().add(this),this._flushAssembler()},n.setSlotsRange=function(t,i){this.isAnimationCached()?st(16411):(this.Bj=t,this.Fj=i)},n.getAttachment=function(t,i){return this._skeleton?this._skeleton.getAttachmentByName(t,i):null},n.setAttachment=function(t,i){this._skeleton&&this._skeleton.setAttachment(t,i),this.invalidAnimationCache()},n.getTextureAtlas=function(t){return t.region},n.setAnimation=function(t,i,n){if("string"!=typeof i)return tt(7511),null;var r=this._skeleton;if(!r||!r.data.findAnimation(i))return tt(7509,i),null;var s=null;if(void 0===n&&(n=!0),this._playTimes=n?0:1,this.isAnimationCached()){if(0!==t&&st(16412),!this._skeletonCache)return null;var e=this._skeletonCache.getAnimationCache(this._skeletonData.uuid,i);e||(e=this._skeletonCache.initAnimationCache(this.skeletonData.uuid,this._skeletonData,i))&&this._skinName&&e.setSkin(this._skinName),e&&(this._animationName=i,this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._animCache=e,this._socketNodes.size>0&&this._animCache.enableCacheAttachedInfo(),this._animCache.updateToFrame(0),this._curFrame=this._animCache.frames[0])}else this._animationName=i,s=this._instance.setAnimation(t,i,n);return this.vo(),s},n.addAnimation=function(t,i,n,r){if(r=r||0,this.isAnimationCached())return 0!==t&&st(16413),this._animationQueue.push({animationName:i,loop:n,delay:r}),null;if(this._skeleton){var s,e=this._skeleton.data.findAnimation(i);return e?null==(s=this._state)?void 0:s.addAnimationWith(t,e,n,r):(tt(7510,i),null)}return null},n.findAnimation=function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},n.getCurrent=function(t){if(this.isAnimationCached())st(16414);else if(this._state)return this._state.getCurrent(t);return null},n.setSkin=function(t){t&&(this._skeleton&&this._skeleton.setSkinByName(t),this._instance.setSkin(t),this.isAnimationCached()&&this._animCache&&this._animCache.setSkin(t),this._skinName=t,this.invalidAnimationCache())},n.updateAnimation=function(t){if(this.vo(),!this.paused)if(this.isAnimationCached()){if(t*=1*this._timeScale,this._isAniComplete){var i;if(0===this._animationQueue.length&&!this._headAniInfo){var n=this._animCache;if(n&&n.isInvalid()){n.updateToFrame(0);var r=n.frames;this._curFrame=r[r.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>(null==(i=this._headAniInfo)?void 0:i.delay)){var s=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,null==s?void 0:s.animationName,null==s?void 0:s.loop)}return}this._updateCache(t)}else this._instance.updateAnimation(t)},n._updateCache=function(t){var i=this._animCache;if(i.isInited()){var n=i.frames,r=jgt.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var s=Math.floor(this._accTime/r);if(i.isCompleted||i.updateToFrame(s),this._curFrame=n[s],void 0!==this._curFrame&&this.attachUtil.updateSkeletonBones(this._curFrame.boneInfos),i.isCompleted&&s>=n.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=n[n.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0,s=0,this._curFrame=n[s],this._emitCacheCompleteEvent()}}},n._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},n.updateRenderData=function(){return this.isAnimationCached()?this._curFrame?this._curFrame.model:null:this._instance.updateRenderData()},n._flushAssembler=function(){var t=i.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._skeleton&&this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.vo(),this._updateColor())},n._render=function(t){var i=0;if(this.renderData&&this._drawList.length>0){for(var n=this.renderData,r=n.chunk,s=r.vertexAccessor,e=n.getMeshBuffer(),h=e.indexOffset,u=0;u<this._drawList.length;u++){var o=this._drawList.data[u];o.texture&&t.commitMiddleware(this,e,h+o.indexOffset,o.indexCount,o.texture,o.material,this._enableBatch),i+=o.indexCount}var c=n.indices.subarray(0,i);s.appendIndices(r.bufferId,c),s.getMeshBuffer(r.bufferId).setDirty()}},n.requestDrawData=function(t,i,n,r){var s=this._drawList.add();s.material=t;var e,h,u=Pk.assets.get(i);return u||(u=null==(e=this.skeletonData)?void 0:e.textures.find((function(t){return t.uuid===i||t.getId()===i})))||(u=null==(h=this.Gj)?void 0:h.get(i)),s.texture=u,s.indexOffset=n,s.indexCount=r,s},n._updateBuiltinMaterial=function(){return Fk.get("default-spine-material")},n.updateMaterial=function(){var t;t=this._customMaterial?this._customMaterial:this._updateBuiltinMaterial(),this.setSharedMaterial(t,0),this.Hj()},n.$j=function(){return null!==this.customMaterial?this.customMaterial:(this.material||this.updateMaterial(),this.material)},n.Hj=function(){for(var t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}},n.getMaterialForBlendAndTint=function(t,i,n){var r=n+"/"+t+"/"+i,s=this._materialCache[r];if(s)return s;if(this.Uj)s=this.Uj;else{var e=this.$j();s=new wA({parent:e,subModelIdx:0,owner:this})}this._materialCache[r]=s,s.overridePipelineStates({blendState:{blendColor:Qs.WHITE,targets:[{blendEq:0,blendAlphaEq:0,blendSrc:t,blendDst:i,blendSrcAlpha:t,blendDstAlpha:i}]}});var h=!1;1===n&&(h=!0);var u=!this._enableBatch;return s.recompileShaders({TWO_COLORED:h,USE_LOCAL:u}),s},n._updateAnimEnum=function(){var t;t=kpt(this.skeletonData)?this.skeletonData.getAnimsEnum():Opt,this._enumAnimations=_i({}),Object.assign(this._enumAnimations,t),_i.update(this._enumAnimations),fn(this,"_animationIndex",this._enumAnimations)},n._updateSkinEnum=function(){var t;t=kpt(this.skeletonData)?this.skeletonData.getSkinsEnum():Tpt,this._enumSkins=_i({}),Object.assign(this._enumSkins,t),_i.update(this._enumSkins),fn(this,"_defaultSkinIndex",this._enumSkins)},n._refreshInspector=function(){},n.destroyRenderData=function(){this._drawList.reset(),t.prototype.destroyRenderData.call(this)},n.createRenderEntity=function(){var t=new TB(1);return t.uy(!0),t},n.markForUpdateRenderData=function(i){void 0===i&&(i=!0),t.prototype.vo.call(this,i),this.Dj&&this.Dj.vo(i)},n.syncAttachedNode=function(){this.attachUtil._syncAttachedNode()},n.isAnimationCached=function(){return 0!==this._cacheMode},n.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._preCacheMode=t,this._instance&&(this._instance.isCache=this.isAnimationCached()),this._updateSkeletonData(),this.vo())},n.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},n.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},n.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},n.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData.uuid)},n.findBone=function(t){return this._skeleton?this._skeleton.findBone(t):null},n.findSlot=function(t){return this._skeleton?this._skeleton.findSlot(t):null},n.setMix=function(t,i,n){this.isAnimationCached()?st(16415):this._state&&this._instance.setMix(t,i,n)},n.clearTracks=function(){this.isAnimationCached()?st(16416):this._state&&(this._state.clearTracks(),this.setToSetupPose())},n.clearTrack=function(t){this.isAnimationCached()?st(16417):this._state&&this._state.clearTrack(t)},n.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},n.zj=function(t){for(var i=0,n=t.length;i<n;i++){var r=t[i].target;!r||r.parent&&r.parent===this.node||X("Target node "+r.name+" is expected to be a direct child of "+this.node.name)}var s=new Map;t.forEach((function(t){t.target&&(s.get(t.target)?X("Target node "+t.target.name+" has existed."):s.set(t.target,!0))}))},n._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var t=0,i=this._sockets.length;t<i;t++){var n=this._sockets[t];if(n.path&&n.target){var r=this._cachedSockets.get(n.path);if(!r){X("Skeleton data does not contain path "+n.path);continue}this._socketNodes.set(r,n.target)}}}},n._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var t=this._skeleton.bones,i=function i(n){return null==n.parent?n.data.name||"<Unamed>":i(t[n.parent.data.index])+"/"+n.data.name},n=0,r=t.length;n<r;n++){var s=t[n].data,e=i(t[n]);this._cachedSockets.set(e,s.index)}}},n.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},n._updateUseTint=function(){this.Hj(),this.destroyRenderData(),this.isAnimationCached()||this._instance.setUseTint(this._useTint);var t=this._assembler;t&&t.createData&&this._skeleton&&(this._renderData=t.createData(this),this.vo())},n._updateBatch=function(){this.Hj(),this.vo()},n._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this.Dj){var t=new WE("DEBUG_DRAW_NODE");t.layer=this.node.layer,t.hideFlags|=1032;var i=null;try{(i=t.addComponent("cc.Graphics")).lineWidth=5,i.strokeColor=new Qs(255,0,0,255),this.Dj=i,t.parent=this.node,this.node.on("layer-changed",this._applyLayer,this)}catch(i){ht(4501,i.message),t.destroy(),t=null}}this.isAnimationCached()?st(16418):this._instance.setDebugMode(!0)}else this.Dj&&(this.node.off("layer-changed",this._applyLayer,this),this.Dj.node.destroy(),this.Dj=null,this.isAnimationCached()||this._instance&&this._instance.setDebugMode(!1))},n.Wj=function(){var t=this.node.qu(),i=this._runtimeData;if(!i)return t.setContentSize(100,100),t.anchorX=.5,void(t.anchorX=.5);var n=i.width,r=i.height;n&&r&&(t.setContentSize(n,r),0!==n&&(t.anchorX=Math.abs(i.x)/n),0!==r&&(t.anchorY=Math.abs(i.y)/r))},n._updateColor=function(){var t=this,i=t.node._uiProps,n=t._tempColor,r=t._color,s=t.node.parent?t.node.parent._uiProps.opacity:1,e=i.localOpacity*s*r.a/255;if(n.r!==r.r||n.g!==r.g||n.b!==r.b||n.a!==e){i.colorDirty=!0,n.r=r.r,n.g=r.g,n.b=r.b,n.a=e;var h=r.r/255,u=r.g/255,o=r.b/255;this._instance.setColor(h,u,o,e)}},n.setVertexEffectDelegate=function(t){if(this._instance)if(t){var i=null==t?void 0:t.getEffectType();if("jitter"===i){var n=null==t?void 0:t.getJitterVertexEffect();this._instance.setJitterEffect(n)}else if("swirl"===i){var r=null==t?void 0:t.getJitterVertexEffect();this._instance.setSwirlEffect(r)}}else this._instance.clearEffect()},n._ensureListener=function(){this._listener||(this._listener=new Egt,this.xj=Egt.addListener(this._listener),this._instance.setListener(this.xj))},n.setStartListener=function(t){this._ensureListener(),this._listener.start=t},n.setInterruptListener=function(t){this._ensureListener(),this._listener.interrupt=t},n.setEndListener=function(t){this._ensureListener(),this._listener.end=t},n.setDisposeListener=function(t){this._ensureListener(),this._listener.dispose=t},n.setCompleteListener=function(t){this._ensureListener(),this._listener.complete=t},n.setEventListener=function(t){this._ensureListener(),this._listener.event=t},n.setTrackStartListener=function(t,i){Egt.getListeners(t,this._instance).start=i},n.setTrackInterruptListener=function(t,i){Egt.getListeners(t,this._instance).interrupt=i},n.setTrackEndListener=function(t,i){Egt.getListeners(t,this._instance).end=i},n.setTrackDisposeListener=function(t,i){Egt.getListeners(t,this._instance).dispose=i},n.setTrackCompleteListener=function(t,i){Egt.getListeners(t,this._instance).complete=function(t){var n=Math.floor(t.trackTime/t.animationEnd);i(t,n)}},n.setTrackEventListener=function(t,i){Egt.getListeners(t,this._instance).event=i},n.getDebugShapes=function(){return this._instance.getDebugShapes()},n.setSlotTexture=function(t,i,n){if(this.isAnimationCached())X("Cached mode can't change texture of slot");else if(this.findSlot(t)){var r=i.width,s=i.height,e=n||!1;this._instance.resizeSlotRegion(t,r,s,e);var h=i.uuid;h||(h=i.getId()),this._instance.setSlotTexture(t,h),this.Gj||(this.Gj=new Map),this.Gj.set(h,i)}else X("No slot named:"+t)},n.Vj=function(t){t&&this.Lj&&(t.destroySkeleton(this.Lj.assetUUID),this.Lj=null)},n._applyLayer=function(){this.Dj&&(this.Dj.node.layer=this.node.layer)},r(i,[{key:"drawList",get:function(){return this._drawList}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(t){t&&t.resetEnums(),this._skeletonData!==t&&(this.destroyRenderData(),this._skeletonData=t,this.defaultSkin="",this.defaultAnimation="",this._animationName="",this._skinName="",this._updateSkeletonData(),this.Wj())}},{key:"_defaultSkinIndex",get:function(){if(kpt(this.skeletonData)){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var i=t[this.defaultSkin];if(void 0!==i)return i}}return 0},set:function(t){var i;if(kpt(this.skeletonData)&&(i=this.skeletonData.getSkinsEnum()),i){var n=i[t];void 0!==n?(this.defaultSkin=String(n),this.setSkin(this.defaultSkin),this._refreshInspector(),this.vo()):X(this.name+" skin enums are invalid")}else X(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var t=this.animation;if(kpt(this.skeletonData))if(t){var i=this.skeletonData.getAnimsEnum();if(i){var n=i[t];if(void 0!==n)return n}}else this._refreshInspector();return 0},set:function(t){var i;if(kpt(this.skeletonData)&&(i=this.skeletonData.getAnimsEnum()),i){var n=String(i[t]);void 0!==n?(this.animation=n,this.animation=n):X(this.name+" animation enums are invalid")}else X(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode=t,this.setAnimationCacheMode(this._cacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this._instance.setPremultipliedAlpha(t),this.vo())}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){t!==this._timeScale&&(this._timeScale=t,this._instance&&(this._instance.dtRate=1*this._timeScale))}},{key:"useTint",get:function(){return this._useTint},set:function(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint())}},{key:"enableBatch",get:function(){return this._enableBatch},set:function(t){t!==this._enableBatch&&(this._enableBatch=t,this._updateBatch())}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil.init(this)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this.vo())}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this.vo())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this.vo())}},{key:"socketNodes",get:function(){return this._socketNodes}},{key:"animation",get:function(){return this._animationName},set:function(t){t?this.setAnimation(0,t,this.loop):this.clearAnimation(0)}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial(),this.vo()}},{key:"customMaterialInstance",get:function(){if(!this._customMaterial)return null;if(!this.Uj){var t={parent:this._customMaterial,subModelIdx:0,owner:this};this.Uj=new wA(t)}return this.Uj}}]),i}(GB),ypt.SpineSocket=Ipt,ypt.AnimationCacheMode=Apt,ept=uo((spt=ypt).prototype,"_skeletonData",[Co],(function(){return null})),hpt=uo(spt.prototype,"defaultSkin",[Co],(function(){return""})),upt=uo(spt.prototype,"defaultAnimation",[Co],(function(){return""})),opt=uo(spt.prototype,"_premultipliedAlpha",[Co],(function(){return!0})),cpt=uo(spt.prototype,"_timeScale",[Co],(function(){return 1})),apt=uo(spt.prototype,"_preCacheMode",[Co],(function(){return-1})),fpt=uo(spt.prototype,"_cacheMode",[Co],(function(){return 0})),vpt=uo(spt.prototype,"_sockets",[Co],(function(){return[]})),lpt=uo(spt.prototype,"_useTint",[Co],(function(){return!1})),dpt=uo(spt.prototype,"_debugMesh",[Co],(function(){return!1})),wpt=uo(spt.prototype,"_debugBones",[Co],(function(){return!1})),gpt=uo(spt.prototype,"_debugSlots",[Co],(function(){return!1})),ppt=uo(spt.prototype,"_enableBatch",[Co],(function(){return!1})),y(spt.prototype,"skeletonData",[Qgt],Object.getOwnPropertyDescriptor(spt.prototype,"skeletonData"),spt.prototype),y(spt.prototype,"_defaultSkinIndex",[Jgt],Object.getOwnPropertyDescriptor(spt.prototype,"_defaultSkinIndex"),spt.prototype),y(spt.prototype,"_animationIndex",[Zgt],Object.getOwnPropertyDescriptor(spt.prototype,"_animationIndex"),spt.prototype),y(spt.prototype,"defaultCacheMode",[tpt],Object.getOwnPropertyDescriptor(spt.prototype,"defaultCacheMode"),spt.prototype),_pt=uo(spt.prototype,"loop",[Co],(function(){return!0})),y(spt.prototype,"sockets",[ipt],Object.getOwnPropertyDescriptor(spt.prototype,"sockets"),spt.prototype),y(spt.prototype,"customMaterial",[ac,npt],Object.getOwnPropertyDescriptor(spt.prototype,"customMaterial"),spt.prototype),rpt=spt))||rpt);O.internal.SpineSkeleton=Rpt;var Mpt,Cpt,Npt,Ppt,Lpt=function(){function t(){this.name="sp.VertexEffectDelegate",this._vertexEffect=void 0,this.Xj=void 0,this.Yj=void 0,this._vertexEffect=null,this.Xj=null,this.Yj="none"}var i=t.prototype;return i.clear=function(){this._vertexEffect=null,this.Xj=null,this.Yj="none"},i.initJitter=function(t,i){return this.Yj="jitter",this._vertexEffect=new $wt.JitterEffect(t,i),this._vertexEffect},i.initSwirlWithPow=function(t,i){return this.Yj="swirl",this.Xj=new $wt.Pow(i),this._vertexEffect=new $wt.SwirlEffect(t,this.Xj),this._vertexEffect},i.initSwirlWithPowOut=function(t,i){return this.Yj="swirl",this.Xj=new $wt.PowOut(i),this._vertexEffect=new $wt.SwirlEffect(t,this.Xj),this._vertexEffect},i.getJitterVertexEffect=function(){return this._vertexEffect},i.getSwirlVertexEffect=function(){return this._vertexEffect},i.getVertexEffect=function(){return this._vertexEffect},i.getEffectType=function(){return this.Yj},t}(),Dpt=1.1,Bpt=new Qs(0,0,255,255),Fpt=new Qs(255,0,0,255),Upt=new Qs(0,255,0,255),xpt=new Qs(255,255,0,255),Gpt=null,jpt=null,Hpt=!1,Vpt=!1,$pt=zD(jD),zpt=zD(VD),Wpt=new Ir(0,0,0);function Xpt(t,i){var n,r;switch(t){case 1:n=Hpt?1:2,r=1;break;case 2:n=7,r=4;break;case 3:n=Hpt?1:2,r=8;break;default:n=Hpt?1:2,r=4}return i.getMaterialForBlendAndTint(n,r,Vpt?1:0)}var Ypt=function(){function t(){this.vCount=32767}var i=t.prototype;return i.Kj=function(t){var i=t?jpt:Gpt;if(!i){var n=xN.root.device,r=xN.root.batcher2D,s=t?VD:jD;t?(i=jpt=new qD(n,s,this.vCount),r.registerBufferAccessor(Number.parseInt("SPINETINT",36),jpt)):(i=Gpt=new qD(n,s,this.vCount),r.registerBufferAccessor(Number.parseInt("SPINE",36),Gpt))}return i},i.createData=function(t){var i=t.renderData;if(!i){var n=t.useTint||t.isAnimationCached(),r=this.Kj(n);i=aB.add(n?VD:jD,r)}return i},i.updateRenderData=function(t){var i;t._skeleton&&t.node.active&&null!=(i=t.skeletonData)&&i.isValid&&qpt(t)},t}(),Kpt=new Ypt;function qpt(t){t.drawList.reset();var i=t.renderData;if(0!==t.color.a&&i){t._updateColor(),Hpt=t.premultipliedAlpha,Vpt=t.useTint||t.isAnimationCached(),t.isAnimationCached()?Jpt(t):Qpt(t);var n=Vpt?jpt:Gpt;t.syncAttachedNode(),(i.vertexCount>0||i.indexCount>0)&&n.getMeshBuffer(i.chunk.bufferId).setDirty()}}function Qpt(t){var i,n,r=(t.useTint?zpt:$pt)/4,s=t.updateRenderData(),e=s.vCount,h=s.iCount,u=t.renderData;if(!(!u||e<1||h<1)){u.vertexCount===e&&u.indexCount===h||((u.vertexCount<e||u.indexCount<h)&&u.resize(Math.ceil(e*Dpt),Math.ceil(h*Dpt)),u.indices=new Uint16Array(h),t._vLength=4*e*r,t._vBuffer=new Uint8Array(u.chunk.vb.buffer,u.chunk.vb.byteOffset,t._vLength),t._iLength=2*h,t._iBuffer=new Uint8Array(u.indices.buffer));var o=u.chunk.vb,c=s.vPtr,a=s.iPtr,f=u.indices,v=$wt.wasmUtil.wasm.HEAPU8;null==(i=t._vBuffer)||i.set(v.subarray(c,c+t._vLength),0),null==(n=t._iBuffer)||n.set(v.subarray(a,a+t._iLength),0);for(var l=u.chunk.vertexOffset,d=0;d<h;d++)f[d]+=l;for(var w=s.getData(),g=s.getTextures(),p=w.size(),_=0,y=0,m=0;m<p;m+=5){y=w.get(m+3);var b=Xpt(w.get(m+4),t);t.requestDrawData(b,g.get(m/5),_,y),_+=y}if(t.enableBatch)for(var k=t.node.worldMatrix,A=0,E=0;E<e;E++)A=E*r,Wpt.x=o[A],Wpt.y=o[A+1],Wpt.z=0,Wpt.transformMat4(k),o[A]=Wpt.x,o[A+1]=Wpt.y,o[A+2]=Wpt.z;var T=t.Dj,O=t._skeleton;if(T&&(t.debugBones||t.debugSlots||t.debugMesh)){T.clear();for(var S=t.getDebugShapes(),I=S.size(),R=0;R<I;R++){var M=S.get(R);if(0===M.type&&t.debugSlots){T.strokeColor=Bpt;var C=M.vOffset*r,N=M.vCount*r;T.moveTo(o[C],o[C+1]);for(var P=C+r,L=C+N;P<L;P+=r)T.lineTo(o[P],o[P+1]);T.close(),T.stroke()}else if(1===M.type&&t.debugMesh){T.strokeColor=xpt;for(var D=M.iCount,B=M.iOffset,F=B,U=B+D;F<U;F+=3){var x=f[F]*r,G=f[F+1]*r,j=f[F+2]*r;T.moveTo(o[x],o[x+1]),T.lineTo(o[G],o[G+1]),T.lineTo(o[j],o[j+1]),T.close(),T.stroke()}}}if(t.debugBones){T.strokeColor=Fpt,T.fillColor=Bpt;for(var H=0,V=O.bones.length;H<V;H++){var $=O.bones[H],z=$.data.length*$.a+$.worldX,W=$.data.length*$.c+$.worldY;T.moveTo($.worldX,$.worldY),T.lineTo(z,W),T.stroke(),T.circle($.worldX,$.worldY,1.5*Math.PI),T.fill(),0===H&&(T.fillColor=Upt)}}}}}function Jpt(t){var i=t.updateRenderData();if(i){var n=i.vCount,r=i.iCount,s=t.renderData;if(!(!s||n<1||r<1)){s.vertexCount===n&&s.indexCount===r||((s.vertexCount<n||s.indexCount<r)&&s.resize(Math.ceil(n*Dpt),Math.ceil(r*Dpt)),s.indices=new Uint16Array(r));var e=s.chunk.vb,h=new Uint8Array(e.buffer,e.byteOffset,4*e.length);h.set(i.vData);var u=t.color,o=t.node._uiProps.opacity;if(1-o>Fn||4294967295!==Qs.toUint32(u)||Hpt){Mpt=u.r/255,Cpt=u.g/255,Npt=u.b/255,Ppt=o;for(var c=0;c<n;c++){var a=c*zpt+20,f=h[a],v=h[a+1],l=h[a+2],d=h[a+3]*Ppt,w=Hpt?d/255:1;h[a]=Math.floor(w*f*Mpt),h[a+1]=Math.floor(w*v*Cpt),h[a+2]=Math.floor(w*l*Npt),h[a+3]=Math.floor(d),h[a+4]=Math.floor(h[a+4]*Mpt),h[a+5]=Math.floor(h[a+5]*Cpt),h[a+6]=Math.floor(h[a+6]*Npt),h[a+7]=Hpt?255:0}}var g=s.indices;g.set(i.iData);for(var p=s.chunk.vertexOffset,_=0;_<r;_++)g[_]+=p;for(var y=i.meshes,m=y.length,b=0,k=0,A=0;A<m;A++){var E=y[A],T=Xpt(E.blendMode,t),O=E.textureID;k=E.iCount,t.requestDrawData(T,O,b,k),b+=k}var S=zpt/4;if(t.enableBatch)for(var I=t.node.worldMatrix,R=0,M=0;M<n;M++)R=M*S,Wpt.x=e[R],Wpt.y=e[R+1],Wpt.z=0,Wpt.transformMat4(I),e[R]=Wpt.x,e[R+1]=Wpt.y,e[R+2]=Wpt.z}}}O.internal.SpineAssembler=Kpt;var Zpt={getAssembler:function(){return Kpt}};Rpt.Assembler=Zpt;var t_t={REGION:0,BOUNDING_BOX:1,MESH:2,SKINNED_MESH:3};bi(t_t);var i_t,n_t={START:0,INTERRUPT:1,END:2,COMPLETE:3,DISPOSE:4,EVENT:5};function r_t(){return i_t||(i_t=Promise.resolve().then((function(){return Promise.resolve().then((function(){return Promise.all([i.import("./spine.wasm-C7yhiRHi.js"),i.import("./spine-BGFFnNyc.js")]).then((function(t){return i=t[0].default,n=t[1].default,new Promise((function(t,r){var s=function(t){return"[Spine]: Spine wasm load failed: "+t};i({instantiateWasm:function(t,i){bP(n,t).then((function(t){i(t.instance,t.module)})).catch((function(t){return r(s(t))}))}}).then((function(t){ygt=t,mgt.forEach((function(t){t(ygt)}))})).then(t).catch((function(t){return r(s(t))}))}));var i,n}))})).catch((function(t){X(t)}))})),i_t)}bi(n_t),t("eq",Object.freeze({__proto__:null,ATTACHMENT_TYPE:t_t,AnimationCacheMode:Ept,AnimationEventType:n_t,DefaultAnimsEnum:Spt,DefaultSkinsEnum:Tpt,SPINE_VERSION:"3.8",Skeleton:Rpt,SkeletonData:Hgt,SpineAnimationCacheMode:Apt,SpineDefaultAnimsEnum:Opt,SpineMaterialType:{COLORED_TEXTURED:0,TWO_COLORED:1},SpineSocket:Ipt,VertexEffectDelegate:Lpt,isBinaryCompatible:function(){return!1},isJsonCompatible:function(){return!1},loadWasmModuleSpine:r_t,simpleSpineAssembler:Zpt,spine:$wt,timeScale:1}));var s_t=new Ir,e_t=new Ir;function h_t(t,i){var n=null;return{value:i.length>0?i[i.length-1]:Ir.ZERO,progress:function(t,i,r,s){return n.getPoint(s)},clone:function(t){return Ir.clone(t)},add:function(t,i){return t.clone().add(i)},sub:function(t,i){return t.clone().subtract(i)},onStart:function(r){var s=r.start,e=r.end,h=r.relative,u=r.reversed;(n=Hf.create(t)).addKnot(s);var o=null;h&&u&&(o=e_t,Ir.subtract(o,s,i[i.length-1]));for(var c=0,a=i.length;c<a;++c){var f=u?i[a-1-c]:i[c];h?u?c>0&&n.addKnot(Ir.copy(s_t,o).add(f)):n.addKnot(Ir.copy(s_t,s).add(f)):n.addKnot(f)}h&&u&&n.addKnot(e)},onComplete:function(){n=null},onStop:function(){n=null},legacyProgress:!1}}var u_t=Object.freeze({__proto__:null,bezier:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return h_t(1,i)},catmullRom:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return h_t(2,i)}});t("es",u_t);var o_t=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},c_t=function(){function t(){this.qj=new Map,this.Qj=[],this.Yi=void 0,this.Jj=[]}var i=t.prototype;return i.Zj=function(t,i){var n=this.Jj.pop();return n||(n=new o_t),n.target=t,n.paused=!!i,n},i.tH=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this.Jj.push(t)},i.iH=function(t,i){i?this.resumeTarget(t):this.pauseTarget(t)},i.nH=function(t){this.rH(t,!1)},i.sH=function(t){t.isValid&&(t.on("active-changed",this.iH,this),t.on("node-destroyed",this.nH,this))},i.eH=function(t){t.isValid&&(t.off("active-changed",this.iH,this),t.off("node-destroyed",this.nH,this))},i.addAction=function(t,i,n,r){if(void 0===r&&(r=!0),t&&i){var s=this.qj.get(i);s?s.actions||(s.actions=[]):(s=this.Zj(i,n),this.qj.set(i,s),this.Qj.push(s)),r&&0===s.actions.length&&i instanceof WE&&(this.sH(i),i.active||(s.paused=!0)),s.target=i,s.actions.push(t),t.startWithTarget(i)}else ht(1e3)},i.removeAllActions=function(){for(var t=this.Qj,i=0;i<t.length;i++){var n=t[i];n&&(n.target instanceof WE&&this.eH(n.target),this.tH(n))}this.Qj.length=0,this.qj=new Map},i.removeAllActionsFromTarget=function(t){this.rH(t,!0)},i.rH=function(t,i){if(null!=t){var n=this.qj.get(t);n&&(i&&t instanceof WE&&this.eH(t),n.actions.length=0,this.hH(n))}},i.removeAction=function(t){if(null!=t){var i=t.getOriginalTarget(),n=this.qj.get(i);if(n)for(var r=0;r<n.actions.length;r++)if(n.actions[r]===t){n.actions.splice(r,1),n.actionIndex>=r&&n.actionIndex--;break}}},i._removeActionByTag=function(t,i,n){for(var r=0,s=i.actions.length;r<s;++r){var e=i.actions[r];if(e&&e.getTag()===t){if(n&&e.getOriginalTarget()!==n)continue;this.uH(r,i);break}}},i._removeAllActionsByTag=function(t,i,n){for(var r=i.actions.length-1;r>=0;--r){var s=i.actions[r];if(s&&s.getTag()===t){if(n&&s.getOriginalTarget()!==n)continue;this.uH(r,i)}}},i.removeActionByTag=function(t,i){var n=this;-1===t&&tt(1002);var r=this.qj;if(i){var s=r.get(i);s&&this._removeActionByTag(t,s,i)}else r.forEach((function(i){n._removeActionByTag(t,i)}))},i.removeAllActionsByTag=function(t,i){var n=this;-1===t&&tt(1002);var r=this.qj;if(i){var s=r.get(i);s&&this._removeAllActionsByTag(t,s,i)}else r.forEach((function(i){n._removeAllActionsByTag(t,i)}))},i.getActionByTag=function(t,i){-1===t&&tt(1004);var n=this.qj.get(i);if(n){if(null!=n.actions)for(var r=0;r<n.actions.length;++r){var s=n.actions[r];if(s&&s.getTag()===t)return s}tt(1005,t)}return null},i.getNumberOfRunningActionsInTarget=function(t){var i=this.qj.get(t);return i&&i.actions?i.actions.length:0},i.pauseTarget=function(t){var i=this.qj.get(t);i&&(i.paused=!0)},i.resumeTarget=function(t){var i=this.qj.get(t);i&&(i.paused=!1)},i.pauseAllRunningActions=function(){for(var t=[],i=this.Qj,n=0;n<i.length;n++){var r=i[n];r&&!r.paused&&(r.paused=!0,r.target&&t.push(r.target))}return t},i.resumeTargets=function(t){if(t)for(var i=0;i<t.length;i++)t[i]&&this.resumeTarget(t[i])},i.pauseTargets=function(t){if(t)for(var i=0;i<t.length;i++)t[i]&&this.pauseTarget(t[i])},i.isActionRunning=function(t){var i=this.qj.get(t.getOriginalTarget()),n=-1;return i&&(n=i.actions.indexOf(t)),-1!==n},i.uH=function(t,i){i.actions.splice(t,1),i.actionIndex>=t&&i.actionIndex--,0===i.actions.length&&(i.target instanceof WE&&this.eH(i.target),this.hH(i))},i.hH=function(t){var i=!1;if(t&&!t.lock&&this.qj.get(t.target)){this.qj.delete(t.target);for(var n=this.Qj,r=0,s=n.length;r<s;r++)if(n[r]===t){n.splice(r,1);break}this.tH(t),i=!0}return i},i.update=function(t){for(var i,n=this.Qj,r=0;r<n.length;r++){this.Yi=n[r];var s=(i=this.Yi).target;if(!Ke(s)||s.isValid){if(!i.paused&&i.actions){for(i.lock=!0,i.actionIndex=0;i.actionIndex<i.actions.length;i.actionIndex++)if(i.currentAction=i.actions[i.actionIndex],i.currentAction){if(i.currentAction.step(t),i.currentAction&&i.currentAction.isDone()){i.currentAction.stop();var e=i.currentAction;i.currentAction=null,this.removeAction(e)}i.currentAction=null}i.lock=!1}0===i.actions.length&&(s instanceof WE&&this.eH(s),this.hH(i)&&r--)}else this.removeAllActionsFromTarget(s),r--}},t}(),a_t=t("et",function(t){function i(){var i;return(i=t.call(this)||this).oH=new c_t,i}return e(i,t),i.prototype.update=function(t){this.oH.update(t)},r(i,[{key:"ActionManager",get:function(){return this.oH}}]),i}(_v));a_t.ID="TWEEN",a_t.instance=void 0,xN.on("director_init",(function(){var t=new a_t;a_t.instance=t,xN.registerSystem(a_t.ID,t,100)}));var f_t=function(t){function i(){var i;return(i=t.call(this)||this)._duration=0,i}e(i,t);var n=i.prototype;return n.getDurationScaled=function(){return this._duration},n.getDuration=function(){return this._duration},n.setDuration=function(t){this._duration=t},i}(function(){function t(){this.originalTarget=null,this.target=null,this.Yh=null,this.tag=-1,this._id=void 0,this._paused=!1}var i=t.prototype;return i.isDone=function(){return!0},i.startWithTarget=function(t){this.originalTarget=t,this.target=t},i.stop=function(){this.target=null},i.getTarget=function(){return this.target},i.setTarget=function(t){this.target=t},i.getOriginalTarget=function(){return this.originalTarget},i.setOriginalTarget=function(t){this.originalTarget=t},i.aH=function(){var t,i=null==(t=this.Yh)?void 0:t.getTarget();return null!=i?i:this.target},i.getTag=function(){return this.tag},i.setTag=function(t){this.tag=t},i.setId=function(t){this._id=t},i.getId=function(){return this._id},i.setPaused=function(t){this._paused=t},t}()),v_t=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.isDone=function(){return!0},n.step=function(){this.update(1)},n.update=function(){},n.reverse=function(){return this.clone()},n.isUnknownDuration=function(){return!1},i}(f_t),l_t=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.update=function(){var t=this.aH();if(t)for(var i=t.getComponentsInChildren(EB),n=0;n<i.length;++n)i[n].enabled=!0},n.reverse=function(){return new d_t},n.clone=function(){var t=new i;return t._id=this._id,t},n.toString=function(){return"<Show>"},i}(v_t),d_t=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.update=function(){var t=this.aH();if(t)for(var i=t.getComponentsInChildren(EB),n=0;n<i.length;++n)i[n].enabled=!1},n.reverse=function(){return new l_t},n.clone=function(){var t=new i;return t._id=this._id,t},n.toString=function(){return"<Hide>"},i}(v_t);!function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;n.update=function(){var t=this.aH();if(t)for(var i=t.getComponentsInChildren(EB),n=0;n<i.length;++n){var r=i[n];r.enabled=!r.enabled}},n.reverse=function(){return new i},n.clone=function(){var t=new i;return t._id=this._id,t},n.toString=function(){return"<ToggleVisibility>"}}(v_t);var w_t=function(t){function i(i){var n;return(n=t.call(this)||this)._isNeedCleanUp=!0,void 0!==i&&n.init(i),n}e(i,t);var n=i.prototype;return n.update=function(){var t=this.aH();t&&(t.removeFromParent(),this._isNeedCleanUp&&t.destroy())},n.init=function(t){return this._isNeedCleanUp=t,!0},n.reverse=function(){return new i(this._isNeedCleanUp)},n.clone=function(){var t=new i(this._isNeedCleanUp);return t._id=this._id,t},n.toString=function(){return"<RemoveSelf>"},i}(v_t);function g_t(t){return new w_t(t)}var p_t=function(t){function i(i,n,r){var s;return(s=t.call(this)||this).fH=void 0,s.Ni=void 0,s.M=void 0,s.initWithFunction(i,n,r),s}e(i,t);var n=i.prototype;return n.initWithFunction=function(t,i,n){return t&&(this.Ni=t),i&&(this.fH=i),void 0!==n&&(this.M=n),!0},n.execute=function(){if(this.Ni){var t=this.aH();this.Ni.call(this.fH,t,this.M)}},n.update=function(){this.execute()},n.getTargetCallback=function(){return this.fH},n.setTargetCallback=function(t){t!==this.fH&&(this.fH=t)},n.clone=function(){var t=new i;return t._id=this._id,this.Ni&&t.initWithFunction(this.Ni,this.fH,this.M),t},n.toString=function(){return"<CallFunc>"},i}(v_t);function __t(t,i,n){return new p_t(t,i,n)}var y_t=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.clone=function(){return new i},n.reverse=function(){return this.clone()},n.update=function(){},n.step=function(){},n.isUnknownDuration=function(){return!1},n.toString=function(){return"DummyAction"},i}(f_t),m_t=function(t){function i(i){var n;return(n=t.call(this)||this).MAX_VALUE=2,n._elapsed=0,n._startTime=0,n._firstTick=!1,n._speed=1,void 0===i||Number.isNaN(i)||n.initWithDuration(i),n}e(i,t);var n=i.prototype;return n.setStartTime=function(t){t=t<0?0:t>this._duration?this._duration:t,this._startTime=t},n.getElapsed=function(){return this._elapsed},n.initWithDuration=function(t){return this._duration=0===t?Si.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},n.isDone=function(){return this._elapsed>=this._duration&&!this.isUnknownDuration()},n.vH=function(t){t._speed=this._speed},n.step=function(t){if(!this._paused&&0!==this._speed){t*=this._speed,this._firstTick?this._elapsed=this._startTime:this._elapsed+=t;var i=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);i=i<1?i:1,this.update(i>0?i:0),this.isUnknownDuration()&&!this._firstTick&&(i<1?this._elapsed-=t:this._elapsed=this._startTime+this._duration),this._firstTick&&(this._firstTick=!1,this._startTime>0&&(this._startTime=0))}},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),this._elapsed=0,this._firstTick=!0},n.getSpeed=function(){return this._speed},n.setSpeed=function(t){this._speed=t},n.getDurationScaled=function(){return this._duration/this._speed},i}(f_t);function b_t(t,i){var n=new k_t;return n.initWithTwoActions(t,i),n}var k_t=function(t){function i(i){var n;if((n=t.call(this)||this).lH=[],n.dH=0,n.wH=0,n.gH=!1,!i||0===i.length)return v(n);1===i.length&&i.push(new y_t);var r=i.length-1;if(r>=0&&null==i[r]&&tt(1015),r>=0){for(var s=i[0],e=1;e<r;e++)i[e]&&(s=b_t(s,i[e]));n.initWithTwoActions(s,i[r])}return n}e(i,t);var n=i.prototype;return n.initWithTwoActions=function(t,i){if(!t||!i)return ht(1025),!1;var n=t.getDurationScaled()+i.getDurationScaled();return this.initWithDuration(n),this.lH[0]=t,this.lH[1]=i,!0},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.vH(t),t.initWithTwoActions(this.lH[0].clone(),this.lH[1].clone()),t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),0!==this.lH.length&&(this.dH=this.lH[0].getDurationScaled()/this._duration,this.wH=-1)},n.stop=function(){0!==this.lH.length&&(-1!==this.wH&&this.lH[this.wH].stop(),t.prototype.stop.call(this))},n.update=function(t){var i=this.lH;if(0!==i.length){var n=0,r=0,s=this.dH,e=this.wH;if(t<s){if(n=0!==s?t/s:1,0===r&&1===e&&this.gH){var h=i[1];if(h.update(0),h.isUnknownDuration())return;h.stop()}}else{var u=i[0];if(r=1,n=1===s?1:(t-s)/(1-s),-1===e){if(u.startWithTarget(this.target),u.update(1),u.isUnknownDuration())return;u.stop()}if(0===e){if(u.update(1),u.isUnknownDuration())return;u.stop()}}var o=i[r];e===r&&o.isDone()||(e!==r&&o.startWithTarget(this.target),o.update(n>1?n%1:n),this.wH=r)}},n.reverse=function(){var t=b_t(this.lH[1].reverse(),this.lH[0].reverse());return this.vH(t),t.gH=!0,t},n.pH=function(t){if(!(this.lH.length<2)){var n=this.lH[0],r=this.lH[1];r.Yh||(r.Yh=t),n instanceof i||n instanceof R_t?n.pH(t):n.Yh||(n.Yh=t)}},n._H=function(t){for(var n=0,r=this.lH.length;n<r;++n){var s=this.lH[n];if(s.getId()===t)return s;if((s instanceof i||s instanceof R_t)&&(s=s._H(t))&&s.getId()===t)return s}return null},n.isUnknownDuration=function(){if(0===this.lH.length)return!1;var t=this.lH[0],i=this.lH[1];return this.wH<1?t.isUnknownDuration():i.isUnknownDuration()},n.toString=function(){return"<Sequence>"},i}(m_t);function A_t(t){return new k_t(t)}var E_t=function(t){function i(i,n){var r;return(r=t.call(this)||this).gE=0,r.yH=0,r.mH=0,r.bH=!1,r.kH=null,r.initWithAction(i,n),r}e(i,t);var n=i.prototype;return n.initWithAction=function(t,i){if(!t||void 0===i)return!1;var n=t.getDurationScaled()*i;return!!this.initWithDuration(n)&&(this.gE=i,this.kH=t,t instanceof v_t&&(this.bH=!0,this.gE-=1),this.yH=0,!0)},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.vH(t),this.kH&&t.initWithAction(this.kH.clone(),this.gE),t},n.startWithTarget=function(i){this.yH=0,this.mH=(this.kH?this.kH.getDurationScaled():0)/this._duration,t.prototype.startWithTarget.call(this,i),this.kH&&this.kH.startWithTarget(i)},n.stop=function(){this.kH&&this.kH.stop(),t.prototype.stop.call(this)},n.update=function(t){var i=this.kH,n=this._duration,r=this.gE,s=this.mH;if(i)if(t>=s){for(;t>s&&this.yH<r;){if(i.update(1),i.isUnknownDuration())return;this.yH++,i.stop(),i.startWithTarget(this.target),s+=i.getDurationScaled()/n,this.mH=s>1?1:s}if(t>=1&&this.yH<r){if(i.update(1),i.isUnknownDuration())return;this.yH++}this.bH||(this.yH===r?i.stop():i.update(t-(s-i.getDurationScaled()/n)))}else i.update(t*r%1)},n.isDone=function(){return this.yH===this.gE},n.reverse=function(){var t=new i(this.kH?this.kH.reverse():void 0,this.gE);return this.vH(t),t},n.setInnerAction=function(t){this.kH!==t&&(this.kH=t)},n.getInnerAction=function(){return this.kH},n.isUnknownDuration=function(){return!!this.kH&&this.kH.isUnknownDuration()},n.toString=function(){return"<Repeat>"},i}(m_t);function T_t(t,i){return new E_t(t,i)}var O_t=function(t){function i(i){var n;return(n=t.call(this)||this).kH=null,i&&n.initWithAction(i),n}e(i,t);var n=i.prototype;return n.initWithAction=function(t){return t?(this.kH=t,this._duration=1/0,!0):(ht(1026),!1)},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.vH(t),this.kH&&t.initWithAction(this.kH.clone()),t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),this.kH&&this.kH.startWithTarget(i)},n.stop=function(){this.kH&&this.kH.stop(),t.prototype.stop.call(this)},n.step=function(t){if(!this._paused&&0!==this._speed){var i=this.kH;i&&(t*=this._speed,i.step(t),i.isDone()&&(i.startWithTarget(this.target),i.step(i.getElapsed()-i.getDurationScaled())))}},n.update=function(){tt(1007)},n.isDone=function(){return!1},n.reverse=function(){if(this.kH){var t=new i(this.kH.reverse());return this.vH(t),t}return this},n.setInnerAction=function(t){this.kH!==t&&(this.kH=t)},n.getInnerAction=function(){return this.kH},n.isUnknownDuration=function(){return!!this.kH&&this.kH.isUnknownDuration()},n.toString=function(){return"<RepeatForever>"},i}(m_t);function S_t(t){return new O_t(t)}function I_t(t,i){var n=new R_t;return n.initWithTwoActions(t,i),n}var R_t=function(t){function i(i){var n;if((n=t.call(this)||this).AH=null,n.EH=null,n.TH=!1,!i||0===i.length)return v(n);1===i.length&&i.push(new y_t);var r=i.length-1;if(r>=0&&null==i[r]&&tt(1015),r>=0){for(var s=i[0],e=1;e<r;e++)i[e]&&(s=I_t(s,i[e]));n.initWithTwoActions(s,i[r])}return n}e(i,t);var n=i.prototype;return n.initWithTwoActions=function(t,i){if(!t||!i)return ht(1027),!1;var n=!1,r=t.getDurationScaled(),s=i.getDurationScaled();return this.initWithDuration(Math.max(r,s))&&(this.AH=t,this.EH=i,r>s?this.EH=b_t(i,C_t(r-s)):r<s&&(this.AH=b_t(t,C_t(s-r))),n=!0),n},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.vH(t),this.AH&&this.EH&&t.initWithTwoActions(this.AH.clone(),this.EH.clone()),t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),this.AH&&this.AH.startWithTarget(i),this.EH&&this.EH.startWithTarget(i)},n.stop=function(){this.AH&&this.AH.stop(),this.EH&&this.EH.stop(),t.prototype.stop.call(this)},n.update=function(t){this.AH&&(this.TH&&!this.AH.isUnknownDuration()||this.AH.update(t)),this.EH&&(this.TH&&!this.EH.isUnknownDuration()||this.EH.update(t)),this.TH=1===t},n.reverse=function(){if(this.AH&&this.EH){var t=I_t(this.AH.reverse(),this.EH.reverse());return this.vH(t),t}return this},n.pH=function(t){if(this.AH&&this.EH){this.EH.Yh||(this.EH.Yh=t);var n=this.AH;n instanceof i||n instanceof k_t?n.pH(t):n.Yh||(n.Yh=t)}},n._H=function(t){var n=this.AH,r=this.EH,s=null,e=function(n){if(n.getId()===t)return n;if(n instanceof k_t||n instanceof i){var r=n._H(t);if(r)return r}return null};return n&&(s=e(n))||r&&(s=e(r))?s:null},n.isUnknownDuration=function(){var t=this.AH,i=this.EH;if(null==t||null==i)return!1;var n=t.isUnknownDuration(),r=i.isUnknownDuration();if(n||r){if(n&&r)return!0;if(this.TH)return!0}return!1},n.toString=function(){return"<Spawn>"},i}(m_t),M_t=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.update=function(){},n.reverse=function(){var t=new i(this._duration);return this.vH(t),t},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.vH(t),t.initWithDuration(this._duration),t},n.isUnknownDuration=function(){return!1},n.toString=function(){return"<DelayTime>"},i}(m_t);function C_t(t){return new M_t(t)}var N_t=function(t){function i(i){var n;return(n=t.call(this)||this).OH=null,i&&n.initWithAction(i),n}e(i,t);var n=i.prototype;return n.initWithAction=function(i){return i?i===this.OH?(ht(1029),!1):!!t.prototype.initWithDuration.call(this,i.getDurationScaled())&&(this.OH=i,!0):(ht(1028),!1)},n.clone=function(){var t=new i;return t._id=this._id,t._speed=this._speed,this.vH(t),this.OH&&t.initWithAction(this.OH.clone()),t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i),this.OH&&this.OH.startWithTarget(i)},n.update=function(t){this.OH&&this.OH.update(1-t)},n.reverse=function(){return this.OH?this.OH.clone():this},n.stop=function(){this.OH&&this.OH.stop(),t.prototype.stop.call(this)},n.isUnknownDuration=function(){return!1},n.toString=function(){return"<ReverseTime>"},i}(m_t);function P_t(t){return new N_t(t)}var L_t=function(t){function i(i,n,r){var s;return(s=t.call(this,i)||this).IH=n,s.RH=r,s}e(i,t);var n=i.prototype;return n.clone=function(){return new i(this._duration,this.IH,this.RH)},n.update=function(t){this.IH.apply(this,[this.target,t].concat(this.RH))},n.reverse=function(){return this.clone()},n.isUnknownDuration=function(){return!1},n.toString=function(){return"<ActionCustomUpdate>"},i}(m_t),D_t=function(t){function i(i,n){var r;return(r=t.call(this)||this).TH=!1,r.IH=i,r.RH=n,r}e(i,t);var n=i.prototype;return n.clone=function(){return new i(this.IH,this.RH)},n.reverse=function(){return this.clone()},n.step=function(){throw new Error("should never go here")},n.update=function(){var t=T.game.deltaTime;this.TH=this.IH.apply(this,[this.target,t].concat(this.RH))},n.isDone=function(){return this.TH},n.isUnknownDuration=function(){return!this.isDone()},n.toString=function(){return"<ActionUnknownDuration>"},i}(f_t);function B_t(t){var i=t.charAt(0);if(/[A-Z]/.test(i)){var n=(t=t.replace(i,i.toLowerCase())).split("-");if(2===n.length){var r=n[0];if("linear"===r)t="linear";else{var s=n[1];switch(r){case"quadratic":t="quad"+s;break;case"quartic":t="quart"+s;break;case"quintic":t="quint"+s;break;case"sinusoidal":t="sine"+s;break;case"exponential":t="expo"+s;break;case"circular":t="circ"+s;break;default:t=r+s}}}}return t}function F_t(t){var i=" [Tween:] ",n=" option is not support in v + "+S,r=t;r.delay&&W(i+"delay"+n),r.repeat&&W(i+"repeat"+n),r.repeatDelay&&W(i+"repeatDelay"+n),r.interpolation&&W(i+"interpolation"+n),r.onStop&&W(i+"onStop"+n)}var U_t=t("eu",function(t){function i(i,n,r){var s;if((s=t.call(this)||this).gH=!1,null==r)r=Object.create(null);else if(F_t(r),r.easing&&"string"==typeof r.easing&&(r.easing=B_t(r.easing)),r.progress||(r.progress=s.progress),r.easing&&"string"==typeof r.easing){var e=r.easing;r.easing=fa[e],r.easing||st(1031,e)}for(var h in s.MH=r,s.CH=Object.create(null),n){var u;if(n.hasOwnProperty(h)){var o=n[h];if("function"==typeof o)o=o();else if(null==o)continue;var c=void 0,a=void 0,f=void 0;void 0!==o.value?("function"==typeof(f=o.value)&&(f=f()),void 0!==o.easing&&("string"==typeof o.easing?(c=fa[o.easing])||st(1031,o.easing):c=o.easing),void 0!==o.progress&&(a=o.progress)):f=o;var v=Object.create(null);v.start=v.current=v.end=null,v.keys=null,v.value=f,v.easing=c,v.progress=a,v.convert=o.convert,v.clone=o.clone,v.add=o.add,v.sub=o.sub,v.legacyProgress=null===(u=o.legacyProgress)||void 0===u||u,v.toFixed=o.toFixed,v.onStart=o.onStart,v.onStop=o.onStop,v.onComplete=o.onComplete,v.valid=!0,s.CH[h]=v}}return s.NH=n,s.initWithDuration(i),s}e(i,t);var n=i.prototype;return n.clone=function(){var t=new i(this._duration,this.NH,this.MH);return t.gH=this.gH,t.Yh=this.Yh,t._id=this._id,this.vH(t),t},n.reverse=function(){if(!this.MH.relative)return st(16382),new i(0,{});var t=new i(this._duration,this.NH,this.MH);return this.vH(t),t.gH=!this.gH,t.Yh=this.Yh,t},n.startWithTarget=function(i){t.prototype.startWithTarget.call(this,i);var n=this.aH();if(n){var r=!!this.MH.relative,s=this.CH,e=this.gH,h=function(){var t=n[u];if(void 0===t)return 0;var i=s[u],h=i.value;if("number"==typeof t)i.start=t,i.current=t,i.end=r?e?t-h:t+h:h;else if("object"==typeof t)if(i.legacyProgress){if(null==i.start){var o=t.constructor;i.start=new o,i.current=new o,i.end=new o}var c;c=h.getModifiableProperties?h.getModifiableProperties():Object.keys(h),i.keys=c;for(var a=0,f=c.length;a<f;++a){var v=c[a];isNaN(t[v])||(i.start[v]=t[v],i.current[v]=t[v],i.end[v]=r?e?t[v]-h[v]:t[v]+h[v]:h[v])}}else{var l=i.clone;if(!l)return st(16383,u),i.valid=!1,0;var d=i.add,w=i.sub;if(r&&(d||(st(16384,u),i.valid=!1),e&&!w&&(st(16385,u),i.valid=!1),!i.valid))return 0;i.start=l(t),i.current=l(t),i.end=r?e?w(t,h):d(t,h):l(h)}else if("string"==typeof t){var g=i.convert,p=function(t){if("number"==typeof t)return t;var i=t;return g&&(i=g(t)),"number"!=typeof i&&(i=Number(i),Number.isNaN(i))?(st(16386,""+t),null):i},_=p(h),y=p(t);if(null==_||null==y)return i.valid=!1,0;i.start=y,i.current=t,i.end=r?e?y-_:y+_:_}i.onStart&&i.onStart({relative:r,reversed:e,start:i.start,end:i.end})};for(var u in s)h();this.MH.onStart&&this.MH.onStart(n)}},n.stop=function(){var i=this.CH;for(var n in i){var r=i[n];r.valid&&r.onStop&&r.onStop()}t.prototype.stop.call(this)},n.update=function(t){var i=this.aH();if(i&&this.MH){var n=this.CH,r=this.MH,s=t;"function"==typeof r.easing&&(s=r.easing(t));var e=r.progress;for(var h in n){var u=n[h];if(u.valid){var o=u.easing?u.easing(t):s,c=u.progress?u.progress:e,a=u.start,f=u.end,v=u.current;if("number"==typeof v)u.current=c(a,f,u.current,o);else if("object"==typeof a)if(u.legacyProgress)for(var l=u.keys,d=0,w=l.length;d<w;++d){var g=l[d];u.current[g]=c(a[g],f[g],u.current[g],o)}else u.current=c(a,f,u.current,o);else if("string"==typeof v){var p,_=c(a,f,u.current,o);if("number"==typeof _)_=_.toFixed(null!==(p=u.toFixed)&&void 0!==p?p:0);else if("string"!=typeof _){st(16387);continue}u.current=_}i[h]=u.current,1===t&&u.onComplete&&u.onComplete()}}r.onUpdate&&r.onUpdate(i,t),1===t&&r.onComplete&&r.onComplete(i)}},n.progress=function(t,i,n,r){return t+(i-t)*r},n.isUnknownDuration=function(){return!1},r(i,[{key:"relative",get:function(){return!!this.MH.relative}}]),i}(m_t)),x_t=function(t){function i(i){var n;return(n=t.call(this)||this).CH=void 0,n.CH={},i&&n.init(i),n}e(i,t);var n=i.prototype;return n.init=function(t){for(var i in t)this.CH[i]=t[i];return!0},n.update=function(){var t=this.CH,i=this.aH();for(var n in t)i[n]=t[n]},n.clone=function(){var t=new i;return t._id=this._id,t.init(this.CH),t},n.isUnknownDuration=function(){return!1},i}(v_t);function G_t(){return a_t.instance.ActionManager}var j_t,H_t,V_t,$_t,z_t,W_t,X_t,Y_t,K_t,q_t,Q_t,J_t,Z_t,tyt,iyt,nyt,ryt,syt,eyt,hyt,uyt,oyt,cyt,ayt,fyt,vyt,lyt,dyt=t("ev",function(){function t(t){this.lH=[],this.PH=null,this.Ci=null,this.LH=-1,this.Hi=1,this.DH=!0,this.Ci=void 0===t?null:t}var i=t.prototype;return i.bindNodeState=function(t){return this.DH=t,this},i.tag=function(t){return this.LH=t,this},i.id=function(t){function i(i){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(t){return this.lH.length>0&&this.lH[this.lH.length-1].setId(t),this})),i.then=function(t){var i=t.BH(!0);return i&&(i.setSpeed(t.Hi),this.lH.push(i)),this},i.reverse=function(i,n){if(null==i&&null==n)return this.FH();var r,s;if(i instanceof t?(r=i,void 0!==n&&(s=n)):"number"==typeof i&&(r=this,s=i),r){var e=t.UH(r,s);e&&this.lH.push(e)}return this},i.FH=function(){if(0===this.lH.length)return st(16388),this.clone(this.Ci);var t=this.BH(!1),i=wyt(this.Ci);return i.Hi=this.Hi,t&&i.xH(t.reverse()),i},t.UH=function(t,i){var n=t.lH;if(0===n.length)return null;var r=null,s=null;return"number"==typeof i?r=t._H(i,n):t&&(r=t.BH(!1)),r?(s=r.reverse()).Yh=t:st(16391,""+i),s},i._H=function(t,i){for(var n=null,r=0,s=i.length;r<s;++r){if((n=i[r]).getId()===t)return n;if((n instanceof k_t||n instanceof R_t)&&(n=n._H(t)))return n}return null},i.xH=function(t){var i=t.clone();return this.GH(i),this.lH.push(i),this},i.GH=function(t){t&&(t instanceof k_t||t instanceof R_t?t.pH(this):t.Yh||(t.Yh=this))},i.target=function(t){function i(i){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(t){return this.Ci=t,this})),i.getTarget=function(){return this.Ci},i.start=function(t){if(void 0===t&&(t=0),!this.Ci)return st(16392),this;this.PH&&G_t().removeAction(this.PH);var i=this.jH();return this.PH=i,i?(i.setTag(this.LH),i.setSpeed(this.Hi),i.setStartTime(t),i.setPaused(!1),G_t().addAction(i,this.Ci,!1,this.DH)):st(16393),this},i.stop=function(){return this.PH&&(this.PH.stop(),G_t().removeAction(this.PH),this.PH=null),this},i.pause=function(){return this.PH?this.PH.setPaused(!0):st(16389),this},i.resume=function(){return this.PH?this.PH.setPaused(!1):st(16390),this},i.clone=function(t){var i=this.BH(!1),n=wyt(null!=t?t:this.Ci);return n.Hi=this.Hi,i?n.xH(i):n},i.union=function(t){var i,n=this;if(void 0===t)return i=n.BH(!1),n.lH.length=0,i&&n.lH.push(i),this;var r=this.lH,s=r.findIndex((function(i){return i.getId()===t}));if(r.length>1){var e=r.splice(s);1===e.length?r.push(e[0]):r.push(A_t(e))}return this},i.to=function(t,i,n){var r=n||Object.create(null);r.relative=!1;var s=new U_t(t,i,r);return this.lH.push(s),this},i.by=function(t,i,n){var r=n||Object.create(null);r.relative=!0;var s=new U_t(t,i,r);return this.lH.push(s),this},i.update=function(t,i){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];var e=new L_t(t,i,r);return this.lH.push(e),this},i.updateUntil=function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var s=new D_t(t,n);return this.lH.push(s),this},i.set=function(t){var i=new x_t(t);return this.lH.push(i),this},i.delay=function(t){var i=C_t(t);return this.lH.push(i),this},i.call=function(t,i,n){var r=__t(t,i,n);return this.lH.push(r),this},i.sequence=function(){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];var s=t.HH(n);return s&&this.lH.push(s),this},i.parallel=function(){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];var s=t.VH(n);return s&&this.lH.push(s),this},i.timeScale=function(t){return this.Hi=t,this.PH&&this.PH.setSpeed(t),this},i.getTimeScale=function(){return this.Hi},i.repeat=function(i,n){if(i===1/0)return this.repeatForever(n);var r,s=this.lH;return(r=n instanceof t?n.BH(!1):s.pop())&&s.push(T_t(r,i)),this},i.repeatForever=function(i){var n,r=this.lH;return(n=i instanceof t?i.BH(!1):r.pop())&&0!==r.length?r.push(T_t(n,Number.MAX_SAFE_INTEGER)):n instanceof m_t?r.push(S_t(n)):st(16394),this},i.reverseTime=function(i){var n,r=this.lH;return(n=i instanceof t?i.BH(!1):r.pop())instanceof m_t?r.push(P_t(n)):st(16395),this},i.hide=function(){if(this.Ci instanceof WE){var t=new d_t;this.lH.push(t)}return this},i.show=function(){if(this.Ci instanceof WE){var t=new l_t;this.lH.push(t)}return this},i.removeSelf=function(){if(this.Ci instanceof WE){var t=g_t(!1);this.lH.push(t)}return this},i.destroySelf=function(){if(this.Ci instanceof WE){var t=g_t(!0);this.lH.push(t)}return this},t.getRunningCount=function(t){return G_t().getNumberOfRunningActionsInTarget(t)},t.stopAll=function(){G_t().removeAllActions()},t.stopAllByTag=function(t,i){G_t().removeAllActionsByTag(t,i)},t.stopAllByTarget=function(t){G_t().removeAllActionsFromTarget(t)},t.pauseAllByTarget=function(t){G_t().pauseTarget(t)},t.resumeAllByTarget=function(t){G_t().resumeTarget(t)},i.BH=function(t){var i=this.lH;if(0===i.length)return null;var n=A_t(i);return t&&this.GH(n),n},i.jH=function(){var t=this.lH;return 0===t.length?null:1===t.length&&t[0]instanceof O_t?t[0]:A_t(t)},t.$H=function(i){var n=t.zH;n.length=0;for(var r=i.length,s=0;s<r;s++){var e=i[s],h=e.BH(!0);h&&(h.setSpeed(e.Hi),n.push(h))}},t.HH=function(i){t.$H(i);var n=A_t(t.zH);return this.zH.length=0,n},t.VH=function(i){t.$H(i);var n,r=(n=t.zH,new R_t(n));return this.zH.length=0,r},r(t,[{key:"running",get:function(){return!!this.PH&&G_t().isActionRunning(this.PH)}},{key:"duration",get:function(){return this.PH?this.PH.getDuration():0}}]),t}());function wyt(t){return new dyt(t)}function gyt(t){return st(16396),new dyt(t)}dyt.zH=[],O.Tween=dyt,O.tween=wyt,O.tweenUtil=gyt;var pyt=new Qs,_yt={NONE:0,COLOR:1,SPRITE:2,SCALE:3};bi(_yt);var yyt={CLICK:"click"},myt=t("ey",(j_t=_o("cc.Button"),H_t=mo(110),V_t=yo(mB),$_t=ic(WE),z_t=ic(_yt),W_t=ic(wL),X_t=ic(wL),Y_t=ic(wL),K_t=ic(wL),q_t=ic([Xg]),j_t(Q_t=H_t(Q_t=V_t((lyt=function(t){function i(){var i;return(i=t.call(this)||this).clickEvents=Z_t&&Z_t(),i._interactable=tyt&&tyt(),i._transition=iyt&&iyt(),i._normalColor=nyt&&nyt(),i._hoverColor=ryt&&ryt(),i._pressedColor=syt&&syt(),i._disabledColor=eyt&&eyt(),i._normalSprite=hyt&&hyt(),i._hoverSprite=uyt&&uyt(),i._pressedSprite=oyt&&oyt(),i._disabledSprite=cyt&&cyt(),i._duration=ayt&&ayt(),i._zoomScale=fyt&&fyt(),i._target=vyt&&vyt(),i._pressed=!1,i.WH=!1,i.XH=new Qs,i.YH=new Qs,i.KH=0,i.qH=!0,i.QH=Rr(),i.JH=Rr(),i.ZH=null,i.tV=null,i.iV=Rr(),i}e(i,t);var n=i.prototype;return n.__preload=function(){this.target||(this.target=this.node),this._applyTarget(),this._resetState()},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},n.onDestroy=function(){this.target.isValid&&this._unregisterTargetEvent(this.target)},n.update=function(t){var i=this.target;if(!this.qH&&i&&(1===this._transition||3===this._transition)){this.KH+=t;var n=1;if(this._duration>0&&(n=this.KH/this._duration),n>=1&&(n=1),1===this._transition){var r=i._uiProps.uiComp;Qs.lerp(pyt,this.XH,this.YH,n),r&&(r.color=pyt)}else 3===this.transition&&(i.getScale(this.iV),this.iV.x=Hn(this.QH.x,this.JH.x,n),this.iV.y=Hn(this.QH.y,this.JH.y,n),i.setScale(this.iV));1===n&&(this.qH=!0)}},n._resizeNodeToTargetNode=function(){this.target&&this.target.qu()},n._resetState=function(){this._pressed=!1,this.WH=!1;var t=this.target;if(t){var i=this._transition;if(1===i&&this._interactable){var n=t.getComponent(GB);n&&(n.color=this._normalColor)}else 3===i&&this.ZH&&t.setScale(this.ZH);this.qH=!0}},n._registerNodeEvent=function(){var t=this,i=t.node;i.on("touch-start",t._onTouchBegan,t),i.on("touch-move",t._onTouchMove,t),i.on("touch-end",t._onTouchEnded,t),i.on("touch-cancel",t._onTouchCancel,t),i.on("mouse-enter",t._onMouseMoveIn,t),i.on("mouse-leave",t._onMouseMoveOut,t)},n._registerTargetEvent=function(t){t.on("transform-changed",this.nV,this)},n._unregisterNodeEvent=function(){var t=this,i=t.node;i.off("touch-start",t._onTouchBegan,t),i.off("touch-move",t._onTouchMove,t),i.off("touch-end",t._onTouchEnded,t),i.off("touch-cancel",t._onTouchCancel,t),i.off("mouse-enter",t._onMouseMoveIn,t),i.off("mouse-leave",t._onMouseMoveOut,t)},n._unregisterTargetEvent=function(t){t.off("transform-changed")},n._getTargetSprite=function(t){var i=null;return t&&(i=t.getComponent(tU)),i},n._applyTarget=function(){this.target&&(this.tV=this._getTargetSprite(this.target),this.ZH||(this.ZH=new Ir),Ir.copy(this.ZH,this.target.scale),this._registerTargetEvent(this.target))},n.rV=function(t){2===this._transition&&this.sV(t.spriteFrame)},n.sV=function(t){if(t)switch(this._getButtonState()){case 0:this._normalSprite=t;break;case 1:this._hoverSprite=t;break;case 2:this._pressedSprite=t;break;case 3:this._disabledSprite=t}},n.eV=function(t){1===this._transition&&this.hV(t)},n.hV=function(t){switch(this._getButtonState()){case 0:this._normalColor=t;break;case 1:this._hoverColor=t;break;case 2:this._pressedColor=t;break;case 3:this._disabledColor=t}},n.nV=function(t){4&t&&this.ZH&&3===this._transition&&this.qH&&Ir.copy(this.ZH,this.target.scale)},n._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&t){var i=t.touch;if(i){var n,r=this.node.qu().hitTest(i.getLocation(),t.windowId);3===this._transition&&this.target&&this.ZH?r?(Ir.copy(this.QH,this.ZH),Ir.multiplyScalar(this.JH,this.ZH,this._zoomScale),this.qH=!1):(this.KH=0,this.qH=!0,this.target.setScale(this.ZH)):(n=r?2:0,this._applyTransition(n)),t&&(t.propagationStopped=!0)}}},n._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(Xg.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},n._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(2!==this._transition||this._hoverSprite)&&(this.WH||(this.WH=!0,this._updateState()))},n._onMouseMoveOut=function(){this.WH&&(this.WH=!1,this._updateState())},n._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},n._getButtonState=function(){var t=0;return this._interactable?this._pressed?t=2:this.WH&&(t=1):t=3,t},n._updateColorTransition=function(t){var i,n=this.uV(t),r=null==(i=this.target)?void 0:i.getComponent(GB);r&&(3===t?(r.color=n,this.qH=!0):(this.XH=r.color.clone(),this.YH=n,this.KH=0,this.qH=!1))},n._updateSpriteTransition=function(t){var i=this.oV(t);this.tV&&i&&(this.tV.spriteFrame=i)},n._updateScaleTransition=function(t){this._interactable&&(2===t?this._zoomUp():this._zoomBack())},n._zoomUp=function(){this.ZH&&(Ir.copy(this.QH,this.ZH),Ir.multiplyScalar(this.JH,this.ZH,this._zoomScale),this.KH=0,this.qH=!1)},n._zoomBack=function(){this.target&&this.ZH&&(Ir.copy(this.QH,this.target.scale),Ir.copy(this.JH,this.ZH),this.KH=0,this.qH=!1)},n._applyTransition=function(t){var i=this._transition;1===i?this._updateColorTransition(t):2===i?this._updateSpriteTransition(t):3===i&&this._updateScaleTransition(t)},n.oV=function(t){switch(t){case 0:return this._normalSprite;case 3:return this._disabledSprite;case 1:return this.hoverSprite;case 2:return this._pressedSprite;default:return null}},n.uV=function(t){switch(t){case 0:return this._normalColor;case 3:return this._disabledColor;case 1:return this._hoverColor;case 2:return this._pressedColor;default:return new Qs}},n.cV=function(){},n.fV=function(){},n.vV=function(){},n.lV=function(){},r(i,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable!==t&&(this._interactable=t,this._updateState(),this._interactable||this._resetState())}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(1===this._transition?this._updateColorTransition(0):2===this._transition&&this._updateSpriteTransition(0),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var i=this.node.getComponent(tU);i&&(i.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),i}(Kg),lyt.Transition=_yt,lyt.EventType=yyt,y((J_t=lyt).prototype,"target",[$_t],Object.getOwnPropertyDescriptor(J_t.prototype,"target"),J_t.prototype),y(J_t.prototype,"transition",[z_t],Object.getOwnPropertyDescriptor(J_t.prototype,"transition"),J_t.prototype),y(J_t.prototype,"normalSprite",[W_t],Object.getOwnPropertyDescriptor(J_t.prototype,"normalSprite"),J_t.prototype),y(J_t.prototype,"pressedSprite",[X_t],Object.getOwnPropertyDescriptor(J_t.prototype,"pressedSprite"),J_t.prototype),y(J_t.prototype,"hoverSprite",[Y_t],Object.getOwnPropertyDescriptor(J_t.prototype,"hoverSprite"),J_t.prototype),y(J_t.prototype,"disabledSprite",[K_t],Object.getOwnPropertyDescriptor(J_t.prototype,"disabledSprite"),J_t.prototype),Z_t=uo(J_t.prototype,"clickEvents",[q_t,Co],(function(){return[]})),tyt=uo(J_t.prototype,"_interactable",[Co],(function(){return!0})),iyt=uo(J_t.prototype,"_transition",[Co],(function(){return 0})),nyt=uo(J_t.prototype,"_normalColor",[Co],(function(){return Qs.WHITE.clone()})),ryt=uo(J_t.prototype,"_hoverColor",[Co],(function(){return new Qs(211,211,211,255)})),syt=uo(J_t.prototype,"_pressedColor",[Co],(function(){return Qs.WHITE.clone()})),eyt=uo(J_t.prototype,"_disabledColor",[Co],(function(){return new Qs(124,124,124,255)})),hyt=uo(J_t.prototype,"_normalSprite",[Co],(function(){return null})),uyt=uo(J_t.prototype,"_hoverSprite",[Co],(function(){return null})),oyt=uo(J_t.prototype,"_pressedSprite",[Co],(function(){return null})),cyt=uo(J_t.prototype,"_disabledSprite",[Co],(function(){return null})),ayt=uo(J_t.prototype,"_duration",[Co],(function(){return.1})),fyt=uo(J_t.prototype,"_zoomScale",[Co],(function(){return 1.2})),vyt=uo(J_t.prototype,"_target",[Co],(function(){return null})),Q_t=J_t))||Q_t)||Q_t)||Q_t));O.Button=myt;var byt=function(){function t(){}return t.add=function(t){var i=this._tabIndexList;-1===i.indexOf(t)&&i.push(t)},t.remove=function(t){var i=this._tabIndexList,n=i.indexOf(t);-1!==n&&i.splice(n,1)},t.resort=function(){this._tabIndexList.sort((function(t,i){return t._delegate.tabIndex-i._delegate.tabIndex}))},t.next=function(t){var i=this._tabIndexList,n=i.indexOf(t);if(t.setFocus(!1),-1!==n){var r=i[n+1];r&&r._delegate.tabIndex>=0&&r.setFocus(!0)}},t}();byt._tabIndexList=[];var kyt=function(){function t(){this._editing=!1,this._delegate=null}var i=t.prototype;return i.init=function(){},i.onEnable=function(){},i.beforeDraw=function(){},i.onDisable=function(){this._editing&&this.endEditing()},i.clear=function(){this._delegate=null},i.setTabIndex=function(){},i.setSize=function(){},i.setFocus=function(t){t?this.beginEditing():this.endEditing()},i.isFocused=function(){return this._editing},i.beginEditing=function(){},i.endEditing=function(){},t}(),Ayt=I.document,Eyt=new ls,Tyt=new ls,Oyt=new Ir,Syt=null,Iyt=0,Ryt=function(t){function i(){var i;return(i=t.call(this)||this)._delegate=null,i._inputMode=-1,i._inputFlag=-1,i._returnType=-1,i.__eventListeners={},i.__autoResize=!1,i.__orientationChanged=void 0,i._edTxt=null,i.dV=!1,i.wV=null,i.gV=null,i.pV=null,i._V=null,i.yV=null,i.mV=null,i.bV=null,i.kV=null,i.AV=null,i.EV=null,i.TV="EditBoxId_"+ ++Iyt,i.OV=!1,i}e(i,t);var n=i.prototype;return n.init=function(t){t&&(this._delegate=t,0===t.inputMode?this.SV():this.IV(),byt.add(this),this.setTabIndex(t.tabIndex),this.RV(),this.MV(),this.CV(),HN.instance.on("canvas-resize",this.NV,this),_h.on("window-resize",this.NV,this))},n.clear=function(){HN.instance.off("canvas-resize",this.NV,this),_h.off("window-resize",this.NV,this),this.PV(),this.LV(),byt.remove(this),Syt===this&&(Syt=null),this._delegate=null},n.NV=function(){this.OV=!0},n.beforeDraw=function(){(this._delegate.node.hasChangedFlags||this.OV)&&(this.OV=!1,this.DV())},n.setTabIndex=function(t){this._edTxt.tabIndex=t,byt.resort()},n.setSize=function(t,i){var n=this._edTxt;n&&(n.style.width=t+"px",n.style.height=i+"px")},n.beginEditing=function(){Syt&&Syt!==this&&Syt.setFocus(!1),this._editing=!0,Syt=this,this._delegate._editBoxEditingDidBegan(),this.BV(),this._edTxt.focus()},n.endEditing=function(){this._edTxt.blur()},n.IV=function(){this.dV=!1,this._edTxt=Ayt.createElement("input")},n.SV=function(){this.dV=!0,this._edTxt=Ayt.createElement("textarea")},n.CV=function(){uP.container&&this._edTxt&&(uP.container.appendChild(this._edTxt),Ayt.head.appendChild(this.EV))},n.LV=function(){Bi(uP.container,this._edTxt)&&this._edTxt&&uP.container.removeChild(this._edTxt),Bi(Ayt.head,this.EV)&&Ayt.head.removeChild(this.EV),this._edTxt=null,this.EV=null},n.BV=function(){this.FV(),this.UV(),this.xV(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),bh.isMobile&&this.GV()},n.jV=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),bh.isMobile&&this.HV()},n.GV=function(){bh.os!==ch.ANDROID&&bh.os!==ch.OHOS||(_h.handleResizeEvent=!1,this.VV())},n.HV=function(){bh.os!==ch.ANDROID&&bh.os!==ch.OHOS||(_h.handleResizeEvent=!0),this.$V()},n.zV=function(){if(this._edTxt){var t=this._edTxt.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(I.innerHeight||Ayt.documentElement.clientHeight)&&t.right<=(I.innerWidth||Ayt.documentElement.clientWidth)}return!1},n.VV=function(){var t=this;setTimeout((function(){I.scrollY<40&&!t.zV()&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},n.$V=function(){setTimeout((function(){bh.browserType!==hh.WECHAT||bh.os!==ch.IOS?I.scrollTo(0,0):I.top&&I.top.scrollTo(0,0)}),400)},n.DV=function(){if(this._edTxt){var t=this._delegate.node,i=ZN.getScaleX(),n=ZN.getScaleY(),r=ZN.getViewportRect(),s=_h.devicePixelRatio;t.getWorldMatrix(Eyt);var e=t.qu();if(e&&(Ir.set(Oyt,-e.anchorX*e.width,-e.anchorY*e.height,Oyt.z),ls.transform(Eyt,Eyt,Oyt)),t.qu()){var h=xN.root.batcher2D.getFirstRenderCamera(t);if(h){h.node.getWorldRT(Tyt);var u=Tyt.m12,o=Tyt.m13,c=kh.center;Tyt.m12=c.x-(Tyt.m00*u+Tyt.m04*o),Tyt.m13=c.y-(Tyt.m01*u+Tyt.m05*o),i/=s,n/=s,Ir.set(Oyt,i,n,1),ls.scale(Tyt,Tyt,Oyt);var a=uP.container,f=parseInt(a&&a.style.paddingLeft||"0");f+=r.x/s;var v=parseInt(a&&a.style.paddingBottom||"0");v+=r.y/s,Tyt.m12+=f,Tyt.m13+=v,ls.multiply(Tyt,Tyt,Eyt);var l="matrix("+Tyt.m00+","+-Tyt.m01+","+-Tyt.m04+","+Tyt.m05+","+Tyt.m12+","+-Tyt.m13+")";this._edTxt.style.transform=l,this._edTxt.style["-webkit-transform"]=l,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},n.UV=function(){var t=this._delegate,i=t.inputMode,n=t.inputFlag,r=t.returnType,s=this._edTxt;if(this._inputMode!==i||this._inputFlag!==n||this._returnType!==r){if(this._inputMode=i,this._inputFlag=n,this._returnType=r,this.dV){var e="none";return 4===n?e="uppercase":2===n&&(e="capitalize"),void(s.style.textTransform=e)}if(0===n)return s.type="password",void(s.style.textTransform="none");var h=s.type;1===i?h="email":2===i?h="number":5===i?h="digit":3===i?(h="tel",s.addEventListener("wheel",(function(){return!1}))):4===i?h="url":(h="text",3===r&&(h="search")),s.type=h;var u="none";4===n?u="uppercase":2===n&&(u="capitalize"),s.style.textTransform=u}},n.FV=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},n.RV=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this.TV,this.dV?(t.style.resize="none",t.style.overflowY="scroll"):(t.type="text",t.style["-moz-appearance"]="textfield"),this.EV=Ayt.createElement("style")}},n.xV=function(){var t=this._delegate,i=this._edTxt;i&&t&&(i.value=t.string,this.WV(t.textLabel))},n.WV=function(t){if(t){var i=t.font;i=!i||i instanceof kD?t.fontFamily:i._fontFamily;var n=t.fontSize*t.node.scale.y;if((this.wV!==i||this.gV!==n||this.pV!==t.fontColor||this._V!==t.horizontalAlign)&&(this.wV=i,this.gV=n,this.pV=t.fontColor,this._V=t.horizontalAlign,this._edTxt)){var r=this._edTxt;switch(r.style.fontSize=n+"px",r.style.color=t.color.toCSS(),r.style.fontFamily=i,t.horizontalAlign){case KF.HorizontalAlign.LEFT:r.style.textAlign="left";break;case KF.HorizontalAlign.CENTER:r.style.textAlign="center";break;case KF.HorizontalAlign.RIGHT:r.style.textAlign="right"}}}},n.XV=function(t){if(t){var i=t.font;i=!i||i instanceof kD?t.fontFamily:t.font._fontFamily;var n=t.fontSize*t.node.scale.y;if(this.yV!==i||this.mV!==n||this.bV!==t.fontColor||this.kV!==t.horizontalAlign||this.AV!==t.fontSize){this.yV=i,this.mV=n,this.bV=t.fontColor,this.kV=t.horizontalAlign,this.AV=t.fontSize;var r=this.EV,s=t.color.toCSS(),e=t.fontSize,h="";switch(t.horizontalAlign){case KF.HorizontalAlign.LEFT:h="left";break;case KF.HorizontalAlign.CENTER:h="center";break;case KF.HorizontalAlign.RIGHT:h="right"}r.innerHTML="#"+this.TV+"::-webkit-input-placeholder{text-transform: initial;-family: "+i+";font-size: "+n+"px;color: "+s+";line-height: "+e+"px;text-align: "+h+";}#"+this.TV+"::-moz-placeholder{text-transform: initial;-family: "+i+";font-size: "+n+"px;color: "+s+";line-height: "+e+"px;text-align: "+h+";}#"+this.TV+"::-ms-input-placeholder{text-transform: initial;-family: "+i+";font-size: "+n+"px;color: "+s+";line-height: "+e+"px;text-align: "+h+";}",bh.browserType===hh.EDGE&&(r.innerHTML+="#"+this.TV+"::-ms-clear{display: none;}")}}},n.MV=function(){var t=this;if(this._edTxt){var i=this._edTxt,n=!1,r=this.__eventListeners;r.compositionStart=function(){n=!0},r.compositionEnd=function(){n=!1,t._delegate._editBoxTextChanged(i.value)},r.onInput=function(){if(!n){var r=t._delegate,s=r.maxLength;s>=0&&"number"!==i.type&&(i.value=i.value.slice(0,s)),r._editBoxTextChanged(i.value)}},r.onClick=function(){t._editing&&bh.isMobile&&t.VV()},r.onKeydown=function(n){13===n.keyCode?(n.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t.dV||i.blur()):9===n.keyCode&&(n.propagationStopped=!0,n.preventDefault(),byt.next(t))},r.onBlur=function(){bh.isMobile&&n&&r.compositionEnd(),t._editing=!1,Syt=null,t.jV(),t._delegate._editBoxEditingDidEnded()},i.addEventListener("compositionstart",r.compositionStart),i.addEventListener("compositionend",r.compositionEnd),i.addEventListener("input",r.onInput),i.addEventListener("keydown",r.onKeydown),i.addEventListener("blur",r.onBlur),i.addEventListener("touchstart",r.onClick)}},n.PV=function(){if(this._edTxt){var t=this._edTxt,i=this.__eventListeners;t.removeEventListener("compositionstart",i.compositionStart),t.removeEventListener("compositionend",i.compositionEnd),t.removeEventListener("input",i.onInput),t.removeEventListener("keydown",i.onKeydown),t.removeEventListener("blur",i.onBlur),t.removeEventListener("touchstart",i.onClick),i.compositionStart=null,i.compositionEnd=null,i.onInput=null,i.onKeydown=null,i.onBlur=null,i.onClick=null}},i}(kyt),Myt={DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5};_i(Myt);var Cyt={ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6};_i(Cyt);var Nyt,Pyt,Lyt,Dyt,Byt,Fyt,Uyt,xyt,Gyt,jyt,Hyt,Vyt,$yt,zyt,Wyt,Xyt,Yyt,Kyt,qyt,Qyt,Jyt,Zyt,tmt,imt,nmt,rmt,smt,emt,hmt,umt={PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5};_i(umt);var omt,cmt,amt,fmt,vmt,lmt,dmt,wmt,gmt,pmt,_mt,ymt,mmt,bmt,kmt,Amt,Emt,Tmt,Omt,Smt,Imt,Rmt,Mmt,Cmt,Nmt,Pmt,Lmt,Dmt,Bmt=t("ez",(Nyt=_o("cc.EditBox"),Pyt=mo(110),Lyt=yo(mB),Dyt=ic(KF),Byt=ic(KF),Fyt=ic(wL),Uyt=ic(umt),xyt=ic(Cyt),Gyt=ic(Myt),jyt=ic([Xg]),Hyt=ic([Xg]),Vyt=ic([Xg]),$yt=ic([Xg]),Nyt(zyt=Pyt(zyt=Lyt((hmt=function(t){function i(){var i;return(i=t.call(this)||this).editingDidBegan=Xyt&&Xyt(),i.textChanged=Yyt&&Yyt(),i.editingDidEnded=Kyt&&Kyt(),i.editingReturn=qyt&&qyt(),i._impl=null,i._background=null,i._textLabel=Qyt&&Qyt(),i._placeholderLabel=Jyt&&Jyt(),i._returnType=Zyt&&Zyt(),i._string=tmt&&tmt(),i._tabIndex=imt&&imt(),i._backgroundImage=nmt&&nmt(),i._inputFlag=rmt&&rmt(),i._inputMode=smt&&smt(),i._maxLength=emt&&emt(),i.YV=!1,i}e(i,t);var n=i.prototype;return n.__preload=function(){this._init()},n.onEnable=function(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()},n.KV=function(){this._impl&&this._impl.beforeDraw()},n.onDisable=function(){this._unregisterEvent(),this.qV(),this._impl&&this._impl.onDisable()},n.onDestroy=function(){xN.off("director_before_draw",this.KV,this),this._impl&&this._impl.clear()},n.setFocus=function(){this._impl&&this._impl.setFocus(!0)},n.focus=function(){this._impl&&this._impl.setFocus(!0)},n.blur=function(){this._impl&&this._impl.setFocus(!1)},n.isFocused=function(){return!!this._impl&&this._impl.isFocused()},n._editBoxEditingDidBegan=function(){Xg.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},n._editBoxEditingDidEnded=function(t){Xg.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this,t)},n._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,Xg.emitEvents(this.textChanged,t,this),this.node.emit("text-changed",this)},n._editBoxEditingReturn=function(t){Xg.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this,t)},n._showLabels=function(){this.YV=!0,this._updateLabels()},n._hideLabels=function(){this.YV=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},n._onTouchBegan=function(t){t.propagationStopped=!0},n._onTouchCancel=function(t){t.propagationStopped=!0},n._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},n._init=function(){this._updatePlaceholderLabel(),this._updateTextLabel(),this.YV=!0,this.node.on("size-changed",this._resizeChildNodes,this),xN.on("director_before_draw",this.KV,this),(this._impl=new i._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},n._ensureBackgroundSprite=function(){if(!this._background){var t=this.node.getComponent(tU);t||(t=this.node.addComponent(tU)),t!==this._background&&(t.type=tU.Type.SLICED,t.spriteFrame=this._backgroundImage,this._background=t,this.QV())}},n._updateTextLabel=function(){var t=this._textLabel;if(!t){var i=this.node.getChildByName("TEXT_LABEL");i||((i=new WE("TEXT_LABEL")).layer=this.node.layer),(t=i.getComponent(KF))||(t=i.addComponent(KF)),i.parent=this.node,this._textLabel=t}0===this._inputMode?(t.verticalAlign=0,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},n._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var i=this.node.getChildByName("PLACEHOLDER_LABEL");i||((i=new WE("PLACEHOLDER_LABEL")).layer=this.node.layer),(t=i.getComponent(KF))||(t=i.addComponent(KF)),i.parent=this.node,this._placeholderLabel=t}0===this._inputMode?t.enableWrapText=!0:t.enableWrapText=!1,t.string=this.placeholder},n._syncSize=function(){var t=this.node.qu(),i=t.contentSize;if(this._background){var n=this._background.node.qu();n.anchorPoint=t.anchorPoint,n.setContentSize(i)}this._updateLabelPosition(i),this._impl&&this._impl.setSize(i.width,i.height)},n._updateLabels=function(){if(this.YV){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},n._updateString=function(t){var i=this._textLabel;if(i){var n=t;n&&(n=this._updateLabelStringStyle(n)),i.string=n,this._updateLabels()}},n._updateLabelStringStyle=function(t,i){void 0===i&&(i=!1);var n,r=this._inputFlag;if(i||0!==r)4===r?t=t.toUpperCase():2===r?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):3===r&&(t=(n=t).charAt(0).toUpperCase()+n.slice(1));else{for(var s="",e=t.length,h=0;h<e;++h)s+="";t=s}return t},n._registerEvent=function(){var t=this,i=t.node;i.on("touch-start",t._onTouchBegan,t),i.on("touch-end",t._onTouchEnded,t)},n._unregisterEvent=function(){var t=this,i=t.node;i.off("touch-start",t._onTouchBegan,t),i.off("touch-end",t._onTouchEnded,t)},n.JV=function(){this._background&&(this.backgroundImage=this._background.spriteFrame)},n.QV=function(){var t=this._background&&this._background.node;null==t||t.on("spriteframe-changed",this.JV,this)},n.qV=function(){var t=this._background&&this._background.node;null==t||t.off("spriteframe-changed",this.JV,this)},n._updateLabelPosition=function(t){var i=this.node.qu(),n=-i.anchorX*i.width,r=-i.anchorY*i.height,s=this._placeholderLabel,e=this._textLabel;e&&(e.node.qu().setContentSize(t.width-2,t.height),e.node.setPosition(n+2,r+t.height,e.node.position.z),0===this._inputMode&&(e.verticalAlign=0),e.enableWrapText=0===this._inputMode),s&&(s.node.qu().setContentSize(t.width-2,t.height),s.node.setPosition(n+2,r+t.height,s.node.position.z),s.enableWrapText=0===this._inputMode)},n._resizeChildNodes=function(){var t=this.node.qu(),i=this._textLabel&&this._textLabel.node;i&&(i.setPosition(-t.width/2,t.height/2,i.position.z),i.qu().setContentSize(t.contentSize));var n=this._placeholderLabel&&this._placeholderLabel.node;n&&(n.setPosition(-t.width/2,t.height/2,n.position.z),n.qu().setContentSize(t.contentSize));var r=this._background&&this._background.node;r&&r.qu().setContentSize(t.contentSize),this._syncSize()},n._xrUnClick=function(){},n._xrKeyBoardInput=function(){},r(i,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string!==t&&(this._string=t,this._updateString(t))}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._ensureBackgroundSprite(),this._background.spriteFrame=t)}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag!==t&&(this._inputFlag=t,this._updateString(this._string))}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),i}(Kg),hmt._EditBoxImpl=kyt,hmt.KeyboardReturnType=Myt,hmt.InputFlag=umt,hmt.InputMode=Cyt,hmt.EventType={EDITING_DID_BEGAN:"editing-did-began",EDITING_DID_ENDED:"editing-did-ended",TEXT_CHANGED:"text-changed",EDITING_RETURN:"editing-return",XR_EDITING_DID_BEGAN:"xr-editing-did-began",XR_EDITING_DID_ENDED:"xr-editing-did-ended"},y((Wyt=hmt).prototype,"textLabel",[Dyt],Object.getOwnPropertyDescriptor(Wyt.prototype,"textLabel"),Wyt.prototype),y(Wyt.prototype,"placeholderLabel",[Byt],Object.getOwnPropertyDescriptor(Wyt.prototype,"placeholderLabel"),Wyt.prototype),y(Wyt.prototype,"backgroundImage",[Fyt],Object.getOwnPropertyDescriptor(Wyt.prototype,"backgroundImage"),Wyt.prototype),y(Wyt.prototype,"inputFlag",[Uyt],Object.getOwnPropertyDescriptor(Wyt.prototype,"inputFlag"),Wyt.prototype),y(Wyt.prototype,"inputMode",[xyt],Object.getOwnPropertyDescriptor(Wyt.prototype,"inputMode"),Wyt.prototype),y(Wyt.prototype,"returnType",[Gyt],Object.getOwnPropertyDescriptor(Wyt.prototype,"returnType"),Wyt.prototype),Xyt=uo(Wyt.prototype,"editingDidBegan",[jyt,Co],(function(){return[]})),Yyt=uo(Wyt.prototype,"textChanged",[Hyt,Co],(function(){return[]})),Kyt=uo(Wyt.prototype,"editingDidEnded",[Vyt,Co],(function(){return[]})),qyt=uo(Wyt.prototype,"editingReturn",[$yt,Co],(function(){return[]})),Qyt=uo(Wyt.prototype,"_textLabel",[Co],(function(){return null})),Jyt=uo(Wyt.prototype,"_placeholderLabel",[Co],(function(){return null})),Zyt=uo(Wyt.prototype,"_returnType",[Co],(function(){return 0})),tmt=uo(Wyt.prototype,"_string",[Co],(function(){return""})),imt=uo(Wyt.prototype,"_tabIndex",[Co],(function(){return 0})),nmt=uo(Wyt.prototype,"_backgroundImage",[Co],(function(){return null})),rmt=uo(Wyt.prototype,"_inputFlag",[Co],(function(){return 5})),smt=uo(Wyt.prototype,"_inputMode",[Co],(function(){return 0})),emt=uo(Wyt.prototype,"_maxLength",[Co],(function(){return 20})),zyt=Wyt))||zyt)||zyt)||zyt));"object"==typeof window&&"object"==typeof document&&(Bmt._EditBoxImpl=Ryt),O.internal.EditBox=Bmt;var Fmt={NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3};bi(Fmt);var Umt={NONE:0,CONTAINER:1,CHILDREN:2};bi(Umt);var xmt={HORIZONTAL:0,VERTICAL:1};bi(xmt);var Gmt={BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1};bi(Gmt);var jmt={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};bi(jmt);var Hmt={NONE:0,FIXED_ROW:1,FIXED_COL:2};bi(Hmt);var Vmt,$mt,zmt,Wmt,Xmt,Ymt,Kmt,qmt,Qmt,Jmt,Zmt,tbt,ibt,nbt=new Ir,rbt=t("eA",(omt=_o("cc.Layout"),cmt=mo(110),amt=yo(mB),fmt=ic(Fmt),vmt=ic(Umt),lmt=ic(xmt),dmt=ic(Gmt),wmt=ic(jmt),gmt=ic(Hmt),omt(pmt=cmt(pmt=amt((Dmt=function(t){function i(){var i;return(i=t.call(this)||this)._resizeMode=ymt&&ymt(),i._layoutType=mmt&&mmt(),i._cellSize=bmt&&bmt(),i._startAxis=kmt&&kmt(),i._paddingLeft=Amt&&Amt(),i._paddingRight=Emt&&Emt(),i._paddingTop=Tmt&&Tmt(),i._paddingBottom=Omt&&Omt(),i._spacingX=Smt&&Smt(),i._spacingY=Imt&&Imt(),i._verticalDirection=Rmt&&Rmt(),i._horizontalDirection=Mmt&&Mmt(),i._constraint=Cmt&&Cmt(),i._constraintNum=Nmt&&Nmt(),i._affectedByScale=Pmt&&Pmt(),i._isAlign=Lmt&&Lmt(),i._layoutSize=new ie(300,200),i._layoutDirty=!0,i._childrenDirty=!1,i._usefulLayoutObj=[],i._init=!1,i}e(i,t);var n=i.prototype;return n.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&(this._doLayout(),this._layoutDirty=!1)},n.onEnable=function(){this._addEventListeners();var t=this.node.qu();t.contentSize.equals(ie.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},n.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},n._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,i=0;i<t.length;++i){var n=t[i],r=n.qu();n.activeInHierarchy&&r&&this._usefulLayoutObj.push(r)}},n._addEventListeners=function(){xN.on("director_after_update",this.updateLayout,this),this.node.on("size-changed",this._resized,this),this.node.on("anchor-changed",this._doLayoutDirty,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-removed",this._childRemoved,this),this.node.on("sibling-order-changed",this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},n._removeEventListeners=function(){xN.off("director_after_update",this.updateLayout,this),this.node.off("size-changed",this._resized,this),this.node.off("anchor-changed",this._doLayoutDirty,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-removed",this._childRemoved,this),this.node.off("sibling-order-changed",this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},n._addChildrenEventListeners=function(){for(var t=this.node.children,i=0;i<t.length;++i){var n=t[i];n.on("size-changed",this._doLayoutDirty,this),n.on("transform-changed",this._transformDirty,this),n.on("anchor-changed",this._doLayoutDirty,this),n.on("active-in-hierarchy-changed",this._childrenChanged,this)}},n._removeChildrenEventListeners=function(){for(var t=this.node.children,i=0;i<t.length;++i){var n=t[i];n.off("size-changed",this._doLayoutDirty,this),n.off("transform-changed",this._transformDirty,this),n.off("anchor-changed",this._doLayoutDirty,this),n.off("active-in-hierarchy-changed",this._childrenChanged,this)}},n._childAdded=function(t){t.on("size-changed",this._doLayoutDirty,this),t.on("transform-changed",this._transformDirty,this),t.on("anchor-changed",this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},n._childRemoved=function(t){t.off("size-changed",this._doLayoutDirty,this),t.off("transform-changed",this._transformDirty,this),t.off("anchor-changed",this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},n._resized=function(){this._layoutSize.set(this.node.qu().contentSize),this._doLayoutDirty()},n._doLayoutHorizontally=function(t,i,n,r){var s=this.node.qu().anchorPoint,e=this._getFixedBreakingNum(),h=1,u=this._paddingLeft;1===this._horizontalDirection&&(h=-1,u=this._paddingRight);var o=(this._horizontalDirection-s.x)*t+h*u,c=o-h*this._spacingX,a=0,f=0,v=0,l=0,d=!1,w=this._usefulLayoutObj.length,g=this._cellSize.width,p=this._getPaddingH();3!==this._layoutType&&2===this._resizeMode&&(g=(t-p-(w-1)*this._spacingX)/w);for(var _=this._usefulLayoutObj,y=0;y<_.length;++y){var m=_[y],b=m.node,k=b.scale,A=this._getUsedScaleValue(k.x),E=this._getUsedScaleValue(k.y);2===this._resizeMode&&(m.width=g/A,3===this._layoutType&&(m.height=this._cellSize.height/E));var T=Math.abs(this._horizontalDirection-m.anchorX),O=m.width*A,S=m.height*E;S>v&&(l=Math.max(v,l),f=v||S,v=S),c+=h*(T*O+this._spacingX);var I=h*(1-T)*O;if(i){if(e>0)(d=y/e>0&&y%e==0)&&(f=v>S?v:f);else if(O>t-p)c>o+h*T*O&&(d=!0);else{var R=(1-this._horizontalDirection-s.x)*t,M=c+I+h*(h>0?this._paddingRight:this._paddingLeft);d=Math.abs(M)>Math.abs(R)}d&&(c=o+h*T*O,S!==v&&(f=v),a+=f+this._spacingY,f=v=S)}var C=n(b,m,a);r&&b.setPosition(c,C),c+=I}return f=Math.max(f,v),Math.max(l,a+f)+this._getPaddingV()},n._doLayoutVertically=function(t,i,n,r){var s=this.node.qu().anchorPoint,e=this._getFixedBreakingNum(),h=1,u=this._paddingBottom;1===this._verticalDirection&&(h=-1,u=this._paddingTop);var o=(this._verticalDirection-s.y)*t+h*u,c=o-h*this._spacingY,a=0,f=0,v=0,l=0,d=!1,w=this._usefulLayoutObj.length,g=this._cellSize.height,p=this._getPaddingV();3!==this._layoutType&&2===this._resizeMode&&(g=(t-p-(w-1)*this._spacingY)/w);for(var _=this._usefulLayoutObj,y=0;y<_.length;++y){var m=_[y],b=m.node,k=b.scale,A=this._getUsedScaleValue(k.x),E=this._getUsedScaleValue(k.y);2===this._resizeMode&&(m.height=g/E,3===this._layoutType&&(m.width=this._cellSize.width/A));var T=Math.abs(this._verticalDirection-m.anchorY),O=m.width*A,S=m.height*E;O>a&&(f=Math.max(a,f),v=a||O,a=O),c+=h*(T*S+this._spacingY);var I=h*(1-T)*S;if(i){if(e>0)(d=y/e>0&&y%e==0)&&(v=a>S?a:v);else if(S>t-p)c>o+h*T*S&&(d=!0);else{var R=(1-this._verticalDirection-s.y)*t,M=c+I+h*(h>0?this._paddingTop:this._paddingBottom);d=Math.abs(M)>Math.abs(R)}d&&(c=o+h*T*S,O!==a&&(v=a),l+=v+this._spacingX,v=a=O)}var C=n(b,m,l);r&&(b.getPosition(nbt),b.setPosition(C,c,nbt.z)),c+=I}return v=Math.max(v,a),Math.max(f,l+v)+this._getPaddingH()},n._doLayoutGridAxisHorizontal=function(t,i){var n=this,r=i.width,s=1,e=-t.y*i.height,h=this._paddingBottom;1===this._verticalDirection&&(s=-1,e=(1-t.y)*i.height,h=this._paddingTop);var u=function(t,i,r){return e+s*(r+(1-i.anchorY)*i.height*n._getUsedScaleValue(t.scale.y)+h)},o=0;1===this._resizeMode&&(o=this._doLayoutHorizontally(r,!0,u,!1),e=-t.y*o,1===this._verticalDirection&&(s=-1,e=(1-t.y)*o)),this._doLayoutHorizontally(r,!0,u,!0),1===this._resizeMode&&this.node.qu().setContentSize(r,o)},n._doLayoutGridAxisVertical=function(t,i){var n=this,r=i.height,s=1,e=-t.x*i.width,h=this._paddingLeft;1===this._horizontalDirection&&(s=-1,e=(1-t.x)*i.width,h=this._paddingRight);var u=function(t,i,r){return e+s*(r+(1-i.anchorX)*i.width*n._getUsedScaleValue(t.scale.x)+h)},o=0;1===this._resizeMode&&(o=this._doLayoutVertically(r,!0,u,!1),e=-t.x*o,1===this._horizontalDirection&&(s=-1,e=(1-t.x)*o)),this._doLayoutVertically(r,!0,u,!0),1===this._resizeMode&&this.node.qu().setContentSize(o,r)},n._doLayoutGrid=function(){var t=this.node.qu(),i=t.anchorPoint,n=t.contentSize;0===this.startAxis?this._doLayoutGridAxisHorizontal(i,n):1===this.startAxis&&this._doLayoutGridAxisVertical(i,n)},n._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,i=0,n=t.length;if(1===this._resizeMode){for(var r=0;r<t.length;++r){var s=t[r],e=s.node.scale;i+=s.width*this._getUsedScaleValue(e.x)}i+=(n-1)*this._spacingX+this._getPaddingH()}else i=this.node.qu().width;return i},n._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,i=0,n=t.length;if(1===this._resizeMode){for(var r=0;r<t.length;++r){var s=t[r],e=s.node.scale;i+=s.height*this._getUsedScaleValue(e.y)}i+=(n-1)*this._spacingY+this._getPaddingV()}else i=this.node.qu().height;return i},n._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),1===this._layoutType){var i=this._getHorizontalBaseWidth();this._doLayoutHorizontally(i,!1,(function(i){return(t._isAlign?Ir.ZERO:i.position).y}),!0),this.node.qu().width=i}else if(2===this._layoutType){var n=this._getVerticalBaseHeight();this._doLayoutVertically(n,!1,(function(i){return(t._isAlign?Ir.ZERO:i.position).x}),!0),this.node.qu().height=n}else 3===this._layoutType&&this._doLayoutGrid()},n._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},n._transformDirty=function(t){4&t&&1&t&&this._affectedByScale&&this._doLayoutDirty()},n._doLayoutDirty=function(){this._layoutDirty=!0},n._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},n._getPaddingH=function(){return this._paddingLeft+this._paddingRight},n._getPaddingV=function(){return this._paddingTop+this._paddingBottom},n._getFixedBreakingNum=function(){if(3!==this._layoutType||0===this._constraint||this._constraintNum<=0)return 0;var t=1===this._constraint?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return 1===this._startAxis&&(t=2===this._constraint?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},r(i,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){1===this._layoutType&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){2===this._layoutType&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){0!==this._layoutType&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){0!==this._layoutType&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){0!==this._constraint&&this._constraintNum!==t&&(t<=0&&st(16400),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),i}(Kg),Dmt.Type=Fmt,Dmt.VerticalDirection=Gmt,Dmt.HorizontalDirection=jmt,Dmt.ResizeMode=Umt,Dmt.AxisDirection=xmt,Dmt.Constraint=Hmt,y((_mt=Dmt).prototype,"type",[fmt],Object.getOwnPropertyDescriptor(_mt.prototype,"type"),_mt.prototype),y(_mt.prototype,"resizeMode",[vmt],Object.getOwnPropertyDescriptor(_mt.prototype,"resizeMode"),_mt.prototype),y(_mt.prototype,"startAxis",[lmt],Object.getOwnPropertyDescriptor(_mt.prototype,"startAxis"),_mt.prototype),y(_mt.prototype,"verticalDirection",[dmt],Object.getOwnPropertyDescriptor(_mt.prototype,"verticalDirection"),_mt.prototype),y(_mt.prototype,"horizontalDirection",[wmt],Object.getOwnPropertyDescriptor(_mt.prototype,"horizontalDirection"),_mt.prototype),y(_mt.prototype,"constraint",[gmt],Object.getOwnPropertyDescriptor(_mt.prototype,"constraint"),_mt.prototype),ymt=uo(_mt.prototype,"_resizeMode",[Co],(function(){return 0})),mmt=uo(_mt.prototype,"_layoutType",[Co],(function(){return 0})),bmt=uo(_mt.prototype,"_cellSize",[Co],(function(){return new ie(40,40)})),kmt=uo(_mt.prototype,"_startAxis",[Co],(function(){return 0})),Amt=uo(_mt.prototype,"_paddingLeft",[Co],(function(){return 0})),Emt=uo(_mt.prototype,"_paddingRight",[Co],(function(){return 0})),Tmt=uo(_mt.prototype,"_paddingTop",[Co],(function(){return 0})),Omt=uo(_mt.prototype,"_paddingBottom",[Co],(function(){return 0})),Smt=uo(_mt.prototype,"_spacingX",[Co],(function(){return 0})),Imt=uo(_mt.prototype,"_spacingY",[Co],(function(){return 0})),Rmt=uo(_mt.prototype,"_verticalDirection",[Co],(function(){return 1})),Mmt=uo(_mt.prototype,"_horizontalDirection",[Co],(function(){return 0})),Cmt=uo(_mt.prototype,"_constraint",[Co],(function(){return 0})),Nmt=uo(_mt.prototype,"_constraintNum",[Co],(function(){return 2})),Pmt=uo(_mt.prototype,"_affectedByScale",[Co],(function(){return!1})),Lmt=uo(_mt.prototype,"_isAlign",[Co],(function(){return!1})),pmt=_mt))||pmt)||pmt)||pmt));O.Layout=rbt;var sbt={HORIZONTAL:0,VERTICAL:1,FILLED:2};_i(sbt);var ebt,hbt,ubt,obt,cbt,abt,fbt,vbt,lbt,dbt,wbt,gbt,pbt,_bt=t("eB",(Vmt=_o("cc.ProgressBar"),$mt=mo(110),zmt=yo(mB),Wmt=ic(tU),Xmt=ic(sbt),Vmt(Ymt=$mt(Ymt=zmt((ibt=function(t){function i(){var i;return(i=t.call(this)||this)._barSprite=qmt&&qmt(),i._mode=Qmt&&Qmt(),i._totalLength=Jmt&&Jmt(),i._progress=Zmt&&Zmt(),i._reverse=tbt&&tbt(),i}e(i,t);var n=i.prototype;return n.onLoad=function(){this._updateBarStatus()},n._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var i=this.node.qu(),n=i.contentSize,r=i.anchorPoint,s=t.qu().contentSize;if(2===this._barSprite.fillType&&(this._mode=2),0===this._mode?this.totalLength=s.width:1===this._mode?this.totalLength=s.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var e=-n.width*r.x;t.setPosition(e,0,0)}}},n._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var i=t.qu(),n=i.anchorPoint,r=i.contentSize,s=new Ms(0,.5),e=jn(this._progress),h=this._totalLength*e,u=r,o=0,c=0;switch(this._mode){case 0:this._reverse&&(s=new Ms(1,.5)),u=new ie(h,r.height),o=this._totalLength,c=r.height;break;case 1:s=this._reverse?new Ms(.5,1):new Ms(.5,0),u=new ie(r.width,h),o=r.width,c=this._totalLength}if(2===this._mode)this._barSprite.type!==tU.Type.FILLED?st(16397):(this._reverse&&(h*=-1),this._barSprite.fillRange=h);else if(this._barSprite.type!==tU.Type.FILLED){var a=s.x-n.x,f=s.y-n.y,v=new Ir(t.position);v.add3f(o*a,c*f,0),t.setPosition(v),i.setAnchorPoint(s),i.setContentSize(u)}else st(16398)}},r(i,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var i=this._barSprite.node;if(!i)return;var n=i.qu().contentSize;0===this._mode?this.totalLength=n.width:1===this._mode?this.totalLength=n.height:2===this._mode&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){2===this._mode&&(t=jn(t)),this._totalLength!==t&&(this._totalLength=t,this._updateBarStatus())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),i}(Kg),ibt.Mode=sbt,y((Kmt=ibt).prototype,"barSprite",[Wmt],Object.getOwnPropertyDescriptor(Kmt.prototype,"barSprite"),Kmt.prototype),y(Kmt.prototype,"mode",[Xmt],Object.getOwnPropertyDescriptor(Kmt.prototype,"mode"),Kmt.prototype),qmt=uo(Kmt.prototype,"_barSprite",[Co],(function(){return null})),Qmt=uo(Kmt.prototype,"_mode",[Co],(function(){return 0})),Jmt=uo(Kmt.prototype,"_totalLength",[Co],(function(){return 1})),Zmt=uo(Kmt.prototype,"_progress",[Co],(function(){return.1})),tbt=uo(Kmt.prototype,"_reverse",[Co],(function(){return!1})),Ymt=Kmt))||Ymt)||Ymt)||Ymt));O.ProgressBar=_bt;var ybt=new Ir,mbt=new Ir,bbt=new Ir,kbt=new Ms,Abt=new Qs,Ebt=new Ms,Tbt={HORIZONTAL:0,VERTICAL:1};bi(Tbt);var Obt,Sbt=t("eC",(ebt=_o("cc.ScrollBar"),hbt=mo(110),ubt=yo(mB),obt=ic(tU),cbt=ic(Tbt),ebt(abt=hbt(abt=ubt((pbt=function(t){function i(){var i;return(i=t.call(this)||this)._scrollView=vbt&&vbt(),i._handle=lbt&&lbt(),i._direction=dbt&&dbt(),i._enableAutoHide=wbt&&wbt(),i._autoHideTime=gbt&&gbt(),i._touching=!1,i._opacity=255,i._autoHideRemainingTime=0,i}e(i,t);var n=i.prototype;return n.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},n.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._opacity=255,this._setOpacity(this._opacity)},n.onScroll=function(t){if(this._scrollView){var i=this._scrollView.content;if(i){var n=i.qu().contentSize,r=this._scrollView.node.qu().contentSize,s=this.node.qu().contentSize;if(!this._conditionalDisableScrollBar(n,r)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var e=0,h=0,u=0,o=0,c=0,a=Ebt;a.set(0,0),0===this._direction?(e=n.width,h=r.width,c=s.width,u=t.x,this._convertToScrollViewSpace(a,i),o=-a.x):1===this._direction&&(e=n.height,h=r.height,c=s.height,u=t.y,this._convertToScrollViewSpace(a,i),o=-a.y);var f=this._calculateLength(e,h,c,u),v=Ebt;this._calculatePosition(v,e,h,c,o,u,f),this._updateLength(f),this._updateHandlerPosition(v)}}}},n.setScrollView=function(t){this._scrollView=t},n.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},n.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var i=t.qu().contentSize,n=this._scrollView.node.qu().contentSize;if(this._conditionalDisableScrollBar(i,n))return}}this._autoHideRemainingTime=this._autoHideTime}},n.onEnable=function(){var t=this.node.getComponent(tU);t&&(this._opacity=t.color.a)},n.start=function(){this._enableAutoHide&&this._setOpacity(0)},n.update=function(t){this._processAutoHide(t)},n._convertToScrollViewSpace=function(t,i){var n=this._scrollView&&this._scrollView.node.qu(),r=i.qu();if(n&&r){ybt.set(-r.anchorX*r.width,-r.anchorY*r.height,0),r.convertToWorldSpaceAR(ybt,mbt);var s=n.convertToNodeSpaceAR(mbt);s.x+=n.anchorX*n.width,s.y+=n.anchorY*n.height,t.set(s.x,s.y)}else t.set(Ms.ZERO)},n._setOpacity=function(t){if(this._handle){var i=this.node.getComponent(tU);i&&(Abt.set(i.color),Abt.a=t,i.color=Abt),(i=this._handle.getComponent(tU))&&(Abt.set(i.color),Abt.a=t,i.color=Abt)}},n._updateHandlerPosition=function(t){if(this._handle){var i=bbt;this._fixupHandlerPosition(i),this._handle.node.setPosition(t.x+i.x,t.y+i.y,i.z)}},n._fixupHandlerPosition=function(t){var i=this.node.qu(),n=i.contentSize,r=i.anchorPoint,s=this.handle.node.qu().contentSize,e=this.handle.node.parent;Ir.set(ybt,-n.width*r.x,-n.height*r.y,0);var h=this.node.qu().convertToWorldSpaceAR(ybt,mbt),u=t;u.set(0,0,0),e.qu().convertToNodeSpaceAR(h,u),0===this.direction?u.set(u.x,u.y+(n.height-s.height)/2,u.z):1===this.direction&&u.set(u.x+(n.width-s.width)/2,u.y,u.z),this.handle.node.setPosition(u)},n._conditionalDisableScrollBar=function(t,i){return t.width<=i.width&&0===this._direction||t.height<=i.height&&1===this._direction},n._calculateLength=function(t,i,n,r){var s=t;return r&&(s+=20*(r>0?r:-r)),n*(i/s)},n._calculatePosition=function(t,i,n,r,s,e,h){var u=i-n;e&&(u+=Math.abs(e));var o=0;u&&(o=jn(o=s/u));var c=(r-h)*o;1===this._direction?t.set(0,c):t.set(c,0)},n._updateLength=function(t){if(this._handle){var i=this._handle.node.qu(),n=i.contentSize,r=i.anchorPoint;r.x===kbt.x&&r.y===kbt.y||i.setAnchorPoint(kbt),0===this._direction?i.setContentSize(t,n.height):i.setContentSize(n.width,t)}},n._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var i=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(i)}},r(i,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(Ms.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(Ms.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),i}(Kg),pbt.Direction=Tbt,y((fbt=pbt).prototype,"handle",[obt],Object.getOwnPropertyDescriptor(fbt.prototype,"handle"),fbt.prototype),y(fbt.prototype,"direction",[cbt],Object.getOwnPropertyDescriptor(fbt.prototype,"direction"),fbt.prototype),vbt=uo(fbt.prototype,"_scrollView",[Co],(function(){return null})),lbt=uo(fbt.prototype,"_handle",[Co],(function(){return null})),dbt=uo(fbt.prototype,"_direction",[Co],(function(){return 0})),wbt=uo(fbt.prototype,"_enableAutoHide",[Co],(function(){return!1})),gbt=uo(fbt.prototype,"_autoHideTime",[Co],(function(){return 1})),abt=fbt))||abt)||abt)||abt));O.ScrollBar=Sbt;var Ibt,Rbt,Mbt,Cbt,Nbt,Pbt,Lbt,Dbt,Bbt,Fbt,Ubt,xbt,Gbt,jbt,Hbt,Vbt,$bt,zbt,Wbt,Xbt,Ybt,Kbt=t("eH",_o("cc.ViewGroup")(Obt=mo(110)(Obt=function(t){function i(){return t.apply(this,arguments)||this}return e(i,t),i}(Kg))||Obt)||Obt);O.ViewGroup=Kbt;var qbt,Qbt,Jbt,Zbt,tkt,ikt,nkt,rkt,skt,ekt,hkt,ukt,okt,ckt=1e-4,akt=Rr(),fkt=Rr(),vkt=Cs(),lkt=Cs(),dkt=function(){return(new Date).getMilliseconds()},wkt={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12},gkt={anchor:Cs(),applyToHorizontal:!1,applyToVertical:!1},pkt=function(t,i,n,r){gkt.anchor.set(t,i),gkt.applyToHorizontal=n,gkt.applyToVertical=r},_kt={NONE:"",SCROLL_TO_TOP:"scroll-to-top",SCROLL_TO_BOTTOM:"scroll-to-bottom",SCROLL_TO_LEFT:"scroll-to-left",SCROLL_TO_RIGHT:"scroll-to-right",SCROLL_BEGAN:"scroll-began",SCROLL_ENDED:"scroll-ended",BOUNCE_TOP:"bounce-top",BOUNCE_BOTTOM:"bounce-bottom",BOUNCE_LEFT:"bounce-left",BOUNCE_RIGHT:"bounce-right",SCROLLING:"scrolling",SCROLL_ENG_WITH_THRESHOLD:"scroll-ended-with-threshold",TOUCH_UP:"touch-up"},ykt=t("eD",(Ibt=_o("cc.ScrollView"),Rbt=mo(110),Mbt=yo(mB),Cbt=ic(WE),Nbt=ic(Sbt),Pbt=ic(Sbt),Lbt=ic([Xg]),Ibt(Dbt=Rbt(Dbt=Mbt((Ybt=function(t){function i(){var i;return(i=t.call(this)||this).bounceDuration=Fbt&&Fbt(),i.brake=Ubt&&Ubt(),i.elastic=xbt&&xbt(),i.inertia=Gbt&&Gbt(),i.horizontal=jbt&&jbt(),i.vertical=Hbt&&Hbt(),i.cancelInnerEvents=Vbt&&Vbt(),i.scrollEvents=$bt&&$bt(),i._autoScrolling=!1,i._scrolling=!1,i._content=zbt&&zbt(),i._horizontalScrollBar=Wbt&&Wbt(),i._verticalScrollBar=Xbt&&Xbt(),i._topBoundary=0,i._bottomBoundary=0,i._leftBoundary=0,i._rightBoundary=0,i._touchMoveDisplacements=[],i._touchMoveTimeDeltas=[],i._touchMovePreviousTimestamp=0,i._touchMoved=!1,i._autoScrollAttenuate=!1,i._autoScrollStartPosition=new Ir,i._autoScrollTargetDelta=new Ir,i._autoScrollTotalTime=0,i._autoScrollAccumulatedTime=0,i._autoScrollCurrentlyOutOfBoundary=!1,i._autoScrollBraking=!1,i._autoScrollBrakingStartPosition=new Ir,i._outOfBoundaryAmount=new Ir,i._outOfBoundaryAmountDirty=!0,i._stopMouseWheel=!1,i._mouseWheelEventElapsedTime=0,i._isScrollEndedWithThresholdEventFired=!1,i._scrollEventEmitMask=0,i._isBouncing=!1,i._contentPos=new Ir,i._deltaPos=new Ir,i._deltaAmount=new Ir,i._hoverIn=0,i}e(i,t);var n=i.prototype;return n.scrollToBottom=function(t,i){void 0===i&&(i=!0),this.ZV(0,0,!1,!0,t,i)},n.scrollToTop=function(t,i){void 0===i&&(i=!0),this.ZV(0,1,!1,!0,t,i)},n.scrollToLeft=function(t,i){void 0===i&&(i=!0),this.ZV(0,0,!0,!1,t,i)},n.scrollToRight=function(t,i){void 0===i&&(i=!0),this.ZV(1,0,!0,!1,t,i)},n.scrollToTopLeft=function(t,i){void 0===i&&(i=!0),this.ZV(0,1,!0,!0,t,i)},n.scrollToTopRight=function(t,i){void 0===i&&(i=!0),this.ZV(1,1,!0,!0,t,i)},n.scrollToBottomLeft=function(t,i){void 0===i&&(i=!0),this.ZV(0,0,!0,!0,t,i)},n.scrollToBottomRight=function(t,i){void 0===i&&(i=!0),this.ZV(1,0,!0,!0,t,i)},n.scrollToOffset=function(t,i,n){void 0===n&&(n=!0);var r=this.getMaxScrollOffset(),s=Cs();0===r.x?s.x=0:s.x=t.x/r.x,0===r.y?s.y=1:s.y=(r.y-t.y)/r.y,this.scrollTo(s,i,n)},n.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,i=this._getContentLeftBoundary()-this._leftBoundary;return new Ms(i,t)},n.getMaxScrollOffset=function(){if(!this._content||!this.view)return Ms.ZERO;var t=this._content.qu().contentSize,i=t.width-this.view.width,n=t.height-this.view.height;return new Ms(i=i>=0?i:0,n=n>=0?n:0)},n.scrollToPercentHorizontal=function(t,i,n){this.ZV(t,0,!0,!1,i,n)},n.scrollTo=function(t,i,n){this.ZV(t.x,t.y,!0,!0,i,n)},n.scrollToPercentVertical=function(t,i,n){this.ZV(0,t,!1,!0,i,n)},n.ZV=function(t,i,n,r,s,e){void 0===e&&(e=!0),pkt(t,i,n,r);var h=this._calculateMovePercentDelta(gkt);s?this._startAutoScroll(h,s,e):this._moveContent(h)},n.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},n.setContentPosition=function(t){this.t$(t)},n.t$=function(t){if(this._content){var i=this.i$();Math.abs(t.x-i.x)<ckt&&Math.abs(t.y-i.y)<ckt||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},n.getContentPosition=function(){return this.i$()},n.i$=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):Ir.ZERO.clone()},n.isScrolling=function(){return this._scrolling},n.isAutoScrolling=function(){return this._autoScrolling},n.getScrollEndedEventTiming=function(){return ckt},n.start=function(){this._calculateBoundary(),this._content&&xN.once("director_before_draw",this._adjustContentOutOfBoundary,this)},n.onEnable=function(){var t=this;t._registerEvent();var i=this._content;if(i){i.on("size-changed",t._calculateBoundary,t),i.on("transform-changed",t._scaleChanged,t);var n=t.view;n&&(n.node.on("transform-changed",t._scaleChanged,t),n.node.on("size-changed",t._calculateBoundary,t))}t._calculateBoundary(),t._updateScrollBarState()},n.update=function(t){var i=this._deltaAmount;this._autoScrolling?(this._processAutoScrolling(t),i.x=0,i.y=0):0===i.x&&0===i.y||(this._processDeltaMove(i),i.x=0,i.y=0)},n.onDisable=function(){var t=this;t._unregisterEvent();var i=t.content;if(i){i.off("size-changed",t._calculateBoundary,t),i.off("transform-changed",t._scaleChanged,t);var n=t.view;n&&(n.node.off("transform-changed",t._scaleChanged,t),n.node.off("size-changed",t._calculateBoundary,t))}t._deltaAmount.set(0,0),t._hideScrollBar(),t.stopAutoScroll()},n._registerEvent=function(){var t=this,i=t.node;i.on("touch-start",t._onTouchBegan,t,!0),i.on("touch-move",t._onTouchMoved,t,!0),i.on("touch-end",t._onTouchEnded,t,!0),i.on("touch-cancel",t._onTouchCancelled,t,!0),i.on("mouse-wheel",t._onMouseWheel,t,!0),PM.on("handle-input",t.n$,t),PM.on("gamepad-input",t.n$,t)},n._unregisterEvent=function(){var t=this,i=t.node;i.off("touch-start",t._onTouchBegan,t,!0),i.off("touch-move",t._onTouchMoved,t,!0),i.off("touch-end",t._onTouchEnded,t,!0),i.off("touch-cancel",t._onTouchCancelled,t,!0),i.off("mouse-wheel",t._onMouseWheel,t,!0),PM.off("handle-input",t.n$,t),PM.off("gamepad-input",t.n$,t)},n._onMouseWheel=function(t,i){var n=this;if(n.enabledInHierarchy&&!n._hasNestedViewGroup(t,i)){var r=t.getScrollY(),s=akt;n.vertical?s.set(0,-.1*r,0):n.horizontal&&s.set(-.1*r,0,0),n._mouseWheelEventElapsedTime=0,n._deltaAmount.add(s),n._stopMouseWheel||(n._handlePressLogic(),n.schedule(this._checkMouseWheel,1/60),n._stopMouseWheel=!0),n._stopPropagationIfTargetIsMe(t)}},n._onTouchBegan=function(t,i){var n=this;n.enabledInHierarchy&&n._content&&(n._hasNestedViewGroup(t,i)||(n._handlePressLogic(),n._touchMoved=!1,n._stopPropagationIfTargetIsMe(t)))},n._onTouchMoved=function(t,i){var n=this;if(n.enabledInHierarchy&&n._content&&!n._hasNestedViewGroup(t,i)){var r=t.touch;if(n._handleMoveLogic(r),n.cancelInnerEvents){var s=r.getUILocation(vkt);if(s.subtract(r.getUIStartLocation(lkt)),s.length()>7&&!n._touchMoved&&t.target!==n.node){var e=new JA(t.getTouches(),t.bubbles,"touch-cancel");e.touch=t.touch,e.simulate=!0,t.target.dispatchEvent(e),n._touchMoved=!0}n._stopPropagationIfTargetIsMe(t)}}},n._onTouchEnded=function(t,i){var n=this;if(n.enabledInHierarchy&&n._content&&t&&!n._hasNestedViewGroup(t,i)){n._dispatchEvent("touch-up");var r=t.touch;n._handleReleaseLogic(r),n._touchMoved?t.propagationStopped=!0:n._stopPropagationIfTargetIsMe(t)}},n._onTouchCancelled=function(t,i){var n=this;n.enabledInHierarchy&&n._content&&(n._hasNestedViewGroup(t,i)||(t&&!t.simulate&&n._handleReleaseLogic(t.touch),n._stopPropagationIfTargetIsMe(t)))},n._calculateBoundary=function(){var t=this;if(t._content&&t.view){var i=t._content.getComponent(rbt);i&&i.enabledInHierarchy&&i.updateLayout();var n=t.view,r=n.width*n.anchorX,s=n.height*n.anchorY;t._leftBoundary=-r,t._bottomBoundary=-s,t._rightBoundary=t._leftBoundary+n.width,t._topBoundary=t._bottomBoundary+n.height,t._moveContentToTopLeft(n.contentSize)}},n._hasNestedViewGroup=function(t,i){if(!t||t.eventPhase!==XA.CAPTURING_PHASE)return!1;if(i)for(var n=0;n<i.length;n++){var r=i[n];if(this.node===r)return!(!t.target||!t.target.getComponent(Kbt));if(r.getComponent(Kbt))return!0}return!1},n._startInertiaScroll=function(t){akt.set(t),akt.multiplyScalar(.7),this._startAttenuatingAutoScroll(akt,t)},n._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},n._startAttenuatingAutoScroll=function(t,i){var n=t.clone();if(n.normalize(),this._content&&this.view){var r=this._content.qu().contentSize,s=this.view.contentSize,e=r.width-s.width,h=r.height-s.height,u=this._calculateAttenuatedFactor(e),o=this._calculateAttenuatedFactor(h);n.x=n.x*e*(1-this.brake)*u,n.y=n.y*h*o*(1-this.brake),n.z=0}var c=t.length(),a=n.length()/c;this.brake>0&&a>7?(a=Math.sqrt(a),n.set(t),n.multiplyScalar(a+1)):n.add(t);var f=this._calculateAutoScrollTimeByInitialSpeed(i.length());this.brake>0&&a>3&&(f*=a=3),0===this.brake&&a>1&&(f*=a),this._startAutoScroll(n,f,!0)},n._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},n._startAutoScroll=function(t,i,n){void 0===n&&(n=!1);var r=this,s=r._flattenVectorByDirection(t);r._autoScrolling=!0,r._autoScrollTargetDelta=s,r._autoScrollAttenuate=n,Ir.copy(r._autoScrollStartPosition,r.i$()),r._autoScrollTotalTime=i,r._autoScrollAccumulatedTime=0,r._autoScrollBraking=!1,r._isScrollEndedWithThresholdEventFired=!1,r._autoScrollBrakingStartPosition.set(0,0,0),r._getHowMuchOutOfBoundary().equals(Ir.ZERO,ckt)||(this._autoScrollCurrentlyOutOfBoundary=!0)},n._calculateTouchMoveVelocity=function(){var t=new Ir,i=0;if((i=this._touchMoveTimeDeltas.reduce((function(t,i){return t+i}),i))<=0||i>=.5)t.set(Ir.ZERO);else{var n=akt;n.set(0,0,0),n=this._touchMoveDisplacements.reduce((function(t,i){return t.add(i),t}),n),t.set(n.x*(1-this.brake)/i,n.y*(1-this.brake)/i,n.z)}return t},n._flattenVectorByDirection=function(t){return this.horizontal||(t.x=0),this.vertical||(t.y=0),t},n._moveContent=function(t,i){var n=this._flattenVectorByDirection(t);akt.set(this.i$()),akt.add(n),akt.set(Math.round(1e4*akt.x)*ckt,Math.round(1e4*akt.y)*ckt,akt.z),this.t$(akt);var r=this._getHowMuchOutOfBoundary();vkt.set(r.x,r.y),this._updateScrollBar(vkt),this.elastic&&i&&this._startBounceBackIfNeeded()},n._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this.i$(),i=this._content.qu();return t.x-i.anchorX*i.width},n._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content.qu();return this._getContentLeftBoundary()+t.width},n._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content.qu();return this._getContentBottomBoundary()+t.height},n._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this.i$(),i=this._content.qu();return t.y-i.anchorY*i.height},n._getHowMuchOutOfBoundary=function(t){if(t||(t=Ir.ZERO),t.equals(Ir.ZERO,ckt)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var i=new Ir,n=this._getContentLeftBoundary(),r=this._getContentRightBoundary();n+t.x>this._leftBoundary?i.x=this._leftBoundary-(n+t.x):r+t.x<this._rightBoundary&&(i.x=this._rightBoundary-(r+t.x));var s=this._getContentTopBoundary(),e=this._getContentBottomBoundary();return s+t.y<this._topBoundary?i.y=this._topBoundary-(s+t.y):e+t.y>this._bottomBoundary&&(i.y=this._bottomBoundary-(e+t.y)),t.equals(Ir.ZERO,ckt)&&(this._outOfBoundaryAmount=i,this._outOfBoundaryAmountDirty=!1),this._clampDelta(i),i},n._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onScroll(t),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onScroll(t)},n._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchBegan(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchBegan()},n._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchEnded(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchEnded()},n._dispatchEvent=function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var i=1<<wkt[t];if(this._scrollEventEmitMask&i)return;this._scrollEventEmitMask|=i}Xg.emitEvents(this.scrollEvents,this,wkt[t]),this.node.emit(t,this)},n._adjustContentOutOfBoundary=function(){if(this._content){this._outOfBoundaryAmountDirty=!0;var t=this._getHowMuchOutOfBoundary();!t.equals(Ir.ZERO,ckt)&&(akt.set(this.i$()),akt.add(t),this.t$(akt),this._updateScrollBar(Ms.ZERO))}},n._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.hide()},n._updateScrollBarState=function(){var t=this;if(t._content&&t.view){var i=t.view,n=t._content.qu(),r=t._verticalScrollBar;r&&r.isValid&&(n.height<i.height||xn(n.height,i.height)?r.hide():r.show());var s=t._horizontalScrollBar;s&&s.isValid&&(n.width<i.width||xn(n.width,i.width)?s.hide():s.show())}},n._stopPropagationIfTargetIsMe=function(t){t.eventPhase===XA.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},n._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},n._handleMoveLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._deltaAmount.add(this._deltaPos)},n._handleReleaseLogic=function(t){var i=this;i._getLocalAxisAlignDelta(i._deltaPos,t),i._gatherTouchMove(i._deltaPos),i._processInertiaScroll(),i._scrolling&&(i._scrolling=!1,i._autoScrolling||i._dispatchEvent("scroll-ended"))},n._getLocalAxisAlignDelta=function(t,i){var n=this.node.qu();n&&(i.getUILocation(vkt),i.getUIPreviousLocation(lkt),akt.set(vkt.x,vkt.y,0),fkt.set(lkt.x,lkt.y,0),n.convertToNodeSpaceAR(akt,akt),n.convertToNodeSpaceAR(fkt,fkt),Ir.subtract(t,akt,fkt))},n._scrollChildren=function(t){var i=this;i._clampDelta(t);var n,r=t;i.elastic&&(n=i._getHowMuchOutOfBoundary(),r.x*=0===n.x?1:.5,r.y*=0===n.y?1:.5),i.elastic||(n=i._getHowMuchOutOfBoundary(r),r.add(n));var s="",e="";if(i._content){var h=i._content.qu(),u=h.anchorX,o=h.anchorY,c=h.width,a=h.height,f=i._content.position||Ir.ZERO;i.vertical&&(r.y>0?f.y-o*a+r.y>=i._bottomBoundary&&(s="scroll-to-bottom"):r.y<0&&f.y-o*a+a+r.y<=i._topBoundary&&(s="scroll-to-top")),i.horizontal&&(r.x<0?f.x-u*c+c+r.x<=i._rightBoundary&&(e="scroll-to-right"):r.x>0&&f.x-u*c+r.x>=i._leftBoundary&&(e="scroll-to-left"))}i._moveContent(r,!1),(i.horizontal&&0!==r.x||i.vertical&&0!==r.y)&&(i._scrolling||(i._scrolling=!0,i._dispatchEvent("scroll-began")),i._dispatchEvent("scrolling")),""!==s&&i._dispatchEvent(s),""!==e&&i._dispatchEvent(e)},n._handlePressLogic=function(){var t=this;t._autoScrolling&&t._dispatchEvent("scroll-ended"),t._autoScrolling=!1,t._isBouncing=!1,t._touchMovePreviousTimestamp=dkt(),t._touchMoveDisplacements.length=0,t._touchMoveTimeDeltas.length=0,t._onScrollBarTouchBegan()},n._clampDelta=function(t){if(this._content&&this.view){var i=this.view.contentSize,n=this._content.qu();n.width<i.width&&(t.x=0),n.height<i.height&&(t.y=0)}},n._gatherTouchMove=function(t){var i=this,n=t.clone();for(i._clampDelta(n);i._touchMoveDisplacements.length>=5;)i._touchMoveDisplacements.shift(),i._touchMoveTimeDeltas.shift();i._touchMoveDisplacements.push(n);var r=dkt();i._touchMoveTimeDeltas.push((r-i._touchMovePreviousTimestamp)/1e3),i._touchMovePreviousTimestamp=r},n._startBounceBackIfNeeded=function(){var t=this;if(!t.elastic)return!1;var i=t._getHowMuchOutOfBoundary();if(t._clampDelta(i),i.equals(Ir.ZERO,ckt))return!1;var n=Math.max(t.bounceDuration,0);return t._startAutoScroll(i,n,!0),t._isBouncing||(i.y>0&&t._dispatchEvent("bounce-top"),i.y<0&&t._dispatchEvent("bounce-bottom"),i.x>0&&t._dispatchEvent("bounce-right"),i.x<0&&t._dispatchEvent("bounce-left"),t._isBouncing=!0),!0},n._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(Ir.ZERO,ckt)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},n._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(Ir.ZERO,ckt)},n._isNecessaryAutoScrollBrake=function(){var t=this;if(t._autoScrollBraking)return!0;if(t._isOutOfBoundary()){if(!t._autoScrollCurrentlyOutOfBoundary)return t._autoScrollCurrentlyOutOfBoundary=!0,t._autoScrollBraking=!0,Ir.copy(t._autoScrollBrakingStartPosition,t.i$()),!0}else t._autoScrollCurrentlyOutOfBoundary=!1;return!1},n._processAutoScrolling=function(t){var i=this,n=i._isNecessaryAutoScrollBrake(),r=n?.05:1;i._autoScrollAccumulatedTime+=t*(1/r);var s,e=Math.min(1,i._autoScrollAccumulatedTime/i._autoScrollTotalTime);i._autoScrollAttenuate&&(s=e,e=(s-=1)*s*s*s*s+1);var h=i._autoScrollTargetDelta.clone();h.multiplyScalar(e);var u=i._autoScrollStartPosition.clone();u.add(h);var o=Math.abs(e-1)<=ckt;if(Math.abs(e-1)<=i.getScrollEndedEventTiming()&&!i._isScrollEndedWithThresholdEventFired&&(i._dispatchEvent("scroll-ended-with-threshold"),i._isScrollEndedWithThresholdEventFired=!0),i.elastic){var c=u.clone();c.subtract(i._autoScrollBrakingStartPosition),n&&c.multiplyScalar(r),u.set(i._autoScrollBrakingStartPosition),u.add(c)}else{var a=u.clone();a.subtract(i.getContentPosition());var f=i._getHowMuchOutOfBoundary(a);f.equals(Ir.ZERO,ckt)||(u.add(f),o=!0)}o&&(i._autoScrolling=!1);var v=u.clone();v.subtract(i.i$()),i._clampDelta(v),i._moveContent(v,o),i._dispatchEvent("scrolling"),i._autoScrolling||(i._isBouncing=!1,i._scrolling=!1,i._dispatchEvent("scroll-ended"))},n._checkMouseWheel=function(t){var i=this;if(!i._getHowMuchOutOfBoundary().equals(Ir.ZERO,ckt))return i._processInertiaScroll(),i._scrolling&&(i._scrolling=!1,i._autoScrolling||i._dispatchEvent("scroll-ended")),i.unschedule(i._checkMouseWheel),void(i._stopMouseWheel=!1);i._mouseWheelEventElapsedTime+=t,i._mouseWheelEventElapsedTime>.1&&(i._onScrollBarTouchEnded(),i._scrolling&&(i._scrolling=!1,i._autoScrolling||i._dispatchEvent("scroll-ended")),i.unschedule(i._checkMouseWheel),i._stopMouseWheel=!1)},n._calculateMovePercentDelta=function(t){var i=t.anchor,n=t.applyToHorizontal,r=t.applyToVertical,s=this;s._calculateBoundary(),i.clampf(Ms.ZERO,Ms.ONE);var e=s._getContentBottomBoundary()-s._bottomBoundary;e=-e;var h=s._getContentLeftBoundary()-s._leftBoundary;h=-h;var u=new Ir;if(s._content&&s.view){var o=0,c=s._content.qu().contentSize,a=s.view.contentSize;n&&(o=c.width-a.width,u.x=h-o*i.x),r&&(o=c.height-a.height,u.y=e-o*i.y)}return u},n._moveContentToTopLeft=function(t){var i=this,n=i._getContentBottomBoundary()-i._bottomBoundary;n=-n;var r=new Ir,s=0,e=i._getContentLeftBoundary()-i._leftBoundary;if(e=-e,i._content){var h=i._content.qu().contentSize;h.height<t.height&&(s=h.height-t.height,r.y=n-s),h.width<t.width&&(s=h.width-t.width,r.x=e)}i._updateScrollBarState(),i._moveContent(r),i._adjustContentOutOfBoundary()},n._scaleChanged=function(t){4===t&&this._calculateBoundary()},n._xrHoverEnter=function(){},n._xrHoverExit=function(){},n.n$=function(t){t instanceof ZA?t.gamepad:t instanceof tE&&t.handleInputDevice,this.enabledInHierarchy},n._xrThumbStickMove=function(t){var i=this;if(i.enabledInHierarchy){var n=t.y,r=akt;i.vertical?r.set(0,-62.5*n,0):i.horizontal&&r.set(-62.5*n,0,0),i._mouseWheelEventElapsedTime=0,i._deltaAmount.add(r),i._stopMouseWheel||(i._handlePressLogic(),i.schedule(i._checkMouseWheel,1/60,NaN,0),i._stopMouseWheel=!0)}},r(i,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var i=t&&t.parent&&t.parent.qu();!t||t&&i?(this._content=t,this._calculateBoundary()):tt(4302)}}},{key:"horizontalScrollBar",get:function(){var t=this._horizontalScrollBar;return t&&!t.isValid&&ht(4303,"horizontal",this.node.name),t},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(Ms.ZERO)))}},{key:"verticalScrollBar",get:function(){var t=this._verticalScrollBar;return t&&!t.isValid&&ht(4303,"vertical",this.node.name),t},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(Ms.ZERO)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t.qu():null}}]),i}(Kbt),Ybt.EventType=_kt,Fbt=uo((Bbt=Ybt).prototype,"bounceDuration",[Co],(function(){return 1})),Ubt=uo(Bbt.prototype,"brake",[Co],(function(){return.5})),xbt=uo(Bbt.prototype,"elastic",[Co],(function(){return!0})),Gbt=uo(Bbt.prototype,"inertia",[Co],(function(){return!0})),y(Bbt.prototype,"content",[Cbt],Object.getOwnPropertyDescriptor(Bbt.prototype,"content"),Bbt.prototype),jbt=uo(Bbt.prototype,"horizontal",[Co],(function(){return!0})),y(Bbt.prototype,"horizontalScrollBar",[Nbt],Object.getOwnPropertyDescriptor(Bbt.prototype,"horizontalScrollBar"),Bbt.prototype),Hbt=uo(Bbt.prototype,"vertical",[Co],(function(){return!0})),y(Bbt.prototype,"verticalScrollBar",[Pbt],Object.getOwnPropertyDescriptor(Bbt.prototype,"verticalScrollBar"),Bbt.prototype),Vbt=uo(Bbt.prototype,"cancelInnerEvents",[Co],(function(){return!0})),$bt=uo(Bbt.prototype,"scrollEvents",[Lbt,Co],(function(){return[]})),zbt=uo(Bbt.prototype,"_content",[Co],(function(){return null})),Wbt=uo(Bbt.prototype,"_horizontalScrollBar",[Co],(function(){return null})),Xbt=uo(Bbt.prototype,"_verticalScrollBar",[Co],(function(){return null})),Dbt=Bbt))||Dbt)||Dbt)||Dbt));O.ScrollView=ykt;var mkt=new Ir,bkt={Horizontal:0,Vertical:1};bi(bkt);var kkt,Akt,Ekt,Tkt,Okt,Skt,Ikt,Rkt,Mkt,Ckt,Nkt,Pkt=t("eE",(qbt=_o("cc.Slider"),Qbt=mo(110),Jbt=yo(mB),Zbt=ic(tU),tkt=ic(bkt),ikt=ic([Xg]),qbt(nkt=Qbt(nkt=Jbt((okt=function(t){function i(){var i;return(i=t.call(this)||this).slideEvents=skt&&skt(),i._handle=ekt&&ekt(),i._direction=hkt&&hkt(),i._progress=ukt&&ukt(),i.Es=new Ir,i.r$=!1,i.s$=!1,i.e$=new Ir,i.h$=new Ir,i}e(i,t);var n=i.prototype;return n.__preload=function(){this._updateHandlePosition()},n.onEnable=function(){var t=this,i=t.node,n=t._handle;if(t._updateHandlePosition(),i.on("touch-start",t._onTouchBegan,t),i.on("touch-move",t._onTouchMoved,t),i.on("touch-end",t._onTouchEnded,t),i.on("touch-cancel",t._onTouchCancelled,t),n&&n.isValid){var r=n.node;r.on("touch-start",t._onHandleDragStart,t),r.on("touch-move",t._onTouchMoved,t),r.on("touch-end",t._onTouchEnded,t)}},n.onDisable=function(){var t=this,i=t.node,n=t._handle;if(i.off("touch-start",t._onTouchBegan,t),i.off("touch-move",t._onTouchMoved,t),i.off("touch-end",t._onTouchEnded,t),i.off("touch-cancel",t._onTouchCancelled,t),n&&n.isValid){var r=n.node;r.off("touch-start",t._onHandleDragStart,t),r.off("touch-move",t._onTouchMoved,t),r.off("touch-end",t._onTouchEnded,t)}},n._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node.qu()){this.r$=!0,this.s$=!0;var i=t.touch.getUILocation();Ir.set(this.h$,i.x,i.y,0),this._handle.node.qu().convertToNodeSpaceAR(this.h$,this.Es),t.propagationStopped=!0}},n._onTouchBegan=function(t){this._handle&&t&&(this.r$=!0,this.s$||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchMoved=function(t){this.r$&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchEnded=function(t){this.r$=!1,this.s$=!1,this.Es=new Ir,t&&(t.propagationStopped=!0)},n._onTouchCancelled=function(t){this.r$=!1,t&&(t.propagationStopped=!0)},n._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},n._emitSlideEvent=function(){Xg.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},n._updateProgress=function(t){if(this._handle&&t){var i=t.getUILocation();Ir.set(this.h$,i.x,i.y,0);var n=this.node.qu(),r=n.convertToNodeSpaceAR(this.h$,mkt);0===this.direction?this.progress=jn(.5+(r.x-this.Es.x)/n.width):this.progress=jn(.5+(r.y-this.Es.y)/n.height)}},n._updateHandlePosition=function(){if(this._handle){this.e$.set(this._handle.node.position);var t=this.node.qu();0===this._direction?this.e$.x=-t.width*t.anchorX+this.progress*t.width:this.e$.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this.e$)}},n.u$=function(){var t=this.node.qu(),i=t.contentSize;if(t.setContentSize(i.height,i.width),this._handle){var n=this._handle.node.position;0===this._direction?this._handle.node.setPosition(n.x,0,n.z):this._handle.node.setPosition(0,n.y,n.z),this._updateHandlePosition()}},n._xrHandleProgress=function(){},n._xrClick=function(){},n._xrUnClick=function(){},n._xrHoverStay=function(){},r(i,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.u$())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),i}(Kg),okt.Direction=bkt,y((rkt=okt).prototype,"handle",[Zbt],Object.getOwnPropertyDescriptor(rkt.prototype,"handle"),rkt.prototype),y(rkt.prototype,"direction",[tkt],Object.getOwnPropertyDescriptor(rkt.prototype,"direction"),rkt.prototype),skt=uo(rkt.prototype,"slideEvents",[ikt,Co],(function(){return[]})),ekt=uo(rkt.prototype,"_handle",[Co],(function(){return null})),hkt=uo(rkt.prototype,"_direction",[Co],(function(){return 0})),ukt=uo(rkt.prototype,"_progress",[Co],(function(){return.1})),nkt=rkt))||nkt)||nkt)||nkt));function Lkt(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(i))}O.Slider=Pkt;var Dkt,Bkt,Fkt,Ukt,xkt,Gkt,jkt,Hkt=t("eF",(kkt=_o("cc.Toggle"),Akt=mo(110),Ekt=yo(mB),Tkt=ic(tU),Okt=ic([Xg]),kkt(Skt=Akt(Skt=Ekt((Nkt=function(t){function i(){var i;return(i=t.call(this)||this).checkEvents=Rkt&&Rkt(),i._isChecked=Mkt&&Mkt(),i._checkMark=Ckt&&Ckt(),i}e(i,t);var n=i.prototype;return n._internalToggle=function(){this.isChecked=!this.isChecked},n._set=function(t,i){if(void 0===i&&(i=!0),this._isChecked!=t){this._isChecked=t;var n=this._toggleContainer;n&&n.enabled&&this.enabled&&(t||!n.anyTogglesChecked()&&!n.allowSwitchOff)&&(this._isChecked=!0,n.notifyToggleCheck(this,i)),this.playEffect(),i&&this._emitToggleEvents()}},n.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},n.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},n.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(i.EventType.CLICK,this._internalToggle,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(i.EventType.CLICK,this._internalToggle,this)},n._emitToggleEvents=function(){this.node.emit(i.EventType.TOGGLE,this),this.checkEvents&&Xg.emitEvents(this.checkEvents,this)},r(i,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return O.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),i}(myt),Nkt.EventType=Lkt({TOGGLE:"toggle"},yyt),y((Ikt=Nkt).prototype,"checkMark",[Tkt],Object.getOwnPropertyDescriptor(Ikt.prototype,"checkMark"),Ikt.prototype),Rkt=uo(Ikt.prototype,"checkEvents",[Okt,Co],(function(){return[]})),Mkt=uo(Ikt.prototype,"_isChecked",[Co],(function(){return!0})),Ckt=uo(Ikt.prototype,"_checkMark",[Co],(function(){return null})),Skt=Ikt))||Skt)||Skt)||Skt));O.Toggle=Hkt;var Vkt,$kt,zkt,Wkt,Xkt,Ykt,Kkt,qkt,Qkt,Jkt,Zkt,tAt,iAt,nAt,rAt,sAt,eAt,hAt,uAt,oAt,cAt,aAt,fAt,vAt,lAt,dAt,wAt=t("eG",(Dkt=_o("cc.ToggleContainer"),Bkt=mo(110),Fkt=ic([Xg]),Dkt(Ukt=Bkt((xkt=function(t){function i(){var i;return(i=t.call(this)||this)._allowSwitchOff=Gkt&&Gkt(),i.checkEvents=jkt&&jkt(),i}e(i,t);var n=i.prototype;return n.onEnable=function(){this.ensureValidState(),this.node.on("child-added",this.ensureValidState,this),this.node.on("child-removed",this.ensureValidState,this)},n.onDisable=function(){this.node.off("child-added",this.ensureValidState,this),this.node.off("child-removed",this.ensureValidState,this)},n.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},n.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},n.notifyToggleCheck=function(t,i){if(void 0===i&&(i=!0),this.enabledInHierarchy){for(var n=0;n<this.toggleItems.length;n++){var r=this.toggleItems[n];r!==t&&(i?r.isChecked=!1:r.setIsCheckedWithoutNotify(!1))}this.checkEvents&&O.Component.EventHandler.emitEvents(this.checkEvents,t)}},n.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var i=t[0];i.isChecked=!0,this.notifyToggleCheck(i)}var n=this.activeToggles();if(n.length>1)for(var r=n[0],s=0;s<n.length;++s){var e=n[s];e!==r&&(e.isChecked=!1)}},r(i,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var i=t.getComponent("cc.Toggle");return i&&i.enabled?i:null})).filter(Boolean)}}]),i}(Kg),Gkt=uo(xkt.prototype,"_allowSwitchOff",[Co],(function(){return!1})),jkt=uo(xkt.prototype,"checkEvents",[Fkt,Co],(function(){return[]})),Ukt=xkt))||Ukt)||Ukt));O.ToggleContainer=wAt;var gAt=new Ms;function pAt(t){var i=t.qu();return t instanceof kR?kh:i?i.contentSize:ie.ZERO}function _At(t,i,n,r){t.parent?gAt.set(t.parent.scale.x,t.parent.scale.y):gAt.set(0,0);for(var s=gAt.x,e=gAt.y,h=0,u=0,o=t.parent;;){if(!o)return n.x=n.y=0,void(r.x=r.y=1);var c=o.position;if(h+=c.x,u+=c.y,(o=o.parent)===i)break;o?gAt.set(o.scale.x,o.scale.y):gAt.set(0,0);var a=gAt.x,f=gAt.y;h*=a,u*=f,s*=a,e*=f}r.x=0!==s?1/s:1,r.y=0!==e?1/e:1,n.x=-h,n.y=-u}var yAt={ONCE:0,ALWAYS:1,ON_WINDOW_RESIZE:2};bi(yAt);var mAt,bAt,kAt,AAt,EAt,TAt,OAt,SAt,IAt,RAt,MAt,CAt,NAt={TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32,HORIZONTAL:56,VERTICAL:7},PAt=t("eI",(Vkt=_o("cc.Widget"),$kt=mo(110),zkt=yo(mB),Wkt=ic(WE),Xkt=ic(yAt),Vkt(Ykt=$kt(Ykt=zkt((dAt=function(t){function i(){var i;return(i=t.call(this)||this)._lastPos=new Ir,i._lastSize=new ie,i._dirty=!0,i._hadAlignOnce=!1,i._alignFlags=qkt&&qkt(),i._target=Qkt&&Qkt(),i._left=Jkt&&Jkt(),i._right=Zkt&&Zkt(),i._top=tAt&&tAt(),i._bottom=iAt&&iAt(),i._horizontalCenter=nAt&&nAt(),i._verticalCenter=rAt&&rAt(),i._isAbsLeft=sAt&&sAt(),i._isAbsRight=eAt&&eAt(),i._isAbsTop=hAt&&hAt(),i._isAbsBottom=uAt&&uAt(),i._isAbsHorizontalCenter=oAt&&oAt(),i._isAbsVerticalCenter=cAt&&cAt(),i._originalWidth=aAt&&aAt(),i._originalHeight=fAt&&fAt(),i._alignMode=vAt&&vAt(),i._lockFlags=lAt&&lAt(),i}e(i,t);var n=i.prototype;return n.updateAlignment=function(){T._widgetManager.updateAlignment(this.node)},n._validateTargetInDEV=function(){},n.setDirty=function(){this.o$()},n.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node.qu().contentSize),T._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},n.onDisable=function(){T._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},n.onDestroy=function(){this._removeParentEvent()},n._adjustWidgetToAllowMovingInEditor=function(){},n._adjustWidgetToAllowResizingInEditor=function(){},n._adjustWidgetToAnchorChanged=function(){this.setDirty()},n._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},n._registerEvent=function(){this.node.on("transform-changed",this._setDirtyByMode,this),this.node.on("size-changed",this._setDirtyByMode,this),this.node.on("anchor-changed",this._adjustWidgetToAnchorChanged,this),this.node.on("parent-changed",this._adjustTargetToParentChanged,this)},n._unregisterEvent=function(){this.node.off("transform-changed",this._setDirtyByMode,this),this.node.off("size-changed",this._setDirtyByMode,this),this.node.off("anchor-changed",this._adjustWidgetToAnchorChanged,this)},n._removeParentEvent=function(){this.node.off("parent-changed",this._adjustTargetToParentChanged,this)},n._autoChangedValue=function(t,i){if((this._alignFlags&t)>0){var n=this.node.parent&&this.node.parent._uiProps,r=n&&n.uiTransformComp,s=r?r.contentSize:kh;this.isAlignLeft&&8===t?this._left=i?this._left*s.width:this._left/s.width:this.isAlignRight&&32===t?this._right=i?this._right*s.width:this._right/s.width:this.isAlignHorizontalCenter&&16===t?this._horizontalCenter=i?this._horizontalCenter*s.width:this._horizontalCenter/s.width:this.isAlignTop&&1===t?this._top=i?this._top*s.height:this._top/s.height:this.isAlignBottom&&4===t?this._bottom=i?this._bottom*s.height:this._bottom/s.height:this.isAbsoluteVerticalCenter&&2===t&&(this._verticalCenter=this._verticalCenter/s.height),this.o$()}},n._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(mB)&&(t.on("transform-changed",this._setDirtyByMode,this),t.on("size-changed",this._setDirtyByMode,this),t.on("anchor-changed",this._setDirtyByMode,this))},n._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off("transform-changed",this._setDirtyByMode,this),t.off("size-changed",this._setDirtyByMode,this),t.off("anchor-changed",this._setDirtyByMode,this))},n._unregisterOldParentEvents=function(t){var i=this._target||t;i&&(i.off("transform-changed",this._setDirtyByMode,this),i.off("size-changed",this._setDirtyByMode,this),i.off("anchor-changed",this._setDirtyByMode,this))},n._setDirtyByMode=function(){1===this.alignMode&&this.o$()},n.c$=function(t,i){if(i!==(this._alignFlags&t)>0){var n=(40&t)>0,r=this.node.qu();i?(this._alignFlags|=t,n?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=r.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=r.height))):(n?this.isStretchWidth&&(r.width=this._originalWidth):this.isStretchHeight&&(r.height=this._originalHeight),this._alignFlags&=~t)}},n.o$=function(){this._dirty||(this._dirty=!0)},r(i,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this.o$())}},{key:"isAlignTop",get:function(){return(1&this._alignFlags)>0},set:function(t){this.c$(1,t),this.o$()}},{key:"isAlignBottom",get:function(){return(4&this._alignFlags)>0},set:function(t){this.c$(4,t),this.o$()}},{key:"isAlignLeft",get:function(){return(8&this._alignFlags)>0},set:function(t){this.c$(8,t),this.o$()}},{key:"isAlignRight",get:function(){return(32&this._alignFlags)>0},set:function(t){this.c$(32,t),this.o$()}},{key:"isAlignVerticalCenter",get:function(){return(2&this._alignFlags)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=2):this._alignFlags&=-3,this.o$()}},{key:"isAlignHorizontalCenter",get:function(){return(16&this._alignFlags)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=16):this._alignFlags&=-17,this.o$()}},{key:"isStretchWidth",get:function(){return!(40&~this._alignFlags)}},{key:"isStretchHeight",get:function(){return!(5&~this._alignFlags)}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this.o$()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this.o$()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this.o$()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this.o$()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this.o$()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this.o$()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this.o$()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this.o$()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this.o$()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this.o$()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this.o$()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this.o$()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(1,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(4,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(8,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(32,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(16,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(2,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this.o$()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this.o$())}}]),i}(Kg),dAt.AlignMode=yAt,y((Kkt=dAt).prototype,"target",[Wkt],Object.getOwnPropertyDescriptor(Kkt.prototype,"target"),Kkt.prototype),y(Kkt.prototype,"alignMode",[Xkt],Object.getOwnPropertyDescriptor(Kkt.prototype,"alignMode"),Kkt.prototype),qkt=uo(Kkt.prototype,"_alignFlags",[Co],(function(){return 0})),Qkt=uo(Kkt.prototype,"_target",[Co],(function(){return null})),Jkt=uo(Kkt.prototype,"_left",[Co],(function(){return 0})),Zkt=uo(Kkt.prototype,"_right",[Co],(function(){return 0})),tAt=uo(Kkt.prototype,"_top",[Co],(function(){return 0})),iAt=uo(Kkt.prototype,"_bottom",[Co],(function(){return 0})),nAt=uo(Kkt.prototype,"_horizontalCenter",[Co],(function(){return 0})),rAt=uo(Kkt.prototype,"_verticalCenter",[Co],(function(){return 0})),sAt=uo(Kkt.prototype,"_isAbsLeft",[Co],(function(){return!0})),eAt=uo(Kkt.prototype,"_isAbsRight",[Co],(function(){return!0})),hAt=uo(Kkt.prototype,"_isAbsTop",[Co],(function(){return!0})),uAt=uo(Kkt.prototype,"_isAbsBottom",[Co],(function(){return!0})),oAt=uo(Kkt.prototype,"_isAbsHorizontalCenter",[Co],(function(){return!0})),cAt=uo(Kkt.prototype,"_isAbsVerticalCenter",[Co],(function(){return!0})),aAt=uo(Kkt.prototype,"_originalWidth",[Co],(function(){return 0})),fAt=uo(Kkt.prototype,"_originalHeight",[Co],(function(){return 0})),vAt=uo(Kkt.prototype,"_alignMode",[Co],(function(){return 2})),lAt=uo(Kkt.prototype,"_lockFlags",[Co,Po],(function(){return 0})),Ykt=Kkt))||Ykt)||Ykt)||Ykt));T.internal.computeInverseTransForTarget=_At,T.internal.getReadonlyNodeSize=pAt,T.Widget=PAt;var LAt=new Qs,DAt={HORIZONTAL:0,VERTICAL:1};bi(DAt);var BAt,FAt,UAt,xAt,GAt,jAt,HAt,VAt,$At,zAt,WAt,XAt,YAt,KAt,qAt,QAt,JAt,ZAt,tEt,iEt,nEt,rEt,sEt,eEt,hEt=t("eK",(mAt=_o("cc.PageViewIndicator"),bAt=mo(110),kAt=ic(wL),AAt=ic(DAt),EAt=ic(ie),mAt(TAt=bAt((CAt=function(t){function i(){var i;return(i=t.call(this)||this).spacing=SAt&&SAt(),i._spriteFrame=IAt&&IAt(),i._direction=RAt&&RAt(),i._cellSize=MAt&&MAt(),i._layout=null,i._pageView=null,i._indicators=[],i}e(i,t);var n=i.prototype;return n.onLoad=function(){this._updateLayout()},n.setPageView=function(t){this._pageView=t,this._refresh()},n._updateLayout=function(){this._layout=this.getComponent(rbt),this._layout||(this._layout=this.addComponent(rbt));var t=this._layout;0===this.direction?(t.type=1,t.spacingX=this.spacing):1===this.direction&&(t.type=2,t.spacingY=this.spacing),t.resizeMode=1},n._createIndicator=function(){var t=new WE;t.layer=this.node.layer;var i=t.addComponent(tU);return i.spriteFrame=this.spriteFrame,i.sizeMode=0,t.parent=this.node,t.qu().setContentSize(this._cellSize),t},n._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var i=this._pageView.curPageIdx;if(!(i>=t.length)){for(var n=0;n<t.length;++n){var r=t[n];if(r._uiProps.uiComp){var s=r._uiProps.uiComp;LAt.set(s.color),LAt.a=127.5,s.color=LAt}}if(t[i]._uiProps.uiComp){var e=t[i]._uiProps.uiComp;LAt.set(e.color),LAt.a=255,e.color=LAt}}}},n._refresh=function(){if(this._pageView){var t=this._indicators,i=this._pageView.getPages();if(i.length!==t.length){var n=0;if(i.length>t.length)for(n=0;n<i.length;++n)t[n]||(t[n]=this._createIndicator());else for(n=t.length-i.length;n>0;--n){var r=t[n-1];this.node.removeChild(r),t.splice(n-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},r(i,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),i}(Kg),CAt.Direction=DAt,y((OAt=CAt).prototype,"spriteFrame",[kAt],Object.getOwnPropertyDescriptor(OAt.prototype,"spriteFrame"),OAt.prototype),y(OAt.prototype,"direction",[AAt],Object.getOwnPropertyDescriptor(OAt.prototype,"direction"),OAt.prototype),y(OAt.prototype,"cellSize",[EAt],Object.getOwnPropertyDescriptor(OAt.prototype,"cellSize"),OAt.prototype),SAt=uo(OAt.prototype,"spacing",[Co],(function(){return 0})),IAt=uo(OAt.prototype,"_spriteFrame",[Co],(function(){return null})),RAt=uo(OAt.prototype,"_direction",[Co],(function(){return 0})),MAt=uo(OAt.prototype,"_cellSize",[Co],(function(){return new ie(20,20)})),TAt=OAt))||TAt)||TAt));O.PageViewIndicator=hEt;var uEt=new Ms,oEt={Unified:0,Free:1};bi(oEt);var cEt={HORIZONTAL:0,VERTICAL:1};bi(cEt);var aEt=t("eJ",(BAt=_o("cc.PageView"),FAt=mo(110),UAt=ic(oEt),xAt=ic(cEt),GAt=ic(hEt),jAt=ic(Sbt),HAt=ic(Sbt),VAt=ic([Xg]),$At=ic([Xg]),BAt(zAt=FAt((eEt=function(t){function i(){var i;return(i=t.call(this)||this).autoPageTurningThreshold=XAt&&XAt(),i.horizontal=YAt&&YAt(),i.vertical=KAt&&KAt(),i.cancelInnerEvents=qAt&&qAt(),i.scrollEvents=QAt&&QAt(),i.pageTurningSpeed=JAt&&JAt(),i.pageEvents=ZAt&&ZAt(),i._sizeMode=tEt&&tEt(),i._direction=iEt&&iEt(),i._scrollThreshold=nEt&&nEt(),i._pageTurningEventTiming=rEt&&rEt(),i._indicator=sEt&&sEt(),i._curPageIdx=0,i._lastPageIdx=0,i._pages=[],i._initContentPos=Rr(),i._scrollCenterOffsetX=[],i._scrollCenterOffsetY=[],i._touchBeganPosition=Cs(),i._touchEndPosition=Cs(),i}e(i,t);var n=i.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on("size-changed",this._updateAllPagesSize,this),this.node.on(i.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off("size-changed",this._updateAllPagesSize,this),this.node.off(i.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},n.getCurrentPageIndex=function(){return this._curPageIdx},n.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},n.getPages=function(){return this._pages},n.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t.qu()?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):tt(4301))},n.insertPage=function(t,i){if(!(i<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(i>=this._pages.length)this.addPage(t);else{if(!t.qu())return void tt(4301);this._pages.splice(i,0,t),this.content.insertChild(t,i),this._updatePageView()}},n.removePage=function(t){if(t&&this.content){var i=this._pages.indexOf(t);-1!==i?this.removePageAtIndex(i):st(4300,t.name)}},n.removePageAtIndex=function(t){var i=this._pages;if(!(t<0||t>=i.length)){var n=i[t];n&&this.content&&(this.content.removeChild(n),i.splice(t,1),this._updatePageView())}},n.removeAllPages=function(){if(this.content){for(var t=this._pages,i=0,n=t.length;i<n;i++)this.content.removeChild(t[i]);this._pages.length=0,this._updatePageView()}},n.scrollToPage=function(t,i){void 0===i&&(i=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),i,!0),this.indicator&&this.indicator._changedState())},n.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},n._updatePageView=function(){if(this.content){var t=this.content.getComponent(rbt);t&&t.enabled&&t.updateLayout();var i=this._pages.length;this._curPageIdx>=i&&(this._curPageIdx=0===i?0:i-1,this._lastPageIdx=this._curPageIdx);for(var n=this._initContentPos,r=0;r<i;++r){var s=this._pages[r].position;0===this.direction?this._scrollCenterOffsetX[r]=Math.abs(n.x+s.x):this._scrollCenterOffsetY[r]=Math.abs(n.y+s.y)}this.indicator&&this.indicator._refresh()}},n._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&0===this._sizeMode)for(var i=this._pages,n=t.contentSize,r=0,s=i.length;r<s;r++)i[r].qu().setContentSize(n)},n._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(i.EventType.SCROLL_ENDED))},n._onTouchBegan=function(i,n){i.touch.getUILocation(uEt),Ms.set(this._touchBeganPosition,uEt.x,uEt.y),t.prototype._onTouchBegan.call(this,i,n)},n._onTouchMoved=function(i,n){t.prototype._onTouchMoved.call(this,i,n)},n._onTouchEnded=function(i,n){i.touch.getUILocation(uEt),Ms.set(this._touchEndPosition,uEt.x,uEt.y),t.prototype._onTouchEnded.call(this,i,n)},n._onTouchCancelled=function(i,n){i.touch.getUILocation(uEt),Ms.set(this._touchEndPosition,uEt.x,uEt.y),t.prototype._onTouchCancelled.call(this,i,n)},n._onMouseWheel=function(){},n._syncScrollDirection=function(){this.horizontal=0===this.direction,this.vertical=1===this.direction},n._syncSizeMode=function(){var t=this.view;if(this.content&&t){var i=this.content.getComponent(rbt);if(i){if(1===this._sizeMode&&this._pages.length>0){var n=this._pages[0].qu(),r=this._pages[this._pages.length-1].qu();0===this.direction?(i.paddingLeft=(t.width-n.width)/2,i.paddingRight=(t.width-r.width)/2):1===this.direction&&(i.paddingTop=(t.height-n.height)/2,i.paddingBottom=(t.height-r.height)/2)}i.updateLayout()}}},n._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,i=0;i<t.length;++i){var n=t[i];this._pages.indexOf(n)>=0||this._pages.push(n)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},n._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,Xg.emitEvents(this.pageEvents,this,"page-turning"),this.node.emit("page-turning",this))},n._isQuicklyScrollable=function(t){if(0===this.direction){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(1===this.direction&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},n._moveOffsetValue=function(t){var i=new Ms;if(1===this._sizeMode)0===this.direction?i.x=this._scrollCenterOffsetX[t]:1===this.direction&&(i.y=this._scrollCenterOffsetY[t]);else{var n=this.view;if(!n)return i;0===this.direction?i.x=t*n.width:1===this.direction&&(i.y=t*n.height)}return i},n._getDragDirection=function(t){return 0===this._direction?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},n._isScrollable=function(t,i,n){if(1===this._sizeMode){var r=0,s=0;if(0===this.direction)return r=this._scrollCenterOffsetX[i],s=this._scrollCenterOffsetX[n],Math.abs(t.x)>=Math.abs(r-s)*this.scrollThreshold;if(1===this.direction)return r=this._scrollCenterOffsetY[i],s=this._scrollCenterOffsetY[n],Math.abs(t.y)>=Math.abs(r-s)*this.scrollThreshold}else{var e=this.view;if(!e)return!1;if(0===this.direction)return Math.abs(t.x)>=e.width*this.scrollThreshold;if(1===this.direction)return Math.abs(t.y)>=e.height*this.scrollThreshold}return!1},n._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var i=new Ms;Ms.subtract(i,this._touchBeganPosition,this._touchEndPosition);var n=this._curPageIdx,r=n+this._getDragDirection(i),s=this.pageTurningSpeed*Math.abs(n-r);if(r<this._pages.length){if(this._isScrollable(i,n,r))return void this.scrollToPage(r,s);var e=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(e))return void this.scrollToPage(r,s)}this.scrollToPage(n,s)}},r(i,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),i}(ykt),eEt.SizeMode=oEt,eEt.Direction=cEt,eEt.EventType=Lkt({PAGE_TURNING:"page-turning"},_kt),y((WAt=eEt).prototype,"sizeMode",[UAt],Object.getOwnPropertyDescriptor(WAt.prototype,"sizeMode"),WAt.prototype),y(WAt.prototype,"direction",[xAt],Object.getOwnPropertyDescriptor(WAt.prototype,"direction"),WAt.prototype),y(WAt.prototype,"indicator",[GAt],Object.getOwnPropertyDescriptor(WAt.prototype,"indicator"),WAt.prototype),XAt=uo(WAt.prototype,"autoPageTurningThreshold",[Co],(function(){return 100})),y(WAt.prototype,"verticalScrollBar",[jAt,ac],Object.getOwnPropertyDescriptor(WAt.prototype,"verticalScrollBar"),WAt.prototype),y(WAt.prototype,"horizontalScrollBar",[HAt,ac],Object.getOwnPropertyDescriptor(WAt.prototype,"horizontalScrollBar"),WAt.prototype),YAt=uo(WAt.prototype,"horizontal",[ac,Co],(function(){return!0})),KAt=uo(WAt.prototype,"vertical",[ac,Co],(function(){return!0})),qAt=uo(WAt.prototype,"cancelInnerEvents",[ac,Co],(function(){return!0})),QAt=uo(WAt.prototype,"scrollEvents",[VAt,Co,ac],(function(){return[]})),JAt=uo(WAt.prototype,"pageTurningSpeed",[Co],(function(){return.3})),ZAt=uo(WAt.prototype,"pageEvents",[$At,Co],(function(){return[]})),tEt=uo(WAt.prototype,"_sizeMode",[Co],(function(){return 0})),iEt=uo(WAt.prototype,"_direction",[Co],(function(){return 0})),nEt=uo(WAt.prototype,"_scrollThreshold",[Co],(function(){return.5})),rEt=uo(WAt.prototype,"_pageTurningEventTiming",[Co],(function(){return.1})),sEt=uo(WAt.prototype,"_indicator",[Co],(function(){return null})),zAt=WAt))||zAt)||zAt));O.PageView=aEt;var fEt=new Ir,vEt=new Ms,lEt=new Ms,dEt=new Ms(1,1),wEt=new Ms,gEt=new Ms;function pEt(t,i){if(!i._hadAlignOnce){0===i.alignMode&&(i._hadAlignOnce=!0);var n,r=i.target,s=lEt,e=dEt;r?_At(t,n=r,s,e):n=t.parent;var h=pAt(n),u=n instanceof kR||!n.getComponent(mB),o=u?vEt:n.getComponent(mB).anchorPoint,c=u;t.getPosition(fEt);var a=t.qu(),f=fEt.x,v=fEt.y,l=a.anchorPoint,d=t.scale;if(56&i.alignFlags){var w=0,g=0,p=h.width;c?(w=kh.left.x,g=kh.right.x):g=(w=-o.x*p)+p,w+=i.isAbsoluteLeft?i.left:i.left*p,g-=i.isAbsoluteRight?i.right:i.right*p,r&&(w+=s.x,w*=e.x,g+=s.x,g*=e.x);var _=0,y=l.x,m=d.x;if(m<0&&(y=1-y,m=-m),i.isStretchWidth)_=g-w,0!==m&&(a.width=_/m),f=w+y*_;else{if(_=a.width*m,i.isAlignHorizontalCenter){var b=i.isAbsoluteHorizontalCenter?i.horizontalCenter:i.horizontalCenter*p,k=(.5-o.x)*h.width;r&&(b*=e.x,k+=s.x,k*=e.x),f=k+(y-.5)*_+b}else f=i.isAlignLeft?w+y*_:g+(y-1)*_;xn(m,0,Fn)?_=a.width:_/=m}i._lastSize.width=_}if(7&i.alignFlags){var A=0,E=0,T=h.height;c?(E=kh.bottom.y,A=kh.top.y):A=(E=-o.y*T)+T,E+=i.isAbsoluteBottom?i.bottom:i.bottom*T,A-=i.isAbsoluteTop?i.top:i.top*T,r&&(E+=s.y,E*=e.y,A+=s.y,A*=e.y);var O=0,S=l.y,I=d.y;if(I<0&&(S=1-S,I=-I),i.isStretchHeight)O=A-E,0!==I&&(a.height=O/I),v=E+S*O;else{if(O=a.height*I,i.isAlignVerticalCenter){var R=i.isAbsoluteVerticalCenter?i.verticalCenter:i.verticalCenter*T,M=(.5-o.y)*h.height;r&&(R*=e.y,M+=s.y,M*=e.y),v=M+(S-.5)*O+R}else v=i.isAlignBottom?E+S*O:A+(S-1)*O;xn(I,0,Fn)?O=a.height:O/=I}i._lastSize.height=O}t.setPosition(f,v,fEt.z),Ir.set(i._lastPos,f,v,fEt.z)}}function _Et(t){var i=t.getComponent(PAt);if(i&&i.enabled){if(!T.isValid(t,!0))return;AEt.push(i)}for(var n,r=w(t.children);!(n=r()).done;){var s=n.value;s.active&&_Et(s)}}function yEt(){var t=xN.getScene();if(t){EEt.isAligning=!0,EEt._nodesOrderDirty&&(AEt.length=0,_Et(t),EEt._nodesOrderDirty=!1);var i=null,n=EEt._activeWidgetsIterator;for(n.i=0;n.i<AEt.length;++n.i)(i=AEt[n.i])._dirty&&(pEt(i.node,i),i._dirty=!1);EEt.isAligning=!1}}var mEt,bEt,kEt,AEt=[],EEt=t("eP",T._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new si(AEt),animationState:null,init:function(){xN.on("director_after_scene_launch",yEt),xN.on("director_after_update",yEt),HN.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);HN.instance.on("canvas-resize",t),_h.on("window-resize",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=xN.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var i=WE.isNode(t)&&t.getComponent(PAt);i&&i.enabled&&(2===i.alignMode||1===i.alignMode)&&i.setDirty();for(var n,r=w(t.children);!(n=r()).done;){var s=n.value;this.refreshWidgetOnResized(s)}},updateOffsetsToStayPut:function(t,i){function n(t,i){return Math.abs(t-i)>1e-10?i:t}var r=t.node,s=r.parent;if(s){var e=wEt;e.set(0,0);var h=gEt;if(h.set(1,1),t.target&&_At(r,s=t.target,e,h),!i)return;var u=s._uiProps&&s.qu(),o=u?u.anchorPoint:vEt,c=r.qu(),a=pAt(s),f=c.anchorPoint,v=r.position,l=NAt,d=r.scale,w=0;if(i&l.LEFT){var g=-o.x*a.width;g+=e.x,g*=h.x,w=v.x-f.x*c.width*Math.abs(d.x)-g,t.isAbsoluteLeft||(w/=a.width),w/=h.x,t.left=n(t.left,w)}if(i&l.RIGHT){var p=(1-o.x)*a.width;p+=e.x,w=(p*=h.x)-(v.x+(1-f.x)*c.width*Math.abs(d.x)),t.isAbsoluteRight||(w/=a.width),w/=h.x,t.right=n(t.right,w)}if(i&l.TOP){var _=(1-o.y)*a.height;_+=e.y,w=(_*=h.y)-(v.y+(1-f.y)*c.height*Math.abs(d.y)),t.isAbsoluteTop||(w/=a.height),w/=h.y,t.top=n(t.top,w)}if(i&l.BOT){var y=-o.y*a.height;y+=e.y,y*=h.y,w=v.y-f.y*c.height*Math.abs(d.y)-y,t.isAbsoluteBottom||(w/=a.height),w/=h.y,t.bottom=n(t.bottom,w)}}},updateAlignment:function t(i){var n=i.parent;n&&WE.isNode(n)&&t(n);var r=i.getComponent(PAt);r&&n&&pEt(i,r)},AlignMode:yAt,AlignFlags:NAt});xN.on("director_init",(function(){EEt.init()}));var TEt,OEt,SEt,IEt,REt,MEt,CEt,NEt,PEt,LEt,DEt,BEt,FEt=t("eL",_o("cc.SafeArea")(mEt=mo(110)(mEt=yo(PAt)((bEt=function(t){function i(){var i;return(i=t.call(this)||this)._symmetric=kEt&&kEt(),i}e(i,t);var n=i.prototype;return n.onEnable=function(){this.updateArea(),_h.on("window-resize",this.updateArea,this),_h.on("orientation-change",this.updateArea,this)},n.onDisable=function(){_h.off("window-resize",this.updateArea,this),_h.off("orientation-change",this.updateArea,this)},n.updateArea=function(){var t=this.node.getComponent(PAt),i=this.node.getComponent(mB);if(t&&i){t.updateAlignment();var n=this.node.position.clone(),r=i.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var s=ZN.getVisibleSize(),e=s.width,h=s.height,u=bh.getSafeAreaRect(this._symmetric);t.top=h-u.y-u.height,t.bottom=u.y,t.left=u.x,t.right=e-u.x-u.width,t.updateAlignment();var o=this.node.position.clone(),c=r.x-(o.x-n.x)/i.width,a=r.y-(o.y-n.y)/i.height;i.setAnchorPoint(c,a),EEt.add(t)}},r(i,[{key:"symmetric",get:function(){return this._symmetric},set:function(t){this._symmetric=t}}]),i}(Kg),kEt=uo(bEt.prototype,"_symmetric",[Co],(function(){return!0})),mEt=bEt))||mEt)||mEt)||mEt);O.SafeArea=FEt,t("eM",(TEt=_o("cc.UICoordinateTracker"),OEt=mo(110),SEt=ic(WE),IEt=ic(HG),REt=ic([Xg]),TEt(MEt=OEt((CEt=function(t){function i(){var i;return(i=t.call(this)||this).syncEvents=NEt&&NEt(),i._target=PEt&&PEt(),i._camera=LEt&&LEt(),i._useScale=DEt&&DEt(),i._distance=BEt&&BEt(),i._transformPos=Rr(),i._viewPos=Rr(),i._canMove=!0,i._lastWPos=Rr(),i._lastCameraPos=Rr(),i}e(i,t);var n=i.prototype;return n.onEnable=function(){this._checkCanMove()},n.update=function(){var t=this.node.worldPosition,i=this._camera;if(this._canMove&&i&&i.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(i.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(i.node.worldPosition),i.camera.update(),i.convertToUINode(t,this._target,this._transformPos),this._useScale&&Ir.transformMat4(this._viewPos,this.node.worldPosition,i.camera.matView),this.syncEvents.length>0)){var n=this._distance/Math.abs(this._viewPos.z);Xg.emitEvents(this.syncEvents,this._transformPos,n)}},n._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},r(i,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),i}(Kg),y(CEt.prototype,"target",[SEt],Object.getOwnPropertyDescriptor(CEt.prototype,"target"),CEt.prototype),y(CEt.prototype,"camera",[IEt],Object.getOwnPropertyDescriptor(CEt.prototype,"camera"),CEt.prototype),NEt=uo(CEt.prototype,"syncEvents",[REt,Co],(function(){return[]})),PEt=uo(CEt.prototype,"_target",[Co],(function(){return null})),LEt=uo(CEt.prototype,"_camera",[Co],(function(){return null})),DEt=uo(CEt.prototype,"_useScale",[Co],(function(){return!0})),BEt=uo(CEt.prototype,"_distance",[Co],(function(){return 1})),MEt=CEt))||MEt)||MEt));var UEt,xEt=["touch-start","touch-end","touch-move","mouse-down","mouse-move","mouse-up","mouse-enter","mouse-leave","mouse-wheel"];function GEt(t){t.propagationStopped=!0}t("eN",_o("cc.BlockInputEvents")(UEt=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.onEnable=function(){for(var t=0;t<xEt.length;t++)this.node.on(xEt[t],GEt,this)},n.onDisable=function(){for(var t=0;t<xEt.length;t++)this.node.off(xEt[t],GEt,this)},i}(Kg))||UEt);var jEt,HEt,VEt,$Et,zEt=t("eO",_o("cc.SubContextView")(jEt=mo(110)(jEt=yo(mB)((HEt=function(t){function i(){var i;return(i=t.call(this)||this)._fps=VEt&&VEt(),i.tV=null,i.f$=new mg,i.s_=new f_,i.v$=0,i.l$=0,i.d$=null,i.w$=new WE("content"),i._designResolutionSize=$Et&&$Et(),i.w$.hideFlags|=1032,i.v$=performance.now(),i}e(i,t);var n=i.prototype;return n.onLoad=function(){AL.getOpenDataContext?(this.l$=1e3/this._fps,this.d$=AL.getOpenDataContext(),this.g$(),this.p$(),this._$(),this.y$()):this.enabled=!1},n.onEnable=function(){this.sH()},n.onDisable=function(){this.eH()},n.g$=function(){if(this.d$){var t=this.d$.canvas,i=this._designResolutionSize.width,n=this._designResolutionSize.height;t.width=i,t.height=n}},n.p$=function(){if(this.d$){var t=this.d$.canvas,i=this.f$;if(i.reset(t),this.s_.image=i,this.s_.create(t.width,t.height),this.tV=this.w$.getComponent(tU),this.tV||(this.tV=this.w$.addComponent(tU)),this.tV.spriteFrame)this.tV.spriteFrame.texture=this.s_;else{var n=new wL;n.texture=this.s_,this.tV.spriteFrame=n}this.w$.parent=this.node}},n._$=function(){if(this.d$){var t=this.node.getComponent(mB),i=this.w$.getComponent(mB),n=t.width/i.width,r=t.height/i.height,s=n>r?r:n;i.width*=s,i.height*=s;var e=ZN.getViewportRect(),h=i.getBoundingBoxToWorld(),u=ZN.getVisibleSize(),o=_h.devicePixelRatio,c=(e.width*(h.x/u.width)+e.x)/o,a=(e.height*(h.y/u.height)+e.y)/o,f=e.width*(h.width/u.width)/o,v=e.height*(h.height/u.height)/o;this.d$.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:c,y:a,width:f,height:v})}},n.m$=function(){var t=this.f$;if(t&&this.d$&&!(t.width<=0||t.height<=0)){var i=this.d$.canvas;t.reset(i),(i.width>t.width||i.height>t.height)&&this.s_.create(i.width,i.height),this.s_.uploadData(i)}},n.sH=function(){this.node.on("transform-changed",this._$,this),this.node.on("size-changed",this._$,this),this.node.on("layer-changed",this.y$,this)},n.eH=function(){this.node.off("transform-changed",this._$,this),this.node.off("size-changed",this._$,this),this.node.off("layer-changed",this.y$,this)},n.y$=function(){this.w$.layer=this.node.layer},n.update=function(t){void 0===t?this.m$():performance.now()-this.v$>=this.l$&&(this.v$+=this.l$,this.m$())},n.onDestroy=function(){this.w$.destroy(),this.s_.destroy(),this.tV&&this.tV.destroy(),this.f$.destroy(),this.d$=null},r(i,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this.l$=1e3/t)}}]),i}(Kg),VEt=uo(HEt.prototype,"_fps",[Co],(function(){return 60})),$Et=uo(HEt.prototype,"_designResolutionSize",[Co],(function(){return new ie(640,960)})),jEt=HEt))||jEt)||jEt)||jEt);O.SubContextView=zEt}}}));
