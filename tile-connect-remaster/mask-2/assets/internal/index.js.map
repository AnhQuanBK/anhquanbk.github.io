{"version":3,"sources":["file:/Applications/Cocos/Creator/3.8.7/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/Applications/Cocos/Creator/3.8.7/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline-types.ts","file:/Applications/Cocos/Creator/3.8.7/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/Applications/Cocos/Creator/3.8.7/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline-settings.ts","file:/Applications/Cocos/Creator/3.8.7/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/file:/Applications/Cocos/Creator/3.8.7/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline.ts"],"names":["SampleCount","gfx","makeMSAA","enabled","sampleCount","X4","BloomType","makeBloom","type","KawaseDualFilter","material","kawaseFilterMaterial","mipmapFilterMaterial","enableAlphaMask","iterations","threshold","intensity","makePipelineSettings","msaa","enableShadingScale","shadingScale","bloom","toneMapping","colorGrading","contribute","colorGradingMap","fsr","sharpness","fxaa","fillRequiredPipelineSettings","value","undefined","fillRequiredMSAA","fillRequiredBloom","fillRequiredToneMapping","fillRequiredColorGrading","fillRequiredFSR","fillRequiredFXAA","ccenum","_RF","pop","ccclass","_decorator","disallowMultiple","executeInEditMode","menu","property","requireComponent","_dec","_dec2","_dec3","Camera","_dec4","CCBoolean","_dec5","displayName","_dec6","group","id","name","_dec7","style","CCInteger","range","_dec8","_dec9","tooltip","CCFloat","slide","_dec10","_dec11","_dec12","_dec13","Material","_dec14","_dec15","_dec16","_dec17","min","_dec18","_dec19","_dec20","_dec21","_dec22","_dec23","Texture2D","_dec24","_dec25","_dec26","_dec27","_dec28","_dec29","_class","_descriptor","_applyDecoratedDescriptor","_class2","_Component","_inherits","BuiltinPipelineSettings","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","_initializerDefineProperty","_assertThisInitialized","_descriptor2","_createClass","key","this","_settings","getComponent","camera","pipelineSettings","get","_editorPreview","set","v","rendering","setEditorPipelineSettings","_disableEditorPreview","getEditorPipelineSettings","Math","pow","ceil","log2","max","val","Component","prototype","configurable","enumerable","writable","initializer","Object","getOwnPropertyDescriptor","AABB","geometry","Sphere","intersect","ClearFlagBit","Color","Format","FormatFeatureBit","LoadOp","StoreOp","TextureType","Viewport","scene","renderer","CameraUsage","CSMLevel","LightType","forwardNeedClearColor","clearFlag","COLOR","STENCIL","getCsmMainLightViewport","light","w","h","level","vp","screenSpaceSignY","shadowFixedArea","csmLevel","LEVEL_1","left","top","width","trunc","height","floor","PipelineConfigs","isWeb","isWebGL1","isWebGPU","isMobile","isHDR","useFloatOutput","toneMappingType","shadowEnabled","shadowMapFormat","R32F","shadowMapSize","Vec2","usePlanarShadow","supportDepthSample","mobileMaxSpotLightShadowMaps","platform","Vec4","setupPipelineConfigs","ppl","configs","sampleFeature","SAMPLED_TEXTURE","LINEAR_FILTER","device","sys","isNative","gfxAPI","API","WEBGL","WEBGPU","pipelineSceneData","getMacroBool","postSettings","shadowInfo","shadows","pipeline","supportsR32FloatTexture","RGBA8","size","ShadowType","Planar","capabilities","getFormatFeatures","DEPTH_STENCIL","x","clipSpaceSignY","defaultSettings","CameraConfigs","settings","isMainGameWindow","renderWindowId","colorName","depthStencilName","enableFullPipeline","enableProfiler","remainingPasses","nativeWidth","nativeHeight","enableHDR","radianceFormat","copyAndTonemapMaterial","enableStoreSceneDepth","sClearColorTransparentBlack","addCopyToScreenPass","pplConfigs","cameraConfigs","input","assert","pass","addRenderPass","addRenderTarget","CLEAR","STORE","addTexture","addQueue","QueueHint","OPAQUE","addFullscreenQuad","getPingPongRenderTarget","prevName","prefix","startsWith","Number","charAt","ForwardLighting","lights","shadowEnabledSpotLights","_sphere","create","_boundingBox","_rangedDirLightBoundingBox","frustum","cameraPos","_step","_iterator","_createForOfIteratorHelper","spotLights","s","n","done","baked","position","y","z","sphereFrustum","push","err","e","f","_step2","_iterator2","sphereLights","_step3","_iterator3","pointLights","_step4","_iterator4","rangedDirLights","transform","node","getWorldMatrix","aabbFrustum","sort","lhs","rhs","Vec3","squaredDistance","_step5","_iterator5","queue","BLEND","SPHERE","SPOT","POINT","RANGED_DIRECTIONAL","addScene","SceneFlags","maxNumShadowMaps","_step6","i","_iterator6","shadowPass","addDepthStencil","DISCARD","NONE","MASK","SHADOW_CASTER","useLightFrustum","_addLightQueues","_step7","_iterator7","depthStencilStoreOp","viewport","_step8","count","_iterator8","storeOp","setViewport","LOAD","BuiltinForwardPassBuilder","forwardLighting","_viewport","_clearColor","_reflectionProbeClearColor","ConfigOrder","RenderOrder","pipelineConfigs","enableMainLightShadowMap","mainLight","enableMainLightPlanarShadowMap","enablePlanarReflectionProbe","cameraUsage","SCENE_VIEW","GAME_VIEW","enableMSAA","enableSingleForwardPass","window","ResourceFlags","ResourceResidency","TEX2D","COLOR_ATTACHMENT","MEMORYLESS","DEPTH_STENCIL_ATTACHMENT","context","setVec4","cullLights","_addCascadedShadowMapPass","addSpotlightShadowPasses","_tryAddReflectionProbePasses","_addForwardRadiancePasses","shadowSize","csmSupported","reflectionProbeManager","cclegacy","internal","_step9","probes","getProbes","probeID","_iterator9","probe","needRender","area","renderArea","probeType","ProbeType","PLANAR","realtimePlanarTexture","addRenderWindow","probePass","_buildReflectionProbePass","colorStoreOp","clearColor","packRGBE","clearDepth","clearStencil","REFLECTION_PROBE","disableMSAA","round","_addForwardSingleRadiancePass","_addForwardMultipleRadiancePasses","_addPlanarShadowQueue","sceneFlags","geometryRenderer","GEOMETRY","msaaRadianceName","msaaDepthStencilName","msPass","addMultisampleRenderPass","_buildForwardMainLightPass","resolveRenderTarget","addLightQueues","firstStoreOp","isMultipleLightPassesNeeded","addLightPasses","PLANAR_SHADOW","downSize","scale","BuiltinBloomPassBuilder","_clearColorTransparentBlack","_bloomParams","_bloomTexSize","_bloomWidths","_bloomHeights","_bloomTexNames","_bloomUpSampleTexDescs","_bloomDownSampleTexDescs","_prefilterTexDesc","_originalColorDesc","hasValidMaterial","MipmapFilter","enableBloom","format","bloomWidth","bloomHeight","createTexture","desc","prevRenderPass","_addKawaseDualFilterBloomPasses","_addMipmapFilterBloomPasses","bloomMaterial","radianceName","sizeCount","prefilterPass","downPass","upPass","combinePass","layout","passIndex","loadOp","queueHint","prefilterInfo","currSamplePass","_addPass","downSampleInfos","currInfo","samplerSrc","samplerSrcName","lastIndex","upSampleInfos","sampleSrc","sampleSrcName","BuiltinToneMappingPassBuilder","_colorGradingTexSize","enableColorGrading","enableToneMapping","setProperty","_addCopyAndTonemapPass","ldrColorPrefix","ldrColorName","lutTex","isSquareMap","setVec2","setFloat","BuiltinFXAAPassBuilder","_fxaaParams","enableFXAA","_addFxaaPass","inputColorName","fxaaMaterial","BuiltinFsrPassBuilder","_fsrParams","_fsrTexSize","enableFSR","outputColorName","_addFsrPass","fsrMaterial","clamp","fsrColorName","easuPass","rcasPass","BuiltinUiPassBuilder","flags","UI","PROFILER","showStatistics","BuiltinPipelineBuilder","_pipelineEvent","director","root","pipelineEvent","_forwardPass","_bloomPass","_toneMappingPass","_fxaaPass","_fsrPass","_uiPass","_configs","_cameraConfigs","_copyAndTonemapMaterial","_initialized","_passBuilders","PREVIEW","editorSettings","passBuilders","_passes","_step10","_iterator10","GAME","swapchain","isGameView","visibility","Layers","Enum","DEFAULT","profiler","RGBA16F","_setupPipelinePreview","_preparePipelinePasses","a","b","getConfigOrder","_setupBuiltinCameraConfigs","_step11","_iterator11","builder","configCamera","_setupCameraConfigs","_step12","_iterator12","windowResize","cameras","_initMaterials","_step13","_iterator13","emit","PipelineEventType","RENDER_CAMERA_BEGIN","_buildForwardPipeline","_buildSimplePipeline","RENDER_CAMERA_END","getRenderOrder","sortPipelinePassBuildersByRenderOrder","_step14","lastPass","_iterator14","setup","_uuid","initialize","effectName","effectAsset","setCustomPipeline"],"mappings":"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","file":"all.js","sourcesContent":["/*\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights to\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n of the Software, and to permit persons to whom the Software is furnished to do so,\n subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\n/**\n * ========================= !DO NOT CHANGE THE FOLLOWING SECTION MANUALLY! =========================\n * The following section is auto-generated.\n * ========================= !DO NOT CHANGE THE FOLLOWING SECTION MANUALLY! =========================\n */\n/* eslint-disable max-len */\nimport { Material, Texture2D, ccenum, gfx } from 'cc';\n\nconst { SampleCount } = gfx;\n\nexport interface MSAA {\n    enabled: boolean; /* false */\n    sampleCount: gfx.SampleCount; /* SampleCount.X4 */\n    [name: string]: unknown;\n}\n\nexport function makeMSAA(): MSAA {\n    return {\n        enabled: false,\n        sampleCount: SampleCount.X4,\n    };\n}\n\nexport function fillRequiredMSAA(value: MSAA): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.sampleCount === undefined) {\n        value.sampleCount = SampleCount.X4;\n    }\n}\n\nexport interface ForwardPassConfigs {\n    enableMainLightShadowMap: boolean; /* false */\n    enableMainLightPlanarShadowMap: boolean; /* false */\n    enablePlanarReflectionProbe: boolean; /* false */\n    enableMSAA: boolean; /* false */\n    enableSingleForwardPass: boolean; /* false */\n    [name: string]: unknown;\n}\n\nexport interface HBAO {\n    enabled: boolean; /* false */\n    radiusScale: number; /* 1 */\n    angleBiasDegree: number; /* 10 */\n    blurSharpness: number; /* 3 */\n    aoSaturation: number; /* 1 */\n    needBlur: boolean; /* false */\n    [name: string]: unknown;\n}\n\nexport function makeHBAO(): HBAO {\n    return {\n        enabled: false,\n        radiusScale: 1,\n        angleBiasDegree: 10,\n        blurSharpness: 3,\n        aoSaturation: 1,\n        needBlur: false,\n    };\n}\n\nexport function fillRequiredHBAO(value: HBAO): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.radiusScale === undefined) {\n        value.radiusScale = 1;\n    }\n    if (value.angleBiasDegree === undefined) {\n        value.angleBiasDegree = 10;\n    }\n    if (value.blurSharpness === undefined) {\n        value.blurSharpness = 3;\n    }\n    if (value.aoSaturation === undefined) {\n        value.aoSaturation = 1;\n    }\n    if (value.needBlur === undefined) {\n        value.needBlur = false;\n    }\n}\n\nexport enum BloomType {\n    KawaseDualFilter,\n    MipmapFilter,\n}\nccenum(BloomType);\n\nexport interface Bloom {\n    enabled: boolean; /* false */\n    type: BloomType; /* BloomType.KawaseDualFilter */\n    /* refcount */ material: Material | null;\n    /* refcount */ kawaseFilterMaterial: Material | null;\n    /* refcount */ mipmapFilterMaterial: Material | null;\n    enableAlphaMask: boolean; /* false */\n    iterations: number; /* 3 */\n    threshold: number; /* 0.8 */\n    intensity: number; /* 1 */\n    [name: string]: unknown;\n}\n\nexport function makeBloom(): Bloom {\n    return {\n        enabled: false,\n        type: BloomType.KawaseDualFilter,\n        material: null,\n        kawaseFilterMaterial: null,\n        mipmapFilterMaterial: null,\n        enableAlphaMask: false,\n        iterations: 3,\n        threshold: 0.8,\n        intensity: 1,\n    };\n}\n\nexport function fillRequiredBloom(value: Bloom): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.type === undefined) {\n        value.type = BloomType.KawaseDualFilter;\n    }\n    if (value.material === undefined) {\n        value.material = null;\n    }\n    if (value.kawaseFilterMaterial === undefined) {\n        value.kawaseFilterMaterial = value.material || null;\n    }\n    if (value.mipmapFilterMaterial === undefined) {\n        value.mipmapFilterMaterial = null;\n    }\n    if (value.enableAlphaMask === undefined) {\n        value.enableAlphaMask = false;\n    }\n    if (value.iterations === undefined) {\n        value.iterations = 3;\n    }\n    if (value.threshold === undefined) {\n        value.threshold = 0.8;\n    }\n    if (value.intensity === undefined) {\n        value.intensity = 1;\n    }\n}\n\nexport interface ColorGrading {\n    enabled: boolean; /* false */\n    /* refcount */ material: Material | null;\n    contribute: number; /* 1 */\n    /* refcount */ colorGradingMap: Texture2D | null;\n    [name: string]: unknown;\n}\n\nexport function makeColorGrading(): ColorGrading {\n    return {\n        enabled: false,\n        material: null,\n        contribute: 1,\n        colorGradingMap: null,\n    };\n}\n\nexport function fillRequiredColorGrading(value: ColorGrading): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.material === undefined) {\n        value.material = null;\n    }\n    if (value.contribute === undefined) {\n        value.contribute = 1;\n    }\n    if (value.colorGradingMap === undefined) {\n        value.colorGradingMap = null;\n    }\n}\n\nexport interface FSR {\n    enabled: boolean; /* false */\n    /* refcount */ material: Material | null;\n    sharpness: number; /* 0.8 */\n    [name: string]: unknown;\n}\n\nexport function makeFSR(): FSR {\n    return {\n        enabled: false,\n        material: null,\n        sharpness: 0.8,\n    };\n}\n\nexport function fillRequiredFSR(value: FSR): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.material === undefined) {\n        value.material = null;\n    }\n    if (value.sharpness === undefined) {\n        value.sharpness = 0.8;\n    }\n}\n\nexport interface FXAA {\n    enabled: boolean; /* false */\n    /* refcount */ material: Material | null;\n    [name: string]: unknown;\n}\n\nexport function makeFXAA(): FXAA {\n    return {\n        enabled: false,\n        material: null,\n    };\n}\n\nexport function fillRequiredFXAA(value: FXAA): void {\n    if (value.enabled === undefined) {\n        value.enabled = false;\n    }\n    if (value.material === undefined) {\n        value.material = null;\n    }\n}\n\nexport interface ToneMapping {\n    /* refcount */ material: Material | null;\n    [name: string]: unknown;\n}\n\nexport function makeToneMapping(): ToneMapping {\n    return {\n        material: null,\n    };\n}\n\nexport function fillRequiredToneMapping(value: ToneMapping): void {\n    if (value.material === undefined) {\n        value.material = null;\n    }\n}\n\nexport interface PipelineSettings {\n    readonly msaa: MSAA;\n    enableShadingScale: boolean; /* false */\n    shadingScale: number; /* 0.5 */\n    readonly bloom: Bloom;\n    readonly toneMapping: ToneMapping;\n    readonly colorGrading: ColorGrading;\n    readonly fsr: FSR;\n    readonly fxaa: FXAA;\n    [name: string]: unknown;\n}\n\nexport function makePipelineSettings(): PipelineSettings {\n    return {\n        msaa: makeMSAA(),\n        enableShadingScale: false,\n        shadingScale: 0.5,\n        bloom: makeBloom(),\n        toneMapping: makeToneMapping(),\n        colorGrading: makeColorGrading(),\n        fsr: makeFSR(),\n        fxaa: makeFXAA(),\n    };\n}\n\nexport function fillRequiredPipelineSettings(value: PipelineSettings): void {\n    if (!value.msaa) {\n        (value.msaa as MSAA) = makeMSAA();\n    } else {\n        fillRequiredMSAA(value.msaa);\n    }\n    if (value.enableShadingScale === undefined) {\n        value.enableShadingScale = false;\n    }\n    if (value.shadingScale === undefined) {\n        value.shadingScale = 0.5;\n    }\n    if (!value.bloom) {\n        (value.bloom as Bloom) = makeBloom();\n    } else {\n        fillRequiredBloom(value.bloom);\n    }\n    if (!value.toneMapping) {\n        (value.toneMapping as ToneMapping) = makeToneMapping();\n    } else {\n        fillRequiredToneMapping(value.toneMapping);\n    }\n    if (!value.colorGrading) {\n        (value.colorGrading as ColorGrading) = makeColorGrading();\n    } else {\n        fillRequiredColorGrading(value.colorGrading);\n    }\n    if (!value.fsr) {\n        (value.fsr as FSR) = makeFSR();\n    } else {\n        fillRequiredFSR(value.fsr);\n    }\n    if (!value.fxaa) {\n        (value.fxaa as FXAA) = makeFXAA();\n    } else {\n        fillRequiredFXAA(value.fxaa);\n    }\n}\n","/*\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights to\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n of the Software, and to permit persons to whom the Software is furnished to do so,\n subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport {\n    _decorator, Camera, CCBoolean, CCFloat, CCInteger, Component,\n    Material, rendering, Texture2D,\n} from 'cc';\n\nimport { EDITOR } from 'cc/env';\n\nimport {\n    BloomType,\n    fillRequiredPipelineSettings, makePipelineSettings, PipelineSettings,\n} from './builtin-pipeline-types';\n\nconst { ccclass, disallowMultiple, executeInEditMode, menu, property, requireComponent, type } = _decorator;\n\n@ccclass('BuiltinPipelineSettings')\n@menu('Rendering/BuiltinPipelineSettings')\n@requireComponent(Camera)\n@disallowMultiple\n@executeInEditMode\nexport class BuiltinPipelineSettings extends Component {\n    @property\n    private readonly _settings: PipelineSettings = makePipelineSettings();\n\n    getPipelineSettings(): PipelineSettings {\n        return this._settings;\n    }\n\n    // Enable/Disable\n    onEnable(): void {\n        fillRequiredPipelineSettings(this._settings);\n        const cameraComponent = this.getComponent(Camera)!;\n        const camera = cameraComponent.camera;\n        camera.pipelineSettings = this._settings;\n\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    onDisable(): void {\n        const cameraComponent = this.getComponent(Camera)!;\n        const camera = cameraComponent.camera;\n        if (camera) {\n            camera.pipelineSettings = null;\n        }\n        if (EDITOR) {\n            this._disableEditorPreview();\n        }\n    }\n\n    // Editor Preview\n    @property(CCBoolean)\n    protected _editorPreview = false;\n\n    @property({\n        displayName: 'Editor Preview (Experimental)',\n        type: CCBoolean,\n    })\n    get editorPreview(): boolean {\n        return this._editorPreview;\n    }\n    set editorPreview(v: boolean) {\n        this._editorPreview = v;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    public _tryEnableEditorPreview(): void {\n        if (rendering === undefined) {\n            return;\n        }\n        if (this._editorPreview) {\n            rendering.setEditorPipelineSettings(this._settings);\n        } else {\n            this._disableEditorPreview();\n        }\n    }\n    public _disableEditorPreview(): void {\n        if (rendering === undefined) {\n            return;\n        }\n        const current = rendering.getEditorPipelineSettings() as PipelineSettings | null;\n        if (current === this._settings) {\n            rendering.setEditorPipelineSettings(null);\n        }\n    }\n\n    // MSAA\n    @property({\n        group: { id: 'MSAA', name: 'Multisample Anti-Aliasing' },\n        type: CCBoolean,\n    })\n    get MsaaEnable(): boolean {\n        return this._settings.msaa.enabled;\n    }\n    set MsaaEnable(value: boolean) {\n        this._settings.msaa.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n\n    @property({\n        group: { id: 'MSAA', name: 'Multisample Anti-Aliasing', style: 'section' },\n        type: CCInteger,\n        range: [2, 4, 2],\n    })\n    set msaaSampleCount(value: number) {\n        value = 2 ** Math.ceil(Math.log2(Math.max(value, 2)));\n        value = Math.min(value, 4);\n        this._settings.msaa.sampleCount = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get msaaSampleCount(): number {\n        return this._settings.msaa.sampleCount;\n    }\n\n    // Shading Scale\n    @property({\n        group: { id: 'ShadingScale', name: 'ShadingScale', style: 'section' },\n        type: CCBoolean,\n    })\n    set shadingScaleEnable(value: boolean) {\n        this._settings.enableShadingScale = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get shadingScaleEnable(): boolean {\n        return this._settings.enableShadingScale;\n    }\n\n    @property({\n        tooltip: 'i18n:postprocess.shadingScale',\n        group: { id: 'ShadingScale', name: 'ShadingScale' },\n        type: CCFloat,\n        range: [0.01, 4, 0.01],\n        slide: true,\n    })\n    set shadingScale(value: number) {\n        this._settings.shadingScale = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get shadingScale(): number {\n        return this._settings.shadingScale;\n    }\n\n    // Bloom\n    @property({\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: CCBoolean,\n    })\n    set bloomEnable(value: boolean) {\n        this._settings.bloom.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get bloomEnable(): boolean {\n        return this._settings.bloom.enabled;\n    }\n\n    @type(BloomType)\n    @property({\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n    })\n    set bloomType(value: BloomType) {\n        this._settings.bloom.type = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n\n    get bloomType(): BloomType {\n        return this._settings.bloom.type;\n    }\n\n    @property({\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: Material,\n    })\n    set kawaseBloomMaterial(value: Material) {\n        if (this._settings.bloom.kawaseFilterMaterial === value) {\n            return;\n        }\n        this._settings.bloom.kawaseFilterMaterial = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get kawaseBloomMaterial(): Material {\n        return this._settings.bloom.kawaseFilterMaterial!;\n    }\n\n    @property({\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: Material,\n    })\n    set mipmapBloomMaterial(value: Material) {\n        if (this._settings.bloom.mipmapFilterMaterial === value) {\n            return;\n        }\n        this._settings.bloom.mipmapFilterMaterial = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get mipmapBloomMaterial(): Material {\n        return this._settings.bloom.mipmapFilterMaterial!;\n    }\n\n    @property({\n        tooltip: 'i18n:bloom.enableAlphaMask',\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: CCBoolean,\n    })\n    set bloomEnableAlphaMask(value: boolean) {\n        this._settings.bloom.enableAlphaMask = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get bloomEnableAlphaMask(): boolean {\n        return this._settings.bloom.enableAlphaMask;\n    }\n\n    @property({\n        tooltip: 'i18n:bloom.iterations',\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: CCInteger,\n        range: [1, 6, 1],\n        slide: true,\n    })\n    set bloomIterations(value: number) {\n        this._settings.bloom.iterations = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get bloomIterations(): number {\n        return this._settings.bloom.iterations;\n    }\n\n    @property({\n        tooltip: 'i18n:bloom.threshold',\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n        type: CCFloat,\n        min: 0,\n    })\n    set bloomThreshold(value: number) {\n        this._settings.bloom.threshold = value;\n    }\n    get bloomThreshold(): number {\n        return this._settings.bloom.threshold;\n    }\n\n    @type(CCFloat)\n    @property({\n        group: { id: 'Bloom', name: 'Bloom (PostProcessing)', style: 'section' },\n    })\n    set bloomIntensity(value: number) {\n        this._settings.bloom.intensity = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get bloomIntensity(): number {\n        return this._settings.bloom.intensity;\n    }\n\n    // Color Grading (LDR)\n    @property({\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\n        type: CCBoolean,\n    })\n    set colorGradingEnable(value: boolean) {\n        this._settings.colorGrading.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get colorGradingEnable(): boolean {\n        return this._settings.colorGrading.enabled;\n    }\n\n    @property({\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\n        type: Material,\n    })\n    set colorGradingMaterial(value: Material) {\n        if (this._settings.colorGrading.material === value) {\n            return;\n        }\n        this._settings.colorGrading.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get colorGradingMaterial(): Material {\n        return this._settings.colorGrading.material!;\n    }\n\n    @property({\n        tooltip: 'i18n:color_grading.contribute',\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\n        type: CCFloat,\n        range: [0, 1, 0.01],\n        slide: true,\n    })\n    set colorGradingContribute(value: number) {\n        this._settings.colorGrading.contribute = value;\n    }\n    get colorGradingContribute(): number {\n        return this._settings.colorGrading.contribute;\n    }\n\n    @property({\n        tooltip: 'i18n:color_grading.originalMap',\n        group: { id: 'Color Grading', name: 'ColorGrading (LDR) (PostProcessing)', style: 'section' },\n        type: Texture2D,\n    })\n    set colorGradingMap(val: Texture2D) {\n        this._settings.colorGrading.colorGradingMap = val;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get colorGradingMap(): Texture2D {\n        return this._settings.colorGrading.colorGradingMap!;\n    }\n\n    // FXAA\n    @property({\n        group: { id: 'FXAA', name: 'Fast Approximate Anti-Aliasing (PostProcessing)', style: 'section' },\n        type: CCBoolean,\n    })\n    set fxaaEnable(value: boolean) {\n        this._settings.fxaa.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get fxaaEnable(): boolean {\n        return this._settings.fxaa.enabled;\n    }\n\n    @property({\n        group: { id: 'FXAA', name: 'Fast Approximate Anti-Aliasing (PostProcessing)', style: 'section' },\n        type: Material,\n    })\n    set fxaaMaterial(value: Material) {\n        if (this._settings.fxaa.material === value) {\n            return;\n        }\n        this._settings.fxaa.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get fxaaMaterial(): Material {\n        return this._settings.fxaa.material!;\n    }\n\n    // FSR\n    @property({\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\n        type: CCBoolean,\n    })\n    set fsrEnable(value: boolean) {\n        this._settings.fsr.enabled = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get fsrEnable(): boolean {\n        return this._settings.fsr.enabled;\n    }\n\n    @property({\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\n        type: Material,\n    })\n    set fsrMaterial(value: Material) {\n        if (this._settings.fsr.material === value) {\n            return;\n        }\n        this._settings.fsr.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get fsrMaterial(): Material {\n        return this._settings.fsr.material!;\n    }\n\n    @property({\n        group: { id: 'FSR', name: 'FidelityFX Super Resolution', style: 'section' },\n        type: CCFloat,\n        range: [0, 1, 0.01],\n        slide: true,\n    })\n    set fsrSharpness(value: number) {\n        this._settings.fsr.sharpness = value;\n    }\n    get fsrSharpness(): number {\n        return this._settings.fsr.sharpness;\n    }\n\n    @property({\n        group: { id: 'ToneMapping', name: 'ToneMapping', style: 'section' },\n        type: Material,\n    })\n    set toneMappingMaterial(value: Material) {\n        if (this._settings.toneMapping.material === value) {\n            return;\n        }\n        this._settings.toneMapping.material = value;\n        if (EDITOR) {\n            this._tryEnableEditorPreview();\n        }\n    }\n    get toneMappingMaterial(): Material {\n        return this._settings.toneMapping.material!;\n    }\n}\n","/*\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights to\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n of the Software, and to permit persons to whom the Software is furnished to do so,\n subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport {\n    assert, cclegacy, clamp, geometry, gfx, Layers, Material, pipeline,\n    PipelineEventProcessor, PipelineEventType, ReflectionProbeManager, renderer,\n    rendering, sys, Vec2, Vec3, Vec4, warn,\n} from 'cc';\n\nimport { DEBUG, EDITOR } from 'cc/env';\n\nimport {\n    BloomType,\n    makePipelineSettings,\n    PipelineSettings,\n} from './builtin-pipeline-types';\n\nconst { AABB, Sphere, intersect } = geometry;\nconst { ClearFlagBit, Color, Format, FormatFeatureBit, LoadOp, StoreOp, TextureType, Viewport } = gfx;\nconst { scene } = renderer;\nconst { CameraUsage, CSMLevel, LightType } = scene;\n\nfunction forwardNeedClearColor(camera: renderer.scene.Camera): boolean {\n    return !!(camera.clearFlag & (ClearFlagBit.COLOR | (ClearFlagBit.STENCIL << 1)));\n}\n\nfunction getCsmMainLightViewport(\n    light: renderer.scene.DirectionalLight,\n    w: number,\n    h: number,\n    level: number,\n    vp: gfx.Viewport,\n    screenSpaceSignY: number,\n): void {\n    if (light.shadowFixedArea || light.csmLevel === CSMLevel.LEVEL_1) {\n        vp.left = 0;\n        vp.top = 0;\n        vp.width = Math.trunc(w);\n        vp.height = Math.trunc(h);\n    } else {\n        vp.left = Math.trunc(level % 2 * 0.5 * w);\n        if (screenSpaceSignY > 0) {\n            vp.top = Math.trunc((1 - Math.floor(level / 2)) * 0.5 * h);\n        } else {\n            vp.top = Math.trunc(Math.floor(level / 2) * 0.5 * h);\n        }\n        vp.width = Math.trunc(0.5 * w);\n        vp.height = Math.trunc(0.5 * h);\n    }\n    vp.left = Math.max(0, vp.left);\n    vp.top = Math.max(0, vp.top);\n    vp.width = Math.max(1, vp.width);\n    vp.height = Math.max(1, vp.height);\n}\n\nexport class PipelineConfigs {\n    isWeb = false;\n    isWebGL1 = false;\n    isWebGPU = false;\n    isMobile = false;\n    isHDR = false;\n    useFloatOutput = false;\n    toneMappingType = 0; // 0: ACES, 1: None\n    shadowEnabled = false;\n    shadowMapFormat = Format.R32F;\n    shadowMapSize = new Vec2(1, 1);\n    usePlanarShadow = false;\n    screenSpaceSignY = 1;\n    supportDepthSample = false;\n    mobileMaxSpotLightShadowMaps = 1;\n\n    platform = new Vec4(0, 0, 0, 0);\n}\n\nfunction setupPipelineConfigs(\n    ppl: rendering.BasicPipeline,\n    configs: PipelineConfigs,\n): void {\n    const sampleFeature = FormatFeatureBit.SAMPLED_TEXTURE | FormatFeatureBit.LINEAR_FILTER;\n    const device = ppl.device;\n    // Platform\n    configs.isWeb = !sys.isNative;\n    configs.isWebGL1 = device.gfxAPI === gfx.API.WEBGL;\n    configs.isWebGPU = device.gfxAPI === gfx.API.WEBGPU;\n    configs.isMobile = sys.isMobile;\n\n    // Rendering\n    configs.isHDR = ppl.pipelineSceneData.isHDR; // Has tone mapping\n    configs.useFloatOutput = ppl.getMacroBool('CC_USE_FLOAT_OUTPUT');\n    configs.toneMappingType = ppl.pipelineSceneData.postSettings.toneMappingType;\n    // Shadow\n    const shadowInfo = ppl.pipelineSceneData.shadows;\n    configs.shadowEnabled = shadowInfo.enabled;\n    configs.shadowMapFormat = pipeline.supportsR32FloatTexture(ppl.device) ? Format.R32F : Format.RGBA8;\n    configs.shadowMapSize.set(shadowInfo.size);\n    configs.usePlanarShadow = shadowInfo.enabled && shadowInfo.type === renderer.scene.ShadowType.Planar;\n    // Device\n    configs.screenSpaceSignY = ppl.device.capabilities.screenSpaceSignY;\n    configs.supportDepthSample = (ppl.device.getFormatFeatures(Format.DEPTH_STENCIL) & sampleFeature) === sampleFeature;\n    // Constants\n    const screenSpaceSignY = device.capabilities.screenSpaceSignY;\n    configs.platform.x = configs.isMobile ? 1.0 : 0.0;\n    configs.platform.w = (screenSpaceSignY * 0.5 + 0.5) << 1 | (device.capabilities.clipSpaceSignY * 0.5 + 0.5);\n}\n\nexport interface PipelineSettings2 extends PipelineSettings {\n    _passes?: rendering.PipelinePassBuilder[];\n}\n\nconst defaultSettings = makePipelineSettings();\n\nexport class CameraConfigs {\n    settings: PipelineSettings = defaultSettings;\n    // Window\n    isMainGameWindow = false;\n    renderWindowId = 0;\n    // Camera\n    colorName = '';\n    depthStencilName = '';\n    // Pipeline\n    enableFullPipeline = false;\n    enableProfiler = false;\n    remainingPasses = 0;\n    // Shading Scale\n    enableShadingScale = false;\n    shadingScale = 1.0;\n    nativeWidth = 1;\n    nativeHeight = 1;\n    width = 1; // Scaled width\n    height = 1; // Scaled height\n    // Radiance\n    enableHDR = false;\n    radianceFormat = gfx.Format.RGBA8;\n    // Tone Mapping\n    copyAndTonemapMaterial: Material | null = null;\n    // Depth\n    /** @en mutable */\n    enableStoreSceneDepth = false;\n}\n\nconst sClearColorTransparentBlack = new Color(0, 0, 0, 0);\n\nfunction sortPipelinePassBuildersByConfigOrder(passBuilders: rendering.PipelinePassBuilder[]): void {\n    passBuilders.sort((a, b) => {\n        return a.getConfigOrder() - b.getConfigOrder();\n    });\n}\n\nfunction sortPipelinePassBuildersByRenderOrder(passBuilders: rendering.PipelinePassBuilder[]): void {\n    passBuilders.sort((a, b) => {\n        return a.getRenderOrder() - b.getRenderOrder();\n    });\n}\n\nfunction addCopyToScreenPass(\n    ppl: rendering.BasicPipeline,\n    pplConfigs: Readonly<PipelineConfigs>,\n    cameraConfigs: CameraConfigs,\n    input: string,\n): rendering.BasicRenderPassBuilder {\n    assert(!!cameraConfigs.copyAndTonemapMaterial);\n    const pass = ppl.addRenderPass(\n        cameraConfigs.nativeWidth,\n        cameraConfigs.nativeHeight,\n        'cc-tone-mapping');\n    pass.addRenderTarget(\n        cameraConfigs.colorName,\n        LoadOp.CLEAR, StoreOp.STORE,\n        sClearColorTransparentBlack);\n    pass.addTexture(input, 'inputTexture');\n    pass.addQueue(rendering.QueueHint.OPAQUE)\n        .addFullscreenQuad(cameraConfigs.copyAndTonemapMaterial, 1);\n    return pass;\n}\n\nexport function getPingPongRenderTarget(prevName: string, prefix: string, id: number): string {\n    if (prevName.startsWith(prefix)) {\n        return `${prefix}${1 - Number(prevName.charAt(prefix.length))}_${id}`;\n    } else {\n        return `${prefix}0_${id}`;\n    }\n}\n\nexport interface PipelineContext {\n    colorName: string;\n    depthStencilName: string;\n}\n\nclass ForwardLighting {\n    // Active lights\n    private readonly lights: renderer.scene.Light[] = [];\n    // Active spot lights with shadows (Mutually exclusive with `lights`)\n    private readonly shadowEnabledSpotLights: renderer.scene.SpotLight[] = [];\n\n    // Internal cached resources\n    private readonly _sphere = Sphere.create(0, 0, 0, 1);\n    private readonly _boundingBox = new AABB();\n    private readonly _rangedDirLightBoundingBox = new AABB(0.0, 0.0, 0.0, 0.5, 0.5, 0.5);\n\n    // ----------------------------------------------------------------\n    // Interface\n    // ----------------------------------------------------------------\n    public cullLights(scene: renderer.RenderScene, frustum: geometry.Frustum, cameraPos?: Vec3): void {\n        // TODO(zhouzhenglong): Make light culling native\n        this.lights.length = 0;\n        this.shadowEnabledSpotLights.length = 0;\n        // spot lights\n        for (const light of scene.spotLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                if (light.shadowEnabled) {\n                    this.shadowEnabledSpotLights.push(light);\n                } else {\n                    this.lights.push(light);\n                }\n            }\n        }\n        // sphere lights\n        for (const light of scene.sphereLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                this.lights.push(light);\n            }\n        }\n        // point lights\n        for (const light of scene.pointLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                this.lights.push(light);\n            }\n        }\n        // ranged dir lights\n        for (const light of scene.rangedDirLights) {\n            AABB.transform(this._boundingBox, this._rangedDirLightBoundingBox, light.node!.getWorldMatrix());\n            if (intersect.aabbFrustum(this._boundingBox, frustum)) {\n                this.lights.push(light);\n            }\n        }\n\n        if (cameraPos) {\n            this.shadowEnabledSpotLights.sort(\n                (lhs, rhs) => Vec3.squaredDistance(cameraPos, lhs.position) - Vec3.squaredDistance(cameraPos, rhs.position),\n            );\n        }\n    }\n    private _addLightQueues(camera: renderer.scene.Camera, pass: rendering.BasicRenderPassBuilder): void {\n        for (const light of this.lights) {\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            switch (light.type) {\n                case LightType.SPHERE:\n                    queue.name = 'sphere-light';\n                    break;\n                case LightType.SPOT:\n                    queue.name = 'spot-light';\n                    break;\n                case LightType.POINT:\n                    queue.name = 'point-light';\n                    break;\n                case LightType.RANGED_DIRECTIONAL:\n                    queue.name = 'ranged-directional-light';\n                    break;\n                default:\n                    queue.name = 'unknown-light';\n            }\n            queue.addScene(\n                camera,\n                rendering.SceneFlags.BLEND,\n                light,\n            );\n        }\n    }\n    public addSpotlightShadowPasses(\n        ppl: rendering.BasicPipeline,\n        camera: renderer.scene.Camera,\n        maxNumShadowMaps: number,\n    ): void {\n        let i = 0;\n        for (const light of this.shadowEnabledSpotLights) {\n            const shadowMapSize = ppl.pipelineSceneData.shadows.size;\n            const shadowPass = ppl.addRenderPass(shadowMapSize.x, shadowMapSize.y, 'default');\n            shadowPass.name = `SpotLightShadowPass${i}`;\n            shadowPass.addRenderTarget(`SpotShadowMap${i}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n            shadowPass.addDepthStencil(`SpotShadowDepth${i}`, LoadOp.CLEAR, StoreOp.DISCARD);\n            shadowPass.addQueue(rendering.QueueHint.NONE, 'shadow-caster')\n                .addScene(camera, rendering.SceneFlags.OPAQUE | rendering.SceneFlags.MASK | rendering.SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light);\n            ++i;\n            if (i >= maxNumShadowMaps) {\n                break;\n            }\n        }\n    }\n    public addLightQueues(pass: rendering.BasicRenderPassBuilder,\n        camera: renderer.scene.Camera, maxNumShadowMaps: number): void {\n        this._addLightQueues(camera, pass);\n        let i = 0;\n        for (const light of this.shadowEnabledSpotLights) {\n            // Add spot-light pass\n            // Save last RenderPass to the `pass` variable\n            // TODO(zhouzhenglong): Fix per queue addTexture\n            pass.addTexture(`SpotShadowMap${i}`, 'cc_spotShadowMap');\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            queue.addScene(camera, rendering.SceneFlags.BLEND, light);\n            ++i;\n            if (i >= maxNumShadowMaps) {\n                break;\n            }\n        }\n    }\n\n    // Notice: ForwardLighting cannot handle a lot of lights.\n    // If there are too many lights, the performance will be very poor.\n    // If many lights are needed, please implement a forward+ or deferred rendering pipeline.\n    public addLightPasses(\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp,\n        id: number, // window id\n        width: number,\n        height: number,\n        camera: renderer.scene.Camera,\n        viewport: gfx.Viewport,\n        ppl: rendering.BasicPipeline,\n        pass: rendering.BasicRenderPassBuilder,\n    ): rendering.BasicRenderPassBuilder {\n        this._addLightQueues(camera, pass);\n\n        let count = 0;\n        const shadowMapSize = ppl.pipelineSceneData.shadows.size;\n        for (const light of this.shadowEnabledSpotLights) {\n            const shadowPass = ppl.addRenderPass(shadowMapSize.x, shadowMapSize.y, 'default');\n            shadowPass.name = 'SpotlightShadowPass';\n            // Reuse csm shadow map\n            shadowPass.addRenderTarget(`ShadowMap${id}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n            shadowPass.addDepthStencil(`ShadowDepth${id}`, LoadOp.CLEAR, StoreOp.DISCARD);\n            shadowPass.addQueue(rendering.QueueHint.NONE, 'shadow-caster')\n                .addScene(camera, rendering.SceneFlags.OPAQUE | rendering.SceneFlags.MASK | rendering.SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light);\n\n            // Add spot-light pass\n            // Save last RenderPass to the `pass` variable\n            ++count;\n            const storeOp = count === this.shadowEnabledSpotLights.length\n                ? depthStencilStoreOp\n                : StoreOp.STORE;\n\n            pass = ppl.addRenderPass(width, height, 'default');\n            pass.name = 'SpotlightWithShadowMap';\n            pass.setViewport(viewport);\n            pass.addRenderTarget(colorName, LoadOp.LOAD);\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, storeOp);\n            pass.addTexture(`ShadowMap${id}`, 'cc_spotShadowMap');\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            queue.addScene(\n                camera,\n                rendering.SceneFlags.BLEND,\n                light,\n            );\n        }\n        return pass;\n    }\n\n    public isMultipleLightPassesNeeded(): boolean {\n        return this.shadowEnabledSpotLights.length > 0;\n    }\n}\n\nexport interface ForwardPassConfigs {\n    enableMainLightShadowMap: boolean;\n    enableMainLightPlanarShadowMap: boolean;\n    enablePlanarReflectionProbe: boolean;\n    enableMSAA: boolean;\n    enableSingleForwardPass: boolean;\n}\n\nexport class BuiltinForwardPassBuilder implements rendering.PipelinePassBuilder {\n    static ConfigOrder = 100;\n    static RenderOrder = 100;\n    getConfigOrder(): number {\n        return BuiltinForwardPassBuilder.ConfigOrder;\n    }\n    getRenderOrder(): number {\n        return BuiltinForwardPassBuilder.RenderOrder;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pipelineConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ForwardPassConfigs): void {\n        // Shadow\n        cameraConfigs.enableMainLightShadowMap = pipelineConfigs.shadowEnabled\n            && !pipelineConfigs.usePlanarShadow\n            && !!camera.scene\n            && !!camera.scene.mainLight\n            && camera.scene.mainLight.shadowEnabled;\n\n        cameraConfigs.enableMainLightPlanarShadowMap = pipelineConfigs.shadowEnabled\n            && pipelineConfigs.usePlanarShadow\n            && !!camera.scene\n            && !!camera.scene.mainLight\n            && camera.scene.mainLight.shadowEnabled;\n\n        // Reflection Probe\n        cameraConfigs.enablePlanarReflectionProbe = cameraConfigs.isMainGameWindow\n            || camera.cameraUsage === CameraUsage.SCENE_VIEW\n            || camera.cameraUsage === CameraUsage.GAME_VIEW;\n\n        // MSAA\n        cameraConfigs.enableMSAA = cameraConfigs.settings.msaa.enabled\n            && !cameraConfigs.enableStoreSceneDepth // Cannot store MS depth, resolve depth is also not cross-platform\n            && !pipelineConfigs.isWeb // TODO(zhouzhenglong): remove this constraint\n            && !pipelineConfigs.isWebGL1;\n\n        // Forward rendering (Depend on MSAA and TBR)\n        cameraConfigs.enableSingleForwardPass\n            = pipelineConfigs.isMobile || cameraConfigs.enableMSAA;\n\n        ++cameraConfigs.remainingPasses;\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        window: renderer.RenderWindow,\n        camera: renderer.scene.Camera,\n        nativeWidth: number,\n        nativeHeight: number): void {\n        const ResourceFlags = rendering.ResourceFlags;\n        const ResourceResidency = rendering.ResourceResidency;\n        const id = window.renderWindowId;\n        const settings = cameraConfigs.settings;\n\n        const width = cameraConfigs.enableShadingScale\n            ? Math.max(Math.floor(nativeWidth * cameraConfigs.shadingScale), 1)\n            : nativeWidth;\n        const height = cameraConfigs.enableShadingScale\n            ? Math.max(Math.floor(nativeHeight * cameraConfigs.shadingScale), 1)\n            : nativeHeight;\n\n        // MsaaRadiance\n        if (cameraConfigs.enableMSAA) {\n            // Notice: We never store multisample results.\n            // These samples are always resolved and discarded at the end of the render pass.\n            // So the ResourceResidency should be MEMORYLESS.\n            if (cameraConfigs.enableHDR) {\n                ppl.addTexture(`MsaaRadiance${id}`, TextureType.TEX2D, cameraConfigs.radianceFormat, width, height, 1, 1, 1,\n                    settings.msaa.sampleCount, ResourceFlags.COLOR_ATTACHMENT, ResourceResidency.MEMORYLESS);\n            } else {\n                ppl.addTexture(`MsaaRadiance${id}`, TextureType.TEX2D, Format.RGBA8, width, height, 1, 1, 1,\n                    settings.msaa.sampleCount, ResourceFlags.COLOR_ATTACHMENT, ResourceResidency.MEMORYLESS);\n            }\n            ppl.addTexture(`MsaaDepthStencil${id}`, TextureType.TEX2D, Format.DEPTH_STENCIL, width, height, 1, 1, 1,\n                settings.msaa.sampleCount, ResourceFlags.DEPTH_STENCIL_ATTACHMENT, ResourceResidency.MEMORYLESS);\n        }\n\n        // Mainlight ShadowMap\n        ppl.addRenderTarget(\n            `ShadowMap${id}`,\n            pplConfigs.shadowMapFormat,\n            pplConfigs.shadowMapSize.x,\n            pplConfigs.shadowMapSize.y,\n        );\n        ppl.addDepthStencil(\n            `ShadowDepth${id}`,\n            Format.DEPTH_STENCIL,\n            pplConfigs.shadowMapSize.x,\n            pplConfigs.shadowMapSize.y,\n        );\n\n        // Spot-light shadow maps\n        if (cameraConfigs.enableSingleForwardPass) {\n            const count = pplConfigs.mobileMaxSpotLightShadowMaps;\n            for (let i = 0; i !== count; ++i) {\n                ppl.addRenderTarget(\n                    `SpotShadowMap${i}`,\n                    pplConfigs.shadowMapFormat,\n                    pplConfigs.shadowMapSize.x,\n                    pplConfigs.shadowMapSize.y,\n                );\n                ppl.addDepthStencil(\n                    `SpotShadowDepth${i}`,\n                    Format.DEPTH_STENCIL,\n                    pplConfigs.shadowMapSize.x,\n                    pplConfigs.shadowMapSize.y,\n                );\n            }\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ForwardPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext): rendering.BasicRenderPassBuilder | undefined {\n        // Add global constants\n        ppl.setVec4('g_platform', pplConfigs.platform);\n\n        const id = camera.window.renderWindowId;\n\n        const scene = camera.scene!;\n        const mainLight = scene.mainLight;\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n\n        // Forward Lighting (Light Culling)\n        this.forwardLighting.cullLights(scene, camera.frustum);\n\n        // Main Directional light CSM Shadow Map\n        if (cameraConfigs.enableMainLightShadowMap) {\n            assert(!!mainLight);\n            this._addCascadedShadowMapPass(ppl, pplConfigs, id, mainLight, camera);\n        }\n\n        // Spot light shadow maps (Mobile or MSAA)\n        if (cameraConfigs.enableSingleForwardPass) {\n            // Currently, only support 1 spot light with shadow map on mobile platform.\n            // TODO(zhouzhenglong): Relex this limitation.\n            this.forwardLighting.addSpotlightShadowPasses(\n                ppl, camera, pplConfigs.mobileMaxSpotLightShadowMaps);\n        }\n\n        this._tryAddReflectionProbePasses(ppl, cameraConfigs, id, mainLight, camera.scene);\n\n        if (cameraConfigs.remainingPasses > 0 || cameraConfigs.enableShadingScale) {\n            context.colorName = cameraConfigs.enableShadingScale\n                ? `ScaledRadiance0_${id}`\n                : `Radiance0_${id}`;\n            context.depthStencilName = cameraConfigs.enableShadingScale\n                ? `ScaledSceneDepth_${id}`\n                : `SceneDepth_${id}`;\n        } else {\n            context.colorName = cameraConfigs.colorName;\n            context.depthStencilName = cameraConfigs.depthStencilName;\n        }\n\n        const pass = this._addForwardRadiancePasses(\n            ppl, pplConfigs, cameraConfigs, id, camera,\n            cameraConfigs.width, cameraConfigs.height, mainLight,\n            context.colorName, context.depthStencilName,\n            !cameraConfigs.enableMSAA,\n            cameraConfigs.enableStoreSceneDepth ? StoreOp.STORE : StoreOp.DISCARD);\n\n        if (!cameraConfigs.enableStoreSceneDepth) {\n            context.depthStencilName = '';\n        }\n\n        if (cameraConfigs.remainingPasses === 0 && cameraConfigs.enableShadingScale) {\n            return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, context.colorName);\n        } else {\n            return pass;\n        }\n    }\n    private _addCascadedShadowMapPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        id: number,\n        light: renderer.scene.DirectionalLight,\n        camera: renderer.scene.Camera,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // ----------------------------------------------------------------\n        // Dynamic states\n        // ----------------------------------------------------------------\n        const shadowSize = ppl.pipelineSceneData.shadows.size;\n        const width = shadowSize.x;\n        const height = shadowSize.y;\n\n        const viewport = this._viewport;\n        viewport.left = viewport.top = 0;\n        viewport.width = width;\n        viewport.height = height;\n\n        // ----------------------------------------------------------------\n        // CSM Shadow Map\n        // ----------------------------------------------------------------\n        const pass = ppl.addRenderPass(width, height, 'default');\n        pass.name = 'CascadedShadowMap';\n        pass.addRenderTarget(`ShadowMap${id}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n        pass.addDepthStencil(`ShadowDepth${id}`, LoadOp.CLEAR, StoreOp.DISCARD);\n        const csmLevel = ppl.pipelineSceneData.csmSupported ? light.csmLevel : 1;\n\n        // Add shadow map viewports\n        for (let level = 0; level !== csmLevel; ++level) {\n            getCsmMainLightViewport(light, width, height, level, this._viewport, pplConfigs.screenSpaceSignY);\n            const queue = pass.addQueue(QueueHint.NONE, 'shadow-caster');\n            if (!pplConfigs.isWebGPU) { // Temporary workaround for WebGPU\n                queue.setViewport(this._viewport);\n            }\n            queue\n                .addScene(camera, SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light, level);\n        }\n    }\n    private _tryAddReflectionProbePasses(\n        ppl: rendering.BasicPipeline,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null,\n    ): void {\n        const reflectionProbeManager = cclegacy.internal.reflectionProbeManager as ReflectionProbeManager | undefined;\n        if (!reflectionProbeManager) {\n            return;\n        }\n        const ResourceResidency = rendering.ResourceResidency;\n        const probes = reflectionProbeManager.getProbes();\n        const maxProbeCount = 4;\n        let probeID = 0;\n        for (const probe of probes) {\n            if (!probe.needRender) {\n                continue;\n            }\n            const area = probe.renderArea();\n            const width = Math.max(Math.floor(area.x), 1);\n            const height = Math.max(Math.floor(area.y), 1);\n\n            if (probe.probeType === renderer.scene.ProbeType.PLANAR) {\n                if (!cameraConfigs.enablePlanarReflectionProbe) {\n                    continue;\n                }\n                const window: renderer.RenderWindow = probe.realtimePlanarTexture!.window!;\n                const colorName = `PlanarProbeRT${probeID}`;\n                const depthStencilName = `PlanarProbeDS${probeID}`;\n                // ProbeResource\n                ppl.addRenderWindow(colorName,\n                    cameraConfigs.radianceFormat, width, height, window);\n                ppl.addDepthStencil(depthStencilName,\n                    gfx.Format.DEPTH_STENCIL, width, height, ResourceResidency.MEMORYLESS);\n\n                // Rendering\n                const probePass = ppl.addRenderPass(width, height, 'default');\n                probePass.name = `PlanarReflectionProbe${probeID}`;\n                this._buildReflectionProbePass(probePass, cameraConfigs, id, probe.camera,\n                    colorName, depthStencilName, mainLight, scene);\n            } else if (EDITOR) {\n                for (let faceIdx = 0; faceIdx < probe.bakedCubeTextures.length; faceIdx++) {\n                    probe.updateCameraDir(faceIdx);\n                    const window: renderer.RenderWindow = probe.bakedCubeTextures[faceIdx].window!;\n                    const colorName = `CubeProbeRT${probeID}${faceIdx}`;\n                    const depthStencilName = `CubeProbeDS${probeID}${faceIdx}`;\n                    // ProbeResource\n                    ppl.addRenderWindow(colorName,\n                        cameraConfigs.radianceFormat, width, height, window);\n                    ppl.addDepthStencil(depthStencilName,\n                        gfx.Format.DEPTH_STENCIL, width, height, ResourceResidency.MEMORYLESS);\n\n                    // Rendering\n                    const probePass = ppl.addRenderPass(width, height, 'default');\n                    probePass.name = `CubeProbe${probeID}${faceIdx}`;\n                    this._buildReflectionProbePass(probePass, cameraConfigs, id, probe.camera,\n                        colorName, depthStencilName, mainLight, scene);\n                }\n                probe.needRender = false;\n            }\n            ++probeID;\n            if (probeID === maxProbeCount) {\n                break;\n            }\n        }\n    }\n    private _buildReflectionProbePass(\n        pass: rendering.BasicRenderPassBuilder,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        colorName: string,\n        depthStencilName: string,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null = null,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // set viewport\n        const colorStoreOp = cameraConfigs.enableMSAA ? StoreOp.DISCARD : StoreOp.STORE;\n\n        // bind output render target\n        if (forwardNeedClearColor(camera)) {\n            this._reflectionProbeClearColor.x = camera.clearColor.x;\n            this._reflectionProbeClearColor.y = camera.clearColor.y;\n            this._reflectionProbeClearColor.z = camera.clearColor.z;\n            const clearColor = rendering.packRGBE(this._reflectionProbeClearColor);\n            this._clearColor.x = clearColor.x;\n            this._clearColor.y = clearColor.y;\n            this._clearColor.z = clearColor.z;\n            this._clearColor.w = clearColor.w;\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, colorStoreOp, this._clearColor);\n        } else {\n            pass.addRenderTarget(colorName, LoadOp.LOAD, colorStoreOp);\n        }\n\n        // bind depth stencil buffer\n        if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n            pass.addDepthStencil(\n                depthStencilName,\n                LoadOp.CLEAR,\n                StoreOp.DISCARD,\n                camera.clearDepth,\n                camera.clearStencil,\n                camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n            );\n        } else {\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, StoreOp.DISCARD);\n        }\n\n        // Set shadow map if enabled\n        if (cameraConfigs.enableMainLightShadowMap) {\n            pass.addTexture(`ShadowMap${id}`, 'cc_shadowMap');\n        }\n\n        // TODO(zhouzhenglong): Separate OPAQUE and MASK queue\n\n        // add opaque and mask queue\n        pass.addQueue(QueueHint.NONE, 'reflect-map') // Currently we put OPAQUE and MASK into one queue, so QueueHint is NONE\n            .addScene(camera,\n                SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.REFLECTION_PROBE,\n                mainLight || undefined,\n                scene ? scene : undefined);\n    }\n    private _addForwardRadiancePasses(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        disableMSAA: boolean = false,\n        depthStencilStoreOp: gfx.StoreOp = StoreOp.DISCARD,\n    ): rendering.BasicRenderPassBuilder {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // ----------------------------------------------------------------\n        // Dynamic states\n        // ----------------------------------------------------------------\n        // Prepare camera clear color\n        const clearColor = camera.clearColor; // Reduce C++/TS interop\n        this._clearColor.x = clearColor.x;\n        this._clearColor.y = clearColor.y;\n        this._clearColor.z = clearColor.z;\n        this._clearColor.w = clearColor.w;\n\n        // Prepare camera viewport\n        const viewport = camera.viewport; // Reduce C++/TS interop\n        this._viewport.left = Math.round(viewport.x * width);\n        this._viewport.top = Math.round(viewport.y * height);\n        // Here we must use camera.viewport.width instead of camera.viewport.z, which\n        // is undefined on native platform. The same as camera.viewport.height.\n        this._viewport.width = Math.max(Math.round(viewport.width * width), 1);\n        this._viewport.height = Math.max(Math.round(viewport.height * height), 1);\n\n        // MSAA\n        const enableMSAA = !disableMSAA && cameraConfigs.enableMSAA;\n        assert(!enableMSAA || cameraConfigs.enableSingleForwardPass);\n\n        // ----------------------------------------------------------------\n        // Forward Lighting (Main Directional Light)\n        // ----------------------------------------------------------------\n        const pass = cameraConfigs.enableSingleForwardPass\n            ? this._addForwardSingleRadiancePass(ppl, pplConfigs, cameraConfigs,\n                id, camera, enableMSAA, width, height, mainLight,\n                colorName, depthStencilName, depthStencilStoreOp)\n            : this._addForwardMultipleRadiancePasses(ppl, cameraConfigs,\n                id, camera, width, height, mainLight,\n                colorName, depthStencilName, depthStencilStoreOp);\n\n        // Planar Shadow\n        if (cameraConfigs.enableMainLightPlanarShadowMap) {\n            this._addPlanarShadowQueue(camera, mainLight, pass);\n        }\n\n        // ----------------------------------------------------------------\n        // Forward Lighting (Blend)\n        // ----------------------------------------------------------------\n        // Add transparent queue\n\n        const sceneFlags = SceneFlags.BLEND |\n            (camera.geometryRenderer\n                ? SceneFlags.GEOMETRY\n                : SceneFlags.NONE);\n\n        pass\n            .addQueue(QueueHint.BLEND)\n            .addScene(camera, sceneFlags, mainLight || undefined);\n\n        return pass;\n    }\n    private _addForwardSingleRadiancePass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        enableMSAA: boolean,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp\n    ): rendering.BasicRenderPassBuilder {\n        assert(cameraConfigs.enableSingleForwardPass);\n        // ----------------------------------------------------------------\n        // Forward Lighting (Main Directional Light)\n        // ----------------------------------------------------------------\n        let pass: rendering.BasicRenderPassBuilder;\n        if (enableMSAA) {\n            const msaaRadianceName = `MsaaRadiance${id}`;\n            const msaaDepthStencilName = `MsaaDepthStencil${id}`;\n            const sampleCount = cameraConfigs.settings.msaa.sampleCount;\n\n            const msPass = ppl.addMultisampleRenderPass(width, height, sampleCount, 0, 'default');\n            msPass.name = 'MsaaForwardPass';\n\n            // MSAA always discards depth stencil\n            this._buildForwardMainLightPass(msPass, cameraConfigs, id, camera,\n                msaaRadianceName, msaaDepthStencilName, StoreOp.DISCARD, mainLight);\n\n            msPass.resolveRenderTarget(msaaRadianceName, colorName);\n\n            pass = msPass;\n        } else {\n            pass = ppl.addRenderPass(width, height, 'default');\n            pass.name = 'ForwardPass';\n\n            this._buildForwardMainLightPass(pass, cameraConfigs, id, camera,\n                colorName, depthStencilName, depthStencilStoreOp, mainLight);\n        }\n        assert(pass !== undefined);\n\n        // Forward Lighting (Additive Lights)\n        this.forwardLighting.addLightQueues(\n            pass,\n            camera,\n            pplConfigs.mobileMaxSpotLightShadowMaps,\n        );\n\n        return pass;\n    }\n    private _addForwardMultipleRadiancePasses(\n        ppl: rendering.BasicPipeline,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp\n    ): rendering.BasicRenderPassBuilder {\n        assert(!cameraConfigs.enableSingleForwardPass);\n\n        // Forward Lighting (Main Directional Light)\n        let pass = ppl.addRenderPass(width, height, 'default');\n        pass.name = 'ForwardPass';\n\n        const firstStoreOp = this.forwardLighting.isMultipleLightPassesNeeded()\n            ? StoreOp.STORE\n            : depthStencilStoreOp;\n\n        this._buildForwardMainLightPass(pass, cameraConfigs,\n            id, camera, colorName, depthStencilName, firstStoreOp, mainLight);\n\n        // Forward Lighting (Additive Lights)\n        pass = this.forwardLighting\n            .addLightPasses(colorName, depthStencilName, depthStencilStoreOp,\n                id, width, height, camera, this._viewport, ppl, pass);\n\n        return pass;\n    }\n    private _buildForwardMainLightPass(\n        pass: rendering.BasicRenderPassBuilder,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null = null,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // set viewport\n        pass.setViewport(this._viewport);\n\n        const colorStoreOp = cameraConfigs.enableMSAA ? StoreOp.DISCARD : StoreOp.STORE;\n\n        // bind output render target\n        if (forwardNeedClearColor(camera)) {\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, colorStoreOp, this._clearColor);\n        } else {\n            pass.addRenderTarget(colorName, LoadOp.LOAD, colorStoreOp);\n        }\n\n        // bind depth stencil buffer\n        if (DEBUG) {\n            if (colorName === cameraConfigs.colorName &&\n                depthStencilName !== cameraConfigs.depthStencilName) {\n                warn('Default framebuffer cannot use custom depth stencil buffer');\n            }\n        }\n\n        if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n            pass.addDepthStencil(\n                depthStencilName,\n                LoadOp.CLEAR,\n                depthStencilStoreOp,\n                camera.clearDepth,\n                camera.clearStencil,\n                camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n            );\n        } else {\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, depthStencilStoreOp);\n        }\n\n        // Set shadow map if enabled\n        if (cameraConfigs.enableMainLightShadowMap) {\n            pass.addTexture(`ShadowMap${id}`, 'cc_shadowMap');\n        }\n\n        // TODO(zhouzhenglong): Separate OPAQUE and MASK queue\n\n        // add opaque and mask queue\n        pass.addQueue(QueueHint.NONE) // Currently we put OPAQUE and MASK into one queue, so QueueHint is NONE\n            .addScene(camera,\n                SceneFlags.OPAQUE | SceneFlags.MASK,\n                mainLight || undefined,\n                scene ? scene : undefined);\n    }\n    private _addPlanarShadowQueue(\n        camera: renderer.scene.Camera,\n        mainLight: renderer.scene.DirectionalLight | null,\n        pass: rendering.BasicRenderPassBuilder,\n    ) {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        pass.addQueue(QueueHint.BLEND, 'planar-shadow')\n            .addScene(\n                camera,\n                SceneFlags.SHADOW_CASTER | SceneFlags.PLANAR_SHADOW | SceneFlags.BLEND,\n                mainLight || undefined,\n            );\n    }\n    private readonly forwardLighting = new ForwardLighting();\n    private readonly _viewport = new Viewport();\n    private readonly _clearColor = new Color(0, 0, 0, 1);\n    private readonly _reflectionProbeClearColor = new Vec3(0, 0, 0);\n}\n\nexport interface BloomPassConfigs {\n    enableBloom: boolean;\n}\n\nfunction downSize(size: number, scale: number): number {\n    return Math.max(Math.floor(size * scale), 1);\n}\n\ninterface RenderTextureDesc {\n    name: string;\n    width: number;\n    height: number;\n}\n\nexport class BuiltinBloomPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 200;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pipelineConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs): void {\n        const { bloom } = cameraConfigs.settings;\n        const hasValidMaterial = (\n            bloom.type === BloomType.KawaseDualFilter && !!bloom.kawaseFilterMaterial ||\n            bloom.type === BloomType.MipmapFilter && !!bloom.mipmapFilterMaterial\n        );\n        cameraConfigs.enableBloom = bloom.enabled && hasValidMaterial;\n\n        if (cameraConfigs.enableBloom) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs,\n        window: renderer.RenderWindow): void {\n        if (!cameraConfigs.enableBloom) {\n            return;\n        }\n\n        const { width, height, settings: { bloom } } = cameraConfigs;\n        const id = window.renderWindowId;\n        const format = cameraConfigs.radianceFormat;\n\n        if (bloom.type === BloomType.KawaseDualFilter) {\n            let bloomWidth = cameraConfigs.width;\n            let bloomHeight = cameraConfigs.height;\n            for (let i = 0; i !== bloom.iterations + 1; ++i) {\n                bloomWidth = Math.max(Math.floor(bloomWidth / 2), 1);\n                bloomHeight = Math.max(Math.floor(bloomHeight / 2), 1);\n                ppl.addRenderTarget(`BloomTex${id}_${i}`, format, bloomWidth, bloomHeight);\n            }\n        } else if (bloom.type === BloomType.MipmapFilter) {\n            const iterations = bloom.iterations;\n            for (let i = 0; i !== iterations + 1; ++i) {\n                // DownSample\n                if (i < iterations) {\n                    const scale = Math.pow(0.5, i + 2);\n                    this._bloomDownSampleTexDescs[i] = this.createTexture(\n                        ppl,\n                        `DownSampleColor${id}${i}`,\n                        downSize(width, scale),\n                        downSize(height, scale),\n                        format);\n                }\n                // UpSample\n                if (i < iterations - 1) {\n                    const scale = Math.pow(0.5, iterations - i - 1);\n                    this._bloomUpSampleTexDescs[i] = this.createTexture(\n                        ppl,\n                        `UpSampleColor${id}${i}`,\n                        downSize(width, scale),\n                        downSize(height, scale),\n                        format);\n                }\n            }\n            this._originalColorDesc = this.createTexture(ppl, `OriginalColor${id}`, width, height, format);\n            this._prefilterTexDesc = this.createTexture(ppl, `PrefilterColor${id}`,\n                downSize(width, 0.5), downSize(height, 0.5), format);\n        }\n    }\n    private createTexture(\n        ppl: rendering.BasicPipeline,\n        name: string, width: number, height: number, format: number): RenderTextureDesc {\n        const desc = { name, width, height };\n        ppl.addRenderTarget(desc.name, format, desc.width, desc.height);\n        return desc;\n    }\n\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableBloom) {\n            return prevRenderPass;\n        }\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n\n        const bloom = cameraConfigs.settings.bloom;\n        const id = camera.window.renderWindowId;\n\n        switch (bloom.type) {\n            case BloomType.KawaseDualFilter: {\n                const material = bloom.kawaseFilterMaterial;\n                assert(!!material);\n                return this._addKawaseDualFilterBloomPasses(\n                    ppl, pplConfigs,\n                    cameraConfigs,\n                    cameraConfigs.settings,\n                    material,\n                    id,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName);\n            }\n            case BloomType.MipmapFilter: {\n                const material = bloom.mipmapFilterMaterial;\n                assert(!!material);\n                return this._addMipmapFilterBloomPasses(\n                    ppl, pplConfigs,\n                    cameraConfigs,\n                    cameraConfigs.settings,\n                    material,\n                    id,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName);\n            }\n            default:\n                return prevRenderPass;\n        }\n    }\n    private _addKawaseDualFilterBloomPasses(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & Readonly<BloomPassConfigs>,\n        settings: PipelineSettings,\n        bloomMaterial: Material,\n        id: number,\n        width: number,\n        height: number,\n        radianceName: string,\n    ): rendering.BasicRenderPassBuilder {\n        const QueueHint = rendering.QueueHint;\n        // Based on Kawase Dual Filter Blur. Saves bandwidth on mobile devices.\n        // eslint-disable-next-line max-len\n        // https://community.arm.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-20-66/siggraph2015_2D00_mmg_2D00_marius_2D00_slides.pdf\n\n        // Size: [prefilter(1/2), downsample(1/4), downsample(1/8), downsample(1/16), ...]\n        const iterations = settings.bloom.iterations;\n        const sizeCount = iterations + 1;\n        this._bloomWidths.length = sizeCount;\n        this._bloomHeights.length = sizeCount;\n        this._bloomWidths[0] = Math.max(Math.floor(width / 2), 1);\n        this._bloomHeights[0] = Math.max(Math.floor(height / 2), 1);\n        for (let i = 1; i !== sizeCount; ++i) {\n            this._bloomWidths[i] = Math.max(Math.floor(this._bloomWidths[i - 1] / 2), 1);\n            this._bloomHeights[i] = Math.max(Math.floor(this._bloomHeights[i - 1] / 2), 1);\n        }\n\n        // Bloom texture names\n        this._bloomTexNames.length = sizeCount;\n        for (let i = 0; i !== sizeCount; ++i) {\n            this._bloomTexNames[i] = `BloomTex${id}_${i}`;\n        }\n\n        // Setup bloom parameters\n        this._bloomParams.x = pplConfigs.useFloatOutput ? 1 : 0;\n        this._bloomParams.y = 0; // unused\n        this._bloomParams.z = settings.bloom.threshold;\n        this._bloomParams.w = settings.bloom.enableAlphaMask ? 1 : 0;\n\n        // Prefilter pass\n        const prefilterPass = ppl.addRenderPass(this._bloomWidths[0], this._bloomHeights[0], 'cc-bloom-prefilter');\n        prefilterPass.addRenderTarget(\n            this._bloomTexNames[0],\n            LoadOp.CLEAR,\n            StoreOp.STORE,\n            this._clearColorTransparentBlack,\n        );\n        prefilterPass.addTexture(radianceName, 'inputTexture');\n        prefilterPass.setVec4('bloomParams', this._bloomParams);\n        prefilterPass\n            .addQueue(QueueHint.OPAQUE)\n            .addFullscreenQuad(bloomMaterial, 0);\n\n        // Downsample passes\n        for (let i = 1; i !== sizeCount; ++i) {\n            const downPass = ppl.addRenderPass(this._bloomWidths[i], this._bloomHeights[i], 'cc-bloom-downsample');\n            downPass.addRenderTarget(this._bloomTexNames[i], LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\n            downPass.addTexture(this._bloomTexNames[i - 1], 'bloomTexture');\n            this._bloomTexSize.x = this._bloomWidths[i - 1];\n            this._bloomTexSize.y = this._bloomHeights[i - 1];\n            downPass.setVec4('bloomTexSize', this._bloomTexSize);\n            downPass\n                .addQueue(QueueHint.OPAQUE)\n                .addFullscreenQuad(bloomMaterial, 1);\n        }\n\n        // Upsample passes\n        for (let i = iterations; i-- > 0;) {\n            const upPass = ppl.addRenderPass(this._bloomWidths[i], this._bloomHeights[i], 'cc-bloom-upsample');\n            upPass.addRenderTarget(this._bloomTexNames[i], LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\n            upPass.addTexture(this._bloomTexNames[i + 1], 'bloomTexture');\n            this._bloomTexSize.x = this._bloomWidths[i + 1];\n            this._bloomTexSize.y = this._bloomHeights[i + 1];\n            upPass.setVec4('bloomTexSize', this._bloomTexSize);\n            upPass\n                .addQueue(QueueHint.OPAQUE)\n                .addFullscreenQuad(bloomMaterial, 2);\n        }\n\n        // Combine pass\n        this._bloomParams.w = settings.bloom.intensity;\n        const combinePass = ppl.addRenderPass(width, height, 'cc-bloom-combine');\n        combinePass.addRenderTarget(radianceName, LoadOp.LOAD, StoreOp.STORE);\n        combinePass.addTexture(this._bloomTexNames[0], 'bloomTexture');\n        combinePass.setVec4('bloomParams', this._bloomParams);\n        combinePass\n            .addQueue(QueueHint.BLEND)\n            .addFullscreenQuad(bloomMaterial, 3);\n\n        if (cameraConfigs.remainingPasses === 0) {\n            return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, radianceName);\n        } else {\n            return combinePass;\n        }\n    }\n    private _addPass(\n        ppl: rendering.BasicPipeline,\n        width: number,\n        height: number,\n        layout: string,\n        colorName: string,\n        material: Material,\n        passIndex: number,\n        loadOp: gfx.LoadOp = LoadOp.CLEAR,\n        clearColor: gfx.Color = sClearColorTransparentBlack,\n        queueHint: rendering.QueueHint = rendering.QueueHint.OPAQUE): rendering.BasicRenderPassBuilder {\n        const pass = ppl.addRenderPass(width, height, layout);\n        pass.addRenderTarget(colorName, loadOp, StoreOp.STORE, clearColor);\n        pass.addQueue(queueHint)\n            .addFullscreenQuad(material, passIndex);\n        return pass;\n    }\n    private _addMipmapFilterBloomPasses(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & Readonly<BloomPassConfigs>,\n        settings: PipelineSettings,\n        bloomMaterial: Material,\n        id: number,\n        width: number,\n        height: number,\n        radianceName: string,\n    ): rendering.BasicRenderPassBuilder {\n        // Setup bloom parameters\n        this._bloomParams.x = pplConfigs.useFloatOutput ? 1 : 0;\n        this._bloomParams.x = 0; // unused\n        this._bloomParams.z = settings.bloom.threshold;\n        this._bloomParams.w = settings.bloom.intensity;\n        const prefilterInfo = this._prefilterTexDesc;\n\n        // Prefilter pass\n        let currSamplePass = this._addPass(\n            ppl,\n            prefilterInfo.width,\n            prefilterInfo.height,\n            'cc-bloom-mipmap-prefilter',\n            prefilterInfo.name,\n            bloomMaterial,\n            0,\n        );\n        currSamplePass.addTexture(radianceName, 'mainTexture');\n        currSamplePass.setVec4('bloomParams', this._bloomParams);\n\n        const downSampleInfos = this._bloomDownSampleTexDescs;\n        // Downsample passes\n        for (let i = 0; i < downSampleInfos.length; ++i) {\n            const currInfo = downSampleInfos[i];\n            const samplerSrc = i === 0 ? prefilterInfo : downSampleInfos[i - 1];\n            const samplerSrcName = samplerSrc.name;\n            this._bloomTexSize.x = 1 / samplerSrc.width;\n            this._bloomTexSize.y = 1 / samplerSrc.height;\n            currSamplePass = this._addPass(\n                ppl,\n                currInfo.width,\n                currInfo.height,\n                'cc-bloom-mipmap-downsample',\n                currInfo.name,\n                bloomMaterial,\n                1,\n            );\n            currSamplePass.addTexture(samplerSrcName, 'mainTexture');\n            currSamplePass.setVec4('bloomParams', this._bloomTexSize);\n        }\n        const lastIndex = downSampleInfos.length - 1;\n        const upSampleInfos = this._bloomUpSampleTexDescs;\n        // Upsample passes\n        for (let i = 0; i < upSampleInfos.length; i++) {\n            const currInfo = upSampleInfos[i];\n            const sampleSrc = i === 0 ? downSampleInfos[lastIndex] : upSampleInfos[i - 1];\n            const sampleSrcName = sampleSrc.name;\n            this._bloomTexSize.x = 1 / sampleSrc.width;\n            this._bloomTexSize.y = 1 / sampleSrc.height;\n            currSamplePass = this._addPass(\n                ppl,\n                currInfo.width,\n                currInfo.height,\n                'cc-bloom-mipmap-upsample',\n                currInfo.name,\n                bloomMaterial,\n                2,\n            );\n            currSamplePass.addTexture(sampleSrcName, 'mainTexture');\n            currSamplePass.addTexture(downSampleInfos[lastIndex - 1 - i].name, 'downsampleTexture');\n            currSamplePass.setVec4('bloomParams', this._bloomTexSize);\n        }\n\n        // Combine pass\n        const combinePass = this._addPass(\n            ppl,\n            width,\n            height,\n            'cc-bloom-mipmap-combine',\n            radianceName,\n            bloomMaterial,\n            3,\n            LoadOp.LOAD,\n        );\n        combinePass.addTexture(upSampleInfos[upSampleInfos.length - 1].name, 'bloomTexture');\n        combinePass.setVec4('bloomParams', this._bloomParams);\n        if (cameraConfigs.remainingPasses === 0) {\n            return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, radianceName);\n        } else {\n            return combinePass;\n        }\n    }\n\n    // Bloom\n    private readonly _clearColorTransparentBlack = new Color(0, 0, 0, 0);\n    private readonly _bloomParams = new Vec4(0, 0, 0, 0);\n    private readonly _bloomTexSize = new Vec4(0, 0, 0, 0);\n    private readonly _bloomWidths: Array<number> = [];\n    private readonly _bloomHeights: Array<number> = [];\n    private readonly _bloomTexNames: Array<string> = [];\n\n    // Mipmap Bloom\n    private readonly _bloomUpSampleTexDescs: Array<RenderTextureDesc> = [];\n    private readonly _bloomDownSampleTexDescs: Array<RenderTextureDesc> = [];\n    private _prefilterTexDesc: RenderTextureDesc = { name: '', width: 0, height: 0 };\n    private _originalColorDesc: RenderTextureDesc = { name: '', width: 0, height: 0 };\n}\n\nexport interface ToneMappingPassConfigs {\n    enableToneMapping: boolean;\n    enableColorGrading: boolean;\n}\n\nexport class BuiltinToneMappingPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 300;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs): void {\n        const settings = cameraConfigs.settings;\n\n        cameraConfigs.enableColorGrading\n            = settings.colorGrading.enabled\n            && !!settings.colorGrading.material\n            && !!settings.colorGrading.colorGradingMap;\n\n        cameraConfigs.enableToneMapping\n            = cameraConfigs.enableHDR // From Half to RGBA8\n            || cameraConfigs.enableColorGrading; // Color grading\n\n        if (cameraConfigs.enableToneMapping) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs): void {\n        if (cameraConfigs.enableColorGrading) {\n            assert(!!cameraConfigs.settings.colorGrading.material);\n            cameraConfigs.settings.colorGrading.material.setProperty(\n                'colorGradingMap',\n                cameraConfigs.settings.colorGrading.colorGradingMap);\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableToneMapping) {\n            return prevRenderPass;\n        }\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n        if (cameraConfigs.remainingPasses === 0) {\n            return this._addCopyAndTonemapPass(ppl, pplConfigs, cameraConfigs,\n                cameraConfigs.width, cameraConfigs.height,\n                context.colorName, cameraConfigs.colorName);\n        } else {\n            const id = cameraConfigs.renderWindowId;\n            const ldrColorPrefix = cameraConfigs.enableShadingScale\n                ? `ScaledLdrColor`\n                : `LdrColor`;\n\n            const ldrColorName = getPingPongRenderTarget(context.colorName, ldrColorPrefix, id);\n            const radianceName = context.colorName;\n            context.colorName = ldrColorName;\n\n            return this._addCopyAndTonemapPass(ppl, pplConfigs, cameraConfigs,\n                cameraConfigs.width, cameraConfigs.height,\n                radianceName, ldrColorName);\n        }\n    }\n    private _addCopyAndTonemapPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs,\n        width: number,\n        height: number,\n        radianceName: string,\n        colorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        let pass: rendering.BasicRenderPassBuilder;\n        const settings = cameraConfigs.settings;\n        if (cameraConfigs.enableColorGrading) {\n            assert(!!settings.colorGrading.material);\n            assert(!!settings.colorGrading.colorGradingMap);\n\n            const lutTex = settings.colorGrading.colorGradingMap;\n            this._colorGradingTexSize.x = lutTex.width;\n            this._colorGradingTexSize.y = lutTex.height;\n\n            const isSquareMap = lutTex.width === lutTex.height;\n            if (isSquareMap) {\n                pass = ppl.addRenderPass(width, height, 'cc-color-grading-8x8');\n            } else {\n                pass = ppl.addRenderPass(width, height, 'cc-color-grading-nx1');\n            }\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n            pass.addTexture(radianceName, 'sceneColorMap');\n            pass.setVec2('lutTextureSize', this._colorGradingTexSize);\n            pass.setFloat('contribute', settings.colorGrading.contribute);\n            pass.addQueue(rendering.QueueHint.OPAQUE)\n                .addFullscreenQuad(settings.colorGrading.material, isSquareMap ? 1 : 0);\n        } else {\n            pass = ppl.addRenderPass(width, height, 'cc-tone-mapping');\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n            pass.addTexture(radianceName, 'inputTexture');\n            if (settings.toneMapping.material) {\n                pass.addQueue(rendering.QueueHint.OPAQUE)\n                    .addFullscreenQuad(settings.toneMapping.material, 0);\n            } else {\n                assert(!!cameraConfigs.copyAndTonemapMaterial);\n                pass.addQueue(rendering.QueueHint.OPAQUE)\n                    .addFullscreenQuad(cameraConfigs.copyAndTonemapMaterial, 0);\n            }\n        }\n        return pass;\n    }\n    private readonly _colorGradingTexSize = new Vec2(0, 0);\n}\n\nexport interface FXAAPassConfigs {\n    enableFXAA: boolean;\n}\n\nexport class BuiltinFXAAPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 400;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FXAAPassConfigs): void {\n        cameraConfigs.enableFXAA\n            = cameraConfigs.settings.fxaa.enabled\n            && !!cameraConfigs.settings.fxaa.material;\n        if (cameraConfigs.enableFXAA) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FXAAPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableFXAA) {\n            return prevRenderPass;\n        }\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n\n        const id = cameraConfigs.renderWindowId;\n        const ldrColorPrefix = cameraConfigs.enableShadingScale\n            ? `ScaledLdrColor`\n            : `LdrColor`;\n        const ldrColorName = getPingPongRenderTarget(context.colorName, ldrColorPrefix, id);\n\n        assert(!!cameraConfigs.settings.fxaa.material);\n        if (cameraConfigs.remainingPasses === 0) {\n            if (cameraConfigs.enableShadingScale) {\n                this._addFxaaPass(ppl, pplConfigs,\n                    cameraConfigs.settings.fxaa.material,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName,\n                    ldrColorName);\n                return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, ldrColorName);\n            } else {\n                assert(cameraConfigs.width === cameraConfigs.nativeWidth);\n                assert(cameraConfigs.height === cameraConfigs.nativeHeight);\n                return this._addFxaaPass(ppl, pplConfigs,\n                    cameraConfigs.settings.fxaa.material,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName,\n                    cameraConfigs.colorName);\n            }\n        } else {\n            const inputColorName = context.colorName;\n            context.colorName = ldrColorName;\n            const lastPass = this._addFxaaPass(ppl, pplConfigs,\n                cameraConfigs.settings.fxaa.material,\n                cameraConfigs.width,\n                cameraConfigs.height,\n                inputColorName,\n                ldrColorName);\n            return lastPass;\n        }\n    }\n    private _addFxaaPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        fxaaMaterial: Material,\n        width: number,\n        height: number,\n        ldrColorName: string,\n        colorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        this._fxaaParams.x = width;\n        this._fxaaParams.y = height;\n        this._fxaaParams.z = 1 / width;\n        this._fxaaParams.w = 1 / height;\n\n        const pass = ppl.addRenderPass(width, height, 'cc-fxaa');\n        pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        pass.addTexture(ldrColorName, 'sceneColorMap');\n        pass.setVec4('texSize', this._fxaaParams);\n        pass.addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fxaaMaterial, 0);\n        return pass;\n    }\n    // FXAA\n    private readonly _fxaaParams = new Vec4(0, 0, 0, 0);\n}\n\nexport interface FSRPassConfigs {\n    enableFSR: boolean;\n}\n\nexport class BuiltinFsrPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 500;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs): void {\n        // FSR (Depend on Shading scale)\n        cameraConfigs.enableFSR = cameraConfigs.settings.fsr.enabled\n            && !!cameraConfigs.settings.fsr.material\n            && cameraConfigs.enableShadingScale\n            && cameraConfigs.shadingScale < 1.0;\n\n        if (cameraConfigs.enableFSR) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableFSR) {\n            return prevRenderPass;\n        }\n        --cameraConfigs.remainingPasses;\n\n        const inputColorName = context.colorName;\n        const outputColorName\n            = cameraConfigs.remainingPasses === 0\n                ? cameraConfigs.colorName\n                : getPingPongRenderTarget(context.colorName, 'UiColor', cameraConfigs.renderWindowId);\n        context.colorName = outputColorName;\n\n        assert(!!cameraConfigs.settings.fsr.material);\n        return this._addFsrPass(ppl, pplConfigs, cameraConfigs,\n            cameraConfigs.settings,\n            cameraConfigs.settings.fsr.material,\n            cameraConfigs.renderWindowId,\n            cameraConfigs.width,\n            cameraConfigs.height,\n            inputColorName,\n            cameraConfigs.nativeWidth,\n            cameraConfigs.nativeHeight,\n            outputColorName);\n    }\n    private _addFsrPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        settings: PipelineSettings,\n        fsrMaterial: Material,\n        id: number,\n        width: number,\n        height: number,\n        inputColorName: string,\n        nativeWidth: number,\n        nativeHeight: number,\n        outputColorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        this._fsrTexSize.x = width;\n        this._fsrTexSize.y = height;\n        this._fsrTexSize.z = nativeWidth;\n        this._fsrTexSize.w = nativeHeight;\n        this._fsrParams.x = clamp(1.0 - settings.fsr.sharpness, 0.02, 0.98);\n\n        const uiColorPrefix = 'UiColor';\n\n        const fsrColorName = getPingPongRenderTarget(outputColorName, uiColorPrefix, id);\n\n        const easuPass = ppl.addRenderPass(nativeWidth, nativeHeight, 'cc-fsr-easu');\n        easuPass.addRenderTarget(fsrColorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        easuPass.addTexture(inputColorName, 'outputResultMap');\n        easuPass.setVec4('fsrTexSize', this._fsrTexSize);\n        easuPass\n            .addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fsrMaterial, 0);\n\n        const rcasPass = ppl.addRenderPass(nativeWidth, nativeHeight, 'cc-fsr-rcas');\n        rcasPass.addRenderTarget(outputColorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        rcasPass.addTexture(fsrColorName, 'outputResultMap');\n        rcasPass.setVec4('fsrTexSize', this._fsrTexSize);\n        rcasPass.setVec4('fsrParams', this._fsrParams);\n        rcasPass\n            .addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fsrMaterial, 1);\n\n        return rcasPass;\n    }\n    // FSR\n    private readonly _fsrParams = new Vec4(0, 0, 0, 0);\n    private readonly _fsrTexSize = new Vec4(0, 0, 0, 0);\n}\n\nexport class BuiltinUiPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 1000;\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        assert(!!prevRenderPass);\n\n        let flags = rendering.SceneFlags.UI;\n        if (cameraConfigs.enableProfiler) {\n            flags |= rendering.SceneFlags.PROFILER;\n            prevRenderPass.showStatistics = true;\n        }\n        prevRenderPass\n            .addQueue(rendering.QueueHint.BLEND, 'default', 'default')\n            .addScene(camera, flags);\n\n        return prevRenderPass;\n    }\n}\n\nif (rendering) {\n\n    const { QueueHint, SceneFlags } = rendering;\n\n    class BuiltinPipelineBuilder implements rendering.PipelineBuilder {\n        private readonly _pipelineEvent: PipelineEventProcessor = cclegacy.director.root.pipelineEvent as PipelineEventProcessor;\n        private readonly _forwardPass = new BuiltinForwardPassBuilder();\n        private readonly _bloomPass = new BuiltinBloomPassBuilder();\n        private readonly _toneMappingPass = new BuiltinToneMappingPassBuilder();\n        private readonly _fxaaPass = new BuiltinFXAAPassBuilder();\n        private readonly _fsrPass = new BuiltinFsrPassBuilder();\n        private readonly _uiPass = new BuiltinUiPassBuilder();\n        // Internal cached resources\n        private readonly _clearColor = new Color(0, 0, 0, 1);\n        private readonly _viewport = new Viewport();\n        private readonly _configs = new PipelineConfigs();\n        private readonly _cameraConfigs = new CameraConfigs();\n        // Materials\n        private readonly _copyAndTonemapMaterial = new Material();\n\n        // Internal States\n        private _initialized = false; // TODO(zhouzhenglong): Make default effect asset loading earlier and remove this flag\n        private _passBuilders: rendering.PipelinePassBuilder[] = [];\n\n        private _setupPipelinePreview(\n            camera: renderer.scene.Camera,\n            cameraConfigs: CameraConfigs) {\n            const isEditorView: boolean\n                = camera.cameraUsage === CameraUsage.SCENE_VIEW\n                || camera.cameraUsage === CameraUsage.PREVIEW;\n\n            if (isEditorView) {\n                const editorSettings = rendering.getEditorPipelineSettings() as PipelineSettings | null;\n                if (editorSettings) {\n                    cameraConfigs.settings = editorSettings;\n                } else {\n                    cameraConfigs.settings = defaultSettings;\n                }\n            } else {\n                if (camera.pipelineSettings) {\n                    cameraConfigs.settings = camera.pipelineSettings as PipelineSettings;\n                } else {\n                    cameraConfigs.settings = defaultSettings;\n                }\n            }\n        }\n\n        private _preparePipelinePasses(cameraConfigs: CameraConfigs): void {\n            const passBuilders = this._passBuilders;\n            passBuilders.length = 0;\n\n            const settings = cameraConfigs.settings as PipelineSettings2;\n            if (settings._passes) {\n                for (const pass of settings._passes) {\n                    passBuilders.push(pass);\n                }\n                assert(passBuilders.length === settings._passes.length);\n            }\n\n            passBuilders.push(this._forwardPass);\n\n            if (settings.bloom.enabled) {\n                passBuilders.push(this._bloomPass);\n            }\n\n            passBuilders.push(this._toneMappingPass);\n\n            if (settings.fxaa.enabled) {\n                passBuilders.push(this._fxaaPass);\n            }\n\n            if (settings.fsr.enabled) {\n                passBuilders.push(this._fsrPass);\n            }\n            passBuilders.push(this._uiPass);\n        }\n\n        private _setupBuiltinCameraConfigs(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n            pipelineConfigs: PipelineConfigs,\n            cameraConfigs: CameraConfigs\n        ) {\n            const window = camera.window;\n            const isMainGameWindow: boolean = camera.cameraUsage === CameraUsage.GAME && !!window.swapchain;\n            const isGameView = isMainGameWindow || camera.cameraUsage === CameraUsage.GAME_VIEW;\n\n            // Window\n            cameraConfigs.isMainGameWindow = isMainGameWindow;\n            cameraConfigs.renderWindowId = window.renderWindowId;\n\n            // Camera\n            cameraConfigs.colorName = window.colorName;\n            cameraConfigs.depthStencilName = window.depthStencilName;\n\n            // Pipeline\n            cameraConfigs.enableFullPipeline = (camera.visibility & (Layers.Enum.DEFAULT)) !== 0;\n            cameraConfigs.enableProfiler = ppl.profiler && isGameView;\n            cameraConfigs.remainingPasses = 0;\n\n            // Shading scale\n            cameraConfigs.shadingScale = cameraConfigs.settings.shadingScale;\n            cameraConfigs.enableShadingScale = cameraConfigs.settings.enableShadingScale\n                && cameraConfigs.shadingScale !== 1.0;\n\n            cameraConfigs.nativeWidth = Math.max(Math.floor(window.width), 1);\n            cameraConfigs.nativeHeight = Math.max(Math.floor(window.height), 1);\n\n            cameraConfigs.width = cameraConfigs.enableShadingScale\n                ? Math.max(Math.floor(cameraConfigs.nativeWidth * cameraConfigs.shadingScale), 1)\n                : cameraConfigs.nativeWidth;\n            cameraConfigs.height = cameraConfigs.enableShadingScale\n                ? Math.max(Math.floor(cameraConfigs.nativeHeight * cameraConfigs.shadingScale), 1)\n                : cameraConfigs.nativeHeight;\n\n            // Radiance\n            cameraConfigs.enableHDR = cameraConfigs.enableFullPipeline\n                && pipelineConfigs.useFloatOutput;\n            cameraConfigs.radianceFormat = cameraConfigs.enableHDR\n                ? gfx.Format.RGBA16F : gfx.Format.RGBA8;\n\n            // Tone Mapping\n            cameraConfigs.copyAndTonemapMaterial = this._copyAndTonemapMaterial;\n\n            // Depth\n            cameraConfigs.enableStoreSceneDepth = false;\n        }\n\n        private _setupCameraConfigs(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n            pipelineConfigs: PipelineConfigs,\n            cameraConfigs: CameraConfigs\n        ): void {\n            this._setupPipelinePreview(camera, cameraConfigs);\n\n            this._preparePipelinePasses(cameraConfigs);\n\n            sortPipelinePassBuildersByConfigOrder(this._passBuilders);\n\n            this._setupBuiltinCameraConfigs(ppl, camera, pipelineConfigs, cameraConfigs);\n\n            for (const builder of this._passBuilders) {\n                if (builder.configCamera) {\n                    builder.configCamera(camera, pipelineConfigs, cameraConfigs);\n                }\n            }\n        }\n\n        // ----------------------------------------------------------------\n        // Interface\n        // ----------------------------------------------------------------\n        windowResize(\n            ppl: rendering.BasicPipeline,\n            window: renderer.RenderWindow,\n            camera: renderer.scene.Camera,\n            nativeWidth: number,\n            nativeHeight: number,\n        ): void {\n            setupPipelineConfigs(ppl, this._configs);\n\n            this._setupCameraConfigs(ppl, camera, this._configs, this._cameraConfigs);\n\n            // Render Window (UI)\n            const id = window.renderWindowId;\n\n            ppl.addRenderWindow(this._cameraConfigs.colorName,\n                Format.RGBA8, nativeWidth, nativeHeight, window,\n                this._cameraConfigs.depthStencilName);\n\n            const width = this._cameraConfigs.width;\n            const height = this._cameraConfigs.height;\n\n            if (this._cameraConfigs.enableShadingScale) {\n                ppl.addDepthStencil(`ScaledSceneDepth_${id}`, Format.DEPTH_STENCIL, width, height);\n                ppl.addRenderTarget(`ScaledRadiance0_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`ScaledRadiance1_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`ScaledLdrColor0_${id}`, Format.RGBA8, width, height);\n                ppl.addRenderTarget(`ScaledLdrColor1_${id}`, Format.RGBA8, width, height);\n            } else {\n                ppl.addDepthStencil(`SceneDepth_${id}`, Format.DEPTH_STENCIL, width, height);\n                ppl.addRenderTarget(`Radiance0_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`Radiance1_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`LdrColor0_${id}`, Format.RGBA8, width, height);\n                ppl.addRenderTarget(`LdrColor1_${id}`, Format.RGBA8, width, height);\n            }\n            ppl.addRenderTarget(`UiColor0_${id}`, Format.RGBA8, nativeWidth, nativeHeight);\n            ppl.addRenderTarget(`UiColor1_${id}`, Format.RGBA8, nativeWidth, nativeHeight);\n\n            for (const builder of this._passBuilders) {\n                if (builder.windowResize) {\n                    builder.windowResize(ppl, this._configs, this._cameraConfigs, window, camera, nativeWidth, nativeHeight);\n                }\n            }\n        }\n        setup(cameras: renderer.scene.Camera[], ppl: rendering.BasicPipeline): void {\n            // TODO(zhouzhenglong): Make default effect asset loading earlier and remove _initMaterials\n            if (this._initMaterials(ppl)) {\n                return;\n            }\n\n            // Render cameras\n            // log(`==================== One Frame ====================`);\n            for (const camera of cameras) {\n                // Skip invalid camera\n                if (!camera.scene || !camera.window) {\n                    continue;\n                }\n                // Setup camera configs\n                this._setupCameraConfigs(ppl, camera, this._configs, this._cameraConfigs);\n                // log(`Setup camera: ${camera.node!.name}, window: ${camera.window.renderWindowId}, isFull: ${this._cameraConfigs.enableFullPipeline}, `\n                //     + `size: ${camera.window.width}x${camera.window.height}`);\n\n                this._pipelineEvent.emit(PipelineEventType.RENDER_CAMERA_BEGIN, camera);\n\n                // Build pipeline\n                if (this._cameraConfigs.enableFullPipeline) {\n                    this._buildForwardPipeline(ppl, camera, camera.scene, this._passBuilders);\n                } else {\n                    this._buildSimplePipeline(ppl, camera);\n                }\n\n                this._pipelineEvent.emit(PipelineEventType.RENDER_CAMERA_END, camera);\n            }\n        }\n        // ----------------------------------------------------------------\n        // Pipelines\n        // ----------------------------------------------------------------\n        private _buildSimplePipeline(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n        ): void {\n            const width = Math.max(Math.floor(camera.window.width), 1);\n            const height = Math.max(Math.floor(camera.window.height), 1);\n            const colorName = this._cameraConfigs.colorName;\n            const depthStencilName = this._cameraConfigs.depthStencilName;\n\n            const viewport = camera.viewport;  // Reduce C++/TS interop\n            this._viewport.left = Math.round(viewport.x * width);\n            this._viewport.top = Math.round(viewport.y * height);\n            // Here we must use camera.viewport.width instead of camera.viewport.z, which\n            // is undefined on native platform. The same as camera.viewport.height.\n            this._viewport.width = Math.max(Math.round(viewport.width * width), 1);\n            this._viewport.height = Math.max(Math.round(viewport.height * height), 1);\n\n            const clearColor = camera.clearColor;  // Reduce C++/TS interop\n            this._clearColor.x = clearColor.x;\n            this._clearColor.y = clearColor.y;\n            this._clearColor.z = clearColor.z;\n            this._clearColor.w = clearColor.w;\n\n            const pass = ppl.addRenderPass(width, height, 'default');\n\n            // bind output render target\n            if (forwardNeedClearColor(camera)) {\n                pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColor);\n            } else {\n                pass.addRenderTarget(colorName, LoadOp.LOAD, StoreOp.STORE);\n            }\n\n            // bind depth stencil buffer\n            if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n                pass.addDepthStencil(\n                    depthStencilName,\n                    LoadOp.CLEAR,\n                    StoreOp.DISCARD,\n                    camera.clearDepth,\n                    camera.clearStencil,\n                    camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n                );\n            } else {\n                pass.addDepthStencil(depthStencilName, LoadOp.LOAD, StoreOp.DISCARD);\n            }\n\n            pass.setViewport(this._viewport);\n\n            // The opaque queue is used for Reflection probe preview\n            pass.addQueue(QueueHint.OPAQUE)\n                .addScene(camera, SceneFlags.OPAQUE);\n\n            // The blend queue is used for UI and Gizmos\n            let flags = SceneFlags.BLEND | SceneFlags.UI;\n            if (this._cameraConfigs.enableProfiler) {\n                flags |= SceneFlags.PROFILER;\n                pass.showStatistics = true;\n            }\n            pass.addQueue(QueueHint.BLEND)\n                .addScene(camera, flags);\n        }\n\n        private _buildForwardPipeline(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n            scene: renderer.RenderScene,\n            passBuilders: rendering.PipelinePassBuilder[],\n        ): void {\n            sortPipelinePassBuildersByRenderOrder(passBuilders);\n\n            const context: PipelineContext = {\n                colorName: '',\n                depthStencilName: '',\n            };\n\n            let lastPass: rendering.BasicRenderPassBuilder | undefined = undefined;\n\n            for (const builder of passBuilders) {\n                if (builder.setup) {\n                    lastPass = builder.setup(ppl, this._configs, this._cameraConfigs,\n                        camera, context, lastPass);\n                }\n            }\n\n            assert(this._cameraConfigs.remainingPasses === 0);\n        }\n\n        private _initMaterials(ppl: rendering.BasicPipeline): number {\n            if (this._initialized) {\n                return 0;\n            }\n\n            setupPipelineConfigs(ppl, this._configs);\n\n            // When add new effect asset, please add its uuid to the dependentAssets in cc.config.json.\n            this._copyAndTonemapMaterial._uuid = `builtin-pipeline-tone-mapping-material`;\n            this._copyAndTonemapMaterial.initialize({ effectName: 'pipeline/post-process/tone-mapping' });\n\n            if (this._copyAndTonemapMaterial.effectAsset) {\n                this._initialized = true;\n            }\n\n            return this._initialized ? 0 : 1;\n        }\n    }\n\n    rendering.setCustomPipeline('Builtin', new BuiltinPipelineBuilder());\n\n} // if (rendering)\n"]}