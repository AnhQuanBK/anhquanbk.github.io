System.register("chunks:///main.js",["./env-5304ac8c.js","cc","./TournamentUtils-53cee7c1.js"],(function(){var e,t,n,i,a,o,r,l,s,u,c,d,h,p,y,v,f,g,m,b,w,S,k,C,E,A,T,P,O,L,I,R,_,D,M,N,B,F,x,z,U,G,H,q,V,$,W,K,j,Y,X,J,Z,Q,ee,te,ne,ie,ae,oe,re,le,se,ue,ce,de,he,pe,ye,ve,fe,ge,me,be,we,Se,ke,Ce,Ee,Ae,Te,Pe,Oe,Le,Ie,Re,_e,De,Me,Ne,Be,Fe,xe,ze,Ue,Ge,He,qe,Ve,$e,We,Ke,je,Ye,Xe,Je,Ze,Qe,et,tt,nt,it,at,ot,rt,lt,st,ut,ct,dt,ht,pt,yt,vt,ft,gt;return{setters:[function(S){e=S.f,t=S.c,n=S.a,i=S.b,a=S._,o=S.h,r=S.d,l=S.e,s=S.i,u=S.g,c=S.j,d=S.k,h=S.l,p=S.m,y=S.n,v=S.o,f=S.p,g=S.q,m=S.r,b=S.s,w=S.t},function(e){S=e.cclegacy,k=e.AudioSource,C=e._decorator,E=e.CCString,A=e.director,T=e.Component,P=e.UITransform,O=e.CCInteger,L=e.CCFloat,I=e.Widget,R=e.tween,_=e.Layout,D=e.game,M=e.ccenum,N=e.isCCObject,B=e.UIOpacity,F=e.Sprite,x=e.Enum,z=e.easing,U=e.EventHandler,G=e.Button,H=e.Input,q=e.Node,V=e.Vec3,$=e.animation,W=e.CCBoolean,K=e.Label,j=e.RichText,Y=e.Graphics,X=e.Color,J=e.sys,Z=e.Director,Q=e.EventTarget,ee=e.ParticleSystem2D,te=e.math,ne=e.View,ie=e.ProgressBar,ae=e.Vec2,oe=e.Layers,re=e.find,le=e.pseudoRandomRangeInt,se=e.randomRangeInt,ue=e.SpriteFrame,ce=e.Animation,de=e.AnimationClip,he=e.randomRange,pe=e.pseudoRandom,ye=e.instantiate,ve=e.Pool,fe=e.Prefab,ge=e.repeat,me=e.js,be=e.misc,we=e.MeshRenderData,Se=e.lerp,ke=e.approx,Ce=e.EPSILON,Ee=e.RealCurve,Ae=e.Gradient,Te=e.bits,Pe=e.random,Oe=e.toRadian,Le=e.CCClass,Ie=e.UIRenderer,Re=e.pseudoRandomRange,_e=e.assert,De=e.clamp,Me=e.HorizontalTextAlignment,Ne=e.Tween,Be=e.ResolutionPolicy,Fe=e.view,xe=e.Material,ze=e.Canvas,Ue=e.ScrollView,Ge=e.NodeEventType,He=e.Mask},function(e){qe=e.R,Ve=e.A,$e=e.G,We=e.C,Ke=e.a,je=e.b,Ye=e.c,Xe=e.d,Je=e.L,Ze=e.e,Qe=e.f,et=e.g,tt=e.I,nt=e.h,it=e.T,at=e.i,ot=e.j,rt=e.S,lt=e.k,st=e.l,ut=e.m,ct=e.n,dt=e.o,ht=e.p,pt=e.q,yt=e.r,vt=e.W,ft=e.s,gt=e.t}],execute:function(){var mt;S._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var bt=null===(mt=Ludex.Plugins.Audio)||void 0===mt?void 0:mt.BaseAudioPlayer;bt||(bt=e((function e(n){t(this,e),console.warn("BaseAudioPlayer is not defined",n)})));var wt,St,kt,Ct=function(a){n(r,a);var o=i(r);function r(e,n){var i;return t(this,r),(i=o.call(this,e)).audioSource=n,i}return e(r,[{key:"play",value:function(e){if(e){var t=e.volume,n=void 0===t?1:t,i=e.loop,a=void 0!==i&&i;this.audioSource.volume=n,this.audioSource.loop=a}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===k.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(e){this.audioSource.volume=e}},{key:"getVolume",value:function(){return this.audioSource.volume}},{key:"getAudioSource",value:function(){return this.audioSource}}]),r}(bt);S._RF.pop(),S._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var Et=Ludex.Utils,At=Et.Array,Tt=Et.Decorator,Pt=null===(wt=Ludex.Plugins.Audio)||void 0===wt?void 0:wt.BaseChannelManager;Pt||(Pt=e((function e(n){t(this,e),console.warn("BaseChannelManager is not defined",n)})));var Ot,Lt,It,Rt,_t,Dt=(St=Tt.tryCatch(),a((kt=function(a){n(s,a);var r,l=i(s);function s(e,n){var i;return t(this,s),(i=l.call(this,n)).allowMultipleTracking={},i.handleLoadedAudio=function(e,t){var n=i.node.addComponent(k);return n.clip=t,n.playOnAwake=!1,new Ct(e,n)},i.node=e,i}return e(s,[{key:"playing",value:function(e){var t,n=null===(t=this.getAudioClip(e))||void 0===t?void 0:t.audioPlayer;return!!(n&&n instanceof Ct)&&n.getAudioSource().state===k.AudioState.PLAYING}},{key:"onLoadAudio",value:(r=o((function*(e,t){var n=yield qe.loadAudioAsync(e);return n&&this.node.isValid?this.handleLoadedAudio(e,n):null})),function(e,t){return r.apply(this,arguments)})},{key:"playWithRealConfig",value:function(e,t){if(this.isCanPlay(t)){if(t){var n=t.volume,i=void 0===n?1:n,a=t.allowMultiple,o=void 0!==a&&a;if(t.volume=this.getVolume()*i,o){var r=e.getAudioSource().clip;if(!r)return;return void this.requestDuplicateAudioPlayer(e.getKey(),r,t).play(t)}}e.play(t)}}},{key:"isCanPlay",value:function(e){var t=this;if(e){var n=e.checkList;if((void 0===n?[]:n).some((function(e){var n=t.getAudioClip(e);if(n){var i=n.audioPlayer;if(i&&i instanceof Ct)return i.getAudioSource().state===k.AudioState.PLAYING}return!1})))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(e,t,n){var i=this.getDuplicateAudioFromPool(e);if(i){if(n){var a=i.key,o=n.volume,r=void 0===o?1:o;this.setAudioClip(a,{volume:r})}return i.audioPlayer}var l=this.allowMultipleTracking[e];if(!l)throw new Error("Allow multiple tracking is not found");var s="".concat(e,"_").concat(l.currentPostFix),u=this.handleLoadedAudio(s,t);return l.list.push({audioPlayer:u,key:s}),l.currentPostFix+=1,this.setAudioClip(s,{audioPlayer:u,volume:1}),u}},{key:"getDuplicateAudioFromPool",value:function(e){if(this.allowMultipleTracking[e]){var t=this.allowMultipleTracking[e].list,n=At.search(t,(function(e){return e.audioPlayer.getAudioSource().state!==k.AudioState.PLAYING}));if(n)return n}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}]),s}(Pt)).prototype,"onLoadAudio",[St],Object.getOwnPropertyDescriptor(kt.prototype,"onLoadAudio"),kt.prototype),kt);S._RF.pop(),S._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var Mt,Nt,Bt,Ft,xt,zt=C.ccclass,Ut=C.property,Gt=codex,Ht=Gt.audio,qt=Gt.player;Ot=zt("Music"),Lt=Ut(E),Ot((_t=a((Rt=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"channelId",_t,l(e)),e.channel=null,e.isMute=!1,e.volume=1,e}return e(s,[{key:"__preload",value:function(){Ht&&(this.makePersistent(),this.channel=new Dt(this.node,this.channelId),Ht.addChannel(this.channel))}},{key:"makePersistent",value:function(){A.isPersistRootNode(this.node)||A.addPersistRootNode(this.node)}},{key:"playing",value:function(e){var t,n;return null!==(t=null===(n=this.channel)||void 0===n?void 0:n.playing(e))&&void 0!==t&&t}},{key:"play",value:function(e,t){if(this.isMusicEnable()){var n=null!=t?t:{};n.loop||(n.loop=!0),Ht.play(e,n,this.channelId)}}},{key:"isMusicEnable",value:function(){return!!qt.getPlayerSetting("music")}},{key:"setVolume",value:function(e){this.volume=e,this.isMute||Ht.setVolume(e,this.channelId)}},{key:"getVolume",value:function(){return Ht.getVolume(this.channelId)}},{key:"pause",value:function(e){Ht.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isMusicEnable()&&Ht.resume(e,this.channelId)}},{key:"stop",value:function(e){Ht.stop(e,this.channelId)}},{key:"mute",value:function(e){this.isMute=e,e?Ht.mute(this.channelId):(this.setVolume(this.volume),Ht.unmute(this.channelId))}}]),s}(T)).prototype,"channelId",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),It=Rt));S._RF.pop(),S._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var Vt,$t,Wt,Kt,jt,Yt,Xt,Jt,Zt,Qt,en,tn,nn,an,on,rn,ln,sn,un,cn,dn=C.ccclass,hn=C.property,pn=codex,yn=pn.audio,vn=pn.player,fn=(Mt=dn("Sound"),Nt=hn(E),Mt((xt=a((Ft=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"channelId",xt,l(e)),e.channel=null,e}return e(s,[{key:"__preload",value:function(){yn&&(this.channel=new Dt(this.node,this.channelId),yn.addChannel(this.channel))}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){A.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){A.removePersistRootNode(this.node)}},{key:"play",value:function(e,t){if(this.isSoundEnable())return yn.play(e,t,this.channelId)}},{key:"isSoundEnable",value:function(){return!!vn.getPlayerSetting("sound")}},{key:"setVolume",value:function(e){yn.setVolume(e,this.channelId)}},{key:"pause",value:function(e){yn.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isSoundEnable()&&yn.resume(e,this.channelId)}},{key:"stop",value:function(e){yn.stop(e,this.channelId)}},{key:"stopAll",value:function(){yn.stopAll(this.channelId)}},{key:"mute",value:function(e){e?yn.mute(this.channelId):yn.unmute(this.channelId)}}]),s}(T)).prototype,"channelId",[Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Bt=Ft))||Bt);S._RF.pop(),S._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var gn,mn=C.ccclass,bn=C.property,wn=(Vt=mn("AutoLayoutWrappee"),$t=bn({type:P}),Wt=bn({type:P}),Vt((Yt=a((jt=e((function e(){t(this,e),r(this,"wrapeeContainer",Yt,this),r(this,"wrapee",Xt,this)}))).prototype,"wrapeeContainer",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=a(jt.prototype,"wrapee",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kt=jt))||Kt),Sn=(Jt=mn("AutoLayout"),Zt=bn({displayName:"Use Auto Layout"}),Qt=bn({type:[wn],displayName:"Children",visible:function(){return this.useAutoLayout}}),en=bn({visible:!1,serializable:!0}),tn=bn({type:O,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),nn=bn({type:L,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),an=bn({visible:!1,serializable:!0}),Jt((ln=a((rn=function(a){n(y,a);var h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"useAutoLayout",ln,l(e)),r(e,"children",sn,l(e)),e.mappedChildren=[],r(e,"selected",un,l(e)),r(e,"deselectedIconW",cn,l(e)),e.tweens=[],e}return e(y,[{key:"selectedIndex",get:function(){return this.selected},set:function(e){this.selected=e,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(e){this.deselectedIconW=e,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map((function(e){var t=e.wrapeeContainer.getComponent(I);if(!t)throw new Error("AutoLayout: Widget component not found");return s(s({},e),{},{wrapeeContainerWidget:t})}))}},{key:"updateLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._layoutDirty||e){this.updateChildrenAnchors();var t,n=u(this.mappedChildren);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.wrapeeContainerWidget.updateAlignment()}}catch(e){n.e(e)}finally{n.f()}}c(d(y.prototype),"updateLayout",this).call(this,e)}},{key:"getSelectedWorldX",value:function(){var e=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?e.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*e.width:e.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){var t=this.mappedChildren[e].wrapeeContainer.width,n=this.deselectedIconWidth/2,i=this.paddingLeft;return((i+t+(t-n+this.spacingX))/2-i)/t}if(e===this.children.length-1){var a=this.mappedChildren[e].wrapeeContainer.width,o=a-this.deselectedIconWidth/2+this.spacingX;return((o+a+this.paddingRight)/2-o)/a}return.5}},{key:"updateChildrenAnchors",value:(h=o((function*(){var e,t=this,n=u(this.tweens);try{for(n.s();!(e=n.n()).done;)e.value.stop()}catch(e){n.e(e)}finally{n.f()}this.tweens=[],yield Promise.all([this.children.flatMap((function(e,n){return t.getChildrenAnchorsTweens(e,t.getAnchorX(n))})).map((function(e){return Ve.runTweenAsync(e)}))])})),function(){return h.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var e=this;this.children.forEach((function(t,n){var i=e.getAnchorX(n);t.wrapee.setAnchorPoint(i,t.wrapee.anchorY),t.wrapeeContainer.setAnchorPoint(i,t.wrapeeContainer.anchorY)}))}},{key:"getChildrenAnchorsTweens",value:function(e,t){return[R(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),R(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}]),y}(_)).prototype,"useAutoLayout",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sn=a(rn.prototype,"children",[Qt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),un=a(rn.prototype,"selected",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a(rn.prototype,"selectedIndex",[tn],Object.getOwnPropertyDescriptor(rn.prototype,"selectedIndex"),rn.prototype),a(rn.prototype,"deselectedIconWidth",[nn],Object.getOwnPropertyDescriptor(rn.prototype,"deselectedIconWidth"),rn.prototype),cn=a(rn.prototype,"deselectedIconW",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),on=rn))||on);S._RF.pop(),S._RF.push({},"32a77jcKOREvpuCe9wamBRu","Background",void 0);(0,C.ccclass)("Background")(gn=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(P),this.ratio=this.uiTransform.width/this.uiTransform.height,this.listenGameEvents(),this.handleViewResized()}},{key:"listenGameEvents",value:function(){D.on($e.ORIENTATION_CHANGED,this.handleViewResized,this),D.on($e.VIEW_RESIZED,this.handleViewResized,this)}},{key:"unlistenGameEvents",value:function(){D.off($e.VIEW_RESIZED,this.handleViewResized,this),D.off($e.ORIENTATION_CHANGED,this.handleViewResized,this)}},{key:"handleViewResized",value:function(){var e=We.cssSizeToWorldSize(We.getScreenWidthCss()),t=We.cssSizeToWorldSize(We.getScreenHeightCss());e/t<this.ratio?(this.uiTransform.width=t*this.ratio,this.uiTransform.height=t):(this.uiTransform.width=e,this.uiTransform.height=e/this.ratio)}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}}]),r}(T));S._RF.pop(),S._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var kn="STARS_UPDATED",Cn="PLAY_BUTTON_PRESS",En="CUSTOM_PLAY_BUTTON_PRESS",An="REQUEST_NAVIGATION",Tn="REQUEST_NAVIGATION_ANIMATION",Pn="DASHBOARD_EVENTS_BUTTON_PRESS";S._RF.pop(),S._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var On=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(On||{});M(On),S._RF.pop(),S._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var Ln=Ludex.Utils.Array,In=function(){function n(){t(this,n),this.callbacks$=[],this.isAborted$=!1,this.abortReason$="",this.callbacks$=[]}var i;return e(n,[{key:"aborted",get:function(){return this.isAborted$}},{key:"reason",get:function(){return this.abortReason$}},{key:"addAbortListener",value:function(e){this.callbacks$.push(e)}},{key:"removeAbortListener",value:function(e){var t=Ln.searchIndex(this.callbacks$,(function(t){return t===e}));-1!==t&&this.callbacks$.splice(t,1)}},{key:"abort",value:function(e){if(!this.isAborted$){this.isAborted$=!0,this.abortReason$=e;var t,n=u(this.callbacks$);try{for(n.s();!(t=n.n()).done;){var i=t.value;"function"==typeof i&&i()}}catch(e){n.e(e)}finally{n.f()}this.callbacks$=[]}}},{key:"untilAborted",value:(i=o((function*(){var e=this;if(!this.isAborted$)return new Promise((function(t){e.addAbortListener((function(){return t()}))}))})),function(){return i.apply(this,arguments)})},{key:"call",value:function(e){this.aborted||e(this)}},{key:"callAsync",value:function(e){return this.aborted?Promise.resolve():e(this)}},{key:"chain",value:function(e){var t=this;e instanceof n?e.addAbortListener((function(){return t.abort()})):e.addEventListener("abort",(function(){return t.abort()}))}}],[{key:"hasBeenAborted",value:function(e){return null==e||e.aborted}}]),n}();function Rn(e,t,n){var i;if("object"!==h(e)||void 0===t||void 0===n)return i=e,function(e,t,n){var a=n.value;n.value=function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(i.call(this))return null==a?void 0:a.apply(this,n);console.debug("Skipping method call ".concat(String(t)," because component ").concat(this.constructor.name," is not enabled in hierarchy"))}};!function(e,t,n){var i=n.value;n.value=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];if(this.isValid)return null==i?void 0:i.apply(this,n);console.debug("Skipping method call ".concat(String(t)," because component ").concat(this.constructor.name," is not enabled in hierarchy"))}}(0,t,n)}function _n(e,t,n){var i;if("object"!==h(e)||void 0===t||void 0===n)return i=e,function(e,t,n){var a=n.value,r=function(){var e=o((function*(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(i.call(this))return yield null==a?void 0:a.apply(this,n);console.debug("Skipping method call ".concat(String(t)," because component ").concat(this.constructor.name," is not enabled in hierarchy"))}));return function(){return e.apply(this,arguments)}}();n.value=r};!function(e,t,n){var i=n.value,a=function(){var e=o((function*(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];if(this.isValid)return yield null==i?void 0:i.apply(this,n);console.debug("Skipping method call ".concat(String(t)," because component ").concat(this.constructor.name," is not enabled in hierarchy"))}));return function(){return e.apply(this,arguments)}}();n.value=a}(0,t,n)}S._RF.pop(),S._RF.push({},"147a4TjOC9PMpdhlBiKEn54","onlyRunInLifeCycle",void 0),S._RF.pop(),S._RF.push({},"6944aqu6zZOGIj+df3KBDrm","onlyRunInLifeCycleAsync",void 0),S._RF.pop(),S._RF.push({},"99384AdWHlKDIyVvCAqSwJE","index",void 0),S._RF.pop(),S._RF.push({},"09236E0KzVAqotP4Yn9R+4m","MissingPropertiesError",void 0);var Dn=function(a){n(r,a);var o=i(r);function r(e,n){var i;return t(this,r),(i=o.call(this,"".concat(e," is missing these required properties: [").concat(n.map((function(e){return e.propertyName})).join(", "),"]"))).className=e,i.errors=n,i}return e(r)}(p(Error));S._RF.pop(),S._RF.push({},"4ce5394i3hCZoi5cZm0Vn2l","MissingPropertyError",void 0);var Mn=function(a){n(r,a);var o=i(r);function r(e,n){var i;return t(this,r),(i=o.call(this,"".concat(e," is missing the required property: <").concat(n,">"))).className=e,i.propertyName=n,i}return e(r)}(p(Error));S._RF.pop(),S._RF.push({},"a2990W72mRAYaItrPHe4H5V","required",void 0);var Nn=Ludex.Utils,Bn=Nn.String,Fn=Nn.Valid,xn=codex.monitorError,zn="_compUtils_ReqPropsMap";function Un(e){return null===e}function Gn(e){return void 0===e}function Hn(e){return Un(e)||Gn(e)}function qn(e){if("function"==typeof e)return e;switch(e){case"null-check":return Un;case"undefined-check":return Gn;default:return Hn}}function Vn(e){return function(t,n){if("function"==typeof t)throw new Error("The required decorator can only be applied to non-static class properties.");var i,a=t.constructor.name,o=(i=n,"".concat("_compUtils_ReqPropsMethod","_").concat(Bn.capitalize(i)));if(void 0!==t[o])throw new Error("The required decorator found that property name ".concat(o," already exists. The reserved method name ").concat(o," is used already or the decorator was applied multiple times."));t[o]=function(t){if(e(this[n]))throw new Mn(t,n)},void 0===t[zn]&&(t[zn]={}),void 0===t[zn][a]&&(t[zn][a]=[]),t[zn][a].push(o)}}function $n(e,t){if("string"!=typeof t)return Vn(qn(e));var n=e;Vn(qn())(n,t)}S._RF.pop(),S._RF.push({},"75e1e0Ei7ZOOr/FzyprYnVJ","index",void 0),S._RF.pop(),S._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var Wn,Kn,jn,Yn,Xn,Jn,Zn,Qn,ei,ti,ni,ii,ai,oi,ri,li,si,ui,ci,di,hi,pi,yi,vi,fi,gi,mi,bi,wi,Si,ki,Ci,Ei,Ai,Ti,Pi,Oi,Li,Ii=Ludex.Utils,Ri=Ii.Array,_i=Ii.Object,Di=Ii.Valid,Mi=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],Ni=function(){function n(){t(this,n),this.validComponentCalled$={}}return e(n,[{key:"validateRequiredComponents",value:function(e){var t,n=e.name,i=e.constructor,a=this.getRequiredComponentNames(i),o=u(a);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(!e.getComponent(r))throw new Error("".concat(n,": Missing required ").concat(r," component"))}}catch(e){o.e(e)}finally{o.f()}}},{key:"validateRequiredProperties",value:function(e){var t,n=e.name,i=e.constructor,a=this.getRequiredPropNames(i),o=u(a);try{for(o.s();!(t=o.n()).done;){var r=t.value;if(!_i.hasOwn(e,r))throw new Error("".concat(n,": Missing required ").concat(r," property"));var l=this.getProperty(r,e);if(!N(l))throw new Error("".concat(n,": ").concat(r," property is not a cc object"))}}catch(e){o.e(e)}finally{o.f()}}},{key:"validateCustomProperties",value:function(e){var t,n=e.name,i=this.getCustomPropNames(e),a=u(i);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(!_i.hasOwn(e,o))throw new Error("".concat(n,": Missing required ").concat(o," property"));var r=this.getProperty(o,e);if(!N(r))throw new Error("".concat(n,": ").concat(o," property is not a cc object"))}}catch(e){a.e(e)}finally{a.f()}}},{key:"getProperty",value:function(e,t){var n;if(_i.hasOwn(t,e))return(null!==(n=Object.getOwnPropertyDescriptor(t,e))&&void 0!==n?n:{}).value}},{key:"getProps",value:function(e){if(!_i.hasOwn(e,"__props__"))return[];var t=e.__props__;return Array.isArray(t)?t:[]}},{key:"getRequiredPropNames",value:function(e){return this.getProps(e).filter((function(t){return"node"!==t&&(!!_i.hasOwn(e,t)&&(!!N(e[t])&&!t.startsWith("_")))}))}},{key:"getBaseComponentName",value:function(e){for(var t=0,n=Mi;t<n.length;t++){var i=n[t];if(i.indexOf(e)>=0)return i}return e}},{key:"getRequiredComponentNames",value:function(e){var t=this;if(!_i.hasOwn(e,"_requireComponent"))return[];var n=e._requireComponent;return Array.isArray(n)?n.map((function(e){return t.getBaseComponentName(e)})):[]}},{key:"getCustomPropNames",value:function(e){var t=this,n=Object.keys(e),i=this.getProps(e.constructor);return Ri.difference(n,i).filter((function(e){return e.indexOf("_")<0})).filter((function(n){if(!_i.hasOwn(e,n))return!1;var i=t.getProperty(n,e);return!(!Di.isObject(i)||!N(i))}))}}],[{key:"inst",get:function(){return this.inst$||(this.inst$=new n),this.inst$}},{key:"required",value:function(e,t){return"string"==typeof t?$n(e,t):$n(e)}},{key:"onlyRunInLifeCycle",value:function(e,t,n){return"object"===h(e)&&void 0!==t&&void 0!==n?Rn(e,t,n):Rn(e)}},{key:"onlyRunInLifeCycleAsync",value:function(e,t,n){return"object"===h(e)&&void 0!==t&&void 0!==n?_n(e,t,n):_n(e)}},{key:"lazyValidateProperties",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var n=e.constructor,i=n.name;if(!this.inst.validComponentCalled$[i])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled$[i]=!0}}}},{key:"validateRequiredProperties",value:function(e,t){!function(e,t){var n,i,a=t?t.name:e.constructor.name,o=t?t.prototype[zn]:e.constructor.prototype[zn],r=null!==(n=null==o?void 0:o[a])&&void 0!==n?n:[],l=[],s=e,c=u(r);try{for(c.s();!(i=c.n()).done;){var d=i.value;if("function"==typeof s[d])try{s[d](a)}catch(h){if(!(h instanceof Mn))throw h;l.push(h)}}}catch(e){c.e(e)}finally{c.f()}if(0!==l.length){var h=new Dn(a,l);if(Fn.isDebugger())throw h;console.error(h),null==xn||xn.sendException(h)}}(e,t)}}]),n}();S._RF.pop(),S._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var Bi=C.ccclass,Fi=C.property,xi=codex.monitorError,zi=Ludex.Utils.Number,Ui=Ke.Layout,Gi=(Wn=Bi("MultiBackground"),Kn=Ni.required,jn=Fi({type:B}),Yn=Ni.required,Xn=Fi({type:F}),Jn=Ni.required,Zn=Fi({type:F}),Qn=Ni.required,ei=Fi({type:B}),ti=Ni.required,ni=Fi({type:B}),ii=Ni.required,ai=Fi({type:P}),oi=Ni.required,ri=Fi({type:P}),li=Ni.required,si=Fi({type:P}),ui=Fi(O),ci=Ni.required,di=Fi(I),hi=Fi({type:x(On)}),pi=Fi({type:x(On)}),yi=Ni.onlyRunInLifeCycleAsync,vi=Ni.onlyRunInLifeCycleAsync,Wn((mi=a((gi=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"fallbackBackground",mi,l(e)),r(e,"background1",bi,l(e)),r(e,"background2",wi,l(e)),r(e,"background1UiOpacity",Si,l(e)),r(e,"background2UiOpacity",ki,l(e)),r(e,"screenUiTransform",Ci,l(e)),r(e,"background1UiTransform",Ei,l(e)),r(e,"background2UiTransform",Ai,l(e)),r(e,"backgroundNudgeAmount",Ti,l(e)),r(e,"nudgeableWidget",Pi,l(e)),r(e,"pageOrder",Oi,l(e)),r(e,"homePage",Li,l(e)),e.currentPage=On.home,e.tryNudgeBackground=function(t){var n=t.to;e.currentPage=n;var i=e.getDirection(e.homePage,n),a=zi.sign(i),o=Math.abs(i),r=e.backgroundNudgeAmount*o,l=Math.min(e.background1UiTransform.width,e.background2UiTransform.width),s=Math.max(0,(l-e.screenUiTransform.width)/2),u=Math.min(s,r)*a;R(e.nudgeableWidget).to(.5,{horizontalCenter:u},{easing:z.cubicInOut}).start()},e}return e(d,[{key:"__preload",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,this.currentBackgroundUiOpacity=this.background1UiOpacity,this.nextBackgroundUiOpacity=this.background2UiOpacity}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this,d),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(Tn,this.tryNudgeBackground),D.on($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(Tn,this.tryNudgeBackground),D.off($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"getDirection",value:function(e,t){var n=this.pageOrder.indexOf(e),i=this.pageOrder.indexOf(t);return-1===n||-1===i?(null==xi||xi.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):n-i}},{key:"setCurrentTheme",value:(u=o((function*(e,t){var n;if(this.currentThemeId!==e){this.currentThemeId=e,null===(n=this.tweenSignal)||void 0===n||n.abort();var i=new In;null==t||t.chain(i),this.tweenSignal=i;var a=yield qe.loadThemeAsync(e);a?i.aborted||(yield this.updateBackground(a,i)):null==xi||xi.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(e,"'s sprite.")))}})),function(e,t){return u.apply(this,arguments)})},{key:"updateBackground",value:(s=o((function*(e,t){e.packable=!1;var n=this.currentBackground,i=this.nextBackground,a=this.currentBackgroundUiOpacity,o=this.nextBackgroundUiOpacity,r=this.fallbackBackground;i.spriteFrame=e,i.node.setSiblingIndex(1),o.opacity=0,r.opacity=255,yield Ve.runTweenAsync(R(o).to(.25,{opacity:255}),t),a.opacity=0,r.opacity=0,this.currentBackground=i,this.nextBackground=n,this.currentBackgroundUiOpacity=i===this.background1?this.background1UiOpacity:this.background2UiOpacity,this.nextBackgroundUiOpacity=n===this.background1?this.background1UiOpacity:this.background2UiOpacity})),function(e,t){return s.apply(this,arguments)})},{key:"handleOrientationChanged",value:function(e){if(e===Ui.Portrait){var t=this.getDirection(this.homePage,this.currentPage),n=zi.sign(t),i=Math.abs(t),a=this.backgroundNudgeAmount*i,o=Math.min(this.background1UiTransform.width,this.background2UiTransform.width),r=Math.max(0,(o-this.screenUiTransform.width)/2),l=Math.min(r,a)*n;this.nudgeableWidget.horizontalCenter=l}else e===Ui.Landscape&&(this.nudgeableWidget.horizontalCenter=0)}}]),d}(T)).prototype,"fallbackBackground",[Kn,jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bi=a(gi.prototype,"background1",[Yn,Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wi=a(gi.prototype,"background2",[Jn,Zn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Si=a(gi.prototype,"background1UiOpacity",[Qn,ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ki=a(gi.prototype,"background2UiOpacity",[ti,ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ci=a(gi.prototype,"screenUiTransform",[ii,ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ei=a(gi.prototype,"background1UiTransform",[oi,ri],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=a(gi.prototype,"background2UiTransform",[li,si],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ti=a(gi.prototype,"backgroundNudgeAmount",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Pi=a(gi.prototype,"nudgeableWidget",[ci,di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oi=a(gi.prototype,"pageOrder",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Li=a(gi.prototype,"homePage",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return On.home}}),a(gi.prototype,"setCurrentTheme",[yi],Object.getOwnPropertyDescriptor(gi.prototype,"setCurrentTheme"),gi.prototype),a(gi.prototype,"updateBackground",[vi],Object.getOwnPropertyDescriptor(gi.prototype,"updateBackground"),gi.prototype),fi=gi))||fi);S._RF.pop(),S._RF.push({},"cb1abhXDs1A57EPVKbvTJg/","ButtonPlusEvents",void 0);var Hi="TRANSITION_DOWN",qi="TRANSITION_HOVER",Vi="TRANSITION_RESET",$i="TRANSITION_DISABLED",Wi="CLICK_START",Ki="CLICK",ji="CLICK_END",Yi="CLICK_CANCEL";S._RF.pop(),S._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var Xi="musics/",Ji="sounds/",Zi=Ludex.Utils.Object,Qi={BUTTON_CLICK:"".concat(Ji,"use_item_click"),BOMB_DEFUSE:"".concat(Ji,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(Ji,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(Ji,"bomb_explode_2"),CLICKS:"".concat(Ji,"clicks"),CLOSE_POPUP_CLICK:"".concat(Ji,"close_popup_click"),COLLECT_STARS:"".concat(Ji,"collect_stars"),COMBO_1:"".concat(Ji,"combo_1"),COMBO_2:"".concat(Ji,"combo_2"),COMBO_3:"".concat(Ji,"combo_3"),COMBO_4:"".concat(Ji,"combo_4"),COMBO_5:"".concat(Ji,"combo_5"),DAILY_REWARD:"".concat(Ji,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(Ji,"extra_time_spawn"),GIFT_CHARGE:"".concat(Ji,"gift_charge"),GIFT_EXPLODE:"".concat(Ji,"gift_explode"),GIFT_REVEAL:"".concat(Ji,"gift_reveal"),HINT_ITEM:"".concat(Ji,"hint_item"),INVALID_MATCH:"".concat(Ji,"invalid_match"),LEVEL_COMPLETE:"".concat(Ji,"level_complete"),LEVEL_FAIL:"".concat(Ji,"level_fail"),LEVEL_START:"".concat(Ji,"level_start"),PROGRESS_STAR:"".concat(Ji,"progress_star"),RESCUE_TIMER:"".concat(Ji,"rescue_timer"),ROCKET_FLY:"".concat(Ji,"rocket_fly"),SHUFFLE_ITEM:"".concat(Ji,"shuffle_item"),THREE_STARS:"".concat(Ji,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(Ji,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(Ji,"tile_select"),USE_ITEM_CLICK:"".concat(Ji,"use_item_click"),BG_MUSIC:"".concat(Xi,"bg_music"),PATCH_SHIFT:"".concat(Ji,"patch_shift"),THUNDERBOLT:"".concat(Ji,"thunderbolt"),WIND:"".concat(Ji,"wind"),COLLECT_COINS:"".concat(Ji,"collect_coins"),COLLECT_STOCK_COINS:"".concat(Ji,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(Ji,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(Ji,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(Ji,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(Ji,"leaderboard_triumph"),ITEM_REWARD:"".concat(Ji,"item_reward"),COMBO_6:"".concat(Ji,"combo_6"),COMBO_7:"".concat(Ji,"combo_7"),COMBO_8:"".concat(Ji,"combo_8"),COMBO_9:"".concat(Ji,"combo_9"),COMBO_10:"".concat(Ji,"combo_10"),COMBO_11:"".concat(Ji,"combo_11"),COMBO_12:"".concat(Ji,"combo_12"),COMBO_13:"".concat(Ji,"combo_13"),TILE_MATCH:"".concat(Ji,"tile_match"),TOURNAMENT_MUSIC:"".concat(Xi,"tournament_music")},ea=Zi.vals(Qi),ta=ea.reduce((function(e,t,n){return e[t]=n,e}),{});M(ta);var na,ia,aa,oa,ra,la,sa,ua,ca,da,ha,pa,ya,va,fa,ga,ma,ba,wa,Sa,ka,Ca,Ea,Aa,Ta,Pa,Oa,La,Ia,Ra=ea;S._RF.pop(),S._RF.push({},"56710cJAPhPd4KK3hV3y8m6","ButtonPlus",void 0);var _a,Da,Ma,Na,Ba,Fa,xa,za,Ua,Ga,Ha,qa=C.ccclass,Va=C.property,$a=C.disallowMultiple,Wa=C.menu,Ka=(na=qa("ButtonPlus"),ia=Wa("Ludex/ButtonPlus/ButtonPlus"),aa=Va(U),oa=Va(U),ra=Va(U),la=Va({override:!0,visible:!1}),sa=Va({override:!0,visible:!1}),ua=Va({override:!0,visible:!1}),ca=Va({override:!0,visible:!1}),da=Va({override:!0,visible:!1}),ha=Va({override:!0,visible:!1}),pa=Va({override:!0,visible:!1}),ya=Va({override:!0,visible:!1}),va=Va({override:!0,visible:!1}),fa=Va({override:!0,visible:!1}),ga=Va({override:!0,visible:!1}),ma=Va({visible:function(){return this.makeSound},type:ta}),ba=Va({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),wa=Va({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),na(Sa=$a(Sa=ia((Ca=a((ka=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"onClickStartEvents",Ca,l(e)),r(e,"onClickEndEvents",Ea,l(e)),r(e,"onClickCancelEvents",Aa,l(e)),r(e,"makeSound",Ta,l(e)),r(e,"soundKey",Pa,l(e)),r(e,"disableSpamClick",Oa,l(e)),r(e,"disableSpamDelay",La,l(e)),r(e,"performBoundsCheckOnClickCancel",Ia,l(e)),e.currentClickBoundingBox=null,e.hasDown=!1,e.hasUp=!1,e.hasFinishClickCycle=!1,e.hasBeenDisabled=!1,e.onTouchStart=function(t){e.interactable&&(e.hasDown||(e.currentClickBoundingBox=We.getBoundingBoxToWorld(e.node),e.handleDown(t)))},e.onTouchEnd=function(t){e.scheduleOnce((function(){e.interactable&&e.hasDown&&(e.hasUp||e.handleUp(t))}),0)},e.onTouchCancel=function(t){if(e.interactable&&e.hasDown&&!e.hasUp){if(e.performBoundsCheckOnClickCancel){var n,i,a=t.getUILocation();if(null!==(n=null===(i=e.currentClickBoundingBox)||void 0===i?void 0:i.contains(a))&&void 0!==n&&n)return void e.handleUp(t)}e.hasUp=!0,e.hasFinishClickCycle=!0,e.handleResetButtonState(),e.emitClickCancelEvents(t),e.emitClickEndEvents(t)}},e.onMouseEnter=function(t){e.interactable&&(e.hasDown||(e.hasFinishClickCycle=!1,e.emitTransitionEvent(qi)))},e.onMouseLeave=function(t){e.interactable&&(e.hasDown||e.hasUp||e.hasFinishClickCycle||e.handleResetButtonState())},e.handleResetButtonState=function(){e.hasDown=!1,e.hasUp=!1,e.emitTransitionEvent(Vi)},e}return e(s,[{key:"transition",get:function(){return G.Transition.NONE},set:function(e){y(d(s.prototype),"transition",G.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return c(d(s.prototype),"normalColor",this)},set:function(e){y(d(s.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function(){return c(d(s.prototype),"pressedColor",this)},set:function(e){y(d(s.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function(){return c(d(s.prototype),"hoverColor",this)},set:function(e){y(d(s.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function(){return c(d(s.prototype),"disabledColor",this)},set:function(e){y(d(s.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function(){return c(d(s.prototype),"normalSprite",this)},set:function(e){y(d(s.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function(){return c(d(s.prototype),"pressedSprite",this)},set:function(e){y(d(s.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function(){return c(d(s.prototype),"hoverSprite",this)},set:function(e){y(d(s.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function(){return c(d(s.prototype),"disabledSprite",this)},set:function(e){y(d(s.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function(){return c(d(s.prototype),"duration",this)},set:function(e){y(d(s.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function(){return c(d(s.prototype),"zoomScale",this)},set:function(e){y(d(s.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function(){c(d(s.prototype),"__preload",this).call(this)}},{key:"onDestroy",value:function(){var e;null===(e=c(d(s.prototype),"onDestroy",this))||void 0===e||e.call(this)}},{key:"onEnable",value:function(){var e;null===(e=c(d(s.prototype),"onEnable",this))||void 0===e||e.call(this),this.hasBeenDisabled=!this.interactable,this.node.off(H.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(q.EventType.TOUCH_START,this.onTouchStart),this.node.on(q.EventType.TOUCH_END,this.onTouchEnd),this.node.on(q.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(q.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(q.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var e;null===(e=c(d(s.prototype),"onDisable",this))||void 0===e||e.call(this),this.node.off(q.EventType.TOUCH_START,this.onTouchStart),this.node.off(q.EventType.TOUCH_END,this.onTouchEnd),this.node.off(q.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(q.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(q.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"_updateState",value:function(){c(d(s.prototype),"_updateState",this).call(this),this.patchEmitTransitionDisabled()}},{key:"patchEmitTransitionDisabled",value:function(){var e=3===this._getButtonState();this.hasBeenDisabled!==e&&(e?this.emitTransitionEvent($i):this.emitTransitionEvent(Vi),this.hasBeenDisabled=e)}},{key:"handleDown",value:function(e){this.hasDown=!0,this.makeSound&&je.playSound(Ra[this.soundKey]),this.emitTransitionEvent(Hi),this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function(e){var t,n=u(this.onClickStartEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}this.node.emit(Wi,this)}},{key:"emitClickEndEvents",value:function(e){var t,n=u(this.onClickEndEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}this.node.emit(ji,this)}},{key:"emitClickCancelEvents",value:function(e){var t,n=u(this.onClickCancelEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}this.node.emit(Yi,this)}},{key:"handleUp",value:function(e){this.hasUp=!0,this._pressed=!1,this.hasFinishClickCycle=!0,this.emitTransitionEvent(Vi),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function(e){if(this.interactable){var t,n=u(this.clickEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}this.node.emit(Ki,this),this.node.emit(G.EventType.CLICK,this)}}},{key:"emitTransitionEvent",value:function(e){this.node.emit(e,this)}},{key:"fakeClick",value:function(){var e=this;this.emitTransitionEvent(Hi),this.scheduleOnce((function(){e.emitTransitionEvent(Vi)}),0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}},{key:"setInteractable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.interactable=e,t&&(this.enabled=e)}}]),s}(G)).prototype,"onClickStartEvents",[aa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ea=a(ka.prototype,"onClickEndEvents",[oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Aa=a(ka.prototype,"onClickCancelEvents",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),a(ka.prototype,"transition",[la],Object.getOwnPropertyDescriptor(ka.prototype,"transition"),ka.prototype),a(ka.prototype,"normalColor",[sa],Object.getOwnPropertyDescriptor(ka.prototype,"normalColor"),ka.prototype),a(ka.prototype,"pressedColor",[ua],Object.getOwnPropertyDescriptor(ka.prototype,"pressedColor"),ka.prototype),a(ka.prototype,"hoverColor",[ca],Object.getOwnPropertyDescriptor(ka.prototype,"hoverColor"),ka.prototype),a(ka.prototype,"disabledColor",[da],Object.getOwnPropertyDescriptor(ka.prototype,"disabledColor"),ka.prototype),a(ka.prototype,"normalSprite",[ha],Object.getOwnPropertyDescriptor(ka.prototype,"normalSprite"),ka.prototype),a(ka.prototype,"pressedSprite",[pa],Object.getOwnPropertyDescriptor(ka.prototype,"pressedSprite"),ka.prototype),a(ka.prototype,"hoverSprite",[ya],Object.getOwnPropertyDescriptor(ka.prototype,"hoverSprite"),ka.prototype),a(ka.prototype,"disabledSprite",[va],Object.getOwnPropertyDescriptor(ka.prototype,"disabledSprite"),ka.prototype),a(ka.prototype,"duration",[fa],Object.getOwnPropertyDescriptor(ka.prototype,"duration"),ka.prototype),a(ka.prototype,"zoomScale",[ga],Object.getOwnPropertyDescriptor(ka.prototype,"zoomScale"),ka.prototype),Ta=a(ka.prototype,"makeSound",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Pa=a(ka.prototype,"soundKey",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ta[Qi.BUTTON_CLICK]}}),Oa=a(ka.prototype,"disableSpamClick",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),La=a(ka.prototype,"disableSpamDelay",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Ia=a(ka.prototype,"performBoundsCheckOnClickCancel",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Sa=ka))||Sa)||Sa)||Sa);S._RF.pop(),S._RF.push({},"b7001YamGNLeauE1hUAtFfj","ButtonPlusAnalytics",void 0);var ja,Ya,Xa,Ja,Za,Qa,eo,to,no,io,ao,oo,ro,lo,so,uo,co,ho,po,yo,vo=C.ccclass,fo=C.property,go=C.disallowMultiple,mo=C.requireComponent,bo=C.menu,wo=Ludex.Plugins.Analytics,So=(void 0===wo?{}:wo).Events,ko=codex.analytics;_a=vo("ButtonPlusAnalytics"),Da=mo(Ka),Ma=bo("Ludex/ButtonPlus/ButtonPlusAnalytics"),Na=Ni.required,Ba=fo(Ka),Fa=fo({visible:function(){return this.useCustomButtonName}}),_a(xa=go(xa=Da(xa=Ma((Ua=a((za=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"button",Ua,l(e)),r(e,"useCustomButtonName",Ga,l(e)),r(e,"customButtonName",Ha,l(e)),e}return e(s,[{key:"onEnable",value:function(){this.button.node.on(Ki,this.onClick,this)}},{key:"onDisable",value:function(){this.button.node.off(Hi,this.onClick,this)}},{key:"onClick",value:function(){So&&ko.event(So.BUTTON_CLICK,{button_name:this.useCustomButtonName?this.customButtonName:this.node.name,screen_name:Ye.getCurrentPage()})}}]),s}(T)).prototype,"button",[Na,Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ga=a(za.prototype,"useCustomButtonName",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ha=a(za.prototype,"customButtonName",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),xa=za))||xa)||xa)||xa);S._RF.pop(),S._RF.push({},"a89b3F866FGO68YNa+5Tsqh","ButtonPlusScale",void 0);var Co,Eo,Ao,To,Po,Oo,Lo,Io,Ro,_o,Do,Mo,No,Bo,Fo,xo,zo,Uo,Go,Ho,qo,Vo,$o,Wo,Ko,jo,Yo,Xo,Jo,Zo,Qo,er,tr,nr,ir,ar=C.ccclass,or=C.property,rr=C.disallowMultiple,lr=C.requireComponent,sr=C.menu,ur=Ludex.Utils.Signal;ja=ar("ButtonPlusScale"),Ya=lr(Ka),Xa=sr("Ludex/ButtonPlus/ButtonPlusScale"),Ja=Ni.required,Za=or(Ka),Qa=or({group:{name:"Normal",style:"section"},displayName:"Scale"}),eo=or({group:{name:"Normal",style:"section"},displayName:"Duration"}),to=or({group:{name:"Hover",style:"section"},displayName:"Scale"}),no=or({group:{name:"Hover",style:"section"},displayName:"Duration"}),io=or({group:{name:"Click",style:"section"},displayName:"Scale"}),ao=or({group:{name:"Click",style:"section"},displayName:"Duration"}),ja(oo=rr(oo=Ya(oo=Xa((lo=a((ro=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"button",lo,l(e)),r(e,"normalScale",so,l(e)),r(e,"normalDuration",uo,l(e)),r(e,"hoverScale",co,l(e)),r(e,"hoverDuration",ho,l(e)),r(e,"clickScale",po,l(e)),r(e,"clickDuration",yo,l(e)),e.animStateController=new ur.SignalController,e}return e(s,[{key:"start",value:function(){this.button.node.setScale(this.normalScale)}},{key:"onEnable",value:function(){this.button.node.on(Hi,this.onTransitionDown,this),this.button.node.on(qi,this.onTransitionHover,this),this.button.node.on(Vi,this.onTransitionReset,this)}},{key:"onDisable",value:function(){this.button.node.off(Hi,this.onTransitionDown,this),this.button.node.off(qi,this.onTransitionHover,this),this.button.node.off(Vi,this.onTransitionReset,this)}},{key:"onTransitionDown",value:function(){Ve.runTweenAsync(R(this.button.node).to(this.clickDuration,{scale:this.clickScale},{easing:"cubicOut"}),this.animStateController.renew())}},{key:"onTransitionHover",value:function(){Ve.runTweenAsync(R(this.button.node).to(this.hoverDuration,{scale:this.hoverScale},{easing:"backOut"}),this.animStateController.renew())}},{key:"onTransitionReset",value:function(){Ve.runTweenAsync(R(this.button.node).to(this.normalDuration,{scale:this.normalScale},{easing:"cubicOut"}),this.animStateController.renew())}}]),s}(T)).prototype,"button",[Ja,Za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so=a(ro.prototype,"normalScale",[Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new V(1,1,1)}}),uo=a(ro.prototype,"normalDuration",[eo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),co=a(ro.prototype,"hoverScale",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new V(1.1,1.1,1.1)}}),ho=a(ro.prototype,"hoverDuration",[no],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),po=a(ro.prototype,"clickScale",[io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new V(.9,.9,.9)}}),yo=a(ro.prototype,"clickDuration",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),oo=ro))||oo)||oo)||oo);S._RF.pop(),S._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var cr,dr,hr,pr,yr=C.ccclass,vr=C.property,fr=C.disallowMultiple,gr=C.executionOrder,mr=codex.analytics,br=Ludex,wr=br.Plugins.Analytics,Sr=(void 0===wr?{}:wr).Events,kr=br.Utils.Valid,Cr=(Co=yr("ExtendedButton"),Eo=gr(111),Ao=vr(U),To=vr(U),Po=vr($.AnimationController),Oo=vr({override:!0,visible:!1}),Lo=vr({override:!0,visible:!1}),Io=vr({override:!0,visible:!1}),Ro=vr({override:!0,visible:!1}),_o=vr({override:!0,visible:!1}),Do=vr({override:!0,visible:!1}),Mo=vr({override:!0,visible:!1}),No=vr({override:!0,visible:!1}),Bo=vr({override:!0,visible:!1}),Fo=vr({override:!0,visible:!1}),xo=vr({override:!0,visible:!1}),zo=vr(W),Uo=vr(W),Go=vr(W),Ho=vr({visible:function(){return this.makeSound},type:ta}),qo=vr({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),Vo=vr({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),$o=vr({}),Co(Wo=fr(Wo=Eo((jo=a((Ko=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"clickStartEvents",jo,l(e)),r(e,"clickEndEvents",Yo,l(e)),r(e,"animationController",Xo,l(e)),r(e,"useDesktopHover",Jo,l(e)),r(e,"emitAnalyticsEvents",Zo,l(e)),r(e,"makeSound",Qo,l(e)),r(e,"soundKey",er,l(e)),r(e,"disableSpamClick",tr,l(e)),r(e,"disableSpamDelay",nr,l(e)),r(e,"isScrollViewCancelInnerEvents",ir,l(e)),e.currentClickBoundingBox=null,e.hasDown=!1,e.hasUp=!1,e.hasFinishClickCycle=!1,e.onTouchStart=function(t){e.interactable&&(e.hasDown||(e.currentClickBoundingBox=We.getBoundingBoxToWorld(e.node),e.handleDown(t)))},e.onTouchEnd=function(t){e.scheduleOnce((function(){e.interactable&&e.hasDown&&(e.hasUp||e.handleUp(t))}),0)},e.onTouchCancel=function(t){if(e.interactable&&e.hasDown&&!e.hasUp){if(!e.isScrollViewCancelInnerEvents){var n,i,a=t.getUILocation();if(null!==(n=null===(i=e.currentClickBoundingBox)||void 0===i?void 0:i.contains(a))&&void 0!==n&&n)return void e.handleUp(t)}e.hasUp=!0,e.hasFinishClickCycle=!0,e.handleResetButtonState(),e.emitClickEndEvents(t)}},e.onMouseEnter=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||(e.hasFinishClickCycle=!1,e.setAnimationState("HOVER")))},e.onMouseLeave=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||e.hasUp||e.hasFinishClickCycle||e.handleResetButtonState())},e.handleResetButtonState=function(){e.hasDown=!1,e.hasUp=!1,e.setAnimationState("RESET")},e}return e(s,[{key:"transition",get:function(){return G.Transition.NONE},set:function(e){y(d(s.prototype),"transition",G.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return c(d(s.prototype),"normalColor",this)},set:function(e){y(d(s.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function(){return c(d(s.prototype),"pressedColor",this)},set:function(e){y(d(s.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function(){return c(d(s.prototype),"hoverColor",this)},set:function(e){y(d(s.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function(){return c(d(s.prototype),"disabledColor",this)},set:function(e){y(d(s.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function(){return c(d(s.prototype),"normalSprite",this)},set:function(e){y(d(s.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function(){return c(d(s.prototype),"pressedSprite",this)},set:function(e){y(d(s.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function(){return c(d(s.prototype),"hoverSprite",this)},set:function(e){y(d(s.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function(){return c(d(s.prototype),"disabledSprite",this)},set:function(e){y(d(s.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function(){return c(d(s.prototype),"duration",this)},set:function(e){y(d(s.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function(){return c(d(s.prototype),"zoomScale",this)},set:function(e){y(d(s.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function(){c(d(s.prototype),"__preload",this).call(this),Ni.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var e;null===(e=c(d(s.prototype),"onDestroy",this))||void 0===e||e.call(this)}},{key:"onEnable",value:function(){var e;null===(e=c(d(s.prototype),"onEnable",this))||void 0===e||e.call(this),this.node.off(H.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(q.EventType.TOUCH_START,this.onTouchStart),this.node.on(q.EventType.TOUCH_END,this.onTouchEnd),this.node.on(q.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(q.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(q.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var e;null===(e=c(d(s.prototype),"onDisable",this))||void 0===e||e.call(this),this.node.off(q.EventType.TOUCH_START,this.onTouchStart),this.node.off(q.EventType.TOUCH_END,this.onTouchEnd),this.node.off(q.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(q.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(q.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(e){if(this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&kr.isString(this.soundKey)){var t=Ra[this.soundKey];t&&je.playSound(t)}this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function(e){var t,n=u(this.clickStartEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}}},{key:"emitClickEndEvents",value:function(e){var t,n=u(this.clickEndEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}}},{key:"handleUp",value:function(e){this.hasUp=!0,this._pressed=!1,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function(e){if(this.interactable){if(this.emitAnalyticsEvents&&Sr){var t=Ye.getCurrentPage();mr.event(Sr.BUTTON_CLICK,{button_name:this.node.name,screen_name:t})}var n,i=u(this.clickEvents);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.emit([e,a.customEventData])}}catch(e){i.e(e)}finally{i.f()}this.node.emit(G.EventType.CLICK,this)}}},{key:"setAnimationState",value:function(e){this.animationController&&(this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e))}},{key:"fakeClick",value:function(){var e=this;this.setAnimationState("DOWN"),this.scheduleOnce((function(){e.setAnimationState("RESET")}),0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),s}(G)).prototype,"clickStartEvents",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yo=a(Ko.prototype,"clickEndEvents",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xo=a(Ko.prototype,"animationController",[Po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Ko.prototype,"transition",[Oo],Object.getOwnPropertyDescriptor(Ko.prototype,"transition"),Ko.prototype),a(Ko.prototype,"normalColor",[Lo],Object.getOwnPropertyDescriptor(Ko.prototype,"normalColor"),Ko.prototype),a(Ko.prototype,"pressedColor",[Io],Object.getOwnPropertyDescriptor(Ko.prototype,"pressedColor"),Ko.prototype),a(Ko.prototype,"hoverColor",[Ro],Object.getOwnPropertyDescriptor(Ko.prototype,"hoverColor"),Ko.prototype),a(Ko.prototype,"disabledColor",[_o],Object.getOwnPropertyDescriptor(Ko.prototype,"disabledColor"),Ko.prototype),a(Ko.prototype,"normalSprite",[Do],Object.getOwnPropertyDescriptor(Ko.prototype,"normalSprite"),Ko.prototype),a(Ko.prototype,"pressedSprite",[Mo],Object.getOwnPropertyDescriptor(Ko.prototype,"pressedSprite"),Ko.prototype),a(Ko.prototype,"hoverSprite",[No],Object.getOwnPropertyDescriptor(Ko.prototype,"hoverSprite"),Ko.prototype),a(Ko.prototype,"disabledSprite",[Bo],Object.getOwnPropertyDescriptor(Ko.prototype,"disabledSprite"),Ko.prototype),a(Ko.prototype,"duration",[Fo],Object.getOwnPropertyDescriptor(Ko.prototype,"duration"),Ko.prototype),a(Ko.prototype,"zoomScale",[xo],Object.getOwnPropertyDescriptor(Ko.prototype,"zoomScale"),Ko.prototype),Jo=a(Ko.prototype,"useDesktopHover",[zo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Zo=a(Ko.prototype,"emitAnalyticsEvents",[Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Qo=a(Ko.prototype,"makeSound",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),er=a(Ko.prototype,"soundKey",[Ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ta[Qi.BUTTON_CLICK]}}),tr=a(Ko.prototype,"disableSpamClick",[qo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nr=a(Ko.prototype,"disableSpamDelay",[Vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ir=a(Ko.prototype,"isScrollViewCancelInnerEvents",[$o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Wo=Ko))||Wo)||Wo)||Wo);S._RF.pop(),S._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var Er,Ar,Tr,Pr,Or,Lr,Ir,Rr,_r,Dr,Mr,Nr,Br,Fr,xr,zr,Ur=C.ccclass,Gr=C.requireComponent,Hr=C.property,qr=Ur("OpacityToggler")(cr=Gr([B])((hr=a((dr=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"activeValue",hr,l(e)),r(e,"inActiveValue",pr,l(e)),e.signal=new In,e}return e(c,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(B),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"changeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(s=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;this.signal.abort(),this.signal=new In;var n=e?this.activeValue:this.inActiveValue;yield Ve.runTweenAsync(R(this.opacityComponent).to(t,{opacity:n}),this.signal)})),function(){return s.apply(this,arguments)})}]),c}(T)).prototype,"activeValue",[Hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),pr=a(dr.prototype,"inActiveValue",[Hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),cr=dr))||cr)||cr;S._RF.pop(),S._RF.push({},"08623z7mLxP/4DVAyNB9srK","DebugAdsPlugin",void 0);var Vr,$r,Wr,Kr=C.ccclass,jr=C.property,Yr=C.requireComponent,Xr=Ludex,Jr=Xr.Events,Zr=Xr.Plugins.Ads.Types,Qr=codex,el=Qr.event,tl=Qr.ads,nl={color:"#00FFFF",prefix:"LOADING"},il={color:"#00FF00",prefix:"LOADED"},al={color:"#FF00FF",prefix:"LOAD FAIL"},ol={color:"#FFFF00",prefix:"SHOWING..."},rl={color:"#00FF00",prefix:"SHOW"},ll={color:"#FF0000",prefix:"SHOW FAIL"},sl={color:"#AAAAAA",prefix:"CLOSED"};Er=Kr("DebugAdsPlugin"),Ar=Yr(B),Tr=Ni.required(),Pr=jr(K),Or=Ni.required(),Lr=jr(K),Ir=Ni.required(),Rr=jr(j),_r=Ni.required(),Dr=jr(B),Er(Mr=Ar((Br=a((Nr=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"statusLabel",Br,l(e)),r(e,"timersLabel",Fr,l(e)),r(e,"logLabel",xr,l(e)),r(e,"opacity",zr,l(e)),e.logLines$=[],e.touchMs$=0,e.logInitializedAds$=function(){if(tl){var t=tl.getAdsInstances();t&&0!==Object.keys(t).length?(e.addLog$("Initialized ".concat(Object.keys(t).length," ad instances:"),"#00FF00"),Object.entries(t).forEach((function(t){var n=v(t,2),i=(n[0],n[1]),a=i.deviceOS,o=i.placementId;e.addLog$("".concat(o," on ").concat(a),"#00FFFF")}))):e.addLog$("No ad instances initialized","#FFFF00")}else e.addLog$("Ads plugin not available","#FF0000")},e.listenEvents$=function(){el.on(Jr.AD_LOADING,e.onAdLoading$),el.on(Jr.AD_LOADED,e.onAdLoaded$),el.on(Jr.AD_LOAD_FAILED,e.onAdLoadFailed$),el.on(Jr.AD_SHOWING,e.onAdShowing$),el.on(Jr.AD_SHOW,e.onAdShow$),el.on(Jr.AD_SHOW_FAILED,e.onAdShowFailed$),el.on(Jr.AD_CLOSED,e.onAdClosed$)},e.unlistenEvents$=function(){el.off(Jr.AD_LOADING,e.onAdLoading$),el.off(Jr.AD_LOADED,e.onAdLoaded$),el.off(Jr.AD_LOAD_FAILED,e.onAdLoadFailed$),el.off(Jr.AD_SHOWING,e.onAdShowing$),el.off(Jr.AD_SHOW,e.onAdShow$),el.off(Jr.AD_SHOW_FAILED,e.onAdShowFailed$),el.off(Jr.AD_CLOSED,e.onAdClosed$)},e.listenInputEvents$=function(){e.node.on(H.EventType.TOUCH_START,e.handleTouchStart$),e.node.on(H.EventType.TOUCH_END,e.handleTouchEnd$)},e.cleanupInputEvents$=function(){e.node.off(H.EventType.TOUCH_START,e.handleTouchStart$),e.node.off(H.EventType.TOUCH_END,e.handleTouchEnd$)},e.handleTouchStart$=function(t){(t.preventSwallow=0===e.opacity.opacity,t.touch&&e.opacity)&&(Date.now()-e.touchMs$<300&&(255===e.opacity.opacity?e.opacity.opacity=0:e.opacity.opacity=255),e.touchMs$=Date.now())},e.handleTouchEnd$=function(t){t.preventSwallow=0===e.opacity.opacity},e.onAdLoading$=function(t){return e.logEvent$(nl,t)},e.onAdLoaded$=function(t){return e.logEvent$(il,t)},e.onAdLoadFailed$=function(t){return e.logEvent$(al,t)},e.onAdShowing$=function(t){return e.logEvent$(ol,t)},e.onAdShow$=function(t){return e.logEvent$(rl,t)},e.onAdShowFailed$=function(t){return e.logEvent$(ll,t)},e.onAdClosed$=function(t){return e.logEvent$(sl,t)},e.logEvent$=function(t,n){var i=n.type,a=n.placementId;e.addLog$("".concat(t.prefix,": ").concat(i," (").concat(a,")"),t.color)},e.addLog$=function(t,n){var i=(new Date).toLocaleTimeString().split(" ")[0],a="<color=".concat(n,">[").concat(i,"] ").concat(t,"</color>");e.logLines$.push(a),e.logLines$.length>20&&e.logLines$.shift(),e.logLabel&&(e.logLabel.string=e.logLines$.join("\n"))},e.updateStatus$=function(){var t=tl.enabled,n=tl.getDeviceOS(),i=tl.getDegradationTracking(),a=tl.getSafeAreaBottom(1),o="N/A",r="N/A";if(i){var l=i.lastSuccessTime;r=l>0?new Date(l).toLocaleTimeString():"Never",o="".concat(i.failedAttempts)}e.statusLabel.string=["Enabled: ".concat(t),"DeviceOS: ".concat(n),"Last Success: ".concat(r),"SafeAreaBottom: ".concat(a),"Degradation Attempts: ".concat(o)].join("\n")},e.updateTimers$=function(){var t=tl.getLastCallAdShownTime();if(t){var n=Date.now()/1e3,i=Object.values(Zr).map((function(e){var i=t[e]||0,a=i>0?(n-i).toFixed(1):"Never";return"".concat(e,": ").concat(a,"s")})).join("\n");e.timersLabel.string="Time Since Last Show\n".concat(i)}},e}return e(s,[{key:"onLoad",value:function(){var e=this;this.logInitializedAds$(),this.listenEvents$(),this.listenInputEvents$(),this.schedule((function(){e.updateStatus$(),e.updateTimers$()}),.5)}},{key:"onDestroy",value:function(){this.unlistenEvents$(),this.cleanupInputEvents$(),this.unscheduleAllCallbacks()}}]),s}(T)).prototype,"statusLabel",[Tr,Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fr=a(Nr.prototype,"timersLabel",[Or,Lr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xr=a(Nr.prototype,"logLabel",[Ir,Rr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zr=a(Nr.prototype,"opacity",[_r,Dr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mr=Nr))||Mr);S._RF.pop(),S._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var ul=C.ccclass,cl=C.property,dl=C.requireComponent,hl=C.disallowMultiple,pl=C.executeInEditMode,yl=Ke.DesignSize,vl=yl.Portrait,fl=yl.Landscape;ul("DebugResolution")(Vr=hl(Vr=dl([Y])(Vr=pl(!0)(((Wr=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i))).handleLayoutChange=function(){var t;null===(t=e.graphics)||void 0===t||t.clear(),e.start()},e}return e(r,[{key:"drawPortrait",get:function(){return r._drawPortrait},set:function(e){e!==r._drawPortrait&&(e?this.drawPortraitResolution():this.graphics.clear(),r._drawPortrait=e,r._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return r._drawLandscape},set:function(e){e!==r._drawLandscape&&(e?this.drawLandscapeResolution():this.graphics.clear(),r._drawLandscape=e,r._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(Y),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){D.on($e.LAYOUT_CHANGED,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var e=this.graphics;if(e){var t=vl.WIDTH,n=vl.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=X.GREEN,e.rect(i,a,t,n),e.stroke()}}},{key:"drawLandscapeResolution",value:function(){var e=this.graphics;if(e){var t=fl.WIDTH,n=fl.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=X.CYAN,e.rect(i,a,t,n),e.stroke()}}}]),r}(T))._drawPortrait=!0,Wr._drawLandscape=!0,a(($r=Wr).prototype,"drawPortrait",[cl],Object.getOwnPropertyDescriptor($r.prototype,"drawPortrait"),$r.prototype),a($r.prototype,"drawLandscape",[cl],Object.getOwnPropertyDescriptor($r.prototype,"drawLandscape"),$r.prototype),Vr=$r))||Vr)||Vr)||Vr);S._RF.pop(),S._RF.push({},"0405b+DQy1IALb/j8jx5Lpc","PerfCounter",void 0);var gl,ml,bl,wl,Sl,kl,Cl,El,Al,Tl,Pl,Ol,Ll,Il,Rl,_l,Dl,Ml,Nl,Bl,Fl,xl,zl,Ul,Gl,Hl,ql,Vl,$l,Wl,Kl,jl,Yl,Xl,Jl,Zl,Ql,es,ts,ns,is,as,os,rs,ls=function(){function n(){t(this,n),this.time=0,this._value=0,this.time=0,this._value=0}return e(n,[{key:"value",get:function(){return this._value}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.time=e}},{key:"end",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._value=e-this.time}}]),n}();S._RF.pop(),S._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var ss=C.ccclass,us=C.executionOrder,cs=C.property,ds=C.requireComponent,hs=Ludex,ps=hs.Utils,ys=ps.Valid,vs=ps.Array,fs=ps.Device,gs=hs.Configs.Debugger.ListPlayerDevIds,ms=codex.player,bs=X.RED,ws=X.YELLOW,Ss=X.WHITE,ks=X.BLACK;gl=ss("GameStats"),ml=us(-1e3),bl=ds([B]),wl=Ni.required(),Sl=cs(K),kl=Ni.required(),Cl=cs(K),El=Ni.required(),Al=cs(K),Tl=Ni.required(),Pl=cs(K),Ol=Ni.required(),Ll=cs(K),Il=Ni.required(),Rl=cs(K),_l=Ni.required(),Dl=cs(K),Ml=Ni.required(),Nl=cs(K),Bl=Ni.required(),Fl=cs(K),xl=Ni.required(),zl=cs(K),Ul=Ni.required(),Gl=cs(K),Hl=Ni.required(),ql=cs(F),Vl=Ni.required(),$l=cs(B),gl(Wl=ml(Wl=bl((jl=a((Kl=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"dprLabel",jl,l(e)),r(e,"fpsLabel",Yl,l(e)),r(e,"fpsRawLabel",Xl,l(e)),r(e,"drawCountLabel",Jl,l(e)),r(e,"rafTimeLabel",Zl,l(e)),r(e,"deltaTimeLabel",Ql,l(e)),r(e,"logicTimeLabel",es,l(e)),r(e,"physicTimeLabel",ts,l(e)),r(e,"renderTimeLabel",ns,l(e)),r(e,"objectMemoryUsageLabel",is,l(e)),r(e,"textureMemoryUsageLabel",as,l(e)),r(e,"bg",os,l(e)),r(e,"opacity",rs,l(e)),e.lastRafTime$=0,e.slowRefreshInterval$=1,e.mediumRefreshInterval$=.5,e.fastRefreshInterval$=.16,e.isBackgroundEnabled$=!1,e.touchMs$=0,e.isDragging$=!1,e.listenInputEvents$=function(){e.node.on(H.EventType.TOUCH_START,e.handleTouchStart$),e.node.on(H.EventType.TOUCH_MOVE,e.handleTouchMove$),e.node.on(H.EventType.TOUCH_END,e.handleTouchEnd$),e.node.on(H.EventType.TOUCH_CANCEL,e.handleTouchEnd$),e.node.on(H.EventType.MOUSE_WHEEL,(function(){console.info(l(e)),D.emit($e.REQUEST_DYNAMIC_ATLAS)}))},e.handleTouchStart$=function(t){(t.preventSwallow=0===e.opacity.opacity,t.touch&&e.opacity)&&(e.isDragging$=!1,Date.now()-e.touchMs$<300&&(255===e.opacity.opacity?e.opacity.opacity=0:e.opacity.opacity=255),e.touchMs$=Date.now())},e.handleTouchMove$=function(t){if(t.preventSwallow=0===e.opacity.opacity,t.touch&&e.opacity){var n=t.touch.getUIDelta();!e.isDragging$&&n.length()>10&&(e.isDragging$=!0),e.isDragging$&&e.node.setPosition(e.node.position.x+n.x,e.node.position.y+n.y)}},e.handleTouchEnd$=function(t){t.preventSwallow=0===e.opacity.opacity,t.touch&&e.opacity&&(e.isDragging$||(e.bg.enabled=!e.bg.enabled,e.isBackgroundEnabled$=e.bg.enabled),e.isDragging$=!1)},e.canDisplayStats$=function(){return ys.isDebugger()||vs.has(gs,ms.getPlayerId())},e.startUpdateStats$=function(){e.schedule(e.updateFastStats$,e.fastRefreshInterval$),e.schedule(e.updateSlowStats$,e.slowRefreshInterval$),e.schedule(e.updateMediumStats$,e.mediumRefreshInterval$),requestAnimationFrame(e.handleRequestAnimationFrame$)},e.updateFastStats$=function(){e.updateFpsRaw$(),e.updateRafTime$(),e.updateDeltaTime$()},e.updateSlowStats$=function(){e.updateDPR$(),e.updateDrawCalls$(),e.updateObjectMemoryUsage$(),e.updateTextureMemoryUsage$()},e.updateMediumStats$=function(){e.updateFps$(),e.updateLogicTime$(),e.updatePhysicTime$(),e.updateRenderTime$()},e.calcRafTime$=function(t){var n;null!==(n=e.node)&&void 0!==n&&n.isValid&&(e.rafTimeCounter$.end(t),e.lastRafTime$=t,e.handleRequestAnimationFrame$())},e.handleRequestAnimationFrame$=function(){e.rafTimeCounter$.start(e.lastRafTime$),requestAnimationFrame(e.calcRafTime$)},e.updateFps$=function(){var t=e.getFps$();e.updateFpsColor$(t),e.fpsLabel.string="FPS: ".concat(t)},e.updateFpsColor$=function(t){t<30?e.fpsLabel.color=bs:t<48?e.fpsLabel.color=ws:e.setColorWithBackground$(e.fpsLabel)},e.updateFpsRaw$=function(){var t=e.getFpsRaw$();e.updateFpsRawColor$(t),e.fpsRawLabel.string="FPS Raw: ".concat(t)},e.updateFpsRawColor$=function(t){t<30?e.fpsRawLabel.color=bs:t<48?e.fpsRawLabel.color=ws:e.setColorWithBackground$(e.fpsRawLabel)},e.updateDrawCalls$=function(){var t=e.getDrawCalls$();e.updateDrawCallsColor$(t),e.drawCountLabel.string="Draw Calls: ".concat(t)},e.updateDrawCallsColor$=function(t){var n=J.os===J.OS.IOS,i=n?60:25;t>(n?80:40)?e.drawCountLabel.color=bs:t>i?e.drawCountLabel.color=ws:e.setColorWithBackground$(e.drawCountLabel)},e.updateRafTime$=function(){var t=e.getRafTime$();e.updateRafTimeColor$(t),e.rafTimeLabel.string="RAF Time: ".concat(t,"ms")},e.updateRafTimeColor$=function(t){t>33?e.rafTimeLabel.color=bs:t>20?e.rafTimeLabel.color=ws:e.setColorWithBackground$(e.rafTimeLabel)},e.updateDeltaTime$=function(){var t=e.getDeltaTime$();e.updateDeltaTimeColor$(t),e.deltaTimeLabel.string="Delta Time: ".concat(t,"ms")},e.updateDeltaTimeColor$=function(t){t>33?e.deltaTimeLabel.color=bs:t>20?e.deltaTimeLabel.color=ws:e.setColorWithBackground$(e.deltaTimeLabel)},e.updateLogicTime$=function(){var t=e.getLogicTime$();e.updateLogicTimeColor$(t),e.logicTimeLabel.string="Logic Time: ".concat(t,"ms")},e.updateLogicTimeColor$=function(t){t>10?e.logicTimeLabel.color=bs:t>5?e.logicTimeLabel.color=ws:e.setColorWithBackground$(e.logicTimeLabel)},e.updatePhysicTime$=function(){var t=e.getPhysicTime$();e.updatePhysicTimeColor$(t),e.physicTimeLabel.string="Physic Time: ".concat(t,"ms")},e.updatePhysicTimeColor$=function(t){t>10?e.physicTimeLabel.color=bs:t>5?e.physicTimeLabel.color=ws:e.setColorWithBackground$(e.physicTimeLabel)},e.updateRenderTime$=function(){var t=e.getRenderTime$();e.updateRenderTimeColor$(t),e.renderTimeLabel.string="Render Time: ".concat(t,"ms")},e.updateRenderTimeColor$=function(t){t>10?e.renderTimeLabel.color=bs:t>5?e.renderTimeLabel.color=ws:e.setColorWithBackground$(e.renderTimeLabel)},e.updateObjectMemoryUsage$=function(){var t=e.getObjectMemoryUsage$();e.updateObjectMemoryUsageColor$(t),e.objectMemoryUsageLabel.string="Object Mem: ".concat(t,"MB")},e.updateObjectMemoryUsageColor$=function(t){t>40?e.objectMemoryUsageLabel.color=bs:t>25?e.objectMemoryUsageLabel.color=ws:e.setColorWithBackground$(e.objectMemoryUsageLabel)},e.updateTextureMemoryUsage$=function(){var t=e.getTextureMemoryUsage$();e.updateTextureMemoryUsageColor$(t),e.textureMemoryUsageLabel.string="Texture Mem: ".concat(t,"MB")},e.updateTextureMemoryUsageColor$=function(t){t>200?e.textureMemoryUsageLabel.color=bs:t>100?e.textureMemoryUsageLabel.color=ws:e.setColorWithBackground$(e.textureMemoryUsageLabel)},e.updateDPR$=function(){var t=fs.pixelRatio();e.updateDPRColor$(t),e.dprLabel.string="DPR: ".concat(t)},e.updateDPRColor$=function(t){t>2?e.dprLabel.color=bs:t<=1?e.dprLabel.color=ws:e.setColorWithBackground$(e.dprLabel)},e.setColorWithBackground$=function(t){var n=e.isBackgroundEnabled$?ks:Ss;t.color.equals(n)||(t.color=n)},e.getFps$=function(){if(!A.root)return 0;var e=A.root.fps;return Math.round(e)||0},e.getDrawCalls$=function(){return A.root&&A.root.device.numDrawCalls||0},e.toFixed$=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Number(e.toFixed(t))||0},e.getFpsRaw$=function(){return e.toFixed$(1e3/e.rafTimeCounter$.value,0)},e.getRafTime$=function(){return e.toFixed$(e.rafTimeCounter$.value)},e.getDeltaTime$=function(){return e.toFixed$(1e3*D.deltaTime)},e.getLogicTime$=function(){return e.toFixed$(e.logicTimeCounter$.value)},e.getPhysicTime$=function(){return e.toFixed$(e.physicTimeCounter$.value)},e.getRenderTime$=function(){return e.toFixed$(e.renderTimeCounter$.value)},e.getObjectMemoryUsage$=function(){if(!A.root)return 0;var t=A.root.device.memoryStatus;return e.toFixed$(t.bufferSize/1048576,4)||0},e.getTextureMemoryUsage$=function(){if(!A.root)return 0;var t=A.root.device.memoryStatus;return e.toFixed$(t.textureSize/1048576,4)||0},e.beforeUpdate$=function(){var t=performance.now();e.logicTimeCounter$.start(t)},e.afterUpdate$=function(){var t=performance.now();e.logicTimeCounter$.end(t)},e.beforePhysics$=function(){var t=performance.now();e.physicTimeCounter$.start(t)},e.afterPhysics$=function(){var t=performance.now();e.physicTimeCounter$.end(t)},e.beforeDraw$=function(){var t=performance.now();e.renderTimeCounter$.start(t)},e.afterDraw$=function(){var t=performance.now();e.renderTimeCounter$.end(t)},e}return e(s,[{key:"__preload",value:function(){this.listenInputEvents$()}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this)}},{key:"start",value:function(){this.bg.enabled=!1,this.canDisplayStats$()?(this.node.active=!0,this.rafTimeCounter$=new ls,this.logicTimeCounter$=new ls,this.physicTimeCounter$=new ls,this.renderTimeCounter$=new ls,A.on(Z.EVENT_BEFORE_UPDATE,this.beforeUpdate$,this),A.on(Z.EVENT_AFTER_UPDATE,this.afterUpdate$,this),A.on(Z.EVENT_BEFORE_PHYSICS,this.beforePhysics$,this),A.on(Z.EVENT_AFTER_PHYSICS,this.afterPhysics$,this),A.on(Z.EVENT_BEFORE_DRAW,this.beforeDraw$,this),A.on(Z.EVENT_AFTER_DRAW,this.afterDraw$,this),this.startUpdateStats$()):this.node.active=!1}},{key:"onDestroy",value:function(){this.canDisplayStats$()&&(A.off(Z.EVENT_BEFORE_UPDATE,this.beforeUpdate$,this),A.off(Z.EVENT_AFTER_UPDATE,this.afterUpdate$,this),A.off(Z.EVENT_BEFORE_PHYSICS,this.beforePhysics$,this),A.off(Z.EVENT_AFTER_PHYSICS,this.afterPhysics$,this),A.off(Z.EVENT_BEFORE_DRAW,this.beforeDraw$,this),A.off(Z.EVENT_AFTER_DRAW,this.afterDraw$,this),this.unschedule(this.updateSlowStats$),this.unschedule(this.updateFastStats$),this.unschedule(this.updateMediumStats$),this.node.off(H.EventType.TOUCH_START,this.handleTouchStart$),this.node.off(H.EventType.TOUCH_MOVE,this.handleTouchMove$),this.node.off(H.EventType.TOUCH_END,this.handleTouchEnd$),this.node.off(H.EventType.TOUCH_CANCEL,this.handleTouchEnd$))}}]),s}(T)).prototype,"dprLabel",[wl,Sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yl=a(Kl.prototype,"fpsLabel",[kl,Cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xl=a(Kl.prototype,"fpsRawLabel",[El,Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jl=a(Kl.prototype,"drawCountLabel",[Tl,Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zl=a(Kl.prototype,"rafTimeLabel",[Ol,Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ql=a(Kl.prototype,"deltaTimeLabel",[Il,Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),es=a(Kl.prototype,"logicTimeLabel",[_l,Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ts=a(Kl.prototype,"physicTimeLabel",[Ml,Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ns=a(Kl.prototype,"renderTimeLabel",[Bl,Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),is=a(Kl.prototype,"objectMemoryUsageLabel",[xl,zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),as=a(Kl.prototype,"textureMemoryUsageLabel",[Ul,Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),os=a(Kl.prototype,"bg",[Hl,ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rs=a(Kl.prototype,"opacity",[Vl,$l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=Kl))||Wl)||Wl);S._RF.pop(),S._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var Cs,Es=function(e){return e.CHALLENGE_FRIENDS="challenge-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.UPDATE_MUSIC="update-music",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.REFRESH_ITEMS="refresh-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ABORT_COIN_ANIMATION="abort-coin-animation",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.TIME_UPDATED="time-updated",e.APPLY_GRAVITY="apply-gravity",e.GRID_ORIENTATION_CHANGE="grid-orientation-change",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_SPAWN="grid-spawn",e.GRID_CREATE="grid-create",e.GRID_RESIZE="grid-resize",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.COMBO_PROGRESS="combo-progress",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e.ITEM_MASK_CLICKED="item-mask-clicked",e.EFFECTS_ANIMATION_START="effects-start",e.EFFECTS_ANIMATION_END="effects-end",e}(Es||{});S._RF.pop(),S._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var As,Ts,Ps,Os,Ls,Is,Rs,_s,Ds,Ms,Ns,Bs,Fs,xs,zs,Us,Gs,Hs,qs=(0,C.ccclass)("PanelAnimationController")(Cs=function(a){n(l,a);var r=i(l);function l(){var e;t(this,l);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=r.call.apply(r,[this].concat(i))).animators=new Set,e.eventTarget=new Q,e.handleRegistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)&&console.warn("Animator already registered."),e.animators.add(t)},e.handleUnregistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)||console.warn("Animator not registered."),e.animators.delete(t)},e.handleShowUIs=function(){var t=o((function*(t){var n,i,a,o=!1,r=[],l=u(e.animators);try{for(l.s();!(a=l.n()).done;){var s=a.value;r.push(s)}}catch(e){l.e(e)}finally{l.f()}for(var c=[],d=0,h=r;d<h.length;d++){var p,y=h[d];if(!y.isReadyForAnimation()&&!o)o=!0,null==t||null===(p=t.fallback)||void 0===p||p.call(t);c.push(y.handleShowUI())}yield Promise.all(c),null==t||null===(n=t.onComplete)||void 0===n||n.call(t),null===(i=e.eventTarget)||void 0===i||i.emit(Es.SHOW_UI)}));return function(e){return t.apply(this,arguments)}}(),e.handleHideUIs=function(){var t=o((function*(t){var n,i,a,o=!1,r=[],l=u(e.animators);try{for(l.s();!(a=l.n()).done;){var s=a.value;r.push(s)}}catch(e){l.e(e)}finally{l.f()}for(var c=[],d=0,h=r;d<h.length;d++){var p,y=h[d];if(!y.isReadyForAnimation()&&!o)o=!0,null==t||null===(p=t.fallback)||void 0===p||p.call(t);c.push(y.handleHideUI())}yield Promise.all(c),null==t||null===(n=t.onComplete)||void 0===n||n.call(t),null===(i=e.eventTarget)||void 0===i||i.emit(Es.HIDE_UI)}));return function(e){return t.apply(this,arguments)}}(),e}return e(l,[{key:"onEnable",value:function(){this.node.scene.on(Es.SHOW_UI,this.handleShowUIs,this),this.node.scene.on(Es.HIDE_UI,this.handleHideUIs,this)}},{key:"onDisable",value:function(){this.node.scene.off(Es.SHOW_UI,this.handleShowUIs,this),this.node.scene.off(Es.HIDE_UI,this.handleHideUIs,this)}},{key:"showUI",value:function(){return this.handleShowUIs()}},{key:"hideUI",value:function(){return this.handleHideUIs()}},{key:"on",value:function(e,t,n,i){this.eventTarget.on(e,t,n,i)}},{key:"off",value:function(e,t,n){this.eventTarget.off(e,t,n)}}],[{key:"getController",value:function(e){for(var t=null,n=e;null!==n;){if(t=n.getComponent(l))return t;n=n.parent}return t}},{key:"registerAnimator",value:function(e){var t=this.getController(e.node);t?t.handleRegistration(e):console.warn("No PanelAnimationController found for animator ".concat(e.node.name))}},{key:"unregisterAnimator",value:function(e){var t=this.getController(e.node);t?t.handleUnregistration(e):console.warn("No PanelAnimationController found for animator ".concat(e.node.name))}}]),l}(T))||Cs;S._RF.pop(),S._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var Vs,$s=C.ccclass,Ws=C.property,Ks=Ludex.Utils.Object,js=(As=$s("AnimationConfig"),Ts=Ws({type:[I]}),As((Ls=a((Os=function(){function n(){t(this,n),r(this,"startHidden",Ls,this),r(this,"nodes",Is,this),r(this,"posOffset",Rs,this),r(this,"showEase",_s,this),r(this,"hideEase",Ds,this),r(this,"showDuration",Ms,this),r(this,"hideDuration",Ns,this)}return e(n,[{key:"setConfig",value:function(e){e&&Ks.assign(this,e)}}]),n}()).prototype,"startHidden",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Is=a(Os.prototype,"nodes",[Ts],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rs=a(Os.prototype,"posOffset",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_s=a(Os.prototype,"showEase",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),Ds=a(Os.prototype,"hideEase",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),Ms=a(Os.prototype,"showDuration",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ns=a(Os.prototype,"hideDuration",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ps=Os))||Ps),Ys=(Bs=$s("PanelAnimator"),Fs=Ws({type:js,displayName:"Top animation nodes"}),xs=Ws({type:js,displayName:"Bottom animation nodes"}),Bs((Gs=a((Us=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"topConfig",Gs,l(e)),r(e,"botConfig",Hs,l(e)),e.isReady=!1,e}return e(d,[{key:"onEnable",value:function(){qs.registerAnimator(this)}},{key:"onDisable",value:function(){qs.unregisterAnimator(this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(u=o((function*(){if(this.isReady)return Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]);console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"))})),function(){return u.apply(this,arguments)})},{key:"handleHideUI",value:(s=o((function*(){if(this.isReady)return Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]);console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"))})),function(){return s.apply(this,arguments)})},{key:"createAnimator",value:function(e,t){var n=e.nodes,i=e.posOffset,a=e.showEase,r=e.hideEase,l=e.showDuration,s=e.hideDuration,u=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y}})),c=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top+i}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom-i}:{mode:"position",value:e.node.position.y+i}})),h="shown",p=new In;return{switchState:function(){var e=o((function*(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];p.abort();var i=new In;if(p=i,h!==e){h=e;var o="hidden"===e?u:c,y="hidden"===e?c:u,v="hidden"===e?s:l,f="hidden"===e?r:a,g=function(){for(var e=0,t=n.length;e<t;e++){var i=n[e],a=o[e],r=y[e].value;d.setToTargetImmediately(i,a,r)}};t?g():(i.addAbortListener(g),yield Promise.all(n.map((function(e,t){var n=o[t],a=y[t].value;return Ve.runTweenAsync(d.getTween({widget:e,config:n,target:a,easing:f,duration:v}),i)}))),i.aborted||i.removeAbortListener(g))}}));return function(t){return e.apply(this,arguments)}}()}}},{key:"setAnimator",value:function(e){var t=e.topConfig,n=e.botConfig,i=new js,a=new js;i.setConfig(t),a.setConfig(n),this.topConfig=i,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(e){var t=e.widget,n=e.config,i=e.target,a=e.easing,o=e.duration;return"top"===n.mode?R(t).call((function(){t.top=n.value})).to(o,{top:i},{easing:a}):"bottom"===n.mode?R(t).call((function(){t.bottom=n.value})).to(o,{bottom:i},{easing:a}):R(t.node.position).call((function(){t.node.setPosition(t.node.position.x,n.value,t.node.position.z)})).to(o,{y:i},{easing:a})}},{key:"setToTargetImmediately",value:function(e,t,n){"top"===t.mode&&(e.top=n),"bottom"===t.mode&&(e.bottom=n);var i=e.node.position.x,a=n,o=e.node.position.z;e.node.setPosition(i,a,o)}}]),d}(T)).prototype,"topConfig",[Fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new js}}),Hs=a(Us.prototype,"botConfig",[xs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new js}}),zs=Us))||zs);S._RF.pop(),S._RF.push({},"21a9aAlkBtGxKLqip8g0o6l","ParticleSystem2DExtra",void 0);var Xs,Js=C.ccclass,Zs=C.disallowMultiple,Qs=C.executeInEditMode,eu=C.requireComponent,tu=Js("ParticleSystem2DExtra")(Vs=Qs(!0)(Vs=Zs(!0)(Vs=eu(ee)(Vs=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i))).emitParticle=function(t){return function(n){t(n);var i=e.particleSystem._simulator.particles.length,a=e.particleSystem._simulator.particles[i-1];e.initParticle(a)}},e.step=function(t){return function(n){for(var i=e.particleSystem._simulator.particles,a=0;a<i.length;a++){var o=i[a];e.updateParticle(o,n)}t(n)}},e}return e(r,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(ee),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var e=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(e);var t=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(t)}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}}]),r}(T))||Vs)||Vs)||Vs)||Vs;S._RF.pop(),S._RF.push({},"9a5a3MgLaRAKbHluGCPsA8j","ExampleParticleSystem2DExtra",void 0);var nu,iu,au,ou,ru,lu,su,uu,cu,du,hu,pu,yu,vu;(0,C.ccclass)("ExampleParticleSystem2DExtra")(Xs=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"initParticle",value:function(e){e.maxSize=te.randomRange(.25,1)*e.size,e.size=0,e.deltaSize=0,e.cycleDuration=te.randomRange(.4,.6),e.life=e.timeToLive,this.setInitPosition(e.pos)}},{key:"updateParticle",value:function(e,t){this.updateScale(e)}},{key:"setInitPosition",value:function(e){var t=e.x,n=e.y;return e.x=t+te.randomRange(-350,350),e.y=n+te.randomRange(-350,350),e}},{key:"updateScale",value:function(e){var t=1-(e.life-e.timeToLive)%e.cycleDuration/e.cycleDuration;e.size=e.maxSize*Math.sin(t*Math.PI)}}]),r}(tu));S._RF.pop(),S._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var fu,gu,mu,bu,wu,Su,ku,Cu,Eu,Au,Tu,Pu,Ou=C.ccclass,Lu=C.requireComponent,Iu=C.property,Ru=codex,_u=Ru.ads,Du=Ru.event,Mu=Ludex,Nu=Mu.Events,Bu=Mu.Plugins.Ads,Fu=void 0===Bu?{}:Bu,xu=Fu.Types,zu=Fu.Status,Uu=Mu.Utils,Gu=Uu.Array,Hu=Uu.Function,qu=Uu.Device,Vu=["top","topleft","topright"],$u=["bottom","bottomleft","bottomright"],Wu=["left","topleft","bottomleft"],Ku=["right","topright","bottomright"];nu=Ou("ResizeWithBannerAd"),iu=Lu(I),au=Iu(W),ou=Iu(W),ru=Iu(W),lu=Iu(W),su=Iu(W),nu(uu=iu((du=a((cu=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"includeSAB",du,l(e)),r(e,"includeRightBanner",hu,l(e)),r(e,"includeBottomBanner",pu,l(e)),r(e,"includeLeftBanner",yu,l(e)),r(e,"closeWhenAdFailed",vu,l(e)),e.handleOnAdShowing=function(t){var n=t.placementId,i=t.type;if(e.checkValid()&&n&&xu&&i===xu.BANNER){try{if(!_u.getAd(xu.BANNER,n))return}catch(e){return void console.debug("Error getting banner ad:",e)}e.resizeWhenBannerAdShow(n),e.emitResizeEvent()}},e.handleOnAdClosed=function(t){var n=t.placementId,i=t.type;if(e.checkValid()&&n&&xu&&i===xu.BANNER){try{if(!_u.getAd(xu.BANNER,n))return}catch(e){return void console.debug("Error getting banner ad:",e)}e.resizeWhenBannerAdClose(n),e.emitResizeEvent()}},e.handleOnAdFailed=function(t){var n=t.placementId,i=t.type;e.closeWhenAdFailed&&e.checkValid()&&n&&xu&&i===xu.BANNER&&(e.resizeWhenBannerAdClose(n),e.emitResizeEvent())},e.handleOnResize=function(){if(e.checkValid()&&xu&&zu){var t=_u.getAdsByType(xu.BANNER);0!==t.length?t.forEach((function(t){var n=_u.getAdStatus(xu.BANNER,t.placementId);n&&(n===zu.SHOWING||qu.isIOS()?e.resizeWhenBannerAdShow(t.placementId):n===zu.IDLE&&e.resizeWhenBannerAdClose(t.placementId))})):e.resizeSafeAreaBottom()}},e.resizeWhenBannerAdShow=function(t){var n,i,a,o,r=We.cssSizeToWorldSize(1),l=_u.getBannerConfig(t),s=l.PlacementId,u=l.BannerWidth,c=l.Position;if("top"===c)n=_u.getBannerHeight(s,r);else if("bottom"===c)e.includeBottomBanner?i=_u.getBannerHeight(s,r,e.includeSAB):e.includeSAB&&(i=_u.getSafeAreaBottom(r));else if("left"===c||"right"===c){if(void 0===u)return;var d=u;"getBannerOffset"in GameSDK.extra&&(d+=GameSDK.extra.getBannerOffset()),"left"===c&&e.includeLeftBanner?a=d*r:"right"===c&&e.includeRightBanner&&(o=d*r)}e.updateWidgets({top:n,bottom:i,left:a,right:o})},e.resizeWhenBannerAdClose=function(t){var n=_u.getBannerConfig(t).Position,i=We.cssSizeToWorldSize(1),a=e.includeSAB?_u.getSafeAreaBottom(i):0;e.updateWidgets({top:Gu.has(Vu,n)?0:void 0,bottom:Gu.has($u,n)?a:void 0,left:Gu.has(Wu,n)?0:void 0,right:Gu.has(Ku,n)?0:void 0})},e.resizeSafeAreaBottom=function(){var t=We.cssSizeToWorldSize(1),n=e.includeSAB?_u.getSafeAreaBottom(t):0;e.updateWidgets({bottom:n})},e.emitResizeEvent=Hu.debounce((function(){D.emit($e.WIDGET_RESIZED)}),100),e}return e(s,[{key:"__preload",value:function(){this.widget=this.getComponent(I),Ni.lazyValidateProperties(this),Du.on(Nu.AD_SHOWING,this.handleOnAdShowing),Du.on(Nu.AD_CLOSED,this.handleOnAdClosed),Du.on(Nu.AD_SHOW_FAILED,this.handleOnAdFailed),D.on($e.VIEW_RESIZED,this.handleOnResize)}},{key:"onDestroy",value:function(){Du.off(Nu.AD_SHOWING,this.handleOnAdShowing),Du.off(Nu.AD_CLOSED,this.handleOnAdClosed),Du.off(Nu.AD_SHOW_FAILED,this.handleOnAdFailed),D.off($e.VIEW_RESIZED,this.handleOnResize)}},{key:"start",value:function(){this.handleOnResize()}},{key:"updateWidgets",value:function(e){var t=e.top,n=e.bottom,i=e.left,a=e.right;this.widget.top=null!=t?t:this.widget.top,this.widget.bottom=null!=n?n:this.widget.bottom,this.widget.left=null!=i?i:this.widget.left,this.widget.right=null!=a?a:this.widget.right,ne.instance.emit("canvas-resize")}},{key:"checkValid",value:function(){return this.node.activeInHierarchy&&null!==this.node.parent&&void 0!==this.node.parent}}]),s}(T)).prototype,"includeSAB",[au],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),hu=a(cu.prototype,"includeRightBanner",[ou],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pu=a(cu.prototype,"includeBottomBanner",[ru],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),yu=a(cu.prototype,"includeLeftBanner",[lu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),vu=a(cu.prototype,"closeWhenAdFailed",[su],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),uu=cu))||uu);S._RF.pop(),S._RF.push({},"3825fBvhGRPUK6d/ohif+v0","PreloadSprite",void 0);var ju=C.ccclass,Yu=C.property,Xu=C.requireComponent,Ju=Ke.Layout,Zu=function(e){return e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape",e}(Zu||{}),Qu=[Ju.Portrait,Ju.Landscape];M(Zu);var ec,tc,nc,ic,ac,oc,rc,lc,sc,uc,cc;fu=ju("PreloadSprite"),gu=Xu(F),mu=Yu({type:Zu}),bu=Yu({type:Xe}),wu=Yu({type:W}),Su=Ni.required,fu(ku=gu((Eu=a((Cu=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"layout",Eu,l(e)),r(e,"path",Au,l(e)),r(e,"packable",Tu,l(e)),r(e,"sprite",Pu,l(e)),e}return e(c,[{key:"__preload",value:function(){this.sprite=this.getComponent(F),Ni.validateRequiredProperties(this,c),D.on($e.ORIENTATION_CHANGED,this.loadSpriteFrame,this),this.loadSpriteFrame()}},{key:"onDestroy",value:function(){D.off($e.ORIENTATION_CHANGED,this.loadSpriteFrame,this)}},{key:"loadSpriteFrame",value:(s=o((function*(){if(this.sprite.spriteFrame)this.unlistenEvent();else if(Je.getCurrentLayout()===Qu[this.layout]&&this.path){var e="".concat(Ze[this.path],"/spriteFrame");if(e){var t=yield qe.loadSpriteFrameAsync(e,this.packable);this.enabledInHierarchy&&!this.sprite.spriteFrame?(this.sprite.spriteFrame=t,this.unlistenEvent()):this.unlistenEvent()}}})),function(){return s.apply(this,arguments)})},{key:"unlistenEvent",value:function(){D.off($e.ORIENTATION_CHANGED,this.loadSpriteFrame,this)}}]),c}(T)).prototype,"layout",[mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Au=a(Cu.prototype,"path",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Tu=a(Cu.prototype,"packable",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pu=a(Cu.prototype,"sprite",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ku=Cu))||ku);S._RF.pop(),S._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var dc,hc,pc,yc,vc,fc,gc,mc=C.ccclass,bc=C.property,wc=C.executeInEditMode,Sc=C.requireComponent,kc=(ec=mc("TapperedProgressBar"),tc=Sc(B),nc=bc({type:B,displayName:"Fill opacity"}),ic=bc({type:F,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),ac=bc({type:F,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),oc=bc({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),ec(rc=wc(rc=tc((sc=a((lc=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"uiOpacity",sc,l(e)),r(e,"leftCap",uc,l(e)),r(e,"rightCap",cc,l(e)),e}return e(s,[{key:"progress",get:function(){return c(d(s.prototype),"progress",this)},set:function(e){y(d(s.prototype),"progress",e,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity)if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}}},{key:"start",value:function(){this.updateAppearance()}}]),s}(ie)).prototype,"uiOpacity",[nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uc=a(lc.prototype,"leftCap",[ic],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cc=a(lc.prototype,"rightCap",[ac],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a(lc.prototype,"progress",[oc],Object.getOwnPropertyDescriptor(lc.prototype,"progress"),lc.prototype),rc=lc))||rc)||rc)||rc);S._RF.pop(),S._RF.push({},"aa60frMJLtIlJZh2yJhMp1s","DynamicLabel",void 0);var Cc,Ec,Ac,Tc,Pc,Oc,Lc,Ic,Rc,_c,Dc,Mc,Nc,Bc,Fc,xc,zc,Uc,Gc,Hc,qc,Vc,$c,Wc,Kc,jc,Yc,Xc,Jc,Zc,Qc,ed,td,nd,id,ad,od,rd,ld,sd,ud=C.ccclass,cd=C.property,dd=C.executeInEditMode,hd=C.requireComponent;dc=ud("DynamicLabel"),hc=hd(K),pc=dd(!0),yc=cd({type:L,min:1,max:200}),vc=cd({type:L,min:.1,max:4}),dc(fc=hc(fc=pc((a((gc=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i)))._quality=1,e._size=1,e._outlineWidth=0,e._shadowOffset=new ae(0,0),e}return e(r,[{key:"size",get:function(){return this._size},set:function(e){this._size=e,this.label.fontSize=this.size*this.quality}},{key:"quality",get:function(){return this._quality},set:function(e){this._quality=e,this.node.scale=new V(1/this.quality,1/this.quality,1),this.label.fontSize=this.size*this.quality,this.label.outlineWidth=this._outlineWidth*this.quality,this.label.shadowOffset=this._shadowOffset.multiplyScalar(this.quality)}},{key:"__preload",value:function(){this.label=this.getComponent(K)}},{key:"start",value:function(){this._quality=1/this.node.scale.x,this._size=this.label.fontSize/this.quality,this._outlineWidth=this.label.outlineWidth,this._shadowOffset=this.label.shadowOffset,this.quality=window.devicePixelRatio,console.info(" ".concat(this.node.name,"<Label> quality:"),this.quality)}}]),r}(T)).prototype,"size",[yc],Object.getOwnPropertyDescriptor(gc.prototype,"size"),gc.prototype),a(gc.prototype,"quality",[vc],Object.getOwnPropertyDescriptor(gc.prototype,"quality"),gc.prototype),fc=gc))||fc)||fc);S._RF.pop(),S._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var pd=C.ccclass,yd=C.property,vd=C.executeInEditMode,fd=C.disallowMultiple,gd=Ludex,md=gd.Utils,bd=md.Signal,wd=(md.Function,md.Array),Sd=gd.Events,kd=codex,Cd=kd.language,Ed=kd.event,Ad=function(e){return e[e.Text=0]="Text",e[e.Texture=1]="Texture",e}({});M(Ad);var Td,Pd,Od,Ld,Id,Rd,_d,Dd,Md,Nd,Bd,Fd,xd,zd,Ud,Gd,Hd,qd,Vd,$d="localize-params-updated",Wd=(Cc=pd("LocalizeParams"),Ec=yd({visible:!1}),Ac=yd(E),Cc((Oc=a((Pc=function(){function n(){t(this,n),r(this,"_text",Oc,this)}return e(n,[{key:"text",get:function(){return this._text},set:function(e){this._text=e,D.emit($d,{text:e,param:this})}}]),n}()).prototype,"_text",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),a(Pc.prototype,"text",[Ac],Object.getOwnPropertyDescriptor(Pc.prototype,"text"),Pc.prototype),Tc=Pc))||Tc),Kd=(Lc=pd("Localize"),Ic=vd(!0),Rc=yd({visible:!1}),_c=yd({type:E,visible:function(){return this.l10nType===Ad.Texture}}),Dc=yd({visible:!1}),Mc=yd({type:x(Ad)}),Nc=yd({type:K,visible:function(){return this.l10nType===Ad.Text}}),Bc=yd({visible:function(){return this.l10nType===Ad.Text}}),Fc=yd({type:[Wd],visible:function(){return this.l10nType===Ad.Text}}),xc=yd({type:F,visible:function(){return this.l10nType===Ad.Texture}}),zc=yd({visible:function(){return this.l10nType===Ad.Texture}}),Uc=yd({visible:!1}),Gc=yd({type:E}),Hc=Ni.onlyRunInLifeCycleAsync,qc=Ni.onlyRunInLifeCycleAsync,Vc=Ni.onlyRunInLifeCycleAsync,$c=Ni.onlyRunInLifeCycleAsync,Wc=Ni.onlyRunInLifeCycle,Kc=Ni.onlyRunInLifeCycleAsync,jc=Ni.onlyRunInLifeCycleAsync,Yc=Ni.onlyRunInLifeCycleAsync,Xc=Ni.onlyRunInLifeCycleAsync,Jc=Ni.onlyRunInLifeCycle,Zc=Ni.onlyRunInLifeCycleAsync,Lc(Qc=fd(Qc=Ic((td=a((ed=function(a){n(k,a);var s,u,c,d,h,p,y,v,g,m,b,w,S=i(k);function k(){var e;t(this,k);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=S.call.apply(S,[this].concat(i))).localized=!1,r(e,"_defaultLocale",td,l(e)),r(e,"_l10nType",nd,l(e)),r(e,"label",id,l(e)),r(e,"updateFont",ad,l(e)),r(e,"params",od,l(e)),r(e,"sprite",rd,l(e)),r(e,"packable",ld,l(e)),r(e,"_key",sd,l(e)),e.updateSignalController=new bd.SignalController,e.onLocalizeParamsUpdated=function(t){var n=t.param;wd.has(e.params,n)&&e.updateLocalization()},e.updateLocalization=function(){return e.updateLocalizationComp()},e}return e(k,[{key:"defaultLocale",get:function(){return this._defaultLocale},set:function(e){!function(e){return wd.has(Qe,e)}(e)?console.warn("Key ".concat(e," not found. Supported locales are ").concat(Qe.join(", "))):this._defaultLocale=e}},{key:"l10nType",get:function(){return this._l10nType},set:function(e){this._l10nType=e,e===Ad.Texture&&(this.label=void 0,this.params=[]),e===Ad.Text&&(this.sprite=void 0,this.packable=!0)}},{key:"key",get:function(){return this._key},set:function(e){try{if(!this.isValidKey(e))return void console.warn("Key ".concat(e," not found in locales"));this._key=e,this.updateLocalization()}catch(e){console.warn(e)}}},{key:"setParams",value:function(e){for(;this.params.length<e.length;)this.params.push(new Wd);for(var t=0,n=this.params.length;t<n;t++){var i,a=this.params[t];a.text=null!==(i=e[t])&&void 0!==i?i:a.text}}},{key:"waitUntilLocalized",value:function(){var e=this;return this.localized?Promise.resolve():new Promise((function(t){return e.node.once($e.LOCALIZE_APPLIED,t)}))}},{key:"__preload",value:function(){}},{key:"isValidKey",value:function(e){return!!this.isTextKey(e)||!!this.isTextureKey(e)}},{key:"isTextKey",value:function(e){try{return this.l10nType===Ad.Text&&Cd.hasTextKey(e)}catch(e){return console.warn(e),!1}}},{key:"isTextureKey",value:function(e){try{return this.l10nType===Ad.Texture&&Cd.hasTextureKey(e)}catch(e){return console.warn(e),!1}}},{key:"onEnable",value:function(){this.listenEvent()}},{key:"onDisable",value:function(){this.unlistenEvent(),this.updateSignalController.abort()}},{key:"start",value:function(){this.initLocalization()}},{key:"listenEvent",value:function(){Ed.on(Sd.LANGUAGE_CHANGED,this.updateLocalization),D.on($d,this.onLocalizeParamsUpdated)}},{key:"unlistenEvent",value:function(){Ed.off(Sd.LANGUAGE_CHANGED,this.updateLocalization),D.off($d,this.onLocalizeParamsUpdated)}},{key:"initLocalization",value:function(){return this.updateLocalizationComp(!0)}},{key:"updateLocalizationComp",value:(w=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.enabledInHierarchy&&void 0!==this.key){var t=this.updateSignalController.renew();try{if(this.localized=!1,this.isTextKey(this.key))yield this.updateTextLocalization(this.key,t);else{if(!this.isTextureKey(this.key))throw new Error("Key ".concat(this.key," not found in locales"));var n=Cd.getCurrentLocale(),i=!f&&e&&n===this.defaultLocale;i||(yield this.updateTextureLocalization(this.key,t))}if(t.aborted)return;this.localized=!0,D.emit($e.LOCALIZE_APPLIED,{localize:this,key:this.key}),this.node.emit($e.LOCALIZE_APPLIED,{localize:this,key:this.key})}catch(e){console.warn(e)}}})),function(){return w.apply(this,arguments)})},{key:"updateTextLocalization",value:(b=o((function*(e,t){var n,i,a=this,o=Cd.getCurrentLocale(),r=Cd.getText(e,this.params.map((function(e){return e.text})),o),l=this.label;if(void 0===l)throw new Error("Text localize component <".concat(this.node.name,"> has no label"));null===(n=t.wrap((function(){return a.setText(l,r)})))||void 0===n||n(),this.updateFont&&(yield null===(i=t.wrap((function(){return a.setTextFont(l,o,t)})))||void 0===i?void 0:i())})),function(e,t){return b.apply(this,arguments)})},{key:"setText",value:(m=o((function*(e,t){e.string=t})),function(e,t){return m.apply(this,arguments)})},{key:"setTextFont",value:(g=o((function*(e,t,n){yield this.setTextFontRuntime(e,t,n)})),function(e,t,n){return g.apply(this,arguments)})},{key:"setTextFontRuntime",value:(v=o((function*(e,t,n){var i=yield qe.loadFontAsync(t);n.aborted||null!==i&&this.setLabelFontInLifeCycle(e,i)})),function(e,t,n){return v.apply(this,arguments)})},{key:"setLabelFontInLifeCycle",value:function(e,t){e.font=t}},{key:"setTextFontEditor",value:(y=o((function*(e,t,n){var i,a,o=this,r=yield this.requestFontUuid(t);if(null!==r){var l=yield null===(i=n.wrap((function(){return o.requestNodeInfo(e.node.uuid)})))||void 0===i?void 0:i();if(void 0!==l){var s=wd.searchIndex(l.__comps__,(function(e){return"cc.Label"===e.type})),u="__comps__.".concat(s,".font");yield null===(a=n.wrap((function(){return o.requestUpdateLabelFont(e.node.uuid,u,r)})))||void 0===a?void 0:a()}}})),function(e,t,n){return y.apply(this,arguments)})},{key:"requestFontUuid",value:(p=o((function*(e){return yield Editor.Message.request("asset-db","query-uuid","db://assets/loadable/".concat(et[e]))})),function(e){return p.apply(this,arguments)})},{key:"requestNodeInfo",value:function(e){return Editor.Message.request("scene","query-node",e)}},{key:"requestUpdateLabelFont",value:(h=o((function*(e,t,n){yield Editor.Message.request("scene","set-property",{uuid:e,path:t,dump:{type:"cc.Font",value:{uuid:n}}})})),function(e,t,n){return h.apply(this,arguments)})},{key:"updateTextureLocalization",value:(d=o((function*(e,t){if(void 0===this.sprite)throw new Error("Texture localize component <".concat(this.node.name,"> has no sprite"));var n=Cd.getTexture(e);yield this.setSpriteRuntime(this.sprite,n,t)})),function(e,t){return d.apply(this,arguments)})},{key:"setSpriteRuntime",value:(c=o((function*(e,t,n){var i=yield qe.loadSpriteFrameAsync("".concat(t,"/spriteFrame"),this.packable);n.aborted||(null!==i?this.setSprite(e,i):console.warn("Sprite not found by path: ".concat(t)))})),function(e,t,n){return c.apply(this,arguments)})},{key:"setSprite",value:function(e,t){e.spriteFrame=t}},{key:"setSpriteEditor",value:(u=o((function*(e,t,n){var i,a,o=this,r=yield this.requestSpriteFrameInfo(t);if(0!==r.length)if(r.length>1){var l=r.slice(0,5).map((function(e){return e.path})),s="".concat(l.join(",")).concat(l.length<r.length?"...":"");console.warn("Ambiguous sprite's path: ".concat(t,". Found ").concat(s))}else{var u=yield null===(i=n.wrap((function(){return o.requestNodeInfo(e.node.uuid)})))||void 0===i?void 0:i();if(void 0!==u){var c=r[0].uuid,d=wd.searchIndex(u.__comps__,(function(e){return"cc.Sprite"===e.type})),h="__comps__.".concat(d,".spriteFrame");yield null===(a=n.wrap((function(){return o.requestUpdateSpriteSpriteFrame(e.node.uuid,h,c)})))||void 0===a?void 0:a()}}else console.error("Sprite not found by path: ".concat(t))})),function(e,t,n){return u.apply(this,arguments)})},{key:"requestSpriteFrameInfo",value:function(e){return Editor.Message.request("asset-db","query-assets",{pattern:"db://assets/loadable/".concat(e,"*"),ccType:"cc.SpriteFrame"})}},{key:"requestUpdateSpriteSpriteFrame",value:(s=o((function*(e,t,n){yield Editor.Message.request("scene","set-property",{uuid:e,path:t,dump:{type:"cc.SpriteFrame",value:{uuid:n}}})})),function(e,t,n){return s.apply(this,arguments)})}]),k}(T)).prototype,"_defaultLocale",[Rc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"en"}}),a(ed.prototype,"defaultLocale",[_c],Object.getOwnPropertyDescriptor(ed.prototype,"defaultLocale"),ed.prototype),nd=a(ed.prototype,"_l10nType",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ad.Text}}),a(ed.prototype,"l10nType",[Mc],Object.getOwnPropertyDescriptor(ed.prototype,"l10nType"),ed.prototype),id=a(ed.prototype,"label",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=a(ed.prototype,"updateFont",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),od=a(ed.prototype,"params",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rd=a(ed.prototype,"sprite",[xc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ld=a(ed.prototype,"packable",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sd=a(ed.prototype,"_key",[Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(ed.prototype,"key",[Gc],Object.getOwnPropertyDescriptor(ed.prototype,"key"),ed.prototype),a(ed.prototype,"updateTextLocalization",[Hc],Object.getOwnPropertyDescriptor(ed.prototype,"updateTextLocalization"),ed.prototype),a(ed.prototype,"setText",[qc],Object.getOwnPropertyDescriptor(ed.prototype,"setText"),ed.prototype),a(ed.prototype,"setTextFont",[Vc],Object.getOwnPropertyDescriptor(ed.prototype,"setTextFont"),ed.prototype),a(ed.prototype,"setTextFontRuntime",[$c],Object.getOwnPropertyDescriptor(ed.prototype,"setTextFontRuntime"),ed.prototype),a(ed.prototype,"setLabelFontInLifeCycle",[Wc],Object.getOwnPropertyDescriptor(ed.prototype,"setLabelFontInLifeCycle"),ed.prototype),a(ed.prototype,"setTextFontEditor",[Kc],Object.getOwnPropertyDescriptor(ed.prototype,"setTextFontEditor"),ed.prototype),a(ed.prototype,"requestUpdateLabelFont",[jc],Object.getOwnPropertyDescriptor(ed.prototype,"requestUpdateLabelFont"),ed.prototype),a(ed.prototype,"updateTextureLocalization",[Yc],Object.getOwnPropertyDescriptor(ed.prototype,"updateTextureLocalization"),ed.prototype),a(ed.prototype,"setSpriteRuntime",[Xc],Object.getOwnPropertyDescriptor(ed.prototype,"setSpriteRuntime"),ed.prototype),a(ed.prototype,"setSprite",[Jc],Object.getOwnPropertyDescriptor(ed.prototype,"setSprite"),ed.prototype),a(ed.prototype,"setSpriteEditor",[Zc],Object.getOwnPropertyDescriptor(ed.prototype,"setSpriteEditor"),ed.prototype),Qc=ed))||Qc)||Qc)||Qc);S._RF.pop(),S._RF.push({},"060a722v8VBE68QPm8fKcyQ","LocalizePreloader",void 0);var jd,Yd,Xd,Jd,Zd,Qd,eh,th,nh,ih,ah,oh,rh,lh,sh,uh,ch=C.ccclass,dh=C.property,hh=Ludex.Utils,ph=hh.Array,yh=hh.Valid,vh=codex.language,fh=(Td=ch("LocalizeTextureKey"),Pd=dh({visible:!1}),Od=dh(E),Td((Rd=a((Id=function(){function n(){t(this,n),r(this,"_key",Rd,this)}return e(n,[{key:"key",get:function(){return this._key},set:function(e){vh.hasTextureKey(e)?this._key=e:console.warn("Key ".concat(e," not found in locales"))}}]),n}()).prototype,"_key",[Pd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),a(Id.prototype,"key",[Od],Object.getOwnPropertyDescriptor(Id.prototype,"key"),Id.prototype),Ld=Id))||Ld),gh=(_d=ch("SupportedLocaleKey"),Dd=dh({visible:!1}),Md=dh(E),_d((Fd=a((Bd=function(){function n(){t(this,n),r(this,"_key",Fd,this)}return e(n,[{key:"key",get:function(){return this._key},set:function(e){ph.has(Qe,e)?this._key=e:console.warn("Key ".concat(e," not found. Supported locales are ").concat(Qe.join(", ")))}}]),n}()).prototype,"_key",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),a(Bd.prototype,"key",[Md],Object.getOwnPropertyDescriptor(Bd.prototype,"key"),Bd.prototype),Nd=Bd))||Nd);xd=ch("LocalizePreloader"),zd=dh([fh]),Ud=dh({type:gh,tooltip:"Preload only for these locales"}),xd((qd=a((Hd=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"keys",qd,l(e)),r(e,"locales",Vd,l(e)),e}return e(s,[{key:"__preload",value:function(){this.preloadTextures()}},{key:"preloadTextures",value:function(){var e=vh.getCurrentLocale(),t=this.locales.map((function(e){return e.key}));if(ph.has(t,e)){var n,i=[],a=u(this.keys);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(!1!==vh.hasTextureKey(o.key)){var r=vh.getTexture(o.key),l="".concat(r,"/spriteFrame");i.push(l)}}}catch(e){a.e(e)}finally{a.f()}qe.loadSpriteFramesAsync(i)}else yh.isDebugger()&&console.info("Skipping preloading of textures because current locale is not in the list of preloading locales")}}]),s}(T)).prototype,"keys",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vd=a(Hd.prototype,"locales",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Gd=Hd));S._RF.pop(),S._RF.push({},"3f364xnTJtDR5yeow2MWHhm","LocalizedLayout",void 0);var mh,bh,wh,Sh,kh,Ch,Eh,Ah,Th,Ph=C.ccclass,Oh=C.property,Lh=C.executeInEditMode,Ih=C.disallowMultiple,Rh=C.requireComponent;jd=Ph("LocalizedLayout"),Yd=Lh(!0),Xd=Rh(P),Jd=Oh(Kd),Zd=Ni.required(),Qd=Oh(P),eh=Oh({visible:!1}),th=Oh({visible:!1}),nh=Oh({type:L,group:"Padding"}),ih=Oh({type:L,group:"Padding"}),jd(ah=Ih(ah=Yd(ah=Xd((rh=a((oh=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"label",rh,l(e)),r(e,"layout",lh,l(e)),r(e,"_horizontal",sh,l(e)),r(e,"_vertical",uh,l(e)),e.updateContentSize=function(){var t;if(void 0!==e.label){var n=null===(t=e.label.getComponent(P))||void 0===t?void 0:t.contentSize;if(void 0!==n){e.layout.setContentSize(n.width+e.horizontal,n.height+e.vertical);var i,a=e.node.getComponentsInChildren(I),o=u(a);try{for(o.s();!(i=o.n()).done;){i.value.updateAlignment()}}catch(e){o.e(e)}finally{o.f()}}}},e}return e(s,[{key:"horizontal",get:function(){return this._horizontal},set:function(e){this._horizontal=e,this.updateContentSize()}},{key:"vertical",get:function(){return this._vertical},set:function(e){this._vertical=e,this.updateContentSize()}},{key:"__preload",value:function(){this.layout=this.getComponent(P),Ni.validateRequiredProperties(this)}},{key:"start",value:function(){this.updateContentSize()}},{key:"onEnable",value:function(){this.listenEvent()}},{key:"onDisable",value:function(){this.unlistenEvent()}},{key:"listenEvent",value:function(){var e;null===(e=this.label)||void 0===e||e.node.on($e.LOCALIZE_APPLIED,this.updateContentSize)}},{key:"unlistenEvent",value:function(){var e;null===(e=this.label)||void 0===e||e.node.off($e.LOCALIZE_APPLIED,this.updateContentSize)}}]),s}(T)).prototype,"label",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=a(oh.prototype,"layout",[Zd,Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh=a(oh.prototype,"_horizontal",[eh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uh=a(oh.prototype,"_vertical",[th],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a(oh.prototype,"horizontal",[nh],Object.getOwnPropertyDescriptor(oh.prototype,"horizontal"),oh.prototype),a(oh.prototype,"vertical",[ih],Object.getOwnPropertyDescriptor(oh.prototype,"vertical"),oh.prototype),ah=oh))||ah)||ah)||ah);S._RF.pop(),S._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var _h,Dh,Mh,Nh,Bh,Fh,xh,zh,Uh,Gh=C.ccclass,Hh=C.property,qh=function(){function n(e,i){t(this,n);var a=null!=i?i:{response:1,dampen:1,eager:1};this.k1=n.calcK1(a),this.k2=n.calcK2(a),this.k3=n.calcK3(a),this.xp=e.clone(),this.y=e.clone(),this.yd=new ae(0,0)}return e(n,[{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=n;null===i&&(i=new ae((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);var a=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*i.x-this.y.x-this.k1*this.yd.x)/a,this.yd.y=this.yd.y+e*(t.y+this.k3*i.y-this.y.y-this.k1*this.yd.y)/a,this.y}},{key:"setDynamics",value:function(e){this.k1=n.calcK1(e),this.k2=n.calcK2(e),this.k3=n.calcK3(e)}},{key:"reset",value:function(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(e){return e.dampen/(Math.PI*e.response)}},{key:"calcK2",value:function(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}},{key:"calcK3",value:function(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}]),n}(),Vh=(mh=Gh("SODConfig"),bh=Hh({type:L,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),wh=Hh({type:L,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),Sh=Hh({type:L,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),mh((Eh=a((Ch=e((function e(){t(this,e),r(this,"response",Eh,this),r(this,"dampen",Ah,this),r(this,"eager",Th,this)}))).prototype,"response",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),Ah=a(Ch.prototype,"dampen",[wh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Th=a(Ch.prototype,"eager",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kh=Ch))||kh);S._RF.pop(),S._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var $h,Wh,Kh,jh,Yh,Xh,Jh,Zh,Qh,ep,tp,np,ip,ap,op,rp,lp,sp,up,cp,dp,hp,pp,yp,vp,fp,gp,mp,bp=C.ccclass,wp=C.property,Sp=(_h=bp("Trail"),Dh=wp({type:q,displayName:"Target"}),Mh=wp({type:Y,displayName:"Graphics"}),Nh=wp({type:[Vh],displayName:"Trail Nodes"}),_h((xh=a((Fh=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"target",xh,l(e)),r(e,"graphics",zh,l(e)),r(e,"trailNodes",Uh,l(e)),e.trailNodeInstances=[],e}return e(s,[{key:"reset",value:function(){var e,t=u(this.trailNodeInstances);try{for(t.s();!(e=t.n()).done;){e.value.reset(new ae(this.node.worldPosition.x,this.node.worldPosition.y))}}catch(e){t.e(e)}finally{t.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(e){this.graphics.clear();var t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(var n=1;n<this.trailNodeInstances.length;n++){var i=this.trailNodeInstances[n-1],a=this.trailNodeInstances[n];this.drawTrail(e,a,i.currentState.x,i.currentState.y)}}},{key:"drawTrail",value:function(e,t,n,i){var a=this.graphics;if(this.target.activeInHierarchy){var o=new ae(n,i),r=t.update(e,o),l=new V(o.x,o.y,0),s=new V(r.x,r.y,0);a.node.inverseTransformPoint(l,l),a.node.inverseTransformPoint(s,s),a.moveTo(l.x,l.y),a.lineTo(s.x,s.y),a.stroke()}}},{key:"spawnTrailNodes",value:function(){var e,t=u(this.trailNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=new ae(this.node.worldPosition.x,this.node.worldPosition.y),a=new qh(i,n);this.trailNodeInstances.push(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),s}(T)).prototype,"target",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zh=a(Fh.prototype,"graphics",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uh=a(Fh.prototype,"trailNodes",[Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bh=Fh))||Bh);S._RF.pop(),S._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var kp,Cp,Ep,Ap,Tp,Pp,Op,Lp,Ip,Rp,_p,Dp,Mp,Np,Bp,Fp,xp,zp,Up,Gp,Hp=C.ccclass,qp=C.executionOrder,Vp=C.property,$p=Ludex.Utils,Wp=$p.Decorator,Kp=$p.Array,jp="Batch By Name",Yp="Batch Label",Xp="Batch Sprite";$h=Hp("BatchNodes"),Wh=qp(99999),Kh=Vp({group:{name:jp}}),jh=Vp({type:[O],group:{name:jp}}),Yh=Vp({type:[E],group:{name:jp}}),Xh=Vp({group:{name:Yp}}),Jh=Vp({group:{name:Yp}}),Zh=Vp({group:{name:Yp}}),Qh=Vp({group:{name:Xp}}),ep=Vp({group:{name:Xp}}),tp=Vp({readonly:!0}),np=Vp({readonly:!0}),ip=Vp({readonly:!0}),ap=Wp.debounce(1e3),$h(op=Wh((lp=a((rp=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"batchByName",lp,l(e)),r(e,"depthNames",sp,l(e)),r(e,"listName",up,l(e)),r(e,"batchLabel",cp,l(e)),r(e,"depthLabel",dp,l(e)),r(e,"typeLabel",hp,l(e)),r(e,"batchSprite",pp,l(e)),r(e,"depthSprite",yp,l(e)),r(e,"batchAllNodes",vp,l(e)),r(e,"batchDepth",fp,l(e)),r(e,"checkOverlap",gp,l(e)),e.batchNode={},e.labelChildren=[],e.spriteChildren=[],e.allChildren=[],e.nameChildren=[],e.originalParents={},e.isInited=!1,r(e,"handleNodeChange",mp,l(e)),e.onAfterUpdate=function(){e.isInited&&e.hierarchyChildren()},e.onAfterRender=function(){e.isInited&&e.restoreOriginalChildren()},e}return e(s,[{key:"__preload",value:function(){this.enabled&&(A.on(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),A.on(Z.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){A.off(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),A.off(Z.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(A.on(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),A.on(Z.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(e){e.once(q.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),A.off(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),A.off(Z.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var e,t,n,i=this;null===(e=this.batchNode.node)||void 0===e||e.setSiblingIndex(0),null===(t=this.batchNode.label)||void 0===t||t.setSiblingIndex(this.depthLabel),null===(n=this.batchNode.sprite)||void 0===n||n.setSiblingIndex(this.depthSprite),this.listName.forEach((function(e,t){var n,a=i.depthNames[t];void 0!==a?null===(n=i.batchNode[e])||void 0===n||n.setSiblingIndex(a):console.warn("BatchNodes: depth is undefined",e,t,a)}))}},{key:"createGlobalNodes",value:function(e){if(this.batchAllNodes){var t=new q("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}}},{key:"createGlobalNameNodes",value:function(e){if(this.batchByName){var t,n=u(this.listName);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!this.batchNode[i]){var a=new q(i);a.active=!0,this.batchNode[i]=a,e.addChild(a)}}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createGlobalLabelNode",value:function(e){if(this.batchLabel){var t=new q("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}}},{key:"createGlobalSpriteNode",value:function(e){if(this.batchSprite){var t=new q("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}}},{key:"saveOriginalParents",value:function(){var e,t=[].concat(g(this.labelChildren),g(this.spriteChildren)),n=this.nameChildren,i=u(t);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.node.parent&&(this.handleActiveChange(a.node),this.originalParents[a.uuid]=a.node.parent)}}catch(e){i.e(e)}finally{i.f()}var o,r=u(n);try{for(r.s();!(o=r.n()).done;){var l=o.value;l.parent&&(this.handleActiveChange(l),this.originalParents[l.uuid]=l.parent)}}catch(e){r.e(e)}finally{r.f()}}},{key:"saveOriginalChildren",value:function(e){var t,n=e.children,i=u(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;this.saveLabelChildren(a),this.saveSpriteChildren(a),this.saveNodeChildrenByName(a),this.saveNodeChildrenByType(a)}}catch(e){i.e(e)}finally{i.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(e){var t;if(this.batchLabel){var n=e.getComponentsInChildren(K),i={none:K.CacheMode.NONE,char:K.CacheMode.CHAR,bitmap:K.CacheMode.BITMAP}[this.typeLabel];i&&(n=n.filter((function(e){return e.cacheMode===i}))),0!==n.length&&(t=this.labelChildren).push.apply(t,g(n))}}},{key:"saveSpriteChildren",value:function(e){var t;if(this.batchSprite){var n=e.getComponentsInChildren(F);0!==n.length&&(t=this.spriteChildren).push.apply(t,g(n))}}},{key:"saveNodeChildrenByName",value:function(e){if(this.batchByName){var t,n=u(e.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;Kp.has(this.listName,i.name)?this.nameChildren.push(i):this.saveNodeChildrenByName(i)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"saveNodeChildrenByType",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.batchAllNodes){var i=e.getComponentsInChildren(T);if((t=this.allChildren).push.apply(t,g(i)),!(this.batchDepth<1||n>=this.batchDepth)){var a,o=u(this.allChildren);try{for(o.s();!(a=o.n()).done;){var r=a.value;this.saveNodeChildrenByType(r.node,this.batchDepth)}}catch(e){o.e(e)}finally{o.f()}}}}},{key:"hierarchyChildren",value:function(){var e,t=function(e,t){e.node.isValid&&e.node.activeInHierarchy&&t&&!e.node.isChildOf(t)&&(e.node.setParent(t,!0),e.node.layer=oe.Enum.UI_2D)},n=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],i=u(this.labelChildren);try{for(i.s();!(e=i.n()).done;){t(e.value,this.batchNode.label)}}catch(e){i.e(e)}finally{i.f()}var a,o=u(this.spriteChildren);try{for(o.s();!(a=o.n()).done;){t(a.value,this.batchNode.sprite)}}catch(e){o.e(e)}finally{o.f()}var r,l=u(this.allChildren);try{for(l.s();!(r=l.n()).done;){t(r.value,this.batchNode.node)}}catch(e){l.e(e)}finally{l.f()}this.allChildren.sort((function(e,t){return e.constructor.name.localeCompare(t.constructor.name)})),this.labelChildren.sort((function(e,t){return e.cacheMode-t.cacheMode}));var s,c=u(this.nameChildren);try{for(c.s();!(s=c.n()).done;){var d=s.value;if(d.isValid&&d.activeInHierarchy&&d.isTransformDirty()){var h=d.getComponent(B);if(!(h&&h.opacity<1||Kp.has(n,d.name))){var p=this.batchNode[d.name];p&&(d.isChildOf(p)||(d.setParent(p,!0),d.layer=oe.Enum.UI_2D))}}}}catch(e){c.e(e)}finally{c.f()}}},{key:"restoreOriginalChildren",value:function(){var e=[].concat(g(this.labelChildren),g(this.spriteChildren));if(e.length>0){var t,n=u(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=this.originalParents[i.uuid];a&&(i.node.isChildOf(a)||i.node.setParent(a,!0))}}catch(e){n.e(e)}finally{n.f()}}var o,r=u(this.nameChildren);try{for(r.s();!(o=r.n()).done;){var l=o.value,s=this.originalParents[l.uuid];s&&(l.isChildOf(s)||l.setParent(s,!0))}}catch(e){r.e(e)}finally{r.f()}}}]),s}(T)).prototype,"batchByName",[Kh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sp=a(rp.prototype,"depthNames",[jh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),up=a(rp.prototype,"listName",[Yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cp=a(rp.prototype,"batchLabel",[Xh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),dp=a(rp.prototype,"depthLabel",[Jh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hp=a(rp.prototype,"typeLabel",[Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),pp=a(rp.prototype,"batchSprite",[Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yp=a(rp.prototype,"depthSprite",[ep],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vp=a(rp.prototype,"batchAllNodes",[tp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fp=a(rp.prototype,"batchDepth",[np],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gp=a(rp.prototype,"checkOverlap",[ip],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mp=a(rp.prototype,"handleNodeChange",[ap],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isInited&&(console.warn("handleNodeChange",e.node.name),e.setupBatchNodes(e.node))}}}),op=rp))||op);S._RF.pop(),S._RF.push({},"1ecebJCOPhK9L6AO92sjHzD","BatchNodesV2",void 0);var Jp,Zp=C.ccclass,Qp=C.executionOrder,ey=C.property,ty=Ludex.Utils,ny=ty.Array,iy=ty.Object;kp=Zp("BatchNodesV2"),Cp=Qp(99999),Ep=ey({group:"Batch Settings"}),Ap=ey({type:[E],group:"Batch Settings",visible:function(){return this.batchByName}}),Tp=ey({type:[O],group:"Batch Settings",visible:function(){return this.batchByName}}),Pp=ey({group:"Label Settings"}),Op=ey({group:"Label Settings",visible:function(){return this.batchLabel}}),Lp=ey({group:"Label Settings",visible:function(){return this.batchLabel}}),Ip=ey({group:"Sprite Settings"}),Rp=ey({group:"Sprite Settings",visible:function(){return this.batchSprite}}),kp(_p=Cp((Mp=a((Dp=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"batchByName",Mp,l(e)),r(e,"listName",Np,l(e)),r(e,"depthNames",Bp,l(e)),r(e,"batchLabel",Fp,l(e)),r(e,"typeLabel",xp,l(e)),r(e,"depthLabel",zp,l(e)),r(e,"batchSprite",Up,l(e)),r(e,"depthSprite",Gp,l(e)),e.batchNodes={},e.originalParents={},e.labelNodes=[],e.spriteNodes=[],e.namedNodes={},e.isInitialized=!1,e.labelNodesByType={bitmap:[],char:[],none:[]},e.isEventListenerSetup=!1,e.onAfterUpdate=function(){e.isInitialized&&e.batchActiveNodes()},e.onAfterRender=function(){e.isInitialized&&e.restoreNodes()},e}return e(s,[{key:"depthLabelBitmap",get:function(){return this.depthLabel}},{key:"depthLabelChar",get:function(){return this.depthLabel+1}},{key:"depthLabelNone",get:function(){return this.depthLabel+2}},{key:"onLoad",value:function(){this.enabled&&this.initializeDataStructures()}},{key:"start",value:function(){this.enabled&&this.initialize()}},{key:"onEnable",value:function(){this.isEventListenerSetup||(this.setupEventListeners(),this.isEventListenerSetup=!0)}},{key:"onDisable",value:function(){this.isEventListenerSetup&&(this.removeEventListeners(),this.isEventListenerSetup=!1),this.restoreNodes()}},{key:"onDestroy",value:function(){this.removeEventListeners(),this.restoreNodes(),this.clearData()}},{key:"initializeDataStructures",value:function(){this.batchNodes={},this.originalParents={},this.labelNodes=[],this.spriteNodes=[],this.namedNodes={},this.labelNodesByType={bitmap:[],char:[],none:[]}}},{key:"initialize",value:function(){this.isInitialized||(this.createBatchContainers(),this.scanNodes(this.node),this.sortBatchNodes(),this.isInitialized=!0)}},{key:"clearData",value:function(){this.batchNodes={},this.originalParents={},this.labelNodes=[],this.spriteNodes=[],this.namedNodes={},this.labelNodesByType={bitmap:[],char:[],none:[]},this.isInitialized=!1}},{key:"categorizeNode",value:function(e){if(e.parent){if(this.originalParents[e.uuid]=e.parent,this.batchLabel){var t=e.getComponent(K);t&&("all"===this.typeLabel?t.cacheMode===K.CacheMode.BITMAP?this.labelNodesByType.bitmap.push(e):t.cacheMode===K.CacheMode.CHAR?this.labelNodesByType.char.push(e):this.labelNodesByType.none.push(e):this.isValidLabel(t)&&this.labelNodes.push(e))}if(this.batchSprite)e.getComponent(F)&&this.spriteNodes.push(e);if(this.batchByName){var n=e.name;this.listName.includes(n)&&(this.namedNodes[n]||(this.namedNodes[n]=[]),this.namedNodes[n].push(e))}}}},{key:"isValidLabel",value:function(e){var t={none:K.CacheMode.NONE,char:K.CacheMode.CHAR,bitmap:K.CacheMode.BITMAP};return e.cacheMode===t[this.typeLabel]}},{key:"sortBatchNodes",value:function(){if(this.batchLabel)if("all"===this.typeLabel){var e,t,n;null===(e=this.batchNodes.label_bitmap)||void 0===e||e.setSiblingIndex(this.depthLabelBitmap),null===(t=this.batchNodes.label_char)||void 0===t||t.setSiblingIndex(this.depthLabelChar),null===(n=this.batchNodes.label_none)||void 0===n||n.setSiblingIndex(this.depthLabelNone)}else{var i,a={bitmap:this.depthLabelBitmap,char:this.depthLabelChar,none:this.depthLabelNone}[this.typeLabel]||this.depthLabelChar;null===(i=this.batchNodes.label)||void 0===i||i.setSiblingIndex(a)}this.batchNodes.sprite&&this.batchNodes.sprite.setSiblingIndex(this.depthSprite);for(var o=0;o<this.listName.length;o++){var r=this.listName[o];if(r){var l=this.depthNames[o]||0,s=this.batchNodes[r];s&&s.setSiblingIndex(l)}}}},{key:"batchNodeArray",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];null!=i&&i.isValid&&i.activeInHierarchy&&(i.parent!==t&&(this.isBatchContainer(i)||i.isTransformDirty()&&this.isParentChainActive(i)&&(i.setParent(t,!0),i.layer=oe.Enum.UI_2D)))}}},{key:"isBatchContainer",value:function(e){var t=iy.vals(this.batchNodes);return ny.has(t,e)}},{key:"isParentChainActive",value:function(e){for(var t=e,n=this.node;t&&t!==n;){if(!t.active||!t.isValid)return!1;t=t.parent}return t===n}},{key:"restoreNodes",value:function(){var e=this,t=function(t){var n=e.originalParents[t.uuid];null!=n&&n.isValid&&t.parent!==n&&e.isParentChainActive(n)&&t.setParent(n,!0)};if(this.batchLabel)if("all"===this.typeLabel)for(var n in this.labelNodesByType)for(var i=this.labelNodesByType[n],a=0;a<i.length;a++){var o=i[a];o&&t(o)}else for(var r=0;r<this.labelNodes.length;r++){var l=this.labelNodes[r];l&&t(l)}if(this.batchSprite)for(var s=0;s<this.spriteNodes.length;s++){var u=this.spriteNodes[s];u&&t(u)}if(this.batchByName)for(var c in this.namedNodes){var d=this.namedNodes[c];if(d)for(var h=0;h<d.length;h++){var p=d[h];p&&t(p)}}}},{key:"setupEventListeners",value:function(){A.on(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),A.on(Z.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"removeEventListeners",value:function(){A.off(Z.EVENT_AFTER_UPDATE,this.onAfterUpdate),A.off(Z.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"createBatchContainers",value:function(){if(this.batchLabel)if("all"===this.typeLabel)for(var e=0,t=["bitmap","char","none"];e<t.length;e++){var n=t[e],i=new q("BatchLabel_".concat(n));i.layer=oe.Enum.UI_2D,this.node.addChild(i),this.batchNodes["label_".concat(n)]=i}else{var a=new q("BatchLabel");a.layer=oe.Enum.UI_2D,this.node.addChild(a),this.batchNodes.label=a}if(this.batchSprite){var o=new q("BatchSprite");o.layer=oe.Enum.UI_2D,this.node.addChild(o),this.batchNodes.sprite=o}if(this.batchByName)for(var r=0;r<this.listName.length;r++){var l=this.listName[r];if(l){var s=new q("Batch_".concat(l));s.layer=oe.Enum.UI_2D,this.node.addChild(s),this.batchNodes[l]=s,this.namedNodes[l]=[]}}}},{key:"scanNodes",value:function(e){for(var t=e.children,n=0;n<t.length;n++){var i=t[n];i&&(this.categorizeNode(i),i.children.length>0&&this.scanNodes(i))}}},{key:"batchActiveNodes",value:function(){if(this.batchLabel&&("all"===this.typeLabel?(this.batchNodesByType(this.labelNodesByType.bitmap,"label_bitmap"),this.batchNodesByType(this.labelNodesByType.char,"label_char"),this.batchNodesByType(this.labelNodesByType.none,"label_none")):this.batchNodesByType(this.labelNodes,"label")),this.batchSprite&&this.batchNodesByType(this.spriteNodes,"sprite"),this.batchByName)for(var e in this.namedNodes){var t=this.namedNodes[e];if(t){var n=this.batchNodes[e];n&&this.batchNodeArray(t,n)}}}},{key:"batchNodesByType",value:function(e,t){var n=this.batchNodes[t];n&&this.batchNodeArray(e,n)}}]),s}(T)).prototype,"batchByName",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Np=a(Dp.prototype,"listName",[Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bp=a(Dp.prototype,"depthNames",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fp=a(Dp.prototype,"batchLabel",[Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xp=a(Dp.prototype,"typeLabel",[Op],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),zp=a(Dp.prototype,"depthLabel",[Lp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Up=a(Dp.prototype,"batchSprite",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Gp=a(Dp.prototype,"depthSprite",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_p=Dp))||_p);S._RF.pop(),S._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var ay,oy=C.ccclass,ry=Ludex.Utils.Browser,ly=codex.player,sy=oy("Vibrate")(Jp=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"vibrate",value:function(e){if(this.isVibrateEnable()&&!ry.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!ly.getPlayerSetting("vibrate")}}]),r}(T))||Jp;S._RF.pop(),S._RF.push({},"21fbd1aIo9DNoKfAoZaF1DC","WidgetCanvasTarget",void 0);var uy;(0,C.ccclass)("WidgetCanvasTarget")(ay=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"__preload",value:function(){var e=this.getComponent(I);if(e){var t=re("Canvas");t&&(e.target=t)}}}]),r}(T));S._RF.pop(),S._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var cy=10,dy=20,hy=100,py=(m(uy={},tt.HINT,80),m(uy,tt.THUNDER,200),m(uy,tt.STORM,150),m(uy,tt.PLIERS,150),uy),yy=2e3,vy=300;S._RF.pop(),S._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var fy={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:3}}};S._RF.pop(),S._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var gy,my,by,wy,Sy=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(Sy||{}),ky={Events:Sy,UNLOCK_SEQUENCE:"101013012031"};S._RF.pop(),S._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var Cy=Ludex.Configs.Leaderboards.LeaderboardList,Ey={DAILY:null!==(gy=null===(my=Cy[0])||void 0===my?void 0:my.Id)&&void 0!==gy?gy:"daily-leaderboard-id",WEEKLY:null!==(by=null===(wy=Cy[1])||void 0===wy?void 0:wy.Id)&&void 0!==by?by:"weekly-leaderboard-id"},Ay="daily",Ty="weekly";S._RF.pop(),S._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var Py=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(Py||{});S._RF.pop(),S._RF.push({},"7e0c9Khhb1DD7wE1NBWi3Py","VibrateStyle",void 0),S._RF.pop(),S._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var Oy=function(a){n(r,a);var o=i(r);function r(e,n){var i;return t(this,r),(i=o.call(this,n)).code=e,i}return e(r)}(p(Error));S._RF.pop(),S._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var Ly=function(a){n(r,a);var o=i(r);function r(e,n){var i;return t(this,r),(i=o.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=e,i.tournamentId=n,i}return e(r)}(Oy);S._RF.pop(),S._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var Iy={mapOrder:[{id:1,theme:"summer",skins:["fruit"],levelCount:10},{id:2,theme:"autumn",skins:["flower"],levelCount:10},{id:3,theme:"winter",skins:["tool"],levelCount:10},{id:4,theme:"summer",skins:["sport"],levelCount:10},{id:5,theme:"autumn",skins:["cosmetics"],levelCount:10},{id:6,theme:"winter",skins:["ice-cream"],levelCount:10},{id:7,theme:"summer",skins:["cakes"],levelCount:10},{id:8,theme:"happy-new-year",skins:["cosmetics","car"],levelCount:10},{id:9,theme:"spring-festival",skins:["flower","ice-cream"],levelCount:10},{id:10,theme:"tree-planting-festival",skins:["fruit","flower","tool"],levelCount:10},{id:11,theme:"blue-sea-festival",skins:["sport","ice-cream"],levelCount:10},{id:12,theme:"music-festival",skins:["cakes","cosmetics"],levelCount:10},{id:13,theme:"harvest-festival",skins:["fruit","flower","tool"],levelCount:10},{id:14,theme:"food-festival",skins:["cakes","ice-cream","flower"],levelCount:10},{id:15,theme:"snow-festival",skins:["ice-cream","sport"],levelCount:10},{id:16,theme:"light-festival",skins:["flower","cakes"],levelCount:10},{id:17,theme:"peace-festival",skins:["flower","sport"],levelCount:10},{id:18,theme:"flower-festival",skins:["flower","fruit"],levelCount:10},{id:19,theme:"street-festival",skins:["car","ice-cream","sport"],levelCount:10},{id:20,theme:"color-garden",skins:["cakes","fruit"],levelCount:10},{id:21,theme:"color-festival",skins:["car","cosmetics","flower"],levelCount:10},{id:22,theme:"nature-summer",skins:["tool","sport"],levelCount:10},{id:23,theme:"snow-mountain",skins:["cakes","ice-cream"],levelCount:10},{id:24,theme:"ice-festival",skins:["ice-cream"],levelCount:10},{id:25,theme:"green-grass-festival",skins:["flower","fruit"],levelCount:10},{id:26,theme:"community-festival",skins:["car","cakes","cosmetics"],levelCount:10},{id:27,theme:"water-festival",skins:["sport","car"],levelCount:10},{id:28,theme:"animal-festival",skins:["flower","fruit"],levelCount:10},{id:29,theme:"lost-festival",skins:["flower"],levelCount:10},{id:30,theme:"halloween-festival",skins:["cakes","cosmetics"],levelCount:10},{id:31,theme:"snow-music-festival",skins:["ice-cream","cosmetics"],levelCount:10},{id:32,theme:"christmas",skins:["ice-cream","tool","cosmetics"],levelCount:10},{id:33,theme:"spring-flower-festival",skins:["flower","fruit"],levelCount:10},{id:34,theme:"tet-holiday",skins:["flower","cosmetics","fruit"],levelCount:10},{id:35,theme:"sea-festival",skins:["car","sport"],levelCount:10},{id:36,theme:"firework-festival",skins:["cosmetics","car","flower"],levelCount:10},{id:37,theme:"halloween-horror",skins:["cakes","cosmetics"],levelCount:10},{id:38,theme:"mid-autumn",skins:["flower","cakes"],levelCount:10},{id:39,theme:"christmas-sweet",skins:["ice-cream","cakes","sport"],levelCount:10},{id:40,theme:"new-year-countdown",skins:["cosmetics","car"],levelCount:10}]};S._RF.pop(),S._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var Ry,_y=Ludex.Utils.Function,Dy=codex,My=Dy.player,Ny=Dy.storage,By=Iy.mapOrder.map((function(e){return{skins:e.skins,themeId:e.theme,currentProgress:0,maxProgress:e.levelCount,isLocked:!0}})),Fy=function(){function n(){t(this,n),this.playerSkinProgress=By.map((function(e){return s({},e)}))}var i,a;return e(n,[{key:"initDefaultPlayerSkinProgress",value:function(){this.playerSkinProgress=By.map((function(e){return s({},e)}))}},{key:"initDashboardSceneStorage",value:function(){var e=Ny.getStorage("dashboard");if(null==e){var t=this.getCurrentMapProgressInstance();Ny.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});var n=Ny.getStorage("collection");if(null==n){Ny.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});var i=Ny.getStorage("leaderboard_content");if(null==i){Ny.addStorage("leaderboard_content",{lastTabOpened:Ay,previousScore:-1});var a=Ny.getStorage("tournament");null==a&&Ny.addStorage("tournament",{animateTournamentLeader:!1,previousScore:-1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){for(var e=void 0,t=void 0,n=0,i=0,a=0,o=0,r=Iy.mapOrder.length;o<r;o++){var l=this.playerSkinProgress[o],s=Iy.mapOrder[o],u=Iy.mapOrder[o+1];if(l.currentProgress<l.maxProgress){var c;a=s.id,e=s.theme,t=null!==(c=null==u?void 0:u.theme)&&void 0!==c?c:e,n=l.currentProgress,i=l.maxProgress;break}}if(void 0===e||void 0===t){var d=Iy.mapOrder[Iy.mapOrder.length-1];return{id:a=d.id,currentTheme:e=d.theme,nextTheme:t=d.theme,progress:n=d.levelCount,max:i=d.levelCount}}return{id:a,currentTheme:e,nextTheme:t,progress:n,max:i}}},{key:"getUnlockedSkinsInstance",value:function(){var e,t=[],n=u(this.playerSkinProgress);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(!i.isLocked&&1===i.skins.length){var a=i.skins[0];a&&t.push(a)}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getLevelSkinsInstance",value:function(e){var t,n=null!=e?e:1,i=0,a=u(Iy.mapOrder);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(i+o.levelCount>=n)return o.skins;i+=o.levelCount}}catch(e){a.e(e)}finally{a.f()}return Iy.mapOrder[Iy.mapOrder.length-1].skins}},{key:"getLevelThemeInstance",value:function(e){var t,n=null!=e?e:1,i=0,a=u(Iy.mapOrder);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(i+o.levelCount>=n)return o.theme;i+=o.levelCount}}catch(e){a.e(e)}finally{a.f()}return Iy.mapOrder[Iy.mapOrder.length-1].theme}},{key:"getThemeSkinsInstance",value:function(e){var t,n=u(Iy.mapOrder);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.theme===e)return i.skins}}catch(e){n.e(e)}finally{n.f()}return[]}},{key:"getCollectionUnlockProgressInstance",value:function(){var e,t=[],n=u(this.playerSkinProgress);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push({skins:i.skins,theme:i.themeId,progress:i.currentProgress,max:i.maxProgress,isLocked:i.isLocked})}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"updatePlayerSkinProgress",value:function(){var e,t=My.getGameData(),n=(null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1)-1;this.playerSkinProgress[0].isLocked=!1;for(var i=0,a=Iy.mapOrder.length;i<a;i++){var o=Iy.mapOrder[i];if(o&&!(n<=0)){var r=n-o.levelCount>=0?o.levelCount:n;n-=r,this.increaseProgress(i,r)}}}},{key:"increaseProgress",value:function(e,t){if(e<0||e>=this.playerSkinProgress.length)throw new Error("increaseProgress: index out of range");var n,i=this.playerSkinProgress[e],a=i.currentProgress,o=i.maxProgress,r=a+t>o?o:a+t;(r>0&&(i.isLocked=!1),r===o)&&((null===(n=Iy.mapOrder[e+1])||void 0===n?void 0:n.skins)&&(this.playerSkinProgress[e+1].isLocked=!1));i.currentProgress=r,i.maxProgress=o}}],[{key:"getInstance",value:function(){return this.inst$||(this.inst$=new n),this.inst$}},{key:"init",value:function(){var e=this.getInstance();e.initDefaultPlayerSkinProgress(),e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkins",value:function(e){return this.getInstance().getLevelSkinsInstance(e)}},{key:"getLevelTheme",value:function(e){return this.getInstance().getLevelThemeInstance(e)}},{key:"getThemeSkins",value:function(e){return this.getInstance().getThemeSkinsInstance(e)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"getCurrentUnlockingThemeIndex",value:function(){var e=this.getCollectionUnlockProgress();if(0===e.length)return null;var t=0;return e.forEach((function(e,n){e.isLocked||(t=n)})),t}},{key:"preloadLevelSpriteFrames",value:function(e){var t=this.getLevelSkins(e);this.preloadSkinsFrames(t)}},{key:"preloadSkinsFrames",value:function(e){var t,n=u(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.preloadSkinFrames(i)}}catch(e){n.e(e)}finally{n.f()}}},{key:"preloadSkinFrames",value:function(e){var t="".concat(nt.TILE_SKIN_FOLDER,"/").concat(e);qe.loadSpriteFramesDirAsync(t)}},{key:"loadLevelSpriteFrames",value:(a=o((function*(e,t,n){var i=_y.rng({generate:function(e,t,n){return le(e,t,n)},generateSeed:function(e){return le(e,0,1e6)},seed:null!=n?n:Date.now()});if(void 0!==t&&0===i(0,2)){var a=this.getThemeSkins(t),o=a[i(0,a.length)];return yield this.loadSkinFrames(o)}if(0===i(0,2)){var r=this.getUnlockedSkins();if(r.length>1){var l=r[i(0,r.length)];return yield this.loadSkinFrames(l)}}var s=this.getLevelSkins(e);if(0===s.length)throw new Error("No skins found for level ".concat(e));if(s.length>1)return yield this.loadSkinsFrames(s);var u=s[0];return yield this.loadSkinFrames(u)})),function(e,t,n){return a.apply(this,arguments)})},{key:"loadSkinFrames",value:function(e){var t="".concat(nt.TILE_SKIN_FOLDER,"/").concat(e);return qe.loadSpriteFramesDirAsync(t)}},{key:"loadSkinsFrames",value:(i=o((function*(e){var t=e.map(this.loadSkinFrames);return(yield _y.allSettled(t)).reduce((function(e,t){return"fulfilled"===t.status&&e.push.apply(e,g(t.value)),e}),[])})),function(e){return i.apply(this,arguments)})}]),n}();S._RF.pop(),S._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var xy=codex,zy=xy.match,Uy=xy.player,Gy=xy.leaderboard,Hy=Ludex,qy=Hy.Utils,Vy=qy.Object,$y=qy.Valid,Wy=qy.String,Ky=qy.Array,jy=Hy.Match.Modes,Yy=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],Xy=function(){function n(){var e=this;t(this,n),this.processStartSingleModeAsync$=o((function*(){var e=Uy.getPlayerId();return zy.single.start.processAsync({playerId:e})})),this.processFinishSingleModeAsync$=o((function*(){return zy.single.finish.processAsync()})),this.processStartTournamentModeAsync$=o((function*(){var e=Uy.getPlayerId(),t=GameSDK.context.getID();return zy.tournament.continue.processAsync({playerId:e,contextId:t})})),this.processFinishTournamentModeAsync$=o((function*(){var e=Uy.getPlayerId(),t=Uy.getBestScore();return zy.tournament.finish.processAsync({playerId:e,bestScore:t})})),this.processStartChallengeModeAsync$=o((function*(){try{return e.processContinueChallengeAsync$()}catch(t){if(!Vy.hasOwn(t,"name")||$y.isString(t.name))throw t;if("PlayerHasFinishedMatch"===t.name)return e.processChallengeNewOpponentAsync$();if("PlayerNotJoinInMatch"===t.name)return e.processJoinChallengeAsync$()}})),this.processFinishChallengeModeAsync$=function(){var e=o((function*(e){return zy.challenge.finish.processAsync(e)}));return function(t){return e.apply(this,arguments)}}(),this.processContinueChallengeAsync$=o((function*(){var t=e.getMatchState$(),n=t.id,i=t.customData,a=i.playerId,o=i.opponentId;if(!$y.isString(n))throw new Error("Invalid match id");if(!$y.isString(a))throw new Error("Invalid player id");if(!$y.isString(o))throw new Error("Invalid opponent id");var r=GameSDK.context.getID();if(!r)throw new Error("Cannot get contextId");return zy.challenge.continue.processAsync({matchId:n,contextId:r,playerId:a,opponentId:o})})),this.processChallengeNewOpponentAsync$=o((function*(){var e=Uy.getConnectedPlayerIds(100,0),t=Math.floor(Math.random()*e.length),n=Uy.getPlayerId(),i=e[t];if(!$y.isString(i)||$y.isEmpty(i))throw new Error("Invalid opponent id");return zy.challenge.friend.processAsync({playerId:n,opponentId:i})})),this.processJoinChallengeAsync$=o((function*(){var t=e.getMatchState$(),n=t.id,i=t.customData,a=i.playerId,o=i.opponentId;if(!$y.isString(n))throw new Error("Invalid match id");if(!$y.isString(a))throw new Error("Invalid player id");if(!$y.isString(o))throw new Error("Invalid opponent id");return zy.challenge.join.processAsync({matchId:n,playerId:a,opponentId:o})})),this.processStartGameModeAsync$=function(){var e=o((function*(e){var t=Uy.getPlayerId();return zy.strategy.start.processAsync({matchId:"123456",gameMode:e,playerId:t})}));return function(t){return e.apply(this,arguments)}}(),this.processFinishGameModeAsync$=o((function*(){return zy.strategy.finish.processAsync({postGlobalLeaderboard:!0,setPlayerBestScore:!0})})),this.getMatchState$=function(){var e=zy.getMatchState();if(!e)throw new Error("Match state not found");return e}}var i,a,r,l,s,u,c,d,h;return e(n,null,[{key:"inst",get:function(){return this.inst$||(this.inst$=new n),this.inst$}},{key:"startMatchAsync",value:(h=o((function*(e){try{var t=null!=e?e:this.getMatchMode();switch(t){case jy.SINGLE:yield this.inst.processStartSingleModeAsync$();break;case jy.TOURNAMENT:yield this.inst.processStartTournamentModeAsync$();break;case jy.CHALLENGE_FRIEND:yield this.inst.processStartChallengeModeAsync$();break;default:t?yield this.inst.processStartGameModeAsync$(t):yield this.inst.processStartSingleModeAsync$()}}catch(e){console.warn("startMatchAsync",e)}})),function(e){return h.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(d=o((function*(e){try{yield zy.handler.setProfileData(e)}catch(e){console.warn("setProfileMatchDataAsync",e)}})),function(e){return d.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(c=o((function*(e){try{yield zy.handler.setMatchCustomData(e)}catch(e){console.warn("setMatchCustomDataAsync",e)}})),function(e){return c.apply(this,arguments)})},{key:"getMatchCustomDataAsync",value:(u=o((function*(){try{yield zy.handler.getMatchCustomData()}catch(e){console.warn("getMatchCustomDataAsync",e)}})),function(){return u.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(s=o((function*(e){try{yield zy.handler.setLeaderboardScore(e)}catch(e){console.warn("setLeaderboardScoreAsync",e)}})),function(e){return s.apply(this,arguments)})},{key:"finishMatchAsync",value:(l=o((function*(e){try{var t=this.getMatchMode();switch(t){case jy.SINGLE:yield this.inst.processFinishSingleModeAsync$();break;case jy.TOURNAMENT:yield this.inst.processFinishTournamentModeAsync$();break;case jy.CHALLENGE_FRIEND:yield this.inst.processFinishChallengeModeAsync$(e);break;default:t?yield this.inst.processFinishGameModeAsync$():yield this.inst.processFinishSingleModeAsync$()}}catch(e){console.warn("finishMatchAsync",e)}})),function(e){return l.apply(this,arguments)})},{key:"joinTournamentAsync",value:(r=o((function*(e){var t=Uy.getPlayerId();return zy.tournament.join.processAsync({tournamentId:e,playerId:t})})),function(e){return r.apply(this,arguments)})},{key:"continueTournamentAsync",value:(a=o((function*(e){var t=Uy.getPlayerId();return zy.tournament.continue.processAsync({playerId:t,contextId:e})})),function(e){return a.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(i=o((function*(){var e=yield this.getTournamentsAsync$(),t=Ky.search(e,(function(e){var t=e.getPayload(),n=JSON.parse($y.isString(t)?t:"{}");return"DEFAULT"===e.getTournamentType()&&n.playerId===Uy.getPlayerId()}));if(t)throw new Ly(Uy.getPlayerId(),t.getID());var n=this.createTournamentPayload$();Uy.setGameData({lastCreateTournamentShown:Date.now()}),yield zy.tournament.create.processAsync(n);var i=n.leaderboardId;Gy.addLeaderboard({name:i,type:"tournament",autoSortRank:!0,leaderboardId:i})})),function(){return i.apply(this,arguments)})},{key:"getMatchMode",value:function(){var e=this.inst.getMatchState$();return $y.isString(e.mode)?e.mode:null}},{key:"getMatchCustomData",value:function(){var e=this.inst.getMatchState$();return $y.isObject(e.customData)?e.customData:null}},{key:"updateMatchStateAfterLevelFinish",value:function(e,t){this.setMatchCustomDataAsync({level:e,score:t});var n=Uy.getPlayerId();this.setProfileMatchDataAsync({id:n,score:t})}}]),n}();Ry=Xy,Xy.createTournamentName$=function(){var e=Yy[te.randomRangeInt(0,Yy.length-1)],t="".concat(e," Tournament"),n=Wy.removeDiacritics(t);return"".concat(n)},Xy.createTournamentPayload$=function(){var e,t,n,i=Wy.generateObjectId(),a=Uy.getPlayerId(),o=Uy.getPlayer().name,r=Uy.getGameData(),l=null!==(e=null==r?void 0:r.level)&&void 0!==e?e:1,s=Fy.getLevelTheme(l),u=Ry.inst.getMatchState$().profiles;return{score:null!==(t=null===(n=(void 0===u?{}:u)[a])||void 0===n?void 0:n.score)&&void 0!==t?t:0,playerId:a,mode:jy.TOURNAMENT,name:Ry.createTournamentName$(),leaderboardId:i,payload:{playerId:a,playerName:o,leaderboardId:i,themeId:s}}},Xy.getTournamentsAsync$=o((function*(){try{return yield GameSDK.tournament.getTournamentsAsync()}catch(e){return console.error(e),[]}})),S._RF.pop(),S._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var Jy="time",Zy="bomb";S._RF.pop(),S._RF.push({},"43ee9veYalAU7wfruC56uJv","GameMode",void 0);var Qy,ev="custom";S._RF.pop(),S._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var tv=(0,C.ccclass)("InputController")(Qy=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i))).handleElementPointerDown=function(){},e.handleElementPointerUp=function(e){},e}return e(r,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){J.os!==J.OS.WINDOWS&&J.os!==J.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){J.os!==J.OS.WINDOWS&&J.os!==J.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),r}(T))||Qy;S._RF.pop(),S._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var nv={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};S._RF.pop(),S._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var iv="fall-down",av="fly-up",ov="push-left",rv="push-right",lv="put-columns-middle",sv="put-rows-middle",uv=[iv,av,ov,rv,lv,sv],cv=[iv,av,sv],dv=[ov,rv,lv];S._RF.pop(),S._RF.push({},"636f3vmmpVFBLNjr6WR2MSa","CustomModeUtils",void 0);var hv=codex.player,pv=function(){function n(){t(this,n)}return e(n,null,[{key:"inst",get:function(){return this.inst$||(this.inst$=new n),this.inst$}},{key:"getCustomBonus",value:function(){var e=this.getCustomData(),t=e.time,n=e.difficulty,i=e.bombs,a=e.ads;return this.getTimeBonus(t)+this.getDifficultyBonus(n)+this.getBombsBonus(i)+this.getExtraAdsBonus(a)}},{key:"getCustomData",value:function(){var e,t=(null!==(e=hv.getGameData())&&void 0!==e?e:{}).custom;return void 0===t?{time:4,difficulty:1,bombs:0,ads:!1}:t}},{key:"getTimeBonus",value:function(e){return 5*(e-4)}},{key:"getDifficultyBonus",value:function(e){return 3===e?30:20*(e-1)}},{key:"getBombsBonus",value:function(e){return 5*e}},{key:"getExtraAdsBonus",value:function(e){return e?75:0}}]),n}();S._RF.pop(),S._RF.push({},"f0eaf/DUO9MpretbO/JIGbt","CustomGameData",void 0);var yv={time:[40,30,20,10,0,-10,-20,-30,-40],difficulty:["Easy","Normal","Hard","Extreme"],bombs:[0,1,2,3,4]};S._RF.pop(),S._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var vv={CAKES:"cakes",CAR:"car",COSMETIC:"cosmetics",FLOWER:"flower",FRUIT:"fruit",ICE_CREAM:"ice-cream",SPORT:"sport",TOOL:"tool"};S._RF.pop(),S._RF.push({},"5c321EpuONCAq5BAh+AQCcd","RandomizedLevelDataConfig",void 0);var fv=5,gv=[90,200],mv=[6,30],bv={bombRange:[1,8],rocketRange:[0,2]},wv={maxSpaceOfPairRange:[2,10],addRandomTilesPerMoveRange:[0,8]},Sv=[5,7],kv=[6,12];S._RF.pop(),S._RF.push({},"4e7344vPB1EoI9uMkZu5Zd0","createRandomizedLevelData",void 0);var Cv,Ev,Av=function(e,t){return function(n){return n<=0?[e,t]:n>=1?[t,t]:[Math.floor(e+n*(t-e)),t]}},Tv=function(e,t){var n=Math.ceil(e),i=Math.floor(t);return Math.floor(Math.random()*(i-n+1))+n},Pv=function(e){return function(t){return Tv.apply(void 0,g(e(t)))}},Ov={generateDifficulty:(Cv=fv,function(e){return Cv<=1?0:(e-1)%Cv/(Cv-1)}),generateTime:Pv(function(e,t){var n=Av(t,e);return function(e){return n(e)}}.apply(void 0,g(gv))),generateColors:Pv(Av.apply(void 0,g(mv))),specials:{generateBomb:Pv(Av.apply(void 0,g(bv.bombRange))),generateRocket:Pv(Av.apply(void 0,g(bv.rocketRange)))},rules:{generateMaxSpaceOfPair:Pv(Av.apply(void 0,g(wv.maxSpaceOfPairRange))),generateAddRandomTilesPerMove:Pv(Av.apply(void 0,g(wv.addRandomTilesPerMoveRange)))},generateColumns:Pv(Av.apply(void 0,g(Sv))),generateRows:Pv(Av.apply(void 0,g(kv)))};S._RF.pop(),S._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var Lv=C.ccclass,Iv=Ludex.Utils,Rv=Iv.Json,_v=Iv.Array,Dv=codex.monitorError,Mv=Object.values(vv),Nv=[[4,6],[4,8],[5,8],[6,8],[5,10],[6,10],[7,10],[7,12]],Bv=[-2,0,2,5],Fv={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},xv=function(){var e={};return function(t){if(e[t])return e[t];var n=function(e){var t=Ov.generateDifficulty(e),n=Ov.generateColumns(t),i=Ov.generateRows(t);return{rows:n%2==1&&i%2==1?i+1:i,columns:n,colors:Ov.generateColors(t),gravity:Math.random()>.75?"normal":Math.random()>.5?uv[Math.floor(Math.random()*uv.length)]:[cv[Math.floor(Math.random()*cv.length)],dv[Math.floor(Math.random()*dv.length)]].join("-"),rules:{addRandomTilesPerMove:Ov.rules.generateAddRandomTilesPerMove(t),maxSpaceOfPair:Ov.rules.generateMaxSpaceOfPair(t)},specials:{bomb:Ov.specials.generateBomb(t),rocket:Ov.specials.generateRocket(t)},time:Ov.generateTime(t)}}(t);return e[t]={level:t,theme:Mv,rows:n.rows,columns:n.columns,colors:n.colors,mode:n.gravity,rules:{maxSpaceOfPair:n.rules.maxSpaceOfPair,addRandomTilesPerMove:n.rules.addRandomTilesPerMove},specials:{bomb:n.specials.bomb,rocket:n.specials.rocket},time:n.time},e[t]}},zv=Lv("LevelManager")(Ev=function(a){n(u,a);var r,l,s=i(u);function u(){var e;t(this,u);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=s.call.apply(s,[this].concat(i))).getRandomizedLevelData=xv(),e}return e(u,[{key:"loadLevel",value:(l=o((function*(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=yield this.loadLevelData(t);this.levelData=null!==(e=null!=n?n:this.levelData)&&void 0!==e?e:Fv,null==Dv||Dv.addMetadata({level:t})})),function(){return l.apply(this,arguments)})},{key:"loadLevelData",value:(r=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=null;if(e>=it)t=this.getRandomizedLevelData(e);else{var n=10,i=this.paddingZero("".concat(Math.floor(e/n)+1),3),a=e%n,o=yield qe.loadJsonAsync("".concat(nt.LEVEL_DATA_FOLDER,"/").concat(i));if(!o)return null;if(null===o.json)return null;t=o.json[a]}if(!(t=Rv.clone(t)))return null;if(Xy.getMatchMode()===ev){var r,l,s,u=pv.getCustomData(),c=t.time*(1+(null!==(r=yv.time[u.time])&&void 0!==r?r:0)/100),d=t.specials.bomb+(null!==(l=yv.bombs[u.bombs])&&void 0!==l?l:0),h=Math.min(t.colors+(null!==(s=Bv[u.difficulty])&&void 0!==s?s:0),30),p=this.getDifficulty(t.columns,t.rows);if(void 0!==p){var y;p+=u.difficulty-1;var f=null!==(y=this.getCustomColumnAndRow(p))&&void 0!==y?y:[t.columns,t.rows],g=v(f,2),m=g[0],b=g[1];t.rows=b,t.columns=m}t.time=c,t.specials.bomb=d,t.colors=h}return t})),function(){return r.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"getCustomColumnAndRow",value:function(e){return Nv[te.clamp(e,0,Nv.length-1)]}},{key:"getDifficulty",value:function(e,t){var n=_v.searchIndex(Nv,(function(n){var i=v(n,2),a=i[0],o=i[1];return a===e&&o===t}));return-1===n?void 0:n}},{key:"paddingZero",value:function(e,t){for(var n="",i=0;i<t-e.length;i++)n+="0";return n+e}}]),u}(T))||Ev;function Uv(e){for(var t=e.array,n=e.isLighter,i=e.out,a=void 0===i?new Set:i,o=0;o<t.length;o++)if(n(t.get(o)))for(var r=o+1;r<t.length;r++)if(!n(t.get(r))){t.swap(o,r),a.add(t.get(o));break}return a}S._RF.pop(),S._RF.push({},"bfb989Gr/dArq4M9uSSrF5/","stagger",void 0),S._RF.pop(),S._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var Gv,Hv,qv,Vv,$v,Wv,Kv,jv,Yv,Xv,Jv,Zv,Qv,ef,tf,nf,af,of,rf,lf,sf,uf,cf,df,hf,pf,yf,vf,ff,gf,mf,bf,wf,Sf,kf,Cf,Ef,Af,Tf,Pf,Of,Lf,If,Rf,_f,Df,Mf,Nf,Bf,Ff,xf,zf,Uf,Gf,Hf,qf,Vf,$f,Wf,Kf,jf,Yf,Xf,Jf,Zf,Qf,eg,tg,ng,ig,ag,og,rg,lg,sg=function(){function n(e){var i;t(this,n),this.array=[];var a=null!=e?e:{},o=a.width,r=void 0===o?1:o,l=a.height,s=void 0===l?1:l,u=e instanceof n?e.array:null!==(i=null==e?void 0:e.content)&&void 0!==i?i:[];if(u.length!==r*s)throw new Error("Invalid content length");this.width=r,this.height=s,this.array=g(u)}return e(n,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(e,t){if(!this.isInBounds(e,t))throw new Error("Out of bounds");return this.array[t*this.width+e]}},{key:"set",value:function(e,t,n){this.array[t*this.width+e]=n}},{key:"isInBounds",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}},{key:"each",value:function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(this.get(n,t),n,t)}},{key:"map",value:function(e){for(var t=[],n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.push(e(this.get(i,n),i,n));return t}},{key:"reduce",value:function(e,t){for(var n=t,i=0;i<this.height;i++)for(var a=0;a<this.width;a++)n=e(n,this.get(a,i),a,i);return n}},{key:"swap",value:function(e,t){var n=v(e,2),i=n[0],a=n[1],o=v(t,2),r=o[0],l=o[1],s=this.get(i,a);this.set(i,a,this.get(r,l)),this.set(r,l,s)}},{key:"shuffle",value:function(e){for(var t=null!=e?e:this.map((function(e,t,n){return[t,n]})),n=g(t),i=new Set,a=n.length-1;a>0;a--){var o=se(0,a+1),r=n[a],l=n[o];n[a]=l,n[o]=r,i.add(this.get(r[0],r[1])),i.add(this.get(l[0],l[1]))}for(var s=0;s<n.length;s++){var u=t[s],c=v(u,2),d=c[0],h=c[1],p=n[s],y=v(p,2),f=y[0],m=y[1];this.swap([d,h],[f,m])}return i}},{key:"toShuffled",value:function(e){var t=new n({width:this.width,height:this.height,content:this.array}),i=t.shuffle(e);return[t,i]}},{key:"gravitate",value:function(e){var t=this,n=v(e.rowRange,2),i=n[0],a=n[1],o=v(e.colRange,2),r=o[0],l=o[1],s=e.direction,u=e.isLighter,c=e.onSwap,d=e.out,h=void 0===d?new Set:d,p=l-r+1,y=a-i+1;switch(s){case nv.Up:for(var f=function(e){Uv({array:{length:y,get:function(n){return t.get(e,a-n)},swap:function(n,i){var o=t.get(e,a-n),r=t.get(e,a-i);t.swap([e,a-n],[e,a-i]),null==c||c(o,r)}},isLighter:u,out:h})},g=r;g<=l;g++)f(g);return h;case nv.Down:for(var m=function(e){Uv({array:{length:y,get:function(n){return t.get(e,i+n)},swap:function(n,a){var o=t.get(e,i+n),r=t.get(e,i+a);t.swap([e,i+n],[e,i+a]),null==c||c(o,r)}},isLighter:u,out:h})},b=r;b<=l;b++)m(b);return h;case nv.Left:for(var w=function(e){Uv({array:{length:p,get:function(n){return t.get(r+n,e)},swap:function(n,i){var a=t.get(r+n,e),o=t.get(r+i,e);t.swap([r+n,e],[r+i,e]),null==c||c(a,o)}},isLighter:u,out:h})},S=i;S<=a;S++)w(S);return h;case nv.Right:for(var k=function(e){Uv({array:{length:p,get:function(n){return t.get(l-n,e)},swap:function(n,i){var a=t.get(l-n,e),o=t.get(l-i,e);t.swap([l-n,e],[l-i,e]),null==c||c(a,o)}},isLighter:u,out:h})},C=i;C<=a;C++)k(C);return h;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var e=new n({width:this.width,height:this.height,content:this.array}),t=e.gravitate.apply(e,arguments);return[e,t]}},{key:"toRotated",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new n({width:this.height,height:this.width,content:new Array(this.width*this.height)});if(e)for(var i=0;i<this.height;i++)for(var a=this.width-1;a>=0;a--)t.set(i,this.width-1-a,this.get(a,i));else for(var o=this.height-1;o>=0;o--)for(var r=0;r<this.width;r++)t.set(this.height-1-o,r,this.get(r,o));return t}}]),n}();S._RF.pop(),S._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),S._RF.pop(),S._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var ug=C.ccclass,cg=C.property,dg=C.requireComponent,hg=Ludex.Utils,pg=hg.Signal,yg=hg.Function,vg=(Gv=ug("Tile"),Hv=dg([P]),qv=dg([B]),Vv=Ni.required,$v=cg({type:F,group:"Sprite"}),Wv=Ni.required,Kv=cg({type:F,group:"Sprite"}),jv=Ni.required,Yv=cg({type:F,group:"Sprite"}),Xv=Ni.required,Jv=cg({type:F,group:"Sprite"}),Zv=Ni.required,Qv=cg({type:F,group:"Sprite"}),ef=Ni.required,tf=cg({type:P,displayName:"Background UI Transform"}),nf=Ni.required,af=cg(ue),of=Ni.required,rf=cg({type:B,group:"Opacity"}),lf=Ni.required,sf=cg({type:B,group:"Opacity"}),uf=Ni.required,cf=cg({type:B,group:"Opacity"}),df=Ni.required,hf=cg({type:B,group:"Opacity"}),pf=Ni.required,yf=cg({type:B,group:"Opacity"}),vf=Ni.required,ff=cg({type:B,group:"Opacity"}),gf=Ni.required,mf=cg({type:B,group:"Opacity"}),bf=Ni.required,wf=cg(Cr),Sf=Ni.required,kf=cg(q),Cf=Ni.required,Ef=cg({type:ce,group:"Animation"}),Af=Ni.required,Tf=cg({type:de,group:"Animation"}),Pf=Ni.required,Of=cg({type:de,group:"Animation"}),Lf=Ni.required,If=cg({type:de,group:"Animation"}),Rf=Ni.required,_f=cg({type:de,group:"Animation"}),Df=Ni.onlyRunInLifeCycle,Mf=Ni.onlyRunInLifeCycle,Nf=Ni.onlyRunInLifeCycle,Bf=Ni.onlyRunInLifeCycle,Ff=Ni.onlyRunInLifeCycleAsync,xf=Ni.onlyRunInLifeCycleAsync,Gv(zf=Hv(zf=qv((Gf=a((Uf=function(a){n(w,a);var s,u,c,d,h,p,y,f,g,m,b=i(w);function w(){var e;t(this,w);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=b.call.apply(b,[this].concat(i)),r(e,"iconPlaceholder",Gf,l(e)),r(e,"icon",Hf,l(e)),r(e,"bombComponent",qf,l(e)),r(e,"starComponent",Vf,l(e)),r(e,"background",$f,l(e)),r(e,"bgUITransform",Wf,l(e)),r(e,"defaultBackground",Kf,l(e)),r(e,"uiOpacity",jf,l(e)),r(e,"shineOpacity",Yf,l(e)),r(e,"glowOpacity",Xf,l(e)),r(e,"iconOpacity",Jf,l(e)),r(e,"iconPlaceholderOpacity",Zf,l(e)),r(e,"bombUiOpacity",Qf,l(e)),r(e,"startUiOpacity",eg,l(e)),r(e,"button",tg,l(e)),r(e,"container",ng,l(e)),r(e,"animationComponent",ig,l(e)),r(e,"clearClip",ag,l(e)),r(e,"shakeClip",og,l(e)),r(e,"breakClip",rg,l(e)),r(e,"lightningClearClip",lg,l(e)),e.id=null,e.frames=[],e.isEmpty=!1,e.coord=new ae,e.mainSignalController=new pg.SignalController,e.identitySignalController=new pg.SignalController,e.placeholderSignalController=new pg.SignalController,e.specialSignalController=new pg.SignalController,e}return e(w,[{key:"onLoad",value:function(){Ni.validateRequiredProperties(this,w),this.special=this.createSpecialHandler(at.none)}},{key:"update",value:function(e){var t;(null===(t=this.special)||void 0===t?void 0:t.type)===at.bomb&&this.special.update(e)}},{key:"onDestroy",value:function(){var e,t;(null===(e=this.special)||void 0===e?void 0:e.type)!==at.none&&(null===(t=this.special)||void 0===t||t.onDestroy())}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(e,t){this.coord.set(e,t)}},{key:"isSimilarTo",value:function(e){return this.id===e.id}},{key:"inSamePositionAs",value:function(e,t){return e instanceof w?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===t}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(Es.TILE_CLICK,this)}},{key:"setIdentity",value:function(e,t){this.id=e,this.frames=t,this.updateIdentityFrame()}},{key:"updateIdentityFrame",value:(m=o((function*(){var e,t=this;if(null!==this.id){var n=this.identitySignalController.renew();if(!Array.isArray(this.frames)){this.setPlaceholderVisible(!0,n);var i=yield this.frames;if(n.aborted)return;this.frames=i}var a=this.frames[this.id];a?(this.setPlaceholderVisible(!1,n),null===(e=n.wrap((function(){return t.setIdentityFrame(a)})))||void 0===e||e()):console.error("Failed to load identity frame. ".concat(this.id," is not in the frames array."))}})),function(){return m.apply(this,arguments)})},{key:"setPlaceholderVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=this.placeholderSignalController.renew();if(t&&n.chain(t),e)return Ve.runTweenAsync(R(this.iconPlaceholder.node).to(.15,{scale:V.ONE},{easing:"backOut"}),n),void Ve.runTweenAsync(R(this.iconPlaceholderOpacity).delay(he(0,.75)).to(.15,{opacity:255}).repeatForever(R(this.iconPlaceholderOpacity).to(.25,{opacity:80}).delay(.25).to(.25,{opacity:255}).delay(.75)),n);Ve.runTweenAsync(R(this.iconPlaceholder.node).to(.15,{scale:V.ZERO},{easing:"backIn"}),n),Ve.runTweenAsync(R(this.iconPlaceholderOpacity).to(.15,{opacity:0}),n)}},{key:"setIdentityFrame",value:function(e,t){var n=this;this.icon.spriteFrame=e;var i=this.getSize(),a=v(i,2),o=a[0],r=a[1],l=e.originalSize,s=l.width,u=l.height,c=Math.max(s/(.7*o),u/(.7*r));this.icon.node.setScale(0,0,0);var d=function(){n.icon.node.setScale(1/c,1/c,1)};null==t||t.once(d),Ve.runTweenAsync(R(this.icon.node).delay(he(0,.2)).to(.15,{scale:new V(1/c,1/c,1)},{easing:"sineOut"}),t),null==t||t.off(d)}},{key:"setSpecialType",value:function(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at.none,a=arguments.length>1?arguments[1]:void 0;if(null===(e=this.special)||void 0===e||e.switch(i,a),(null===(t=this.special)||void 0===t?void 0:t.type)===at.bomb||(null===(n=this.special)||void 0===n?void 0:n.type)===at.star){var o=this.special;if(!Array.isArray(this.frames)){var r=this.specialSignalController.renew();o.hide(r,!0),this.frames.then((function(){o.isDestroyed||o.show(r)}))}}}},{key:"setFocused",value:(g=o((function*(e){var t=R(this.shineOpacity).to(.15,{opacity:e?255:0},{easing:"cubicOut"});this.shineOpacity.node.scale=e?V.ZERO:V.ONE;var n=R(this.shineOpacity.node).to(.15,{scale:e?V.ONE:V.ZERO},{easing:"cubicOut"});if(e){var i=R(this.glowOpacity).to(2,{opacity:150});i.to(2,{opacity:20}),this.glowOpacityTween=R(this.glowOpacity).repeatForever(i).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;yield Promise.all([Ve.runTweenAsync(t),Ve.runTweenAsync(n)])})),function(e){return g.apply(this,arguments)})},{key:"setEmpty",value:function(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isEmpty||(this.mainSignalController.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),i||(null===(e=this.special)||void 0===e?void 0:e.type)!==at.star&&(null===(t=this.special)||void 0===t?void 0:t.type)!==at.bomb||this.special.clear(),this.setOpacity(0),null===(n=this.special)||void 0===n||n.switch(at.none))}},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e}},{key:"setHint",value:(f=o((function*(e){var t,n=this.mainSignalController.renew();if(e)yield this.runAnimation(this.shakeClip.name,n);else if(null===(t=this.animationComponent)||void 0===t||t.stop(),this.container){var i=R(this.container).to(.1,{scale:V.ONE,eulerAngles:V.ZERO});yield Ve.runTweenAsync(i,n)}})),function(e){return f.apply(this,arguments)})},{key:"playClearFX",value:(y=o((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.mainSignalController.renew();this.setOpacity(255);var a=function(){return t.setOpacity(0)},o=n?this.lightningClearClip:this.clearClip;i.once(a),yield this.runAnimationAfterDelay(o.name,e,i),i.off(a),i.aborted||a()})),function(e){return y.apply(this,arguments)})},{key:"playOldLightningClearFX",value:(p=o((function*(){var e=this,t=this.mainSignalController.renew();this.setOpacity(255);var n=function(){return e.setOpacity(0)};t.once(n),yield this.runAnimation(this.breakClip.name,t),t.off(n),t.aborted||n()})),function(){return p.apply(this,arguments)})},{key:"runAnimationAfterDelay",value:(h=o((function*(e,t,n){t&&(yield Ve.waitTweenAsync(t,n)),yield this.runAnimation(e,n)})),function(e,t,n){return h.apply(this,arguments)})},{key:"runAnimation",value:function(e,t){return Ve.runAnimationAsync(this.animationComponent,e,t)}},{key:"restore",value:(d=o((function*(e,t){var n=this.mainSignalController.renew();this.animationComponent.stop(),this.isEmpty=!1,this.setIgnoreInput(!0),void 0!==e&&t&&this.setIdentity(e,t),this.setOpacity(255),this.iconOpacity.opacity=255,this.node.setScale(V.ZERO),this.background.spriteFrame=this.defaultBackground,this.button.fakeClick(),yield Ve.runTweenAsync(R(this.node).to(.3,{scale:V.ONE},{easing:"backOut"}),n),this.node.setScale(V.ONE),this.setIgnoreInput(!1)})),function(e,t){return d.apply(this,arguments)})},{key:"sync",value:(c=o((function*(e){var t=e.duration,n=void 0===t?.3:t,i=e.delay,a=void 0===i?0:i,o=e.easing,r=void 0===o?"cubicOut":o,l=(0,e.getTargetPosition)(this.coord),s=new V(l.x,l.y,this.node.position.z);yield Ve.runTweenAsync(R(this.node).delay(a).to(n,{position:s},{easing:r}))})),function(e){return c.apply(this,arguments)})},{key:"fly",value:(u=o((function*(e){var t=this,n=300,i=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),a=Math.max(n-.7*i,0),o=i/1e3,r=this.node.position.clone(),l=e.getTilePosition(this.coord),s=new V(l.x,l.y,this.node.position.z),u=this.container,c=2,d=1,h=360,p=.0025*a,y=0,v=new V(0,0,0),f=.75-p,g={value:0,prevElapsed:0},m=R(g);return m.delay(o),m.to(.5,{value:0},{progress:function(e,n,i,a){var o=(c*=-1)*a,l=r.clone();return l.x+=o,t.node.setPosition(l),i}}),m.to(p,{value:1},{progress:function(e,i,o,r){var l=Ve.easeOutExpo(r),s=p*r-g.prevElapsed,c=p*r,y=a*l;t.setHeight(y,n);var v=t.node.position.clone();d+=.1,V.rotateZ(v,v,new V(0,0,0),d*Math.PI*s),t.node.setPosition(new V(v.x,v.y,v.z));var f=(h+=10)*s;return u.angle+=f,g.prevElapsed=c,o}}),m.call((function(){v.set((t.node.position.x+s.x)/2,(t.node.position.y+s.y)/2,0),g.prevElapsed=0,u.angle%=360,u.angle-=360,y=u.angle})),m.to(f,{value:0},{progress:function(e,i,o,r){var l=f*r-g.prevElapsed,s=f*r,c=a*(1-r);t.setHeight(c,n);var d=t.node.position.clone();return V.rotateZ(d,d,v,Math.PI/f*l),t.node.setPosition(new V(d.x,d.y,d.z)),u.angle+=-y/f*l,g.prevElapsed=s,o}}),m.call((function(){t.node.setPosition(s),t.setHeight(0,n),u.angle=0})),Ve.runTweenAsync(m)})),function(e){return u.apply(this,arguments)})},{key:"moveAround",value:(s=o((function*(){for(var e=[{x:1,y:1},{x:-1,y:1},{x:-1,y:-1},{x:1,y:-1}],t=this.container.position.clone(),n=-1,i=0;i<5;i++){for(var a=te.randomRangeInt(0,4);n===a;)a=te.randomRangeInt(0,4);n=a;var o=e[a];if(o){var r=t.clone().add(new V(5*o.x,5*o.y)),l=R(this.container).to(.1,{position:r},{easing:"smooth"});yield Ve.runTweenAsync(l)}}var s=R(this.container).to(.1,{position:t},{easing:"smooth"});yield Ve.runTweenAsync(s)})),function(){return s.apply(this,arguments)})},{key:"setHeight",value:function(e,t){if(this.container){var n=this.container;n.setPosition(new V(n.position.x,e,0)),n.setScale(new V(1+e/t*.3,1+e/t*.3,1))}}},{key:"createSpecialHandler",value:function(e,t){var n=this;switch(e){case at.bomb:return this.createBombHandler(null!=t?t:90);case at.star:return this.createStarHandler();default:return{type:at.none,switch:function(e,t){n.special=n.createSpecialHandler(e,t)}}}}},{key:"createBombHandler",value:function(e){var t=this,n=!1,i=!1,a=e,o=function(){i=!0},r=function(){i=!1};this.node.scene.on(Es.TILE_CLICK,o),this.node.scene.on(Es.USE_ITEM,o),this.node.scene.on(Es.RESUME_TIME,o),this.node.scene.on(Es.PAUSE_TIME,r),this.node.scene.on(Es.TIME_OUT,r),this.bombComponent.node.active=!0;var l=function(){n=!0,i=!1,t.bombComponent.node.active=!1,a=e,t.node.scene.off(Es.TILE_CLICK,o),t.node.scene.off(Es.USE_ITEM,o),t.node.scene.off(Es.GAME_RESUME,o),t.node.scene.off(Es.GAME_PAUSE,r),t.node.scene.off(Es.TIME_OUT,r)};return{type:at.bomb,get isDestroyed(){return n},update:function(n){i&&(a-=n,t.bombComponent.fillRange=-a/e,a<=0&&(i=!1,t.bombComponent.node.active=!1,t.setEmpty(!0),t.node.scene.emit(Es.BOMB_EXPLODE,t)))},clear:function(){je.playSound(Qi.BOMB_DEFUSE)},cleanup:l,onDestroy:function(){n=!0,t.node.scene.off(Es.TILE_CLICK,o),t.node.scene.off(Es.USE_ITEM,o),t.node.scene.off(Es.GAME_RESUME,o),t.node.scene.off(Es.GAME_PAUSE,r),t.node.scene.off(Es.TIME_OUT,r)},switch:function(e,n){l(),t.special=t.createSpecialHandler(e,n)},show:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!n)return null==e||e.once((function(){t.bombUiOpacity.opacity=255})),yg.allSettled([Ve.runTweenAsync(R(t.bombUiOpacity).to(.1,{opacity:255},{easing:"cubicOut"}),e)]);t.bombUiOpacity.opacity=255},hide:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!n)return null==e||e.once((function(){t.bombUiOpacity.opacity=0})),yg.allSettled([Ve.runTweenAsync(R(t.bombUiOpacity).to(.1,{opacity:0},{easing:"cubicOut"}),e)]);t.bombUiOpacity.opacity=0},detonateImmediately:function(){a=0}}}},{key:"createStarHandler",value:function(){var e=this,t=!1;this.starComponent.node.active=!0;var n=function(){t=!0,e.starComponent.node.active=!1};return{type:at.star,get isDestroyed(){return t},clear:function(){e.starComponent.node.active=!1,je.playSound(Qi.COLLECT_STARS);var t=e.node.worldPosition,n=t.x,i=t.y;e.node.scene.emit(Es.ADD_STARS,{startAnimationAt:[n,i]})},cleanup:n,onDestroy:function(){t=!0},show:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!n)return null==t||t.once((function(){e.startUiOpacity.opacity=255})),yg.allSettled([Ve.runTweenAsync(R(e.startUiOpacity).to(.1,{opacity:255},{easing:"cubicOut"}),t)]);e.startUiOpacity.opacity=255},hide:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!n)return null==t||t.once((function(){e.startUiOpacity.opacity=0})),yg.allSettled([Ve.runTweenAsync(R(e.startUiOpacity).to(.1,{opacity:0},{easing:"cubicOut"}),t)]);e.startUiOpacity.opacity=0},switch:function(t){n(),e.special=e.createSpecialHandler(t)}}}}]),w}(T)).prototype,"iconPlaceholder",[Vv,$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hf=a(Uf.prototype,"icon",[Wv,Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qf=a(Uf.prototype,"bombComponent",[jv,Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vf=a(Uf.prototype,"starComponent",[Xv,Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$f=a(Uf.prototype,"background",[Zv,Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wf=a(Uf.prototype,"bgUITransform",[ef,tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=a(Uf.prototype,"defaultBackground",[nf,af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jf=a(Uf.prototype,"uiOpacity",[of,rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yf=a(Uf.prototype,"shineOpacity",[lf,sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=a(Uf.prototype,"glowOpacity",[uf,cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jf=a(Uf.prototype,"iconOpacity",[df,hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zf=a(Uf.prototype,"iconPlaceholderOpacity",[pf,yf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qf=a(Uf.prototype,"bombUiOpacity",[vf,ff],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eg=a(Uf.prototype,"startUiOpacity",[gf,mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tg=a(Uf.prototype,"button",[bf,wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ng=a(Uf.prototype,"container",[Sf,kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ig=a(Uf.prototype,"animationComponent",[Cf,Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ag=a(Uf.prototype,"clearClip",[Af,Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),og=a(Uf.prototype,"shakeClip",[Pf,Of],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rg=a(Uf.prototype,"breakClip",[Lf,If],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lg=a(Uf.prototype,"lightningClearClip",[Rf,_f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Uf.prototype,"setIgnoreInput",[Df],Object.getOwnPropertyDescriptor(Uf.prototype,"setIgnoreInput"),Uf.prototype),a(Uf.prototype,"setPlaceholderVisible",[Mf],Object.getOwnPropertyDescriptor(Uf.prototype,"setPlaceholderVisible"),Uf.prototype),a(Uf.prototype,"setIdentityFrame",[Nf],Object.getOwnPropertyDescriptor(Uf.prototype,"setIdentityFrame"),Uf.prototype),a(Uf.prototype,"setOpacity",[Bf],Object.getOwnPropertyDescriptor(Uf.prototype,"setOpacity"),Uf.prototype),a(Uf.prototype,"runAnimationAfterDelay",[Ff],Object.getOwnPropertyDescriptor(Uf.prototype,"runAnimationAfterDelay"),Uf.prototype),a(Uf.prototype,"runAnimation",[xf],Object.getOwnPropertyDescriptor(Uf.prototype,"runAnimation"),Uf.prototype),zf=Uf))||zf)||zf)||zf);S._RF.pop(),S._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),S._RF.pop(),S._RF.push({},"d65b2oe6HRJU7zJnHC2Jubi","BoardScale",void 0);function fg(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=n.x,o=n.y,r=v(t,2),l=r[0],s=r[1],u=l*(a-(e.width-1)/2)+i*(a-e.width/2),c=s*(o-(e.height-1)/2)+i*(o-e.height/2);return-1===a&&(u+=t[0]/4),a===e.width&&(u-=t[0]/4),-1===o&&(c+=t[1]/4),o===e.height&&(c-=t[1]/4),{x:u,y:c}}function gg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],n=v(e,2),i=n[0],a=n[1],o=v(t,2),r=o[0],l=o[1],s=1-r,u=1-l,c=i*s,d=a*u;return[c,d]}function mg(e){for(var t=e.split("-"),n=[],i=0;i<t.length;){var a=null;switch(t[i]){case"normal":i+=1;break;case"fall":a=iv,i+=2;break;case"fly":a=av,i+=2;break;case"push":"left"===t[i+1]?(a=ov,i+=2):(a=rv,i+=2);break;case"put":"columns"===t[i+1]?(a=lv,i+=3):(a=sv,i+=3)}a&&n.push(a)}return n}function bg(e){switch(e){case iv:return rv;case av:return ov;case ov:return iv;case rv:return av;case lv:return sv;case sv:return lv}}function wg(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.x,o=e.y,r=i?o:n-1-o,l=i?t-1-a:a;return{x:r,y:l}}function Sg(e){return(e instanceof sg?e.asArray():e).filter((function(e){return!e.isHidden()}))}function kg(e){return(e instanceof sg?e.asArray():e).filter((function(e){return e.isHidden()}))}S._RF.pop(),S._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),S._RF.pop(),S._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),S._RF.pop(),S._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),S._RF.pop(),S._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),S._RF.pop(),S._RF.push({},"60475oElENLe7C3g+jd0ZEl","rotateGravity",void 0),S._RF.pop(),S._RF.push({},"a1c1a/tPEpHy4ITkE80K0lL","rotatePath",void 0),S._RF.pop(),S._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),S._RF.pop(),S._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),S._RF.pop(),S._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),S._RF.pop(),S._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var Cg=Ludex.Utils.Object;function Eg(e){return Array.isArray(e)}function Ag(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=Eg(e)?e:e.asArray();return n[le(t,0,n.length)]}S._RF.pop(),S._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),S._RF.pop(),S._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var Tg=Ludex.Utils.Array;function Pg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e instanceof sg?e.asArray():e,i=Ag(n,t),a=Tg.search(n,(function(e){return e.isSimilarTo(i)&&!e.inSamePositionAs(i)}));if(void 0===a)throw new Error("Could not find a matching tile");return[i,a]}S._RF.pop(),S._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var Og=function(e){return e};function Lg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Og;return function*(){var i=e,a=t;i<=0&&(i=Number.POSITIVE_INFINITY);for(var o=0;o<i;o++)yield n(a),a=1e9*pe(a)}()}function Ig(e){return Array.isArray(e)}function Rg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=Ig(e)?e:e.asArray();if(i.length<t)return new Set(i);for(var a=new Set,o=Lg(-1,n),r=o.next();a.size<t;){if(r.done)throw new Error("RNG exhausted");a.add(Ag(i,r.value)),r=o.next()}return a}S._RF.pop(),S._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),S._RF.pop(),S._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),S._RF.pop(),S._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var _g=[1,2];function Dg(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=t.specials,o=a.bomb,r=le.apply(void 0,[i].concat(_g)),l=Rg(e,o,i),s=e.asArray().filter((function(e){return!l.has(e)})),c=Rg(s,r,i),d=u(l);try{for(d.s();!(n=d.n()).done;){var h=n.value,p=2*t.time/3;h.setSpecialType(at.bomb,p)}}catch(e){d.e(e)}finally{d.f()}var y,v=u(c);try{for(v.s();!(y=v.n()).done;){var f=y.value;f.setSpecialType(at.star)}}catch(e){v.e(e)}finally{v.f()}}S._RF.pop(),S._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),S._RF.pop(),S._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var Mg=Ludex.Utils.Array;function Ng(e){var t=e.levelData,n=t.columns,i=t.rows,a=e.identities,o=e.setTileIdentity,r=e.createTile,l=e.seed,s=function(e,t,n){var i,a=[],o=u(Lg(t/2,e,(function(e){return le(e,0,n.length)})));try{for(o.s();!(i=o.n()).done;){var r=i.value;a.push(n[r]),a.push(n[r])}}catch(e){o.e(e)}finally{o.f()}return Mg.shuffle(a),a}(void 0===l?Date.now():l,n*i,a),c=Bg(e.levelData,a,s).reverse(),d=Bg(e.levelData,a,c).reverse().map((function(e){var t=r(e);return o(t,e),t}));return new sg({width:n,height:i,content:d})}function Bg(e,t,n){var i=e.rows,a=e.columns,o=e.rules;if(!o.maxSpaceOfPair)return n;var r,l=function(e,t,n){for(var i=[],a=0;a<t;a++){i[a]=[];for(var o=0;o<n;o++)i[a][o]=e[a*n+o]}return i}(n,i,a),s=u(t);try{for(s.s();!(r=s.n()).done;)for(var c=r.value,d=null,h=null,p=0;p<i;p++)for(var y=0;y<a;y++){if(l[p][y]===c)if(d&&h){var v=o.maxSpaceOfPair+1;if(Math.abs(p-d)+Math.abs(y-h)<=v)h=y,d=p;else{var f=Fg(d,h,p,y),g=l[f.row][f.column];l[f.row][f.column]=l[p][y],l[p][y]=g}}else d=p,h=y}}catch(e){s.e(e)}finally{s.f()}return function(e){var t,n=[],i=u(e);try{for(i.s();!(t=i.n()).done;){var a,o=t.value,r=u(o);try{for(r.s();!(a=r.n()).done;){var l=a.value;n.push(l)}}catch(e){r.e(e)}finally{r.f()}}}catch(e){i.e(e)}finally{i.f()}return n}(l)}function Fg(e,t,n,i){var a=e,o=t;return n>e&&(a=e+1),n<e&&(a=e-1),i>t&&(o=t+1),i<t&&(o=t-1),{row:a,column:o}}S._RF.pop(),S._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var xg=Ludex.Utils.Array;function zg(e){var t=e.customFen,n=e.identities,i=e.createTile,a=t.idSize,o=t.cols,r=t.rows,l=t.code;if(n.length<t.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(n.length," to fill it according to fen code ").concat(a));var s=l.split(":");if(s.length!==r)throw new Error("Invalid grid code");var c=/[a-zA-Z]+\d+|./g,d=/[a-zA-Z]+/,h=/\d+/,p=s.reduceRight((function(e,a){var o,r=[],l=a.matchAll(c),s=u(l);try{for(s.s();!(o=s.n()).done;){var p,y,v=o.value[0],f=null===(p=h.exec(v))||void 0===p?void 0:p[0],g=void 0!==f?parseInt(f,10):void 0,m=void 0!==g&&!isNaN(g)&&g<n.length?n[g]:void 0,b=i(void 0!==m?m:n[0]),w=null===(y=d.exec(v))||void 0===y?void 0:y[0],S=void 0!==w?Ug(w,t.encoding):void 0;void 0!==S&&void 0!==m?b.setSpecialType(S):b.setEmpty(),r.push(b)}}catch(e){s.e(e)}finally{s.f()}return e.concat(r)}),[]);return new sg({width:o,height:r,content:p})}function Ug(e,t){var n=xg.search(Object.entries(t),(function(t){var n=v(t,2);n[0];return n[1]===e}));if(void 0===n)throw new Error("Invalid special type ".concat(e));return n[0]}function Gg(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.toRotated(t);return n.each((function(e,t,n){e.setCoord(t,n)})),n}S._RF.pop(),S._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),S._RF.pop(),S._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var Hg=Ludex.Utils.Array;function qg(e){var t=e.grid,n=e.setIdentity,i=e.seed,a=void 0===i?Date.now():i,o=t.asArray(),r=Ag(t,a),l=function(e,t){var n=t.getCoord(),i=n.x,a=n.y;return Cg.vals(nv).reduce((function(t,n){var o=n.x,r=n.y,l=i+o,s=a+r;return e.isInBounds(l,s)&&t.push(e.get(l,s)),t}),[])}(t,r);if(!l.some((function(e){return e.isSimilarTo(r)}))){var s=Ag(l,a),u=Hg.search(o,(function(e){return!e.inSamePositionAs(r)&&!e.inSamePositionAs(s)&&e.isSimilarTo(s)}));if(void 0===u||null===r.id)throw new Error("Could not find a sacrifice tile");n(u,r.id),n(s,r.id)}}S._RF.pop(),S._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),S._RF.pop(),S._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var Vg=[{startTile:{x:0,y:1},endTile:{x:3,y:1},localeTextKey:"guide.step1"},{startTile:{x:2,y:2},endTile:{x:3,y:0},localeTextKey:"guide.step2"},{startTile:{x:0,y:0},endTile:{x:3,y:3},localeTextKey:"guide.step3"},{startTile:{x:0,y:4},endTile:{x:2,y:3},localeTextKey:"guide.step4"},{startTile:{x:1,y:4},endTile:{x:1,y:2},localeTextKey:"guide.step5"}];S._RF.pop(),S._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var $g=Ludex.Utils.Array;function Wg(e,t){return e[0]===t[0]&&e[1]===t[1]}function Kg(e){return new ae(e[0],e[1])}function jg(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function Yg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jg;return t.map((function(t){return[e.tile[0]+t.x,e.tile[1]+t.y]}))}var Xg,Jg=[nv.Up,nv.Down,nv.Left,nv.Right],Zg=function(){function n(e,i){var a;if(t(this,n),this.f=0,this.g=0,this.h=0,i&&Wg(e,i.tile))throw new Error("Tile cannot be its own parent");this.tile=e,this.parent=i;var o=n.calcDirection(this),r=i&&o&&i.cache.direction&&!o.equals(i.cache.direction)?1:0;this.cache={direction:o,turns:r+(null!==(a=null==i?void 0:i.cache.turns)&&void 0!==a?a:0)}}return e(n,[{key:"getKey",value:function(){var e;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(e=this.cache.direction)||void 0===e?void 0:e.toString())}},{key:"equals",value:function(e){return this.getKey()===e.getKey()}}],[{key:"calcDirection",value:function(e){if(e.parent){var t=e.parent.tile,n=e.tile;return new ae(n[0]-t[0],n[1]-t[1])}return null}}]),n}();function Qg(e,t,n){var i=nm(e,t),a=nm(e,n);if(0===i.length||0===a.length)return em(t,n);var o=function(e,t,n){var i=[],a=[],o=new Zg(t,null),r=new Zg(n,null),l=[r.tile];i.push(o);for(;i.length>0;){var s=i.shift();if(a.push(s),Wg(s.tile,r.tile)){for(var c=[],d=s,h=s,p=s.parent;p;)p.cache.turns!==h.cache.turns&&(c.unshift({a:Kg(p.tile),b:Kg(d.tile)}),d=p),h=p,p=p.parent;return c.unshift({a:Kg(h.tile),b:Kg(d.tile)}),c}var y,v=Yg(s,nm(e,s.tile,l)),f=u(v);try{var g=function(){var e=y.value,t=new Zg(e,s);if(t.cache.turns>8)return 0;var n=Wg(t.tile,r.tile),o=a.some((function(e){return e.equals(t)}));if(i.some((function(e){return e.equals(t)}))||o&&!n)return 0;t.g=s.g+1+t.cache.turns,t.h=tm(t,r),t.f=t.g+t.h,i.push(t)};for(f.s();!(y=f.n()).done;)g()}catch(e){f.e(e)}finally{f.f()}i.sort((function(e,t){return e.f-t.f}))}return null}(e,t,n);return o||em(t,n)}function em(e,t){var n=Kg(e),i=Kg(t);return n.x===i.x||n.y===i.y?[{a:n,b:i}]:[{a:n,b:{x:n.x,y:i.y}},{a:{x:n.x,y:i.y},b:i}]}function tm(e,t){var n=e.tile,i=t.tile;return Math.abs(n[0]-i[0])+Math.abs(n[1]-i[1])}function nm(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=[],o=u(Jg);try{var r=function(){var o=n.value,r={x:t[0]+o.x,y:t[1]+o.y};if(e.isInBounds(r.x,r.y))return(e.get(r.x,r.y).isHidden()||$g.search(i,(function(e){return Wg(e,[r.x,r.y])})))&&a.push(o),1;jg(r,e)&&a.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}return a}S._RF.pop(),S._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),S._RF.pop(),S._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var im=(m(Xg={},at.bomb,"b"),m(Xg,at.star,"s"),m(Xg,at.none,"t"),Xg);function am(e){return e.reduce((function(e,t,n,i){return t.inSamePositionAs(n,i)||e.push([t,[n,i]]),e}),[])}function*om(e,t){for(var n=0,i=e-1,a=0,o=t-1;n<=i&&a<=o;){for(var r=n;r<=i;r++)yield{x:r,y:a};for(var l=++a;l<=o;l++)yield{x:i,y:l};for(var s=--i;s>=n;s--)yield{x:s,y:o};for(var u=--o;u>=a;u--)yield{x:n,y:u};n++}}S._RF.pop(),S._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),S._RF.pop(),S._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),S._RF.pop(),S._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var rm,lm,sm,um,cm,dm,hm,pm,ym,vm,fm,gm,mm=Ludex.Utils.Array,bm=function(){function n(e,i){t(this,n),this.coord=new ae(e,i)}return e(n,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),n}();function wm(e){return new ae(e[0],e[1])}function Sm(e,t,n){if(void 0===t||void 0===n)return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:om,i=[],a=u(n(e.width,e.height));try{for(a.s();!(t=a.n()).done;){var o=t.value,r=e.get(o.x,o.y);r.isHidden()||i.push([r,[o.x,o.y]])}}catch(e){a.e(e)}finally{a.f()}var l,s=[],c=function(){var t=i.shift(),n=v(t,2),a=n[0],o=n[1];if(mm.search(s,(function(e){return Em(e,o)})))return 0;s.push(o);for(var r,l=function(){var t=v(c[u],2),n=t[0],i=t[1];if(!n.isSimilarTo(a)||mm.search(s,(function(e){return Em(e,i)})))return 0;var r=Sm(e,o,i);return null!==r?{v:{v:r}}:void 0},u=0,c=i;u<c.length;u++)if(0!==(r=l())&&r)return r.v};for(;i.length>0;)if(0!==(l=c())&&l)return l.v;return null}(e);var i,a=[t[0]+1,t[1]+1],o=[n[0]+1,n[1]+1],r=function(e){var t=mm.fillWith(e.width+2,(function(e){return new bm(e-1,-1)})),n=mm.fillWith(e.width+2,(function(t){return new bm(t-1,e.height)})),i=mm.fillWith(e.height,(function(e){return new bm(-1,e)})),a=mm.fillWith(e.height,(function(t){return new bm(e.width,t)})),o=function(o,r){var l=o-1,s=r-1;return-1===l?i[s]:l===e.width?a[s]:-1===s?t[l]:s===e.height?n[l]:e.get(l,s)};return{get:function(e,t){return o(e,t)},width:e.width+2,height:e.height+2}}(e),l=[a,o];if(a[0]===o[0]&&Tm(r,l,a[1],o[1],a[0])||a[1]===o[1]&&Pm(r,l,a[0],o[0],a[1]))return Im([{a:wm(a),b:wm(o)}],{x:-1,y:-1});var s=a[1]<=o[1]?a:o,c=a[1]<=o[1]?o:a,d=a[0]<=o[0]?a:o,h=a[0]<=o[0]?o:a,p=[],y=[],f=Om(r,l,1,wm(s),wm(c)),g=Om(r,l,-1,wm(s),wm(c));-1===f&&-1===g||(i=-1!==f?f:g,p=[{a:wm(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:o[0],y:i}},{a:{x:o[0],y:i},b:wm(o)}]);var m=Lm(r,l,1,wm(d),wm(h)),b=Lm(r,l,-1,wm(d),wm(h));-1===m&&-1===b||(i=-1!==m?m:b,p=[{a:wm(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:o[1]}},{a:{x:i,y:o[1]},b:wm(o)}]);var w=function(e,t,n,i){for(var a=n.y+1;a<i.y;a++)if(Tm(e,t,n.y,a,n.x)&&Pm(e,t,n.x,i.x,a)&&Tm(e,t,a,i.y,i.x))return a;return-1}(r,l,wm(s),wm(c));-1!==w&&(i=w,y=[{a:wm(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:o[0],y:i}},{a:{x:o[0],y:i},b:wm(o)}]);var S=function(e,t,n,i){for(var a=n.x+1;a<i.x;a++)if(Pm(e,t,n.x,a,n.y)&&Tm(e,t,n.y,i.y,a)&&Pm(e,t,a,i.x,i.y))return a;return-1}(r,l,wm(d),wm(h));return-1!==S&&(i=S,y=[{a:wm(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:o[1]}},{a:{x:i,y:o[1]},b:wm(o)}]),p.length>0&&y.length>0?Im(km(p)<=km(y)?p:y,{x:-1,y:-1}):p.length>0?Im(p,{x:-1,y:-1}):y.length>0?Im(y,{x:-1,y:-1}):null}function km(e){var t,n=0,i=u(e);try{for(i.s();!(t=i.n()).done;){n+=Cm(t.value)}}catch(e){i.e(e)}finally{i.f()}return n}function Cm(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function Em(e,t){return e[0]===t[0]&&e[1]===t[1]}function Am(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=e.get.apply(e,g(t));return i.isHidden()||n.some((function(e){return Em(e,t)}))}function Tm(e,t,n,i,a){for(var o=Math.min(n,i),r=Math.max(n,i),l=o;l<=r;l++)if(!Am(e,[a,l],t))return!1;return!0}function Pm(e,t,n,i,a){for(var o=Math.min(n,i),r=Math.max(n,i),l=o;l<=r;l++)if(!Am(e,[l,a],t))return!1;return!0}function Om(e,t,n,i,a){var o=1===n?a.y:i.y,r=1===n?i.x:a.x;if(Tm(e,t,i.y,a.y,r))for(;o>=0&&o<e.height&&Am(e,[i.x,o],t)&&Am(e,[a.x,o],t);){if(Pm(e,t,i.x,a.x,o))return o;o+=n}return-1}function Lm(e,t,n,i,a){var o=1===n?a.x:i.x,r=1===n?i.y:a.y;if(Pm(e,t,i.x,a.x,r))for(;o>=0&&o<e.width&&Am(e,[o,i.y],t)&&Am(e,[o,a.y],t);){if(Tm(e,t,i.y,a.y,o))return o;o+=n}return-1}function Im(e,t){return e.map((function(e){return{a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}}}))}S._RF.pop(),S._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var Rm=C.ccclass,_m=C.property,Dm=C.requireComponent,Mm=codex.monitorError,Nm=Ludex.Utils,Bm=Nm.Array,Fm=Nm.Function,xm=Nm.Valid,zm=Ke.Layout,Um=(rm=Rm("Board"),lm=Dm(P),sm=Ni.required,um=_m(vg),cm=Ni.required,dm=_m(q),hm=_m({displayName:"Tile Spacing",group:"Create config"}),rm(pm=lm((vm=a((ym=function(a){n(y,a);var s,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"tilePrefab",vm,l(e)),r(e,"tilesHolder",fm,l(e)),r(e,"tileTrim",gm,l(e)),e.tileSize=[0,0],e.selectedTile=null,e.isPlayingEffect=!1,e.useRotatedGameplay=!1,e.dirtyGameplayRotation=!1,e.parsedGravityRules=[],e.normalMatches=0,e.normalMatchesSinceLastSpawn=0,e.spawnAttempts=0,e.hintPath=null,e.hintTiles=null,e.isAnimating=!1,e.animationQueue=[],e.isConsumingAnimation=!1,e.handleViewResized=Fm.debounce((function(){if(!e.isPlayingEffect&&(e.updateTilesHolderScale(),e.levelData)){var t=e.shouldRotate(e.levelData);e.dirtyGameplayRotation=e.useRotatedGameplay!==t,e.dirtyGameplayRotation&&e.consumeAnimationQueue()}}),100),e}return e(y,[{key:"onLoad",value:function(){this.widget=this.getComponent(I),this.uiTransform=this.getComponent(P),Ni.validateRequiredProperties(this,y),this.tilePrefab.node.active=!1,this.listenEvents()}},{key:"onDestroy",value:function(){this.unlistenEvents()}},{key:"shouldRotate",value:function(e){return 0!==e.level&&e.rows>e.columns!==this.uiTransform.height>this.uiTransform.width}},{key:"create",value:(h=o((function*(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();this.levelData=t,this.handleOrientationChanged(Je.getCurrentLayout()),yield Ve.waitTweenAsync(0);var a=e.then((function(e){var n=g(e);Bm.shuffle(n);var i=n.slice(0,t.colors);return null==Mm||Mm.addMetadata({frames:i.map((function(e){return e.name}))}),i})),o=Bm.fillWith(t.colors,(function(e){return e}));this.useRotatedGameplay=this.shouldRotate(t)&&0!==this.levelData.level,this.parsedGravityRules=mg(t.mode);var r=function(e){var t=ye(n.tilePrefab.node),i=t.getComponent(vg);return i.setIdentity(e,a),n.tilesHolder.addChild(t),t.active=!0,i},l=!1;if(void 0!==t.customFen)try{l=!0,this.grid=zg({customFen:t.customFen,identities:o,createTile:r}),this.useRotatedGameplay&&(this.grid=Gg(this.grid)),this.grid.each((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),l=!1}l||(this.grid=Ng({levelData:t,seed:i,identities:o,createTile:r,setTileIdentity:function(e,t){return e.setIdentity(t,a)}}),this.useRotatedGameplay&&(this.grid=Gg(this.grid)),this.grid.each((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),qg({grid:this.grid,setIdentity:function(e,t){return e.setIdentity(t,a)},seed:i}),Dg(this.grid,t,i));var s=[this.tileTrim.x,this.tileTrim.y];this.tileSize=gg(this.tilePrefab.getSize(),s),this.updateTilesHolderScale(),this.node.scene.emit(Es.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()})),function(e,t){return h.apply(this,arguments)})},{key:"updateTilesHolderScale",value:function(){if(this.grid){var e=[this.grid.width,this.grid.height],t=[this.uiTransform.width,this.uiTransform.height],n=function(e,t,n){var i=v(e,2),a=i[0],o=i[1],r=v(t,2),l=r[0],s=r[1],u=v(n,2),c=u[0]/(a*l),d=u[1]/(o*s);return Math.min(Math.min(c,d),2.25)}(e,this.tilePrefab.getSize(),t);this.tilesHolder.setScale(n,n),this.node.scene.emit(Es.GRID_RESIZE,n)}}},{key:"destroyTiles",value:function(){var e;null===(e=this.grid)||void 0===e||e.each((function(e){return e.node.destroy()}))}},{key:"animateTilesAppear",value:function(){var e=this;if(!this.grid){var t=new Error("animateTilesAppear: Grid is not initialized");if(xm.isDebugger())throw t;return null==Mm||Mm.sendException(t),Promise.resolve()}var n=this.grid;return new Promise((function(t){var i=function(){var i=o((function*(){var i=function(t){return fg(n,e.tileSize,t)};yield Promise.all(n.map((function(t,a,o){var r=he(0,.5),l=t.node.scale.clone(),s=function(t,n){var i,a=ae.ZERO.clone(),o=u(e.parsedGravityRules);try{for(o.s();!(i=o.n()).done;){var r=i.value,l=e.useRotatedGameplay?bg(r):r,s=e.getPrimitiveDirection(t,n,l);a.subtract2f(s.x,s.y)}}catch(e){o.e(e)}finally{o.f()}return a.normalize()}(a,o),c=fg(n,e.tileSize,{x:a,y:o}),d=s.multiplyScalar(100).add2f(c.x,c.y);return t.node.setPosition(d.x,d.y),t.node.setScale(0,0),Promise.all([Ve.runTweenAsync(R(t.node).delay(r).to(.5,{scale:l},{easing:"elasticOut"})),t.sync({getTargetPosition:i,easing:"backOut",duration:.5,delay:r})])}))),t()}));return function(){return i.apply(this,arguments)}}();e.animationQueue.push(i),e.consumeAnimationQueue()}))}},{key:"animateTilesWave",value:function(){var e=this;if(!this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","animateTilesWave"),Promise.resolve();var t=this.grid;return new Promise((function(n){var i=function(){var e=o((function*(){var e=function(e,t){for(var n=t.x,i=t.y,a="center"===e?{x:(n-1)/2,y:(i-1)/2}:e,o=a.x,r=a.y,l=[],s=0;s<n;s++){for(var u=[],c=0;c<i;c++){var d=o-s,h=r-c,p=Math.sqrt(d*d+h*h);u.push(p)}l.push(u)}return l}("center",{x:t.width,y:t.height});yield Promise.all(t.map((function(t,n,i){var a,o,r=.1*(null!==(a=null===(o=e[n])||void 0===o?void 0:o[i])&&void 0!==a?a:0),l=t.node.scale.clone();return Promise.all([Ve.runTweenAsync(R(t.node).delay(r).to(.25,{scale:l.clone().multiplyScalar(1.2)},{easing:"quadOut"}).to(.25,{scale:l},{easing:"quadIn"}))])}))),n()}));return function(){return e.apply(this,arguments)}}();e.animationQueue.push(i),e.consumeAnimationQueue()}))}},{key:"animateTilesError",value:(d=o((function*(e){if(!this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","animateTilesError"),Promise.resolve();this.isAnimating||(this.isAnimating=!0,yield Promise.all(e.map((function(e){return e.moveAround()}))),this.isAnimating=!1)})),function(e){return d.apply(this,arguments)})},{key:"handleTileClick",value:function(e){if(!e.isHidden()){if(this.selectedTile===e)return je.playSound(Qi.TILE_SELECT),this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return je.playSound(Qi.TILE_SELECT),this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return je.playSound(Qi.TILE_SELECT),this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(e,t){if(this.grid&&this.levelData){var n=[e.getCoord().x,e.getCoord().y],i=[t.getCoord().x,t.getCoord().y],a=Sm(this.grid,n,i);if(null===a){je.playSound(Qi.INVALID_MATCH),this.animateTilesError([e,t]);var o=0===this.levelData.level,r=function(e,t,n,i){if(i){var a=Vg[4].startTile,o=Vg[4].endTile;if(t[0]===a.x&&t[1]===a.y&&n[0]===o.x&&n[1]===o.y)return[{a:a,b:o}];if(t[0]===o.x&&t[1]===o.y&&n[0]===a.x&&n[1]===a.y)return[{a:a,b:o}]}return Qg(e,t,n)}(this.grid,n,i,o);return this.node.scene.emit(Es.GRID_MATCH,[e,t]),void this.node.scene.emit(Es.GRID_MATCH_FAIL,r)}je.playSound(Qi.TILE_MATCH),this.node.scene.emit(Es.GRID_MATCH,[e,t]),this.node.scene.emit(Es.GRID_MATCH_SUCCESS,a,[e,t]),this.clear({pairs:[[e,t]]})}else this.reportOrThrowInDebugger("Grid is not initialized","match")}},{key:"clear",value:function(e){var t=this,n=e.pairs,i=e.stagger,a=void 0===i?0:i,o=e.delay,r=void 0===o?0:o,l=e.lightning,s=void 0!==l&&l;this.normalMatches+=n.length;for(var u=0;u<n.length;u++){var c=n[u],d=v(c,2),h=d[0],p=d[1],y=a?2*u*a:0,f=a?(2*u+1)*a:0;h.setEmpty(),p.setEmpty(),h.playClearFX(y,s),p.playClearFX(f,s),this.node.scene.emit(Es.GRID_CLEAR,[h,p])}Ve.waitTweenAsync(r).then((function(){t.processGameplayCycle()}))}},{key:"clearUsingOldLightningFX",value:function(e){this.normalMatches+=e.length;var t,n=u(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=v(i,2),o=a[0],r=a[1];o.setEmpty(),r.setEmpty(),o.playOldLightningClearFX(),r.playOldLightningClearFX(),this.node.scene.emit(Es.GRID_CLEAR,[o,r])}}catch(e){n.e(e)}finally{n.f()}this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var e=this.hintPath[0],t=this.hintPath[this.hintPath.length-1];if(e&&t){var n=e.a,i=t.b,a=this.getTileAt(n.x,n.y),o=this.getTileAt(i.x,i.y);a&&o?(a.setHint(!0),o.setHint(!0),this.hintTiles=[a,o]):this.reportOrThrowInDebugger("Hint tiles are not valid","showHint")}else this.reportOrThrowInDebugger("Hint path is not valid","showHint")}}},{key:"hideHint",value:function(){if(this.hintTiles){var e=v(this.hintTiles,2),t=e[0],n=e[1];t.setHint(!1),n.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(e,t){return this.grid&&this.grid.isInBounds(e,t)?this.grid.get(e,t):null}},{key:"getAnyTileWorldPosition",value:function(e,t){if(!this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getAnyTileWorldPosition"),{x:0,y:0};var n=fg(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(n.x,n.y);var i=this.tilePrefab.node.getWorldPosition();return{x:i.x,y:i.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return this.grid?[this.grid.width,this.grid.height]:(this.reportOrThrowInDebugger("Grid is not initialized","getGridSize"),[0,0])}},{key:"getUncleared",value:function(){return this.grid?Sg(this.grid):(this.reportOrThrowInDebugger("Grid is not initialized","getUncleared"),[])}},{key:"getCleared",value:function(){return this.grid?kg(this.grid):(this.reportOrThrowInDebugger("Grid is not initialized","getCleared"),[])}},{key:"getBombTiles",value:function(){return this.grid?Sg((e=this.grid)instanceof sg?e.asArray():e).filter((function(e){var t;return(null===(t=e.special)||void 0===t?void 0:t.type)===at.bomb})):(this.reportOrThrowInDebugger("Grid is not initialized","getBombTiles"),[]);var e}},{key:"getPairs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getPairs"),[];for(var n=[],i=t?Sg(this.grid):kg(this.grid),a=function(){var e=Pg(i),t=v(e,2),a=t[0],o=t[1];n.push([a,o]),i=i.filter((function(e){return e!==a&&e!==o}))};n.length<e;)a();return n}},{key:"getBoundingBoxWorld",value:function(){var e=this.tilesHolder.getWorldScale().x,t=this.getGridSize(),n=this.tileSize[0]*e*t[0],i=this.tileSize[1]*e*t[1],a=this.node.getWorldPosition().subtract3f(n/2,i/2,0);return new te.Rect(a.x,a.y,n,i)}},{key:"setIgnoreInput",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];null===(e=this.grid)||void 0===e||e.each((function(e){return e.setIgnoreInput(t)}))}},{key:"processShuffleRequest",value:function(e){if(this.grid){var t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}else this.reportOrThrowInDebugger("Grid is not initialized","processShuffleRequest")}},{key:"generateFenFromCurrentLevel",value:function(e){var t;return this.levelData||this.reportOrThrowInDebugger("Level data is not initialized","generateFenFromCurrentLevel"),y.generateFen(null!==(t=null!=e?e:this.levelData)&&void 0!==t?t:Fv)}},{key:"listenEvents",value:function(){D.on($e.VIEW_RESIZED,this.handleViewResized),D.on($e.WIDGET_RESIZED,this.handleViewResized),D.on($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.node.scene.on(Es.EFFECTS_ANIMATION_START,this.onEffectAnimStarted,this),this.node.scene.on(Es.EFFECTS_ANIMATION_END,this.onEffectAnimEnded,this)}},{key:"unlistenEvents",value:function(){D.off($e.VIEW_RESIZED,this.handleViewResized),D.off($e.WIDGET_RESIZED,this.handleViewResized),D.off($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.node.scene.off(Es.EFFECTS_ANIMATION_START,this.onEffectAnimStarted,this),this.node.scene.off(Es.EFFECTS_ANIMATION_END,this.onEffectAnimEnded,this)}},{key:"onEffectAnimStarted",value:function(){this.isPlayingEffect=!0}},{key:"onEffectAnimEnded",value:function(){this.isPlayingEffect=!1,this.handleOrientationChanged(Je.getCurrentLayout()),this.handleViewResized()}},{key:"getWidgetMargins",value:function(e){return e!==zm.Landscape||void 0!==this.levelData&&0===this.levelData.level?{top:160,bottom:160,left:20,right:20}:{top:80,bottom:80,left:640,right:60}}},{key:"handleOrientationChanged",value:function(e){if(!this.isPlayingEffect){var t=this.getWidgetMargins(e),n=t.top,i=t.bottom,a=t.left,o=t.right;this.widget.top=n,this.widget.bottom=i,this.widget.left=a,this.widget.right=o}}},{key:"processGameplayCycle",value:function(){if(this.node.activeInHierarchy&&this.grid&&this.levelData){var e=Sg(this.grid);if(0!==e.length){var t=this.grid,n=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,i=this.normalMatchesSinceLastSpawn>=2;n&&(i?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length%2==1&&this.processSpawnSingleTileStep(),e.length>14&&(t=this.processGravitationStep(t));var a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}}else this.reportOrThrowInDebugger("Grid is not initialized","processGameplayCycle")}},{key:"processSpawnStep",value:function(){var e,t;if(this.grid){var n=Rg(kg(this.grid),2),i=v(n,2),a=i[0],o=i[1],r=null!==(e=null==a?void 0:a.id)&&void 0!==e?e:void 0,l=null!==(t=null==a?void 0:a.frames)&&void 0!==t?t:void 0;void 0!==a&&void 0!==r&&void 0!==l&&void 0!==o?(a.restore(),o.restore(r,l),this.node.scene.emit(Es.GRID_SPAWN,[a,o])):this.reportOrThrowInDebugger("Failed to get random tiles","processSpawnStep")}else this.reportOrThrowInDebugger("Grid is not initialized","processSpawnStep")}},{key:"processGravitationStep",value:function(e){var t,n=this,i=e,a=[],r=u(this.parsedGravityRules);try{var l=function(){var e=t.value,r=n.useRotatedGameplay?bg(e):e,l=am(i=n.toGravitated(i,r));if(0===l.length)return 1;var s,c=u(l);try{for(c.s();!(s=c.n()).done;){var d=v(s.value,2),h=d[0],p=v(d[1],2),y=p[0],f=p[1];h.setCoord(y,f)}}catch(e){c.e(e)}finally{c.f()}i.each((function(e){e.node.setSiblingIndex(0)}));var g=function(){var e=o((function*(){yield Promise.all(l.map((function(e){var t=v(e,2),a=t[0],o=v(t[1],2),r=o[0],l=o[1];return a.sync({delay:.25,duration:.25,getTargetPosition:function(){return fg(i,n.tileSize,{x:r,y:l})}})})))}));return function(){return e.apply(this,arguments)}}();a.push(g)};for(r.s();!(t=r.n()).done;)l()}catch(e){r.e(e)}finally{r.f()}var s=function(){var e=o((function*(){for(var e=0,t=a;e<t.length;e++){var n=t[e];yield n()}}));return function(){return e.apply(this,arguments)}}();return this.animationQueue.push(s),i}},{key:"toGravitated",value:function(e,t){var n=new sg(e),i=e.height-1,a=e.width-1,o=[0,i],r=[0,a],l=Math.floor(e.height/2),s=Math.floor(e.width/2),u=function(e){return e.isHidden()};switch(t){case iv:n.gravitate({rowRange:o,colRange:r,direction:nv.Down,isLighter:u});break;case av:n.gravitate({rowRange:o,colRange:r,direction:nv.Up,isLighter:u});break;case ov:n.gravitate({rowRange:o,colRange:r,direction:nv.Left,isLighter:u});break;case rv:n.gravitate({rowRange:o,colRange:r,direction:nv.Right,isLighter:u});break;case lv:n.gravitate({rowRange:o,colRange:[s,a],direction:nv.Left,isLighter:u,out:n.gravitate({rowRange:o,colRange:[0,s-1],direction:nv.Right,isLighter:u})});break;case sv:n.gravitate({rowRange:[l,i],colRange:r,direction:nv.Down,isLighter:u,out:n.gravitate({rowRange:[0,l-1],colRange:r,direction:nv.Up,isLighter:u})})}return n}},{key:"getPrimitiveDirection",value:function(e,t,n){if(!this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getPrimitiveDirection"),nv.Down;var i=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(n){case iv:return nv.Down;case av:return nv.Up;case ov:return nv.Left;case rv:return nv.Right;case lv:return e>=a?nv.Left:nv.Right;case sv:return t>=i?nv.Down:nv.Up}}},{key:"processShuffleStep",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0,o=Sm(e),r=Sg(e).map((function(e){var t=e.getCoord();return[t.x,t.y]}));if(null!==o&&!i)return[e,o];var l=100;do{var s=e.toShuffled(r),c=v(s,1);o=Sm(n=c[0]),l--}while(null===o&&l>0);if(l<=0){var d,h,p,y,f=n.asArray().map((function(e){var t;return{name:e.id,type:null===(t=e.special)||void 0===t?void 0:t.type,active:!e.isHidden()}}));return null==Mm||Mm.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",level:null===(d=this.levelData)||void 0===d?void 0:d.level,rules:null===(h=this.levelData)||void 0===h?void 0:h.rules,mode:null===(p=this.levelData)||void 0===p?void 0:p.mode,gridAsArray:f}),this.node.scene.emit(Es.GAME_EXIT),[e,null!==(y=o)&&void 0!==y?y:[]]}var g,m=am(n),b=u(m);try{for(b.s();!(g=b.n()).done;){var w=v(g.value,2),S=w[0],k=v(w[1],2),C=k[0],E=k[1];S.setCoord(C,E)}}catch(e){b.e(e)}finally{b.f()}var A=void 0!==a?function(){return a(e,n)}:this.createShuffleAnimationHandler(e,n);return this.animationQueue.push(A),[n,null!==(t=o)&&void 0!==t?t:[]]}},{key:"createShuffleAnimationHandler",value:function(e,t){var n=this,i=function(){var i=o((function*(){yield Promise.all(e.map((function(e,i,a){return e.sync({duration:.3,easing:"smooth",getTargetPosition:function(){return fg(t,n.tileSize,{x:i,y:a},10)}})})))}));return function(){return i.apply(this,arguments)}}(),a=function(){var e=o((function*(){t.each((function(e){e.node.setSiblingIndex(0)})),yield Promise.all(t.map((function(e){return e.sync({duration:.4,easing:"smooth",delay:he(0,.2),getTargetPosition:function(e){return fg(t,n.tileSize,e)}})})))}));return function(){return e.apply(this,arguments)}}();return function(){var e=o((function*(){yield i(),yield a()}));return function(){return e.apply(this,arguments)}}()}},{key:"processSpawnSingleTileStep",value:function(){if(this.grid){var e,t=Rg(kg(this.grid),1),n=v(t,1)[0],i=Sg(this.grid),a={},o=u(i);try{for(o.s();!(e=o.n()).done;){var r,l=e.value.id;null!==l&&(a[l]=(null!==(r=a[l])&&void 0!==r?r:0)+1)}}catch(e){o.e(e)}finally{o.f()}var s=Bm.search(i,(function(e){var t=e.id;if(null===t)return!1;var n=a[t];return void 0!==n&&n%2==1}));n&&s&&null!==s.id?(n.restore(s.id,s.frames),this.node.scene.emit(Es.GRID_SPAWN,[n])):this.reportOrThrowInDebugger("Failed to get a random tile","processSpawnSingleTileStep")}else this.reportOrThrowInDebugger("Grid is not initialized","processSpawnSingleTileStep")}},{key:"consumeAnimationQueue",value:(c=o((function*(){if(!this.isConsumingAnimation){for(this.isConsumingAnimation=!0;this.animationQueue.length>0;){if(0===this.getUncleared().length){this.animationQueue=[];break}var e=this.animationQueue.shift();yield null==e?void 0:e()}for(;this.dirtyGameplayRotation&&void 0!==this.levelData;)this.dirtyGameplayRotation=!1,this.shouldRotate(this.levelData)!==this.useRotatedGameplay&&(yield this.updateGameplayRotation());this.isConsumingAnimation=!1}})),function(){return c.apply(this,arguments)})},{key:"updateGameplayRotation",value:(s=o((function*(){var e=this;if(this.levelData){var t=this.shouldRotate(this.levelData),n=this.useRotatedGameplay&&!t;if(this.useRotatedGameplay=t,this.grid&&this.levelData&&this.hintPath){this.node.scene.emit(Es.GRID_ORIENTATION_CHANGE,this.useRotatedGameplay),this.hintPath=function(e,t,n){var i,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=[],r=u(n);try{for(r.s();!(i=r.n()).done;){var l=i.value,s=l.a,c=l.b,d=wg(s,e,t,a),h=wg(c,e,t,a);o.push({a:d,b:h})}}catch(e){r.e(e)}finally{r.f()}return o}(this.grid.width,this.grid.height,this.hintPath,n),this.setIgnoreInput(!0);var i=Gg(this.grid,n);this.grid=i,this.updateTilesHolderScale(),yield Promise.all(i.map((function(t){return t.sync({delay:.3,duration:.3,easing:"quartInOut",getTargetPosition:function(){return fg(i,e.tileSize,t.getCoord(),10)}})}))),i.each((function(e){e.node.setSiblingIndex(0)})),yield Promise.all(i.map((function(t){return t.sync({duration:.2,easing:"sineInOut",getTargetPosition:function(){return fg(i,e.tileSize,t.getCoord())}})}))),this.setIgnoreInput(!1)}}})),function(){return s.apply(this,arguments)})},{key:"clearAnimationQueue",value:function(){this.isConsumingAnimation=!1,this.animationQueue=[]}},{key:"reportOrThrowInDebugger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown error thrown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Board",n=new Error("".concat(t,": ").concat(e));if(xm.isDebugger())throw n;null==Mm||Mm.sendException(n)}}],[{key:"generateFen",value:function(e){for(var t=e,n=[],i=0;i<t.colors;i++)n.push(i+1);var a=Date.now(),o=Ng({levelData:t,seed:a,identities:n,setTileIdentity:function(e,t){return e.setIdentity(t)},createTile:function(e){var t=e,n=void 0,i=new ae(0,0);return{get id(){return t},get special(){return n},get coord(){return i},setIdentity:function(e){t=e},isHidden:function(){return!1},setSpecialType:function(e){n={type:e}},setCoord:function(e,t){return i.set(e,t)},getCoord:function(){return i},isSimilarTo:function(e){return e.id===t},inSamePositionAs:function(e){return e.getCoord().equals(i)}}}});return o.each((function(e,t,n){e.setCoord(t,n)})),qg({grid:o,seed:a,setIdentity:function(e,t){return e.setIdentity(t)}}),Dg(o,t,a),function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:im,n=e.width,i=e.height,a=[],o=new Map,r=i-1;r>=0;r--){for(var l=[],s=0;s<n;s++){var u,c,d=e.get(s,r),h=d.isHidden()?null:d.id;if(null!==h){var p=t[null!==(u=null===(c=d.special)||void 0===c?void 0:c.type)&&void 0!==u?u:at.none];if(!o.has(h)){var y=o.size.toString();o.set(h,y)}var v="".concat(p).concat(o.get(h));l.push(v)}else l.push(".")}a.push(l.join(""))}return{code:a.join(":"),idSize:o.size,encoding:t,rows:i,cols:n}}(o)}}]),y}(T)).prototype,"tilePrefab",[sm,um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=a(ym.prototype,"tilesHolder",[cm,dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gm=a(ym.prototype,"tileTrim",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ae(.025,.1)}}),pm=ym))||pm)||pm);S._RF.pop(),S._RF.push({},"f7e1byg/txJGqnuJJ7xQV1M","withItemAnalytics",void 0);var Gm=Ludex.Plugins.Analytics,Hm=(void 0===Gm?{}:Gm).Events,qm=codex.analytics,Vm=function(e,t){return function(){return Hm&&qm.event(Hm.USE_ITEM,{item_name:e}),t.apply(void 0,arguments)}};S._RF.pop(),S._RF.push({},"bc704Yz8bdJzYja7TsWcGMN","useHintItem",void 0);var $m=Vm(tt.PLIERS,(function(e,t){if(!t.isDrawingHint){var n=e.getHintPath();null!==n&&(je.playSound(Qi.HINT_ITEM),t.drawHintPath(n,(function(t){return e.getAnyTileWorldPosition(t.x,t.y)})),e.showHint())}}));S._RF.pop(),S._RF.push({},"0a2423JE25HLIm5td77YE7e","usePliersItem",void 0);var Wm=Vm(tt.PLIERS,(function(e,t){var n,i=Ag(e.getBombTiles()),a=i.node.worldPosition;t.createDefuseExplosionAt(a.x,a.y),je.playSound(Qi.BOMB_DEFUSE),null===(n=i.special)||void 0===n||n.switch(at.none)}));S._RF.pop(),S._RF.push({},"004c93sHsBHnpww25v/ilqP","withBlockedInput",void 0);S._RF.pop(),S._RF.push({},"33523Q0FqxMp6H+SNCi8//7","withCenteredBoard",void 0);var Km=function(e,t){return o((function*(){var n=e.widget,i=n.left,a=n.right,o=(i+a)/2;yield Ve.runTweenAsync(R(e.widget).to(.2,{left:o,right:o},{easing:"cubicOut"}));var r=yield t.apply(void 0,arguments),l=e.getWidgetMargins(Je.getCurrentLayout()),s=l.top,u=l.bottom,c=l.left,d=l.right;return yield Ve.runTweenAsync(R(e.widget).to(.2,{top:s,bottom:u,left:c,right:d},{easing:"cubicOut"})),r}))};S._RF.pop(),S._RF.push({},"975e3Ao0kxHW6RlBkPl5kbh","withEffectAnimationEvents",void 0);var jm=function(e,t){return o((function*(){e.node.scene.emit(Es.EFFECTS_ANIMATION_START);var n=yield t.apply(void 0,arguments);return e.node.scene.emit(Es.EFFECTS_ANIMATION_END),n}))};S._RF.pop(),S._RF.push({},"d2cd0VZLwhNMJwc3ppHvOtA","withLoweredVolume",void 0);var Ym=function(e){return o((function*(){je.setVolumeMusic(0,!0);var t=yield e.apply(void 0,arguments);return je.setVolumeMusic(.3,!0),t}))};S._RF.pop(),S._RF.push({},"a62ebriH15FfI8l0x1GBX1p","useThunderItem",void 0);var Xm,Jm=function(){var e=o((function*(e,t){if(!(e.getUncleared().length<4)){var n=e.getPairs(2),i=jm(e,Km(e,Qm));e.clearSelectedTile(),yield i(t,n,e)}}));return function(t,n){return e.apply(this,arguments)}}(),Zm=Vm(tt.THUNDER,Ym((Xm=Jm,o((function*(){ot.setBlockInput(!0);var e=yield Xm.apply(void 0,arguments);return ot.setBlockInput(!1),e})))));function Qm(e,t,n){return e.playThunderAnimation(t,n)}S._RF.pop(),S._RF.push({},"0e50bRTLUtMgYDDkS0nbFm5","useTornadoItem",void 0);var eb,tb=Ludex.Utils.Function,nb=function(){var e=o((function*(e,t){var n=yield tb.allSettled(e.map((function(n,i,a){return n.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return fg(e,t,{x:i,y:a},10)}})})));n.some((function(e){return"rejected"===e.status}))&&console.error("Error playing padding animation",n.filter((function(e){return"rejected"===e.status})))}));return function(t,n){return e.apply(this,arguments)}}(),ib=function(){var e=o((function*(e,t){var n=e.asArray().length;e.each((function(t,i,a){t.node.setSiblingIndex(n-1-(i+a*e.width))}));var i=yield tb.allSettled(e.map((function(n){return n.fly({getTilePosition:function(n){return fg(e,t,n)}})})));i.some((function(e){return"rejected"===e.status}))&&console.error("Error playing shuffle animation",i.filter((function(e){return"rejected"===e.status})))}));return function(t,n){return e.apply(this,arguments)}}(),ab=function(){var e=o((function*(e,t,n,i){je.playSound(Qi.SHUFFLE_ITEM),je.playSound(Qi.WIND),yield nb(e,n()),i(),yield ib(t,n())}));return function(t,n,i,a){return e.apply(this,arguments)}}(),ob=function(){var e=o((function*(e,t){var n=function(){return e.getTileSize()},i=function(){return t.playTornadoAnimation()},a=jm(e,Km(e,Ym((function(e,t){return ab(e,t,n,i)}))));return new Promise((function(t){e.processShuffleRequest(function(){var n=o((function*(n,i){e.clearSelectedTile(),yield a(n,i),t()}));return function(e,t){return n.apply(this,arguments)}}())}))}));return function(t,n){return e.apply(this,arguments)}}(),rb=Vm(tt.THUNDER,Ym(ob));S._RF.pop(),S._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var lb=(0,C.ccclass)("Line")(eb=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(P)}},{key:"setPoints",value:function(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=ae.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;var n=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new V(0,0,n)}}]),r}(T))||eb;S._RF.pop(),S._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var sb,ub,cb,db,hb,pb,yb,vb,fb,gb,mb,bb=function(a){n(r,a);var o=i(r);function r(e,n,i,a,l){var s;return t(this,r),(s=o.call(this,e,n,l)).ator=i,s.ftor=a,s}return e(r,[{key:"alloc",value:function(){var e=c(d(r.prototype),"alloc",this).call(this);return this.ator&&this.ator(e),e}},{key:"free",value:function(e){this.ftor&&this.ftor(e),c(d(r.prototype),"free",this).call(this,e)}}]),r}(ve);S._RF.pop(),S._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var wb,Sb,kb,Cb,Eb,Ab,Tb,Pb,Ob,Lb=C.ccclass,Ib=C.property,Rb=(sb=Lb("PathDrawer"),ub=Ib({group:"Line",displayName:"Prefab",type:fe}),cb=Ib({group:"Line",displayName:"Holder",type:q,tooltip:"Line Prefab"}),db=Ib({group:"Point",displayName:"Prefab",type:fe}),hb=Ib({group:"Point",displayName:"Holder",type:q}),sb((vb=a((yb=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"linePrefab",vb,l(e)),r(e,"lineHolder",fb,l(e)),e.lineNodes=[],r(e,"pointPrefab",gb,l(e)),r(e,"pointHolder",mb,l(e)),e.pointNodes=[],e}return e(s,[{key:"start",value:function(){var e=this;this.linePool=new bb((function(){var t=ye(e.linePrefab);return e.lineHolder.addChild(t),t.parent=e.lineHolder,t.active=!1,t}),0,(function(t){e.lineNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()})),this.pointPool=new bb((function(){var t=ye(e.pointPrefab);return e.pointHolder.addChild(t),t.active=!1,t}),0,(function(t){e.pointNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()}))}},{key:"drawPath",value:function(e){this.clearPath();var t,n=u(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(lb))||void 0===i||i.setPoints(a.a,a.b)}}catch(e){n.e(e)}finally{n.f()}}},{key:"clearPath",value:function(){var e,t=u(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.linePool.free(n)}}catch(e){t.e(e)}finally{t.f()}this.lineNodes=[];var i,a=u(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.pointPool.free(o)}}catch(e){a.e(e)}finally{a.f()}this.pointNodes=[]}}]),s}(T)).prototype,"linePrefab",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fb=a(yb.prototype,"lineHolder",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gb=a(yb.prototype,"pointPrefab",[db],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mb=a(yb.prototype,"pointHolder",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pb=yb))||pb);S._RF.pop(),S._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var _b,Db,Mb,Nb,Bb=C.ccclass,Fb=C.property,xb=(wb=Bb("ErrorDrawer"),Sb=Fb(ue),kb=Fb(ue),Cb=Fb(ue),wb((Tb=a((Ab=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"one",Tb,l(e)),r(e,"two",Pb,l(e)),r(e,"error",Ob,l(e)),e}return e(s,[{key:"start",value:function(){c(d(s.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(e){var t=this;if(this.clearPath(),e.forEach((function(n,i){var a;if(null===(a=t.linePool.alloc().getComponent(lb))||void 0===a||a.setPoints(n.a,n.b),0!==i){var o=t.pointPool.alloc();o.setWorldPosition(new V(n.a.x,n.a.y,0));var r=o.getComponent(F);1===i&&e.length>3?r.spriteFrame=t.one:2===i&&e.length>3?r.spriteFrame=t.two:r.spriteFrame=t.error}})),1===e.length){var n=this.pointPool.alloc();n.setWorldPosition(new V(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),n.getComponent(F).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}]),s}(Rb)).prototype,"one",[Sb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=a(Ab.prototype,"two",[kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ob=a(Ab.prototype,"error",[Cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eb=Ab))||Eb);S._RF.pop(),S._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var zb,Ub,Gb,Hb,qb=(_b=(0,C.ccclass)("HintDrawer"),Db=Ni.onlyRunInLifeCycle,_b((a((Nb=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"drawPath",value:function(e){this.clearPath(),this.createPath(e),this.showPath()}},{key:"createPath",value:function(e){if(0!==e.length){var t=e.length-1;if(!(t<0)){var n=e[t];if(n){var i,a=u(e);try{for(a.s();!(i=a.n()).done;){var o,r=i.value;null===(o=this.linePool.alloc().getComponent(lb))||void 0===o||o.setPoints(r.a,r.b),this.pointPool.alloc().setWorldPosition(r.a.x,r.a.y,0)}}catch(e){a.e(e)}finally{a.f()}this.pointPool.alloc().setWorldPosition(n.b.x,n.b.y,0)}}}}},{key:"showPath",value:function(){var e,t=u(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value.getComponent(B);n.opacity=0,R(n).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){t.e(e)}finally{t.f()}var i,a=u(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value.getComponent(B);o.opacity=0,R(o).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){a.e(e)}finally{a.f()}}},{key:"clearPath",value:function(){var e,t=this,n=u(this.lineNodes);try{var i=function(){var n=e.value,i=n.getComponent(B),a=R(i).to(.15,{opacity:0});Ve.runTweenAsync(a).then((function(){t.node.activeInHierarchy&&(i.opacity=255,t.linePool.free(n))}))};for(n.s();!(e=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}var a,o=u(this.pointNodes);try{var r=function(){var e=a.value,n=e.getComponent(B),i=R(n).to(.15,{opacity:0});Ve.runTweenAsync(i).then((function(){t.node.activeInHierarchy&&(n.opacity=255,t.pointPool.free(e))}))};for(o.s();!(a=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}this.lineNodes=[],this.pointNodes=[]}}]),r}(Rb)).prototype,"clearPath",[Db],Object.getOwnPropertyDescriptor(Nb.prototype,"clearPath"),Nb.prototype),Mb=Nb))||Mb);S._RF.pop(),S._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var Vb,$b,Wb,Kb,jb,Yb,Xb,Jb,Zb,Qb=(zb=(0,C.ccclass)("MatchDrawer"),Ub=Ni.onlyRunInLifeCycleAsync,zb((a((Hb=function(a){n(u,a);var r,l,s=i(u);function u(){return t(this,u),s.apply(this,arguments)}return e(u,[{key:"drawPath",value:function(e){var t=this;if(0!==e.length){var n=e.length-1;if(!(n<0)){var i=e[n];if(i){e.forEach((function(e,n){var i,a=t.linePool.alloc();null===(i=a.getComponent(lb))||void 0===i||i.setPoints(e.a,e.b),t.animateLine(a);var o=t.pointPool.alloc();o.setWorldPosition(e.a.x,e.a.y,0),t.animatePoint(o,n)}));var a=this.pointPool.alloc();a.setWorldPosition(i.b.x,i.b.y,0),this.animatePoint(a,e.length)}}}}},{key:"animateLine",value:(l=o((function*(e){var t=e.getComponent(B);t.opacity=0;var n=R(t).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});yield Ve.runTweenAsync(n),t.opacity=255,this.linePool.free(e)})),function(e){return l.apply(this,arguments)})},{key:"animatePoint",value:(r=o((function*(e,t){e.scale=V.ZERO;var n=R(e).delay(.03*t).to(.2,{scale:V.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:V.ZERO},{easing:"backIn"});yield Ve.runTweenAsync(n),this.node.activeInHierarchy&&this.pointPool.free(e)})),function(e,t){return r.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),u}(Rb)).prototype,"animatePoint",[Ub],Object.getOwnPropertyDescriptor(Hb.prototype,"animatePoint"),Hb.prototype),Gb=Hb))||Gb);S._RF.pop(),S._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var ew,tw=C.ccclass,nw=C.property,iw=(Vb=tw("PathDraw"),$b=nw({group:{name:"Path Drawer"},type:Qb}),Wb=nw({group:{name:"Path Drawer"},type:qb}),Kb=nw({group:{name:"Path Drawer"},type:xb}),Vb((Xb=a((Yb=function(a){n(c,a);var o=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"matchPath",Xb,l(e)),r(e,"hintPath",Jb,l(e)),r(e,"errorPath",Zb,l(e)),e.isDrawingHint=!1,e}return e(c,[{key:"onLoad",value:function(){var e=this;this.node.scene.on(Es.GRID_RESIZE,(function(t){e.node.setScale(t,t),e.node.position=e.board.node.position.clone()}))}},{key:"init",value:function(e){this.board=e}},{key:"drawMatchPath",value:function(e,t){var n,i=e.map((function(e){return s({},e)})),a=u(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.matchPath.drawPath(i)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0;var n,i=e.map((function(e){return s({},e)})),a=u(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.hintPath.drawPath(i)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(e,t){var n,i=e.map((function(e){return s({},e)})),a=u(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.errorPath.drawPath(i)}}]),c}(T)).prototype,"matchPath",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jb=a(Yb.prototype,"hintPath",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zb=a(Yb.prototype,"errorPath",[Kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jb=Yb))||jb);S._RF.pop(),S._RF.push({},"1a5c0RyWQJOipSvNtPLsTHS","ClockManager",void 0);var aw,ow,rw,lw,sw,uw,cw,dw,hw,pw,yw,vw,fw,gw,mw,bw,ww,Sw,kw=C.ccclass,Cw=C.disallowMultiple,Ew=kw("ClockManager")(ew=Cw(ew=function(a){n(s,a);var r,l=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=l.call.apply(l,[this].concat(i))).time=0,e.remaining=0,e.running=!1,e.halfTime=!1,e}return e(s,[{key:"onLoad",value:function(){this.node.scene.on(Es.RESCUE_START,this.refillTime,this)}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"setTime",value:function(e){this.time=e,this.remaining=e,this.node.scene.emit(Es.TIME_UPDATED,this.remaining)}},{key:"getRemainingTime",value:function(){return this.remaining}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(Es.TIME_OUT)}},{key:"update",value:function(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(Es.HALF_TIME)),this.remaining>=0&&this.node.scene.emit(Es.TIME_UPDATED,this.remaining)))}},{key:"refillTime",value:(r=o((function*(){var e=this,t=R(this.node).to(3,{},{onUpdate:function(t,n){if(n){var i=te.lerp(0,120,n);e.setTime(i)}}});yield Ve.runTweenAsync(t),this.setTime(120),this.node.scene.emit(Es.RESCUE_FINISHED)})),function(){return r.apply(this,arguments)})}]),s}(T))||ew)||ew;S._RF.pop(),S._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var Aw,Tw,Pw,Ow,Lw,Iw,Rw,_w,Dw,Mw,Nw,Bw=C.ccclass,Fw=C.property,xw=(aw=Bw("Coin"),ow=Fw(ee),rw=Fw(ce),lw=Fw(de),sw=Fw(de),uw=Ni.onlyRunInLifeCycle,cw=Ni.onlyRunInLifeCycle,dw=Ni.onlyRunInLifeCycle,hw=Ni.onlyRunInLifeCycle,pw=Ni.onlyRunInLifeCycleAsync,yw=Ni.onlyRunInLifeCycleAsync,vw=Ni.onlyRunInLifeCycle,aw((mw=a((gw=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"emittingParticles",mw,l(e)),r(e,"animation",bw,l(e)),r(e,"spin",ww,l(e)),r(e,"rest",Sw,l(e)),e}return e(c,[{key:"__preload",value:function(){Ni.lazyValidateProperties(this)}},{key:"resetDisabled",value:function(){this.stopParticles(),this.stopAnimation(),this.hide(),this.node.active=!1,this.node.setPosition(0,0,this.node.position.z)}},{key:"hide",value:function(){this.node.setScale(V.ZERO)}},{key:"stopParticles",value:function(){this.emittingParticles.stopSystem()}},{key:"playTrailParticles",value:function(){this.emittingParticles.resetSystem()}},{key:"playSpinAnimationAfterDelay",value:(s=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;e>0&&(yield Ve.waitTweenAsync(e)),yield this.playSpinAnimation(t)})),function(){return s.apply(this,arguments)})},{key:"playSpinAnimation",value:function(e){return Ve.runAnimationAsync(this.animation,this.spin.name,e)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),c}(T)).prototype,"emittingParticles",[ow],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bw=a(gw.prototype,"animation",[rw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ww=a(gw.prototype,"spin",[lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sw=a(gw.prototype,"rest",[sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(gw.prototype,"resetDisabled",[uw],Object.getOwnPropertyDescriptor(gw.prototype,"resetDisabled"),gw.prototype),a(gw.prototype,"hide",[cw],Object.getOwnPropertyDescriptor(gw.prototype,"hide"),gw.prototype),a(gw.prototype,"stopParticles",[dw],Object.getOwnPropertyDescriptor(gw.prototype,"stopParticles"),gw.prototype),a(gw.prototype,"playTrailParticles",[hw],Object.getOwnPropertyDescriptor(gw.prototype,"playTrailParticles"),gw.prototype),a(gw.prototype,"playSpinAnimationAfterDelay",[pw],Object.getOwnPropertyDescriptor(gw.prototype,"playSpinAnimationAfterDelay"),gw.prototype),a(gw.prototype,"playSpinAnimation",[yw],Object.getOwnPropertyDescriptor(gw.prototype,"playSpinAnimation"),gw.prototype),a(gw.prototype,"stopAnimation",[vw],Object.getOwnPropertyDescriptor(gw.prototype,"stopAnimation"),gw.prototype),fw=gw))||fw);S._RF.pop(),S._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var zw,Uw,Gw,Hw,qw,Vw,$w,Ww,Kw,jw,Yw,Xw,Jw,Zw,Qw,eS,tS,nS,iS=C.ccclass,aS=C.property,oS=V.ZERO.clone().add3f(0,-100,0),rS=V.ZERO.clone().add3f(0,100,0),lS=Ludex.Utils.Number,sS=(Aw=iS("CoinTextPopup"),Tw=aS(K),Pw=aS(B),Ow=Ni.onlyRunInLifeCycle,Lw=Ni.onlyRunInLifeCycle,Iw=Ni.onlyRunInLifeCycleAsync,Rw=Ni.onlyRunInLifeCycleAsync,Aw((Mw=a((Dw=function(a){n(h,a);var s,u,c,d=i(h);function h(){var e;t(this,h);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=d.call.apply(d,[this].concat(i)),r(e,"label",Mw,l(e)),r(e,"uiOpacity",Nw,l(e)),e}return e(h,[{key:"__preload",value:function(){Ni.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(c=o((function*(e,t){this.enableNode(),this.initializePopup(e),yield this.showTextPopupAnimation(t),yield this.hidePopup(),this.disableNode()})),function(e,t){return c.apply(this,arguments)})},{key:"enableNode",value:function(){this.node.active=!0}},{key:"disableNode",value:function(){this.node.active=!1}},{key:"initializePopup",value:function(e){var t=lS.getShortNumber(e,3);this.label.string=t,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(oS)}},{key:"hidePopup",value:(u=o((function*(){this.node.setScale(V.ONE),this.node.setPosition(rS),yield Ve.runTweenAsync(R(this.uiOpacity).to(.5,{opacity:0}))})),function(){return u.apply(this,arguments)})},{key:"showTextPopupAnimation",value:(s=o((function*(e){yield Promise.all([Ve.runTweenAsync(R(this.node).to(1.5,{position:rS},{easing:"sineOut"}),e),Ve.runTweenAsync(R(this.node).to(.5,{scale:V.ONE},{easing:"backOut"}),e)])})),function(e){return s.apply(this,arguments)})}]),h}(T)).prototype,"label",[Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nw=a(Dw.prototype,"uiOpacity",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Dw.prototype,"disableNode",[Ow],Object.getOwnPropertyDescriptor(Dw.prototype,"disableNode"),Dw.prototype),a(Dw.prototype,"initializePopup",[Lw],Object.getOwnPropertyDescriptor(Dw.prototype,"initializePopup"),Dw.prototype),a(Dw.prototype,"hidePopup",[Iw],Object.getOwnPropertyDescriptor(Dw.prototype,"hidePopup"),Dw.prototype),a(Dw.prototype,"showTextPopupAnimation",[Rw],Object.getOwnPropertyDescriptor(Dw.prototype,"showTextPopupAnimation"),Dw.prototype),_w=Dw))||_w);S._RF.pop(),S._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var uS,cS=C.ccclass,dS=C.disallowMultiple,hS=C.property,pS=codex,yS=pS.player,vS=pS.monitorError,fS=999999999,gS=10,mS=1,bS=1,wS=(zw=cS("CoinManager"),Uw=Ni.required(),Gw=hS(fe),Hw=Ni.required(),qw=hS(fe),Vw=Ni.required(),$w=hS(q),Ww=Ni.onlyRunInLifeCycleAsync,Kw=Ni.onlyRunInLifeCycleAsync,jw=Ni.onlyRunInLifeCycleAsync,Yw=Ni.onlyRunInLifeCycleAsync,Xw=Ni.onlyRunInLifeCycleAsync,Jw=Ni.onlyRunInLifeCycleAsync,zw(Zw=dS((eS=a((Qw=function(a){n(y,a);var u,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=p.call.apply(p,[this].concat(i))).coins=0,r(e,"coinPrefab",eS,l(e)),r(e,"coinTextPopup",tS,l(e)),r(e,"coinAnimContainer",nS,l(e)),e.coinObjects=[],e}return e(y,[{key:"onLoad",value:function(){Ni.validateRequiredProperties(this),this.getCoinsFromPlayerData(),this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(){this.updateCoins({coins:this.coins})}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(Es.ADD_COINS,this.addCoins,this),this.node.scene.on(Es.REMOVE_COINS,this.removeCoins,this),this.node.scene.on(Es.ABORT_COIN_ANIMATION,this.abortCoinAnimation,this)}},{key:"prepareCoinCollection",value:function(){for(var e=0;e<gS;e++){var t=ye(this.coinPrefab);t.setParent(this.coinAnimContainer),t.setPosition(0,0),t.active=!1,this.coinObjects.push(t.getComponent(xw))}}},{key:"prepareCoinTextPopup",value:function(){var e=ye(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(sS)}},{key:"handleCollectionAnim",value:(h=o((function*(e,t,n,i,a){var o=this;if(t){var r=this.coinObjects.slice(0,this.getShortAmount(e));if(0===r.length)return console.warn("Requested coins amount is ".concat(e,". Shortened to ").concat(this.getShortAmount(e),". No coin objects was found to animate collection.")),void(null==vS||vS.sendException(new Error("Requested coins amount is ".concat(e,". Shortened to ").concat(this.getShortAmount(e),". No coin objects was found to animate collection.")),{coins:e,animatedCoins:r.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!t,coinCollectionCount:this.coinObjects.length}));je.playSound(Qi.COLLECT_STOCK_COINS),yield Promise.all([this.playCoinFlyAndexplodeAnimation(t,r,n,i,a),Ve.waitTweenAsync(n+i/2,a).then((function(){return o.animateCoinTextPopup(e,a)}))]),a.abort()}else console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played")})),function(e,t,n,i,a){return h.apply(this,arguments)})},{key:"playCoinFlyAndexplodeAnimation",value:(d=o((function*(e,t,n,i,a){var o=this,r=n+i;yield Promise.all([].concat(g(t.flatMap((function(t){t.node.active=!0,t.stopParticles();var r=[0,.5*Math.min(n,i)],l=he.apply(void 0,r),s=n-l,u=i+l;return[o.animateCoinExplode(t.node,s,a),Ve.waitTweenAsync(s,a).then((function(){return o.animateCoinFlyBack(e,t,u,a)}))]}))),[Ve.waitTweenAsync(r,a).then((function(){return e.emitExplodeEffect(a)}))]))})),function(e,t,n,i,a){return d.apply(this,arguments)})},{key:"animateCoinTextPopup",value:function(e,t){return this.coinTextPopupNode.show(e,t)}},{key:"animateCoinFlyBack",value:(c=o((function*(e,t,n,i){var a=t.node.worldPosition.clone(),o=V.ZERO.clone(),r=e.getCoinIconWorldScale();yield Ve.runTweenAsync(R(t.node).to(n,{scale:r},{onStart:function(){t.playSpinAnimationAfterDelay(0,i),t.playTrailParticles()},onUpdate:function(n,i){if(void 0!==i){var r=z.cubicIn(i),l=e.getCoinIconWorldPosition();t.node.worldPosition=V.lerp(o,a,l,r)}},onComplete:function(){t.emittingParticles.stopSystem(),t.stopAnimation(),t.hide()}}),i),yield Ve.waitTweenAsync(1,i),t.resetDisabled()})),function(e,t,n,i){return c.apply(this,arguments)})},{key:"animateCoinExplode",value:(u=o((function*(e,t,n){var i=[-200,200],a=[-200,200],o=he(i[0],i[1]),r=he(a[0],a[1]);e.setPosition(0,0,e.position.z),e.setScale(V.ZERO);var l=new V(o,r,e.position.z);yield Promise.all([Ve.runTweenAsync(R(e).delay(.1*t).to(.8*t,{scale:V.ONE},{easing:"elasticOut"}),n),Ve.runTweenAsync(R(e).to(t,{position:l},{easing:"circOut"}),n)])})),function(e,t,n){return u.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var e=yS.getGameData();this.coins=e?e.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(e){var t,n;if(this.coins>fS&&(this.coins=fS),e.coins!==this.coins){var i=Math.max(0,e.coins-this.coins);this.coins=e.coins,yS.setGameData({coins:this.coins});var a=e.collectionAnimation;null===(t=this.collectionAnimSignal)||void 0===t||t.abort();var o=new In;if(this.collectionAnimSignal=o,null==a||null===(n=a.signal)||void 0===n||n.chain(o),void 0===a||a.animateTextOnly)this.node.scene.emit(Es.COIN_CHANGED,s(s({},e),{},{collectionAnimation:{animateTextOnly:!0,signal:null==a?void 0:a.signal}}));else{var r=a.floatDuration,l=void 0===r?mS:r,u=a.flyDuration,c=void 0===u?bS:u,d=a.target,h=void 0===d?this.targetContainer:d;this.collectionAnimSignal=o,this.targetContainer=h;var p=s(s({},e),{},{collectionAnimation:{floatDuration:l,flyDuration:c,animateTextOnly:!1,signal:o,target:h}});this.node.scene.emit(Es.COIN_CHANGED,p),this.handleCollectionAnim(i,this.targetContainer,l,c,o)}}}},{key:"addCoins",value:function(e){this.updateCoins(s(s({},e),{},{coins:this.coins+e.coins}))}},{key:"removeCoins",value:function(e){this.coins<e.coins?this.node.scene.emit(Es.REMOVE_COINS_FAILED):(this.updateCoins(s(s({},e),{},{coins:this.coins-e.coins})),this.node.scene.emit(Es.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(Es.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(e){return Math.min(e,gS)}},{key:"abortCoinAnimation",value:function(){var e;null===(e=this.collectionAnimSignal)||void 0===e||e.abort()}},{key:"untilFinishesCollectAnim",value:function(){return void 0===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(e){this.targetContainer=e}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var e;null===(e=this.collectionAnimSignal)||void 0===e||e.abort()}}]),y}(T)).prototype,"coinPrefab",[Uw,Gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tS=a(Qw.prototype,"coinTextPopup",[Hw,qw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nS=a(Qw.prototype,"coinAnimContainer",[Vw,$w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Qw.prototype,"handleCollectionAnim",[Ww],Object.getOwnPropertyDescriptor(Qw.prototype,"handleCollectionAnim"),Qw.prototype),a(Qw.prototype,"playCoinFlyAndexplodeAnimation",[Kw],Object.getOwnPropertyDescriptor(Qw.prototype,"playCoinFlyAndexplodeAnimation"),Qw.prototype),a(Qw.prototype,"animateCoinTextPopup",[jw],Object.getOwnPropertyDescriptor(Qw.prototype,"animateCoinTextPopup"),Qw.prototype),a(Qw.prototype,"animateCoinFlyBack",[Yw],Object.getOwnPropertyDescriptor(Qw.prototype,"animateCoinFlyBack"),Qw.prototype),a(Qw.prototype,"animateCoinExplode",[Xw],Object.getOwnPropertyDescriptor(Qw.prototype,"animateCoinExplode"),Qw.prototype),a(Qw.prototype,"untilFinishesCollectAnim",[Jw],Object.getOwnPropertyDescriptor(Qw.prototype,"untilFinishesCollectAnim"),Qw.prototype),Zw=Qw))||Zw)||Zw);S._RF.pop(),S._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var SS,kS,CS,ES,AS,TS,PS,OS,LS,IS,RS,_S=C.ccclass,DS=[Qi.COMBO_1,Qi.COMBO_2,Qi.COMBO_3,Qi.COMBO_4,Qi.COMBO_5,Qi.COMBO_6,Qi.COMBO_7,Qi.COMBO_8,Qi.COMBO_9,Qi.COMBO_10,Qi.COMBO_11,Qi.COMBO_12,Qi.COMBO_13],MS=_S("ComboManager")(uS=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(Es.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(Es.GAME_FINISH,this.resetCombo,this),this.node.scene.on(Es.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(Es.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(Es.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(e){if(this.currentCombo=e,e>0){var t=Math.min(e-1,DS.length-1);je.playSound(DS[t]),this.vibrate(e)}this.emitEvent&&this.node.scene.emit(Es.COMBO_UPDATED,e)}},{key:"vibrate",value:function(e){var t;null===(t=re("Vibrate"))||void 0===t||null===(t=t.getComponent(sy))||void 0===t||t.vibrate(Math.min(20+20*e,220))}},{key:"setEmitEvent",value:function(e){this.emitEvent=e}}]),r}(T))||uS;S._RF.pop(),S._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var NS=C.ccclass,BS=C.property,FS=(SS=NS("Burst"),kS=BS(L),CS=BS(O),ES=BS(L),AS=BS(O),SS((OS=a((PS=function(){function n(){t(this,n),r(this,"time",OS,this),r(this,"repeatCount",LS,this),r(this,"repeatInterval",IS,this),r(this,"count",RS,this),this.remainingCount=0,this.curTime=0}return e(n,[{key:"update",value:function(e,t){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var n=ge(e.time-e.startDelay.evaluate(0,1),e.duration)-t;n=n>0?n:0;var i=ge(e.time-e.startDelay.evaluate(0,1),e.duration);this.curTime>=n&&this.curTime<i&&(e.emit(this.count,t-(i-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),n}()).prototype,"time",[kS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),LS=a(PS.prototype,"repeatCount",[CS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),IS=a(PS.prototype,"repeatInterval",[ES],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),RS=a(PS.prototype,"count",[AS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),TS=PS))||TS);S._RF.pop(),S._RF.push({},"370cbFjxn9GKJzqbTOhQZiA","ParticleSimulator",void 0);var xS,zS,US,GS,HS,qS,VS,$S,WS,KS,jS,YS,XS,JS,ZS,QS,ek,tk=new V(0,0,0),nk=function(){function n(){t(this,n),this.pos=new V(0,0,0),this.color=new X(255,255,255,255),this.size=new V(0,0,0),this.startSize=new V(0,0,0),this.rotation=new V(0,0,0),this.startLifetime=0,this.remainingLifetime=0,this.randomSeed=0,this.velocity=new V(0,0),this.width=0,this.height=0}return e(n,[{key:"init",value:function(){this.pos.set(tk),this.remainingLifetime=0,this.startLifetime=0,this.startSize.set(tk),this.startColor=X.WHITE.clone(),this.velocity.set(tk),this.randomSeed=0}}]),n}(),ik=new(function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"get",value:function(){return this._get()||new nk}}]),r}(me.Pool))((function(e){e.pos.set(tk),e.color.set(255,255,255,255),e.size.set(tk),e.rotation.set(tk)}),1024),ak=function(){function n(e){t(this,n),this.particles=[],this.active=!1,this.uvFilled=0,this.renderData=new we,this.sys=e,this.particles=[],this.active=!1,this.uvFilled=0}return e(n,[{key:"stop",value:function(){this.active=!1}},{key:"reset",value:function(){this.active=!0;var e,t=this.particles,n=u(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;ik.put(i)}}catch(e){n.e(e)}finally{n.f()}t.length=0,this.renderData.resize(0,0)}},{key:"emitParticle",value:function(){var e=ik.get();return this.particles.push(e),e}},{key:"updateUVs",value:function(e){var t=this.renderData;if(t&&this.sys){var n=t.vData,i=this.sys.spriteFrame;if(!i)return;for(var a=i.uv,o=e?0:this.uvFilled,r=this.particles.length,l=o;l<r;l++){var s,u,c,d,h,p,y,v,f=9*l*4;n[f+3]=null!==(s=a[0])&&void 0!==s?s:0,n[f+4]=null!==(u=a[1])&&void 0!==u?u:0,n[f+12]=null!==(c=a[2])&&void 0!==c?c:0,n[f+13]=null!==(d=a[3])&&void 0!==d?d:0,n[f+21]=null!==(h=a[4])&&void 0!==h?h:0,n[f+22]=null!==(p=a[5])&&void 0!==p?p:0,n[f+30]=null!==(y=a[6])&&void 0!==y?y:0,n[f+31]=null!==(v=a[7])&&void 0!==v?v:0}this.uvFilled=r}}},{key:"updateParticleBuffer",value:function(e,t,n,i){var a=n.vData,o=t.x,r=t.y,l=t.z,s=e.width*e.size.x/2,u=e.height*e.size.y/2,c=e.rotation.x||0,d=e.rotation.y||0,h=e.rotation.z||0;if(0===c&&0===d&&0===h)a[i]=o-s,a[i+1]=r-u,a[i+2]=l,a[i+9]=o+s,a[i+10]=r-u,a[i+11]=l,a[i+18]=o-s,a[i+19]=r+u,a[i+20]=l,a[i+27]=o+s,a[i+28]=r+u,a[i+29]=l;else{var p=function(e,t,n){var i=t*g-n*m,a=t*m+n*g,o=e*b+a*w;return new V(o*S-i*k,o*k+i*S,a*b-e*w)},y=-be.degreesToRadians(c),v=-be.degreesToRadians(d),f=-be.degreesToRadians(h),g=Math.cos(y),m=Math.sin(y),b=Math.cos(v),w=Math.sin(v),S=Math.cos(f),k=Math.sin(f),C=[p(-s,-u,0),p(s,-u,0),p(-s,u,0),p(s,u,0)];a[i]=C[0].x+o,a[i+1]=C[0].y+r,a[i+2]=C[0].z+l,a[i+9]=C[1].x+o,a[i+10]=C[1].y+r,a[i+11]=C[1].z+l,a[i+18]=C[2].x+o,a[i+19]=C[2].y+r,a[i+20]=C[2].z+l,a[i+27]=C[3].x+o,a[i+28]=C[3].y+r,a[i+29]=C[3].z+l}X.toArray(a,e.color,i+5),X.toArray(a,e.color,i+14),X.toArray(a,e.color,i+23),X.toArray(a,e.color,i+32)}},{key:"step",value:function(e){var t,n=this.sys.node,i=this.particles;n.updateWorldTransform(),this.active&&this.sys.emitting(e);var a=this.renderData,o=i.length;a.reset(),this.requestData(4*o,6*o),o>this.uvFilled&&this.updateUVs();for(var r=0;r<i.length;){var l=i[r];if(l)if(l.remainingLifetime-=e,l.remainingLifetime>0){var s=9*r*4;this.updateParticleBuffer(l,l.pos,a,s),++r}else{var u=i[r];if(!u)continue;if(r!==i.length-1){var c=i[i.length-1];c&&(i[r]=c)}ik.put(u),i.length--,a.resize(a.vertexCount-4,a.indexCount-6)}}this.renderData.material=this.sys.getRenderMaterial(0),this.renderData.frame=this.sys.spriteFrame,null==a||null===(t=a.setRenderDrawInfoAttributes)||void 0===t||t.call(a)}},{key:"requestData",value:function(e,t){var n=this.renderData.indexCount;this.renderData.request(e,t);for(var i=this.renderData.indexCount/6,a=this.renderData.iData,o=n;o<i;o++){var r=4*o;a[n++]=r,a[n++]=r+1,a[n++]=r+2,a[n++]=r+1,a[n++]=r+3,a[n++]=r+2}}},{key:"initDrawInfo",value:function(){var e,t=this.renderData;null==t||null===(e=t.setRenderDrawInfoAttributes)||void 0===e||e.call(t)}}]),n}();S._RF.pop(),S._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var ok,rk,lk,sk,uk,ck,dk,hk,pk,yk,vk,fk,gk,mk,bk,wk,Sk,kk=C.ccclass,Ck=C.property,Ek=x({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),Ak=(xS=kk("CurveRange"),zS=Ck({type:x(Ek)}),US=Ck({visible:function(){return this.mode===Ek.Constant}}),GS=Ck({visible:function(){return this.mode===Ek.Curve}}),HS=Ck({visible:function(){return this.mode===Ek.TwoCurves}}),qS=Ck({visible:function(){return this.mode===Ek.TwoCurves}}),VS=Ck({visible:function(){return this.mode===Ek.TwoConstants}}),$S=Ck({visible:function(){return this.mode===Ek.TwoConstants}}),xS((jS=a((KS=function(){function n(){t(this,n),r(this,"mode",jS,this),r(this,"constant",YS,this),r(this,"spline",XS,this),r(this,"splineMin",JS,this),r(this,"splineMax",ZS,this),r(this,"constantMin",QS,this),r(this,"constantMax",ek,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return e(n,[{key:"evaluate",value:function(e,t){switch(this.mode){case Ek.Curve:return this.spline.evaluate(e);case Ek.TwoCurves:return Se(this.splineMin.evaluate(e),this.splineMax.evaluate(e),t);case Ek.TwoConstants:return Se(this.constantMin,this.constantMax,t);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case Ek.Curve:return 1;case Ek.TwoConstants:return this.constantMax;case Ek.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case Ek.Curve:return ke(1,0,Ce);case Ek.TwoConstants:return ke(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,Ce);case Ek.TwoCurves:return ke(1,0,Ce);default:return ke(this.constant,0,Ce)}}}]),n}()).prototype,"mode",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ek.Constant}}),YS=a(KS.prototype,"constant",[US],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XS=a(KS.prototype,"spline",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ee}}),JS=a(KS.prototype,"splineMin",[HS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ee}}),ZS=a(KS.prototype,"splineMax",[qS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ee}}),QS=a(KS.prototype,"constantMin",[VS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ek=a(KS.prototype,"constantMax",[$S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WS=KS))||WS);S._RF.pop(),S._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var Tk=C.ccclass,Pk=C.property,Ok=x({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),Lk=new X,Ik=new X,Rk=(ok=Tk("GradientRange"),rk=Pk({type:x(Ok)}),lk=Pk({visible:function(){return this.mode===Ok.Color}}),sk=Pk({visible:function(){return this.mode===Ok.TwoColors}}),uk=Pk({visible:function(){return this.mode===Ok.TwoColors}}),ck=Pk({visible:function(){return this.mode===Ok.Gradient||this.mode===Ok.RandomColor}}),dk=Pk({visible:function(){return this.mode===Ok.TwoGradients}}),hk=Pk({visible:function(){return this.mode===Ok.TwoGradients}}),ok((vk=a((yk=function(){function n(){t(this,n),r(this,"mode",vk,this),r(this,"color",fk,this),r(this,"colorMin",gk,this),r(this,"colorMax",mk,this),r(this,"gradient",bk,this),r(this,"gradientMin",wk,this),r(this,"gradientMax",Sk,this),this._color=X.WHITE.clone()}return e(n,[{key:"evaluate",value:function(e,t){switch(this.mode){case Ok.Color:return this.color;case Ok.TwoColors:return X.lerp(this._color,this.colorMin,this.colorMax,t),this._color;case Ok.RandomColor:return this.gradient.getRandomColor(this._color);case Ok.Gradient:return this.gradient.evaluateFast(this._color,e);case Ok.TwoGradients:return X.lerp(this._color,this.gradientMin.evaluateFast(Lk,e),this.gradientMax.evaluateFast(Ik,e),t),this._color;default:return this.color}}}]),n}()).prototype,"mode",[rk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ok.Color}}),fk=a(yk.prototype,"color",[lk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return X.WHITE.clone()}}),gk=a(yk.prototype,"colorMin",[sk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return X.WHITE.clone()}}),mk=a(yk.prototype,"colorMax",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return X.WHITE.clone()}}),bk=a(yk.prototype,"gradient",[ck],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ae}}),wk=a(yk.prototype,"gradientMin",[dk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ae}}),Sk=a(yk.prototype,"gradientMax",[hk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ae}}),pk=yk))||pk);function _k(e,t,n,i){!function(e,t){ae.set(e,Math.cos(t),Math.sin(t))}(e,i),e.z=0,V.multiplyScalar(e,e,t+(n-t)*Pe())}function Dk(e){var t=Ek;switch(e.mode){case t.TwoCurves:case t.TwoConstants:return!0;default:return!1}}S._RF.pop(),S._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),S._RF.pop(),S._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0);var Mk,Nk,Bk,Fk,xk,zk,Uk,Gk=23541,Hk=39825,qk=91041,Vk=125292,$k=197866,Wk=156497;S._RF.pop(),S._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var Kk,jk,Yk,Xk,Jk,Zk,Qk,eC,tC,nC=C.ccclass,iC=C.property,aC=qk,oC=(Mk=nC("ColorOvertimeModule"),Nk=iC({type:W}),Bk=iC({type:Rk}),Mk((zk=a((xk=function(){function n(){t(this,n),r(this,"enable",zk,this),r(this,"color",Uk,this)}return e(n,[{key:"update",value:function(e){if(this.enable){e.color.set(e.startColor);var t=function(e){var t=Ok;switch(e.mode){case t.TwoGradients:case t.TwoColors:return!0;default:return!1}}(this.color)?pe(e.randomSeed+aC):0;e.color.multiply(this.color.evaluate(1-e.remainingLifetime/e.startLifetime,t))}}}]),n}()).prototype,"enable",[Nk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uk=a(xk.prototype,"color",[Bk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rk}}),Fk=xk))||Fk);S._RF.pop(),S._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var rC,lC,sC,uC,cC,dC,hC,pC,yC,vC,fC,gC,mC,bC=C.ccclass,wC=C.property,SC=Gk,kC=(Kk=bC("LimitVelocityOvertimeModule"),jk=wC({type:W}),Yk=wC({type:Ak}),Xk=wC({type:Ak}),Kk((Qk=a((Zk=function(){function n(){t(this,n),r(this,"enable",Qk,this),r(this,"limit",eC,this),r(this,"dampen",tC,this),this.limit.constant=500,this.dampen.constant=.2}return e(n,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=e.velocity.clone().normalize(),a=Dk(this.limit)?pe(e.randomSeed+SC):0,o=Dk(this.dampen)?pe(e.randomSeed+SC+1):0,r=e.velocity.length(),l=this.limit.evaluate(n,a),s=this.dampen.evaluate(n,o);e.velocity=i.multiplyScalar(this.dampenBeyondLimit(r,l,s,t))}}},{key:"dampenBeyondLimit",value:function(e,t,n,i){if(e<=t)return e;var a=1-Math.exp(-n*i);return te.lerp(e,t,a)}}]),n}()).prototype,"enable",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eC=a(Zk.prototype,"limit",[Yk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),tC=a(Zk.prototype,"dampen",[Xk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),Jk=Zk))||Jk);S._RF.pop(),S._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var CC,EC,AC,TC,PC,OC,LC,IC,RC,_C,DC,MC,NC,BC,FC,xC,zC,UC,GC,HC,qC,VC,$C,WC=C.ccclass,KC=C.property,jC=Vk,YC=(rC=WC("RotationOvertimeModule"),lC=KC({type:W}),sC=KC(W),uC=KC({type:Ak,visible:function(){return this.separateAxes}}),cC=KC({type:Ak,visible:function(){return this.separateAxes}}),dC=KC({type:Ak}),rC((yC=a((pC=function(){function n(){t(this,n),r(this,"enable",yC,this),r(this,"separateAxes",vC,this),r(this,"x",fC,this),r(this,"y",gC,this),r(this,"z",mC,this)}return e(n,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=e.randomSeed+jC,a=Dk(this.z)?pe(i):0,o=this.z.evaluate(n,a)*t,r=0,l=0;if(this.separateAxes){var s=Dk(this.x)?pe(i):0,u=Dk(this.y)?pe(i):0;r=this.x.evaluate(n,s)*t,l=this.y.evaluate(n,u)*t}e.rotation.add3f(r,l,o)}}}]),n}()).prototype,"enable",[lC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vC=a(pC.prototype,"separateAxes",[sC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fC=a(pC.prototype,"x",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),gC=a(pC.prototype,"y",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),mC=a(pC.prototype,"z",[dC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),hC=pC))||hC);S._RF.pop(),S._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var XC,JC,ZC,QC,eE,tE,nE,iE,aE,oE,rE,lE,sE,uE=C.ccclass,cE=C.property,dE=x({Circle:0,Rectangle:1}),hE=x({Base:0,Edge:1}),pE=function(){return this.shape===dE.Circle},yE=function(){return this.shape===dE.Rectangle},vE=[0,0],fE=(CC=uE("ShapeModule"),EC=cE({type:x(dE)}),AC=cE({type:x(hE),visible:yE}),TC=cE({}),PC=cE({}),OC=cE({}),LC=cE({range:[0,360],visible:pE}),IC=cE({range:[-360,360],visible:pE}),RC=cE({min:0,visible:pE}),_C=cE({range:[0,1],step:.01,visible:pE}),DC=cE({visible:yE}),CC((BC=a((NC=function(){function n(){t(this,n),r(this,"shape",BC,this),r(this,"emitFrom",FC,this),r(this,"position",xC,this),r(this,"rotation",zC,this),r(this,"scale",UC,this),r(this,"arc",GC,this),r(this,"angle",HC,this),r(this,"radius",qC,this),r(this,"radiusThickness",VC,this),r(this,"rectangleThickness",$C,this)}return e(n,[{key:"emit",value:function(e){switch(this.shape){case dE.Circle:this.circleEmit(this.radius,this.radiusThickness,Oe(this.generateArcAngle()),e);break;case dE.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,e)}}},{key:"circleEmit",value:function(e,t,n,i){var a=i.pos;_k(a,e*(1-t),e,n+Oe(this.angle)),i.velocity=a.clone().normalize()}},{key:"rectangleEmit",value:function(e,t,n){var i,a,o,r=n.pos;switch(e){case hE.Base:a=r,o=t,ae.set(a,he(-o.x,o.x),he(-o.y,o.y));break;case hE.Edge:vE[0]=he(-1,1),vE[1]=(0===(i=he(-1,1))&&i++,Te.sign(i)),function(e){for(var t=0;t<e.length;t++){var n=t+se(0,e.length-t),i=e[n];e[n]=e[t],e[t]=i}}(vE),this.applyRectThickness(vE,t),ae.set(r,vE[0],vE[1])}n.velocity=r.clone().normalize()}},{key:"generateArcAngle",value:function(){return he(0,this.arc)}},{key:"applyRectThickness",value:function(e,t){t.x>0&&(e[0]*=t.x),t.y>0&&(e[1]*=t.y)}},{key:"gizmo",value:function(e){switch(e.strokeColor.fromHEX("#46C4FFB0"),e.fillColor.fromHEX("#46C4FF77"),e.lineWidth=8,this.shape){case dE.Circle:this.gizmoCircle(e);break;case dE.Rectangle:this.gizmoRectangle(e)}}},{key:"gizmoCircle",value:function(e){e.clear();var t=this.angle,n=this.angle+this.arc;if(this.createArcPath(e,this.radius,t,n),this.createArcPath(e,this.radius*(1-this.radiusThickness),t,n),this.arc<360&&this.radius>0){var i=this.radius*Math.cos(Oe(this.angle)),a=this.radius*Math.sin(Oe(this.angle)),o=this.radius*Math.cos(Oe(this.arc+this.angle)),r=this.radius*Math.sin(Oe(this.arc+this.angle));e.moveTo(i,a),e.lineTo(0,0),e.moveTo(o,r),e.lineTo(0,0)}e.stroke()}},{key:"gizmoRectangle",value:function(e){e.clear();var t=this.rectangleThickness.x,n=this.rectangleThickness.y;e.moveTo(t,n),e.lineTo(-t,n),e.lineTo(-t,-n),e.lineTo(t,-n),e.close(),e.stroke()}},{key:"createArcPath",value:function(e,t,n,i){if(!(t<=0))for(var a=(i-n)/48,o=0;o<=48;o++){var r=n+o*a,l=t*Math.cos(Oe(r)),s=t*Math.sin(Oe(r));0===o?e.moveTo(l,s):e.lineTo(l,s)}}}]),n}()).prototype,"shape",[EC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dE.Circle}}),FC=a(NC.prototype,"emitFrom",[AC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hE.Base}}),xC=a(NC.prototype,"position",[TC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new V(0,0,0)}}),zC=a(NC.prototype,"rotation",[PC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new V(0,0,0)}}),UC=a(NC.prototype,"scale",[OC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new V(1,1,1)}}),GC=a(NC.prototype,"arc",[LC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),HC=a(NC.prototype,"angle",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),qC=a(NC.prototype,"radius",[RC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),VC=a(NC.prototype,"radiusThickness",[_C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$C=a(NC.prototype,"rectangleThickness",[DC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ae(20,50)}}),MC=NC))||MC);S._RF.pop(),S._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var gE,mE,bE,wE,SE,kE,CE,EE,AE,TE=C.ccclass,PE=C.property,OE=Hk,LE=(XC=TE("SizeOvertimeModule"),JC=PE({type:W}),ZC=PE(W),QC=PE({type:Ak,visible:function(){return!this.separateAxes}}),eE=PE({type:Ak,visible:function(){return this.separateAxes}}),tE=PE({type:Ak,visible:function(){return this.separateAxes}}),XC((aE=a((iE=function(){function n(){t(this,n),r(this,"enable",aE,this),r(this,"separateAxes",oE,this),r(this,"size",rE,this),r(this,"x",lE,this),r(this,"y",sE,this),this.size.constant=1,this.x.constant=1,this.y.constant=1}return e(n,[{key:"update",value:function(e){if(this.enable){var t=1-e.remainingLifetime/e.startLifetime,n=e.randomSeed+OE;if(this.separateAxes){var i=Dk(this.x)?pe(n):0,a=Dk(this.y)?pe(n):0;e.size.x=e.startSize.x*this.x.evaluate(t,i),e.size.y=e.startSize.y*this.y.evaluate(t,a)}else{var o=Dk(this.size)?pe(n):0,r=this.size.evaluate(t,o);e.size.multiplyScalar(r)}}}}]),n}()).prototype,"enable",[JC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oE=a(iE.prototype,"separateAxes",[ZC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rE=a(iE.prototype,"size",[QC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),lE=a(iE.prototype,"x",[eE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),sE=a(iE.prototype,"y",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),nE=iE))||nE);S._RF.pop(),S._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var IE,RE,_E,DE,ME,NE,BE,FE,xE,zE,UE,GE,HE,qE,VE,$E,WE,KE,jE,YE,XE,JE,ZE,QE,eA,tA,nA,iA,aA,oA,rA,lA,sA,uA,cA,dA,hA,pA,yA,vA,fA,gA,mA,bA,wA,SA,kA,CA,EA,AA,TA,PA,OA,LA,IA,RA,_A,DA,MA,NA,BA,FA=C.ccclass,xA=C.property,zA=(gE=FA("VelocityOvertimeModule"),mE=xA({type:W}),bE=xA({type:Ak}),wE=xA({type:Ak}),gE((CE=a((kE=function(){function n(){t(this,n),r(this,"enable",CE,this),r(this,"x",EE,this),r(this,"y",AE,this),this._temp_v3=new V,this.x.constant=0,this.y.constant=0}return e(n,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=Dk(this.x)?pe(e.randomSeed+$k):0,a=Dk(this.y)?pe(e.randomSeed+Wk):0,o=V.set(this._temp_v3,this.x.evaluate(n,i),this.y.evaluate(n,a),0);e.velocity.add(o.multiplyScalar(t))}}}]),n}()).prototype,"enable",[mE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE=a(kE.prototype,"x",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),AE=a(kE.prototype,"y",[wE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),SE=kE))||SE);S._RF.pop(),S._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var UA,GA,HA,qA,VA,$A,WA,KA,jA,YA,XA,JA,ZA=C.ccclass,QA=C.property,eT=C.executeInEditMode,tT=C.disallowMultiple,nT=C.playOnFocus,iT=Le.Attr.setClassAttr,aT=x({World:0,Local:1}),oT=(IE=ZA("ParticleSystem"),RE=eT(!0),_E=tT(!0),DE=nT(!0),ME=QA({}),NE=QA({formerlySerializedAs:"preview"}),BE=QA(W),FE=QA({type:x(aT)}),xE=QA({formerlySerializedAs:"simulationSpace"}),zE=QA(L),UE=QA(W),GE=QA({type:Ak}),HE=QA({type:Ak}),qE=QA(Rk),VE=QA(W),$E=QA({type:Ak,formerlySerializedAs:"startSize"}),WE=QA({type:Ak,visible:function(){return this.startSize2D}}),KE=QA({type:Ak}),jE=QA(W),YE=QA({type:Ak,visible:function(){return this.startRotation3D}}),XE=QA({type:Ak,visible:function(){return this.startRotation3D}}),JE=QA({type:Ak,formerlySerializedAs:"startRotation"}),ZE=QA({type:Ak}),QE=QA({type:Ak}),eA=QA({type:fE}),tA=QA({type:zA}),nA=QA({type:LE}),iA=QA({type:YC}),aA=QA({type:oC}),oA=QA({type:kC}),rA=QA(FS),lA=QA({serializable:!0}),sA=QA({type:ue}),IE(uA=RE(uA=_E(uA=DE((a((cA=function(a){n(s,a);var o=i(s);function s(){var e;return t(this,s),e=o.call(this),r(e,"_preview",dA,l(e)),r(e,"playOnAwake",hA,l(e)),r(e,"_simulationSpace",pA,l(e)),r(e,"duration",yA,l(e)),r(e,"loop",vA,l(e)),r(e,"startDelay",fA,l(e)),r(e,"startLifetime",gA,l(e)),r(e,"startColor",mA,l(e)),r(e,"startSize2D",bA,l(e)),r(e,"startSizeX",wA,l(e)),r(e,"startSizeY",SA,l(e)),r(e,"startSpeed",kA,l(e)),r(e,"startRotation3D",CA,l(e)),r(e,"startRotationX",EA,l(e)),r(e,"startRotationY",AA,l(e)),r(e,"startRotationZ",TA,l(e)),r(e,"gravityModifier",PA,l(e)),r(e,"rateOverTime",OA,l(e)),r(e,"shapeModule",LA,l(e)),r(e,"velocityOvertimeModule",IA,l(e)),r(e,"sizeOvertimeModule",RA,l(e)),r(e,"rotationOvertimeModule",_A,l(e)),r(e,"colorOvertimeModule",DA,l(e)),r(e,"limitVelocityOvertimeModule",MA,l(e)),r(e,"bursts",NA,l(e)),r(e,"_spriteFrame",BA,l(e)),e._renderSpriteFrame=null,e.time=0,e.emitRateTimeCounter=0,e.isPlaying=!1,e.isStopped=!0,e.isEmitting=!1,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e.rateOverTime.constant=10,e.initProperties(),e}return e(s,[{key:"preview",get:function(){return this._preview},set:function(e){this._preview=e,e?this._startPreview():this._stopPreview()}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(e){this._simulationSpace=e,this._updateMaterial(),this._updateSimulationSpace()}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(e){this._renderSpriteFrame!==e&&(this._renderSpriteFrame=e,e&&!e._uuid||(this._spriteFrame=e),this._applySpriteFrame())}},{key:"assembler",get:function(){return this._assembler}},{key:"onEnable",value:function(){c(d(s.prototype),"onEnable",this).call(this),this._updateMaterial(),this._updateSimulationSpace()}},{key:"onDestroy",value:function(){c(d(s.prototype),"onDestroy",this).call(this)}},{key:"initProperties",value:function(){this._simulator=new ak(this)}},{key:"onFocusInEditor",value:function(){this._startPreview()}},{key:"onLostFocusInEditor",value:function(){this._stopPreview()}},{key:"_startPreview",value:function(){this._preview&&this.play()}},{key:"_stopPreview",value:function(){this._preview||(this.play(),this.stop())}},{key:"__preload",value:function(){c(d(s.prototype),"__preload",this).call(this),this.spriteFrame&&!this._renderSpriteFrame&&this._applySpriteFrame(),this.playOnAwake&&this.play()}},{key:"start",value:function(){this.node.position=new V(this.node.position.x,this.node.position.y,100)}},{key:"play",value:function(){this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isStopped=!1,this.isEmitting=!0,this._simulator.reset(),this.markForUpdateRenderData()}},{key:"stop",value:function(){this.isPlaying&&(this.isPlaying=!1),this.isEmitting&&(this.isEmitting=!1),this.isStopped=!0,this._simulator.reset(),this._simulator.stop()}},{key:"_flushAssembler",value:function(){var e,t=ee.Assembler.getAssembler(this);if(this._assembler!==t&&(this._assembler=t),null!==(e=this._assembler)&&void 0!==e&&e.createData){var n=this._simulator,i=n.renderData;i||(i=n.renderData=this._assembler.createData(this),n.uvFilled=0,i.particleInitRenderDrawInfo(this.renderEntity),n.initDrawInfo())}}},{key:"_applySpriteFrame",value:function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator&&this._simulator.updateUVs(!0),this._updateMaterial(),this.isStopped=!1,this.markForUpdateRenderData()):this.stop()}},{key:"_updateMaterial",value:function(){if(this._customMaterial){this.setSharedMaterial(this._customMaterial,0);var e=this.getRenderMaterial(0).passes[0].blendState.targets[0];e&&(this._dstBlendFactor=e.blendDst,this._srcBlendFactor=e.blendSrc)}var t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this.simulationSpace===aT.Local}),t&&t.passes.length>0&&this._updateBlendFunc()}},{key:"_finishedSimulation",value:function(){this.stop(),this.markForUpdateRenderData()}},{key:"_canRender",value:function(){return c(d(s.prototype),"_canRender",this).call(this)&&!this.isStopped&&null!==this._renderSpriteFrame&&void 0!==this._renderSpriteFrame}},{key:"_render",value:function(e){this.simulationSpace===aT.Local?e.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):this.simulationSpace===aT.World&&e.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)}},{key:"_updateSimulationSpace",value:function(){var e;"function"==typeof(null===(e=this._renderEntity)||void 0===e?void 0:e.setRenderTransform)&&(this.simulationSpace===aT.Local?(this._renderEntity.setRenderTransform(this.node),this._renderEntity.setUseLocal(!0)):this.simulationSpace===aT.World&&(this._renderEntity.setRenderTransform(null),this._renderEntity.setUseLocal(!1)))}},{key:"lateUpdate",value:function(e){this.isPlaying&&(this.time+=e,this._simulator.step(e))}},{key:"emitting",value:function(e){var t=this,n=this.startDelay.evaluate(0,1);if(this.time>n&&this.time>this.duration+n&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*e,this.emitRateTimeCounter>1){var i=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=i,this.emit(i,e)}var a,o=u(this.bursts);try{for(o.s();!(a=o.n()).done;){a.value.update(this,e)}}catch(e){o.e(e)}finally{o.f()}}var r=this.gravityModifier.evaluate(this.time/this.duration,1);0!==this._simulator.particles.length||this.isEmitting||!this.isPlaying?this._simulator.particles.forEach((function(n,i){t.sizeOvertimeModule.update(n),t.rotationOvertimeModule.update(n,e),t.colorOvertimeModule.update(n),t.velocityOvertimeModule.update(n,e),t.applyGravityModifier(n,r),t.limitVelocityOvertimeModule.update(n,e),n.pos.add(n.velocity.clone().multiplyScalar(e))})):this._finishedSimulation()}},{key:"emit",value:function(e,t){if(null!==this.spriteFrame)for(var n=this.time%this.duration/this.duration,i=0;i<e;i++){var a=this._simulator.emitParticle();if(a.init(),this.shapeModule.emit(a),this.simulationSpace===aT.World){var o=this.node.worldMatrix;a.pos.x+=o.m12,a.pos.y+=o.m13}var r=this.startSpeed.evaluate(n,this.rand());a.velocity.multiplyScalar(r),a.width=this.spriteFrame.width,a.height=this.spriteFrame.height;var l=this.startSizeX.evaluate(n,this.rand()),s=this.startSize2D?new V(l,this.startSizeY.evaluate(n,this.rand()),1):new V(l,l,1);a.startSize=s.clone(),a.size=s.clone();var u=this.startRotationZ.evaluate(n,this.rand()),c=this.startRotation3D?new V(this.startRotationX.evaluate(n,this.rand()),this.startRotationY.evaluate(n,this.rand()),u):new V(0,0,u);a.rotation=c,a.startColor=this.startColor.evaluate(n,this.rand()).clone(),a.color=a.startColor.clone(),a.startLifetime=this.startLifetime.evaluate(n,this.rand())+t,a.remainingLifetime=a.startLifetime,a.randomSeed=se(0,233280)}}},{key:"applyGravityModifier",value:function(e,t){e.velocity.add(new V(0,-9.8*t,0))}},{key:"rand",value:function(){return pe(se(0,Te.INT_MAX))}}]),s}(Ie)).prototype,"preview",[ME],Object.getOwnPropertyDescriptor(cA.prototype,"preview"),cA.prototype),dA=a(cA.prototype,"_preview",[NE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hA=a(cA.prototype,"playOnAwake",[BE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),a(cA.prototype,"simulationSpace",[FE],Object.getOwnPropertyDescriptor(cA.prototype,"simulationSpace"),cA.prototype),pA=a(cA.prototype,"_simulationSpace",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return aT.Local}}),yA=a(cA.prototype,"duration",[zE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),vA=a(cA.prototype,"loop",[UE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fA=a(cA.prototype,"startDelay",[GE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),gA=a(cA.prototype,"startLifetime",[HE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),mA=a(cA.prototype,"startColor",[qE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rk}}),bA=a(cA.prototype,"startSize2D",[VE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wA=a(cA.prototype,"startSizeX",[$E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),SA=a(cA.prototype,"startSizeY",[WE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),kA=a(cA.prototype,"startSpeed",[KE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),CA=a(cA.prototype,"startRotation3D",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),EA=a(cA.prototype,"startRotationX",[YE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),AA=a(cA.prototype,"startRotationY",[XE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),TA=a(cA.prototype,"startRotationZ",[JE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),PA=a(cA.prototype,"gravityModifier",[ZE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),OA=a(cA.prototype,"rateOverTime",[QE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ak}}),LA=a(cA.prototype,"shapeModule",[eA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fE}}),IA=a(cA.prototype,"velocityOvertimeModule",[tA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zA}}),RA=a(cA.prototype,"sizeOvertimeModule",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new LE}}),_A=a(cA.prototype,"rotationOvertimeModule",[iA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new YC}}),DA=a(cA.prototype,"colorOvertimeModule",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new oC}}),MA=a(cA.prototype,"limitVelocityOvertimeModule",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new kC}}),NA=a(cA.prototype,"bursts",[QA,rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BA=a(cA.prototype,"_spriteFrame",[lA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a(cA.prototype,"spriteFrame",[sA],Object.getOwnPropertyDescriptor(cA.prototype,"spriteFrame"),cA.prototype),uA=cA))||uA)||uA)||uA)||uA);iT(oT,"color","visible",!1),S._RF.pop(),S._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var rT=C.ccclass,lT=C.property,sT=(UA=rT("ItemCollectionFX"),GA=Ni.required,HA=lT(F),qA=Ni.required,VA=lT(q),$A=Ni.required,WA=lT(q),UA((YA=a((jA=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"sprite",YA,l(e)),r(e,"standardParticlesContainer",XA,l(e)),r(e,"quickParticlesContainer",JA,l(e)),e.standardParticles=[],e.quickParticles=[],e}return e(s,[{key:"__preload",value:function(){this.standardParticles=this.standardParticlesContainer.getComponentsInChildren(oT),this.quickParticles=this.quickParticlesContainer.getComponentsInChildren(oT),Ni.validateRequiredProperties(this,s)}},{key:"onDisable",value:function(){this.standardParticlesContainer.active=!1,this.quickParticlesContainer.active=!1}},{key:"playExplosionParticles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?(this.quickParticlesContainer.active=!0,this.playParticles(this.quickParticles)):(this.standardParticlesContainer.active=!0,this.playParticles(this.standardParticles))}},{key:"playParticles",value:function(e){var t,n=u(e);try{for(n.s();!(t=n.n()).done;){t.value.play()}}catch(e){n.e(e)}finally{n.f()}}}]),s}(T)).prototype,"sprite",[GA,HA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XA=a(jA.prototype,"standardParticlesContainer",[qA,VA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JA=a(jA.prototype,"quickParticlesContainer",[$A,WA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KA=jA))||KA);S._RF.pop(),S._RF.push({},"7df59GGBIxFo7OyHCGrEKe5","addItemEffect",void 0);var uT=new V(.8,1.2,1),cT=new V(1.2,.8,1),dT=new V(.5,.5,.5),hT=new V(.65,.65,.65),pT=function(){var e=o((function*(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.playExplosionParticles(n),je.playSound(Qi.ITEM_REWARD),n?yield yT(e,t):yield fT(e,t),je.playSound(Qi.BUTTON_CLICK)}));return function(t,n){return e.apply(this,arguments)}}();function yT(e,t){return vT.apply(this,arguments)}function vT(){return(vT=o((function*(e,t){var n=Ve.runTweenAsync(R(e.node).to(.1,{scale:uT}).to(.1,{scale:cT}).to(.1,{scale:V.ONE}).to(.3,{scale:hT})),i=e.node.worldPosition.x,a=e.node.worldPosition.y,o=new V,r=Ve.runTweenAsync(R(e.node).update(.8,(function(n,r){t.node.getWorldPosition(o);var l=z.quadOut(r),s=Se(i,o.x,l),u=Math.max(a,o.y),c=Se(a,u+300,.5);if(r<.5){var d=z.cubicOut(2*r),h=Se(a,c,d);e.node.setWorldPosition(s,h,0)}else{var p=z.cubicIn(2*(r-.5)),y=Se(c,o.y,p);e.node.setWorldPosition(s,y,0)}})));yield Promise.all([n,r])}))).apply(this,arguments)}function fT(e,t){return gT.apply(this,arguments)}function gT(){return(gT=o((function*(e,t){yield NT(e),yield Ve.waitTweenAsync(.8),yield BT(e,t),yield FT(e,t)}))).apply(this,arguments)}var mT,bT,wT,ST,kT,CT,ET,AT,TT,PT,OT,LT,IT,RT,_T,DT,MT,NT=function(e){return Ve.runTweenAsync(R(e.node).to(.1,{scale:uT}).to(.1,{scale:cT}).to(.1,{scale:V.ONE}))},BT=function(e,t){return Ve.runTweenAsync(R(e.node).to(1,{worldPosition:new V(t.node.worldPosition.x,t.node.worldPosition.y+30,t.node.worldPosition.z),scale:dT},{easing:"cubicInOut"}))},FT=function(e,t){var n=t.node.worldPosition.clone(),i=new V(n.x,n.y+70,n.z);return Ve.runTweenAsync(R(e.node).to(.3,{worldPosition:i,scale:hT},{easing:"cubicOut"}).to(.5,{worldPosition:n},{easing:"cubicIn"}))};S._RF.pop(),S._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var xT,zT,UT,GT,HT,qT=C.ccclass,VT=C.property,$T=C.disallowMultiple,WT=(mT=qT("ShiningStar"),bT=VT(F),wT=VT({serializable:!0,visible:!1}),ST=VT({type:L,displayName:"Scale up duration",min:.001}),kT=VT({serializable:!0,visible:!1}),CT=VT({type:L,displayName:"Bounce and Fall duration",min:.001}),ET=VT({serializable:!0,visible:!1}),AT=VT({type:L,displayName:"Start scale"}),TT=VT({serializable:!0,visible:!1}),PT=VT({type:L,displayName:"End scale"}),mT(OT=$T((IT=a((LT=function(a){n(f,a);var s,u,c,d,h,p,y,v=i(f);function f(){var e;t(this,f);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=v.call.apply(v,[this].concat(i)),r(e,"shine",IT,l(e)),r(e,"twScaleUpDuration",RT,l(e)),r(e,"twBounceAndFallDuration",_T,l(e)),r(e,"twStartScale",DT,l(e)),r(e,"twEndScale",MT,l(e)),e.isBeingAnimated=!1,e}return e(f,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(e){this.twScaleUpDuration=e}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(e){this.twBounceAndFallDuration=e}},{key:"startScale",get:function(){return this.twStartScale},set:function(e){this.twStartScale=e}},{key:"endScale",get:function(){return this.twEndScale},set:function(e){this.twEndScale=e}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(B),this.uiOpacity=this.node.getComponent(B),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(y=o((function*(){if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0,yield this.animateAppear(),yield this.animateDisappear(),this.isBeingAnimated=!1})),function(){return y.apply(this,arguments)})},{key:"animateAppear",value:(p=o((function*(){this.shineOpacity.opacity=255,yield Promise.all([this.animateFadeIn(),this.animateScaleUp()])})),function(){return p.apply(this,arguments)})},{key:"animateDisappear",value:(h=o((function*(){yield Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]),this.node.setScale(0,0),this.uiOpacity.opacity=0})),function(){return h.apply(this,arguments)})},{key:"animateBounceAndFall",value:(d=o((function*(){var e=this.node.position.x,t=this.node.position.y,n=[60,120],i=(Math.random()*(n[1]-n[0])+n[0])*(Math.PI/180),a=e+200*Math.cos(i),o=t+200*Math.sin(i),r=t-500,l=Ve.runTweenAsync(R(this.node).to(.2*this.twBounceAndFallDuration,{position:new V(a,o,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new V(a,r,this.node.position.z)},{easing:"cubicIn"})),s=[0,360],u=Ve.runTweenAsync(R(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new V(0,0,Math.random()*(s[1]-s[0])*(a>e?-1:1))},{easing:"sineOut"}));yield Promise.all([l,u]),this.node.eulerAngles=new V(0,0,0)})),function(){return d.apply(this,arguments)})},{key:"animateFadeIn",value:(c=o((function*(){var e=Math.max(this.scaleUpDuration/4,.01);yield Ve.runTweenAsync(R(this.uiOpacity).to(e,{opacity:255}))})),function(){return c.apply(this,arguments)})},{key:"animateScaleUp",value:(u=o((function*(){this.node.setScale(this.startScale,this.startScale);var e=new V(this.endScale,this.endScale,1);yield Ve.runTweenAsync(R(this.node).to(this.scaleUpDuration,{scale:e},{easing:"cubicOut"}))})),function(){return u.apply(this,arguments)})},{key:"animateScaleDown",value:(s=o((function*(){var e=new V(0,0,1);yield Ve.runTweenAsync(R(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:e},{easing:"cubicIn"}))})),function(){return s.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}}]),f}(T)).prototype,"shine",[bT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RT=a(LT.prototype,"twScaleUpDuration",[wT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),a(LT.prototype,"scaleUpDuration",[ST],Object.getOwnPropertyDescriptor(LT.prototype,"scaleUpDuration"),LT.prototype),_T=a(LT.prototype,"twBounceAndFallDuration",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),a(LT.prototype,"bounceAndFallDuration",[CT],Object.getOwnPropertyDescriptor(LT.prototype,"bounceAndFallDuration"),LT.prototype),DT=a(LT.prototype,"twStartScale",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),a(LT.prototype,"startScale",[AT],Object.getOwnPropertyDescriptor(LT.prototype,"startScale"),LT.prototype),MT=a(LT.prototype,"twEndScale",[TT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),a(LT.prototype,"endScale",[PT],Object.getOwnPropertyDescriptor(LT.prototype,"endScale"),LT.prototype),OT=LT))||OT)||OT);S._RF.pop(),S._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var KT=C.ccclass,jT=C.property,YT=C.disallowMultiple,XT=Ludex.Utils.Array,JT=(xT=KT("StarParticles"),zT=jT({type:[WT],displayName:"Prebuilt Shining stars"}),xT(UT=YT((HT=a((GT=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"shiningStars",HT,l(e)),e}return e(c,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(s=o((function*(e){var t=this.getFirstAvailableShiningStar();if(void 0===t)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");var n=v(e,2),i=n[0],a=n[1],o=new V(i,a,this.node.worldPosition.z);t.node.worldPosition=o,yield t.playAnimation()})),function(e){return s.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return XT.search(this.shiningStars,(function(e){return e.isAvailable}))}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}}]),c}(T)).prototype,"shiningStars",[zT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UT=GT))||UT)||UT);S._RF.pop(),S._RF.push({},"d10c8b8p8RD45oVz5qSL2LD","clampToBoundingBox",void 0);S._RF.pop(),S._RF.push({},"02e30BdQXxIEbItBFTh00UT","getClosestPair",void 0);var ZT=function e(t){var n=nP(t);return function(i,a,o,r){if(o===r)return[i,a];if(o>r)return e(t)(i,a,r,o);var l=n(o,r);return l>=tP(i,t.length)(a[0],a[1])?[i,a]:[eP(i,t.length)(o,r,l),[o,r]]}},QT=function(e){return function(t,n){return t*(2*e-t-1)/2+(n-t-1)}},eP=function e(t,n){return function(i,a,o){if(i===a)return t;if(i>a)return e(t,n)(a,i,o);var r=QT(n)(i,a);return[].concat(g(t.slice(0,r)),[o],g(t.slice(r+1)))}},tP=function e(t,n){return function(i,a){var o;if(i===a)return 1/0;if(i>a)return e(t,n)(a,i);var r=QT(n)(i,a);return null!==(o=t[r])&&void 0!==o?o:1/0}},nP=function(e){return function(t,n){var i=e[t],a=e[n];return ae.distance(i,a)}};S._RF.pop(),S._RF.push({},"a70090n5pRBdIZb/GuW6wDs","toSortedIndices",void 0);var iP=Ludex.Utils.Array,aP=function(e,t){var n,i=e.map((function(e,t){return{data:e,index:t}}));return i.sort((function(e,n){return t(e.data,n.data)})),i.reduce((function(e,t,n){return e[t.index]=n,e}),(n=e.length,iP.fillWith(n,(function(){return 0}))))};S._RF.pop(),S._RF.push({},"56e87lhVSNJ8LMUzQpgUomc","randomSign",void 0);var oP,rP,lP,sP,uP,cP,dP,hP,pP,yP,vP,fP,gP,mP=function(){return Pe()>.5?1:-1};S._RF.pop(),S._RF.push({},"ce29fBj4hlOb5ZB/FQ77PpP","Ray",void 0);var bP,wP,SP,kP,CP,EP,AP,TP,PP,OP,LP,IP=C.ccclass,RP=C.property,_P=(oP=IP("Ray"),rP=Ni.required,lP=RP(P),sP=Ni.required,uP=RP(F),cP=RP({type:B}),dP=RP({type:L}),oP((yP=a((pP=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"uiTransform",yP,l(e)),r(e,"sprite",vP,l(e)),r(e,"uiOpacity",fP,l(e)),r(e,"widthOffset",gP,l(e)),e}return e(s,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,s)}}]),s}(T)).prototype,"uiTransform",[rP,lP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vP=a(pP.prototype,"sprite",[sP,uP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fP=a(pP.prototype,"uiOpacity",[cP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gP=a(pP.prototype,"widthOffset",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hP=pP))||hP);S._RF.pop(),S._RF.push({},"a20fagfOq5En6C68G/OaEAy","RayManagerProperties",void 0);var DP,MP,NP,BP,FP,xP,zP,UP,GP,HP,qP,VP,$P,WP,KP=C.ccclass,jP=C.property,YP=(bP=KP("RayManagerProperties"),wP=jP({type:L}),SP=jP({type:L}),kP=jP({type:O,min:1}),CP=jP({type:L,min:0,max:1,slide:!0,step:.01}),bP((TP=a((AP=e((function e(){t(this,e),r(this,"thicknessStart",TP,this),r(this,"thicknessEnd",PP,this),r(this,"segments",OP,this),r(this,"jaggedness",LP,this)}))).prototype,"thicknessStart",[wP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),PP=a(AP.prototype,"thicknessEnd",[SP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),OP=a(AP.prototype,"segments",[kP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),LP=a(AP.prototype,"jaggedness",[CP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),EP=AP))||EP);S._RF.pop(),S._RF.push({},"19a4dTqUJdEXb8HsBhOcSyI","RayManager",void 0);var XP,JP,ZP,QP,eO,tO,nO,iO,aO=C.ccclass,oO=C.property,rO=(DP=aO("RayManager"),MP=Ni.required,NP=oO({type:fe}),BP=Ni.required,FP=oO({type:B}),xP=Ni.required,zP=oO({type:P}),UP=oO({type:YP}),DP((qP=a((HP=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"rayPrefab",qP,l(e)),r(e,"uiOpacity",VP,l(e)),r(e,"uiTransform",$P,l(e)),r(e,"properties",WP,l(e)),e}return e(s,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,s),this.rayPool=lO(this.rayPrefab,this.node),this.rayPool=cO(this.rayPool,this.properties.segments)}},{key:"onEnable",value:function(){this.rayPool=cO(this.rayPool,this.properties.segments)}},{key:"onDestroy",value:function(){this.rayPool=pO(this.rayPool)}},{key:"createRayAnimation",value:function(e,t){var n=this,i=uO(this.rayPool,this.properties.segments),a=v(i,2),o=a[0],r=a[1];this.rayPool=r;var l=SO(t);return bO(this,o,e,l).call((function(){n.rayPool=hO(o,n.rayPool)}))}}]),s}(T)).prototype,"rayPrefab",[MP,NP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VP=a(HP.prototype,"uiOpacity",[BP,FP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$P=a(HP.prototype,"uiTransform",[xP,zP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WP=a(HP.prototype,"properties",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new YP}}),GP=HP))||GP),lO=function(e,t){return{prefab:e,container:t,activeRays:[],inactiveRays:[]}},sO=function(e){var t;return null!==(t=yO(e))&&void 0!==t?t:vO(e)},uO=function(e,t){for(var n=[],i=e,a=0;a<t;a++){var o=sO(i),r=v(o,2),l=r[0],s=r[1];n.push(l),i=s}return[n,i]},cO=function(e,t){if(e.inactiveRays.length>=t)return e;for(var n=t-e.inactiveRays.length,i=e,a=0;a<n;a++){var o=vO(i),r=v(o,2),l=r[0],s=r[1];i=dO(l,s)}return i},dO=function(e,t){e.node.active=!1;var n=[].concat(g(t.inactiveRays),[e]),i=t.activeRays.filter((function(t){return t!==e}));return s(s({},t),{},{activeRays:i,inactiveRays:n})},hO=function(e,t){var n,i=u(e);try{for(i.s();!(n=i.n()).done;){n.value.node.active=!1}}catch(e){i.e(e)}finally{i.f()}var a=[].concat(g(t.inactiveRays),g(e)),o=t.activeRays.filter((function(t){return!e.includes(t)}));return s(s({},t),{},{activeRays:o,inactiveRays:a})},pO=function(e){e.container.destroyAllChildren();return s(s({},e),{},{activeRays:[],inactiveRays:[]})},yO=function(e){if(0!==e.inactiveRays.length){var t=b(e.inactiveRays),n=t[0],i=t.slice(1),a=n,o=[].concat(g(e.activeRays),[a]),r=i;return a.node.active=!0,[a,s(s({},e),{},{activeRays:o,inactiveRays:r})]}},vO=function(e){var t=ye(e.prefab);e.container.addChild(t);var n=t.getComponent(_P);if(!n)throw new Error("Ray component not found");var i=[].concat(g(e.activeRays),[n]);return n.node.active=!0,[n,s(s({},e),{},{activeRays:i})]},fO=function(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=wO(e.properties.segments,e.uiTransform.height*e.node.worldScale.y,e.uiTransform.width*e.node.worldScale.x,e.properties.jaggedness),o={start:{x:0,y:0},end:{x:0,y:e.uiTransform.height*e.node.worldScale.y}},r={start:e.node.worldPosition,end:null!=n?n:{x:0,y:e.node.worldPosition.y+e.uiTransform.height*e.node.worldScale.y}},l=kO(o.start,o.end)(r.start,r.end),s=gO(),u=function(e,t,n){return s(e,l(t),l(n))},c={x:0,y:0},d=i,h=0;h<e.properties.segments;h++){var p=a(c,h,d),y=p.start,v=p.end,f=p.seed,g=mO(e,h/(e.properties.segments-1)),m=t[h],b=u(m,y,v);b.uiTransform.setContentSize(b.uiTransform.width,g),c=v,d=f}return t},gO=function(){var e={x:0,y:0};return function(t,n,i){var a=(n.x+i.x)/2,o=(n.y+i.y)/2;ae.subtract(e,i,n);var r=ae.len(e)/t.node.worldScale.x+t.widthOffset;ae.normalize(e,e);var l=180*Math.atan2(e.y,e.x)/Math.PI;return t.node.setWorldPosition(a,o,0),t.node.setRotationFromEuler(0,0,l),t.uiTransform.setContentSize(r,t.uiTransform.height),t}},mO=function(e,t){return Se(e.properties.thicknessStart,e.properties.thicknessEnd,t)},bO=function(e,t,n,i){var a,o=SO(i),r=SO(o);return(a=R(e.uiOpacity).call((function(){return fO(e,t,n,i)})).call((function(){var e,n=u(t);try{for(n.s();!(e=n.n()).done;){e.value.uiOpacity.opacity=255}}catch(e){n.e(e)}finally{n.f()}})).set({opacity:255}).delay(.05).set({opacity:0}).delay(.05).call((function(){return fO(e,t,n,o)})).set({opacity:255}).delay(.05).set({opacity:0}).delay(.05).call((function(){return fO(e,t,n,r)})).set({opacity:255})).parallel.apply(a,[R(e.uiOpacity).delay(.2).set({opacity:0}).call((function(){var e,n=u(t);try{for(n.s();!(e=n.n()).done;){e.value.uiOpacity.opacity=0}}catch(e){n.e(e)}finally{n.f()}}))].concat(g(t.map((function(t,n,i){return R(t.node).update(.2,(function(a,o){t.uiTransform.setContentSize(t.uiTransform.width,Se(mO(e,n/(i.length-1)),e.properties.thicknessEnd,z.cubicIn(o)))}))})))))},wO=function(e,t,n,i){return function(a,o,r){if(0===o)return{start:{x:0,y:0},end:{x:0,y:0},seed:r};if(o===e-1)return{start:{x:a.x,y:a.y},end:{x:0,y:t},seed:r};var l=SO(r),s=SO(l),u=a.x,c=a.y,d=(o-1)/(e-1),h=o/(e-1),p=Math.max(-n,Se(u,u-n,i)),y=Math.min(n,Se(u,u+n,i)),v=Re(s,p,y)*Se(1,0,h),f=Se(0,t,d),g=Se(0,t,h);return{start:{x:u,y:c},end:{x:v,y:Re(l,f,g)},seed:s}}},SO=function(e){return Re(null!=e?e:se(0,1e6),0,1e6)},kO=function(e,t){var n={x:t.x-e.x,y:t.y-e.y};return function(t,i){var a={x:i.x-t.x,y:i.y-t.y},o=Math.atan2(n.y,n.x),r=Math.atan2(a.y,a.x)-o,l=Math.cos(r),s=Math.sin(r),u=ae.len(a)/ae.len(n),c=t.x-e.x,d=t.y-e.y,h={x:0,y:0};return function(e){return h.x=e.x*l-e.y*s,h.y=e.x*s+e.y*l,h.x*=u,h.y*=u,h.x+=c,h.y+=d,{x:h.x,y:h.y}}}};S._RF.pop(),S._RF.push({},"a7ff8uVnP1G3ppM9F/A5DYq","Cloud",void 0);var CO,EO,AO,TO,PO,OO,LO,IO,RO,_O,DO,MO,NO,BO,FO,xO=C.ccclass,zO=C.property,UO=new V(0,300),GO=(XP=xO("Cloud"),JP=Ni.required,ZP=zO(ce),QP=zO({type:[rO]}),XP((nO=a((tO=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"animation",nO,l(e)),r(e,"rays",iO,l(e)),e.cachedCanvasUiTransform=null,e}return e(s,[{key:"canvas",get:function(){var e,t,n=null!==(e=this.cachedCanvasUiTransform)&&void 0!==e?e:null===(t=re("Canvas"))||void 0===t?void 0:t.getComponent(P);return _e(null!=n,"Cloud: canvasUiTransform is null"),n}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this,s)}},{key:"getLightningTween",value:function(e){var t,n=this;return(t=R(this.node).call((function(){Ve.runAnimationAsync(n.animation)})).delay(.2)).parallel.apply(t,g(this.rays.map((function(t){return t.createRayAnimation(e)}))))}},{key:"getMoveToScreenTween",value:function(e,t){var n=this.canvas.width,i="left"===t?-300:n+300,a=R(this.node).set({worldPosition:new V(i,e.y)}).to(.6,{worldPosition:new V(e.x,e.y,0)},{easing:"quadOut"}),o=De(e.y<this.canvas.height/2?1.2:1.7-e.y/this.canvas.height,.7,2),r=R(this.node).set({scale:new V(1.1*o,.9*o,1)}).to(.6,{scale:new V(o,o,1)},{easing:"quadIn"});return R(this.node).parallel(a,r)}},{key:"getMoveOutScreenTween",value:function(e){var t=this,n=this.canvas,i=n.width,a=n.height,o=new V("left"===e?-i/2-300:i/2+300,this.node.position.y),r=new V(0,-a/2-500);return R(this.node).call((function(){o.set(o.x,t.node.position.y)})).to(.6,{position:function(){return o}},{easing:"quadIn"}).set({position:r})}},{key:"getMoveToScreenCenterTween",value:function(){var e=this.canvas,t=e.width,n=e.height,i=this.getRandomInitialPosition(t,n),a=i.x,o=i.y;return R(this.node).set({position:new V(a,o,0)}).to(.8,{position:UO},{easing:"quadOut"})}},{key:"getRandomInitialPosition",value:function(e,t){switch(se(0,4)){case 0:return{x:Math.random()*e-e/2,y:t/2+300};case 1:return{x:Math.random()*e-e/2,y:-t/2-300};case 2:return{x:-e/2-300,y:Math.random()*t-t/2};case 3:return{x:e/2+300,y:Math.random()*t-t/2}}}}]),s}(T)).prototype,"animation",[JP,ZP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iO=a(tO.prototype,"rays",[QP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eO=tO))||eO);S._RF.pop(),S._RF.push({},"e6e5eBLV4pKT6u5MYHNZfQd","CloudEffectProperties",void 0);var HO,qO,VO,$O,WO,KO,jO=C.ccclass,YO=C.property,XO=(CO=jO("CloudEffectProperties"),EO=Ni.required,AO=YO({group:{name:"Thunder Effect",style:"section"},type:q}),TO=Ni.required,PO=YO({group:{name:"Thunder Effect",style:"section"},type:GO}),OO=Ni.required,LO=YO({group:{name:"Thunder Effect",style:"section"},type:GO}),IO=Ni.required,RO=YO({group:{name:"Thunder Effect",style:"section"},type:GO}),CO((MO=a((DO=e((function e(){t(this,e),r(this,"cloudContainer",MO,this),r(this,"cloud1",NO,this),r(this,"cloud2",BO,this),r(this,"cloud3",FO,this)}))).prototype,"cloudContainer",[EO,AO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NO=a(DO.prototype,"cloud1",[TO,PO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=a(DO.prototype,"cloud2",[OO,LO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FO=a(DO.prototype,"cloud3",[IO,RO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_O=DO))||_O);S._RF.pop(),S._RF.push({},"d716cluEdBCx5J3CuLcUQc6","CloudEffect",void 0);var JO,ZO,QO,eL,tL,nL,iL,aL,oL,rL,lL,sL,uL,cL,dL,hL,pL,yL,vL,fL,gL,mL,bL,wL,SL,kL,CL,EL,AL,TL,PL,OL,LL,IL,RL,_L,DL,ML,NL,BL,FL,xL,zL,UL,GL,HL,qL,VL,$L,WL,KL=C.ccclass,jL=C.property,YL=Ludex.Utils.Array,XL=(HO=KL("CloudEffect"),qO=Ni.required,VO=jL({type:XO}),HO((KO=a((WO=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"properties",KO,l(e)),e}return e(d,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,d)}},{key:"onEnable",value:function(){var e,t=null===(e=re("Canvas"))||void 0===e?void 0:e.getComponent(P);_e(null!=t,"Canvas UI transform not found"),this.canvasUiTransform=t}},{key:"playThunderAnimations",value:(u=o((function*(e){var t,n=this,i=e.manager,a=e.pairs,o=e.board,r=a.flat(),l=[this.properties.cloud1,this.properties.cloud2,this.properties.cloud3],s=this.getSimpleCloudPositions(r,l),u=(t=R(this.node)).parallel.apply(t,g(s.map((function(e,t){return n.getCloudFxTween({manager:i,board:o,effect:e,delay:.1*t})}))));yield Ve.runTweenAsync(u)})),function(e){return u.apply(this,arguments)})},{key:"playMultiThunderAnimation",value:(s=o((function*(e){var t=e.manager,n=e.pairs,i=e.board,a=e.stagger,o=this.properties.cloud1;o.node.active=!0,yield Ve.runTweenAsync(o.getMoveToScreenCenterTween()),yield Ve.waitTweenAsync(.2),i.clear({pairs:n,stagger:a,lightning:!0});for(var r=[],l=0,s=2*n.length;l<s;l++){var u=n[Math.floor(l/2)];if(void 0!==u){var c=u[l%2];void 0!==c&&(0!==l&&l%2==0&&(t.node.scene.emit(Es.ADD_COMBO),t.node.scene.emit(Es.ADD_SCORE)),t.shakeGame(),t.shakeScreen(500),je.playSound(Qi.THUNDERBOLT),r.push(Ve.runTweenAsync(o.getLightningTween(c.node.worldPosition))),a&&(yield Ve.waitTweenAsync(a)))}}yield Promise.all(r),o.node.active=!1})),function(e){return s.apply(this,arguments)})},{key:"getSimpleCloudPositions",value:function(e,t){var n=function(e){if(e.length<2)throw new Error("Not enough points to find a closest pair");for(var t=e[0],n=e[1],i=[ae.distance(t,n)],a=[0,1],o=ZT(e),r=0;r<e.length-1;r++)for(var l=r+1;l<e.length;l++){var s=o(i,a,r,l),u=v(s,2);i=u[0],a=u[1]}return a}([e[0].node.worldPosition,e[1].node.worldPosition,e[2].node.worldPosition,e[3].node.worldPosition]),i=YL.split(e,(function(e,t){return n.includes(t)})),a=i.left,o=i.right;_e(2===a.length,"Closest pair must have 2 tiles"),_e(2===o.length,"Other tiles must have 2 tiles");var r,l,s=a[0],u=a[1],c=o[0],d=o[1],h=c.node.worldPosition,p=d.node.worldPosition,y=(r=this.canvasUiTransform.getBoundingBoxToWorld(),l=100,function(e){return{x:Math.max(r.xMin+l,Math.min(r.xMax-l,e.x)),y:Math.max(r.yMin+l,Math.min(r.yMax-l,e.y))}}),f=Math.max(s.node.worldPosition.y,u.node.worldPosition.y)+he(150,200),g=h.y+he(150,200),m=p.y+he(150,200),b=(s.node.worldPosition.x+u.node.worldPosition.x)/2+he(50,100)*mP(),w=h.x+he(50,100)*mP(),S=p.x+he(50,100)*mP(),k=y({x:b,y:f}),C=y({x:w,y:g}),E=y({x:S,y:m}),A=aP([k,C,E],(function(e,t){return t.y-e.y}));return[{type:"multi-tile-cloud",cloud:t[A[0]],worldPosition:k,tiles:[s,u]},{type:"single-tile-cloud",clouds:[{cloud:t[A[1]],worldPosition:C,tile:c},{cloud:t[A[2]],worldPosition:E,tile:d}],tiles:[c,d]}]}},{key:"getCloudFxTween",value:function(e){return"multi-tile-cloud"===e.effect.type?this.getMultiTileCloudFxTween(e.effect,e):this.getSingleTileCloudFxTween(e.effect,e)}},{key:"getMultiTileCloudFxTween",value:function(e,t){var n=t.manager,i=t.board,a=t.delay,o=void 0===a?0:a;e.cloud.node.active=!0;var r=e.cloud.getMoveToScreenTween(e.worldPosition,"left"),l=R(this.node).delay(.4).call(this.clearTiles.bind(this,n,i,[e.tiles],.05)),s=R(this.node).delay(.2).call(n.createClearExplosionAt.bind(n,e.tiles[0].node.worldPosition)),u=e.cloud.getLightningTween(e.tiles[0].node.worldPosition),c=e.cloud.getLightningTween(e.tiles[1].node.worldPosition),d=R(this.node).delay(.2).call(n.createClearExplosionAt.bind(n,e.tiles[1].node.worldPosition)),h=R(this.node).parallel(u,s),p=R(this.node).delay(.3).parallel(c,d),y=e.cloud.getMoveOutScreenTween("left");return R(this.node).delay(o).then(r).parallel(l,h,p).then(y).call((function(){e.cloud.node.active=!1}))}},{key:"getSingleTileCloudFxTween",value:function(e,t){var n=t.manager,i=t.board,a=t.delay,o=void 0===a?0:a,r=e.clouds[0],l=e.clouds[1];r.cloud.node.active=!0,l.cloud.node.active=!0;var s=R(this.node).delay(.6).call(this.clearTiles.bind(this,n,i,[e.tiles],.1)),u=r.cloud.getMoveToScreenTween(r.worldPosition,"right"),c=r.cloud.getLightningTween(e.tiles[0].node.worldPosition).then(r.cloud.getMoveOutScreenTween("right")),d=R(this.node).delay(.2).call(n.createClearExplosionAt.bind(n,r.tile.node.worldPosition)),h=R(this.node).delay(.1).then(l.cloud.getMoveToScreenTween(l.worldPosition,"left")),p=l.cloud.getLightningTween(e.tiles[1].node.worldPosition).then(l.cloud.getMoveOutScreenTween("left")),y=R(this.node).delay(.2).call(n.createClearExplosionAt.bind(n,l.tile.node.worldPosition)),v=R(this.node).then(u).parallel(c,d).call((function(){r.cloud.node.active=!1})),f=R(this.node).then(h).parallel(p,y).call((function(){l.cloud.node.active=!1}));return R(this.node).delay(o).parallel(v,f,s)}},{key:"clearTiles",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.shakeGame(),e.shakeScreen(500),je.playSound(Qi.THUNDERBOLT),t.clear({pairs:n,stagger:i,lightning:!0,delay:1.5}),e.node.scene.emit(Es.ADD_COMBO),e.node.scene.emit(Es.ADD_SCORE)}}]),d}(T)).prototype,"properties",[qO,VO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new XO}}),$O=WO))||$O);S._RF.pop(),S._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var JL=Ludex.Utils.Valid,ZL=C.ccclass,QL=C.property,eI=codex.monitorError,tI=(JO=ZL("EffectManager"),ZO=Ni.required,QO=QL({group:{name:"Thunder Effect",style:"section"},type:XL}),eL=Ni.required,tL=QL({group:{name:"Mask Effect",style:"section"},type:qr}),nL=Ni.required,iL=QL({group:{name:"Mask Effect",style:"section"},type:q}),aL=Ni.required,oL=QL({group:{name:"Tornado Effect",style:"section"},type:q}),rL=Ni.required,lL=QL({group:{name:"Clear Particle Effect",style:"section"},type:q,displayName:"Particle holder node"}),sL=Ni.required,uL=QL({group:{name:"Clear Particle Effect",style:"section"},type:oT,displayName:"Emitter 1"}),cL=Ni.required,dL=QL({group:{name:"Clear Particle Effect",style:"section"},type:oT,displayName:"Emitter 2"}),hL=Ni.required,pL=QL({group:{name:"Star Particles Effect",style:"section"},type:JT}),yL=Ni.required,vL=QL({group:{name:"Confetti Effect",style:"section"},type:oT}),fL=Ni.required,gL=QL({group:{name:"Confetti Effect",style:"section"},type:oT}),mL=QL({group:{name:"Add Item Effect",style:"section"},type:sT}),bL=QL({group:{name:"Add Item Effect",style:"section"},type:ue}),wL=QL({group:{name:"Add Item Effect",style:"section"},type:ue}),SL=QL({group:{name:"Add Item Effect",style:"section"},type:ue}),kL=QL({group:{name:"Add Item Effect",style:"section"},type:ue}),CL=Ni.required,EL=QL({type:q,displayName:"Clear Explosion Container",group:{name:"Clear Explosion Effect",style:"section"}}),AL=Ni.onlyRunInLifeCycle,TL=Ni.onlyRunInLifeCycleAsync,JO((($L=function(a){n(E,a);var s,c,d,h,p,y,f,g,m,b,w,S,k,C=i(E);function E(){var e;t(this,E);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=C.call.apply(C,[this].concat(i)),r(e,"cloudEffect",LL,l(e)),r(e,"backgroundMask",IL,l(e)),r(e,"masks",RL,l(e)),r(e,"tornadoContainer",_L,l(e)),r(e,"clearParticleHolder",DL,l(e)),r(e,"clearParticle1",ML,l(e)),r(e,"clearParticle2",NL,l(e)),r(e,"starParticle",BL,l(e)),r(e,"leftConfetti",FL,l(e)),r(e,"rightConfetti",xL,l(e)),r(e,"itemEffect",zL,l(e)),r(e,"hintSpriteFrame",UL,l(e)),r(e,"thunderSpriteFrame",GL,l(e)),r(e,"tornadoSpriteFrame",HL,l(e)),r(e,"pliersSpriteFrame",qL,l(e)),e.maskTargets=[],e.vibrate=null,e.gameShakeSignal=new In,r(e,"clearExplosionContainer",VL,l(e)),e}return e(E,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,E)}},{key:"onLoad",value:function(){this.clearParticleHolder.active=!1,this.leftConfetti.node.active=!1,this.rightConfetti.node.active=!1}},{key:"update",value:function(){if(this.maskTargets.length>0)for(var e=0;e<this.maskTargets.length;e++){var t=this.maskTargets[e];if(!t.isHidden()){var n=this.masks[e];n&&n.setWorldPosition(t.node.worldPosition)}}}},{key:"onEnable",value:function(){this.node.scene.on(Es.GRID_RESIZE,this.handleBoardResize,this)}},{key:"onDisable",value:function(){this.node.scene.off(Es.GRID_RESIZE,this.handleBoardResize,this)}},{key:"handleBoardResize",value:function(e){if(this.clearParticleHolder.setScale(e,e),this.clearExplosionContainer.setScale(e,e),Je.isLandscape()){var t=te.clamp(e,1,1.5);this.cloudEffect.node.setScale(t,t)}else this.cloudEffect.node.setScale(1,1)}},{key:"playClearEffectAt",value:function(e){var t=this,n=e[0],i=n.x,a=n.y,o=e[1],r=o.x,l=o.y,s=this.clearParticle1.node.worldPosition.z,u=this.clearParticle2.node.worldPosition.z;this.clearParticleHolder.active=!0,this.clearParticle1.node.setWorldPosition(i,a,s),this.clearParticle2.node.setWorldPosition(r,l,u),this.clearParticle1.play(),this.clearParticle2.play(),this.scheduleOnce((function(){t.clearParticleHolder.active=!1}),this.clearParticle1.duration)}},{key:"playStarEffectAt",value:function(e){this.starParticle.fireShiningStarAt(e)}},{key:"playConfettiEffect",value:function(){var e,t,n=this;null===(e=this.node.parent)||void 0===e||e.addChild(this.leftConfetti.node),this.rightConfetti.node.parent!==this.node.parent&&(null===(t=this.node.parent)||void 0===t||t.addChild(this.rightConfetti.node));var i=Je.isLandscape(),a=i?50:30,o=i?5e3:2e3,r=i?15e3:1e4,l=i?40:60,s=i?110:100,u=i?30:20;this.leftConfetti.bursts[0].count=this.rightConfetti.bursts[0].count=a,this.leftConfetti.startSpeed.constantMin=this.rightConfetti.startSpeed.constantMin=o,this.leftConfetti.startSpeed.constantMax=this.rightConfetti.startSpeed.constantMax=r,this.leftConfetti.shapeModule.angle=l,this.rightConfetti.shapeModule.angle=s,this.leftConfetti.shapeModule.arc=this.rightConfetti.shapeModule.arc=u,this.leftConfetti.node.active=!1,this.rightConfetti.node.active=!1,this.leftConfetti.play(),this.rightConfetti.play(),this.scheduleOnce((function(){n.leftConfetti.node.active=!1}),this.leftConfetti.duration),this.scheduleOnce((function(){n.rightConfetti.node.active=!1}),this.rightConfetti.duration)}},{key:"playTornadoAnimation",value:(k=o((function*(){var e=this,t=this.tornadoSpineNode.getComponent("sp.Skeleton");if(t)return new Promise((function(n){e.tornadoSpineNode.active=!0,t.setAnimation(0,"tornado_alone",!1),t.setCompleteListener((function(){n(),e.tornadoSpineNode.active=!1}))}))})),function(){return k.apply(this,arguments)})},{key:"playThunderAnimation",value:(S=o((function*(e,t){var n=this;this.resetMasks();var i=v(e,2),a=v(i[0],2),o=a[0],r=a[1],l=v(i[1],2),s=l[0],u=l[1];this.maskTargets=[o,r,s,u],this.maskTargets.forEach((function(e,t){n.setMaskProperties(t,e.node.worldPosition,e.node.worldScale)})),yield this.setBackgroundMaskActive(!0),yield this.cloudEffect.playThunderAnimations({manager:this,board:t,pairs:e}),this.setBackgroundMaskActive(!1)})),function(e,t){return S.apply(this,arguments)})},{key:"playItemAddAnimation",value:(w=o((function*(e,t,n){var i,a=null===(i=A.getScene())||void 0===i?void 0:i.getChildByName("Canvas");if(null!=a){var o=n.itemType;if(o){switch(this.itemEffect.node.active=!0,this.itemEffect.node.setParent(a),this.itemEffect.node.setWorldPosition(e,t,this.itemEffect.node.worldPosition.z),this.itemEffect.node.setScale(V.ONE),o){case tt.HINT:this.itemEffect.sprite.spriteFrame=this.hintSpriteFrame;break;case tt.THUNDER:this.itemEffect.sprite.spriteFrame=this.thunderSpriteFrame;break;case tt.STORM:this.itemEffect.sprite.spriteFrame=this.tornadoSpriteFrame;break;case tt.PLIERS:this.itemEffect.sprite.spriteFrame=this.pliersSpriteFrame}var r=E.FULL_ANIM_USED_ON_ADD_ITEM[o];E.FULL_ANIM_USED_ON_ADD_ITEM[o]=!0,yield pT(this.itemEffect,n,r),this.itemEffect.node.active=!1}}})),function(e,t,n){return w.apply(this,arguments)})},{key:"playMultiThunderAnimation",value:(b=o((function*(e,t,n){this.resetMasks(),yield this.cloudEffect.playMultiThunderAnimation({manager:this,pairs:e,board:t,stagger:n}),yield this.setBackgroundMaskActive(!1)})),function(e,t,n){return b.apply(this,arguments)})},{key:"shakeScreen",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.vibrate=null!==(e=this.vibrate)&&void 0!==e?e:this.node.getComponent(sy),null===(t=this.vibrate)||void 0===t||t.vibrate(n)}},{key:"preloadEffects",value:function(){this.loadDefuseExplosionPool(),this.loadBombExplosionPool(),this.loadClearExplosionPool(),this.loadTornadoSpine()}},{key:"loadDefuseExplosionPool",value:(m=o((function*(){if(this.defuseExplosionPool)return this.defuseExplosionPool;var e=yield qe.loadPrefabAsync(nt.BOMB_DEFUSE_PREFAB);if(this.isValid&&this.node.activeInHierarchy){if(null!==e)return this.defuseExplosionPool=function(e,t){return new bb((function(){var n=ye(e),i=n.getComponent(ce);if(!i)throw new Error("DefuseExplosion: No animation component found in bombDefuseExplosionPrefab");return t.addChild(n),n.active=!1,{node:n,animation:i}}),1,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.node),this.defuseExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createDefuseExplosionAt")}})),function(){return m.apply(this,arguments)})},{key:"loadBombExplosionPool",value:(g=o((function*(){if(this.bombExplosionPool)return this.bombExplosionPool;var e=yield qe.loadPrefabAsync(nt.BOMB_EXPLODE_PREFAB);if(this.isValid&&this.node.activeInHierarchy){if(null!==e)return this.bombExplosionPool=function(e,t){return new bb((function(){var n=ye(e),i=n.getComponent(ce);if(!i)throw new Error("BombExplosion: No animation component found in bombExplosionPrefab");return t.addChild(n),n.active=!1,{node:n,animation:i}}),1,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.node),this.bombExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createBombExplosionAt")}})),function(){return g.apply(this,arguments)})},{key:"loadClearExplosionPool",value:(f=o((function*(){if(this.clearExplosionPool)return this.clearExplosionPool;var e=yield qe.loadPrefabAsync(nt.CLEAR_EXPLOSION_PREFAB);if(this.isValid&&this.node.activeInHierarchy){if(null!==e)return this.clearExplosionPool=function(e,t){return new bb((function(){var n=ye(e),i=n.getComponent(P),a=n.getComponent(ce);if(!i||!a)throw new Error("ClearExplosion: Invalid prefab");return t.addChild(n),n.active=!1,{node:n,uiTransform:i,animation:a}}),2,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.clearExplosionContainer),this.clearExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createClearExplosionAt")}})),function(){return f.apply(this,arguments)})},{key:"loadTornadoSpine",value:(y=o((function*(){var e=yield qe.loadPrefabAsync(nt.TORNADO_SPINE_PREFAB);if(this.isValid&&this.node.activeInHierarchy)if(null!==e){var t=ye(e);t.active=!1,this.tornadoContainer.addChild(t),this.tornadoSpineNode=t}else this.reportOrThrowInDebugger("Failed to load prefab","loadTornadoSpine")})),function(){return y.apply(this,arguments)})},{key:"createDefuseExplosionAt",value:(p=o((function*(e,t){var n=yield this.loadDefuseExplosionPool();if(n){var i=n.alloc(),a=i.node,o=i.animation;a.setWorldPosition(e,t,0),yield Ve.runAnimationAsync(o),n.free(i)}})),function(e,t){return p.apply(this,arguments)})},{key:"createBombExplosionAt",value:(h=o((function*(e){var t=yield this.loadBombExplosionPool();if(t){var n=t.alloc(),i=n.node,a=n.animation;i.setWorldPosition(e),yield Ve.runAnimationAsync(a),t.free(n)}})),function(e){return h.apply(this,arguments)})},{key:"createClearExplosionAt",value:(d=o((function*(e){var t,n=yield this.loadClearExplosionPool();if(n){var i=n.alloc(),a=i.node,o=i.animation;a.setWorldPosition(e),null===(t=a.getComponentInChildren(oT))||void 0===t||t.play(),yield Ve.runAnimationAsync(o),n.free(i)}})),function(e){return d.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(c=o((function*(e){e&&(this.backgroundMask.node.active=!0),yield this.backgroundMask.changeStateFade(e,.25),e||(this.backgroundMask.node.active=!1)})),function(e){return c.apply(this,arguments)})},{key:"resetMasks",value:function(){var e,t=u(this.masks);try{for(t.s();!(e=t.n()).done;){e.value.worldPosition=new V(-9999,-9999,0)}}catch(e){t.e(e)}finally{t.f()}}},{key:"setMaskProperties",value:function(e,t,n){var i=this.masks[e];i&&(n&&(i.worldScale=n),i.worldPosition=t)}},{key:"shakeGame",value:(s=o((function*(){var e=this;this.gameShakeSignal.abort();var t=new In;this.gameShakeSignal=t;var n=this.node.position.clone(),i=he(-10,10),a=he(-10,10),o=n.clone().add3f(i,a,0),r=n.clone().add3f(-i,-a,0),l=R(this.node).to(.05,{position:o}).to(.05,{position:r}).to(.05,{position:n}),s=function(){return e.node.setPosition(n)};t.addAbortListener(s),yield Ve.runTweenAsync(l,t),t.removeAbortListener(s)})),function(){return s.apply(this,arguments)})},{key:"reportOrThrowInDebugger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown error thrown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Board",n=new Error("".concat(t,": ").concat(e));if(JL.isDebugger())throw n;null==eI||eI.sendException(n)}}]),E}(T)).FULL_ANIM_USED_ON_ADD_ITEM=(m(WL={},tt.HINT,!1),m(WL,tt.THUNDER,!1),m(WL,tt.STORM,!1),m(WL,tt.PLIERS,!1),WL),LL=a((OL=$L).prototype,"cloudEffect",[ZO,QO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IL=a(OL.prototype,"backgroundMask",[eL,tL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RL=a(OL.prototype,"masks",[nL,iL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_L=a(OL.prototype,"tornadoContainer",[aL,oL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DL=a(OL.prototype,"clearParticleHolder",[rL,lL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ML=a(OL.prototype,"clearParticle1",[sL,uL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NL=a(OL.prototype,"clearParticle2",[cL,dL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BL=a(OL.prototype,"starParticle",[hL,pL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FL=a(OL.prototype,"leftConfetti",[yL,vL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xL=a(OL.prototype,"rightConfetti",[fL,gL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zL=a(OL.prototype,"itemEffect",[mL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UL=a(OL.prototype,"hintSpriteFrame",[bL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GL=a(OL.prototype,"thunderSpriteFrame",[wL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HL=a(OL.prototype,"tornadoSpriteFrame",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qL=a(OL.prototype,"pliersSpriteFrame",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VL=a(OL.prototype,"clearExplosionContainer",[CL,EL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(OL.prototype,"shakeScreen",[AL],Object.getOwnPropertyDescriptor(OL.prototype,"shakeScreen"),OL.prototype),a(OL.prototype,"shakeGame",[TL],Object.getOwnPropertyDescriptor(OL.prototype,"shakeGame"),OL.prototype),PL=OL))||PL);S._RF.pop(),S._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var nI="newbie",iI="timer",aI="combo",oI="hint-item",rI="thunder-item",lI="storm-item",sI="pliers-item",uI="custom-mode";S._RF.pop(),S._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var cI=function(){function n(e){var i=this;t(this,n),this.alignSkipButton=function(){var e=i.gameplay.board,t=i.manager.guideUi.guideSkipButton;if(t){var n=t.parent;if(n){var a=e.getBoundingBoxWorld(),o=a.yMax,r=a.xMax,l=We.cssSizeToWorldSize(We.getScreenHeightCss()),s=r-n.getComponent(P).width/2,u=Math.min(o+100,o+(l-o)/2);n.setWorldPosition(s,u,0)}}},this.manager=e,this.gameplay=e.gameplay}var i,a;return e(n,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(Es.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(Es.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.on(Es.GRID_RESIZE,this.handleViewResized,this),this.manager.guideUi.guideSkipButton.on(P.EventType.SIZE_CHANGED,this.alignSkipButton,this),this.showStep(this.currentStep),this.manager.node.scene.emit(Es.HIDE_UI)}},{key:"showNextStep",value:function(){this.currentStep+1<Vg.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(a=o((function*(e){var t=Vg[e];if(t){var n=this.gameplay,i=n.board,a=n.effectManager,o=t.startTile,r=t.endTile,l=i.getTileAt(o.x,o.y),s=i.getTileAt(r.x,r.y);if(l&&s){var u=l.node.worldPosition,c=s.node.worldPosition;a.resetMasks(),a.setMaskProperties(0,u,l.node.worldScale),a.setMaskProperties(1,c,s.node.worldScale),a.setBackgroundMaskActive(!0);var d=this.manager.guideUi,h=d.guideHand,p=d.guideTextBox,y=d.guideSkipButton;h.node.active=!0,y.active=!0,h.playHandAnimation(u,c),this.alignGuideTextBox(),this.alignSkipButton(),yield p.hide(),p.setLocalizedText(t.localeTextKey),yield p.show(),i.setIgnoreInput(!0),l.setIgnoreInput(!1),s.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1)}}})),function(e){return a.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=Vg[this.currentStep];if(e){var t=this.gameplay,n=t.board,i=t.effectManager,a=e.startTile,o=e.endTile,r=n.getTileAt(a.x,a.y),l=n.getTileAt(o.x,o.y);if(r&&l){var s=r.node.worldPosition,u=l.node.worldPosition;i.setMaskProperties(0,s,r.node.worldScale),i.setMaskProperties(1,u,l.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}}},{key:"alignGuideTextBox",value:function(){var e=this.gameplay.board,t=this.manager.guideUi.guideTextBox,n=e.getBoundingBoxWorld(),i=n.width,a=n.yMin,o=n.center.x,r=t.widget.bottom+(a-t.widget.bottom)/2;t.node.setWorldPosition(o,r,0);var l=Math.max(Math.min(223,.85*(a-t.widget.bottom)),10);t.uiTransform.setContentSize(i,l)}},{key:"close",value:(i=o((function*(){var e=this.gameplay,t=e.board,n=e.effectManager;this.manager.node.scene.off(Es.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(Es.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.off(Es.GRID_RESIZE,this.handleViewResized,this),this.manager.guideUi.guideSkipButton.off(P.EventType.SIZE_CHANGED,this.alignSkipButton,this),t.setIgnoreInput(!1),yield Promise.all([this.manager.guideUi.guideTextBox.hide(),n.setBackgroundMaskActive(!1)]),this.manager.guideUi.guideHand.node.active=!1,this.manager.completeGuide(nI)})),function(){return i.apply(this,arguments)})}]),n}();S._RF.pop(),S._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var dI=function(){function n(e){t(this,n),this.manager=e,this.gameplay=e.gameplay}var i,a;return e(n,[{key:"setup",value:(a=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer;yield this.gameplay.handleShowUI(),t.node.active=!0,n.node.active=!0,i.key="guide.timer",n.horizontalAlign=Me.CENTER,n.getComponent(P).setAnchorPoint(.5,.5),this.handleViewResized(),yield t.show(),this.manager.node.scene.once(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Es.PAUSE_TIME),D.on($e.VIEW_RESIZED,this.handleViewResized,this),D.on($e.ORIENTATION_CHANGED,this.handleViewResized,this)})),function(){return a.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.uiManager.currentLayout.clock,a=i.getComponent(P).contentSize,o=a.width,r=a.height,l=i.node.worldPosition,s=Je.isPortrait()?l.y-r/2-50:l.y+r/2+70;o*=1.5,r*=1.5,t.setOtherMaskTransform(l.x,l.y,o,r),n.node.setWorldPosition(l.x,s,0)}},{key:"close",value:(i=o((function*(){var e=this.manager.guideUi,t=e.guideInfoText,n=e.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(Es.RESUME_TIME),yield n.hide(),t.node.active=!1,this.manager.completeGuide(iI),this.unlistenEvents()})),function(){return i.apply(this,arguments)})},{key:"unlistenEvents",value:function(){D.off($e.VIEW_RESIZED,this.handleViewResized,this),D.off($e.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),n}();S._RF.pop(),S._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var hI=function(){function n(e){t(this,n),this.manager=e,this.gameplay=e.gameplay}var i,a;return e(n,[{key:"setup",value:(a=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer;t.node.active=!0,n.node.active=!0,i.key="guide.combo",n.horizontalAlign=Me.RIGHT,n.getComponent(P).setAnchorPoint(1,.5),this.handleViewResized(),yield t.show(),this.manager.node.scene.once(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Es.PAUSE_TIME),D.on($e.VIEW_RESIZED,this.handleViewResized,this),D.on($e.ORIENTATION_CHANGED,this.handleViewResized,this)})),function(){return a.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.uiManager.comboContainer,a=i.getComponent(P).contentSize,o=a.width,r=a.height,l=1.5*i.node.scale.x,s=i.node.worldPosition;o*=l,r*=l,t.setOtherMaskTransform(s.x,s.y,o,r),n.node.setWorldPosition(s.x-o/2-10,s.y,0)}},{key:"close",value:(i=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(Es.RESUME_TIME),t.node.off(q.EventType.TOUCH_START,this.close,this),yield t.hide(),n.node.active=!1,this.manager.completeGuide(aI),this.unlistenEvents()})),function(){return i.apply(this,arguments)})},{key:"unlistenEvents",value:function(){D.off($e.VIEW_RESIZED,this.handleViewResized,this),D.off($e.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),n}();S._RF.pop(),S._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var pI=Ludex.Utils.Array,yI=function(){function n(e){t(this,n),this.manager=e,this.gameplay=e.gameplay}var i,a;return e(n,[{key:"setup",value:(a=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer;pI.search(this.gameplay.uiManager.items,(function(e){return e.itemType===tt.HINT}))&&(t.node.active=!0,n.node.active=!0,i.key="guide.hint",n.horizontalAlign=Me.CENTER,n.getComponent(P).setAnchorPoint(.5,.5),this.handleViewResized(),yield t.show(),this.manager.node.scene.once(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.once(Es.ITEM_MASK_CLICKED,this.useItem,this),this.manager.node.scene.emit(Es.PAUSE_TIME),D.on($e.VIEW_RESIZED,this.handleViewResized,this),D.on($e.ORIENTATION_CHANGED,this.handleViewResized,this))})),function(){return a.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideItemButton,a=pI.search(this.gameplay.uiManager.items,(function(e){return e.itemType===tt.HINT}));if(a){var o=a.node.worldPosition,r=a.getComponent(P).contentSize,l=r.width,s=r.height;if(l+=40,s+=40,t.setItemMaskTransform(o.x,o.y,l,s),i.node.active=!0,i.setTransform(o.x,o.y,l,s),Je.isPortrait())n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,o.y+s/2+30,0);else if(Je.isLandscape()){var u=this.gameplay.uiManager.currentLayout.clock,c=new V(u.node.worldPosition.x,u.node.worldPosition.y-750,0);n.node.worldPosition=c}}}},{key:"close",value:(i=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideItemButton;this.manager.node.scene.emit(Es.RESUME_TIME),yield t.hide(),n.node.active=!1,i.node.active=!1,this.manager.completeGuide(oI),this.unlistenEvents()})),function(){return i.apply(this,arguments)})},{key:"useItem",value:function(){this.manager.node.scene.emit(Es.USE_ITEM,tt.HINT),this.close()}},{key:"unlistenEvents",value:function(){this.manager.node.scene.off(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.off(Es.ITEM_MASK_CLICKED,this.useItem,this),D.off($e.VIEW_RESIZED,this.handleViewResized,this),D.off($e.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),n}();S._RF.pop(),S._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var vI=Ludex.Utils.Array,fI=function(){function n(e){t(this,n),this.manager=e,this.gameplay=e.gameplay}var i,a;return e(n,[{key:"setup",value:(a=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer;vI.search(this.gameplay.uiManager.items,(function(e){return e.itemType===tt.THUNDER}))&&(t.node.active=!0,n.node.active=!0,i.key="guide.thunder",n.horizontalAlign=Me.CENTER,n.getComponent(P).setAnchorPoint(.5,.5),this.handleViewResized(),yield t.show(),this.manager.node.scene.once(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.once(Es.ITEM_MASK_CLICKED,this.useItem,this),this.manager.node.scene.emit(Es.PAUSE_TIME),D.on($e.VIEW_RESIZED,this.handleViewResized,this),D.on($e.ORIENTATION_CHANGED,this.handleViewResized,this))})),function(){return a.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideItemButton,a=vI.search(this.gameplay.uiManager.items,(function(e){return e.itemType===tt.THUNDER}));if(a){var o=a.node.worldPosition,r=a.getComponent(P).contentSize,l=r.width,s=r.height;if(l+=40,s+=40,t.setItemMaskTransform(o.x,o.y,l,s),i.node.active=!0,i.setTransform(o.x,o.y,l,s),Je.isPortrait())n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,o.y+s/2+30,0);else if(Je.isLandscape()){var u=this.gameplay.uiManager.currentLayout.clock,c=new V(u.node.worldPosition.x,u.node.worldPosition.y-750,0);n.node.worldPosition=c}}}},{key:"close",value:(i=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideItemButton;this.manager.node.scene.emit(Es.RESUME_TIME),yield t.hide(),n.node.active=!1,i.node.active=!1,this.manager.completeGuide(rI),this.unlistenEvents()})),function(){return i.apply(this,arguments)})},{key:"useItem",value:function(){this.manager.node.scene.emit(Es.USE_ITEM,tt.THUNDER),this.close()}},{key:"unlistenEvents",value:function(){this.manager.node.scene.off(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.off(Es.ITEM_MASK_CLICKED,this.useItem,this),D.off($e.VIEW_RESIZED,this.handleViewResized,this),D.off($e.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),n}();S._RF.pop(),S._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var gI=Ludex.Utils.Array,mI=function(){function n(e){t(this,n),this.manager=e,this.gameplay=e.gameplay}var i,a;return e(n,[{key:"setup",value:(a=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer;gI.search(this.gameplay.uiManager.items,(function(e){return e.itemType===tt.STORM}))&&(t.node.active=!0,n.node.active=!0,i.key="guide.storm",n.horizontalAlign=Me.CENTER,n.getComponent(P).setAnchorPoint(.5,.5),this.handleViewResized(),yield t.show(),this.manager.node.scene.once(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.once(Es.ITEM_MASK_CLICKED,this.useItem,this),this.manager.node.scene.emit(Es.PAUSE_TIME),D.on($e.VIEW_RESIZED,this.handleViewResized,this),D.on($e.ORIENTATION_CHANGED,this.handleViewResized,this))})),function(){return a.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideItemButton,a=gI.search(this.gameplay.uiManager.items,(function(e){return e.itemType===tt.STORM}));if(a){var o=a.node.worldPosition,r=a.getComponent(P).contentSize,l=r.width,s=r.height;if(l+=40,s+=40,t.setItemMaskTransform(o.x,o.y,l,s),i.node.active=!0,i.setTransform(o.x,o.y,l,s),Je.isPortrait())n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,o.y+s/2+30,0);else if(Je.isLandscape()){var u=this.gameplay.uiManager.currentLayout.clock,c=new V(u.node.worldPosition.x,u.node.worldPosition.y-750,0);n.node.worldPosition=c}}}},{key:"close",value:(i=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideItemButton;this.manager.node.scene.emit(Es.RESUME_TIME),yield t.hide(),n.node.active=!1,i.node.active=!1,this.manager.completeGuide(lI),this.unlistenEvents()})),function(){return i.apply(this,arguments)})},{key:"useItem",value:function(){this.manager.node.scene.emit(Es.USE_ITEM,tt.STORM),this.close()}},{key:"unlistenEvents",value:function(){this.manager.node.scene.off(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.off(Es.ITEM_MASK_CLICKED,this.useItem,this),D.off($e.VIEW_RESIZED,this.handleViewResized,this),D.off($e.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),n}();S._RF.pop(),S._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var bI,wI,SI,kI,CI,EI,AI,TI,PI,OI=Ludex.Utils.Array,LI=function(){function n(e){t(this,n),this.manager=e,this.gameplay=e.gameplay}var i,a;return e(n,[{key:"setup",value:(a=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer;OI.search(this.gameplay.uiManager.items,(function(e){return e.itemType===tt.PLIERS}))&&(t.node.active=!0,n.node.active=!0,i.key="guide.pliers",n.horizontalAlign=Me.CENTER,n.getComponent(P).setAnchorPoint(.5,.5),this.handleViewResized(),yield t.show(),this.manager.node.scene.once(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.once(Es.ITEM_MASK_CLICKED,this.useItem,this),this.manager.node.scene.emit(Es.PAUSE_TIME),D.on($e.VIEW_RESIZED,this.handleViewResized,this),D.on($e.ORIENTATION_CHANGED,this.handleViewResized,this))})),function(){return a.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideItemButton,a=OI.search(this.gameplay.uiManager.items,(function(e){return e.itemType===tt.PLIERS}));if(a){var o=a.node.worldPosition,r=a.getComponent(P).contentSize,l=r.width,s=r.height;if(l+=40,s+=40,t.setItemMaskTransform(o.x,o.y,l,s),i.node.active=!0,i.setTransform(o.x,o.y,l,s),Je.isPortrait())n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,o.y+s/2+30,0);else if(Je.isLandscape()){var u=this.gameplay.uiManager.currentLayout.clock,c=new V(u.node.worldPosition.x,u.node.worldPosition.y-750,0);n.node.worldPosition=c}}}},{key:"close",value:(i=o((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideItemButton;this.manager.node.scene.emit(Es.RESUME_TIME),yield t.hide(),n.node.active=!1,i.node.active=!1,this.manager.completeGuide(sI),this.unlistenEvents()})),function(){return i.apply(this,arguments)})},{key:"useItem",value:function(){this.manager.node.scene.emit(Es.USE_ITEM,tt.PLIERS),this.close()}},{key:"unlistenEvents",value:function(){this.manager.node.scene.off(Es.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.off(Es.ITEM_MASK_CLICKED,this.useItem,this),D.off($e.VIEW_RESIZED,this.handleViewResized,this),D.off($e.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),n}();S._RF.pop(),S._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var II,RI=C.ccclass,_I=C.property,DI=(bI=RI("GuideHand"),wI=_I(q),SI=_I(q),kI=_I(B),bI((AI=a((EI=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"hand",AI,l(e)),r(e,"circleHighlight",TI,l(e)),r(e,"circleHighlightOpacity",PI,l(e)),e}return e(s,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(e,t){var n=this;this.handTween&&this.handTween.stop();var i=R(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new V(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:V.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new V(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:V.ONE,angle:0});this.handTween=R(this.hand).repeatForever(i).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),R(this.circleHighlight).to(.6,{scale:new V(1.5,1.5)},{easing:"quadOut"}).start(),R(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),s}(T)).prototype,"hand",[wI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TI=a(EI.prototype,"circleHighlight",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PI=a(EI.prototype,"circleHighlightOpacity",[kI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CI=EI))||CI);S._RF.pop(),S._RF.push({},"763fe/xz6FAU5qOW2sRJ//R","GuideItemButton",void 0);var MI,NI,BI,FI,xI,zI,UI,GI=(0,C.ccclass)("GuideItemButton")(II=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"__preload",value:function(){this.uiTransform=this.node.getComponent(P)}},{key:"setTransform",value:function(e,t,n,i){this.node.setWorldPosition(e,t,0),this.uiTransform.setContentSize(n,i)}},{key:"onClick",value:function(){this.node.scene.emit(Es.ITEM_MASK_CLICKED)}}]),r}(T))||II;S._RF.pop(),S._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var HI,qI,VI,$I,WI,KI,jI,YI,XI=C.ccclass,JI=C.property,ZI=(MI=XI("GameMask"),NI=JI(P),BI=JI(F),MI((zI=a((xI=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"uiTransform",zI,l(e)),r(e,"sprite",UI,l(e)),e}return e(s,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),s}(T)).prototype,"uiTransform",[NI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI=a(xI.prototype,"sprite",[BI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FI=xI))||FI);S._RF.pop(),S._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var QI,eR,tR,nR,iR,aR,oR,rR=C.ccclass,lR=C.property,sR=C.executeInEditMode,uR=(HI=rR("AlphaMasks"),qI=sR(!0),VI=lR(ZI),$I=Ni.required(),HI(WI=qI((jI=a((KI=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"masks",jI,l(e)),r(e,"UITransform",YI,l(e)),e}return e(s,[{key:"__preload",value:function(){this.UITransform=this.node.getComponent(P)}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this)}},{key:"start",value:function(){var e;this.material=null===(e=this.getComponent(F))||void 0===e?void 0:e.getMaterialInstance(0)}},{key:"update",value:function(){var e=this;if(this.material){var t=this.UITransform,n=t.width,i=t.height;this.masks.forEach((function(t,a){var o=t.uiTransform,r=o.width,l=o.height,s=o.anchorX,u=o.anchorY,c=r*t.node.scale.x,d=l*t.node.scale.y,h=new ae(c/n,d/i),p=new ae(.5+(.5-s)*h.x,.5-(.5-u)*h.y),y=new ae(p.x+(t.node.worldPosition.x-e.node.worldPosition.x)/n,p.y-(t.node.worldPosition.y-e.node.worldPosition.y)/i);e.material.setProperty("mask".concat(a,"Texture"),t.texture),e.material.setProperty("ratio".concat(a),h),e.material.setProperty("center".concat(a),y)}))}}},{key:"setMaskActive",value:function(e,t){var n;e>=this.masks.length||null===(n=this.material)||void 0===n||n.setProperty("useMask".concat(e),t?1:0)}}]),s}(T)).prototype,"masks",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YI=a(KI.prototype,"UITransform",[$I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WI=KI))||WI)||WI);S._RF.pop(),S._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var cR,dR,hR,pR,yR,vR,fR,gR,mR,bR,wR,SR,kR,CR,ER,AR,TR,PR,OR=C.ccclass,LR=C.property,IR=(QI=OR("GuideMasks"),eR=LR(qr),tR=LR(uR),QI((aR=a((iR=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"background",aR,l(e)),r(e,"alphaMasks",oR,l(e)),e}return e(d,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"show",value:(u=o((function*(){this.background.node.active=!0,yield this.background.changeStateFade(!0,.25)})),function(){return u.apply(this,arguments)})},{key:"hide",value:(s=o((function*(){yield this.background.changeStateFade(!1,.25),this.background.node.active=!1})),function(){return s.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(Es.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[1].node.worldPosition=new V(-9999,-9999,0);var a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,n,i)}},{key:"setItemMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[0].node.worldPosition=new V(-9999,-9999,0);var a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,n,i)}},{key:"setMaskTransform",value:function(e,t,n,i,a){e.uiTransform.setContentSize(i,a),e.node.setWorldPosition(t,n,0)}}]),d}(T)).prototype,"background",[eR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oR=a(iR.prototype,"alphaMasks",[tR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nR=iR))||nR);S._RF.pop(),S._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var RR,_R,DR,MR,NR,BR,FR,xR,zR,UR,GR,HR,qR,VR,$R,WR,KR,jR,YR,XR,JR,ZR,QR,e_,t_=C.ccclass,n_=C.property,i_=(cR=t_("GuideTextBox"),dR=Ni.required(),hR=n_(K),pR=Ni.required(),yR=n_(I),vR=Ni.required(),fR=n_(P),gR=Ni.required(),mR=n_(qr),bR=Ni.required(),wR=n_(Kd),cR((CR=a((kR=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"guideText",CR,l(e)),r(e,"widget",ER,l(e)),r(e,"uiTransform",AR,l(e)),r(e,"opacityToggler",TR,l(e)),r(e,"localizer",PR,l(e)),e}return e(d,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this)}},{key:"setLocalizedText",value:function(e){this.localizer.key=e}},{key:"show",value:(u=o((function*(){yield this.opacityToggler.changeStateFade(!0)})),function(){return u.apply(this,arguments)})},{key:"hide",value:(s=o((function*(){yield this.opacityToggler.changeStateFade(!1)})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"guideText",[dR,hR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ER=a(kR.prototype,"widget",[pR,yR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AR=a(kR.prototype,"uiTransform",[vR,fR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TR=a(kR.prototype,"opacityToggler",[gR,mR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PR=a(kR.prototype,"localizer",[bR,wR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=kR))||SR);S._RF.pop(),S._RF.push({},"a2522Y5Q6JGSr90yCp/4qCm","GuideUI",void 0);var a_,o_,r_,l_,s_,u_=C.ccclass,c_=C.property,d_=(RR=u_("GuideUI"),_R=Ni.required(),DR=c_(DI),MR=Ni.required(),NR=c_(i_),BR=Ni.required(),FR=c_(K),xR=Ni.required(),zR=c_(Kd),UR=Ni.required(),GR=c_(IR),HR=Ni.required(),qR=c_(q),VR=Ni.required(),$R=c_(GI),RR((jR=a((KR=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"guideHand",jR,l(e)),r(e,"guideTextBox",YR,l(e)),r(e,"guideInfoText",XR,l(e)),r(e,"guideInfoTextLocalizer",JR,l(e)),r(e,"guideMasks",ZR,l(e)),r(e,"guideSkipButton",QR,l(e)),r(e,"guideItemButton",e_,l(e)),e}return e(s,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this)}}]),s}(T)).prototype,"guideHand",[_R,DR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YR=a(KR.prototype,"guideTextBox",[MR,NR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XR=a(KR.prototype,"guideInfoText",[BR,FR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JR=a(KR.prototype,"guideInfoTextLocalizer",[xR,zR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZR=a(KR.prototype,"guideMasks",[UR,GR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QR=a(KR.prototype,"guideSkipButton",[HR,qR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e_=a(KR.prototype,"guideItemButton",[VR,$R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WR=KR))||WR);S._RF.pop(),S._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var h_=codex,p_=h_.player,y_=h_.analytics,v_=C.ccclass,f_=C.property,g_=Ludex,m_=g_.Match.Modes,b_=g_.Plugins.Analytics,w_=(void 0===b_?{}:b_).Events,S_=g_.Utils.Array,k_=new ae(0,10),C_=new ae(0,10),E_="READY",A_="RUNNING",T_=(a_=v_("GuidelinesManager"),o_=f_(d_),a_((s_=a((l_=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"guideUi",s_,l(e)),e.guideHintDelay=null,e.guideStormDelay=null,e}return e(c,[{key:"init",value:function(e){this.gameplay=e,this.status=E_,this.node.scene.on(Es.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(Es.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(Es.USE_ITEM,this.handleUseItem,this),this.node.scene.on(Es.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(Es.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(Es.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(nI)&&this.resetGuideItemShowed(),this.startGuide(nI)):this.startGuide(iI)}},{key:"startGuide",value:function(e){if(this.status===A_)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=A_,e){case nI:w_&&y_.event(w_.TUTORIAL_BEGIN),this.guide1=new cI(this),this.guide1.setup();break;case iI:this.guide2=new dI(this),this.guide2.setup();break;case aI:this.guide3=new hI(this),this.guide3.setup();break;case oI:this.guide4=new yI(this),this.guide4.setup();break;case rI:this.guide5=new fI(this),this.guide5.setup();break;case lI:this.guide6=new mI(this),this.guide6.setup();break;case sI:this.guide7=new LI(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(e){w_&&y_.event(w_.TUTORIAL_STEP,{step:e}),this.status=E_,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){var e=this.getCurrentLevel(),t=k_.x,n=k_.y;return e>=t&&e<=n}},{key:"isShowErrorPathLevel",value:function(){if(Xy.getMatchMode()===m_.TOURNAMENT)return!1;var e=this.getCurrentLevel(),t=C_.x,n=C_.y;return e>=t&&e<=n}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(e){return S_.has(this.getGuideItemShowed(),e)}},{key:"addGuideItemShowed",value:function(e){if(!this.hasGuideItemShowed(e)){var t=this.getGuideItemShowed();t.push(e),p_.setGameData({guideItemShowed:t})}}},{key:"resetGuideItemShowed",value:function(){p_.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var e,t;return null!==(e=null===(t=p_.getGameData())||void 0===t?void 0:t.guideItemShowed)&&void 0!==e?e:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(aI),this.node.scene.off(Es.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var e=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=R(this.node).delay(5).call((function(){e.isNewbieGuideLevel()||(e.hasGuideItemShowed(oI)&&e.status===E_?e.node.scene.emit(Es.SHOW_HINT):e.startGuide(oI),e.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var e=this;null===this.guideStormDelay&&(this.guideStormDelay=new Ne(this.node).delay(10).call((function(){e.isNewbieGuideLevel()||e.hasGuideItemShowed(lI)||e.gameplay.itemManager.canUseItem(tt.STORM)&&(e.startGuide(lI)||e.startStormGuide())}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(rI)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(sI)}},{key:"handleUseItem",value:function(e){switch(this.startAutoGuides(),e){case tt.HINT:this.addGuideItemShowed(oI);break;case tt.THUNDER:this.addGuideItemShowed(rI);break;case tt.STORM:this.addGuideItemShowed(lI);break;case tt.PLIERS:this.addGuideItemShowed(sI)}}},{key:"skipNewbieGuide",value:(s=o((function*(){this.guideUi.guideSkipButton.active=!1,yield this.guide1.close();var e=this.getCurrentLevel()+1;p_.setGameData({level:e}),this.node.scene.emit(Es.NEXT_LEVEL)})),function(){return s.apply(this,arguments)})},{key:"onDestroy",value:function(){var e,t,n,i,a,o;null===(e=this.guide2)||void 0===e||e.unlistenEvents(),null===(t=this.guide3)||void 0===t||t.unlistenEvents(),null===(n=this.guide4)||void 0===n||n.unlistenEvents(),null===(i=this.guide5)||void 0===i||i.unlistenEvents(),null===(a=this.guide6)||void 0===a||a.unlistenEvents(),null===(o=this.guide7)||void 0===o||o.unlistenEvents()}}]),c}(T)).prototype,"guideUi",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r_=l_))||r_);S._RF.pop(),S._RF.push({},"aa973zMvtZFD6GO7rUb6TBF","canUseHintItem",void 0);S._RF.pop(),S._RF.push({},"f3464SQfFhIs5PVRx8JpCO1","canUsePliersItem",void 0);S._RF.pop(),S._RF.push({},"ad5b3eazZ1B3YR8JJm+qvM6","canUseThunderItem",void 0);S._RF.pop(),S._RF.push({},"3b5b1bQTVlDaaFOGKDB5VZk","canUseTornadoItem",void 0);var P_,O_;S._RF.pop(),S._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var L_,I_=C.ccclass,R_=codex.player,__=(m(P_={},tt.HINT,{canActivate:!1,quantity:0}),m(P_,tt.THUNDER,{canActivate:!1,quantity:0}),m(P_,tt.STORM,{canActivate:!1,quantity:0}),m(P_,tt.PLIERS,{canActivate:!1,quantity:0}),P_),D_=I_("ItemManager")(O_=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i))).itemConfigs=__,e}return e(r,[{key:"onLoad",value:function(){this.node.scene.on(Es.GRID_CREATE,this.updateItemsConfig,this),this.node.scene.on(Es.GRID_MATCH,this.updateItemsConfig,this),this.node.scene.on(Es.GRID_CLEAR,this.updateItemsConfig,this),this.node.scene.on(Es.GRID_SPAWN,this.updateItemsConfig,this),this.node.scene.on(Es.BOMB_EXPLODE,this.updateItemsConfig,this),this.node.scene.on(Es.REFRESH_ITEMS,this.updateItemsConfig,this)}},{key:"init",value:function(e){this.game=e}},{key:"getQuantity",value:function(e){return this.itemConfigs[e].quantity}},{key:"setQuantity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Math.max(0,t);this.itemConfigs[e].quantity=i,this.saveQuantity(e,t),this.updateItemConfig(e,n)}},{key:"saveQuantity",value:function(e,t){var n=R_.getGameData();n&&R_.setGameData({items:s(s({},n.items),{},m({},e,t))})}},{key:"canUseItem",value:function(e){var t=this.game,n=t.board,i=t.pathDraw;switch(e){case tt.HINT:return function(e,t){return e.getUncleared().length>0&&!1===t.isDrawingHint}(n,i);case tt.PLIERS:return function(e){return e.getBombTiles().length>0}(n);case tt.STORM:return function(e){return e.getUncleared().length>4}(n);case tt.THUNDER:return function(e){return e.getUncleared().length>=4}(n);default:return!1}}},{key:"updateItemsConfig",value:function(){var e=R_.getGameData();if(e&&e.items){for(var t=0,n=Object.keys(this.itemConfigs);t<n.length;t++){var i=n[t],a=this.itemConfigs[i];a.canActivate=this.canUseItem(i),a.quantity=e.items[i]||0}this.game.uiManager.currentLayout.updateStatus({items:this.itemConfigs})}}},{key:"updateItemConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=R_.getGameData();n&&(this.itemConfigs[e].canActivate=this.canUseItem(e),this.itemConfigs[e].quantity=n.items[e]||0,this.game.uiManager.currentLayout.updateStatus(s({items:s(s({},this.itemConfigs),{},m({},e,s({animate:t},this.itemConfigs[e])))},this.game.uiManager.config)))}}]),r}(T))||O_;S._RF.pop(),S._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var M_=C.ccclass,N_=Ludex.Match.Modes,B_=M_("ScoreManager")(L_=function(a){n(s,a);var r,l=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=l.call.apply(l,[this].concat(i))).currentScore=0,e}return e(s,[{key:"addScore",value:function(e,t,n){var i=this.getLevelMultiplier(e),a=this.getComboMultiplier(t),o=this.getTimeMultiplier(e,n),r=this.getCustomBonusScoreMultiplier(),l=Math.floor(this.currentScore+10*i*a*o*r),s=10*Math.ceil(l/10);this.setScore(s)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var e;Xy.getMatchMode()!==N_.TOURNAMENT?this.currentScore=0:this.currentScore=(null===(e=Xy.getMatchCustomData())||void 0===e?void 0:e.score)||0}},{key:"setScore",value:function(e){this.currentScore=e,this.updateScore()}},{key:"updateScore",value:(r=o((function*(){this.node.scene.emit(Es.SCORE_UPDATED,this.currentScore)})),function(){return r.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getComboMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getTimeMultiplier",value:function(e,t){return e<=2?4:1+.05*t}},{key:"getCustomBonusScoreMultiplier",value:function(){return Xy.getMatchMode()!==ev?1:1+pv.getCustomBonus()/100}}]),s}(T))||L_;S._RF.pop(),S._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var F_=function(){function n(e){t(this,n),this.game=null,this.data={},this.game=e.getGameplay(),this.manager=e,this.updateStateData(),this.logDebug()}return e(n,[{key:"logDebug",value:function(){var e=this.constructor.name;console.debug("[STATE] ".concat(e),this.data)}},{key:"updateStateData",value:function(){if(this.game){var e=this.game.getGameData();e&&(this.data=e)}}},{key:"updateGameData",value:function(e){var t;null===(t=this.game)||void 0===t||t.setGameData(e)}}]),n}();S._RF.pop(),S._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var x_=codex,z_=x_.analytics,U_=x_.storage,G_=Ludex.Match.Modes,H_=function(a){n(d,a);var r,l,s,u,c=i(d);function d(e,n){var i;return t(this,d),i=c.call(this,e),je.stopAllSounds(),i.vibrateDevice(),i.pauseCountdown(),i.updateMatchCustomData(),i.handleGameOver(n),i.logLevelFailAnalytics(),i}return e(d,[{key:"pauseCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var e;null===(e=re("Vibrate"))||void 0===e||null===(e=e.getComponent(sy))||void 0===e||e.vibrate(500)}},{key:"handleGameOver",value:function(e){var t=Xy.getMatchMode();t===G_.SINGLE||t===ev?this.handleSingleGameOver(e):t===G_.TOURNAMENT?this.handleTournamentGameOver():t===G_.CHALLENGE_FRIEND?this.handleChallengeGameOver():this.handleSingleGameOver(e)}},{key:"handleSingleGameOver",value:(u=o((function*(e){var t,n;if(this.game){var i=null!==(t=(yield this.openFailScreenAndWaitForClose(e)).screenData)&&void 0!==t?t:{},a=i.customMode,o=i.rescue;if(a){var r=(null!==(n=(yield rt.openScreenAndWaitForClose(lt.CUSTOM_GAME_SCREEN)).screenData)&&void 0!==n?n:{}).customMode?ev:G_.SINGLE;this.game.node.scene.emit(Es.GAME_REPLAY,r)}else o?(this.game.node.scene.emit(Es.SHOW_UI),this.game.node.scene.emit(Es.RESCUE_START)):this.game.node.scene.emit(Es.GAME_REPLAY)}})),function(e){return u.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(s=o((function*(){var e,t,n=this;if(this.game){var i=(null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{}).tournamentId;if(i){var a;if(st.validateTournamentExpired(i))return U_.setStorageData("tournament","animateTournamentLeader",!1),rt.showNotificationScreenWithLocalizedKey("error.tourEnded",2),void(null===(a=this.game)||void 0===a||a.scheduleOnce((function(){var e;null===(e=n.game)||void 0===e||e.node.scene.emit(Es.GAME_EXIT)}),2));ot.setBlockInput(!0);try{var o,r=null!==(o=U_.getStorageData("tournament","previousScore"))&&void 0!==o?o:0,l=this.game.scoreManager.getCurrentScore(),s=l>r;if(s){var u,c,d=(null!==(u=Xy.getMatchCustomData())&&void 0!==u?u:{}).tournamentId;if(!d)return;st.saveTournamentProgress(null!==(c=this.data.level)&&void 0!==c?c:1,l,d)}U_.setStorageData("tournament","animateTournamentLeader",s),yield Xy.finishMatchAsync()}catch(e){console.warn(e)}ot.setBlockInput(!1),null===(t=this.game)||void 0===t||t.node.scene.emit(Es.GAME_EXIT)}}})),function(){return s.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(l=o((function*(){if(this.game){ot.setBlockInput(!0);try{var e,t=(null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{}).challengeData;yield Xy.finishMatchAsync({extraData:{challengeData:t}})}catch(e){console.warn(e)}ot.setBlockInput(!1),this.game.node.scene.emit(Es.SHOW_CHALLENGE_RESULTS)}})),function(){return l.apply(this,arguments)})},{key:"openFailScreenAndWaitForClose",value:(r=o((function*(e){var t=this.data.level;return e===Jy&&je.playSound(Qi.LEVEL_FAIL_TIMEOUT),je.playSound(Qi.LEVEL_FAIL),rt.openScreenAndWaitForClose(lt.RESCUES_SCREEN,{level:t,failKey:e})})),function(e){return r.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var e;if(this.game){var t=this.data.level,n=void 0===t?1:t,i=null===(e=this.game)||void 0===e?void 0:e.scoreManager.getCurrentScore();Xy.updateMatchStateAfterLevelFinish(n,i)}}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore(),i=Xy.getMatchMode()||void 0;null==z_||z_.levelFail(t,n,i)}}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){}}]),d}(F_);S._RF.pop(),S._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var q_=codex,V_=q_.analytics,$_=q_.player,W_=q_.leaderboard,K_=Ludex,j_=K_.Match.Modes,Y_=K_.Utils.Time,X_=K_.Plugins.Ads,J_=(void 0===X_?{}:X_).Types,Z_=Ludex.Configs.Ads.NotifyPlayerBeforeShow,Q_=function(a){n(f,a);var r,l,s,u,c,d,h,p,y,v=i(f);function f(e){var n;return t(this,f),(n=v.call(this,e)).handleFinishStateFlow(),n}return e(f,[{key:"handleFinishStateFlow",value:(y=o((function*(){if(this.game){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),this.game.uiManager.pauseTime();var e=Xy.getMatchMode();this.updatePlayerProgress(),this.updateMatchCustomData(),e===j_.CHALLENGE_FRIEND?this.handleFinishChallenge():e===j_.TOURNAMENT?this.handleFinishTournament():this.handleFinishSingle(),this.logLevelCompleteAnalytics()}})),function(){return y.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"attemptCallCreateShortcut",value:function(){var e=this.data.level;(void 0===e?0:e)<2||J_&&ut.isReadyAdShowable(J_.INTERSTITIAL)||GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("createShortcutAsync",e)}))}},{key:"updatePlayerProgress",value:function(){var e=this.data.level,t=$_.getGameData();if(this.game&&e&&t){var n=Xy.getMatchMode(),i=t.level,a=e+1,o=Math.max(i,a);if(n===j_.SINGLE||n===ev)$_.setGameData({level:o});else if(n===j_.TOURNAMENT){var r,l=(null!==(r=Xy.getMatchCustomData())&&void 0!==r?r:{}).tournamentId;if(!l)return;var s=this.game.scoreManager.getCurrentScore();st.saveTournamentProgress(e,s,l)}}}},{key:"updateMatchCustomData",value:function(){if(this.game){var e=this.data.level,t=void 0===e?1:e,n=this.game.scoreManager.getCurrentScore();Xy.updateMatchStateAfterLevelFinish(t,n)}}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore(),i=Xy.getMatchMode()||void 0;null==V_||V_.levelComplete(t,n,i)}}},{key:"handleFinishChallenge",value:(p=o((function*(){if(this.game)try{var e;rt.showLoadingScreen();var t=(null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{}).challengeData;yield Xy.finishMatchAsync({extraData:{challengeData:t}}),this.game.node.scene.emit(Es.SHOW_CHALLENGE_RESULTS)}catch(e){console.warn("finish challenge error",e)}finally{rt.closeLoadingScreen()}})),function(){return p.apply(this,arguments)})},{key:"handleFinishTournament",value:(h=o((function*(){if(this.handlePostTournamentScore(),this.game){var e=this.data.level,t=void 0===e?1:e;je.playSound(Qi.LEVEL_COMPLETE,{volume:.5}),this.game.effectManager.playConfettiEffect(),yield Y_.sleepAsync(500),yield ut.showInterstitialAdAsync({forLevel:t}),this.game.node.scene.emit(Es.NEXT_LEVEL)}})),function(){return h.apply(this,arguments)})},{key:"handlePostTournamentScore",value:(d=o((function*(){var e;if(this.game){var t=null===(e=this.game)||void 0===e?void 0:e.scoreManager.getCurrentScore();if(t){try{yield GameSDK.tournament.postScoreAsync(t)}catch(e){console.warn("GameSDK post score async",e)}var n=Xy.getMatchCustomData();if(n){var i=n.leaderboardId,a=n.playerId;i&&a&&(yield W_.setLeaderboardScoreAsync(i,a,t))}}}})),function(){return d.apply(this,arguments)})},{key:"handleFinishSingle",value:(c=o((function*(){je.turnUpMusic();var e=this.data.level,t=void 0===e?0:e,n=t>0&&t%5==0;12===t?yield this.handleUnlockCustomMode():(n?yield this.handleFinishHardLevel():yield this.handleFinishNormalLevel(),this.handleNextLevelSingle())})),function(){return c.apply(this,arguments)})},{key:"handleFinishNormalLevel",value:(u=o((function*(){var e,t;if(this.game){var n=this.data.level,i=void 0===n?0:n,a=(null!==(e=$_.getGameData())&&void 0!==e?e:{}).coins,o=void 0===a?0:a,r=(null!==(t=Xy.getMatchCustomData())&&void 0!==t?t:{}).score,l=void 0===r?0:r;Z_&&(yield this.game.uiManager.interstitialAdIndicator.flash());var s=GameSDK.isGameSDK("Yandex");s||(yield this.showAdsNormalLevel(.8)),je.playSound(Qi.LEVEL_COMPLETE,{volume:.5}),yield rt.openScreenAndWaitForClose(lt.LEVEL_COMPLETE_SCREEN,{level:i,coins:o,score:l,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1}),s&&(yield this.showAdsNormalLevel())}})),function(){return u.apply(this,arguments)})},{key:"showAdsNormalLevel",value:(s=o((function*(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.game){var n=this.data.level,i=void 0===n?0:n,a=null!==(e=$_.getGameData())&&void 0!==e?e:{},o=a.custom;Xy.getMatchMode()===ev&&null!=o&&o.ads?(this.game.node.scene.emit(Es.HIDE_UI),yield Ve.waitTweenAsync(t),yield ut.showRewardedInterstitialAdAsync({showError:!1})):J_&&ut.isReadyAdShowable(J_.INTERSTITIAL)&&(this.game.node.scene.emit(Es.HIDE_UI),yield Ve.waitTweenAsync(t),yield ut.showInterstitialAdAsync({forLevel:i}))}})),function(){return s.apply(this,arguments)})},{key:"handleFinishHardLevel",value:(l=o((function*(){var e,t,n,i,a=this.data.level,o=void 0===a?0:a,r=null!==(e=null===(t=$_.getGameData())||void 0===t?void 0:t.coins)&&void 0!==e?e:0,l=null!==(n=null===(i=Xy.getMatchCustomData())||void 0===i?void 0:i.score)&&void 0!==n?n:0;je.playSound(Qi.LEVEL_COMPLETE,{volume:.5});var s=(yield rt.openScreenAndWaitForClose(lt.LEVEL_COMPLETE_SCREEN,{level:o,coins:r,score:l,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!0})).screenData,u=(null!=s?s:{}).canShowRewardsAd;if(void 0!==u&&u){var c=(yield rt.openScreenAndWaitForClose(lt.GET_REWARDS_SCREEN)).screenData,d=null!=c?c:{},h=d.getRewardsSuccess,p=void 0!==h&&h,y=d.rewardsAdShown,v=void 0!==y&&y;p&&this.getRewardItems(),yield rt.openScreenAndWaitForClose(lt.LEVEL_COMPLETE_SCREEN,{level:o,coins:r,score:l,getRewardsSuccess:p,lookingForRewards:!1}),p||v||(yield ut.showInterstitialAdAsync({forLevel:o}))}else yield ut.showInterstitialAdAsync({forLevel:o})})),function(){return l.apply(this,arguments)})},{key:"handleUnlockCustomMode",value:(r=o((function*(){var e,t;if(this.game){var n=this.data.level,i=void 0===n?0:n,a=(null!==(e=$_.getGameData())&&void 0!==e?e:{}).coins,o=void 0===a?0:a,r=(null!==(t=Xy.getMatchCustomData())&&void 0!==t?t:{}).score,l=void 0===r?0:r;je.playSound(Qi.LEVEL_COMPLETE,{volume:.5}),yield rt.openScreenAndWaitForClose(lt.LEVEL_COMPLETE_SCREEN,{level:i,coins:o,score:l,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1}),ct.switchToDashboardScene()}})),function(){return r.apply(this,arguments)})},{key:"handleNextLevelSingle",value:function(){var e=this.data.level,t=$_.getGameData();this.game&&e&&t&&this.game.node.scene.emit(Es.NEXT_LEVEL)}},{key:"getRewardItems",value:function(){this.game&&(this.game.node.scene.emit(Es.ADD_ITEM,{item:tt.STORM,quantity:1}),this.game.node.scene.emit(Es.ADD_ITEM,{item:tt.THUNDER,quantity:1}))}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),f}(F_);S._RF.pop(),S._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var eD=codex,tD=eD.player,nD=eD.match,iD=Ludex.Match.Modes,aD=function(a){n(y,a);var r,l,u,c,d,h,p=i(y);function y(e){var n;return t(this,y),(n=p.call(this,e)).clearBoard(),n.initAdPreload(),n.initCountdown(),n.initScore(),n.loadLevelAndUI(),n}return e(y,[{key:"loadLevelAndUI",value:function(){var e=this;this.setAdVisibility(),this.loadLevel().then((function(){e.updateUI()}))}},{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.board.clearAnimationQueue(),this.game.pathDraw.clearMatchPath())}},{key:"setAdVisibility",value:function(){var e=this.data.level,t=void 0!==e&&e>dt.NUM_LEVEL_WITHOUT_BANNER_ADS;ut.setAvoidBannerShowed(!t),ut.updateBannerAdsByLayout(Je.getCurrentLayout()),ut.refreshBannerAdVisibility()}},{key:"loadLevel",value:(h=o((function*(){if(this.game){var e=Xy.getMatchMode();try{if(e===iD.CHALLENGE_FRIEND){var t=yield this.loadChallengeFriendMode();return je.playSound(Qi.LEVEL_START),void this.handleChallengeFriendModeStart(t)}if(e===iD.TOURNAMENT)return yield this.loadSingleMode(),je.playSound(Qi.LEVEL_START),void this.handleTournamentModeStart()}catch(e){console.error("Error loading level:",e)}yield this.loadSingleMode(),je.playSound(Qi.LEVEL_START),this.handleSingleModeStart()}})),function(){return h.apply(this,arguments)})},{key:"loadChallengeFriendMode",value:(d=o((function*(){if(!this.game)throw new Error("Game is not initialized");yield Xy.getMatchCustomDataAsync();var e=nD.getMatchState().customData.challengeData;if(null==e)throw new Error("Challenge friend mode need to have data.");var t=this.game.levelManager;return yield t.loadLevel(e.level),this.updateGameData({level:e.level,levelData:t.getLevelData()}),e})),function(){return d.apply(this,arguments)})},{key:"loadSingleMode",value:(c=o((function*(){if(null===this.game)throw new Error("Game is not initialized");var e=this.game.levelManager;yield e.loadLevel(this.data.level),this.updateGameData({levelData:e.getLevelData()})})),function(){return c.apply(this,arguments)})},{key:"handleChallengeFriendModeStart",value:(u=o((function*(e){if(this.game){var t=this.game.levelManager.getLevelData(),n=e.level,i=e.fen,a=e.gravity,o=e.rules,r=e.time,l=tD.getPlayerId();yield Promise.all([Xy.setMatchCustomDataAsync({level:n,score:0}),Xy.setProfileMatchDataAsync({id:l,score:0})]);var u=Fy.loadLevelSpriteFrames(e.level);yield this.game.board.create(u,s(s({},t),{},{level:n,customFen:i,mode:a,rules:o,time:r})),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),this.game.board.setIgnoreInput(!1),yield u,this.ready()}})),function(e){return u.apply(this,arguments)})},{key:"handleSingleModeStart",value:(l=o((function*(){var e,t;if(this.game){var n=this.game.levelManager.getLevelData(),i=null!==(e=this.data.level)&&void 0!==e?e:1,a=tD.getPlayerId();yield Promise.all([Xy.setMatchCustomDataAsync({level:i,score:0}),Xy.setProfileMatchDataAsync({id:a,score:0})]);var o=Fy.loadLevelSpriteFrames(i);yield this.game.board.create(o,n),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),null!==(t=this.game.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),i&&i>0&&i%5==0&&(Je.isLandscape()&&this.game.handleShowUI(),yield rt.openScreen(lt.HARD_LEVEL_SCREEN),yield Ve.waitTweenAsync(1.3),rt.closeScreen(lt.HARD_LEVEL_SCREEN),ot.setBlockInput(!0),yield this.game.board.animateTilesWave(),ot.setBlockInput(!1)),this.ready()}})),function(){return l.apply(this,arguments)})},{key:"handleTournamentModeStart",value:(r=o((function*(){var e,t;if(this.game){var n=this.game.levelManager.getLevelData(),i=null!==(e=this.data.level)&&void 0!==e?e:1,a=tD.getPlayerId();yield Promise.all([Xy.setMatchCustomDataAsync({level:i}),Xy.setProfileMatchDataAsync({id:a})]);var o=Fy.loadLevelSpriteFrames(i,this.data.themeId);yield this.game.board.create(o,n),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),null!==(t=this.game.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),yield o,this.ready()}})),function(){return r.apply(this,arguments)})},{key:"initAdPreload",value:function(){this.game&&(this.game.isAdPreloadedForCurrentLevel=!1)}},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.clockManager.init()}},{key:"updateUI",value:function(){if(this.game){var e=this.game.getGameData();if(e){var t=e.level,n=void 0===t?0:t,i=e.levelData;this.game.uiManager.setLevelText(n),i&&this.game.clockManager.setTime(i.time)}}}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),y}(F_);S._RF.pop(),S._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var oD=Ludex.Plugins.Ads,rD=(void 0===oD?{}:oD).Types,lD=function(a){n(r,a);var o=i(r);function r(e){var n;return t(this,r),(n=o.call(this,e)).startCountdown(),n.preloadNextLevelSkins(),rD&&ut.preloadAdsByType(rD.INTERSTITIAL),n}return e(r,[{key:"preloadNextLevelSkins",value:function(){var e,t=null!==(e=this.data.level)&&void 0!==e?e:1;Fy.preloadLevelSpriteFrames(t+1)}},{key:"startCountdown",value:function(){var e;this.game&&(null!==(e=this.game.guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||(this.game.clockManager.startCountdown(),this.game.uiManager.startCountdown()))}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(e){var t=this.manager.createFailState(this.manager,e);this.manager.change(t)}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){this.updateStateData()}}]),r}(F_);S._RF.pop(),S._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var sD,uD=codex.analytics,cD=Ludex.Utils.Valid,dD=[Qi.COMBO_1,Qi.COMBO_2,Qi.COMBO_3,Qi.COMBO_4,Qi.COMBO_5,Qi.COMBO_6,Qi.COMBO_7,Qi.COMBO_8,Qi.COMBO_9,Qi.COMBO_10,Qi.COMBO_11,Qi.COMBO_12,Qi.COMBO_13,Qi.TILE_MATCH,Qi.BOMB_DEFUSE,Qi.BOMB_EXPLODE_1,Qi.BOMB_EXPLODE_2,Qi.TILE_SELECT,Qi.THUNDERBOLT,Qi.SHUFFLE_ITEM,Qi.LEVEL_START,Qi.LEVEL_COMPLETE,Qi.LEVEL_FAIL],hD=function(a){n(r,a);var o=i(r);function r(e){var n;return t(this,r),n=o.call(this,e),je.stopAllSounds(),je.turnDownMusic(),n.preloadAssets(),n.handleGuideFlow(),n.setGridPlayable(),n.logLevelStartAnalytics(),n}return e(r,[{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(e){if(cD.isDebugger()){var t=this.manager.createFailState(this.manager);this.manager.change(t)}}},{key:"finish",value:function(){if(cD.isDebugger()){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}}},{key:"update",value:function(){}},{key:"preloadAssets",value:function(){var e;this.preloadSounds(),null===(e=this.game)||void 0===e||e.effectManager.preloadEffects()}},{key:"preloadSounds",value:function(){for(var e=0,t=dD;e<t.length;e++){var n=t[e];qe.loadAudioAsync(n)}}},{key:"setGridPlayable",value:function(){var e;null!==(e=this.manager.getGameplay().guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var e,t;this.game&&(null!==(e=this.game.guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.game.handleShowUI(),null===(t=this.game.guidelinesManager)||void 0===t||t.show())}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=(Xy.getMatchCustomData()||{}).score,i=void 0===n?0:n,a=Xy.getMatchMode()||void 0;null==uD||uD.levelStart(t,i,a)}}}]),r}(F_);S._RF.pop(),S._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var pD=(0,C.ccclass)("StateManager")(sD=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(e){this.gameplay=e,this.state=new aD(this)}},{key:"change",value:function(e){this.state=e}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return this.state instanceof aD}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return this.state instanceof hD}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return this.state instanceof lD}},{key:"fail",value:function(e){this.state.fail(e)}},{key:"isFail",value:function(){return this.state instanceof H_}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return this.state instanceof Q_}},{key:"update",value:function(e){this.state&&this.state.update(e)}},{key:"createInitializeState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return w(aD,t)}},{key:"createReadyState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return w(hD,t)}},{key:"createPlayingState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return w(lD,t)}},{key:"createFailState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return w(H_,t)}},{key:"createFinishState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return w(Q_,t)}}]),r}(T))||sD;S._RF.pop(),S._RF.push({},"e80e4nIcfdLN56j5b9SMhvH","LeaderboardUtils",void 0);var yD,vD=codex.leaderboard,fD=function(){function n(){t(this,n)}var i,a,r;return e(n,null,[{key:"inst",get:function(){return this.inst$||(this.inst$=new n),this.inst$}},{key:"getAllLeaderboardAsync",value:(r=o((function*(e){if(!vD)return null;var t=vD.getLeaderboardName(e);if(!t)return null;var n=yield vD.getLeaderboardResponseAsync(e);return n?(yield this.requestLeaderboardAsync(t,n.amountPlayer),vD.getLeaderboard(t)):null})),function(e){return r.apply(this,arguments)})},{key:"requestLeaderboardAsync",value:(a=o((function*(e,t){this.isLeaderboardRequesting(e)?yield this.waitForLeaderboardFinishAsync(e):yield vD.requestLeaderboardAsync(e,t)})),function(e,t){return a.apply(this,arguments)})},{key:"waitForLeaderboardFinishAsync",value:(i=o((function*(e){var t=this;if(this.isLeaderboardRequesting(e))return new Promise((function(n){var i=setInterval((function(){t.isLeaderboardRequesting(e)||(clearInterval(i),n())}),100)}))})),function(e){return i.apply(this,arguments)})},{key:"isLeaderboardRequesting",value:function(e){var t;return(null===(t=vD.getLeaderboard(e))||void 0===t?void 0:t.isRequesting)||!1}}]),n}();try{new fD}catch(e){console.error("LeaderboardUtils",e)}S._RF.pop(),S._RF.push({},"a95ba1U+uJB66zZU7UYL4e5","TournamentManager",void 0);var gD,mD,bD,wD,SD,kD,CD,ED,AD,TD=C.ccclass,PD=Ludex.Utils.Object,OD=codex,LD=OD.player,ID=OD.leaderboard,RD=TD("TournamentManager")(yD=function(a){n(d,a);var r,l,s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=c.call.apply(c,[this].concat(i))).leaderData=[],e.tournamentData=null,e.leaderboardData=null,e.leaderboardName=null,e}return e(d,[{key:"init",value:(u=o((function*(){yield this.requestTournamentData(),yield this.requestLeaderData()})),function(){return u.apply(this,arguments)})},{key:"requestTournamentData",value:(s=o((function*(){var e,t,n=(null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{}).tournamentId;n&&(yield st.requestTournamentDataAsync(),this.tournamentData=null!==(t=st.getTournamentDataById(n))&&void 0!==t?t:null)})),function(){return s.apply(this,arguments)})},{key:"requestLeaderData",value:(l=o((function*(){var e,t=this,n=(null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{}).leaderboardId;if(n&&(yield this.requestLeaderboardData(n),this.leaderboardData)){var i=LD.getPlayerId();this.leaderData=PD.vals(this.leaderboardData.leaders).reduce((function(e,t){if(t.playerId!==i&&t.score>0){var n={score:t.score,rank:t.rank};e.push(n)}return e}),[]).sort((function(e,t){return e.score-t.score})),this.leaderData.forEach((function(e,n){e.rank=t.leaderData.length-n}))}})),function(){return l.apply(this,arguments)})},{key:"requestLeaderboardData",value:(r=o((function*(e){this.leaderboardName=ID.getLeaderboardName(e),this.leaderboardData=yield fD.getAllLeaderboardAsync(e)})),function(e){return r.apply(this,arguments)})}]),d}(T))||yD;S._RF.pop(),S._RF.push({},"2b89dXjcudIaZRJFuh5TAAI","InterstitialAdIndicator",void 0);var _D=C.ccclass,DD=C.property,MD=["ads.interNotice.backInSec","ads.interNotice.hangTight","ads.interNotice.quickAd"];var ND,BD=Ludex.Configs.Ads.NotifyPlayerBeforeShow,FD=(gD=_D("InterstitialAdIndicator"),mD=Ni.required(),bD=DD(B),wD=Ni.required(),SD=DD(Kd),gD((ED=a((CD=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"uiOpacity",ED,l(e)),r(e,"labelLocalizer",AD,l(e)),e}return e(c,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this)}},{key:"flash",value:(s=o((function*(){var e,t,n=(t=Math.floor(Math.random()*MD.length),MD[t]);if(!1!==BD&&n){null===(e=this.signal)||void 0===e||e.abort();var i=new In;this.signal=i,this.labelLocalizer.key=n;var a=R(this.uiOpacity).to(.25,{opacity:255},{easing:"linear"}).delay(.25).to(.25,{opacity:100},{easing:"linear"}).delay(.125);yield Ve.runTweenAsync(R(this.uiOpacity).repeat(2,a).to(.25,{opacity:0},{easing:"linear"}),i),this.uiOpacity.opacity=0}})),function(){return s.apply(this,arguments)})}]),c}(T)).prototype,"uiOpacity",[mD,bD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AD=a(CD.prototype,"labelLocalizer",[wD,SD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kD=CD))||kD);S._RF.pop(),S._RF.push({},"dfab8xSeglD/abIKphEhi4g","ComboContainer",void 0);var xD,zD=C.ccclass,UD=Ludex.Match.Modes,GD=zD("ComboContainer")(ND=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"__preload",value:function(){this.widget=this.node.getComponent(I),this.node.scene.on(Es.GRID_RESIZE,this.handleViewResized,this)}},{key:"init",value:function(e){this.board=e}},{key:"updateWidget",value:function(){if(Je.isPortrait())return this.node.scale=new V(1,1,1),this.widget.right=22.5,void(this.widget.top=Xy.getMatchMode()===UD.TOURNAMENT?180:160);if(this.board){this.node.scale=new V(1.5,1.5,1.5);var e=this.board.getBoundingBoxWorld().yMax,t=We.cssSizeToWorldSize(We.getScreenHeightCss());this.widget.right=142.5,this.widget.top=(t-e)/2}}},{key:"updateStatus",value:function(){this.updateWidget()}},{key:"handleViewResized",value:function(){this.updateWidget()}}]),r}(T))||ND;S._RF.pop(),S._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var HD,qD,VD,$D,WD,KD,jD,YD,XD,JD,ZD,QD,eM,tM,nM,iM,aM,oM,rM,lM,sM,uM,cM,dM,hM,pM,yM=C.ccclass,vM=yM("ComboProgressBar")(xD=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"start",value:function(){this.progressBar=this.getComponent(kc),this.opacity=this.getComponent(B),this.comboTimer=0,this.isActive=!1,this.node.scene.on(Es.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/2):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(Es.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=2),e>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),r}(T))||xD;S._RF.pop(),S._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var fM,gM,mM,bM,wM,SM,kM,CM=C.ccclass,EM=C.property,AM=(m(HD={},tt.HINT,"item.hintDesc"),m(HD,tt.PLIERS,"item.pliersDesc"),m(HD,tt.STORM,"item.stormDesc"),m(HD,tt.THUNDER,"item.thunderDesc"),HD),TM=(qD=CM("SpecialItem"),VD=EM({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),$D=Ni.required,WD=EM({type:G,tooltip:"The button that activates the item"}),KD=EM({type:O,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),jD=Ni.required,YD=EM({type:K,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),XD=Ni.required,JD=EM({type:q,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),ZD=Ni.required,QD=EM({type:q,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),eM=Ni.required,tM=EM({type:B,group:"Animation"}),nM=Ni.required,iM=EM({type:B,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),qD((rM=a((oM=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"isDevButton",rM,l(e)),r(e,"button",lM,l(e)),r(e,"quantity",sM,l(e)),r(e,"quantityLabel",uM,l(e)),r(e,"quantityNode",cM,l(e)),r(e,"plusNode",dM,l(e)),r(e,"glowUIOpacity",hM,l(e)),r(e,"uiOpacity",pM,l(e)),e.vibrateComp=null,e}return e(d,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this,d)}},{key:"updateStatus",value:function(e){var t;if(void 0!==this.itemType){var n=null===(t=e.items)||void 0===t?void 0:t[this.itemType];n&&(this.setActiveStatus(n.canActivate),this.setQuantity(n.quantity,n.animate))}}},{key:"setActiveStatus",value:function(e){var t;null===(t=this.signal)||void 0===t||t.abort();var n=new In;this.signal=n,this.button.interactable=e,Ve.runTweenAsync(R(this.uiOpacity).to(.2,{opacity:e?255:128}),n)}},{key:"activate",value:(u=o((function*(){this.quantity<=0?this.requestItem():(this.vibrate(),this.node.scene.emit(Es.USE_ITEM,this.itemType))})),function(){return u.apply(this,arguments)})},{key:"setQuantity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,void(this.plusNode.active=!1);n=Math.max(0,n),this.quantity=n,this.quantityLabel.string="".concat(this.quantity),n<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem()}},{key:"requestItem",value:function(){void 0!==this.itemType?rt.openScreen(lt.GET_ITEM_SCREEN,{item:this.itemType,localizedMessageKey:AM[this.itemType],quantity:1}):console.warn("Item type is not defined")}},{key:"vibrate",value:function(){var e,t;this.vibrateComp=null!==(e=this.vibrateComp)&&void 0!==e?e:this.node.getComponent(sy),null===(t=this.vibrateComp)||void 0===t||t.vibrate(50)}},{key:"animateAddItem",value:(s=o((function*(){return this.glowUIOpacity.opacity=0,Promise.all([Ve.runTweenAsync(R(this.node).to(.1,{scale:new V(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:V.ONE},{easing:"elasticOut"})),Ve.runTweenAsync(R(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))])})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"isDevButton",[VD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lM=a(oM.prototype,"button",[$D,WD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sM=a(oM.prototype,"quantity",[KD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uM=a(oM.prototype,"quantityLabel",[jD,YD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cM=a(oM.prototype,"quantityNode",[XD,JD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dM=a(oM.prototype,"plusNode",[ZD,QD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hM=a(oM.prototype,"glowUIOpacity",[eM,tM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pM=a(oM.prototype,"uiOpacity",[nM,iM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aM=oM))||aM);S._RF.pop(),S._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var PM=C.ccclass,OM=C.disallowMultiple,LM=C.property,IM=(fM=PM("Clock"),gM=LM(q),mM=LM(K),fM(bM=OM((SM=a((wM=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"clockIcon",SM,l(e)),r(e,"timeLabel",kM,l(e)),e}return e(d,[{key:"__preload",value:function(){this.node.scene.on(Es.TIME_UPDATED,this.updateTimeLabel,this),this.node.scene.on(Es.RESCUE_START,this.handleRescueStart,this),this.node.scene.on(Es.RESCUE_FINISHED,this.handleRescueFinished,this)}},{key:"updateStatus",value:function(e){void 0!==e.time&&this.updateTimeLabel(e.time)}},{key:"updateTimeLabel",value:function(e){var t=this.convertSecondsToMmSs(e);this.timeLabel.string=t}},{key:"convertSecondsToMmSs",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60),i=this.padZero(t),a=this.padZero(n);return"".concat(i,":").concat(a)}},{key:"padZero",value:function(e){return e<10?"0".concat(e):"".concat(e)}},{key:"handleRescueStart",value:(u=o((function*(){var e=R(this.node).to(.5,{scale:new V(1.1,1.1,1)}),t=R(this.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),n=R(this.clockIcon).repeat(5,t);Ve.runTweenAsync(n),Ve.runTweenAsync(e)})),function(){return u.apply(this,arguments)})},{key:"handleRescueFinished",value:(s=o((function*(){var e=R(this.node).to(.5,{scale:new V(1,1,1)});Ve.runTweenAsync(e)})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"clockIcon",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kM=a(wM.prototype,"timeLabel",[mM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bM=wM))||bM)||bM);S._RF.pop(),S._RF.push({},"9ecd9Kte0VJN4rRVFlb6CzI","OverlayUtils",void 0);var RM=codex,_M=RM.player,DM=RM.analytics,MM=Ludex.Plugins.Analytics,NM=(void 0===MM?{}:MM).Events,BM=function(){function n(){t(this,n)}var i,a,r;return e(n,null,[{key:"inst",get:function(){return this.inst$||(this.inst$=new n),this.inst$}},{key:"shareBestScoreWithOverlay",value:(r=o((function*(){try{var e=(_M.getPlayer().data||{}).score;this.isOverlayViewAPIAvailable(GameSDK),yield GameSDK.extra.shareAsync({text:"Great! I have a best score!",intent:"SHARE",imageOverlayPath:"wideframes/share-async.xml",pathToCSS:"wideframes/share-async-styles.css",initialData:{score:null!=e?e:0},shareDestination:["NEWSFEED","GROUP","COPY_LINK","MESSENGER"],switchContext:!1}),NM&&DM.event(NM.SHARE,{share_content_type:"BestScore",success:!0})}catch(e){NM&&DM.event(NM.SHARE,{share_content_type:"BestScore",success:!1}),console.error("Overlay sharing failed:",e)}})),function(){return r.apply(this,arguments)})},{key:"inviteFriendsWithOverlay",value:(a=o((function*(){try{var e=(_M.getPlayer().data||{}).score;this.isOverlayViewAPIAvailable(GameSDK),yield GameSDK.extra.inviteAsync({initialData:{score:null!=e?e:0},text:{default:"Great! I have a best score!",localizations:{vi_VN:"Tht tuyt! Mnh va ph k lc ny!"}},imageOverlayPath:"wideframes/invite-async.xml",pathToCSS:"wideframes/invite-async-styles.css"}),NM&&DM.event(NM.INVITE,{invite_content_type:"BestScore",success:!0})}catch(e){NM&&DM.event(NM.INVITE,{invite_content_type:"BestScore",success:!1}),console.error("Overlay inviting failed:",e)}})),function(){return a.apply(this,arguments)})},{key:"isOverlayViewAPIAvailable",value:function(e){if(!e.isGameSDK("FacebookInstant"))throw new Error("GameSDK is not FacebookInstant");if(!e.extra.isNEZP()||e.extra.isRestricted())throw new Error("GameSDK is not NEZP or Restricted");if(!("overlayViews"in e))throw new Error("GameSDK does not have overlayViews")}},{key:"createOverlayViewAsync",value:(i=o((function*(e,t,n,i,a){return this.isOverlayViewAPIAvailable(GameSDK),yield GameSDK.overlayViews.createOverlayViewAsync(e,t,n,i,a)})),function(e,t,n,a,o){return i.apply(this,arguments)})},{key:"getGameScaleFactor",value:function(){var e=Ke.DesignSize,t=e.Portrait,n=e.Landscape,i=We.getScreenWidthCss(),a=We.getScreenHeightCss(),o=Je.isLandscape(),r=i/(o?n.WIDTH:t.WIDTH),l=a/(o?n.HEIGHT:t.HEIGHT);switch(this.getViewResolutionPolicy().getContentStrategy()){case Be.ContentStrategy.FIXED_WIDTH:return r;case Be.ContentStrategy.FIXED_HEIGHT:return l;default:return Math.max(r,l)}}},{key:"getViewResolutionPolicy",value:function(){return Fe.getResolutionPolicy()}}]),n}();S._RF.pop(),S._RF.push({},"782f7aiDpVF869fWzGqeFHO","PlayerAvatarOverlay",void 0);var FM=Ludex.Utils,xM=FM.Time,zM=FM.Object,UM=function(){function n(e){var i=this;t(this,n),this.createMainDiv$=function(){i.mainDiv$=document.createElement("div"),zM.assign(i.mainDiv$.style,{position:"absolute",transform:"translate(-50%, -50%)",scrollbarWidth:"none",alignItems:"center",overflow:"hidden",backgroundColor:"transparent",opacity:"0",transition:"opacity 0.3s ease-in-out",pointerEvents:"none",display:"none"}),i.updateContainerWidth$(55),document.body.appendChild(i.mainDiv$)},this.isPlayerIdValid$=function(e){return/^\d+$/.test(e)},this.showOverlay$=o((function*(){i.overlayView&&(zM.assign(i.mainDiv$.style,{opacity:"0",display:"none",pointerEvents:"none"}),yield i.overlayView.showAsync(),yield i.fadeIn())})),this.updateContainerWidth$=function(e){var t=Je.isLandscape()?2.4:1.2,n="".concat(e*t*BM.getGameScaleFactor(),"px");zM.assign(i.mainDiv$.style,{width:n,height:n})},this.getIframeCss$=function(){return"".concat("width: 100%;"," ").concat("height: 100%;"," ").concat("overflow: hidden;"," ").concat("background-color: transparent;"," ").concat("border-width: 0px;"," ").concat("align-items: center;")},this.scene=e,this.createMainDiv$()}var i,a,r,l;return e(n,[{key:"moveOverlayTo",value:function(e,t){var n=BM.getGameScaleFactor();Object.assign(this.mainDiv$.style,{top:"calc(100vh - ".concat(t*n,"px)"),left:"calc(".concat(e*n,"px)")})}},{key:"updateOverlay",value:(l=o((function*(e){try{var t=e.playerId,n=e.worldX,i=e.worldY,a=e.avatarWidth,o=void 0===a?55:a,r=e.customCss,l=void 0===r?"overlays/avatar/avatar-overlay-styles.css":r;if(!this.isPlayerIdValid$(t))return!1;if(this.updateContainerWidth$(o),this.moveOverlayTo(n,i),this.currentPlayerId===t)return yield this.showOverlay$(),!0;this.overlayView=yield BM.createOverlayViewAsync("overlays/avatar/avatar-overlay.xml",this.mainDiv$,this.getIframeCss$(),l,{playerId:t}),this.currentPlayerId=t,yield this.showOverlay$()}catch(e){return console.error("Error creating overlay view:",e),!1}return!0})),function(e){return l.apply(this,arguments)})},{key:"hideOverlay",value:(r=o((function*(){if(this.overlayView){zM.assign(this.mainDiv$.style,{opacity:"0",pointerEvents:"none"});try{yield xM.sleepAsync(300),this.mainDiv$.style.display="none",yield this.overlayView.dismissAsync()}catch(e){console.error("Hide overlay failed:",e)}}})),function(){return r.apply(this,arguments)})},{key:"fadeIn",value:(a=o((function*(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ease-in-out";zM.assign(this.mainDiv$.style,{transition:"opacity ".concat(t,"ms ").concat(n),display:"block"}),requestAnimationFrame((function(){zM.assign(e.mainDiv$.style,{opacity:"1",pointerEvents:"auto"})})),yield xM.sleepAsync(t)})),function(){return a.apply(this,arguments)})},{key:"fadeOut",value:(i=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ease-in-out";zM.assign(this.mainDiv$.style,{transition:"opacity ".concat(e,"ms ").concat(t),opacity:"0",pointerEvents:"none"}),yield xM.sleepAsync(e),this.mainDiv$.style.display="none"})),function(){return i.apply(this,arguments)})}]),n}();S._RF.pop(),S._RF.push({},"af947t5g91EkZVWXv5upZaV","CacheUtils",void 0);var GM,HM,qM,VM,$M,WM,KM,jM,YM,XM,JM,ZM=Ludex.Utils.Image,QM=codex.frameCapture,eN=function(){function n(){t(this,n)}var i,a,r;return e(n,null,[{key:"inst",get:function(){return this.inst$||(this.inst$=new n),this.inst$}},{key:"getPlayerAvatar",value:(r=o((function*(e,t,n,i){var a=this.playerAvatarCache$.get("".concat(t,":").concat(n));return a||(a=yield this.loadPlayerAvatar(e,t,n,i)),a})),function(e,t,n,i){return r.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(a=o((function*(e,t,n,i){var a=yield this.loadImage(e,n,n,"".concat(t,":").concat(n));if((null==i||!i.aborted)&&a){var o=ue.createWithImage(a);return this.playerAvatarCache$.set("".concat(t,":").concat(n),o),o}})),function(e,t,n,i){return a.apply(this,arguments)})},{key:"isAvatarCached",value:function(e,t){return this.playerAvatarCache$.has("".concat(e,":").concat(t))}},{key:"loadImage",value:(i=o((function*(e,t,n,i){try{var a=yield QM.captureAsync({width:t,height:n,name:"LeaderAvatar",renderOptions:m({},i,{name:i,type:"image",depth:0,position:[0,0],size:[t,n],image:e})});return a?yield ZM.loadImage(a):null}catch(e){return null}})),function(e,t,n,a){return i.apply(this,arguments)})}]),n}();eN.playerAvatarCache$=new Map;try{new eN}catch(e){console.error("CacheUtils",e)}S._RF.pop(),S._RF.push({},"540108ucKBPYbN9gW5TFh/q","LeaderRail",void 0);var tN,nN,iN,aN,oN,rN=C.ccclass,lN=C.property,sN="overlays/avatar/tournament-rail-overlay-styles.css",uN=(GM=rN("LeaderRail"),HM=lN(K),qM=lN(q),VM=lN(F),$M=lN(oT),GM((jM=a((KM=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"scoreLabel",jM,l(e)),r(e,"crown",YM,l(e)),r(e,"avatar",XM,l(e)),r(e,"spark",JM,l(e)),e.score=0,e.isOverlayMode=!1,e.playerAvatarOverlay=null,e.showAvatarOverlay$=function(){var t=o((function*(t){var n,i=e.getAvatarPosition$(),a=i.worldX,o=i.worldY,r=yield null===(n=e.playerAvatarOverlay)||void 0===n?void 0:n.updateOverlay({playerId:t,worldX:a,worldY:o,avatarWidth:e.getAvatarWidth$(),customCss:sN});return null!=r&&r}));return function(e){return t.apply(this,arguments)}}(),e.getAvatarWidth$=function(){var t=e.avatar.node.getComponent(P);return t?t.width:0},e.getAvatarPosition$=function(){var t=e.avatar.node;return{worldX:t.worldPositionX,worldY:t.worldPositionY}},e.createAvatarOverlay$=function(){try{BM.isOverlayViewAPIAvailable(GameSDK),e.isOverlayMode=!0,e.playerAvatarOverlay=new UM(e.node.scene)}catch(e){return}},e.handleAvatarPositionChanged$=function(){var t;if(e.isOverlayMode){var n=e.getAvatarPosition$(),i=n.worldX,a=n.worldY;null===(t=e.playerAvatarOverlay)||void 0===t||t.moveOverlayTo(i,a)}},e}return e(d,[{key:"__preload",value:function(){this.defaultAvatar=this.avatar.spriteFrame,this.uiOpacity=this.getComponent(B)}},{key:"onLoad",value:function(){this.createAvatarOverlay$()}},{key:"onDisable",value:function(){this.cleanupOverlay()}},{key:"updateScore",value:(u=o((function*(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e-this.score,o=i?0:.5,r=R(this.node).to(o,{},{onUpdate:function(e,t){if(t){var i=Math.floor(a*t)+n.score;n.scoreLabel.string=i.toString()}}});yield Ve.runTweenAsync(r,t),this.score=e,this.scoreLabel.string=e.toString()})),function(e,t){return u.apply(this,arguments)})},{key:"updatePhoto",value:(s=o((function*(){var e=GameSDK.player.getID();if(e){if(this.isOverlayMode){if(yield this.showAvatarOverlay$(e))return;this.isOverlayMode=!1}var t=GameSDK.player.getPhoto();if(t){var n=yield eN.getPlayerAvatar(t,e,50);n?(n.packable=!0,this.avatar.spriteFrame=n):this.avatar.spriteFrame=this.defaultAvatar}}})),function(){return s.apply(this,arguments)})},{key:"setCrown",value:function(e){this.crown.active=e}},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e}},{key:"playSparkParticle",value:function(){this.spark.play()}},{key:"stopSparkParticle",value:function(){this.spark.stop()}},{key:"cleanupOverlay",value:function(){var e;null===(e=this.playerAvatarOverlay)||void 0===e||e.hideOverlay()}},{key:"update",value:function(e){this.handleAvatarPositionChanged$()}}]),d}(T)).prototype,"scoreLabel",[HM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YM=a(KM.prototype,"crown",[qM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XM=a(KM.prototype,"avatar",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JM=a(KM.prototype,"spark",[$M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=KM))||WM);S._RF.pop(),S._RF.push({},"00759vwS/dHS6GvHKvVE5Q1","TournamentProgressBar",void 0);var cN,dN,hN,pN,yN,vN,fN,gN,mN,bN,wN,SN,kN,CN,EN,AN,TN,PN,ON,LN,IN=C.ccclass,RN=C.property,_N=474,DN=(tN=IN("TournamentProgressBar"),nN=RN(uN),tN((oN=a((aN=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"playerLeader",oN,l(e)),e.onUpdate=function(){e.playerLeader&&e.playerLeader.node&&(e.playerLeader.node.position=new V(e.progressBar.progress*_N-237,0,0))},e}return e(c,[{key:"__preload",value:function(){this.progressBar=this.getComponent(ie)}},{key:"updateProgress",value:(s=o((function*(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"cubicOut",a=R(this.progressBar).to(n,{progress:e},{easing:i,onUpdate:this.onUpdate});yield Ve.runTweenAsync(a,t)})),function(e,t){return s.apply(this,arguments)})},{key:"getProgress",value:function(){return this.progressBar.progress}}]),c}(T)).prototype,"playerLeader",[nN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iN=aN))||iN);S._RF.pop(),S._RF.push({},"16d68fBLT1Ha7lXADThDtfC","TournamentRail",void 0);var MN,NN,BN,FN,xN,zN,UN,GN,HN,qN=C.ccclass,VN=C.property,$N=Ludex,WN=$N.Utils,KN=WN.Array,jN=WN.Signal,YN=WN.Valid,XN=$N.Match.Modes,JN=(cN=qN("TournamentRail"),dN=VN(DN),hN=VN(uN),pN=VN(q),yN=VN(q),vN=VN(Kd),fN=VN(Kd),gN=VN(q),mN=VN(B),bN=Ni.onlyRunInLifeCycleAsync,cN((kN=a((SN=function(a){n(f,a);var s,c,d,h,p,y,v=i(f);function f(){var e;t(this,f);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=v.call.apply(v,[this].concat(i)),r(e,"progressBar",kN,l(e)),r(e,"playerLeader",CN,l(e)),r(e,"flag",EN,l(e)),r(e,"sword",AN,l(e)),r(e,"currentRankLocalizer",TN,l(e)),r(e,"nextRankLocalizer",PN,l(e)),r(e,"devTools",ON,l(e)),r(e,"challengerJoinedUiOpacity",LN,l(e)),e.challengerJoinedY=0,e.leaderData=[],e.nextLeaderIndex=0,e.score=0,e.minScore=0,e.maxScore=0,e.signal=new jN.SignalController,e}return e(f,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(B),this.playerLeader.updatePhoto(),this.devTools.active=YN.isDebugger(),this.challengerJoinedY=this.challengerJoinedUiOpacity.node.position.y}},{key:"updateStatus",value:(y=o((function*(e){if(Xy.getMatchMode()!==XN.TOURNAMENT)return this.uiOpacity.opacity=0,void this.playerLeader.cleanupOverlay();this.uiOpacity.opacity=255,this.playerLeader.updatePhoto();var t=e.leaderData,n=e.score;if(t&&void 0!==n){var i=this.signal.renew();this.score=n,this.nextLeaderIndex=this.getScoreReachedLeaderIndex(this.score,t),this.syncRail(t,i,!0)}})),function(e){return y.apply(this,arguments)})},{key:"syncRail",value:(p=o((function*(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e[this.nextLeaderIndex-1],a=e[this.nextLeaderIndex],o=i?i.rank:a?a.rank+1:1;this.setRankLabel(o,this.currentRankLocalizer);var r=!a;this.nextRankLocalizer.node.active=!r,this.runActiveAnimation(this.sword,!r,t,n),this.playerLeader.setCrown(r),this.playerLeader.updateScore(this.score,t,n);var l=n?0:void 0;if(r)this.playerLeader.playSparkParticle(),yield this.progressBar.updateProgress(1,t,l);else{this.playerLeader.stopSparkParticle(),this.setRankLabel(a.rank,this.nextRankLocalizer),this.minScore=i?i.score:0,this.maxScore=a.score;var s=(this.score-this.minScore)/(this.maxScore-this.minScore);(s=.8*s+.1)<this.progressBar.getProgress()&&this.showScoreUpdatedNotice(t),yield this.progressBar.updateProgress(s,t,l)}})),function(e,t){return p.apply(this,arguments)})},{key:"handleScoreUpdated",value:(h=o((function*(e){var t=e.score,n=e.leaderData;if(void 0!==t&&n){this.leaderData=n;var i=this.signal.renew();this.score=t;var a=this.getScoreReachedLeaderIndex(t,n);if(a>this.nextLeaderIndex){this.nextLeaderIndex=a;var o=(1-this.progressBar.getProgress())/1.5;o=Math.min(o,.5),yield this.progressBar.updateProgress(1,i,o,"cubicIn"),this.runBubbleAnimation(this.sword,i),yield this.progressBar.updateProgress(0,i,0),this.runBubbleAnimation(this.flag,i)}else if(a<this.nextLeaderIndex){this.nextLeaderIndex=a;var r=this.progressBar.getProgress()/1.5;r=Math.min(r,.5),yield this.progressBar.updateProgress(0,i,r,"cubicIn"),this.runBubbleAnimation(this.flag,i),yield this.progressBar.updateProgress(1,i,0),this.runBubbleAnimation(this.sword,i)}this.syncRail(n,i)}})),function(e){return h.apply(this,arguments)})},{key:"runBubbleAnimation",value:(d=o((function*(e,t){e.scale=V.ONE;var n=R(e).to(.1,{scale:new V(1.2,1.2,1.2)}).to(.2,{scale:V.ONE},{easing:"backOut"});yield Ve.runTweenAsync(n,t),e.scale=V.ONE})),function(e,t){return d.apply(this,arguments)})},{key:"runActiveAnimation",value:(c=o((function*(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t?V.ZERO:V.ONE,o=t?V.ONE:V.ZERO;if(i)e.scale=o;else if(!e.scale.equals(o)){var r=t?"backOut":"quadOut";e.scale=a;var l=R(e).to(.1,{scale:new V(1.2,1.2,1.2)}).to(.2,{scale:o},{easing:r});yield Ve.runTweenAsync(l,n),e.scale=o}})),function(e,t,n){return c.apply(this,arguments)})},{key:"getScoreReachedLeaderIndex",value:function(e,t){var n=KN.searchIndex(t,(function(t){return t.score>=e}));return-1===n?t.length:n}},{key:"setRankLabel",value:function(e,t){1!==e?2!==e?3!==e?(t.key="status.nth",t.setParams([e.toString()])):t.key="status.third":t.key="status.second":t.key="status.first"}},{key:"handleDecreaseRank",value:function(){var e,t=u(this.leaderData);try{for(t.s();!(e=t.n()).done;){e.value.score+=2*this.getMedianScore()}}catch(e){t.e(e)}finally{t.f()}this.handleScoreUpdated({score:this.score,leaderData:this.leaderData})}},{key:"handleIncreaseRank",value:function(){var e,t=u(this.leaderData);try{for(t.s();!(e=t.n()).done;){e.value.score-=2*this.getMedianScore()}}catch(e){t.e(e)}finally{t.f()}this.handleScoreUpdated({score:this.score,leaderData:this.leaderData})}},{key:"getMedianScore",value:function(){return(this.leaderData[this.leaderData.length-1].score-this.leaderData[0].score)/this.leaderData.length}},{key:"showScoreUpdatedNotice",value:(s=o((function*(e){var t=this;this.challengerJoinedUiOpacity.node.active=!0,this.challengerJoinedUiOpacity.opacity=0;var n=function(){t.challengerJoinedUiOpacity.node.active=!1,t.challengerJoinedUiOpacity.opacity=0};e.once(n);var i=new V(this.challengerJoinedUiOpacity.node.position.x,this.challengerJoinedY-10,this.challengerJoinedUiOpacity.node.position.z),a=new V(this.challengerJoinedUiOpacity.node.position.x,this.challengerJoinedY,this.challengerJoinedUiOpacity.node.position.z),o=new V(this.challengerJoinedUiOpacity.node.position.x,this.challengerJoinedY+10,this.challengerJoinedUiOpacity.node.position.z);this.challengerJoinedUiOpacity.node.setPosition(i);var r=Ve.runTweenAsync(R(this.challengerJoinedUiOpacity).to(.5,{opacity:255}),e),l=Ve.runTweenAsync(R(this.challengerJoinedUiOpacity.node).to(.5,{position:a},{easing:"cubicOut"}),e),s=Ve.waitTweenAsync(1,e);yield Promise.all([r,l,s]);var u=Ve.runTweenAsync(R(this.challengerJoinedUiOpacity.node).to(.5,{position:o},{easing:"cubicIn"}),e),c=Ve.runTweenAsync(R(this.challengerJoinedUiOpacity).to(.5,{opacity:0}),e);yield Promise.all([u,c]),e.off(n)})),function(e){return s.apply(this,arguments)})}]),f}(T)).prototype,"progressBar",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CN=a(SN.prototype,"playerLeader",[hN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EN=a(SN.prototype,"flag",[pN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AN=a(SN.prototype,"sword",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TN=a(SN.prototype,"currentRankLocalizer",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PN=a(SN.prototype,"nextRankLocalizer",[fN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ON=a(SN.prototype,"devTools",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LN=a(SN.prototype,"challengerJoinedUiOpacity",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(SN.prototype,"updateStatus",[bN],Object.getOwnPropertyDescriptor(SN.prototype,"updateStatus"),SN.prototype),wN=SN))||wN);S._RF.pop(),S._RF.push({},"ac5371+oVZBLoBKwAM7rH3r","GameSceneLayout",void 0);var ZN,QN,eB,tB,nB,iB,aB,oB,rB,lB,sB=C.ccclass,uB=C.property,cB=(MN=sB("GameSceneLayout"),NN=uB(JN),BN=uB(IM),FN=uB(TM),MN((UN=a((zN=function(a){n(p,a);var s,c,d,h=i(p);function p(){var e;t(this,p);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=h.call.apply(h,[this].concat(i)),r(e,"tournamentRail",UN,l(e)),r(e,"clock",GN,l(e)),r(e,"items",HN,l(e)),e.isInited=!1,e.entranceSignal=new In,e.exitSignal=new In,e}return e(p,[{key:"waitForInitAsync",value:(d=o((function*(){var e=this;if(!this.isInited)return new Promise((function(t){var n=setInterval((function(){e.isInited&&(clearInterval(n),t())}),100)}))})),function(){return d.apply(this,arguments)})},{key:"setLevelText",value:function(e){}},{key:"disableLayout",value:function(){}},{key:"enableLayout",value:function(){}},{key:"updateStatus",value:function(e){this.clock.updateStatus(e),this.tournamentRail.updateStatus(e);var t,n=u(this.items);try{for(n.s();!(t=n.n()).done;){t.value.updateStatus(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"playExitAnimUI",value:(c=o((function*(){})),function(){return c.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(s=o((function*(){})),function(){return s.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){}},{key:"unHighlightCoinContainer",value:function(){}},{key:"handleScoreUpdated",value:function(e){}}]),p}(T)).prototype,"tournamentRail",[NN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GN=a(zN.prototype,"clock",[BN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HN=a(zN.prototype,"items",[FN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xN=zN))||xN);S._RF.pop(),S._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var dB,hB,pB,yB,vB,fB,gB,mB,bB,wB=C.ccclass,SB=C.property,kB=C.disallowMultiple,CB=(ZN=wB("ScoreBlock"),QN=SB(K),eB=SB(W),tB=SB({visible:function(){return this.isResizeWidth}}),nB=Ni.onlyRunInLifeCycle,ZN(iB=kB((oB=a((aB=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"scoreText",oB,l(e)),r(e,"isResizeWidth",rB,l(e)),r(e,"maxScoreWidth",lB,l(e)),e.panelWidthDiff=0,e}return e(d,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(P),this.scoreUITransform=this.scoreText.node.getComponent(P),this.panelWidthDiff=this.uiTransform.width-this.maxScoreWidth,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"updateScore",value:(u=o((function*(e){var t=this,n=e-this.score,i=R(this.node).to(.1,{},{onUpdate:function(e,i){if(i){var a=Math.floor(n*i)+t.score;t.scoreText.string=a.toString(),t.resizeWidth()}}});yield Ve.runTweenAsync(i),this.setScore(e),yield this.resizeWidth()})),function(e){return u.apply(this,arguments)})},{key:"setScore",value:function(e){var t=null!=e?e:0;this.score=t,this.scoreText.string=t.toString()}},{key:"resizeWidth",value:(s=o((function*(){var e=this;if(this.isResizeWidth){var t=this.uiTransform.width,n=(this.scoreUITransform.width>this.maxScoreWidth?this.scoreUITransform.width:this.maxScoreWidth)+this.panelWidthDiff;n<=t&&0!==this.score||(this.uiTween&&this.uiTween.stop(),this.uiTween=R(this.node).to(.05,{},{easing:"sineOut",onUpdate:function(i,a){a&&(e.uiTransform.width=te.lerp(t,n,a))}}),yield Ve.runTweenAsync(this.uiTween),this.uiTransform.width=n)}})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"scoreText",[QN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rB=a(aB.prototype,"isResizeWidth",[eB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lB=a(aB.prototype,"maxScoreWidth",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a(aB.prototype,"setScore",[nB],Object.getOwnPropertyDescriptor(aB.prototype,"setScore"),aB.prototype),iB=aB))||iB)||iB);S._RF.pop(),S._RF.push({},"424745QWUlDPabdCe8UcRwy","ChallengeScoreBlock",void 0);var EB,AB,TB,PB,OB,LB,IB,RB=C.ccclass,_B=C.property,DB=(dB=RB("ChallengeScoreBlock"),hB=_B(F),pB=_B(ue),yB=_B(q),dB((gB=a((fB=function(a){n(p,a);var s,u,h=i(p);function p(){var e;t(this,p);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=h.call.apply(h,[this].concat(i)),r(e,"avatar",gB,l(e)),r(e,"defaultAvatar",mB,l(e)),r(e,"defaultAvatarNode",bB,l(e)),e.playerAvatarOverlay=null,e.isOverlayMode=!1,e.setAvatarSpriteFrame$=function(t){e.isValid&&(e.avatar.spriteFrame=t)},e.createAvatarOverlay$=function(){try{BM.isOverlayViewAPIAvailable(GameSDK),e.isOverlayMode=!0,e.playerAvatarOverlay=new UM(e.node.scene)}catch(e){return}},e.handleScoreBlockPositionChange$=function(){var t;if(e.isOverlayMode){var n=e.getDefaultAvatarPosition$(),i=n.worldX,a=n.worldY;null===(t=e.playerAvatarOverlay)||void 0===t||t.moveOverlayTo(i,a)}},e.getDefaultAvatarPosition$=function(){var t=e.defaultAvatarNode;return{worldX:t.worldPositionX,worldY:t.worldPositionY}},e.getDefaultAvatarWidth$=function(){var t=e.defaultAvatarNode.getComponent(P);return t?t.width:0},e}return e(p,[{key:"onLoad",value:function(){c(d(p.prototype),"onLoad",this).call(this),this.createAvatarOverlay$()}},{key:"onDisable",value:function(){this.cleanupOverlay()}},{key:"updateInfo",value:(u=o((function*(e,t,n){var i=this;this.setScore(n),this.scheduleOnce((function(){return i.resizeWidth()}),0);try{if(this.isOverlayMode){if(yield this.showAvatarOverlay(t))return;this.isOverlayMode=!1}var a=yield eN.getPlayerAvatar(e,t,50);if(!a)return;a.packable=!0,this.setAvatarSpriteFrame$(a)}catch(e){this.setAvatarSpriteFrame$(this.defaultAvatar)}})),function(e,t,n){return u.apply(this,arguments)})},{key:"showAvatarOverlay",value:(s=o((function*(e){var t,n=this.getDefaultAvatarPosition$(),i=n.worldX,a=n.worldY,o=yield null===(t=this.playerAvatarOverlay)||void 0===t?void 0:t.updateOverlay({playerId:e,worldX:i,worldY:a,avatarWidth:this.getDefaultAvatarWidth$()});return null!=o&&o})),function(e){return s.apply(this,arguments)})},{key:"cleanupOverlay",value:function(){var e;null===(e=this.playerAvatarOverlay)||void 0===e||e.hideOverlay()}},{key:"update",value:function(e){this.handleScoreBlockPositionChange$()}}]),p}(CB)).prototype,"avatar",[hB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mB=a(fB.prototype,"defaultAvatar",[pB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bB=a(fB.prototype,"defaultAvatarNode",[yB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vB=fB))||vB);S._RF.pop(),S._RF.push({},"aa96ehFCjBCy6vss3wBcr+l","CustomScoreContainer",void 0);var MB,NB,BB,FB,xB,zB,UB,GB,HB,qB,VB,$B,WB,KB,jB,YB,XB,JB,ZB,QB,eF,tF,nF=C.ccclass,iF=C.property,aF=C.disallowMultiple,oF=(EB=nF("CustomScoreContainer"),AB=iF(q),TB=iF(K),EB(PB=aF((LB=a((OB=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"customScoreBlock",LB,l(e)),r(e,"scoreText",IB,l(e)),e}return e(s,[{key:"updateStatus",value:function(){Xy.getMatchMode()===ev?(this.customScoreBlock.active=!0,this.scoreText.string="".concat(pv.getCustomBonus(),"%")):this.customScoreBlock.active=!1}}]),s}(T)).prototype,"customScoreBlock",[AB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IB=a(OB.prototype,"scoreText",[TB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PB=OB))||PB)||PB);S._RF.pop(),S._RF.push({},"b1ef276tNtH+oc5BqYfDMXl","Sidebar",void 0);var rF,lF,sF,uF,cF,dF,hF,pF,yF,vF,fF,gF=C.ccclass,mF=C.property,bF=C.disallowMultiple,wF={score:-589.003,item:-861.836,sidebar:1114},SF={score:-568.518,item:-981.836,sidebar:1222},kF=(MB=gF("Sidebar"),NB=mF(CB),BB=mF(q),FB=mF(K),xB=mF(q),zB=mF(I),UB=mF(q),GB=mF(oF),HB=mF(Ee),qB=mF(B),VB=Ni.onlyRunInLifeCycle,MB($B=bF((KB=a((WB=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"scoreBlock",KB,l(e)),r(e,"itemContainer",jB,l(e)),r(e,"levelNumber",YB,l(e)),r(e,"sidebarContainer",XB,l(e)),r(e,"sidebarBackground",JB,l(e)),r(e,"leavesContainer",ZB,l(e)),r(e,"customScoreContainer",QB,l(e)),r(e,"entranceCurve",eF,l(e)),r(e,"uiOpacity",tF,l(e)),e.originSidebarPosition=0,e.originLeavesPosition=0,e}return e(d,[{key:"saveOriginPos",value:function(){this.originSidebarPosition=this.sidebarContainer.position.y,this.originLeavesPosition=this.leavesContainer.position.y}},{key:"initUIPos",value:function(){this.sidebarContainer.setPosition(this.sidebarContainer.position.x,this.originSidebarPosition+1250),this.leavesContainer.setPosition(this.leavesContainer.position.x,this.originLeavesPosition+150)}},{key:"playExitAnimUI",value:(u=o((function*(e){var t=this,n=function(){return t.setActive(!1)};e.addAbortListener(n);var i=R(this.sidebarContainer).to(.2,{position:new V(this.sidebarContainer.position.x,this.originSidebarPosition+1250,0)},{easing:"quadIn"}),a=R(this.leavesContainer);a.delay(.1).to(.2,{position:new V(this.leavesContainer.position.x,this.originLeavesPosition+150,0)},{easing:"quadIn"}),yield Promise.all([Ve.runTweenAsync(i,e),Ve.runTweenAsync(a,e)]),e.removeAbortListener(n),e.aborted||this.setActive(!1)})),function(e){return u.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(s=o((function*(e){var t=this;this.setActive(!0);var n=R(this.sidebarContainer).to(.3,{position:new V(this.sidebarContainer.position.x,this.originSidebarPosition,0)},{easing:function(e){return t.entranceCurve.evaluate(e)}}),i=R(this.leavesContainer);i.to(.2,{position:new V(this.leavesContainer.position.x,this.originLeavesPosition,0)},{easing:"quadIn"}),yield Promise.all([Ve.runTweenAsync(n,e),Ve.runTweenAsync(i,e)])})),function(e){return s.apply(this,arguments)})},{key:"setActive",value:function(e){this.uiOpacity&&(this.uiOpacity.opacity=e?255:0)}},{key:"setLevelText",value:function(e){this.levelNumber.string=e.toString()}},{key:"updateStatus",value:function(e){void 0!==e.score&&this.scoreBlock.setScore(e.score),void 0!==e.level&&this.setLevelText(e.level),this.customScoreContainer.updateStatus(),this.updateUIByMode()}},{key:"updateScore",value:function(e){this.scoreBlock.updateScore(e)}},{key:"updateUIByMode",value:function(){var e=Xy.getMatchMode()===ev?SF:wF;this.scoreBlock.node.position.set(this.scoreBlock.node.position.x,e.score),this.itemContainer.position.set(this.itemContainer.position.x,e.item),this.sidebarContainer.getComponent(P).height=e.sidebar,this.sidebarBackground.updateAlignment()}}]),d}(T)).prototype,"scoreBlock",[NB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jB=a(WB.prototype,"itemContainer",[BB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YB=a(WB.prototype,"levelNumber",[FB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XB=a(WB.prototype,"sidebarContainer",[xB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JB=a(WB.prototype,"sidebarBackground",[zB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZB=a(WB.prototype,"leavesContainer",[UB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QB=a(WB.prototype,"customScoreContainer",[GB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eF=a(WB.prototype,"entranceCurve",[HB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ee}}),tF=a(WB.prototype,"uiOpacity",[qB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(WB.prototype,"setActive",[VB],Object.getOwnPropertyDescriptor(WB.prototype,"setActive"),WB.prototype),$B=WB))||$B)||$B);S._RF.pop(),S._RF.push({},"0ff4fFbKylIvaONtaTZkRQV","LandscapeLayout",void 0);var CF,EF,AF,TF,PF,OF,LF,IF=C.ccclass,RF=C.property,_F=codex.match,DF=Ludex.Match.Modes,MF=(rF=IF("LandscapeLayout"),lF=RF({type:kF,group:"Sidebar"}),sF=RF({type:DB,group:"ChallengeScore"}),uF=RF({type:DB,group:"ChallengeScore"}),cF=RF(q),rF((pF=a((hF=function(a){n(y,a);var s,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"sidebar",pF,l(e)),r(e,"playerScoreBlock",yF,l(e)),r(e,"opponentScoreBlock",vF,l(e)),r(e,"topAnimNodes",fF,l(e)),e.originTopNodesPos=[],e}return e(y,[{key:"onLoad",value:function(){var e=this;A.once(Z.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos(),e.isInited=!0}))}},{key:"saveOriginPos",value:function(){this.sidebar.saveOriginPos();var e,t=u(this.topAnimNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originTopNodesPos.push(n.position.clone())}}catch(e){t.e(e)}finally{t.f()}}},{key:"initUIPos",value:function(){var e=this;this.sidebar.initUIPos(),this.topAnimNodes.forEach((function(t,n){var i=e.originTopNodesPos[n].clone();i.y+=100,t.setPosition(i)}))}},{key:"playExitAnimUI",value:(h=o((function*(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new In;var n=[];this.topAnimNodes.forEach((function(i,a){var o=new V(e.node.position.x,e.originTopNodesPos[a].y+100,0),r=R(i);r.to(t,{position:o},{easing:"backIn"}),n.push(Ve.runTweenAsync(r,e.exitSignal))})),n.push(this.sidebar.playExitAnimUI(this.exitSignal)),yield Promise.all(n)})),function(){return h.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(s=o((function*(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new In;var n=[];this.topAnimNodes.forEach((function(i,a){var o=new V(e.node.position.x,e.originTopNodesPos[a].y,0),r=R(i);r.to(t,{position:o},{easing:"backOut"}),n.push(Ve.runTweenAsync(r,e.entranceSignal))})),n.push(this.sidebar.playEntranceAnimUI(this.entranceSignal)),yield Promise.all(n)})),function(){return s.apply(this,arguments)})},{key:"setLevelText",value:function(e){this.sidebar.setLevelText(e)}},{key:"updateStatus",value:function(e){c(d(y.prototype),"updateStatus",this).call(this,e),this.sidebar.updateStatus(e),this.updateScoreBlockStatus(e)}},{key:"updateScoreBlockStatus",value:function(e){var t;if(Xy.getMatchMode()!==DF.CHALLENGE_FRIEND)return this.playerScoreBlock.node.active=!1,void(this.opponentScoreBlock.node.active=!1);if(!this.playerScoreBlock.node.active){var n=_F.getMatchState(),i=null!==(t=Xy.getMatchCustomData())&&void 0!==t?t:{},a=i.playerId,o=i.opponentId;if(a&&o){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var r=n.profiles[a],l=n.profiles[o];r&&this.playerScoreBlock.updateInfo(r.photo,a,r.score),l&&this.opponentScoreBlock.updateInfo(l.photo,o,l.score),void 0!==e.score&&this.playerScoreBlock.setScore(e.score)}}}},{key:"handleScoreUpdated",value:function(e){this.sidebar.updateScore(e),this.playerScoreBlock.node.active&&this.playerScoreBlock.updateScore(e)}}]),y}(cB)).prototype,"sidebar",[lF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yF=a(hF.prototype,"playerScoreBlock",[sF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vF=a(hF.prototype,"opponentScoreBlock",[uF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fF=a(hF.prototype,"topAnimNodes",[cF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dF=hF))||dF);S._RF.pop(),S._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var NF,BF,FF,xF,zF,UF,GF,HF,qF,VF,$F,WF,KF,jF,YF,XF,JF=C.ccclass,ZF=C.property,QF=(CF=JF("UIMasks"),EF=ZF(qr),AF=ZF(uR),CF((OF=a((PF=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"background",OF,l(e)),r(e,"alphaMasks",LF,l(e)),e}return e(d,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"show",value:(u=o((function*(){this.alphaMasks.setMaskActive(0,Je.isPortrait()),this.alphaMasks.setMaskActive(1,Je.isLandscape()),this.background.node.active=!0,yield this.background.changeStateFade(!0,.25)})),function(){return u.apply(this,arguments)})},{key:"hide",value:(s=o((function*(){yield this.background.changeStateFade(!1,.25),this.background.node.active=!1})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"background",[EF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LF=a(PF.prototype,"alphaMasks",[AF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TF=PF))||TF);S._RF.pop(),S._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var ex,tx,nx,ix,ax,ox,rx,lx,sx,ux=C.ccclass,cx=C.property,dx=Ludex.Utils.Number,hx=(NF=ux("CoinContainer"),BF=cx(K),FF=cx(F),xF=cx(B),zF=cx(ee),UF=Ni.onlyRunInLifeCycle,GF=Ni.onlyRunInLifeCycleAsync,HF=Ni.onlyRunInLifeCycleAsync,qF=Ni.onlyRunInLifeCycle,VF=Ni.onlyRunInLifeCycle,NF((KF=a((WF=function(a){n(h,a);var s,u,c,d=i(h);function h(){var e;t(this,h);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=d.call.apply(d,[this].concat(i)),r(e,"coinLabel",KF,l(e)),r(e,"coinIcon",jF,l(e)),r(e,"explosionCircle",YF,l(e)),r(e,"explosionParticles",XF,l(e)),e.currentCoin=0,e}return e(h,[{key:"setCoinTextFromNumber",value:function(e){var t=dx.getShortNumber(e,3);this.coinLabel.string=t}},{key:"handleAddCoinButton",value:function(){rt.openScreen(lt.GET_COIN_SCREEN,{quantity:vy})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents(),this.explosionParticles.node.active=!1}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(Es.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(c=o((function*(e){var t,n,i,a=e.coins,o=e.collectionAnimation,r=e.playSound;if(void 0!==o&&!1!==this.node.activeInHierarchy){var l=o.signal;if(null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null!=l?l:new In,o.animateTextOnly)return yield this.animateCoinText(a,0,r,l),void this.setCoins(a);var s=null!==(n=o.flyDuration)&&void 0!==n?n:0,u=(null!==(i=o.floatDuration)&&void 0!==i?i:0)+s;yield this.animateCoinText(a,u,r,l),this.setCoins(a)}else this.setCoins(a)})),function(e){return c.apply(this,arguments)})},{key:"setCoins",value:function(e){this.setCoinTextFromNumber(e),this.currentCoin=e}},{key:"animateCoinText",value:(u=o((function*(e,t){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3?arguments[3]:void 0,o=this.currentCoin;yield Ve.waitTweenAsync(t,a),i&&je.playSound(Qi.COLLECT_COINS),yield Ve.runOnUpdateAsync(this.node,1,(function(t){var i=Math.round(o+(e-o)*t);n.setCoinTextFromNumber(i)}),a)})),function(e,t){return u.apply(this,arguments)})},{key:"emitExplodeEffect",value:(s=o((function*(e){this.initializeExplosionCircle(),this.explosionParticles.resetSystem(),yield Promise.all([Ve.runTweenAsync(R(this.explosionCircle.node).to(.4,{scale:new V(3,3,3)},{easing:"quadOut"}),e),Ve.runTweenAsync(R(this.explosionCircle).delay(.2).to(.2,{opacity:0}),e)]),this.resetExplosionCircle()})),function(e){return s.apply(this,arguments)})},{key:"resetExplosionCircle",value:function(){this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0,this.explosionCircle.node.active=!1,this.explosionParticles.node.active=!1}},{key:"initializeExplosionCircle",value:function(){this.explosionCircle.node.active=!0,this.explosionParticles.node.active=!0,this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0)}},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),h}(T)).prototype,"coinLabel",[BF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jF=a(WF.prototype,"coinIcon",[FF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YF=a(WF.prototype,"explosionCircle",[xF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XF=a(WF.prototype,"explosionParticles",[zF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(WF.prototype,"setCoins",[UF],Object.getOwnPropertyDescriptor(WF.prototype,"setCoins"),WF.prototype),a(WF.prototype,"animateCoinText",[GF],Object.getOwnPropertyDescriptor(WF.prototype,"animateCoinText"),WF.prototype),a(WF.prototype,"emitExplodeEffect",[HF],Object.getOwnPropertyDescriptor(WF.prototype,"emitExplodeEffect"),WF.prototype),a(WF.prototype,"resetExplosionCircle",[qF],Object.getOwnPropertyDescriptor(WF.prototype,"resetExplosionCircle"),WF.prototype),a(WF.prototype,"initializeExplosionCircle",[VF],Object.getOwnPropertyDescriptor(WF.prototype,"initializeExplosionCircle"),WF.prototype),$F=WF))||$F);S._RF.pop(),S._RF.push({},"f963aJjCvtD0Y2LplwjDer1","ScoreContainer",void 0);var px,yx,vx,fx,gx,mx,bx,wx,Sx,kx,Cx,Ex,Ax,Tx,Px,Ox,Lx,Ix,Rx,_x,Dx=C.ccclass,Mx=C.property,Nx=Ludex.Match.Modes,Bx=codex.match,Fx=(ex=Dx("ScoreContainer"),tx=Mx(CB),nx=Mx(DB),ix=Mx(DB),ex((rx=a((ox=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"scoreBlock",rx,l(e)),r(e,"playerScoreBlock",lx,l(e)),r(e,"opponentScoreBlock",sx,l(e)),e.scoreBlockShown=!0,e.challengeScoreBlockShown=!1,e}return e(s,[{key:"updateStatus",value:function(e){switch(Bx.getMatchState().mode){case Nx.CHALLENGE_FRIEND:this.showChallengeScoreBlock(),this.hideScoreBlock(),void 0!==e.score&&this.playerScoreBlock.setScore(e.score);break;case Nx.SINGLE:case ev:this.hideChallengeScoreBlock(),this.showScoreBlock(),void 0!==e.score&&this.scoreBlock.setScore(e.score);break;default:this.hideScoreBlock(),this.hideChallengeScoreBlock()}}},{key:"showChallengeScoreBlock",value:function(){var e;if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var t=Bx.getMatchState(),n=null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{},i=n.playerId,a=n.opponentId;if(i&&a){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var o=t.profiles[i],r=t.profiles[a];o&&r&&(this.playerScoreBlock.updateInfo(o.photo,i,o.score),this.opponentScoreBlock.updateInfo(r.photo,a,r.score))}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1,this.playerScoreBlock.cleanupOverlay(),this.opponentScoreBlock.cleanupOverlay())}},{key:"showScoreBlock",value:function(){var e;if(!this.scoreBlockShown){this.scoreBlockShown=!0;var t=(null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{}).score;this.scoreBlock.node.active=!0,this.scoreBlock.setScore(t)}}},{key:"hideScoreBlock",value:function(){this.scoreBlockShown&&(this.scoreBlockShown=!1,this.scoreBlock.node.active=!1)}},{key:"updateScore",value:function(e){this.challengeScoreBlockShown?this.playerScoreBlock.updateScore(e):this.scoreBlockShown&&this.scoreBlock.updateScore(e)}}]),s}(T)).prototype,"scoreBlock",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lx=a(ox.prototype,"playerScoreBlock",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sx=a(ox.prototype,"opponentScoreBlock",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=ox))||ax);S._RF.pop(),S._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var xx,zx,Ux,Gx,Hx,qx,Vx,$x,Wx,Kx=C.ccclass,jx=C.property,Yx=(px=Kx("Header"),yx=jx(Kd),vx=jx(q),fx=jx(q),gx=jx(q),mx=jx(q),bx=jx(Fx),wx=jx(hx),Sx=jx(oF),kx=Ni.onlyRunInLifeCycle,px((Ax=a((Ex=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"levelTextLocalizer",Ax,l(e)),r(e,"settingNode",Tx,l(e)),r(e,"homeNode",Px,l(e)),r(e,"leftNode",Ox,l(e)),r(e,"coinNode",Lx,l(e)),r(e,"scoreContainer",Ix,l(e)),r(e,"coinContainer",Rx,l(e)),r(e,"customScoreContainer",_x,l(e)),e}return e(s,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(B),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"updateStatus",value:function(e){this.scoreContainer.updateStatus(e),void 0!==e.coins&&this.coinContainer.setCoins(e.coins),void 0!==e.level&&this.setLevelText(e.level)}},{key:"highlightCoinContainer",value:function(){var e=re("Canvas/Screens");if(e){var t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}}},{key:"removeCoinContainerHighlight",value:function(){var e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}},{key:"setLevelText",value:function(e){this.levelTextLocalizer.setParams([e.toString()])}},{key:"setButtonsInteractable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.settingNode.getComponent(G).interactable=e,this.homeNode.getComponent(G).interactable=e}},{key:"setActive",value:function(e){this.uiOpacity.opacity=e?255:0}}]),s}(T)).prototype,"levelTextLocalizer",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tx=a(Ex.prototype,"settingNode",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Px=a(Ex.prototype,"homeNode",[fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox=a(Ex.prototype,"leftNode",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lx=a(Ex.prototype,"coinNode",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ix=a(Ex.prototype,"scoreContainer",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rx=a(Ex.prototype,"coinContainer",[wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x=a(Ex.prototype,"customScoreContainer",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Ex.prototype,"setActive",[kx],Object.getOwnPropertyDescriptor(Ex.prototype,"setActive"),Ex.prototype),Cx=Ex))||Cx);S._RF.pop(),S._RF.push({},"456584ngz9FupmxndAXqCbY","PortraitLayout",void 0);var Xx=C.ccclass,Jx=C.property,Zx=(xx=Xx("PortraitLayout"),zx=Jx(Yx),Ux=Jx([q]),Gx=Jx([q]),xx((Vx=a((qx=function(a){n(y,a);var s,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"header",Vx,l(e)),r(e,"topAnimNodes",$x,l(e)),e.originTopNodesPos=[],r(e,"botAnimNodes",Wx,l(e)),e.originBotNodesPos=[],e.hideBotWorldY=-80,e}return e(y,[{key:"onLoad",value:function(){var e=this;this.validateRequiredComponents(),A.once(Z.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos(),e.isInited=!0}))}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var e,t=u(this.topAnimNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originTopNodesPos.push(n.position.clone())}}catch(e){t.e(e)}finally{t.f()}var i,a=u(this.botAnimNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.originBotNodesPos.push(o.position.clone())}}catch(e){a.e(e)}finally{a.f()}}},{key:"initUIPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t,n){var i,a,o=null!==(i=null===(a=e.originTopNodesPos[n])||void 0===a?void 0:a.clone())&&void 0!==i?i:new V(0,0,0);o.y+=200,t.setPosition(o)}));var t=new V(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((function(n,i){var a,o,r,l,s=null!==(a=null===(o=e.originBotNodesPos[i])||void 0===o?void 0:o.clone())&&void 0!==a?a:new V(0,0,0);t.y=e.hideBotWorldY;var u=null!==(r=null===(l=n.parent)||void 0===l?void 0:l.inverseTransformPoint(t,t).y)&&void 0!==r?r:200;s.y=u,n.setPosition(s)}))}},{key:"setLevelText",value:function(e){this.header.setLevelText(e)}},{key:"disableLayout",value:function(){this.header.setButtonsInteractable(!1)}},{key:"enableLayout",value:function(){this.header.setButtonsInteractable()}},{key:"updateStatus",value:function(e){c(d(y.prototype),"updateStatus",this).call(this,e),this.header.updateStatus(e)}},{key:"playExitAnimUI",value:(h=o((function*(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new In;var n=[];this.topAnimNodes.forEach((function(i,a){var o,r,l=new V(i.position.x,(null!==(o=null===(r=e.originTopNodesPos[a])||void 0===r?void 0:r.y)&&void 0!==o?o:0)+200,0),s=R(i);s.to(t,{position:l},{easing:"backIn"}),n.push(Ve.runTweenAsync(s,e.exitSignal))}));var i,a=new V(0,this.hideBotWorldY,0),o=u(this.botAnimNodes);try{for(o.s();!(i=o.n()).done;){var r,l,s=i.value;a.y=this.hideBotWorldY;var c=null!==(r=null===(l=s.parent)||void 0===l?void 0:l.inverseTransformPoint(a,a).y)&&void 0!==r?r:200,d=new V(s.position.x,c,0),h=R(s);h.to(t,{position:d},{easing:"backIn"}),n.push(Ve.runTweenAsync(h,this.exitSignal))}}catch(e){o.e(e)}finally{o.f()}yield Promise.all(n),this.exitSignal.aborted||this.header.setActive(!1)})),function(){return h.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(s=o((function*(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new In,this.header.setActive(!0);var n=[];this.topAnimNodes.forEach((function(i,a){var o,r,l=new V(i.position.x,null!==(o=null===(r=e.originTopNodesPos[a])||void 0===r?void 0:r.y)&&void 0!==o?o:0,0),s=R(i);s.to(t,{position:l},{easing:"backOut"}),n.push(Ve.runTweenAsync(s,e.entranceSignal))})),this.botAnimNodes.forEach((function(i,a){var o,r,l=new V(i.position.x,null!==(o=null===(r=e.originBotNodesPos[a])||void 0===r?void 0:r.y)&&void 0!==o?o:0,0),s=R(i);s.to(t,{position:l},{easing:"backOut"}),n.push(Ve.runTweenAsync(s,e.entranceSignal))})),yield Promise.all(n)})),function(){return s.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"handleScoreUpdated",value:function(e){this.header.scoreContainer.updateScore(e)}}]),y}(cB)).prototype,"header",[zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$x=a(qx.prototype,"topAnimNodes",[Ux],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wx=a(qx.prototype,"botAnimNodes",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Hx=qx))||Hx);S._RF.pop(),S._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var Qx,ez,tz,nz,iz,az="bomb";S._RF.pop(),S._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var oz,rz,lz,sz,uz,cz,dz,hz,pz,yz,vz,fz,gz,mz,bz,wz,Sz,kz=Ludex,Cz=kz.Dtos.Player,Ez=kz.Utils.Function,Az=C.ccclass,Tz=C.property,Pz=codex,Oz=Pz.player,Lz=Pz.language,Iz=(Qx=Az("DevToolsContainer"),ez=Tz(q),Qx((iz=a((nz=function(a){n(y,a);var s,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"devToolsToggle",iz,l(e)),e.isActive=!0,e.game=null,e.bundleName="lowest",e.currentLocaleIndex=0,e.debouncedStarsNotification=Ez.debounce((function(){var e=Oz.getGameData();e&&rt.showNotificationScreen("Stars added. Current stars: ".concat(e.stars))}),700),e}return e(y,[{key:"injectGameplay",value:function(e){this.game=e}},{key:"start",value:function(){this.initCurrentLocale()}},{key:"initCurrentLocale",value:function(){var e=Lz.getCurrentLocale();this.currentLocaleIndex=Qe.indexOf(e)}},{key:"hideAllButtons",value:function(){var e,t=this.getComponentsInChildren(G),n=u(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.node.parent;i&&(i.name!==this.devToolsToggle.name&&(i.active=!1))}}catch(e){n.e(e)}finally{n.f()}}},{key:"showAllButtons",value:function(){var e,t=this.getComponentsInChildren(G),n=u(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.node.parent;i&&(i.name!==this.devToolsToggle.name&&(i.active=!0))}}catch(e){n.e(e)}finally{n.f()}}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){Oz.setPlayerData(Cz.Data.getDefaults()),rt.openScreen(lt.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(Es.START_OVER,0)}},{key:"handleNextLevel",value:(h=o((function*(){var e,t,n,i=(null!==(e=null===(t=this.game)||void 0===t||null===(t=t.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:1)+1;null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),Oz.setGameData({level:i}),this.node.scene.emit(Es.NEXT_LEVEL)})),function(){return h.apply(this,arguments)})},{key:"handlePrevLevel",value:(d=o((function*(){var e,t,n,i=Math.max((null!==(e=null===(t=this.game)||void 0===t||null===(t=t.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:2)-1,1);null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),Oz.setGameData({level:i}),this.node.scene.emit(Es.NEXT_LEVEL)})),function(){return d.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(c=o((function*(e){var t,n=Number(e.string);null===(t=this.game)||void 0===t||t.setGameData({level:n-1}),Oz.setGameData({level:n}),this.node.scene.emit(Es.NEXT_LEVEL)})),function(e){return c.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var e=codex.getBuildVersion();rt.showNotificationScreen("Build version: ".concat(e))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(Es.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){var e;null===(e=this.game)||void 0===e||e.clockManager.setTime(.1)}},{key:"handleClickExplodeButton",value:function(){var e,t,n=this.game;if(n){var i=null===(e=n.getGameData())||void 0===e||null===(e=e.levelData)||void 0===e?void 0:e.specials.bomb;if(i&&!(i<=0)){var a=n.board.getBombTiles();if(0!==a.length){var o=a[0];if(!o||(null===(t=o.special)||void 0===t?void 0:t.type)!==az)throw new Error("Invalid bomb tile");o.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(Es.ADD_ITEM,{item:tt.HINT,quantity:2}),this.node.scene.emit(Es.ADD_ITEM,{item:tt.STORM,quantity:2}),this.node.scene.emit(Es.ADD_ITEM,{item:tt.THUNDER,quantity:2}),this.node.scene.emit(Es.ADD_ITEM,{item:tt.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(Es.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var e=Oz.getGameData();e&&(Oz.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchQualityAssets",value:function(){switch(this.bundleName){case"lowest":this.bundleName="highest";break;case"highest":this.bundleName="lowest"}D.emit($e.REQUEST_UPGRADE_ASSET,{quality:this.bundleName})}},{key:"handleSwitchLocale",value:(s=o((function*(){this.currentLocaleIndex=(this.currentLocaleIndex+1)%Qe.length;var e=Qe[this.currentLocaleIndex];rt.showLoadingNotificationScreen();try{if(!e)throw new Error("Locale is undefined");yield this.preloadLanguageAsync(e),D.emit($e.CHOOSE_LANGUAGE,{locale:e,saveToPlayerData:!0}),rt.showNotificationScreen("Language changed to ".concat(e))}catch(e){console.error(e),rt.showNotificationScreen("Failed to change language")}})),function(){return s.apply(this,arguments)})},{key:"preloadLanguageAsync",value:function(e){return new Promise((function(t,n){D.emit($e.PRELOAD_LANGUAGE,{locale:e,onLoad:t,onError:n})}))}}]),y}(T)).prototype,"devToolsToggle",[ez],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tz=nz))||tz);S._RF.pop(),S._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var Rz,_z,Dz,Mz,Nz,Bz,Fz,xz,zz,Uz=C.ccclass,Gz=C.property,Hz=Ludex,qz=Hz.Utils.Valid,Vz=Hz.Match.Modes,$z=Ke.Layout,Wz=(oz=Uz("UIManager"),rz=Gz(FD),lz=Gz(Zx),sz=Gz(MF),uz=Gz(Iz),cz=Gz(vM),dz=Gz(GD),hz=Gz(QF),oz((vz=a((yz=function(a){n(v,a);var s,c,d,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),r(e,"interstitialAdIndicator",vz,l(e)),r(e,"portraitLayout",fz,l(e)),r(e,"landscapeLayout",gz,l(e)),r(e,"devTools",mz,l(e)),r(e,"comboProgressBar",bz,l(e)),r(e,"comboContainer",wz,l(e)),r(e,"uiMasks",Sz,l(e)),e.uiShown=!1,e.config={},e.isResetDataListener=!1,e.showDevTools=function(){e.devTools&&(e.devTools.node.active=!0)},e}return e(v,[{key:"onLoad",value:function(){this.node.scene.on(ky.Events.UNLOCK_DEV_TOOLS,this.showDevTools),this.node.scene.on(Es.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(Es.RESCUE_FINISHED,this.hideRescueAnimation,this),this.node.scene.on(Es.SCORE_UPDATED,this.handleScoreUpdated,this),D.on($e.ORIENTATION_CHANGED,this.onOrientationChanged,this),this.onOrientationChanged(Je.getCurrentLayout())}},{key:"onDestroy",value:function(){this.node.scene.off(ky.Events.UNLOCK_DEV_TOOLS,this.showDevTools),this.node.scene.off(Es.RESCUE_START,this.showRescueAnimation,this),this.node.scene.off(Es.RESCUE_FINISHED,this.hideRescueAnimation,this),this.node.scene.off(Es.SCORE_UPDATED,this.handleScoreUpdated,this),D.off($e.ORIENTATION_CHANGED,this.onOrientationChanged,this)}},{key:"init",value:function(e){this.currentLayout=this.portraitLayout,this.game=e,this.initDevTools(e),this.comboContainer.init(e.board)}},{key:"initDevTools",value:function(e){var t=this;this.isResetDataListener||(window.addEventListener("reset-game-data",(function(){var e;null===(e=t.devTools)||void 0===e||e.handleResetData()})),this.isResetDataListener=!0),this.devTools&&(this.devTools.node.active=qz.isDebugger(),this.devTools.injectGameplay(e))}},{key:"setLevelText",value:function(e){this.config.level=e,this.currentLayout.setLevelText(e)}},{key:"startCountdown",value:function(){this.comboProgressBar.resume()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume()}},{key:"setComboUI",value:function(e){this.comboContainer.getComponent(qr).changeStateFade(e,.1)}},{key:"disableLayout",value:function(){this.currentLayout.disableLayout()}},{key:"enableLayout",value:function(){this.currentLayout.enableLayout()}},{key:"updateStatus",value:function(){var e;this.currentLayout.updateStatus({coins:this.game.coinManager.getCoins(),score:this.game.scoreManager.getCurrentScore(),leaderData:null===(e=this.game.tournamentManager)||void 0===e?void 0:e.leaderData,items:this.game.itemManager.itemConfigs}),this.comboContainer.updateStatus()}},{key:"showRescueAnimation",value:(p=o((function*(){yield this.uiMasks.show()})),function(){return p.apply(this,arguments)})},{key:"hideRescueAnimation",value:(h=o((function*(){yield this.uiMasks.hide()})),function(){return h.apply(this,arguments)})},{key:"playExitAnimUI",value:(d=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.uiShown=!1,yield this.currentLayout.playExitAnimUI(e)})),function(){return d.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(c=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;this.uiShown=!0,yield this.currentLayout.playEntranceAnimUI(e)})),function(){return c.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.currentLayout.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.currentLayout.unHighlightCoinContainer()}},{key:"handleClickedPauseGame",value:function(){rt.openScreen(lt.PAUSE_SCREEN),this.node.scene.emit(Es.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){rt.openScreen(lt.QUIT_LEVEL_SCREEN),this.node.scene.emit(Es.GAME_PAUSE)}},{key:"items",get:function(){return this.currentLayout.items}},{key:"setInteractableItems",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=u(this.items);try{for(n.s();!(e=n.n()).done;){var i=e.value;t?void 0!==i.itemType?i.button.interactable=this.game.itemManager.canUseItem(i.itemType):console.warn("Item type is not defined"):i.button.interactable=!1}}catch(e){n.e(e)}finally{n.f()}}},{key:"onOrientationChanged",value:(s=o((function*(e){var t;e===$z.Portrait?(this.landscapeLayout.node.active=!1,this.portraitLayout.node.active=!0,this.currentLayout=this.portraitLayout):e===$z.Landscape&&(this.portraitLayout.node.active=!1,this.landscapeLayout.node.active=!0,this.currentLayout=this.landscapeLayout),this.currentLayout&&(this.currentLayout.updateStatus({coins:this.game.coinManager.getCoins(),level:this.config.level,score:this.game.scoreManager.getCurrentScore(),time:this.game.clockManager.getRemainingTime(),leaderData:null===(t=this.game.tournamentManager)||void 0===t?void 0:t.leaderData,items:this.game.itemManager.itemConfigs}),yield this.currentLayout.waitForInitAsync(),this.uiShown?this.playEntranceAnimUI(0):this.playExitAnimUI(0))})),function(e){return s.apply(this,arguments)})},{key:"handleScoreUpdated",value:function(e){var t;this.config.score=e,this.currentLayout.handleScoreUpdated(e),Xy.getMatchMode()===Vz.TOURNAMENT&&this.currentLayout.tournamentRail.handleScoreUpdated({score:e,leaderData:null===(t=this.game.tournamentManager)||void 0===t?void 0:t.leaderData})}}]),v}(T)).prototype,"interstitialAdIndicator",[rz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fz=a(yz.prototype,"portraitLayout",[lz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gz=a(yz.prototype,"landscapeLayout",[sz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mz=a(yz.prototype,"devTools",[uz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bz=a(yz.prototype,"comboProgressBar",[cz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wz=a(yz.prototype,"comboContainer",[dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sz=a(yz.prototype,"uiMasks",[hz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pz=yz))||pz);S._RF.pop(),S._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var Kz=codex,jz=Kz.player,Yz=Kz.event,Xz=Kz.match,Jz=Kz.storage,Zz=Kz.analytics,Qz=Kz.monitorError,eU=Kz.leaderboard,tU=Ludex,nU=tU.Events,iU=tU.Utils,aU=iU.Time,oU=iU.Array,rU=iU.Valid,lU=tU.Configs.Gameplay,sU=tU.Match.Modes,uU=tU.Plugins.Ads,cU=(void 0===uU?{}:uU).Types,dU=C.ccclass,hU=C.property,pU={level:1,isFromLoader:!1};Rz=dU("Gameplay"),_z=hU(Um),Dz=hU(qr),Mz=hU(iw),Rz((Fz=a((Bz=function(a){n(p,a);var c,d,h=i(p);function p(){var e;t(this,p);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=h.call.apply(h,[this].concat(i)),r(e,"board",Fz,l(e)),r(e,"opacityToggler",xz,l(e)),r(e,"pathDraw",zz,l(e)),e.gameData=null,e.rescueTiles=[],e.isAutoPlayEnabled=!1,e.isAdPreloadedForCurrentLevel=!1,e.handleOpenScreen=function(t){t.screenName===ht[lt.GET_ITEM_SCREEN]&&e.uiManager.highlightCoinContainer()},e.handleShowUI=o((function*(){e.uiManager.updateStatus(),e.uiManager.disableLayout(),e.uiManager.setInteractableItems(!1),yield e.uiManager.playEntranceAnimUI(),e.uiManager.enableLayout(),e.uiManager.setInteractableItems(!0)})),e.handleHideUI=o((function*(){e.uiManager.disableLayout(),e.uiManager.setInteractableItems(!1),yield e.uiManager.playExitAnimUI()})),e.handleCloseScreen=function(t){t.screenName===ht[lt.GET_ITEM_SCREEN]&&e.uiManager.unHighlightCoinContainer()},e.handlePauseGame=function(){e.node.scene.emit(Es.PAUSE_TIME),e.node.pauseSystemEvents(!0),e.opacityToggler.changeStateFade(!1,.1),e.uiManager.setComboUI(!1),e.processCrazyGamesGameplayStop()},e.handleResumeGame=function(){var t;e.node.resumeSystemEvents(!0),e.stateManager.isPlaying()&&e.node.scene.emit(Es.RESUME_TIME),e.processCrazyGamesGameplayStart(),e.opacityToggler.changeStateFade(!0,.1),e.uiManager.setComboUI(!0),null===(t=e.guidelinesManager)||void 0===t||t.startAutoGuides()},e.handleReplayGame=function(){var t=o((function*(t){e.handleHideHint();try{var n=Xy.getMatchMode();n!==sU.SINGLE&&n!==ev||(yield Xy.finishMatchAsync()),n!==sU.CHALLENGE_FRIEND&&(yield Xy.startMatchAsync(t)),n===sU.TOURNAMENT&&(yield Xy.setMatchCustomDataAsync({level:1,score:0}),e.setGameData({level:1}))}catch(e){console.warn("handleReplayGame",e)}e.stateManager.initialize()}));return function(e){return t.apply(this,arguments)}}(),e.handleFinishGame=function(){var t;e.attemptCallCreateShortcut(),null!==(t=e.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()?(e.guidelinesManager.guideUi.guideSkipButton.active=!1,e.handleNextLevel()):e.stateManager.finish()},e.handleNextLevel=o((function*(){var t;if(e.gameData){var n=Xy.getMatchMode();try{n!==sU.SINGLE&&n!==ev||(yield Xy.finishMatchAsync())}catch(e){console.warn("handleNextLevel",e)}var i=(null!==(t=e.gameData.level)&&void 0!==t?t:1)+1;e.setGameData({level:i}),n===sU.TOURNAMENT?yield Xy.setMatchCustomDataAsync({level:i}):(yield Xy.setMatchCustomDataAsync({level:i,score:0}),yield Xy.startMatchAsync()),e.stateManager.initialize(),console.log("Next level",e.gameData.level)}})),e.handleStartOver=function(){var t=o((function*(t){var n;jz.setGameData({level:null!=t?t:1}),yield Xy.setMatchCustomDataAsync({level:t,score:0}),e.gameData=jz.getGameData(),e.stateManager.initialize(),console.info("Start over",null===(n=e.gameData)||void 0===n?void 0:n.level)}));return function(e){return t.apply(this,arguments)}}(),e.handleMaxLevel=function(){e.gameData&&(e.initData(),rt.openScreen(lt.CONGRATULATION_SCREEN,{level:e.gameData.level}),console.info("Max level",e.gameData.level))},e.handleExitGame=o((function*(){try{Jz.setStorageData("dashboard","animateToCurrentLevel",!0),Jz.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}})),e.handleTileClick=function(t){e.stateManager.playing(),e.board.handleTileClick(t),e.handleHideHint()},e.handleGridMatchSuccess=function(t,n){e.pathDraw.drawMatchPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)})),e.comboManager.addCombo(),e.handleAddScore(),e.effectManager.playClearEffectAt([n[0].node.worldPosition,n[1].node.worldPosition])},e.handleGridMatchFail=function(t){var n;null!==(n=e.guidelinesManager)&&void 0!==n&&n.isShowErrorPathLevel()&&e.pathDraw.drawErrorPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)}))},e.handleGridClear=o((function*(){var t,n,i,a=e.board.getUncleared();(cU&&10===a.length&&!e.isAdPreloadedForCurrentLevel&&(e.isAdPreloadedForCurrentLevel=!0,ut.preloadAdsByType(cU.INTERSTITIAL)),0===a.length&&e.node.scene.emit(Es.GAME_FINISH),8===a.length)&&(yield null===(t=e.tournamentManager)||void 0===t?void 0:t.requestLeaderData(),null===(n=e.uiManager)||void 0===n||n.currentLayout.tournamentRail.handleScoreUpdated({score:e.scoreManager.getCurrentScore(),leaderData:null===(i=e.tournamentManager)||void 0===i?void 0:i.leaderData}))})),e.handlePauseTime=function(){e.clockManager.pause(),e.uiManager.pauseTime()},e.handleResumeTime=function(){e.clockManager.resume(),e.uiManager.resumeTime()},e.handleClockTimeout=function(){e.stateManager.fail(Jy)},e.handleHalfTime=function(){void 0!==e.guidelinesManager&&(e.board.getUncleared().length>=e.board.getCleared().length&&e.guidelinesManager.startThunderGuide()||e.board.getBombTiles().length>0&&e.guidelinesManager.startPliersGuide())},e.handleStartRescue=function(){var t,n,i;if(je.turnDownMusic(),ot.setBlockInput(!0),e.board.setIgnoreInput(!0),e.rescueTiles.length>0){var a,o=u(e.rescueTiles);try{for(o.s();!(a=o.n()).done;){a.value.restore()}}catch(e){o.e(e)}finally{o.f()}e.rescueTiles=[]}var r=null!==(t=Xy.getMatchMode())&&void 0!==t?t:void 0;null==Zz||Zz.levelRescue(null!==(n=null===(i=e.gameData)||void 0===i?void 0:i.level)&&void 0!==n?n:1,void 0,r)},e.handleFinishRescue=function(){ot.setBlockInput(!1),e.board.setIgnoreInput(!1)},e.handleBombExplode=function(){var t=o((function*(t){e.rescueTiles.push(t),e.board.setIgnoreInput(!0),ot.getBlockInput()||(je.playSound(Qi.BOMB_EXPLODE_1),ot.setBlockInput(!0));var n=t.node.worldPosition;yield e.effectManager.createBombExplosionAt(new V(n.x,n.y,0)),ot.setBlockInput(!1),e.stateManager.isFail()||e.stateManager.fail(Zy)}));return function(e){return t.apply(this,arguments)}}(),e.handleShowHint=function(){if(!e.pathDraw.isDrawingHint){var t=e.board.getHintPath();t&&(je.playSound(Qi.HINT_ITEM),e.pathDraw.drawHintPath(t,(function(t){return e.board.getAnyTileWorldPosition(t.x,t.y)})),e.board.showHint(),e.node.scene.emit(Es.REFRESH_ITEMS))}},e.handleGridOrientationChange=function(){e.handleHideHint()},e.handleHideHint=function(){e.pathDraw.isDrawingHint&&(e.pathDraw.clearHintPath(),e.board.hideHint(),e.node.scene.emit(Es.REFRESH_ITEMS))},e.handleAddScore=function(){var t=e.levelManager.getLevelData().level,n=e.comboManager.getCombo(),i=e.clockManager.getRemainingTime();e.scoreManager.addScore(t,n,i)},e.handleUseItem=function(){var t=o((function*(t){switch(e.stateManager.playing(),t!==tt.HINT&&e.handleHideHint(),e.itemManager.setQuantity(t,e.itemManager.getQuantity(t)-1),t){case tt.HINT:$m(e.board,e.pathDraw),e.node.scene.emit(Es.REFRESH_ITEMS);break;case tt.PLIERS:Wm(e.board,e.effectManager),e.node.scene.emit(Es.REFRESH_ITEMS);break;case tt.STORM:e.node.scene.emit(Es.HIDE_UI),e.node.scene.emit(Es.PAUSE_TIME),yield rb(e.board,e.effectManager),e.node.scene.emit(Es.RESUME_TIME),e.node.scene.emit(Es.SHOW_UI);break;case tt.THUNDER:e.node.scene.emit(Es.HIDE_UI),e.node.scene.emit(Es.PAUSE_TIME),yield Zm(e.board,e.effectManager),e.board.getUncleared().length>0&&(e.node.scene.emit(Es.RESUME_TIME),e.node.scene.emit(Es.SHOW_UI))}}));return function(e){return t.apply(this,arguments)}}(),e.handleAutoPlay=function(){e.isAutoPlayEnabled?e.disableAutoPlay():e.enableAutoPlay()},e.enableAutoPlay=function(){e.isAutoPlayEnabled=!0,e.schedule(e.autoPlay,.5)},e.disableAutoPlay=function(){e.isAutoPlayEnabled=!1,e.unschedule(e.autoPlay)},e.autoPlay=function(){if(e.stateManager.isReady()||e.stateManager.isPlaying()){var t=e.board.getHintPath();if(!t)throw new Error("No path found");var n=t[0],i=t.slice(-1)[0];if(void 0!==n&&void 0!==i){var a=n.a,o=i.b,r=e.board.getTileAt(a.x,a.y),l=e.board.getTileAt(o.x,o.y);if(!r||!l)throw new Error("Tile is null");r.onClick(),l.onClick()}else{var s=new Error("No path found");if(rU.isDebugger())throw s;null==Qz||Qz.sendException(s)}}},e.handleAddStars=function(t){var n=jz.getGameData();if(!n)return Promise.resolve([]);jz.setGameData({stars:n.stars+1});var i=t.startAnimationAt;i&&e.effectManager.playStarEffectAt(i)},e.handleChallengeFriends=o((function*(){try{var t,n,i;rt.showLoadingScreen();var a=e.board.generateFenFromCurrentLevel(),o=(null!==(t=jz.getGameData())&&void 0!==t?t:{}).level,r=void 0===o?1:o;r=Math.max(1,r);var l=null!==(n=null===(i=e.gameData)||void 0===i?void 0:i.levelData)&&void 0!==n?n:{},s=l.mode,u=void 0===s?"":s,c=l.rules,d=void 0===c?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:c,h=l.time,p=void 0===h?0:h;yield null==Xz?void 0:Xz.context.choose.processAsync({playerId:jz.getPlayerId(),fallbackSingleMode:!1,extraData:{challengeData:{level:r,fen:a,gravity:u,rules:d,time:p}}}),Xy.getMatchMode()===sU.TOURNAMENT&&(yield e.tryInitTournamentMode()),rt.closeLoadingScreen(),e.node.scene.emit(Es.UPDATE_MUSIC),e.node.scene.emit(Es.GAME_RESUME),e.node.scene.emit(Es.GAME_REPLAY,{level:r})}catch(t){var y=t instanceof Error?t:new Error("Unable to invite friends");null==Qz||Qz.sendException(y),rt.closeLoadingScreen(),rt.showNotificationScreenWithLocalizedKey("error.tryLater"),e.node.scene.emit(Es.GAME_RESUME),e.node.scene.emit(Es.SHOW_UI)}})),e.handleAddItem=function(){var t=o((function*(t){var n=t.animate,i=t.item,a=t.quantity,o=oU.search(e.uiManager.items,(function(e){return e.itemType===i}));if(void 0!==o){var r=e.itemManager.getQuantity(i)+a;if(e.itemManager.saveQuantity(i,r),e.uiManager.setInteractableItems(!1),n){var l=n.startWorldPosition;yield e.effectManager.playItemAddAnimation(l.x,l.y,o)}e.itemManager.setQuantity(i,r,!0),e.uiManager.setInteractableItems(!0)}else console.warn("Item ".concat(i," not found"))}));return function(e){return t.apply(this,arguments)}}(),e}return e(p,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){Fy.init()}},{key:"onDestroy",value:function(){this.unlistenCoreEvents()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initCoinManager(),this.initComboManager(),this.initClockManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager(),this.initPathDraw()}},{key:"initUIManager",value:function(){var e;this.uiManager=null===(e=this.node.parent)||void 0===e?void 0:e.getComponentInChildren(Wz),this.uiManager.init(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(zv)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(pD)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(tv)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(tI)}},{key:"initItemManager",value:function(){this.itemManager=this.getComponent(D_),this.itemManager.init(this)}},{key:"initCoinManager",value:function(){this.coinManager=this.getComponent(wS)}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(MS),this.comboManager.init()}},{key:"initClockManager",value:function(){this.clockManager=this.getComponent(Ew),this.clockManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(B_),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){lU.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(T_),this.guidelinesManager.init(this))}},{key:"initPathDraw",value:function(){this.pathDraw.init(this.board)}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){Yz.on(nU.OPENING_SCREEN,this.handleOpenScreen),Yz.on(nU.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"unlistenCoreEvents",value:function(){Yz.off(nU.OPENING_SCREEN,this.handleOpenScreen),Yz.off(nU.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(Es.SHOW_UI,this.handleShowUI),this.node.scene.on(Es.HIDE_UI,this.handleHideUI),this.node.scene.on(Es.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(Es.GAME_RESUME,this.handleResumeGame),this.node.scene.on(Es.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(Es.GAME_FINISH,this.handleFinishGame),this.node.scene.on(Es.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(Es.START_OVER,this.handleStartOver),this.node.scene.on(Es.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(Es.GAME_EXIT,this.handleExitGame),this.node.scene.on(Es.TILE_CLICK,this.handleTileClick),this.node.scene.on(Es.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(Es.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(Es.GRID_ORIENTATION_CHANGE,this.handleGridOrientationChange),this.node.scene.on(Es.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(Es.RESUME_TIME,this.handleResumeTime),this.node.scene.on(Es.TIME_OUT,this.handleClockTimeout),this.node.scene.on(Es.HALF_TIME,this.handleHalfTime),this.node.scene.on(Es.RESCUE_START,this.handleStartRescue),this.node.scene.on(Es.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(Es.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(Es.SHOW_HINT,this.handleShowHint),this.node.scene.on(Es.ADD_SCORE,this.handleAddScore),this.node.scene.on(Es.GRID_CLEAR,this.handleGridClear),this.node.scene.on(Es.USE_ITEM,this.handleUseItem),this.node.scene.on(Es.ADD_ITEM,this.handleAddItem),this.node.scene.on(Es.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(Es.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(Es.CHALLENGE_FRIENDS,this.handleChallengeFriends)}},{key:"start",value:(d=o((function*(){this.initDataFirstTime(),yield this.tryInitTournamentMode(),this.initGame()})),function(){return d.apply(this,arguments)})},{key:"initDataFirstTime",value:function(){this.initData();var e,t,n=this.getSceneData(),i=(null!=n?n:{}).isFromLoader,a=void 0!==i&&i,o=(null!=n?n:{}).level;void 0===o&&(o=Xy.getMatchMode()===sU.TOURNAMENT?1:null!==(e=null===(t=jz.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:0);this.setGameData({level:o,isFromLoader:a})}},{key:"initData",value:function(){var e,t=this.getSceneData(),n=(null!=t?t:{}).isFromLoader,i=void 0!==n&&n,a=null!==(e=jz.getGameData())&&void 0!==e?e:{},o=a.level,r=void 0===o?1:o,l=a.items;0===r&&i&&l?(l.hint=2,l.thunder=1,l.storm=1,l.pliers=0,jz.setGameData({items:l,coins:500,lastRewardedItems:Date.now()}),this.node.scene.emit(Es.ADD_COINS,{coins:500,playSound:!1})):l&&this.checkItemsRewardable()&&(l.hint<5&&(l.hint+=1),l.thunder<5&&(l.thunder+=1),l.storm<5&&(l.storm+=1),l.pliers<5&&(l.pliers+=1),jz.setGameData({items:l,lastRewardedItems:Date.now()})),this.setGameData(s(s({},pU),{},{level:r}))}},{key:"checkItemsRewardable",value:function(){var e,t=(null!==(e=jz.getGameData())&&void 0!==e?e:{}).lastRewardedItems,n=void 0===t?0:t;return!aU.isToday(n)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"tryInitTournamentMode",value:(c=o((function*(){var e,t;if(Xy.getMatchMode()===sU.TOURNAMENT){this.tournamentManager=this.getComponent(RD),yield this.tournamentManager.init();var n=this.tournamentManager,i=n.leaderboardData,a=n.leaderboardName,o=n.tournamentData;if(o){var r=o.payload.themeId;if(this.setGameData({themeId:r}),i&&a){var l=jz.getPlayerId(),s=i.leaders[l];if(!s&&eU){var u=yield eU.getLeadersByPlayerIdsAsync(a,[l]);if(0===u.length)return;s=u[0]}Jz.setStorageData("tournament","previousScore",null!==(e=null===(t=s)||void 0===t?void 0:t.score)&&void 0!==e?e:0)}}}})),function(){return c.apply(this,arguments)})},{key:"setGameData",value:function(e){var t,n,i,a=null!==(t=null!==(n=e.level)&&void 0!==n?n:null===(i=this.gameData)||void 0===i?void 0:i.level)&&void 0!==t?t:1;this.gameData=s(s(s({},this.gameData),e),{},{level:a})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return ct.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var e,t=null!==(e=this.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?0:n,a=t.nextLevelCount;i<2||(void 0===a?0:a)<2||GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("checkAndCreateShortcutAsync",e)}))}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.isGameSDK("CrazyGames")}}]),p}(T)).prototype,"board",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xz=a(Bz.prototype,"opacityToggler",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zz=a(Bz.prototype,"pathDraw",[Mz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nz=Bz));S._RF.pop(),S._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var yU=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e[e.DAILY_REWARDS=2]="DAILY_REWARDS",e}(yU||{});M(yU),S._RF.pop(),S._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var vU,fU=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.WEEKLY_TAB_SELECTED="weekly-tab-selected",e.OVERLAY_SHOW_STARTED="overlay-show-started",e.OVERLAY_SHOW_COMPLETED="overlay-show-completed",e}(fU||{}),gU="#AE4212",mU="#3D5172",bU="#92200C",wU="#8F5542",SU="#8A4733",kU="#3e7110",CU="#3e7110";S._RF.pop(),S._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),S._RF.pop(),S._RF.push({},"2737dY5lxxEY6mKDXeUQJUc","ThemeLocaleKeys",void 0);var EU,AU=(m(vU={},pt.SUMMER,"theme.summer"),m(vU,pt.AUTUMN,"theme.autumn"),m(vU,pt.WINTER,"theme.winter"),m(vU,pt.SPRING_FESTIVAL,"theme.springFestival"),m(vU,pt.TREE_PLANTING_FESTIVAL,"theme.treePlantingFestival"),m(vU,pt.BLUE_SEA_FESTIVAL,"theme.blueSeaFestival"),m(vU,pt.MUSIC_FESTIVAL,"theme.musicFestival"),m(vU,pt.HARVEST_FESTIVAL,"theme.harvestFestival"),m(vU,pt.FOOD_FESTIVAL,"theme.foodFestival"),m(vU,pt.SNOW_FESTIVAL,"theme.snowFestival"),m(vU,pt.LIGHT_FESTIVAL,"theme.lightFestival"),m(vU,pt.PEACE_FESTIVAL,"theme.peaceFestival"),m(vU,pt.FLOWER_FESTIVAL,"theme.flowerFestival"),m(vU,pt.STREET_FESTIVAL,"theme.streetFestival"),m(vU,pt.COLOR_GARDEN,"theme.colorGarden"),m(vU,pt.COLOR_FESTIVAL,"theme.colorFestival"),m(vU,pt.NATURE_SUMMER,"theme.natureSummer"),m(vU,pt.SNOW_MOUNTAIN,"theme.snowMountain"),m(vU,pt.ICE_FESTIVAL,"theme.iceFestival"),m(vU,pt.GREEN_GRASS_FESTIVAL,"theme.greenGrassFestival"),m(vU,pt.COMMUNITY_FESTIVAL,"theme.communityFestival"),m(vU,pt.WATER_FESTIVAL,"theme.waterFestival"),m(vU,pt.ANIMAL_FESTIVAL,"theme.animalFestival"),m(vU,pt.LOST_FESTIVAL,"theme.lostFestival"),m(vU,pt.HALLOWEEN_FESTIVAL,"theme.halloweenFestival"),m(vU,pt.SNOW_MUSIC_FESTIVAL,"theme.snowMusicFestival"),m(vU,pt.CHRISTMAS,"theme.christmas"),m(vU,pt.SPRING_FLOWER_FESTIVAL,"theme.springFlowerFestival"),m(vU,pt.TET_HOLIDAY,"theme.tetHoliday"),m(vU,pt.SEA_FESTIVAL,"theme.seaFestival"),m(vU,pt.FIREWORK_FESTIVAL,"theme.fireworkFestival"),m(vU,pt.HALLOWEEN_HORROR,"theme.halloweenHorror"),m(vU,pt.MID_AUTUMN,"theme.midAutumn"),m(vU,pt.CHRISTMAS_SWEET,"theme.christmasSweet"),m(vU,pt.NEW_YEAR_COUNTDOWN,"theme.newYearCountdown"),m(vU,pt.HAPPY_NEW_YEAR,"theme.happyNewYear"),vU);S._RF.pop(),S._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),S._RF.pop(),S._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),S._RF.pop(),S._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var TU;(0,C.ccclass)("HintItem")(EU=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"itemType",get:function(){return tt.HINT}}]),r}(TM));S._RF.pop(),S._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var PU;(0,C.ccclass)("PliersItem")(TU=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"itemType",get:function(){return tt.PLIERS}}]),r}(TM));S._RF.pop(),S._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var OU;(0,C.ccclass)("StormItem")(PU=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"itemType",get:function(){return tt.STORM}}]),r}(TM));S._RF.pop(),S._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var LU,IU,RU,_U,DU,MU,NU;(0,C.ccclass)("ThunderItem")(OU=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"itemType",get:function(){return tt.THUNDER}}]),r}(TM));S._RF.pop(),S._RF.push({},"28c5eNXZLBE+50Dno043fmy","useTornadoThunderCombined",void 0),S._RF.pop(),S._RF.push({},"eb6c23usqxHPaoJcvF0LbY6","separatePositions",void 0),S._RF.pop(),S._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),S._RF.pop(),S._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),S._RF.pop(),S._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),S._RF.pop(),S._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),S._RF.pop(),S._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var BU,FU=C.ccclass,xU=C.property;LU=FU("RendererModule"),IU=xU(xe),RU=xU(ue),LU((MU=a((DU=e((function e(){t(this,e),r(this,"material",MU,this),r(this,"spriteFrame",NU,this)}))).prototype,"material",[IU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NU=a(DU.prototype,"spriteFrame",[RU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_U=DU));S._RF.pop(),S._RF.push({},"c20acgKcuRFP6+Am/XjOFeP","ParticleSystem2DExtra",void 0);var zU,UU=C.ccclass,GU=C.disallowMultiple,HU=C.executeInEditMode,qU=C.requireComponent,VU=UU("ParticleSystem2DExtra")(BU=HU(!0)(BU=GU(!0)(BU=qU(ee)(BU=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i))).emitParticle=function(t){return function(n){t(n);var i=e.particleSystem._simulator.particles.length,a=e.particleSystem._simulator.particles[i-1];e.initParticle(a)}},e.step=function(t){return function(n){for(var i=e.particleSystem._simulator.particles,a=0;a<i.length;a++){var o=i[a];e.updateParticle(o,n)}t(n)}},e}return e(r,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(ee),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var e=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(e);var t=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(t)}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}}]),r}(T))||BU)||BU)||BU)||BU;S._RF.pop(),S._RF.push({},"664feJL84ZOTaM99dgWY4x0","ExampleParticleSystem2DExtra",void 0);var $U;(0,C.ccclass)("ExampleParticleSystem2DExtra")(zU=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"initParticle",value:function(e){e.maxSize=te.randomRange(.25,1)*e.size,e.size=0,e.deltaSize=0,e.cycleDuration=te.randomRange(.4,.6),e.life=e.timeToLive,this.setInitPosition(e.pos)}},{key:"updateParticle",value:function(e,t){this.updateScale(e)}},{key:"setInitPosition",value:function(e){var t=e.x,n=e.y;return e.x=t+te.randomRange(-350,350),e.y=n+te.randomRange(-350,350),e}},{key:"updateScale",value:function(e){var t=1-(e.life-e.timeToLive)%e.cycleDuration/e.cycleDuration;e.size=e.maxSize*Math.sin(t*Math.PI)}}]),r}(VU));S._RF.pop(),S._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var WU,KU,jU,YU,XU,JU,ZU,QU,eG,tG,nG,iG=C.ccclass,aG=C.disallowMultiple,oG=Ludex,rG=oG.Events,lG=oG.Utils.Valid,sG=oG.Configs.Core.StartSDKAfterLoadGame,uG=codex,cG=uG.ads,dG=uG.player,hG=uG.event,pG=uG.context;iG("BootScene")($U=aG($U=function(a){n(p,a);var r,l,c,d,h=i(p);function p(){var e;t(this,p);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=h.call.apply(h,[this].concat(i))).setupLoadingFullScreen=function(){sG?(rt.addShowedScene(yt.BOOT_SCENE),dG.isFirstSession()?rt.addShowedScene(yt.GAME_SCENE):rt.addShowedScene(yt.DASHBOARD_SCENE)):rt.showLoadingFullScreen(yt.BOOT_SCENE)},e.processWhenGameSdkStarted=function(){e.setupGameData(),e.sendMsGamesDailyNotification()},e.loadBundles=o((function*(){return Promise.all([qe.loadBundle("loadable"),qe.loadBundle("animations")])})),e.loadWasmModules=o((function*(){if("SOLO"!==pG.getContextType()||dG.isFirstSession())return Promise.all([vt.loadModuleAsync("spine")])})),e.lazyLoadWasmModules=o((function*(){yield Promise.all([vt.loadModuleAsync("spine")])})),e.handlePauseAudio=function(){hG.on(rG.VISIBILITY_HIDDEN,e.handleMuteAudio),hG.on(rG.VISIBILITY_VISIBLE,e.handleUnMuteAudio)},e.handleMuteAudio=function(){je.muteAudio(!0)},e.handleUnMuteAudio=function(){null!=cG&&cG.isAdFullSizeShowing()||je.muteAudio(!1)},e}return e(p,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.preloadAssets(),this.listenEvents()}},{key:"preloadAssets",value:(d=o((function*(){try{D.pause(),yield Promise.all([this.loadWasmModules(),this.loadBundles(),this.loadCurrentPlayerTheme(),this.loadGuideSkin()])}catch(e){console.warn("processPreloadAssets",e)}finally{null!=cG&&cG.isAdFullSizeShowing()||D.resume()}})),function(){return d.apply(this,arguments)})},{key:"onLoad",value:function(){this.handlePauseAudio(),this.overrideGameSDK(),this.setupLoadingFullScreen()}},{key:"start",value:(c=o((function*(){yield GameSDK.extra.waitSDKInitiatedAsync(),this.processCrazyGamesLoadingStop(),this.disableBannerAdsOnStartingLevels()})),function(){return c.apply(this,arguments)})},{key:"listenEvents",value:function(){hG.catchUp(rG.GAME_READY,this.lazyLoadWasmModules),hG.catchUp(rG.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"overrideGameSDK",value:function(){if("FBInstant"in window&&"shareAsync"in FBInstant){var e=FBInstant.shareAsync;FBInstant.shareAsync=function(){var t=o((function*(t){var n=s({},t);return e(n)}));return function(e){return t.apply(this,arguments)}}()}}},{key:"setupGameData",value:function(){var e=dG.getGameData();if(e){var t=e.totalLevel,n=Math.max(t,it),i=s(s({},e),{},{totalLevel:n});dG.setGameData(i)}}},{key:"disableBannerAdsOnStartingLevels",value:function(){var e=dG.getGameData();if(e){var t=e.level,n=void 0!==t&&t>dt.NUM_LEVEL_WITHOUT_BANNER_ADS;ut.setAvoidBannerShowed(!n)}}},{key:"loadCurrentPlayerTheme",value:(l=o((function*(){var e=Iy.mapOrder,t=e[0];if(lG.isObject(t)){var n=dG.getGameData(),i=null==n?void 0:n.level;if(!lG.isNumber(i))return qe.loadThemeAsync(t.theme);var a,o=u(e);try{for(o.s();!(a=o.n()).done;){var r=a.value;if((i-=r.levelCount)<=0){t=r;break}}}catch(e){o.e(e)}finally{o.f()}return qe.loadThemeAsync(t.theme)}})),function(){return l.apply(this,arguments)})},{key:"loadGuideSkin",value:(r=o((function*(){if(dG.isFirstSession())return Fy.loadLevelSpriteFrames(0)})),function(){return r.apply(this,arguments)})},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}},{key:"sendMsGamesDailyNotification",value:function(){var e=GameSDK.extra;"sendDailyNotificationAsync"in e&&e.sendDailyNotificationAsync().catch((function(e){console.warn("sendMsGamesDailyNotification",e)}))}}]),p}(T))||$U);S._RF.pop(),S._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var yG,vG,fG,gG,mG,bG,wG,SG,kG,CG,EG,AG,TG=C.ccclass,PG=C.property;WU=TG("RigidBodyObject"),KU=PG(L),jU=PG(ae),YU=PG(L),XU=PG(W),WU((QU=a((ZU=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"gravityScale",QU,l(e)),r(e,"linearVelocity",eG,l(e)),r(e,"bounce",tG,l(e)),r(e,"simulate",nG,l(e)),e}return e(s,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(ze).getComponent(P),this.uiTransform=this.node.getComponent(P)}},{key:"update",value:function(e){if(this.simulate){this.applyGravity();var t=this.node.worldPosition.clone();t.add(new V(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}}},{key:"applyForce",value:function(e){this.linearVelocity.add(e)}},{key:"applyGravity",value:function(){var e=new ae(0,-9.8*this.gravityScale);this.applyForce(e)}},{key:"applyBounce",value:function(e){var t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);var n=this.canvas.width;return t.xMax>n&&(e.x=n-t.width/2,this.linearVelocity.x*=-1),e}}]),s}(T)).prototype,"gravityScale",[KU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),eG=a(ZU.prototype,"linearVelocity",[jU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ae(0,0)}}),tG=a(ZU.prototype,"bounce",[YU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nG=a(ZU.prototype,"simulate",[XU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JU=ZU));S._RF.pop(),S._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var OG,LG,IG,RG,_G,DG,MG,NG,BG,FG=C.ccclass,xG=C.property,zG=C.disallowMultiple,UG=function(){},GG=(yG=FG("AnimSkipOverlay"),vG=xG(B),fG=xG(B),gG=xG(G),mG=Ni.onlyRunInLifeCycleAsync,bG=Ni.onlyRunInLifeCycleAsync,wG=Ni.onlyRunInLifeCycleAsync,yG(SG=zG((CG=a((kG=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"containerUIOpacity",CG,l(e)),r(e,"maskUIOpacity",EG,l(e)),r(e,"skipButton",AG,l(e)),e.isOpened=!1,e.currentCallback=UG,e}return e(d,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"open",value:(u=o((function*(e){this.containerUIOpacity.node.active=!0;var t=e.onSkip,n=e.opacity,i=void 0===n?255:n,a=e.transitionDuration,o=void 0===a?.2:a;this.maskUIOpacity.opacity=i,yield this.animateUIOpacity(0,255,o),this.currentCallback=t,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit($e.OPENED_SKIP_OVERLAY,e)})),function(e){return u.apply(this,arguments)})},{key:"close",value:(s=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.skipButton.interactable=!1,this.currentCallback=UG,yield this.animateUIOpacity(255,0,e),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit($e.CLOSED_SKIP_OVERLAY)})),function(){return s.apply(this,arguments)})},{key:"animateUIOpacity",value:function(e,t,n){return this.containerUIOpacity.opacity=e,Ve.runTweenAsync(R(this.containerUIOpacity).to(n,{opacity:t}))}},{key:"untilClosed",value:function(){var e=this;return!1===this.isOpened?Promise.resolve():new Promise((function(t){e.node.scene.once($e.CLOSED_SKIP_OVERLAY,t)}))}}]),d}(T)).prototype,"containerUIOpacity",[vG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EG=a(kG.prototype,"maskUIOpacity",[fG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AG=a(kG.prototype,"skipButton",[gG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(kG.prototype,"open",[mG],Object.getOwnPropertyDescriptor(kG.prototype,"open"),kG.prototype),a(kG.prototype,"close",[bG],Object.getOwnPropertyDescriptor(kG.prototype,"close"),kG.prototype),a(kG.prototype,"untilClosed",[wG],Object.getOwnPropertyDescriptor(kG.prototype,"untilClosed"),kG.prototype),SG=kG))||SG)||SG);S._RF.pop(),S._RF.push({},"95ba56f1qVFfLLdPv++OfLw","SmoothScrollView",void 0);var HG,qG=C.ccclass,VG=C.property,$G=(OG=qG("SmoothScrollView"),LG=VG({type:W,group:"Mouse Scroll"}),IG=VG({type:L,group:"Mouse Scroll",visible:function(){return this.mouseScroll}}),RG=VG({type:L,group:"Mouse Scroll",visible:function(){return this.mouseScroll}}),OG((MG=a((DG=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"mouseScroll",MG,l(e)),r(e,"mouseScrollSpeed",NG,l(e)),r(e,"mouseScrollDuration",BG,l(e)),e}return e(s,[{key:"_onMouseWheel",value:function(e,t){if(this.mouseScroll){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,t)){var n=new V,i=e.getScrollY()<0?1:-1;this.vertical?n.set(0,i*this.mouseScrollSpeed,0):this.horizontal&&n.set(i*this.mouseScrollSpeed,0,0),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._startAutoScroll(n,this.mouseScrollDuration,!0),this._stopPropagationIfTargetIsMe(e)}}else c(d(s.prototype),"_onMouseWheel",this).call(this,e,t)}}]),s}(Ue)).prototype,"mouseScroll",[LG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NG=a(DG.prototype,"mouseScrollSpeed",[IG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),BG=a(DG.prototype,"mouseScrollDuration",[RG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),_G=DG))||_G);S._RF.pop(),S._RF.push({},"904917NfYBJy781QxKjEPIO","ViewNode",void 0);var WG,KG,jG,YG,XG,JG,ZG,QG,eH,tH,nH,iH,aH,oH,rH,lH,sH,uH,cH,dH,hH,pH,yH,vH,fH,gH,mH,bH,wH,SH=C.ccclass,kH=C.requireComponent,CH=SH("ViewNode")(HG=kH(B)(HG=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i))).order=0,e}return e(r,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(B),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"setVisible",value:function(e){this.uiOpacity.opacity=e?255:0}},{key:"isVisible",value:function(){return this.uiOpacity.opacity>0}}]),r}(T))||HG)||HG;S._RF.pop(),S._RF.push({},"0b250nSw/RHRq8vKigzgfhs","ScrollViewLayout",void 0);var EH=C.ccclass,AH=C.property,TH=C.requireComponent,PH=Ludex.Utils,OH=PH.Array,LH=PH.Signal,IH=(WG=EH("ScrollViewLayout"),KG=TH($G),jG=Ni.required,YG=AH(P),XG=AH(L),JG=AH(fe),ZG=AH(O),QG=Ni.required,eH=AH(O),tH=Ni.required,nH=Ni.required,iH=Ni.required,aH=Ni.onlyRunInLifeCycleAsync,oH=Ni.onlyRunInLifeCycleAsync,rH=Ni.onlyRunInLifeCycleAsync,lH=Ni.onlyRunInLifeCycle,sH=Ni.onlyRunInLifeCycle,uH=Ni.onlyRunInLifeCycle,cH=Ni.onlyRunInLifeCycle,WG(dH=KG((pH=a((hH=function(a){n(y,a);var s,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"viewport",pH,l(e)),r(e,"spacing",yH,l(e)),r(e,"nodePrefab",vH,l(e)),r(e,"maxNodeCount",fH,l(e)),r(e,"extendCount",gH,l(e)),r(e,"scrollView",mH,l(e)),r(e,"uiTransform",bH,l(e)),r(e,"contentUiTransform",wH,l(e)),e.nodePool=[],e.nodeHeight=0,e.scrollSignalController=new LH.SignalController,e.onNodeVisible=function(){},e.onNodeInvisible=function(){},e}return e(y,[{key:"__preload",value:function(){var e;this.scrollView=this.getComponent($G),this.uiTransform=this.getComponent(P),this.contentUiTransform=null===(e=this.scrollView.content)||void 0===e?void 0:e.getComponent(P)}},{key:"onDestroy",value:function(){D.off($e.VIEW_RESIZED,this.handleViewResized,this)}},{key:"start",value:function(){var e=ye(this.nodePrefab);this.nodeHeight=e.getComponent(P).height,e.destroy(),Ni.validateRequiredProperties(this,y)}},{key:"init",value:function(e,t){this.createNodePool(),this.onNodeVisible=null!=e?e:this.onNodeVisible,this.onNodeInvisible=null!=t?t:this.onNodeInvisible;for(var n=0;n<this.nodePool.length;n++){var i;null===(i=this.nodePool[n])||void 0===i||i.setVisible(!1)}this.updateVisibility()}},{key:"updateNodeVisibility",value:function(){for(var e=0;e<this.nodePool.length;e++){var t=this.nodePool[e];t&&(t.isVisible()?this.onNodeVisible(t):this.onNodeInvisible(t))}}},{key:"listenEvents",value:function(){this.scrollView.node.on(Ue.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.on(Ge.TOUCH_MOVE,this.abortScrollSignal,this),this.scrollView.node.on(Ge.MOUSE_WHEEL,this.abortScrollSignal,this),D.on($e.VIEW_RESIZED,this.handleViewResized,this)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(Ue.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.off(Ge.TOUCH_MOVE,this.abortScrollSignal,this),this.scrollView.node.off(Ge.MOUSE_WHEEL,this.abortScrollSignal,this),D.off($e.VIEW_RESIZED,this.handleViewResized,this)}},{key:"scrollToOrder",value:(h=o((function*(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=this.getNodeScrollOffset(e),a=this.scrollView.getScrollOffset().y,o=(i=Math.max(i,0))-(a=Math.max(a,0));Math.abs(o)<5||(yield this.scrollToOffset(new ae(0,i),n,t))})),function(e,t){return h.apply(this,arguments)})},{key:"scrollToTop",value:(d=o((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;yield this.scrollToOffset(new ae(0,0),t,e)})),function(e){return d.apply(this,arguments)})},{key:"scrollToOffset",value:(c=o((function*(e,t,n){var i=this,a=this.scrollSignalController.renew();this.scrollView.scrollToOffset(e,t);var o=function(){return i.handleScrollSignalAborted()},r=function(){a.aborted||i.handleExternalSignalAborted(e)};a.once(o),n.addAbortListener(r),yield Ve.waitTweenAsync(t,n),a.off(o),n.removeAbortListener(r)})),function(e,t,n){return c.apply(this,arguments)})},{key:"updateVisibility",value:function(){for(var e=this.viewport.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin,i=0;i<this.maxNodeCount;i++){var a=this.getNodeBoundingBoxWorld(i),o=a.top,r=a.bot;if(o<n||r>t){var l=this.getNodeByOrder(i);l&&(this.onNodeInvisible(l),l.setVisible(!1))}else{var s=this.getNodeByOrder(i);if(s)s.isVisible()||(s.order=i,this.onNodeVisible(s),s.setVisible(!0));else{var u=this.getInvisibleNode();u&&(u.node.setPosition(this.getNodePosition(i)),u.order=i,this.onNodeVisible(u),u.setVisible(!0))}}}}},{key:"updateLayout",value:function(){var e,t=this.getVisibleNodes(),n=u(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.node.setPosition(this.getNodePosition(i.order))}}catch(e){n.e(e)}finally{n.f()}}},{key:"setMaxNodeCount",value:function(e){this.maxNodeCount=e,this.contentUiTransform.height=(this.nodeHeight+this.spacing)*this.maxNodeCount}},{key:"getAllNodes",value:function(){return this.nodePool}},{key:"getVisibleNodes",value:function(){return this.nodePool.filter((function(e){return e.isVisible()}))}},{key:"getNodePosition",value:function(e){return new V(0,-(this.nodeHeight+this.spacing)*e-this.nodeHeight/2,0)}},{key:"getNodeScrollOffset",value:function(e){return-this.getNodePosition(e).y-this.uiTransform.node.worldPosition.y-this.uiTransform.height/2+this.viewport.node.worldPosition.y}},{key:"getNodeByOrder",value:function(e){return OH.search(this.nodePool,(function(t){return t.order===e}))}},{key:"getInvisibleNode",value:function(){return OH.search(this.nodePool,(function(e){return!e.isVisible()}))}},{key:"createNodePool",value:function(){var e=Math.ceil(this.viewport.height/this.nodeHeight)+1+this.extendCount;if(!(this.nodePool.length>=e)){var t=e-this.nodePool.length;this.setMaxNodeCount(this.maxNodeCount);for(var n=0;n<t;n++){var i,a=ye(this.nodePrefab);null===(i=this.scrollView.content)||void 0===i||i.addChild(a),a.setPosition(this.getNodePosition(this.nodePool.length));var o=a.addComponent(CH);o.order=this.nodePool.length,o.setVisible(!1),this.nodePool.push(o)}}}},{key:"getNodeBoundingBoxWorld",value:function(e){var t,n,i=this.getNodePosition(e).y+(null!==(t=null===(n=this.scrollView.content)||void 0===n?void 0:n.worldPosition.y)&&void 0!==t?t:0);return{top:i+this.nodeHeight/2,bot:i-this.nodeHeight/2}}},{key:"abortScrollSignal",value:function(){this.scrollSignalController.abort()}},{key:"handleScrollSignalAborted",value:function(){this.scrollView.stopAutoScroll(),this.updateVisibility()}},{key:"handleExternalSignalAborted",value:function(e){this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(e,0),this.updateVisibility()}},{key:"handleViewResized",value:(s=o((function*(){yield Ve.waitTweenAsync(0),this.createNodePool(),this.updateVisibility()})),function(){return s.apply(this,arguments)})}]),y}(T)).prototype,"viewport",[jG,YG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yH=a(hH.prototype,"spacing",[XG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vH=a(hH.prototype,"nodePrefab",[JG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fH=a(hH.prototype,"maxNodeCount",[ZG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gH=a(hH.prototype,"extendCount",[QG,eH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mH=a(hH.prototype,"scrollView",[tH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bH=a(hH.prototype,"uiTransform",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wH=a(hH.prototype,"contentUiTransform",[iH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(hH.prototype,"scrollToOrder",[aH],Object.getOwnPropertyDescriptor(hH.prototype,"scrollToOrder"),hH.prototype),a(hH.prototype,"scrollToTop",[oH],Object.getOwnPropertyDescriptor(hH.prototype,"scrollToTop"),hH.prototype),a(hH.prototype,"scrollToOffset",[rH],Object.getOwnPropertyDescriptor(hH.prototype,"scrollToOffset"),hH.prototype),a(hH.prototype,"updateVisibility",[lH],Object.getOwnPropertyDescriptor(hH.prototype,"updateVisibility"),hH.prototype),a(hH.prototype,"createNodePool",[sH],Object.getOwnPropertyDescriptor(hH.prototype,"createNodePool"),hH.prototype),a(hH.prototype,"handleScrollSignalAborted",[uH],Object.getOwnPropertyDescriptor(hH.prototype,"handleScrollSignalAborted"),hH.prototype),a(hH.prototype,"handleExternalSignalAborted",[cH],Object.getOwnPropertyDescriptor(hH.prototype,"handleExternalSignalAborted"),hH.prototype),dH=hH))||dH)||dH);S._RF.pop(),S._RF.push({},"a3bd3opU7JJh4TqZ3uorJHi","DailyRewardsUtils",void 0);var RH,_H,DH,MH,NH,BH,FH,xH,zH,UH,GH,HH,qH,VH,$H,WH,KH,jH=codex,YH=jH.player,XH=jH.storage,JH=jH.dailyRewards,ZH=Ludex,QH=ZH.Utils.Array,eq=ZH.Configs.DailyRewards,tq=eq.MockTime,nq=eq.MaxDays,iq=eq.CheckInterrupt,aq=tq>0?tq:864e5,oq=function(){function n(){t(this,n)}var i,a,r,l,u,c;return e(n,null,[{key:"setDirty",value:function(){this.lastUpdate=0}},{key:"logLoginReward",value:function(){JH.logLoginReward(),this.setDirty(),this.tryUpdateData()}},{key:"tryUpdateData",value:(c=o((function*(){if(this.shouldUpdateData()){this.lastUpdate=Date.now(),yield JH.requestDailyRewardsAsync();var e=this.getCurrentRemainingTime();this.updateInterval=e/2}})),function(){return c.apply(this,arguments)})},{key:"hasClaimableRewards",value:(u=o((function*(){yield this.tryUpdateData();var e=JH.getDailyRewards();return null!==e&&void 0!==QH.search(Object.values(e),(function(e){return"ready"===e.status}))})),function(){return u.apply(this,arguments)})},{key:"hasShownPopup",value:function(){return XH.getStorage("dashboardDailyRewards").hasShownPopup}},{key:"getRewardsData",value:(l=o((function*(){yield this.tryUpdateData();var e=JH.getDailyRewards();if(null===e)return null;for(var t=[],n=0;n<nq;n++){var i=fy[n];if(i){var a=e[n+1];t.push(s(s({id:i.id,type:i.type,status:i.status},a),{},{value:i.value,items:i.items?s({},i.items):void 0}))}}return t})),function(){return l.apply(this,arguments)})},{key:"setHasShownPopup",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];XH.setStorageData("dashboardDailyRewards","hasShownPopup",e)}},{key:"openPopupScreen",value:(r=o((function*(){yield rt.openScreen(lt.DAILY_REWARDS_SCREEN)})),function(){return r.apply(this,arguments)})},{key:"openPopupScreenAndWaitForClose",value:(a=o((function*(){yield rt.openScreenAndWaitForClose(lt.DAILY_REWARDS_SCREEN)})),function(){return a.apply(this,arguments)})},{key:"getRemainingTime",value:(i=o((function*(){return yield this.tryUpdateData(),this.getCurrentRemainingTime()})),function(){return i.apply(this,arguments)})},{key:"getCurrentRemainingTime",value:function(){var e;if(null===JH.getDailyRewards())return 0;var t=null!==(e=YH.getPlayerData().dailyRewardedData)&&void 0!==e?e:{},n=t.firstReward,i=void 0===n?0:n,a=t.lastReward,o=void 0===a?0:a;if(iq){var r=this.findLastRewardedIndex();if(-1===r)return 0;var l=i+(r+1)*aq;return Math.max(l-Date.now(),0)}var s=o+aq;return Math.max(s-Date.now(),0)}},{key:"findLastRewardedIndex",value:function(){for(var e,t=(null!==(e=YH.getPlayerData().dailyRewardedData)&&void 0!==e?e:{}).logDays,n=void 0===t?[]:t,i=n.length-1;i>=0;i--)if(n[i])return i;return-1}},{key:"shouldUpdateData",value:function(){return Date.now()-this.lastUpdate>this.updateInterval}}]),n}();oq.lastUpdate=0,oq.updateInterval=0,S._RF.pop(),S._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var rq,lq,sq,uq,cq,dq,hq,pq,yq,vq,fq,gq=C.ccclass,mq=C.disallowMultiple,bq=C.property,wq=[50,160],Sq=(RH=gq("LockAnimator"),_H=bq(ee),DH=bq(ce),MH=bq(de),NH=bq(de),BH=bq(de),FH=bq(Sp),xH=bq({type:O,min:0}),RH(zH=mq((GH=a((UH=function(a){n(y,a);var s,u,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"floatingParticles",GH,l(e)),r(e,"iconAnimation",HH,l(e)),r(e,"lockClip",qH,l(e)),r(e,"unlockClip",VH,l(e)),r(e,"tryToUnlockClip",$H,l(e)),r(e,"trailTemplate",WH,l(e)),r(e,"trailCount",KH,l(e)),e.trails=[],e}return e(y,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(h=o((function*(e){var t=this;this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),this.scheduleOnce((function(){t.explodeTrails(e)}),1.1),yield this.playAnimation(this.unlockClip.name,e),this.floatingParticles.stopSystem()})),function(e){return h.apply(this,arguments)})},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:(d=o((function*(e){var t=this;yield Promise.all(this.trails.map((function(n){return t.getExplodeTrail(n,0,e)})))})),function(e){return d.apply(this,arguments)})},{key:"getExplodeTrail",value:(c=o((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=he(0,2*Math.PI),a=he(wq[0],wq[1])*Math.cos(i),o=he(wq[0],wq[1])*Math.sin(i),r=new V(a,o,e.node.position.z),l=e.node.scale.clone(),s=R(e.node).delay(t).call((function(){e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:r.clone()},{easing:"expoOut"}).to(.5,{scale:new V(0,0,1)},{easing:"expoIn"});yield Ve.runTweenAsync(s,n),e.node.setPosition(0,0),e.node.scale=l,e.reset(),e.node.active=!1})),function(e){return c.apply(this,arguments)})},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var e=0;e<this.trailCount;e++){var t=ye(this.trailTemplate.node);t.setParent(this.node),t.active=!1,this.trails.push(t.getComponent(Sp))}}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"playAnimation",value:(u=o((function*(e,t){var n=this;return null!=t&&t.aborted?Promise.resolve():new Promise((function(i){n.iconAnimation.once(ce.EventType.FINISHED,(function(){i()})),null==t||t.addAbortListener((function(){n.iconAnimation.off(ce.EventType.FINISHED),n.iconAnimation.stop(),i()})),n.iconAnimation.play(e)}))})),function(e,t){return u.apply(this,arguments)})},{key:"playTryToUnlockAnimation",value:(s=o((function*(){return this.playAnimation(this.tryToUnlockClip.name)})),function(){return s.apply(this,arguments)})}]),y}(T)).prototype,"floatingParticles",[_H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HH=a(UH.prototype,"iconAnimation",[DH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qH=a(UH.prototype,"lockClip",[MH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VH=a(UH.prototype,"unlockClip",[NH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$H=a(UH.prototype,"tryToUnlockClip",[BH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WH=a(UH.prototype,"trailTemplate",[FH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KH=a(UH.prototype,"trailCount",[xH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zH=UH))||zH)||zH);S._RF.pop(),S._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var kq,Cq,Eq,Aq,Tq,Pq,Oq,Lq,Iq,Rq,_q,Dq,Mq,Nq,Bq,Fq,xq,zq,Uq,Gq,Hq,qq,Vq,$q,Wq,Kq,jq,Yq,Xq,Jq,Zq,Qq,eV,tV,nV,iV,aV,oV,rV=C.ccclass,lV=C.property,sV=(rq=rV("ThemeProgressBar"),lq=lV(q),sq=lV(q),uq=lV(q),cq=lV(q),rq((pq=a((hq=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"progressBar",pq,l(e)),r(e,"progressText",yq,l(e)),r(e,"leftCap",vq,l(e)),r(e,"rightCap",fq,l(e)),e}return e(s,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var n=this.progressBar.getComponent(ie);if(!n)throw new Error("ThemeProgressBar: progressBarComponent not found");n.progress=e/t;var i=this.progressText.getComponent(K);if(!i)throw new Error("ThemeProgressBar: progressTextComponent not found");i.string="".concat(e,"/").concat(t)}}]),s}(T)).prototype,"progressBar",[lq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yq=a(hq.prototype,"progressText",[sq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vq=a(hq.prototype,"leftCap",[uq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fq=a(hq.prototype,"rightCap",[cq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dq=hq))||dq);S._RF.pop(),S._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var uV,cV,dV,hV,pV,yV,vV,fV,gV,mV,bV,wV,SV,kV=C.ccclass,CV=C.property,EV={progress:0,max:10,isLocked:!0,theme:pt.SUMMER,skins:[vv.FRUIT]},AV=Ludex.Utils.Array,TV=(kq=kV("ThemeBlock"),Cq=Ni.required,Eq=CV(q),Aq=Ni.required,Tq=CV(q),Pq=Ni.required,Oq=CV(Sq),Lq=Ni.required,Iq=CV({type:q,group:"Container"}),Rq=Ni.required,_q=CV({type:B,group:"Container"}),Dq=Ni.required,Mq=CV({type:q,group:"Theme"}),Nq=Ni.required,Bq=CV({type:F,group:"Theme"}),Fq=Ni.required,xq=CV({type:Kd,group:"Title"}),zq=Ni.required,Uq=CV({type:B,group:"Title"}),Gq=Ni.required,Hq=CV({type:F,group:"Tile"}),qq=Ni.required,Vq=CV({type:B,group:"Tile"}),$q=CV(W),Wq=Ni.onlyRunInLifeCycleAsync,kq((Yq=a((jq=function(a){n(y,a);var u,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"mask",Yq,l(e)),r(e,"progressBar",Xq,l(e)),r(e,"lockAnimator",Jq,l(e)),r(e,"container",Zq,l(e)),r(e,"containerOpacity",Qq,l(e)),r(e,"themeLoadingRing",eV,l(e)),r(e,"themeSprite",tV,l(e)),r(e,"titleLocalizer",nV,l(e)),r(e,"titleOpacity",iV,l(e)),r(e,"tileBlockIconSprite",aV,l(e)),r(e,"newTilesOpacity",oV,l(e)),e.signal=new In,e.payload=EV,e}return e(y,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(e){this.payload.isLocked=e,this.updateInfo()}},{key:"__preload",value:function(){this.maskUIOpacity=this.mask.getComponent(B),Ni.validateRequiredProperties(this,y)}},{key:"updateInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:EV;this.payload=e;var t=e.progress,n=e.max,i=e.isLocked,a=e.theme,o=e.skins;this.signal.abort();var r=new In;this.signal=r,this.updateTitle(a),this.updateSkinAsync(o,r),this.updateThemeAsync(a,r);var l=this.progressBar.getComponent(sV);if(!l)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=i,this.progressBar.active=!i,this.lockAnimator.node.active=i,i&&this.lockAnimator.lock(),this.maskUIOpacity.opacity=i?128:0,i||l.setProgress(t,n)}},{key:"playUnlockAnim",value:(h=o((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:EV;this.payload=s(s({},t),{},{isLocked:!1});var n=t.progress,i=t.max,a=this.progressBar.getComponent(sV);if(!a)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,a.setProgress(n,i),yield this.animateUnlockedState(e)})),function(e){return h.apply(this,arguments)})},{key:"updateTitle",value:function(e){var t=AU[e];this.titleLocalizer.key=t}},{key:"updateSkinAsync",value:(d=o((function*(e,t){var n=this.tileBlockIconSprite.length,i=e.length,a=e.map(function(){var e=o((function*(e){return yield qe.loadSkinPreviewAsync(e)}));return function(t){return e.apply(this,arguments)}}()),r=yield Promise.all(a);if(!t.aborted&&this.tileBlockIconSprite)if(i<=n){for(var l=Math.floor(n/i),s=n%i,u=g(AV.fillWith(i,(function(){return l}))),c=0;c<s;c++){var d=u[c];u[c]=d+1}for(var h=0,p=0;p<i;p++)for(var y=u[p],v=0;v<y&&h<n;v++,h++){var f=r[p][v];this.tileBlockIconSprite[h].spriteFrame=f}}else for(var m=0,b=this.tileBlockIconSprite.length;m<b;m++){var w=this.tileBlockIconSprite[m],S=r[m%i][0];w.spriteFrame=S}})),function(e,t){return d.apply(this,arguments)})},{key:"updateThemeAsync",value:(c=o((function*(e,t){this.themeSprite.spriteFrame=null;var n=qe.getAsset("".concat(ft[e],"/spriteFrame"),ue);if(!n){if(this.themeLoadingRing.active=!0,yield Ve.waitTweenAsync(.1,t),t.aborted)return;n=yield qe.loadThemePreviewAsync(e)}n||(n=yield qe.loadThemePreviewAsync(pt.SUMMER)),this.themeSprite&&n&&!t.aborted&&(this.themeSprite.spriteFrame=n,this.themeLoadingRing.active=!1)})),function(e,t){return c.apply(this,arguments)})},{key:"animateUnlockedState",value:(u=o((function*(e){var t,n=this.progressBar.getComponent(B);if(!n)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,this.maskUIOpacity.opacity=null!==(t=this.maskUIOpacity.opacity)&&void 0!==t?t:255,this.progressBar.active=!0,n.opacity=0,yield this.lockAnimator.unlock(e),this.lockAnimator.node.active=!1,yield Promise.all([Ve.runTweenAsync(R(this.maskUIOpacity).to(.25,{opacity:0}),e),Ve.runTweenAsync(R(n).to(.25,{opacity:255}),e)]),this.mask.active=!1,this.maskUIOpacity.opacity=0,n.opacity=255})),function(e){return u.apply(this,arguments)})},{key:"setVisible",value:function(e){this.containerOpacity.opacity=e?255:0,this.titleOpacity.opacity=e?255:0,this.newTilesOpacity.opacity=e?255:0}}]),y}(T)).prototype,"mask",[Cq,Eq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xq=a(jq.prototype,"progressBar",[Aq,Tq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jq=a(jq.prototype,"lockAnimator",[Pq,Oq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zq=a(jq.prototype,"container",[Lq,Iq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qq=a(jq.prototype,"containerOpacity",[Rq,_q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eV=a(jq.prototype,"themeLoadingRing",[Dq,Mq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tV=a(jq.prototype,"themeSprite",[Nq,Bq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nV=a(jq.prototype,"titleLocalizer",[Fq,xq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iV=a(jq.prototype,"titleOpacity",[zq,Uq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aV=a(jq.prototype,"tileBlockIconSprite",[Gq,Hq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oV=a(jq.prototype,"newTilesOpacity",[qq,Vq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(jq.prototype,"isLocked",[$q],Object.getOwnPropertyDescriptor(jq.prototype,"isLocked"),jq.prototype),a(jq.prototype,"updateSkinAsync",[Wq],Object.getOwnPropertyDescriptor(jq.prototype,"updateSkinAsync"),jq.prototype),Kq=jq))||Kq);S._RF.pop(),S._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var PV,OV,LV,IV,RV,_V,DV,MV,NV,BV,FV,xV,zV,UV,GV=C.ccclass,HV=C.property,qV=codex.storage,VV=(uV=GV("CollectionsContent"),cV=HV(Ys),dV=HV(IH),hV=HV(qr),pV=HV({type:L,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),yV=Ni.onlyRunInLifeCycleAsync,vV=Ni.onlyRunInLifeCycleAsync,uV((mV=a((gV=function(a){n(h,a);var u,c,d=i(h);function h(){var e;t(this,h);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=d.call.apply(d,[this].concat(i))).animateThemeBlockUnlockIndex=null,r(e,"panelAnimator",mV,l(e)),r(e,"themeScrollView",bV,l(e)),r(e,"contentOpacity",wV,l(e)),e.themeScrollViewInited=!1,e.payloads=[],e.preservedScrollPosition=new ae,r(e,"offsetFromTopOfScrollView",SV,l(e)),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return e(h,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.node.scene.on(Es.HIDE_UI,this.hideContent),this.node.scene.on(Es.SHOW_UI,this.showContent),this.themeScrollView.listenEvents()}},{key:"unlistenEvents",value:function(){this.unlistenUIEvents(),this.themeScrollView.unlistenEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(Es.HIDE_UI,this.hideContent),this.node.scene.off(Es.SHOW_UI,this.showContent)}},{key:"init",value:function(e){var t=this;this.payloads=e,this.themeScrollViewInited||(this.themeScrollViewInited=!0,this.themeScrollView.init((function(e){var n,i=t.animateThemeBlockUnlockIndex===e.order,a=t.payloads[e.order],o=e.getComponent(TV);a&&(o.updateInfo(s(s({},a),{},{skins:null!==(n=a.skins)&&void 0!==n?n:[],isLocked:!!i||a.isLocked})),o.setVisible(!0),o.container.scale=new V(.4,.4,.4),R(o.container).to(.3,{scale:V.ONE},{easing:"quadOut"}).start())})))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.scrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.scrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(e){var t=this,n=qV.getStorageData("collection","animateMapPackUnlock"),i=qV.getStorageData("collection","lastMapPack");e.forEach((function(e,a){var o=e.progress,r=e.max,l=e.isLocked;if(o<r&&!l&&n&&i!==a+1)return t.animateThemeBlockUnlockIndex=a,qV.setStorageData("collection","animateMapPackUnlock",!1),void qV.setStorageData("collection","lastMapPack",a+1)}))}},{key:"shouldAnimateThemeBlockUnlock",value:function(){return null!==this.animateThemeBlockUnlockIndex}},{key:"playThemeTabUnlockAnim",value:(c=o((function*(e){var t;if(this.animateThemeBlockUnlockIndex){var n=this.themeScrollView.getNodeByOrder(this.animateThemeBlockUnlockIndex);if(n&&n.isVisible()){var i=n.getComponent(TV);if(i){var a=Fy.getCollectionUnlockProgress()[this.animateThemeBlockUnlockIndex];a&&(yield i.playUnlockAnim(e,s(s({},a),{},{skins:null!==(t=a.skins)&&void 0!==t?t:[],isLocked:!0})),this.animateThemeBlockUnlockIndex=null)}}}})),function(e){return c.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(u=o((function*(e,t){yield this.themeScrollView.scrollToOrder(e,t)})),function(e,t){return u.apply(this,arguments)})},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}}]),h}(T)).prototype,"panelAnimator",[cV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bV=a(gV.prototype,"themeScrollView",[dV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wV=a(gV.prototype,"contentOpacity",[hV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SV=a(gV.prototype,"offsetFromTopOfScrollView",[pV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),a(gV.prototype,"playThemeTabUnlockAnim",[yV],Object.getOwnPropertyDescriptor(gV.prototype,"playThemeTabUnlockAnim"),gV.prototype),a(gV.prototype,"scrollToCurrentUnlockingTheme",[vV],Object.getOwnPropertyDescriptor(gV.prototype,"scrollToCurrentUnlockingTheme"),gV.prototype),fV=gV))||fV);S._RF.pop(),S._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var $V,WV,KV,jV,YV,XV,JV,ZV,QV,e$,t$,n$,i$,a$,o$,r$,l$,s$,u$,c$,d$,h$=C.ccclass,p$=C.property,y$=(PV=h$("StarProgressBar"),OV=p$(kc),LV=p$(K),IV=p$(O),RV=p$(O),_V=p$(E),DV=Ni.onlyRunInLifeCycle,PV((BV=a((NV=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"progressBar",BV,l(e)),r(e,"progressLabel",FV,l(e)),r(e,"current",xV,l(e)),r(e,"total",zV,l(e)),r(e,"separator",UV,l(e)),e}return e(c,[{key:"setRange",value:function(e,t){this.total=t,this.current=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(s=o((function*(e,t,n){var i=this,a=Math.min(e,this.total)/this.total,o=this.current,r=1,l=R(this.progressBar).to(3,{progress:a},{easing:"quadOut",onUpdate:function(t,a){a&&(i.current=o+Math.floor((e-o)*a),null==n||n(i.current),i.current===o-r&&(r++,R(i.progressLabel.node).to(.05,{scale:new V(1.2,1.2,1.2)}).to(.05,{scale:V.ONE}).start()),i.updateProgressLabel())}}),s=function(){i.current=e,i.updateProgress()};null==t||t.addAbortListener(s),yield Ve.runTweenAsync(l,t),null==t||t.removeAbortListener(s)})),function(e,t,n){return s.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),c}(T)).prototype,"progressBar",[OV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FV=a(NV.prototype,"progressLabel",[LV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xV=a(NV.prototype,"current",[IV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zV=a(NV.prototype,"total",[RV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UV=a(NV.prototype,"separator",[_V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(NV.prototype,"updateProgress",[DV],Object.getOwnPropertyDescriptor(NV.prototype,"updateProgress"),NV.prototype),MV=NV))||MV);S._RF.pop(),S._RF.push({},"62d0dndWgNMpLpyrC7yEEUL","DailyRewardsWidget",void 0);var v$,f$,g$,m$,b$,w$,S$=C.ccclass,k$=C.property,C$=Ludex,E$=C$.Utils,A$=E$.Signal,T$=E$.String,P$=C$.Configs.DailyRewards.MockTime,O$=C$.Events,L$=codex.event,I$=P$>0?P$:864e5,R$=($V=S$("DailyRewardsWidget"),WV=Ni.required,KV=k$("cc.animation.AnimationController"),jV=Ni.required,YV=k$(oT),XV=Ni.required,JV=k$(K),ZV=Ni.required,QV=k$(kc),e$=Ni.required,t$=k$(q),n$=Ni.onlyRunInLifeCycle,i$=Ni.onlyRunInLifeCycle,a$=Ni.onlyRunInLifeCycle,$V((l$=a((r$=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"animationController",l$,l(e)),r(e,"particles",s$,l(e)),r(e,"timeLabel",u$,l(e)),r(e,"progressBar",c$,l(e)),r(e,"progressBarAndLabel",d$,l(e)),e.signalController=new A$.SignalController,e.handleScreenClosed=function(t){t.screenName===ht[lt.DAILY_REWARDS_SCREEN]&&e.refresh()},e}return e(d,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,d)}},{key:"onEnable",value:function(){L$.on(O$.CLOSED_SCREEN,this.handleScreenClosed)}},{key:"onDisable",value:function(){L$.off(O$.CLOSED_SCREEN,this.handleScreenClosed),this.signalController.abort()}},{key:"onDestroy",value:function(){this.signalController.abort()}},{key:"setParticles",value:function(e){e?(this.particles.node.active=!0,this.particles.play()):(this.particles.stop(),this.particles.node.active=!1)}},{key:"setProgressBarAndLabelVisibility",value:function(e,t){Ve.runTweenAsync(R(this.progressBarAndLabel).to(e?.5:.2,{scale:e?V.ONE:V.ZERO},{easing:e?"backOut":"sineIn"}),t)}},{key:"startUpdateRemainingTimeSchedule",value:function(e){var t=this,n=new A$.SignalController,i=function(){var a=o((function*(){var a=n.renew();a.chain(e);var o=yield oq.getRemainingTime();a.aborted||(t.updateRemainingTime(o),0===o&&t.unschedule(i))}));return function(){return a.apply(this,arguments)}}();i(),this.schedule(i,1),e.once((function(){return t.unschedule(i)}))}},{key:"startSelfRefreshSchedule",value:(u=o((function*(e){var t=this,n=yield oq.getRemainingTime();if(!e.aborted&&0!==n){var i=function n(){e.aborted||t.refresh(),t.unschedule(n)};this.schedule(i,n/1e3),e.once((function(){return t.unschedule(i)}))}})),function(e){return u.apply(this,arguments)})},{key:"updateRemainingTime",value:function(e){if(0===e)this.updateTimeLabel("00:00:00");else{var t=T$.padStart(Math.floor(e/36e5).toString(),2,"0"),n=T$.padStart(Math.floor(e%36e5/6e4).toString(),2,"0"),i=T$.padStart(Math.floor(e%6e4/1e3).toString(),2,"0"),a="".concat(t,":").concat(n,":").concat(i);this.updateTimeLabel(a)}var o=1-e/I$;this.updateProgressBar(o)}},{key:"updateTimeLabel",value:function(e){this.timeLabel.string=e}},{key:"updateProgressBar",value:function(e){this.progressBar.progress=e}},{key:"refresh",value:(s=o((function*(){var e=this.signalController.renew(),t=yield oq.hasClaimableRewards();e.aborted||(this.animationController.setValue("claimable",t),this.setParticles(t),this.setProgressBarAndLabelVisibility(!t,e),this.startUpdateRemainingTimeSchedule(e),this.startSelfRefreshSchedule(e))})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"animationController",[WV,KV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s$=a(r$.prototype,"particles",[jV,YV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u$=a(r$.prototype,"timeLabel",[XV,JV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c$=a(r$.prototype,"progressBar",[ZV,QV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d$=a(r$.prototype,"progressBarAndLabel",[e$,t$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(r$.prototype,"updateRemainingTime",[n$],Object.getOwnPropertyDescriptor(r$.prototype,"updateRemainingTime"),r$.prototype),a(r$.prototype,"updateTimeLabel",[i$],Object.getOwnPropertyDescriptor(r$.prototype,"updateTimeLabel"),r$.prototype),a(r$.prototype,"updateProgressBar",[a$],Object.getOwnPropertyDescriptor(r$.prototype,"updateProgressBar"),r$.prototype),o$=r$))||o$);S._RF.pop(),S._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var _$,D$,M$,N$,B$,F$,x$,z$,U$,G$,H$,q$,V$,$$,W$,K$=C.ccclass,j$=C.property,Y$=(v$=K$("EventButton"),f$=j$({type:x(yU)}),g$=j$(W),v$((w$=a((b$=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"eventType",w$,l(e)),e._isAvailable=!1,e}return e(s,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(e){this._isAvailable=e,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(Pn,{type:this.eventType})}},{key:"setAnimationState",value:function(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),c(d(s.prototype),"setAnimationState",this).call(this,e)}}]),s}(Cr)).prototype,"eventType",[f$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yU.STAR_CHEST}}),a(b$.prototype,"isAvailable",[g$],Object.getOwnPropertyDescriptor(b$.prototype,"isAvailable"),b$.prototype),m$=b$))||m$);S._RF.pop(),S._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var X$,J$,Z$,Q$,eW,tW,nW,iW,aW,oW,rW,lW,sW,uW,cW,dW,hW,pW,yW=C.ccclass,vW=C.property,fW=codex.player,gW=(_$=yW("DashboardHeader"),D$=vW({type:y$,displayName:"Progress bar",group:"Star Chest"}),M$=vW({type:Y$,displayName:"Button Component",group:"Star Chest"}),N$=vW(R$),B$=vW(P),F$=vW(I),x$=vW(P),_$((G$=a((U$=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"starProgressBar",G$,l(e)),r(e,"chestButton",H$,l(e)),r(e,"dailyRewardsWidget",q$,l(e)),r(e,"uiTransform",V$,l(e)),r(e,"containerWidget",$$,l(e)),r(e,"containerUITransform",W$,l(e)),e}return e(s,[{key:"__preload",value:function(){D.on(kn,this.handleStarsUpdateEvent,this),D.on($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),D.on($e.VIEW_RESIZED,this.handleOrientationChanged,this)}},{key:"start",value:function(){this.handleOrientationChanged()}},{key:"onDestroy",value:function(){D.off(kn,this.handleStarsUpdateEvent,this),D.off($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),D.off($e.VIEW_RESIZED,this.handleOrientationChanged,this)}},{key:"updateDailyRewardsButton",value:function(){this.dailyRewardsWidget.refresh()}},{key:"updateStarProgress",value:function(e){this.handleStarsUpdateEvent(e)}},{key:"updateStarChestButtonAnimation",value:function(e){this.chestButton.isAvailable=e>=20}},{key:"handleStarsUpdateEvent",value:function(e){var t,n=null!=e?e:null===(t=fW.getGameData())||void 0===t?void 0:t.stars;void 0!==n&&(this.starProgressBar.setRange(n,20),this.updateStarChestButtonAnimation(n))}},{key:"handleOrientationChanged",value:function(){Je.isPortrait()?this.containerWidget.isAlignLeft=this.containerWidget.isAlignRight=!0:Je.isLandscape()&&(this.containerWidget.isAlignLeft=this.containerWidget.isAlignRight=!1,this.containerUITransform.width=Math.min(this.uiTransform.width,1366)),this.containerWidget.getComponentsInChildren(I).forEach((function(e,t){e.updateAlignment()}))}},{key:"handleClickedSettingsButton",value:function(){rt.openScreen(lt.SETTINGS_SCREEN)}}]),s}(T)).prototype,"starProgressBar",[D$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H$=a(U$.prototype,"chestButton",[M$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q$=a(U$.prototype,"dailyRewardsWidget",[N$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V$=a(U$.prototype,"uiTransform",[B$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$$=a(U$.prototype,"containerWidget",[F$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W$=a(U$.prototype,"containerUITransform",[x$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z$=U$))||z$);S._RF.pop(),S._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var mW,bW,wW,SW,kW,CW,EW,AW,TW,PW,OW,LW,IW,RW=C.ccclass,_W=C.property,DW=C.executeInEditMode,MW=(X$=RW("JourneyLevelAvatar"),J$=_W({type:F,displayName:"Avatar node"}),Z$=_W(q),Q$=_W(ce),eW=_W(B),tW=_W({type:de,group:"Animation"}),nW=_W({type:de,group:"Animation"}),iW=_W({type:de,group:"Animation"}),aW=_W({type:ue,displayName:"Avatar sprite"}),X$(oW=DW((lW=a((rW=function(a){n(h,a);var s,u,c,d=i(h);function h(){var e;t(this,h);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=d.call.apply(d,[this].concat(i)),r(e,"sprite",lW,l(e)),r(e,"lockIcon",sW,l(e)),r(e,"animation",uW,l(e)),r(e,"opacity",cW,l(e)),r(e,"flashAnimation",dW,l(e)),r(e,"unlockAnimation",hW,l(e)),r(e,"spawnAnimation",pW,l(e)),e}return e(h,[{key:"avatarSprite",get:function(){var e,t;return null!==(e=null===(t=this.sprite)||void 0===t?void 0:t.spriteFrame)&&void 0!==e?e:null},set:function(e){this.sprite&&(this.sprite.spriteFrame=e)}},{key:"playUnlockAnimation",value:(c=o((function*(){var e=this.playAnimation(this.unlockAnimation),t=this.lockIcon.position.x,n=this.lockIcon.position.y,i=[45,135],a=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),o=this.lockIcon.position.x+150*Math.cos(a),r=this.lockIcon.position.y+150*Math.sin(a),l=n-400,s=Ve.runTweenAsync(R(this.lockIcon).delay(.3).to(.2,{position:new V(o,r,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new V(o,l,this.lockIcon.position.z)},{easing:"cubicIn"})),u=[0,360],c=Ve.runTweenAsync(R(this.lockIcon).delay(.3).to(.6,{eulerAngles:new V(0,0,Math.random()*(u[1]-u[0])*(o>t?-1:1))},{easing:"sineOut"}));yield Promise.all([e,s,c]),this.lockIcon.position=new V(t,n,this.lockIcon.position.z),this.lockIcon.eulerAngles=new V(0,0,0)})),function(){return c.apply(this,arguments)})},{key:"playFlashAnimation",value:(u=o((function*(e){var t=this.node.position.y,n=this.playAnimation(this.flashAnimation),i=Ve.runTweenAsync(R(this.node).to(.1,{position:new V(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new V(this.node.position.x,t,this.node.position.z)},{easing:"sineIn"}),e);yield Promise.all([n,i])})),function(e){return u.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(V.ZERO)}},{key:"playAnimation",value:(s=o((function*(e){yield Ve.runAnimationAsync(this.animation,e.name)})),function(e){return s.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var e=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((function(t){return null!==t&&(t.name===e.flashAnimation.name||t.name===e.unlockAnimation.name||t.name===e.spawnAnimation.name)})))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),h}(T)).prototype,"sprite",[J$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sW=a(rW.prototype,"lockIcon",[Z$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uW=a(rW.prototype,"animation",[Q$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cW=a(rW.prototype,"opacity",[eW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dW=a(rW.prototype,"flashAnimation",[tW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hW=a(rW.prototype,"unlockAnimation",[nW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pW=a(rW.prototype,"spawnAnimation",[iW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(rW.prototype,"avatarSprite",[aW],Object.getOwnPropertyDescriptor(rW.prototype,"avatarSprite"),rW.prototype),oW=rW))||oW)||oW);S._RF.pop(),S._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var NW,BW,FW,xW,zW,UW,GW,HW,qW,VW,$W,WW,KW,jW,YW,XW,JW,ZW,QW,eK,tK,nK,iK,aK,oK,rK,lK=C.ccclass,sK=C.property,uK=C.executeInEditMode,cK=(mW=lK("JourneyProgressBar"),bW=sK(kc),wW=sK(K),SW=sK(B),kW=sK(O),CW=sK(O),EW=sK(E),AW=Ni.onlyRunInLifeCycle,mW(TW=uK((OW=a((PW=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"progressBar",OW,l(e)),r(e,"progressLabel",LW,l(e)),r(e,"labelUIOpacity",IW,l(e)),e.currentProgress=10,e.totalProgress=10,e.labelSeparator="/",e}return e(c,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(e){this.labelSeparator=e,this.updateProgress()}},{key:"setRange",value:function(e,t){this.totalProgress=t;var n=e;n>t&&(n=t),this.currentProgress=n,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(s=o((function*(e){var t=this,n=e.nextCurr,i=e.nextTotal,a=e.numberOfProgressBar,o=void 0===a?0:a,r=e.onProgressBarPassed,l=e.signal,s=n/i,u=R(this.labelUIOpacity).to(.2,{opacity:0}),c=R(this.labelUIOpacity).to(.2,{opacity:255}),d=o<1?1:Math.sqrt(o)+1,h=0===o?s:o+s,p=1,y=this.progressBar.progress,v=h,f=Ve.runOnUpdateAsync(this.node,d,(function(e){var n=z.sineInOut(e),i=Se(y,v,n);t.progressBar.progress=i%1,i>p&&(p=0===i?1:Math.ceil(i),null==r||r())}),l);return yield Promise.all([Ve.runTweenAsync(u,l),f]),this.currentProgress=n,this.totalProgress=i,this.updateProgress(),yield Ve.runTweenAsync(c,l),this.labelUIOpacity.opacity=255,s})),function(e){return s.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),c}(T)).prototype,"progressBar",[bW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LW=a(PW.prototype,"progressLabel",[wW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IW=a(PW.prototype,"labelUIOpacity",[SW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(PW.prototype,"total",[kW],Object.getOwnPropertyDescriptor(PW.prototype,"total"),PW.prototype),a(PW.prototype,"current",[CW],Object.getOwnPropertyDescriptor(PW.prototype,"current"),PW.prototype),a(PW.prototype,"separator",[EW],Object.getOwnPropertyDescriptor(PW.prototype,"separator"),PW.prototype),a(PW.prototype,"updateProgress",[AW],Object.getOwnPropertyDescriptor(PW.prototype,"updateProgress"),PW.prototype),TW=PW))||TW)||TW);S._RF.pop(),S._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var dK,hK,pK,yK,vK,fK,gK,mK,bK,wK,SK,kK=C.ccclass,CK=C.property,EK=(NW=kK("ProgressConfiguration"),BW=CK(ue),FW=CK(E),NW((UW=a((zW=e((function e(){t(this,e),r(this,"avatar",UW,this),r(this,"themeId",GW,this)}))).prototype,"avatar",[BW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GW=a(zW.prototype,"themeId",[FW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xW=zW)),HW=kK("JourneyProgressAnimator"),qW=Ni.required,VW=CK(cK),$W=Ni.required,WW=CK(q),KW=Ni.required,jW=CK(F),YW=Ni.required,XW=CK(MW),JW=CK({type:L,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),ZW=Ni.onlyRunInLifeCycleAsync,QW=Ni.onlyRunInLifeCycle,HW((nK=a((tK=function(a){n(v,a);var s,u,c,d,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),r(e,"progressBar",nK,l(e)),r(e,"currentLevelAvatarNode",iK,l(e)),r(e,"currentLevelAvatar",aK,l(e)),r(e,"nextLevelAvatar",oK,l(e)),r(e,"nextLevelYOffset",rK,l(e)),e.isAnimating=!1,e}return e(v,[{key:"setRange",value:function(e,t){this.progressBar.setRange(e,t)}},{key:"animateTo",value:(p=o((function*(e,t){if(this.isAnimating)return console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve();this.isAnimating=!0,e!==this.progressBar.current&&(yield this.progressBar.animateTo({nextCurr:e,nextTotal:this.progressBar.total,signal:t})),this.isAnimating=!1})),function(e,t){return p.apply(this,arguments)})},{key:"animateToNextLevel",value:(h=o((function*(e){var t=this,n=e.nextCurr,i=e.nextTotal,a=e.mapsPassed,o=e.signal;if(this.isAnimating)console.warn("JourneyProgressAnimator: animation already in progress");else{this.isAnimating=!0;var r=a.length-2;if(0===r)return yield this.progressBar.animateTo({nextCurr:n,nextTotal:i,signal:o}),void(this.isAnimating=!1);yield this.animateTargetAvaToCenter(o);var l=1;yield this.progressBar.animateTo({signal:o,nextCurr:n,nextTotal:i,numberOfProgressBar:r,onProgressBarPassed:function(){if(1===l)return t.nextLevelAvatar.playUnlockAnimation(),void(l+=1);if(l>=a.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");t.nextLevelAvatar.playFlashAnimation(o),t.setNextLevelAvatar(a[l].theme),l+=1}}),yield this.animateTargetAvaToPrev(o);var s=a[a.length-1].theme,u=a[a.length-2].theme;this.setCurrentLevelAvatar(u),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=yield this.getSpriteFrameByThemeId(s),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1}})),function(e){return h.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(d=o((function*(e){var t=new V(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);yield Ve.runTweenAsync(R(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e),this.nextLevelAvatar.node.position=t})),function(e){return d.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(c=o((function*(e){var t=this.currentLevelAvatarNode.position.clone();yield Ve.runTweenAsync(R(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e),this.nextLevelAvatar.node.position=t})),function(e){return c.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:(u=o((function*(e){return qe.loadThemeThumbnailAsync(e)})),function(e){return u.apply(this,arguments)})},{key:"loadAndSetAvatar",value:(s=o((function*(e,t){var n=yield this.getSpriteFrameByThemeId(e);n?this.setAvatar(n,t):console.warn("JourneyProgressAnimator: ".concat(e," is null"))})),function(e,t){return s.apply(this,arguments)})},{key:"setAvatar",value:function(e,t){t instanceof MW?t.avatarSprite=e:t.spriteFrame=e}},{key:"setCurrentLevelAvatar",value:function(e){this.loadAndSetAvatar(e,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(e){this.loadAndSetAvatar(e,this.nextLevelAvatar)}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this,v),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}}]),v}(T)).prototype,"progressBar",[qW,VW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iK=a(tK.prototype,"currentLevelAvatarNode",[$W,WW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aK=a(tK.prototype,"currentLevelAvatar",[KW,jW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oK=a(tK.prototype,"nextLevelAvatar",[YW,XW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rK=a(tK.prototype,"nextLevelYOffset",[JW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a(tK.prototype,"loadAndSetAvatar",[ZW],Object.getOwnPropertyDescriptor(tK.prototype,"loadAndSetAvatar"),tK.prototype),a(tK.prototype,"setAvatar",[QW],Object.getOwnPropertyDescriptor(tK.prototype,"setAvatar"),tK.prototype),eK=tK))||eK);S._RF.pop(),S._RF.push({},"4b935BmCjhBf73yEp1PitwH","LandscapeMask",void 0);var AK,TK,PK,OK,LK,IK,RK,_K,DK,MK,NK,BK,FK,xK=C.ccclass,zK=C.property,UK=(dK=xK("LandscapeMask"),hK=zK(qr),pK=zK(P),yK=zK(P),vK=zK(P),dK((mK=a((gK=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"opacityToggler",mK,l(e)),r(e,"uiTransform",bK,l(e)),r(e,"leftMask",wK,l(e)),r(e,"rightMask",SK,l(e)),e}return e(s,[{key:"__preload",value:function(){D.on($e.VIEW_RESIZED,this.onViewResized,this)}},{key:"onDestroy",value:function(){D.off($e.VIEW_RESIZED,this.onViewResized,this)}},{key:"onViewResized",value:function(){this.updateMaskPosition()}},{key:"updateMaskPosition",value:function(){var e=this.uiTransform.contentSize,t=e.width,n=e.height;this.leftMask.width=this.rightMask.width=2*n;var i=this.leftMask.height>.3*t?this.leftMask.height-.3*t:0;this.leftMask.node.setWorldPosition(-i,this.leftMask.node.worldPosition.y,0),this.rightMask.node.setWorldPosition(t+i,this.rightMask.node.worldPosition.y,0)}},{key:"show",value:function(){this.opacityToggler.changeStateFade(!0,.2)}},{key:"hide",value:function(){this.opacityToggler.changeStateFade(!1,.1)}}]),s}(T)).prototype,"opacityToggler",[hK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bK=a(gK.prototype,"uiTransform",[pK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wK=a(gK.prototype,"leftMask",[yK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SK=a(gK.prototype,"rightMask",[vK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fK=gK))||fK);S._RF.pop(),S._RF.push({},"ee748sgCHxCTaIJcL1SUIFl","CustomButton",void 0);var GK,HK,qK,VK,$K,WK,KK,jK,YK,XK,JK,ZK,QK,ej,tj=C.ccclass,nj=C.property,ij=(AK=tj("CustomButton"),TK=nj(F),PK=nj(ue),OK=nj(ue),LK=nj(G),IK=nj(q),AK((DK=a((_K=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"sprite",DK,l(e)),r(e,"lockedSprite",MK,l(e)),r(e,"unlockedSprite",NK,l(e)),r(e,"button",BK,l(e)),r(e,"unlockContainer",FK,l(e)),e}return e(c,[{key:"interactable",set:function(e){this.button.interactable=e}},{key:"updateStatus",value:function(e){var t=e>=13;this.button.interactable=t,this.unlockContainer.active=!t,this.sprite.spriteFrame=t?this.unlockedSprite:this.lockedSprite}},{key:"handleOnClicked",value:(s=o((function*(){var e;(null!==(e=(yield rt.openScreenAndWaitForClose(lt.CUSTOM_GAME_SCREEN)).screenData)&&void 0!==e?e:{}).customMode&&this.node.scene.emit(En)})),function(){return s.apply(this,arguments)})}]),c}(T)).prototype,"sprite",[TK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MK=a(_K.prototype,"lockedSprite",[PK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NK=a(_K.prototype,"unlockedSprite",[OK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BK=a(_K.prototype,"button",[LK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FK=a(_K.prototype,"unlockContainer",[IK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RK=_K))||RK);S._RF.pop(),S._RF.push({},"a479fLcnJ9AtqhT/3Hs2xco","CustomGuideUI",void 0);var aj,oj,rj,lj,sj,uj,cj,dj,hj,pj,yj,vj,fj,gj,mj,bj=C.ccclass,wj=C.property,Sj=(GK=bj("CustomGuideUI"),HK=Ni.required(),qK=wj(ij),VK=Ni.required(),$K=wj(IR),WK=Ni.required(),KK=wj(K),jK=Ni.onlyRunInLifeCycleAsync,YK=Ni.onlyRunInLifeCycleAsync,GK((ZK=a((JK=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"customButton",ZK,l(e)),r(e,"guideMasks",QK,l(e)),r(e,"guideInfoText",ej,l(e)),e.guideShown=!1,e}return e(c,[{key:"update",value:function(){if(this.guideShown){var e=this.customButton.node.worldPosition;this.guideInfoText.node.worldPosition=new V(e.x-100,e.y,0),this.guideMasks.setOtherMaskTransform(e.x,e.y,150,150)}}},{key:"startGuide",value:(s=o((function*(){var e;this.guideShown=!0,this.guideInfoText.node.active=!0,yield this.guideMasks.show(),yield Promise.race([this.waitForClick(),Ve.waitTweenAsync(3)]),yield null===(e=this.guideMasks)||void 0===e?void 0:e.hide(),this.guideInfoText.node.active=!1,this.guideShown=!1})),function(){return s.apply(this,arguments)})},{key:"waitForClick",value:function(){var e=this;return new Promise((function(t){e.node.scene.once(Es.GUIDE_MASK_CLICKED,(function(){t()}))}))}}]),c}(T)).prototype,"customButton",[HK,qK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QK=a(JK.prototype,"guideMasks",[VK,$K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ej=a(JK.prototype,"guideInfoText",[WK,KK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(JK.prototype,"startGuide",[jK],Object.getOwnPropertyDescriptor(JK.prototype,"startGuide"),JK.prototype),a(JK.prototype,"waitForClick",[YK],Object.getOwnPropertyDescriptor(JK.prototype,"waitForClick"),JK.prototype),XK=JK))||XK);S._RF.pop(),S._RF.push({},"21121NZ8PtCJJpkj1j2/qOg","PlayButton",void 0);var kj,Cj,Ej,Aj,Tj,Pj,Oj,Lj,Ij,Rj,_j,Dj,Mj,Nj,Bj,Fj,xj,zj,Uj,Gj,Hj,qj,Vj,$j,Wj,Kj,jj,Yj,Xj,Jj,Zj,Qj,eY,tY,nY,iY,aY,oY,rY,lY,sY,uY=C.ccclass,cY=C.property,dY=(aj=uY("PlayButton"),oj=Ni.required(),rj=cY(Kd),lj=Ni.required(),sj=cY(q),uj=Ni.required(),cj=cY(q),dj=Ni.required(),hj=cY(G),aj((vj=a((yj=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"localizer",vj,l(e)),r(e,"defaultBackground",fj,l(e)),r(e,"hardLevelBackground",gj,l(e)),r(e,"button",mj,l(e)),e}return e(s,[{key:"interactable",set:function(e){this.button.interactable=e}},{key:"updateStatus",value:function(e){var t=e%5==0;this.localizer.setParams([e.toString()]),this.defaultBackground.active=!t,this.hardLevelBackground.active=t}},{key:"handleOnClicked",value:function(){this.node.scene.emit(Cn)}}]),s}(T)).prototype,"localizer",[oj,rj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fj=a(yj.prototype,"defaultBackground",[lj,sj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gj=a(yj.prototype,"hardLevelBackground",[uj,cj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mj=a(yj.prototype,"button",[dj,hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pj=yj))||pj);S._RF.pop(),S._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var hY,pY,yY,vY,fY,gY,mY,bY,wY,SY,kY,CY,EY,AY,TY,PY,OY,LY,IY,RY,_Y,DY,MY,NY,BY,FY,xY,zY,UY,GY,HY,qY,VY=C.ccclass,$Y=C.property,WY=codex,KY=WY.storage,jY=WY.monitorError,YY=WY.player,XY=Ludex.Utils,JY=XY.Array,ZY=XY.Json,QY=(kj=VY("HomeContent"),Cj=Ni.required(),Ej=$Y({type:dY,group:"Play Button"}),Aj=Ni.required(),Tj=$Y({type:ij,group:"Play Button"}),Pj=Ni.required(),Oj=$Y(qr),Lj=Ni.required(),Ij=$Y(EK),Rj=Ni.required(),_j=$Y(gW),Dj=Ni.required(),Mj=$Y(B),Nj=Ni.required(),Bj=$Y(hx),Fj=Ni.required(),xj=$Y(q),zj=Ni.required(),Uj=$Y(UK),Gj=Ni.required(),Hj=$Y(Sj),qj=Ni.onlyRunInLifeCycleAsync,Vj=Ni.onlyRunInLifeCycleAsync,$j=Ni.onlyRunInLifeCycleAsync,Wj=Ni.onlyRunInLifeCycleAsync,Kj=Ni.onlyRunInLifeCycleAsync,jj=Ni.onlyRunInLifeCycle,Yj=Ni.onlyRunInLifeCycle,Xj=Ni.onlyRunInLifeCycleAsync,kj((Qj=a((Zj=function(a){n(v,a);var u,c,d,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),r(e,"playButton",Qj,l(e)),r(e,"customButton",eY,l(e)),r(e,"contentOpacity",tY,l(e)),r(e,"journeyProgressAnimator",nY,l(e)),r(e,"dashboardHeader",iY,l(e)),r(e,"overlayDuringAnim",aY,l(e)),r(e,"coinContainer",oY,l(e)),r(e,"leavesContainer",rY,l(e)),r(e,"landscapeMask",lY,l(e)),r(e,"customGuideUI",sY,l(e)),e}return e(v,[{key:"onLoad",value:function(){D.on($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(),Ni.validateRequiredProperties(this)}},{key:"onDestroy",value:function(){D.off($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"listenEvents",value:function(){this.node.scene.on(Es.HIDE_UI,this.hideContent,this),this.node.scene.on(Es.SHOW_UI,this.showContent,this)}},{key:"unlistenEvents",value:function(){this.node.scene.off(Es.HIDE_UI,this.hideContent,this),this.node.scene.off(Es.SHOW_UI,this.showContent,this)}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"updateStatus",value:function(){var e,t=null!==(e=YY.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?1:n,a=t.stars,o=void 0===a?0:a;this.playButton.updateStatus(i),this.customButton.updateStatus(i),this.dashboardHeader.updateStarProgress(o),this.dashboardHeader.updateDailyRewardsButton()}},{key:"updateDailyRewardsButton",value:function(){this.dashboardHeader.updateDailyRewardsButton()}},{key:"setUnlockProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setProgress(e),this.updateCurrentMapInStorage(e,t)}},{key:"shouldPlayUnlockAnimation",value:function(){var e,t,n=KY.getStorage("dashboard");if(null==n)return null==jY||jY.sendException(new Error("DashboardScene: dashboardStorage not found")),!1;if(!(null!==(e=n.animateToCurrentLevel)&&void 0!==e&&e))return!1;var i=KY.getStorage("tournament");if(null==i)return null==jY||jY.sendException(new Error("DashboardScene: tournamentStorage not found")),!1;if(null!==(t=i.animateTournamentLeader)&&void 0!==t&&t)return!1;var a=n.lastMapPayload,o=Fy.getCurrentMapProgress();return ZY.encode(a)!==ZY.encode(o)&&!(JY.searchIndex(Iy.mapOrder,(function(e){return e.id===a.id}))>JY.searchIndex(Iy.mapOrder,(function(e){return e.id===o.id})))}},{key:"playUnlockProgressAnimation",value:function(e){var t=KY.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=t.lastMapPayload,i=Fy.getCurrentMapProgress(),a=JY.searchIndex(Iy.mapOrder,(function(e){return e.id===n.id})),o=JY.searchIndex(Iy.mapOrder,(function(e){return e.id===i.id})),r=Iy.mapOrder.slice(a,o+2);return n.id===i.id?this.playUnlockProgressAnimationOnly(i,n,e):this.playUnlockProgressAndPackAnimation(n,i,r,e)}},{key:"playUnlockProgressAndPackAnimation",value:(p=o((function*(e,t,n,i){this.setProgress(s({},e)),this.updateCurrentMapInStorage(s({},t),!0),this.playButton.interactable=!1,yield this.showOwnOverlay(i),yield this.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:n,signal:i}),yield this.hideOwnOverlay(i),this.playButton.interactable=!0})),function(e,t,n,i){return p.apply(this,arguments)})},{key:"playUnlockProgressAnimationOnly",value:(h=o((function*(e,t,n){this.setProgress(s(s({},e),{},{progress:t.progress})),this.updateCurrentMapInStorage(s({},e),!0);var i=e.progress;yield this.showOwnOverlay(n),yield this.journeyProgressAnimator.animateTo(i,n),yield this.hideOwnOverlay(n)})),function(e,t,n){return h.apply(this,arguments)})},{key:"hideOwnOverlay",value:(d=o((function*(e){yield Ve.runTweenAsync(R(this.overlayDuringAnim).to(.3,{opacity:0}),e),this.node.activeInHierarchy&&(this.overlayDuringAnim.opacity=0)})),function(e){return d.apply(this,arguments)})},{key:"showOwnOverlay",value:(c=o((function*(e){yield Ve.runTweenAsync(R(this.overlayDuringAnim).to(.3,{opacity:150}),e)})),function(e){return c.apply(this,arguments)})},{key:"setProgress",value:function(e){var t=e.currentTheme,n=e.nextTheme,i=e.progress,a=e.max;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(null!=n?n:t),this.journeyProgressAnimator.setRange(i,a)}},{key:"updateCurrentMapInStorage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=KY.getStorage("dashboard");if(null!=n){var i=n.animateToCurrentLevel;KY.setStorageData("dashboard","animateToCurrentLevel",!t&&i),KY.setStorageData("dashboard","lastMapPayload",e)}else null==jY||jY.sendException(new Error("DashboardScene: dashboardStorage not found"))}},{key:"handleOrientationChanged",value:function(){this.leavesContainer.active=Je.isLandscape(),this.landscapeMask.node.active=Je.isLandscape()}},{key:"transitionIn",value:function(){this.listenEvents(),this.landscapeMask.node.active&&(this.landscapeMask.updateMaskPosition(),this.landscapeMask.show())}},{key:"transitionOut",value:function(){this.unlistenEvents(),this.landscapeMask.node.active&&this.landscapeMask.hide()}},{key:"hideContent",value:function(){this.contentOpacity.changeStateFade(!1,.5)}},{key:"showContent",value:function(){this.contentOpacity.changeStateFade(!0,.1)}},{key:"showCustomGuide",value:(u=o((function*(){yield this.customGuideUI.startGuide()})),function(){return u.apply(this,arguments)})}]),v}(T)).prototype,"playButton",[Cj,Ej],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eY=a(Zj.prototype,"customButton",[Aj,Tj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tY=a(Zj.prototype,"contentOpacity",[Pj,Oj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nY=a(Zj.prototype,"journeyProgressAnimator",[Lj,Ij],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iY=a(Zj.prototype,"dashboardHeader",[Rj,_j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aY=a(Zj.prototype,"overlayDuringAnim",[Dj,Mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oY=a(Zj.prototype,"coinContainer",[Nj,Bj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rY=a(Zj.prototype,"leavesContainer",[Fj,xj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lY=a(Zj.prototype,"landscapeMask",[zj,Uj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sY=a(Zj.prototype,"customGuideUI",[Gj,Hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Zj.prototype,"playUnlockProgressAnimation",[qj],Object.getOwnPropertyDescriptor(Zj.prototype,"playUnlockProgressAnimation"),Zj.prototype),a(Zj.prototype,"playUnlockProgressAndPackAnimation",[Vj],Object.getOwnPropertyDescriptor(Zj.prototype,"playUnlockProgressAndPackAnimation"),Zj.prototype),a(Zj.prototype,"playUnlockProgressAnimationOnly",[$j],Object.getOwnPropertyDescriptor(Zj.prototype,"playUnlockProgressAnimationOnly"),Zj.prototype),a(Zj.prototype,"hideOwnOverlay",[Wj],Object.getOwnPropertyDescriptor(Zj.prototype,"hideOwnOverlay"),Zj.prototype),a(Zj.prototype,"showOwnOverlay",[Kj],Object.getOwnPropertyDescriptor(Zj.prototype,"showOwnOverlay"),Zj.prototype),a(Zj.prototype,"hideContent",[jj],Object.getOwnPropertyDescriptor(Zj.prototype,"hideContent"),Zj.prototype),a(Zj.prototype,"showContent",[Yj],Object.getOwnPropertyDescriptor(Zj.prototype,"showContent"),Zj.prototype),a(Zj.prototype,"showCustomGuide",[Xj],Object.getOwnPropertyDescriptor(Zj.prototype,"showCustomGuide"),Zj.prototype),Jj=Zj))||Jj);S._RF.pop(),S._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var eX,tX,nX,iX,aX,oX,rX,lX,sX,uX=C.ccclass,cX=C.property,dX=C.disallowMultiple,hX=C.requireComponent,pX=(hY=uX("DashboardPage"),pY=hX(I),yY=hX(B),vY=Ni.required(),fY=cX({type:q,displayName:"Page's container"}),gY=Ni.required(),mY=Ni.required(),bY=cX({type:q,displayName:"Placeholder"}),wY=Ni.required(),SY=cX({displayName:"Don't create prefab",tooltip:"Tell the component to not create the prefab even if it hasn't create yet"}),kY=cX({displayName:"Darken background"}),CY=cX({type:O,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),EY=cX({displayName:"Use navbar shadow"}),AY=cX({type:O,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),TY=Ni.required(),PY=Ni.required(),OY=Ni.onlyRunInLifeCycleAsync,LY=Ni.onlyRunInLifeCycle,IY=Ni.onlyRunInLifeCycleAsync,hY(RY=dX(RY=pY(RY=yY((DY=a((_Y=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"container",DY,l(e)),r(e,"containerUIOpacity",MY,l(e)),r(e,"placeholder",NY,l(e)),r(e,"placeholderUIOpacity",BY,l(e)),r(e,"hasCreated",FY,l(e)),e.pagePrefab=null,r(e,"darkenBackground",xY,l(e)),r(e,"backgroundOpacity",zY,l(e)),r(e,"useNavbarShadow",UY,l(e)),r(e,"navbarShadowOpacity",GY,l(e)),r(e,"uiOpacity",HY,l(e)),r(e,"widgetComponent",qY,l(e)),e}return e(d,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(B),this.widgetComponent=this.getComponent(I),this.containerUIOpacity=this.container.getComponent(B),this.placeholderUIOpacity=this.placeholder.getComponent(B),Ni.validateRequiredProperties(this)}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(u=o((function*(){this.hasCreated||(yield this.create()),this.mountInLifeCycle()})),function(){return u.apply(this,arguments)})},{key:"mountInLifeCycle",value:function(){this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,Ye.trackCurrentPage(this.node.name,!0)}},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return!0}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(s=o((function*(){if(this.pagePrefab&&!this.hasCreated){var e=ye(this.pagePrefab);this.container.addChild(e),yield Ve.waitTweenAsync(0),this.hasCreated=!0}})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"container",[vY,fY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MY=a(_Y.prototype,"containerUIOpacity",[gY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NY=a(_Y.prototype,"placeholder",[mY,bY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BY=a(_Y.prototype,"placeholderUIOpacity",[wY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FY=a(_Y.prototype,"hasCreated",[SY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xY=a(_Y.prototype,"darkenBackground",[kY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zY=a(_Y.prototype,"backgroundOpacity",[CY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),UY=a(_Y.prototype,"useNavbarShadow",[EY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),GY=a(_Y.prototype,"navbarShadowOpacity",[AY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),HY=a(_Y.prototype,"uiOpacity",[TY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qY=a(_Y.prototype,"widgetComponent",[PY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(_Y.prototype,"mount",[OY],Object.getOwnPropertyDescriptor(_Y.prototype,"mount"),_Y.prototype),a(_Y.prototype,"mountInLifeCycle",[LY],Object.getOwnPropertyDescriptor(_Y.prototype,"mountInLifeCycle"),_Y.prototype),a(_Y.prototype,"create",[IY],Object.getOwnPropertyDescriptor(_Y.prototype,"create"),_Y.prototype),RY=_Y))||RY)||RY)||RY)||RY);S._RF.pop(),S._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var yX,vX,fX,gX,mX,bX,wX,SX,kX,CX,EX,AX,TX,PX,OX,LX,IX,RX,_X,DX,MX,NX,BX,FX,xX,zX,UX,GX,HX,qX,VX,$X,WX,KX,jX,YX,XX,JX,ZX,QX=(eX=(0,C.ccclass)("CollectionsPage"),tX=Ni.required(),nX=Ni.onlyRunInLifeCycleAsync,iX=Ni.onlyRunInLifeCycle,aX=Ni.onlyRunInLifeCycleAsync,oX=Ni.onlyRunInLifeCycleAsync,eX((sX=a((lX=function(a){n(v,a);var s,u,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=y.call.apply(y,[this].concat(i))).payload=null,r(e,"panelAnimationController",sX,l(e)),e}return e(v,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(qs),c(d(v.prototype),"onLoad",this).call(this)}},{key:"start",value:(p=o((function*(){c(d(v.prototype),"start",this).call(this)})),function(){return p.apply(this,arguments)})},{key:"setPayload",value:function(e){this.payload=e}},{key:"mount",value:(h=o((function*(){yield c(d(v.prototype),"mount",this).call(this),this.onMount()})),function(){return h.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(VV),!this.themeContent))throw new Error("No theme content found");var e=Fy.getCollectionUnlockProgress();this.themeContent.updateUnlockedProgress(e),this.payload&&this.themeContent.init(this.payload)}},{key:"transitionIn",value:(u=o((function*(){yield c(d(v.prototype),"transitionIn",this).call(this),this.themeContent.restoreScrollPosition(),this.themeContent.listenEvents();var e=Ve.runTweenAsync(R(this.containerUIOpacity).to(.2,{opacity:255})),t=this.panelAnimationController.showUI();yield Promise.all([e,t])})),function(){return u.apply(this,arguments)})},{key:"transitionOut",value:(s=o((function*(){yield c(d(v.prototype),"transitionOut",this).call(this),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),yield this.panelAnimationController.hideUI(),this.themeContent.unlistenEvents()})),function(){return s.apply(this,arguments)})}]),v}(pX)).prototype,"panelAnimationController",[tX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(lX.prototype,"mount",[nX],Object.getOwnPropertyDescriptor(lX.prototype,"mount"),lX.prototype),a(lX.prototype,"onMount",[iX],Object.getOwnPropertyDescriptor(lX.prototype,"onMount"),lX.prototype),a(lX.prototype,"transitionIn",[aX],Object.getOwnPropertyDescriptor(lX.prototype,"transitionIn"),lX.prototype),a(lX.prototype,"transitionOut",[oX],Object.getOwnPropertyDescriptor(lX.prototype,"transitionOut"),lX.prototype),rX=lX))||rX);S._RF.pop(),S._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var eJ,tJ,nJ,iJ,aJ,oJ,rJ,lJ,sJ,uJ,cJ,dJ,hJ,pJ,yJ,vJ,fJ,gJ=C.ccclass,mJ=C.property,bJ=C.disallowMultiple,wJ=C.requireComponent,SJ=Ludex.Utils.Array,kJ=(yX=gJ("PageManagerItem"),vX=mJ(pX),fX=mJ({type:x(On)}),yX((bX=a((mX=e((function e(){t(this,e),r(this,"page",bX,this),r(this,"pageType",wX,this)}))).prototype,"page",[vX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wX=a(mX.prototype,"pageType",[fX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gX=mX))||gX),CJ=(SX=gJ("PageManager"),kX=wJ(P),CX=Ni.required(),EX=mJ({type:B,displayName:"Background Mask",group:"Background Mask"}),AX=mJ({type:L,displayName:"Transition duration",group:"Background Mask"}),TX=mJ({type:L,displayName:"Transition delay",group:"Background Mask"}),PX=Ni.required(),OX=mJ({type:B,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),LX=mJ({type:L,displayName:"Transition duration",group:"Nav Bar Shadow"}),IX=mJ({type:L,displayName:"Transition delay",group:"Nav Bar Shadow"}),RX=mJ({type:[kJ]}),_X=mJ({type:x(On)}),DX=Ni.required(),MX=Ni.onlyRunInLifeCycleAsync,NX=Ni.onlyRunInLifeCycleAsync,BX=Ni.onlyRunInLifeCycle,FX=Ni.onlyRunInLifeCycle,xX=Ni.onlyRunInLifeCycle,zX=Ni.onlyRunInLifeCycleAsync,UX=Ni.onlyRunInLifeCycleAsync,GX=Ni.onlyRunInLifeCycleAsync,SX(HX=bJ(HX=kX((VX=a((qX=function(a){n(b,a);var s,c,d,h,p,y,v,f,g,m=i(b);function b(){var e;t(this,b);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=m.call.apply(m,[this].concat(i)),r(e,"backgroundMask",VX,l(e)),r(e,"backgroundMaskTransitionDuration",$X,l(e)),r(e,"backgroundMaskTransitionDelay",WX,l(e)),r(e,"navBarShadow",KX,l(e)),r(e,"navBarShadowTransitionDuration",jX,l(e)),r(e,"navBarShadowTransitionDelay",YX,l(e)),r(e,"pageItems",XX,l(e)),r(e,"currentScreen",JX,l(e)),r(e,"uiTransform",ZX,l(e)),e}return e(b,[{key:"unmountAndHideAll",value:function(){var e=this;this.pageItems.forEach((function(t){var n=t.page;t.pageType!==e.currentScreen&&(n.unmount(),n.hide())}))}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(P),Ni.validateRequiredProperties(this),D.on($e.VIEW_RESIZED,this.init,this)}},{key:"onDestroy",value:function(){D.off($e.VIEW_RESIZED,this.init,this)}},{key:"init",value:function(){var e=this;this.pageItems.forEach((function(t,n){var i=t.page.getWidget(),a=e.getPageIndex(e.currentScreen);i.right=-(n-a)*e.uiTransform.width,i.left=(n-a)*e.uiTransform.width,i.updateAlignment()}))}},{key:"updateCollectionsContentPayload",value:function(e){var t=this.getPage(On.collections);t&&t instanceof QX&&t.setPayload(e)}},{key:"navigate",value:(g=o((function*(e,t,n,i){var a=e.from,o=e.to;null!==a?yield this.navigateFromPage(a,o,t,n,i):yield this.navigateFromNull(o,n,i)})),function(e,t,n,i){return g.apply(this,arguments)})},{key:"navigateFromPage",value:(f=o((function*(e,t,n,i,a){var o=this,r=this.validateNavigationRequest(e,t),l=r.toPage,s=r.fromPage;this.currentScreen=t;var u=this.uiTransform.width,c=this.getPageIndex(e),d=this.getPageIndex(t),h=Math.min(c,d),p=Math.max(c,d),y=(p-h)*u,v=c<d?1:-1,f=this.pageItems.slice(h,p+1);f.forEach((function(e,t){var n=e.page;n.show(),n.getWidget().enabled=!1,n.node.position=new V((t+h-c)*u,n.node.position.y,n.node.position.z)}));var g=!l.hasLoadedPage();g&&this.showLoadingScreen();var m=this.pageItems.filter((function(e){return e.pageType!==t})),b=function(){return o.cleanupPages(l,m)};n.addAbortListener(b),yield this.mountPage(l,i),yield n.callAsync((function(){return o.performFullTransition({from:e,to:t,fromPage:s,toPage:l,distance:y,direction:v,items:f})})),n.removeAbortListener(b),n.call(b),yield n.callAsync((function(){return o.transitionInPage(l,a)})),g&&this.hideLoadingScreen()})),function(e,t,n,i,a){return f.apply(this,arguments)})},{key:"hideLoadingScreen",value:function(){rt.closeLoadingScreen()}},{key:"showLoadingScreen",value:function(){rt.showLoadingScreen()}},{key:"cleanupPages",value:function(e,t){var n=e.getWidget();n.enabled=!0,n.left=0,n.right=0,ne.instance.emit("canvas-resize");var i,a=u(t);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.page.unmount(),o.page.hide()}}catch(e){a.e(e)}finally{a.f()}}},{key:"performFullTransition",value:(v=o((function*(e){var t=e.from,n=e.to,i=e.fromPage,a=e.distance,o=e.direction,r=e.items,l=e.toPage;this.node.scene.emit(Tn,{from:t,to:n}),yield Promise.all([i.transitionOut(),this.transition(a,o,r),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,l.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,l.getNavbarShadow())])})),function(e){return v.apply(this,arguments)})},{key:"mountPage",value:(y=o((function*(e,t){yield e.mount(),yield null==t?void 0:t(e)})),function(e,t){return y.apply(this,arguments)})},{key:"validateNavigationRequest",value:function(e,t){if(e!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");var n=this.getPage(this.currentScreen),i=this.getPage(t);if(!i||!n)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");return{toPage:i,fromPage:n}}},{key:"navigateFromNull",value:(p=o((function*(e,t,n){var i,a=this.getPage(this.currentScreen);a.show(),this.currentScreen=e,yield this.mountPage(a,t),null!==(i=this.node)&&void 0!==i&&i.scene&&(this.node.scene.emit(Tn,{from:null,to:e}),yield this.transitionInPage(a,n))})),function(e,t,n){return p.apply(this,arguments)})},{key:"transitionInPage",value:(h=o((function*(e,t){yield e.transitionIn(),yield null==t?void 0:t(e)})),function(e,t){return h.apply(this,arguments)})},{key:"getPage",value:function(e){var t,n,i=this.getPageIndex(e);return-1!==i&&null!==(t=null===(n=this.pageItems[i])||void 0===n?void 0:n.page)&&void 0!==t?t:null}},{key:"handleBackgroundMask",value:(d=o((function*(e,t){yield Ve.runTweenAsync(R(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(e,{opacity:t}).start())})),function(e,t){return d.apply(this,arguments)})},{key:"handleNavBarShadow",value:(c=o((function*(e,t){yield Ve.runTweenAsync(R(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(e,{opacity:t}).start())})),function(e,t){return c.apply(this,arguments)})},{key:"getPageIndex",value:function(e){return SJ.searchIndex(this.pageItems,(function(t){return t.pageType===e}))}},{key:"transition",value:(s=o((function*(e,t,n){yield Promise.all(n.map((function(n){var i=n.page;return Ve.runTweenAsync(R(i.node).to(.5,{position:new V(i.node.position.x-e*t,i.node.position.y,i.node.position.z)},{easing:z.quintInOut}))})))})),function(e,t,n){return s.apply(this,arguments)})}]),b}(T)).prototype,"backgroundMask",[CX,EX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$X=a(qX.prototype,"backgroundMaskTransitionDuration",[AX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),WX=a(qX.prototype,"backgroundMaskTransitionDelay",[TX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),KX=a(qX.prototype,"navBarShadow",[PX,OX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jX=a(qX.prototype,"navBarShadowTransitionDuration",[LX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),YX=a(qX.prototype,"navBarShadowTransitionDelay",[IX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),XX=a(qX.prototype,"pageItems",[RX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JX=a(qX.prototype,"currentScreen",[_X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return On.home}}),ZX=a(qX.prototype,"uiTransform",[DX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(qX.prototype,"navigate",[MX],Object.getOwnPropertyDescriptor(qX.prototype,"navigate"),qX.prototype),a(qX.prototype,"navigateFromPage",[NX],Object.getOwnPropertyDescriptor(qX.prototype,"navigateFromPage"),qX.prototype),a(qX.prototype,"hideLoadingScreen",[BX],Object.getOwnPropertyDescriptor(qX.prototype,"hideLoadingScreen"),qX.prototype),a(qX.prototype,"showLoadingScreen",[FX],Object.getOwnPropertyDescriptor(qX.prototype,"showLoadingScreen"),qX.prototype),a(qX.prototype,"cleanupPages",[xX],Object.getOwnPropertyDescriptor(qX.prototype,"cleanupPages"),qX.prototype),a(qX.prototype,"performFullTransition",[zX],Object.getOwnPropertyDescriptor(qX.prototype,"performFullTransition"),qX.prototype),a(qX.prototype,"mountPage",[UX],Object.getOwnPropertyDescriptor(qX.prototype,"mountPage"),qX.prototype),a(qX.prototype,"navigateFromNull",[GX],Object.getOwnPropertyDescriptor(qX.prototype,"navigateFromNull"),qX.prototype),HX=qX))||HX)||HX)||HX);S._RF.pop(),S._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var EJ,AJ,TJ,PJ,OJ,LJ,IJ,RJ,_J,DJ,MJ,NJ,BJ,FJ,xJ,zJ,UJ,GJ,HJ,qJ,VJ,$J,WJ,KJ,jJ,YJ,XJ,JJ,ZJ,QJ,eZ,tZ,nZ,iZ,aZ,oZ,rZ,lZ,sZ,uZ,cZ,dZ,hZ=C.ccclass,pZ=C.property,yZ=Ludex.Utils,vZ=yZ.Array,fZ=yZ.Signal,gZ=Ke.Layout,mZ=(eJ=hZ("NavManager"),tJ=pZ(q),nJ=pZ(q),iJ=pZ(Sn),aJ=pZ({type:I,group:"Widgets"}),oJ=pZ({type:I,group:"Widgets"}),rJ=pZ({type:I,group:"Widgets"}),lJ=pZ(P),eJ((cJ=a((uJ=function(a){n(v,a);var s,c,d,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),r(e,"selectorNode",cJ,l(e)),r(e,"selectedButtonNode",dJ,l(e)),r(e,"autoLayout",hJ,l(e)),r(e,"navWidget",pJ,l(e)),r(e,"backgroundWidget",yJ,l(e)),r(e,"layoutWidget",vJ,l(e)),r(e,"uiTransform",fJ,l(e)),e.navButtons=[],e.selectorAnimationSignal=new fZ.SignalController,e.isNavigating=!1,e}return e(v,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var e;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(e=this.selectedButtonNode)||void 0===e?void 0:e.getComponentInChildren("NavButton"),D.on($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),D.on($e.VIEW_RESIZED,this.handleViewResized,this),this.handleOrientationChanged(Je.getCurrentLayout())}},{key:"onDestroy",value:function(){D.off($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),D.off($e.VIEW_RESIZED,this.handleViewResized,this)}},{key:"select",value:(p=o((function*(e){var t=this;if(!this.isNavigating){if(!vZ.has(this.navButtons,e))throw new Error("NavManager: Button not found");if(e!==this.selectedButton){if(!e.isWIP)return this.isNavigating=!0,this.node.scene.emit(An,{from:this.selectedButton.buttonType,to:e.buttonType}),new Promise((function(n){t.node.scene.once(Tn,(function(){var i=t.selectedButton.deselect();t.autoLayout.selectedIndex=t.navButtons.indexOf(e),t.selectedButton=e;var a=t.autoLayout.getSelectedWorldX()-e.getSelectedWorldDistanceX(),o=t.playSelectorAnimation(a),r=e.select();Promise.all([i,r,o]).then((function(){t.isNavigating=!1,n()}))}))}));this.handleWIPButton()}}})),function(e){return p.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(h=o((function*(e){this.isNavigating||(vZ.has([On.store],e.buttonType)?this.handleWIPButton():yield this.select(e))})),function(e){return h.apply(this,arguments)})},{key:"selectByType",value:(d=o((function*(e){var t=vZ.search(this.navButtons,(function(t){return t.buttonType===e}));if(!t)throw new Error("NavManager: Button not found");yield this.selectUsingSceneTransition(t)})),function(e){return d.apply(this,arguments)})},{key:"handleWIPButton",value:function(){rt.openScreen(lt.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(c=o((function*(){var e=this;if(!this.currentButton||!vZ.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");var t=this.currentButton.buttonType;return this.node.scene.emit(An,{from:null,to:t}),new Promise((function(t){e.node.scene.once(Tn,(function(){e.autoLayout.selectedIndex=e.navButtons.indexOf(e.currentButton);var n=e.navButtons.map((function(t){return t===e.currentButton?t.select(!1):t.deselect(!1,!0)})),i=e.autoLayout.getSelectedWorldX()-e.currentButton.getSelectedWorldDistanceX();e.selectorNode.worldPosition=new V(i,e.selectorNode.worldPosition.y,0),Promise.all(n).then((function(){t()}))}))}))})),function(){return c.apply(this,arguments)})},{key:"playSelectorAnimation",value:(s=o((function*(e){var t=this,n=this.selectorAnimationSignal.renew(),i=new V(1,1,1),a=this.selectorNode.worldPosition.clone(),o=new V(1.2*i.x,.8*i.y,1),r=R(this.selectorNode).to(.3,{worldPosition:new V(e,a.y,0)},{easing:"quintInOut",onUpdate:function(e,n){if(void 0!==n){var a=t.calculateCurrentSquashScale(i,o,n);t.selectorNode.scale=a}}});yield Ve.runTweenAsync(r,n),this.selectorNode.scale=i})),function(e){return s.apply(this,arguments)})},{key:"setIgnoreInput",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=u(this.navButtons);try{for(n.s();!(e=n.n()).done;){var i=e.value,a=i.getComponentInChildren(G);a&&(a.interactable=!t)}}catch(e){n.e(e)}finally{n.f()}}},{key:"calculateCurrentSquashScale",value:function(e,t,n){var i=this.splitIntoSquashRatio(n);return e.clone().lerp(t,i)}},{key:"splitIntoSquashRatio",value:function(e){return e<.5?2*e:1-2*(e-.5)}},{key:"handleOrientationChanged",value:function(e){e===gZ.Portrait?(this.navWidget.isAlignLeft=!0,this.navWidget.isAlignRight=!0,this.backgroundWidget.left=-50,this.backgroundWidget.right=-50,this.layoutWidget.left=0,this.layoutWidget.right=0):e===gZ.Landscape&&(this.navWidget.isAlignLeft=!1,this.navWidget.isAlignRight=!1,this.backgroundWidget.left=0,this.backgroundWidget.right=0,this.layoutWidget.left=25,this.layoutWidget.right=25,this.uiTransform.width=1e3)}},{key:"handleViewResized",value:function(){this.selectedButton&&(this.selectorAnimationSignal.abort(),this.selectorNode.worldPositionX=this.selectedButton.node.worldPosition.x,this.selectorNode.y=-164.5)}}]),v}(T)).prototype,"selectorNode",[tJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dJ=a(uJ.prototype,"selectedButtonNode",[nJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hJ=a(uJ.prototype,"autoLayout",[iJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pJ=a(uJ.prototype,"navWidget",[aJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yJ=a(uJ.prototype,"backgroundWidget",[oJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vJ=a(uJ.prototype,"layoutWidget",[rJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fJ=a(uJ.prototype,"uiTransform",[lJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sJ=uJ))||sJ);S._RF.pop(),S._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var bZ,wZ=C.ccclass,SZ=C.disallowMultiple,kZ=C.property,CZ=codex,EZ=CZ.storage,AZ=CZ.player,TZ=CZ.monitorError,PZ=Ludex,OZ=PZ.Match.Modes,LZ=PZ.Utils.Array;EJ=wZ("DashboardScene"),AJ=Ni.required(),TJ=kZ(wS),PJ=Ni.required(),OJ=kZ(mZ),LJ=Ni.required(),IJ=kZ(Gi),RJ=Ni.required(),_J=kZ(CJ),DJ=Ni.required(),MJ=kZ(GG),NJ=Ni.required(),BJ=kZ(qr),FJ=Ni.onlyRunInLifeCycle,xJ=Ni.onlyRunInLifeCycle,zJ=Ni.onlyRunInLifeCycle,UJ=Ni.onlyRunInLifeCycle,GJ=Ni.onlyRunInLifeCycle,HJ=Ni.onlyRunInLifeCycle,qJ=Ni.onlyRunInLifeCycle,VJ=Ni.onlyRunInLifeCycleAsync,$J=Ni.onlyRunInLifeCycleAsync,WJ=Ni.onlyRunInLifeCycleAsync,KJ=Ni.onlyRunInLifeCycleAsync,jJ=Ni.onlyRunInLifeCycle,YJ=Ni.onlyRunInLifeCycleAsync,XJ=Ni.onlyRunInLifeCycleAsync,JJ=Ni.onlyRunInLifeCycleAsync,ZJ=Ni.onlyRunInLifeCycleAsync,QJ=Ni.onlyRunInLifeCycleAsync,eZ=Ni.onlyRunInLifeCycleAsync,tZ=Ni.onlyRunInLifeCycle,nZ=Ni.onlyRunInLifeCycleAsync,iZ=Ni.onlyRunInLifeCycle,EJ(aZ=SZ((rZ=a((oZ=function(a){n(A,a);var c,d,h,p,y,v,f,g,m,b,w,S,k,C,E=i(A);function A(){var e;t(this,A);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=E.call.apply(E,[this].concat(i)),r(e,"coinManager",rZ,l(e)),r(e,"navManager",lZ,l(e)),r(e,"bgComp",sZ,l(e)),r(e,"pageManager",uZ,l(e)),r(e,"pageAnimSkipOverlay",cZ,l(e)),r(e,"transitionOpacityToggler",dZ,l(e)),e.firstNavigation=!0,e.isFirstNavToCollections=!0,e.isFirstNavToTournament=!0,e.navigationSignal=null,e}return e(A,[{key:"listenNavigationEvents",value:function(){this.node.scene.on(An,this.onNavigate,this)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(Cn,this.handleDashboardPlayButtonPress,this),this.node.scene.on(En,this.handleCustomPlayButtonPress,this),this.node.scene.on(Pn,this.handleEventButtonPress,this)}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this),this.listenNavigationEvents(),this.listenDashboardEvents(),this.coinManager.init(),Fy.init(),this.setPlayerLevel(),this.updateBackgroundImageToCurrentTheme(),this.pageManager.updateCollectionsContentPayload(Fy.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var e,t=(null!==(e=AZ.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=0===n?1:n,AZ.setGameData({level:n})}},{key:"start",value:function(){AZ.getPlayerSetting("music")&&this.updateMusic(),this.pageManager.init(),this.navManager.selectDefaultNavBtn(),this.scheduleOnce(this.preloadScene,5),this.scheduleOnce(this.preloadSkins,3),this.scheduleOnce(this.preloadScreens,10)}},{key:"preloadScene",value:function(){ct.isSceneLoaded(yt.GAME_SCENE)||ct.preloadGameScene()}},{key:"preloadScreens",value:function(){var e;rt.preloadScreen(lt.LOADING_SCREEN),rt.preloadScreen(lt.NOTIFICATION_SCREEN),rt.preloadScreen(lt.SETTINGS_SCREEN),rt.preloadScreen(lt.GET_COIN_SCREEN),rt.preloadScreen(lt.STAR_CHEST_SCREEN),rt.preloadScreen(lt.DAILY_REWARDS_SCREEN);var t=AZ.getGameData();(null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1)>=13&&rt.preloadScreen(lt.CUSTOM_GAME_SCREEN)}},{key:"preloadSkins",value:function(){var e,t=Fy.getUnlockedSkins(),n=u(t);try{for(n.s();!(e=n.n()).done;){var i=e.value,a="".concat(nt.TILE_SKIN_FOLDER,"/").concat(i);qe.loadSpriteFramesDirAsync(a)}}catch(e){n.e(e)}finally{n.f()}}},{key:"attemptCallSubscribeBot",value:function(){GameSDK.isGameSDK("FacebookInstant")&&GameSDK.extra.checkAndSubscribeBotAsync().catch((function(e){console.warn("subscribeBotAsync",e)}))}},{key:"updateBackgroundImageToCurrentTheme",value:function(){var e,t=EZ.getStorage("dashboard");if(null!=t){var n=null!==(e=t.animateToCurrentLevel)&&void 0!==e&&e,i=s({},t.lastMapPayload),a=Fy.getCurrentMapProgress(),o=i.currentTheme===a.currentTheme&&i.nextTheme===a.nextTheme,r=a.currentTheme;!n||o||this.isDevToolTimeTravel(i.id,a.id)?this.bgComp.setCurrentTheme(r):this.bgComp.setCurrentTheme(i.currentTheme)}else null==TZ||TZ.sendException(new Error("DashboardScene: dashboardStorage not found"))}},{key:"isDevToolTimeTravel",value:function(e,t){return LZ.searchIndex(Iy.mapOrder,(function(t){return t.id===e}))>LZ.searchIndex(Iy.mapOrder,(function(e){return e.id===t}))}},{key:"handleDashboardPlayButtonPress",value:function(){this.handlePlayButtonPress(OZ.SINGLE)}},{key:"handleCustomPlayButtonPress",value:function(){this.handlePlayButtonPress(ev)}},{key:"handlePlayButtonPress",value:(C=o((function*(e){try{var t;ot.setBlockInput(!0);var n=Fy.getCurrentMapProgress(),i=(null!==(t=AZ.getGameData())&&void 0!==t?t:{}).level,a=void 0===i?1:i;yield Xy.setMatchCustomDataAsync({level:a}),yield Xy.startMatchAsync(e),this.updateCurrentMapInStorage(n),EZ.setStorageData("collection","lastMapPack",n.id),EZ.setStorageData("collection","animateMapPackUnlock",!1),yield this.switchToGameScene(a)}catch(e){ot.setBlockInput(!1),console.error(e)}})),function(e){return C.apply(this,arguments)})},{key:"switchToGameScene",value:(k=o((function*(e){ct.isSceneLoaded(yt.GAME_SCENE)&&(yield this.transitionOpacityToggler.changeStateFade(!0,.25)),ct.switchToGameScene({level:e})})),function(e){return k.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(e){EZ.setStorageData("dashboard","animateToCurrentLevel",!1),EZ.setStorageData("dashboard","lastMapPayload",e)}},{key:"updateMusic",value:(S=o((function*(){je.getCurrentMusic()!==Qi.BG_MUSIC&&(yield je.setVolumeMusic(0,!0),yield Ve.waitTweenAsync(1)),je.playMusic(Qi.BG_MUSIC),je.turnUpMusic()})),function(){return S.apply(this,arguments)})},{key:"onNavigate",value:(w=o((function*(e){switch(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),e.to){case On.store:break;case On.collections:yield this.triggerPageNavigation(e),yield this.handleLogicAfterNavigateToCollections(),this.cleanupAfterPageNavigation();break;case On.tournaments:rt.preloadScreen(lt.TOURNAMENT_DETAIL_SCREEN),yield this.triggerPageNavigation(e),this.cleanupAfterPageNavigation();break;case On.leaderboard:yield this.triggerPageNavigation(e),this.cleanupAfterPageNavigation();break;case On.home:yield this.handleNavigateToHome(e);break;default:throw new Error("DashboardScene: Unhandled page name")}})),function(e){return w.apply(this,arguments)})},{key:"handleLogicAfterNavigateToCollections",value:(b=o((function*(){var e,t=null===(e=this.pageManager.getPage(On.collections))||void 0===e?void 0:e.getContainer().getComponentInChildren(VV);if(null==t)throw new Error("CollectionsContent not found");var n=new In,i=t.shouldAnimateThemeBlockUnlock();i&&(yield this.openSkipOverlay(n)),yield this.tryPlayScrollToCollectionAnim(t,n),yield t.playThemeTabUnlockAnim(n),i&&(yield this.closeSkipOverlay()),n.abort()})),function(){return b.apply(this,arguments)})},{key:"closeSkipOverlay",value:(m=o((function*(){yield this.pageAnimSkipOverlay.close()})),function(){return m.apply(this,arguments)})},{key:"openSkipOverlay",value:(g=o((function*(e){yield this.pageAnimSkipOverlay.open({onSkip:function(){return e.abort()},opacity:200})})),function(e){return g.apply(this,arguments)})},{key:"tryPlayScrollToCollectionAnim",value:(f=o((function*(e,t){var n=Fy.getCurrentUnlockingThemeIndex();this.isFirstNavToCollections&&null!==n&&(yield e.scrollToCurrentUnlockingTheme(n,t),this.isFirstNavToCollections=!1)})),function(e,t){return f.apply(this,arguments)})},{key:"cleanupAfterPageNavigation",value:function(){this.navManager.setIgnoreInput(!1)}},{key:"triggerPageNavigation",value:(v=o((function*(e){var t;null===(t=this.navigationSignal)||void 0===t||t.abort(),this.navigationSignal=new In,yield this.pageManager.navigate(e,this.navigationSignal)})),function(e){return v.apply(this,arguments)})},{key:"handleNavigateToHome",value:(y=o((function*(e){var t,n=this;null===(t=this.navigationSignal)||void 0===t||t.abort(),this.navigationSignal=new In,yield this.pageManager.navigate(e,this.navigationSignal,o((function*(){n.initializeHomepageCoinManager()}))),yield this.handleLogicAfterNavigateToHome()})),function(e){return y.apply(this,arguments)})},{key:"handleLogicAfterNavigateToHome",value:(p=o((function*(){oq.hasShownPopup()||this.shouldPlayLevelUpAnimation()||(yield oq.hasClaimableRewards())&&(yield oq.openPopupScreenAndWaitForClose()),this.attemptCallSubscribeBot(),yield this.waitUntilCoinManagerFinishesAnyAnimation(),yield this.waitUntilPageAnimSkipOverlayCloses(),yield this.tryNavigateToTournament(),yield this.tryPlayLevelUpAnimation(),yield this.tryShowCustomModeGuide()})),function(){return p.apply(this,arguments)})},{key:"waitUntilCoinManagerFinishesAnyAnimation",value:function(){return this.coinManager.untilFinishesCollectAnim()}},{key:"waitUntilPageAnimSkipOverlayCloses",value:function(){return this.pageAnimSkipOverlay.untilClosed()}},{key:"tryNavigateToTournament",value:(h=o((function*(){if(EZ.getStorage("tournament").animateTournamentLeader)return yield this.navManager.selectByType(On.tournaments);if(this.isFirstNavToTournament){this.isFirstNavToTournament=!1;try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");if((yield GameSDK.getTournamentAsync()).getEndTime()<Date.now()/1e3)return yield this.navManager.selectByType(On.tournaments)}catch(e){}}})),function(){return h.apply(this,arguments)})},{key:"shouldPlayLevelUpAnimation",value:function(){var e;if(!this.enabledInHierarchy)return!1;var t=null===(e=this.pageManager.getPage(On.home))||void 0===e?void 0:e.getContainer().getComponentInChildren(QY);if(null==t)return!1;var n=t.shouldPlayUnlockAnimation(),i=this.shouldPlayPackUnlockAnimation();return n||i}},{key:"tryPlayLevelUpAnimation",value:(d=o((function*(){var e,t=this,n=null===(e=this.pageManager.getPage(On.home))||void 0===e?void 0:e.getContainer().getComponentInChildren(QY);if(null==n)throw new Error("DashboardScene: Homepage not found");var i=new In;this.navigationSignal&&i.chain(this.navigationSignal);var a=n.shouldPlayUnlockAnimation(),o=this.shouldPlayPackUnlockAnimation();a&&(o&&(yield this.pageAnimSkipOverlay.open({onSkip:function(){return i.abort()},opacity:150})),yield n.playUnlockProgressAnimation(i),this.updateBackgroundImageToCurrentTheme(),o&&(yield this.pageAnimSkipOverlay.close(),yield i.callAsync((function(){return t.navManager.selectByType(On.collections)}))))})),function(){return d.apply(this,arguments)})},{key:"shouldPlayPackUnlockAnimation",value:function(){var e=EZ.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");var t=e.lastMapPayload,n=Fy.getCurrentMapProgress();return!(LZ.searchIndex(Iy.mapOrder,(function(e){return e.id===t.id}))===LZ.searchIndex(Iy.mapOrder,(function(e){return e.id===n.id})))}},{key:"initializeHomepageCoinManager",value:function(){var e,t=null===(e=this.pageManager.getPage(On.home))||void 0===e?void 0:e.getContainer().getComponentInChildren(QY);if(null==t)throw new Error("DashboardScene: Homepage not found");this.coinManager.setTargetContainer(t.getCoinContainer()),this.coinManager.emitCoinAmount()}},{key:"tryShowCustomModeGuide",value:(c=o((function*(){var e,t,n=null!==(e=AZ.getGameData())&&void 0!==e?e:{},i=n.level,a=void 0===i?1:i,o=n.guideItemShowed,r=void 0===o?[]:o;if(13===a&&!LZ.has(r,uI)){r.push(uI),AZ.setGameData({guideItemShowed:r});var l=null===(t=this.pageManager.getPage(On.home))||void 0===t?void 0:t.getContainer().getComponentInChildren(QY);if(null==l)throw new Error("DashboardScene: Homepage not found");yield l.showCustomGuide()}})),function(){return c.apply(this,arguments)})},{key:"handleEventButtonPress",value:function(e){switch(e.type){case yU.STAR_CHEST:rt.openScreen(lt.STAR_CHEST_SCREEN);break;case yU.DAILY_REWARDS:oq.openPopupScreen();break;case yU.BALLOON:rt.showNotificationScreenWithLocalizedKey("error.soon");break;default:throw new Error("DashboardScene: Unhandled event button type")}}},{key:"handleTestLayoutButtonClicked",value:function(){}}]),A}(T)).prototype,"coinManager",[AJ,TJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lZ=a(oZ.prototype,"navManager",[PJ,OJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sZ=a(oZ.prototype,"bgComp",[LJ,IJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uZ=a(oZ.prototype,"pageManager",[RJ,_J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cZ=a(oZ.prototype,"pageAnimSkipOverlay",[DJ,MJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dZ=a(oZ.prototype,"transitionOpacityToggler",[NJ,BJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(oZ.prototype,"preloadScene",[FJ],Object.getOwnPropertyDescriptor(oZ.prototype,"preloadScene"),oZ.prototype),a(oZ.prototype,"preloadScreens",[xJ],Object.getOwnPropertyDescriptor(oZ.prototype,"preloadScreens"),oZ.prototype),a(oZ.prototype,"preloadSkins",[zJ],Object.getOwnPropertyDescriptor(oZ.prototype,"preloadSkins"),oZ.prototype),a(oZ.prototype,"attemptCallSubscribeBot",[UJ],Object.getOwnPropertyDescriptor(oZ.prototype,"attemptCallSubscribeBot"),oZ.prototype),a(oZ.prototype,"updateBackgroundImageToCurrentTheme",[GJ],Object.getOwnPropertyDescriptor(oZ.prototype,"updateBackgroundImageToCurrentTheme"),oZ.prototype),a(oZ.prototype,"handleDashboardPlayButtonPress",[HJ],Object.getOwnPropertyDescriptor(oZ.prototype,"handleDashboardPlayButtonPress"),oZ.prototype),a(oZ.prototype,"handleCustomPlayButtonPress",[qJ],Object.getOwnPropertyDescriptor(oZ.prototype,"handleCustomPlayButtonPress"),oZ.prototype),a(oZ.prototype,"handlePlayButtonPress",[VJ],Object.getOwnPropertyDescriptor(oZ.prototype,"handlePlayButtonPress"),oZ.prototype),a(oZ.prototype,"onNavigate",[$J],Object.getOwnPropertyDescriptor(oZ.prototype,"onNavigate"),oZ.prototype),a(oZ.prototype,"handleLogicAfterNavigateToCollections",[WJ],Object.getOwnPropertyDescriptor(oZ.prototype,"handleLogicAfterNavigateToCollections"),oZ.prototype),a(oZ.prototype,"tryPlayScrollToCollectionAnim",[KJ],Object.getOwnPropertyDescriptor(oZ.prototype,"tryPlayScrollToCollectionAnim"),oZ.prototype),a(oZ.prototype,"cleanupAfterPageNavigation",[jJ],Object.getOwnPropertyDescriptor(oZ.prototype,"cleanupAfterPageNavigation"),oZ.prototype),a(oZ.prototype,"triggerPageNavigation",[YJ],Object.getOwnPropertyDescriptor(oZ.prototype,"triggerPageNavigation"),oZ.prototype),a(oZ.prototype,"handleNavigateToHome",[XJ],Object.getOwnPropertyDescriptor(oZ.prototype,"handleNavigateToHome"),oZ.prototype),a(oZ.prototype,"waitUntilCoinManagerFinishesAnyAnimation",[JJ],Object.getOwnPropertyDescriptor(oZ.prototype,"waitUntilCoinManagerFinishesAnyAnimation"),oZ.prototype),a(oZ.prototype,"waitUntilPageAnimSkipOverlayCloses",[ZJ],Object.getOwnPropertyDescriptor(oZ.prototype,"waitUntilPageAnimSkipOverlayCloses"),oZ.prototype),a(oZ.prototype,"tryNavigateToTournament",[QJ],Object.getOwnPropertyDescriptor(oZ.prototype,"tryNavigateToTournament"),oZ.prototype),a(oZ.prototype,"tryPlayLevelUpAnimation",[eZ],Object.getOwnPropertyDescriptor(oZ.prototype,"tryPlayLevelUpAnimation"),oZ.prototype),a(oZ.prototype,"initializeHomepageCoinManager",[tZ],Object.getOwnPropertyDescriptor(oZ.prototype,"initializeHomepageCoinManager"),oZ.prototype),a(oZ.prototype,"tryShowCustomModeGuide",[nZ],Object.getOwnPropertyDescriptor(oZ.prototype,"tryShowCustomModeGuide"),oZ.prototype),a(oZ.prototype,"handleEventButtonPress",[iZ],Object.getOwnPropertyDescriptor(oZ.prototype,"handleEventButtonPress"),oZ.prototype),aZ=oZ))||aZ);S._RF.pop(),S._RF.push({},"1be4fAboTNK3IFk6IiygYLZ","PageContent",void 0);var IZ,RZ,_Z,DZ,MZ,NZ,BZ,FZ=C.ccclass,xZ=Ke.Layout;FZ("PageContent")(bZ=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"__preload",value:function(){this.widget=this.getComponent(I),this.uiTransform=this.getComponent(P)}},{key:"onLoad",value:function(){D.on($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Je.getCurrentLayout())}},{key:"onDestroy",value:function(){D.off($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:function(e){e===xZ.Portrait?(this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0):e===xZ.Landscape&&(this.widget.isAlignLeft=!1,this.widget.isAlignRight=!1,this.uiTransform.width=1e3)}}]),r}(T));S._RF.pop(),S._RF.push({},"c68178FyxlCOqbCt/+wktvw","PageHeader",void 0);var zZ,UZ,GZ,HZ,qZ,VZ,$Z,WZ,KZ,jZ,YZ,XZ,JZ=C.ccclass,ZZ=C.property,QZ=Ke.Layout;IZ=JZ("PageHeader"),RZ=Ni.required,_Z=ZZ(I),DZ=Ni.onlyRunInLifeCycleAsync,IZ((BZ=a((NZ=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"widget",BZ,l(e)),e}return e(d,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,d),Je.isLandscape()&&this.loadLeaves()}},{key:"onLoad",value:function(){D.on($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Je.getCurrentLayout())}},{key:"onDestroy",value:function(){D.off($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:(u=o((function*(e){e===QZ.Portrait?(this.leaves&&(this.leaves.active=!1),this.widget.left=-80,this.widget.right=-80):e===QZ.Landscape&&(this.widget.left=0,this.widget.right=0,yield this.loadLeaves(),this.leaves&&(this.leaves.active=!0))})),function(e){return u.apply(this,arguments)})},{key:"loadLeaves",value:(s=o((function*(){if(!this.leaves){var e=yield qe.loadPrefabAsync(nt.PAGE_LEAVES_PREFAB);!this.leaves&&e&&this.enabledInHierarchy&&(this.leaves=ye(e),this.node.addChild(this.leaves))}})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"widget",[RZ,_Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(NZ.prototype,"loadLeaves",[DZ],Object.getOwnPropertyDescriptor(NZ.prototype,"loadLeaves"),NZ.prototype),MZ=NZ));S._RF.pop(),S._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var eQ,tQ,nQ,iQ,aQ,oQ,rQ,lQ,sQ,uQ,cQ,dQ,hQ=C.ccclass,pQ=C.property,yQ=codex,vQ=yQ.player,fQ=yQ.storage,gQ=yQ.monitorError,mQ=Ludex.Utils.Number;zZ=hQ("HomePage"),UZ=Ni.required(),GZ=pQ({type:K,group:"Placeholders"}),HZ=Ni.required(),qZ=Ni.onlyRunInLifeCycleAsync,VZ=Ni.onlyRunInLifeCycle,$Z=Ni.onlyRunInLifeCycleAsync,WZ=Ni.onlyRunInLifeCycleAsync,zZ((YZ=a((jZ=function(a){n(f,a);var u,h,p,y,v=i(f);function f(){var e;t(this,f);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=v.call.apply(v,[this].concat(i)),r(e,"coinLabel",YZ,l(e)),r(e,"panelAnimationController",XZ,l(e)),e}return e(f,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(qs),c(d(f.prototype),"onLoad",this).call(this)}},{key:"onEnable",value:function(){this.node.scene.on(Es.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"onDisable",value:function(){this.node.scene.off(Es.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"updatePlaceholderCoins",value:(y=o((function*(e){this.coinLabel.string=mQ.getShortNumber(e.coins,3)})),function(e){return y.apply(this,arguments)})},{key:"mount",value:(p=o((function*(){yield c(d(f.prototype),"mount",this).call(this),this.onMount()})),function(){return p.apply(this,arguments)})},{key:"onMount",value:function(){var e;if(!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(QY),!this.homeContent))throw new Error("HomePage: homeContent not found");var t=(null!==(e=vQ.getGameData())&&void 0!==e?e:{}).coins,n=void 0===t?0:t;this.updatePlaceholderCoins({coins:n}),this.homeContent.updateStatus(),this.initUnlockProgressData()}},{key:"initUnlockProgressData",value:function(){var e=this.homeContent.shouldPlayUnlockAnimation(),t=s({},Fy.getCurrentMapProgress()),n=fQ.getStorage("dashboard");if(null==n)return null==gQ||gQ.sendException(new Error("DashboardScene: dashboardStorage not found")),void(e||this.homeContent.setUnlockProgress(t));var i=s({},n.lastMapPayload);e?this.homeContent.setUnlockProgress(i):this.homeContent.setUnlockProgress(t)}},{key:"transitionIn",value:(h=o((function*(){this.homeContent.transitionIn(),yield c(d(f.prototype),"transitionIn",this).call(this),yield this.panelAnimationController.showUI()})),function(){return h.apply(this,arguments)})},{key:"transitionOut",value:(u=o((function*(){this.homeContent.transitionOut(),yield c(d(f.prototype),"transitionOut",this).call(this),yield this.panelAnimationController.hideUI()})),function(){return u.apply(this,arguments)})},{key:"hasLoadedPage",value:function(){return!0}}]),f}(pX)).prototype,"coinLabel",[UZ,GZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XZ=a(jZ.prototype,"panelAnimationController",[HZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(jZ.prototype,"mount",[qZ],Object.getOwnPropertyDescriptor(jZ.prototype,"mount"),jZ.prototype),a(jZ.prototype,"onMount",[VZ],Object.getOwnPropertyDescriptor(jZ.prototype,"onMount"),jZ.prototype),a(jZ.prototype,"transitionIn",[$Z],Object.getOwnPropertyDescriptor(jZ.prototype,"transitionIn"),jZ.prototype),a(jZ.prototype,"transitionOut",[WZ],Object.getOwnPropertyDescriptor(jZ.prototype,"transitionOut"),jZ.prototype),KZ=jZ));S._RF.pop(),S._RF.push({},"73dd1GUhlNKPJc27Ls4gr6D","JoinLeaderboardContainer",void 0);var bQ,wQ,SQ,kQ,CQ,EQ,AQ,TQ,PQ,OQ,LQ,IQ,RQ,_Q,DQ,MQ,NQ,BQ,FQ,xQ,zQ=C.ccclass,UQ=C.property,GQ=(eQ=zQ("JoinLeaderboardContainer"),tQ=Ni.required,nQ=UQ(I),iQ=Ni.required,aQ=UQ(P),oQ=Ni.required,rQ=UQ(q),eQ((uQ=a((sQ=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"widget",uQ,l(e)),r(e,"uiTransform",cQ,l(e)),r(e,"joinButton",dQ,l(e)),e}return e(c,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,c)}},{key:"updatePosition",value:function(e){void 0!==e?(this.widget.enabled=!1,this.node.setWorldPosition(this.node.worldPosition.x,e,this.node.worldPosition.z)):(this.widget.enabled=!0,this.widget.updateAlignment())}},{key:"show",value:(s=o((function*(e){if(null==e||!e.aborted){this.joinButton.active=!0;var t=R(this.joinButton).set({scale:V.ZERO}).to(.5,{scale:V.ONE},{easing:"backOut"});yield Ve.runTweenAsync(t,e)}})),function(e){return s.apply(this,arguments)})},{key:"hide",value:function(){this.joinButton.active=!1}}]),c}(T)).prototype,"widget",[tQ,nQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cQ=a(sQ.prototype,"uiTransform",[iQ,aQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dQ=a(sQ.prototype,"joinButton",[oQ,rQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lQ=sQ))||lQ);S._RF.pop(),S._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var HQ,qQ,VQ,$Q,WQ,KQ,jQ,YQ=C.ccclass,XQ=C.property,JQ=C.requireComponent,ZQ=codex.analytics,QQ=Ludex,e0=QQ.Utils,t0=e0.Array,n0=e0.Valid,i0=QQ.Plugins.Analytics,a0=(void 0===i0?{}:i0).Events,o0=(bQ=YQ("SwitchButton"),wQ=JQ([G,ce]),SQ=XQ(W),kQ=XQ(q),CQ=XQ(q),EQ=XQ(W),AQ=XQ({visible:function(){return this.useSound},type:ta}),TQ=XQ(W),PQ=XQ({visible:function(){return this.useDesktopHover},type:de}),OQ=XQ({visible:function(){return this.useDesktopHover},type:de}),bQ(LQ=wQ((RQ=a((IQ=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"enable",RQ,l(e)),r(e,"nodeOn",_Q,l(e)),r(e,"nodeOff",DQ,l(e)),r(e,"useSound",MQ,l(e)),r(e,"soundKey",NQ,l(e)),r(e,"useDesktopHover",BQ,l(e)),r(e,"mouseEnterClip",FQ,l(e)),r(e,"mouseLeaveClip",xQ,l(e)),e.isMouseLeaved=!1,e.onMouseEnter=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved=!1,e.animationComponent.play(e.mouseEnterClip.name))},e.onMouseLeave=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved||(e.isMouseLeaved=!0,e.animationComponent.play(e.mouseLeaveClip.name)))},e}return e(s,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(G),this.animationComponent=this.getComponent(ce),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var e=this.animationComponent.clips.map((function(e){return null==e?void 0:e.name})).filter((function(e){return null!=e&&"string"==typeof e}));this.useDesktopHover&&(t0.has(e,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),t0.has(e,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(q.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(q.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(q.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(q.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(a0&&ZQ.event(a0.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&n0.isString(this.soundKey)&&je.playSound(Ra[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(e){this.node.active&&this.updateStatus(e)}},{key:"updateStatus",value:function(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}]),s}(T)).prototype,"enable",[SQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_Q=a(IQ.prototype,"nodeOn",[kQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DQ=a(IQ.prototype,"nodeOff",[CQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MQ=a(IQ.prototype,"useSound",[EQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),NQ=a(IQ.prototype,"soundKey",[AQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ta[Qi.BUTTON_CLICK]}}),BQ=a(IQ.prototype,"useDesktopHover",[TQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),FQ=a(IQ.prototype,"mouseEnterClip",[PQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xQ=a(IQ.prototype,"mouseLeaveClip",[OQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LQ=IQ))||LQ)||LQ);S._RF.pop(),S._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var r0,l0,s0,u0,c0,d0,h0,p0,y0,v0=C.ccclass,f0=C.property,g0=codex.analytics,m0=Ludex.Plugins.Analytics,b0=(void 0===m0?{}:m0).Events,w0=(HQ=v0("Tabs"),qQ=f0(o0),VQ=f0(o0),HQ((KQ=a((WQ=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"tabDaily",KQ,l(e)),r(e,"tabWeekly",jQ,l(e)),e}return e(s,[{key:"setInteractableButtons",value:function(e){this.tabDaily.getComponent(G).interactable=e,this.tabWeekly.getComponent(G).interactable=e}},{key:"updateStatus",value:function(e){this.tabDaily.setEnabled(e===Ay),this.tabWeekly.setEnabled(e===Ty)}},{key:"handleTabDailySelect",value:function(){this.tabDaily.setEnabled(!0),this.tabWeekly.setEnabled(!1),je.playSound(Qi.BUTTON_CLICK),b0&&g0.event(b0.BUTTON_CLICK,{button_name:this.node.name,screen_name:Ye.getCurrentPage()}),this.node.scene.emit(fU.WORLD_TAB_SELECTED)}},{key:"handleTabWeeklySelect",value:function(){this.tabDaily.setEnabled(!1),this.tabWeekly.setEnabled(!0),je.playSound(Qi.BUTTON_CLICK),b0&&g0.event(b0.BUTTON_CLICK,{button_name:this.node.name,screen_name:Ye.getCurrentPage()}),this.node.scene.emit(fU.WEEKLY_TAB_SELECTED)}}]),s}(T)).prototype,"tabDaily",[qQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jQ=a(WQ.prototype,"tabWeekly",[VQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$Q=WQ))||$Q);S._RF.pop(),S._RF.push({},"91613SO4bxPDq9dH9zxyIef","LeaderboardTimer",void 0);var S0,k0,C0,E0,A0,T0=C.ccclass,P0=C.property,O0=Ludex.Utils.Time,L0=codex.language,I0=(r0=T0("LeaderboardTimer"),l0=P0(P),s0=P0(q),u0=P0(Kd),r0((h0=a((d0=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"background",h0,l(e)),r(e,"calendar",p0,l(e)),r(e,"timerLocalizer",y0,l(e)),e.alreadyShown=!1,e}return e(c,[{key:"onLoad",value:function(){this.timerOpacity=this.timerLocalizer.node.getComponent(B),this.validateRequiredComponents(),this.backgroundDefaultWidth=this.background.width,this.calendarDefaultPosition=this.calendar.position.clone()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"show",value:(s=o((function*(e){if(!this.alreadyShown&&!e.aborted){this.alreadyShown=!0;var t=R(this.calendar).to(.3,{scale:V.ONE},{easing:"backOut"}).to(.3,{position:this.calendarDefaultPosition.clone()},{easing:"quadOut"}),n=R(this.background).delay(.3).to(.3,{width:this.backgroundDefaultWidth},{easing:"quadOut"}),i=R(this.timerOpacity).to(.3,{opacity:255});yield Promise.all([Ve.runTweenAsync(t,e),Ve.runTweenAsync(n,e)]),this.calendar.scale=V.ONE,this.calendar.position=this.calendarDefaultPosition.clone(),this.background.width=this.backgroundDefaultWidth,yield Ve.runTweenAsync(i,e),this.timerOpacity.opacity=255}})),function(e){return s.apply(this,arguments)})},{key:"reset",value:function(){this.alreadyShown||(this.calendar.position=this.background.node.position.clone(),this.calendar.scale=V.ZERO,this.background.width=0,this.timerOpacity.opacity=0)}},{key:"setTimeLabel",value:function(e){if(e){var t=new Date,n=0;if("manually"===e)n=0;else if("daily"===e)n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+1);else if("weekly"===e){var i=t.getUTCDay(),a=0===i?1:8-i;n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+a)}else n="monthly"===e?Date.UTC(t.getUTCFullYear(),t.getUTCMonth()+1):Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+1);try{var o=O0.getRelativeTime(n/1e3,L0.getCurrentLocale());this.timerLocalizer.key="game.endsIn",this.timerLocalizer.setParams([o])}catch(e){this.timerLocalizer.key="game.endsSoon"}}else this.timerLocalizer.key="status.loading"}}]),c}(T)).prototype,"background",[l0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p0=a(d0.prototype,"calendar",[s0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y0=a(d0.prototype,"timerLocalizer",[u0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c0=d0))||c0);S._RF.pop(),S._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var R0,_0,D0,M0,N0,B0,F0,x0,z0,U0,G0,H0,q0,V0,$0,W0,K0,j0,Y0,X0,J0,Z0,Q0,e1,t1,n1,i1,a1,o1,r1,l1,s1,u1,c1,d1,h1,p1,y1,v1,f1,g1,m1,b1,w1,S1=C.ccclass,k1=C.disallowMultiple,C1=C.property,E1=(S0=S1("LeaderSkeleton"),k0=C1(q),S0(C0=k1((A0=a((E0=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"container",A0,l(e)),e}return e(d,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(B),this.validateRequiredComponents()}},{key:"hide",value:(u=o((function*(e){var t=this;yield Ve.runTweenAsync(R(this.uiOpacity).to(.2,{opacity:0}).call((function(){t.node.active=!1})),e)})),function(e){return u.apply(this,arguments)})},{key:"show",value:(s=o((function*(e,t){var n=this;this.node.active=!0,this.uiOpacity.opacity=0;var i=this.container.position.clone();this.container.position=new V(i.x,i.y-100,i.z);var a=R(this.container).delay(e);a.to(.2,{position:i},{easing:"cubicOut"});var o=R(this.uiOpacity).delay(e);o.to(.2,{opacity:255},{easing:"cubicOut"});var r=function(){n.container.position=i,n.uiOpacity.opacity=255};t.addAbortListener(r),yield Promise.all([Ve.runTweenAsync(a,t),Ve.runTweenAsync(o,t)]),t.removeAbortListener(r)})),function(e,t){return s.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),d}(T)).prototype,"container",[k0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C0=E0))||C0)||C0);S._RF.pop(),S._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var A1,T1,P1,O1,L1,I1,R1,_1,D1,M1,N1,B1,F1,x1=C.ccclass,z1=C.property,U1=Ludex.Utils,G1=U1.Number,H1=U1.Signal,q1=(R0=x1("Leader"),_0=z1(K),D0=z1(B),M0=z1({type:q,group:"Container"}),N0=z1({type:F,group:"Background"}),B0=z1({type:ue,group:"Background"}),F0=z1({type:F,group:"Rank"}),x0=z1({type:K,group:"Rank"}),z0=z1({type:ue,group:"Rank"}),U0=z1({type:ue,group:"Rank"}),G0=z1({type:ue,group:"Rank"}),H0=z1({type:ue,group:"Rank"}),q0=z1({type:F,group:"Avatar"}),V0=z1({type:B,group:"Avatar"}),$0=z1({type:F,group:"Score"}),W0=z1({type:K,group:"Score"}),K0=z1({type:ue,group:"Score"}),j0=z1({type:B,group:"Score"}),Y0=z1({type:B}),X0=z1({type:P}),J0=Ni.onlyRunInLifeCycle,Z0=Ni.onlyRunInLifeCycleAsync,Q0=Ni.onlyRunInLifeCycle,R0((n1=a((t1=function(a){n(y,a);var s,u,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"nameLabel",n1,l(e)),r(e,"nameOpacity",i1,l(e)),r(e,"container",a1,l(e)),r(e,"background",o1,l(e)),r(e,"highlightBackground",r1,l(e)),r(e,"rankSprite",l1,l(e)),r(e,"rankLabel",s1,l(e)),r(e,"goldRank",u1,l(e)),r(e,"silverRank",c1,l(e)),r(e,"bronzeRank",d1,l(e)),r(e,"highlightRank",h1,l(e)),r(e,"avatar",p1,l(e)),r(e,"avatarOpacity",y1,l(e)),r(e,"scoreBackground",v1,l(e)),r(e,"scoreLabel",f1,l(e)),r(e,"highlightScoreBackground",g1,l(e)),r(e,"scoreOpacity",m1,l(e)),r(e,"uiOpacity",b1,l(e)),r(e,"uiTransform",w1,l(e)),e.signalController=new H1.SignalController,e}return e(y,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.defaultAvatar=this.avatar.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e,t){this.updateBackground(e),this.updateRank(e,t),this.updatePhoto(e),this.updateUsername(e),this.updateScore(e)}},{key:"updateBackground",value:function(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(e,t){var n=e.rank;this.rankLabel.string=t&&n>t?"".concat(t,"+"):n.toString(),this.rankSprite.spriteFrame=this.defaultRank;var i=new X(SU);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,i=new X(CU)),n){case 1:this.rankSprite.spriteFrame=this.goldRank,i=new X(gU);break;case 2:this.rankSprite.spriteFrame=this.silverRank,i=new X(mU);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,i=new X(bU)}this.rankLabel.shadowColor=i,this.rankLabel.outlineColor=i}},{key:"updatePhoto",value:(h=o((function*(e){var t=this.signalController.renew();if(this.avatar){var n=e.playerId,i=e.photo;if(eN.isAvatarCached(e.playerId,70)){var a=yield eN.getPlayerAvatar(i,n,70,t);if(!a||t.aborted)return;this.setPhoto(a)}else if(this.avatar.spriteFrame=this.defaultAvatar,yield Ve.waitTweenAsync(.1,t),!t.aborted){var o=yield eN.getPlayerAvatar(i,n,70,t);o&&!t.aborted&&this.setPhoto(o)}}})),function(e){return h.apply(this,arguments)})},{key:"setPhoto",value:function(e){this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}},{key:"updateUsername",value:function(e){this.nameLabel.string=e.name,this.nameLabel.color=new X(e.isHighlight?kU:wU)}},{key:"updateScore",value:function(e){var t=Math.floor(e.score);this.scoreLabel.string=G1.getShortNumber(t,7);var n=this.scoreLabel.getComponent(K);n.outlineColor=new X(e.isHighlight?CU:SU),n.shadowColor=new X(e.isHighlight?CU:SU),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(d=o((function*(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;this.setVisible(!1);var a=this.container.position.clone();this.container.position=new V(a.x,a.y-100,a.z);var o=R(this.container).delay(t);o.to(i,{position:a},{easing:"backOut"});var r=R(this.uiOpacity).delay(t);r.to(i,{opacity:255},{easing:"cubicOut",onUpdate:function(){n.nameOpacity.opacity=n.uiOpacity.opacity,n.scoreOpacity.opacity=n.uiOpacity.opacity,n.avatarOpacity.opacity=n.uiOpacity.opacity}});var l=function(){n.enabledInHierarchy&&(n.container.position=a,n.uiOpacity.opacity=255,n.avatar.node.active=!0)};e.addAbortListener(l),yield Promise.all([Ve.runTweenAsync(o,e),Ve.runTweenAsync(r,e)]),e.removeAbortListener(l)})),function(e,t){return d.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(c=o((function*(e,t,n){var i=R(this.node).to(t,{worldPosition:e},{easing:"quadOut"});yield Ve.runTweenAsync(i,n)})),function(e,t,n){return c.apply(this,arguments)})},{key:"runScaleAnimation",value:(u=o((function*(e,t,n){var i=R(this.node).to(t,{scale:new V(e,e,e)},{easing:"backOut"});yield Ve.runTweenAsync(i,n)})),function(e,t,n){return u.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(s=o((function*(e,t,n,i,a,o){var r=this;yield Ve.runOnUpdateAsync(this.node,a,(function(a){var o=Math.floor(e+(t-e)*a),l=Math.floor(n+(i-n)*a);r.updateRank({rank:o,isHighlight:!0}),r.updateScore({score:l,isHighlight:!0})}),o)})),function(e,t,n,i,a,o){return s.apply(this,arguments)})},{key:"setVisible",value:function(e){var t=e?255:0;this.uiOpacity.opacity=t,this.nameOpacity.opacity=t,this.scoreOpacity.opacity=t,this.avatarOpacity.opacity=t}}]),y}(T)).prototype,"nameLabel",[_0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i1=a(t1.prototype,"nameOpacity",[D0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a1=a(t1.prototype,"container",[M0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=a(t1.prototype,"background",[N0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r1=a(t1.prototype,"highlightBackground",[B0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l1=a(t1.prototype,"rankSprite",[F0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s1=a(t1.prototype,"rankLabel",[x0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=a(t1.prototype,"goldRank",[z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c1=a(t1.prototype,"silverRank",[U0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d1=a(t1.prototype,"bronzeRank",[G0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h1=a(t1.prototype,"highlightRank",[H0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p1=a(t1.prototype,"avatar",[q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y1=a(t1.prototype,"avatarOpacity",[V0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v1=a(t1.prototype,"scoreBackground",[$0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f1=a(t1.prototype,"scoreLabel",[W0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g1=a(t1.prototype,"highlightScoreBackground",[K0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m1=a(t1.prototype,"scoreOpacity",[j0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b1=a(t1.prototype,"uiOpacity",[Y0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w1=a(t1.prototype,"uiTransform",[X0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(t1.prototype,"updateInfo",[J0],Object.getOwnPropertyDescriptor(t1.prototype,"updateInfo"),t1.prototype),a(t1.prototype,"updatePhoto",[Z0],Object.getOwnPropertyDescriptor(t1.prototype,"updatePhoto"),t1.prototype),a(t1.prototype,"setPhoto",[Q0],Object.getOwnPropertyDescriptor(t1.prototype,"setPhoto"),t1.prototype),e1=t1))||e1);S._RF.pop(),S._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var V1=C.ccclass,$1=C.property,W1=codex.player,K1=Ludex.Utils.Array,j1=(A1=V1("Leaders"),T1=$1(IH),P1=$1(q1),O1=$1(O),L1=Ni.onlyRunInLifeCycleAsync,I1=Ni.onlyRunInLifeCycleAsync,R1=Ni.onlyRunInLifeCycleAsync,_1=Ni.onlyRunInLifeCycleAsync,A1((N1=a((M1=function(a){n(g,a);var c,d,h,p,y,v,f=i(g);function g(){var e;t(this,g);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=f.call.apply(f,[this].concat(i)),r(e,"scrollView",N1,l(e)),r(e,"tempLeader",B1,l(e)),r(e,"maxLeader",F1,l(e)),e.leaderData=[],e.displayLeaderData=[],e.displayPlayerLeader=null,e.isHidden=!0,e}return e(g,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(P),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=W1.getPlayerId()}},{key:"updateData",value:(v=o((function*(e){this.isHidden=!1,this.leaderData=e,this.leaderData.forEach((function(e,t){e.rank=t+1})),this.setupDisplayLeadersData()})),function(e){return v.apply(this,arguments)})},{key:"initScrollViews",value:function(){var e=this;this.scrollView.setMaxNodeCount(this.leaderData.length),this.scrollView.init((function(t){var n=t.getComponent(q1),i=e.displayLeaderData[t.order];if(i){var a=i.playerId,o=i.photo,r=i.name,l=i.score;n.setVisible(!0),n.updateInfo({playerId:a,isHighlight:e.currentPlayerId===a,name:r,photo:o,rank:t.order+1,score:l},e.maxLeader)}}))}},{key:"playRankChangeAnimation",value:(y=o((function*(e,t,n,i){if(!(t>=n)){var a=this.displayLeaderData,o=K1.search(a,(function(e){return e.playerId===W1.getPlayerId()}));if(o){var r=o.rank;if(a[i-1]){var l=this.scrollView.getNodeByOrder(o.rank-1);if(l){var s=null==l?void 0:l.getComponent(q1);if(s){s.setVisible(!1),this.tempLeader.setVisible(!0),this.tempLeader.updatePhoto({playerId:W1.getPlayerId(),photo:o.photo}),this.tempLeader.node.worldPosition=l.node.worldPosition.clone(),yield this.tempLeader.runScaleAnimation(1.1,.5,e);var u=Math.min(.5*(r-i),2),c=[this.tempLeader.runUpdateDataAnimation(r,i,t,n,u,e),this.scrollToLeaderRank(i,u,e)],d=this.scrollView.scrollView.getMaxScrollOffset().y,h=this.scrollView.getNodeScrollOffset(i-1),p=V.ZERO;if(h<0)p=new V(this.tempLeader.node.worldPosition.x,this.node.worldPosition.y+this.scrollView.getNodePosition(i-1).y+this.uiTransform.height/2,this.tempLeader.node.worldPosition.z);else if(this.scrollView.scrollView.getScrollOffset().y>=d-5)if(h<d)p=new V(this.tempLeader.node.worldPosition.x,this.scrollView.viewport.node.worldPosition.y,this.tempLeader.node.worldPosition.z);else{var y,v=this.scrollView.getNodeByOrder(i-1);p=null!==(y=null==v?void 0:v.node.worldPosition.clone())&&void 0!==y?y:V.ZERO}p.equals(V.ZERO)||c.push(this.tempLeader.runWorldPositionAnimation(p,u,e)),yield Promise.all(c),yield Promise.all([this.tempLeader.runScaleAnimation(1,.25,e),this.playPostRankChangeAnimation(i,r,e)]),this.tempLeader.setVisible(!1),l.node.worldPosition=this.tempLeader.node.worldPosition.clone(),this.setupDisplayLeadersData(),this.scrollView.updateNodeVisibility(),this.scrollView.updateLayout()}}}}}})),function(e,t,n,i){return y.apply(this,arguments)})},{key:"playShowLeadersAnimation",value:(p=o((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;if(!this.isHidden){var i=[],a=this.scrollView.getAllNodes();if(a.sort((function(e,t){return e.order-t.order})).forEach((function(e,n){var a=e.getComponent(q1);a.setVisible(n<t.leaderData.length),e.isVisible()&&i.push(a)})),!(i.length<1)){i=i.slice(0,a.length-1);var r=.3;yield Promise.all(i.map(function(){var i=o((function*(i,a){t.isHidden||(yield i.runShowUpAnimation(e,a*n,r))}));return function(e,t){return i.apply(this,arguments)}}()))}}})),function(e){return p.apply(this,arguments)})},{key:"scrollToPlayerLeader",value:(h=o((function*(e,t){this.displayPlayerLeader&&(yield this.scrollToLeaderRank(this.displayPlayerLeader.rank,e,t))})),function(e,t){return h.apply(this,arguments)})},{key:"updateDisplayPlayerLeaderForRankChanging",value:function(e,t,n){if(!this.displayPlayerLeader)return!1;this.displayPlayerLeader.score=e,this.displayLeaderData.sort((function(e,t){return t.score-e.score}));var i=this.displayLeaderData.indexOf(this.displayPlayerLeader)+1;return n===i?(this.displayPlayerLeader.score=t,this.displayPlayerLeader.rank=n,!1):(this.displayPlayerLeader.rank=i,this.tempLeader.updateInfo({playerId:W1.getPlayerId(),isHighlight:!0,name:this.displayPlayerLeader.name,photo:this.displayPlayerLeader.photo,rank:this.displayPlayerLeader.rank,score:e}),!0)}},{key:"hideLeaders",value:function(){this.isHidden=!0;var e,t=this.scrollView.getAllNodes().map((function(e){return e.getComponent(q1)})),n=u(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;null==i||i.setVisible(!1)}}catch(e){n.e(e)}finally{n.f()}}},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"setupDisplayLeadersData",value:function(){var e=this,t=K1.search(this.leaderData,(function(t){return t.playerId===e.currentPlayerId}));t?(this.displayLeaderData=this.leaderData.filter((function(t){return t.playerId!==e.currentPlayerId})),this.displayPlayerLeader=s({},t),this.displayLeaderData.splice(t.rank-1,0,this.displayPlayerLeader)):(this.displayPlayerLeader=null,this.displayLeaderData=this.leaderData)}},{key:"playPostRankChangeAnimation",value:(d=o((function*(e,t,n){var i=null!=e?e:0,a=this.scrollView.getVisibleNodes().filter((function(e){return e.order>=i-1&&e.order<t})),o=a.map((function(e){return e.getComponent(q1)})),r=this.scrollView.nodeHeight+this.scrollView.spacing,l=[];o.forEach((function(e,t){var i=a[t];if(i){e.updateRank({rank:i.order+2,isHighlight:!1});var o=e.node.worldPosition.clone();l.push(e.runWorldPositionAnimation(o.add3f(0,-r,0),.25,n))}})),yield Promise.all(l)})),function(e,t,n){return d.apply(this,arguments)})},{key:"scrollToLeaderRank",value:(c=o((function*(e,t,n){yield this.scrollView.scrollToOrder(e-1,n,t)})),function(e,t,n){return c.apply(this,arguments)})}]),g}(T)).prototype,"scrollView",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B1=a(M1.prototype,"tempLeader",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F1=a(M1.prototype,"maxLeader",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(M1.prototype,"updateData",[L1],Object.getOwnPropertyDescriptor(M1.prototype,"updateData"),M1.prototype),a(M1.prototype,"playRankChangeAnimation",[I1],Object.getOwnPropertyDescriptor(M1.prototype,"playRankChangeAnimation"),M1.prototype),a(M1.prototype,"scrollToPlayerLeader",[R1],Object.getOwnPropertyDescriptor(M1.prototype,"scrollToPlayerLeader"),M1.prototype),a(M1.prototype,"scrollToLeaderRank",[_1],Object.getOwnPropertyDescriptor(M1.prototype,"scrollToLeaderRank"),M1.prototype),D1=M1))||D1);S._RF.pop(),S._RF.push({},"9f98ebQ6z1GMZv6FqGBHkpb","LeaderboardContentOverlay",void 0);var Y1,X1=Ludex,J1=X1.Utils,Z1=J1.Time,Q1=J1.Object,e2=X1.Plugins.Ads,t2=(void 0===e2?{}:e2).Types,n2=codex.ads,i2=function(){function n(e){var i=this;t(this,n),this.isPageMounted=!1,this.createMainDiv$=function(){i.mainDiv$=document.createElement("div");var e=BM.getGameScaleFactor();Q1.assign(i.mainDiv$.style,{position:"absolute",transform:"translateX(-50%)",left:"50%",top:"".concat(295*e,"px"),scrollbarWidth:"none",alignItems:"start",overflow:"auto",backgroundColor:"transparent",opacity:"0",transition:"opacity 0.1s ease-in-out",pointerEvents:"none",display:"none",userSelect:"none"}),document.body.appendChild(i.mainDiv$)},this.isPayloadChanged$=function(e){if(!i.currentPayload$)return!0;if(i.currentPayload$.leaderboardPlayers.length!==e.leaderboardPlayers.length)return!0;for(var t=0;t<e.leaderboardPlayers.length;t++){var n=i.currentPayload$.leaderboardPlayers[t],a=e.leaderboardPlayers[t];if(!n||!a)return!0;if(n.playerId!==a.playerId||n.rank!==a.rank||n.score!==a.score)return!0}return!1},this.showOverlay$=o((function*(){i.overlayElement$&&(yield i.overlayElement$.showAsync(),i.revealMainDiv$())})),this.revealMainDiv$=function(){i.overlayElement$&&i.isPageMounted&&(i.scene.emit(fU.OVERLAY_SHOW_COMPLETED),i.mainDiv$.style.display="block",i.mainDiv$.scrollTop=0,requestAnimationFrame((function(){i.isPageMounted?Q1.assign(i.mainDiv$.style,{opacity:"1",pointerEvents:"auto"}):i.mainDiv$.style.display="none"})))},this.validateOverlayPayload$=function(e){var t,n=s(s({},e),{},{leaderboardPlayers:[]}),i=/^\d+$/,a=u(e.leaderboardPlayers);try{for(a.s();!(t=a.n()).done;){var o=t.value;i.test(o.playerId)&&n.leaderboardPlayers.push(o)}}catch(e){a.e(e)}finally{a.f()}return n},this.getIframeCss$=function(e){var t="100cqw",n=e.leaderboardPosition,a=e.leaderboardPlayers.length;n&&(t="".concat(i.getElementDivWidth$(n),"px"));var o="height: calc((".concat(t," * (121 / 1000) + 4px) * ").concat(a,");");return"".concat("width: 100%;"," ").concat("border-width: 0px;"," ").concat("overflow: hidden;"," ").concat("display: block;"," ").concat(o,"   ")},this.updateMainDivPosition$=function(e){if(i.mainDiv$){var t="".concat(i.getElementDivWidth$(e),"px"),n="".concat(i.getElementDivHeight$(),"px"),a="".concat(i.getElementDivTopOffset$(),"px");Q1.assign(i.mainDiv$.style,{width:t,height:"calc(100vh - ".concat(n,")"),top:a})}},this.getElementDivWidth$=function(e){return e.width*BM.getGameScaleFactor()},this.getElementDivHeight$=function(){return BM.getGameScaleFactor()*(450+i.getAdBannerHeight$())},this.getAdBannerHeight$=function(){if(!ut.isBannerAdShowing())return 0;if(!t2)return 0;var e=0;try{var t=n2.getAd(t2.BANNER);if(!t)return 0;e=n2.getBannerHeight(t.placementId,We.cssSizeToWorldSize(1))}catch(e){return console.debug("Error getting ad banner height:",e),0}return e},this.getElementDivTopOffset$=function(){return 295*BM.getGameScaleFactor()},this.scene=e,this.createMainDiv$()}var i,a,r,l;return e(n,[{key:"updateOverlay",value:(l=o((function*(e){try{if(!this.isPageMounted)return!1;this.scene.emit(fU.OVERLAY_SHOW_STARTED);var t=this.validateOverlayPayload$(e);if(t.leaderboardPosition&&this.moveMainDiv(t.leaderboardPosition),!this.isPayloadChanged$(t))return this.revealMainDiv$(),!0;this.overlayElement$?yield this.overlayElement$.updateAsync(t):this.overlayElement$=yield BM.createOverlayViewAsync("overlays/leaderboard/leaderboard-overlay.xml",this.mainDiv$,this.getIframeCss$(e),"overlays/leaderboard/leaderboard-overlay-styles.css",t),this.currentPayload$=t,yield this.showOverlay$()}catch(e){return console.error("Error creating overlay view:",e),!1}return!0})),function(e){return l.apply(this,arguments)})},{key:"hideOverlay",value:(r=o((function*(){if(this.overlayElement$){Q1.assign(this.mainDiv$.style,{opacity:"0",pointerEvents:"none"});try{yield Z1.sleepAsync(100),this.mainDiv$.style.display="none"}catch(e){console.error("Hide overlay failed:",e)}}})),function(){return r.apply(this,arguments)})},{key:"handleHideUICall",value:(a=o((function*(){Q1.assign(this.mainDiv$.style,{opacity:"0",pointerEvents:"none",display:"none"})})),function(){return a.apply(this,arguments)})},{key:"handleShowUICall",value:(i=o((function*(){Q1.assign(this.mainDiv$.style,{opacity:"1",pointerEvents:"auto",display:"block"})})),function(){return i.apply(this,arguments)})},{key:"setIsPageMounted",value:function(e){this.isPageMounted=e}},{key:"moveMainDiv",value:function(e){this.updateMainDivPosition$(e)}}]),n}();S._RF.pop(),S._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var a2,o2,r2,l2,s2,u2,c2,d2,h2,p2,y2,v2,f2,g2,m2,b2,w2,S2,k2,C2,E2,A2,T2,P2,O2,L2,I2,R2,_2,D2,M2,N2,B2,F2=(0,C.ccclass)("LeaderboardIsEmpty")(Y1=function(a){n(s,a);var r,l=i(s);function s(){return t(this,s),l.apply(this,arguments)}return e(s,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(B),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"show",value:(r=o((function*(){this.uiOpacity.opacity=255;var e=this.node.position.clone(),t=R(this.node);t.to(.05,{position:e.clone().add3f(5,0,0)}),t.to(.05,{position:e.clone().add3f(-5,0,0)});var n=R(this.node).repeat(2,t);n.to(.05,{position:e}),yield Ve.runTweenAsync(n)})),function(){return r.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),s}(T))||Y1;S._RF.pop(),S._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var x2,z2,U2,G2,H2,q2,V2,$2,W2=C.ccclass,K2=C.property,j2=codex,Y2=j2.storage,X2=j2.leaderboard,J2=j2.player,Z2=j2.monitorError,Q2=Ludex,e5=Q2.Utils.Object,t5=Q2.Configs.Leaderboards,n5=function(a){n(r,a);var o=i(r);function r(e){var n;return t(this,r),(n=o.call(this,e)).name="EmptyLeaderboardError",n}return e(r)}(p(Error)),i5=(a2=W2("LeaderboardContent"),o2=Ni.required(),r2=K2(w0),l2=Ni.required(),s2=K2(I0),u2=Ni.required(),c2=K2({type:j1,group:"Leaderboard"}),d2=K2({type:[E1],group:"Leaderboard"}),h2=Ni.required(),p2=K2({type:F2,group:"Leaderboard"}),y2=Ni.required(),v2=K2(qr),f2=Ni.required(),g2=K2(GQ),m2=Ni.required(),b2=K2(q),w2=Ni.onlyRunInLifeCycleAsync,S2=Ni.onlyRunInLifeCycleAsync,k2=Ni.onlyRunInLifeCycleAsync,C2=Ni.onlyRunInLifeCycleAsync,E2=Ni.onlyRunInLifeCycleAsync,A2=Ni.onlyRunInLifeCycleAsync,T2=Ni.onlyRunInLifeCycle,a2((L2=a((O2=function(a){n(f,a);var s,u,c,d,h,p,y,v=i(f);function f(){var e;t(this,f);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=v.call.apply(v,[this].concat(i)),r(e,"tabs",L2,l(e)),r(e,"timer",I2,l(e)),r(e,"leaders",R2,l(e)),r(e,"leaderSkeletons",_2,l(e)),r(e,"leaderboardIsEmpty",D2,l(e)),r(e,"contentOpacity",M2,l(e)),r(e,"joinLeaderboardContainer",N2,l(e)),r(e,"loadingNode",B2,l(e)),e.isHidden=!0,e.isOverlayMode=!1,e.currentLb=null,e.currentTab=Ay,e.animAbortSignal=new In,e.hasPlayedAppearAnim={friends:!1,global:!1,global_weekly:!1},e.dailyFBOverlay=null,e.weeklyFBOverlay=null,e.unlistenEvents$=function(){D.off($e.VIEW_RESIZED,e.handleViewResized$),e.node.scene.off(fU.WEEKLY_TAB_SELECTED,e.handleWeeklyTabSelected$),e.node.scene.off(fU.WORLD_TAB_SELECTED,e.handleDailyTabSelected$),e.node.scene.off(fU.OVERLAY_SHOW_STARTED,e.enableOverlayLoadingNode$),e.node.scene.off(fU.OVERLAY_SHOW_COMPLETED,e.disableOverlayLoadingNode$),e.unlistenUIEvents()},e.getLeaderboardName$=function(e){var t=e===Ty?Ey.WEEKLY:Ey.DAILY;return X2.getLeaderboardName(t)},e.cleanupSideEffects$=function(){e.animAbortSignal.abort(),e.animAbortSignal=new In,e.leaders.hideLeaders(),e.leaderboardIsEmpty.hide(),e.joinLeaderboardContainer.hide()},e.initializeStatusUpdate$=function(t){e.tabs.updateStatus(t),e.timer.setTimeLabel()},e.loadLeaderboardData$=function(){var t=o((function*(t,n){yield e.showLoading(t,n),yield e.loadLeaderboard(t,n),e.hideLoading(t,n)}));return function(e,n){return t.apply(this,arguments)}}(),e.handleSuccessfulLoad$=function(){var t=o((function*(t,n){e.isOverlayMode?yield e.handleOverlayMode$(t,n):yield e.handleRegularMode$(t,n),yield e.handleGuestUserFlow$(t)}));return function(e,n){return t.apply(this,arguments)}}(),e.handleOverlayMode$=function(){var t=o((function*(t,n){t.call((function(){var i;null===(i=e.timer)||void 0===i||i.show(t),e.handleUpdateOverlayAfterSignal$(t,n)}))}));return function(e,n){return t.apply(this,arguments)}}(),e.handleUpdateOverlayAfterSignal$=function(){var t=o((function*(t,n){if(!(yield e.updateOverlay$(n)))return e.isOverlayMode=!1,e.disableOverlayLoadingNode$(),void e.handleRegularMode$(t,n);e.setupTimerWithLeaderboard$(t)}));return function(e,n){return t.apply(this,arguments)}}(),e.handleRegularMode$=function(){var t=o((function*(t,n){t.call((function(){e.setupTimerWithLeaderboard$(t)})),yield t.callAsync((function(t){return e.playLeadersShowupAnimation(n,t)}))}));return function(e,n){return t.apply(this,arguments)}}(),e.setupTimerWithLeaderboard$=function(t){var n,i,a;null===(n=e.timer)||void 0===n||n.setTimeLabel(null===(i=e.currentLb)||void 0===i?void 0:i.resettable),null===(a=e.timer)||void 0===a||a.show(t)},e.handleGuestUserFlow$=function(){var t=o((function*(t){var n;GameSDK.extra.isGuest&&(e.updateJoinLeaderboardButton(),yield null===(n=e.joinLeaderboardContainer)||void 0===n?void 0:n.show(t))}));return function(e){return t.apply(this,arguments)}}(),e.handleLoadError$=function(t,n,i){if(!(i instanceof n5))throw i;t.call((function(){e.handleEmptyLeaderboard$(t,n)}))},e.handleEmptyLeaderboard$=function(t,n){e.leaderboardIsEmpty.show(),e.leaders.scrollView.setMaxNodeCount(0),e.hideLoading(t,n),e.setupTimerWithLeaderboard$(t)},e.updateOverlay$=function(){var t=o((function*(t){if(!e.currentLb)return!1;var n=e5.vals(e.currentLb.leaders);n.sort((function(e,t){return t.score-e.score}));var i=n.map((function(e){var t=e.rank>50?"50+":"".concat(e.rank);return{playerId:e.playerId,rank:t,score:e.score}})),a=e.getCorrectOverlay$(t);if(!a)return!1;var o=yield null==a?void 0:a.updateOverlay({leaderboardPlayers:i,leaderboardPosition:e.getLeaderboardSize$(),currentPlayerId:J2.getPlayerId()});return null!=o&&o}));return function(e){return t.apply(this,arguments)}}(),e.handleViewResized$=function(){e.updateJoinLeaderboardButton()},e.handleWeeklyTabSelected$=o((function*(){Y2.setStorageData("leaderboard_content","lastTabOpened",Ty),e.cleanupSideEffects$(),e.currentTab=Ty;var t=e.animAbortSignal;try{yield e.updateStatus(t,Ty)}catch(e){t.call((function(){var t=e instanceof Error?e:new Error("Unknown error during loading global weekly leaderboard.");console.error("LeaderboardContent",t),null==Z2||Z2.sendException(t),rt.showNotificationScreenWithLocalizedKey("error.noFriendsLb",2)}))}})),e.handleDailyTabSelected$=o((function*(){Y2.setStorageData("leaderboard_content","lastTabOpened",Ay),e.cleanupSideEffects$(),e.currentTab=Ay;var t=e.animAbortSignal;try{yield e.updateStatus(t,Ay)}catch(e){t.call((function(){var t=e instanceof Error?e:new Error("Unknown error during loading global leaderboard.");console.error("LeaderboardContent",t),null==Z2||Z2.sendException(t),rt.showNotificationScreenWithLocalizedKey("error.noWorldLb",2)}))}})),e.hideContent$=function(){var t,n;e.contentOpacity.changeStateFade(!1,.1),e.updateOverlayMountStatus(!1),null===(t=e.dailyFBOverlay)||void 0===t||t.handleHideUICall(),null===(n=e.weeklyFBOverlay)||void 0===n||n.handleHideUICall()},e.showContent$=function(){e.contentOpacity.changeStateFade(!0,.1),e.updateOverlayMountStatus(!0),e.handleOverlayShowUICall$()},e.handleOverlayShowUICall$=function(){var t,n;e.isOverlayMode&&(e.currentTab===Ty?null===(t=e.weeklyFBOverlay)||void 0===t||t.handleShowUICall():null===(n=e.dailyFBOverlay)||void 0===n||n.handleShowUICall())},e.createFBOverlay$=function(){try{BM.isOverlayViewAPIAvailable(GameSDK),e.isOverlayMode=!0,e.dailyFBOverlay=new i2(e.node.scene),e.weeklyFBOverlay=new i2(e.node.scene)}catch(e){return}},e.getLeaderboardSize$=function(){var t=e.leaders.getComponent(P);if(!t)return{worldX:0,worldY:0,width:0,height:0};var n=t.width,i=t.height,a=e.leaders.node;return{worldX:a.worldPositionX,worldY:a.worldPositionY,width:n,height:i}},e.getCorrectOverlay$=function(t){return t===Ay?e.dailyFBOverlay:e.weeklyFBOverlay},e.enableOverlayLoadingNode$=function(){e.loadingNode.active=!0},e.disableOverlayLoadingNode$=function(){e.loadingNode.active=!1},e}return e(f,[{key:"__preload",value:function(){var e,t;this.leaders.maxLeader=null!==(e=null===(t=t5.LeaderboardList[0])||void 0===t?void 0:t.Limit)&&void 0!==e?e:0}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this),this.createFBOverlay$()}},{key:"listenEvents",value:function(){D.on($e.VIEW_RESIZED,this.handleViewResized$),this.node.scene.on(fU.WEEKLY_TAB_SELECTED,this.handleWeeklyTabSelected$),this.node.scene.on(fU.WORLD_TAB_SELECTED,this.handleDailyTabSelected$),this.node.scene.on(fU.OVERLAY_SHOW_STARTED,this.enableOverlayLoadingNode$),this.node.scene.on(fU.OVERLAY_SHOW_COMPLETED,this.disableOverlayLoadingNode$),this.node.scene.on(Es.HIDE_UI,this.hideContent$),this.node.scene.on(Es.SHOW_UI,this.showContent$)}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(Es.HIDE_UI,this.hideContent$),this.node.scene.off(Es.SHOW_UI,this.showContent$)}},{key:"loadLeaderboard",value:(y=o((function*(e,t){var n=this,i=this.getLeaderboardName$(t);null!==i&&(yield e.callAsync((function(){return X2.requestLeaderboardAsync(i,n.leaders.maxLeader)})),e.call((function(){var e=X2.getLeaderboard(i);n.currentLb=null!=e?e:n.currentLb})),yield e.callAsync(o((function*(){return n.loadPlayerLeaderData(t)}))))})),function(e,t){return y.apply(this,arguments)})},{key:"showLoading",value:(p=o((function*(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.isOverlayMode)return this.enableOverlayLoadingNode$(),void this.cleanupOverlay();yield Promise.all([this.leaders.scrollView.unlistenEvents(),this.leaders.scrollView.scrollToTop(e).then((function(){n.leaders&&(n.leaders.scrollView.scrollView.enabled=!1,n.leaders.scrollView.listenEvents())})),this.leaderSkeletons.map((function(t,n){return t.show(n*i,e)}))])})),function(e,t){return p.apply(this,arguments)})},{key:"hideLoading",value:(h=o((function*(e,t){this.isOverlayMode||(yield Promise.all(this.leaderSkeletons.map((function(t){return t.hide(e)}))))})),function(e,t){return h.apply(this,arguments)})},{key:"entering",value:function(){this.timer.reset(),this.isHidden=!1;var e=Y2.getStorageData("leaderboard_content","lastTabOpened");e===Ty?this.handleWeeklyTabSelected$():e===Ay&&this.handleDailyTabSelected$()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.leaders.scrollView.unlistenEvents(),this.unlistenEvents$(),this.cleanupSideEffects$(),this.cleanupOverlay()}},{key:"cleanupOverlay",value:function(){var e,t;null===(e=this.dailyFBOverlay)||void 0===e||e.hideOverlay(),null===(t=this.weeklyFBOverlay)||void 0===t||t.hideOverlay()}},{key:"updateOverlayMountStatus",value:function(e){var t,n;null===(t=this.dailyFBOverlay)||void 0===t||t.setIsPageMounted(e),null===(n=this.weeklyFBOverlay)||void 0===n||n.setIsPageMounted(e)}},{key:"updateStatus",value:(d=o((function*(e,t){if(void 0!==e&&!this.isHidden){this.initializeStatusUpdate$(t);try{yield this.loadLeaderboardData$(e,t),yield this.handleSuccessfulLoad$(e,t)}catch(n){this.handleLoadError$(e,t,n)}}})),function(e,t){return d.apply(this,arguments)})},{key:"playLeadersShowupAnimation",value:(c=o((function*(e,t){var n=this;if(this.currentLb){var i=J2.getPlayerId(),a=this.currentLb.leaders[i],o=Y2.getStorage("leaderboard_content").previousScore,r=e5.vals(this.currentLb.leaders);r.sort((function(e,t){return t.score-e.score})),GameSDK.extra.isGuest&&(r=r.slice(0,5));var l=a&&-1!==o&&o<a.score&&a.rank<=this.leaders.maxLeader;this.leaders.updateData(r);var s=!1;l&&(s=this.leaders.updateDisplayPlayerLeaderForRankChanging(o,a.score,a.rank)),this.leaders.initScrollViews(),this.leaders.scrollView.scrollView.enabled=!0;var u=this.hasPlayedAppearAnim[e]?0:.1;yield t.callAsync((function(){return n.leaders.playShowLeadersAnimation(t,u)})),this.hasPlayedAppearAnim[e]=!0,a&&(yield t.callAsync((function(){return n.leaders.scrollToPlayerLeader(1,t)})),s&&-1!==o&&(yield t.callAsync((function(e){return n.leaders.playRankChangeAnimation(e,o,a.score,a.rank)})),Y2.setStorageData("leaderboard_content","previousScore",a.score)))}})),function(e,t){return c.apply(this,arguments)})},{key:"loadPlayerLeaderData",value:(u=o((function*(e){var t=J2.getPlayerId();if(null===this.currentLb)throw new Error("LeaderboardContent: Leaderboard is not found.");var n=this.currentLb.leaders;if(0===Object.keys(n).length)throw new n5("LeaderboardContent: Leaderboard is empty.");if(!n[t]){var i=this.getLeaderboardName$(e);if(null===i)throw new Error("LeaderboardContent: Leaderboard name is not found.");var a=yield X2.getLeadersByPlayerIdsAsync(i,[t]);if(0!==a.length){var o=a[0];o&&(n[t]=o)}}})),function(e){return u.apply(this,arguments)})},{key:"updateJoinLeaderboardButton",value:function(){if(GameSDK.extra.isGuest&&!this.isOverlayMode){var e=void 0,t=this.leaders.scrollView.getVisibleNodes();if(0===t.length)e=this.leaders.scrollView.viewport.getBoundingBoxToWorld().center.y;else{var n=t[t.length-1],i=this.joinLeaderboardContainer.uiTransform.height,a=n.node.worldPosition.y-i-20;a-i/2>=this.leaders.scrollView.viewport.getBoundingBoxToWorld().yMin&&(e=a)}this.joinLeaderboardContainer.updatePosition(e)}}},{key:"handleJoinLeaderboard",value:(s=o((function*(){try{if(!("initPlayerAsync"in GameSDK.player))return;if(rt.showLoadingScreen(),yield GameSDK.player.initPlayerAsync(),rt.closeLoadingScreen(),GameSDK.extra.isGuest)return void rt.showNotificationScreenWithLocalizedKey("error.joinLb",1)}catch(e){console.warn("Join leaderboard failed",e),rt.closeLoadingScreen(),rt.showNotificationScreenWithLocalizedKey("error.joinLb",1)}})),function(){return s.apply(this,arguments)})}]),f}(T)).prototype,"tabs",[o2,r2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I2=a(O2.prototype,"timer",[l2,s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R2=a(O2.prototype,"leaders",[u2,c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_2=a(O2.prototype,"leaderSkeletons",[d2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),D2=a(O2.prototype,"leaderboardIsEmpty",[h2,p2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M2=a(O2.prototype,"contentOpacity",[y2,v2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N2=a(O2.prototype,"joinLeaderboardContainer",[f2,g2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B2=a(O2.prototype,"loadingNode",[m2,b2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(O2.prototype,"loadLeaderboard",[w2],Object.getOwnPropertyDescriptor(O2.prototype,"loadLeaderboard"),O2.prototype),a(O2.prototype,"showLoading",[S2],Object.getOwnPropertyDescriptor(O2.prototype,"showLoading"),O2.prototype),a(O2.prototype,"hideLoading",[k2],Object.getOwnPropertyDescriptor(O2.prototype,"hideLoading"),O2.prototype),a(O2.prototype,"updateStatus",[C2],Object.getOwnPropertyDescriptor(O2.prototype,"updateStatus"),O2.prototype),a(O2.prototype,"playLeadersShowupAnimation",[E2],Object.getOwnPropertyDescriptor(O2.prototype,"playLeadersShowupAnimation"),O2.prototype),a(O2.prototype,"loadPlayerLeaderData",[A2],Object.getOwnPropertyDescriptor(O2.prototype,"loadPlayerLeaderData"),O2.prototype),a(O2.prototype,"updateJoinLeaderboardButton",[T2],Object.getOwnPropertyDescriptor(O2.prototype,"updateJoinLeaderboardButton"),O2.prototype),P2=O2))||P2);S._RF.pop(),S._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var a5,o5,r5,l5,s5,u5,c5,d5,h5,p5,y5,v5,f5,g5,m5,b5,w5,S5,k5,C5;x2=(0,C.ccclass)("LeaderboardPage"),z2=Ni.required(),U2=Ni.onlyRunInLifeCycleAsync,G2=Ni.onlyRunInLifeCycleAsync,H2=Ni.onlyRunInLifeCycleAsync,x2(($2=a((V2=function(a){n(v,a);var s,u,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),r(e,"panelAnimationController",$2,l(e)),e}return e(v,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(qs),c(d(v.prototype),"onLoad",this).call(this)}},{key:"start",value:(p=o((function*(){c(d(v.prototype),"start",this).call(this)})),function(){return p.apply(this,arguments)})},{key:"mount",value:(h=o((function*(){if(yield c(d(v.prototype),"mount",this).call(this),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(i5),this.content.updateOverlayMountStatus(!0),!this.content)throw new Error("LeaderboardPage: Leaders not found")})),function(){return h.apply(this,arguments)})},{key:"transitionIn",value:(u=o((function*(){this.content.entering(),yield c(d(v.prototype),"transitionIn",this).call(this);var e=Ve.runTweenAsync(R(this.containerUIOpacity).to(.2,{opacity:255})),t=this.panelAnimationController.showUI();this.content.listenEvents(),yield Promise.all([e,t])})),function(){return u.apply(this,arguments)})},{key:"transitionOut",value:(s=o((function*(){yield c(d(v.prototype),"transitionOut",this).call(this),this.content.cleanupOverlay(),this.content.unlistenUIEvents(),yield this.panelAnimationController.hideUI()})),function(){return s.apply(this,arguments)})},{key:"unmount",value:function(){var e,t,n;null===(e=this.content)||void 0===e||e.hide(),null===(t=this.content)||void 0===t||t.cleanup(),null===(n=this.content)||void 0===n||n.updateOverlayMountStatus(!1),c(d(v.prototype),"unmount",this).call(this)}}]),v}(pX)).prototype,"panelAnimationController",[z2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(V2.prototype,"mount",[U2],Object.getOwnPropertyDescriptor(V2.prototype,"mount"),V2.prototype),a(V2.prototype,"transitionIn",[G2],Object.getOwnPropertyDescriptor(V2.prototype,"transitionIn"),V2.prototype),a(V2.prototype,"transitionOut",[H2],Object.getOwnPropertyDescriptor(V2.prototype,"transitionOut"),V2.prototype),q2=V2));S._RF.pop(),S._RF.push({},"0d1c02Npp9IXrjlFdl8co2L","TopLeader",void 0);var E5,A5,T5,P5,O5,L5,I5,R5,_5,D5,M5,N5,B5,F5,x5,z5,U5,G5,H5,q5,V5,$5,W5,K5,j5,Y5,X5,J5,Z5,Q5,e3,t3,n3,i3,a3,o3,r3,l3,s3,u3,c3,d3=C.ccclass,h3=C.property,p3=Ludex.Utils.Number,y3=(a5=d3("TopLeader"),o5=h3(K),r5=h3(q),l5=h3({type:F}),s5=h3({type:He}),u5=h3({type:B}),c5=h3({type:K}),d5=h3({type:B}),h5=Ni.onlyRunInLifeCycle,p5=Ni.onlyRunInLifeCycleAsync,y5=Ni.onlyRunInLifeCycleAsync,a5((g5=a((f5=function(a){n(h,a);var s,u,c,d=i(h);function h(){var e;t(this,h);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=d.call.apply(d,[this].concat(i)),r(e,"nameLabel",g5,l(e)),r(e,"defaultAvatar",m5,l(e)),r(e,"avatar",b5,l(e)),r(e,"mask",w5,l(e)),r(e,"avatarOpacity",S5,l(e)),r(e,"scoreLabel",k5,l(e)),r(e,"uiOpacity",C5,l(e)),e.signal=new In,e}return e(h,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateUsername(e),this.updatePhoto(e),this.updateScore(e)}},{key:"updateUsername",value:function(e){this.nameLabel&&(this.nameLabel.string=e.name)}},{key:"updatePhoto",value:(c=o((function*(e){this.signal.abort();var t=new In;this.signal=t,this.mask.enabled=!1,this.defaultAvatar.active=!eN.isAvatarCached(e.playerId,128),this.avatar.spriteFrame=null;var n=e.playerId,i=e.photo,a=yield eN.getPlayerAvatar(i,n,128,t);a&&!t.aborted&&this.setPhoto(a)})),function(e){return c.apply(this,arguments)})},{key:"setPhoto",value:(u=o((function*(e){if(this.node.active){e.packable=!0,this.avatar.spriteFrame=e;var t=R(this.avatarOpacity).to(.2,{opacity:255});yield Ve.runTweenAsync(t,this.signal),this.enabledInHierarchy&&(this.mask.enabled=!0,this.defaultAvatar.active=!1)}})),function(e){return u.apply(this,arguments)})},{key:"updateScore",value:function(e){if(this.scoreLabel){var t=Math.floor(e.score);this.scoreLabel.string=p3.getShortNumber(t,7)}}},{key:"runShowUpAnimation",value:(s=o((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,n=arguments.length>2?arguments[2]:void 0;this.node.scale=V.ZERO;var i=R(this.node).delay(e).to(t,{scale:new V(1,1,1)},{easing:"backOut"}),a=R(this.uiOpacity).delay(e).to(t,{opacity:255});yield Promise.all([Ve.runTweenAsync(i,n),Ve.runTweenAsync(a,n)])})),function(e){return s.apply(this,arguments)})},{key:"setVisible",value:function(e){var t=e?255:0;this.uiOpacity.opacity=t,this.avatarOpacity.opacity=t}}]),h}(T)).prototype,"nameLabel",[o5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m5=a(f5.prototype,"defaultAvatar",[r5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b5=a(f5.prototype,"avatar",[l5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w5=a(f5.prototype,"mask",[s5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S5=a(f5.prototype,"avatarOpacity",[u5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k5=a(f5.prototype,"scoreLabel",[c5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C5=a(f5.prototype,"uiOpacity",[d5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(f5.prototype,"updateInfo",[h5],Object.getOwnPropertyDescriptor(f5.prototype,"updateInfo"),f5.prototype),a(f5.prototype,"updatePhoto",[p5],Object.getOwnPropertyDescriptor(f5.prototype,"updatePhoto"),f5.prototype),a(f5.prototype,"setPhoto",[y5],Object.getOwnPropertyDescriptor(f5.prototype,"setPhoto"),f5.prototype),v5=f5))||v5);S._RF.pop(),S._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var v3,f3,g3,m3,b3,w3=C.ccclass,S3=C.property,k3=codex,C3=k3.leaderboard,E3=k3.player,A3=k3.language,T3=Ludex.Utils,P3=T3.Time,O3=T3.Object,L3=T3.Array,I3=T3.Number,R3=(E5=w3("TournamentBlock"),A5=Ni.required,T5=S3(q),P5=Ni.required,O5=S3(K),L5=Ni.required,I5=S3({type:Kd,group:"Localize"}),R5=Ni.required,_5=S3({type:Kd,group:"Localize"}),D5=Ni.required,M5=S3({type:Kd,group:"Localize"}),N5=Ni.required,B5=S3({type:Kd,group:"Localize"}),F5=Ni.required,x5=S3(P),z5=Ni.required,U5=S3(B),G5=Ni.required,H5=S3({type:F,group:"Banner"}),q5=Ni.required,V5=S3({type:q,group:"Banner"}),$5=Ni.required,W5=S3({type:q,group:"Banner"}),K5=Ni.required,j5=S3(y3),Y5=Ni.onlyRunInLifeCycleAsync,X5=Ni.onlyRunInLifeCycle,E5((Q5=a((Z5=function(a){n(v,a);var s,u,c,d,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),r(e,"container",Q5,l(e)),r(e,"title",e3,l(e)),r(e,"titleLocalizer",t3,l(e)),r(e,"timeLocalizer",n3,l(e)),r(e,"playerCountLocalizer",i3,l(e)),r(e,"playButtonLocalize",a3,l(e)),r(e,"uiTransform",o3,l(e)),r(e,"uiOpacity",r3,l(e)),r(e,"banner",l3,l(e)),r(e,"bannerMask",s3,l(e)),r(e,"bannerLoadingRing",u3,l(e)),r(e,"topLeader",c3,l(e)),e.hasPlayedAnimation=!1,e}return e(v,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,v)}},{key:"updateInfo",value:(p=o((function*(e){this.payload=e;var t=e.endTime,n=e.title,i=e.payload.playerName,a=e.tournamentType,o=e.payload,r=o.leaderboardId,l=o.themeId,s=void 0===l?pt.AUTUMN:l;r&&(this.topLeader.setVisible(!1),this.topLeader.node.active=!1,this.setPlayerCountWaiting(),"PAGE_HOSTED"===a?this.updateTitleTournamentTitle(n):this.updateTitleWithPlayerName(null!=i?i:n),this.updateEndTime(t),this.updateTournamentBanner(s),yield this.fetchAndUpdateLeadersPayload(r,{leaders:[],amountPlayer:0},n))})),function(e){return p.apply(this,arguments)})},{key:"fetchAndUpdateLeadersPayload",value:(h=o((function*(e,t,n){var i=t;try{var a=yield this.getLeadersPayload(e);a&&(i=a)}catch(e){console.error("Fetch lb for tournament ".concat(n),e)}this.updateLeadersPayload(i)})),function(e,t,n){return h.apply(this,arguments)})},{key:"updateLeadersPayload",value:function(e){this.leadersPayload=e;var t=this.leadersPayload,n=t.player,i=t.amountPlayer,a=t.leaders;this.updatePlayerCount(i),this.updatePlayButtonLabel(void 0!==n),this.updateTopLeader(null!=a?a:[])}},{key:"updateTitleWithPlayerName",value:function(e){void 0!==e&&(this.titleLocalizer.enabled=!0,this.titleLocalizer.setParams([e]))}},{key:"updateTitleTournamentTitle",value:function(e){this.titleLocalizer.enabled=!1,this.title.string=e}},{key:"updateEndTime",value:function(e){try{var t=P3.getRelativeTime(e,A3.getCurrentLocale());this.timeLocalizer.key="game.endsIn",this.timeLocalizer.setParams([t])}catch(e){this.timeLocalizer.key="game.endsSoon"}}},{key:"updatePlayerCount",value:function(e){var t=I3.getShortNumber(e,3);1===e?this.playerCountLocalizer.key="game.player":(this.playerCountLocalizer.key="game.nPlayers",this.playerCountLocalizer.setParams([t]))}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLocalizer.key="status.loading"}},{key:"updateTopLeader",value:(d=o((function*(e){if(0!==e.length){var t,n=e[0];if(n)Ludex.Configs.Mockup.Leaderboards.Enabled&&(n=null!==(t=L3.search(e,(function(e){return 1===e.rank})))&&void 0!==t?t:n),this.topLeader.node.active=!0,this.topLeader.updateInfo(n),this.topLeader.runShowUpAnimation(0,.2)}})),function(e){return d.apply(this,arguments)})},{key:"updateTournamentBanner",value:(c=o((function*(e){var t=qe.getAsset("".concat(ft[e],"/spriteFrame"),ue);t||(this.bannerMask.active=!0,this.bannerLoadingRing.active=!0,t=yield qe.loadThemePreviewAsync(e)),t||(t=yield qe.loadThemePreviewAsync(pt.SUMMER)),this.banner&&t&&(this.banner.spriteFrame=t,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1)})),function(e){return c.apply(this,arguments)})},{key:"updatePlayButtonLabel",value:function(e){this.playButtonLocalize.key=e?"game.continue":"game.join"}},{key:"getLeadersPayload",value:(u=o((function*(e){var t,n=C3.getLeaderboardName(e);if(!n)return null;var i=yield fD.getAllLeaderboardAsync(e);if(!i)return null;var a=O3.vals(i.leaders);a.sort((function(e,t){return e.rank-t.rank}));var o=E3.getPlayerId(),r=yield C3.getLeadersByPlayerIdsAsync(n,[o]),l={leaders:a,amountPlayer:null!==(t=i.amountPlayer)&&void 0!==t?t:0};return r.length>0&&(l.player=r[0]),l})),function(e){return u.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(s=o((function*(e,t,n){var i=this;this.node.scale=new V(.8,.8,.8),this.uiOpacity.opacity=0;var a=this.container.position.clone();this.container.position=new V(a.x,a.y-100,a.z);var o=R(this.node).delay(e);o.to(t,{scale:V.ONE},{easing:"elasticOut"});var r=R(this.container).delay(e);r.to(t,{position:a},{easing:"backOut"});var l=R(this.uiOpacity).delay(e);l.to(t,{opacity:255},{easing:"cubicOut"});var s=function(){i.node.setScale(V.ONE),i.container.setPosition(a),i.uiOpacity.opacity=255};n.addAbortListener(s),yield Promise.all([Ve.runTweenAsync(o,n),Ve.runTweenAsync(r,n),Ve.runTweenAsync(l,n)]),n.removeAbortListener(s)})),function(e,t,n){return s.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var e=this.payload.id||"";if(st.validateTournamentExpired(e))return this.node.scene.emit(Py.RELOAD_TOURNAMENT),void rt.showNotificationScreenWithLocalizedKey("error.tourEnded",2);try{var t=JSON.stringify(this.payload),n=this.leadersPayload.player?"tournament_end":"tournament_start";rt.showTournamentDetailScreen(t,n,this.hasPlayedAnimation),this.hasPlayedAnimation=!0}catch(e){console.warn("handleOnTournamentClicked",e)}}}]),v}(T)).prototype,"container",[A5,T5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e3=a(Z5.prototype,"title",[P5,O5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t3=a(Z5.prototype,"titleLocalizer",[L5,I5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n3=a(Z5.prototype,"timeLocalizer",[R5,_5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i3=a(Z5.prototype,"playerCountLocalizer",[D5,M5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a3=a(Z5.prototype,"playButtonLocalize",[N5,B5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o3=a(Z5.prototype,"uiTransform",[F5,x5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r3=a(Z5.prototype,"uiOpacity",[z5,U5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l3=a(Z5.prototype,"banner",[G5,H5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s3=a(Z5.prototype,"bannerMask",[q5,V5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u3=a(Z5.prototype,"bannerLoadingRing",[$5,W5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c3=a(Z5.prototype,"topLeader",[K5,j5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Z5.prototype,"fetchAndUpdateLeadersPayload",[Y5],Object.getOwnPropertyDescriptor(Z5.prototype,"fetchAndUpdateLeadersPayload"),Z5.prototype),a(Z5.prototype,"updateLeadersPayload",[X5],Object.getOwnPropertyDescriptor(Z5.prototype,"updateLeadersPayload"),Z5.prototype),J5=Z5))||J5);S._RF.pop(),S._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var _3,D3,M3,N3,B3,F3,x3,z3,U3,G3,H3,q3=C.ccclass,V3=C.property,$3=(v3=q3("TournamentBlockSkeleton"),f3=V3(q),v3((b3=a((m3=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"container",b3,l(e)),e}return e(d,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(B),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"hide",value:(u=o((function*(e){var t=this;yield Ve.runTweenAsync(R(this.uiOpacity).to(.2,{opacity:0}).call((function(){t.node.active=!1})),e)})),function(e){return u.apply(this,arguments)})},{key:"show",value:(s=o((function*(e,t){var n=this;this.node.active=!0,this.node.scale=new V(.8,.8,.8),this.uiOpacity.opacity=0;var i=this.container.position.clone();this.container.position=new V(i.x,i.y-100,i.z);var a=R(this.node).delay(e);a.to(.2,{scale:V.ONE},{easing:"elasticOut"});var o=R(this.container).delay(e);o.to(.2,{position:i},{easing:"backOut"});var r=R(this.uiOpacity).delay(e);r.to(.2,{opacity:255},{easing:"cubicOut"});var l=function(){n.node.setScale(V.ONE),n.container.setPosition(i),n.uiOpacity.opacity=255};t.addAbortListener(l),yield Promise.all([Ve.runTweenAsync(a,t),Ve.runTweenAsync(o,t),Ve.runTweenAsync(r,t)]),t.removeAbortListener(l)})),function(e,t){return s.apply(this,arguments)})}]),d}(T)).prototype,"container",[f3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g3=m3))||g3);S._RF.pop(),S._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var W3,K3=C.ccclass,j3=C.property,Y3=codex.player,X3=(_3=K3("TournamentsBoard"),D3=j3(fe),M3=j3(_),N3=j3(q),B3=j3(P),_3((z3=a((x3=function(a){n(d,a);var s,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"tournamentBlockPrefab",z3,l(e)),e.tournamentBlockArray=[],r(e,"layout",U3,l(e)),r(e,"createTournamentButton",G3,l(e)),r(e,"viewport",H3,l(e)),e}return e(d,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(B),this.validateRequiredComponents()}},{key:"start",value:function(){for(var e=0;e<6;e++)this.addTournamentBlock();var t=this.tournamentBlockArray[0];t&&(this.tournamentBlockContentHeight=t.uiTransform.contentSize.height+this.layout.spacingY)}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"updateData",value:function(e){var t=this,n=!1;e.forEach((function(e,i){var a=t.tournamentBlockArray[i];e.payload.playerId===Y3.getPlayerId()&&(n=!0),a||(a=t.addTournamentBlock()),a.node.active=!0,a.updateInfo(e)})),n||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var e=ye(this.tournamentBlockPrefab);this.layout.node.addChild(e),e.active=!1;var t=e.getComponent(R3);return this.tournamentBlockArray.push(t),t}},{key:"removeTournamentBlocks",value:function(){var e,t=this.getActiveTournamentBlocks(),n=u(t);try{for(n.s();!(e=n.n()).done;){e.value.node.active=!1}}catch(e){n.e(e)}finally{n.f()}this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var e=this;return this.tournamentBlockArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"setCreateTournamentButtonActive",value:function(e){GameSDK.isGameSDK("FacebookInstant")&&(e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e)}},{key:"showTournamentBlocks",value:(s=o((function*(e,t){var n=this.getActiveTournamentBlocks();if(!(n.length<1)){var i=Math.ceil(e/this.tournamentBlockContentHeight),a=Math.min(n.length,i);yield Promise.all(n.map(function(){var e=o((function*(e,n){n<a?yield e.runShowPopUpAnimation(.1*n,.3,t):e.uiOpacity.opacity=255}));return function(t,n){return e.apply(this,arguments)}}()))}})),function(e,t){return s.apply(this,arguments)})},{key:"updateVisibility",value:function(){var e,t=this.viewport.getBoundingBoxToWorld(),n=t.yMax,i=t.yMin,a=this.getActiveTournamentBlocks(),o=u(a);try{for(o.s();!(e=o.n()).done;){var r=e.value,l=r.uiTransform;if(void 0!==l){var s=l.getBoundingBoxToWorld(),c=s.yMax,d=s.yMin,h=c<i||d>n;r.uiOpacity.opacity=h?0:255}}}catch(e){o.e(e)}finally{o.f()}}}]),d}(T)).prototype,"tournamentBlockPrefab",[D3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U3=a(x3.prototype,"layout",[M3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G3=a(x3.prototype,"createTournamentButton",[N3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H3=a(x3.prototype,"viewport",[B3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F3=x3))||F3);S._RF.pop(),S._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var J3,Z3,Q3,e6,t6,n6,i6,a6,o6,r6,l6,s6,u6,c6,d6,h6=(0,C.ccclass)("TournamentsNotAvailable")(W3=function(a){n(s,a);var r,l=i(s);function s(){return t(this,s),l.apply(this,arguments)}return e(s,[{key:"onLoad",value:function(){this.hide()}},{key:"show",value:(r=o((function*(){this.node.active=!0;var e=this.node.position.clone(),t=R(this.node);t.to(.05,{position:e.clone().add3f(5,0,0)}),t.to(.05,{position:e.clone().add3f(-5,0,0)});var n=R(this.node).repeat(2,t);n.to(.05,{position:e}),yield Ve.runTweenAsync(n)})),function(){return r.apply(this,arguments)})},{key:"hide",value:function(){this.node.active=!1}}]),s}(T))||W3;S._RF.pop(),S._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var p6,y6,v6,f6,g6,m6,b6,w6,S6,k6=C.ccclass,C6=C.property,E6=codex,A6=E6.storage,T6=E6.match,P6=Ludex.Utils,O6=P6.Object,L6=P6.Array,I6=(J3=k6("TournamentContent"),Z3=C6({type:Ys}),Q3=C6(X3),e6=C6(h6),t6=C6(Ue),n6=C6({type:[$3]}),i6=C6(qr),J3((r6=a((o6=function(a){n(p,a);var s,u,c,d,h=i(p);function p(){var e;t(this,p);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=h.call.apply(h,[this].concat(i)),r(e,"panelAnimator",r6,l(e)),r(e,"tournamentsBoard",l6,l(e)),r(e,"tournamentsNotAvailable",s6,l(e)),r(e,"scrollView",u6,l(e)),r(e,"skeletons",c6,l(e)),r(e,"contentOpacity",d6,l(e)),e.animAbortSignal=null,e.softAbortSignal=null,e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return e(p,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(P),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(Ue.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(Py.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(Es.HIDE_UI,this.hideContent),this.node.scene.on(Es.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(Ue.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(Py.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(Es.HIDE_UI,this.hideContent),this.node.scene.off(Es.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(d=o((function*(){var e;if(null===this.animAbortSignal&&null===this.softAbortSignal&&(this.animAbortSignal=new In,this.softAbortSignal=new In,yield this.showLoading(this.animAbortSignal),!this.isAborted())){var t=yield st.requestTournamentDataAsync();this.isAborted()||(yield this.hideLoading(this.animAbortSignal),this.isAborted()||(0!==t.length||null!==(e=this.softAbortSignal)&&void 0!==e&&e.aborted?(this.tournamentsNotAvailable.hide(),this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(t),yield this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal),this.tournamentsBoard.updateVisibility()):this.tournamentsNotAvailable.show()))}})),function(){return d.apply(this,arguments)})},{key:"showLoading",value:(c=o((function*(e){this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,yield Promise.all([this.skeletons.map((function(t){return t.show(0,e)}))])})),function(e){return c.apply(this,arguments)})},{key:"hideLoading",value:(u=o((function*(e){yield Promise.all([this.skeletons.map((function(t){return t.hide(e)}))])})),function(e){return u.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!A6.getStorage("tournament").animateTournamentLeader)return;var e=st.getAllTournamentData(),t=T6.getMatchState().customData.tournamentId;if(!t)throw new Error("Tournament ID not found");var n=L6.search(e,(function(e){return e.id===t}));if(!n)throw new Error("Tournament not found");var i=JSON.stringify(n);rt.showTournamentDetailScreen(i,"tournament_end")}catch(e){A6.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}},{key:"processCreateTournament",value:(s=o((function*(){try{yield Xy.processCreateTournamentAsync()}catch(e){if(!O6.hasOwn(e,"code"))return void rt.showNotificationScreenWithLocalizedKey("error.createTourFail",2);if("USER_INPUT"===e.code)return;if("PLAYER_HAS_TOURNAMENT"===e.code)return void rt.showNotificationScreenWithLocalizedKey("error.tourExists",2);"INVALID_OPERATION"===e.code&&O6.hasOwn(e,"message")&&"string"==typeof e.message&&rt.showNotificationScreen(e.message,2),rt.showNotificationScreenWithLocalizedKey("error.createTourFail",2)}this.reload()})),function(){return s.apply(this,arguments)})},{key:"isAborted",value:function(){var e,t;return null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e}},{key:"cleanup",value:function(){var e;this.unlistenEvents(),null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var e;null===(e=this.softAbortSignal)||void 0===e||e.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.listenEvents(),this.enter()}}]),p}(T)).prototype,"panelAnimator",[Z3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l6=a(o6.prototype,"tournamentsBoard",[Q3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s6=a(o6.prototype,"tournamentsNotAvailable",[e6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u6=a(o6.prototype,"scrollView",[t6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c6=a(o6.prototype,"skeletons",[n6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),d6=a(o6.prototype,"contentOpacity",[i6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a6=o6))||a6);S._RF.pop(),S._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var R6,_6,D6,M6,N6,B6;p6=(0,C.ccclass)("TournamentPage"),y6=Ni.required(),v6=Ni.onlyRunInLifeCycleAsync,f6=Ni.onlyRunInLifeCycle,g6=Ni.onlyRunInLifeCycleAsync,m6=Ni.onlyRunInLifeCycleAsync,p6((S6=a((w6=function(a){n(v,a);var s,u,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),r(e,"panelAnimationController",S6,l(e)),e}return e(v,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(qs),c(d(v.prototype),"onLoad",this).call(this)}},{key:"start",value:(p=o((function*(){c(d(v.prototype),"start",this).call(this)})),function(){return p.apply(this,arguments)})},{key:"mount",value:(h=o((function*(){yield c(d(v.prototype),"mount",this).call(this),this.onMount()})),function(){return h.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(I6),!this.content)throw new Error("LeaderboardPage: Leaders not found")}},{key:"transitionIn",value:(u=o((function*(){yield c(d(v.prototype),"transitionIn",this).call(this);var e=Ve.runTweenAsync(R(this.containerUIOpacity).to(.2,{opacity:255})),t=this.panelAnimationController.showUI();this.content.listenEvents(),yield Promise.all([e,t]),this.content.enter()})),function(){return u.apply(this,arguments)})},{key:"transitionOut",value:(s=o((function*(){var e;null===(e=this.content)||void 0===e||e.softAbort(),this.content.unlistenUIEvents(),yield c(d(v.prototype),"transitionOut",this).call(this),yield this.panelAnimationController.hideUI()})),function(){return s.apply(this,arguments)})},{key:"unmount",value:function(){var e;null===(e=this.content)||void 0===e||e.cleanup(),c(d(v.prototype),"unmount",this).call(this)}}]),v}(pX)).prototype,"panelAnimationController",[y6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(w6.prototype,"mount",[v6],Object.getOwnPropertyDescriptor(w6.prototype,"mount"),w6.prototype),a(w6.prototype,"onMount",[f6],Object.getOwnPropertyDescriptor(w6.prototype,"onMount"),w6.prototype),a(w6.prototype,"transitionIn",[g6],Object.getOwnPropertyDescriptor(w6.prototype,"transitionIn"),w6.prototype),a(w6.prototype,"transitionOut",[m6],Object.getOwnPropertyDescriptor(w6.prototype,"transitionOut"),w6.prototype),b6=w6));S._RF.pop(),S._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var F6,x6,z6,U6,G6,H6,q6,V6,$6,W6=C.ccclass,K6=C.property;R6=W6("EventBadge"),_6=K6(K),D6=K6(E),R6((B6=a((N6=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"label",B6,l(e)),e}return e(s,[{key:"text",get:function(){return this.label.string},set:function(e){this.label.string=e}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),s}(T)).prototype,"label",[_6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(N6.prototype,"text",[D6],Object.getOwnPropertyDescriptor(N6.prototype,"text"),N6.prototype),M6=N6));S._RF.pop(),S._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var j6,Y6,X6,J6,Z6,Q6,e9,t9,n9,i9,a9,o9,r9,l9,s9,u9,c9,d9,h9,p9,y9,v9,f9,g9,m9,b9,w9,S9,k9,C9,E9,A9,T9,P9,O9,L9,I9,R9,_9,D9,M9,N9,B9,F9,x9,z9,U9,G9,H9=C.ccclass,q9=C.property;F6=H9("EventProgressBar"),x6=q9(kc),z6=q9(K),U6=q9(E),G6=q9({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),F6((V6=a((q6=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"progressBar",V6,l(e)),r(e,"progressLabel",$6,l(e)),e}return e(s,[{key:"text",get:function(){return this.progressLabel.string},set:function(e){this.progressLabel.string=e}},{key:"progress",get:function(){return this.progressBar.progress},set:function(e){this.progressBar.progress=e}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),s}(T)).prototype,"progressBar",[x6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$6=a(q6.prototype,"progressLabel",[z6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(q6.prototype,"text",[U6],Object.getOwnPropertyDescriptor(q6.prototype,"text"),q6.prototype),a(q6.prototype,"progress",[G6],Object.getOwnPropertyDescriptor(q6.prototype,"progress"),q6.prototype),H6=q6));S._RF.pop(),S._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var V9,$9,W9,K9,j9,Y9,X9,J9=C.ccclass,Z9=C.property,Q9=C.executeInEditMode,e4=codex.analytics,t4=(null!==(j6=Ludex.Plugins.Analytics)&&void 0!==j6?j6:{}).Events;Y6=J9("NavButton"),X6=Z9(W),J6=Z9({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),Z6=Z9({type:L,group:{name:"Animation"}}),Q6=Z9({type:L,group:{name:"Animation"}}),e9=Z9({type:L,group:{name:"Animation"}}),t9=Z9({type:L,group:{name:"Animation"}}),n9=Z9({type:L,group:{name:"Animation"}}),i9=Z9({group:{name:"Animation"}}),a9=Z9({type:L,group:{name:"Animation"}}),o9=Z9({type:L,group:{name:"Animation"}}),r9=Z9({group:{name:"Animation"}}),l9=Z9({type:L,group:{name:"Animation"}}),s9=Z9({type:L,group:{name:"Animation"}}),u9=Z9({type:L,group:{name:"Animation"}}),c9=Z9({type:L,group:{name:"Animation"}}),d9=Z9({type:L,group:{name:"Animation"}}),h9=Z9({type:P}),p9=Z9(q),y9=Z9(B),v9=Z9({type:P}),f9=Z9({type:x(On)}),g9=Z9(mZ),Y6(m9=Q9((w9=a((b9=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"wip",w9,l(e)),r(e,"isSelectedInEditor",S9,l(e)),r(e,"animationDuration",k9,l(e)),r(e,"selectedSpacing",C9,l(e)),r(e,"deselectedSpacing",E9,l(e)),r(e,"selectedIconY",A9,l(e)),r(e,"selectedIconX",T9,l(e)),r(e,"selectedIconScale",P9,l(e)),r(e,"deselectedIconY",O9,l(e)),r(e,"deselectedIconX",L9,l(e)),r(e,"deselectedIconScale",I9,l(e)),r(e,"initTextY",R9,l(e)),r(e,"selectedTextY",_9,l(e)),r(e,"selectedTextX",D9,l(e)),r(e,"deselectedTextY",M9,l(e)),r(e,"deselectedTextX",N9,l(e)),r(e,"spacer",B9,l(e)),r(e,"icon",F9,l(e)),r(e,"text",x9,l(e)),r(e,"uiTransform",z9,l(e)),r(e,"screenType",U9,l(e)),r(e,"navManager",G9,l(e)),e.isSelected=!1,e.onMouseEnter=function(t){e.isSelected||e.playHoverOnAnimation()},e.onMouseLeave=function(t){e.isSelected||e.playHoverOffAnimation()},e}return e(d,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(q.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(q.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(q.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(q.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.initTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var e,t;this.isSelected||(je.playSound(Qi.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),t4&&e4.event(t4.BUTTON_CLICK,{button_name:null!==(e=null===(t=this.node.parent)||void 0===t?void 0:t.name)&&void 0!==e?e:this.node.name,screen_name:Ye.getCurrentPage()}))}},{key:"select",value:(u=o((function*(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0,e?yield Ve.runTweenAsync(this.playSelectAnimation()):(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255)})),function(){return u.apply(this,arguments)})},{key:"deselect",value:(s=o((function*(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isSelected&&!t)throw new Error("NavButton: Already deselected");this.isSelected=!1,e?yield Ve.runTweenAsync(this.deselectAnimation()):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0)})),function(){return s.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var e=new V(this.selectedIconX,this.selectedIconY,0),t=new V(this.deselectedIconX,this.deselectedIconY,0),n=this.node.scale.clone();this.node.scale=this.selectedIconScale;var i=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=n,a.x-i.x}},{key:"playHoverOnAnimation",value:function(){var e=R(this.icon);return e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),Ve.runTweenAsync(e)}},{key:"playHoverOffAnimation",value:function(){var e=R(this.icon);return e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),Ve.runTweenAsync(e)}},{key:"playSelectAnimation",value:function(){var e=this;return R(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=z.quintInOut(n),a=z.backOut(n),o=z.linear(n),r=n<.5?2*n:1,l=e.deselectedIconY+(e.selectedIconY-e.deselectedIconY)*a,s=e.deselectedIconX+(e.selectedIconX-e.deselectedIconX)*o;e.icon.setPosition(s,l,0);var u=e.deselectedIconScale.clone().lerp(e.selectedIconScale,i);e.icon.setScale(u.x,u.y,e.icon.scale.z);var c=255*r,d=e.deselectedTextY+(e.selectedTextY-e.deselectedTextY)*o,h=e.deselectedTextX+(e.selectedTextX-e.deselectedTextX)*o;e.text.opacity=c,e.text.node.setPosition(h,d,0)}}})}},{key:"deselectAnimation",value:function(){var e=this;return R(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=Se(e.selectedIconY,e.deselectedIconY,n),a=Se(e.selectedIconX,e.deselectedIconX,n);e.icon.setPosition(a,i,0);var o=Se(255,0,n<.5?2*n:1);e.text.opacity=o;var r=Se(e.selectedTextY,e.deselectedTextY,n),l=Se(e.selectedTextX,e.deselectedTextX,n);e.text.node.setPosition(l,r,0);var s=e.selectedIconScale.clone().lerp(e.deselectedIconScale,z.quintInOut(n));e.icon.setScale(s.x,s.y,e.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(P),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}}]),d}(T)).prototype,"wip",[X6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),S9=a(b9.prototype,"isSelectedInEditor",[J6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),k9=a(b9.prototype,"animationDuration",[Z6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),C9=a(b9.prototype,"selectedSpacing",[Q6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),E9=a(b9.prototype,"deselectedSpacing",[e9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),A9=a(b9.prototype,"selectedIconY",[t9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),T9=a(b9.prototype,"selectedIconX",[n9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),P9=a(b9.prototype,"selectedIconScale",[i9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new V(1,1,1)}}),O9=a(b9.prototype,"deselectedIconY",[a9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),L9=a(b9.prototype,"deselectedIconX",[o9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I9=a(b9.prototype,"deselectedIconScale",[r9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new V(.8,.8,1)}}),R9=a(b9.prototype,"initTextY",[l9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-100}}),_9=a(b9.prototype,"selectedTextY",[s9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),D9=a(b9.prototype,"selectedTextX",[u9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M9=a(b9.prototype,"deselectedTextY",[c9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),N9=a(b9.prototype,"deselectedTextX",[d9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B9=a(b9.prototype,"spacer",[h9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F9=a(b9.prototype,"icon",[p9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x9=a(b9.prototype,"text",[y9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z9=a(b9.prototype,"uiTransform",[v9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U9=a(b9.prototype,"screenType",[f9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G9=a(b9.prototype,"navManager",[g9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m9=b9))||m9);S._RF.pop(),S._RF.push({},"091aai5+ANDeZfFN8JFkbyi","TournamentButton",void 0);var n4,i4,a4,o4,r4,l4,s4,u4,c4=Ludex.Utils.Signal,d4=C.ccclass,h4=C.property,p4=new V(1.1,1.1);V9=d4("TournamentButton"),$9=Ni.required,W9=h4(q),K9=Ni.onlyRunInLifeCycle,V9((X9=a((Y9=function(a){n(y,a);var s,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"hotIcon",X9,l(e)),e.requestController=new c4.SignalController,e}return e(y,[{key:"__preload",value:function(){Ni.validateRequiredProperties(this,y)}},{key:"onLoad",value:(h=o((function*(){yield this.handleHotIconAppearance()})),function(){return h.apply(this,arguments)})},{key:"onDestroy",value:function(){this.requestController.abort()}},{key:"handleHotIconAppearance",value:(d=o((function*(){GameSDK.isGameSDK("MsGames")?this.handleMsGamesHotIconCheck():this.handleNormalHotIconCheck()})),function(){return d.apply(this,arguments)})},{key:"handleMsGamesHotIconCheck",value:(c=o((function*(){try{var e=this.requestController.renew(),t=yield st.requestTournamentDataAsync();if(e.aborted)return;t.filter((function(e){return!st.validateTournamentExpired(e.id)})).length>=2&&this.showHotIcon(e)}catch(e){console.info("Error in TournamentButton",e)}})),function(){return c.apply(this,arguments)})},{key:"handleNormalHotIconCheck",value:(s=o((function*(){try{var e=this.requestController.renew(),t=yield st.requestTournamentDataAsync();if(e.aborted)return;var n,i=u(t);try{for(i.s();!(n=i.n()).done;){var a=n.value.payload,o=a.leaderboardId,r=a.playerId;if(o&&"global"===r){var l=yield fD.getAllLeaderboardAsync(o);if(l&&l.amountPlayer>=30){this.showHotIcon(e);break}}}}catch(e){i.e(e)}finally{i.f()}}catch(e){console.info("Error in TournamentButton",e)}})),function(){return s.apply(this,arguments)})},{key:"showHotIcon",value:function(e){this.hotIcon.active=!0,this.hotIcon.setScale(V.ZERO);var t=R(this.hotIcon).delay(1).to(.3,{scale:p4},{easing:"backIn"}).to(.3,{scale:V.ONE},{easing:"backOut"});Ve.runTweenAsync(R(this.hotIcon).to(.5,{scale:V.ONE},{easing:"backOut"}).repeatForever(t),e)}}]),y}(T)).prototype,"hotIcon",[$9,W9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Y9.prototype,"showHotIcon",[K9],Object.getOwnPropertyDescriptor(Y9.prototype,"showHotIcon"),Y9.prototype),j9=Y9));S._RF.pop(),S._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var y4,v4,f4,g4,m4,b4,w4,S4=C.ccclass,k4=C.property,C4=C.disallowMultiple,E4=codex,A4=E4.player,T4=E4.event,P4=Ke.Layout,O4=Ludex,L4=O4.Match.Modes,I4=O4.Events;n4=S4("GameScene"),i4=Ni.required,a4=k4(wS),o4=Ni.onlyRunInLifeCycle,r4=Ni.onlyRunInLifeCycle,n4(l4=C4((u4=a((s4=function(a){n(u,a);var s=i(u);function u(){var e;t(this,u);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=s.call.apply(s,[this].concat(i)),r(e,"coinManager",u4,l(e)),e.handleGameExit=function(){ct.switchToDashboardScene()},e.handleShowResults=function(){ct.switchScene(yt.CHALLENGE_RESULT_SCENE)},e.handleGameMaskWhenLayoutChanged=function(e){var t=re("Canvas/Game/GameObjects");if(t){var n=t.getComponent(He);n&&(n.enabled=e===P4.Landscape)}},e.updateMusic=o((function*(){var e=Xy.getMatchMode()===L4.TOURNAMENT,t=e?Qi.TOURNAMENT_MUSIC:Qi.BG_MUSIC;je.getCurrentMusic()!==t&&(yield je.setVolumeMusic(0,!0),yield Ve.waitTweenAsync(1)),je.playMusic(t,e),je.setVolumeMusic(e?.4:.3,!0)})),e}return e(u,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){this.coinManager.init()}},{key:"validateRequiredComponents",value:function(){Ni.validateRequiredProperties(this,u)}},{key:"listenGameEvents",value:function(){D.on($e.ORIENTATION_CHANGED,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(Es.GAME_EXIT,this.handleGameExit),this.node.scene.on(Es.SHOW_CHALLENGE_RESULTS,this.handleShowResults),this.node.scene.on(Es.UPDATE_MUSIC,this.updateMusic)}},{key:"start",value:function(){A4.getPlayerSetting("music")&&this.updateMusic(),this.scheduleOnce(this.preloadScenes,20),this.scheduleOnce(this.preloadScreens,10)}},{key:"preloadScenes",value:function(){ct.preloadDashboardScene()}},{key:"preloadScreens",value:function(){var e,t=A4.getGameData(),n=null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1;n%5==0&&rt.preloadScreen(lt.HARD_LEVEL_SCREEN),n>=it&&(rt.preloadScreen(lt.CONGRATULATION_SCREEN),rt.preloadScreen(lt.START_OVER_SCREEN)),rt.preloadScreen(lt.PAUSE_SCREEN),rt.preloadScreen(lt.LOADING_SCREEN),rt.preloadScreen(lt.GET_ITEM_SCREEN),rt.preloadScreen(lt.NOTIFICATION_SCREEN),this.node.scene.once(Es.GAME_FINISH,(function(){rt.preloadScreen(lt.LEVEL_COMPLETE_SCREEN),rt.preloadScreen(lt.GET_REWARDS_SCREEN)})),T4.once(I4.OPENED_SCREEN,(function(e){e.screenName===ht[lt.PAUSE_SCREEN]&&(rt.preloadScreen(lt.QUIT_LEVEL_SCREEN),rt.preloadScreen(lt.START_OVER_SCREEN),rt.preloadScreen(lt.CUSTOM_GAME_SCREEN))}))}}]),u}(T)).prototype,"coinManager",[i4,a4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(s4.prototype,"preloadScenes",[o4],Object.getOwnPropertyDescriptor(s4.prototype,"preloadScenes"),s4.prototype),a(s4.prototype,"preloadScreens",[r4],Object.getOwnPropertyDescriptor(s4.prototype,"preloadScreens"),s4.prototype),l4=s4))||l4);S._RF.pop(),S._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var R4,_4,D4,M4,N4,B4,F4,x4=C.ccclass,z4=C.property;y4=x4("ComboEffect"),v4=z4(B),f4=z4(ee),y4((b4=a((m4=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"circleOpacity",b4,l(e)),r(e,"particle",w4,l(e)),e}return e(s,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(Es.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){e>1&&(this.circleOpacity.node.scale=V.ZERO,this.circleOpacity.opacity=60,this.particle.resetSystem(),R(this.circleOpacity.node).to(.2,{scale:new V(1.3,1.3,1.3)},{easing:"quadOut"}).start(),R(this.circleOpacity).delay(.3).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),s}(T)).prototype,"circleOpacity",[v4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w4=a(m4.prototype,"particle",[f4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g4=m4));S._RF.pop(),S._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var U4,G4,H4,q4,V4,$4,W4,K4,j4,Y4,X4,J4,Z4=C.ccclass,Q4=C.property;R4=Z4("ComboLabel"),_4=Q4(K),D4=Q4(q),R4((B4=a((N4=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"comboNumber",B4,l(e)),r(e,"comboContainer",F4,l(e)),e}return e(s,[{key:"onLoad",value:function(){this.opacity=this.getComponent(B),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(Es.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(e),R(this.comboContainer).to(.1,{scale:new V(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:V.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),s}(T)).prototype,"comboNumber",[_4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F4=a(N4.prototype,"comboContainer",[D4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M4=N4));S._RF.pop(),S._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var e8,t8,n8,i8,a8,o8,r8,l8,s8,u8,c8,d8,h8,p8,y8,v8,f8,g8,m8=Ludex.Utils.Signal,b8=C.ccclass,w8=C.property,S8=Ke.Layout,k8=["good","great","excellent"];U4=b8("ComboPopup"),G4=Ni.required(),H4=w8(Kd),q4=Ni.required(),V4=w8(ce),$4=Ni.required(),W4=w8(B),U4((Y4=a((j4=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"spriteLocalizer",Y4,l(e)),r(e,"animation",X4,l(e)),r(e,"textUiOpacity",J4,l(e)),e.comboController=new m8.SignalController,e}return e(c,[{key:"__preload",value:function(){this.widget=this.getComponent(I),Ni.validateRequiredProperties(this)}},{key:"onLoad",value:function(){D.on($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Je.getCurrentLayout())}},{key:"onDestroy",value:function(){D.off($e.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.comboController.abort()}},{key:"start",value:function(){this.node.scene.on(Es.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:(s=o((function*(e){if(!(e<2))for(var t=k8.length-1;t>=0;t--){var n=k8[t];if(e>=t+2){var i=this.comboController.renew();if(this.spriteLocalizer.key=n,this.textUiOpacity.opacity=0,yield this.spriteLocalizer.waitUntilLocalized(),i.aborted)return;return Ve.runTweenAsync(R(this.textUiOpacity).to(.25,{opacity:255}),i),void this.animation.play()}}})),function(e){return s.apply(this,arguments)})},{key:"handleOrientationChanged",value:function(e){e===S8.Portrait?(this.widget.left=20,this.widget.right=20):e===S8.Landscape&&(this.widget.left=700,this.widget.right=120)}}]),c}(T)).prototype,"spriteLocalizer",[G4,H4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X4=a(j4.prototype,"animation",[q4,V4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J4=a(j4.prototype,"textUiOpacity",[$4,W4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K4=j4));S._RF.pop(),S._RF.push({},"11abe47Ss1CtabSFT1/cPKt","PlayableScene",void 0);var C8,E8,A8,T8,P8,O8,L8,I8,R8,_8,D8,M8,N8,B8,F8,x8,z8=C.ccclass,U8=C.property,G8=C.disallowMultiple,H8=codex.analytics;e8=z8("PlayableScene"),t8=Ni.required(),n8=U8({type:K}),i8=Ni.required(),a8=U8({type:oT}),o8=Ni.required(),r8=U8({type:oT}),l8=Ni.required(),s8=U8({type:ce}),u8=Ni.onlyRunInLifeCycleAsync,c8=Ni.onlyRunInLifeCycle,d8=Ni.onlyRunInLifeCycle,e8(h8=G8((y8=a((p8=function(a){n(h,a);var s,u,c,d=i(h);function h(){var e;return t(this,h),e=d.call(this),r(e,"label",y8,l(e)),r(e,"particleLeft",v8,l(e)),r(e,"particleRight",f8,l(e)),r(e,"backgroundAnimation",g8,l(e)),ct.markIsTestScene(yt.PLAYABLE_SCENE),e}return e(h,[{key:"__preload",value:function(){this.listenEvents()}},{key:"onLoad",value:function(){Ni.validateRequiredProperties(this)}},{key:"listenEvents",value:function(){}},{key:"start",value:(c=o((function*(){H8.event("ready_playable"),yield this.waitViewable(),this.playTweens(),this.playParticles(),this.playAnimations(),H8.event("showing_playable"),setTimeout((function(){"openAppStore"in GameSDK.extra&&GameSDK.extra.openAppStore()}),1e4)})),function(){return c.apply(this,arguments)})},{key:"waitViewable",value:(u=o((function*(){"isViewable"in GameSDK.extra&&(GameSDK.extra.isViewable()||"waitViewableChange"in GameSDK.extra&&(D.pause(),(yield GameSDK.extra.waitViewableChange())?D.resume():yield this.waitViewable()))})),function(){return u.apply(this,arguments)})},{key:"playTweens",value:(s=o((function*(){var e=R(this.label.node).to(10,{position:new V(0,200,0)},{easing:"cubicInOut"}).to(6,{position:new V(0,-100,0)},{easing:"cubicInOut"});Ve.runTweenAsync(R(this.label.node).repeat(999,e))})),function(){return s.apply(this,arguments)})},{key:"playParticles",value:function(){console.log("playParticles",this.particleLeft,this.particleRight),this.particleLeft.play(),this.particleRight.play()}},{key:"playAnimations",value:function(){this.backgroundAnimation.play()}}]),h}(T)).prototype,"label",[t8,n8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v8=a(p8.prototype,"particleLeft",[i8,a8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f8=a(p8.prototype,"particleRight",[o8,r8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g8=a(p8.prototype,"backgroundAnimation",[l8,s8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(p8.prototype,"playTweens",[u8],Object.getOwnPropertyDescriptor(p8.prototype,"playTweens"),p8.prototype),a(p8.prototype,"playParticles",[c8],Object.getOwnPropertyDescriptor(p8.prototype,"playParticles"),p8.prototype),a(p8.prototype,"playAnimations",[d8],Object.getOwnPropertyDescriptor(p8.prototype,"playAnimations"),p8.prototype),h8=p8))||h8);S._RF.pop(),S._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var q8,V8,$8,W8,K8,j8,Y8,X8,J8,Z8,Q8,e7,t7,n7,i7,a7,o7,r7,l7,s7,u7,c7,d7,h7,p7,y7,v7,f7,g7=C.ccclass,m7=C.property,b7=(C8=g7("PlayerScore"),E8=m7(q),A8=m7(K),T8=m7(B),P8=m7(B),O8=m7(F),L8=m7(q),I8=Ni.onlyRunInLifeCycleAsync,C8((D8=a((_8=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"crown",D8,l(e)),r(e,"playerScore",M8,l(e)),r(e,"playerScoreUiOpacity",N8,l(e)),r(e,"waitingUiOpacity",B8,l(e)),r(e,"avatar",F8,l(e)),r(e,"defaultAvatarNode",x8,l(e)),e.avatarOverlay=null,e.isOverlayMode=!1,e}return e(d,[{key:"onLoad",value:function(){this.createAvatarOverlay()}},{key:"createAvatarOverlay",value:function(){try{BM.isOverlayViewAPIAvailable(GameSDK),this.isOverlayMode=!0,this.avatarOverlay=new UM(this.node.scene)}catch(e){return}}},{key:"showCrown",value:function(e){this.crown.active=e}},{key:"setPlayerScore",value:function(e){this.playerScore.string=e.toString()}},{key:"playWaitingAnimation",value:function(){this.waitingUiOpacity.node.active=!0,this.playerScoreUiOpacity.node.active=!1,this.waitingUiOpacity.opacity=130,this.playerScoreUiOpacity.opacity=0;var e=R(this.waitingUiOpacity).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=R(this.waitingUiOpacity).repeatForever(e).start()}},{key:"stopWaitingAnimation",value:function(){this.waitingAnimation&&this.waitingAnimation.stop(),this.waitingUiOpacity.opacity=0,this.playerScoreUiOpacity.opacity=255,this.waitingUiOpacity.node.active=!1,this.playerScoreUiOpacity.node.active=!0}},{key:"loadPhoto",value:(u=o((function*(e,t){try{var n="10"===t;if(this.isOverlayMode&&!n){if(yield this.showAvatarOverlay(t))return;this.isOverlayMode=!1}var i=yield eN.getPlayerAvatar(e,t,128);if(!i)throw new Error("Failed to create sprite frame");if(!this.node.activeInHierarchy)return;i.packable=!0,this.avatar.spriteFrame=i}catch(e){return void console.error(e)}})),function(e,t){return u.apply(this,arguments)})},{key:"showAvatarOverlay",value:(s=o((function*(e){if(!this.avatarOverlay)return!1;var t=this.getDefaultAvatarPosition(),n=t.worldX,i=t.worldY,a=yield this.avatarOverlay.updateOverlay({playerId:e,worldX:n,worldY:i,avatarWidth:this.getDefaultAvatarWidth()});return null!=a&&a})),function(e){return s.apply(this,arguments)})},{key:"cleanupOverlay",value:function(){var e;null===(e=this.avatarOverlay)||void 0===e||e.hideOverlay()}},{key:"getDefaultAvatarPosition",value:function(){var e=this.defaultAvatarNode;return{worldX:e.worldPositionX,worldY:e.worldPositionY}}},{key:"getDefaultAvatarWidth",value:function(){return this.defaultAvatarNode.getComponent(P).width}}]),d}(T)).prototype,"crown",[E8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M8=a(_8.prototype,"playerScore",[A8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N8=a(_8.prototype,"playerScoreUiOpacity",[T8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B8=a(_8.prototype,"waitingUiOpacity",[P8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F8=a(_8.prototype,"avatar",[O8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x8=a(_8.prototype,"defaultAvatarNode",[L8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(_8.prototype,"loadPhoto",[I8],Object.getOwnPropertyDescriptor(_8.prototype,"loadPhoto"),_8.prototype),R8=_8))||R8);S._RF.pop(),S._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var w7,S7,k7,C7,E7,A7,T7,P7,O7,L7=C.ccclass,I7=C.disallowMultiple,R7=C.property,_7=codex,D7=_7.match,M7=_7.player,N7=_7.monitorError,B7=Ludex.Utils.Object;q8=L7("ChallengeResultScene"),V8=R7(Kd),$8=R7(Kd),W8=R7(Kd),K8=R7(Kd),j8=R7({type:b7,group:"Score"}),Y8=R7({type:b7,group:"Score"}),X8=R7({group:"Confetti Effect",type:oT}),J8=R7({group:"Confetti Effect",type:oT}),Z8=R7(zv),Q8=R7(ce),e7=Ni.onlyRunInLifeCycle,t7=Ni.onlyRunInLifeCycle,n7=Ni.onlyRunInLifeCycle,i7=Ni.onlyRunInLifeCycle,a7=Ni.onlyRunInLifeCycle,q8(o7=I7((l7=a((r7=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"drawLocalizer",l7,l(e)),r(e,"winLocalizer",s7,l(e)),r(e,"loseLocalizer",u7,l(e)),r(e,"waitingLocalizer",c7,l(e)),r(e,"playerScore",d7,l(e)),r(e,"opponentScore",h7,l(e)),r(e,"leftConfetti",p7,l(e)),r(e,"rightConfetti",y7,l(e)),r(e,"levelManager",v7,l(e)),r(e,"headerAnimation",f7,l(e)),e.goToDashboardScene=function(){e.playerScore.cleanupOverlay(),e.opponentScore.cleanupOverlay(),ct.switchToDashboardScene()},e.goToGameScene=function(){e.playerScore.cleanupOverlay(),e.opponentScore.cleanupOverlay(),ct.switchToGameScene()},e}return e(c,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.node.scene.on($e.RESULT_SCENE_HOME,this.goToDashboardScene),this.node.scene.on($e.RESULT_SCENE_REPLAY,this.handleTryAgainClicked,this)}},{key:"start",value:function(){this.scheduleOnce(this.preloadScenes,3);try{var e,t,n=D7.getMatchState(),i=n.customData,a=i.playerId,o=i.opponentId;if(!a||!o)throw new Error("ResultScene: playerId is ".concat(a," and opponentId is ").concat(o,". Expected to not be null."));var r=M7.getPlayer().photo,l=null!==(e=n.profiles[a])&&void 0!==e?e:{},s=l.score,u=void 0===s?0:s,c=l.finished,d=void 0!==c&&c,h=null!==(t=n.profiles[o])&&void 0!==t?t:{},p=h.photo,y=void 0===p?"":p,v=h.score,f=void 0===v?0:v,g=h.finished,m=void 0!==g&&g,b=d&&m,w=b&&u>f,S=b&&f>u;this.playerScore.loadPhoto(r,a),this.opponentScore.loadPhoto(y,o),this.playerScore.setPlayerScore(u),this.opponentScore.setPlayerScore(f),this.playerScore.showCrown(w),this.opponentScore.showCrown(S),d&&m?u===f?this.playStatusAnimation("Draw"):w?this.playStatusAnimation("Win"):S&&this.playStatusAnimation("Lose"):(d||this.playerScore.playWaitingAnimation(),m||this.opponentScore.playWaitingAnimation(),this.playStatusAnimation("Waiting"))}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}},{key:"preloadScenes",value:function(){ct.preloadDashboardScene()}},{key:"handleTryAgainClicked",value:(s=o((function*(){var e,t=(null!==(e=M7.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=Math.max(1,n);var i=yield this.levelManager.loadLevelData(n);try{if(!i)throw new Error("Level data is not found");var a=D7.getMatchState().customData.opponentId;if(!a)throw new Error("Opponent id is not found");rt.showLoadingScreen();var o=Um.generateFen(i),r=i.mode,l=void 0===r?"":r,s=i.rules,u=void 0===s?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:s,c=i.time,d=void 0===c?0:c,h=i.level;yield D7.challenge.friend.processAsync({playerId:M7.getPlayerId(),opponentId:a,extraData:{challengeData:{level:h,fen:o,gravity:l,rules:u,time:d}}}),rt.closeLoadingScreen(),this.goToGameScene()}catch(e){if(B7.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void rt.closeLoadingScreen();console.warn("ReplayChallengeFriend",e),rt.closeLoadingScreen(),rt.showNotificationScreenWithLocalizedKey("error.challengeFail",2),null==N7||N7.sendException(e instanceof Error?e:new Error("ReplayChallengeFriend"+JSON.stringify(e))),this.scheduleOnce(this.goToDashboardScene,2)}})),function(){return s.apply(this,arguments)})},{key:"handleHomeClicked",value:function(){this.goToDashboardScene()}},{key:"playStatusAnimation",value:function(e){var t=this;"Win"!==e&&"Waiting"!==e||this.triggerConfettiAnimation();var n=this.getSpriteLocalizer(e);n.node.active=!0,n.waitUntilLocalized().then((function(){switch(e){case"Draw":t.playDrawAnimation();break;case"Win":t.playWinAnimation();break;case"Lose":t.playLoseAnimation();break;case"Waiting":t.playWaitingAnimation()}}))}},{key:"getSpriteLocalizer",value:function(e){switch(e){case"Draw":return this.drawLocalizer;case"Win":return this.winLocalizer;case"Lose":return this.loseLocalizer;case"Waiting":return this.waitingLocalizer}}},{key:"playDrawAnimation",value:function(){this.headerAnimation.play("RibbonDraw"),je.playSound(Qi.LEVEL_FAIL)}},{key:"playWinAnimation",value:function(){this.headerAnimation.play("RibbonWin"),je.playSound(Qi.LEVEL_COMPLETE)}},{key:"playLoseAnimation",value:function(){this.headerAnimation.play("RibbonLose"),je.playSound(Qi.LEVEL_FAIL)}},{key:"playWaitingAnimation",value:function(){this.headerAnimation.play("RibbonWaiting"),je.playSound(Qi.LEVEL_COMPLETE)}},{key:"triggerConfettiAnimation",value:function(){var e=this,t=Je.isLandscape(),n=t?50:30,i=t?5e3:2e3,a=t?15e3:1e4,o=t?40:60,r=t?110:100,l=t?30:20;this.leftConfetti.bursts[0].count=this.rightConfetti.bursts[0].count=n,this.leftConfetti.startSpeed.constantMin=this.rightConfetti.startSpeed.constantMin=i,this.leftConfetti.startSpeed.constantMax=this.rightConfetti.startSpeed.constantMax=a,this.leftConfetti.shapeModule.angle=o,this.rightConfetti.shapeModule.angle=r,this.leftConfetti.shapeModule.arc=this.rightConfetti.shapeModule.arc=l,this.scheduleOnce((function(){e.leftConfetti.play(),e.rightConfetti.play()}),.2)}}]),c}(T)).prototype,"drawLocalizer",[V8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s7=a(r7.prototype,"winLocalizer",[$8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u7=a(r7.prototype,"loseLocalizer",[W8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c7=a(r7.prototype,"waitingLocalizer",[K8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d7=a(r7.prototype,"playerScore",[j8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h7=a(r7.prototype,"opponentScore",[Y8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p7=a(r7.prototype,"leftConfetti",[X8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y7=a(r7.prototype,"rightConfetti",[J8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v7=a(r7.prototype,"levelManager",[Z8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f7=a(r7.prototype,"headerAnimation",[Q8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(r7.prototype,"playDrawAnimation",[e7],Object.getOwnPropertyDescriptor(r7.prototype,"playDrawAnimation"),r7.prototype),a(r7.prototype,"playWinAnimation",[t7],Object.getOwnPropertyDescriptor(r7.prototype,"playWinAnimation"),r7.prototype),a(r7.prototype,"playLoseAnimation",[n7],Object.getOwnPropertyDescriptor(r7.prototype,"playLoseAnimation"),r7.prototype),a(r7.prototype,"playWaitingAnimation",[i7],Object.getOwnPropertyDescriptor(r7.prototype,"playWaitingAnimation"),r7.prototype),a(r7.prototype,"triggerConfettiAnimation",[a7],Object.getOwnPropertyDescriptor(r7.prototype,"triggerConfettiAnimation"),r7.prototype),o7=r7))||o7);S._RF.pop(),S._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var F7,x7=C.ccclass,z7=C.property,U7=C.disallowMultiple,G7=Ludex.Events,H7=codex.event,q7=(w7=x7("BaseScreen"),S7=z7(q),k7=z7(q),C7=z7(B),w7(E7=U7((T7=a((A7=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"container",T7,l(e)),r(e,"backgroundMask",P7,l(e)),r(e,"screenOpacity",O7,l(e)),e.data={},e}return e(s,[{key:"__preload",value:function(){this.animation=this.getComponent(ce),this.backgroundMaskButton=this.backgroundMask.getComponent(G),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(e){this.screenOpacity.opacity=e}},{key:"open",value:function(e){var t,n,i=this;e&&(this.data=e),this.animation.once(ce.EventType.PLAY,(function(){i.show()})),H7.emit(G7.OPENED_SCREEN,{screenName:this.node.name,screenData:this.data}),this.runAnimation(null!==(t=null===(n=this.data.overrideAnimation)||void 0===n?void 0:n.openScreen)&&void 0!==t?t:"OpenScreen")}},{key:"close",value:function(){var e,t,n=this;this.node.active&&(this.animation.once(ce.EventType.FINISHED,(function(){H7.emit(G7.CLOSED_SCREEN,{screenName:n.node.name}),n.hide()})),this.runAnimation(null!==(e=null===(t=this.data.overrideAnimation)||void 0===t?void 0:t.closeScreen)&&void 0!==e?e:"CloseScreen"))}},{key:"runAnimation",value:function(e){if(!this.isAnimationExist(e))throw new Error("".concat(this.node.name,": Animation component must have ").concat(e," clip"));this.animation.play(e)}},{key:"isAnimationExist",value:function(e){return this.animation.clips.some((function(t){return!(!t||t.name!==e)}))}},{key:"getMaskOpacity",value:function(){var e=this.backgroundMask.getComponent(B);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var e=this.container.getComponent(B);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.node.active=!0;var e=this.node.getComponent(I);if(e){e.enabled=!0,e.updateAlignment();var t,n=this.node.getComponentsInChildren(I),i=u(n);try{for(i.s();!(t=i.n()).done;){t.value.updateAlignment()}}catch(e){i.e(e)}finally{i.f()}}}},{key:"hide",value:function(){this.node.active=!1}}]),s}(T)).prototype,"container",[S7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P7=a(A7.prototype,"backgroundMask",[k7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O7=a(A7.prototype,"screenOpacity",[C7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E7=A7))||E7)||E7);S._RF.pop(),S._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var V7,$7,W7,K7,j7,Y7,X7,J7,Z7,Q7,eee,tee,nee,iee,aee=C.ccclass,oee=C.requireComponent;aee("BackgroundMask")(F7=oee([B])(F7=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"onLoad",value:function(){var e=this.getComponent(B);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var e,t,n=this.opacity.opacity/255;e=n,(t=document.getElementById("app-mask"))&&(t.style.background="rgb(0 0 0 / ".concat(e,")"))}}]),r}(T))||F7);S._RF.pop(),S._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var ree,lee,see,uee,cee,dee,hee,pee,yee,vee,fee,gee,mee,bee,wee=C.ccclass,See=C.property,kee=C.executeInEditMode,Cee=(V7=wee("ScreenConfig"),$7=See({type:x(lt)}),W7=See({type:O}),V7((Y7=a((j7=e((function e(){t(this,e),r(this,"key",Y7,this),r(this,"depth",X7,this)}))).prototype,"key",[$7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return lt.LOADING_SCREEN}}),X7=a(j7.prototype,"depth",[W7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),K7=j7))||K7);J7=wee("Screens"),Z7=See({type:[Cee]}),Q7=See({tooltip:"Preload all the screens automatically in ScreenDepth when the scene starts."}),J7(eee=kee((nee=a((tee=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"screens",nee,l(e)),r(e,"autoPreload",iee,l(e)),e}return e(s,[{key:"onEnable",value:function(){}},{key:"onDisable",value:function(){}},{key:"onChildrenChanged",value:function(){}}]),s}(T)).prototype,"screens",[Z7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iee=a(tee.prototype,"autoPreload",[Q7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),eee=tee))||eee);S._RF.pop(),S._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var Eee,Aee,Tee,Pee,Oee,Lee,Iee,Ree,_ee,Dee,Mee,Nee,Bee,Fee,xee,zee=C.ccclass,Uee=C.property,Gee=C.disallowMultiple,Hee=C.requireComponent,qee=Ludex.Events,Vee=codex.event;ree=zee("CongratulationScreen"),lee=Hee(q7),see=Uee(q),uee=Uee(q),cee=Uee(G),dee=Uee(G),hee=Uee(G),ree(pee=Gee(pee=lee((vee=a((yee=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"congratulation",vee,l(e)),r(e,"confirmation",fee,l(e)),r(e,"closeButtonComponent",gee,l(e)),r(e,"yesButtonComponent",mee,l(e)),r(e,"noButtonComponent",bee,l(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("CongratulationScreen: screen not found");e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.yesButtonComponent.interactable=!0,e.noButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.confirmationUIOpacity=this.confirmation.getComponent(B),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Vee.on(qee.OPENING_SCREEN,this.handleOpeningScreen),Vee.on(qee.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Vee.off(qee.OPENING_SCREEN,this.handleOpeningScreen),Vee.off(qee.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,rt.closeScreen(lt.CONGRATULATION_SCREEN)}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,R(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),R(this.confirmation).set({scale:new V(.8,.8,.8)}).to(.2,{scale:new V(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(Es.START_OVER,1)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(Es.GAME_REPLAY)}}]),s}(T)).prototype,"congratulation",[see],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fee=a(yee.prototype,"confirmation",[uee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gee=a(yee.prototype,"closeButtonComponent",[cee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mee=a(yee.prototype,"yesButtonComponent",[dee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bee=a(yee.prototype,"noButtonComponent",[hee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pee=yee))||pee)||pee);S._RF.pop(),S._RF.push({},"dc7da51sglB44qYIJOboZkL","HorizontalSelector",void 0);var $ee,Wee,Kee,jee,Yee,Xee,Jee,Zee,Qee,ete,tte,nte,ite,ate,ote,rte,lte=C.ccclass,ste=C.property,ute=(Eee=lte("HorizontalSelector"),Aee=ste({type:W,tooltip:"Component initializes on its own in its preload method. Turn off if you want to initialize it manually."}),Tee=ste({type:E,visible:function(){return!this.selfInitialize}}),Pee=ste({type:O,visible:function(){return!this.selfInitialize}}),Oee=ste(W),Lee=ste(K),Iee=ste(U),Eee((Dee=a((_ee=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"selfInitialize",Dee,l(e)),r(e,"items",Mee,l(e)),r(e,"currentIndex",Nee,l(e)),r(e,"loop",Bee,l(e)),r(e,"selectedItemLabel",Fee,l(e)),r(e,"onSelectEvents",xee,l(e)),e.selectedItem="",e}return e(s,[{key:"__preload",value:function(){this.selfInitialize||this.init(this.items,this.currentIndex)}},{key:"init",value:function(e,t,n){this.items=e,this.currentIndex=t,void 0!==n&&(this.loop=n),this.selectedItem=this.items[this.currentIndex],this.selectedItemLabel&&(this.selectedItemLabel.string=this.selectedItem)}},{key:"selectNext",value:function(){(this.loop||this.currentIndex!==this.items.length-1)&&(this.currentIndex=(this.currentIndex+1)%this.items.length,this.selectedItem=this.items[this.currentIndex],this.emitOnSelectedEvents())}},{key:"selectPrevious",value:function(){(this.loop||0!==this.currentIndex)&&(this.currentIndex=(this.currentIndex-1+this.items.length)%this.items.length,this.selectedItem=this.items[this.currentIndex],this.emitOnSelectedEvents())}},{key:"getSelectedItem",value:function(){return this.selectedItem}},{key:"getSelectedIndex",value:function(){return this.currentIndex}},{key:"getItems",value:function(){return this.items}},{key:"setSelectedItem",value:function(e){this.selectedItem=this.items[e],this.currentIndex=e,this.emitOnSelectedEvents()}},{key:"emitOnSelectedEvents",value:function(){this.selectedItemLabel&&(this.selectedItemLabel.string=this.selectedItem);var e,t=u(this.onSelectEvents);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.emit([this.selectedItem,n.customEventData])}}catch(e){t.e(e)}finally{t.f()}}}]),s}(T)).prototype,"selfInitialize",[Aee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mee=a(_ee.prototype,"items",[Tee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nee=a(_ee.prototype,"currentIndex",[Pee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bee=a(_ee.prototype,"loop",[Oee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fee=a(_ee.prototype,"selectedItemLabel",[Lee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xee=a(_ee.prototype,"onSelectEvents",[Iee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ree=_ee))||Ree);S._RF.pop(),S._RF.push({},"50306JI4lZMEqIc8ZHjuEgn","CustomGameScreen",void 0);var cte,dte,hte,pte,yte,vte,fte,gte,mte,bte,wte,Ste,kte,Cte,Ete,Ate,Tte,Pte,Ote,Lte,Ite,Rte,_te,Dte,Mte,Nte,Bte,Fte,xte,zte,Ute,Gte,Hte,qte,Vte,$te,Wte=C.ccclass,Kte=C.property,jte=C.requireComponent,Yte=Ludex.Events,Xte=codex,Jte=Xte.event,Zte=Xte.player;$ee=Wte("CustomGameScreen"),Wee=jte(q7),Kee=Kte(G),jee=Kte({type:ute,group:"Selectors"}),Yee=Kte({type:ute,group:"Selectors"}),Xee=Kte({type:ute,group:"Selectors"}),Jee=Kte({type:o0,group:"Selectors"}),Zee=Kte(K),$ee(Qee=Wee((tte=a((ete=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"playButton",tte,l(e)),r(e,"timeSelector",nte,l(e)),r(e,"difficultySelector",ite,l(e)),r(e,"bombsSelector",ate,l(e)),r(e,"extraAdsSwitch",ote,l(e)),r(e,"bonusLabel",rte,l(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StartLevelScreen: screen not found");e.validateEventPayload(t)&&e.setInteractableButtons(!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Jte.on(Yte.OPENING_SCREEN,this.handleOpeningScreen),Jte.on(Yte.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Jte.off(Yte.OPENING_SCREEN,this.handleOpeningScreen),Jte.off(Yte.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(Es.HIDE_UI)}},{key:"close",value:function(e){this.setInteractableButtons(!1),this.node.scene.emit(Es.SHOW_UI),Jte.emit(Yte.CLOSE_SCREEN,{screenName:this.node.name,screenData:{customMode:e}})}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateStatus",value:function(){var e=yv.time,t=yv.difficulty,n=yv.bombs,i=pv.getCustomData();this.timeSelector.init(e.map((function(e){return e<0?"".concat(e,"%"):"+".concat(e,"%")})),i.time),this.difficultySelector.init(g(t),i.difficulty),this.bombsSelector.init(n.map((function(e){return"".concat(e)})),i.bombs),this.extraAdsSwitch.setEnabled(i.ads),this.calculateBonus()}},{key:"handleClickedPlay",value:(s=o((function*(){this.close(!0)})),function(){return s.apply(this,arguments)})},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleSelectedTime",value:function(e){this.updateCustomGameData(),this.calculateBonus()}},{key:"handleSelectedDifficulty",value:function(e){this.updateCustomGameData(),this.calculateBonus()}},{key:"handleSelectedBombs",value:function(e){this.updateCustomGameData(),this.calculateBonus()}},{key:"handleSwitchedExtraAds",value:function(){this.extraAdsSwitch.switch(),this.updateCustomGameData(),this.calculateBonus()}},{key:"updateCustomGameData",value:function(){var e=this.timeSelector.getSelectedIndex(),t=this.difficultySelector.getSelectedIndex(),n=this.bombsSelector.getSelectedIndex();Zte.setGameData({custom:{time:e,difficulty:t,bombs:n,ads:this.extraAdsSwitch.enable}})}},{key:"setInteractableButtons",value:function(e){this.playButton.interactable=e,this.screen.backgroundMask.getComponent(G).interactable=e}},{key:"calculateBonus",value:function(){var e=pv.getCustomBonus();this.bonusLabel.string=e>=0?"+".concat(e,"%"):"".concat(e,"%")}}]),c}(T)).prototype,"playButton",[Kee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nte=a(ete.prototype,"timeSelector",[jee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ite=a(ete.prototype,"difficultySelector",[Yee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ate=a(ete.prototype,"bombsSelector",[Xee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ote=a(ete.prototype,"extraAdsSwitch",[Jee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rte=a(ete.prototype,"bonusLabel",[Zee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qee=ete))||Qee);S._RF.pop(),S._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var Qte,ene,tne,nne,ine,ane,one,rne,lne,sne,une,cne,dne,hne,pne,yne,vne,fne,gne,mne,bne,wne,Sne,kne,Cne,Ene,Ane,Tne,Pne,One,Lne,Ine,Rne,_ne,Dne,Mne,Nne,Bne,Fne,xne,zne,Une=C.ccclass,Gne=C.property,Hne=(cte=Une("DayBlock"),dte=Ni.required,hte=Gne({type:F,group:"Background"}),pte=Ni.required,yte=Gne({type:F,group:"Background"}),vte=Ni.required,fte=Gne({type:ue,group:"Background"}),gte=Ni.required,mte=Gne({type:ue,group:"Background"}),bte=Ni.required,wte=Gne(K),Ste=Ni.required,kte=Gne(Kd),Cte=Ni.required,Ete=Gne(K),Ate=Ni.required,Tte=Gne(q),Pte=Ni.required,Ote=Gne(q),Lte=Ni.required,Ite=Gne(q),Rte=Ni.required,_te=Gne({type:B}),cte((Nte=a((Mte=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"background",Nte,l(e)),r(e,"topBackground",Bte,l(e)),r(e,"blueBackground",Fte,l(e)),r(e,"blueTopBackground",xte,l(e)),r(e,"dayLabel",zte,l(e)),r(e,"dayLocalizer",Ute,l(e)),r(e,"coinLabel",Gte,l(e)),r(e,"rewardItemsNode",Hte,l(e)),r(e,"checkNode",qte,l(e)),r(e,"glowNodes",Vte,l(e)),r(e,"uiOpacity",$te,l(e)),e}return e(s,[{key:"onLoad",value:function(){Ni.validateRequiredProperties(this,s),this.initDefaultProperties()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new X(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new X("#3469bf")}},{key:"updateInfo",value:function(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}},{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLocalizer.setParams([e.day.toString()]);var t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}},{key:"updateRewardItems",value:function(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(e){this.glowNodes&&this.glowNodes.forEach((function(t){t.active=e}))}}]),s}(T)).prototype,"background",[dte,hte],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bte=a(Mte.prototype,"topBackground",[pte,yte],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fte=a(Mte.prototype,"blueBackground",[vte,fte],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xte=a(Mte.prototype,"blueTopBackground",[gte,mte],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zte=a(Mte.prototype,"dayLabel",[bte,wte],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ute=a(Mte.prototype,"dayLocalizer",[Ste,kte],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gte=a(Mte.prototype,"coinLabel",[Cte,Ete],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hte=a(Mte.prototype,"rewardItemsNode",[Ate,Tte],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qte=a(Mte.prototype,"checkNode",[Pte,Ote],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vte=a(Mte.prototype,"glowNodes",[Lte,Ite],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$te=a(Mte.prototype,"uiOpacity",[Rte,_te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dte=Mte))||Dte);S._RF.pop(),S._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var qne,Vne=C.ccclass,$ne=C.property,Wne=C.requireComponent,Kne=Ludex,jne=Kne.Events,Yne=Kne.Utils,Xne=Yne.Array,Jne=Yne.Signal,Zne=Kne.Plugins.Ads,Qne=(void 0===Zne?{}:Zne).Types,eie=codex,tie=eie.event,nie=eie.player;Qte=Vne("DailyRewardsScreen"),ene=Wne(q7),tne=Ni.required(),nne=$ne(q),ine=Ni.required(),ane=$ne(G),one=Ni.required(),rne=$ne(G),lne=Ni.required(),sne=$ne(G),une=Ni.required(),cne=$ne(G),dne=Ni.required(),hne=$ne(G),pne=Ni.required(),yne=$ne(q),vne=Ni.required(),fne=$ne(q),gne=Ni.required(),mne=$ne(q),bne=$ne([Hne]),wne=Ni.onlyRunInLifeCycle,Sne=Ni.onlyRunInLifeCycleAsync,kne=Ni.onlyRunInLifeCycle,Cne=Ni.onlyRunInLifeCycleAsync,Ene=Ni.onlyRunInLifeCycleAsync,Ane=Ni.onlyRunInLifeCycle,Tne=Ni.onlyRunInLifeCycle,Pne=Ni.onlyRunInLifeCycle,Qte(One=ene((Ine=a((Lne=function(a){n(v,a);var s,c,d,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=y.call.apply(y,[this].concat(i))).rewardsData=[],r(e,"loadingRing",Ine,l(e)),r(e,"claimButton",Rne,l(e)),r(e,"claimX2Button",_ne,l(e)),r(e,"closeButton",Dne,l(e)),r(e,"backgroundButton",Mne,l(e)),r(e,"continueButton",Nne,l(e)),r(e,"claimButtonScallableNode",Bne,l(e)),r(e,"claimX2ButtonScallableNode",Fne,l(e)),r(e,"continueButtonScallableNode",xne,l(e)),r(e,"dailyBlocks",zne,l(e)),e.dailyLoadingController=new Jne.SignalController,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0,e.setLoading())},e.handleOpenedScreen=function(){var t=o((function*(t){e.validateEventPayload(t)&&e.open()}));return function(e){return t.apply(this,arguments)}}(),e}return e(v,[{key:"__preload",value:function(){this.enabled=!1,Ni.validateRequiredProperties(this,v),this.listenScreenEvents(),Qne&&ut.preloadAdsByType(Qne.REWARDED_VIDEO)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"listenScreenEvents",value:function(){tie.on(jne.OPENING_SCREEN,this.handleOpeningScreen),tie.on(jne.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){tie.off(jne.OPENING_SCREEN,this.handleOpeningScreen),tie.off(jne.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"setLoading",value:function(){this.loadingRing.active=!0;var e,t=u(this.dailyBlocks);try{for(t.s();!(e=t.n()).done;){e.value.uiOpacity.opacity=0}}catch(e){t.e(e)}finally{t.f()}this.continueButtonScallableNode.active=!1,this.claimButtonScallableNode.active=!1,this.claimX2ButtonScallableNode.active=!1}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.setInteractableButtons(!0),this.node.scene.emit(Es.HIDE_UI),this.openAsync()}},{key:"openAsync",value:(p=o((function*(){var e=this.dailyLoadingController.renew(),t=!oq.hasShownPopup(),n=yield oq.getRewardsData();if(null!==n){var i=Xne.search(n,(function(e){return"ready"===e.status}));this.updateScreenData(n,i),t?yield this.runPopUpAnim(e):this.showElements()}else this.close()})),function(){return p.apply(this,arguments)})},{key:"updateScreenData",value:function(e,t){this.rewardsData=e,this.currentRewardsData=t;for(var n=0,i=this.dailyBlocks.length;n<i;n++){var a=this.rewardsData[n],o=this.dailyBlocks[n],r=a.id,l=a.type,s=a.value,u=a.status;o.updateInfo({day:r,type:l,value:s,status:u})}}},{key:"close",value:function(){oq.setHasShownPopup(),this.setInteractableButtons(!1),this.dailyLoadingController.abort(),tie.emit(jne.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Es.SHOW_UI)}},{key:"runPopUpAnim",value:(h=o((function*(e){var t=this;this.loadingRing.active=!1,yield Promise.all(this.dailyBlocks.map((function(n,i){return t.runBlockPopUpAnim(n,.15*i,e)}))),yield this.runButtonPopUpAnim(e)})),function(e){return h.apply(this,arguments)})},{key:"showElements",value:function(){this.loadingRing.active=!1;var e,t=u(this.dailyBlocks);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.uiOpacity.opacity=255,n.node.setScale(1,1,1)}}catch(e){t.e(e)}finally{t.f()}void 0===this.currentRewardsData?(this.continueButtonScallableNode.active=!0,this.claimButtonScallableNode.active=!1,this.claimX2ButtonScallableNode.active=!1,this.continueButtonScallableNode.setScale(1,1,1)):(this.continueButtonScallableNode.active=!1,this.claimButtonScallableNode.active=!0,this.claimX2ButtonScallableNode.active=!0,this.claimButtonScallableNode.setScale(1,1,1),this.claimX2ButtonScallableNode.setScale(1,1,1))}},{key:"runButtonPopUpAnim",value:(d=o((function*(e){if(void 0===this.currentRewardsData)return this.continueButtonScallableNode.active=!0,this.claimButtonScallableNode.active=!1,this.claimX2ButtonScallableNode.active=!1,this.continueButtonScallableNode.setScale(0,0,0),void(yield Ve.runTweenAsync(R(this.continueButtonScallableNode).to(.3,{scale:V.ONE},{easing:"backOut"}),e));this.continueButtonScallableNode.active=!1,this.claimButtonScallableNode.active=!0,this.claimX2ButtonScallableNode.active=!0,this.claimButtonScallableNode.setScale(0,0,0),this.claimX2ButtonScallableNode.setScale(0,0,0),yield Promise.all([Ve.runTweenAsync(R(this.claimButtonScallableNode).to(.3,{scale:V.ONE},{easing:"backOut"}),e),Ve.runTweenAsync(R(this.claimX2ButtonScallableNode).delay(.1).to(.3,{scale:V.ONE},{easing:"backOut"}),e)])})),function(e){return d.apply(this,arguments)})},{key:"runBlockPopUpAnim",value:(c=o((function*(e,t,n){e.node.setScale(1.2,1.2,1.2),e.uiOpacity.opacity=0;var i=Ve.runTweenAsync(R(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}),n),a=Ve.runTweenAsync(R(e.node).delay(t).to(.3,{scale:V.ONE},{easing:"backOut"}),n);yield Promise.all([i,a])})),function(e,t,n){return c.apply(this,arguments)})},{key:"handleOnClaim",value:function(){void 0!==this.currentRewardsData?(this.setInteractableButtons(!1),this.claimReward(this.currentRewardsData)):rt.showNotificationScreenWithLocalizedKey("error.rewardFail",2)}},{key:"handleOnClaimX2",value:(s=o((function*(){void 0!==this.currentRewardsData?(this.setInteractableButtons(!1),(yield ut.showRewardVideoAdAsync())?this.claimReward(this.currentRewardsData,!0):this.setInteractableButtons(!0)):rt.showNotificationScreenWithLocalizedKey("error.rewardFail",2)})),function(){return s.apply(this,arguments)})},{key:"claimReward",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];oq.logLoginReward();var n=e.value*(t?2:1);this.node.scene.emit(Es.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1}});var i=nie.getGameData();if(e.items&&i){var a=e.items.hint*(t?2:1),o=e.items.thunder*(t?2:1),r=e.items.storm*(t?2:1);nie.setGameData({items:{hint:i.items.hint+a,thunder:i.items.thunder+o,storm:i.items.storm+r,pliers:i.items.pliers}})}this.close()}},{key:"setInteractableButtons",value:function(e){this.claimButton.interactable=e,this.claimX2Button.interactable=e,this.closeButton.interactable=e,this.backgroundButton.interactable=e,this.continueButton.interactable=e}}]),v}(T)).prototype,"loadingRing",[tne,nne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rne=a(Lne.prototype,"claimButton",[ine,ane],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_ne=a(Lne.prototype,"claimX2Button",[one,rne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dne=a(Lne.prototype,"closeButton",[lne,sne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mne=a(Lne.prototype,"backgroundButton",[une,cne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nne=a(Lne.prototype,"continueButton",[dne,hne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bne=a(Lne.prototype,"claimButtonScallableNode",[pne,yne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fne=a(Lne.prototype,"claimX2ButtonScallableNode",[vne,fne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xne=a(Lne.prototype,"continueButtonScallableNode",[gne,mne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zne=a(Lne.prototype,"dailyBlocks",[bne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),a(Lne.prototype,"updateScreenData",[wne],Object.getOwnPropertyDescriptor(Lne.prototype,"updateScreenData"),Lne.prototype),a(Lne.prototype,"runPopUpAnim",[Sne],Object.getOwnPropertyDescriptor(Lne.prototype,"runPopUpAnim"),Lne.prototype),a(Lne.prototype,"showElements",[kne],Object.getOwnPropertyDescriptor(Lne.prototype,"showElements"),Lne.prototype),a(Lne.prototype,"runButtonPopUpAnim",[Cne],Object.getOwnPropertyDescriptor(Lne.prototype,"runButtonPopUpAnim"),Lne.prototype),a(Lne.prototype,"runBlockPopUpAnim",[Ene],Object.getOwnPropertyDescriptor(Lne.prototype,"runBlockPopUpAnim"),Lne.prototype),a(Lne.prototype,"handleOnClaim",[Ane],Object.getOwnPropertyDescriptor(Lne.prototype,"handleOnClaim"),Lne.prototype),a(Lne.prototype,"claimReward",[Tne],Object.getOwnPropertyDescriptor(Lne.prototype,"claimReward"),Lne.prototype),a(Lne.prototype,"setInteractableButtons",[Pne],Object.getOwnPropertyDescriptor(Lne.prototype,"setInteractableButtons"),Lne.prototype),One=Lne))||One);S._RF.pop(),S._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var iie,aie,oie,rie,lie,sie,uie,cie,die,hie;(0,C.ccclass)("DayBlockRed")(qne=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r,[{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLocalizer.setParams([e.day.toString()]);var t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}}]),r}(Hne));S._RF.pop(),S._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var pie,yie,vie,fie,gie,mie,bie,wie,Sie,kie,Cie,Eie,Aie,Tie,Pie,Oie,Lie,Iie,Rie,_ie,Die,Mie,Nie,Bie,Fie,xie,zie,Uie,Gie,Hie,qie,Vie=C.ccclass,$ie=C.property,Wie=C.requireComponent,Kie=codex.event,jie=Ludex,Yie=jie.Events,Xie=jie.Plugins.Ads,Jie=(void 0===Xie?{}:Xie).Types;iie=Vie("GetCoinScreen"),aie=Wie(q7),oie=$ie(K),rie=$ie(G),lie=$ie(G),iie(sie=aie((cie=a((uie=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"quantityLabel",cie,l(e)),r(e,"closeButtonComponent",die,l(e)),r(e,"getNowButtonComponent",hie,l(e)),e.handleOpeningScreen=function(t){console.log("GetCoinScreen.OPENING_SCREEN",t),e.validateEventPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus())},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents(),Jie&&ut.preloadAdsByType(Jie.REWARDED_VIDEO)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Kie.on(Yie.OPENING_SCREEN,this.handleOpeningScreen),Kie.on(Yie.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Kie.off(Yie.OPENING_SCREEN,this.handleOpeningScreen),Kie.off(Yie.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return"screenName"in e&&(e.screenName===this.node.name&&(this.payload=e,!0))}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(Es.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),Kie.emit(Yie.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Es.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var e=this.getQuantity();e&&this.updateQuantityLabel(e)}},{key:"updateQuantityLabel",value:function(e){this.quantityLabel.string="x".concat(e.toString())}},{key:"getQuantity",value:function(){var e=this.payload.screenData;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}},{key:"handleAddCoin",value:function(){var e=this.getQuantity();this.node.scene.emit(Es.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1},skipAnimation:!0}),this.close()}},{key:"handleGetNowButtonClicked",value:(s=o((function*(){je.stopAllSounds(),(yield ut.showRewardVideoAdAsync())&&this.handleAddCoin()})),function(){return s.apply(this,arguments)})},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.getNowButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),c}(T)).prototype,"quantityLabel",[oie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),die=a(uie.prototype,"closeButtonComponent",[rie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hie=a(uie.prototype,"getNowButtonComponent",[lie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sie=uie))||sie);S._RF.pop(),S._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var Zie,Qie,eae,tae,nae,iae,aae,oae,rae,lae,sae=C.ccclass,uae=C.property,cae=codex,dae=cae.event,hae=cae.player,pae=cae.analytics,yae=cae.language,vae=Ludex,fae=vae.Events,gae=vae.Utils.Array,mae=vae.Plugins,bae=mae.Ads,wae=(void 0===bae?{}:bae).Types,Sae=mae.Analytics,kae=(void 0===Sae?{}:Sae).Events,Cae=Object.values(tt);pie=sae("GetItemScreen"),yie=uae({type:fe,group:"Item"}),vie=uae({type:F,group:"Item"}),fie=uae({type:ue,group:"Item"}),gie=uae({type:ue,group:"Item"}),mie=uae({type:ue,group:"Item"}),bie=uae({type:ue,group:"Item"}),wie=uae({type:K,group:"Title"}),Sie=uae({type:Kd,group:"Title"}),kie=uae({type:K,group:"Description"}),Cie=uae({type:Kd,group:"Description"}),Eie=uae(K),Aie=uae({type:G,group:"Buttons"}),Tie=uae({type:G,group:"Buttons"}),Pie=uae({type:G,group:"Buttons"}),pie((Iie=a((Lie=function(a){n(h,a);var s,u,c,d=i(h);function h(){var e;t(this,h);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=d.call.apply(d,[this].concat(i)),r(e,"itemFxPrefab",Iie,l(e)),r(e,"itemSprite",Rie,l(e)),r(e,"hintSpriteFrame",_ie,l(e)),r(e,"stormSpriteFrame",Die,l(e)),r(e,"thunderSpriteFrame",Mie,l(e)),r(e,"pliersSpriteFrame",Nie,l(e)),r(e,"titleLabel",Bie,l(e)),r(e,"titleLocalizer",Fie,l(e)),r(e,"descriptionLabel",xie,l(e)),r(e,"descriptionLocalizer",zie,l(e)),r(e,"coinLabel",Uie,l(e)),r(e,"closeButtonComponent",Gie,l(e)),r(e,"buyItemButtonComponent",Hie,l(e)),r(e,"getNowButtonComponent",qie,l(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("GetItemScreen: screen not found");e.validateEventPayload(t)&&e.validateEventPayloadData(t.screenData)&&(e.setInteractableButtons(!0),e.data=t.screenData,e.updateStatus(t.screenData))},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(h,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents(),wae&&ut.preloadAdsByType(wae.REWARDED_VIDEO)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){dae.on(fae.OPENING_SCREEN,this.handleOpeningScreen),dae.on(fae.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){dae.off(fae.OPENING_SCREEN,this.handleOpeningScreen),dae.off(fae.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"validateEventPayloadData",value:function(e){return!!e&&(!(!("item"in e)||!gae.has(Cae,e.item))&&("quantity"in e&&"number"==typeof e.quantity&&!("localizedMessageKey"in e&&void 0!==e.localizedMessageKey&&!yae.hasTextKey(e.localizedMessageKey))))}},{key:"open",value:function(){this.node.scene.emit(Es.GAME_PAUSE)}},{key:"close",value:function(){this.setInteractableButtons(!1),dae.emit(fae.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Es.GAME_RESUME)}},{key:"updateStatus",value:function(e){this.updateItemIcon(e.item),this.updateTitle(e.item),e.localizedMessageKey&&this.updateDescription(e.localizedMessageKey),this.updateButtons(e.item)}},{key:"updateItemIcon",value:function(e){switch(e){case tt.HINT:this.itemSprite.spriteFrame=this.hintSpriteFrame;break;case tt.STORM:this.itemSprite.spriteFrame=this.stormSpriteFrame;break;case tt.THUNDER:this.itemSprite.spriteFrame=this.thunderSpriteFrame;break;case tt.PLIERS:this.itemSprite.spriteFrame=this.pliersSpriteFrame}}},{key:"getItemLocalizedTitleKey",value:function(e){switch(e){case tt.HINT:return"item.hint";case tt.STORM:return"item.storm";case tt.THUNDER:return"item.thunder";case tt.PLIERS:return"item.pliers"}}},{key:"updateTitle",value:function(e){this.titleLocalizer.key=this.getItemLocalizedTitleKey(e)}},{key:"updateDescription",value:function(e){this.descriptionLocalizer.key=e}},{key:"updateButtons",value:function(e){var t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string="".concat(3*py[e]))}},{key:"canBuyItem",value:function(e){var t=hae.getGameData();return!!t&&t.coins>=3*py[e]}},{key:"handleAddItem",value:(c=o((function*(){this.data.item&&(kae&&pae.event(kae.EARN_ITEM,{item_name:this.data.item,value:3}),this.node.scene.emit(Es.ADD_ITEM,{animate:{startWorldPosition:this.itemSprite.node.worldPosition.clone()},item:this.data.item,quantity:3}))})),function(){return c.apply(this,arguments)})},{key:"handleGetNowButtonClicked",value:(u=o((function*(){this.stopAllSounds(),(yield ut.showRewardVideoAdAsync())&&(this.handleAddItem(),this.close())})),function(){return u.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(s=o((function*(){this.node.scene.emit(Es.REMOVE_COINS,{coins:3*py[this.data.item],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close()})),function(){return s.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var e;null===(e=re("Sound"))||void 0===e||null===(e=e.getComponent(fn))||void 0===e||e.stopAll()}},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.buyItemButtonComponent.interactable=e,this.getNowButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),h}(T)).prototype,"itemFxPrefab",[yie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rie=a(Lie.prototype,"itemSprite",[vie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_ie=a(Lie.prototype,"hintSpriteFrame",[fie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Die=a(Lie.prototype,"stormSpriteFrame",[gie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mie=a(Lie.prototype,"thunderSpriteFrame",[mie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nie=a(Lie.prototype,"pliersSpriteFrame",[bie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bie=a(Lie.prototype,"titleLabel",[wie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fie=a(Lie.prototype,"titleLocalizer",[Sie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xie=a(Lie.prototype,"descriptionLabel",[kie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zie=a(Lie.prototype,"descriptionLocalizer",[Cie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uie=a(Lie.prototype,"coinLabel",[Eie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gie=a(Lie.prototype,"closeButtonComponent",[Aie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hie=a(Lie.prototype,"buyItemButtonComponent",[Tie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qie=a(Lie.prototype,"getNowButtonComponent",[Pie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oie=Lie));S._RF.pop(),S._RF.push({},"4d6710xA7hAk65cGA4Dgdrc","GetRewardsScreen",void 0);var Eae,Aae=C.ccclass,Tae=C.requireComponent,Pae=C.property,Oae=Ludex,Lae=Oae.Events,Iae=Oae.Plugins.Ads,Rae=(void 0===Iae?{}:Iae).Types,_ae=codex.event;Zie=Aae("GetRewardsScreen"),Qie=Tae(q7),eae=Pae(Kd),tae=Pae(G),nae=Pae(G),Zie(iae=Qie((oae=a((aae=function(a){n(h,a);var s,u,c,d=i(h);function h(){var e;t(this,h);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=d.call.apply(d,[this].concat(i)),r(e,"countDownLocalizer",oae,l(e)),r(e,"skipButton",rae,l(e)),r(e,"claimButton",lae,l(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.setInteractableButtons(!1)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(h,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents(),Rae&&ut.preloadAdsByType(Rae.REWARDED_VIDEO)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){_ae.on(Lae.OPENING_SCREEN,this.handleOpeningScreen),_ae.on(Lae.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){_ae.off(Lae.OPENING_SCREEN,this.handleOpeningScreen),_ae.off(Lae.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.runCountdownAnimation()}},{key:"close",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setInteractableButtons(!1),_ae.emit(Lae.CLOSE_SCREEN,{screenName:this.node.name,screenData:{getRewardsSuccess:e,rewardsAdShown:t}})}},{key:"runCountdownAnimation",value:function(){var e=this,t=5;this.countDownLocalizer.setParams([t.toString()]);this.schedule((function(){t<=0?e.stopCountdownAnimation():(3===--t&&e.runButtonAnimation(),e.countDownLocalizer.setParams([t.toString()]))}),1,6)}},{key:"stopCountdownAnimation",value:(c=o((function*(){if(this.unscheduleAllCallbacks(),GameSDK.isGameSDK("Yandex"))this.close(!1);else{var e=yield ut.showRewardedInterstitialAdAsync();this.close(e,!0)}})),function(){return c.apply(this,arguments)})},{key:"handleClickedSkip",value:function(){this.unscheduleAllCallbacks(),this.close(!1)}},{key:"handleClickedClaim",value:(u=o((function*(){this.unscheduleAllCallbacks();var e=yield ut.showRewardedInterstitialAdAsync();this.close(e,!0)})),function(){return u.apply(this,arguments)})},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"runButtonAnimation",value:(s=o((function*(){var e=(GameSDK.isGameSDK("Yandex")?this.claimButton:this.skipButton).node.getComponent(B);if(e){var t=R(e).to(.3,{opacity:255});yield Ve.runTweenAsync(t),this.setInteractableButtons(!0)}})),function(){return s.apply(this,arguments)})},{key:"updateStatus",value:function(){var e=GameSDK.isGameSDK("Yandex");this.skipButton.node.active=!e,this.claimButton.node.active=e,this.countDownLocalizer.key=e?"ads.levelAfterT":"ads.adAfterT",this.skipButton.getComponent(B).opacity=0,this.claimButton.getComponent(B).opacity=0}},{key:"setInteractableButtons",value:function(e){this.skipButton.interactable=e,this.claimButton.interactable=e}}]),h}(T)).prototype,"countDownLocalizer",[eae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rae=a(aae.prototype,"skipButton",[tae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lae=a(aae.prototype,"claimButton",[nae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iae=aae))||iae);S._RF.pop(),S._RF.push({},"bfe1eXch0ZMKIz1ofLKc2Iv","HardLevelScreen",void 0);var Dae,Mae,Nae,Bae,Fae,xae,zae,Uae,Gae,Hae,qae,Vae,$ae,Wae=C.ccclass,Kae=C.requireComponent,jae=Ludex,Yae=jae.Events,Xae=jae.Plugins.Ads,Jae=(void 0===Xae?{}:Xae).Types,Zae=codex.event;Wae("HardLevelScreen")(Eae=Kae(q7)(Eae=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i))).handleOpeningScreen=function(t){e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents(),Jae&&ut.preloadAdsByType(Jae.REWARDED_INTERSTITIAL)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Zae.on(Yae.OPENING_SCREEN,this.handleOpeningScreen),Zae.on(Yae.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Zae.off(Yae.OPENING_SCREEN,this.handleOpeningScreen),Zae.off(Yae.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation()}},{key:"close",value:function(){rt.closeScreen(lt.HARD_LEVEL_SCREEN)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}}]),r}(T))||Eae);S._RF.pop(),S._RF.push({},"2db0dg4dI9GCKCdFOMrBFsQ","GetRewardsEffect",void 0);var Qae,eoe,toe,noe,ioe,aoe,ooe,roe,loe,soe,uoe,coe,doe,hoe,poe,yoe,voe,foe,goe,moe,boe,woe,Soe,koe,Coe,Eoe,Aoe,Toe,Poe,Ooe,Loe,Ioe,Roe,_oe,Doe,Moe,Noe,Boe,Foe,xoe,zoe,Uoe,Goe,Hoe,qoe=C.ccclass,Voe=C.property,$oe=(Dae=qoe("GetRewardsEffect"),Mae=Voe(ue),Nae=Voe(ue),Bae=Voe(ue),Fae=Voe(ue),xae=Voe(oT),Dae((Gae=a((Uae=function(a){n(d,a);var s,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"hint",Gae,l(e)),r(e,"thunder",Hae,l(e)),r(e,"storm",qae,l(e)),r(e,"pliers",Vae,l(e)),r(e,"particles",$ae,l(e)),e}return e(d,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"playAnimation",value:(s=o((function*(e,t){var n=this,i=-30*(e.length-1)/2+90;yield Promise.all(e.map((function(e,a){var o=n.createSprite(e),r=i+30*a,l=.15*a;o.node.position=new V(300*Math.cos(r*(Math.PI/180)),300*Math.sin(r*(Math.PI/180)),0);var s=R(o.node);return s.delay(l),s.to(.6,{position:V.ZERO,scale:new V(.7,.7,.7)},{easing:"backIn"}),Ve.runTweenAsync(s).then((function(){t(),je.playSound(Qi.COLLECT_STARS),n.playExplodeEffect(),o.node.destroy()}))})))})),function(e,t){return s.apply(this,arguments)})},{key:"playExplodeEffect",value:function(){var e,t=u(this.particles);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.play()}}catch(e){t.e(e)}finally{t.f()}}},{key:"createSprite",value:function(e){var t=this.getSpriteFrame(e),n=(new q).addComponent(F);return n.spriteFrame=t,n.node.parent=this.node,n.node.scale=new V(1.5,1.5,1.5),n}},{key:"getSpriteFrame",value:function(e){switch(e){case"hint":return this.hint;case"thunder":return this.thunder;case"storm":return this.storm;case"pliers":return this.pliers;default:return null}}}]),d}(T)).prototype,"hint",[Mae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hae=a(Uae.prototype,"thunder",[Nae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qae=a(Uae.prototype,"storm",[Bae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vae=a(Uae.prototype,"pliers",[Fae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$ae=a(Uae.prototype,"particles",[xae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zae=Uae))||zae);S._RF.pop(),S._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var Woe,Koe,joe,Yoe,Xoe,Joe,Zoe,Qoe,ere,tre,nre,ire=C.ccclass,are=C.property,ore=C.requireComponent,rre=Ludex,lre=rre.Events,sre=rre.Utils,ure=sre.Valid,cre=sre.Signal,dre=rre.Plugins.Ads,hre=(void 0===dre?{}:dre).Types,pre=codex,yre=pre.event,vre=pre.player;Qae=ire("LevelCompleteScreen"),eoe=ore(q7),toe=are(K),noe=are(K),ioe=are(B),aoe=are($oe),ooe=are({type:G,group:"Play Button"}),roe=are({type:q,group:"Play Button"}),loe=are({type:B,group:"Play Button"}),soe=are({type:q,group:"Play Button"}),uoe=are({type:q,group:"Play Button"}),coe=are({type:G,group:"Home Button"}),doe=are({type:ce,group:"Coin Container"}),hoe=are({type:hx,group:"Coin Container"}),poe=are({type:ce,group:"Coin Container"}),yoe=are({type:de,group:"Coin Container"}),voe=are({type:de,group:"Coin Container"}),foe=are({type:oT,group:"Particles"}),goe=are({type:oT,group:"Particles"}),moe=are({type:oT,group:"Particles"}),boe=are(B),woe=are(Kd),Qae(Soe=eoe((Coe=a((koe=function(a){n(m,a);var s,u,c,d,h,p,y,v,f,g=i(m);function m(){var e;t(this,m);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=g.call.apply(g,[this].concat(i))).level=1,e.coins=40,e.currentCoins=0,e.score=0,e.playAnimation=!1,e.getRewardsSuccess=!1,e.lookingForRewards=!1,e.playAnimationSignal=new In,r(e,"coinText",Coe,l(e)),r(e,"scoreText",Eoe,l(e)),r(e,"lookingForRewardsText",Aoe,l(e)),r(e,"getRewardsEffect",Toe,l(e)),r(e,"playButton",Poe,l(e)),r(e,"playBackground",Ooe,l(e)),r(e,"shineBackground",Loe,l(e)),r(e,"hardLevelBackground",Ioe,l(e)),r(e,"buttonsContainer",Roe,l(e)),r(e,"homeButton",_oe,l(e)),r(e,"coinAnimation",Doe,l(e)),r(e,"coinContainer",Moe,l(e)),r(e,"coinContainerAnimation",Noe,l(e)),r(e,"coinContainerEnterClip",Boe,l(e)),r(e,"coinContainerExitClip",Foe,l(e)),r(e,"leftConfetti",xoe,l(e)),r(e,"rightConfetti",zoe,l(e)),r(e,"bokehParticles",Uoe,l(e)),r(e,"welldoneUiOpacity",Goe,l(e)),r(e,"welldoneLocalize",Hoe,l(e)),e.localizeVisibilityController=new cre.SignalController,e.coinContainerShown=!1,e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)&&(e.setInteractableButtons(!0),e.hideTextUntilLocalized())},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e.handleParticleEnd=o((function*(){e.level&&(yield Ve.waitTweenAsync(.15)),yield Promise.all([e.animateCoin(),e.animateScore()]),e.lookingForRewards?yield e.handleLookingForRewards():yield e.animateVisibleButtonContainer(!0)})),e}return e(m,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.localizeVisibilityController.abort()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){yre.on(lre.OPENING_SCREEN,this.handleOpeningScreen),yre.on(lre.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){yre.off(lre.OPENING_SCREEN,this.handleOpeningScreen),yre.off(lre.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"hideTextUntilLocalized",value:(f=o((function*(){var e=this.localizeVisibilityController.renew();this.welldoneUiOpacity.opacity=0,yield this.welldoneLocalize.waitUntilLocalized(),e.aborted||(yield Ve.runTweenAsync(R(this.welldoneUiOpacity).to(.5,{opacity:255}),e))})),function(){return f.apply(this,arguments)})},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(!!ure.isObject(i)&&(ure.isNumber(i.level)&&(this.level=i.level,this.coins=this.level<5?cy:dy),ure.isNumber(i.coins)&&(this.currentCoins=i.coins),ure.isNumber(i.score)&&(this.score=i.score),this.playAnimation=!1,ure.isObject(i.overrideAnimation)&&(this.playAnimation="LevelCompleteOpenScreen"===i.overrideAnimation.openScreen),this.lookingForRewards=!1,ure.isBoolean(i.lookingForRewards)&&(this.lookingForRewards=i.lookingForRewards),this.getRewardsSuccess=!1,ure.isBoolean(i.getRewardsSuccess)&&(this.getRewardsSuccess=i.getRewardsSuccess),!0))}},{key:"open",value:function(){this.updateStatus(),this.node.scene.emit(Es.HIDE_UI),this.tryPlayAnimation()}},{key:"close",value:(v=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.localizeVisibilityController.abort(),this.stopParticles(),this.coinContainerShown&&(this.coinContainerShown=!1,yield Ve.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)),yre.emit(lre.CLOSE_SCREEN,{screenName:this.node.name,screenData:{canShowRewardsAd:e}}),this.node.scene.emit(Es.ABORT_COIN_ANIMATION)})),function(){return v.apply(this,arguments)})},{key:"updateStatus",value:function(){this.updateCoinContainer(),this.updateButtonsContainer(),this.lookingForRewardsText.opacity=0}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoins})}},{key:"updateButtonsContainer",value:function(){var e=vre.getGameData();if(e){var t=this.level+1>e.totalLevel?this.level:this.level+1,n=t%5==0,i=13===t;this.playButton.node.active=!1,this.homeButton.node.active=!1,i?this.homeButton.node.active=!0:(this.playButton.node.active=!0,this.playBackground.active=!n,this.hardLevelBackground.active=n)}}},{key:"tryPlayAnimation",value:function(){if(this.playAnimation){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.scoreText.string="0",this.animateVisibleButtonContainer(!1,!1),this.playParticles();var e=this.screen.getComponent(ce);e?e.once(ce.EventType.FINISHED,this.handleParticleEnd):this.handleParticleEnd()}else{if(this.animateVisibleButtonContainer(!0,!1),!this.getRewardsSuccess)return;this.getRewardsEffect.playAnimation(["storm","thunder"],this.triggerCollectItemPlayButtonAnimation.bind(this))}}},{key:"handleLookingForRewards",value:(y=o((function*(){yield this.animateLookingForRewards(),hre&&ut.isReadyAdShowable(hre.REWARDED_INTERSTITIAL)?this.close(!0):this.animateVisibleButtonContainer(!0)})),function(){return y.apply(this,arguments)})},{key:"animateCoin",value:(p=o((function*(){var e=this;this.screen.container?(this.coinAnimation.play(),yield Ve.runOnUpdateAsync(this.node,.8,(function(t){var n=Se(0,e.coins,t),i=Math.floor(n);e.coinText.string="x".concat(i)})),yield this.animateCoinCollection(),this.coinText.string="x".concat(this.coins)):console.warn("LevelCompleteScreen: screen not found")})),function(){return p.apply(this,arguments)})},{key:"animateScore",value:(h=o((function*(){var e=this;Ve.runOnUpdateAsync(this.scoreText.node,.8,(function(t){var n=Se(0,e.score,t);e.scoreText.string="".concat(Math.floor(n))})),this.scoreText.node.setScale(1,1,1),this.scoreText.string="".concat(this.score)})),function(){return h.apply(this,arguments)})},{key:"animateCoinCollection",value:(d=o((function*(){this.coinContainerShown=!0,yield Ve.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name),this.node.scene.emit(Es.ADD_COINS,{coins:this.coins,collectionAnimation:{floatDuration:.5,flyDuration:.5,animateTextOnly:!1,target:this.coinContainer}})})),function(){return d.apply(this,arguments)})},{key:"animateLookingForRewards",value:(c=o((function*(){var e=R(this.lookingForRewardsText);e.to(.25,{opacity:255},{easing:"linear"}).delay(.25),e.to(.25,{opacity:100},{easing:"linear"}).delay(.125),yield Ve.runTweenAsync(R(this.lookingForRewardsText).repeat(2,e).to(.25,{opacity:0},{easing:"linear"})),this.lookingForRewardsText.opacity=0})),function(){return c.apply(this,arguments)})},{key:"animateVisibleButtonContainer",value:(u=o((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e?1:0;if(t){this.playAnimationSignal.abort();var i=new In;this.playAnimationSignal=i;var a=e?0:1;this.buttonsContainer.setScale(a,a,this.buttonsContainer.scale.z);var o=R(this.buttonsContainer).to(.5,{scale:new V(n,n,1)},{easing:"backOut"});e||this.setInteractableButtons(!1),yield Ve.runTweenAsync(o,i),e&&this.setInteractableButtons(!0)}else this.setInteractableButtons(e),this.buttonsContainer.setScale(n,n,this.buttonsContainer.scale.z)})),function(e){return u.apply(this,arguments)})},{key:"triggerCollectItemPlayButtonAnimation",value:(s=o((function*(){this.playAnimationSignal.abort();var e=new In;this.playAnimationSignal=e;var t=R(this.buttonsContainer).to(.08,{scale:new V(.95,1.05,1)}).to(.08,{scale:new V(1.05,.95,1)}).to(.08,{scale:new V(1,1,1)}),n=R(this.shineBackground).to(.08,{opacity:50},{easing:"quadOut"}).to(.08,{opacity:0},{easing:"quadIn"});yield Promise.all([Ve.runTweenAsync(t,e),Ve.runTweenAsync(n,e)])})),function(){return s.apply(this,arguments)})},{key:"playParticles",value:function(){var e=Je.isLandscape(),t=e?50:30,n=e?5e3:2e3,i=e?15e3:1e4,a=e?40:60,o=e?110:100,r=e?30:20;this.leftConfetti.bursts[0].count=this.rightConfetti.bursts[0].count=t,this.leftConfetti.startSpeed.constantMin=this.rightConfetti.startSpeed.constantMin=n,this.leftConfetti.startSpeed.constantMax=this.rightConfetti.startSpeed.constantMax=i,this.leftConfetti.shapeModule.angle=a,this.rightConfetti.shapeModule.angle=o,this.leftConfetti.shapeModule.arc=this.rightConfetti.shapeModule.arc=r,this.leftConfetti.play(),this.rightConfetti.play(),this.bokehParticles.play()}},{key:"stopParticles",value:function(){this.leftConfetti.stop(),this.rightConfetti.stop(),this.bokehParticles.stop()}},{key:"setInteractableButtons",value:function(e){this.playButton.interactable=e,this.homeButton.interactable=e}},{key:"handleClickedPlay",value:function(){this.setInteractableButtons(!1),this.close()}},{key:"handleClickedHome",value:function(){this.setInteractableButtons(!1),this.close()}}]),m}(T)).prototype,"coinText",[toe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eoe=a(koe.prototype,"scoreText",[noe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aoe=a(koe.prototype,"lookingForRewardsText",[ioe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Toe=a(koe.prototype,"getRewardsEffect",[aoe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Poe=a(koe.prototype,"playButton",[ooe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ooe=a(koe.prototype,"playBackground",[roe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Loe=a(koe.prototype,"shineBackground",[loe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ioe=a(koe.prototype,"hardLevelBackground",[soe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Roe=a(koe.prototype,"buttonsContainer",[uoe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_oe=a(koe.prototype,"homeButton",[coe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Doe=a(koe.prototype,"coinAnimation",[doe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Moe=a(koe.prototype,"coinContainer",[hoe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Noe=a(koe.prototype,"coinContainerAnimation",[poe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Boe=a(koe.prototype,"coinContainerEnterClip",[yoe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Foe=a(koe.prototype,"coinContainerExitClip",[voe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xoe=a(koe.prototype,"leftConfetti",[foe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zoe=a(koe.prototype,"rightConfetti",[goe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uoe=a(koe.prototype,"bokehParticles",[moe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Goe=a(koe.prototype,"welldoneUiOpacity",[boe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hoe=a(koe.prototype,"welldoneLocalize",[woe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Soe=koe))||Soe);S._RF.pop(),S._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var fre,gre,mre,bre,wre,Sre=C.ccclass,kre=C.property,Cre=["interMsg.reviveAd","interMsg.doubleAd","interMsg.ranked","interMsg.friendChallenge","interMsg.bragChallenge","interMsg.clearTiles","interMsg.beatClock","interMsg.clearBombs","interMsg.seasonPack","interMsg.collectStars","interMsg.competeInLb","interMsg.competeWithFriends","interMsg.thunder","interMsg.hint","interMsg.pliers","interMsg.tornado","interMsg.coins","interMsg.seasonTiles","interMsg.dailyLogin","interMsg.levelUp","interMsg.seasonRewards"],Ere=(Woe=Sre("LoadingFullScreen"),Koe=Ni.required(),joe=kre(ie),Yoe=Ni.required(),Xoe=Ni.required(),Joe=kre(Kd),Woe((ere=a((Qoe=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"progressBar",ere,l(e)),r(e,"uiOpacity",tre,l(e)),r(e,"loadingLabelLocalizer",nre,l(e)),e}return e(d,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(B),Ni.validateRequiredProperties(this)}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0,this.progressBar.progress=0}},{key:"show",value:(u=o((function*(e){this.uiOpacity.opacity=0,this.progressBar.progress=0;var t=R(this.uiOpacity).to(.5,{opacity:255},{easing:"cubicOut"}),n=R(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),Ve.runTweenAsync(t),yield Ve.runTweenAsync(n)})),function(e){return u.apply(this,arguments)})},{key:"hide",value:(s=o((function*(e){if(this.uiOpacity&&this.progressBar){this.uiOpacity.opacity=255,this.progressBar.progress=.9;var t=R(this.uiOpacity).to(.5,{opacity:0},{easing:"cubicIn"}),n=R(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation(),yield Ve.runTweenAsync(n),this.stopLoadingTextAnimation(),yield Ve.runTweenAsync(t),this.node.active=!1}})),function(e){return s.apply(this,arguments)})},{key:"runLoadingTextAnimation",value:function(){var e=this;this.updateHintText(),this.schedule((function(){return e.updateHintText()}),5)}},{key:"updateHintText",value:function(){if(this.loadingLabelLocalizer){var e=this.getHintText();e&&(this.loadingLabelLocalizer.key=e)}}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"getHintText",value:function(){return Cre[Math.floor(Math.random()*Cre.length)]}}]),d}(T)).prototype,"progressBar",[Koe,joe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tre=a(Qoe.prototype,"uiOpacity",[Yoe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nre=a(Qoe.prototype,"loadingLabelLocalizer",[Xoe,Joe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zoe=Qoe))||Zoe);S._RF.pop(),S._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var Are,Tre=C.ccclass,Pre=C.property;fre=Tre("Loading"),gre=Pre(fe),fre((wre=a((bre=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"loadingPrefab",wre,l(e)),e.loadingNode=null,e}return e(d,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){A.isPersistRootNode(this.node)||A.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var e,t=re("Canvas");if(t&&!t.getChildByName("Loading")){this.loadingNode||(this.loadingNode=ye(this.loadingPrefab));var n=ye._clone(this.loadingNode);this.loadingFullScreen=n.getComponent(Ere),null===(e=re("Canvas"))||void 0===e||e.addChild(n)}}},{key:"show",value:(u=o((function*(e){this.createLoadingFullScreen(),yield this.loadingFullScreen.show(e)})),function(e){return u.apply(this,arguments)})},{key:"hide",value:(s=o((function*(e){this.loadingFullScreen&&(yield this.loadingFullScreen.hide(e))})),function(e){return s.apply(this,arguments)})}]),d}(T)).prototype,"loadingPrefab",[gre],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mre=bre));S._RF.pop(),S._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var Ore,Lre,Ire,Rre,_re,Dre,Mre,Nre,Bre,Fre,xre=C.ccclass,zre=C.disallowMultiple,Ure=C.requireComponent,Gre=Ludex.Events,Hre=codex.event;xre("LoadingScreen")(Are=zre(Are=Ure(q7)(Are=function(a){n(r,a);var o=i(r);function r(){var e;t(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=o.call.apply(o,[this].concat(i))).isClosing=!1,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0,e.isClosing=!1)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&(e.isClosing=!0,e.unscheduleAllCallbacks())},e.handleClosedScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!1,e.isClosing=!1)},e.handleOnCloseScreen=function(){rt.closeScreen(lt.LOADING_SCREEN)},e}return e(r,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.validateRequiredProperties(this,r)}},{key:"listenScreenEvents",value:function(){Hre.on(Gre.OPENING_SCREEN,this.handleOpeningScreen),Hre.on(Gre.OPENED_SCREEN,this.handleOpenedScreen),Hre.on(Gre.CLOSING_SCREEN,this.handleClosingScreen),Hre.on(Gre.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){Hre.off(Gre.OPENING_SCREEN,this.handleOpeningScreen),Hre.off(Gre.OPENED_SCREEN,this.handleOpenedScreen),Hre.off(Gre.CLOSING_SCREEN,this.handleClosingScreen),Hre.off(Gre.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled&&!this.isClosing){var e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}}}]),r}(T))||Are)||Are);S._RF.pop(),S._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var qre,Vre,$re,Wre,Kre,jre,Yre,Xre,Jre,Zre,Qre,ele,tle,nle,ile,ale,ole=C.ccclass,rle=C.disallowMultiple,lle=C.requireComponent,sle=C.property,ule=Ludex,cle=ule.Events,dle=ule.Utils.Valid,hle=codex.event;Ore=ole("NotificationScreen"),Lre=lle(q7),Ire=sle(K),Rre=sle(Kd),_re=sle(G),Ore(Dre=rle(Dre=Lre((Nre=a((Mre=function(a){n(s,a);var o=i(s);function s(){var e;t(this,s);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=o.call.apply(o,[this].concat(i)),r(e,"message",Nre,l(e)),r(e,"messageLocalizer",Bre,l(e)),r(e,"touchZone",Fre,l(e)),e.enableCloseOnTouch=!0,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.updateScreenData(t),e.screen.backgroundMaskButton.interactable=e.enableCloseOnTouch)},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e}return e(s,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.screen=this.getComponent(q7),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){hle.on(cle.OPENING_SCREEN,this.handleOpeningScreen),hle.on(cle.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){hle.off(cle.OPENING_SCREEN,this.handleOpeningScreen),hle.off(cle.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"updateScreenData",value:function(e){var t=e.screenData;dle.isObject(t)?(void 0!==t.message?this.setMessageManually(t.message):void 0!==t.localizedMessageKey&&this.setMessageUsingLocalizeKey(t.localizedMessageKey),t.duration&&t.duration>0&&this.scheduleOnce((function(){rt.closeScreen(lt.NOTIFICATION_SCREEN)}),t.duration),!1===t.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"setMessageManually",value:function(e){this.messageLocalizer.enabled=!1,this.message.string=e}},{key:"setMessageUsingLocalizeKey",value:function(e){this.messageLocalizer.enabled=!0,this.messageLocalizer.key=e}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),this.screen.backgroundMaskButton.interactable=!1,rt.closeScreen(lt.NOTIFICATION_SCREEN)}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),s}(T)).prototype,"message",[Ire],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bre=a(Mre.prototype,"messageLocalizer",[Rre],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fre=a(Mre.prototype,"touchZone",[_re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dre=Mre))||Dre)||Dre);S._RF.pop(),S._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var ple,yle,vle,fle,gle,mle,ble,wle,Sle,kle,Cle,Ele,Ale,Tle,Ple,Ole,Lle,Ile,Rle,_le,Dle,Mle,Nle=C.ccclass,Ble=C.property,Fle=C.requireComponent,xle=Ludex,zle=xle.Events,Ule=xle.Match.Modes,Gle=codex,Hle=Gle.event,qle=Gle.storage;qre=Nle("QuitLevelScreen"),Vre=Fle(q7),$re=Ble(K),Wre=Ble(K),Kre=Ble(G),jre=Ble(K),Yre=Ble(K),Xre=Ble(G),qre(Jre=Vre((Qre=a((Zre=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"singleDescription",Qre,l(e)),r(e,"tournamentDescription",ele,l(e)),r(e,"quitButton",tle,l(e)),r(e,"quitLabel",nle,l(e)),r(e,"endLabel",ile,l(e)),r(e,"continueButton",ale,l(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.setInteractableButtons(!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(d,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Hle.on(zle.OPENING_SCREEN,this.handleOpeningScreen),Hle.on(zle.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Hle.off(zle.OPENING_SCREEN,this.handleOpeningScreen),Hle.off(zle.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(Es.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),rt.closeScreen(lt.QUIT_LEVEL_SCREEN),this.node.scene.emit(Es.SHOW_UI),this.node.scene.emit(Es.GAME_RESUME)}},{key:"updateStatus",value:function(){var e=Xy.getMatchMode()===Ule.TOURNAMENT;this.singleDescription.node.active=!e,this.tournamentDescription.node.active=e,this.quitLabel.node.active=!e,this.endLabel.node.active=e}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(e){this.quitButton.interactable=e,this.continueButton.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"handleClickedContinue",value:function(){this.close()}},{key:"handleClickedQuit",value:(u=o((function*(){this.setInteractableButtons(!1),Xy.getMatchMode()===Ule.TOURNAMENT&&(yield this.handleTournamentQuit()),this.node.scene.emit(Es.GAME_EXIT)})),function(){return u.apply(this,arguments)})},{key:"handleTournamentQuit",value:(s=o((function*(){var e,t,n=null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{},i=n.score,a=void 0===i?0:i,o=n.level,r=void 0===o?1:o,l=n.tournamentId,s=a>(null!==(t=qle.getStorageData("tournament","previousScore"))&&void 0!==t?t:0);s&&l&&st.saveTournamentProgress(r,a,l),qle.setStorageData("tournament","animateTournamentLeader",s),yield Xy.finishMatchAsync()})),function(){return s.apply(this,arguments)})}]),d}(T)).prototype,"singleDescription",[$re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ele=a(Zre.prototype,"tournamentDescription",[Wre],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tle=a(Zre.prototype,"quitButton",[Kre],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nle=a(Zre.prototype,"quitLabel",[jre],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ile=a(Zre.prototype,"endLabel",[Yre],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ale=a(Zre.prototype,"continueButton",[Xre],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jre=Zre))||Jre);S._RF.pop(),S._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var Vle,$le,Wle,Kle,jle,Yle,Xle,Jle,Zle,Qle,ese,tse,nse,ise,ase,ose,rse,lse,sse,use,cse,dse,hse,pse,yse,vse,fse,gse,mse,bse,wse=C.ccclass,Sse=C.property,kse=C.disallowMultiple,Cse=C.requireComponent,Ese=Ludex,Ase=Ese.Events,Tse=Ese.Plugins.Ads,Pse=(void 0===Tse?{}:Tse).Types,Ose=codex,Lse=Ose.event,Ise=Ose.player;ple=wse("RescuesScreen"),yle=Cse(q7),vle=Sse(B),fle=Sse([q]),gle=Sse(Kd),mle=Sse(Kd),ble=Sse(q),wle=Sse(q),Sle=Sse(ce),kle=Sse(q),Cle=Sse(q),ple(Ele=kse(Ele=yle((Tle=a((Ale=function(a){n(v,a);var s,u,c,d,h,p,y=i(v);function v(){var e;t(this,v);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=y.call.apply(y,[this].concat(i)),r(e,"adOpacity",Tle,l(e)),r(e,"animNodes",Ple,l(e)),r(e,"titleLocalizer",Ole,l(e)),r(e,"descriptionLocalizer",Lle,l(e)),r(e,"timer",Ile,l(e)),r(e,"bomb",Rle,l(e)),r(e,"bombAnim",_le,l(e)),r(e,"replayButton",Dle,l(e)),r(e,"buyTimeButton",Mle,l(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("RescuesScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(v,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents(),Pse&&ut.preloadAdsByType(Pse.REWARDED_VIDEO)}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Lse.on(Ase.OPENING_SCREEN,this.handleOpeningScreen),Lse.on(Ase.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Lse.off(Ase.OPENING_SCREEN,this.handleOpeningScreen),Lse.off(Ase.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:(p=o((function*(){je.turnOffMusic(),this.resetState(),this.runOpenAnimation(),this.node.scene.emit(Es.HIDE_UI)})),function(){return p.apply(this,arguments)})},{key:"close",value:function(e){je.turnUpMusic(),Lse.emit(Ase.CLOSE_SCREEN,{screenName:this.node.name,screenData:e})}},{key:"resetState",value:function(){var e,t=(null===(e=this.payload.screenData)||void 0===e?void 0:e.failKey)===Zy;this.titleLocalizer.key=t?"game.boom":"game.timesUp",this.descriptionLocalizer.key=t?"game.bombDesc":"game.timesUpDesc",this.timer.active=!t,this.bomb.active=t,t&&this.bombAnim.play();var n=Ise.getGameData();if(n){var i=n.coins>=yy;this.replayButton.active=!i,this.buyTimeButton.active=i,this.adOpacity.opacity=0}}},{key:"runOpenAnimation",value:(h=o((function*(){var e=this;this.screen.container?(yield Promise.all(this.animNodes.map((function(t,n){return e.runAppearTween(t,.1*n)}))),yield this.runShowAdContainer()):console.warn("TimeUpScreen: screen not found")})),function(){return h.apply(this,arguments)})},{key:"runAppearTween",value:(d=o((function*(e,t){yield Ve.runTweenAsync(R(e).set({scale:new V(0,0,0)}).delay(t).to(1,{scale:new V(1,1,1)},{easing:function(e){return Ve.elasticOut(e,.1,.45)}}))})),function(e,t){return d.apply(this,arguments)})},{key:"runShowAdContainer",value:(c=o((function*(){var e=R(this.adOpacity);e.delay(1),e.to(.5,{opacity:255}),yield Ve.runTweenAsync(e)})),function(){return c.apply(this,arguments)})},{key:"handleClickReplay",value:(u=o((function*(){var e=this.screen.data.level;GameSDK.isGameSDK("Yandex")&&(yield ut.showInterstitialAdAsync({forLevel:e})),this.close()})),function(){return u.apply(this,arguments)})},{key:"handleClickBuyTime",value:function(){this.node.scene.emit(Es.REMOVE_COINS,{coins:yy,collectionAnimation:{animateTextOnly:!0}}),this.close({rescue:!0})}},{key:"handleClickAd",value:(s=o((function*(){(yield ut.showRewardVideoAdAsync())&&this.close({rescue:!0})})),function(){return s.apply(this,arguments)})},{key:"handleClickClose",value:function(){var e,t,n=(null!==(e=null===(t=Ise.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:1)>=13;this.close({customMode:n})}}]),v}(T)).prototype,"adOpacity",[vle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ple=a(Ale.prototype,"animNodes",[fle],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ole=a(Ale.prototype,"titleLocalizer",[gle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lle=a(Ale.prototype,"descriptionLocalizer",[mle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ile=a(Ale.prototype,"timer",[ble],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rle=a(Ale.prototype,"bomb",[wle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_le=a(Ale.prototype,"bombAnim",[Sle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dle=a(Ale.prototype,"replayButton",[kle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mle=a(Ale.prototype,"buyTimeButton",[Cle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ele=Ale))||Ele)||Ele);S._RF.pop(),S._RF.push({},"726c9oCUUBDpboDnHRz7SGZ","PauseScreen",void 0);var Rse,_se,Dse,Mse,Nse,Bse,Fse,xse,zse,Use,Gse,Hse,qse,Vse,$se,Wse,Kse,jse,Yse,Xse,Jse,Zse,Qse,eue,tue,nue,iue,aue,oue=C.ccclass,rue=C.property,lue=C.requireComponent,sue=Ludex,uue=sue.Events,cue=sue.Utils.Device,due=sue.Match.Modes,hue=codex,pue=hue.player,yue=hue.event;Vle=oue("PauseScreen"),$le=lue(q7),Wle=rue(q),Kle=rue(q),jle=rue(q),Yle=rue(o0),Xle=rue(o0),Jle=rue(o0),Zle=rue(G),Qle=rue({type:G,group:"Button Container"}),ese=rue({type:G,group:"Button Container"}),tse=rue({type:G,group:"Button Container"}),nse=rue({type:G,group:"Button Container"}),ise=rue({type:G,group:"Button Container"}),ase=rue(B),Vle(ose=$le((lse=a((rse=function(a){n(p,a);var s,u,c,d,h=i(p);function p(){var e;t(this,p);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=h.call.apply(h,[this].concat(i)),r(e,"musicSetting",lse,l(e)),r(e,"soundSetting",sse,l(e)),r(e,"vibrateSetting",use,l(e)),r(e,"musicSwitch",cse,l(e)),r(e,"soundSwitch",dse,l(e)),r(e,"vibrateSwitch",hse,l(e)),r(e,"closeButtonComponent",pse,l(e)),r(e,"resumeButton",yse,l(e)),r(e,"restartButton",vse,l(e)),r(e,"challengeFriendsButton",fse,l(e)),r(e,"createShortcutButton",gse,l(e)),r(e,"customModeButton",mse,l(e)),r(e,"containerUIOpacity",bse,l(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus(),e.updateButtonsStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,i=ky.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==i.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===i),e.triggerSequence===i&&(e.node.scene.emit(ky.Events.UNLOCK_DEV_TOOLS),e.node.off(ky.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(G),n=e.vibrateSetting.getComponentInChildren(o0),i=e.vibrateSetting.getComponentInChildren(qr);if(t&&n&&i)if(cue.isMobile()){var a,o=null!==(a=pue.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(o)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return e(p,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){yue.on(uue.OPENING_SCREEN,this.handleOpeningScreen),yue.on(uue.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){yue.off(uue.OPENING_SCREEN,this.handleOpeningScreen),yue.off(uue.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(ky.Events.TRIGGER_UNLOCK_KEY),this.node.on(ky.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(ky.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(ky.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(ky.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.node.emit(ky.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(Es.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(ky.Events.TRIGGER_RESET_SEQUENCE),rt.closeScreen(lt.PAUSE_SCREEN)}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=pue.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=pue.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=pue.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),GameSDK.isGameSDK("GameDistribution")||this.updateVibrateButton()):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"setInteractableButtons",value:function(e){this.resumeButton.interactable=e,this.closeButtonComponent.interactable=e,this.restartButton.interactable=e,this.challengeFriendsButton.interactable=e,this.screen.backgroundMaskButton.interactable=e,this.customModeButton.interactable=e}},{key:"updateButtonsStatus",value:function(){var e,t=GameSDK.isGameSDK("Yandex"),n=Xy.getMatchMode()===due.SINGLE||Xy.getMatchMode()===ev,i=(null!==(e=pue.getGameData())&&void 0!==e?e:{}).level,a=void 0===i?1:i;this.setActiveButton(this.challengeFriendsButton,!t),this.setActiveButton(this.createShortcutButton,t&&cue.isDesktop()),this.setActiveButton(this.customModeButton,n&&a>=13),this.setActiveButton(this.resumeButton,!n)}},{key:"setActiveButton",value:function(e,t){e&&e.node.parent&&(e.node.parent.active=t)}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();if(pue.setSetting("music",e),this.node.emit(ky.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e){var t=Xy.getMatchMode();je.playMusic(t===due.TOURNAMENT?Qi.TOURNAMENT_MUSIC:Qi.BG_MUSIC)}else je.pauseMusic();this.handleMsGamesAudioSync(e)}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"handleMsGamesAudioSync",value:function(e){GameSDK.isGameSDK("MsGames")&&(console.log("handleMsGamesAudioSync",e),e?GameSDK.extra.notifyGameUnmuted():GameSDK.extra.notifyGameMuted())}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();pue.setSetting("sound",e),this.node.emit(ky.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();pue.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedCustomMode",value:(d=o((function*(){var e;this.setVisible(!1);var t=(null!==(e=(yield rt.openScreenAndWaitForClose(lt.CUSTOM_GAME_SCREEN)).screenData)&&void 0!==e?e:{}).customMode;if(!t)return this.node.scene.emit(Es.HIDE_UI),void this.setVisible(!0);this.close(),this.node.scene.emit(Es.GAME_RESUME),this.node.scene.emit(Es.GAME_REPLAY,t?ev:void 0)})),function(){return d.apply(this,arguments)})},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedRestart",value:(c=o((function*(){var e;this.close();var t=(null!==(e=pue.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;Xy.getMatchMode()===ev?yield ut.showRewardedInterstitialAdAsync({showError:!1}):yield ut.showInterstitialAdAsync({forLevel:n}),Xy.getMatchMode()!==due.TOURNAMENT?(this.node.scene.emit(Es.GAME_RESUME),this.node.scene.emit(Es.GAME_REPLAY)):rt.openScreen(lt.START_OVER_SCREEN)})),function(){return c.apply(this,arguments)})},{key:"handleClickedChallengeFriends",value:(u=o((function*(){if(GameSDK.isGameSDK("MsGames"))return rt.showLoadingScreen(),yield GameSDK.extra.shareAsync(),void rt.closeLoadingScreen();this.close(),this.node.scene.emit(Es.CHALLENGE_FRIENDS)})),function(){return u.apply(this,arguments)})},{key:"handleClickedCreateShortcut",value:(s=o((function*(){try{yield GameSDK.extra.checkAndCreateShortcutAsync()}catch(e){rt.showNotificationScreenWithLocalizedKey("error.shortcutFail")}})),function(){return s.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(Es.GAME_RESUME),this.node.scene.emit(Es.SHOW_UI)}},{key:"setVisible",value:function(e){this.containerUIOpacity.opacity=e?255:0}}]),p}(T)).prototype,"musicSetting",[Wle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sse=a(rse.prototype,"soundSetting",[Kle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),use=a(rse.prototype,"vibrateSetting",[jle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cse=a(rse.prototype,"musicSwitch",[Yle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dse=a(rse.prototype,"soundSwitch",[Xle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hse=a(rse.prototype,"vibrateSwitch",[Jle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pse=a(rse.prototype,"closeButtonComponent",[Zle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yse=a(rse.prototype,"resumeButton",[Qle],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vse=a(rse.prototype,"restartButton",[ese],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fse=a(rse.prototype,"challengeFriendsButton",[tse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gse=a(rse.prototype,"createShortcutButton",[nse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mse=a(rse.prototype,"customModeButton",[ise],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bse=a(rse.prototype,"containerUIOpacity",[ase],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ose=rse))||ose);S._RF.pop(),S._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var vue,fue,gue,mue,bue,wue,Sue,kue,Cue,Eue,Aue,Tue,Pue,Oue,Lue,Iue,Rue,_ue,Due,Mue,Nue,Bue,Fue,xue=C.ccclass,zue=C.property,Uue=C.requireComponent,Gue=Ludex,Hue=Gue.Events,que=Gue.Utils.Device,Vue=Gue.Match.Modes,$ue=Gue.Configs.Debugger.MonitorError,Wue=Gue.Plugins.Analytics,Kue=(void 0===Wue?{}:Wue).Events,jue=codex,Yue=jue.player,Xue=jue.event,Jue=jue.monitorError,Zue=jue.frameCapture,Que=jue.analytics;Rse=xue("SettingsScreen"),_se=Uue(q7),Dse=zue({type:q,group:"SettingContainer"}),Mse=zue({type:q,group:"SettingContainer"}),Nse=zue({type:q,group:"SettingContainer"}),Bse=zue({type:o0,group:"Switch Container"}),Fse=zue({type:o0,group:"Switch Container"}),xse=zue({type:o0,group:"Switch Container"}),zse=zue(G),Use=zue({type:G,group:"Button Container"}),Gse=zue({type:G,group:"Button Container"}),Hse=zue({type:G,group:"Button Container"}),qse=zue({type:G,group:"Button Container"}),Vse=zue({type:G,group:"Button Container"}),Rse($se=_se((Kse=a((Wse=function(a){n(y,a);var s,u,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"musicSetting",Kse,l(e)),r(e,"soundSetting",jse,l(e)),r(e,"vibrateSetting",Yse,l(e)),r(e,"musicSwitch",Xse,l(e)),r(e,"soundSwitch",Jse,l(e)),r(e,"vibrateSwitch",Zse,l(e)),r(e,"closeButton",Qse,l(e)),r(e,"reportButton",eue,l(e)),r(e,"shareButton",tue,l(e)),r(e,"inviteFriendsButton",nue,l(e)),r(e,"feedbackButton",iue,l(e)),r(e,"createShortcutButton",aue,l(e)),e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(G),n=e.vibrateSetting.getComponentInChildren(o0),i=e.vibrateSetting.getComponentInChildren(qr);if(t&&n&&i)if(que.isMobile()){var a,o=null!==(a=Yue.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(o)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return e(y,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.listenScreenEvents(),this.updateButtonsStatus()}},{key:"onDestroy",value:function(){this.unlistenScreenEvents()}},{key:"listenScreenEvents",value:function(){Xue.on(Hue.OPENING_SCREEN,this.handleOpeningScreen),Xue.on(Hue.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unlistenScreenEvents",value:function(){Xue.off(Hue.OPENING_SCREEN,this.handleOpeningScreen),Xue.off(Hue.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.node.emit(ky.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(Es.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(ky.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(Es.SHOW_UI),rt.closeScreen(lt.SETTINGS_SCREEN)}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=Yue.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=Yue.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=Yue.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),GameSDK.isGameSDK("GameDistribution")||this.updateVibrateButton()):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"setInteractableButtons",value:function(e){this.closeButton.interactable=e,this.reportButton.interactable=e,this.shareButton.interactable=e,this.inviteFriendsButton.interactable=e,this.feedbackButton.interactable=e,this.createShortcutButton.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"updateButtonsStatus",value:function(){var e=GameSDK.isGameSDK("Yandex"),t=GameSDK.isGameSDK("MsGames");this.setActiveButton(this.reportButton,$ue.Feedback),this.setActiveButton(this.shareButton,!e&&!t),this.setActiveButton(this.inviteFriendsButton,!e),this.setActiveButton(this.feedbackButton,e),this.setActiveButton(this.createShortcutButton,e&&que.isDesktop()||t)}},{key:"setActiveButton",value:function(e,t){e&&e.node.parent&&(e.node.parent.active=t)}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();if(Yue.setSetting("music",e),e){var t=Xy.getMatchMode();je.playMusic(t===Vue.TOURNAMENT?Qi.TOURNAMENT_MUSIC:Qi.BG_MUSIC)}else je.pauseMusic();this.handleMsGamesAudioSync(e)}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"handleMsGamesAudioSync",value:function(e){GameSDK.isGameSDK("MsGames")&&(console.log("handleMsGamesAudioSync",e),e?GameSDK.extra.notifyGameUnmuted():GameSDK.extra.notifyGameMuted())}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();Yue.setSetting("sound",e)}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();Yue.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleClickedReport",value:function(){null==Jue||Jue.feedbackAsync()}},{key:"handleClickedShare",value:(h=o((function*(){if(GameSDK.isGameSDK("FacebookInstant"))return rt.showLoadingScreen(),GameSDK.extra.isNEZP()?yield BM.shareBestScoreWithOverlay():yield GameSDK.extra.shareBestScoreAsync(),void rt.closeLoadingScreen();this.close()})),function(){return h.apply(this,arguments)})},{key:"handleClickedInviteFriends",value:(d=o((function*(){rt.showLoadingScreen(),GameSDK.isGameSDK("MsGames")&&(yield GameSDK.extra.shareAsync()),GameSDK.isGameSDK("FacebookInstant")&&(yield this.inviteWithBestScoreFbInstant()),rt.closeLoadingScreen()})),function(){return d.apply(this,arguments)})},{key:"handleClickedFeedback",value:function(){var e="error.ratingFail";"ratingAsync"in GameSDK.extra?GameSDK.extra.ratingAsync().catch((function(t){if("code"in t){switch(t.code){case"NO_AUTH":e="error.ratingNoAuth";break;case"GAME_RATED":e="error.ratingGameRated"}rt.showNotificationScreenWithLocalizedKey(e)}else rt.showNotificationScreenWithLocalizedKey(e)})):rt.showNotificationScreenWithLocalizedKey(e)}},{key:"handleClickedCreateShortcut",value:(c=o((function*(){try{yield GameSDK.extra.checkAndCreateShortcutAsync()}catch(e){rt.showNotificationScreenWithLocalizedKey("error.shortcutFail")}})),function(){return c.apply(this,arguments)})},{key:"inviteWithBestScoreFbInstant",value:(u=o((function*(){GameSDK.isGameSDK("FacebookInstant")&&(GameSDK.extra.isNEZP()?yield BM.inviteFriendsWithOverlay():yield this.inviteWithBestScoreAsync())})),function(){return u.apply(this,arguments)})},{key:"inviteWithBestScoreAsync",value:(s=o((function*(){if(GameSDK.isGameSDK("FacebookInstant"))try{if(!Zue)throw new Error("FrameCapture not found");var e=Yue.getPlayer(),t=e.playerId,n=e.name,i=e.photo,a=(e.data||{}).score,o=yield Zue.renderAsync("share-score-with-invite",{playerId:t,playerPhoto:i,playerScore:a});if(null===o)throw new Error("Failed to render share score wideframe");yield GameSDK.extra.inviteAsync({text:{default:"Great! I got a new best score!",localizations:{vi_VN:"Tht tuyt! Mnh va ph k lc ny!"}},image:o,data:{playerId:t,playerName:n,playerPhoto:i,type:"share_invite"}}),Kue&&Que.event(Kue.INVITE,{invite_content_type:"BestScore",success:!0})}catch(e){Kue&&Que.event(Kue.INVITE,{invite_content_type:"BestScore",success:!1}),console.warn(e)}})),function(){return s.apply(this,arguments)})}]),y}(T)).prototype,"musicSetting",[Dse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jse=a(Wse.prototype,"soundSetting",[Mse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yse=a(Wse.prototype,"vibrateSetting",[Nse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xse=a(Wse.prototype,"musicSwitch",[Bse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jse=a(Wse.prototype,"soundSwitch",[Fse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zse=a(Wse.prototype,"vibrateSwitch",[xse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qse=a(Wse.prototype,"closeButton",[zse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eue=a(Wse.prototype,"reportButton",[Use],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tue=a(Wse.prototype,"shareButton",[Gse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nue=a(Wse.prototype,"inviteFriendsButton",[Hse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iue=a(Wse.prototype,"feedbackButton",[qse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aue=a(Wse.prototype,"createShortcutButton",[Vse],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$se=Wse))||$se);S._RF.pop(),S._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var ece,tce,nce,ice,ace,oce,rce,lce,sce,uce,cce,dce,hce,pce,yce,vce,fce,gce,mce,bce,wce=C.ccclass,Sce=C.property,kce=(vue=wce("StarChest"),fue=Sce(F),gue=Sce(B),mue=Sce(ee),bue=Sce(B),wue=Sce(B),Sue=Sce({type:L,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),kue=Sce({type:L,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),Cue=Sce({type:L,displayName:"Centered Offset X",group:"Reward Animations"}),Eue=Sce({type:L,displayName:"Centered Offset Y",group:"Reward Animations"}),Aue=Sce({type:L,min:0,displayName:"Starting Scale",group:"Reward Animations"}),Tue=Sce({type:L,min:0,displayName:"Ending Scale",group:"Reward Animations"}),vue((Lue=a((Oue=function(a){n(y,a);var s,u,c,d,h,p=i(y);function y(){var e;t(this,y);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=p.call.apply(p,[this].concat(i)),r(e,"sprite",Lue,l(e)),r(e,"glowOpacity",Iue,l(e)),r(e,"explosionParticles",Rue,l(e)),r(e,"circle",_ue,l(e)),r(e,"uiOpacity",Due,l(e)),e.ogCenterX=0,e.ogCenterY=0,r(e,"endingOffsetX",Mue,l(e)),r(e,"endingOffsetY",Nue,l(e)),r(e,"startingScale",Bue,l(e)),r(e,"endingScale",Fue,l(e)),e}return e(y,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"moveToCenter",value:(h=o((function*(e){var t=new V(this.endingOffsetX,this.endingOffsetY,this.node.position.z);yield Ve.runTweenAsync(R(this.node).to(.7,{position:t},{easing:"quintInOut"}),e),this.node.position=t})),function(e){return h.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new V(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(d=o((function*(e,t){var n=this.startingScale+(this.endingScale-this.startingScale)*e,i=new V(n,n,n);yield Promise.all([Ve.runTweenAsync(R(this.sprite.node).to(.2,{scale:i},{easing:"backOut"}),t),Ve.runTweenAsync(R(this.glowOpacity.node).to(.2,{scale:i},{easing:"backOut"}),t)]),this.sprite.node.setScale(i),this.glowOpacity.node.setScale(i)})),function(e,t){return d.apply(this,arguments)})},{key:"startShaking",value:function(){var e=this,t=this.node.position.clone();this.shakingTween={ogPos:t,tw:R(this.node).to(.1,{},{onUpdate:function(n,i){if(i){var a=t.x+10*(i-.5);e.node.position=new V(a,t.y,t.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(c=o((function*(e){var t=this.sprite.node.scale.clone().multiplyScalar(1.1);yield Promise.all([Ve.runTweenAsync(R(this.sprite.node).to(.2,{scale:t},{easing:"cubicInOut"}),e),Ve.runTweenAsync(R(this.glowOpacity.node).to(.2,{scale:t}),e),Ve.runTweenAsync(R(this.glowOpacity).to(.5,{opacity:255}),e)])})),function(e){return c.apply(this,arguments)})},{key:"explode",value:(u=o((function*(e){var t=this,n=new V(8,8,8),i=function(){var i=o((function*(){t.circle.opacity=255,t.circle.node.setScale(V.ZERO),yield Promise.all([Ve.runTweenAsync(R(t.circle).to(.3,{opacity:0}),e),Ve.runTweenAsync(R(t.circle.node).to(.3,{scale:n},{easing:"cubicOut"}),e)]),t.circle.opacity=0,t.circle.node.scale=n}));return function(){return i.apply(this,arguments)}}(),a=function(){var n=o((function*(){yield Promise.all([Ve.runTweenAsync(R(t.glowOpacity.node).to(.3,{scale:V.ZERO},{easing:"cubicOut"}),e),Ve.runTweenAsync(R(t.sprite.node).to(.3,{scale:V.ZERO},{easing:"cubicOut"}),e)]),t.sprite.node.setScale(V.ZERO),t.glowOpacity.node.setScale(V.ZERO)}));return function(){return n.apply(this,arguments)}}();yield Promise.all([this.explodeParticles(e),i(),a()])})),function(e){return u.apply(this,arguments)})},{key:"explodeParticles",value:(s=o((function*(e){e.aborted||(this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),yield Ve.waitTweenAsync(1),this.explosionParticles.node.active=!1)})),function(e){return s.apply(this,arguments)})}]),y}(T)).prototype,"sprite",[fue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iue=a(Oue.prototype,"glowOpacity",[gue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rue=a(Oue.prototype,"explosionParticles",[mue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_ue=a(Oue.prototype,"circle",[bue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Due=a(Oue.prototype,"uiOpacity",[wue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(Oue.prototype,"startingOffsetX",[Sue],Object.getOwnPropertyDescriptor(Oue.prototype,"startingOffsetX"),Oue.prototype),a(Oue.prototype,"startingOffsetY",[kue],Object.getOwnPropertyDescriptor(Oue.prototype,"startingOffsetY"),Oue.prototype),Mue=a(Oue.prototype,"endingOffsetX",[Cue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Nue=a(Oue.prototype,"endingOffsetY",[Eue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bue=a(Oue.prototype,"startingScale",[Aue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Fue=a(Oue.prototype,"endingScale",[Tue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Pue=Oue))||Pue);S._RF.pop(),S._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var Cce,Ece,Ace,Tce,Pce,Oce,Lce,Ice,Rce=C.ccclass,_ce=C.property,Dce=C.requireComponent,Mce=Ludex.Events,Nce=codex,Bce=Nce.event,Fce=Nce.player;ece=Rce("StarChestScreen"),tce=Dce(q7),nce=_ce(y$),ice=_ce(G),ace=_ce(G),oce=_ce(ce),rce=_ce(kce),lce=_ce(B),sce=_ce(GG),uce=_ce(Kd),ece(cce=tce((hce=a((dce=function(a){n(p,a);var s,u,c,d,h=i(p);function p(){var e;t(this,p);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=h.call.apply(h,[this].concat(i)),r(e,"starProgressBar",hce,l(e)),r(e,"openButton",pce,l(e)),r(e,"continueButton",yce,l(e)),r(e,"chestAnimation",vce,l(e)),r(e,"starChest",fce,l(e)),r(e,"chestUnlockFXMask",gce,l(e)),r(e,"skipOverlay",mce,l(e)),r(e,"messageLabelLocalizer",bce,l(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(p,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Bce.on(Mce.OPENING_SCREEN,this.handleOpeningScreen),Bce.on(Mce.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Bce.off(Mce.OPENING_SCREEN,this.handleOpeningScreen),Bce.off(Mce.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(Es.HIDE_UI);var e=Fce.getGameData();if(e){var t=e.stars;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20);var n=this.numChestAvailable>0;this.setInteractableButtons(!0),this.openButton.node.active=n,this.openButton.interactable=n,this.continueButton.node.active=!n,this.continueButton.interactable=!n,this.messageLabelLocalizer.key=this.numChestAvailable?"reward.starChestAvailable":"reward.starChestUnavailable",this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){this.setInteractableButtons(!1),Bce.emit(Mce.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Es.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(d=o((function*(){if(0!==this.numChestAvailable){je.turnDownMusic();var e=Fce.getGameData();if(e){this.setInteractableButtons(!1);var t=e.stars;Fce.setGameData({stars:e.stars-20*this.numChestAvailable});var n=new In;yield this.skipOverlay.open({opacity:200,onSkip:function(){return n.abort()}}),yield this.handleUnlockAnimation(t,e.stars,n),yield this.skipOverlay.close(),je.turnUpMusic(),D.emit(kn),this.close()}}else this.close()})),function(){return d.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(c=o((function*(e,t,n){var i=this;yield Promise.all([this.starChest.moveToCenter(n),this.fadeInChestUnlockFX(n)]),this.chestAnimation.stop(),this.starChest.startShaking(),yield je.playSound(Qi.STAR_CHEST_DRUM_ROLL,{loop:!0}),yield Ve.waitTweenAsync(0);var a=e,o=this.numChestAvailable;yield Promise.all([this.starProgressBar.animateTo(t,n,(function(e){var t;a-e>=20&&(a=e,o--,i.starChest.scale((t=o,i.numChestAvailable>2?1-t/i.numChestAvailable:.35*(1-t/i.numChestAvailable)),n),je.playSound(Qi.STAR_CHEST_OPEN))}))]),yield Ve.waitTweenAsync(1,n),this.starChest.stopShaking(),yield this.starChest.glow(n),je.stopSound(Qi.STAR_CHEST_DRUM_ROLL);var r=hy*this.numChestAvailable;this.node.scene.emit(Es.ADD_COINS,{coins:r,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:n},skipAnimation:!0}),yield this.starChest.explode(n),yield Ve.waitTweenAsync(1,n),yield Promise.all([this.fadeOutChestUnlockFX(n)])})),function(e,t,n){return c.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(u=o((function*(e){this.chestUnlockFXMask.node.active=!0,yield Ve.runTweenAsync(R(this.chestUnlockFXMask).to(.5,{opacity:150}),e)})),function(e){return u.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(s=o((function*(e){yield Ve.runTweenAsync(R(this.chestUnlockFXMask).to(.3,{opacity:0}),e),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1})),function(e){return s.apply(this,arguments)})},{key:"setInteractableButtons",value:function(e){this.openButton.interactable=e,this.continueButton.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),p}(T)).prototype,"starProgressBar",[nce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pce=a(dce.prototype,"openButton",[ice],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yce=a(dce.prototype,"continueButton",[ace],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vce=a(dce.prototype,"chestAnimation",[oce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fce=a(dce.prototype,"starChest",[rce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gce=a(dce.prototype,"chestUnlockFXMask",[lce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mce=a(dce.prototype,"skipOverlay",[sce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bce=a(dce.prototype,"messageLabelLocalizer",[uce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cce=dce))||cce);S._RF.pop(),S._RF.push({},"2f7694kcVZNWq3iTCp1piqI","StartOverScreen",void 0);var xce,zce,Uce,Gce,Hce,qce=C.ccclass,Vce=C.property,$ce=C.requireComponent,Wce=Ludex.Events,Kce=codex,jce=Kce.event;Kce.player,Cce=qce("StartOverScreen"),Ece=$ce(q7),Ace=Vce(G),Tce=Vce(G),Cce(Pce=Ece((Lce=a((Oce=function(a){n(c,a);var s,u=i(c);function c(){var e;t(this,c);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),r(e,"restartButton",Lce,l(e)),r(e,"cancelButton",Ice,l(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.setInteractableButtons(!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return e(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ni.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jce.on(Wce.OPENING_SCREEN,this.handleOpeningScreen),jce.on(Wce.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jce.off(Wce.OPENING_SCREEN,this.handleOpeningScreen),jce.off(Wce.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(Es.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),rt.closeScreen(lt.START_OVER_SCREEN)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(e){this.restartButton.interactable=e,this.cancelButton.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"handleClickedCancel",value:function(){this.close(),this.node.scene.emit(Es.GAME_RESUME),this.node.scene.emit(Es.SHOW_UI)}},{key:"handleClickedRestart",value:(s=o((function*(){this.close(),this.node.scene.emit(Es.GAME_RESUME),this.node.scene.emit(Es.GAME_REPLAY)})),function(){return s.apply(this,arguments)})}]),c}(T)).prototype,"restartButton",[Ace],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ice=a(Oce.prototype,"cancelButton",[Tce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pce=Oce))||Pce);S._RF.pop(),S._RF.push({},"d6d78U+W5xDwqln9pXXQOaF","TopLeaders",void 0);var Yce=C.ccclass,Xce=C.property,Jce=(xce=Yce("TopLeaders"),zce=Xce(y3),xce((Hce=a((Gce=function(a){n(d,a);var s,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"topLeaders",Hce,l(e)),e.leaderData=[],e}return e(d,[{key:"updateData",value:function(e){var t=this;this.leaderData=e.slice(0,3),this.leaderData.slice(0,3).forEach((function(e,n){t.topLeaders[n].updateInfo({playerId:e.playerId,name:e.name,photo:e.photo,score:e.score})}))}},{key:"playShowLeadersAnimation",value:(s=o((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,i=.3;yield Promise.all(this.leaderData.map(function(){var a=o((function*(a,o){var r=t.topLeaders[o];yield r.runShowUpAnimation(o*n,i,e)}));return function(e,t){return a.apply(this,arguments)}}()))})),function(e){return s.apply(this,arguments)})},{key:"hideLeaders",value:function(){var e,t=u(this.topLeaders);try{for(t.s();!(e=t.n()).done;){e.value.setVisible(!1)}}catch(e){t.e(e)}finally{t.f()}}}]),d}(T)).prototype,"topLeaders",[zce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Uce=Gce))||Uce);S._RF.pop(),S._RF.push({},"c4670J4h0NFE5fCQacNQNsB","TournamentDetailOverlay",void 0);var Zce,Qce,ede,tde,nde,ide=Ludex.Utils,ade=(ide.Time,ide.Object),ode=function(){function n(e){var i=this;t(this,n),this.isScreenActive=!1,this.createLeaderboardDiv$=function(){i.leaderboardDiv$=document.createElement("div"),ade.assign(i.leaderboardDiv$.style,{position:"absolute",transform:"translate(-50%, -50%)",left:"50%",scrollbarWidth:"none",alignItems:"start",overflow:"auto",backgroundColor:"transparent",opacity:"0",transition:"opacity 0.3s ease-in-out",pointerEvents:"none",display:"none",userSelect:"none"}),document.body.appendChild(i.leaderboardDiv$)},this.createTopPlayerDiv$=function(){i.topPlayerDiv$=document.createElement("div"),ade.assign(i.topPlayerDiv$.style,{position:"absolute",transform:"translate(-50%, -50%)",left:"50%",scrollbarWidth:"none",alignItems:"start",overflow:"hidden",backgroundColor:"transparent",opacity:"0",transition:"opacity 0.3s ease-in-out",pointerEvents:"none",display:"none",userSelect:"none"}),document.body.appendChild(i.topPlayerDiv$)},this.updateTopPlayerElement$=function(){var e=o((function*(e){var t=e.tournamentPlayers.slice().sort((function(e,t){return e.rank-t.rank})).slice(0,3),n=s(s({},e),{},{tournamentPlayers:t,leaderboardPosition:e.leaderboardPosition,topPlayerPosition:e.topPlayerPosition});return i.topPlayerElement$?(yield i.topPlayerElement$.updateAsync(n),i.topPlayerElement$):yield BM.createOverlayViewAsync("overlays/tournament/top-player-overlay.xml",i.topPlayerDiv$,i.getTopPlayerIframeCss$(),"overlays/tournament/top-player-overlay-styles.css",n)}));return function(t){return e.apply(this,arguments)}}(),this.updateLeaderboardElement$=function(){var e=o((function*(e){if(i.leaderboardElement$){yield i.leaderboardElement$.updateAsync(e);var t=i.leaderboardElement$.getIFrameElement(),n=i.getLeaderboardIframeCss$(e);return t.style.cssText=n,i.leaderboardElement$}return yield BM.createOverlayViewAsync("overlays/tournament/leaderboard-overlay.xml",i.leaderboardDiv$,i.getLeaderboardIframeCss$(e),"overlays/tournament/leaderboard-overlay-styles.css",e)}));return function(t){return e.apply(this,arguments)}}(),this.isPayloadChanged$=function(e){if(!i.currentPayload$)return!0;if(i.currentPayload$.tournamentPlayers.length!==e.tournamentPlayers.length)return!0;for(var t=0;t<e.tournamentPlayers.length;t++){var n=i.currentPayload$.tournamentPlayers[t],a=e.tournamentPlayers[t];if(!n||!a)return!0;if(n.playerId!==a.playerId||n.rank!==a.rank||n.score!==a.score)return!0}return!1},this.showOverlay$=o((function*(){if(i.leaderboardElement$&&i.topPlayerElement$){var e=i.leaderboardElement$.showAsync(),t=i.topPlayerElement$.showAsync();yield Promise.all([e,t]),i.revealMainDivs$()}})),this.revealMainDivs$=function(){i.isScreenActive&&i.leaderboardElement$&&i.topPlayerElement$&&(ade.assign(i.leaderboardDiv$.style,{display:"block"}),i.leaderboardDiv$.scrollTop=0,ade.assign(i.topPlayerDiv$.style,{display:"block"}),requestAnimationFrame((function(){if(!i.isScreenActive)return i.leaderboardDiv$.style.display="none",void(i.topPlayerDiv$.style.display="none");ade.assign(i.leaderboardDiv$.style,{opacity:"1",pointerEvents:"auto"}),ade.assign(i.topPlayerDiv$.style,{opacity:"1",pointerEvents:"auto"})})))},this.validateOverlayPayload$=function(e){var t,n=s(s({},e),{},{tournamentPlayers:[]}),i=/^\d+$/,a=u(e.tournamentPlayers);try{for(a.s();!(t=a.n()).done;){var o=t.value;i.test(o.playerId)&&n.tournamentPlayers.push(o)}}catch(e){a.e(e)}finally{a.f()}return n},this.getLeaderboardIframeCss$=function(e){var t=e.tournamentPlayers,n=e.leaderboardPosition,a=i.getElementDivWidth$(n),o=t.length,r="height: calc((".concat(a,"px * (107 / 593) - 2px) * ").concat(o," + 15px);");return"".concat("width: 100%;"," ").concat("border-width: 0px;"," ").concat("overflow: hidden;"," ").concat("display: block;"," ").concat(r,"   ")},this.getTopPlayerIframeCss$=function(){return"".concat("width: 100%;"," ").concat("border-width: 0px;"," ").concat("overflow: hidden;"," ").concat("display: block;"," ").concat("height: 130%;"," ").concat("top: -23%;"," ").concat("position: absolute;")},this.getElementDivWidth$=function(e){return e.width*BM.getGameScaleFactor()},this.getElementDivHeight$=function(e){return e.height*BM.getGameScaleFactor()},this.getElementDivTopOffset$=function(e){return e.worldY*BM.getGameScaleFactor()},this.getElementDivLeftOffset$=function(e){return e.worldX*BM.getGameScaleFactor()},this.moveAndResizeOverlays$=function(e){var t=e.leaderboardPosition,n=e.topPlayerPosition;i.updateDivPosition$(i.leaderboardDiv$,t),i.updateDivPosition$(i.topPlayerDiv$,n)},this.updateDivPosition$=function(e,t){if(e){var n="".concat(i.getElementDivWidth$(t),"px"),a="".concat(i.getElementDivHeight$(t),"px"),o="".concat(i.getElementDivLeftOffset$(t),"px"),r="".concat(i.getElementDivTopOffset$(t),"px");ade.assign(e.style,{width:n,height:a,left:o,top:"calc(100vh - ".concat(r,")")})}},this.scene=e,this.createLeaderboardDiv$(),this.createTopPlayerDiv$()}var i,a;return e(n,[{key:"updateOverlay",value:(a=o((function*(e){try{if(!this.isScreenActive)return!1;var t=this.validateOverlayPayload$(e);if(this.moveAndResizeOverlays$(t),!this.isPayloadChanged$(t))return yield this.revealMainDivs$(),!0;this.topPlayerElement$=yield this.updateTopPlayerElement$(t),this.leaderboardElement$=yield this.updateLeaderboardElement$(t),this.currentPayload$=t,yield this.showOverlay$()}catch(e){return console.error("Error creating overlay view:",e),!1}return!0})),function(e){return a.apply(this,arguments)})},{key:"hideOverlay",value:(i=o((function*(){this.leaderboardElement$&&this.topPlayerElement$&&(ade.assign(this.leaderboardDiv$.style,{opacity:"0",pointerEvents:"none",display:"none"}),ade.assign(this.topPlayerDiv$.style,{opacity:"0",pointerEvents:"none",display:"none"}))})),function(){return i.apply(this,arguments)})},{key:"setIsScreenActive",value:function(e){this.isScreenActive=e}}]),n}();S._RF.pop(),S._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var rde,lde,sde,ude,cde,dde,hde,pde,yde,vde,fde,gde,mde,bde,wde,Sde,kde,Cde,Ede,Ade,Tde,Pde,Ode,Lde,Ide,Rde,_de,Dde,Mde,Nde,Bde,Fde,xde,zde,Ude,Gde,Hde,qde,Vde,$de,Wde,Kde,jde,Yde,Xde,Jde,Zde,Qde,ehe,the,nhe,ihe,ahe,ohe,rhe,lhe,she,uhe,che,dhe,hhe,phe,yhe,vhe,fhe,ghe,mhe,bhe,whe,She,khe=C.ccclass,Che=C.property,Ehe=(Zce=khe("TournamentLeaderSkeleton"),Qce=Che(q),Zce((nde=a((tde=function(a){n(d,a);var s,u,c=i(d);function d(){var e;t(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=c.call.apply(c,[this].concat(i)),r(e,"container",nde,l(e)),e}return e(d,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(B),this.validateRequiredComponents()}},{key:"hide",value:(u=o((function*(e){var t=this;yield Ve.runTweenAsync(R(this.uiOpacity).to(.2,{opacity:0}).call((function(){t.node.active=!1})),e)})),function(e){return u.apply(this,arguments)})},{key:"show",value:(s=o((function*(e,t){this.node.active=!0,this.node.scale=new V(.8,.8,.8),this.uiOpacity.opacity=0;var n=this.container.position.clone();this.container.position=new V(n.x,n.y-100,n.z);var i=R(this.node).delay(e);i.to(.2,{scale:V.ONE},{easing:"elasticOut"});var a=R(this.container).delay(e);a.to(.2,{position:n},{easing:"backOut"});var o=R(this.uiOpacity).delay(e);o.to(.2,{opacity:255},{easing:"cubicOut"}),yield Promise.all([Ve.runTweenAsync(i,t),Ve.runTweenAsync(a,t),Ve.runTweenAsync(o,t)]),this.node.scale=V.ONE,this.container.position=n,this.uiOpacity.opacity=255})),function(e,t){return s.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),d}(T)).prototype,"container",[Qce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ede=tde))||ede);S._RF.pop(),S._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var Ahe,The=C.ccclass,Phe=C.property,Ohe=C.requireComponent,Lhe=Ludex,Ihe=Lhe.Events,Rhe=Lhe.Utils,_he=Rhe.Object,Dhe=Rhe.Time,Mhe=Rhe.Number,Nhe=codex,Bhe=Nhe.event,Fhe=Nhe.storage,xhe=Nhe.player,zhe=Nhe.leaderboard,Uhe=Nhe.language,Ghe=1166;rde=The("TournamentDetailScreen"),lde=Ohe(q7),sde=Ni.required,ude=Ni.required,cde=Phe(K),dde=Ni.required,hde=Phe(Kd),pde=Ni.required,yde=Phe(Kd),vde=Ni.required,fde=Phe(Kd),gde=Ni.required,mde=Phe(j1),bde=Ni.required,wde=Phe(Jce),Sde=Ni.required,kde=Phe({type:q,group:"Buttons"}),Cde=Ni.required,Ede=Phe({type:q,group:"Buttons"}),Ade=Ni.required,Tde=Phe({type:q,group:"Buttons"}),Pde=Ni.required,Ode=Phe({type:q,group:"Buttons"}),Lde=Ni.required,Ide=Phe({type:_,group:"Buttons"}),Rde=Ni.required,_de=Phe({type:F}),Dde=Ni.required,Mde=Phe({type:q}),Nde=Ni.required,Bde=Phe({type:q}),Fde=Phe({type:[Ehe]}),xde=Phe({type:oT,group:"Confetti"}),zde=Phe({type:oT,group:"Confetti"}),Ude=Ni.required,Gde=Phe({type:P,group:"Container"}),Hde=Ni.required,qde=Phe({type:P,group:"Container"}),Vde=Ni.required,$de=Phe({type:q,group:"Container"}),Wde=Ni.onlyRunInLifeCycleAsync,Kde=Ni.onlyRunInLifeCycleAsync,jde=Ni.onlyRunInLifeCycleAsync,Yde=Ni.onlyRunInLifeCycleAsync,Xde=Ni.onlyRunInLifeCycleAsync,Jde=Ni.onlyRunInLifeCycle,Zde=Ni.onlyRunInLifeCycle,rde(Qde=lde((the=a((ehe=function(a){n(S,a);var c,d,h,p,y,v,f,g,b,w=i(S);function S(){var e;t(this,S);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return e=w.call.apply(w,[this].concat(i)),r(e,"screen",the,l(e)),r(e,"title",nhe,l(e)),r(e,"titleLocalizer",ihe,l(e)),r(e,"timeLocalizer",ahe,l(e)),r(e,"playerCountLocalizer",ohe,l(e)),r(e,"tournamentLeaders",rhe,l(e)),r(e,"topLeaders",lhe,l(e)),r(e,"playButton",she,l(e)),r(e,"continueButton",uhe,l(e)),r(e,"replayButton",che,l(e)),r(e,"logInButton",dhe,l(e)),r(e,"buttonsLayout",hhe,l(e)),r(e,"banner",phe,l(e)),r(e,"bannerLoadingRing",yhe,l(e)),r(e,"bannerMask",vhe,l(e)),r(e,"leaderSkeletons",fhe,l(e)),r(e,"leftConfetti",ghe,l(e)),r(e,"rightConfetti",mhe,l(e)),r(e,"container",bhe,l(e)),r(e,"tempContainer",whe,l(e)),r(e,"topPlayerOverlayRef",She,l(e)),e.signal$=new In,e.isOverlayMode$=!1,e.leadersPayload$=null,e.tournamentDetailOverlay$=null,e.listenScreenEvents$=function(){Bhe.on(Ihe.OPENING_SCREEN,e.handleOpeningScreen$),Bhe.on(Ihe.OPENED_SCREEN,e.handleOpenedScreen$)},e.unListenScreenEvents$=function(){Bhe.off(Ihe.OPENING_SCREEN,e.handleOpeningScreen$),Bhe.off(Ihe.OPENED_SCREEN,e.handleOpenedScreen$)},e.handleOpeningScreen$=function(t){if(!e.screen)throw new Error("TournamentDetailScreen: screen not found");e.validateEventPayload$(t)&&(e.enabled=!0)},e.handleOpenedScreen$=function(t){e.validateEventPayload$(t)&&e.open()},e.validateEventPayload$=function(t){return(null!=t?t:{}).screenName===e.node.name&&(e.payload$=t,!0)},e.cleanup$=function(){var t;null===(t=e.signal$)||void 0===t||t.abort(),e.signal$=new In,e.tournamentLeaders.hideLeaders(),e.topLeaders.hideLeaders(),e.cleanupOverlay$()},e.cleanupOverlay$=function(){var t;null===(t=e.tournamentDetailOverlay$)||void 0===t||t.hideOverlay()},e.handleOverlayMode$=function(){var t=o((function*(t){return!!e.leadersPayload$&&new Promise((function(n){t.call((function(){e.updateOverlay$().then((function(t){e.isOverlayMode$=t,n(t)}))}))}))}));return function(e){return t.apply(this,arguments)}}(),e.updateOverlay$=o((function*(){var t;if(!e.leadersPayload$||!e.tournamentDetailOverlay$)return!1;var n=null!==(t=e.leadersPayload$.leaders)&&void 0!==t?t:[];n.sort((function(e,t){return e.rank-t.rank}));var i=n.map((function(e){return{playerId:e.playerId,rank:e.rank,score:e.score}})),a=yield e.tournamentDetailOverlay$.updateOverlay({tournamentPlayers:i,leaderboardPosition:e.getLeaderboardPosition$(),topPlayerPosition:e.getTopPlayerPosition$(),currentPlayerId:xhe.getPlayerId()});return null!=a&&a})),e.updateContainer$=o((function*(){var t=e.tempContainer.height;e.container.node.position=e.tempContainer.node.position.clone(),t<Ghe&&e.container.height!==t?(e.container.height=t,ne.instance.emit("canvas-resize")):t>Ghe&&e.container.height<Ghe&&(e.container.height=Ghe,ne.instance.emit("canvas-resize"))})),e.updateTitleWithPlayerName$=function(t){void 0!==t&&(e.titleLocalizer.enabled=!0,e.titleLocalizer.setParams([t]))},e.updateTitleTournamentTitle$=function(t){e.titleLocalizer.enabled=!1,e.title.string=t},e.updateEndTime$=function(t){try{var n=Dhe.getRelativeTime(t,Uhe.getCurrentLocale(),{style:"short"});e.timeLocalizer.key="game.endsIn",e.timeLocalizer.setParams([n])}catch(t){e.timeLocalizer.key="game.endsSoon"}},e.updateTournamentBanner$=function(){var t=o((function*(t,n){e.banner.spriteFrame=null;var i=qe.getAsset("".concat(gt[t],"/spriteFrame"),ue);i||(e.bannerMask.active=!0,e.bannerLoadingRing.active=!0,i=yield qe.loadThemeTournamentAsync(t)),i||(i=yield qe.loadThemeTournamentAsync(pt.SUMMER)),e.banner&&i&&!n.aborted&&(e.banner.spriteFrame=i,e.bannerMask.active=!1,e.bannerLoadingRing.active=!1)}));return function(e,n){return t.apply(this,arguments)}}(),e.setPlayerCountWaiting$=function(){e.playerCountLocalizer.key="status.loading"},e.updateButtonVisibility$=function(){var t,n;if(e.playButton.active=!1,e.continueButton.active=!1,e.replayButton.active=!1,e.logInButton.active=!1,GameSDK.extra.isGuest)e.logInButton.active=!0;else{var i=(null!==(t=null===(n=e.payload$)||void 0===n?void 0:n.screenData)&&void 0!==t?t:{}).tournamentContextType;switch(void 0===i?"tournament_start":i){case"tournament_end":var a,o,r=(null!==(a=null===(o=xhe.getGameData())||void 0===o?void 0:o.tournamentProgress[e.tournamentPayload$.id])&&void 0!==a?a:{}).replayCount,l=void 0===r?0:r;e.continueButton.active=l>1,e.replayButton.active=!0,e.buttonsLayout.updateLayout(!0);break;case"tournament_start":e.playButton.active=!0}}},e.getLeadersPayload$=function(){var e=o((function*(e){var t=zhe.getLeaderboardName(e);if(!t)return null;var n=yield fD.getAllLeaderboardAsync(e);if(!n)return null;var i,a=_he.vals(n.leaders),o=xhe.getPlayerId(),r={leaders:[],amountPlayer:n.amountPlayer},l=u(a);try{for(l.s();!(i=l.n()).done;){var s=i.value;s.playerId===o?(r.player=s,r.leaders.push(s)):r.leaders.push(s)}}catch(e){l.e(e)}finally{l.f()}if(!r.player){var c=(yield zhe.getLeadersByPlayerIdsAsync(t,[o]))[0];c&&(r.player=c,r.leaders.push(c))}return r}));return function(t){return e.apply(this,arguments)}}(),e.processPlayTournament$=function(){var t=o((function*(t){var n=e.tournamentPayload$.id||"",i=st.validateTournamentExpired(n);if(st.syncTournamentProgress(),i)return e.close(),e.node.scene.emit(Py.RELOAD_TOURNAMENT),void rt.showNotificationScreenWithLocalizedKey("error.tourEnded",2);var a=t.level,o=t.score,r=t.replay;try{rt.showLoadingScreen(),yield Xy.setMatchCustomDataAsync({level:a,score:o}),yield e.processJoinTournament$(a),r&&e.increaseTournamentReplayCount$()}catch(t){if(_he.hasOwn(t,"code")&&"USER_INPUT"===t.code)return;try{yield e.processContinueTournament$(a),r&&e.increaseTournamentReplayCount$()}catch(e){if(_he.hasOwn(e,"code")&&"USER_INPUT"===e.code)return;console.error("processPlayButtonPressed",e),rt.showNotificationScreenWithLocalizedKey("error.tourJoinFail",2)}}finally{rt.closeLoadingScreen()}}));return function(e){return t.apply(this,arguments)}}(),e.processJoinTournament$=o((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{var n=e.tournamentPayload$.id||"";yield Xy.joinTournamentAsync(n),ct.switchToGameScene({level:t})}catch(e){throw console.warn("processJoinTournament",e),e}})),e.processContinueTournament$=o((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;try{var t,n=null!==(t=GameSDK.context.getID())&&void 0!==t?t:"";yield Xy.continueTournamentAsync(n),ct.switchToGameScene({level:e})}catch(e){throw console.warn("processContinueTournament",e),e}})),e.increaseTournamentReplayCount$=function(){var e,t,n=(null!==(e=Xy.getMatchCustomData())&&void 0!==e?e:{}).tournamentId;if(n){var i=xhe.getGameData();if(i){var a=i.tournamentProgress,o=(null!==(t=a[n])&&void 0!==t?t:{}).replayCount,r=void 0===o?0:o;xhe.setGameData({tournamentProgress:m({},n,s(s({level:1,score:0},a[n]),{},{replayCount:r+1}))})}}},e.setInteractableButtons$=function(t){e.screen.backgroundMaskButton.interactable=t},e.createTournamentOverlay$=function(){try{BM.isOverlayViewAPIAvailable(GameSDK),e.isOverlayMode$=!0,e.tournamentDetailOverlay$=new ode(e.node.scene)}catch(e){return}},e.getLeaderboardPosition$=function(){var t=e.tournamentLeaders.getComponent(P);if(!t)return{worldX:0,worldY:0,width:0,height:0};var n=t.width,i=t.height,a=e.tournamentLeaders.node;return{worldX:a.worldPositionX,worldY:a.worldPositionY,width:n,height:i}},e.getTopPlayerPosition$=function(){var t=e.topPlayerOverlayRef.getComponent(P);if(!t)return{worldX:0,worldY:0,width:0,height:0};var n=t.width,i=t.height,a=e.topPlayerOverlayRef;return{worldX:a.worldPositionX,worldY:a.worldPositionY,width:n,height:i}},e.updateOverlayScreenStatus$=function(t){var n;null===(n=e.tournamentDetailOverlay$)||void 0===n||n.setIsScreenActive(t)},e}return e(S,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(q7),Ni.validateRequiredProperties(this,S),this.listenScreenEvents$(),this.createTournamentOverlay$()}},{key:"onDestroy",value:function(){this.signal$.abort(),this.unListenScreenEvents$(),this.cleanupOverlay$()}},{key:"open",value:function(){this.updateContainer$(),this.updateInfo(),this.updateOverlayScreenStatus$(!0),this.setInteractableButtons$(!0),this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders(),this.updateButtonVisibility$(),this.setPlayerCountWaiting$(),this.node.scene.emit(Es.HIDE_UI)}},{key:"close",value:function(){rt.closeTournamentDetailScreen(),this.setInteractableButtons$(!1),this.tournamentLeaders.scrollView.unlistenEvents(),this.updateOverlayScreenStatus$(!1),this.node.scene.emit(Es.SHOW_UI),this.cleanup$()}},{key:"updateInfo",value:(b=o((function*(){var e,t,n,i,a,o,r=this,l=this.signal$,s=null===(e=this.payload$)||void 0===e||null===(e=e.screenData)||void 0===e?void 0:e.tournament;if(s){var u=null===(t=null===(n=this.payload$.screenData)||void 0===n?void 0:n.playAnimation)||void 0===t||t,c=JSON.parse(s);c.id=c.id.toString(),this.tournamentPayload$=c;var d=this.tournamentPayload$,h=d.endTime,p=d.payload,y=d.title,v=d.tournamentType,f=p.leaderboardId,g=void 0===f?"":f,m=p.themeId,b=void 0===m?pt.AUTUMN:m,w=p.playerName;"PAGE_HOSTED"===v?this.updateTitleTournamentTitle$(y):this.updateTitleWithPlayerName$(null!=w?w:y),this.updateEndTime$(h),this.updateTournamentBanner$(b,l);var S=Fhe.getStorage("tournament"),k=S.previousScore,C=S.animateTournamentLeader;if(Fhe.setStorageData("tournament","animateTournamentLeader",!1),yield this.showLoading(l),yield this.loadLeaders(g),!this.leadersPayload$||0===this.leadersPayload$.leaders.length||l.aborted)return this.updatePlayerCount(0),void(yield this.hideLoading(l));var E=this.leadersPayload$,A=E.player,T=E.amountPlayer,P=null!==(i=this.leadersPayload$.leaders)&&void 0!==i?i:[];if(P.sort((function(e,t){return e.rank-t.rank})),yield this.hideLoading(l),this.isOverlayMode$&&(yield this.handleOverlayMode$(l)))return;if(this.topLeaders&&this.tournamentLeaders&&!l.aborted){this.updatePlayerCount(T),this.topLeaders.updateData(P),this.topLeaders.playShowLeadersAnimation(l);var O=null!==(a=null==A?void 0:A.score)&&void 0!==a?a:0,L=null!==(o=null==A?void 0:A.rank)&&void 0!==o?o:0,I=C&&-1!==k&&k<O;this.tournamentLeaders.updateData(P);var R=!1;A&&I&&(R=this.tournamentLeaders.updateDisplayPlayerLeaderForRankChanging(k,O,L)),this.tournamentLeaders.initScrollViews(),this.tournamentLeaders.scrollView.scrollView.enabled=!0,yield l.callAsync((function(e){return r.runShowUpAnimation(e,u)})),C&&R&&-1!==k&&this.tournamentLeaders&&(yield l.callAsync((function(e){return r.tournamentLeaders.playRankChangeAnimation(e,k,O,L)})),this.tryPlayConfettiEffect(L))}}})),function(){return b.apply(this,arguments)})},{key:"loadLeaders",value:(g=o((function*(e){this.leadersPayload$=yield this.getLeadersPayload$(e)})),function(e){return g.apply(this,arguments)})},{key:"showLoading",value:(f=o((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isOverlayMode$?this.cleanupOverlay$():yield Promise.all([this.tournamentLeaders.scrollView.unlistenEvents(),this.tournamentLeaders.scrollView.scrollToTop(e,.1).then((function(){t.tournamentLeaders.scrollView.scrollView.enabled=!1,t.tournamentLeaders.scrollView.listenEvents()})),this.leaderSkeletons.map((function(t,i){return t.show(i*n,e)}))])})),function(e){return f.apply(this,arguments)})},{key:"hideLoading",value:(v=o((function*(e){this.isOverlayMode$||(yield Promise.all(this.leaderSkeletons.map((function(t){return t.hide(e)}))))})),function(e){return v.apply(this,arguments)})},{key:"runShowUpAnimation",value:(y=o((function*(e){var t,n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=i?0:.1;yield null===(t=this.tournamentLeaders)||void 0===t?void 0:t.playShowLeadersAnimation(e,a),yield null===(n=this.tournamentLeaders)||void 0===n?void 0:n.scrollToPlayerLeader(1.5,e)})),function(e){return y.apply(this,arguments)})},{key:"tryPlayConfettiEffect",value:function(e){if(!(e>10)){var t=Je.isLandscape(),n=t?50:30,i=t?5e3:2e3,a=t?15e3:1e4,o=t?40:60,r=t?110:100,l=t?30:20;this.leftConfetti.bursts[0].count=this.rightConfetti.bursts[0].count=n,this.leftConfetti.startSpeed.constantMin=this.rightConfetti.startSpeed.constantMin=i,this.leftConfetti.startSpeed.constantMax=this.rightConfetti.startSpeed.constantMax=a,this.leftConfetti.shapeModule.angle=o,this.rightConfetti.shapeModule.angle=r,this.leftConfetti.shapeModule.arc=this.rightConfetti.shapeModule.arc=l,this.leftConfetti.play(),this.rightConfetti.play(),je.playSound(Qi.LEADERBOARD_TRIUMPH)}}},{key:"updatePlayerCount",value:function(e){var t=Mhe.getShortNumber(e,3);1===e?this.playerCountLocalizer.key="game.player":(this.playerCountLocalizer.key="game.nPlayers",this.playerCountLocalizer.setParams([t]))}},{key:"handleOnLogIn",value:(p=o((function*(){try{if(!("initPlayerAsync"in GameSDK.player))return;if(rt.showLoadingScreen(),yield GameSDK.player.initPlayerAsync(),rt.closeLoadingScreen(),GameSDK.extra.isGuest)return void rt.showNotificationScreenWithLocalizedKey("error.login",1)}catch(e){rt.closeLoadingScreen(),rt.showNotificationScreenWithLocalizedKey("error.login",1)}})),function(){return p.apply(this,arguments)})},{key:"handleOnPlay",value:(h=o((function*(){GameSDK.isGameSDK("Yandex")&&(yield ut.showInterstitialAdAsync()),yield this.processPlayTournament$({level:1,score:0,replay:!1})})),function(){return h.apply(this,arguments)})},{key:"handleOnReplay",value:(d=o((function*(){GameSDK.isGameSDK("Yandex")&&(yield ut.showInterstitialAdAsync()),yield this.processPlayTournament$({level:1,score:0,replay:!0})})),function(){return d.apply(this,arguments)})},{key:"handleOnContinue",value:(c=o((function*(){var e,t;if(yield ut.showRewardVideoAdAsync()){var n=null!==(e=null===(t=xhe.getGameData())||void 0===t?void 0:t.tournamentProgress[this.tournamentPayload$.id])&&void 0!==e?e:{},i=n.level,a=void 0===i?1:i,o=n.score,r=void 0===o?0:o,l=a>1?Math.floor(a/2):1,s=Math.floor(r/2);yield this.processPlayTournament$({level:l,score:s,replay:!1})}})),function(){return c.apply(this,arguments)})}]),S}(T)).prototype,"screen",[sde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nhe=a(ehe.prototype,"title",[ude,cde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ihe=a(ehe.prototype,"titleLocalizer",[dde,hde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ahe=a(ehe.prototype,"timeLocalizer",[pde,yde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ohe=a(ehe.prototype,"playerCountLocalizer",[vde,fde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rhe=a(ehe.prototype,"tournamentLeaders",[gde,mde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lhe=a(ehe.prototype,"topLeaders",[bde,wde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),she=a(ehe.prototype,"playButton",[Sde,kde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uhe=a(ehe.prototype,"continueButton",[Cde,Ede],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),che=a(ehe.prototype,"replayButton",[Ade,Tde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dhe=a(ehe.prototype,"logInButton",[Pde,Ode],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hhe=a(ehe.prototype,"buttonsLayout",[Lde,Ide],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),phe=a(ehe.prototype,"banner",[Rde,_de],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yhe=a(ehe.prototype,"bannerLoadingRing",[Dde,Mde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vhe=a(ehe.prototype,"bannerMask",[Nde,Bde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fhe=a(ehe.prototype,"leaderSkeletons",[Fde],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ghe=a(ehe.prototype,"leftConfetti",[xde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mhe=a(ehe.prototype,"rightConfetti",[zde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bhe=a(ehe.prototype,"container",[Ude,Gde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),whe=a(ehe.prototype,"tempContainer",[Hde,qde],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),She=a(ehe.prototype,"topPlayerOverlayRef",[Vde,$de],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a(ehe.prototype,"updateInfo",[Wde],Object.getOwnPropertyDescriptor(ehe.prototype,"updateInfo"),ehe.prototype),a(ehe.prototype,"loadLeaders",[Kde],Object.getOwnPropertyDescriptor(ehe.prototype,"loadLeaders"),ehe.prototype),a(ehe.prototype,"showLoading",[jde],Object.getOwnPropertyDescriptor(ehe.prototype,"showLoading"),ehe.prototype),a(ehe.prototype,"hideLoading",[Yde],Object.getOwnPropertyDescriptor(ehe.prototype,"hideLoading"),ehe.prototype),a(ehe.prototype,"runShowUpAnimation",[Xde],Object.getOwnPropertyDescriptor(ehe.prototype,"runShowUpAnimation"),ehe.prototype),a(ehe.prototype,"tryPlayConfettiEffect",[Jde],Object.getOwnPropertyDescriptor(ehe.prototype,"tryPlayConfettiEffect"),ehe.prototype),a(ehe.prototype,"updatePlayerCount",[Zde],Object.getOwnPropertyDescriptor(ehe.prototype,"updatePlayerCount"),ehe.prototype),Qde=ehe))||Qde);S._RF.pop(),S._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,C.ccclass)("TournamentLeader")(Ahe=function(a){n(r,a);var o=i(r);function r(){return t(this,r),o.apply(this,arguments)}return e(r)}(q1));S._RF.pop(),S._RF.push({},"88f2b4WH6NBlaGD7WvCOA2j","VibrateUtils",void 0);Ludex.Utils.Browser,codex.player;S._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});