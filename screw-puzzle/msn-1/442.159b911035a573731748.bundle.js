"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[442],{624:function(e,t,n){n.r(t);var s=n(68),a=n(14),i=n(56),r=n.n(i),c=n(455),u=n.n(c),o=n(47),l=n.n(o),h=n(101),d=n(619),p=GameCore.Utils.Object,f=GameCore.Ads,A=f.Types,y=f.Status,I="msgames",m=function(e){function t(t,n){var s;return(s=e.call(this,t)||this).instance=void 0,s.placementId=void 0,s.instanceLoadFailedQueue=void 0,s.isHasTooManyInstancesError=void 0,s.instance=null,s.placementId=n,s.instanceLoadFailedQueue=[],s.isHasTooManyInstancesError=!1,s}(0,a.Z)(t,e),t.setGame=function(e){self.game=e};var n=t.prototype;return n.loadAsync=function(){var e=(0,s.Z)(l().mark((function e(){var t,n,s;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status===y.IDLE){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.status=y.LOADING,e.next=6,this.createInstanceByType(this.type);case 6:if(this.instance=e.sent,null!==this.instance){e.next=9;break}throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");case 9:return e.next=11,this.instance.loadAsync();case 11:this.status=y.FILLED,t=this.getSceneName(),this.type===A.PRE_ROLL&&self.game.analytics.loadPreRollAd(t,I),this.type===A.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(t,I),this.type===A.REWARDED&&self.game.analytics.loadRewardedVideoAd(t,I),e.next=25;break;case 18:throw e.prev=18,e.t0=e.catch(2),this.status=y.IDLE,this.instance&&this.instanceLoadFailedQueue.push(this.instance),this.instance=null,this.isAdTypeValid(this.type)&&(n=this.getSceneName(),s={type:this.type,placement:n,adService:I},self.game.analytics.loadAdFail(s)),e.t0;case 25:case"end":return e.stop()}}),e,this,[[2,18]])})));return function(){return e.apply(this,arguments)}}(),n.showAsync=function(){var e=(0,s.Z)(l().mark((function e(){var t,n,s,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!1,null,e.prev=2,this.status===y.FILLED){e.next=5;break}throw new GameCore.Ads.AdError("AD_NOT_FILLED","Ads no fill.");case 5:if(this.status=y.SHOWING,null!==this.instance){e.next=8;break}throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");case 8:return this.isHasTooManyInstancesError&&self.game.analytics.event(h._.MISSING_AD_SHOW,{ad_type:this.type}),e.next=11,this.instance.showAsync();case 11:t=!0,this.status=y.IDLE,this.instance=null,e.next=21;break;case 16:throw e.prev=16,e.t0=e.catch(2),e.t0 instanceof Object&&p.hasOwn(e.t0,"code")?("ADS_NOT_LOADED"===e.t0.code?this.status=y.FILLED:(this.status=y.IDLE,this.instance=null),"USER_INPUT"===e.t0.code&&(this.status=y.IDLE,this.instance=null,t=!0)):(this.status=y.IDLE,this.instance=null),e.t0,e.t0;case 21:return e.prev=21,window.focus(),n=this.getSceneName(),t?(this.type===A.PRE_ROLL&&self.game.analytics.showPreRollAd(n,I),this.type===A.INTERSTITIAL&&self.game.analytics.showInterstitialAd(n,I),this.type===A.REWARDED&&self.game.analytics.showRewardedVideoAd(n,I)):this.isAdTypeValid(this.type)&&(s=this.getSceneName(),a={type:this.type,placement:s,adService:I},self.game.analytics.showAdFail(a)),e.finish(21);case 26:case"end":return e.stop()}}),e,this,[[2,16,21,26]])})));return function(){return e.apply(this,arguments)}}(),n.getStatus=function(){return this.status},n.createInstanceByType=function(){var e=(0,s.Z)(l().mark((function e(t){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=self.game.facebook,e.prev=1,e.t0=t,e.next=e.t0===A.REWARDED?5:e.t0===A.INTERSTITIAL||e.t0===A.PRE_ROLL?8:11;break;case 5:return e.next=7,n.getRewardedVideoAsync(this.placementId);case 7:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,n.getInterstitialAdAsync(this.placementId);case 11:case 20:return e.abrupt("return",null);case 12:e.next=21;break;case 14:if(e.prev=14,e.t1=e.catch(1),!(e.t1 instanceof Object&&p.hasOwn(e.t1,"code"))){e.next=20;break}if("ADS_TOO_MANY_INSTANCES"!==e.t1.code){e.next=20;break}return this.isHasTooManyInstancesError=!0,e.abrupt("return",this.instanceLoadFailedQueue.shift()||null);case 21:case"end":return e.stop()}}),e,this,[[1,14]])})));return function(t){return e.apply(this,arguments)}}(),n.getSceneName=function(){try{var e=self.game.globalScene;return e instanceof d.Z?e.getCurrentScene().scene.getSceneName():"unknown"}catch(t){return"unknown"}},n.isAdTypeValid=function(e){var t;return r()(t=u()(A)).call(t,e)},t}(GameCore.Ads.AdInstance);t.default=m}}]);