"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[131,442],{624:function(e,t,n){n.r(t);var r=n(68),a=n(14),s=n(56),i=n.n(s),c=n(455),o=n.n(c),u=n(47),d=n.n(u),l=n(101),p=n(619),h=GameCore.Utils.Object,f=GameCore.Ads,y=f.Types,m=f.Status,v="msgames",w=function(e){function t(t,n){var r;return(r=e.call(this,t)||this).instance=void 0,r.placementId=void 0,r.instanceLoadFailedQueue=void 0,r.isHasTooManyInstancesError=void 0,r.instance=null,r.placementId=n,r.instanceLoadFailedQueue=[],r.isHasTooManyInstancesError=!1,r}(0,a.Z)(t,e),t.setGame=function(e){self.game=e};var n=t.prototype;return n.loadAsync=function(){var e=(0,r.Z)(d().mark((function e(){var t,n,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.status===m.IDLE){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.status=m.LOADING,e.next=6,this.createInstanceByType(this.type);case 6:if(this.instance=e.sent,null!==this.instance){e.next=9;break}throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");case 9:return e.next=11,this.instance.loadAsync();case 11:this.status=m.FILLED,t=this.getSceneName(),this.type===y.PRE_ROLL&&self.game.analytics.loadPreRollAd(t,v),this.type===y.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(t,v),this.type===y.REWARDED&&self.game.analytics.loadRewardedVideoAd(t,v),e.next=25;break;case 18:throw e.prev=18,e.t0=e.catch(2),this.status=m.IDLE,this.instance&&this.instanceLoadFailedQueue.push(this.instance),this.instance=null,this.isAdTypeValid(this.type)&&(n=this.getSceneName(),r={type:this.type,placement:n,adService:v},self.game.analytics.loadAdFail(r)),e.t0;case 25:case"end":return e.stop()}}),e,this,[[2,18]])})));return function(){return e.apply(this,arguments)}}(),n.showAsync=function(){var e=(0,r.Z)(d().mark((function e(){var t,n,r,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!1,null,e.prev=2,this.status===m.FILLED){e.next=5;break}throw new GameCore.Ads.AdError("AD_NOT_FILLED","Ads no fill.");case 5:if(this.status=m.SHOWING,null!==this.instance){e.next=8;break}throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");case 8:return this.isHasTooManyInstancesError&&self.game.analytics.event(l._.MISSING_AD_SHOW,{ad_type:this.type}),e.next=11,this.instance.showAsync();case 11:t=!0,this.status=m.IDLE,this.instance=null,e.next=21;break;case 16:throw e.prev=16,e.t0=e.catch(2),e.t0 instanceof Object&&h.hasOwn(e.t0,"code")?("ADS_NOT_LOADED"===e.t0.code?this.status=m.FILLED:(this.status=m.IDLE,this.instance=null),"USER_INPUT"===e.t0.code&&(this.status=m.IDLE,this.instance=null,t=!0)):(this.status=m.IDLE,this.instance=null),e.t0,e.t0;case 21:return e.prev=21,window.focus(),n=this.getSceneName(),t?(this.type===y.PRE_ROLL&&self.game.analytics.showPreRollAd(n,v),this.type===y.INTERSTITIAL&&self.game.analytics.showInterstitialAd(n,v),this.type===y.REWARDED&&self.game.analytics.showRewardedVideoAd(n,v)):this.isAdTypeValid(this.type)&&(r=this.getSceneName(),a={type:this.type,placement:r,adService:v},self.game.analytics.showAdFail(a)),e.finish(21);case 26:case"end":return e.stop()}}),e,this,[[2,16,21,26]])})));return function(){return e.apply(this,arguments)}}(),n.getStatus=function(){return this.status},n.createInstanceByType=function(){var e=(0,r.Z)(d().mark((function e(t){var n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=self.game.facebook,e.prev=1,e.t0=t,e.next=e.t0===y.REWARDED?5:e.t0===y.INTERSTITIAL||e.t0===y.PRE_ROLL?8:11;break;case 5:return e.next=7,n.getRewardedVideoAsync(this.placementId);case 7:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,n.getInterstitialAdAsync(this.placementId);case 11:case 20:return e.abrupt("return",null);case 12:e.next=21;break;case 14:if(e.prev=14,e.t1=e.catch(1),!(e.t1 instanceof Object&&h.hasOwn(e.t1,"code"))){e.next=20;break}if("ADS_TOO_MANY_INSTANCES"!==e.t1.code){e.next=20;break}return this.isHasTooManyInstancesError=!0,e.abrupt("return",this.instanceLoadFailedQueue.shift()||null);case 21:case"end":return e.stop()}}),e,this,[[1,14]])})));return function(t){return e.apply(this,arguments)}}(),n.getSceneName=function(){try{var e=self.game.globalScene;return e instanceof p.Z?e.getCurrentScene().scene.getSceneName():"unknown"}catch(t){return"unknown"}},n.isAdTypeValid=function(e){var t;return i()(t=o()(y)).call(t,e)},t}(GameCore.Ads.AdInstance);t.default=w},634:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});var r=n(14),a=n(68),s=n(47),i=n.n(s),c=n(38),o=n.n(c),u=n(624),d='<div id="mockads"> <div style="color:#fff;display:flex;align-content:space-between;justify-content:space-between;flex-direction:column;flex-wrap:nowrap;position:absolute;width:100vw;height:100vh;top:0;left:0;font-family:sans-serif;background:#063b4d;background:linear-gradient(0deg,#063b4d 30%,#0e6171 100%)"> <div style="display:flex;height:6vh;background-color:#0b4d5b;flex-direction:row;justify-content:space-between;align-items:center;align-content:center;font-size:larger" id="ad-header"> <div style="width:80px;display:flex;align-items:center;justify-content:center;margin:0 10px;cursor:pointer" id="close-btn"> Close </div> <div style="width:80px;display:flex;align-items:center;justify-content:center;margin:0 10px;cursor:pointer" id="reward-btn"> Reward </div> </div> <div style="display:flex;flex-direction:column;flex-wrap:nowrap;align-content:center;justify-content:center;height:100%;align-items:center" id="ad-content"> <div style="display:flex;width:200px;height:50px;background-color:#1f7888;align-items:center;justify-content:center;border-radius:100vw;margin:10px;text-transform:uppercase"> <span>AD {AD_TYPE}</span> </div> <div style="background-color:#1f7888;display:flex;align-items:center;justify-content:center;width:80vw;border-radius:16px"> <img src="{AD_CONTENT}" style="position:relative;width:inherit;border-radius:6px"/> </div> </div> <div style="display:flex;height:3vh;flex-direction:row;justify-content:flex-start;align-items:center;background-color:#063f51" id="ad-footer"></div> </div> </div>',l=GameCore.Configs.Ads.Mockup,p=l.ErrorRate,h=l.GiphyApiKey,f=function(e){return function(t){t.preventDefault();var n=document.getElementById("popup-ads");null==n||n.remove(),e()}},y=function(){var e=(0,a.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new(o())((function(e,n){var r=new Image;r.onload=function(){return e()},r.onerror=function(){return n()},r.src=t})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){var e=(0,a.Z)(i().mark((function e(t,n,r,a){var s,c,o,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=d.markup||d,(c=document.createElement("div")).id="popup-ads",c.innerHTML=s.replace("{AD_TYPE}",t).replace("{AD_CONTENT}",n),document.body.appendChild(c),(o=document.getElementById("close-btn"))&&(t===GameCore.Ads.Types.REWARDED?(o.innerHTML="Skip",o.onclick=f((function(){a({code:"USER_INPUT",message:"Skip ads mock error"})}))):o.onclick=f(r)),(u=document.getElementById("reward-btn"))&&(t===GameCore.Ads.Types.REWARDED?u.onclick=f(r):u.remove());case 9:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),v=function(){function e(e){this.type=void 0,this.adContent=void 0,this.apiAdContent=void 0,this.loadTimer=void 0,this.showTimer=void 0,this.type=e,this.adContent="",this.apiAdContent="https://api.giphy.com/v1/gifs/trending?api_key="+h+"&rate=pg&bundle=low_bandwidth"}var t=e.prototype;return t.loadAsync=function(){var e=(0,a.Z)(i().mark((function e(){var t,n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Phaser.Math.RND.between(0,100)<=p){e.next=7;break}return e.next=4,this.getAdContentAsync();case 4:return this.adContent=e.sent,e.next=7,y(this.adContent);case 7:return e.abrupt("return",new(o())((function(e,r){clearTimeout(n.loadTimer),t?r({code:"NETWORK_FAILURE",message:"Load ads mock error"}):e()})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.showAsync=function(){var e=(0,a.Z)(i().mark((function e(){var t,n=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Phaser.Math.RND.between(0,100)<=p,e.abrupt("return",new(o())((function(e,r){t?r({code:"RATE_LIMITED",message:"Show ads mock error"}):m(n.type,n.adContent,e,r)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.getPlacementID=function(){return"123"},t.getAdContentAsync=function(){var e=(0,a.Z)(i().mark((function e(){var t,n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(this.apiAdContent,{method:"GET"});case 3:return t=e.sent,e.next=6,t.json();case 6:if(n=e.sent,GameCore.Utils.Valid.isObject(n)){e.next=9;break}return e.abrupt("return","");case 9:return r=n.data,a=Phaser.Math.RND.between(0,r.length-1),e.abrupt("return",r[a].images.downsized.url);case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return","assets/images/others/giphy-demo.gif");case 17:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),e}(),w=function(e){function t(){return e.apply(this,arguments)||this}return(0,r.Z)(t,e),t.prototype.createInstanceByType=function(){var e=(0,a.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new v(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t}(u.default),g=w}}]);