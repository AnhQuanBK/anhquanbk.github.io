"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[112],{635:function(e,t,n){n.r(t);var a,r=n(68),i=n(54),s=n(37),o=n(14),d=n(38),c=n.n(d),l=n(56),u=n.n(l),f=n(455),p=n.n(f),A=n(47),h=n.n(A),y=n(101),m=n(619),w=GameCore,g=w.Utils.Object,P=w.Ads,S=P.Types,v=P.Status,T="idle",I="loading",E="loaded",b="failed",k="google",R=function(e){function t(n,a){var r;return(r=e.call(this,n)||this).instance=void 0,r.instance=null,r.status=v.IDLE,t._initStatus||(t.initStatus=T),window.setInterstitialPlacementType=t.setInterstitialPlacementType,window.setRewardedPlacementType=t.setRewardedPlacementType,window.setPreRollPlacementType=t.setPreRollPlacementType,t.childAdInstances.push((0,s.Z)(r)),t.isPreloadConfigReady&&(r.status=v.FILLED),r}(0,o.Z)(t,e),t.initGoogleAdsAsync=function(){var e=(0,r.Z)(h().mark((function e(n){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("loaded"!==t.initStatus){e.next=3;break}return e.abrupt("return");case 3:t.initStatus=I,t.adsByGoogleConfig=n,t.loadScriptElementAsync(n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.configGoogleAdsOnInit=function(){var e=(0,r.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.adsbygoogle=window.adsbygoogle||[],window.adBreak=function(e){adsbygoogle.push(e)},window.adConfig=function(e){adsbygoogle.push(e)},t.initStatus=E,t.runPreloadAdConfig();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.runPreloadAdConfig=function(){var e=(0,r.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preloadPromise=new(c())((function(e,n){window.adConfig({preloadAdBreaks:"on",onReady:function(){t.isPreloadConfigReady=!0,t.handlePostPreloadAdComplete(),e()}}),setTimeout((function(){t.isPreloadConfigReady||n(new Error("Failed to preload ad config in time."))}),1e4)})),e.abrupt("return",t.preloadPromise);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.loadScriptElementAsync=function(e){return new(c())((function(n,a){!function(r){e.maxScriptLoadRetryCount;var i=document.createElement("script");try{t.assignAdsByGoogleScriptProperties(i,e)}catch(o){t.initStatus=b,a(new Error("Invalid adConfig."))}if(i.onload=function(){t.configGoogleAdsOnInit(),n(!0)},i.onerror=function(){t.initStatus=b,a(new Error("Failed to load Google Ads script."))},document.head.appendChild(i),!!!document.getElementById("adsByGoogleFunctionScript")){var s=document.createElement("script");s.text="window.adsbygoogle = window.adsbygoogle || []; var adBreak = adConfig = function(o) {adsbygoogle.push(o);}",s.id="adsByGoogleFunctionScript",document.head.appendChild(s)}}()}))},t.assignAdsByGoogleScriptProperties=function(e,t){var n=t.dataAdClient,a=t.dataAdHost,r=t.dataAdChannel,i=t.dataAdBreakTest,s=t.dataAdFrequencyHint;if(!n&&!a)throw new Error("dataAdClient or dataAdHost is required.");e.async=!0,e.setAttribute("data-ad-frequency-hint",s+"s"),n&&e.setAttribute("data-ad-client",n),r&&e.setAttribute("data-ad-channel",r),a&&e.setAttribute("data-ad-host",a),i&&e.setAttribute("data-adbreak-test","on");var o="";if(n||a){o="?";var d=[];n&&d.push("client="+n),a&&d.push("host="+a),o+=d.join("&")}e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"+o,e.crossOrigin="anonymous"};var n=t.prototype;return n.makeAdInstance=function(){var e=this;return{getPlacementID:function(){return""},loadAsync:function(){return e.preloadAdPlacement()},showAsync:function(){return e.createAdPlacement()}}},n.preloadAdPlacement=function(){return t.initStatus!==E?c().reject(new Error("Google Ads not initiated.")):t.isPreloadConfigReady?c().resolve():t.preloadPromise?t.preloadPromise:t.runPreloadAdConfig()},n.createAdPlacement=function(){switch(this.type){case S.PRE_ROLL:return this.createAdPlacementPreroll();case S.REWARDED:return this.createAdPlacementRewarded();case S.INTERSTITIAL:return this.createAdPlacementInterstitial();default:return c().reject(new GameCore.Ads.AdError("UNSUPPORTED_AD_TYPE","Unsupported."))}},n.createAdPlacementPreroll=function(){return new(c())((function(e,n){window.adBreak({type:t.preRollPlacementType,name:"prerollAd",adBreakDone:function(t){switch(t.breakStatus){case"dismissed":case"viewed":return void e();default:return void n(new GameCore.Ads.AdError(t.breakStatus,t.breakType))}}})}))},n.createAdPlacementInterstitial=function(){return new(c())((function(e,n){window.adBreak({type:t.interstitialPlacementType,name:"interstitialAd",beforeAd:function(){self.game.ads.hideBannerAdAsync()},adBreakDone:function(t){switch(self.game.ads.showBannerAdAsync(),t.breakStatus){case"dismissed":case"viewed":return void e();default:return void n(new GameCore.Ads.AdError(t.breakStatus,t.breakType))}}})}))},n.createAdPlacementRewarded=function(){return new(c())((function(e,n){window.adBreak({type:t.rewardedPlacementType,name:"rewardedAd",beforeReward:function(e){self.game.ads.hideBannerAdAsync(),e()},adViewed:function(){},adDismissed:function(){},adBreakDone:function(t){switch(self.game.ads.showBannerAdAsync(),t.breakStatus){case"dismissed":return void n(new GameCore.Ads.AdError("USER_INPUT","User dismissed."));case"viewed":return void e();default:return void n(new GameCore.Ads.AdError(t.breakStatus,t.breakType))}}})}))},t.setGame=function(e){self.game=e},n.getStatus=function(){return this.status},n.loadAsync=function(){var e=(0,r.Z)(h().mark((function e(){var t,n,a;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==this.instance){e.next=3;break}return e.abrupt("return");case 3:if(this.instance=this.makeAdInstance(),null!==this.instance){e.next=6;break}throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");case 6:return e.next=8,this.instance.loadAsync();case 8:t=this.getSceneName(),this.type===S.PRE_ROLL&&self.game.analytics.loadPreRollAd(t,k),this.type===S.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(t,k),this.type===S.REWARDED&&self.game.analytics.loadRewardedVideoAd(t,k),e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(0),this.isAdTypeValid(this.type)&&(n=this.getSceneName(),a={type:this.type,placement:n,adService:k},self.game.analytics.loadAdFail(a)),e.t0;case 18:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),n.showAsync=function(){var e=(0,r.Z)(h().mark((function e(){var t,n,a,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!1,e.prev=1,this.status===v.FILLED){e.next=4;break}throw new GameCore.Ads.AdError("AD_NOT_FILLED","Ads no fill.");case 4:if(this.status=v.SHOWING,null!==this.instance){e.next=8;break}return e.next=8,this.loadAsync();case 8:if(null!==this.instance){e.next=10;break}throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");case 10:return e.next=12,this.instance.showAsync();case 12:t=!0,this.handlePostShowAdStatus(),this.instance=null,e.next=27;break;case 17:if(e.prev=17,e.t0=e.catch(1),!(e.t0 instanceof Object&&g.hasOwn(e.t0,"code"))){e.next=24;break}if("noAdPreloaded"!==e.t0.code){e.next=22;break}return e.abrupt("return");case 22:"USER_INPUT"===e.t0.code&&(t=!0),"frequencyCapped"===e.t0.code&&self.game.analytics.event(y._.MISSING_AD_SHOW,{ad_type:this.type});case 24:throw this.handlePostShowAdStatus(),this.instance=null,e.t0;case 27:return e.prev=27,window.focus(),n=this.getSceneName(),t?(this.type===S.PRE_ROLL&&self.game.analytics.showPreRollAd(n,k),this.type===S.INTERSTITIAL&&self.game.analytics.showInterstitialAd(n,k),this.type===S.REWARDED&&self.game.analytics.showRewardedVideoAd(n,k)):this.isAdTypeValid(this.type)&&(a=this.getSceneName(),r={type:this.type,placement:a,adService:k},self.game.analytics.showAdFail(r)),e.finish(27);case 32:case"end":return e.stop()}}),e,this,[[1,17,27,32]])})));return function(){return e.apply(this,arguments)}}(),n.getSceneName=function(){try{var e=self.game.globalScene;return e instanceof m.Z?e.getCurrentScene().scene.getSceneName():"unknown"}catch(t){return"unknown"}},n.isAdTypeValid=function(e){var t;return u()(t=p()(S)).call(t,e)},n.handlePostShowAdStatus=function(){t.isPreloadConfigReady?this.status=v.FILLED:this.status=v.IDLE},t.handlePostPreloadAdComplete=function(){t.childAdInstances.forEach((function(e){e.status=v.FILLED}))},(0,i.Z)(t,null,[{key:"initStatus",get:function(){return t._initStatus},set:function(e){this._initStatus!==e&&(self.game.analytics.event(y._.AD_INIT,{ad_service:k,state:e}),this._initStatus=e)}}]),t}(GameCore.Ads.AdInstance);a=R,R.childAdInstances=[],R._initStatus=void 0,R.isPreloadConfigReady=!1,R.adsByGoogleConfig=void 0,R.preloadPromise=void 0,R.preRollPlacementType="preroll",R.interstitialPlacementType="next",R.rewardedPlacementType="reward",R.setInterstitialPlacementType=function(e){a.interstitialPlacementType=e},R.setRewardedPlacementType=function(e){a.rewardedPlacementType=e},R.setPreRollPlacementType=function(e){a.preRollPlacementType=e},t.default=R}}]);