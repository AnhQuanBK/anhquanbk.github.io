function _array_like_to_array(e,t){if(null==t||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function _assert_this_initialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _async_generator(e){var t,n;function send(e,r){return new Promise(function(a,o){var i={key:e,arg:r,resolve:a,reject:o,next:null};if(n)n=n.next=i;else t=n=i,resume(e,r)})}function resume(t,n){try{var r=e[t](n);var a=r.value;var o=a instanceof _await_value;Promise.resolve(o?a.wrapped:a).then(function(e){if(o){resume("next",e);return}settle(r.done?"return":"normal",e)},function(e){resume("throw",e)})}catch(e){settle("throw",e)}}function settle(e,r){switch(e){case"return":t.resolve({value:r,done:true});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:false});break}if(t=t.next)resume(t.key,t.arg);else n=null}if(this._invoke=send,"function"!=typeof e.return)this.return=void 0}if("function"==typeof Symbol&&Symbol.asyncIterator)_async_generator.prototype[Symbol.asyncIterator]=function(){return this};function _async_generator_delegate(e,t){var n={},r=false;function pump(n,a){return r=true,{done:false,value:t(a=new Promise(function(t){t(e[n](a))}))}}if("function"==typeof Symbol&&Symbol.iterator)n[Symbol.iterator]=function(){return this};if(n.next=function(e){if(r)return r=false,e;return pump("next",e)},"function"==typeof e.throw)n.throw=function(e){if(r)throw r=false,e;return pump("throw",e)};if("function"==typeof e.return)n.return=function(e){return pump("return",e)};return n}function _async_iterator(e){var t,n,r,a=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);a--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new AsyncFromSyncIterator(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(e){function AsyncFromSyncIteratorContinuation(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(AsyncFromSyncIterator=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return AsyncFromSyncIteratorContinuation(this.n.apply(this.s,arguments))},return:function(e){var t=this.s.return;return void 0===t?Promise.resolve({value:e,done:!0}):AsyncFromSyncIteratorContinuation(t.apply(this.s,arguments))},throw:function(e){var t=this.s.return;return void 0===t?Promise.reject(e):AsyncFromSyncIteratorContinuation(t.apply(this.s,arguments))}},new AsyncFromSyncIterator(e)}function asyncGeneratorStep(e,t,n,r,a,o,i){try{var u=e[o](i);var s=u.value}catch(e){n(e);return}if(u.done)t(s);else Promise.resolve(s).then(r,a)}function _async_to_generator(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function _next(e){asyncGeneratorStep(o,r,a,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(o,r,a,_next,_throw,"throw",e)}_next(void 0)})}}function _await_async_generator(e){return new _await_value(e)}function _await_value(e){this.wrapped=e}function _call_super(e,t,n){return t=_get_prototype_of(t),_possible_constructor_return(e,_is_native_reflect_construct()?Reflect.construct(t,n||[],_get_prototype_of(e).constructor):t.apply(e,n))}function _class_call_check(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r.enumerable=r.enumerable||false,r.configurable=true,"value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function _create_class(e,t,n){if(t)_defineProperties(e.prototype,t);if(n)_defineProperties(e,n);return e}function _define_property(e,t,n){if(t in e)Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true});else e[t]=n;return e}function _get_prototype_of(e){return(_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");if(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}}),t)_set_prototype_of(e,t)}function _instanceof(e,t){if(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance])return!!t[Symbol.hasInstance](e);return e instanceof t}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var o=[];var i=true;var u=false;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=true);}catch(e){u=true,r=e}finally{try{if(!i&&null!=a.return)a.return()}finally{if(u)throw r}}return o}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};var r=Object.keys(n);if("function"==typeof Object.getOwnPropertySymbols)r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}));r.forEach(function(t){_define_property(e,t,n[t])})}return e}function _possible_constructor_return(e,t){if(t&&("object"===_type_of(t)||"function"==typeof t))return t;return _assert_this_initialized(e)}function _set_prototype_of(e,t){return(_set_prototype_of=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,t){if(!e)return;if("string"==typeof e)return _array_like_to_array(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor)n=e.constructor.name;if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(e,t)}function _wrap_async_generator(e){return function(){return new _async_generator(e.apply(this,arguments))}}function _is_native_reflect_construct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_is_native_reflect_construct=function(){return!!e})()}function _ts_generator(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");while(i)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;if(r=0,a)o=[2&o[0],a.value];switch(o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:false};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}if(a[2])i.ops.pop();i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}function _ts_values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}_async_generator.prototype.next=function(e){return this._invoke("next",e)},_async_generator.prototype.throw=function(e){return this._invoke("throw",e)},_async_generator.prototype.return=function(e){return this._invoke("return",e)};var W=Object.defineProperty;var f=function(e,t,n){return function(e,t,n){return t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,(void 0===t?"undefined":_type_of(t))!="symbol"?t+"":t,n)};System.register(["./core.js"],function(e,t){"use strict";var n,r;return{setters:[function(e){n=e.P,r=e.G}],execute:function(){var t=e("d",{});e("e",Object.freeze(Object.defineProperty({__proto__:null,default:t},Symbol.toStringTag,{value:"Module"}))),"stream"in Blob.prototype||Object.defineProperty(Blob.prototype,"stream",{value:function(){return new Response(this).body}}),"setBigUint64"in DataView.prototype||Object.defineProperty(DataView.prototype,"setBigUint64",{value:function(e,t,n){var r=Number(4294967295n&t),a=Number(t>>32n);this.setUint32(e+(n?0:4),r,n),this.setUint32(e+(n?4:0),a,n)}});var U=function(e){return new DataView(new ArrayBuffer(e))},h=function(e){return new Uint8Array(e.buffer||e)},v=function(e){return new TextEncoder().encode(String(e))},w=function(e){return Math.min(0xffffffff,Number(e))},S=function(e){return Math.min(65535,Number(e))};function E(e,t){if(void 0===t||_instanceof(t,Date)||(t=new Date(t)),_instanceof(e,File))return{isFile:1,t:t||new Date(e.lastModified),i:e.stream()};if(_instanceof(e,Response))return{isFile:1,t:t||new Date(e.headers.get("Last-Modified")||Date.now()),i:e.body};if(void 0===t)t=new Date;else if(isNaN(t))throw new Error("Invalid modification date.");if(void 0===e)return{isFile:0,t:t};if("string"==typeof e)return{isFile:1,t:t,i:v(e)};if(_instanceof(e,Blob))return{isFile:1,t:t,i:e.stream()};if(_instanceof(e,Uint8Array)||_instanceof(e,ReadableStream))return{isFile:1,t:t,i:e};if(_instanceof(e,ArrayBuffer)||ArrayBuffer.isView(e))return{isFile:1,t:t,i:h(e)};if(Symbol.asyncIterator in e)return{isFile:1,t:t,i:T(e[Symbol.asyncIterator]())};throw new TypeError("Unsupported input format.")}function T(e,t){var n=arguments.length>1&&void 0!==t?t:e;return new ReadableStream({pull:function(t){return _async_to_generator(function(){var n,r,a;return _ts_generator(this,function(o){switch(o.label){case 0:n=0,o.label=1;case 1:if(!(t.desiredSize>n))return[3,4];return[4,e.next()];case 2:if(!(r=o.sent()).value)return t.close(),[3,4];a=O(r.value),t.enqueue(a),n+=a.byteLength,o.label=3;case 3:return[3,1];case 4:return[2]}})})()},cancel:function(e){var t;null==(t=n.throw)||t.call(n,e)}})}function O(e){return"string"==typeof e?v(e):_instanceof(e,Uint8Array)?e:h(e)}function F(e,t,n){var r=_sliced_to_array(function(e){return e?_instanceof(e,Uint8Array)?[e,1]:ArrayBuffer.isView(e)||_instanceof(e,ArrayBuffer)?[h(e),1]:[v(e),0]:[void 0,0]}(t),2),a=r[0],o=r[1];if(_instanceof(e,File))return{o:b(a||v(e.name)),u:BigInt(e.size),l:o};if(_instanceof(e,Response)){var i=e.headers.get("content-disposition"),u=i&&i.match(/;\s*filename\*?=["']?(.*?)["']?$/i),s=u&&u[1]||e.url&&new URL(e.url).pathname.split("/").findLast(Boolean),c=s&&decodeURIComponent(s),l=n||+e.headers.get("content-length");return{o:b(a||v(c)),u:BigInt(l),l:o}}return a=b(a,void 0!==e||void 0!==n),"string"==typeof e?{o:a,u:BigInt(v(e).length),l:o}:_instanceof(e,Blob)?{o:a,u:BigInt(e.size),l:o}:_instanceof(e,ArrayBuffer)||ArrayBuffer.isView(e)?{o:a,u:BigInt(e.byteLength),l:o}:{o:a,u:q(e,n),l:o}}function q(e,t){return t>-1?BigInt(t):e?void 0:0n}function b(e,t){var n=arguments.length>1&&void 0!==t?t:1;if(!e||e.every(function(e){return 47===e}))throw new Error("The file must have a name.");if(n)for(;47===e[e.length-1];)e=e.subarray(0,-1);else 47!==e[e.length-1]&&(e=new Uint8Array(_to_consumable_array(e).concat([47])));return e}var a=new Uint32Array(256);for(var o=0;o<256;++o){var i=o;for(var u=0;u<8;++u)i=i>>>1^(1&i&&0xedb88320);a[o]=i}function L(e,t){var n=arguments.length>1&&void 0!==t?t:0;n^=-1;for(var r=0,o=e.length;r<o;r++)n=n>>>8^a[255&n^e[r]];return(-1^n)>>>0}function R(e,t,n){var r=arguments.length>2&&void 0!==n?n:0;var a=e.getSeconds()>>1|e.getMinutes()<<5|e.getHours()<<11,o=e.getDate()|e.getMonth()+1<<5|e.getFullYear()-1980<<9;t.setUint16(r,a,1),t.setUint16(r+2,o,1)}function M(e,t){var n=e.o;return 8*(!e.l||(null!=t?t:function(e){try{s.decode(e)}catch(e){return 0}return 1}(n)))}var s=new TextDecoder("utf8",{fatal:1});function j(e,t){var n=arguments.length>1&&void 0!==t?t:0;var r=U(30);return r.setUint32(0,0x504b0304),r.setUint32(4,0x2d000800|n),R(e.t,r,10),r.setUint16(26,e.o.length,1),h(r)}function $(){return _$.apply(this,arguments)}function _$(){return(_$=_wrap_async_generator(function(e){var t,n,r,a;return _ts_generator(this,function(o){switch(o.label){case 0:if(!("then"in(t=e.i)))return[3,2];return[4,_await_async_generator(t)];case 1:t=o.sent(),o.label=2;case 2:if(!_instanceof(t,Uint8Array))return[3,4];return[4,t];case 3:return o.sent(),e.m=L(t,0),e.u=BigInt(t.length),[3,9];case 4:e.u=0n,n=t.getReader(),o.label=5;case 5:return[4,_await_async_generator(n.read())];case 6:if(a=(r=o.sent()).value,r.done)return[3,9];return e.m=L(a,e.m),e.u+=BigInt(a.length),[4,a];case 7:o.sent(),o.label=8;case 8:return[3,5];case 9:return[2]}})})).apply(this,arguments)}function k(e,t){var n=U(16+(t?8:0));return n.setUint32(0,0x504b0708),n.setUint32(4,e.isFile?e.m:0,1),t?(n.setBigUint64(8,e.u,1),n.setBigUint64(16,e.u,1)):(n.setUint32(8,w(e.u),1),n.setUint32(12,w(e.u),1)),h(n)}function z(e,t,n,r){var a=arguments.length>2&&void 0!==n?n:0,o=arguments.length>3&&void 0!==r?r:0;var i=U(46);return i.setUint32(0,0x504b0102),i.setUint32(4,0x2d032d00),i.setUint16(8,2048|a),R(e.t,i,12),i.setUint32(16,e.isFile?e.m:0,1),i.setUint32(20,w(e.u),1),i.setUint32(24,w(e.u),1),i.setUint16(28,e.o.length,1),i.setUint16(30,o,1),i.setUint16(40,e.isFile?33204:16893,1),i.setUint32(42,w(t),1),h(i)}function V(e,t,n){var r=U(n);return r.setUint16(0,1,1),r.setUint16(2,n-4,1),16&n&&(r.setBigUint64(4,e.u,1),r.setBigUint64(12,e.u,1)),r.setBigUint64(n-8,t,1),h(r)}function A(e){return _instanceof(e,File)||_instanceof(e,Response)?[[e],[e]]:[[e.input,e.name,e.size],[e.input,e.lastModified]]}function H(e,t){var n=arguments.length>1&&void 0!==t?t:{};var r={"Content-Type":"application/zip","Content-Disposition":"attachment"};return("bigint"==_type_of(n.length)||Number.isInteger(n.length))&&n.length>0&&(r["Content-Length"]=String(n.length)),n.metadata&&(r["Content-Length"]=String(function(e){return function(e){var t=BigInt(22),n=0n,r=0;var a=true,o=false,i=void 0;try{for(var u,s=e[Symbol.iterator]();!(a=(u=s.next()).done);a=true){var c=u.value;if(!c.o)throw new Error("Every file must have a non-empty name.");if(void 0===c.u)throw new Error('Missing size for file "'.concat(new TextDecoder().decode(c.o),'".'));var l=c.u>=4294967295n,_=n>=4294967295n;n+=BigInt(46+c.o.length+(l&&8))+c.u,t+=BigInt(c.o.length+46+(12*_|28*l)),r||(r=l)}}catch(e){o=true,i=e}finally{try{if(!a&&null!=s.return)s.return()}finally{if(o)throw i}}return(r||n>=4294967295n)&&(t+=BigInt(76)),t+n}(function(e){var t,n,r,a,o,i,u;return _ts_generator(this,function(s){switch(s.label){case 0:t=true,n=false,r=void 0,s.label=1;case 1:s.trys.push([1,6,7,8]),a=e[Symbol.iterator](),s.label=2;case 2:if(!!(t=(o=a.next()).done))return[3,5];return i=o.value,[4,F.apply(void 0,_to_consumable_array(A(i)[0]))];case 3:s.sent(),s.label=4;case 4:return t=true,[3,2];case 5:return[3,8];case 6:return u=s.sent(),n=true,r=u,[3,8];case 7:try{if(!t&&null!=a.return)a.return()}finally{if(n)throw r}return[7];case 8:return[2]}})}(e))}(n.metadata))),new Response(G(e,n),{headers:r})}function G(e,t){var n=arguments.length>1&&void 0!==t?t:{};var r=function(e){var t;var n=e[Symbol.iterator in e?Symbol.iterator:Symbol.asyncIterator]();return _define_property({next:function(){return _async_to_generator(function(){var e,t,r,a;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,n.next()];case 1:if((e=o.sent()).done)return[2,e];return r=(t=_sliced_to_array(A(e.value),2))[0],a=t[1],[2,{done:0,value:Object.assign(E.apply(void 0,_to_consumable_array(a)),F.apply(void 0,_to_consumable_array(r)))}]}})})()},throw:null==(t=n.throw)?void 0:t.bind(n)},Symbol.asyncIterator,function(){return this})}(e);return T((function(){var e=_wrap_async_generator(function(e,t){var n,r,a,o,i,u,s,c,l,_,y,p,d,g,m,C,I,x,B,P,D,N,Y,J;return _ts_generator(this,function(Q){switch(Q.label){case 0:n=[],r=0n,a=0n,o=0,i=false,u=false,Q.label=1;case 1:Q.trys.push([1,11,12,17]),c=_async_iterator(e),Q.label=2;case 2:return[4,_await_async_generator(c.next())];case 3:if(!(i=!(l=Q.sent()).done))return[3,10];return y=M(_=l.value,t.buffersAreUTF8),[4,j(_,y)];case 4:return Q.sent(),[4,new Uint8Array(_.o)];case 5:if(Q.sent(),!_.isFile)return[3,7];return[5,_ts_values(_async_generator_delegate(_async_iterator($(_)),_await_async_generator))];case 6:Q.sent(),Q.label=7;case 7:return p=_.u>=4294967295n,d=12*(r>=4294967295n)|28*p,[4,k(_,p)];case 8:Q.sent(),n.push(z(_,r,y,d)),n.push(_.o),d&&n.push(V(_,r,d)),p&&(r+=8n),a++,r+=BigInt(46+_.o.length)+_.u,o||(o=p),Q.label=9;case 9:return i=false,[3,2];case 10:return[3,17];case 11:return g=Q.sent(),u=true,s=g,[3,17];case 12:if(Q.trys.push([12,,15,16]),!(i&&null!=c.return))return[3,14];return[4,_await_async_generator(c.return())];case 13:Q.sent(),Q.label=14;case 14:return[3,16];case 15:if(u)throw s;return[7];case 16:return[7];case 17:m=0n,C=true,I=false,x=void 0,Q.label=18;case 18:Q.trys.push([18,23,24,25]),B=n[Symbol.iterator](),Q.label=19;case 19:if(!!(C=(P=B.next()).done))return[3,22];return[4,D=P.value];case 20:Q.sent(),m+=BigInt(D.length),Q.label=21;case 21:return C=true,[3,19];case 22:return[3,25];case 23:return N=Q.sent(),I=true,x=N,[3,25];case 24:try{if(!C&&null!=B.return)B.return()}finally{if(I)throw x}return[7];case 25:if(!(o||r>=4294967295n))return[3,27];return(Y=U(76)).setUint32(0,0x504b0606),Y.setBigUint64(4,BigInt(44),1),Y.setUint32(12,0x2d032d00),Y.setBigUint64(24,a,1),Y.setBigUint64(32,a,1),Y.setBigUint64(40,m,1),Y.setBigUint64(48,r,1),Y.setUint32(56,0x504b0607),Y.setBigUint64(64,r+m,1),Y.setUint32(72,1,1),[4,h(Y)];case 26:Q.sent(),Q.label=27;case 27:return(J=U(22)).setUint32(0,0x504b0506),J.setUint16(8,S(a),1),J.setUint16(10,S(a),1),J.setUint32(12,w(m),1),J.setUint32(16,w(r),1),[4,h(J)];case 28:return Q.sent(),[2]}})});return function(t,n){return e.apply(this,arguments)}})()(r,n),r)}var c={recordFps:30,syncFps:!1,type:"png",quality:.92},l=r.Utils,_=l.Time,y=l.Image,p=l.Browser;e("i",Object.freeze(Object.defineProperty({__proto__:null,default:/*#__PURE__*/function(e){function K(){var e;return _class_call_check(this,K),e=_call_super(this,K,arguments),f(e,"options"),f(e,"panelControl",null),f(e,"canvas",null),f(e,"capturing"),f(e,"requestCount",0),f(e,"requestFinishCount",0),f(e,"lastCaptureTime",0),f(e,"realStartTime",0),f(e,"countVideoTime",0),f(e,"imageList"),f(e,"processCapture",/*#__PURE__*/_async_to_generator(function(){var t,n,r;return _ts_generator(this,function(a){switch(a.label){case 0:if(!e.isCapturing())return[2];return t=performance.now(),[4,e.waitNextFrame(!0)];case 1:if(a.sent(),!e.isCapturing())return[2];return[4,e.handleCapture()];case 2:if(a.sent(),e.lastCaptureTime=performance.now(),n=t-e.lastCaptureTime,!!e.options.syncFps)return[3,5];if(!((r=1e3/e.options.recordFps)>n))return[3,4];return[4,_.sleepAsync(r-n)];case 3:a.sent(),a.label=4;case 4:a.label=5;case 5:return e.countVideoTime+=n,e.updateRecordInfo(),e.processCapture(),[2]}})})),f(e,"handleCapture",/*#__PURE__*/_async_to_generator(function(){var t;return _ts_generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,4]),e.requestCount++,[4,e.snapshotCanvas()];case 1:if(!(t=n.sent()))throw new Error("Image data is null");return e.addImageDataToList(e.requestCount,t),e.requestFinishCount++,[3,4];case 2:return n.sent(),[4,e.stopCaptureAsync()];case 3:return n.sent(),[3,4];case 4:return[2]}})})),f(e,"addImageDataToList",function(t,n){var r=e.getPaddingName(t);e.imageList.push({name:"".concat(r,".").concat(e.options.type),input:n})}),e}return _inherits(K,e),_create_class(K,[{key:"init",value:function(){this.imageList=[],this.options=_object_spread({},c)}},{key:"configure",value:function(e){this.options=_object_spread({},this.options,e),"function"==typeof t&&(this.panelControl=new t(this,this.options))}},{key:"setCanvas",value:function(e){this.canvas=e}},{key:"getCanvas",value:function(){return this.canvas}},{key:"runTestCanvas",value:function(){if(!t)return;var e=this.createCanvas(200,300);e&&(e.style.position="absolute",document.body.appendChild(e),t(e),this.setCanvas(e))}},{key:"setPanelExpanded",value:function(e){var t;null==(t=this.panelControl)||t.setPanelExpanded(e)}},{key:"getOptions",value:function(){return this.options}},{key:"isCapturing",value:function(){return this.capturing}},{key:"initCaptureState",value:function(){this.imageList=[],this.capturing=!1,this.requestCount=0,this.requestFinishCount=0,this.countVideoTime=0,this.realStartTime=performance.now()}},{key:"setStateInputPanel",value:function(e){this.panelControl&&(e?this.panelControl.unblockInputPanel():this.panelControl.blockInputPanel())}},{key:"startCaptureAsync",value:function(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return e.isCapturing()||e.canvas&&(e.initCaptureState(),e.setStateInputPanel(!1),e.capturing=!0,e.processCapture()),[2]})})()}},{key:"waitNextFrame",value:function(e){var t=this;var n=arguments.length>0&&void 0!==e&&e;return new Promise(function(e,r){n||t.isCapturing()||r(new Error("CanvasRecorder is not capturing")),requestAnimationFrame(function(){e()})})}},{key:"updateRecordInfo",value:function(){if(!this.panelControl)return;var e=this.formatDateHMS(this.countVideoTime),t=this.formatDateHMS(performance.now()-this.realStartTime);this.panelControl.updateRecordInfo(e,t)}},{key:"snapshotCanvas",value:function(e){var t=this;return new Promise(function(n,r){if(!t.canvas){r(new Error("Canvas is not set"));return}var a=t.options,o=a.type,i=a.quality,u=e||{},s=u.type,c=void 0===s?o:s,l=u.quality,_=u.resolution,y=void 0===_?1:_;t.canvas.toBlob(function(e){if(!e){r(new Error("Blob is null"));return}1!==y?t.resizeBlob(e,c,y).then(n).catch(r):n(e)},"image/".concat(c),void 0===l?i:l)})}},{key:"resizeBlob",value:function(e,t,n){return _async_to_generator(function(){var r,a,o;return _ts_generator(this,function(i){switch(i.label){case 0:return[4,y.blobToHtmlImage(e,!0,!1)];case 1:if(!(r=i.sent()))throw new Error("Can not convert blob to image");return a=n/window.devicePixelRatio,r.width*=a,r.height*=a,[4,y.elementToBlob(r,t)];case 2:if(o=i.sent(),URL.revokeObjectURL(r.src),!o)throw new Error("Can not convert image to blob");return[2,o]}})})()}},{key:"stopCaptureAsync",value:function(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return[2,(e.capturing=!1,new Promise(function(t){var n=setInterval(function(){e.requestCount===e.requestFinishCount&&(clearInterval(n),e.setStateInputPanel(!0),t())},500)}))]})})()}},{key:"snapshotFrameAsync",value:function(e){var t=this;return _async_to_generator(function(){var n,r,a;return _ts_generator(this,function(o){switch(o.label){case 0:if(o.trys.push([0,3,,4]),!t.canvas)return[2,null];return r=void 0!==(n=(e||{}).force)&&n,[4,t.waitNextFrame(r)];case 1:return o.sent(),[4,t.snapshotCanvas(e)];case 2:if(!(a=o.sent()))throw new Error("Image data is null");return[2,a];case 3:return o.sent(),[2,null];case 4:return[2]}})})()}},{key:"downloadImage",value:function(e){var t=document.createElement("a"),n="screenshot-".concat(this.getDateFilename());t.download=n,t.href=URL.createObjectURL(e);var r="image/".concat(this.options.type);t.dataset.downloadurl=[r,t.download,t.href].join(":"),t.click(),URL.revokeObjectURL(t.href),t.remove()}},{key:"downloadImagesAsync",value:function(){var e=this;return _async_to_generator(function(){var t,n,r;return _ts_generator(this,function(a){switch(a.label){case 0:if(a.trys.push([0,2,,3]),e.isCapturing())return[2];return e.setStateInputPanel(!1),t=document.createElement("a"),n="images-".concat(e.getDateFilename()),t.download=n,[4,H(e.imageList).blob()];case 1:return r=a.sent(),t.href=URL.createObjectURL(r),t.click(),URL.revokeObjectURL(t.href),t.remove(),[3,3];case 2:return a.sent(),[3,3];case 3:return[2]}})})()}},{key:"getRecordImages",value:function(){return this.imageList.map(function(e){return e.input})}},{key:"createCanvas",value:function(e,t){var n=p.createCanvas({type:"canvas"});return n?(n.canvas.width=e,n.canvas.height=t,n.canvas):null}},{key:"getPaddingName",value:function(e){var t=e.toString().length;var n="";for(var r=0;r<5-t;r++)n+="0";return n+e.toString()}},{key:"getDateFilename",value:function(){var e=new Date;return"".concat(e.toLocaleTimeString(),"-").concat(e.toLocaleDateString())}},{key:"formatDateHMS",value:function(e,t){var n=arguments.length>1&&void 0!==t&&t;var r=new Date(e).toISOString();return n?r.slice(11,-5):r.slice(14,-5)}}]),K}(n.Plugins.BasePlugin)},Symbol.toStringTag,{value:"Module"})))}}});