function _array_like_to_array(e,t){if(null==t||t>e.length)t=e.length;for(var o=0,l=new Array(t);o<t;o++)l[o]=e[o];return l}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function _assert_this_initialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function asyncGeneratorStep(e,t,o,l,u,d,f){try{var y=e[d](f);var _=y.value}catch(e){o(e);return}if(y.done)t(_);else Promise.resolve(_).then(l,u)}function _async_to_generator(e){return function(){var t=this,o=arguments;return new Promise(function(l,u){var d=e.apply(t,o);function _next(e){asyncGeneratorStep(d,l,u,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(d,l,u,_next,_throw,"throw",e)}_next(void 0)})}}function _call_super(e,t,o){return t=_get_prototype_of(t),_possible_constructor_return(e,_is_native_reflect_construct()?Reflect.construct(t,o||[],_get_prototype_of(e).constructor):t.apply(e,o))}function _class_call_check(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _construct(){return(_construct=_is_native_reflect_construct()?Reflect.construct:function construct(e,t,o){var l=[null];l.push.apply(l,t);var u=new(Function.bind.apply(e,l));if(o)_set_prototype_of(u,o.prototype);return u}).apply(null,arguments)}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var l=t[o];if(l.enumerable=l.enumerable||false,l.configurable=true,"value"in l)l.writable=true;Object.defineProperty(e,l.key,l)}}function _create_class(e,t,o){if(t)_defineProperties(e.prototype,t);if(o)_defineProperties(e,o);return e}function _define_property(e,t,o){if(t in e)Object.defineProperty(e,t,{value:o,enumerable:true,configurable:true,writable:true});else e[t]=o;return e}function _get(e,t,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function get(e,t,o){var l=_super_prop_base(e,t);if(!l)return;var u=Object.getOwnPropertyDescriptor(l,t);if(u.get)return u.get.call(o||e);return u.value})(e,t,o||e)}function _get_prototype_of(e){return(_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");if(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}}),t)_set_prototype_of(e,t)}function _instanceof(e,t){if(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance])return!!t[Symbol.hasInstance](e);return e instanceof t}function _is_native_function(e){return -1!==Function.toString.call(e).indexOf("[native code]")}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,t){var o,l,u=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==u)return;var d=[];var f=true;var y=false;try{for(u=u.call(e);!(f=(o=u.next()).done)&&(d.push(o.value),!t||d.length!==t);f=true);}catch(e){y=true,l=e}finally{try{if(!f&&null!=u.return)u.return()}finally{if(y)throw l}}return d}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};var l=Object.keys(o);if("function"==typeof Object.getOwnPropertySymbols)l=l.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}));l.forEach(function(t){_define_property(e,t,o[t])})}return e}function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);if(t)l=l.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable});o.push.apply(o,l)}return o}function _object_spread_props(e,t){if(t=null!=t?t:{},Object.getOwnPropertyDescriptors)Object.defineProperties(e,Object.getOwnPropertyDescriptors(t));else ownKeys(Object(t)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))});return e}function _object_without_properties(e,t){if(null==e)return{};var o,l,u=_object_without_properties_loose(e,t);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(l=0;l<d.length;l++)if(o=d[l],!(t.indexOf(o)>=0)){if(!!Object.prototype.propertyIsEnumerable.call(e,o))u[o]=e[o]}}return u}function _object_without_properties_loose(e,t){if(null==e)return{};var o,l,u={};var d=Object.keys(e);for(l=0;l<d.length;l++)if(o=d[l],!(t.indexOf(o)>=0))u[o]=e[o];return u}function _possible_constructor_return(e,t){if(t&&("object"===_type_of(t)||"function"==typeof t))return t;return _assert_this_initialized(e)}function _set_prototype_of(e,t){return(_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _super_prop_base(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(null===(e=_get_prototype_of(e)))break;return e}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,t){if(!e)return;if("string"==typeof e)return _array_like_to_array(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);if("Object"===o&&e.constructor)o=e.constructor.name;if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _array_like_to_array(e,t)}function _wrap_native_super(e){var t="function"==typeof Map?new Map:void 0;return(_wrap_native_super=function wrapNativeSuper(e){if(null===e||!_is_native_function(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_get_prototype_of(this).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}}),_set_prototype_of(Wrapper,e)})(e)}function _is_native_reflect_construct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_is_native_reflect_construct=function(){return!!e})()}function _ts_generator(e,t){var o,l,u,d,f={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return d={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d;function verb(e){return function(t){return step([e,t])}}function step(d){if(o)throw new TypeError("Generator is already executing.");while(f)try{if(o=1,l&&(u=2&d[0]?l.return:d[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,d[1])).done)return u;if(l=0,u)d=[2&d[0],u.value];switch(d[0]){case 0:case 1:u=d;break;case 4:return f.label++,{value:d[1],done:false};case 5:f.label++,l=d[1],d=[0];continue;case 7:d=f.ops.pop(),f.trys.pop();continue;default:if(!(u=(u=f.trys).length>0&&u[u.length-1])&&(6===d[0]||2===d[0])){f=0;continue}if(3===d[0]&&(!u||d[1]>u[0]&&d[1]<u[3])){f.label=d[1];break}if(6===d[0]&&f.label<u[1]){f.label=u[1],u=d;break}if(u&&f.label<u[2]){f.label=u[2],f.ops.push(d);break}if(u[2])f.ops.pop();f.trys.pop();continue}d=t.call(e,f)}catch(e){d=[6,e],l=0}finally{o=u=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:true}}}var Qo=Object.defineProperty;var c=function(e,t){return Qo(e,"name",{value:t,configurable:!0})};var h=function(e,t,o){return function(e,t,o){return t in e?Qo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o}(e,(void 0===t?"undefined":_type_of(t))!="symbol"?t+"":t,o)};System.register(["./bundle/core.js","./bundle/__commonjsHelpers__.js","./bundle/canvas-recorder.js"],function(e,t){"use strict";var o,l,u,d,f,y,_,p;return{setters:[function(e){o=e.G,l=e.P,u=e.M,d=e._,f=e.a,y=e.C},function(e){_=e.g},function(e){p=e.d}],execute:c(function(){var v,g,m;var A=o.Utils,w=A.Valid,D=A.Object,I=A.String,b=A.Json,S="is invalid",k=/*#__PURE__*/function(){function X(e){_class_call_check(this,X),this.defaultData(),this.processData(e)}return _create_class(X,[{key:"processData",value:function processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}},{key:"defaultData",value:function defaultData(){var e=this.constructor.name;this.lazyDefaultData(X.data[e])}},{key:"lazyDefaultData",value:function lazyDefaultData(e){for(var t in w.isObject(e)||this.exception("data",S),e)if(D.hasOwn(e,t)){var o=e[t];D.assign(this,_define_property({},t,o))}}},{key:"lazyValidateStructure",value:function lazyValidateStructure(e){w.isObject(e)||this.exception("structure","is not object");var t=this.getKeys();var o=true,l=false,u=void 0;try{for(var d,f=t[Symbol.iterator]();!(o=(d=f.next()).done);o=true){var y=d.value;var _=this[y];void 0===_&&this.exception("structure","has no key ".concat(y)),D.hasOwn(e,y)||void 0===_||this.setDefaultData(y,e)}}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}}},{key:"setDefaultData",value:function setDefaultData(e,t){w.isObject(t)||this.exception("data",S);var o=this[e];void 0===o&&this.exception("default","has no key ".concat(e)),D.assign(t,_define_property({},e,o))}},{key:"lazyValidateData",value:function lazyValidateData(e){var t=this.getKeys();var o=true,l=false,u=void 0;try{for(var d,f=t[Symbol.iterator]();!(o=(d=f.next()).done);o=true){var y=d.value;var _=e[y],p=I.removeDiacritics(y).replace(/[^a-zA-Z0-9]/g,""),v="validate".concat(I.capitalize(p)),g=this[v];if("function"==typeof g)try{g.call(this,_)}catch(t){console.warn(t),this.setDefaultData(y,e)}else this.exception("validate","has no function ".concat(v))}}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}}},{key:"lazySetupData",value:function lazySetupData(e){var t=this.getKeys();var o=true,l=false,u=void 0;try{for(var d,f=t[Symbol.iterator]();!(o=(d=f.next()).done);o=true){var y=d.value;var _=e[y];D.assign(this,_define_property({},y,_))}}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}}},{key:"validate",value:function validate(){this.validateData(this.toObject())}},{key:"exception",value:function exception(e,t){throw new Error("".concat(this.constructor.name,": ").concat(e," ").concat(t))}},{key:"toObject",value:function toObject(){return Object.fromEntries(Object.entries(this).filter(function(e){return"toObject"!==_sliced_to_array(e,1)[0]}))}},{key:"getKeys",value:function getKeys(){return Object.keys(this).filter(function(e){return"toObject"!==e})}}],[{key:"addDefaultData",value:function addDefaultData(e){w.isObject(e)||this.prototype.exception("default data",S),e=b.clone(e);var t=this.name;w.isObject(X.data[t])||(X.data[t]={}),X.data[t]=D.merge(X.data[t],e),console.debug("".concat(t," default data:"),X.data[t])}},{key:"getDefaultData",value:function getDefaultData(){var e=this.name;return b.clone(X.data[e])}},{key:"addValidateFunction",value:function addValidateFunction(e,t){w.isString(e)||this.prototype.exception("validate key",S),"function"!=typeof t&&this.prototype.exception("validate function",S);var o="validate".concat(I.capitalize(e));D.assign(this.prototype,_define_property({},o,t))}}]),X}();c(k,"BaseDtos"),h(k,"data",{}),o.Dtos={Base:k};var P={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded",notificationData:"notificationData",lastCallSwitchGame:"lastCallSwitchGame"},E={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],firstReward:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0,notificationData:{D1:{arrivalDate:0},D2:{arrivalDate:0},D3:{arrivalDate:0},D4:{arrivalDate:0},D5:{arrivalDate:0},D6:{arrivalDate:0},D7:{arrivalDate:0}},lastCallSwitchGame:0}},C=o.Utils.Valid,x=E.playerId,T=E.name,L=E.photo,N=E.locale,O="is invalid",R=/*#__PURE__*/function(e){function sn(){return _class_call_check(this,sn),_call_super(this,sn,arguments)}return _inherits(sn,e),_create_class(sn,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){C.isString(e)&&e||this.exception("_id",O)}},{key:"validatePlayerId",value:function validatePlayerId(e){C.isString(e)&&e||this.exception("playerId",O)}},{key:"validateName",value:function validateName(e){C.isString(e)&&e||this.exception("name",O)}},{key:"validatePhoto",value:function validatePhoto(e){C.isString(e)||this.exception("photo",O)}},{key:"validateLocale",value:function validateLocale(e){C.isString(e)&&e||this.exception("locale",O)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(sn.prototype),"toObject",this).call(this)}}]),sn}(k);c(R,"PlayerInfoDtos"),R.addDefaultData({playerId:x,name:T,photo:L,locale:N});var M=new R({playerId:"10",name:"Your Friend"}).toObject(),F=/*#__PURE__*/function(e){function an(e){var t;return _class_call_check(this,an),h(t=_call_super(this,an,[e]),"code"),t.code="CREATE_MATCH_FAILED",t}return _inherits(an,e),an}(_wrap_native_super(Error));c(F,"ACreateMatchFailed");var G=/*#__PURE__*/function(e){function nn(e){var t;return _class_call_check(this,nn),(t=_call_super(this,nn,[e])).name="PlayerIdNotValid",t.message=null!=e?e:"Player id is not valid",t}return _inherits(nn,e),nn}(F);c(G,"PlayerIdNotValid");var B=o.Dtos,j=o.Utils,V=j.Array,H=j.Object,U=j.Json,K=j.Valid,W=o.Events,rn=function rn(e){var t=this;_class_call_check(this,rn);var o=this;h(this,"game"),h(this,"initContext",c(function(){var e;var o={contextId:null!==(e=GameSDK.context.getID())&&void 0!==e?e:"",contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},l=new B.Context.Info(o).toObject(),u=l.contextId,d=l.contextType,f=l.entryPointData;t.game.context.receiveContext(u,d,f)},"initContext")),h(this,"initPlayer",c(/*#__PURE__*/_async_to_generator(function(){var e,t,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,3,4]),e=o.game.player,t=o.getPlayerInfo(),console.info("playerInfo",U.clone(t)),console.debug("dataKeys",l=V.unique(H.vals(P))),[4,GameSDK.player.getDataAsync(l)];case 1:return u=f.sent(),console.debug("rawData",U.clone(u)),d=new B.Player.Data(u).toObject(),console.info("playerData",U.clone(d)),e.receiveData(t,d),[3,4];case 2:return console.warn("StateInitiator.initPlayer",f.sent()),[3,4];case 3:return o.game.event.emit(W.PLAYER_INFO_LOADED),[7];case 4:return[2]}})}),"initPlayer")),h(this,"getPlayerInfo",c(function(){try{var e=GameSDK.player.getID();var t=GameSDK.player.getName();var o=GameSDK.player.getPhoto();var l=GameSDK.getLocale();if(!K.isString(e))throw new G;return K.isString(t)||(t="You"),K.isString(l)&&l||(l="en"),new B.Player.Info({playerId:e,name:t,photo:o,locale:l}).toObject()}catch(e){return console.warn("StateInitiator.getPlayerInfo",e),M}},"getPlayerInfo")),this.game=e};c(rn,"StateInitiator");var z=/*#__PURE__*/function(e){function on(e,t){var o;return _class_call_check(this,on),h(o=_call_super(this,on,[e]),"payload"),o.name="BadRequest",o.message=null!=e?e:"This request is bad",o.payload=t,o}return _inherits(on,e),on}(_wrap_native_super(Error));c(z,"BadRequest");var q=/*#__PURE__*/function(e){function cn(e,t){var o;return _class_call_check(this,cn),h(o=_call_super(this,cn,[e]),"payload"),o.name="RequestTimeout",o.message=null!=e?e:"This request is timeout",o.payload=t,o}return _inherits(cn,e),cn}(_wrap_native_super(Error));c(q,"RequestTimeout");var Y=o.Utils,J=o.Configs,Q=J.AppId,$=J.Network,Z=c(function(e){if(!e.ok)throw new z(void 0,{response:e})},"validateResponse"),ee=c(function(){var e=window.game.auth.getToken();return{token:e,timeout:$.Timeout,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},"defaultConfig"),et=c(function(e,t,l,u){return /*#__PURE__*/_async_to_generator(function(){var d,f,y,_,p;return _ts_generator(this,function(v){switch(v.label){case 0:if(v.trys.push([0,3,,4]),!Q)throw new z("AppId is not defined");return d="".concat(e,"/apps/").concat(Q,"/").concat(t),f=new AbortController,l.signal=f.signal,y=setTimeout(function(){f.abort()},l.timeout),o.Utils.Valid.isObject(u)&&(l.body=JSON.stringify(u)),[4,fetch(d,l)];case 1:return _=v.sent(),clearTimeout(y),Z(_),[4,_.json()];case 2:return[2,v.sent()||{}];case 3:if(_instanceof(p=v.sent(),z))return[2,null];throw _instanceof(p,Object)&&"name"in p&&"AbortError"===p.name?new q:p;case 4:return[2]}})})},"requester"),en=c(/*#__PURE__*/function(){var e=_async_to_generator(function(e,t){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,1,,7]),[2,e()];case 1:if(!(_instanceof(o=l.sent(),q)&&t>0))return[3,6];l.label=2;case 2:return l.trys.push([2,5,,6]),[4,Y.Time.sleepAsync(600)];case 3:return l.sent(),[4,en(e,t-1)];case 4:return[2,l.sent()];case 5:return l.sent(),[2,{}];case 6:return[2,_instanceof(o,q)?{}:(console.warn("Request error",o),{})];case 7:return[2]}})});return function(t,o){return e.apply(this,arguments)}}(),"handleRequest"),ea=c(/*#__PURE__*/function(){var e=_async_to_generator(function(e,t,o){var l;var u=arguments;return _ts_generator(this,function(d){switch(d.label){case 0:l=u.length>3&&void 0!==u[3]?u[3]:$.Retries,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,en(et(o,e,_object_spread_props(_object_spread({},ee(),t),{method:"GET"})),l)];case 2:return[2,d.sent()];case 3:return[2,(console.warn("Get error",d.sent()),{})];case 4:return[2]}})});return function(t,o,l){return e.apply(this,arguments)}}(),"get"),es=c(/*#__PURE__*/function(){var e=_async_to_generator(function(e,t,o,l){var u;var d=arguments;return _ts_generator(this,function(f){switch(f.label){case 0:u=d.length>4&&void 0!==d[4]?d[4]:$.Retries,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,en(et(l,e,_object_spread_props(_object_spread({},ee(),o),{method:"POST"}),t),u)];case 2:return[2,f.sent()];case 3:return[2,(console.warn("Post error",f.sent()),{})];case 4:return[2]}})});return function(t,o,l,u){return e.apply(this,arguments)}}(),"post"),eo=o.Configs.Notification.ApiUrl,ec=o.Utils.Object,el=c(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(!ec.hasOwn(e,"playerId"))throw new Error("Missing playerId");return t=e.playerId,[4,es("players/".concat(t),e,{},eo,10)];case 1:return o.sent(),[2]}})});return function(t){return e.apply(this,arguments)}}(),"updatePlayerProfileNotificationAsync");var eu=function(e){return e.IDLE="idle",e.LOADING="loading",e.FILLED="filled",e.SHOWING="showing",e}(eu||{});var ed=function(e){return e.BANNER="banner",e.INTERSTITIAL="interstitial",e.REWARDED_VIDEO="rewarded_video",e.REWARDED_INTERSTITIAL="rewarded_interstitial",e}(ed||{});var eh=(c(v=/*#__PURE__*/function(e){function ke(e,t){var o;return _class_call_check(this,ke),h(o=_call_super(this,ke,[t]),"code"),o.code=e,o.message=t,o}return _inherits(ke,e),ke}(_wrap_native_super(Error)),"AdError"),v);var ef=/*#__PURE__*/function(){function ln(e,t){_class_call_check(this,ln),h(this,"type"),h(this,"service"),h(this,"placementId"),h(this,"_status"),this.type=e,this._status=eu.IDLE,this.placementId=t}return _create_class(ln,[{key:"setStatus",value:function setStatus(e){this._status!==e&&(this._status=e)}},{key:"status",get:function get(){return this._status}},{key:"exception",value:function exception(e){throw new eh("AD_INSTANCE_ERROR",e)}}]),ln}();c(ef,"BaseInstance");var ey=(c(g=/*#__PURE__*/function(e){function Ve(){return _class_call_check(this,Ve),_call_super(this,Ve,arguments)}return _inherits(Ve,e),_create_class(Ve,[{key:"loadAsync",value:function loadAsync(){this.exception("This method is not implemented")}},{key:"showAsync",value:function showAsync(){this.exception("This method is not implemented")}},{key:"hideAsync",value:function hideAsync(){this.exception("Unsupported method")}}]),Ve}(ef),"AdInstance"),g);o.Plugins.Ads={Types:ed,Status:eu,AdError:eh,AdInstance:ey};var e_=o.Utils,ep=e_.Array,ev=e_.Object,eg=/*#__PURE__*/function(e){function dn(){var e;return _class_call_check(this,dn),e=_call_super(this,dn,arguments),h(e,"enabled"),h(e,"config"),h(e,"lastCallAdShownTime"),h(e,"isAdFullSizeShowed"),h(e,"ads",{}),h(e,"safeAreaBottom"),h(e,"degradationTracking",{failedAttempts:0,lastSuccessTime:0}),e}return _inherits(dn,e),_create_class(dn,[{key:"init",value:function init(){var e;this.lastCallAdShownTime=(_define_property(e={},ed.BANNER,0),_define_property(e,ed.INTERSTITIAL,0),_define_property(e,ed.REWARDED_VIDEO,0),_define_property(e,ed.REWARDED_INTERSTITIAL,0),e),this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom(),this.resetDegradationTracking()}},{key:"calculateSafeAreaBottom",value:function calculateSafeAreaBottom(){try{var e=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(e,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch(e){this.safeAreaBottom=0}}},{key:"configure",value:function configure(e){this.config=e,this.enabled=this.config.Enabled}},{key:"checkEnabled",value:function checkEnabled(){if(!this.enabled)throw new eh("ADS_NOT_ENABLED","Ads is't enabled")}},{key:"isAdFullSizeShowing",value:function isAdFullSizeShowing(){return this.isAdFullSizeShowed}},{key:"setAdInstance",value:function setAdInstance(e,t,o){var l="".concat(e,"-").concat(t);if(this.ads[l]){console.warn("AdsPlugin: Ad instance with placementId ".concat(t," already exists"));return}this.ads[l]={type:e,placementId:t,interval:null,instance:new o(e,t)}}},{key:"loadAdAsync",value:function loadAdAsync(e,t){var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:o.checkEnabled(),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,o.getAd(e,t).instance.loadAsync()];case 2:return u.sent(),[3,4];case 3:throw l=u.sent(),o.degradationTracking.failedAttempts++,l;case 4:return[2]}})})()}},{key:"showAdAsync",value:function showAdAsync(e,t){var l=this;return _async_to_generator(function(){var u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:if(l.checkEnabled(),!l.canbeShowAd(e,t))return console.warn("AdsPlugin: This ad ".concat(e," is not ready to be shown")),[2];u=l.game.event,d=l.getAd(e,t),y.label=1;case 1:return y.trys.push([1,3,4,5]),u.emit(o.Events.AD_SHOWING,{type:e,placementId:t}),l.isAdFullSizeShowed=!0,[4,d.instance.showAsync()];case 2:return y.sent(),l.resetDegradationTracking(),l.lastCallAdShownTime[e]=Date.now()/1e3,[3,5];case 3:throw f=y.sent(),l.degradationTracking.failedAttempts++,f;case 4:return u.emit(o.Events.AD_CLOSED,{type:e,placementId:t}),l.isAdFullSizeShowed=!1,[7];case 5:return[2]}})})()}},{key:"getAdStatus",value:function getAdStatus(e,t){return this.checkEnabled(),this.getAd(e,t).instance.status}},{key:"getAd",value:function getAd(e,t){var o=null;if(t?o=this.getAdByPlacementId(t,e):o=this.getPriorityAdByType(e),!o)throw new eh("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return o}},{key:"getAdsByType",value:function getAdsByType(e){return ev.vals(this.ads).filter(function(t){return t.type===e})}},{key:"getAdByPlacementId",value:function getAdByPlacementId(e,t){var o=ev.vals(this.ads);return ep.search(o,function(o){return o.placementId===e&&(!t||o.type===t)})||null}},{key:"getPriorityAdByType",value:function getPriorityAdByType(e){var t=this.getAdsByType(e);if(!t.length)return null;return ep.search(t,function(t){return t.type===e})||null}},{key:"canbeShowAd",value:function canbeShowAd(e,t){return this.canbeShowAdByTime(e,t)}},{key:"canbeShowAdByTime",value:function canbeShowAdByTime(e,t){try{var o,l=Date.now()/1e3;if(t)o=this.getCommonAdConfig(t);else{var u=this.getPriorityAdByType(e);if(!u)return!1;o=this.getCommonAdConfig(u.placementId)}var d=o.SecondsBetweenAds,f=o.SecondsFirstTime,y=l-this.lastCallAdShownTime[e],_=y>d,p=y>f;return console.debug("[AdsPlugin] canbeShowAdByTime",{type:e,now:l,lastShownTime:this.lastCallAdShownTime[e],period:y,adConfig:o,canbeShowByTime:_,canbeShowFirstTime:p}),this.lastCallAdShownTime[e]>0?_:p}catch(t){return console.warn("Error while checking canbe show ".concat(e," ad by time"),t),!1}}},{key:"canbeShowBannerAd",value:function canbeShowBannerAd(e){try{var t=this.getBannerConfig(e).Platform;if("ALL"===t)return!0;var o=GameSDK.getPlatform();return!!o&&o===t}catch(e){return console.warn("Error while checking canbeShowBannerAd",e),!1}}},{key:"showBannerAdAsync",value:function showBannerAdAsync(e,t){var o=!(arguments.length>1)||void 0===t||t;var l=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(u){switch(u.label){case 0:if(l.checkEnabled(),t=l.getAd(ed.BANNER,e),!l.canbeShowBannerAd(t.placementId))throw new Error("Banner ad can not be shown");if(l.cleanBannerReloadTimer(t),!o)return[3,2];return[4,l.showBannerAdWithSchedule(t)];case 1:return u.sent(),[3,4];case 2:return[4,l.showBannerAdOnce(t)];case 3:u.sent(),u.label=4;case 4:return[2]}})})()}},{key:"showBannerAdOnce",value:function showBannerAdOnce(e){var t=this;return _async_to_generator(function(){var l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(l=t.game.event,t.isAdFullSizeShowing())return console.warn("Show banner ad skipped because ad full size is showing"),[2];f.label=1;case 1:return f.trys.push([1,3,,8]),[4,e.instance.showAsync()];case 2:return f.sent(),l.emit(o.Events.AD_SHOWING,{type:ed.BANNER,placementId:e.placementId}),[3,8];case 3:d=_instanceof(u=f.sent(),Error)?u:new Error("AdsPlugin.startShowBannerAdInterval: Failed to show banner ad"),f.label=4;case 4:return f.trys.push([4,6,,7]),[4,e.instance.hideAsync()];case 5:return f.sent(),[3,7];case 6:return console.warn("AdsPlugin.startShowBannerAdInterval: Failed to call ad.instance.hideAsync after show banner ad failed",f.sent()),[3,7];case 7:return l.emit(o.Events.AD_FAILED,{type:ed.BANNER,placementId:e.placementId,error:d}),[3,8];case 8:return[2]}})})()}},{key:"showBannerAdWithSchedule",value:function showBannerAdWithSchedule(e){var t=this;return _async_to_generator(function(){var o,l;return _ts_generator(this,function(u){switch(u.label){case 0:return[4,t.showBannerAdOnce(e)];case 1:if(u.sent(),(o=t.getBannerConfig(e.placementId).SecondsReload)<=0)return console.warn("Banner ad reload time is less than 0"),[2];return l=c(function(){return t.showBannerAdWithSchedule(e)},"cb"),e.interval=setTimeout(l,1e3*o),[2]}})})()}},{key:"hideBannerAdAsync",value:function hideBannerAdAsync(e){var t=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return t.checkEnabled(),l=t.getAd(ed.BANNER,e),t.cleanBannerReloadTimer(l),[4,l.instance.hideAsync()];case 1:return u.sent(),t.game.event.emit(o.Events.AD_CLOSED,{type:ed.BANNER,placementId:e}),[2]}})})()}},{key:"cleanBannerReloadTimer",value:function cleanBannerReloadTimer(e){try{var t=e.interval;if(!t)return;clearInterval(t)}catch(e){console.warn("Error while cleaning banner reload timer",e)}}},{key:"getCommonAdConfig",value:function getCommonAdConfig(e){var t=_to_consumable_array(this.config.InterstitialAdOptions).concat(_to_consumable_array(this.config.RewardedVideoAdOptions),_to_consumable_array(this.config.RewardedInterstitialAdOptions)),o=ep.search(t,function(t){return t.PlacementId===e});if(!o)throw new Error("Ad config with placementId ".concat(e," not found"));return o}},{key:"getBannerConfig",value:function getBannerConfig(e){var t=ep.search(this.config.BannerDisplayAdOptions,function(t){return t.PlacementId===e});if(!t)throw new Error("Banner config with placementId ".concat(e," not found"));return t}},{key:"getBannerHeight",value:function getBannerHeight(e,t,o){var l=!(arguments.length>2)||void 0===o||o;this.checkEnabled();var u=this.getBannerConfig(e),d=GameSDK.getBannerHeight(u);return l?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(d+this.safeAreaBottom)*t):d*t}},{key:"getSafeAreaBottom",value:function getSafeAreaBottom(e){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*e}},{key:"resetDegradationTracking",value:function resetDegradationTracking(){this.degradationTracking={failedAttempts:0,lastSuccessTime:Date.now()}}},{key:"isServiceDegraded",value:function isServiceDegraded(){var e=Date.now(),t=this.config.DegradationTracking,o=t.MaxFailedAttempts,l=t.ResetTimeMinutes,u=this.degradationTracking,d=u.lastSuccessTime,f=u.failedAttempts;return e-d>6e4*l&&this.resetDegradationTracking(),f>=o}}]),dn}(l.Plugins.BasePlugin);c(eg,"AdsPlugin");var em={APP_LAUNCH:"app_launch",APP_INITIALIZED:"app_initialized",ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",USE_ITEM:"use_item",EARN_ITEM:"earn_item",GET_FREE_ITEM:"get_free_item",SHARE:"share",INVITE:"invite",MESSAGE:"message",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_INIT:"ad_init",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOWING:"ad_showing",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",SWITCH_GAME_POPUP:"switch_game_popup",SWITCH_GAME:"switch_game"},eA=/*#__PURE__*/function(){function hn(){_class_call_check(this,hn),h(this,"history",[]),h(this,"missing",[]),h(this,"outOfOrder",[]),h(this,"completed",!1),h(this,"failed",!1),h(this,"warned",[]),h(this,"debug",!1)}return _create_class(hn,[{key:"addEvent",value:function addEvent(e,t){if(this.completed||this.failed){this.debugLog("Skip event:",e);return}this.history.push(e),this.validateAndUpdate(e)}},{key:"validateAndUpdate",value:function validateAndUpdate(e){var t=this.validateFunnelState();if(t.hasFailed){this.failed=!0,this.logValidationError();return}t.hasWarnings&&this.handleWarnings(t.warnings),this.checkFunnelCompletion(e)}},{key:"validateFunnelState",value:function validateFunnelState(){var e={hasFailed:!1,hasWarnings:!1,warnings:[]},t=this.getCurrentSteps().filter(function(e){return e.required});for(var o=0;o<t.length;o++){var l=t[o],u=this.history.indexOf(l.name);if(-1===u)return this.missing=[l.name],e.hasFailed=!0,e;if(o>0){var d=t[o-1];if(this.history.indexOf(d.name)>u)return this.missing=[d.name],e.hasFailed=!0,e}}var f=this.validateDependencies();return f.length>0&&(e.hasWarnings=!0,e.warnings=f,this.outOfOrder=f),e}},{key:"getCurrentSteps",value:function getCurrentSteps(){var e=this.history[this.history.length-1],t=this.funnelSteps.findIndex(function(t){return t.name===e});return this.funnelSteps.slice(0,t+1)}},{key:"validateDependencies",value:function validateDependencies(){var e=this;var t=[];return this.history.forEach(function(o,l){var u;var d=e.funnelSteps.find(function(e){return e.name===o});if(!(null!=(u=null==d?void 0:d.dependencies)&&u.length))return;var f=d.dependencies.find(function(t){return!e.history.includes(t)||e.history.indexOf(t)>l});f&&!e.warned.includes(o)&&(t.push({event:o,missingDependency:f}),e.warned.push(o))}),t}},{key:"checkFunnelCompletion",value:function checkFunnelCompletion(e){var t=this;if(e!==this.funnelSteps[this.funnelSteps.length-1].name)return;this.funnelSteps.filter(function(e){return e.required}).every(function(e){return t.history.includes(e.name)})&&(this.completed=!0,this.logCompletion())}},{key:"handleWarnings",value:function handleWarnings(e){var t=true,o=false,l=void 0;try{for(var u,d=e[Symbol.iterator]();!(t=(u=d.next()).done);t=true){var f=u.value;console.warn("⚠️ [".concat(this.constructor.name,"] Event ").concat(f.event," is out of order. Missing: ").concat(f.missingDependency))}}catch(e){o=true,l=e}finally{try{if(!t&&null!=d.return)d.return()}finally{if(o)throw l}}}},{key:"logValidationError",value:function logValidationError(){var e=this.constructor.name;this.missing.length&&console.error("⚠️ [".concat(e,"] Missing required: ").concat(this.missing.join(", "))),console.debug("ℹ️ [".concat(e,"] History:"),this.history)}},{key:"logCompletion",value:function logCompletion(){var e=this.constructor.name;this.outOfOrder.length>0?console.warn("⚠️ [".concat(e,"] Completed with out of order events:"),{history:this.history,outOfOrder:this.outOfOrder}):console.info("\uD83C\uDFAF [".concat(e,"] Completed"),{history:this.history})}},{key:"debugLog",value:function debugLog(){for(var e,t=arguments.length,o=new Array(t),l=0;l<t;l++)o[l]=arguments[l];this.debug&&(e=console).debug.apply(e,["\uD83D\uDD0D [".concat(this.constructor.name,"]")].concat(_to_consumable_array(o)))}},{key:"isFunnelCompleted",value:function isFunnelCompleted(){return this.completed}},{key:"isFunnelFailed",value:function isFunnelFailed(){return this.failed}},{key:"getEventHistory",value:function getEventHistory(){return _to_consumable_array(this.history)}},{key:"getMissingEvents",value:function getMissingEvents(){return _to_consumable_array(this.missing)}},{key:"getOutOfOrderEvents",value:function getOutOfOrderEvents(){return _to_consumable_array(this.outOfOrder)}}]),hn}();c(eA,"BaseFunnel");var ew=/*#__PURE__*/function(e){function un(){var e;return _class_call_check(this,un),e=_call_super(this,un,arguments),h(e,"debug",!1),h(e,"funnelSteps",[{name:em.AD_INIT,required:!0,payload:{service:"adsense"},description:"Init adsense ad"},{name:em.AD_LOAD_FAILED,required:!1,payload:{service:e.service},description:"Platform ad load failed (trigger for adsense)"},{name:em.AD_LOAD,required:!0,payload:{service:"adsense"},description:"Start loading adsense ad"},{name:em.AD_LOAD_FAILED,required:!1,dependencies:[em.AD_LOAD],payload:{service:"adsense"},description:"Adsense ad load failed"},{name:em.AD_SHOWING,required:!0,dependencies:[em.AD_LOAD],payload:{service:"adsense"},description:"Adsense ad is showing"},{name:em.AD_SHOW,required:!1,dependencies:[em.AD_SHOWING],payload:{service:"adsense"},description:"Adsense ad shown successfully"},{name:em.AD_SHOW_FAILED,required:!1,dependencies:[em.AD_SHOWING],payload:{service:"adsense"},description:"Adsense ad show failed"},{name:em.AD_LOAD,required:!1,payload:{service:"adsense"},description:"Preload adsense ad"}]),e}return _inherits(un,e),_create_class(un,[{key:"service",get:function get(){var e;return null!==(e=null==GameSDK?void 0:GameSDK.getSDKName())&&void 0!==e?e:"GameCore"}},{key:"addEvent",value:function addEvent(e,t){((null==t?void 0:t.service)==="adsense"||e===em.AD_LOAD_FAILED&&(null==t?void 0:t.service)==="platform")&&_get(_get_prototype_of(un.prototype),"addEvent",this).call(this,e,t)}}]),un}(eA);c(ew,"AdsenseFunnel");var eD=/*#__PURE__*/function(e){function pn(){var e;return _class_call_check(this,pn),e=_call_super(this,pn,arguments),h(e,"debug",!1),h(e,"funnelSteps",[{name:em.APP_LAUNCH,required:!0,description:"Application launched"},{name:em.APP_INITIALIZED,required:!0,dependencies:[em.APP_LAUNCH],description:"Application initialized"},{name:em.ENGINE_READY,required:!0,dependencies:[em.APP_INITIALIZED],description:"Game engine initialized"},{name:em.LOAD_START,required:!0,dependencies:[em.ENGINE_READY],description:"Start loading game assets"},{name:em.LOAD_COMPLETE,required:!0,dependencies:[em.LOAD_START],description:"Game assets loaded completely"},{name:em.APP_READY,required:!0,dependencies:[em.LOAD_COMPLETE],description:"Game is ready to play"}]),e}return _inherits(pn,e),pn}(eA);c(eD,"CorecosFunnel");var eI=/*#__PURE__*/function(e){function yn(){var e;return _class_call_check(this,yn),e=_call_super(this,yn,arguments),h(e,"debug",!1),h(e,"funnelSteps",[{name:em.AD_INIT,required:!0,payload:{service:e.service},description:"Init platform ad"},{name:em.AD_LOAD,required:!0,payload:{service:e.service},description:"Start loading platform ad"},{name:em.AD_LOAD_FAILED,required:!1,dependencies:[em.AD_LOAD],payload:{service:e.service},description:"Platform ad load failed"},{name:em.AD_SHOWING,required:!0,dependencies:[em.AD_LOAD],payload:{service:e.service},description:"Platform ad is showing"},{name:em.AD_SHOW,required:!1,dependencies:[em.AD_SHOWING],payload:{service:e.service},description:"Platform ad shown successfully"},{name:em.AD_SHOW_FAILED,required:!1,dependencies:[em.AD_SHOWING],payload:{service:e.service},description:"Platform ad show failed"},{name:em.AD_LOAD,required:!1,payload:{service:e.service},description:"Preload platform ad"}]),e}return _inherits(yn,e),_create_class(yn,[{key:"service",get:function get(){var e;return null!==(e=null==GameSDK?void 0:GameSDK.getSDKName())&&void 0!==e?e:"GameCore"}},{key:"addEvent",value:function addEvent(e,t){(null==t?void 0:t.service)===this.service&&_get(_get_prototype_of(yn.prototype),"addEvent",this).call(this,e,t)}}]),yn}(eA);c(eI,"PlatformAdsFunnel");var eb=o.Utils,eS=eb.String,ek=eb.Valid;var eP=(c(m=/*#__PURE__*/function(){function Ue(e,t,o){_class_call_check(this,Ue),h(this,"game"),h(this,"name"),h(this,"color"),h(this,"options"),h(this,"selfLog"),h(this,"currentPath"),this.game=e,this.name=t,this.options=o,this.color=o.color||"#FFF",this.selfLog=o.log,this.currentPath="/",console.info("%c".concat(this.name,": init"),"color: ".concat(this.color),this.options)}return _create_class(Ue,[{key:"event",value:function event(e,t){this.logInfo("event",{name:e,payload:t});var o=this.formatEventName(e);this.processEvent(o,t)}},{key:"logInfo",value:function logInfo(e,t){this.selfLog&&console.info("%c".concat(this.name,": ").concat(e),"color: ".concat(this.color),t)}},{key:"pageview",value:function pageview(e){var t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),document.title=t,this.event(em.PAGE_VIEW,{path_path:e,page_title:t})}},{key:"levelStart",value:function levelStart(e,t,o){this.event(em.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e),game_mode:o?eS.toUpperCamelCase(o):void 0})}},{key:"levelFail",value:function levelFail(e,t,o){this.event(em.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e),game_mode:o?eS.toUpperCamelCase(o):void 0})}},{key:"levelRescue",value:function levelRescue(e,t,o){this.event(em.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e),game_mode:o?eS.toUpperCamelCase(o):void 0})}},{key:"levelComplete",value:function levelComplete(e,t,o){this.event(em.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e),game_mode:o?eS.toUpperCamelCase(o):void 0})}},{key:"initAdEvent",value:function initAdEvent(e){var t=e.adService,o=e.state;this.event(em.AD_INIT,{ad_service:t,state:o})}},{key:"loadAdEvent",value:function loadAdEvent(e){var t=e.type,o=e.placement,l=e.service;this.event(em.AD_LOAD,{ad_type:t,screen_name:o,ad_service:l})}},{key:"showAdEvent",value:function showAdEvent(e){var t=e.type,o=e.placement,l=e.service;this.event(em.AD_SHOW,{ad_type:t,screen_name:o,ad_service:l})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){var t=e.placement,o=e.service;this.loadAdEvent({type:"interstitial",placement:t,service:o})}},{key:"showInterstitialAd",value:function showInterstitialAd(e){var t=e.placement,o=e.service;this.showAdEvent({type:"interstitial",placement:t,service:o})}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){var t=e.placement,o=e.service;this.loadAdEvent({type:"rewarded_video",placement:t,service:o})}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){var t=e.placement,o=e.service;this.showAdEvent({type:"rewarded_video",placement:t,service:o})}},{key:"receiveVideoReward",value:function receiveVideoReward(e){var t=e.placement,o=e.service;this.event(em.AD_REWARD,{screen_name:t,ad_service:o})}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(e){var t=e.placement,o=e.service;this.loadAdEvent({type:"rewarded_interstitial",placement:t,service:o})}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(e){var t=e.placement,o=e.service;this.showAdEvent({type:"rewarded_interstitial",placement:t,service:o})}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(e){var t=e.placement,o=e.service;this.event(em.AD_REWARD,{screen_name:t,ad_service:o})}},{key:"loadAdFail",value:function loadAdFail(e){var t=e.type,o=e.placement,l=e.service;this.event(em.AD_LOAD_FAILED,{ad_type:t,screen_name:o,ad_service:l})}},{key:"showAdFail",value:function showAdFail(e){var t=e.type,o=e.placement,l=e.service;this.event(em.AD_SHOW_FAILED,{ad_type:t,screen_name:o,ad_service:l})}},{key:"showingAd",value:function showingAd(e){var t=e.type,o=e.placement,l=e.service;this.event(em.AD_SHOWING,{ad_type:t,screen_name:o,ad_service:l})}},{key:"formatEventName",value:function formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(eS.padStart(e.toString(),5,"0"))}},{key:"getPageTitle",value:function getPageTitle(e){var t=e.split("/").pop();if(!ek.isString(t))return e;var o=t.replace(/([-_\s.])/g," $1");return eS.toUpperCamelCase(o)}},{key:"addGameModeToPageTitle",value:function addGameModeToPageTitle(e){var t=this.game.match.getMatchState().mode;return t||(t="Normal"),"".concat(eS.toUpperCamelCase(t),"::").concat(e)}}]),Ue}(),"BaseAnalytics"),m);o.Plugins.Analytics={Events:em,BaseFunnel:eA,BaseAnalytics:eP};var eE=/*#__PURE__*/function(e){function fn(e){var t;return _class_call_check(this,fn),h(t=_call_super(this,fn,[e]),"analytics",[]),h(t,"placement","unknown"),h(t,"funnels",[]),h(t,"pageview",c(function(e){if(!t.isActive())return;t.placement=e;var o=t.getPageByKey(e);var l=true,u=false,d=void 0;try{for(var f,y=t.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.pageview(o)}catch(e){u=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(u)throw d}}t.logFunnelEvent(em.PAGE_VIEW)},"pageview")),t.initFunnels(),t}return _inherits(fn,e),_create_class(fn,[{key:"add",value:function add(e){var t=this.analytics.findIndex(function(t){return t.name===e.name});-1!==t?this.analytics[t]=e:this.analytics.push(e)}},{key:"isActive",value:function isActive(){return this.analytics.length>=1}},{key:"initFunnels",value:function initFunnels(){this.addFunnel(new eD),this.addFunnel(new ew),this.addFunnel(new eI)}},{key:"addFunnel",value:function addFunnel(e){this.funnels.push(e)}},{key:"logFunnelEvent",value:function logFunnelEvent(e,t){var o=true,l=false,u=void 0;try{for(var d,f=this.funnels[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.addEvent(e,t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}}},{key:"event",value:function event(e,t){if(this.isActive()){var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.event(e,t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(e,t)}}},{key:"levelStart",value:function levelStart(e,t,o){if(this.isActive()){var l=true,u=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.levelStart(e,t,o)}catch(e){u=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(u)throw d}}this.logFunnelEvent(em.LEVEL_START,{score:t,mode:o})}}},{key:"levelRescue",value:function levelRescue(e,t,o){if(this.isActive()){var l=true,u=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.levelRescue(e,t,o)}catch(e){u=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(u)throw d}}this.logFunnelEvent(em.LEVEL_RESCUE,{score:t,mode:o})}}},{key:"levelFail",value:function levelFail(e,t,o){if(this.isActive()){var l=true,u=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.levelFail(e,t,o)}catch(e){u=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(u)throw d}}this.logFunnelEvent(em.LEVEL_END,{score:t,mode:o})}}},{key:"levelComplete",value:function levelComplete(e,t,o){if(this.isActive()){var l=true,u=false,d=void 0;try{for(var f,y=this.analytics[Symbol.iterator]();!(l=(f=y.next()).done);l=true)f.value.levelComplete(e,t,o)}catch(e){u=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(u)throw d}}this.logFunnelEvent(em.LEVEL_END,{score:t,mode:o})}}},{key:"initAdEvent",value:function initAdEvent(e){var t=true,o=false,l=void 0;if(this.isActive())try{for(var u,d=this.analytics[Symbol.iterator]();!(t=(u=d.next()).done);t=true)u.value.initAdEvent(e)}catch(e){o=true,l=e}finally{try{if(!t&&null!=d.return)d.return()}finally{if(o)throw l}}}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.loadInterstitialAd(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_LOAD,t)}},{key:"showInterstitialAd",value:function showInterstitialAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.showInterstitialAd(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_SHOW,t)}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.loadRewardedVideoAd(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_LOAD,t)}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.showRewardedVideoAd(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_SHOW,t)}},{key:"receiveVideoReward",value:function receiveVideoReward(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.receiveVideoReward(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_REWARD,t)}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.loadRewardedInterstitialAd(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_LOAD,t)}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.showRewardedInterstitialAd(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_SHOW,t)}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.receiveInterstitialReward(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_REWARD,t)}},{key:"loadAdFail",value:function loadAdFail(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.loadAdFail(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_LOAD_FAILED,t)}},{key:"showAdFail",value:function showAdFail(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.showAdFail(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_SHOW_FAILED,t)}},{key:"showingAd",value:function showingAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(o=(d=f.next()).done);o=true)d.value.showingAd(t)}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(em.AD_SHOWING,t)}},{key:"getPageByKey",value:function getPageByKey(e){var t=e;if(t.indexOf("_")>-1)return t.replace(/_/g,"-").toLowerCase();var o=t.length-1,l="";for(;o>0;){var u=isNaN(parseInt(l=t.charAt(o),10)),d=l===l.toUpperCase();u&&d&&(t="".concat(t.slice(0,o),"-").concat(t.slice(o))),o--}return t.toLowerCase()}}]),fn}(l.Plugins.BasePlugin);c(eE,"AnalyticsPlugin");var eC=/*#__PURE__*/function(){function gn(e){_class_call_check(this,gn),h(this,"key"),this.key=e}return _create_class(gn,[{key:"getKey",value:function getKey(){return this.key}}]),gn}();c(eC,"BaseAudioPlayer");var ex=Object.defineProperty,eT=Object.getOwnPropertyDescriptor,eL=c(function(e,t,o,l){for(var u,d=l>1?void 0:l?eT(t,o):t,f=e.length-1;f>=0;f--)(u=e[f])&&(d=(l?u(t,o,d):u(d))||d);return l&&d&&ex(t,o,d),d},"__decorateClass$2");var eN=o.Utils.Decorator,eO=/*#__PURE__*/function(){function wn(e){_class_call_check(this,wn),h(this,"id"),h(this,"isMuteAll"),h(this,"masterVolume"),h(this,"audioClips"),this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}return _create_class(wn,[{key:"getId",value:function getId(){return this.id}},{key:"getAudioClip",value:function getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}},{key:"setAudioClip",value:function setAudioClip(e,t){this.audioClips[e]=_object_spread({},this.audioClips[e],t)}},{key:"play",value:function play(e,t){var o=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(!(l=o.getAudioClip(e)))return[3,1];return u=l.audioPlayer,o.playWithRealConfig(u,t),[3,3];case 1:return[4,o.loadAndPlay(e,t)];case 2:d.sent(),d.label=3;case 3:return[2]}})})()}},{key:"loadAndPlay",value:function loadAndPlay(e,t){var o=this;return _async_to_generator(function(){var l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return[4,o.onLoadAudio(e,t)];case 1:if(!(l=f.sent()))return[2];return d=void 0===(u=(t||{}).volume)?1:u,o.setAudioClip(e,{volume:d,audioPlayer:l}),o.playWithRealConfig(l,t),[2]}})})()}},{key:"playWithRealConfig",value:function playWithRealConfig(e,t){if(t){var o=t.volume;t.volume=this.masterVolume*(void 0===o?1:o)}e.play(t)}},{key:"pause",value:function pause(e){var t=this.getAudioClip(e);if(!t)return!1;return t.audioPlayer.pause(),!0}},{key:"resume",value:function resume(e){var t=this.getAudioClip(e);if(!t)return!1;return t.audioPlayer.resume(),!0}},{key:"stop",value:function stop(e){var t=this.getAudioClip(e);if(!t)return!1;return t.audioPlayer.stop(),!0}},{key:"stopAll",value:function stopAll(){this.callAudioPlayers("stop")}},{key:"muteAll",value:function muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}},{key:"unmuteAll",value:function unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}},{key:"setVolume",value:function setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}},{key:"getVolume",value:function getVolume(){return this.masterVolume}},{key:"queueAudioPlayer",value:function queueAudioPlayer(e,t){try{var o=e.audioPlayer,l=e.volume;switch(t){case"play":o.play();break;case"pause":o.pause();break;case"resume":o.resume();break;case"stop":o.stop();break;case"mute":o.setVolume(0);break;case"unmute":case"setVolume":o.setVolume(this.masterVolume*(void 0===l?1:l));break;default:throw new Error("Unsupported function: ".concat(t))}}catch(e){console.warn("queueAudioPlayer",e)}}},{key:"callAudioPlayers",value:function callAudioPlayers(e){var t=o.Utils.Object.vals(this.audioClips);var l=true,u=false,d=void 0;try{for(var f,y=t[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;this.queueAudioPlayer(_,e)}}catch(e){u=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(u)throw d}}}}]),wn}();c(eO,"BaseChannelManager"),eL([eN.tryCatch(),eN.validateParams("string")],eO.prototype,"loadAndPlay",1);var eR=Object.defineProperty,eM=Object.getOwnPropertyDescriptor,eF=c(function(e,t,o,l){for(var u,d=l>1?void 0:l?eM(t,o):t,f=e.length-1;f>=0;f--)(u=e[f])&&(d=(l?u(t,o,d):u(d))||d);return l&&d&&eR(t,o,d),d},"__decorateClass$1");o.Plugins.Audio={BaseAudioPlayer:eC,BaseChannelManager:eO};var eG=o.Utils.Decorator,eB=/*#__PURE__*/function(e){function mn(){var e;return _class_call_check(this,mn),e=_call_super(this,mn,arguments),h(e,"firstChannelId"),h(e,"channels",{}),e}return _inherits(mn,e),_create_class(mn,[{key:"addChannel",value:function addChannel(e){var t=e.getId();this.channels[t]=e,this.firstChannelId||(this.firstChannelId=t)}},{key:"getChannel",value:function getChannel(e){if(void 0===e)return this.channels[this.firstChannelId];var t=this.channels[e];if(!t)throw new Error("Channel ".concat(e," not found"));return t}},{key:"play",value:function play(e,t,o){var l=this;return _async_to_generator(function(){return _ts_generator(this,function(u){switch(u.label){case 0:return[4,l.getChannel(o).play(e,t)];case 1:return u.sent(),[2]}})})()}},{key:"pause",value:function pause(e,t){try{this.getChannel(t).pause(e)}catch(e){console.warn("pauseSound",e)}}},{key:"resume",value:function resume(e,t){try{this.getChannel(t).resume(e)}catch(e){console.warn("resumeSound",e)}}},{key:"stop",value:function stop(e,t){try{this.getChannel(t).stop(e)}catch(e){console.warn("stopSound",e)}}},{key:"stopAll",value:function stopAll(e){try{this.getChannel(e).stopAll()}catch(e){console.warn("stopAllSounds",e)}}},{key:"mute",value:function mute(e){try{this.getChannel(e).muteAll()}catch(e){console.warn("mute",e)}}},{key:"unmute",value:function unmute(e){try{this.getChannel(e).unmuteAll()}catch(e){console.warn("unmute",e)}}},{key:"setVolume",value:function setVolume(e,t){try{this.getChannel(t).setVolume(e)}catch(e){console.warn("setSoundVolume",e)}}},{key:"getVolume",value:function getVolume(e){try{return this.getChannel(e).getVolume()}catch(e){return console.warn("getSoundVolume",e),-1}}}]),mn}(l.Plugins.BasePlugin);c(eB,"AudioPlugin"),eF([eG.tryCatch(),eG.validateParams("string")],eB.prototype,"play",1);var ej={token:"",isRequesting:!1},eV=o.Utils.Object,eH=/*#__PURE__*/function(e){function An(){return _class_call_check(this,An),_call_super(this,An,arguments)}return _inherits(An,e),_create_class(An,[{key:"init",value:function init(){this.game.storage.addStorage("auth",ej)}},{key:"requestToken",value:function requestToken(){var e=this;return _async_to_generator(function(){var t,o,l;return _ts_generator(this,function(u){switch(u.label){case 0:t=e.game.storage,u.label=1;case 1:if(u.trys.push([1,3,4,5]),t.getStorageData("auth","isRequesting")||""!==t.getStorageData("auth","token"))return[2];return t.setStorageData("auth","isRequesting",!0),[4,GameSDK.player.getSignedPlayerInfoAsync()];case 2:return o=u.sent().getSignature(),t.setStorageData("auth","token",o),[3,5];case 3:if(l=u.sent(),eV.hasOwn(l,"code")&&"PENDING_REQUEST"===l.code)return[2];return t.setStorageData("auth","token",""),console.error(l),[3,5];case 4:return t.setStorageData("auth","isRequesting",!1),[7];case 5:return[2]}})})()}},{key:"getToken",value:function getToken(){var e;return null!==(e=this.game.storage.getStorageData("auth","token"))&&void 0!==e?e:""}}]),An}(l.Plugins.BasePlugin);c(eH,"AuthPlugin");var eU=function(e){return e.SOLO="solo",e.TOURNAMENT="tournament",e.SHARE_INVITE="share_invite",e.MATCHING_GROUP="matching_group_match",e.CHALLENGE_FRIEND="challenge_friend_match",e}(eU||{});var eK=u,eW=o.Configs,ez=o.Utils,eq=ez.Array,eY=ez.Valid,eJ=ez.Browser,eQ=/*#__PURE__*/function(){function Dn(e){_class_call_check(this,Dn),h(this,"game"),this.game=e}return _create_class(Dn,[{key:"isValidContextType",value:function isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}},{key:"isValidEntryPointData",value:function isValidEntryPointData(e){return eY.isObject(e)}},{key:"isTournamentEntryPoint",value:function isTournamentEntryPoint(e){return eq.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],e)}},{key:"receiveContext",value:function receiveContext(e,t,o){var l=this.game.storage;l.setStorageData("context","contextId",e),this.isValidEntryPointData(o)?l.setStorageData("context","entryPointData",o):console.warn("Invalid context type: ".concat(t)),this.isValidContextType(t)?l.setStorageData("context","contextType",t):console.warn("Invalid context type: ".concat(t))}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t,o,l,u,d,f,y,_,p,v;return _ts_generator(this,function(v){switch(v.label){case 0:if(l=(null!=(o=(t=e.game.storage).getStorageData("context","entryPointData"))?o:{}).type,u=eU.SOLO,d=eU.TOURNAMENT,f=eU.MATCHING_GROUP,y=eU.SHARE_INVITE,_=eU.CHALLENGE_FRIEND,p=u,l===d&&(p=d),l===f&&(p=f),(l===_||l===y)&&(p=_),p!==u)return[3,4];if(!eW.Core.FastCheckTournamentContext)return[3,1];return p=e.fastCheckTournamentContext()||p,[3,3];case 1:return[4,e.outdatedCheckTournamentContext()];case 2:p=v.sent()||p,v.label=3;case 3:v.label=4;case 4:return t.setStorageData("context","sessionContextType",p),[2]}})})()}},{key:"fastCheckTournamentContext",value:function fastCheckTournamentContext(){var e=eJ.getQueryParams().entry_point;return!!("string"==typeof e&&this.isTournamentEntryPoint(e))&&eU.TOURNAMENT}},{key:"outdatedCheckTournamentContext",value:function outdatedCheckTournamentContext(){var e=this;return _async_to_generator(function(){var t,o;return _ts_generator(this,function(l){switch(l.label){case 0:if(t=e.game.storage,!("getTournamentAsync"in GameSDK))return[2,!1];l.label=1;case 1:return l.trys.push([1,3,,4]),[4,GameSDK.getTournamentAsync()];case 2:return o=l.sent(),[2,(t.setStorageData("context","contextId",o.getContextID()),o.getEndTime()>Date.now()/1e3&&eU.TOURNAMENT)];case 3:return[2,(console.warn("outdatedCheckTournamentContext",l.sent()),!1)];case 4:return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){var e=this.game,t=e.player,o=e.storage,l=o.getStorageData("context","entryPointData"),u=o.getStorageData("context","sessionContextType"),d=t.getPlayerId(),f=null!=l?l:{},y=f.matchId,_=f.playerId,p=f.opponentId,v=void 0===p?M.playerId:p,g=d===_,m=v===M.playerId||[v,_].indexOf(d)>=0,A=eU.TOURNAMENT,w=eU.MATCHING_GROUP,D=eU.SHARE_INVITE,I=eU.CHALLENGE_FRIEND;var b=eK.SINGLE;u===A&&(b=eK.TOURNAMENT),u!==D||g||(b=eK.CHALLENGE_FRIEND),u===I&&y&&m&&(b=eK.CHALLENGE_FRIEND),u===w&&(b=eK.MATCHING_GROUP),o.setStorageData("context","contextGameMode",b)}}]),Dn}();c(eQ,"Context");var eX=/*#__PURE__*/function(e){function In(e){var t;return _class_call_check(this,In),(t=_call_super(this,In,[e])).name="PlayerHasFinishedMatch",t.message=null!=e?e:"Player has finished match",t}return _inherits(In,e),In}(_wrap_native_super(Error));c(eX,"PlayerHasFinishedMatch");var e$=/*#__PURE__*/function(e){function vn(e){var t;return _class_call_check(this,vn),(t=_call_super(this,vn,[e])).name="PlayerNotJoinInMatch",t.message=e||"Player is not join in match",t}return _inherits(vn,e),vn}(_wrap_native_super(Error));c(e$,"PlayerNotJoinInMatch");var eZ=o.Events,e0=o.Plugins.Analytics,e2=o.Utils.Valid,e3=/*#__PURE__*/function(){function Pn(e){_class_call_check(this,Pn),h(this,"game"),this.game=e}return _create_class(Pn,[{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t,o,l,u,d,f,y,_,p,v,g,m,A,w,D,I,b,S,k,P,E;return _ts_generator(this,function(C){switch(C.label){case 0:if(d=(u=e.game).player,f=u.storage,y=u.monitorError,_=null!==(t=f.getStorageData("context","contextId"))&&void 0!==t?t:"",p=null!==(o=f.getStorageData("context","entryPointData"))&&void 0!==o?o:{},v=null!==(l=f.getStorageData("context","sessionContextType"))&&void 0!==l?l:"",g=p.type,m=p.matchId,A=p.playerId,w=p.opponentId,D=p.playerScore,!(I=p.action))return[3,2];return[4,e.processEntryPointAction(I)];case 1:C.sent(),C.label=2;case 2:if(b=d.isFirstLogin(),setTimeout(function(){e.logUserAnalytics(b)},1e3),S=eU.TOURNAMENT,k=eU.SHARE_INVITE,P=eU.MATCHING_GROUP,E=eU.CHALLENGE_FRIEND,v!==S)return[3,6];C.label=3;case 3:return C.trys.push([3,5,,6]),[4,e.processTournamentModeAsync(_)];case 4:return C.sent(),[2];case 5:return C.sent(),null==y||y.sendException(new Error("Process Tournament Fail"),{contextId:_,isFirstLogin:b,entryPointData:p,playerData:d.getPlayerData()}),[3,6];case 6:if(v!==E)return[3,10];if(!(g===k&&"string"==typeof A))return[3,8];return[4,e.processChallengeFromPostAsync(A)];case 7:return C.sent(),[2];case 8:if(!(g===E&&"string"==typeof m&&"string"==typeof A&&"string"==typeof w))return[3,10];return[4,e.processChallengeFromMessageAsync({contextId:_,matchId:m,playerId:A,opponentId:w})];case 9:return C.sent(),[2];case 10:if(!(v===P&&"string"==typeof A&&"number"==typeof D))return[3,12];return[4,e.processMatchingGroupModeAsync(A,D)];case 11:return C.sent(),[2];case 12:if(!b)return[3,14];return[4,e.processSingleModeAsync(!0)];case 13:return C.sent(),d.loggedIn(),[2];case 14:return e.switchToDashboardScene(),[2]}})})()}},{key:"logUserAnalytics",value:function logUserAnalytics(e){try{var t=this.game,o=t.player,l=t.analytics;if(e)l.event(e0.Events.NEW_USER);else{var u=o.getPlayerData().gameData.coins;l.event(e0.Events.RETURNING_USER,{coins:u})}}catch(e){}}},{key:"processEntryPointAction",value:function processEntryPointAction(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:switch(l.trys.push([0,7,,8]),o=t.game.player,e){case"reset_data":return[3,1];case"enable_debug":return[3,3];case"set_locale_en":return[3,4];case"set_locale_ru":return[3,5]}return[3,6];case 1:return o.setPlayerDataByName("score",0),o.setPlayerDataByName("endlessScore",0),o.setGameData({coins:0,level:1}),[4,o.syncProfileToServer()];case 2:return l.sent(),[3,6];case 3:return o.setPlayerDataByName("debug",!0),[3,6];case 4:return t.requestSetLocale("en"),[3,6];case 5:return t.requestSetLocale("ru"),[3,6];case 6:return[3,8];case 7:return console.warn("processEntryPointAction",l.sent()),[3,8];case 8:return[2]}})})()}},{key:"requestSetLocale",value:function requestSetLocale(e){this.game.event.emit(eZ.REQUEST_LANGUAGE,{locale:e})}},{key:"processTournamentModeAsync",value:function processTournamentModeAsync(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(l=(o=t.game).match,u=o.player.getPlayerId(),e2.isEmpty(e))throw new Error("Cannot get contextId");return[4,l.tournament.continue.processAsync({playerId:u,contextId:e})];case 1:return d.sent(),t.switchToGameScene(),[2]}})})()}},{key:"processChallengeFromPostAsync",value:function processChallengeFromPostAsync(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(l=(o=t.game).match,(u=o.player.getPlayerId())!==e)return[3,2];return[4,l.single.start.processAsync({playerId:u})];case 1:return d.sent(),[3,6];case 2:return d.trys.push([2,4,,6]),[4,l.challenge.friend.processAsync({playerId:u,opponentId:e})];case 3:return d.sent(),[3,6];case 4:return console.warn("processChallengeFromPostAsync",d.sent()),[4,l.single.start.processAsync({playerId:u})];case 5:return d.sent(),[3,6];case 6:return t.switchToGameScene(),[2]}})})()}},{key:"processChallengeFromMessageAsync",value:function processChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,7]),[4,t.processContinueChallengeFromMessageAsync(e)];case 1:return l.sent(),[3,7];case 2:if(console.warn("processContinueChallengeFromMessageAsync",o=l.sent()),!_instanceof(o,eX))return[3,4];return[4,t.processAwaitChallengeFromMessageAsync(e)];case 3:return l.sent(),[2];case 4:if(!_instanceof(o,e$))return[3,6];return[4,t.processJoinChallengeFromMessageAsync(e)];case 5:return l.sent(),[2];case 6:return t.switchToDashboardScene(),[3,7];case 7:return[2]}})})()}},{key:"processContinueChallengeFromMessageAsync",value:function processContinueChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p;return _ts_generator(this,function(v){switch(v.label){case 0:if(o=e.contextId,l=e.matchId,u=e.playerId,d=e.opponentId,y=(f=t.game).match,_=f.player.getPlayerId(),u!==_)return[3,2];return[4,y.challenge.continue.processAsync({contextId:o,matchId:l,playerId:_,opponentId:d})];case 1:return v.sent(),[3,4];case 2:return p=d===M.playerId,[4,y.challenge.continue.processAsync({contextId:o,matchId:l,playerId:_,opponentId:p?d:u})];case 3:v.sent(),v.label=4;case 4:return t.switchToGameScene(),[2]}})})()}},{key:"processJoinChallengeFromMessageAsync",value:function processJoinChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return o=e.contextId,l=e.matchId,u=e.playerId,f=(d=t.game).match,y=d.player.getPlayerId(),[4,f.challenge.join.processAsync({contextId:o,matchId:l,playerId:y,opponentId:u})];case 1:return _.sent(),t.switchToGameScene(),[2]}})})()}},{key:"processAwaitChallengeFromMessageAsync",value:function processAwaitChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:o=e.contextId,l=e.matchId,u=e.playerId,f=(d=t.game).match,y=d.player.getPlayerId(),_.label=1;case 1:return _.trys.push([1,3,,5]),[4,f.challenge.await.processAsync({contextId:o,matchId:l,playerId:y,opponentId:u})];case 2:return _.sent(),t.switchToChallengeResultScene(),[3,5];case 3:return console.warn("processAwaitChallengeFromMessageAsync",_.sent()),[4,t.processResultChallengeFromMessageAsync(e)];case 4:return _.sent(),[3,5];case 5:return[2]}})})()}},{key:"processResultChallengeFromMessageAsync",value:function processResultChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:o=e.contextId,l=e.matchId,u=e.playerId,f=(d=t.game).match,y=d.player.getPlayerId(),_.label=1;case 1:return _.trys.push([1,3,,4]),[4,f.challenge.result.processAsync({contextId:o,matchId:l,playerId:y,opponentId:u})];case 2:return _.sent(),t.switchToChallengeResultScene(),[3,4];case 3:return _.sent(),t.switchToDashboardScene(),[3,4];case 4:return[2]}})})()}},{key:"processMatchingGroupModeAsync",value:function processMatchingGroupModeAsync(e,t){var o=this;return _async_to_generator(function(){var l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return u=(l=o.game).match,d=l.player,[4,u.group.join.processAsync({playerId:d.getPlayerId(),opponentId:e,opponentScore:t})];case 1:return f.sent(),o.switchToGameScene(),[2]}})})()}},{key:"processSingleModeAsync",value:function processSingleModeAsync(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(l=(o=t.game).match,u=o.player.getPlayerId(),!e)return[3,2];return[4,l.handler.setMatchCustomData({level:0})];case 1:d.sent(),d.label=2;case 2:return[4,l.single.start.processAsync({playerId:u})];case 3:return d.sent(),t.switchToGameScene(),[2]}})})()}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){this.game.event.emit(eZ.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}},{key:"switchToGameScene",value:function switchToGameScene(){this.game.event.emit(eZ.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}},{key:"switchToChallengeResultScene",value:function switchToChallengeResultScene(){this.game.event.emit(eZ.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}}]),Pn}();c(e3,"Loader");var e1={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},e4=o.Events,e5=/*#__PURE__*/function(e){function En(e){var t;return _class_call_check(this,En),h(t=_call_super(this,En,[e]),"context"),h(t,"loader"),t.loader=new e3(e),t.context=new eQ(e),t}return _inherits(En,e),_create_class(En,[{key:"init",value:function init(){this.game.storage.addStorage("context",e1)}},{key:"getSessionContextTypes",value:function getSessionContextTypes(){return eU}},{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t,o,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:o=(t=e.game).event,l=t.monitorError,f.label=1;case 1:if(f.trys.push([1,5,,6]),o.getEventEmitCount(e4.CONTEXT_SESSION_TYPE_DETECTED)>0)return[3,3];return[4,o.waitTo(e4.CONTEXT_SESSION_TYPE_DETECTED,3e3)];case 2:f.sent(),f.label=3;case 3:return[4,e.loader.processContextData()];case 4:return f.sent(),o.emit(e4.CONTEXT_DATA_PROCESSED),[3,6];case 5:if(console.debug("processContextData",u=f.sent()),e.switchToDashboardScene(),l)d=_instanceof(u,Error)?u:new Error(JSON.stringify(u)),l.sendException(d);return[3,6];case 6:return[2]}})})()}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t,o,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:o=(t=e.game).event,l=t.monitorError,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,e.context.detectContextSessionType()];case 2:return f.sent(),o.emit(e4.CONTEXT_SESSION_TYPE_DETECTED),[3,4];case 3:if(console.debug("detectContextSessionType",u=f.sent()),l)d=_instanceof(u,Error)?u:new Error(JSON.stringify(u)),l.sendException(d);return[3,4];case 4:return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){this.context.detectContextGameMode()}},{key:"receiveContext",value:function receiveContext(e,t,o){this.context.receiveContext(e,t,o)}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){this.game.event.emit(e4.SWITCH_SCENE,{sceneName:"DashboardScene"})}}]),En}(l.Plugins.BasePlugin);c(e5,"ContextPlugin");var e6=o.Utils.Valid,e7=e1.contextId,e8=e1.contextType,e9=e1.entryPointData,te="is invalid",tt=/*#__PURE__*/function(e){function Sn(){var e;return _class_call_check(this,Sn),e=_call_super(this,Sn,arguments),h(e,"data"),e}return _inherits(Sn,e),_create_class(Sn,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateContextId",value:function validateContextId(e){e6.isString(e)||this.exception("contextId",te)}},{key:"validateContextType",value:function validateContextType(e){e6.isString(e)&&e||this.exception("contextType",te)}},{key:"validateEntryPointData",value:function validateEntryPointData(e){e6.isObject(e)||this.exception("entryPointData",te)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Sn.prototype),"toObject",this).call(this)}}]),Sn}(k);c(tt,"ContextInfoDtos"),tt.addDefaultData({contextId:e7,contextType:e8,entryPointData:e9}),o.Dtos.Context={Info:tt};var tn={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},ta=o.Utils.Object,ts=/*#__PURE__*/function(){function xn(){_class_call_check(this,xn)}return _create_class(xn,[{key:"getDailyRewardsAsync",value:function getDailyRewardsAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,ta.vals(tn)]})})()}}]),xn}();c(ts,"DailyRewardsAPI");var to={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},tc={dailyRewards:{}},tl=o.Configs.DailyRewards,tu=tl.CheckInterrupt,td=tl.MaxDays,th=tl.MockTime,tf=o.Utils,ty=tf.Array,t_=tf.Valid,tp=th>0?th:864e5,tv=/*#__PURE__*/function(e){function bn(){var e;return _class_call_check(this,bn),e=_call_super(this,bn,arguments),h(e,"dailyRewardsApi",new ts),e}return _inherits(bn,e),_create_class(bn,[{key:"init",value:function init(){this.game.storage.addStorage("dailyRewards",tc)}},{key:"requestDailyRewardsAsync",value:function requestDailyRewardsAsync(){var e=this;return _async_to_generator(function(){var t,o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return[4,e.dailyRewardsApi.getDailyRewardsAsync()];case 1:return t=d.sent(),l=(o=e.parseDailyRewards(t)).logs,u=o.rewards,e.setRewardsLog(l),e.setDailyRewards(u),[2]}})})()}},{key:"getDailyRewards",value:function getDailyRewards(){return this.game.storage.getStorageData("dailyRewards","dailyRewards")||null}},{key:"logLoginReward",value:function logLoginReward(){tu?this.logFromFirstReward():this.logFromLastReward()}},{key:"logFromFirstReward",value:function logFromFirstReward(){var e=this.game.player.getPlayerData().dailyRewarded,t=e.logDays,o=e.firstReward,l=new Date,u=_to_consumable_array(t);if(0===o){u[0]=!0,t_.isDebugger()||l.setHours(0,0,0,0),this.setRewardsLog({logDays:u,firstReward:l.valueOf(),lastReward:l.valueOf()});return}var d=Math.floor((l.valueOf()-o)/tp);d>=td||d>=t.length||(u[d]=!0,t_.isDebugger()||l.setHours(0,0,0,0),this.setRewardsLog({logDays:u,lastReward:l.valueOf()}))}},{key:"logFromLastReward",value:function logFromLastReward(){var e=this.game.player.getPlayerData().dailyRewarded,t=e.logDays,o=e.lastReward,l=new Date,u=_to_consumable_array(t);if(0===o){u[0]=!0,t_.isDebugger()||l.setHours(0,0,0,0),this.setRewardsLog({logDays:u,firstReward:l.valueOf(),lastReward:l.valueOf()});return}if(Math.floor((l.valueOf()-o)/tp)<1)return;var d=ty.searchIndex(u,function(e){return!1===e});void 0!==d&&(u[d]=!0,t_.isDebugger()||l.setHours(0,0,0,0),this.setRewardsLog({logDays:u,lastReward:l.valueOf()}))}},{key:"setRewardsLog",value:function setRewardsLog(e){var t=e.logDays,o=e.firstReward,l=e.lastReward,u=this.game.player,d=u.getPlayerData().dailyRewarded;u.setPlayerDataByName("dailyRewarded",{logDays:void 0!==t?_to_consumable_array(t):_to_consumable_array(d.logDays),firstReward:null!=o?o:d.firstReward,lastReward:null!=l?l:d.lastReward})}},{key:"parseDailyRewards",value:function parseDailyRewards(e){var t=this.game.player.getPlayerData().dailyRewarded,o=t.logDays,l=t.firstReward,u=t.lastReward;if(void 0===o||void 0===l||0===l||void 0===u||0===u||o.length!==e.length){var d=this.getDefaultDailyRewards(e);return{logs:{logDays:d.logDays,firstReward:0,lastReward:0},rewards:d.rewards}}return tu?this.parseFromFirstReward(e,o,l,u):this.parseFromLastReward(e,o,l,u)}},{key:"parseFromFirstReward",value:function parseFromFirstReward(e,t,o,l){var u=Date.now()-o;if(u<0){var d=this.getDefaultDailyRewards(e);return{logs:{logDays:d.logDays,firstReward:0,lastReward:0},rewards:d.rewards}}var f=Math.floor(u/tp),y=f>=td||f>=t.length,_=void 0!==ty.search(t.slice(0,f),function(e){return!1===e});if(y||_){var p=this.getDefaultDailyRewards(e);return{logs:{logDays:p.logDays,firstReward:0,lastReward:l},rewards:p.rewards}}var v=[],g={};for(var m=0;m<e.length;m++){var A=e[m],w=v.length>f,D=v.length===f,I=t[m];if(w){v.push(!1),g[A.id]=_object_spread_props(_object_spread({},A),{status:to.WAITING});continue}if(v.push(I),D){g[A.id]=_object_spread_props(_object_spread({},A),{status:I?to.REWARDED:to.READY});continue}g[A.id]=_object_spread_props(_object_spread({},A),{status:I?to.REWARDED:to.SKIPPED})}return{logs:{logDays:v,firstReward:o,lastReward:l},rewards:g}}},{key:"parseFromLastReward",value:function parseFromLastReward(e,t,o,l){var u=Date.now()-l;if(u<0){var d=this.getDefaultDailyRewards(e);return{logs:{logDays:d.logDays,firstReward:0,lastReward:0},rewards:d.rewards}}var f=Math.floor(u/tp)>=1,y=ty.searchIndex(t,function(e){return!1===e});if(-1===y&&f){var _=this.getDefaultDailyRewards(e);return _.rewards[e[0].id].status=f?to.READY:to.WAITING,{logs:{logDays:_.logDays,firstReward:0,lastReward:l},rewards:_.rewards}}var p=[],v={};for(var g=0,m=e.length;g<m;g++){var A=e[g],w=-1!==y&&g>y,D=g===y;if(w){p.push(!1),v[A.id]=_object_spread_props(_object_spread({},A),{status:to.WAITING});continue}if(D){p.push(!1),v[A.id]=_object_spread_props(_object_spread({},A),{status:f?to.READY:to.WAITING});continue}p.push(!0),v[A.id]=_object_spread_props(_object_spread({},A),{status:to.REWARDED})}return{logs:{logDays:p,firstReward:o,lastReward:l},rewards:v}}},{key:"getDefaultDailyRewards",value:function getDefaultDailyRewards(e){var t=[],o={};var l=true,u=false,d=void 0;try{for(var f,y=e[Symbol.iterator]();!(l=(f=y.next()).done);l=true){var _=f.value;t.push(!1),o[_.id]=_object_spread_props(_object_spread({},_),{status:to.WAITING})}}catch(e){u=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(u)throw d}}return o[e[0].id].status=to.READY,{logDays:t,rewards:o}}},{key:"setDailyRewards",value:function setDailyRewards(e){this.game.storage.setStorageData("dailyRewards","dailyRewards",e)}}]),bn}(l.Plugins.BasePlugin);c(tv,"DailyRewardsPlugin");var tg={exports:{}};tg.exports,function(e){var t=Object.prototype.hasOwnProperty,o="~";function s(){}function a(e,t,o){this.fn=e,this.context=t,this.once=o||!1}function n(e,t,l,u,d){if("function"!=typeof l)throw new TypeError("The listener must be a function");var f=new a(l,u||e,d),y=o?o+t:t;return e._events[y]?e._events[y].fn?e._events[y]=[e._events[y],f]:e._events[y].push(f):(e._events[y]=f,e._eventsCount++),e}function i(e,t){0===--e._eventsCount?e._events=new s:delete e._events[t]}function r(){this._events=new s,this._eventsCount=0}c(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(o=!1)),c(a,"EE"),c(n,"addListener"),c(i,"clearEvent"),c(r,"EventEmitter"),r.prototype.eventNames=c(function(){var e,l,u=[];if(0===this._eventsCount)return u;for(l in e=this._events)t.call(e,l)&&u.push(o?l.slice(1):l);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(e)):u},"eventNames"),r.prototype.listeners=c(function(e){var t=o?o+e:e,l=this._events[t];if(!l)return[];if(l.fn)return[l.fn];for(var u=0,d=l.length,f=new Array(d);u<d;u++)f[u]=l[u].fn;return f},"listeners"),r.prototype.listenerCount=c(function(e){var t=o?o+e:e,l=this._events[t];return l?l.fn?1:l.length:0},"listenerCount"),r.prototype.emit=c(function(e,t,l,u,d,f){var y=o?o+e:e;if(!this._events[y])return!1;var _,p,v=this._events[y],g=arguments.length;if(v.fn){switch(v.once&&this.removeListener(e,v.fn,void 0,!0),g){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,t),!0;case 3:return v.fn.call(v.context,t,l),!0;case 4:return v.fn.call(v.context,t,l,u),!0;case 5:return v.fn.call(v.context,t,l,u,d),!0;case 6:return v.fn.call(v.context,t,l,u,d,f),!0}for(p=1,_=new Array(g-1);p<g;p++)_[p-1]=arguments[p];v.fn.apply(v.context,_)}else{var m,A=v.length;for(p=0;p<A;p++)switch(v[p].once&&this.removeListener(e,v[p].fn,void 0,!0),g){case 1:v[p].fn.call(v[p].context);break;case 2:v[p].fn.call(v[p].context,t);break;case 3:v[p].fn.call(v[p].context,t,l);break;case 4:v[p].fn.call(v[p].context,t,l,u);break;default:if(!_)for(m=1,_=new Array(g-1);m<g;m++)_[m-1]=arguments[m];v[p].fn.apply(v[p].context,_)}}return!0},"emit"),r.prototype.on=c(function(e,t,o){return n(this,e,t,o,!1)},"on"),r.prototype.once=c(function(e,t,o){return n(this,e,t,o,!0)},"once"),r.prototype.removeListener=c(function(e,t,l,u){var d=o?o+e:e;if(!this._events[d])return this;if(!t)return i(this,d),this;var f=this._events[d];if(f.fn)f.fn!==t||u&&!f.once||l&&f.context!==l||i(this,d);else{for(var y=0,_=[],p=f.length;y<p;y++)(f[y].fn!==t||u&&!f[y].once||l&&f[y].context!==l)&&_.push(f[y]);_.length?this._events[d]=1===_.length?_[0]:_:i(this,d)}return this},"removeListener"),r.prototype.removeAllListeners=c(function(e){var t;return e?(t=o?o+e:e,this._events[t]&&i(this,t)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=o,r.EventEmitter=r,e.exports=r}(tg);var tm=tg.exports;var tA=new(_(tm)),tw={names:[],history:[]},tD=/*#__PURE__*/function(e){function Cn(){var e;return _class_call_check(this,Cn),e=_call_super(this,Cn,arguments),h(e,"enableLog",!1),h(e,"muteEvents",[]),e}return _inherits(Cn,e),_create_class(Cn,[{key:"init",value:function init(){this.game.storage.addStorage("event",tw)}},{key:"enableLogEvent",value:function enableLogEvent(){this.enableLog=!0}},{key:"on",value:function on(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"on","listening"),tA.on(e,t)}},{key:"once",value:function once(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"once","listening"),tA.once(e,t)}},{key:"waitTo",value:function waitTo(e,t){var o=this;return new Promise(function(l,u){var d;var f=c(function(e){clearTimeout(d),l(e)},"callback");o.once(e,f),t&&t>0&&(d=setTimeout(function(){o.off(e,f),u(new Error("Event ".concat(e," timeout")))},t))})}},{key:"catchUp",value:function catchUp(e,t){if(this.validateCallback(t),this.once(e,t),!(this.getEventEmitCount(e)>0))return;var o,l=(null!==(o=this.getLastEventInfo(e))&&void 0!==o?o:{}).payload;this.emit(e,l)}},{key:"off",value:function off(e,t){this.validateCallback(t),tA.off(e,t),this.addHistory(e,"action","removed")}},{key:"mute",value:function mute(e){this.muteEvents.indexOf(e)>-1||this.muteEvents.push(e)}},{key:"clear",value:function clear(e){tA.removeAllListeners(e),this.addHistory(e,"action","removed")}},{key:"emit",value:function emit(e,t){if(this.muteEvents.indexOf(e)>-1)return;var o=[];t&&(o=[t]),this.addHistory(e,"action","called",t),tA.emit.apply(tA,[e].concat(_to_consumable_array(o)))}},{key:"validateCallback",value:function validateCallback(e){if("function"!=typeof e)throw new Error("Callback must be a function")}},{key:"addEventName",value:function addEventName(e){var t=this.game.storage.getStorageData("event","names");t&&t.indexOf(e)<0&&t.push(e)}},{key:"limitHistory",value:function limitHistory(e){if(e.length<=1e4)return e;return o.Utils.Array.limit(e,1e4)}},{key:"getEventListeners",value:function getEventListeners(){return Object.keys(tA.eventNames())}},{key:"getHistory",value:function getHistory(){var e;var t=null!==(e=this.game.storage.getStorageData("event","history"))&&void 0!==e?e:[];return this.limitHistory(t)}},{key:"getEventEmitCount",value:function getEventEmitCount(e){return this.getHistory().filter(function(t){return t.name===e&&"called"===t.status}).length}},{key:"getLastEventInfo",value:function getLastEventInfo(e){var t=this.getHistory();var o=null;for(var l=t.length-1;l>=0;l--)if(t[l].name===e){o=t[l];break}return o}},{key:"getTypeFromHistory",value:function getTypeFromHistory(e){var t,o=this.getLastEventInfo(e);return null!==(t=null==o?void 0:o.type)&&void 0!==t?t:null}},{key:"getCallsFromHistory",value:function getCallsFromHistory(e){var t,o=this.getLastEventInfo(e);return null!==(t=null==o?void 0:o.called)&&void 0!==t?t:0}},{key:"addHistory",value:function addHistory(e,t,o,l){var u;var d=null!==(u=this.getTypeFromHistory(e))&&void 0!==u?u:t,f=this.getCallsFromHistory(e),y="called"===o?f+1:f;this.getHistory().push({type:d,status:o,name:e,called:y,payload:null!=l?l:{}}),this.logEventInfo(e,d,o,y)}},{key:"logEventInfo",value:function logEventInfo(e,t,o,l){if(this.enableLog){if("listening"===o){console.debug("Event (".concat(t,") ").concat(e,": ").concat(o));var u=tA.listenerCount(e);u>1&&console.warn("Event ".concat(e," has ").concat(u," listener"))}else"action"!==t&&console.debug("Event (".concat(t,") ").concat(e,": ").concat(o," (").concat(l," times)"));"called"===o&&tA.listenerCount(e)<=0&&console.warn("Event ".concat(e," is called but not listening"))}}}]),Cn}(l.Plugins.BasePlugin);c(tD,"EventPlugin");var tI=o.Configs,tb=o.Utils.Object,tS=tI.FrameCapture,tk=tS.Enabled,tP=tS.WideframeConfigs,tE=c(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,o,l,u,d;return _ts_generator(this,function(f){if(!tk)return[2,(console.warn("FrameCapture is not enabled"),null)];if(!(t=tx(e)))return[2,null];return tC(t,tP.ResultChallenge),o=window.game.frameCapture,u=(l=tP.ResultChallenge).Width,d=l.Height,[2,o.captureAsync({name:"ResultChallenge",width:u,height:d,renderOptions:t})]})});return function(t){return e.apply(this,arguments)}}(),"renderResultChallenge"),tC=c(function(e,t){var o=t.Width,l=t.Height,u=t.Wideframe;e.wideframe={name:"result-challenge",type:"image",depth:0,image:u,size:[o,l],position:[0,0]}},"addWideframe$2"),tx=c(function(e){try{var t=e.playerId,o=e.playerPhoto,l=e.playerScore,u=void 0===l?0:l,d=e.opponentId,f=e.opponentPhoto,y=e.opponentScore,_=void 0===y?0:y,p=e.isPlayerFinished,v=e.isOpponentFinished,g=tP.ResultChallenge.RenderOptions,m=tb.clone(g);if(!m)return null;var A=tb.clear(m),w=tb.camelCaseKeys(A),D=w.playerPhoto,I=w.opponentPhoto,b=u===_,S=u>_,k=null!=p?p:v,P=p&&v;return"image"===D.type&&(D.name="".concat(void 0===t?"10":t),D.image=void 0===o?"":o),"image"===I.type&&(I.name="".concat(void 0===d?"20":d),I.image=void 0===f?"":f),k?tT(w,{playerScore:u,opponentScore:_,isPlayerFinished:p,isOpponentFinished:v}):(delete w.leftScore,delete w.rightScore),!P||b?(delete w.leftCrown,delete w.rightCrown,w):(S?delete w.rightCrown:delete w.leftCrown,w)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),tT=c(function(e,t){var o=e.leftScore,l=e.rightScore,u=t.playerScore,d=t.opponentScore,f=t.isPlayerFinished,y=t.isOpponentFinished;(null==o?void 0:o.type)==="text"&&(o.text=f?"".concat(void 0===u?0:u):"???"),(null==l?void 0:l.type)==="text"&&(l.text=y?"".concat(void 0===d?0:d):"???")},"addRenderScores"),tL=o.Configs,tN=o.Utils.Object,tO=tL.FrameCapture,tR=tO.Enabled,tM=tO.WideframeConfigs,tF=c(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,o,l,u,d;return _ts_generator(this,function(f){if(!tR)return[2,(console.warn("FrameCapture is not enabled"),null)];if(!(t=tB(e)))return[2,null];return tG(t,tM.ShareLeaderboard),o=window.game.frameCapture,u=(l=tM.ShareLeaderboard).Width,d=l.Height,[2,o.captureAsync({name:"ShareLeaderboard",width:u,height:d,renderOptions:t})]})});return function(t){return e.apply(this,arguments)}}(),"renderShareLeaderboard"),tG=c(function(e,t){var o=t.Width,l=t.Height,u=t.Wideframe;e.wideframe={name:"share-leaderboard",type:"image",depth:0,image:u,size:[o,l],position:[0,0]}},"addWideframe$1"),tB=c(function(e){try{var t=e.playerId,o=e.playerPhoto,l=e.leaders,u=tM.ShareLeaderboard.RenderOptions,d=tN.clone(u);if(!d)return null;var f=tN.clear(d),y=tN.camelCaseKeys(f),_=y.avatar;return"image"===_.type&&(_.name="".concat(t),_.image=o),tj(y,l),y}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),tj=c(function(e,t){var o="600 48px";t.forEach(function(t,l){var u=t.id,d=t.name,f=t.photo,y=t.score;var _=1294+180*l;e["photo_".concat(u)]={depth:-1,name:u,type:"image",image:f,size:[96,96],position:[436,_]},_=1360+180*l,e["name_".concat(u)]={font:o,depth:1,name:u,type:"text",text:d,position:[600,_]},e["score_".concat(u)]={font:o,depth:1,name:u,type:"text",text:"".concat(y),position:[100,_]}})},"addLeaders"),tV=o.Configs,tH=o.Utils.Object,tU=tV.FrameCapture,tK=tU.Enabled,tW=tU.WideframeConfigs,tz=c(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,o,l,u,d;return _ts_generator(this,function(f){if(!tK)return[2,(console.warn("FrameCapture is not enabled"),null)];if(!(t=tY(e)))return[2,null];return tq(t,tW.ShareScore),o=window.game.frameCapture,u=(l=tW.ShareScore).Width,d=l.Height,[2,o.captureAsync({name:"ShareScore",width:u,height:d,renderOptions:t})]})});return function(t){return e.apply(this,arguments)}}(),"renderShareScore"),tq=c(function(e,t){var o=t.Width,l=t.Height,u=t.Wideframe;e.wideframe={name:"share-score",type:"image",depth:0,image:u,size:[o,l],position:[0,0]}},"addWideframe"),tY=c(function(e){try{var t=e.playerId,o=e.playerPhoto,l=e.playerScore,u=tW.ShareScore.RenderOptions,d=tH.clone(u);if(!d)return null;var f=tH.clear(d),y=tH.camelCaseKeys(f);console.log("renderOptions",y);var _=y.avatar,p=y.playerScore;return"image"===_.type&&(_.name="".concat(t),_.image=o),"text"===p.type&&(p.text="".concat(l)),y}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),tJ=o.Configs.FrameCapture.Options,tQ=o.Utils,tX=tQ.Browser,t$=tQ.Image,tZ=tQ.Object,t0=tQ.Valid,t2=/*#__PURE__*/function(e){function Tn(){var e;return _class_call_check(this,Tn),e=_call_super(this,Tn,arguments),h(e,"width"),h(e,"height"),h(e,"canvas",null),h(e,"context",null),h(e,"testRenderOptions",null),h(e,"caches",{}),h(e,"wideframe",{}),e}return _inherits(Tn,e),_create_class(Tn,[{key:"init",value:function init(){this.addWideframeRender("renderShareScore",tz),this.addWideframeRender("renderResultChallenge",tE),this.addWideframeRender("renderShareLeaderboard",tF)}},{key:"preloadAsync",value:function preloadAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return o=e.renderOptions,[4,t.loadImages(o)];case 1:return l.sent(),[2]}})})()}},{key:"captureAsync",value:function captureAsync(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return o=e.width,l=e.height,u=e.renderOptions,[4,t.loadImages(u)];case 1:return[2,(d.sent(),t.width=o,t.height=l,t.createCanvas(),t.drawObjects(u),t.snapshotFrameAsync())]}})})()}},{key:"addWideframeRender",value:function addWideframeRender(e,t){this.wideframe[e]=t}},{key:"setTestRenderOptions",value:function setTestRenderOptions(e){if(!e){this.testRenderOptions=null;return}var t=tZ.camelCaseKeys(e);this.testRenderOptions=tZ.merge(this.testRenderOptions,t)}},{key:"createCanvas",value:function createCanvas(){if(!this.canvas){var e=tX.createCanvas({type:"canvas",contextAttributes:{alpha:!1,desynchronized:!0,willReadFrequently:!0},contextType:"2d"});this.canvas=null==e?void 0:e.canvas,this.context=null==e?void 0:e.context}if(!this.canvas)throw new Error("Failed to create canvas");this.context&&this.context.clearRect(0,0,this.width,this.height),this.canvas.width=this.width,this.canvas.height=this.height}},{key:"loadImages",value:function loadImages(e){var t=this;return _async_to_generator(function(){var o,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(o=tZ.vals(e).filter(function(e){return"image"===e.type}),l=t.prepareLoadImages(o),(u=tZ.vals(l)).length<1)return[2];return[4,Promise.all(u)];case 1:return d=f.sent(),t.cacheImages(l,d),[2]}})})()}},{key:"prepareLoadImages",value:function prepareLoadImages(e){var t={};var o=true,l=false,u=void 0;try{for(var d,f,y=e[Symbol.iterator]();!(o=(f=y.next()).done);o=true)d=this,function(){var e=f.value;var o=e.name,l=e.image,u=e.fallbackImage,y=d.caches[o];!t0.isString(l)||y||(""===l&&t0.isString(u)&&(e.image=u),console.debug("prepareLoadImages",e),t[o]=new Promise(function(t){t$.loadImage(l).then(function(e){t(e)}).catch(function(){t0.isString(u)?(e.image=u,t$.loadImage(e.image).then(function(e){t(e)}).catch(function(){t(null)})):t(null)})}))}()}catch(e){l=true,u=e}finally{try{if(!o&&null!=y.return)y.return()}finally{if(l)throw u}}return t}},{key:"cacheImages",value:function cacheImages(e,t){for(var o in e){var l=t.shift();l&&(this.caches[o]=l)}}},{key:"drawObjects",value:function drawObjects(e){var t=tZ.vals(e).sort(function(e,t){return e.depth-t.depth});var o=true,l=false,u=void 0;try{for(var d,f=t[Symbol.iterator]();!(o=(d=f.next()).done);o=true){var y=d.value;switch(y.type){case"text":this.drawText(y);break;case"image":this.drawImage(y);break}}}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}}},{key:"drawText",value:function drawText(e){if(!this.canvas||!this.context)return;var t=e.position,o=e.font,l=e.text,u=e.color,d=e.lineWidth,f=e.textAlign;this.context.font="".concat(o," ").concat('nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif'),this.context.fillStyle=null!=u?u:"#ffffff",d&&(this.context.lineWidth=d),f&&(this.context.textAlign=f),console.debug("drawText",e);var y=_sliced_to_array(t,2),_=y[0],p=y[1];this.context.fillText(l,_,p)}},{key:"drawImage",value:function drawImage(e){if(!this.canvas||!this.context)return;var t=e.name,o=e.size,l=e.position,u=e.fallbackImage;var d=this.caches[t];if(!d&&u&&(d=this.caches[u]),!d)throw new Error("Image ".concat(t," not found"));console.debug("drawImage",e);var f=_sliced_to_array(l,2),y=f[0],_=f[1],p=_sliced_to_array(o,2),v=p[0],g=p[1];this.context.drawImage(d,y,_,v,g)}},{key:"snapshotFrameAsync",value:function snapshotFrameAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(!e.canvas)return[2,null];if(t=null,!(tJ.UseBlobIfPossible&&"toBlob"in e.canvas))return[3,2];return[4,e.createAsBlob()];case 1:return t=o.sent(),[3,3];case 2:t=e.createAsDataImage(),o.label=3;case 3:if(!t)throw new Error("Image data is null");return[2,(t0.isDebugger()&&t$.logImage(t),t)]}})})()}},{key:"createAsDataImage",value:function createAsDataImage(){if(!this.canvas||!this.context)return null;var e=tJ.Quality,t=tJ.RenderType;return this.context.canvas.toDataURL("image/".concat(t),e)}},{key:"createAsBlob",value:function createAsBlob(){var e=this;return new Promise(function(t){if(!e.canvas){t(null);return}var o=tJ.Quality,l=tJ.RenderType;e.canvas.toBlob(function(e){if(!e){t(null);return}t$.blobToDataImage(e).then(function(e){t(e)})},"image/".concat(l),o)})}}]),Tn}(l.Plugins.BasePlugin);c(t2,"FrameCapturePlugin");var t3=/*#__PURE__*/function(e){function On(e,t){_class_call_check(this,On);var o,l=String(e);return h(o=_call_super(this,On,['Text with key "'.concat(l,'" not found in locale "').concat(t,'"')]),"key"),h(o,"locale"),o.name="MissingKeyInLocaleError",o.key=l,o.locale=t,o}return _inherits(On,e),On}(_wrap_native_super(Error));c(t3,"MissingKeyInLocaleError");var t1=/*#__PURE__*/function(e){function Nn(e){var t;return _class_call_check(this,Nn),h(t=_call_super(this,Nn,['Locale "'.concat(e,'" not found')]),"locale"),t.name="LocaleNotFoundError",t.locale=e,t}return _inherits(Nn,e),Nn}(_wrap_native_super(Error));c(t1,"LocaleNotFoundError");var t4=o.Utils,t5=t4.Object,t6=t4.Function,t7=t4.Browser,t8=o.Configs.Languages.DetectPlayerLocale,t9=/*#__PURE__*/function(e){function Ln(){var e;return _class_call_check(this,Ln),e=_call_super(this,Ln,arguments),h(e,"locale"),h(e,"fallbackLocale"),h(e,"data",{}),e}return _inherits(Ln,e),_create_class(Ln,[{key:"setFallbackLocale",value:function setFallbackLocale(e){this.fallbackLocale=e}},{key:"hasTextKey",value:function hasTextKey(e,t){var o=null!=t?t:this.getCurrentLocale(),l=this.getLocaleData(o).text;return t5.hasOwn(l,e)}},{key:"hasTextureKey",value:function hasTextureKey(e,t){var o=null!=t?t:this.getCurrentLocale(),l=this.getLocaleData(o).texture;return t5.hasOwn(l,e)}},{key:"add",value:function add(e,t,o){var l=arguments.length>2&&void 0!==o&&o;this.data[e]=t,l&&this.setFallbackLocale(e)}},{key:"choose",value:function choose(e){this.locale=e,this.game.event.emit(o.Events.LANGUAGE_CHANGED,{locale:e})}},{key:"getText",value:function getText(e,t,o,l){var u=arguments.length>3&&void 0!==l&&l;try{return this.uncaughtGetText(e,t,o,!u)}catch(t){return _instanceof(t,t3)||_instanceof(t,t1)?console.warn(t.message):console.error(t),String(e)}}},{key:"getTexture",value:function getTexture(e,t,o){var l=arguments.length>2&&void 0!==o&&o;return this.uncaughtGetTexture(e,t,!l)}},{key:"uncaughtGetText",value:function uncaughtGetText(e,t,o,l){var u=this;var d=arguments.length>1&&void 0!==t?t:[],f=arguments.length>2?o:void 0,y=!(arguments.length>3)||void 0===l||l;if(!y||void 0===this.fallbackLocale){var _=this.getRawText(e,null!=f?f:this.getCurrentLocale());return this.replaceVariables(_,d)}var p=this.fallbackLocale,v=t6.retry(function(){return u.getRawText(e,null!=f?f:u.getCurrentLocale())},function(){return u.getRawText(e,p)});return this.replaceVariables(v,d)}},{key:"getRawText",value:function getRawText(e,t){if(!this.hasTextKey(e,t))throw new t3(e,t);return this.getLocaleData(t).text[e]}},{key:"uncaughtGetTexture",value:function uncaughtGetTexture(e,t,o){var l=this;var u=!(arguments.length>2)||void 0===o||o;if(!u||void 0===this.fallbackLocale)return this.getRawTexture(e,null!=t?t:this.getCurrentLocale());var d=this.fallbackLocale;return t6.retry(function(){return l.getRawTexture(e,null!=t?t:l.getCurrentLocale())},function(){return l.getRawTexture(e,d)})}},{key:"getRawTexture",value:function getRawTexture(e,t){if(!this.hasTextureKey(e,t))throw new t3(e,t);return this.getLocaleData(t).texture[e]}},{key:"getCurrentLocale",value:function getCurrentLocale(){var e;return null!==(e=this.locale)&&void 0!==e?e:"en"}},{key:"getLocaleData",value:function getLocaleData(e){var t=null!=e?e:this.getCurrentLocale();if(!t5.hasOwn(this.data,t))throw new t1(t);return this.data[t]}},{key:"replaceVariables",value:function replaceVariables(e,t){var o=t.length;if(0===o)return e;var l=e;for(var u=0;u<o;u++){var d=t[u],f="%{".concat(u,"}");l=l.replace(f,d)}return l}},{key:"getPlayerLanguage",value:function getPlayerLanguage(){var e,t=globalThis.game.player,o=GameSDK.getLocale(),l=null==o?void 0:o.trim().split(/[-_]/)[0],u=this.getBrowserLanguage();return l!==u?null!=l?l:u:t.getPlayerDataByKey("isFirstLogin")?u:null!==(e=t.getPlayerSetting("language"))&&void 0!==e?e:u}},{key:"getBrowserLanguage",value:function getBrowserLanguage(){var e;if(!1===t8)return"en";var t=t7.getLocale();return null==(e=null==t?void 0:t.trim())?void 0:e.split(/[-_]/)[0]}}]),Ln}(l.Plugins.BasePlugin);c(t9,"LanguagePlugin");var ne=e("D",{_id:"",name:"",createdBy:"",description:"",expireTime:6048e5,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15}),nt=o.Configs,na=o.Utils,ns=na.Object,no=na.String,nc=na.Valid,nl=nt.OtherHost,nu=nt.Mockup,nd=nt.AppId,nh=/*#__PURE__*/function(){function Rn(){_class_call_check(this,Rn),h(this,"mockAPI")}return _create_class(Rn,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:if(e.mockAPI)return[2];return[4,d(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/LeaderboardAPIMock.js")];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=l.sent().default))throw new Error("Cannot load LeaderboardAPIMock");return e.mockAPI=new o,[2]}})})()}},{key:"getLeadersAsync",value:function getLeadersAsync(e,t,o){var l=this;return _async_to_generator(function(){var u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(u=no.params(o),!nu.Leaderboards.Enabled)return[3,6];return[4,l.initMockAPI()];case 1:if(f.sent(),!("playerIds"in o))return[3,3];return[4,l.mockAPI.getPlayers(e,o)];case 2:return d=f.sent(),[3,5];case 3:return[4,l.mockAPI.getLeaders(e,o)];case 4:d=f.sent(),f.label=5;case 5:return[3,8];case 6:return[4,ea("".concat(t,"?").concat(u),{},nl)];case 7:d=f.sent(),f.label=8;case 8:return[2,ns.hasOwn(d,"data")&&Array.isArray(d.data)?d.data:[]]}})})()}},{key:"getLeaderboardAsync",value:function getLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var o,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(l="leaderboards/".concat(e),!nu.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return u.sent(),[4,t.mockAPI.getLeaderboardAsync(e)];case 2:return o=u.sent(),[3,5];case 3:return[4,ea(l,{},nl)];case 4:o=u.sent(),ns.hasOwn(o,"data")&&nc.isObject(o.data)&&(o=o.data),u.label=5;case 5:return[2,o]}})})()}},{key:"getLeaderboardsAsync",value:function getLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(u=o.Utils.String.params(e),!nu.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return d.sent(),[4,t.mockAPI.getLeaderboardsAsync(e)];case 2:return l=d.sent(),[3,5];case 3:return[4,ea("leaderboards?".concat(u),{},nl)];case 4:l=d.sent(),ns.hasOwn(l,"data")&&Array.isArray(l.data)?l=l.data:l=[],d.label=5;case 5:return[2,l]}})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(o=e.leaderboardId,l=e.playerId,u=e.score,!nu.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return d.sent(),[4,t.mockAPI.setScoreAsync(o,l,u)];case 2:return d.sent(),[3,5];case 3:return[4,es("leaderboards/".concat(o,"/players/").concat(l),{score:u},{},nl)];case 4:d.sent(),d.label=5;case 5:return[2]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:if(l=null!==(o=e._id)&&void 0!==o?o:no.generateObjectId(),u=e.numberOfLeaders,d=_object_spread_props(_object_spread({},ne,e),{_id:l,appId:nd,numberOfLeaders:u}),f="leaderboards",!nu.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return _.sent(),[4,t.mockAPI.createLeaderboard(d)];case 2:return y=_.sent(),[3,5];case 3:return[4,es(f,d,{},nl)];case 4:y=_.sent(),ns.hasOwn(y,"data")&&nc.isObject(y.data)&&(y=y.data),_.label=5;case 5:if(!ns.hasOwn(y,"_id")||y._id!==l)throw new Error("Create leaderboard failed");return[2,l]}})})()}}]),Rn}();c(nh,"LeaderboardAPI");var nf={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},ny={leaderboards:{}},n_=o.Utils,np=n_.Array,nv=n_.Valid,ng=n_.Json,nm=n_.Object,nA=/*#__PURE__*/function(e){function _n(){var e;return _class_call_check(this,_n),e=_call_super(this,_n,arguments),h(e,"lbAPI",new nh),h(e,"configs"),e}return _inherits(_n,e),_create_class(_n,[{key:"init",value:function init(){this.game.storage.addStorage("leaderboard",ny),this.configs={}}},{key:"addLeaderboard",value:function addLeaderboard(e){var t=e.name,o=e.type,l=e.leaderboardId,u=e.autoSortRank;if(this.getLeaderboard(t)){console.warn("Leaderboard with name ".concat(t," already exists"));return}var d="leaderboards/".concat(l,"/");("global"===o||"tournament"===o)&&(d+="leaders"),"friends"===o&&(d+="players"),this.configs[t]={id:l,name:t,type:o,host:d,autoSortRank:u};var f=ng.clone(nf);this.setLeaderboard(t,_object_spread({},f))}},{key:"requestLeaderboardsAsync",value:function requestLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,t.lbAPI.getLeaderboardsAsync(e)];case 1:return[2,o.sent()];case 2:return[2,(console.warn("requestGlobalLeaderboardsAsync",o.sent()),[])];case 3:return[2]}})})()}},{key:"requestLeaderboardAsync",value:function requestLeaderboardAsync(e,t){var o=this;return _async_to_generator(function(){var l,u,d,f,y,_,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:if(A.trys.push([0,,6,8]),o.validateLeaderboard(e),o.clearLeaderboard(e),o.setLeaderboard(e,{isRequesting:!0}),u=(l=o.configs[e]).id,d=l.type,f=l.host,y=[],"friends"!==d)return[3,2];return p=[(_=o.game.player).getPlayerId()].concat(_to_consumable_array(_.getConnectedPlayerIds(t,0))),o.configs[e].playerIds=_to_consumable_array(p),[4,o.lbAPI.getLeadersAsync(u,f,{playerIds:p})];case 1:return y=A.sent(),[3,4];case 2:return[4,o.lbAPI.getLeadersAsync(u,f,{limit:t,offset:0})];case 3:y=A.sent(),A.label=4;case 4:if(0===y.length)return[2];return[4,o.receiveLeaderboardAsync(e,y)];case 5:return A.sent(),o.setLeaderboard(e,{limit:t,offset:0}),[3,8];case 6:return[4,o.lbAPI.getLeaderboardAsync(o.configs[e].id)];case 7:return g=(v=A.sent())?v.resettable:"",m=v?v.amountPlayer:0,o.setLeaderboard(e,{isRequesting:!1,resettable:g,amountPlayer:m}),[7];case 8:return[2]}})})()}},{key:"loadMoreLeaderboardAsync",value:function loadMoreLeaderboardAsync(e,t){var o=this;return _async_to_generator(function(){var l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:if(!(l=o.getLeaderboard(e)))return[3,4];if("friends"===o.configs[e].type)return console.warn("Cannot load more leaderboard with type friend"),[2];p.label=1;case 1:return p.trys.push([1,,3,4]),o.setLeaderboard(e,{isRequesting:!0}),d=(u=o.configs[e]).id,f=u.host,y=l.offset+l.limit,[4,o.lbAPI.getLeadersAsync(d,f,{limit:t,offset:y})];case 2:if(0===(_=p.sent()).length)return[2];return o.receiveLeaderboardAsync(e,_),o.setLeaderboard(e,{limit:t,offset:y}),[3,4];case 3:return o.setLeaderboard(e,{isRequesting:!1}),[7];case 4:return[2]}})})()}},{key:"getLeaderboard",value:function getLeaderboard(e){var t=this.game.storage.getStorageData("leaderboard","leaderboards");return t&&t[e]?t[e]:null}},{key:"getLeadersByPlayerIdsAsync",value:function getLeadersByPlayerIdsAsync(e,t){var o=this;return _async_to_generator(function(){var l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),o.validateLeaderboard(e),l=o.configs[e].id,u="leaderboards/".concat(l,"/players"),[4,o.lbAPI.getLeadersAsync(l,u,{playerIds:t})];case 1:return[2,0===(d=f.sent()).length?[]:o.toLeaders(d)];case 2:return[2,(console.warn(f.sent()),[])];case 3:return[2]}})})()}},{key:"getLeaderboardResponseAsync",value:function getLeaderboardResponseAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.lbAPI.getLeaderboardAsync(e)];case 1:return[2,o.sent()]}})})()}},{key:"clearLeaderboard",value:function clearLeaderboard(e){try{this.validateLeaderboard(e);var t=ng.clone(nf);this.setLeaderboard(e,null),this.setLeaderboard(e,_object_spread({},t))}catch(e){console.warn(e)}}},{key:"isLeaderboardEmpty",value:function isLeaderboardEmpty(e){var t=this.getLeaderboard(e);if(!t)return!0;return 0===Object.keys(t.leaders).length}},{key:"isExistLeaderboardId",value:function isExistLeaderboardId(e){var t=this.configs;return nm.vals(t).some(function(t){return t.id===e})}},{key:"getLeaderboardName",value:function getLeaderboardName(e){var t=this.configs,o=np.search(nm.vals(t),function(t){return t.id===e});return o?o.name:null}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e,t,o){var l=this;return _async_to_generator(function(){var u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,3,,4]),GameSDK.extra.isGuest)return[2];return l.validateLeaderboard(e),u=l.configs[e].id,[4,l.getLastScoreOnLeaderboard(e,t)];case 1:if((d=f.sent())&&o<=d)return[2];return[4,l.lbAPI.setLeaderboardScoreAsync({leaderboardId:u,playerId:t,score:o})];case 2:return f.sent(),[3,4];case 3:return console.warn(f.sent()),[3,4];case 4:return[2]}})})()}},{key:"getLastScoreOnLeaderboard",value:function getLastScoreOnLeaderboard(e,t){var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return[4,o.getLeadersByPlayerIdsAsync(e,[t])];case 1:return[2,0===(l=u.sent()).length?null:l[0].score]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){return[2,t.lbAPI.createLeaderboardAsync(e)]})})()}},{key:"validateLeaderboard",value:function validateLeaderboard(e){var t=this.getLeaderboard(e);if(!nv.isObject(t))throw new Error("Leaderboard with name ".concat(e," not found"))}},{key:"setLeaderboard",value:function setLeaderboard(e,t){if(!t)return;this.game.storage.setStorageData("leaderboard","leaderboards",_define_property({},e,t))}},{key:"receiveLeaderboardAsync",value:function receiveLeaderboardAsync(e,t){var o=this;return _async_to_generator(function(){var l,u,d,f,y,_,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:return o.validateLeaderboard(e),[4,o.toLeaders(t)];case 1:return d=m.sent().filter(function(e){return e.name&&e.photo}),y=void 0===(f=(null!==(u=o.getLeaderboard(e))&&void 0!==u?u:{}).leaders)?{}:f,_=d.filter(function(e){return!y[e.playerId]||(y[e.playerId]=e,!1)}),p=nm.vals(y),_.length>0&&(l=p).unshift.apply(l,_to_consumable_array(_)),v=p.sort(function(e,t){return t.score-e.score}),o.configs[e].autoSortRank&&(v=v.map(function(e,t){return _object_spread_props(_object_spread({},e),{rank:t+1})})),g=nm.keyBy(v,"playerId"),o.setLeaderboard(e,{leaders:g}),[2]}})})()}},{key:"toLeaders",value:function toLeaders(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return o=t.game.profile,l=e.map(function(e){return e.playerId}),[4,o.requestProfiles(l)];case 1:return d.sent(),u=o.getProfiles(),[2,e.map(function(e){var t=u[e.playerId];return t?_object_spread_props(_object_spread({},e),{name:t.name,photo:t.photo}):_object_spread_props(_object_spread({},e),{name:"Nameless",photo:"default"})}).map(function(e){return _object_spread_props(_object_spread({},e),{score:parseInt(e.score,10)})})]}})})()}}]),_n}(l.Plugins.BasePlugin);c(nA,"LeaderboardPlugin");var nw=/*#__PURE__*/function(){function Mn(){_class_call_check(this,Mn),h(this,"APIHost")}return _create_class(Mn,[{key:"setAPIHost",value:function setAPIHost(e){this.APIHost=e}},{key:"getAPIHost",value:function getAPIHost(){return this.APIHost}}]),Mn}();c(nw,"BaseAPI");var nD=o.Utils,nI=/*#__PURE__*/function(e){function $n(){return _class_call_check(this,$n),_call_super(this,$n,arguments)}return _inherits($n,e),_create_class($n,[{key:"createSingleMatchAsync",value:function createSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,es("single-matches",e,{},t.getAPIHost())];case 1:return o=l.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"getSingleMatchDetailAsync",value:function getSingleMatchDetailAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,ea("single-matches/active",{},e.getAPIHost())];case 1:return t=o.sent(),[2,e.returnValidMatchData(t)]}})})()}},{key:"updateSingleMatchMoveAsync",value:function updateSingleMatchMoveAsync(e,t){var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return[4,es("single-matches/".concat(e,"/move"),t,{},o.getAPIHost())];case 1:return l=u.sent(),[2,o.returnValidMatchData(l)]}})})()}},{key:"finishSingleMatchAsync",value:function finishSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,es("single-matches/".concat(e,"/finish"),{},{},t.getAPIHost())];case 1:return o=l.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,es("matches",e,{},t.getAPIHost())];case 1:return o=l.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,es("matches/".concat(e,"/join"),{},{},t.getAPIHost())];case 1:return o=l.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"getMatchDetailByIdAsync",value:function getMatchDetailByIdAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,ea("matches/".concat(e),{},t.getAPIHost())];case 1:return o=l.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:return l=void 0===(o=e.matchId)?"":o,d=void 0===(u=e.score)?0:u,y=void 0===(f=e.level)?0:f,p=void 0===(_=e.extraData)?{}:_,[4,es("matches/".concat(l,"/finish"),{matchId:l,score:d,level:y,extraData:p},{},t.getAPIHost())];case 1:return v=g.sent(),[2,t.returnValidMatchData(v)]}})})()}},{key:"returnValidMatchData",value:function returnValidMatchData(e){var t;return nD.Valid.isObject(e)?nD.Object.hasOwn(e,"data")?null!==(t=e.data)&&void 0!==t?t:{}:{}:{}}}]),$n}(nw);c(nI,"MatchAPI");var nb=/*#__PURE__*/function(){function Gn(e){_class_call_check(this,Gn),h(this,"matchAPI"),this.createAPI(),this.setAPIConfig(e)}return _create_class(Gn,[{key:"createAPI",value:function createAPI(){this.matchAPI=new nI}},{key:"setAPIConfig",value:function setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}},{key:"setMatchAPIInstance",value:function setMatchAPIInstance(e){this.matchAPI=e}},{key:"getMatchAPI",value:function getMatchAPI(){return this.matchAPI}}]),Gn}();c(nb,"APIHandler");var nS=/*#__PURE__*/function(){function Fn(e,t){_class_call_check(this,Fn),h(this,"game"),h(this,"match"),this.game=e,this.match=t}return _create_class(Fn,[{key:"startLog",value:function startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group("\uD83D\uDE80 ".concat(this.constructor.name)),e&&console.log("\uD83D\uDCE6 ? Payload:",e)}},{key:"endLog",value:function endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}},{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(e){throw new Error("Not implemented")})})()}}]),Fn}();c(nS,"BaseConcrete");var nk=/*#__PURE__*/function(e){function kn(e){var t;return _class_call_check(this,kn),(t=_call_super(this,kn,[e])).name="LevelNotDefined",t.message=null!=e?e:"Level is not defined",t}return _inherits(kn,e),kn}(F);c(nk,"LevelNotDefined");var nP=/*#__PURE__*/function(e){function Vn(e){var t;return _class_call_check(this,Vn),(t=_call_super(this,Vn,[e])).name="MatchModeNotDefined",t.message=null!=e?e:"Match id is not defined",t}return _inherits(Vn,e),Vn}(F);c(nP,"MatchModeNotDefined");var nE=o.Utils,nC=nE.Object,nx=nE.Valid,nT=/*#__PURE__*/function(){function Un(e){_class_call_check(this,Un),h(this,"game"),h(this,"match"),h(this,"nextHandler"),this.game=e.game,this.match=e.match,this.nextHandler=null}return _create_class(Un,[{key:"setNext",value:function setNext(e){return this.nextHandler=e,e}},{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){return console.groupCollapsed("➡️ ".concat(t.constructor.name)),t.logData("Before",e),[2]})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:if(t.logData("After",e),console.groupEnd(),!t.nextHandler)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:o.sent(),o.label=2;case 2:return[2]}})})()}},{key:"logData",value:function logData(e,t){if(!nx.isDebugger())return;console.groupCollapsed("\uD83D\uDCE6 MatchState: ".concat(e));var o=t.profiles,l=t.customData,u=_object_without_properties(t,["profiles","customData"]);console.info("\uD83D\uDCBE Base"),console.table(nC.clone(u)),console.info("\uD83D\uDCBE Profile"),console.table(nC.clone(o)),console.info("\uD83D\uDCBE Custom"),console.table(nC.clone(l)),console.groupEnd()}}]),Un}();c(nT,"BaseHandler");var nL=o.Plugins,nN=o.Utils,nO=nL.Analytics,nR=nN.String,nM=nN.Valid,nF=/*#__PURE__*/function(e){function Bn(){return _class_call_check(this,Bn),_call_super(this,Bn,arguments)}return _inherits(Bn,e),_create_class(Bn,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(Bn.prototype),"processAsync",t)})().call(o,e),l=e.mode,u=e.customData.level,o.validateMode(l),o.validateLevel(u),o.game.analytics.event(nO.Events.MATCH_START,{level:u,game_mode:nR.toUpperCamelCase(l),level_name:o.getLevelName(u)}),[4,o.nextAsync(e)];case 1:return d.sent(),[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!nM.isString(e))throw new nP}},{key:"validateLevel",value:function validateLevel(e){if(!nM.isNumber(e))throw new nk}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(nR.padStart(e.toString(),5,"0"))}}]),Bn}(nT);c(nF,"LogMatchStartHandler");var nG={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},nB=/*#__PURE__*/function(e){function Wn(){return _class_call_check(this,Wn),_call_super(this,Wn,arguments)}return _inherits(Wn,e),_create_class(Wn,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(Wn.prototype),"processAsync",t)})().call(o,e),l=e.mode,u=e.status,d=null!=l?l:eK.SINGLE,u===nG.FINISHED&&(d=eK.SINGLE),o.contextGameModeDetected(d),[4,o.nextAsync(e)];case 1:return f.sent(),[2]}})})()}},{key:"contextGameModeDetected",value:function contextGameModeDetected(e){this.game.storage.setStorageData("context","contextGameMode",e)}}]),Wn}(nT);c(nB,"ContextGameModeHandler");var nj=/*#__PURE__*/function(e){function jn(e){var t;return _class_call_check(this,jn),(t=_call_super(this,jn,[e])).name="GetMatchDetailFailed",t.message=null!=e?e:"Get match detail failed",t}return _inherits(jn,e),jn}(_wrap_native_super(Error));c(nj,"GetMatchDetailFailed");var nV=/*#__PURE__*/function(e){function Kn(e){var t;return _class_call_check(this,Kn),(t=_call_super(this,Kn,[e])).name="MatchAreNotActive",t.message=null!=e?e:"Match are not active",t}return _inherits(Kn,e),Kn}(_wrap_native_super(Error));c(nV,"MatchAreNotActive");var nH=/*#__PURE__*/function(e){function Hn(e){var t;return _class_call_check(this,Hn),(t=_call_super(this,Hn,[e])).name="MatchIdNotValid",t.message=null!=e?e:"Match id is not valid",t}return _inherits(Hn,e),Hn}(F);c(nH,"MatchIdNotValid");var nU=/*#__PURE__*/function(e){function zn(e){var t;return _class_call_check(this,zn),(t=_call_super(this,zn,[e])).name="OpponentHasFinishedMatch",t.message=e||"Opponent has finished match",t}return _inherits(zn,e),zn}(_wrap_native_super(Error));c(nU,"OpponentHasFinishedMatch");var nK=/*#__PURE__*/function(e){function qn(e){var t;return _class_call_check(this,qn),(t=_call_super(this,qn,[e])).name="OpponentIdNotValid",t.message=null!=e?e:"Opponent id is not valid",t}return _inherits(qn,e),qn}(F);c(nK,"OpponentIdNotValid");var nW=/*#__PURE__*/function(e){function Yn(e){var t;return _class_call_check(this,Yn),(t=_call_super(this,Yn,[e])).name="PlayerNotCurrentInMatch",t.message=null!=e?e:"The player is not currently in this match",t}return _inherits(Yn,e),Yn}(_wrap_native_super(Error));c(nW,"PlayerNotCurrentInMatch");var nz=/*#__PURE__*/function(e){function Qn(e){var t;return _class_call_check(this,Qn),(t=_call_super(this,Qn,[e])).name="PlayerNotFinishedMatch",t.message=e||"Player not finished match",t}return _inherits(Qn,e),Qn}(_wrap_native_super(Error));c(nz,"PlayerNotFinishedMatch");var nq=o.Dtos,nY=o.Utils.Object,nJ=/*#__PURE__*/function(e){function Xn(){return _class_call_check(this,Xn),_call_super(this,Xn,arguments)}return _inherits(Xn,e),_create_class(Xn,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(Xn.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),[4,o.getMatchAsync(e)];case 1:return l=d.sent(),u=new nq.Match.Data(l).toObject(),o.validateAwaitMatchData(e,u),o.updateMatchData(e,u),o.validateMatchStatus(e),o.validatePlayerTurn(e),o.validateOpponentTurn(e),[4,o.nextAsync(e)];case 2:return d.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){if("string"!=typeof e.id)throw new nH}},{key:"validateMatchStatus",value:function validateMatchStatus(e){if(e.status!==nG.ACTIVE)throw new nV}},{key:"validateAwaitMatchData",value:function validateAwaitMatchData(e,t){var o=e.id,l=e.customData,u=t._id,d=t.whitePlayerId,f=t.blackPlayerId;if("string"!=typeof u||u!==o)throw new nj;var y=l.playerId,_=d===y;if(!_&&f===M.playerId)throw new e$;if(!_&&f!==y)throw new nW}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,o=e.customData.playerId;if("string"!=typeof o)throw new G;if(!t[o].finished)throw new nz}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,o=e.customData.opponentId;if("string"!=typeof o)throw new nK;if(t[o].finished)throw new nU}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){return[2,(o=e.id)?t.match.api.getMatchAPI().getMatchDetailByIdAsync(o):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t.status,l=t.extraData;e.status=o,e.customData=nY.merge(e.customData,l)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,l=t.blackPlayerId,u=o===e.customData.playerId;e.customData.playerId=u?o:l,e.customData.opponentId=u?l:o}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,l=t.opponentId;if(!o||!l)return;var u={name:"",photo:"",finished:!1};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},u)),e.profiles[l]||(e.profiles[l]=_object_spread({id:l},u))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,t){var o=e.customData,l=o.playerId,u=o.opponentId;if(!l||!u)return;var d=t.whitePlayerId,f=t.whitePlayerScore,y=t.whitePlayerFinish,_=t.blackPlayerScore,p=t.blackPlayerFinish,v=d===l;e.profiles[l].score=v?f:_,e.profiles[u].score=v?_:f,e.profiles[l].finished=v?y:p,e.profiles[u].finished=v?p:y}}]),Xn}(nT);c(nJ,"AwaitMatchHandler");var nQ={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},nX=/*#__PURE__*/function(e){function Jn(e,t){var o;return _class_call_check(this,Jn),h(o=_call_super(this,Jn,[e]),"payload"),o.payload=t,o}return _inherits(Jn,e),_create_class(Jn,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Jn.prototype),"processAsync",t)})().call(o,e),o.initializeMatch(e),[4,o.nextAsync(e)];case 1:return l.sent(),[2]}})})()}},{key:"initializeMatch",value:function initializeMatch(e){var t=this.payload,o=t.id,l=t.mode,u=t.customData;e.id=null!=o?o:null,e.mode=l||null,e.status=nG.OPEN,e.startAt=0,e.finishAt=0,e.profiles={},e.customData=_object_spread({},nQ,e.customData,u)}}]),Jn}(nT);c(nX,"PrepareMatchHandler");var n$=/*#__PURE__*/function(e){function Zn(e){var t;return _class_call_check(this,Zn),(t=_call_super(this,Zn,[e])).name="UnavailableFeature",t.message="Unavailable feature: ".concat(e),t}return _inherits(Zn,e),Zn}(_wrap_native_super(Error));c(n$,"UnavailableFeature");var nZ=/*#__PURE__*/function(e){function ei(e){var t;return _class_call_check(this,ei),(t=_call_super(this,ei,[e])).name="ContextIdNotValid",t.message=null!=e?e:"Context id is not valid",t}return _inherits(ei,e),ei}(F);c(nZ,"ContextIdNotValid");var n0=/*#__PURE__*/function(e){function ti(e){var t;return _class_call_check(this,ti),(t=_call_super(this,ti,[e])).name="ProfileNotFound",t.message=null!=e?e:"Profile not found",t}return _inherits(ti,e),ti}(F);c(n0,"ProfileNotFound");var n2=/*#__PURE__*/function(e){function si(){return _class_call_check(this,si),_call_super(this,si,arguments)}return _inherits(si,e),_create_class(si,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(si.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createWideframesAwaitingAsync(e)];case 1:return(l=u.sent())&&o.sendMessageAsync(e,l),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,l=o.contextId,u=o.opponentId;if(!t||"string"!=typeof t)throw new nH;if(!l||"string"!=typeof l)throw new nZ;if(!u||"string"!=typeof u)throw new nK}},{key:"createWideframesAwaitingAsync",value:function createWideframesAwaitingAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A,w,D;return _ts_generator(this,function(I){switch(I.label){case 0:if(I.trys.push([0,4,,5]),o=t.game.frameCapture,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];if(p=y.photo,g=void 0===(v=y.score)?0:v,!y.finished)return[2,null];if(m=_.photo,w=void 0===(A=_.score)?0:A,!_.finished)return[3,1];return D=null,[3,3];case 1:return[4,o.wideframe.renderResultChallenge({playerId:d,playerPhoto:p,playerScore:g,opponentId:f,opponentPhoto:m,opponentScore:w,isPlayerFinished:!0,isOpponentFinished:!1})];case 2:D=I.sent(),I.label=3;case 3:return[2,D];case 4:return[2,(console.warn("createWideframesAwaitingAsync",I.sent()),null)];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var o,l,u,d,f,y,_,p;return _ts_generator(this,function(v){switch(v.label){case 0:if(o=e.id,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||"string"!=typeof d)throw new G;if(!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");if(!(y=l[d]))throw new n0;return _=y.name,p={data:{type:eU.CHALLENGE_FRIEND,matchId:o,playerId:d,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(_," is waiting for you to finish this game. Play now!"),localizations:{vi_VN:"".concat(_," đang chờ bạn kết th\xfac trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"},[4,GameSDK.extra.updateAsync(p)];case 1:return v.sent(),[2]}})})()}}]),si}(nT);c(n2,"SendAwaitingMessageHandler");var n3=/*#__PURE__*/function(e){function ai(){return _class_call_check(this,ai),_call_super(this,ai,arguments)}return _inherits(ai,e),_create_class(ai,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.nextAsync(e)];case 1:return o.sent(),[2]}})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:if(!t.nextHandler)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:o.sent(),o.label=2;case 2:return[2]}})})()}}]),ai}(nT);c(n3,"NothingHandler");var n1=o.Dtos,n4=/*#__PURE__*/function(e){function ni(){return _class_call_check(this,ni),_call_super(this,ni,arguments)}return _inherits(ni,e),_create_class(ni,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:return(function(){return _get(_get_prototype_of(ni.prototype),"processAsync",t)})().call(o,e),o.validateData(e),u=(l=e.customData).playerId,d=l.opponentId,f=u,[4,o.getProfile(f)];case 1:if(!(y=p.sent()))throw new n0;if(o.updateMatchProfile(e,f,y),(f=d)===M.playerId)return[3,3];return[4,o.getProfile(f)];case 2:if(!(_=p.sent()))throw new n0;return o.updateMatchProfile(e,f,_),[3,4];case 3:o.updateMatchProfile(e,f),p.label=4;case 4:return[4,o.nextAsync(e)];case 5:return p.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.customData,o=t.playerId,l=t.opponentId;if(!o||"string"!=typeof o)throw new G;if(!l||"string"!=typeof l)throw new nK}},{key:"getProfile",value:function getProfile(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,(o=t.game.profile).requestProfiles([e])];case 1:return[2,(l.sent(),o.getProfiles()[e])]}})})()}},{key:"updateMatchProfile",value:function updateMatchProfile(e,t,o){var l=null!=o?o:M,u=l.name,d=l.photo,f=new n1.Match.Profile({id:t,name:u,photo:d}).toObject();e.profiles[t]?(e.profiles[t].name=f.name,e.profiles[t].photo=f.photo):e.profiles[t]=f}}]),ni}(nT);c(n4,"GetMatchProfilesHandler");var n5=/*#__PURE__*/function(e){function ii(){return _class_call_check(this,ii),_call_super(this,ii,arguments)}return _inherits(ii,e),_create_class(ii,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:return w.trys.push([0,,2,3]),t.startLog(e),o=e.matchId,l=e.playerId,u=e.opponentId,d=new n3(t),y=new nX(t,{id:o,mode:f.CHALLENGE_FRIEND,customData:{playerId:l,opponentId:u}}),d.setNext(y),_=new nJ(t),y.setNext(_),p=new n4(t),_.setNext(p),v=new n2(t),p.setNext(v),g=new nF(t),v.setNext(g),m=new nB(t),g.setNext(m),A=t.match.getMatchState(),[4,d.processAsync(A)];case 1:return w.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),ii}(nS);c(n5,"AwaitChallengeMatchConcrete");var n6=/*#__PURE__*/function(e){function ri(e){var t;return _class_call_check(this,ri),(t=_call_super(this,ri,[e])).name="CreateContextFailed",t.message=null!=e?e:"Create context failed",t}return _inherits(ri,e),ri}(F);c(n6,"CreateContextFailed");var n7=o.Utils,n8=n7.Valid,n9=n7.Object,ae=/*#__PURE__*/function(e){function oi(e,t){var o;return _class_call_check(this,oi),h(o=_call_super(this,oi,[e]),"payload"),o.payload=t,o}return _inherits(oi,e),_create_class(oi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(oi.prototype),"processAsync",t)})().call(o,e),l=o.payload.opponentId,[4,o.createAsync(l)];case 1:return u=d.sent(),e.customData.contextId=u,[4,o.nextAsync(e)];case 2:return d.sent(),[2]}})})()}},{key:"createAsync",value:function createAsync(e){var t=this;return _async_to_generator(function(){var o,l;return _ts_generator(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,GameSDK.context.createAsync(e)];case 1:return u.sent(),[3,3];case 2:return o=u.sent(),t.validateError(o),[3,3];case 3:if(l=GameSDK.context.getID(),!n8.isString(l))throw new n6;return[2,l]}})})()}},{key:"validateError",value:function validateError(e){if(!n9.hasOwn(e,"code"))throw e;if("SAME_CONTEXT"!==e.code){if("INVALID_PARAM"===e.code){if(!this.isNotConnectedPlayerError(e))throw e;return}throw e}}},{key:"validateErrorMessage",value:function validateErrorMessage(e){if(!n9.hasOwn(e,"message")||!n8.isString(e.message))throw e}},{key:"isNotConnectedPlayerError",value:function isNotConnectedPlayerError(e){return this.validateErrorMessage(e),e.message.indexOf("is not a connected player of the current player")>-1}}]),oi}(nT);c(ae,"CreateContextHandler");var at=/*#__PURE__*/function(e){function ci(e){var t;return _class_call_check(this,ci),(t=_call_super(this,ci,[e])).name="MatchAreNotOpen",t.message=null!=e?e:"Match are not open",t}return _inherits(ci,e),ci}(F);c(at,"MatchAreNotOpen");var aa=o.Dtos,as=o.Utils.Object,ao=/*#__PURE__*/function(e){function li(e,t){var o;return _class_call_check(this,li),h(o=_call_super(this,li,[e]),"payload"),o.payload=t,o}return _inherits(li,e),_create_class(li,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(li.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createMatchAsync(e)];case 1:return l=d.sent(),u=new aa.Match.Data(l).toObject(),o.updateMatchState(e,u),[4,o.nextAsync(e)];case 2:return d.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.status;if("string"!=typeof e.customData.opponentId)throw new nK;if(t!==nG.OPEN)throw new at}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){if(o=e.customData.opponentId,l=t.payload.extraData,!o)return[2,{}];return u={opponentPlayerId:o,extraData:l},[2,t.match.api.getMatchAPI().createMatchAsync(u)]})})()}},{key:"updateMatchState",value:function updateMatchState(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateFinishStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t._id,l=t.extraData;e.id=o||null,e.customData=as.merge(e.customData,l)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,l=t.blackPlayerId,u=o===e.customData.opponentId;e.customData.playerId=u?l:o,e.customData.opponentId=u?o:l}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,l=t.opponentId;if(!o||!l)return;var u={name:"",photo:"",finished:!1};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},u)),e.profiles[l]||(e.profiles[l]=_object_spread({id:l},u))}},{key:"updateFinishStatus",value:function updateFinishStatus(e,t){var o=e.customData,l=o.playerId,u=o.opponentId;if(!l||!u)return;var d=t.whitePlayerId,f=t.whitePlayerFinish,y=t.blackPlayerFinish,_=d===e.customData.opponentId;e.profiles[l].finished=_?y:f,e.profiles[u].finished=_?f:y}}]),li}(nT);c(ao,"CreateMatchHandler");var ac=/*#__PURE__*/function(e){function di(){return _class_call_check(this,di),_call_super(this,di,arguments)}return _inherits(di,e),_create_class(di,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:if((function(){return _get(_get_prototype_of(di.prototype),"processAsync",t)})().call(o,e),e.status!==nG.OPEN)throw new at;return o.startMatch(e),[4,o.nextAsync(e)];case 1:return l.sent(),[2]}})})()}},{key:"startMatch",value:function startMatch(e){e.status=nG.ACTIVE,e.startAt=Date.now()}}]),di}(nT);c(ac,"StartMatchHandler");var al=/*#__PURE__*/function(e){function hi(){return _class_call_check(this,hi),_call_super(this,hi,arguments)}return _inherits(hi,e),_create_class(hi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(hi.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createWideframesChallengeAsync(e)];case 1:return(l=u.sent())&&o.sendMessageAsync(e,l),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,l=o.contextId,u=o.opponentId;if(!t||"string"!=typeof t)throw new nH;if(!l||"string"!=typeof l)throw new nZ;if(!u||"string"!=typeof u)throw new nK}},{key:"createWideframesChallengeAsync",value:function createWideframesChallengeAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A,w;return _ts_generator(this,function(D){switch(D.label){case 0:if(D.trys.push([0,2,,3]),o=t.game.frameCapture,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];return p=y.photo,g=void 0===(v=y.score)?0:v,m=_.photo,w=void 0===(A=_.score)?0:A,[4,o.wideframe.renderResultChallenge({playerId:d,playerPhoto:p,playerScore:g,opponentId:f,opponentPhoto:m,opponentScore:w,isPlayerFinished:!1,isOpponentFinished:!1})];case 1:return[2,D.sent()];case 2:return[2,(console.warn("createWideframesChallengeAsync",D.sent()),null)];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var o,l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:if(o=e.id,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||"string"!=typeof d)throw new G;if(!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");return y=l[d].name,_={data:{type:eU.CHALLENGE_FRIEND,matchId:o,playerId:d,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," challenges you"),localizations:{vi_VN:"".concat(y," thử th\xe1ch bạn trong trận đấu n\xe0y. Chơi ngay!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},[4,GameSDK.extra.updateAsync(_)];case 1:return p.sent(),[2]}})})()}}]),hi}(nT);c(al,"SendChallengeMessageHandler");var au=/*#__PURE__*/function(e){function ui(){return _class_call_check(this,ui),_call_super(this,ui,arguments)}return _inherits(ui,e),_create_class(ui,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A,w,D;return _ts_generator(this,function(I){switch(I.label){case 0:return I.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,l=e.opponentId,u=e.extraData,d=new n3(t),y=new ae(t,{opponentId:l}),d.setNext(y),_=new nX(t,{mode:f.CHALLENGE_FRIEND,customData:{playerId:o,opponentId:l}}),y.setNext(_),p=new ao(t,{extraData:u}),_.setNext(p),v=new n4(t),p.setNext(v),g=new ac(t),v.setNext(g),m=new nF(t),g.setNext(m),A=new al(t),m.setNext(A),w=new nB(t),A.setNext(w),D=t.match.getMatchState(),[4,d.processAsync(D)];case 1:return I.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),ui}(nS);c(au,"ChallengeFriendConcrete");var ad=/*#__PURE__*/function(e){function pi(e){var t;return _class_call_check(this,pi),(t=_call_super(this,pi,[e])).name="SameContext",t.message=null!=e?e:"Same context",t}return _inherits(pi,e),pi}(_wrap_native_super(Error));c(ad,"SameContext");var ah=o.Utils,af=/*#__PURE__*/function(e){function yi(e,t){var o;return _class_call_check(this,yi),h(o=_call_super(this,yi,[e]),"payload"),o.payload=t,o}return _inherits(yi,e),_create_class(yi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(yi.prototype),"processAsync",t)})().call(o,e),l=o.payload.contextId,[4,o.switchAsync(l)];case 1:return u.sent(),e.customData.contextId=l,[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"checkSameContext",value:function checkSameContext(e){var t=GameSDK.context.getID();if(t===e)throw new ad;if("SOLO"===e&&null===t)throw new ad}},{key:"switchAsync",value:function switchAsync(e){var t=this;return _async_to_generator(function(){var o,l;return _ts_generator(this,function(u){switch(u.label){case 0:o="SOLO"===e,u.label=1;case 1:return u.trys.push([1,3,,4]),t.checkSameContext(e),[4,GameSDK.context.switchAsync(e,o)];case 2:return u.sent(),[3,4];case 3:if(_instanceof(l=u.sent(),ad))return[2];if(!ah.Object.hasOwn(l,"code"))throw l;if(ah.Device.isAndroid()&&o&&"INVALID_PARAM"===l.code)return[2];if("SAME_CONTEXT"!==l.code)throw l;return[3,4];case 4:return[2]}})})()}}]),yi}(nT);c(af,"SwitchContextHandler");var ay=o.Dtos,a_=o.Utils.Object,ap=/*#__PURE__*/function(e){function fi(){return _class_call_check(this,fi),_call_super(this,fi,arguments)}return _inherits(fi,e),_create_class(fi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(fi.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),[4,o.getMatchAsync(e)];case 1:return l=d.sent(),u=new ay.Match.Data(l).toObject(),o.validateContinueMatchData(e,u),o.updateMatchData(e,u),o.validatePlayerTurn(e),[4,o.nextAsync(e)];case 2:return d.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id,o=e.status;if("string"!=typeof t)throw new nH;if(o!==nG.OPEN)throw new at}},{key:"validateContinueMatchData",value:function validateContinueMatchData(e,t){var o=e.id,l=e.customData,u=t._id,d=t.whitePlayerId,f=t.blackPlayerId;if("string"!=typeof u||u!==o)throw console.warn("\uD83E\uDD16 ? respMatchDataValidated",t),new nj;var y=l.playerId,_=d===y;if(!_&&f===M.playerId)throw new e$;if(!_&&f!==y)throw new nW}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,o=e.customData.playerId;if("string"!=typeof o)throw new G;if(t[o].finished)throw new eX}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){return[2,(o=e.id)?t.match.api.getMatchAPI().getMatchDetailByIdAsync(o):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t.extraData;e.customData=a_.merge(e.customData,o)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,l=t.blackPlayerId,u=o===e.customData.playerId;e.customData.playerId=u?o:l,e.customData.opponentId=u?l:o}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,l=t.opponentId;if(!o||!l)return;var u={name:"",photo:"",finished:!1};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},u)),e.profiles[l]||(e.profiles[l]=_object_spread({id:l},u))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,t){var o=e.customData,l=o.playerId,u=o.opponentId;if(!l||!u)return;var d=t.whitePlayerId,f=t.whitePlayerScore,y=t.whitePlayerFinish,_=t.blackPlayerScore,p=t.blackPlayerFinish,v=d===l;e.profiles[l].score=v?f:_,e.profiles[u].score=v?_:f,e.profiles[l].finished=v?y:p,e.profiles[u].finished=v?p:y}}]),fi}(nT);c(ap,"ContinueMatchHandler");var av=/*#__PURE__*/function(e){function gi(e,t){var o;return _class_call_check(this,gi),h(o=_call_super(this,gi,[e]),"payload"),o.payload=t,o}return _inherits(gi,e),_create_class(gi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:if((function(){return _get(_get_prototype_of(gi.prototype),"processAsync",t)})().call(o,e),!o.payload.ignore)return[3,2];return[4,o.nextAsync(e)];case 1:return u.sent(),[2];case 2:return o.validateData(e),[4,o.createWideframesCurrentScoreAsync()];case 3:return(l=u.sent())&&o.sendMessageAsync(e,l),[4,o.nextAsync(e)];case 4:return u.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,l=o.contextId,u=o.opponentId;if(!t||"string"!=typeof t)throw new nH;if(!l||"string"!=typeof l)throw new nZ;if(!u||"string"!=typeof u)throw new nK}},{key:"createWideframesCurrentScoreAsync",value:function createWideframesCurrentScoreAsync(){var e=this;return _async_to_generator(function(){var t,o,l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),o=(t=e.game).player,l=t.frameCapture,d=(u=o.getPlayer()).playerId,f=u.photo,_=void 0===(y=(e.match.getMatchState().profiles[d]||{}).score)?0:y,[4,l.wideframe.renderShareScore({playerId:d,playerPhoto:f,playerScore:_})];case 1:return[2,p.sent()];case 2:return[2,(console.warn("createWideframesCurrentScoreAsync",p.sent()),null)];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var o,l,u,d,f,y,_,p;return _ts_generator(this,function(v){switch(v.label){case 0:if(o=e.id,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||"string"!=typeof d)throw new G;if(!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");if(!(y=l[d]))throw new n0;if(_=y.name,p={data:{type:eU.CHALLENGE_FRIEND,matchId:o,playerId:d,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(_," made an update."),localizations:{vi_VN:"".concat(_," đ\xe3 cập nhật trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:return v.sent(),[2]}})})()}}]),gi}(nT);c(av,"SendUpdateMessageHandler");var ag=/*#__PURE__*/function(e){function wi(){return _class_call_check(this,wi),_call_super(this,wi,arguments)}return _inherits(wi,e),_create_class(wi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A,w,D,I,b,S;return _ts_generator(this,function(k){switch(k.label){case 0:return k.trys.push([0,,2,3]),t.startLog(e),o=e.contextId,l=e.matchId,u=e.playerId,d=e.opponentId,_=void 0===(y=e.sendUpdateMessage)||y,p=new n3(t),v=new af(t,{contextId:o}),p.setNext(v),g=new nX(t,{id:l,mode:f.CHALLENGE_FRIEND,customData:{playerId:u,opponentId:d}}),v.setNext(g),m=new ap(t),g.setNext(m),A=new n4(t),m.setNext(A),w=new ac(t),A.setNext(w),D=new av(t,{ignore:!_}),w.setNext(D),I=new nF(t),D.setNext(I),b=new nB(t),I.setNext(b),S=t.match.getMatchState(),[4,p.processAsync(S)];case 1:return k.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),wi}(nS);c(ag,"ContinueChallengeMatchConcrete");var am=o.Plugins,aA=o.Utils,aw=am.Analytics,aD=aA.String,aI=aA.Valid,ab=/*#__PURE__*/function(e){function mi(){return _class_call_check(this,mi),_call_super(this,mi,arguments)}return _inherits(mi,e),_create_class(mi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d,f,y,_,p;return _ts_generator(this,function(v){switch(v.label){case 0:return(function(){return _get(_get_prototype_of(mi.prototype),"processAsync",t)})().call(o,e),l=e.customData,u=e.mode,d=e.startAt,f=e.finishAt,y=l.level,o.validateMode(u),o.validateLevel(y),_=o.game.analytics,p=Math.floor((f-d)/1e3),_.event(aw.Events.MATCH_END,{level:y,game_mode:aD.toUpperCamelCase(u),level_name:o.getLevelName(y),time_played:p}),[4,o.nextAsync(e)];case 1:return v.sent(),[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!aI.isString(e))throw new nP}},{key:"validateLevel",value:function validateLevel(e){if(!aI.isNumber(e))throw new nk}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(aD.padStart(e.toString(),5,"0"))}}]),mi}(nT);c(ab,"LogMatchFinishedHandler");var aS=/*#__PURE__*/function(e){function Ai(e){var t;return _class_call_check(this,Ai),(t=_call_super(this,Ai,[e])).name="LeaderboardNotExist",t.message=null!=e?e:"Leaderboard not exist in game",t}return _inherits(Ai,e),Ai}(_wrap_native_super(Error));c(aS,"LeaderboardNotExist");var ak=/*#__PURE__*/function(e){function Di(e){var t;return _class_call_check(this,Di),(t=_call_super(this,Di,[e])).name="ScoreNotValid",t.message=null!=e?e:"Score is not valid",t}return _inherits(Di,e),Di}(_wrap_native_super(Error));c(ak,"ScoreNotValid");var aP=o.Utils.Valid,aE=o.Configs.Leaderboards.LeaderboardList,aC=/*#__PURE__*/function(e){function Ii(e,t){var o;return _class_call_check(this,Ii),h(o=_call_super(this,Ii,[e]),"payload"),h(o,"skipPostScore"),o.payload={score:0,playerId:""},o.skipPostScore=!!(null!=t&&t.ignore),o}return _inherits(Ii,e),_create_class(Ii,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d,f,y,_,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:if((function(){return _get(_get_prototype_of(Ii.prototype),"processAsync",t)})().call(o,e),!o.skipPostScore)return[3,2];return[4,o.nextAsync(e)];case 1:return g.sent(),[2];case 2:if(o.setupSetScorePayload(e),!("submitGameResultsAsync"in GameSDK.extra))return[3,4];return[4,GameSDK.extra.submitGameResultsAsync(o.payload.score)];case 3:g.sent(),g.label=4;case 4:l=true,u=false,d=void 0;try{for(f=aE[Symbol.iterator]();!(l=(y=f.next()).done);l=true)p=(_=y.value).Id,v=_.Mode,e.mode&&o.isValidMode(v,e.mode)&&o.setLeaderboardScoreAsync(_object_spread({leaderboardId:p},o.payload))}catch(e){u=true,d=e}finally{try{if(!l&&null!=f.return)f.return()}finally{if(u)throw d}}return[4,o.nextAsync(e)];case 5:return g.sent(),[2]}})})()}},{key:"isValidMode",value:function isValidMode(e,t){return e===t}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){if(o=e.profiles,!(l=e.customData.playerId)||!o[l])throw new n0;if(u=o[l].score,!aP.isNumber(u))throw new ak;return t.payload={score:u,playerId:l},[2]})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),o=e.playerId,l=e.score,u=e.leaderboardId,!(d=t.game.leaderboard.getLeaderboardName(u)))throw new aS;return[4,t.game.leaderboard.setLeaderboardScoreAsync(d,o,l)];case 1:return f.sent(),[3,3];case 2:return console.warn("setLeaderboardScoreAsync",f.sent()),[3,3];case 3:return[2]}})})()}}]),Ii}(nT);c(aC,"PostGlobalLeaderboardsScoreHandler");var ax=o.Dtos,aT=o.Utils,aL=aT.Valid,aN=aT.Object,aO=/*#__PURE__*/function(e){function vi(e,t){var o;return _class_call_check(this,vi),h(o=_call_super(this,vi,[e]),"payload"),o.payload=t,o}return _inherits(vi,e),_create_class(vi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if((function(){return _get(_get_prototype_of(vi.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),!o.payload.useAPI)return[3,2];return[4,o.finishMatchAsync(e)];case 1:return l=d.sent(),u=new ax.Match.Data(l).toObject(),o.updateMatchFromAPI(e,u),[3,3];case 2:o.updateMatchData(e),d.label=3;case 3:return o.updateMatchState(e),[4,o.nextAsync(e)];case 4:return d.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status,o=e.profiles,l=e.customData;if(t!==nG.ACTIVE)throw new nV;var u=l.playerId;if(!u||!aN.hasOwn(o,u))throw new nW}},{key:"updateMatchData",value:function updateMatchData(e){var t=e.customData.playerId;if(!aL.isString(t))throw new G;e.profiles[t].finished=!0}},{key:"updateMatchState",value:function updateMatchState(e){e.status=nG.FINISHED,e.finishAt=Date.now()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y;return _ts_generator(this,function(_){if(o=e.id,l=e.profiles,d=(u=e.customData).level,f=u.playerId,!aL.isString(f))throw new G;return y={matchId:null!=o?o:"",score:l[f].score,level:d,extraData:t.payload.extraData},[2,t.match.api.getMatchAPI().finishMatchAsync(y)]})})()}},{key:"updateMatchFromAPI",value:function updateMatchFromAPI(e,t){var o=e.customData,l=o.playerId,u=o.opponentId;if(!aL.isString(l))throw new G;if(!aL.isString(u))throw new nK;var d=t.whitePlayerId,f=t.whitePlayerScore,y=t.blackPlayerScore,_=t.whitePlayerFinish,p=t.blackPlayerFinish,v=l===d;e.profiles[l].score=v?f:y,e.profiles[u].score=v?y:f,e.profiles[l].finished=v?_:p,e.profiles[u].finished=v?p:_}}]),vi}(nT);c(aO,"FinishMatchHandler");var aR=/*#__PURE__*/function(e){function Pi(){return _class_call_check(this,Pi),_call_super(this,Pi,arguments)}return _inherits(Pi,e),_create_class(Pi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Pi.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createWideframesResultAsync(e)];case 1:return(l=u.sent())&&o.progressSendFinishedMessage(e,l),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,l=o.contextId,u=o.opponentId;if(!t||"string"!=typeof t)throw new nH;if(!l||"string"!=typeof l)throw new nZ;if(!u||"string"!=typeof u)throw new nK}},{key:"createWideframesResultAsync",value:function createWideframesResultAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A,w,D,I;return _ts_generator(this,function(b){switch(b.label){case 0:if(b.trys.push([0,2,,3]),o=t.game.frameCapture,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];return p=y.photo,g=void 0===(v=y.score)?0:v,m=y.finished,A=_.photo,D=void 0===(w=_.score)?0:w,I=_.finished,[4,o.wideframe.renderResultChallenge({playerId:d,playerPhoto:p,playerScore:g,opponentId:f,opponentPhoto:A,opponentScore:D,isPlayerFinished:!!m,isOpponentFinished:!!I})];case 1:return[2,b.sent()];case 2:return[2,(console.warn("createWideframesResultAsync",b.sent()),null)];case 3:return[2]}})})()}},{key:"progressSendFinishedMessage",value:function progressSendFinishedMessage(e,t){var o=e.profiles,l=e.customData,u=l.playerId,d=l.opponentId;if(!u||"string"!=typeof u)throw new G;if(!d||"string"!=typeof d)throw new nK;if(!o[u]||!o[d])throw new n0;var f=o[u],y=f.score,_=f.finished,p=o[d],v=p.score,g=p.finished;_?this.sendFinishMessageAsync(e,t):g&&(void 0===y?0:y)>(void 0===v?0:v)?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}},{key:"sendFinishMessageAsync",value:function sendFinishMessageAsync(e,t){return _async_to_generator(function(){var o,l,u,d,f,y,_,p;return _ts_generator(this,function(v){switch(v.label){case 0:if(o=e.id,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||"string"!=typeof d)throw new G;if(!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");if(!(y=l[d]))throw new n0;if(_=y.name,p={data:{type:eU.CHALLENGE_FRIEND,matchId:o,playerId:d,opponentId:f,status:nG.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(_," just finished. Check them now."),localizations:{vi_VN:"".concat(_," vừa ho\xe0n th\xe0nh m\xe0n chơi. Nhấn để xem kết quả trận đấu.")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:return v.sent(),[2]}})})()}},{key:"sendPlayTurnMessageAsync",value:function sendPlayTurnMessageAsync(e,t){return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:if(o=e.id,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||"string"!=typeof d)throw new G;if(!(y=l[d]))throw new n0;if(_=y.name,p=y.score,v={data:{type:eU.CHALLENGE_FRIEND,matchId:o,playerId:d,opponentId:f,status:nG.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(_," got ").concat(p," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(_," đ\xe3 đạt ").concat(p," điểm! Nhấn Chơi để so t\xe0i!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");return[4,GameSDK.extra.updateAsync(v)];case 1:return g.sent(),[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:if(o=e.id,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||"string"!=typeof d)throw new G;if(!(y=l[d]))throw new n0;if(_=y.name,p=y.score,v={data:{type:eU.CHALLENGE_FRIEND,matchId:o,playerId:d,opponentId:f,status:nG.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(_," beat your high score. Their score: ").concat(p),localizations:{vi_VN:"".concat(_," đ\xe3 vượt qua điểm số của bạn, với ").concat(p," điểm!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");return[4,GameSDK.extra.updateAsync(v)];case 1:return g.sent(),[2]}})})()}}]),Pi}(nT);c(aR,"SendFinishedMessageHandler");var aM=/*#__PURE__*/function(e){function Ei(e,t){var o;return _class_call_check(this,Ei),h(o=_call_super(this,Ei,[e]),"ignore"),o.ignore=!!(null!=t&&t.ignore),o}return _inherits(Ei,e),_create_class(Ei,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Ei.prototype),"processAsync",t)})().call(o,e),o.setPlayerBestScore(e),[4,o.nextAsync(e)];case 1:return l.sent(),[2]}})})()}},{key:"setPlayerBestScore",value:function setPlayerBestScore(e){if(this.ignore)return;var t=e.profiles,o=e.customData.playerId;if(!o||!t[o])throw new n0;var l=this.game.player,u=l.getBestScore()||0,d=t[o].score,f=void 0===d?0:d;f<=u||(l.setBestScore(f),t[o].bestScore=f)}}]),Ei}(nT);c(aM,"SetPlayerBestScoreHandler");var aF=/*#__PURE__*/function(e){function Si(){return _class_call_check(this,Si),_call_super(this,Si,arguments)}return _inherits(Si,e),_create_class(Si,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:return g.trys.push([0,,2,3]),t.startLog(e),o=(null!=e?e:{}).extraData,l=new n3(t),u=new aO(t,{useAPI:!0,extraData:o}),l.setNext(u),d=new aR(t),u.setNext(d),f=new ab(t),d.setNext(f),y=new aM(t),f.setNext(y),_=new aC(t),y.setNext(_),p=new nB(t),_.setNext(p),v=t.match.getMatchState(),[4,l.processAsync(v)];case 1:return g.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Si}(nS);c(aF,"FinishChallengeMatchConcrete");var aG=/*#__PURE__*/function(e){function xi(e){var t;return _class_call_check(this,xi),(t=_call_super(this,xi,[e])).name="ContextAreSolo",t.message=null!=e?e:"Context are solo",t}return _inherits(xi,e),xi}(_wrap_native_super(Error));c(aG,"ContextAreSolo");var aB=/*#__PURE__*/function(e){function bi(e){var t;return _class_call_check(this,bi),(t=_call_super(this,bi,[e])).name="ContextNotChallenge",t.message=null!=e?e:"Context is not a challenge",t}return _inherits(bi,e),bi}(_wrap_native_super(Error));c(aB,"ContextNotChallenge");var aj=/*#__PURE__*/function(e){function Ci(e){var t;return _class_call_check(this,Ci),(t=_call_super(this,Ci,[e])).name="NetworkFailure",t.message=null!=e?e:"Network failure",t}return _inherits(Ci,e),Ci}(_wrap_native_super(Error));c(aj,"NetworkFailure");var aV=o.Utils,aH=o.Dtos,aU=aV.Array,aK=aV.Object,aW=/*#__PURE__*/function(e){function Ti(e,t){var o;return _class_call_check(this,Ti),h(o=_call_super(this,Ti,[e]),"payload"),o.payload=t,o}return _inherits(Ti,e),_create_class(Ti,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Ti.prototype),"processAsync",t)})().call(o,e),o.checkCurrentContext(),[4,o.getOpponentIdFromContextAsync()];case 1:return l=u.sent(),e.customData.opponentId=l,[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"checkCurrentContext",value:function checkCurrentContext(){var e=GameSDK.context.getID();if("string"!=typeof e)throw new nZ;if("SOLO"===e)throw new aG}},{key:"getOpponentIdFromContextAsync",value:function getOpponentIdFromContextAsync(){var e=this;return _async_to_generator(function(){var t,o,l;return _ts_generator(this,function(u){switch(u.label){case 0:return t=e.payload.ignoreId,[4,e.getContextPlayers([t])];case 1:if((o=u.sent()).length>1)throw new aB;return l=M,[2,(1===o.length&&(l=o[0]),l.playerId)]}})})()}},{key:"getContextPlayers",value:function getContextPlayers(e){return _async_to_generator(function(){var t,o,l,u,d,f,y,_,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:return A.trys.push([0,2,,3]),[4,GameSDK.context.getPlayersAsync()];case 1:t=A.sent(),o=[],l=true,u=false,d=void 0;try{for(f=t[Symbol.iterator]();!(l=(y=f.next()).done);l=true)if(p=(_=y.value).getID(),!(e.indexOf(p)>-1)){if(!!(v=_.getName()))g=_.getPhoto(),o.push(new aH.Player.Info({playerId:p,name:v,photo:g}).toObject())}}catch(e){u=true,d=e}finally{try{if(!l&&null!=f.return)f.return()}finally{if(u)throw d}}return[2,aU.unique(o)];case 2:if(m=A.sent(),aK.hasOwn(m,"code")&&"NETWORK_FAILURE"===m.code)throw new aj;return[2,[]];case 3:return[2]}})})()}}]),Ti}(nT);c(aW,"GetOpponentChallengeContextHandler");var az=/*#__PURE__*/function(e){function Oi(e){var t;return _class_call_check(this,Oi),(t=_call_super(this,Oi,[e])).name="ContextIsTournament",t.message=null!=e?e:"Context is a tournament",t}return _inherits(Oi,e),Oi}(_wrap_native_super(Error));c(az,"ContextIsTournament");var aq=o.Utils.Object,aY=/*#__PURE__*/function(e){function Ni(){return _class_call_check(this,Ni),_call_super(this,Ni,arguments)}return _inherits(Ni,e),_create_class(Ni,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Ni.prototype),"processAsync",t)})().call(o,e),[4,o.chooseAsync()];case 1:return l=u.sent(),[4,o.checkContextTournament()];case 2:return u.sent(),e.customData.contextId=l,[4,o.nextAsync(e)];case 3:return u.sent(),[2]}})})()}},{key:"chooseAsync",value:function chooseAsync(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})];case 1:return o.sent(),[3,3];case 2:if(e=o.sent(),!aq.hasOwn(e,"code")||"SAME_CONTEXT"!==e.code)throw e;return[3,3];case 3:if("string"!=typeof(t=GameSDK.context.getID()))throw new n6;return[2,t]}})})()}},{key:"checkContextTournament",value:function checkContextTournament(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(o){switch(o.label){case 0:if(o.trys.push([0,4,,5]),!GameSDK.context.getID())return[2];if(!("getTournamentAsync"in GameSDK))return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:return o.sent(),e=new az,[3,3];case 2:e=new n$("getTournamentAsync"),o.label=3;case 3:throw e;case 4:if(_instanceof(t=o.sent(),az))throw t;return[3,5];case 5:return[2]}})})()}}]),Ni}(nT);c(aY,"ChooseContextHandler");var aJ=/*#__PURE__*/function(e){function Li(){return _class_call_check(this,Li),_call_super(this,Li,arguments)}return _inherits(Li,e),_create_class(Li,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A,w,D;return _ts_generator(this,function(I){switch(I.label){case 0:return I.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,l=e.extraData,u=new n3(t),d=new aY(t),u.setNext(d),y=new nX(t,{mode:f.CHALLENGE_FRIEND,customData:{playerId:o}}),d.setNext(y),_=new aW(t,{ignoreId:o}),y.setNext(_),p=new ao(t,{extraData:l}),_.setNext(p),v=new n4(t),p.setNext(v),g=new ac(t),v.setNext(g),m=new nF(t),g.setNext(m),A=new al(t),m.setNext(A),w=new nB(t),A.setNext(w),D=t.match.getMatchState(),[4,u.processAsync(D)];case 1:return I.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Li}(nS);c(aJ,"InviteFriendsConcrete");var aQ=/*#__PURE__*/function(e){function Ri(e){var t;return _class_call_check(this,Ri),(t=_call_super(this,Ri,[e])).name="JoinMatchFailed",t.message=null!=e?e:"Join match failed",t}return _inherits(Ri,e),Ri}(_wrap_native_super(Error));c(aQ,"JoinMatchFailed");var aX=/*#__PURE__*/function(e){function _i(e){var t;return _class_call_check(this,_i),(t=_call_super(this,_i,[e])).name="MatchAreFinished",t.message=null!=e?e:"Match are finished",t}return _inherits(_i,e),_i}(_wrap_native_super(Error));c(aX,"MatchAreFinished");var a$=/*#__PURE__*/function(e){function Mi(e){var t;return _class_call_check(this,Mi),(t=_call_super(this,Mi,[e])).name="OtherPlayerHasJoinedMatch",t.message=null!=e?e:"Other player has joined match",t}return _inherits(Mi,e),Mi}(_wrap_native_super(Error));c(a$,"OtherPlayerHasJoinedMatch");var aZ=o.Dtos,a0=o.Utils.Object,a2=/*#__PURE__*/function(e){function $i(){return _class_call_check(this,$i),_call_super(this,$i,arguments)}return _inherits($i,e),_create_class($i,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of($i.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),[4,o.joinMatchAsync(e)];case 1:return l=d.sent(),u=new aZ.Match.Data(l).toObject(),o.validateJoinMatchData(e,u),o.updateMatchData(e,u),[4,o.nextAsync(e)];case 2:return d.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){if(e.status!==nG.OPEN)throw new at}},{key:"validateJoinMatchData",value:function validateJoinMatchData(e,t){var o=e.id,l=e.customData,u=t._id,d=t.blackPlayerId,f=t.whitePlayerId,y=t.whitePlayerFinish,_=t.blackPlayerFinish,p=d===l.playerId,v=f===l.opponentId;if("string"!=typeof u||u!==o||!v)throw console.warn("\uD83E\uDD16 ? matchData",t),new aQ;if(y&&_)throw new aX;if(!p)throw new a$}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){return[2,(o=e.id)?t.match.api.getMatchAPI().joinMatchAsync(o):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t.extraData;e.customData=a0.merge(e.customData,o)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,l=t.blackPlayerId,u=o===e.customData.playerId;e.customData.playerId=u?o:l,e.customData.opponentId=u?l:o}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,l=t.opponentId;if(!o||!l)return;var u={name:"",photo:"",finished:!1};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},u)),e.profiles[l]||(e.profiles[l]=_object_spread({id:l},u))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,t){var o=e.customData,l=o.playerId,u=o.opponentId;if(!l||!u)return;var d=t.whitePlayerId,f=t.whitePlayerScore,y=t.whitePlayerFinish,_=t.blackPlayerScore,p=t.blackPlayerFinish,v=d===e.customData.playerId;e.profiles[l].score=v?f:_,e.profiles[u].score=v?_:f,e.profiles[l].finished=v?y:p,e.profiles[u].finished=v?p:y}}]),$i}(nT);c(a2,"JoinMatchHandler");var a3=/*#__PURE__*/function(e){function Gi(){return _class_call_check(this,Gi),_call_super(this,Gi,arguments)}return _inherits(Gi,e),_create_class(Gi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Gi.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createWideframesAcceptedAsync(e)];case 1:return(l=u.sent())&&o.sendMessageAsync(e,l),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,l=o.contextId,u=o.opponentId;if(!t||"string"!=typeof t)throw new nH;if(!l||"string"!=typeof l)throw new nZ;if(!u||"string"!=typeof u)throw new nK}},{key:"createWideframesAcceptedAsync",value:function createWideframesAcceptedAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A,w,D;return _ts_generator(this,function(I){switch(I.label){case 0:if(I.trys.push([0,4,,5]),o=t.game.frameCapture,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];if(p=y.photo,g=void 0===(v=y.score)?0:v,y.finished)return[2,null];if(m=_.photo,w=void 0===(A=_.score)?0:A,!_.finished)return[3,2];return[4,o.wideframe.renderResultChallenge({playerId:d,playerPhoto:p,playerScore:g,opponentId:f,opponentPhoto:m,opponentScore:w,isPlayerFinished:!1,isOpponentFinished:!0})];case 1:return D=I.sent(),[3,3];case 2:D=null,I.label=3;case 3:return[2,D];case 4:return[2,(console.warn("createWideframesAcceptedAsync",I.sent()),null)];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var o,l,u,d,f,y,_,p;return _ts_generator(this,function(v){switch(v.label){case 0:if(o=e.id,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||"string"!=typeof d)throw new G;if(!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");if(!(y=l[d]))throw new n0;return _=y.name,p={data:{type:eU.CHALLENGE_FRIEND,matchId:o,playerId:d,opponentId:f},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(_," accepted the challenge."),localizations:{vi_VN:"".concat(_," đ\xe3 chấp nhận tham gia trận đấu.")}},image:t,strategy:"LAST",notification:"PUSH"},[4,GameSDK.extra.updateAsync(p)];case 1:return v.sent(),[2]}})})()}}]),Gi}(nT);c(a3,"SendAcceptedMessageHandler");var a1=/*#__PURE__*/function(e){function Fi(){return _class_call_check(this,Fi),_call_super(this,Fi,arguments)}return _inherits(Fi,e),_create_class(Fi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A,w;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),t.startLog(e),o=e.matchId,l=e.playerId,u=e.opponentId,d=new n3(t),y=new nX(t,{id:o,mode:f.CHALLENGE_FRIEND,customData:{playerId:l,opponentId:u}}),d.setNext(y),_=new a2(t),y.setNext(_),p=new n4(t),_.setNext(p),v=new ac(t),p.setNext(v),g=new a3(t),v.setNext(g),m=new nF(t),g.setNext(m),A=new nB(t),m.setNext(A),w=t.match.getMatchState(),[4,d.processAsync(w)];case 1:return D.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Fi}(nS);c(a1,"JoinChallengeMatchConcrete");var a4={_id:"",status:"",appId:"",createdAt:"",startedAt:null,finishedAt:null,winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1,extraData:{}},a5=o.Configs.AppId,a6=o.Utils.Valid,a7="is invalid",a8=/*#__PURE__*/function(e){function ki(){return _class_call_check(this,ki),_call_super(this,ki,arguments)}return _inherits(ki,e),_create_class(ki,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){a6.isString(e)&&e||this.exception("_id",a7)}},{key:"validateStatus",value:function validateStatus(e){a6.isString(e)&&e||this.exception("status",a7)}},{key:"validateAppId",value:function validateAppId(e){a6.isString(e)&&e===a5||this.exception("appId",a7)}},{key:"validateCreatedAt",value:function validateCreatedAt(e){a6.isString(e)||this.exception("createdAt",a7)}},{key:"validateStartedAt",value:function validateStartedAt(e){null!==e&&(a6.isString(e)||this.exception("startedAt",a7))}},{key:"validateFinishedAt",value:function validateFinishedAt(e){null!==e&&(a6.isString(e)||this.exception("finishedAt",a7))}},{key:"validateExtraData",value:function validateExtraData(e){null!==e&&(a6.isObject(e)||this.exception("extraData",a7))}},{key:"validateWinnerId",value:function validateWinnerId(e){null===e||a6.isString(e)&&e||this.exception("winnerId",a7)}},{key:"validateWhitePlayerId",value:function validateWhitePlayerId(e){a6.isString(e)&&e||this.exception("whitePlayerId",a7)}},{key:"validateBlackPlayerId",value:function validateBlackPlayerId(e){a6.isString(e)&&e||this.exception("blackPlayerId",a7)}},{key:"validateWhitePlayerScore",value:function validateWhitePlayerScore(e){a6.isNumber(e)||this.exception("whitePlayerScore",a7)}},{key:"validateBlackPlayerScore",value:function validateBlackPlayerScore(e){a6.isNumber(e)||this.exception("blackPlayerScore",a7)}},{key:"validateWhitePlayerFinish",value:function validateWhitePlayerFinish(e){a6.isBoolean(e)||this.exception("whitePlayerFinish",a7)}},{key:"validateBlackPlayerFinish",value:function validateBlackPlayerFinish(e){a6.isBoolean(e)||this.exception("blackPlayerFinish",a7)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(ki.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return a4}}]),ki}(k);c(a8,"RespMatchDataDtos"),a8.addDefaultData(a4);var a9=/*#__PURE__*/function(e){function Vi(e){var t;return _class_call_check(this,Vi),(t=_call_super(this,Vi,[e])).name="MatchAreNotFinished",t.message=e||"Match are not finished",t}return _inherits(Vi,e),Vi}(_wrap_native_super(Error));c(a9,"MatchAreNotFinished");var re=/*#__PURE__*/function(e){function Ui(e){var t;return _class_call_check(this,Ui),(t=_call_super(this,Ui,[e])).name="OpponentNotFinishedMatch",t.message=e||"Opponent not finished match",t}return _inherits(Ui,e),Ui}(_wrap_native_super(Error));c(re,"OpponentNotFinishedMatch");var rt=o.Utils.Object,ra=/*#__PURE__*/function(e){function Bi(){return _class_call_check(this,Bi),_call_super(this,Bi,arguments)}return _inherits(Bi,e),_create_class(Bi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Bi.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),[4,o.getMatchAsync(e)];case 1:return l=new a8(u.sent()).toObject(),o.validateResultMatchData(e,l),o.updateMatchData(e,l),o.validatePlayerTurn(e),o.validateOpponentTurn(e),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){if("string"!=typeof e.id)throw new nH}},{key:"validateResultMatchData",value:function validateResultMatchData(e,t){var o=e.id,l=t._id,u=t.whitePlayerFinish,d=t.blackPlayerFinish;if("string"!=typeof l||l!==o)throw new nj;if(!u&&!d)throw new a9}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,o=e.customData.playerId;if("string"!=typeof o)throw new G;if(!t[o].finished)throw new nz}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,o=e.customData.opponentId;if("string"!=typeof o)throw new nK;if(!t[o].finished)throw new re}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){return[2,(o=e.id)?t.match.api.getMatchAPI().getMatchDetailByIdAsync(o):null]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t.extraData;e.status=nG.FINISHED,e.customData=rt.merge(e.customData,o)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,l=t.blackPlayerId,u=o===e.customData.playerId;e.customData.playerId=u?o:l,e.customData.opponentId=u?l:o}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,l=t.opponentId;if(!o||!l)return;var u={name:"",photo:"",finished:!0};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},u)),e.profiles[l]||(e.profiles[l]=_object_spread({id:l},u))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,t){var o=e.customData,l=o.playerId,u=o.opponentId;if(!l||!u)return;var d=t.whitePlayerId,f=t.whitePlayerScore,y=t.whitePlayerFinish,_=t.blackPlayerScore,p=t.blackPlayerFinish,v=d===e.customData.playerId;e.profiles[l].score=v?f:_,e.profiles[u].score=v?_:f,e.profiles[l].finished=v?y:p,e.profiles[u].finished=v?p:y}}]),Bi}(nT);c(ra,"ResultMatchHandler");var rs=/*#__PURE__*/function(e){function Wi(){return _class_call_check(this,Wi),_call_super(this,Wi,arguments)}return _inherits(Wi,e),_create_class(Wi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,,2,3]),t.startLog(e),o=e.matchId,l=e.playerId,u=e.opponentId,d=new n3(t),y=new nX(t,{id:o,mode:f.CHALLENGE_FRIEND,customData:{playerId:l,opponentId:u}}),d.setNext(y),_=new ra(t),y.setNext(_),p=new n4(t),_.setNext(p),v=new nB(t),p.setNext(v),g=t.match.getMatchState(),[4,d.processAsync(g)];case 1:return m.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Wi}(nS);c(rs,"ResultChallengeMatchConcrete");var ro=/*#__PURE__*/function(e){function ji(){var e;return _class_call_check(this,ji),e=_call_super(this,ji,arguments),h(e,"fallbackSingleMode"),h(e,"startFLowChallengeFriend",c(/*#__PURE__*/function(){var t=_async_to_generator(function(t){return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e.match.challenge.invite.processAsync(t)];case 1:return[2,(o.sent(),!0)];case 2:return[2,o.sent()];case 3:return[2]}})});return function(e){return t.apply(this,arguments)}}(),"startFLowChallengeFriend")),h(e,"startFlowTournament",c(/*#__PURE__*/function(){var t=_async_to_generator(function(t){var o;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,4]),"string"!=typeof(o=GameSDK.context.getID()))throw new nZ;return[4,e.match.tournament.continue.processAsync({playerId:t,contextId:o})];case 1:return l.sent(),[3,4];case 2:return l.sent(),[4,e.startFlowSingle(t)];case 3:return l.sent(),[3,4];case 4:return[2]}})});return function(e){return t.apply(this,arguments)}}(),"startFlowTournament")),h(e,"startFlowSingle",c(/*#__PURE__*/function(){var t=_async_to_generator(function(t){return _ts_generator(this,function(o){return[2,e.match.single.start.processAsync({playerId:t})]})});return function(e){return t.apply(this,arguments)}}(),"startFlowSingle")),e}return _inherits(ji,e),_create_class(ji,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,,7,8]),t.startLog(e),o=e.playerId,l=e.extraData,u=e.fallbackSingleMode,t.fallbackSingleMode=u,[4,t.startFLowChallengeFriend({playerId:o,extraData:l})];case 1:if(!0===(d=f.sent()))return[2];if(!_instanceof(d,az))return[3,3];return[4,t.startFlowTournament(o)];case 2:return f.sent(),[3,6];case 3:if(!t.fallbackSingleMode)return[3,5];return[4,t.startFlowSingle(o)];case 4:return f.sent(),[3,6];case 5:throw d;case 6:return[3,8];case 7:return t.endLog(),[7];case 8:return[2]}})})()}}]),ji}(nS);c(ro,"ChooseContextConcrete");var rc=/*#__PURE__*/function(e){function Ki(e){var t;return _class_call_check(this,Ki),(t=_call_super(this,Ki,[e])).name="LeaderboardIdNotValid",t.message=null!=e?e:"Leaderboard id is not valid",t}return _inherits(Ki,e),Ki}(_wrap_native_super(Error));c(rc,"LeaderboardIdNotValid");var rl=o.Utils.Valid,ru=/*#__PURE__*/function(e){function Hi(e,t){var o;return _class_call_check(this,Hi),h(o=_call_super(this,Hi,[e]),"payload"),h(o,"leaderboardPayload"),o.payload=t,o}return _inherits(Hi,e),_create_class(Hi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:if((function(){return _get(_get_prototype_of(Hi.prototype),"processAsync",t)})().call(o,e),o.setupSetScorePayload(e),!("submitGameResultsAsync"in GameSDK.extra))return[3,2];return[4,GameSDK.extra.submitGameResultsAsync(o.payload.score)];case 1:l.sent(),l.label=2;case 2:return o.setLeaderboardScoreAsync(),[4,o.nextAsync(e)];case 3:return l.sent(),[2]}})})()}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f;return _ts_generator(this,function(y){if(o=e.profiles,!(l=e.customData.playerId)||!o[l])throw new n0;if(d=(u=t.payload).score,f=u.leaderboardId,!rl.isNumber(d))throw new ak;if(!rl.isString(f))throw new rc;return t.leaderboardPayload={score:d,playerId:l,leaderboardId:f},[2]})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(){var e=this;return _async_to_generator(function(){var t,o,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),o=(t=e.leaderboardPayload).playerId,l=t.score,u=t.leaderboardId,!(d=e.game.leaderboard.getLeaderboardName(u)))throw new aS;return[4,e.game.leaderboard.setLeaderboardScoreAsync(d,o,l)];case 1:return f.sent(),[3,3];case 2:return console.warn("setLeaderboardScoreAsync",f.sent()),[3,3];case 3:return[2]}})})()}}]),Hi}(nT);c(ru,"SetLeaderboardScoreHandler");var rd=o.Utils.Valid,rh=/*#__PURE__*/function(e){function zi(e){return _class_call_check(this,zi),_call_super(this,zi,[e,{score:0,leaderboardId:""}])}return _inherits(zi,e),_create_class(zi,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d,f,y;return _ts_generator(this,function(_){if(l=e.profiles,d=(u=e.customData).playerId,!(f=u.leaderboardId))throw new rc;if(!d||!l[d])throw new n0;if(y=l[d].score,!rd.isNumber(y))throw new ak;return o.payload.score=y,o.payload.leaderboardId=f,(function(){return _get(_get_prototype_of(zi.prototype),"setupSetScorePayload",t)})().call(o,e),[2]})})()}}]),zi}(ru);c(rh,"PostLeaderboardScoreHandler");var rf=/*#__PURE__*/function(e){function qi(){return _class_call_check(this,qi),_call_super(this,qi,arguments)}return _inherits(qi,e),_create_class(qi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(qi.prototype),"processAsync",t)})().call(o,e),o.validateData(e),o.progressSendGroupMessage(e),[4,o.nextAsync(e)];case 1:return l.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,l=o.contextId,u=o.opponentId;if(!t||"string"!=typeof t)throw new nH;if(!l||"string"!=typeof l)throw new nZ;if(!u||"string"!=typeof u)throw new nK}},{key:"createWideframesResultGroupAsync",value:function createWideframesResultGroupAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A,w;return _ts_generator(this,function(D){switch(D.label){case 0:if(D.trys.push([0,2,,3]),o=t.game.frameCapture,l=e.profiles,d=(u=e.customData).playerId,f=u.opponentId,!d||!f)return[2,null];if(y=l[d],_=l[f],!y||!_)return[2,null];return p=y.photo,g=void 0===(v=y.score)?0:v,m=_.photo,w=void 0===(A=_.score)?0:A,[4,o.wideframe.renderResultChallenge({playerId:d,playerPhoto:p,playerScore:g,opponentId:f,opponentPhoto:m,opponentScore:w,isPlayerFinished:!0,isOpponentFinished:!0})];case 1:return[2,D.sent()];case 2:return[2,(console.warn("createWideframesResultGroupAsync",D.sent()),null)];case 3:return[2]}})})()}},{key:"createWideframesBestScoreAsync",value:function createWideframesBestScoreAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:if(g.trys.push([0,2,,3]),l=(o=t.game).player,u=o.frameCapture,d=e.customData.playerId,y=(f=l.getPlayer()).playerId,_=f.photo,p=f.data,d!==y)return[2,null];return v=(p||{}).score,[4,u.wideframe.renderShareScore({playerId:y,playerPhoto:_,playerScore:v})];case 1:return[2,g.sent()];case 2:return[2,(console.warn("createWideframesBestScoreAsync",g.sent()),null)];case 3:return[2]}})})()}},{key:"progressSendGroupMessage",value:function progressSendGroupMessage(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:if(o=e.profiles,u=(l=e.customData).playerId,!((d=l.opponentId)&&"string"==typeof d))return[3,2];if(!u||"string"!=typeof u)throw new G;if(f=o[u],y=o[d],!f||!y)return[2];if(!((void 0===(_=f.score)?0:_)>(void 0===(p=y.score)?0:p)))return[3,2];return[4,t.createWideframesResultGroupAsync(e)];case 1:if(!(v=m.sent()))return[2];return t.sendBestScoreMessageAsync(e,v),[2];case 2:return[4,t.createWideframesBestScoreAsync(e)];case 3:return(g=m.sent())&&t.sendChallengeMessageAsync(e,g),[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){var o=this;return _async_to_generator(function(){var l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:if(l=e.profiles,!(u=e.customData.playerId)||"string"!=typeof u)throw new G;if(!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");if(!(d=l[u]))throw new n0;if(f=d.name,y=d.score,_={data:{type:o.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:u,playerName:f,playerScore:y},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:"".concat(f," beats your high score. Their score: ").concat(y,"."),localizations:{vi_VN:"".concat(f," vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");return[4,GameSDK.extra.updateAsync(_)];case 1:return p.sent(),[2]}})})()}},{key:"sendChallengeMessageAsync",value:function sendChallengeMessageAsync(e,t){var o=this;return _async_to_generator(function(){var l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:if(l=e.profiles,!(u=e.customData.playerId)||"string"!=typeof u)throw new G;if(!(d=l[u]))throw new n0;if(f=d.name,y=d.score,_={data:{type:o.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:u,playerName:f,playerScore:y},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(f," got ").concat(y," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(f," đ\xe3 đạt ").concat(y," điểm! Qu\xe1 dễ lu\xf4n. Chơi lại n\xe0o!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new n$("updateAsync");return[4,GameSDK.extra.updateAsync(_)];case 1:return p.sent(),[2]}})})()}}]),qi}(nT);c(rf,"SendGroupMessageHandler");var ry=/*#__PURE__*/function(e){function Yi(){return _class_call_check(this,Yi),_call_super(this,Yi,arguments)}return _inherits(Yi,e),_create_class(Yi,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,o,l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,,2,3]),e.startLog(),t=new n3(e),o=new aO(e,{useAPI:!1}),t.setNext(o),l=new rf(e),o.setNext(l),u=new ab(e),l.setNext(u),d=new aM(e),u.setNext(d),f=new rh(e),d.setNext(f),y=new nB(e),f.setNext(y),_=e.match.getMatchState(),[4,t.processAsync(_)];case 1:return p.sent(),[3,3];case 2:return e.endLog(),[7];case 3:return[2]}})})()}}]),Yi}(nS);c(ry,"FinishGroupConcrete");var r_=o.Dtos,rp=/*#__PURE__*/function(e){function Qi(e,t){var o;return _class_call_check(this,Qi),h(o=_call_super(this,Qi,[e]),"payload"),o.payload=t,o}return _inherits(Qi,e),_create_class(Qi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Qi.prototype),"processAsync",t)})().call(o,e),o.updateProfileMatchData(e),[4,o.nextAsync(e)];case 1:return l.sent(),[2]}})})()}},{key:"updateProfileMatchData",value:function updateProfileMatchData(e){var t=this.payload.id,o=e.profiles;if(!o[t])throw new n0;var l=_object_spread({},o[t],this.payload),u=new r_.Match.Profile(l).toObject();o[u.id]=u}}]),Qi}(nT);c(rp,"SetProfileDataHandler");var rv=/*#__PURE__*/function(e){function Xi(){return _class_call_check(this,Xi),_call_super(this,Xi,arguments)}return _inherits(Xi,e),_create_class(Xi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:return w.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,l=e.opponentId,u=e.opponentScore,d=new n3(t),y=new nX(t,{id:"7749",mode:f.MATCHING_GROUP,customData:{playerId:o,opponentId:l}}),d.setNext(y),_=new n4(t),y.setNext(_),p=new rp(t,{id:o,score:u}),_.setNext(p),v=new ac(t),p.setNext(v),g=new nF(t),v.setNext(g),m=new nB(t),g.setNext(m),A=t.match.getMatchState(),[4,d.processAsync(A)];case 1:return w.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Xi}(nS);c(rv,"JoinGroupConcrete");var rg=/*#__PURE__*/function(e){function Ji(e){var t;return _class_call_check(this,Ji),(t=_call_super(this,Ji,[e])).name="MatchGroupNotSupported",t.message=null!=e?e:"Match group is not supported",t}return _inherits(Ji,e),Ji}(_wrap_native_super(Error));c(rg,"MatchGroupNotSupported");var rm=/*#__PURE__*/function(e){function Zi(e,t){var o;return _class_call_check(this,Zi),h(o=_call_super(this,Zi,[e]),"payload"),o.payload=t,o}return _inherits(Zi,e),_create_class(Zi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Zi.prototype),"processAsync",t)})().call(o,e),[4,o.checkMatchGroupSupported()];case 1:return u.sent(),[4,o.matchingGroup()];case 2:return l=u.sent(),e.customData.contextId=l,[4,o.nextAsync(e)];case 3:return u.sent(),[2]}})})()}},{key:"checkMatchGroupSupported",value:function checkMatchGroupSupported(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:if(!("getSupportedAPIs"in GameSDK))throw new n$("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new n$("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new rg;return[4,GameSDK.extra.checkCanPlayerMatchAsync()];case 1:if(!e.sent())throw new rg;return[2]}})})()}},{key:"matchingGroup",value:function matchingGroup(){var e=this;return _async_to_generator(function(){var t,o,l,u,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:if(!("matchPlayerAsync"in GameSDK.extra))throw new n$("matchPlayerAsync");return o=(t=e.payload).matchTag,u=void 0!==(l=t.autoSwitch)&&l,f=void 0!==(d=t.onlyExisting)&&d,[4,GameSDK.extra.matchPlayerAsync(o,u,f)];case 1:if(_.sent(),"string"!=typeof(y=GameSDK.context.getID()))throw new n6;return[2,y]}})})()}}]),Zi}(nT);c(rm,"GroupContextHandler");var rA=/*#__PURE__*/function(e){function er(){return _class_call_check(this,er),_call_super(this,er,arguments)}return _inherits(er,e),_create_class(er,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A,w;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),t.startLog(e),o=e.matchTag,l=e.playerId,u=e.options,d=new n3(t),y=new rm(t,_object_spread({matchTag:o},u)),d.setNext(y),_=new nX(t,{id:"7749",mode:f.MATCHING_GROUP,customData:{playerId:l}}),y.setNext(_),p=new aW(t,{ignoreId:l}),_.setNext(p),v=new ac(t),p.setNext(v),g=new n4(t),v.setNext(g),m=new nF(t),g.setNext(m),A=new nB(t),m.setNext(A),w=t.match.getMatchState(),[4,d.processAsync(w)];case 1:return D.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),er}(nS);c(rA,"StartGroupConcrete");var rw=/*#__PURE__*/function(e){function tr(){return _class_call_check(this,tr),_call_super(this,tr,arguments)}return _inherits(tr,e),_create_class(tr,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,o,l,u,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return _.trys.push([0,,2,3]),e.startLog(),t=new n3(e),o=new aO(e,{useAPI:!1}),t.setNext(o),l=new ab(e),o.setNext(l),u=new aM(e),l.setNext(u),d=new aC(e),u.setNext(d),f=new nB(e),d.setNext(f),y=e.match.getMatchState(),[4,t.processAsync(y)];case 1:return _.sent(),[3,3];case 2:return e.endLog(),[7];case 3:return[2]}})})()}}]),tr}(nS);c(rw,"FinishSingleConcrete");var rD=/*#__PURE__*/function(e){function sr(e){var t;return _class_call_check(this,sr),(t=_call_super(this,sr,[e])).name="ProfileIdNotDefined",t.message=null!=e?e:"Profile id is not defined",t}return _inherits(sr,e),sr}(_wrap_native_super(Error));c(rD,"ProfileIdNotDefined");var rI=o.Dtos,rb=/*#__PURE__*/function(e){function ar(e,t){var o;return _class_call_check(this,ar),h(o=_call_super(this,ar,[e]),"payload"),o.payload=t,o}return _inherits(ar,e),_create_class(ar,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if((function(){return _get(_get_prototype_of(ar.prototype),"processAsync",t)})().call(o,e),!(l=o.payload.profileId))throw new rD;if(u=o.game.player.getPlayerId(),l!==u)return[3,1];return d=o.getPlayerProfile(),[3,3];case 1:return[4,o.getProfileAsync(l)];case 2:if(!(d=f.sent()))throw new n0;f.label=3;case 3:return o.updateMatchData(d,e),[4,o.nextAsync(e)];case 4:return f.sent(),[2]}})})()}},{key:"getPlayerProfile",value:function getPlayerProfile(){var e=this.game.player.getPlayer();return{playerId:e.playerId,name:e.name,photo:e.photo,locale:e.locale}}},{key:"getProfileAsync",value:function getProfileAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,(o=t.game.profile).requestProfiles([e])];case 1:return[2,(l.sent(),o.getProfiles()[e])]}})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var o=e.playerId,l=e.name,u=e.photo,d=new rI.Match.Profile({id:o,name:l,photo:u}).toObject();t.profiles[o]=d}}]),ar}(nT);c(rb,"GetProfileHandler");var rS=/*#__PURE__*/function(e){function nr(){return _class_call_check(this,nr),_call_super(this,nr,arguments)}return _inherits(nr,e),_create_class(nr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,l=new n3(t),u=new af(t,{contextId:"SOLO"}),l.setNext(u),d=new nX(t,{id:"123456",mode:f.SINGLE,customData:{playerId:o}}),u.setNext(d),y=new ac(t),d.setNext(y),_=new rb(t,{profileId:o}),y.setNext(_),p=new nF(t),_.setNext(p),v=new nB(t),p.setNext(v),g=t.match.getMatchState(),[4,l.processAsync(g)];case 1:return m.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),nr}(nS);c(rS,"StartSingleConcrete");var rk=/*#__PURE__*/function(e){function ir(){return _class_call_check(this,ir),_call_super(this,ir,arguments)}return _inherits(ir,e),_create_class(ir,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:return w.trys.push([0,,2,3]),t.startLog(e),u=void 0!==(l=(o=null!=e?e:{}).setPlayerBestScore)&&l,f=void 0!==(d=o.postGlobalLeaderboard)&&d,y=new n3(t),_=new aO(t,{useAPI:!1}),y.setNext(_),p=new ab(t),_.setNext(p),v=new aM(t,{ignore:!u}),p.setNext(v),g=new aC(t,{ignore:!f}),v.setNext(g),m=new nB(t),g.setNext(m),A=t.match.getMatchState(),[4,y.processAsync(A)];case 1:return w.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),ir}(nS);c(rk,"FinishStrategyConcrete");var rP=/*#__PURE__*/function(e){function rr(){return _class_call_check(this,rr),_call_super(this,rr,arguments)}return _inherits(rr,e),_create_class(rr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A,w;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),t.startLog(e),o=e.matchId,l=e.playerId,u=e.gameMode,f=void 0===(d=e.extraData)?{}:d,y=new n3(t),_=new af(t,{contextId:"SOLO"}),y.setNext(_),p=new nX(t,{id:o,mode:u,customData:_object_spread({playerId:l},f)}),_.setNext(p),v=new ac(t),p.setNext(v),g=new rb(t,{profileId:l}),v.setNext(g),m=new nF(t),g.setNext(m),A=new nB(t),m.setNext(A),w=t.match.getMatchState(),[4,y.processAsync(w)];case 1:return D.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),rr}(nS);c(rP,"StartStrategyConcrete");var rE=o.Plugins,rC=o.Utils,rx=rE.Analytics,rT=rC.String,rL=rC.Valid,rN=/*#__PURE__*/function(e){function or(){return _class_call_check(this,or),_call_super(this,or,arguments)}return _inherits(or,e),_create_class(or,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d,f,y;return _ts_generator(this,function(_){switch(_.label){case 0:return(function(){return _get(_get_prototype_of(or.prototype),"processAsync",t)})().call(o,e),l=e.mode,u=e.customData,o.validateMode(l),d=o.game.analytics,f=u.tournamentId,y=u.leaderboardId,d.event(rx.Events.TOURNAMENT_START,{success:!0,game_mode:rT.toUpperCamelCase(l),tournament_id:f,leaderboard_id:y}),[4,o.nextAsync(e)];case 1:return _.sent(),[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!rL.isString(e))throw new nP}}]),or}(nT);c(rN,"LogTournamentStartHandler");var rO=/*#__PURE__*/function(e){function cr(e){var t;return _class_call_check(this,cr),(t=_call_super(this,cr,[e])).name="TournamentIdNotValid",t.message=null!=e?e:"Tournament id is not valid",t}return _inherits(cr,e),cr}(_wrap_native_super(Error));c(rO,"TournamentIdNotValid");var rR=o.Utils.Valid,rM=/*#__PURE__*/function(e){function lr(e,t){var o;return _class_call_check(this,lr),h(o=_call_super(this,lr,[e]),"payload"),o.payload=t,o}return _inherits(lr,e),_create_class(lr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:return(function(){return _get(_get_prototype_of(lr.prototype),"processAsync",t)})().call(o,e),l=o.payload.contextId,o.validateContextId(l),[4,GameSDK.getTournamentAsync()];case 1:return d=(u=y.sent()).getID().toString(),o.validateTournamentId(d),f=JSON.parse(u.getPayload()||"{}").leaderboardId,o.validateLeaderboardId(f),e.customData.contextId=l,e.customData.tournamentId=d,e.customData.leaderboardId=f,[4,o.nextAsync(e)];case 2:return y.sent(),[2]}})})()}},{key:"validateContextId",value:function validateContextId(e){if(!rR.isString(e))throw new nZ}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!rR.isString(e))throw new rO}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!rR.isString(e)||""===e)throw new rc}}]),lr}(nT);c(rM,"ContinueTournamentHandler");var rF=/*#__PURE__*/function(e){function dr(){return _class_call_check(this,dr),_call_super(this,dr,arguments)}return _inherits(dr,e),_create_class(dr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:return w.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,l=e.contextId,u=new n3(t),d=new rM(t,{contextId:l}),u.setNext(d),y=new nX(t,{id:"1997",mode:f.TOURNAMENT,customData:{playerId:o}}),d.setNext(y),_=new ac(t),y.setNext(_),p=new rb(t,{profileId:o}),_.setNext(p),v=new nF(t),p.setNext(v),g=new rN(t),v.setNext(g),m=new nB(t),v.setNext(m),A=t.match.getMatchState(),[4,u.processAsync(A)];case 1:return w.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),dr}(nS);c(rF,"ContinueTournamentConcrete");var rG=o.Plugins.Analytics,rB=/*#__PURE__*/function(e){function hr(){return _class_call_check(this,hr),_call_super(this,hr,arguments)}return _inherits(hr,e),_create_class(hr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:return(function(){return _get(_get_prototype_of(hr.prototype),"processAsync",t)})().call(o,e),l=e.customData,u=o.game.analytics,d=l.tournamentId,f=l.leaderboardId,u.event(rG.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:d,leaderboard_id:f}),[4,o.nextAsync(e)];case 1:return y.sent(),[2]}})})()}}]),hr}(nT);c(rB,"LogTournamentCreateHandler");var rj=/*#__PURE__*/function(e){function ur(e,t){var o;return _class_call_check(this,ur),h(o=_call_super(this,ur,[e]),"payload"),o.payload=t,o}return _inherits(ur,e),_create_class(ur,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(ur.prototype),"processAsync",t)})().call(o,e),[4,o.createTournamentAsync()];case 1:return l.sent(),[4,o.updateMatchStateAsync(e)];case 2:return l.sent(),[4,o.nextAsync(e)];case 3:return l.sent(),[2]}})})()}},{key:"createTournamentAsync",value:function createTournamentAsync(){var e=this;return _async_to_generator(function(){var t,o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return o=(t=e.payload).name,l=t.score,u=t.customData,[4,GameSDK.tournament.createAsync({initialScore:l,config:{title:o,tournamentTitle:o},data:u})];case 1:return d.sent(),[2]}})})()}},{key:"updateMatchStateAsync",value:function updateMatchStateAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,2,,3]),!("getTournamentAsync"in GameSDK))throw new n$("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 1:return l=(o=f.sent()).getContextID(),u=o.getID().toString(),d=t.payload.playerId,e.customData.playerId=d,e.customData.contextId=l,e.customData.tournamentId=u,[3,3];case 2:if(_instanceof(f.sent(),n$))return[2];return[3,3];case 3:return[2]}})})()}}]),ur}(nT);c(rj,"CreateTournamentHandler");var rV=o.Utils.Valid,rH=/*#__PURE__*/function(e){function pr(e,t){var o;return _class_call_check(this,pr),h(o=_call_super(this,pr,[e]),"payload"),h(o,"leaderboardPayload"),o.payload=t,o}return _inherits(pr,e),_create_class(pr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(pr.prototype),"processAsync",t)})().call(o,e),o.validatePayload(),[4,o.setupCreatePayload(e)];case 1:return l.sent(),[4,o.createLeaderboardAsync(e)];case 2:return l.sent(),[4,o.nextAsync(e)];case 3:return l.sent(),[2]}})})()}},{key:"validatePayload",value:function validatePayload(){var e=this.payload.leaderboardId;if(!rV.isString(e))throw new rc}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!rV.isString(e))throw new G}},{key:"setupCreatePayload",value:function setupCreatePayload(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f;return _ts_generator(this,function(y){return o=e.customData.playerId,t.validatePlayerId(o),u=(l=t.payload).name,d=l.leaderboardId,f=l.customData,t.leaderboardPayload={_id:d,name:null!=u?u:"",createdBy:o,description:JSON.stringify(f)},[2]})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,t.game.leaderboard.createLeaderboardAsync(t.leaderboardPayload)];case 1:return o=l.sent(),e.customData.leaderboardId=o,[2]}})})()}}]),pr}(nT);c(rH,"CreateLeaderboardHandler");var rU=/*#__PURE__*/function(e){function yr(){return _class_call_check(this,yr),_call_super(this,yr,arguments)}return _inherits(yr,e),_create_class(yr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A,w,D;return _ts_generator(this,function(I){switch(I.label){case 0:return I.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,l=e.name,u=e.score,d=e.leaderboardId,f=e.payload,y=new n3(t),_=new af(t,{contextId:"SOLO"}),y.setNext(_),p=new rj(t,{name:l,score:u,playerId:o,customData:f}),_.setNext(p),v=new rb(t,{profileId:o}),p.setNext(v),g=new rp(t,{id:o,score:u}),v.setNext(g),m=new rH(t,{name:l,customData:f,leaderboardId:d}),g.setNext(m),A=new rh(t),m.setNext(A),w=new rB(t),A.setNext(w),D=t.match.getMatchState(),[4,y.processAsync(D)];case 1:return I.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),yr}(nS);c(rU,"CreateTournamentConcrete");var rK=o.Plugins.Analytics,rW=o.Utils.Valid,rz=/*#__PURE__*/function(e){function fr(e,t){var o;return _class_call_check(this,fr),h(o=_call_super(this,fr,[e]),"payload"),o.payload=t,o}return _inherits(fr,e),_create_class(fr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(fr.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.postScoreTournamentAsync(e)];case 1:return l.sent(),[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.profiles,o=e.customData.playerId;if(this.validatePlayerId(o),!t[o])throw new n0}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!rW.isString(e))throw new G}},{key:"getPlayerProfile",value:function getPlayerProfile(e){var t=e.profiles,o=e.customData.playerId;return this.validatePlayerId(o),t[o]}},{key:"isNewBestScore",value:function isNewBestScore(e){var t=this.getPlayerProfile(e),o=t.score,l=t.bestScore;return(void 0===o?0:o)>(void 0===l?0:l)}},{key:"postScoreTournamentAsync",value:function postScoreTournamentAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:o=window.game.analytics,u=void 0===(l=t.getPlayerProfile(e).score)?0:l,d=null,f=!1,y=t.payload.checkBestScore,_=t.isNewBestScore(e),p.label=1;case 1:if(p.trys.push([1,7,8,9]),!("getTournamentAsync"in GameSDK))throw new n$("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 2:if(p.sent(),!(!y||_))return[3,4];return d=rK.Events.TOURNAMENT_SHARE,[4,GameSDK.tournament.shareAsync({score:u})];case 3:return p.sent(),[3,6];case 4:return d=rK.Events.TOURNAMENT_POST_SCORE,[4,GameSDK.tournament.postScoreAsync(u)];case 5:p.sent(),p.label=6;case 6:return f=!0,[3,9];case 7:return console.warn("Post Score Tournament",p.sent()),[3,9];case 8:return d&&o.event(d,{success:f}),[7];case 9:return[2]}})})()}}]),fr}(nT);c(rz,"PostScoreTournamentHandler");var rq=/*#__PURE__*/function(e){function gr(){return _class_call_check(this,gr),_call_super(this,gr,arguments)}return _inherits(gr,e),_create_class(gr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f,y,_,p,v,g,m,A,w,D;return _ts_generator(this,function(I){switch(I.label){case 0:return I.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,l=e.bestScore,d=void 0!==(u=e.checkBestScore)&&u,f=new n3(t),y=new aO(t,{useAPI:!1}),f.setNext(y),_=new rp(t,{id:o,bestScore:l}),y.setNext(_),p=new rz(t,{checkBestScore:d}),_.setNext(p),v=new ab(t),p.setNext(v),g=new aM(t),v.setNext(g),m=new rh(t),g.setNext(m),A=new aC(t),m.setNext(A),w=new nB(t),A.setNext(w),D=t.match.getMatchState(),[4,f.processAsync(D)];case 1:return I.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),gr}(nS);c(rq,"FinishTournamentConcrete");var rY=o.Utils,rJ=rY.Valid,rQ=rY.Object,rX=/*#__PURE__*/function(e){function wr(e,t){var o;return _class_call_check(this,wr),h(o=_call_super(this,wr,[e]),"payload"),o.payload=t,o}return _inherits(wr,e),_create_class(wr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:return(function(){return _get(_get_prototype_of(wr.prototype),"processAsync",t)})().call(o,e),l=o.payload.tournamentId,o.validateTournamentId(l),[4,o.joinTournamentAsync(l)];case 1:return y.sent(),[4,GameSDK.getTournamentAsync()];case 2:return d=(u=y.sent()).getContextID(),o.validateContextId(d),f=JSON.parse(u.getPayload()||"{}").leaderboardId,o.validateLeaderboardId(f),e.customData.contextId=d,e.customData.tournamentId=l,e.customData.leaderboardId=f,[4,o.nextAsync(e)];case 3:return y.sent(),[2]}})})()}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!rJ.isString(e))throw new rO}},{key:"validateContextId",value:function validateContextId(e){if(!rJ.isString(e))throw new nZ}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!rJ.isString(e)||""===e)throw new rc}},{key:"joinTournamentAsync",value:function joinTournamentAsync(e){return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(!("tournament"in GameSDK))throw new n$("tournament");o.label=1;case 1:return o.trys.push([1,3,,4]),[4,GameSDK.tournament.joinAsync(e)];case 2:return o.sent(),[3,4];case 3:if(t=o.sent(),!rQ.hasOwn(t,"code")||"SAME_CONTEXT"!==t.code)throw t;return[3,4];case 4:return[2]}})})()}}]),wr}(nT);c(rX,"JoinTournamentHandler");var r$=/*#__PURE__*/function(e){function mr(){return _class_call_check(this,mr),_call_super(this,mr,arguments)}return _inherits(mr,e),_create_class(mr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,l,u,d,y,_,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:return w.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,l=e.tournamentId,u=new n3(t),d=new rX(t,{tournamentId:l}),u.setNext(d),y=new nX(t,{id:"1997",mode:f.TOURNAMENT,customData:{playerId:o}}),d.setNext(y),_=new ac(t),y.setNext(_),p=new rb(t,{profileId:o}),_.setNext(p),v=new nF(t),p.setNext(v),g=new rN(t),v.setNext(g),m=new nB(t),g.setNext(m),A=t.match.getMatchState(),[4,u.processAsync(A)];case 1:return w.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),mr}(nS);c(r$,"JoinTournamentConcrete");var rZ=o.Dtos,r0=o.Utils.Object,r2=/*#__PURE__*/function(e){function Ar(){return _class_call_check(this,Ar),_call_super(this,Ar,arguments)}return _inherits(Ar,e),_create_class(Ar,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Ar.prototype),"processAsync",t)})().call(o,e),[4,o.getMatchCustomData(e)];case 1:return l=u.sent(),o.updateMatchCustomData(e,l),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"getMatchCustomData",value:function getMatchCustomData(e){var t=this;return _async_to_generator(function(){var o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(!(o=e.id))return[2,{}];return[4,t.match.api.getMatchAPI().getMatchDetailByIdAsync(o)];case 1:return[2,null!==(u=null==(l=d.sent())?void 0:l.extraData)&&void 0!==u?u:{}]}})})()}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e,t){var o=r0.merge(e.customData,t),l=new rZ.Match.CustomData(o).toObject();e.customData=l}}]),Ar}(nT);c(r2,"GetMatchCustomDataHandler");var r3=o.Dtos,r1=o.Utils.Object,r4=/*#__PURE__*/function(e){function Dr(e,t){var o;return _class_call_check(this,Dr),h(o=_call_super(this,Dr,[e]),"payload"),o.payload=t,o}return _inherits(Dr,e),_create_class(Dr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Dr.prototype),"processAsync",t)})().call(o,e),o.updateMatchCustomData(e),[4,o.nextAsync(e)];case 1:return l.sent(),[2]}})})()}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e){var t=r1.merge(e.customData,this.payload),o=new r3.Match.CustomData(t).toObject();e.customData=o}}]),Dr}(nT);c(r4,"SetMatchCustomDataHandler");var r5={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:_object_spread({},nQ)},r6=o.Configs,r7=/*#__PURE__*/function(e){function Ir(){var e;return _class_call_check(this,Ir),e=_call_super(this,Ir,arguments),h(e,"base"),h(e,"group"),h(e,"single"),h(e,"context"),h(e,"strategy"),h(e,"challenge"),h(e,"tournament"),h(e,"api"),h(e,"handler"),h(e,"useCPUProfile"),e}return _inherits(Ir,e),_create_class(Ir,[{key:"init",value:function init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}},{key:"setUseCPUProfile",value:function setUseCPUProfile(e){this.useCPUProfile=e}},{key:"createMatchData",value:function createMatchData(){this.game.storage.addStorage("match",r5)}},{key:"getMatchState",value:function getMatchState(){return this.game.storage.getStorage("match")}},{key:"createBaseConcrete",value:function createBaseConcrete(){this.base=new nS(this.game,this)}},{key:"createConcreteFlows",value:function createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createContextFlows(),this.createStrategyFlows(),this.createChallengeFlows(),this.createTournamentFlows()}},{key:"createConcreteHandlers",value:function createConcreteHandlers(){var e=this;this.handler={setProfileData:c(/*#__PURE__*/function(){var t=_async_to_generator(function(t){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return o=new rp(e.base,t),[4,e.processHandlerAsync(o)];case 1:return l.sent(),[2]}})});return function(e){return t.apply(this,arguments)}}(),"setProfileData"),setMatchCustomData:c(/*#__PURE__*/function(){var t=_async_to_generator(function(t){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return o=new r4(e.base,t),[4,e.processHandlerAsync(o)];case 1:return l.sent(),[2]}})});return function(e){return t.apply(this,arguments)}}(),"setMatchCustomData"),getMatchCustomData:c(/*#__PURE__*/_async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return t=new r2(e.base),[4,e.processHandlerAsync(t)];case 1:return o.sent(),[2]}})}),"getMatchCustomData"),setLeaderboardScore:c(/*#__PURE__*/function(){var t=_async_to_generator(function(t){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return o=new ru(e.base,t),[4,e.processHandlerAsync(o)];case 1:return l.sent(),[2]}})});return function(e){return t.apply(this,arguments)}}(),"setLeaderboardScore")}}},{key:"createAPIHandler",value:function createAPIHandler(){var e={appId:r6.AppId,matchAPIHost:r6.ApiHost};this.api=new nb(e)}},{key:"createGroupFlows",value:function createGroupFlows(){this.group={join:new rv(this.game,this),start:new rA(this.game,this),finish:new ry(this.game,this)}}},{key:"createSingleFlows",value:function createSingleFlows(){this.single={start:new rS(this.game,this),finish:new rw(this.game,this)}}},{key:"createStrategyFlows",value:function createStrategyFlows(){this.strategy={start:new rP(this.game,this),finish:new rk(this.game,this)}}},{key:"createContextFlows",value:function createContextFlows(){this.context={choose:new ro(this.game,this)}}},{key:"createChallengeFlows",value:function createChallengeFlows(){this.challenge={invite:new aJ(this.game,this),friend:new au(this.game,this),join:new a1(this.game,this),await:new n5(this.game,this),result:new rs(this.game,this),finish:new aF(this.game,this),continue:new ag(this.game,this)}}},{key:"createTournamentFlows",value:function createTournamentFlows(){this.tournament={join:new r$(this.game,this),create:new rU(this.game,this),finish:new rq(this.game,this),continue:new rF(this.game,this)}}},{key:"processHandlerAsync",value:function processHandlerAsync(e){var t=this.getMatchState();return e.processAsync(t)}}]),Ir}(l.Plugins.BasePlugin);c(r7,"MatchPlugin");var r8=o.Utils.Valid,r9="is invalid",se=/*#__PURE__*/function(e){function vr(){return _class_call_check(this,vr),_call_super(this,vr,arguments)}return _inherits(vr,e),_create_class(vr,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!r8.isNumber(e)||e<0)&&this.exception("level",r9)}},{key:"validateRescued",value:function validateRescued(e){(!r8.isNumber(e)||e<0)&&this.exception("rescued",r9)}},{key:"validateContextId",value:function validateContextId(e){r8.isString(e)||this.exception("contextId",r9)}},{key:"validatePlayerId",value:function validatePlayerId(e){r8.isString(e)||this.exception("playerId",r9)}},{key:"validateOpponentId",value:function validateOpponentId(e){r8.isString(e)||null===e||this.exception("opponentId",r9)}},{key:"validateTournamentId",value:function validateTournamentId(e){r8.isString(e)||null===e||this.exception("tournamentId",r9)}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){r8.isString(e)||null===e||this.exception("leaderboardId",r9)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(vr.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return k.getDefaultData()}}]),vr}(k);c(se,"MatchCustomDataDtos"),se.addDefaultData(nQ);var st=o.Utils.Valid,sa="is invalid",ss=/*#__PURE__*/function(e){function Pr(){return _class_call_check(this,Pr),_call_super(this,Pr,arguments)}return _inherits(Pr,e),_create_class(Pr,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){st.isString(e)&&e||this.exception("id",sa)}},{key:"validateName",value:function validateName(e){st.isString(e)&&e||this.exception("name",sa)}},{key:"validatePhoto",value:function validatePhoto(e){st.isString(e)||this.exception("photo",sa)}},{key:"validateScore",value:function validateScore(e){(!st.isNumber(e)||e<0)&&this.exception("score",sa)}},{key:"validateBestScore",value:function validateBestScore(e){(!st.isNumber(e)||e<0)&&this.exception("bestScore",sa)}},{key:"validateFinished",value:function validateFinished(e){st.isBoolean(e)||this.exception("finished",sa)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Pr.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return k.getDefaultData()}}]),Pr}(k);c(ss,"MatchProfileDtos"),ss.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1}),o.Dtos.Match={Data:a8,Profile:ss,CustomData:se};var so=o.Utils.Object,sc=o.Configs.ApiHost,sl=c(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,o;return _ts_generator(this,function(l){switch(l.label){case 0:return t="players","MsGames"===GameSDK.getSDKName()&&(t="players?platform=ms-games"),[4,es(t,e,{},sc,10)];case 1:return o=l.sent(),[2,so.hasOwn(o,"data")?o.data||{}:{}]}})});return function(t){return e.apply(this,arguments)}}(),"updatePlayerProfileAsync"),su=o.Utils,sd=su.Array,sh=su.Object,sf=su.Valid,sy=o.Configs.AppId,s_=/*#__PURE__*/function(e){function Er(){return _class_call_check(this,Er),_call_super(this,Er,arguments)}return _inherits(Er,e),_create_class(Er,[{key:"init",value:function init(){this.game.storage.addStorage("player",E)}},{key:"saveToCloud",value:function saveToCloud(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=e.getPlayerData(),[4,GameSDK.player.setDataAsync(t)];case 1:return o.sent(),[3,3];case 2:return console.warn(o.sent()),[3,3];case 3:return[2]}})})()}},{key:"receiveData",value:function receiveData(e,t){var o=this.game.storage,l=e.playerId,u=e.name,d=e.photo,f=e.locale;o.setStorageData("player","playerId",l),o.setStorageData("player","name",u),o.setStorageData("player","photo",d),o.setStorageData("player","locale",f),t&&this.setPlayerData(t)}},{key:"syncProfileToServer",value:function syncProfileToServer(){var e=this;return _async_to_generator(function(){var t,o,l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:if(GameSDK.extra.isGuest)throw new Error("Guest player cannot sync profile to server");if(t=e.game.storage,l=(o=e.getPlayer()).playerId,u=o.name,d=o.photo,f=o.locale,y=e.getPlayerASID(),!(!sf.isString(y)&&"getASIDAsync"in GameSDK.player))return[3,2];return[4,GameSDK.player.getASIDAsync()];case 1:y=null!==(_=p.sent())&&void 0!==_?_:y,t.setStorageData("player","ASID","".concat(y)),p.label=2;case 2:return[4,sl({appId:sy,ASID:y,playerId:l,name:u,photo:d,locale:f})];case 3:return p.sent(),[2]}})})()}},{key:"setPlayerDataByName",value:function setPlayerDataByName(e,t){this.setPlayerData(_define_property({},e,t))}},{key:"setPlayerData",value:function setPlayerData(e){this.game.storage.setStorageData("player","data",e),this.saveToCloud()}},{key:"setBestScore",value:function setBestScore(e){this.setPlayerDataByName("score",e)}},{key:"setBestEndlessScore",value:function setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}},{key:"setSetting",value:function setSetting(e,t){this.setPlayerDataByName("settings",_define_property({},e,t))}},{key:"setGameData",value:function setGameData(e){var t;var o=null!==(t=this.getGameData())&&void 0!==t?t:{},l=sh.merge(o,e);this.setPlayerDataByName("gameData",l)}},{key:"requestConnectedPlayers",value:function requestConnectedPlayers(){var e=this;return _async_to_generator(function(){var t,o,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return t=e.game.storage,[4,GameSDK.player.getConnectedPlayersAsync()];case 1:if(o=d.sent().map(function(e){var t=e.getID(),o=e.getName(),l=e.getPhoto();return t&&o&&l?new R({playerId:t,name:o,photo:l}).toObject():null}),(l=sd.unique(o)).length<1)return[2];return u=sh.keyBy(l,"playerId"),t.setStorageData("player","connectedPlayers",u),[2]}})})()}},{key:"getPlayer",value:function getPlayer(){return this.game.storage.getStorage("player")}},{key:"getPlayerId",value:function getPlayerId(){var e;return null!==(e=this.game.storage.getStorageData("player","playerId"))&&void 0!==e?e:""}},{key:"getPlayerASID",value:function getPlayerASID(){var e;return null!==(e=this.game.storage.getStorageData("player","ASID"))&&void 0!==e?e:null}},{key:"getPlayerLocale",value:function getPlayerLocale(){var e;return null!==(e=this.game.storage.getStorageData("player","locale"))&&void 0!==e?e:""}},{key:"getPlayerData",value:function getPlayerData(){var e;return null!==(e=this.game.storage.getStorageData("player","data"))&&void 0!==e?e:E.data}},{key:"getPlayerDataByKey",value:function getPlayerDataByKey(e){var t=this.getPlayerData();return sh.hasOwn(t,e)?t[e]:null}},{key:"getGameData",value:function getGameData(){return this.getPlayerDataByKey("gameData")}},{key:"getPlayerSetting",value:function getPlayerSetting(e){var t=this.getPlayerSettings();return sh.hasOwn(t,e)?t[e]:null}},{key:"getPlayerSettings",value:function getPlayerSettings(){return this.getPlayerData().settings}},{key:"isFirstLogin",value:function isFirstLogin(){var e;return null!==(e=this.getPlayerDataByKey("isFirstLogin"))&&void 0!==e?e:E.data.isFirstLogin}},{key:"loggedIn",value:function loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}},{key:"getBestScore",value:function getBestScore(){return this.getPlayerData().score}},{key:"getBestEndlessScore",value:function getBestEndlessScore(){return this.getPlayerData().endlessScore}},{key:"getConnectedPlayers",value:function getConnectedPlayers(){var e;return null!==(e=this.game.storage.getStorageData("player","connectedPlayers"))&&void 0!==e?e:{}}},{key:"getConnectedPlayerIds",value:function getConnectedPlayerIds(e,t){return Object.keys(this.getConnectedPlayers()).slice(t,t+e)}},{key:"getNotificationData",value:function getNotificationData(){var e;return null!==(e=this.getPlayerDataByKey("notificationData"))&&void 0!==e?e:E.data.notificationData}}]),Er}(l.Plugins.BasePlugin);c(s_,"PlayerPlugin");var sp=o.Dtos,sv=o.Utils.Valid,sg=E.data,sm=sg.score,sA=sg.endlessScore,sw=sg.settings,sD=sg.gameData,sI=sg.isFirstLogin,sb=sg.dailyRewarded,sS=sg.notificationData,sk=sg.lastCallSwitchGame,sP="is invalid",sE=/*#__PURE__*/function(e){function Sr(){return _class_call_check(this,Sr),_call_super(this,Sr,arguments)}return _inherits(Sr,e),_create_class(Sr,[{key:"processData",value:function processData(e){this.validateStructure(e),e.settings=new sp.Player.Settings(e.settings).toObject(),e.gameData=new sp.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}},{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateScore",value:function validateScore(e){(!sv.isNumber(e)||e<0)&&this.exception("score",sP)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!sv.isNumber(e)||sm<0)&&this.exception("endlessScore",sP)}},{key:"validateSettings",value:function validateSettings(e){sv.isObject(e)||this.exception("settings",sP)}},{key:"validateNotificationData",value:function validateNotificationData(e){sv.isObject(e)||this.exception("notificationData",sP),"D1"in e&&sv.isObject(e.D1)||this.exception("notificationData.D1",sP),"D2"in e&&sv.isObject(e.D2)||this.exception("notificationData.D2",sP),"D3"in e&&sv.isObject(e.D3)||this.exception("notificationData.D3",sP),"D4"in e&&sv.isObject(e.D4)||this.exception("notificationData.D4",sP),"D5"in e&&sv.isObject(e.D5)||this.exception("notificationData.D5",sP),"D6"in e&&sv.isObject(e.D6)||this.exception("notificationData.D6",sP),"D7"in e&&sv.isObject(e.D7)||this.exception("notificationData.D7",sP)}},{key:"validateGameData",value:function validateGameData(e){sv.isObject(e)||this.exception("gameData",sP)}},{key:"validateIsFirstLogin",value:function validateIsFirstLogin(e){sv.isBoolean(e)||this.exception("isFirstLogin",sP)}},{key:"validateDailyRewarded",value:function validateDailyRewarded(e){sv.isObject(e)||this.exception("dailyRewarded",sP)}},{key:"validateLastCallSwitchGame",value:function validateLastCallSwitchGame(e){sv.isNumber(e)||this.exception("lastCallSwitchGame",sP),e<0&&this.exception("lastCallSwitchGame",sP)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Sr.prototype),"toObject",this).call(this)}}]),Sr}(k);c(sE,"PlayerDataDtos"),sE.addDefaultData({score:sm,endlessScore:sA,settings:sw,gameData:sD,isFirstLogin:sI,dailyRewarded:sb,notificationData:sS,lastCallSwitchGame:sk});var sC=o.Utils.Valid,sx=E.data.gameData,sT=sx.level,sL=sx.coins,sN=/*#__PURE__*/function(e){function xr(){return _class_call_check(this,xr),_call_super(this,xr,arguments)}return _inherits(xr,e),_create_class(xr,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!sC.isNumber(e)||e<0)&&this.exception("level","is invalid")}},{key:"validateCoins",value:function validateCoins(e){(!sC.isNumber(e)||e<0)&&this.exception("coins","is invalid")}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(xr.prototype),"toObject",this).call(this)}}]),xr}(k);c(sN,"PlayerGameDataDtos"),sN.addDefaultData({level:sT,coins:sL});var sO=o.Utils.Valid,sR=E.data.settings,sM=sR.sound,sF=sR.music,sG=sR.vibrate,sB=sR.language,sj="is invalid",sV=/*#__PURE__*/function(e){function br(){return _class_call_check(this,br),_call_super(this,br,arguments)}return _inherits(br,e),_create_class(br,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateSound",value:function validateSound(e){sO.isBoolean(e)||this.exception("sound",sj)}},{key:"validateMusic",value:function validateMusic(e){sO.isBoolean(e)||this.exception("music",sj)}},{key:"validateVibrate",value:function validateVibrate(e){sO.isBoolean(e)||this.exception("vibrate",sj)}},{key:"validateLanguage",value:function validateLanguage(e){sO.isString(e)&&e||this.exception("language",sj)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(br.prototype),"toObject",this).call(this)}}]),br}(k);c(sV,"PlayerSettingsDtos"),sV.addDefaultData({sound:sM,music:sF,vibrate:sG,language:sB}),o.Dtos.Player={Info:R,Data:sE,Settings:sV,GameData:sN};var sH=o.Configs,sU=o.Utils,sK=sU.Object,sW=sU.String,sz=sH.ApiHost,sq=sH.Mockup,sY=/*#__PURE__*/function(){function Cr(){_class_call_check(this,Cr),h(this,"mockAPI")}return _create_class(Cr,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:if(e.mockAPI)return[2];return[4,d(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/ProfileAPIMock.js")];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=l.sent().default))throw new Error("Cannot load ProfileAPIMock");return e.mockAPI=new o,[2]}})})()}},{key:"getPlayersAsync",value:function getPlayersAsync(e){var t=this;return _async_to_generator(function(){var o,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(o=sW.params(e),!sq.Profile.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return u.sent(),[4,t.mockAPI.getPlayersAsync(e)];case 2:return l=u.sent(),[3,5];case 3:return[4,ea("players?".concat(o),{},sz)];case 4:l=u.sent(),u.label=5;case 5:return[2,sK.hasOwn(l,"data")&&Array.isArray(l.data)?l.data:[]]}})})()}}]),Cr}();c(sY,"ProfileAPI");var sJ={profiles:{},profileIds:[]},sQ=o.Utils,sX=o.Dtos,s$=sQ.Array,sZ=sQ.Valid,s0=sQ.Object,s2=sQ.Function,s3=/*#__PURE__*/function(e){function Tr(){var e;return _class_call_check(this,Tr),e=_call_super(this,Tr,arguments),h(e,"profileAPI",new sY),e}return _inherits(Tr,e),_create_class(Tr,[{key:"init",value:function init(){this.game.storage.addStorage("profile",sJ)}},{key:"requestProfiles",value:function requestProfiles(e){var t=this;return _async_to_generator(function(){var o,l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:if(o=t.getProfileIds(),(l=s$.difference(e,o)).length<1)return[2];return u=s$.chunk(l,400).map(function(e){return t.profileAPI.getPlayersAsync({playerIds:e})}),[4,s2.allSettled(u)];case 1:if(d=y.sent().reduce(function(e,t){return"fulfilled"===t.status?e.concat(t.value):e},[]),!t.validateProfilesResponse(d))return[2];return f=t.convertToProfiles(d),t.setProfiles(f),[2]}})})()}},{key:"getProfile",value:function getProfile(e){var t;return null!==(t=this.getProfiles()[e])&&void 0!==t?t:null}},{key:"getProfiles",value:function getProfiles(){var e;return null!==(e=this.game.storage.getStorageData("profile","profiles"))&&void 0!==e?e:sJ.profiles}},{key:"setProfiles",value:function setProfiles(e){var t=this.game.storage;t.setStorageData("profile","profiles",e),t.setStorageData("profile","profileIds",Object.keys(e))}},{key:"getProfileIds",value:function getProfileIds(){var e;return null!==(e=this.game.storage.getStorageData("profile","profileIds"))&&void 0!==e?e:[]}},{key:"validateProfilesResponse",value:function validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}},{key:"convertToProfiles",value:function convertToProfiles(e){var t={};var o=true,l=false,u=void 0;try{for(var d,f=e[Symbol.iterator]();!(o=(d=f.next()).done);o=true){var y=d.value;s0.hasOwn(y,"playerId")&&sZ.isString(y.playerId)&&(t[y.playerId]=new sX.Player.Info(y).toObject())}}catch(e){l=true,u=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(l)throw u}}return t}}]),Tr}(l.Plugins.BasePlugin);c(s3,"ProfilePlugin");var s1="Save The Pets",s4=o.Utils,s5=s4.Object,s6=s4.Valid,s7=s4.Browser,s8=/*#__PURE__*/function(e){function Or(e){var t;return _class_call_check(this,Or),h(t=_call_super(this,Or,[e]),"storages"),h(t,"storageLocalKeys",{}),t.storages={},t}return _inherits(Or,e),_create_class(Or,[{key:"addStorage",value:function addStorage(e,t,o){var l=arguments.length>2&&void 0!==o&&o;var u=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:if(console.info("addStorage",e,t),u.storages[e]=t,!l)return[3,2];return[4,u.initFromWebStorage(e,t)];case 1:o.sent(),o.label=2;case 2:return[2]}})})()}},{key:"initFromWebStorage",value:function initFromWebStorage(e,t){var o=this;return _async_to_generator(function(){var l,u,d,f,y,_,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:return o.storageLocalKeys[e]=!0,[4,s7.getIndexedDB("".concat(s1,"_S_").concat(e))];case 1:if(l=g.sent(),!s6.isObject(l))return[2];u=Object.keys(t),d=true,f=false,y=void 0;try{for(_=u[Symbol.iterator]();!(d=(p=_.next()).done);d=true)v=p.value,s5.hasOwn(l,v)&&_type_of(t[v])==_type_of(l[v])&&o.setStorageData(e,v,l[v])}catch(e){f=true,y=e}finally{try{if(!d&&null!=_.return)_.return()}finally{if(f)throw y}}return[2]}})})()}},{key:"initStorageData",value:function initStorageData(e,t,o){this.storages[e][t]=o}},{key:"setStorageData",value:function setStorageData(e,t,o){var l;if(s6.isObject(o)){var u=this.getStorageData(e,t);l=s5.merge(u,o)}else l=o;this.storages[e][t]=l}},{key:"getStorageData",value:function getStorageData(e,t){return this.getStorage(e)[t]}},{key:"getStorage",value:function getStorage(e){return this.storages[e]}},{key:"updateToWebStorage",value:function updateToWebStorage(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){if(t.storageLocalKeys[e])return[2,t.saveToWebStorage(e)];return[2]})})()}},{key:"saveToWebStorage",value:function saveToWebStorage(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){return o=t.getStorage(e),[2,s7.setIndexedDB("".concat(s1,"_S_").concat(e),o)]})})()}}]),Or}(l.Plugins.BasePlugin);c(s8,"StoragePlugin");var s9=/*#__PURE__*/function(e){function Nr(){var e;return _class_call_check(this,Nr),e=_call_super(this,Nr,arguments),h(e,"isVisible",!0),h(e,"browserPrefixes",["moz","ms","o","","webkit"]),h(e,"handleVisibilityChange",c(function(t){if(["focus","blur"].indexOf(t)>-1)return"focus"===t?e.onVisibleEvent():e.onHiddenEvent();var o=e.getBrowserPrefix();return e.getHiddenPropertyName(o)in document?e.onHiddenEvent():e.onVisibleEvent()},"handleVisibilityChange")),e}return _inherits(Nr,e),_create_class(Nr,[{key:"init",value:function init(){var e=this;var t=this.getBrowserPrefix(),o=[this.getVisibilityEvent(t),"focus","blur"];var l=true,u=false,d=void 0;try{for(var f,y=o[Symbol.iterator]();!(l=(f=y.next()).done);l=true)(function(){var t=f.value;window.addEventListener(t,function(){e.handleVisibilityChange(t)},!1),document.addEventListener(t,function(){e.handleVisibilityChange(t)},!1)})()}catch(e){u=true,d=e}finally{try{if(!l&&null!=y.return)y.return()}finally{if(u)throw d}}GameSDK.extra&&("onPause"in GameSDK.extra&&GameSDK.extra.onPause(function(){e.handleVisibilityChange("blur")}),"onResume"in GameSDK.extra&&GameSDK.extra.onResume(function(){e.handleVisibilityChange("focus")}))}},{key:"isGameVisible",value:function isGameVisible(){return this.isVisible}},{key:"getHiddenPropertyName",value:function getHiddenPropertyName(e){return e?"".concat(e,"Hidden"):"hidden"}},{key:"getVisibilityEvent",value:function getVisibilityEvent(e){return"".concat(e||"","visibilitychange")}},{key:"getBrowserPrefix",value:function getBrowserPrefix(){var e=true,t=false,o=void 0;try{for(var l,u=this.browserPrefixes[Symbol.iterator]();!(e=(l=u.next()).done);e=true){var d=l.value;if(this.getHiddenPropertyName(d)in document)return d}}catch(e){t=true,o=e}finally{try{if(!e&&null!=u.return)u.return()}finally{if(t)throw o}}return""}},{key:"onVisibleEvent",value:function onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(o.Events.VISIBILITY_VISIBLE))}},{key:"onHiddenEvent",value:function onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(o.Events.VISIBILITY_HIDDEN))}}]),Nr}(l.Plugins.BasePlugin);c(s9,"VisibilityPlugin");var ie=o.Utils.Array,it={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed"},ia={NOT_STARTED:"not-started",IN_PROGRESS:"in-progress",COMPLETED:"completed",FAILED:"failed"},is=["next","preroll","browse","pause","start"],io=["reward"],ic=/*#__PURE__*/function(){function oe(){_class_call_check(this,oe)}return _create_class(oe,null,[{key:"initStatus",get:function get(){return this._initStatus},set:function set(e){var t,o;this._initStatus!==e&&(null==(o=null==(t=this.game)?void 0:t.analytics)||o.initAdEvent({adService:"adsense",state:e}),this._initStatus=e)}},{key:"getRewardedVideoAsync",value:function getRewardedVideoAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.ensureInitialized()];case 1:return[2,(o.sent(),t.createAdInstance(t.rewardedType,e))]}})})()}},{key:"getInterstitialAdAsync",value:function getInterstitialAdAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.ensureInitialized()];case 1:return[2,(o.sent(),t.createAdInstance(t.interstitialType,e))]}})})()}},{key:"getRewardedInterstitialAsync",value:function getRewardedInterstitialAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.ensureInitialized()];case 1:return[2,(o.sent(),t.createAdInstance(t.rewardedType,e))]}})})()}},{key:"setGame",value:function setGame(e){this.game=e}},{key:"setRewardType",value:function setRewardType(e){ie.has(io,e)?this.rewardedType=e:console.warn("Rewarded Ad type: ".concat(e," is not supported."))}},{key:"setInterstitialType",value:function setInterstitialType(e){ie.has(is,e)?this.interstitialType=e:console.warn("Interstitial Ad type: ".concat(e," is not supported."))}},{key:"initAsync",value:function initAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:switch(l.trys.push([0,2,,3]),t.initStatus){case it.LOADED:return console.warn("Google AdSense already initiated."),[2];case it.LOADING:return console.warn("Google AdSense is being initiated."),[2]}if(!t.validateConfig(e))throw new Error("Invalid Google Ads configuration");return t.initStatus=it.LOADING,t.config=e,[4,t.loadScriptElementAsync()];case 1:return l.sent(),console.info("Google AdSense initialized successfully"),[3,3];case 2:throw o=l.sent(),t.initStatus=it.FAILED,console.warn("Failed to initialize Google AdSense:",o),o;case 3:return[2]}})})()}},{key:"validateConfig",value:function validateConfig(e){if(!e)return console.error("Google Ads config is required"),!1;var t=e.dataAdClient,o=e.dataAdHost;if(!t&&!o)return console.error("Either dataAdClient or dataAdHost is required"),!1;if(e.dataAdFrequencyHint){var l=Number(e.dataAdFrequencyHint);if(isNaN(l)||l<=0)return console.error("dataAdFrequencyHint must be a positive number"),!1}return!0}},{key:"loadScriptElementAsync",value:function loadScriptElementAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,e.injectMainScript()];case 1:return o.sent(),[4,e.configureGoogleAds()];case 2:return o.sent(),[3,4];case 3:throw console.warn("Failed to load Google Ads script:",t=o.sent()),t;case 4:return[2]}})})()}},{key:"injectMainScript",value:function injectMainScript(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return[2,new Promise(function(t,o){try{var l=document.createElement("script");e.configureScriptAttributes(l),l.onload=function(){e.initStatus=it.LOADED,t()},l.onerror=function(t){e.initStatus=it.FAILED,o(new Error("Failed to load Google Ads script: ".concat(t)))},document.head.appendChild(l)}catch(e){console.warn("Failed to inject main script:",e),o(e)}})]})})()}},{key:"configureGoogleAds",value:function configureGoogleAds(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(o.trys.push([0,3,,4]),window.adsbygoogle=window.adsbygoogle||[],window.adBreak=function(e){return adsbygoogle.push(e)},window.adConfig=function(e){return adsbygoogle.push(e)},!e.config.usePreload)return[3,2];return[4,e.preloadAdConfig()];case 1:o.sent(),o.label=2;case 2:return[3,4];case 3:throw console.warn("Failed to configure Google Ads:",t=o.sent()),t;case 4:return[2]}})})()}},{key:"configureScriptAttributes",value:function configureScriptAttributes(e){var t=this.config,o=t.dataAdClient,l=t.dataAdHost,u=t.dataAdChannel,d=t.dataAdBreakTest,f=t.dataAdFrequencyHint;e.async=!0,e.crossOrigin="anonymous";var y="";f&&e.setAttribute("data-ad-frequency-hint","".concat(f,"s")),o&&(e.setAttribute("data-ad-client",o),y+="?client=".concat(o)),u&&e.setAttribute("data-ad-channel",u),l&&(e.setAttribute("data-ad-host",l),y+="&host=".concat(l)),d&&e.setAttribute("data-adbreak-test","on"),e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js".concat(y)}},{key:"ensureInitialized",value:function ensureInitialized(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(e.initStatus!==it.LOADED)throw new Error("Google Ads not initialized. Call initAsync first.");return[4,e.ensurePreloaded()];case 1:return t.sent(),[2]}})})()}},{key:"ensurePreloaded",value:function ensurePreloaded(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(!(e.preloadStatus!==ia.COMPLETED))return[3,2];return[4,e.preloadAdPlacement()];case 1:t.sent(),t.label=2;case 2:return[2]}})})()}},{key:"createAdInstance",value:function createAdInstance(e,t){var o=this;return{getPlacementID:c(function(){return t},"getPlacementID"),loadAsync:c(function(){return o.preloadAdPlacement()},"loadAsync"),showAsync:c(function(){return o.showAd(e,t)},"showAsync"),hideAsync:c(function(){return Promise.resolve()},"hideAsync")}}},{key:"showAd",value:function showAd(e,t){var o=this;return _async_to_generator(function(){return _ts_generator(this,function(l){return[2,new Promise(function(l,u){try{var d=o.createAdBreakConfig({type:e,placementId:t,resolve:l,reject:u});window.adBreak(d)}catch(e){console.warn("Failed to show ad:",e),u(e)}})]})})()}},{key:"createAdBreakConfig",value:function createAdBreakConfig(e){var t=this.createBaseAdBreakConfig({placementId:e.placementId}),o=e.type;if(ie.has(is,o))return this.createInterstitialAdBreakConfig(t,e);if(ie.has(io,o))return this.createRewardAdBreakConfig(t,e);throw new Error("Ad type: ".concat(o," is not supported."))}},{key:"createBaseAdBreakConfig",value:function createBaseAdBreakConfig(e){return{name:e.placementId,beforeAd:c(function(){},"beforeAd"),adBreakDone:c(function(e){},"adBreakDone")}}},{key:"createInterstitialAdBreakConfig",value:function createInterstitialAdBreakConfig(e,t){var o=this;var l=t.resolve,u=t.reject;return _object_spread_props(_object_spread({},e),{type:this.interstitialType,adBreakDone:c(function(t){var d;null==(d=e.adBreakDone)||d.call(e,t),o.handleAdBreakDone({info:t,resolve:l,reject:u})},"adBreakDone")})}},{key:"createRewardAdBreakConfig",value:function createRewardAdBreakConfig(e,t){var o=t.resolve,l=t.reject;return _object_spread_props(_object_spread({},e),{type:this.rewardedType,beforeReward:c(function(e){e()},"beforeReward"),adDismissed:c(function(){l(new Error("USER_INPUT"))},"adDismissed"),adViewed:c(function(){o()},"adViewed")})}},{key:"handleAdBreakDone",value:function handleAdBreakDone(e){var t=e.info,o=e.resolve,l=e.reject;switch(t.breakStatus){case"viewed":o();break;case"frequencyCapped":l(new Error("AD_FREQUENCY_CAPPED"));break;default:l(new Error(t.breakStatus))}}},{key:"preloadAdPlacement",value:function preloadAdPlacement(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return[2,e.initStatus!==it.LOADED?Promise.reject(new Error("Google Ads not initiated.")):e.preloadAdConfig()]})})()}},{key:"getInitStatus",value:function getInitStatus(){return this.initStatus}},{key:"getPreloadStatus",value:function getPreloadStatus(){return this.preloadStatus}},{key:"preloadAdConfig",value:function preloadAdConfig(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){if(e.preloadStatus!==ia.COMPLETED&&e.preloadStatus!==ia.IN_PROGRESS)return[2,(e.preloadStatus=ia.IN_PROGRESS,new Promise(function(t,o){var l=setTimeout(function(){e.preloadStatus===ia.IN_PROGRESS&&(e.preloadStatus=ia.FAILED,o(new Error("Failed to preload ad config in time.")))},5e3);window.adConfig({preloadAdBreaks:"on",onReady:c(function(){clearTimeout(l),e.preloadStatus=ia.COMPLETED,t()},"onReady")})}))];return[2]})})()}}]),oe}();c(ic,"GoogleAds"),h(ic,"game"),h(ic,"_initStatus",it.IDLE),h(ic,"preloadStatus",ia.NOT_STARTED),h(ic,"config"),h(ic,"rewardedType","reward"),h(ic,"interstitialType","next"),window.GoogleAds=ic;var il=o.Utils.Object,iu=o.Plugins.Ads,id=iu.Status,ih=iu.Types,iy=iu.AdError,i_=/*#__PURE__*/function(e){function Lr(e,t){var o;return _class_call_check(this,Lr),h(o=_call_super(this,Lr,[e,t]),"service"),h(o,"instance"),h(o,"instanceQueue",[]),o.service=GameSDK.getSDKName(),o.instance=null,o}return _inherits(Lr,e),_create_class(Lr,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(console.debug("AdInstance","loadAsync called",{type:e.type,status:e.status,service:e.service,placementId:e.placementId}),!!(e.instance&&e.status===id.FILLED))return[3,5];if(e.status!==id.IDLE)throw new iy("AD_NOT_READY","Ad is not ready.");o.label=1;case 1:return o.trys.push([1,4,,5]),[4,e.createInstanceByType(e.type)];case 2:if(e.instance=o.sent(),null===e.instance)throw new iy("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");return e.setStatus(id.LOADING),[4,e.instance.loadAsync()];case 3:return o.sent(),e.setStatus(id.FILLED),console.debug("AdInstance","loadAsync success",{type:e.type,status:e.status,service:e.service}),e.logAdLoad(),[3,5];case 4:throw t=o.sent(),console.warn("AdInstance","loadAsync failed",{type:e.type,status:e.status,service:e.service}),console.warn(t),e.setStatus(id.IDLE),_instanceof(t,Object)&&"code"in t&&"INVALID_PARAM"===t.code&&(e.instance=null),e.instance&&e.pushInstanceToQueue(e.instance),self.game.analytics.loadAdFail({type:e.type,service:e.service}),t;case 5:return[2]}})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){var t,o;return _ts_generator(this,function(l){switch(l.label){case 0:if(console.debug("AdInstance","showAsync called",{type:e.type,status:e.status,service:e.service}),e.status!==id.FILLED)throw new iy("AD_NOT_FILLED","Ad is not filled.");if(null===e.instance)throw new iy("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");t=!1,l.label=1;case 1:return l.trys.push([1,3,4,5]),e.setStatus(id.SHOWING),self.game.analytics.showingAd({type:e.type,service:e.service}),[4,e.instance.showAsync()];case 2:return l.sent(),t=!0,e.setStatus(id.IDLE),e.instance=null,console.debug("AdInstance","showAsync success",{type:e.type,status:e.status,service:e.service}),[3,5];case 3:throw o=l.sent(),console.warn("AdInstance","showAsync failed",{type:e.type,status:e.status,service:e.service,error:o}),il.hasOwn(o,"code")&&("AD_NOT_LOADED"===o.code&&e.setStatus(id.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf("".concat(o.code))>-1&&(e.setStatus(id.IDLE),e.instance=null),"USER_INPUT"===o.code&&(t=!0)),e.status===id.SHOWING&&(e.setStatus(id.IDLE),e.instance=null),o;case 4:return t?e.logAdShown():self.game.analytics.showAdFail({type:e.type,service:e.service}),[7];case 5:return[2]}})})()}},{key:"createInstanceByType",value:function createInstanceByType(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,t.getAdInstanceByType(e)];case 1:return[2,l.sent()];case 2:return o=l.sent(),[2,il.hasOwn(o,"code")&&"ADS_TOO_MANY_INSTANCES"===o.code?t.getAdInstanceFailed():null];case 3:return[2]}})})()}},{key:"getAdInstanceByType",value:function getAdInstanceByType(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:switch(e){case ih.REWARDED_VIDEO:return[3,1];case ih.INTERSTITIAL:return[3,3];case ih.REWARDED_INTERSTITIAL:return[3,5]}return[3,7];case 1:return[4,GameSDK.getRewardedVideoAsync(t.placementId)];case 2:return[2,o.sent()];case 3:return[4,GameSDK.getInterstitialAdAsync(t.placementId)];case 4:return[2,o.sent()];case 5:return[4,GameSDK.getRewardedInterstitialAsync(t.placementId)];case 6:return[2,o.sent()];case 7:return[2,null];case 8:return[2]}})})()}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(){if(!("canBeLoadedAd"in GameSDK.extra))return this.instanceQueue.shift()||null;var e=true,t=false,o=void 0;try{for(var l,u=this.instanceQueue[Symbol.iterator]();!(e=(l=u.next()).done);e=true){var d=l.value;if(GameSDK.extra.canBeLoadedAd(d))return this.instanceQueue.splice(this.instanceQueue.indexOf(d),1),d}}catch(e){t=true,o=e}finally{try{if(!e&&null!=u.return)u.return()}finally{if(t)throw o}}return null}},{key:"logAdLoad",value:function logAdLoad(){switch(this.type){case ih.INTERSTITIAL:self.game.analytics.loadInterstitialAd({service:this.service});break;case ih.REWARDED_VIDEO:self.game.analytics.loadRewardedVideoAd({service:this.service});break;case ih.REWARDED_INTERSTITIAL:self.game.analytics.loadRewardedInterstitialAd({service:this.service});break}}},{key:"logAdShown",value:function logAdShown(){switch(this.type){case ih.INTERSTITIAL:self.game.analytics.showInterstitialAd({service:this.service});break;case ih.REWARDED_VIDEO:self.game.analytics.showRewardedVideoAd({service:this.service});break;case ih.REWARDED_INTERSTITIAL:self.game.analytics.showRewardedInterstitialAd({service:this.service});break}}},{key:"pushInstanceToQueue",value:function pushInstanceToQueue(e){this.instanceQueue.push(e)}}]),Lr}(iu.AdInstance);c(i_,"NormalAdInstance");var ip=o.Plugins.Ads.Types,iv=/*#__PURE__*/function(e){function Rr(e,t){var o;return _class_call_check(this,Rr),(o=_call_super(this,Rr,[e,t])).service="adsense",o}return _inherits(Rr,e),_create_class(Rr,[{key:"createInstanceByType",value:function createInstanceByType(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:switch(o.trys.push([0,9,,10]),e){case ip.REWARDED_VIDEO:return[3,1];case ip.INTERSTITIAL:return[3,3];case ip.REWARDED_INTERSTITIAL:return[3,5]}return[3,7];case 1:return[4,ic.getRewardedVideoAsync(t.placementId)];case 2:return[2,o.sent()];case 3:return[4,ic.getInterstitialAdAsync(t.placementId)];case 4:return[2,o.sent()];case 5:return[4,ic.getRewardedInterstitialAsync(t.placementId)];case 6:return[2,o.sent()];case 7:return[2,null];case 8:return[3,10];case 9:return[2,(console.warn(o.sent()),null)];case 10:return[2]}})})()}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(){return null}}]),Rr}(i_);c(iv,"AdSenseInstance");var ig=/*#__PURE__*/function(e){function _r(){return _class_call_check(this,_r),_call_super(this,_r,arguments)}return _inherits(_r,e),_create_class(_r,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return e.exception("Unsupported method"),[2]})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return e.exception("This method is not implemented"),[2]})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return e.exception("This method is not implemented"),[2]})})()}}]),_r}(ey);c(ig,"BannerInstance");var im=o.Plugins.Ads.Status,iA=/*#__PURE__*/function(e){function Mr(){return _class_call_check(this,Mr),_call_super(this,Mr,arguments)}return _inherits(Mr,e),_create_class(Mr,[{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.loadBannerAdAsync(e.placementId)];case 1:return t.sent(),e.setStatus(im.SHOWING),[2]}})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.hideBannerAdAsync(e.placementId)];case 1:return t.sent(),e.setStatus(im.IDLE),[2]}})})()}}]),Mr}(ig);c(iA,"BannerAdInstance");var iw=Object.defineProperty,iD=Object.getOwnPropertyDescriptor,iI=c(function(e,t,o,l){for(var u,d=l>1?void 0:l?iD(t,o):t,f=e.length-1;f>=0;f--)(u=e[f])&&(d=(l?u(t,o,d):u(d))||d);return l&&d&&iw(t,o,d),d},"__decorateClass");var ib=o.Plugins.Analytics,iS=ib.BaseAnalytics,ik=ib.Events,iP=o.Events,iE=iP.VISIBILITY_HIDDEN,iC=iP.VISIBILITY_VISIBLE,ix=o.Utils,iT=ix.Array,iL=ix.Object,iN=ix.Image,iO=ix.Decorator,iR=o.Configs.Analytics.ClarityAnalytics,iM=iL.invert(ik),iF=[ik.SCREEN_OPEN],iG=/*#__PURE__*/function(e){function $r(e,t){var o;return _class_call_check(this,$r),h(o=_call_super(this,$r,[e,"ClarityAnalytics",_object_spread_props(_object_spread({},t),{color:"#9692FF"})]),"image"),h(o,"screenshotCount",4),h(o,"isCapturing",!1),h(o,"isScreenshotByEvent",!1),h(o,"handleVisibilityHidden",c(function(){var e;null==(e=o.clarity)||e.call(o,"set","Visibility","hidden")},"handleVisibilityHidden")),h(o,"handleVisibilityVisible",c(function(){var e;null==(e=o.clarity)||e.call(o,"set","Visibility","visible")},"handleVisibilityVisible")),h(o,"makeScreenshotByEvent",c(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,l;var u=arguments;return _ts_generator(this,function(d){switch(d.label){case 0:if(t=u.length>1&&void 0!==u[1]?u[1]:0,!o.game.canvasRecorder||!o.isScreenshotByEvent||!iL.hasOwn(iM,e))return[2];if(l=iM[e],!iT.has(iR.ScreenshotCanvas.ByEvent,l))return[3,2];return[4,o.setScreenshotToHtml()];case 1:d.sent(),t<o.screenshotCount&&setTimeout(function(){return o.makeScreenshotByEvent(e,t+1)},300),d.label=2;case 2:return[2]}})});return function(t){return e.apply(this,arguments)}}(),"makeScreenshotByEvent")),h(o,"setScreenshotToHtml",c(/*#__PURE__*/_async_to_generator(function(){var e;return _ts_generator(this,function(t){switch(t.label){case 0:if(t.trys.push([0,,2,3]),o.isCapturing||(o.isCapturing=!0,!o.image))return[2];return[4,o.captureScreenshot()];case 1:if(!(e=t.sent()))return[2];return o.image.src=e,[3,3];case 2:return o.isCapturing=!1,[7];case 3:return[2]}})}),"setScreenshotToHtml")),o.setupScreenshots(),o.listenVisibilityEvents(),o}return _inherits($r,e),_create_class($r,[{key:"clarity",get:function get(){return iL.hasOwn(window,"clarity")?window.clarity:null}},{key:"setUser",value:function setUser(e){var t;null==(t=this.clarity)||t.call(this,"identify",e)}},{key:"listenVisibilityEvents",value:function listenVisibilityEvents(){this.game.event.on(iE,this.handleVisibilityHidden),this.game.event.on(iC,this.handleVisibilityVisible)}},{key:"processEvent",value:function processEvent(e,t){var o;this.setTagByEvent(e,t),this.makeScreenshotByEvent(e),iT.has(iF,e)||null==(o=this.clarity)||o.call(this,"event",e,t)}},{key:"setTagByEvent",value:function setTagByEvent(e,t){if(t)switch(e){case ik.PAGE_VIEW:case ik.SCREEN_OPEN:this.setPageTag(t);break;case ik.AD_SHOWING:this.setAdTag(t);break;case ik.BUTTON_CLICK:this.setButtonTag(t);break;case ik.TUTORIAL_STEP:this.setTutorialTag(t);break;case ik.LEVEL_START:this.setLevelTag(t);break;case ik.USE_ITEM:this.setItemTag(t);break}}},{key:"setPageTag",value:function setPageTag(e){var t;if(!e.page_title&&!e.path_path)return;var o=e.page_title||e.path_path;o&&(null==(t=this.clarity)||t.call(this,"set","Page",o))}},{key:"setAdTag",value:function setAdTag(e){var t;if(!e.ad_type||!e.ad_service)return;var o="".concat(e.ad_type,":").concat(e.ad_service);null==(t=this.clarity)||t.call(this,"set","Ad",o)}},{key:"setButtonTag",value:function setButtonTag(e){var t;if(!e.button_name||!e.screen_name)return;var o="".concat(e.button_name,":").concat(e.screen_name);null==(t=this.clarity)||t.call(this,"set","Button",o)}},{key:"setTutorialTag",value:function setTutorialTag(e){var t;if(!e.step)return;var o=e.step.toString();null==(t=this.clarity)||t.call(this,"set","Tutorial",o)}},{key:"setLevelTag",value:function setLevelTag(e){var t;if(!e.level_name||!e.game_mode)return;var o="".concat(e.game_mode,":").concat(e.level_name);null==(t=this.clarity)||t.call(this,"set","Level",o)}},{key:"setItemTag",value:function setItemTag(e){var t;e.item_name&&(null==(t=this.clarity)||t.call(this,"set","Item",e.item_name))}},{key:"setupScreenshots",value:function setupScreenshots(){if(("undefined"==typeof FileReader?"undefined":_type_of(FileReader))>"u"){console.warn("FileReader is not supported");return}this.initImage();var e=iR.ScreenshotCanvas,t=e.ByEvent,o=e.Interval;if(t.length>0){this.isScreenshotByEvent=!0;return}setInterval(this.setScreenshotToHtml,o)}},{key:"initImage",value:function initImage(){if(this.image)return;var e=document.getElementById("Cocos3dGameContainer");e&&(this.image=document.createElement("img"),this.image.id="clarity-screenshot",this.image.setAttribute("data-clarity-unmask","true"),iL.assign(this.image.style,{position:"absolute",display:"flex",width:"100%",top:0,left:0,pointerEvents:"none"}),e.insertBefore(this.image,e.firstChild))}},{key:"captureScreenshot",value:function captureScreenshot(){var e=this;return _async_to_generator(function(){var t,o;return _ts_generator(this,function(l){switch(l.label){case 0:if(!e.game.canvasRecorder)return[2,null];return[4,e.game.canvasRecorder.snapshotFrameAsync({force:!0,type:"jpeg",quality:.1,resolution:.5})];case 1:if(t=l.sent(),e.game.canvasRecorder.waitNextFrame(),!t)return[3,3];return[4,iN.blobToDataImage(t)];case 2:return o=l.sent(),[3,4];case 3:o=null,l.label=4;case 4:return[2,o]}})})()}}]),$r}(iS);c(iG,"ClarityAnalytics"),iI([iO.tryCatch()],iG.prototype,"setupScreenshots",1),iI([iO.tryCatch()],iG.prototype,"initImage",1),iI([iO.tryCatch()],iG.prototype,"captureScreenshot",1);var iB=o.Plugins.Analytics,ij=iB.BaseAnalytics,iV=iB.Events,iH=[iV.BUTTON_CLICK,iV.SCREEN_OPEN],iU=o.Utils.Array,iK=/*#__PURE__*/function(e){function Gr(e,t){var o;return _class_call_check(this,Gr),h(o=_call_super(this,Gr,[e,"FacebookAnalytics",_object_spread_props(_object_spread({},t),{color:"#0F52BA"})]),"prefix"),o.prefix=t.prefix,o}return _inherits(Gr,e),_create_class(Gr,[{key:"processEvent",value:function processEvent(e,t){if(!("logEvent"in GameSDK.extra)||iU.has(iH,e))return;var o=this.addPrefixToEventName(e);GameSDK.extra.logEvent(o,1,t)}},{key:"addPrefixToEventName",value:function addPrefixToEventName(e){return"".concat(this.prefix,"_").concat(e)}}]),Gr}(ij);c(iK,"FacebookAnalytics");var iW=o.Plugins.Analytics,iz=iW.BaseAnalytics,iq=[iW.Events.SCREEN_OPEN],iY=o.Utils.Array,iJ=/*#__PURE__*/function(e){function Fr(e,t){return _class_call_check(this,Fr),_call_super(this,Fr,[e,"FirebaseAnalytics",_object_spread_props(_object_spread({},t),{color:"#FFCA28"})])}return _inherits(Fr,e),_create_class(Fr,[{key:"setUser",value:function setUser(e,t){var o,l;null==(l=null==(o=this.game.firebase)?void 0:o.services.analytics)||l.setUser(e,t)}},{key:"processEvent",value:function processEvent(e,t){var o,l;iY.has(iq,e)||null==(l=null==(o=this.game.firebase)?void 0:o.services.analytics)||l.event(e,t)}}]),Fr}(iz);c(iJ,"FirebaseAnalytics");var iQ=o.Plugins.Analytics,iX=iQ.BaseAnalytics,i$=iQ.Events,iZ=[i$.SCREEN_OPEN],i0=o.Utils.Array,i2=/*#__PURE__*/function(e){function kr(e,t){return _class_call_check(this,kr),_call_super(this,kr,[e,"GoogleAnalytics",_object_spread_props(_object_spread({},t),{color:"#E35335"})])}return _inherits(kr,e),_create_class(kr,[{key:"processEvent",value:function processEvent(e,t){i0.has(iZ,e)||(this.customEvent(e,t),gtag("event",e,t))}},{key:"customEvent",value:function customEvent(e,t){switch(e){case i$.AD_SHOW:case i$.AD_SHOW_FAILED:case i$.AD_SHOWING:case i$.USE_ITEM:case i$.EARN_ITEM:this.addLevelName(t);break}}},{key:"addLevelName",value:function addLevelName(e){if(!e||!(null!=game&&game.match))return;var t=game.match.getMatchState().customData.level;t<0||(e.level_name=this.getLevelName(t))}}]),kr}(iX);c(i2,"GoogleAnalytics");var i3=o.Plugins.Analytics,i1=i3.BaseAnalytics,i4=i3.Events,i5=[i4.LEVEL_START,i4.LEVEL_END],i6=o.Utils.Array,i7=/*#__PURE__*/function(e){function Vr(e){return _class_call_check(this,Vr),_call_super(this,Vr,[e,"YandexAnalytics",{color:"#FFB02E"}])}return _inherits(Vr,e),_create_class(Vr,[{key:"processEvent",value:function processEvent(e){"logEvent"in GameSDK.extra&&i6.has(i5,e)&&GameSDK.extra.logEvent(e)}}]),Vr}(i1);c(i7,"YandexAnalytics");var i8=o.Dtos,i9=o.Events,ot=o.Configs,oa=ot.AppId,os=ot.Ads,oo=ot.Analytics,oc=ot.AdaptivePerformance,ol=ot.Debugger,ou=ot.Firebase,od=ot.Notification,oh=ot.RemoteConfig,of=ot.PerformanceMonitor,oy=o.Plugins.Ads.Types,o_=o.Utils,op=o_.Device,ov=o_.Object,og=o_.Json,om=o_.String,oA=o_.Valid,ow=o_.Mark,oD=/*#__PURE__*/function(e){function Ur(){var e;return _class_call_check(this,Ur),e=_call_super(this,Ur,arguments),h(e,"markName","Core Initialize"),h(e,"modulePlugins",[]),h(e,"processContextSession",c(/*#__PURE__*/_async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return ow.putAttr(e.markName,"Step","Process Context Payload"),[4,e.context.detectContextSessionType()];case 1:return o.sent(),e.context.detectContextGameMode(),t=e.storage.getStorageData("context","sessionContextType")||"unknown",ow.putAttr(e.markName,"Context Mode",t),console.warn("GameCore start completed",t),ow.stop(e.markName),[2]}})}),"processContextSession")),h(e,"addDevPlugins",c(function(){var t;var o=ol.ListPlayerDevIds,l=null==(t=null==GameSDK?void 0:GameSDK.player)?void 0:t.getID();!l||o.indexOf(l)<0||(e.addConsolePlugin(),e.addProfilerPlugin())},"addDevPlugins")),h(e,"handleProtectGameInstance",c(function(){e.event.getEventEmitCount(y.MODULE_PLUGIN_READY)<e.modulePlugins.length||(window.game=Object.freeze(window.game),console.warn("window.game",window.game))},"handleProtectGameInstance")),h(e,"initCanvasRecorderPlugin",c(function(){if(!e.canvasRecorder)return;var t=ol.CanvasRecorder,o=t.Options,l=o.Type,u=o.Quality,d=o.RecordFps,f=o.SyncFps;e.canvasRecorder.configure({type:l,quality:u,syncFps:f,recordFps:d}),e.canvasRecorder.setPanelExpanded(t.PanelExpanded);var y=document.querySelector("canvas");if(!y){console.error("Canvas not found");return}e.canvasRecorder.setCanvas(y)},"initCanvasRecorderPlugin")),h(e,"initMonitorErrorPlugin",c(function(){var t;if(!e.monitorError)return;var o=ol.MonitorError,l=ol.ListPlayerDevIds,u=o.ApiKey,d=o.Service,f=o.Feedback,y=o.TrackUser,_=o.FilterErrors,p=GameSDK.player.getID(),v=GameSDK.player.getName();p&&l.indexOf(p)>=0||(null==(t=window.disableSimpleTrackErrors)||t.call(window),e.monitorError.configure({apiKey:u,service:d,feedback:f,trackUser:y,releaseStage:"development",buildVersion:"".concat("24")}),e.monitorError.setUser({id:p,name:v}),e.monitorError.addFilterErrors(_),e.monitorError.initFeedbackTrackErrors(),e.updateMonitorErrorUserAndMetadata(),e.processErrorsQueue())},"initMonitorErrorPlugin")),h(e,"updateMonitorErrorUserAndMetadata",c(function(){e.event.catchUp(i9.PLAYER_INFO_LOADED,e.processWhenPlayerInfoLoaded)},"updateMonitorErrorUserAndMetadata")),h(e,"processErrorsQueue",c(function(){if(e.monitorError&&window.__errorQueue){var t=true,o=false,l=void 0;try{for(var u,d=window.__errorQueue[Symbol.iterator]();!(t=(u=d.next()).done);t=true){var f=u.value;if(_instanceof(f,Error))e.monitorError.sendException(f);else{var y=f||{message:"",code:"Unknown",stack:"Unknown stack"},_=y.message,p=y.code,v=y.stack,g=new Error(_||p);g.stack=v,e.monitorError.sendException(g)}}}catch(e){o=true,l=e}finally{try{if(!t&&null!=d.return)d.return()}finally{if(o)throw l}}window.__errorQueue=null}},"processErrorsQueue")),h(e,"processWhenPlayerInfoLoaded",c(function(){if(!e.monitorError)return;var t=e.player.getPlayer(),o=t.playerId,l=t.name;e.monitorError.setUser({id:o,name:l}),e.monitorError.addMetadata({isFirstLogin:e.player.isFirstLogin()})},"processWhenPlayerInfoLoaded")),h(e,"handleSaveRemoteConfig",c(function(t){try{var o=_define_property({},t.type,t);e.player.setPlayerDataByName("remoteConfig",o)}catch(e){console.warn("handleSaveGameCoreConfig",e)}},"handleSaveRemoteConfig")),h(e,"handleUpdateGameCoreConfig",c(function(t){try{var l=t.id,u=t.type;if("GameCore"!==u)return;o.Configs=ov.merge(o.Configs,t.config);var d=o.Configs.Ads;e.ads.configure(d),e.event.emit(y.REMOTE_CONFIG_UPDATED,{id:l,type:u})}catch(e){console.warn("handleUpdateGameCoreConfig",e)}},"handleUpdateGameCoreConfig")),h(e,"handleStorageCurrentRemoteConfig",c(function(){var t=e.player.getPlayerDataByKey("remoteConfig");if(console.debug("playerRemoteConfig",og.clone(t)),!!t){for(var o in t)if(ov.hasOwn(t,o)){var l=t[o],u=og.clone(l);console.log("newRemoteConfig",u);var d=new i8.RemoteConfig.Data(u).toObject();console.debug("remoteConfigValid",d),e.remoteConfig.setRemoteConfig(d),e.remoteConfig.processUpdateConfig(d.id,d.type)}}},"handleStorageCurrentRemoteConfig")),h(e,"initAdaptivePerformancePlugin",c(function(){if(!e.adaptivePerformance)return;var t=og.clone(oc);e.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin")),h(e,"processAfterSyncProfile",c(function(){od.Enabled&&e.updatePlayerProfileToNotificationService()},"processAfterSyncProfile")),e}return _inherits(Ur,e),_create_class(Ur,[{key:"getBuildVersion",value:function getBuildVersion(){return parseInt("".concat("24"))||0}},{key:"boot",value:function boot(){var e=this;var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){return console.groupEnd(),console.groupCollapsed("\uD83E\uDDEC GameCore Boot"),(function(){return _get(_get_prototype_of(Ur.prototype),"boot",e)})().call(t),t.addPlugins(),t.initEventPlugin(),t.event.emit(i9.CORE_BOOTING),t.initFirebasePlugin(),t.initMarkCoreInitialize(),ow.putAttr(t.markName,"Step","Init Analytics"),t.initGoogleAnalytics(),t.initClarityAnalytics(),t.initFirebaseAnalytics(),t.initYandexAnalytics(),t.initFacebookAnalytics(),ow.putAttr(t.markName,"Step","Init Plugins"),t.initAds(),t.initMatchPlugin(),t.initRemoteConfig(),ow.putAttr(t.markName,"Step","Load Lazy Plugins"),oA.isDebugger()||t.event.on(i9.MODULE_PLUGIN_READY,t.handleProtectGameInstance),t.addMonitorPlugin().then(t.initMonitorErrorPlugin),t.addCanvasRecorderPlugin().then(t.initCanvasRecorderPlugin),t.addAdaptivePerformancePlugin().then(t.initAdaptivePerformancePlugin),ow.putAttr(t.markName,"Step","Load Dev Plugins"),t.event.catchUp(i9.GAME_SDK_READY,t.addDevPlugins),[2]})})()}},{key:"start",value:function start(){var e=this;var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return console.groupEnd(),console.groupCollapsed("\uD83E\uDDEC GameCore Start"),(function(){return _get(_get_prototype_of(Ur.prototype),"start",e)})().call(t),ow.putAttr(t.markName,"Step","Core Start"),t.event.emit(i9.CORE_STARTING),ow.putAttr(t.markName,"Step","Request Token"),[4,t.auth.requestToken()];case 1:return o.sent(),ow.putAttr(t.markName,"Step","Init States"),[4,t.initState()];case 2:if(o.sent(),ow.putAttr(t.markName,"Step","Process Player Profile"),t.processPlayerProfile(),!("FacebookInstant"===GameSDK.getSDKName()&&op.isIOS()))return[3,3];return t.event.catchUp(i9.GAME_SDK_STARTED,t.processContextSession),[3,5];case 3:return[4,t.processContextSession()];case 4:o.sent(),o.label=5;case 5:return ow.putAttr(t.markName,"Step","Core Ready"),ow.putAttr(t.markName,"Success","true"),t.event.emit(i9.CORE_READY),[2]}})})()}},{key:"addPlugins",value:function addPlugins(){this.installPlugin("Storage",s8),this.installPlugin("Event",tD),this.installPlugin("Ads",eg),this.installPlugin("Auth",eH),this.installPlugin("Audio",eB),this.installPlugin("Match",r7),this.installPlugin("Player",s_),this.installPlugin("Profile",s3),this.installPlugin("Context",e5),this.installPlugin("Language",t9),this.installPlugin("Analytics",eE),this.installPlugin("Visibility",s9),this.installPlugin("Leaderboard",nA),this.installPlugin("DailyRewards",tv),this.installPlugin("FrameCapture",t2),this.installPlugin("RemoteConfig",p),"Proxy"in window&&this.installPlugin("Firebase",p)}},{key:"installPlugin",value:function installPlugin(e,t,o){var l=arguments.length>2&&void 0!==o&&o;var u=om.toCamelCase(om.capitalize(e));this.plugins.install(e,t,!0,u),"Storage"!==e&&(l?this.emitModulePluginReady(e):this.emitCorePluginReady(e))}},{key:"addMonitorPlugin",value:function addMonitorPlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!ol.MonitorError.Enabled)return[2];return e.modulePlugins.push("MonitorError"),[4,d(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/monitor-error.js")];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=l.sent().default))return[2];return e.installPlugin("MonitorError",o,!0),[3,3];case 2:return console.error("Error importing Monitor Error plugin:",l.sent()),[3,3];case 3:return[2]}})})()}},{key:"addCanvasRecorderPlugin",value:function addCanvasRecorderPlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!ol.CanvasRecorder.Enabled)return[2];return e.modulePlugins.push("CanvasRecorder"),[4,d(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/canvas-recorder.js").then(function(e){return e.i})];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=l.sent().default))throw new Error("CanvasRecorderPlugin is not a function");return e.installPlugin("CanvasRecorder",o,!0),[3,3];case 2:return console.error("Error importing Canvas Recorder plugin:",l.sent()),[3,3];case 3:return[2]}})})()}},{key:"addAdaptivePerformancePlugin",value:function addAdaptivePerformancePlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!oc.Enabled)return[2];return e.modulePlugins.push("AdaptivePerformance"),[4,d(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/index.js")];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=l.sent().default))return[2];return e.installPlugin("AdaptivePerformance",o,!0),[3,3];case 2:return console.error("Error importing Adaptive Performance plugin:",l.sent()),[3,3];case 3:return[2]}})})()}},{key:"addConsolePlugin",value:function addConsolePlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!ol.Console.Enabled)return[2];return e.modulePlugins.push("Console"),[4,d(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/canvas-recorder.js").then(function(e){return e.e})];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=l.sent().default))throw new Error("ConsolePlugin is not a function");return e.installPlugin("Console",o,!0),e.initConsolePlugin(),[3,3];case 2:return console.error("Error importing Console plugin:",l.sent()),[3,3];case 3:return[2]}})})()}},{key:"addProfilerPlugin",value:function addProfilerPlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(l){switch(l.label){case 0:if(l.trys.push([0,2,,3]),!ol.Profiler.Enabled)return[2];return e.modulePlugins.push("Profiler"),[4,d(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/canvas-recorder.js").then(function(e){return e.e})];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=l.sent().default))throw new Error("ProfilerPlugin is not a function");return e.installPlugin("Profiler",o,!0),e.initProfilerPlugin(),[3,3];case 2:return console.error("Error importing Profiler plugin:",l.sent()),[3,3];case 3:return[2]}})})()}},{key:"emitCorePluginReady",value:function emitCorePluginReady(e){this.event.emit(y.CORE_PLUGIN_READY,{name:e})}},{key:"emitModulePluginReady",value:function emitModulePluginReady(e){this.event.emit(y.MODULE_PLUGIN_READY,{name:e})}},{key:"initEventPlugin",value:function initEventPlugin(){ol.EventLogging.Enabled&&this.event.enableLogEvent()}},{key:"initMatchPlugin",value:function initMatchPlugin(){this.match.setUseCPUProfile(!1)}},{key:"initAds",value:function initAds(){this.ads.configure(os),this.initGoogleAds(),this.initAdInstance(),os.Enabled&&this.analytics.initAdEvent({adService:"platform",state:"loaded"})}},{key:"initGoogleAds",value:function initGoogleAds(){var e=this;return _async_to_generator(function(){var t,o,l,u,d,f,y,_;return _ts_generator(this,function(p){switch(p.label){case 0:if(p.trys.push([0,2,,3]),!os.Enabled)return[2];if(o=(t=os.AdServiceConfigs.AdSense).Enabled,l=t.UsePreload,u=t.DataAdBreakTest,d=t.DataAdClient,f=t.DataAdChannel,y=t.DataAdFrequencyHint,_=t.DataAdHost,!o)return[2];return ic.setGame(e),[4,ic.initAsync({usePreload:l,dataAdHost:_,dataAdClient:d,dataAdChannel:f,dataAdBreakTest:u,dataAdFrequencyHint:y})];case 1:return p.sent(),[3,3];case 2:return console.warn("initGoogleAds",p.sent()),[3,3];case 3:return[2]}})})()}},{key:"getAdInstanceByService",value:function getAdInstanceByService(e,t){var o=arguments.length>1&&void 0!==t&&t;var l=os.AdServiceConfigs,u=l.AdSense,d=l.AppLovin;switch(e){case"adsense":if(u.Enabled)return iv;break;case"applovin":d.Enabled;break;default:return o?iA:i_}return null}},{key:"initAdInstance",value:function initAdInstance(){var e=true,t=false,o=void 0;try{for(var l,u=os.InterstitialAdOptions[Symbol.iterator]();!(e=(l=u.next()).done);e=true){var d=l.value;var f=this.getAdInstanceByService(d.AdService);f&&this.ads.setAdInstance(oy.INTERSTITIAL,d.PlacementId,f)}}catch(e){t=true,o=e}finally{try{if(!e&&null!=u.return)u.return()}finally{if(t)throw o}}var y=true,_=false,p=void 0;try{for(var v,g=os.RewardedVideoAdOptions[Symbol.iterator]();!(y=(v=g.next()).done);y=true){var m=v.value;var A=this.getAdInstanceByService(m.AdService);A&&this.ads.setAdInstance(oy.REWARDED_VIDEO,m.PlacementId,A)}}catch(e){_=true,p=e}finally{try{if(!y&&null!=g.return)g.return()}finally{if(_)throw p}}var w=true,D=false,I=void 0;try{for(var b,S=os.RewardedInterstitialAdOptions[Symbol.iterator]();!(w=(b=S.next()).done);w=true){var k=b.value;var P=this.getAdInstanceByService(k.AdService);P&&this.ads.setAdInstance(oy.REWARDED_INTERSTITIAL,k.PlacementId,P)}}catch(e){D=true,I=e}finally{try{if(!w&&null!=S.return)S.return()}finally{if(D)throw I}}var E=true,C=false,x=void 0;try{for(var T,L=os.BannerDisplayAdOptions[Symbol.iterator]();!(E=(T=L.next()).done);E=true){var N=T.value;var O=this.getAdInstanceByService(N.AdService,!0);O&&this.ads.setAdInstance(oy.BANNER,N.PlacementId,O)}}catch(e){C=true,x=e}finally{try{if(!E&&null!=L.return)L.return()}finally{if(C)throw x}}}},{key:"initState",value:function initState(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),(t=new rn(e)).initContext(),[4,t.initPlayer()];case 1:return o.sent(),[3,3];case 2:return console.error("StateInitiator",o.sent()),[3,3];case 3:return[2]}})})()}},{key:"initConsolePlugin",value:function initConsolePlugin(){this.console&&this.console.configure()}},{key:"initProfilerPlugin",value:function initProfilerPlugin(){this.profiler&&this.profiler.configure()}},{key:"initRemoteConfig",value:function initRemoteConfig(){if(!oh.Enabled)return;var e=og.clone(oh);this.remoteConfig.configure(e),this.event.on(y.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(y.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.catchUp(y.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}},{key:"initFirebasePlugin",value:function initFirebasePlugin(){if(!ou.Enabled||!this.firebase)return;var e=og.clone(ou);this.firebase.configure(e),ow.setService(this.firebase.services.performance)}},{key:"initMarkCoreInitialize",value:function initMarkCoreInitialize(){of.CoreFlows&&(ow.measure(this.markName),ow.putAttr(this.markName,"Build","".concat("24")),ow.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),ow.putAttr(this.markName,"Platform",GameSDK.getPlatform()),ow.putAttr(this.markName,"Success","false"),ow.start(this.markName))}},{key:"processPlayerProfile",value:function processPlayerProfile(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.player.syncProfileToServer()];case 1:return t.sent(),e.processAfterSyncProfile(),[3,3];case 2:return console.warn("processPlayerProfile fail",t.sent()),[3,3];case 3:return[2]}})})()}},{key:"updatePlayerProfileToNotificationService",value:function updatePlayerProfileToNotificationService(){var e=this;return _async_to_generator(function(){var t,o,l;return _ts_generator(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),o=(t=e.player.getPlayer()).ASID,l=t.playerId,[4,el({appId:oa,ASID:o,playerId:l,name:t.name,photo:t.photo,locale:t.locale})];case 1:return u.sent(),[3,3];case 2:return console.warn("updatePlayerProfileToNotificationService",u.sent()),[3,3];case 3:return[2]}})})()}},{key:"initGoogleAnalytics",value:function initGoogleAnalytics(){var e;var t=null!==(e=oo.GoogleAnalytics)&&void 0!==e?e:{},o=t.Enabled,l=t.ConsoleLog;o&&this.analytics.add(new i2(this.game,{log:!!l}))}},{key:"initClarityAnalytics",value:function initClarityAnalytics(){var e;var t=null!==(e=oo.ClarityAnalytics)&&void 0!==e?e:{},o=t.Enabled,l=t.ConsoleLog;if(!o)return;var u=new iG(this.game,{log:!!l});if(!GameSDK.extra.isGuest){var d=this.player.getPlayer().playerId;u.setUser(d)}this.analytics.add(u)}},{key:"initFirebaseAnalytics",value:function initFirebaseAnalytics(){var e,t=this;var o=null!==(e=oo.FirebaseAnalytics)&&void 0!==e?e:{},l=o.Enabled,u=o.ConsoleLog;if(!l)return;var d=new iJ(this.game,{log:!!u});this.analytics.add(d);var f="no_entry";GameSDK.getEntryPointAsync().then(function(e){f=e}).catch(function(e){console.warn(e)}).finally(function(){var e=t.player.getPlayer(),o=e.playerId,l=e.locale,u=GameSDK.getEntryPointData()||{},y=u.fbig_ad_id,_=u.fbig_adset_id,p=u.fbig_campaign_id;d.setUser(o,{locale:l,ad_id:y,adset_id:_,campaign_id:p,traffic_source:f})})}},{key:"initYandexAnalytics",value:function initYandexAnalytics(){"Yandex"===GameSDK.getSDKName()&&this.analytics.add(new i7(this.game))}},{key:"initFacebookAnalytics",value:function initFacebookAnalytics(){var e;var t=GameSDK.getSDKName(),o=null!==(e=oo.FacebookAnalytics)&&void 0!==e?e:{},l=o.Enabled,u=o.Prefix,d=o.ConsoleLog;if(!(!l||"FacebookInstant"!==t)){if("string"!=typeof u){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new iK(this.game,{prefix:u,log:!!d}))}}}]),Ur}(l.Game);c(oD,"MagicGame");var oI=o.Configs.GameEngine.ForceDesktopDPR,ob=o.Utils.Device,oS=o.Events,ok=c(/*#__PURE__*/_async_to_generator(function(){var e;return _ts_generator(this,function(t){switch(t.label){case 0:return e=new oD,window.game=e,window.__sdkLoadingCount<20&&(window.__sdkLoadingCount=20),window.__gameCoreStart=!0,[4,e.boot()];case 1:return t.sent(),e.event.catchUp(oS.REQUEST_CORE_START,oP),oE(e),[2]}})}),"initGame"),oP=c(function(){if(!window.__sdkInitiated){game.event.catchUp(oS.GAME_SDK_READY,oP);return}window.game.start(),console.warn("Game started"),window.__sdkLoadingCount<25&&(window.__sdkLoadingCount=25)},"startGame"),oE=c(function(e){var t=setInterval(function(){if(!window.__sdkInitiated)return;clearInterval(t),window.__sdkLoadingCount<10&&(window.__sdkLoadingCount=10),e.event.emit(oS.GAME_SDK_READY)},5)},"waitGameSDK");!1!==oI&&ob.isDesktop()&&"number"==typeof oI&&oI>0&&(window.devicePixelRatio=oI),window.originalRequestAnimationFrame=window.requestAnimationFrame,window.isCustomRequestAnimationFrame=!0,window.requestAnimationFrame=function(e){return window.isCustomRequestAnimationFrame?(setTimeout(e,1e3/60),0):window.originalRequestAnimationFrame(e)},ok()},"execute")}});