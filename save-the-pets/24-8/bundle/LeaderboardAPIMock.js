function asyncGeneratorStep(e,r,t,a,n,o,s){try{var c=e[o](s);var i=c.value}catch(e){t(e);return}if(c.done)r(i);else Promise.resolve(i).then(a,n)}function _async_to_generator(e){return function(){var r=this,t=arguments;return new Promise(function(a,n){var o=e.apply(r,t);function _next(e){asyncGeneratorStep(o,a,n,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(o,a,n,_next,_throw,"throw",e)}_next(void 0)})}}function _class_call_check(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var a=r[t];if(a.enumerable=a.enumerable||false,a.configurable=true,"value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function _create_class(e,r,t){if(r)_defineProperties(e.prototype,r);if(t)_defineProperties(e,t);return e}function _define_property(e,r,t){if(r in e)Object.defineProperty(e,r,{value:t,enumerable:true,configurable:true,writable:true});else e[r]=t;return e}function _object_spread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};var a=Object.keys(t);if("function"==typeof Object.getOwnPropertySymbols)a=a.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}));a.forEach(function(r){_define_property(e,r,t[r])})}return e}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);if(r)a=a.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable});t.push.apply(t,a)}return t}function _object_spread_props(e,r){if(r=null!=r?r:{},Object.getOwnPropertyDescriptors)Object.defineProperties(e,Object.getOwnPropertyDescriptors(r));else ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}function _ts_generator(e,r){var t,a,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function verb(e){return function(r){return step([e,r])}}function step(o){if(t)throw new TypeError("Generator is already executing.");while(s)try{if(t=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;if(a=0,n)o=[2&o[0],n.value];switch(o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:false};case 5:s.label++,a=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}if(n[2])s.ops.pop();s.trys.pop();continue}o=r.call(e,s)}catch(e){o=[6,e],a=0}finally{t=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}var I=Object.defineProperty;var g=function(e,r){return I(e,"name",{value:r,configurable:!0})};System.register(["./core.js","../GameCore.js","./__commonjsHelpers__.js","./canvas-recorder.js"],function(e,r){"use strict";var t,a;return{setters:[function(e){t=e.G},function(e){a=e.D},null,null],execute:g(function(){var r=t.Configs,n=t.Utils,o=r.Mockup.Leaderboards,s=o.MinScore,c=o.MaxScore,i=o.NumOfLeaders,u=o.ErrorRate,l=o.DefaultLimit,f=o.RandomDelayMs,d=n.Valid,y=n.Browser,b=n.Time,p=n.Object,v=n.Number,_="LeadersMockKey",h="LeaderboardsMockKey",w=/*#__PURE__*/function(){function m(){_class_call_check(this,m)}return _create_class(m,[{key:"getPlayers",value:function(e,r){var t=this;return _async_to_generator(function(){var a,n,o,s,c,i,u,l,f;return _ts_generator(this,function(d){switch(d.label){case 0:return[4,t.awaitRandomDelay()];case 1:if(d.sent(),t.randomResponseError("Get players error"))return[2,{data:[]}];if(a=r.playerIds,n=[],a&&a.length>0){o=t.getLeadersData(e),s=true,c=false,i=void 0;try{for(u=a[Symbol.iterator]();!(s=(l=u.next()).done);s=true)(f=o[l.value])&&n.push(f)}catch(e){c=true,i=e}finally{try{if(!s&&null!=u.return)u.return()}finally{if(c)throw i}}}return[2,{data:n}]}})})()}},{key:"getLeaders",value:function(e,r){var t=this;return _async_to_generator(function(){var a,n,o,s,c,i,u,f,d;return _ts_generator(this,function(y){switch(y.label){case 0:return[4,t.awaitRandomDelay()];case 1:if(y.sent(),t.randomResponseError("Get leaders error"))return[2,{data:[]}];for(a=r.limit,n=r.offset,o=t.getLeadersData(e),s=p.vals(o),t.sortLeadersRank(s),c=[],i=n,u=0===a?l:n+a,f=i;f<u;f++)(d=s[f])&&c.push(d);return[2,(t.sortLeadersRank(c),{data:c})]}})})()}},{key:"getLeaderboardAsync",value:function(e){var r=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,r.awaitRandomDelay()];case 1:if(t.sent(),r.randomResponseError("Get leaderboard error"))return[2,null];return[2,r.getLeaderBoard(e)||(console.warn("[LeaderboardAPIMock] Leaderboard ".concat(e," not found")),null)]}})})()}},{key:"getLeaderboardsAsync",value:function(e){var r=this;return _async_to_generator(function(){var t,a,n,o,s;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,r.awaitRandomDelay()];case 1:if(c.sent(),r.randomResponseError("Get leaderboards error"))return[2,[]];if(a=void 0===(t=e.limit)?9999:t,n=e.type,a<=0)return[2,[]];return o=r.getLeaderBoardsData(),s=p.vals(o),[2,void 0===n?s.slice(0,a):s.filter(function(e){return e.type===n}).slice(0,a)]}})})()}},{key:"getLeadersData",value:function(e){var r=this.getPlayersData(),t=Object.keys(r[e]),a={};var n=true,o=false,s=void 0;try{for(var c,i=t[Symbol.iterator]();!(n=(c=i.next()).done);n=true){var u=c.value;var l=r[e][u];d.isObject(l)&&(a[u]=l)}}catch(e){o=true,s=e}finally{try{if(!n&&null!=i.return)i.return()}finally{if(o)throw s}}return a}},{key:"sortLeadersRank",value:function(e){e.sort(function(e,r){return parseInt(r.score,10)-parseInt(e.score,10)}),e.forEach(function(e,r){e.rank=r+1})}},{key:"setScoreAsync",value:function(e,r,t){var a=this;return _async_to_generator(function(){var n,o,s,c,i;return _ts_generator(this,function(u){switch(u.label){case 0:return[4,a.awaitRandomDelay()];case 1:if(u.sent(),a.randomResponseError("Set score error"))return[2,null];if(n={success:!1},!(o=a.getLeaderBoard(e)))return[2,(console.warn("[LeaderboardAPIMock] Leaderboard ".concat(e," not found")),n)];return(c=(s=a.getPlayersData())[e][r])||(c=a.createPlayerData(r),o.amountPlayer+=1,o.numberOfLeaders+=1,a.writeLeaderBoard(e,o)),c.score=t.toString(),s[e][r]=c,i=p.vals(s[e]),[2,(a.sortLeadersRank(i),i.forEach(function(r,t){s[e][r.playerId]=r}),a.writePlayersData(e,s),n.success=!0,n)]}})})()}},{key:"createLeaderboard",value:function(e){var r=this;return _async_to_generator(function(){var t,a,n;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,r.awaitRandomDelay()];case 1:if(o.sent(),r.randomResponseError("Create leaderboard error"))return[2,null];if(t=e._id,(a=r.getLeaderBoardsData())[t])return[2,a[t]];return[2,(n=null!=(n=e.numberOfLeaders)?n:v.random(i.Max-i.Min)+i.Min,r.createPlayersData(e,n),r.createLeaderboardData(e,n))]}})})()}},{key:"createLeaderboardData",value:function(e,r){var t=e._id,n=_object_spread_props(_object_spread({},a,e),{createdAt:new Date().toISOString(),createdBy:"mock",numberOfLeaders:r,amountPlayer:r});return this.writeLeaderBoard(t,n),n}},{key:"createPlayersData",value:function(e,r){var t=e._id,a="friends-leaderboard-key"===e.name,n=_define_property({},t,{}),o=[];for(var s=0;s<r;s++){var c=a?"connected-player-".concat(s):s.toString(),i=this.createPlayerData(c);o.push(i)}return this.sortLeadersRank(o),o.forEach(function(e,r){n[t][e.playerId]=e}),this.writePlayersData(t,n),n}},{key:"createPlayerData",value:function(e){return{playerId:e,score:this.randomScore(),rank:0}}},{key:"randomScore",value:function(){return Math.floor(Math.random()*(c-s)+s).toString()}},{key:"getLeaderBoardsData",value:function(){var e=y.getLocalStorage(h);return d.isObject(e)?e:{}}},{key:"writeLeaderBoardsData",value:function(e){d.isObject(e)&&y.writeLocalStorage(h,e)}},{key:"getLeaderBoard",value:function(e){var r=this.getLeaderBoardsData();return r[e]?r[e]:null}},{key:"writeLeaderBoard",value:function(e,r){var t=this.getLeaderBoardsData();t[e]=r,this.writeLeaderBoardsData(t)}},{key:"getPlayersData",value:function(){var e=y.getLocalStorage(_);return d.isObject(e)?e:{}}},{key:"writePlayersData",value:function(e,r){var t=this.getPlayersData();t[e]||(t[e]={}),p.assign(t[e],r[e]),y.writeLocalStorage(_,t)}},{key:"randomResponseError",value:function(e){return 100*Math.random()<u&&(console.warn("[LeaderboardAPIMock]",e),!0)}},{key:"awaitRandomDelay",value:function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,b.sleepAsync(Math.random()*f)];case 1:return e.sent(),[2]}})})()}}]),m}();g(w,"LeaderboardAPIMock"),e("default",w)},"execute")}});