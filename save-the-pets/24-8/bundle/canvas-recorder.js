function _array_like_to_array(e,t){if(null==t||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function _assert_this_initialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _async_generator(e){var t,n;function send(e,r){return new Promise(function(o,i){var u={key:e,arg:r,resolve:o,reject:i,next:null};if(n)n=n.next=u;else t=n=u,resume(e,r)})}function resume(t,n){try{var r=e[t](n);var o=r.value;var i=o instanceof _await_value;Promise.resolve(i?o.wrapped:o).then(function(e){if(i){resume("next",e);return}settle(r.done?"return":"normal",e)},function(e){resume("throw",e)})}catch(e){settle("throw",e)}}function settle(e,r){switch(e){case"return":t.resolve({value:r,done:true});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:false});break}if(t=t.next)resume(t.key,t.arg);else n=null}if(this._invoke=send,"function"!=typeof e.return)this.return=void 0}if("function"==typeof Symbol&&Symbol.asyncIterator)_async_generator.prototype[Symbol.asyncIterator]=function(){return this};function _async_generator_delegate(e,t){var n={},r=false;function pump(n,o){return r=true,{done:false,value:t(o=new Promise(function(t){t(e[n](o))}))}}if("function"==typeof Symbol&&Symbol.iterator)n[Symbol.iterator]=function(){return this};if(n.next=function(e){if(r)return r=false,e;return pump("next",e)},"function"==typeof e.throw)n.throw=function(e){if(r)throw r=false,e;return pump("throw",e)};if("function"==typeof e.return)n.return=function(e){return pump("return",e)};return n}function _async_iterator(e){var t,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new AsyncFromSyncIterator(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(e){function AsyncFromSyncIteratorContinuation(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(AsyncFromSyncIterator=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return AsyncFromSyncIteratorContinuation(this.n.apply(this.s,arguments))},return:function(e){var t=this.s.return;return void 0===t?Promise.resolve({value:e,done:!0}):AsyncFromSyncIteratorContinuation(t.apply(this.s,arguments))},throw:function(e){var t=this.s.return;return void 0===t?Promise.reject(e):AsyncFromSyncIteratorContinuation(t.apply(this.s,arguments))}},new AsyncFromSyncIterator(e)}function asyncGeneratorStep(e,t,n,r,o,i,u){try{var s=e[i](u);var c=s.value}catch(e){n(e);return}if(s.done)t(c);else Promise.resolve(c).then(r,o)}function _async_to_generator(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function _next(e){asyncGeneratorStep(i,r,o,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,r,o,_next,_throw,"throw",e)}_next(void 0)})}}function _await_async_generator(e){return new _await_value(e)}function _await_value(e){this.wrapped=e}function _call_super(e,t,n){return t=_get_prototype_of(t),_possible_constructor_return(e,_is_native_reflect_construct()?Reflect.construct(t,n||[],_get_prototype_of(e).constructor):t.apply(e,n))}function _class_call_check(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r.enumerable=r.enumerable||false,r.configurable=true,"value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function _create_class(e,t,n){if(t)_defineProperties(e.prototype,t);if(n)_defineProperties(e,n);return e}function _define_property(e,t,n){if(t in e)Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true});else e[t]=n;return e}function _get_prototype_of(e){return(_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");if(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}}),t)_set_prototype_of(e,t)}function _instanceof(e,t){if(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance])return!!t[Symbol.hasInstance](e);return e instanceof t}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==o)return;var i=[];var u=true;var s=false;try{for(o=o.call(e);!(u=(n=o.next()).done)&&(i.push(n.value),!t||i.length!==t);u=true);}catch(e){s=true,r=e}finally{try{if(!u&&null!=o.return)o.return()}finally{if(s)throw r}}return i}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};var r=Object.keys(n);if("function"==typeof Object.getOwnPropertySymbols)r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}));r.forEach(function(t){_define_property(e,t,n[t])})}return e}function _possible_constructor_return(e,t){if(t&&("object"===_type_of(t)||"function"==typeof t))return t;return _assert_this_initialized(e)}function _set_prototype_of(e,t){return(_set_prototype_of=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,t){if(!e)return;if("string"==typeof e)return _array_like_to_array(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor)n=e.constructor.name;if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(e,t)}function _wrap_async_generator(e){return function(){return new _async_generator(e.apply(this,arguments))}}function _is_native_reflect_construct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_is_native_reflect_construct=function(){return!!e})()}function _ts_generator(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");while(u)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;if(r=0,o)i=[2&i[0],o.value];switch(i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:false};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}if(o[2])u.ops.pop();u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:true}}}function _ts_values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}_async_generator.prototype.next=function(e){return this._invoke("next",e)},_async_generator.prototype.throw=function(e){return this._invoke("throw",e)},_async_generator.prototype.return=function(e){return this._invoke("return",e)};var M=Object.defineProperty;var a=function(e,t){return M(e,"name",{value:t,configurable:!0})};var f=function(e,t,n){return function(e,t,n){return t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,(void 0===t?"undefined":_type_of(t))!="symbol"?t+"":t,n)};System.register(["./core.js"],function(e,t){"use strict";var n,r;return{setters:[function(e){n=e.P,r=e.G}],execute:a(function(){var t=e("d",{});e("e",Object.freeze(Object.defineProperty({__proto__:null,default:t},Symbol.toStringTag,{value:"Module"}))),"stream"in Blob.prototype||Object.defineProperty(Blob.prototype,"stream",{value:function(){return new Response(this).body}}),"setBigUint64"in DataView.prototype||Object.defineProperty(DataView.prototype,"setBigUint64",{value:function(e,t,n){var r=Number(4294967295n&t),o=Number(t>>32n);this.setUint32(e+(n?0:4),r,n),this.setUint32(e+(n?4:0),o,n)}});var o=a(function(e){return new DataView(new ArrayBuffer(e))},"e"),i=a(function(e){return new Uint8Array(e.buffer||e)},"n"),u=a(function(e){return new TextEncoder().encode(String(e))},"t"),s=a(function(e){return Math.min(0xffffffff,Number(e))},"i"),c=a(function(e){return Math.min(65535,Number(e))},"r");function N(e,t){if(void 0===t||_instanceof(t,Date)||(t=new Date(t)),_instanceof(e,File))return{isFile:1,t:t||new Date(e.lastModified),i:e.stream()};if(_instanceof(e,Response))return{isFile:1,t:t||new Date(e.headers.get("Last-Modified")||Date.now()),i:e.body};if(void 0===t)t=new Date;else if(isNaN(t))throw new Error("Invalid modification date.");if(void 0===e)return{isFile:0,t:t};if("string"==typeof e)return{isFile:1,t:t,i:u(e)};if(_instanceof(e,Blob))return{isFile:1,t:t,i:e.stream()};if(_instanceof(e,Uint8Array)||_instanceof(e,ReadableStream))return{isFile:1,t:t,i:e};if(_instanceof(e,ArrayBuffer)||ArrayBuffer.isView(e))return{isFile:1,t:t,i:i(e)};if(Symbol.asyncIterator in e)return{isFile:1,t:t,i:L(e[Symbol.asyncIterator]())};throw new TypeError("Unsupported input format.")}function L(e,t){var n=arguments.length>1&&void 0!==t?t:e;return new ReadableStream({pull:function(t){return _async_to_generator(function(){var n,r,o;return _ts_generator(this,function(i){switch(i.label){case 0:n=0,i.label=1;case 1:if(!(t.desiredSize>n))return[3,4];return[4,e.next()];case 2:if(!(r=i.sent()).value)return t.close(),[3,4];o=j(r.value),t.enqueue(o),n+=o.byteLength,i.label=3;case 3:return[3,1];case 4:return[2]}})})()},cancel:function(e){var t;null==(t=n.throw)||t.call(n,e)}})}function j(e){return"string"==typeof e?u(e):_instanceof(e,Uint8Array)?e:i(e)}function A(e,t,n){var r=_sliced_to_array(function(e){return e?_instanceof(e,Uint8Array)?[e,1]:ArrayBuffer.isView(e)||_instanceof(e,ArrayBuffer)?[i(e),1]:[u(e),0]:[void 0,0]}(t),2),o=r[0],s=r[1];if(_instanceof(e,File))return{o:B(o||u(e.name)),u:BigInt(e.size),l:s};if(_instanceof(e,Response)){var c=e.headers.get("content-disposition"),l=c&&c.match(/;\s*filename\*?=["']?(.*?)["']?$/i),y=l&&l[1]||e.url&&new URL(e.url).pathname.split("/").findLast(Boolean),p=y&&decodeURIComponent(y),h=n||+e.headers.get("content-length");return{o:B(o||u(p)),u:BigInt(h),l:s}}return o=B(o,void 0!==e||void 0!==n),"string"==typeof e?{o:o,u:BigInt(u(e).length),l:s}:_instanceof(e,Blob)?{o:o,u:BigInt(e.size),l:s}:_instanceof(e,ArrayBuffer)||ArrayBuffer.isView(e)?{o:o,u:BigInt(e.byteLength),l:s}:{o:o,u:$(e,n),l:s}}function $(e,t){return t>-1?BigInt(t):e?void 0:0n}function B(e,t){var n=arguments.length>1&&void 0!==t?t:1;if(!e||e.every(function(e){return 47===e}))throw new Error("The file must have a name.");if(n)for(;47===e[e.length-1];)e=e.subarray(0,-1);else 47!==e[e.length-1]&&(e=new Uint8Array(_to_consumable_array(e).concat([47])));return e}a(N,"f"),a(L,"o"),a(j,"a"),a(A,"s"),a($,"u"),a(B,"d");var l=new Uint32Array(256);for(var y=0;y<256;++y){var p=y;for(var h=0;h<8;++h)p=p>>>1^(1&p&&0xedb88320);l[y]=p}function x(e,t){var n=arguments.length>1&&void 0!==t?t:0;n^=-1;for(var r=0,o=e.length;r<o;r++)n=n>>>8^l[255&n^e[r]];return(-1^n)>>>0}function E(e,t,n){var r=arguments.length>2&&void 0!==n?n:0;var o=e.getSeconds()>>1|e.getMinutes()<<5|e.getHours()<<11,i=e.getDate()|e.getMonth()+1<<5|e.getFullYear()-1980<<9;t.setUint16(r,o,1),t.setUint16(r+2,i,1)}function k(e,t){var n=e.o;return 8*(!e.l||(null!=t?t:function(e){try{v.decode(e)}catch(e){return 0}return 1}(n)))}a(x,"y"),a(E,"w"),a(k,"B$1");var v=new TextDecoder("utf8",{fatal:1});function V(e,t){var n=arguments.length>1&&void 0!==t?t:0;var r=o(30);return r.setUint32(0,0x504b0304),r.setUint32(4,0x2d000800|n),E(e.t,r,10),r.setUint16(26,e.o.length,1),i(r)}function _(){return __.apply(this,arguments)}function __(){return(__=_wrap_async_generator(function(e){var t,n,r,o;return _ts_generator(this,function(i){switch(i.label){case 0:if(!("then"in(t=e.i)))return[3,2];return[4,_await_async_generator(t)];case 1:t=i.sent(),i.label=2;case 2:if(!_instanceof(t,Uint8Array))return[3,4];return[4,t];case 3:return i.sent(),e.m=x(t,0),e.u=BigInt(t.length),[3,9];case 4:e.u=0n,n=t.getReader(),i.label=5;case 5:return[4,_await_async_generator(n.read())];case 6:if(o=(r=i.sent()).value,r.done)return[3,9];return e.m=x(o,e.m),e.u+=BigInt(o.length),[4,o];case 7:i.sent(),i.label=8;case 8:return[3,5];case 9:return[2]}})})).apply(this,arguments)}function H(e,t){var n=o(16+(t?8:0));return n.setUint32(0,0x504b0708),n.setUint32(4,e.isFile?e.m:0,1),t?(n.setBigUint64(8,e.u,1),n.setBigUint64(16,e.u,1)):(n.setUint32(8,s(e.u),1),n.setUint32(12,s(e.u),1)),i(n)}function G(e,t,n,r){var u=arguments.length>2&&void 0!==n?n:0,c=arguments.length>3&&void 0!==r?r:0;var l=o(46);return l.setUint32(0,0x504b0102),l.setUint32(4,0x2d032d00),l.setUint16(8,2048|u),E(e.t,l,12),l.setUint32(16,e.isFile?e.m:0,1),l.setUint32(20,s(e.u),1),l.setUint32(24,s(e.u),1),l.setUint16(28,e.o.length,1),l.setUint16(30,c,1),l.setUint16(40,e.isFile?33204:16893,1),l.setUint32(42,s(t),1),i(l)}function Y(e,t,n){var r=o(n);return r.setUint16(0,1,1),r.setUint16(2,n-4,1),16&n&&(r.setBigUint64(4,e.u,1),r.setBigUint64(12,e.u,1)),r.setBigUint64(n-8,t,1),i(r)}function P(e){return _instanceof(e,File)||_instanceof(e,Response)?[[e],[e]]:[[e.input,e.name,e.size],[e.input,e.lastModified]]}a(V,"p"),a(_,"g"),a(H,"I$1"),a(G,"v"),a(Y,"h"),a(P,"D");var d=a(function(e){return function(e){var t=BigInt(22),n=0n,r=0;var o=true,i=false,u=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=true){var l=s.value;if(!l.o)throw new Error("Every file must have a non-empty name.");if(void 0===l.u)throw new Error('Missing size for file "'.concat(new TextDecoder().decode(l.o),'".'));var y=l.u>=4294967295n,p=n>=4294967295n;n+=BigInt(46+l.o.length+(y&&8))+l.u,t+=BigInt(l.o.length+46+(12*p|28*y)),r||(r=y)}}catch(e){i=true,u=e}finally{try{if(!o&&null!=c.return)c.return()}finally{if(i)throw u}}return(r||n>=4294967295n)&&(t+=BigInt(76)),t+n}(function(e){var t,n,r,o,i,u,s;return _ts_generator(this,function(c){switch(c.label){case 0:t=true,n=false,r=void 0,c.label=1;case 1:c.trys.push([1,6,7,8]),o=e[Symbol.iterator](),c.label=2;case 2:if(!!(t=(i=o.next()).done))return[3,5];return u=i.value,[4,A.apply(void 0,_to_consumable_array(P(u)[0]))];case 3:c.sent(),c.label=4;case 4:return t=true,[3,2];case 5:return[3,8];case 6:return s=c.sent(),n=true,r=s,[3,8];case 7:try{if(!t&&null!=o.return)o.return()}finally{if(n)throw r}return[7];case 8:return[2]}})}(e))},"S");function Z(e,t){var n=arguments.length>1&&void 0!==t?t:{};var r={"Content-Type":"application/zip","Content-Disposition":"attachment"};return("bigint"==_type_of(n.length)||Number.isInteger(n.length))&&n.length>0&&(r["Content-Length"]=String(n.length)),n.metadata&&(r["Content-Length"]=String(d(n.metadata))),new Response(J(e,n),{headers:r})}function J(e,t){var n=arguments.length>1&&void 0!==t?t:{};var r=function(e){var t;var n=e[Symbol.iterator in e?Symbol.iterator:Symbol.asyncIterator]();return _define_property({next:function(){return _async_to_generator(function(){var e,t,r,o;return _ts_generator(this,function(i){switch(i.label){case 0:return[4,n.next()];case 1:if((e=i.sent()).done)return[2,e];return r=(t=_sliced_to_array(P(e.value),2))[0],o=t[1],[2,{done:0,value:Object.assign(N.apply(void 0,_to_consumable_array(o)),A.apply(void 0,_to_consumable_array(r)))}]}})})()},throw:null==(t=n.throw)?void 0:t.bind(n)},Symbol.asyncIterator,function(){return this})}(e);return L((function(){var e=_wrap_async_generator(function(e,t){var n,r,u,l,y,p,h,v,d,g,b,m,w,C,U,I,F,O,T,R,D,q,z,K;return _ts_generator(this,function(Q){switch(Q.label){case 0:n=[],r=0n,u=0n,l=0,y=false,p=false,Q.label=1;case 1:Q.trys.push([1,11,12,17]),v=_async_iterator(e),Q.label=2;case 2:return[4,_await_async_generator(v.next())];case 3:if(!(y=!(d=Q.sent()).done))return[3,10];return b=k(g=d.value,t.buffersAreUTF8),[4,V(g,b)];case 4:return Q.sent(),[4,new Uint8Array(g.o)];case 5:if(Q.sent(),!g.isFile)return[3,7];return[5,_ts_values(_async_generator_delegate(_async_iterator(_(g)),_await_async_generator))];case 6:Q.sent(),Q.label=7;case 7:return m=g.u>=4294967295n,w=12*(r>=4294967295n)|28*m,[4,H(g,m)];case 8:Q.sent(),n.push(G(g,r,b,w)),n.push(g.o),w&&n.push(Y(g,r,w)),m&&(r+=8n),u++,r+=BigInt(46+g.o.length)+g.u,l||(l=m),Q.label=9;case 9:return y=false,[3,2];case 10:return[3,17];case 11:return C=Q.sent(),p=true,h=C,[3,17];case 12:if(Q.trys.push([12,,15,16]),!(y&&null!=v.return))return[3,14];return[4,_await_async_generator(v.return())];case 13:Q.sent(),Q.label=14;case 14:return[3,16];case 15:if(p)throw h;return[7];case 16:return[7];case 17:U=0n,I=true,F=false,O=void 0,Q.label=18;case 18:Q.trys.push([18,23,24,25]),T=n[Symbol.iterator](),Q.label=19;case 19:if(!!(I=(R=T.next()).done))return[3,22];return[4,D=R.value];case 20:Q.sent(),U+=BigInt(D.length),Q.label=21;case 21:return I=true,[3,19];case 22:return[3,25];case 23:return q=Q.sent(),F=true,O=q,[3,25];case 24:try{if(!I&&null!=T.return)T.return()}finally{if(F)throw O}return[7];case 25:if(!(l||r>=4294967295n))return[3,27];return(z=o(76)).setUint32(0,0x504b0606),z.setBigUint64(4,BigInt(44),1),z.setUint32(12,0x2d032d00),z.setBigUint64(24,u,1),z.setBigUint64(32,u,1),z.setBigUint64(40,U,1),z.setBigUint64(48,r,1),z.setUint32(56,0x504b0607),z.setBigUint64(64,r+U,1),z.setUint32(72,1,1),[4,i(z)];case 26:Q.sent(),Q.label=27;case 27:return(K=o(22)).setUint32(0,0x504b0506),K.setUint16(8,c(u),1),K.setUint16(10,c(u),1),K.setUint32(12,s(U),1),K.setUint32(16,s(r),1),[4,i(K)];case 28:return Q.sent(),[2]}})});return function(t,n){return e.apply(this,arguments)}})()(r,n),r)}a(Z,"A"),a(J,"N");var g={recordFps:30,syncFps:!1,type:"png",quality:.92},b=r.Utils,m=b.Time,w=b.Image,C=b.Browser,U=/*#__PURE__*/function(e){function S(){var e;return _class_call_check(this,S),e=_call_super(this,S,arguments),f(e,"options"),f(e,"panelControl",null),f(e,"canvas",null),f(e,"capturing"),f(e,"requestCount",0),f(e,"requestFinishCount",0),f(e,"lastCaptureTime",0),f(e,"realStartTime",0),f(e,"countVideoTime",0),f(e,"imageList"),f(e,"processCapture",a(/*#__PURE__*/_async_to_generator(function(){var t,n,r;return _ts_generator(this,function(o){switch(o.label){case 0:if(!e.isCapturing())return[2];return t=performance.now(),[4,e.waitNextFrame(!0)];case 1:if(o.sent(),!e.isCapturing())return[2];return[4,e.handleCapture()];case 2:if(o.sent(),e.lastCaptureTime=performance.now(),n=t-e.lastCaptureTime,!!e.options.syncFps)return[3,5];if(!((r=1e3/e.options.recordFps)>n))return[3,4];return[4,m.sleepAsync(r-n)];case 3:o.sent(),o.label=4;case 4:o.label=5;case 5:return e.countVideoTime+=n,e.updateRecordInfo(),e.processCapture(),[2]}})}),"processCapture")),f(e,"handleCapture",a(/*#__PURE__*/_async_to_generator(function(){var t;return _ts_generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,4]),e.requestCount++,[4,e.snapshotCanvas()];case 1:if(!(t=n.sent()))throw new Error("Image data is null");return e.addImageDataToList(e.requestCount,t),e.requestFinishCount++,[3,4];case 2:return console.error("handleCapture",n.sent()),[4,e.stopCaptureAsync()];case 3:return n.sent(),[3,4];case 4:return[2]}})}),"handleCapture")),f(e,"addImageDataToList",a(function(t,n){var r=e.getPaddingName(t);e.imageList.push({name:"".concat(r,".").concat(e.options.type),input:n})},"addImageDataToList")),e}return _inherits(S,e),_create_class(S,[{key:"init",value:function(){this.imageList=[],this.options=_object_spread({},g)}},{key:"configure",value:function(e){this.options=_object_spread({},this.options,e),"function"==typeof t&&(this.panelControl=new t(this,this.options))}},{key:"setCanvas",value:function(e){this.canvas=e}},{key:"getCanvas",value:function(){return this.canvas}},{key:"runTestCanvas",value:function(){if(!t)return;var e=this.createCanvas(200,300);e&&(e.style.position="absolute",document.body.appendChild(e),t(e),this.setCanvas(e))}},{key:"setPanelExpanded",value:function(e){var t;null==(t=this.panelControl)||t.setPanelExpanded(e)}},{key:"getOptions",value:function(){return this.options}},{key:"isCapturing",value:function(){return this.capturing}},{key:"initCaptureState",value:function(){this.imageList=[],this.capturing=!1,this.requestCount=0,this.requestFinishCount=0,this.countVideoTime=0,this.realStartTime=performance.now()}},{key:"setStateInputPanel",value:function(e){this.panelControl&&(e?this.panelControl.unblockInputPanel():this.panelControl.blockInputPanel())}},{key:"startCaptureAsync",value:function(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){if(!e.isCapturing()){if(!e.canvas)return console.warn("Canvas is not set"),[2];e.initCaptureState(),e.setStateInputPanel(!1),e.capturing=!0,e.processCapture()}return[2]})})()}},{key:"waitNextFrame",value:function(e){var t=this;var n=arguments.length>0&&void 0!==e&&e;return new Promise(function(e,r){n||t.isCapturing()||r(new Error("CanvasRecorder is not capturing")),requestAnimationFrame(function(){e()})})}},{key:"updateRecordInfo",value:function(){if(!this.panelControl)return;var e=this.formatDateHMS(this.countVideoTime),t=this.formatDateHMS(performance.now()-this.realStartTime);this.panelControl.updateRecordInfo(e,t)}},{key:"snapshotCanvas",value:function(e){var t=this;return new Promise(function(n,r){if(!t.canvas){r(new Error("Canvas is not set"));return}var o=t.options,i=o.type,u=o.quality,s=e||{},c=s.type,l=void 0===c?i:c,y=s.quality,p=s.resolution,h=void 0===p?1:p;t.canvas.toBlob(function(e){if(!e){r(new Error("Blob is null"));return}1!==h?t.resizeBlob(e,l,h).then(n).catch(r):n(e)},"image/".concat(l),void 0===y?u:y)})}},{key:"resizeBlob",value:function(e,t,n){return _async_to_generator(function(){var r,o,i;return _ts_generator(this,function(u){switch(u.label){case 0:return[4,w.blobToHtmlImage(e,!0,!1)];case 1:if(!(r=u.sent()))throw new Error("Can not convert blob to image");return o=n/window.devicePixelRatio,r.width*=o,r.height*=o,[4,w.elementToBlob(r,t)];case 2:if(i=u.sent(),URL.revokeObjectURL(r.src),!i)throw new Error("Can not convert image to blob");return[2,i]}})})()}},{key:"stopCaptureAsync",value:function(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return[2,(e.capturing=!1,new Promise(function(t){var n=setInterval(function(){e.requestCount===e.requestFinishCount&&(clearInterval(n),e.setStateInputPanel(!0),t())},500)}))]})})()}},{key:"snapshotFrameAsync",value:function(e){var t=this;return _async_to_generator(function(){var n,r,o;return _ts_generator(this,function(i){switch(i.label){case 0:if(i.trys.push([0,3,,4]),!t.canvas)return[2,(console.warn("Canvas is not set"),null)];return r=void 0!==(n=(e||{}).force)&&n,[4,t.waitNextFrame(r)];case 1:return i.sent(),[4,t.snapshotCanvas(e)];case 2:if(!(o=i.sent()))throw new Error("Image data is null");return[2,o];case 3:return[2,(console.error("snapshotFrame",i.sent()),null)];case 4:return[2]}})})()}},{key:"downloadImage",value:function(e){var t=document.createElement("a"),n="screenshot-".concat(this.getDateFilename());t.download=n,t.href=URL.createObjectURL(e);var r="image/".concat(this.options.type);t.dataset.downloadurl=[r,t.download,t.href].join(":"),t.click(),URL.revokeObjectURL(t.href),t.remove()}},{key:"downloadImagesAsync",value:function(){var e=this;return _async_to_generator(function(){var t,n,r;return _ts_generator(this,function(o){switch(o.label){case 0:if(o.trys.push([0,2,,3]),e.isCapturing())return[2];return e.setStateInputPanel(!1),t=document.createElement("a"),n="images-".concat(e.getDateFilename()),t.download=n,[4,Z(e.imageList).blob()];case 1:return r=o.sent(),t.href=URL.createObjectURL(r),t.click(),URL.revokeObjectURL(t.href),t.remove(),[3,3];case 2:return console.error("downloadZipImages",o.sent()),[3,3];case 3:return[2]}})})()}},{key:"getRecordImages",value:function(){return this.imageList.map(function(e){return e.input})}},{key:"createCanvas",value:function(e,t){var n=C.createCanvas({type:"canvas"});return n?(n.canvas.width=e,n.canvas.height=t,n.canvas):(console.warn("Can not create canvas"),null)}},{key:"getPaddingName",value:function(e){var t=e.toString().length;var n="";for(var r=0;r<5-t;r++)n+="0";return n+e.toString()}},{key:"getDateFilename",value:function(){var e=new Date;return"".concat(e.toLocaleTimeString(),"-").concat(e.toLocaleDateString())}},{key:"formatDateHMS",value:function(e,t){var n=arguments.length>1&&void 0!==t&&t;var r=new Date(e).toISOString();return n?r.slice(11,-5):r.slice(14,-5)}}]),S}(n.Plugins.BasePlugin);a(U,"CanvasRecorderPlugin"),e("i",Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"})))},"execute")}});