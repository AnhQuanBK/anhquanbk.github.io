function _instanceof(r,u){if(null!=u&&"undefined"!=typeof Symbol&&u[Symbol.hasInstance])return!!u[Symbol.hasInstance](r);return r instanceof u}function _type_of(r){return r&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r}function _ts_generator(r,u){var f,y,m,S,_={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return S={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(S[Symbol.iterator]=function(){return this}),S;function verb(r){return function(u){return step([r,u])}}function step(S){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(m=2&S[0]?y.return:S[0]?y.throw||((m=y.return)&&m.call(y),0):y.next)&&!(m=m.call(y,S[1])).done)return m;if(y=0,m)S=[2&S[0],m.value];switch(S[0]){case 0:case 1:m=S;break;case 4:return _.label++,{value:S[1],done:false};case 5:_.label++,y=S[1],S=[0];continue;case 7:S=_.ops.pop(),_.trys.pop();continue;default:if(!(m=(m=_.trys).length>0&&m[m.length-1])&&(6===S[0]||2===S[0])){_=0;continue}if(3===S[0]&&(!m||S[1]>m[0]&&S[1]<m[3])){_.label=S[1];break}if(6===S[0]&&_.label<m[1]){_.label=m[1],m=S;break}if(m&&_.label<m[2]){_.label=m[2],_.ops.push(S);break}if(m[2])_.ops.pop();_.trys.pop();continue}S=u.call(r,_)}catch(r){S=[6,r],y=0}finally{f=m=0}if(5&S[0])throw S[1];return{value:S[0]?S[1]:void 0,done:true}}}System.register("chunks:///systems.js",["./rollupPluginModLoBabelHelpers-60801af6.js","cc","./GeneralUtils-58d1f2c9.js"],function(r,u){var f,y,m,S,_,w,b,A,D,C,k,R,T,L,F,M,I,x,P,N,O,U,z,G,B,V,H,q,j,Q,W,Y,K,Z,J,X,$,ee,et,en,er,ei,ea,es,eo,eu,ec,el,eh,ed,ef,ep,ev,eg,ey,em;return{setters:[function(r){f=r.f,y=r.c,m=r.g,S=r._,_=r.d,w=r.h,b=r.i,A=r.j,D=r.k,C=r.l,k=r.a,R=r.b},function(r){T=r.cclegacy,L=r.game,F=r.settings,M=r.Settings,I=r.View,x=r.AssetManager,P=r.director,N=r.input,O=r.Input,U=r.sys,z=r.macro,G=r.DynamicAtlasManager,B=r.screen,V=r.math,H=r.Director,q=r.ResolutionPolicy,j=r.Texture2D,Q=r.assetManager,W=r.Layers,Y=r.ImageAsset,K=r.instantiate,Z=r.Game,J=r.gfx,X=r._decorator,$=r.rendering,ee=r.Component},function(r){et=r.G,en=r.A,er=r.a,ei=r.C,ea=r.P,es=r.b,eo=r.E,r.B,eu=r.c,ec=r.R,el=r.L,eh=r.d,ed=r.e,ef=r.S,ep=r.f,ev=r.g,eg=r.h,ey=r.i,em=r.j}],execute:function(){T._RF.push({},"0b067Iz+iFJLJjNpsfblY7S","AdsManager",void 0);var r=GameCore,u=r.Events,eS=r.Configs.Ads,eE=eS.Enabled,e_=eS.PreloadAds,ew=eS.ShowAdOnLoad,eb=eS.BannerDisplayAdOptions,eA=r.Utils.Time,eD=globalThis.game.event,eC=function(){function e(){var r=this;y(this,e),this.currentLayout="",this.processShowBannerAds=function(){en.showBannerAds()},this.processPreloadAds=m(function(){return _ts_generator(this,function(r){switch(r.label){case 0:if(!e_)return[3,2];return[4,eA.sleepAsync(3e3)];case 1:r.sent(),en.preloadAds(),r.label=2;case 2:return[2]}})}),this.processShowFirstInterstitialAd=m(function(){var r,u;return _ts_generator(this,function(f){switch(f.label){case 0:if(f.trys.push([0,3,,4]),!eE)return[2];if(r=ew.Enabled,u=ew.DelaySeconds,!r)return[2];if(!(u>0))return[3,2];return[4,eA.sleepAsync(1e3*u)];case 1:f.sent(),f.label=2;case 2:return en.showInterstitialAdAsync({forceLoad:!0,contextType:"preroll"}),[3,4];case 3:return console.warn("processShowFirstInterstitialAd failed",f.sent()),[3,4];case 4:return[2]}})}),this.handleLayoutChanged=function(u){r.currentLayout!==u&&(r.currentLayout=u,u!==er.Layout.Landscape?eb.forEach(function(r){var u=r.PlacementId,f=r.Position;"bottom"===f||"top"===f?en.showBannerAd(u):en.hideBannerAd(u)}):r.processShowBannerAds())}}return f(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){L.on(et.LAYOUT_CHANGED,this.handleLayoutChanged),eD.catchUp(u.GAME_READY,this.processPreloadAds),eD.catchUp(u.GAME_READY,this.processShowBannerAds),eD.catchUp(u.GAME_SDK_STARTED,this.processShowFirstInterstitialAd)}}]),e}();T._RF.pop(),T._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var ek,eR,eT,eL=GameCore.Events,eF=globalThis.game.event,eM=function(){function e(){y(this,e)}return f(e,[{key:"init",value:function(){console.info("Core Manager: Initialized")}},{key:"requestStart",value:function(){eF.emit(eL.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(r){eF.catchUp(eL.CORE_BOOTING,r)}},{key:"onCoreStart",value:function(r){eF.catchUp(eL.CORE_STARTING,r)}},{key:"onCoreReady",value:function(r){eF.catchUp(eL.CORE_READY,r)}}]),e}();T._RF.pop(),T._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var eI=GameCore,ex=eI.Events,eP=eI.Configs.GameEngine,eN=eP.DynamicAtlas,eO=eP.PreferredFPS,eU=eI.Utils,ez=eU.Valid,eG=eU.Device,eB=eU.Decorator,eV=globalThis.game.event,eH=(ek=eB.debounce(600),eT=S((eR=function(){var r;function e(){var r=this;y(this,e),this.handlePauseEngine=m(function(){return _ts_generator(this,function(r){return console.info("Engine: Paused",L.isPaused()),L.isPaused(),[2]})}),this.handleResumeEngine=m(function(){return _ts_generator(this,function(u){return r.restoreRequestAnimationFrame(),console.info("Engine: Resumed",L.isPaused()),L.isPaused(),[2]})}),this.handleResizeView=function(u){var f=u.width,y=u.height;r.resizeView(f,y)},_(this,"handleViewResized",eT,this)}return f(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){L.on(et.VIEW_RESIZE,this.handleResizeView),L.on(et.VIEW_RESIZED,this.handleViewResized)}},{key:"overrideSettings",value:function(){F.overrideSettings(M.Category.ENGINE,"debug",ez.isDebugger()),I.instance.resizeWithBrowserSize(!1),eG.isDesktop()?L.frameRate=eO.Desktop:L.frameRate=eO.Mobile}},{key:"setupAutoAtlas",value:function(){x.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var r=x.instance.downloader;r.maxConcurrency=30,r.maxRequestsPerFrame=30}},{key:"getPipelineFlows",value:function(){var r,u;return null!==(r=null===(u=P.root)||void 0===u||null===(u=u.pipeline)||void 0===u?void 0:u.flows)&&void 0!==r?r:[]}},{key:"getRenderQueues",value:function(r){var u=this.getPipelineFlows()[0];return null!=u&&u.stages?u.stages[r].renderQueues:[]}},{key:"setupOptimalPipelines",value:(r=m(function(){return _ts_generator(this,function(r){return x.instance.transformPipeline.remove(1),[2]})}),function(){return r.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var r=this;N.on(O.EventType.TOUCH_START,this.handleResumeEngine),eV.catchUp(ex.GAME_READY,function(){eV.on(ex.VISIBILITY_HIDDEN,r.handlePauseEngine),eV.on(ex.VISIBILITY_VISIBLE,r.handleResumeEngine),r.restoreRequestAnimationFrame()})}},{key:"restoreRequestAnimationFrame",value:function(){window.isCustomRequestAnimationFrame=!1}},{key:"setupDynamicAtlas",value:function(){switch(U.os){case U.OS.IOS:this.setupDynamicAtlasForIOS();break;case U.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(r){var u=r.Enabled,f=r.AutoAtlasSize,y=r.MaxAtlasCount,m=r.MaxAtlasSize,S=r.MaxFrameSize;if(z.CLEANUP_IMAGE_CACHE=!u,G.instance.enabled=u,G.instance.textureSize=m,G.instance.maxFrameSize=S,G.instance.maxAtlasCount=y,G.instance.textureBleeding=eN.TextureBleeding,f){var _=this.getMaxTextureSize();if(!_)return;G.instance.textureSize=_}}},{key:"getMaxTextureSize",value:function(){if(!P.root)return -1;var r=P.root.device.capabilities.maxTextureSize;if(r>8192)return 7168;var u=G.instance.maxFrameSize,f=r-1024;return f<=(void 0===u?0:u)||f<=0?-1:f}},{key:"setupDynamicAtlasForIOS",value:function(){var r=eN.IOS;this.setDynamicAtlas(r)}},{key:"setupDynamicAtlasForAndroid",value:function(){var r=eN.Android;this.setDynamicAtlas(r)}},{key:"setupDynamicAtlasForDesktop",value:function(){var r=eN.Desktop;this.setDynamicAtlas(r)}},{key:"setupBatcherLimit",value:function(){z.BATCHER2D_MEM_INCREMENT=288,z.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(r,u){var f,y=window.devicePixelRatio,m=y>=2?2/y:1,S=Math.round(r*y*m),_=Math.round(u*y*m);if(!(S<1||_<1)){null===(f=P.root)||void 0===f||f.resize(S,_);var w=I.instance.getDesignResolutionSize();w.width>0&&w.height>0&&(B.windowSize=new V.Size(S,_)),P.once(H.EVENT_AFTER_UPDATE,function(){L.emit(et.VIEW_RESIZED,{width:S,height:_})})}}}]),e}()).prototype,"handleViewResized",[ek],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(r){console.info("✨ New View Size",{width:r.width,height:r.height})}}}),eR);T._RF.pop();var eq,ej=new(function(){function e(){y(this,e),this._registry={},this._moduleCache={}}return f(e,[{key:"define",value:function(r,u,f){this._registry[r]={factory:u,resolveMap:f}}},{key:"require",value:function(r){return this._require(r)}},{key:"throwInvalidWrapper",value:function(r,u){throw new Error("Module '".concat(r,"' imported from '").concat(u,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(r,u){var f=this._moduleCache[r];if(f)return f.exports;var y={id:r,exports:{}};return this._moduleCache[r]=y,this._tryModuleLoad(y,r),y.exports}},{key:"_resolve",value:function(r,u){return this._resolveFromInfos(r,u)||this._throwUnresolved(r,u)}},{key:"_resolveFromInfos",value:function(r,u){var f,y;return r in cjsInfos?r:u&&null!==(f=null===(y=cjsInfos[u])||void 0===y?void 0:y.resolveCache[r])&&void 0!==f?f:void 0}},{key:"_tryModuleLoad",value:function(r,u){var f=!0;try{this._load(r,u),f=!1}finally{f&&delete this._moduleCache[u]}}},{key:"_load",value:function(r,u){var f=this._loadWrapper(u),y=f.factory,m=f.resolveMap,S=this._createRequire(r),_=m?this._createRequireWithResolveMap("function"==typeof m?m():m,S):S;y(r.exports,_,r)}},{key:"_loadWrapper",value:function(r){return r in this._registry?this._registry[r]:this._loadHostProvidedModules(r)}},{key:"_loadHostProvidedModules",value:function(r){return{factory:function(u,f,y){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(r,"'."));try{y.exports=require(r)}catch(u){throw new Error("Exception thrown when calling host defined require('".concat(r,"')."),{cause:u})}}}}},{key:"_createRequire",value:function(r){var u=this;return function(f){return u._require(f,r)}}},{key:"_createRequireWithResolveMap",value:function(r,u){return function(f){var y=r[f];if(y)return u(y);throw new Error("Unresolved specifier "+f)}}},{key:"_throwUnresolved",value:function(r,u){throw new Error("Unable to resolve ".concat(r," from ").concat(parent,"."))}}]),e}());function Fe(r){return(Fe="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function(r){return void 0===r?"undefined":_type_of(r)}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":void 0===r?"undefined":_type_of(r)})(r)}var eQ,eW,eY,eK,eZ,eJ,eX,e$="file:///Users/anhquan/Desktop/Repository/save-the-pets/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";ej.define(e$,function(r,u,f,y,m){(function(u,y){"object"===Fe(r)&&void 0!==f?f.exports=y():"function"==typeof define&&define.amd?define(y):u.ResizeObserver=y()})(this,function(){var r=function(){if("undefined"!=typeof Map)return Map;function e(r,u){var f=-1;return r.some(function(r,y){return r[0]===u&&(f=y,!0)}),f}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(r){var u=e(this.__entries__,r),f=this.__entries__[u];return f&&f[1]},t.prototype.set=function(r,u){var f=e(this.__entries__,r);~f?this.__entries__[f][1]=u:this.__entries__.push([r,u])},t.prototype.delete=function(r){var u=this.__entries__,f=e(u,r);~f&&u.splice(f,1)},t.prototype.has=function(r){return!!~e(this.__entries__,r)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(r,u){void 0===u&&(u=null);for(var f=0,y=this.__entries__;f<y.length;f++){var m=y[f];r.call(u,m[1],m[0])}},t}()}(),u="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,f="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),y="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(f):function(r){return setTimeout(function(){return r(Date.now())},1e3/60)};var m=["top","right","bottom","left","width","height","size","weight"],S="undefined"!=typeof MutationObserver,_=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(r,u){var f=!1,m=!1,S=0;function o(){f&&(f=!1,r()),m&&c()}function s(){y(o)}function c(){var r=Date.now();if(f){if(r-S<2)return;m=!0}else f=!0,m=!1,setTimeout(s,20);S=r}return c}(this.refresh.bind(this),0)}return e.prototype.addObserver=function(r){~this.observers_.indexOf(r)||this.observers_.push(r),this.connected_||this.connect_()},e.prototype.removeObserver=function(r){var u=this.observers_,f=u.indexOf(r);~f&&u.splice(f,1),!u.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var r=this.observers_.filter(function(r){return r.gatherActive(),r.hasActive()});return r.forEach(function(r){return r.broadcastActive()}),r.length>0},e.prototype.connect_=function(){u&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),S?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){u&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(r){var u=r.propertyName,f=void 0===u?"":u;m.some(function(r){return!!~f.indexOf(r)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(r,u){for(var f=0,y=Object.keys(u);f<y.length;f++){var m=y[f];Object.defineProperty(r,m,{value:u[m],enumerable:!1,writable:!1,configurable:!0})}return r},c=function(r){return r&&r.ownerDocument&&r.ownerDocument.defaultView||f},w=v(0,0,0,0);function l(r){return parseFloat(r)||0}function d(r){for(var u=[],f=1;f<arguments.length;f++)u[f-1]=arguments[f];return u.reduce(function(u,f){return u+l(r["border-"+f+"-width"])},0)}function h(r){var u=r.clientWidth,f=r.clientHeight;if(!u&&!f)return w;var y=c(r).getComputedStyle(r),m=function(r){for(var u={},f=0,y=["top","right","bottom","left"];f<y.length;f++){var m=y[f],S=r["padding-"+m];u[m]=l(S)}return u}(y),S=m.left+m.right,_=m.top+m.bottom,b=l(y.width),A=l(y.height);if("border-box"===y.boxSizing&&(Math.round(b+S)!==u&&(b-=d(y,"left","right")+S),Math.round(A+_)!==f&&(A-=d(y,"top","bottom")+_)),!function(r){return r===c(r).document.documentElement}(r)){var D=Math.round(b+S)-u,C=Math.round(A+_)-f;1!==Math.abs(D)&&(b-=D),1!==Math.abs(C)&&(A-=C)}return v(m.left,m.top,b,A)}var b="undefined"!=typeof SVGGraphicsElement?function(r){return _instanceof(r,c(r).SVGGraphicsElement)}:function(r){return _instanceof(r,c(r).SVGElement)&&"function"==typeof r.getBBox};function p(r){return u?b(r)?function(r){var u=r.getBBox();return v(0,0,u.width,u.height)}(r):h(r):w}function v(r,u,f,y){return{x:r,y:u,width:f,height:y}}var A=function(){function e(r){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=r}return e.prototype.isActive=function(){var r=p(this.target);return this.contentRect_=r,r.width!==this.broadcastWidth||r.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var r=this.contentRect_;return this.broadcastWidth=r.width,this.broadcastHeight=r.height,r},e}(),g=function(r,u){var f,y,m,S,_,w,b=(f=u.x,y=u.y,m=u.width,S=u.height,_="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,s(w=Object.create(_.prototype),{x:f,y:y,width:m,height:S,top:y,right:f+m,bottom:S+y,left:f}),w);s(this,{target:r,contentRect:b})},D=function(){function t(u,f,y){if(this.activeObservations_=[],this.observations_=new r,"function"!=typeof u)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=u,this.controller_=f,this.callbackCtx_=y}return t.prototype.observe=function(r){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(r,c(r).Element))throw new TypeError('parameter 1 is not of type "Element".');var u=this.observations_;u.has(r)||(u.set(r,new A(r)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(r){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(r,c(r).Element))throw new TypeError('parameter 1 is not of type "Element".');var u=this.observations_;u.has(r)&&(u.delete(r),u.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var r=this;this.clearActive(),this.observations_.forEach(function(u){u.isActive()&&r.activeObservations_.push(u)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var r=this.callbackCtx_,u=this.activeObservations_.map(function(r){return new g(r.target,r.broadcastRect())});this.callback_.call(r,u,r),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),C="undefined"!=typeof WeakMap?new WeakMap:new r,E=function e(r){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var u=new D(r,_.getInstance(),this);C.set(this,u)};return["observe","unobserve","disconnect"].forEach(function(r){E.prototype[r]=function(){var u;return(u=C.get(this))[r].apply(u,arguments)}}),void 0!==f.ResizeObserver?f.ResizeObserver:E}),eq=f.exports},{}),ej.require(e$),T._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var e0=er.Layout,e1=er.DesignSize,e2=e1.Portrait,e3=e1.Landscape,e4=GameCore,e5=e4.Utils.Decorator,e6=e4.Configs.GameEngine,e8=e6.AutoResizeCanvas,e7=e6.AutoChangeOrientation,e9=(eQ=e5.debounce(200),eW=e5.debounce(200),eY=e5.debounce(200),eZ=S((eK=function(){function e(){y(this,e),_(this,"handleViewResizeBySystem",eZ,this),_(this,"handleViewResize",eJ,this),_(this,"handleBodyResize",eX,this)}return f(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){e8&&(B.on("window-resize",this.handleViewResize,this),B.on("orientation-change",this.handleViewResize,this)),L.on(et.REQUEST_VIEW_RESIZE,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){e8&&new eq(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){e7&&(I.instance.resizeWithBrowserSize(!0),I.instance.setOrientation(z.ORIENTATION_AUTO),this.resolutionPolicy=I.instance.getResolutionPolicy(),this.resolutionPolicy.setContentStrategy(q.ContentStrategy.EXACT_FIT),this.resolutionPolicy.setContainerStrategy(q.ContainerStrategy.EQUAL_TO_FRAME))}},{key:"setupOrientationByScreenSize",value:function(){e7&&(this.getScreenRatio()<=e2.WIDTH/e2.HEIGHT?this.setPortraitView():this.setLandscapeView())}},{key:"resizeGameDiv",value:function(r){var u=arguments.length>0&&void 0!==r&&r,f=document.getElementById("GameDiv");if(!f)return!1;var y=ei.getScreenWidthCss(),m=ei.getScreenHeightCss(),S=f.getBoundingClientRect(),_=S.width,w=S.height;return!(y===_&&m===w&&!u)&&(f.style.width="".concat(y,"px"),f.style.height="".concat(m,"px"),!0)}},{key:"resizeGameView",value:function(){if(globalThis.game.ads.isAdFullSizeShowing())console.error("⚠️ LayoutManager:resizeGameView skipped because ad is showing");else{var r=ei.getScreenWidthCss(),u=ei.getScreenHeightCss();L.emit(et.VIEW_RESIZE,{width:r,height:u})}}},{key:"setPortraitView",value:function(){var r=e2.WIDTH,u=e2.HEIGHT;this.currentLayout!==e0.Portrait&&(this.currentLayout=e0.Portrait,this.changeDesignResolutionSize(r,u))}},{key:"setLandscapeView",value:function(){var r=e3.WIDTH,u=e3.HEIGHT;this.currentLayout!==e0.Landscape&&(this.currentLayout=e0.Landscape,this.changeDesignResolutionSize(r,u))}},{key:"changeDesignResolutionSize",value:function(r,u){this.currentLayout===e0.Portrait?this.resolutionPolicy.setContentStrategy(q.ContentStrategy.FIXED_WIDTH):this.resolutionPolicy.setContentStrategy(q.ContentStrategy.FIXED_HEIGHT);var f=this.currentLayout===e0.Portrait,y=this.currentLayout===e0.Landscape;f&&!er.FULL_PORTRAIT_SIZE?this.resolutionPolicy.setContentStrategy(q.ContentStrategy.SHOW_ALL):y&&!er.FULL_LANDSCAPE_SIZE&&this.resolutionPolicy.setContentStrategy(q.ContentStrategy.EXACT_FIT),I.instance.setDesignResolutionSize(r,u,this.resolutionPolicy),L.emit(et.LAYOUT_CHANGED,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout,this.resolutionPolicy)}},{key:"getScreenRatio",value:function(){return ei.getScreenWidthCss()/ei.getScreenHeightCss()}}]),e}()).prototype,"handleViewResizeBySystem",[eQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(u){globalThis.game.ads.isAdFullSizeShowing()?console.error("⚠️ LayoutManager:handleViewResizeBySystem skipped because ad is showing"):(console.debug("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=u||window.devicePixelRatio,r.setupOrientationByScreenSize(),r.resizeGameView())}}}),eJ=S(eK.prototype,"handleViewResize",[eW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(){globalThis.game.ads.isAdFullSizeShowing()?console.error("⚠️ LayoutManager:handleViewResize skipped because ad is showing"):(console.debug("\uD83D\uDCF1 View resize by window"),r.setupOrientationByScreenSize(),r.resizeGameView())}}}),eX=S(eK.prototype,"handleBodyResize",[eY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(){r.resizeGameDiv()&&(console.debug("\uD83D\uDCF1 View resize by body"),r.setupOrientationByScreenSize(),r.resizeGameView())}}}),eK);T._RF.pop(),T._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var te=GameCore,tt=te.Utils.Valid,tn=te.Dtos.Player,tr=globalThis.game.player,ti=function(){function e(){y(this,e)}return f(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){tn.Data.addDefaultData(ea),tn.GameData.addDefaultData(es),tn.GameData.addValidateFunction("bestEndlessScore",function(r){if(!tt.isNumber(r)||r<0)throw new Error("bestEndlessScore ".concat(r," is invalid"))}),tn.GameData.addValidateFunction("firstLoginTime",function(r){if(!tt.isNumber(r)||r<0)throw new Error("firstLoginTime ".concat(r," is invalid"))})}},{key:"requestConnectedPlayers",value:function(){tr.requestConnectedPlayers().catch(function(r){console.warn("player.requestConnectedPlayers",r)})}}]),e}();T._RF.pop(),T._RF.push({},"c510204p3JAXLCuogskxTkP","AdaptivePerformance",void 0);var ta=GameCore,ts=ta.Events,to=ta.Utils.Valid,tu=globalThis.game,tc=tu.event,tl=tu.adaptivePerformance,th=function(){function e(){var r=this;y(this,e),this.handleBeginFrame=function(){P.on(H.EVENT_AFTER_UPDATE,r.lateUpdate),P.on(H.EVENT_BEFORE_UPDATE,r.updateActualFPS)},this.handleAfterSceneLaunch=function(r){tl&&tl.trackingScene(r.name)},this.handleRequestResizeGame=function(r){var u=r.forcePixelRatio;to.isNumber(u)&&L.emit(et.REQUEST_VIEW_RESIZE,u)},this.lateUpdate=function(){var r=1e3*L.deltaTime;null==tl||tl.updatePostStepDeltaTime(r)},this.updateActualFPS=function(){var r,u=null===(r=P.root)||void 0===r?void 0:r.fps;to.isNumber(u)&&(null==tl||tl.updateActualFPS(u))}}return f(e,[{key:"init",value:function(){tl&&this.listenEvents()}},{key:"listenEvents",value:function(){tc.on(ts.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),P.once(H.EVENT_BEGIN_FRAME,this.handleBeginFrame),P.on(H.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();T._RF.pop(),T._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var td,tf,tp,tv=globalThis.game.canvasRecorder,tg=function(){function e(){y(this,e)}return f(e,[{key:"init",value:function(){if(L.canvas&&tv){tv.setCanvas(L.canvas);var r=tv.getOptions(),t=function(){L.pause(),L.step()},u=tv.waitNextFrame;tv.waitNextFrame=function(f){var y=arguments.length>0&&void 0!==f&&f;return new Promise(function(f,m){y||tv.isCapturing()?r.syncFps?(P.once(H.EVENT_AFTER_RENDER,f),t()):u(y).then(f).catch(m):L.resume()})}}}}]),e}();T._RF.pop(),T._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var ty,tm,tS=GameCore,tE=tS.Configs.GameEngine.DynamicAssets,t_=tE.Enabled,tw=tE.Resolution,tb=tE.IgnoreFiles,tA=tS.Events,tD=tS.Utils,tC=tD.Array,tk=tD.Function,tR=tD.Time,tT=tD.Decorator,tL=globalThis.game,tF=tL.event,tM=tL.storage,tI=tL.getBuildVersion,tx=[".png",".jpg",".jpeg",".webp"],tP=(td=tT.debounce(1e3),tp=S((tf=function(){var r,u,S,b;function e(){var r=this;y(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradedAssets={},this.upgradableAssets={},_(this,"handleChangeQuality",tp,this),this.replaceAssetUrl=function(u){return r.useHighQuality?u.replace("native/","native32/"):u},this.requestUpdateDynamicAssets=function(){L.emit(et.UPGRADE_DYNAMIC_ATLAS,{force:!0})},this.collectUpgradableAssets=function(u){var f,y=u.output=u.input,m=tw.Adjust,S=tw.Original,_=m<S?m:S,b=!1,A=w(y);try{for(A.s();!(f=A.n()).done;){var D=f.value;if(tC.has(tx,D.ext)&&!tC.has(tb,D.uuid)&&(D.url=r.replaceAssetUrl(D.url),!(D.uuid in r.upgradableAssets))){var C={ext:D.ext,url:D.url,uuid:D.uuid,options:D.options,resolution:_};console.debug("DynamicAssets: Collect upgradable asset",D,C),r.upgradableAssets[D.uuid]=C,b=!0}}}catch(r){A.e(r)}finally{A.f()}b&&L.emit(et.REQUEST_UPGRADE_ASSET)}}return f(e,[{key:"init",value:(b=m(function(){return _ts_generator(this,function(r){switch(r.label){case 0:if(console.info("DynamicAssets: init",{EDITOR:eo,Enabled:t_}),!t_)return[3,2];return[4,this.initStorage()];case 1:r.sent(),this.checkCacheVersion(),Q.transformPipeline.insert(this.collectUpgradableAssets,2),this.useHighQuality||this.injectTextureResolution(),this.listenEvents(),r.label=2;case 2:return[2]}})}),function(){return b.apply(this,arguments)})},{key:"initStorage",value:(S=m(function(){return _ts_generator(this,function(r){switch(r.label){case 0:return[4,tM.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0)];case 1:return r.sent(),[2]}})}),function(){return S.apply(this,arguments)})},{key:"checkCacheVersion",value:function(){var r=tI().toString(),u=tM.getStorage("DynamicAssets"),f=null!=u?u:{},y=f.buildVersion,m=f.useHighQuality;"boolean"==typeof m&&(this.useHighQuality=m&&y===r),tM.setStorageData("DynamicAssets","buildVersion",r),tM.updateToWebStorage("DynamicAssets")}},{key:"listenEvents",value:function(){var r=this;this.useHighQuality||tF.catchUp(tA.GAME_READY,function(){r.useHighQuality=!0,L.on(et.REQUEST_UPGRADE_ASSET,r.handleChangeQuality)})}},{key:"injectTextureResolution",value:function(){var r=tw.Adjust,u=tw.Original;if(!(r>=u||u<=0)){var f=r/u;Object.defineProperty(j.prototype,"width",{get:function(){var r,u;return this.isValid?this.uuid?(null===(r=this.image.data)||void 0===r||null===(r=r.src)||void 0===r?void 0:r.indexOf("native32/"))>=0?this._width:(console.debug("DynamicAssets: Texture2D image",this),(null===(u=this.image)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.width)/f||this._width):this._width/f:this._width}}),Object.defineProperty(j.prototype,"height",{get:function(){var r,u;return this.isValid?this.uuid?(null===(r=this.image.data)||void 0===r||null===(r=r.src)||void 0===r?void 0:r.indexOf("native32/"))>=0?this._height:(null===(u=this.image)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.height)/f||this._height:this._height/f:this._height}})}}},{key:"saveStateToStorage",value:function(){tM.setStorageData("DynamicAssets","useHighQuality",this.useHighQuality),tM.updateToWebStorage("DynamicAssets")}},{key:"updateSpriteFrames",value:(u=m(function(){var r,u,f,y,m,S,_,b,A;return _ts_generator(this,function(D){switch(D.label){case 0:if(!(r=P.getScene()))return[3,9];f=r.getComponentsInChildren("cc.Sprite"),y=w(f),D.label=1;case 1:D.trys.push([1,7,8,9]),y.s(),D.label=2;case 2:if(!!(u=y.n()).done)return[3,6];if(!(null!=(_=(S=u.value).spriteFrame)&&_.texture))return[3,5];if(b=_.texture,!this.upgradedAssets[null===(m=b.image)||void 0===m?void 0:m.uuid])return[3,4];return console.debug("DynamicAssets: Update sprite frame",b),S.node.layer=W.Enum.UI_2D,b.updateImage(),[4,tR.sleepAsync(8)];case 3:D.sent(),D.label=4;case 4:D.label=5;case 5:return[3,2];case 6:return[3,9];case 7:return A=D.sent(),y.e(A),[3,9];case 8:return y.f(),[7];case 9:return[2]}})}),function(){return u.apply(this,arguments)})},{key:"processUpgradeQualityAsync",value:(r=m(function(r){var u,f;return _ts_generator(this,function(y){return u=this,[2,_instanceof(f=Q.assets.get(r.uuid),Y)?(r.url=this.replaceAssetUrl(r.url),console.debug("DynamicAssets: Process upgrade quality",r.uuid,r),new Promise(function(y){Q.loadAny(r,r.options,function(m,S){if(m)return console.warn("DynamicAssets: Upgrade error",m),void y(!1);f.reset(S),f._nativeUrl=u.replaceAssetUrl(f.nativeUrl),u.upgradedAssets[r.uuid]=!0,console.debug("DynamicAssets: Upgrade done",r.uuid,S,f),L.emit(et.ASSET_QUALITY_CHANGE,{asset:f,item:r}),y(!0)})})):(console.warn("DynamicAssets: Asset not found",r.uuid,f),this.upgradedAssets[r.uuid]=!1,!1)]})}),function(u){return r.apply(this,arguments)})}]),e}()).prototype,"handleChangeQuality",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return m(function(){var u,f,y,m;return _ts_generator(this,function(S){switch(S.label){case 0:if(!!r.isProcessing)return[3,6];S.label=1;case 1:for(var _ in S.trys.push([1,4,5,6]),r.isProcessing=!0,u=[],r.upgradableAssets)if((f=r.upgradableAssets[_])&&!r.upgradedAssets[_])y=r.processUpgradeQualityAsync(f),u.push(y);if(u.length<1)return[2];return[4,tk.allSettled(u)];case 2:return console.debug("DynamicAssets: Upgradable Assets Info",{total:(m=S.sent()).filter(function(r){return"fulfilled"===r.status}).length,results:m}),r.saveStateToStorage(),[4,r.updateSpriteFrames()];case 3:return S.sent(),r.requestUpdateDynamicAssets(),[3,6];case 4:return console.warn("DynamicAssets: Handle change quality error",S.sent()),[3,6];case 5:return r.isProcessing=!1,[7];case 6:return[2]}})})}}),tf);T._RF.pop(),T._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var tN,tO,tU,tz=GameCore,tG=tz.Events,tB=tz.Configs.GameEngine.DynamicAtlas,tV=tB.UsePowerOfTwo,tH=tB.TextureAtlasOptimize,tq=tB.AllowNonePackable,tj=tB.OnlyOptimizeWhenRenderTooLong,tQ=tz.Utils,tW=tQ.Array,tY=tQ.Json,tK=tQ.Object,tZ=tQ.Decorator,tJ=globalThis.game.event,tX=(ty=tZ.debounce(2e3),S((tm=function(){function e(){var r=this;y(this,e),this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.pendingTextures={},this.setupRenderListeners=function(){P.on(H.EVENT_BEFORE_RENDER,r.updateBeforeRenderTime),P.on(H.EVENT_AFTER_RENDER,r.updateAfterRenderTime),tj&&tJ.catchUp(tG.SCENE_LAUNCHED,function(){P.once(H.EVENT_AFTER_RENDER,r.checkRenderTimeHighers)})},this.checkRenderTimeHighers=function(){var u=r.getMeanRenderTime();u>8&&r.handleLaggyFrame(u),P.once(H.EVENT_AFTER_RENDER,function(){setTimeout(r.checkRenderTimeHighers,r.renderTimeInterval)})},this.resetPendingInfo=function(){r.pendingSprites={},r.pendingTextures={}},this.updateBeforeRenderTime=function(){r.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){r.renderTimes.push(performance.now()-r.lastRenderTime)},this.tryInsertSpriteFrame=function(u){var f=r.getAtlas();if(!f)throw new Error("DynamicAtlas: Atlas not found");if(tW.has(f._innerSpriteFrames,u))throw new Error("DynamicAtlas: Sprite frame already exists");var y=f.insertSpriteFrame(u);if(!1===y)throw new Error("DynamicAtlas: Failed to insert sprite frame");return y},this.requestUpdateDynamicAtlas=function(u){r.isProcessing||(r.forceUpdateDynamicAtlas||(r.forceUpdateDynamicAtlas=(null==u?void 0:u.force)||!1),r.updateDynamicAtlas())},this.generateDrawInfo=function(u){if(!(u.length<1)){var f=u.sort(function(r,u){return u.usageCount-r.usageCount}),y=G.instance.textureSize;if(r.calculateOptimizedAtlas(f,y),r.atlasInfo){var m,S=r.atlasInfo.textures,_=w(S);try{for(_.s();!(m=_.n()).done;){var b=m.value;r.drawInfo.push(b)}}catch(r){_.e(r)}finally{_.f()}var A=f.filter(function(r){return!S.some(function(u){return u.id===r.id})});A.length>0&&(console.warn("DynamicAtlas: Missing textures",A),r.generateDrawInfo(A))}else console.warn("DynamicAtlas: Atlas info not found",{textures:f})}},this.calculateOptimizedAtlas=function(u,f){var y=function(r){var u,f=0,y=0,m=w(r);try{for(m.s();!(u=m.n()).done;){var S=u.value;f+=S.w*S.h,y=Math.max(y,S.w)}}catch(r){m.e(r)}finally{m.f()}r.sort(function(r,u){return u.h-r.h});var _,b=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(f/.95)),y),h:1/0}],A=0,D=0,C=w(r);try{for(C.s();!(_=C.n()).done;)for(var k=_.value,R=b.length-1;R>=0;R--){var T=b[R];if(!(k.w>T.w||k.h>T.h)){if(k.x=T.x,k.y=T.y,D=Math.max(D,k.y+k.h),A=Math.max(A,k.x+k.w),k.w===T.w&&k.h===T.h){var L=b.pop();R<b.length&&(b[R]=L)}else k.h===T.h?(T.x+=k.w,T.w-=k.w):k.w===T.w?(T.y+=k.h,T.h-=k.h):(b.push({x:T.x+k.w,y:T.y,w:T.w-k.w,h:k.h}),T.y+=k.h,T.h-=k.h);break}}}catch(r){C.e(r)}finally{C.f()}return{w:A,h:D,fill:f/(A*D)||0}}(u),m=y.w,S=y.h,_=y.fill;if(_<.6)console.warn("DynamicAtlas: Fill rate is too low",_,b(u));else{if(m>f||S>f)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",m,S,f),void(u.pop()?r.calculateOptimizedAtlas(u,f):console.warn("DynamicAtlas: Texture size is too big",m,S,f));r.atlasInfo={textures:u,atlasSize:f,packedInfo:{width:Math.round(m),height:Math.round(S),fillRate:_}}}},this.drawTexture=function(u,f,y){var m,S,_=f.texture,w=_.image,b=_.getId(),A=tW.search(r.drawInfo,function(r){return r.id===b})||{x:-1,y:-1},D=A.x,C=A.y;if(D<0||C<0)return r.pendingSprites[f.uuid]||(r.pendingSprites[f.uuid]=f),r.pendingTextures[b]||(r.pendingTextures[b]=_,tj||r.requestUpdateDynamicAtlas()),!1;var k=y?2:0;D+=k,C+=k;var R=u._innerTextureInfos[b];R||(y&&((w.width<=8||w.height<=8)&&(u._texture.drawTextureAt(w,D-1,C-1),u._texture.drawTextureAt(w,D-1,C+1),u._texture.drawTextureAt(w,D+1,C-1),u._texture.drawTextureAt(w,D+1,C+1)),u._texture.drawTextureAt(w,D-1,C),u._texture.drawTextureAt(w,D+1,C),u._texture.drawTextureAt(w,D,C-1),u._texture.drawTextureAt(w,D,C+1)),u._texture.drawTextureAt(w,D,C),u._count++,u._innerTextureInfos[b]={texture:_,x:D,y:C});var T=f.rect,L=T.x,F=T.y;L+=null!==(m=null==R?void 0:R.x)&&void 0!==m?m:D,F+=null!==(S=null==R?void 0:R.y)&&void 0!==S?S:C;var M={texture:u._texture,x:L,y:F};return D-=k,C-=k,u._innerSpriteFrames.push(f),M},this.refreshComponents=function(r){var u,f=w(r);try{for(f.s();!(u=f.n()).done;){var y=u.value;y.node.active&&(y.node.active=!1,y.node.active=!0)}}catch(r){f.e(r)}finally{f.f()}},this.isSameAtlas=function(r,u){if(!r||!u)return!1;var f=r.textures,y=u.textures;if(f.length!==y.length)return!1;var m=f.slice().sort(function(r,u){return r.id.localeCompare(u.id)}),S=y.slice().sort(function(r,u){return r.id.localeCompare(u.id)});return m.every(function(r,u){var f=S[u];if(!f)return!1;var y=r.id,m=r.name,_=r.w,w=r.h,b=f.id,A=f.name,D=f.w,C=f.h;return!m||y===b&&m===A&&_===D&&w===C})}}return f(e,[{key:"init",value:function(){tH&&G.instance.enabled&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:tH}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){L.on(et.UPGRADE_DYNAMIC_ATLAS,this.requestUpdateDynamicAtlas,this),tJ.on(tG.SWITCH_SCENE,this.resetPendingInfo),tJ.on(tG.SCENE_RENDERED,this.requestUpdateDynamicAtlas),tJ.catchUp(tG.GAME_READY,this.setupRenderListeners)}},{key:"handleLaggyFrame",value:function(r){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(r.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var r,u=0,f=w(this.renderTimes);try{for(f.s();!(r=f.n()).done;)u+=r.value}catch(r){f.e(r)}finally{f.f()}return u/=this.renderTimes.length,this.renderTimes=[],u}},{key:"overrideDynamicAtlas",value:function(){var r=this,u=G.instance;u.insertSpriteFrame=function(f){if(!u.enabled)return null;var y=u.maxAtlasCount,m=(u._atlases,u._atlasIndex),S=void 0===m?-1:m;if(S>=y)return null;try{var _=r.tryInsertSpriteFrame(f);return _||S>=y?_:_=r.tryInsertSpriteFrame(f)}catch(r){return null}}}},{key:"createAtlas",value:function(){return G.instance.newAtlas()}},{key:"getAtlas",value:function(){var r=this,u=G.instance,f=u._atlases,y=u._atlasIndex,m=u.textureBleeding,S=(void 0===f?[]:f)[y];return S||(S=this.createAtlas()),S?(S.originalInsertSpriteFrame||(S.originalInsertSpriteFrame=S.insertSpriteFrame,S.insertSpriteFrame=function(u){return r.drawTexture(S,u,m)}),S):null}},{key:"updateDynamicAtlas",value:function(){try{var r=P.getScene();if(!r)return;var u=this.collectPackageInfo();if(Object.keys(u).length<1)return;if(this.drawInfo=[],this.atlasInfo=null,this.isProcessing=!0,this.generateDrawInfo(tK.vals(u)),!this.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!this.updateAtlasData()&&!this.forceUpdateDynamicAtlas)return;var f=r.getComponentsInChildren("cc.UIRenderer");this.refreshComponents(f)}catch(r){console.error("DynamicAtlas: Error updating dynamic atlas",r)}finally{this.isProcessing=!1,this.forceUpdateDynamicAtlas&&(this.forceUpdateDynamicAtlas=!1)}}},{key:"collectAllSpriteFrames",value:function(){var r=P.getScene();if(r){var u,f=r.getComponentsInChildren("cc.UIRenderer"),y=w(f);try{for(y.s();!(u=y.n()).done;){var m=u.value,S=m.spriteFrame;if(m.__classname__,m.enabled&&S&&S.packable&&S.texture){var _=S.uuid;_&&(this.pendingSprites[_]||(m.node.layer=W.Enum.UI_2D,this.pendingSprites[_]=S))}}}catch(r){y.e(r)}finally{y.f()}}}},{key:"collectPackageInfo",value:function(){tq&&this.collectAllSpriteFrames();var r,u=tK.vals(this.pendingSprites),f={},y=w(u);try{for(y.s();!(r=y.n()).done;){var m,S=r.value,_=S.texture,b=S.original,A=null==_?void 0:_.getId(),D=null==b||null===(m=b._texture)||void 0===m?void 0:m.getId();if(D&&(A=D),A){this.collectInfo[A]||this.initializeCollectInfo(A,S);var C=this.collectInfo[A];C&&(C.usageCount++,f[A]=C)}}}catch(r){y.e(r)}finally{y.f()}return f}},{key:"initializeCollectInfo",value:function(r,u){var f=u.texture,y=u.original,m=u.uuid,S=f.width,_=f.height,w=(null==y?void 0:y._texture)||{width:0,height:0},b=w.width,A=w.height,D=Math.max(S,b)+2,C=Math.max(_,A)+2;D<=1||C<=1?console.warn("DynamicAtlas: Skip invalid texture size",m,{w:D,h:C}):this.collectInfo[r]={id:r,w:D,h:C,x:-1,y:-1,usageCount:0,name:m}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var r=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!r,r)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.debug("DynamicAtlas: atlas info",this.atlasInfo);var u=this.getAtlas();if(!u||!u._texture)return!1;var f=this.atlasInfo.packedInfo,y=u._texture,m={width:y.width,height:y.height},S=f.width+20,_=f.height+20,w=Math.max(S,_),b=tV?w:S,A=m.width!==b||m.height!==b;return console.debug("DynamicAtlas: Update atlas data",{currentSize:m,newSize:b,needsResize:A}),!!A&&(G.instance.reset(),!(!(u=this.getAtlas())||!u._texture)&&(console.debug("DynamicAtlas: Update atlas data",{newSize:b,currentSize:m}),tV?(u._texture.initWithSize(b,b),console.debug("DynamicAtlas: Resize atlas (PO2)",b,u)):(u._texture.initWithSize(S,_),console.debug("DynamicAtlas: Resize atlas",S,_,u)),this.lastAtlasInfo=tY.clone(this.atlasInfo),!0))}}]),e}()).prototype,"updateDynamicAtlas",[ty],Object.getOwnPropertyDescriptor(tm.prototype,"updateDynamicAtlas"),tm.prototype),tm);T._RF.pop(),T._RF.push({},"2f36c+IsKJAU5s61TqQdaJ6","HybridFileCache",void 0);var t$=GameCore,t0=t$.Events,t1=t$.Configs.GameEngine.HybridFileCache,t2=t1.Enabled,t3=t1.PreviewMode,t4=t1.BuildMode,t5=t$.Utils,t6=t5.Object,t8=t5.Function,t7=t5.Json,t9=t5.Decorator,ne=globalThis.game,nt=ne.event,nn=ne.storage,nr=ne.getBuildVersion,ni=T.internal.CCON,na=x.instance,ns=na.downloader,no=na.pipeline,nu=na.fetchPipeline,nc=(tN=t9.throttle(1e3),tU=S((tO=function(){var r,u,S,C,k;function e(){var r=this;y(this,e),this.supportTypes=[],this.bundledFiles={},this.originDownloaders={},this.nativeAssetDictionary={},this.downloadFile=function(u){return function(f,y,m){var S=r.getCache(u,f);if(S)return m(null,S);var _=r.getDownloader(u);if(!_)return m(new Error("Downloader not found"),null);_(f,y,function(y,S){return y||r.setCache(u,f,S),m(y,S)})}},_(this,"requestUpdateStorage",tU,this),this.clearCache=function(){nn.initStorageData("HybridFileCache","cachedFiles",{}),nn.initStorageData("HybridFileCache","cachedBundles",{}),nn.updateToWebStorage("HybridFileCache")}}return f(e,[{key:"init",value:(k=m(function(){return _ts_generator(this,function(r){switch(r.label){case 0:if(!(t2&&!eo))return[3,3];return[4,this.initStorage()];case 1:return r.sent(),[4,this.checkCacheVersion()];case 2:return r.sent(),this.initSupportedTypes(),this.injectOptimalLoadPipeline(),this.injectOptimalFetchPipeline(),this.injectCacheExtensionPipeline(),this.saveOriginDownloaders(),this.registerCustomDownloader(),this.setupBundledFiles(),this.listenEvents(),console.info("Hybrid File Cache: Initialized",{supportTypes:this.supportTypes}),[3,4];case 3:nt.emit(t0.BUNDLE_READY),r.label=4;case 4:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"initStorage",value:(C=m(function(){return _ts_generator(this,function(r){return[2,nn.addStorage("HybridFileCache",{buildVersion:"0",cachedFiles:{},cachedBundles:{},cachedExtensions:{}},!0)]})}),function(){return C.apply(this,arguments)})},{key:"checkCacheVersion",value:(S=m(function(){var r,u;return _ts_generator(this,function(f){switch(f.label){case 0:if(r=nr().toString(),u=nn.getStorageData("HybridFileCache","buildVersion"),nn.setStorageData("HybridFileCache","buildVersion",r),!(u!==r))return[3,2];return[4,this.clearCache()];case 1:f.sent(),f.label=2;case 2:return this.requestUpdateStorage(),[2]}})}),function(){return S.apply(this,arguments)})},{key:"initSupportedTypes",value:function(){this.supportTypes=t4.SupportedExtensions}},{key:"setupBundledFiles",value:(u=m(function(){var r,u,f,y;return _ts_generator(this,function(m){switch(m.label){case 0:if(m.trys.push([0,,3,4]),!t4.Enabled)return[2];u=[],f=w(this.supportTypes);try{for(f.s();!(r=f.n()).done;)y=r.value,this.getCachedBundles(y)||u.push(this.downloadBundledFile(y))}catch(r){f.e(r)}finally{f.f()}if(!(u.length>0))return[3,2];return[4,t8.allSettled(u)];case 1:m.sent(),m.label=2;case 2:return[3,4];case 3:return nt.emit(t0.BUNDLE_READY),[7];case 4:return[2]}})}),function(){return u.apply(this,arguments)})},{key:"downloadBundledFile",value:(r=m(function(r){var u,f,y;return _ts_generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,3,,4]),u=r.replace(".",""),f="./cache/bundle".concat(u.toUpperCase(),".").concat(u),"bundle"===r&&(f="./cache/bundleBUNDLE.json"),[4,fetch(f,{method:"GET",headers:{"Content-Type":"application/json"}})];case 1:return[4,m.sent().json()];case 2:return y=m.sent(),this.setBundledCache(r,y),[3,4];case 3:return console.error("Hybrid File Cache: Downloaded bundled file",{type:r,error:m.sent()}),[3,4];case 4:return[2]}})}),function(u){return r.apply(this,arguments)})},{key:"injectOptimalFetchPipeline",value:function(){if(t3.Enabled||t4.Enabled){var r=nu.pipes[1];if(r)nu.remove(2),nu.insert(function(u,f){try{r(u,f)}catch(r){console.error("Hybrid File Cache: optimized fetch pipeline",{error:r})}},2),console.debug("Hybrid File Cache: injected optimal fetch pipeline",b(nu.pipes))}}},{key:"injectOptimalLoadPipeline",value:function(){if(t3.Enabled||t4.Enabled){var r=no.pipes[2];if(r)no.remove(2),no.insert(function(u,f){try{r(u,f)}catch(r){console.error("Hybrid File Cache: optimized load pipeline",{error:r})}},2),console.debug("Hybrid File Cache: injected optimal load pipeline",b(no.pipes))}}},{key:"injectCacheExtensionPipeline",value:function(){var r=this;if(t3.Enabled&&t3.CacheUuidExtension){var u={},n=function(f,y){f.output=f.input;for(var m=0;m<f.input.length;m++){var S=f.input[m];if(S.id){var _=r.getCacheExtension(S.id);_?(S.url=S.url.replace(S.ext,_),S.ext=_,u[S.id]=!0):u[S.id]=!1}}y(null,null)},i=function(f){return function(y,m){for(var S=b(y.input),_=0;_<S.length;_++){var w=S[_];if(w.id){var A,D=u[w.id];if(!r.nativeAssetDictionary.hasOwnProperty(w.id))r.nativeAssetDictionary[w.id]=null!==(A=w.isNative)&&void 0!==A&&A;D&&(w.isNative=!0)}}y.input.length>0&&console.debug("Hybrid File Cache: process cache extension"),f(y,m)}},a=function(f,y){f.output=f.input;for(var m=0;m<f.output.length;m++){var S,_=f.output[m];if(_.id){var w=null!==(S=r.nativeAssetDictionary[_.id])&&void 0!==S&&S;_.isNative=w,u[_.id]||r.setCacheExtension(_.id,_.ext)}}y(null,null)};no.insert(n,1),nu.insert(n,1),no.insert(a,3),nu.insert(a,3);var f=b(no.pipes),y=b(nu.pipes);no.pipes[2]=i(f[2]),nu.pipes[2]=i(y[2]),console.debug("Hybrid File Cache: inject cache extension pipelines",f,y,b(no.pipes),b(nu.pipes))}}},{key:"saveOriginDownloaders",value:function(){var r,u=w(this.supportTypes);try{for(u.s();!(r=u.n()).done;){var f=r.value;this.originDownloaders[f]=ns._downloaders[f]}}catch(r){u.e(r)}finally{u.f()}}},{key:"registerCustomDownloader",value:function(){var r,u=w(this.supportTypes);try{for(u.s();!(r=u.n()).done;){var f=r.value;"bundle"!==f&&ns.register(f,this.downloadFile(f))}}catch(r){u.e(r)}finally{u.f()}}},{key:"listenEvents",value:function(){nt.on(t0.SCENE_LOADED,this.requestUpdateStorage),L.on(et.CLEAR_HYBRID_FILE_CACHE,this.clearCache)}},{key:"getDownloader",value:function(r){var u;return null!==(u=this.originDownloaders[r])&&void 0!==u?u:null}},{key:"getCacheKey",value:function(r,u){var f=u.match(/.*\/([-a-z0-9@]+)\.([^\.]+)$/);if(!f)return null;var y=A(f,3),m=(y[0],y[1]),S=y[2];return!S||r.indexOf(S)<0?null:"".concat(m,":").concat(r)}},{key:"validateDataType",value:function(r,u){return Array.isArray(u)&&t6.hasOwn(u[0],"__type__"),!(".cconb"===r&&t6.hasOwn(u,"chunks")&&!(Array.isArray(u.chunks)&&_instanceof(u,ni)))||(console.warn("Hybrid File Cache: Invalid cconb",{type:r,data:u}),!1)}},{key:"encodeData",value:function(r,u){return".cconb"===r?t6.hasOwn(u,"_document")&&t6.hasOwn(u,"_chunks")?new ni(u._document,u._chunks):null:t7.clone(u)}},{key:"decodeData",value:function(r,u){if(".cconb"===r){if(!t6.hasOwn(u,"_document")||!t6.hasOwn(u,"_chunks"))return null;if(!Array.isArray(u._chunks))return null;var f,y=[],m=w(u._chunks);try{for(m.s();!(f=m.n()).done;){var S=f.value;_instanceof(S,Uint8Array)?y.push(S):y.push(new Uint8Array(Object.values(S)))}}catch(r){m.e(r)}finally{m.f()}return new ni(u._document,y)}return t7.clone(u)}},{key:"setCache",value:function(r,u,f){var y=this.getCacheKey(r,u);if(y&&this.validateDataType(r,f)){var m=this.encodeData(r,f);nn.setStorageData("HybridFileCache","cachedFiles",D({},y,m)),this.requestUpdateStorage()}}},{key:"getCache",value:function(r,u){var f=this.getCacheKey(r,u);if(!f)return null;var y=this.getFileCaches()[f];return y||(y=this.getBundledCache(r,f)),y?this.decodeData(r,y):null}},{key:"getFileCaches",value:function(){var r;return null!==(r=nn.getStorageData("HybridFileCache","cachedFiles"))&&void 0!==r?r:{}}},{key:"getCachedBundles",value:function(r){var u=nn.getStorageData("HybridFileCache","cachedBundles");if(!u)return null;var f=u[r];return f?(this.bundledFiles[r]=f,f):null}},{key:"getBundledCache",value:function(r,u){var f,y=this.bundledFiles[r];return y&&null!==(f=y[u.replace(":".concat(r),"")])&&void 0!==f?f:null}},{key:"setBundledCache",value:function(r,u){this.bundledFiles[r]=u,nn.setStorageData("HybridFileCache","cachedBundles",D({},r,u)),this.requestUpdateStorage()}},{key:"getCacheExtension",value:function(r){return this.getCachedExtensions()[r]}},{key:"setCacheExtension",value:function(r,u){nn.setStorageData("HybridFileCache","cachedExtensions",D({},r,u)),this.requestUpdateStorage()}},{key:"getCachedExtensions",value:function(){var r;return null!==(r=nn.getStorageData("HybridFileCache","cachedExtensions"))&&void 0!==r?r:{}}}]),e}()).prototype,"requestUpdateStorage",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(){nn.updateToWebStorage("HybridFileCache")}}}),tO);T._RF.pop();var nl={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};T._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var nh=GameCore,nd=nh.Events,nf=nh.Utils.Array,np=globalThis.game,nv=np.player,ng=np.event,ny=np.language,nm=np.monitorError,nS=function(){var r,u,S,_,w;function e(){var r=this;y(this,e),this.handlePreloadLanguage=function(){var u=m(function(u){var f,y,m,S,_;return _ts_generator(this,function(w){switch(w.label){case 0:if(f=u.locale,y=u.onLoad,m=u.onError,!r.isSupportedLocale(f))return[2,(console.warn("Preload language ".concat(f," not found")),void(null==m||m(new Error("Language ".concat(f," not found")))))];w.label=1;case 1:return w.trys.push([1,3,,4]),[4,r.addLanguage(f)];case 2:return w.sent(),null==y||y(f),[3,4];case 3:return S=w.sent(),console.error(_=r.toError(S,"handleLanguageRequested")),null==nm||nm.sendException(_),null==m||m(S),[3,4];case 4:return[2]}})});return function(r){return u.apply(this,arguments)}}(),this.handleChooseLanguage=function(u){var f=u.locale,y=u.saveToPlayerData;if(r.isSupportedLocale(f))try{r.setLanguage(f,void 0!==y&&y)}catch(u){var m=r.toError(u,"handleLanguageRequested");console.error(m),null==nm||nm.sendException(m)}else console.warn("Choose language ".concat(f," not found"))},this.handleLanguageRequested=function(){var u=m(function(u){var f,y,m,S,_,w,b;return _ts_generator(this,function(A){switch(A.label){case 0:if(f=u.locale,m=void 0!==(y=u.saveToPlayerData)&&y,S=u.onLoad,_=u.onError,!r.isSupportedLocale(f))return[2,(console.warn("Request language ".concat(f," not found")),void(null==_||_(new Error("Language ".concat(f," not found")))))];A.label=1;case 1:return A.trys.push([1,3,,4]),[4,r.addLanguage(f)];case 2:return A.sent(),null==S||S(f),r.setLanguage(f,m),[3,4];case 3:return w=A.sent(),console.error(b=r.toError(w,"handleLanguageRequested")),null==nm||nm.sendException(b),null==_||_(b),[3,4];case 4:return[2]}})});return function(r){return u.apply(this,arguments)}}()}return f(e,[{key:"init",value:(w=m(function(){var r,u;return _ts_generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,3,,4]),[4,this.initDefaultLanguage()];case 1:return f.sent(),this.listenEvent(),[4,this.initPlayerLanguage()];case 2:return f.sent(),[3,4];case 3:return r=f.sent(),console.error(u=this.toError(r,"handleLanguageRequested")),null==nm||nm.sendException(u),[3,4];case 4:return[2]}})}),function(){return w.apply(this,arguments)})},{key:"initDefaultLanguage",value:(_=m(function(){return _ts_generator(this,function(r){return ny.add("en",nl,!0),this.setLanguage("en"),[2]})}),function(){return _.apply(this,arguments)})},{key:"initPlayerLanguage",value:(S=m(function(){var r,u,f;return _ts_generator(this,function(y){switch(y.label){case 0:if(!(u=ny.getPlayerLanguage())||!this.isSupportedLocale(u))return[2,(console.warn("Language ".concat(u," not supported. Overriding with default language")),void this.setLanguage("en",!0))];return[4,this.addLanguage(u)];case 1:return y.sent(),f=null!==(r=nv.getPlayerDataByKey("isFirstLogin"))&&void 0!==r&&r,this.setLanguage(u,f),[2]}})}),function(){return S.apply(this,arguments)})},{key:"isSupportedLocale",value:function(r){return nf.has(eu,r)}},{key:"listenEvent",value:function(){ng.on(nd.REQUEST_LANGUAGE,this.handleLanguageRequested),L.on(nd.REQUEST_LANGUAGE,this.handleLanguageRequested),L.on(et.PRELOAD_LANGUAGE,this.handlePreloadLanguage),L.on(et.CHOOSE_LANGUAGE,this.handleChooseLanguage)}},{key:"addLanguage",value:(u=m(function(r){var u,f;var y=arguments;return _ts_generator(this,function(m){switch(m.label){case 0:return u=y.length>1&&void 0!==y[1]&&y[1],[4,this.getLangData(r)];case 1:return f=m.sent(),ny.add(r,f,u),[2]}})}),function(r){return u.apply(this,arguments)})},{key:"setLanguage",value:function(r,u){var f=arguments.length>1&&void 0!==u&&u;if(ny.choose(r),f){var y=nv.getPlayerSettings(),m=C(C({},y),{},{language:r});nv.setPlayerDataByName("settings",m)}}},{key:"getLangData",value:(r=m(function(r){var u;return _ts_generator(this,function(f){switch(f.label){case 0:if("en"===r)return[2,nl];return[4,ec.loadJsonAsync(el[r])];case 1:if(null===(u=f.sent()))throw new Error("Language ".concat(r," not found"));if(null===u.json)throw new Error("Language ".concat(r," is empty"));return[2,u.json]}})}),function(u){return r.apply(this,arguments)})},{key:"toError",value:function(r,u){return _instanceof(r,Error)?r:"string"==typeof r?new Error("LanguagePlugin: ".concat(r)):new Error("LanguagePlugin: Unknown error in module: <".concat(u,">"))}}]),e}();T._RF.pop(),T._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var nE=GameCore,n_=nE.Configs,nw=n_.Mockup,nb=nw.Leaderboards,nA=nw.GameSDK.Player,nD=n_.Leaderboards,nC=nE.Utils.Number,nk=globalThis.game.leaderboard,nR=function(){var r,u,S,_;function e(){var r=this;y(this,e),this.handleWhenGameSDKStarted=function(){nb.Enabled?r.setupLeaderboardsMockup():r.setupLeaderboards()}}return f(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(_=m(function(){return _ts_generator(this,function(r){return this.setupLeaderboardByConfigs(),[2]})}),function(){return _.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var r,u=nD.LeaderboardList,f=w(u);try{for(f.s();!(r=f.n()).done;){var y=r.value,m=y.Id,S=y.Name;nk.addLeaderboard({name:S,type:"global",autoSortRank:!0,leaderboardId:m})}}catch(r){f.e(r)}finally{f.f()}}},{key:"setupLeaderboardsMockup",value:(S=m(function(){return _ts_generator(this,function(r){return this.setupMockGlobalLeaderboards(),this.setupMockFriendsLeaderboard(),[2]})}),function(){return S.apply(this,arguments)})},{key:"setupMockGlobalLeaderboards",value:(u=m(function(){var r,u,f,y,m,S,_,b,A,D;return _ts_generator(this,function(C){switch(C.label){case 0:u=nb.NumOfLeaders,f=nD.LeaderboardList,y=w(f),C.label=1;case 1:C.trys.push([1,7,8,9]),y.s(),C.label=2;case 2:if(!!(r=y.n()).done)return[3,6];if(S=(m=r.value).Name,_=m.Id,!S)return[3,5];return[4,nk.createLeaderboardAsync({_id:_,name:S,numberOfLeaders:nC.random(u.Max-u.Min)+u.Min})];case 3:return b=C.sent(),nk.addLeaderboard({name:S,type:"global",autoSortRank:!0,leaderboardId:b}),[4,nk.requestLeaderboardAsync(S,10)];case 4:C.sent(),console.info("setupGlobalLeaderboard fetch new",A=nk.getLeaderboard(S),A&&Object.keys(A.leaders).length),console.info("setupGlobalLeaderboard load more",A=nk.getLeaderboard(S),A&&Object.keys(A.leaders).length),C.label=5;case 5:return[3,2];case 6:return[3,9];case 7:return D=C.sent(),y.e(D),[3,9];case 8:return y.f(),[7];case 9:return[2]}})}),function(){return u.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(r=m(function(){var r,u,f,y,m;return _ts_generator(this,function(S){switch(S.label){case 0:return r=eh.FRIENDS,u=ed.FRIENDS,f=0,(y=nA.ConnectedPlayers).Enabled&&(f=nC.random(y.NumOfPlayers-1)+1),[4,nk.createLeaderboardAsync({_id:u,name:r,numberOfLeaders:f})];case 1:return m=S.sent(),nk.addLeaderboard({name:r,type:"friends",autoSortRank:!0,leaderboardId:m}),[4,nk.requestLeaderboardAsync(r,10)];case 2:return S.sent(),console.info("setupFriendsLeaderboard done",nk.getLeaderboard(r)),[2]}})}),function(){return r.apply(this,arguments)})}]),e}();T._RF.pop(),T._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var nT=GameCore,nL=nT.Utils,nF=nT.Events,nM=nT.Configs.PerformanceMonitor.FpsTracking,nI=globalThis.game.event,nx=function(){function e(){var r=this;y(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){r.startTraceFps(),P.on(H.EVENT_AFTER_UPDATE,r.handleLateUpdate)},this.handleLateUpdate=function(){if(r.mark){if(r.fpsTraceDuration-=L.deltaTime,r.fpsTraceDuration<=0&&!r.traceStopped)return r.traceStopped=!0,r.unListenEvents(),r.updateFPS(),void r.mark.stop(r.markName);r.fpsTraceIntervalTimer-=L.deltaTime,r.fpsTraceIntervalTimer>0||(r.fpsTraceIntervalTimer=r.fpsTraceInterval,r.updateFPS(),r.mark.stop(r.markName),r.startTraceFps())}}}return f(e,[{key:"mark",get:function(){return nM.Enabled?nL.Mark:null}},{key:"init",value:function(){var r=nM.TrackingDuration,u=nM.TrackingInterval;this.mark&&(this.fpsTraceDuration=null!=r?r:60,this.fpsTraceInterval=null!=u?u:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents())}},{key:"listenEvents",value:function(){nI.catchUp(nF.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){P.off(H.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var r,u;if(this.mark){var f=this.getFPS(),y=this.getDrawCalls(),m=this.getDeviceRender(),S=this.getTextureMemory();this.minFps=Math.min(null!==(r=this.minFps)&&void 0!==r?r:f,f),this.maxFps=Math.max(null!==(u=this.maxFps)&&void 0!==u?u:0,f),this.mark.putMetric(this.markName,"FPS Metric",f),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",m),this.mark.putAttr(this.markName,"Draw Calls",y.toString()),this.mark.putAttr(this.markName,"Texture Memory",S.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.debug("FPS: ".concat(f," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(y,", texture memory: ").concat(S.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!P.root)return 0;return Math.floor(P.root.fps)||0}},{key:"getDrawCalls",value:function(){return P.root&&P.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return P.root&&P.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return P.root&&P.root.device.memoryStatus.textureSize/1048576||0}}]),e}();T._RF.pop(),T._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var nP=GameCore.Events,nN=globalThis.game.event,nO=function(){function e(){y(this,e),this.handleHotReload=function(){L.restart()},this.handleUpdateConfig=function(r){if("Gameplay"===r.type){L.emit(et.GAMEPLAY_UPDATE_CONFIG,r.config);var u=r.id,f=r.type;nN.emit(nP.REMOTE_CONFIG_UPDATED,{id:u,type:f})}}}return f(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){nN.on(nP.REQUEST_HOT_RELOAD,this.handleHotReload),nN.on(nP.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();T._RF.pop(),T._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var nU=function(){function e(){y(this,e)}return f(e,[{key:"init",value:function(){this.initHybridFileCache(),console.info("Plugins Manager: Initialized")}},{key:"initLanguages",value:function(){(new nS).init()}},{key:"initLeaderboards",value:function(){(new nR).init()}},{key:"initRemoteConfig",value:function(){(new nO).init()}},{key:"initDynamicAtlas",value:function(){(new tX).init()}},{key:"initDynamicAssets",value:function(){(new tP).init()}},{key:"initHybridFileCache",value:function(){(new nc).init()}},{key:"initCanvasRecorder",value:function(){(new tg).init()}},{key:"initPerformanceMonitor",value:function(){(new nx).init()}},{key:"initAdaptivePerformance",value:function(){(new th).init()}}]),e}();T._RF.pop(),T._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var nz=globalThis.game,nG=nz.event,nB=nz.monitorError,nV=GameCore,nH=nV.Events,nq=nV.Configs.PerformanceMonitor,nj=nV.Utils.Mark,nQ=function(){var r;function e(){var r=this;y(this,e),this.markName="Load Scene",this.testScene={},this.isClearedMark=!1,this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var u=m(function(u){var f,y,m;return _ts_generator(this,function(S){return f=u.sceneName,y=u.sceneData,console.debug("Switching",m=r.correctSceneName(f),null!=y?y:{}),m&&(L.emit(et.REQUEST_VIEW_RESIZE),setTimeout(function(){ep.showLoadingFullScreen(m)},0),r.startScene({sceneName:m,sceneData:y})),[2]})});return function(r){return u.apply(this,arguments)}}(),this.preloadScene=function(){var u=m(function(u,f){var y,m;return _ts_generator(this,function(S){switch(S.label){case 0:return y=u.sceneName,[4,r.waitSceneLoaded(y)];case 1:return S.sent(),r.startMeasure("preload",u),null==(m=Q.getBundle("main"))||m.loadScene(y,{},r.onSceneProgress,r.onScenePreloaded(y,f)),[2]}})});return function(r,f){return u.apply(this,arguments)}}(),this.waitSceneLoaded=function(){var u=m(function(u){return _ts_generator(this,function(f){switch(f.label){case 0:if(!r.queueLoadScene[u])return[3,2];return[4,nG.waitTo(nH.SCENE_LOADED)];case 1:console.info("SceneManager.waitSceneLoaded",{payload:f.sent()}),f.label=2;case 2:return[2]}})});return function(r){return u.apply(this,arguments)}}(),this.startMeasure=function(u,f){if(r.mark){var y=f.sceneName;r.queueLoadScene[y]&&(r.mark.putAttr(r.markName,"Canceled","true"),r.stopMeasure(y)),console.groupCollapsed("\uD83D\uDCE6 ".concat(y,": ").concat(u," progress")),r.mark.measure(r.markName),r.mark.putAttr(r.markName,"Cancel","false"),r.mark.putAttr(r.markName,"Success","false"),r.mark.putMetric(r.markName,y),r.mark.start(r.markName),r.queueLoadScene[y]=!0}},this.stopMeasure=function(u){r.mark&&r.queueLoadScene[u]&&(r.mark.rmAttr(r.markName,"File"),r.mark.putAttr(r.markName,"Success","true"),r.mark.stop(r.markName),r.queueLoadScene[u]=!1,console.groupEnd())},this.onSceneProgress=function(u,f,y){r.mark&&r.mark.putAttr(r.markName,"Last File","".concat(y.id," (").concat(y.ext,")"));var m=Math.floor(u/f*70+30);GameSDK.setLoadingProgress(m)},this.onScenePreloaded=function(r,u){return function(f){u&&u(r,null!=f?f:null),console.debug("SceneManager.onScenePreloaded",{sceneName:r,error:f}),f||nG.emit(nH.SCENE_LOADED,{sceneName:r,isPreload:!0})}},this.onSceneLoaded=function(u,f){var y=arguments.length>1&&void 0!==f?f:0;return function(f,m){var S=u.sceneName,_=u.sceneData;if(f||!m||m.name!==S)return console.warn("SceneManager.onSceneLoaded",{error:f,scene:m,sceneName:S,retries:y}),void r.startScene(u,y+1);r.handleBeforeSceneLaunch(m,_)(),P.once(H.EVENT_AFTER_SCENE_LAUNCH,r.handleSceneLaunched(S,_))}},this.handleBeforeSceneLaunch=function(u,f){return function(){r.setSceneData(u,null!=f?f:{}),nG.emit(nH.SCENE_LOADED,{sceneName:u.name}),r.isClearedMark||(nG.clear(nH.MARK_IS_TEST_SCENE),r.isClearedMark=!0)}},this.handleSceneLaunched=function(u,f){return function(){var y;ep.hideLoadingFullScreen(u),ev.switchSceneTracking(),null==nB||nB.addMetadata({currentScene:u}),null===(y=r.callbackSwitchScene)||void 0===y||y.call(r,{sceneName:u,sceneData:f}),nG.emit(nH.SCENE_LAUNCHED,{sceneName:u}),P.once(H.EVENT_AFTER_RENDER,function(){L.emit(et.REQUEST_VIEW_RESIZE),nG.emit(nH.SCENE_RENDERED,{sceneName:u})})}},this.handleSceneLoaded=function(u){var f=u.sceneName;r.stopMeasure(f),eg.markIsSceneLoaded(f)},this.setTestScene=function(u){var f=u.sceneName;console.warn("SceneManager.setTestScene",f),r.testScene[f]=!0}}return f(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){nG.catchUp(nH.MARK_IS_TEST_SCENE,this.setTestScene),nG.on(nH.SWITCH_SCENE,this.switchScene),nG.on(nH.PRELOAD_SCENE,this.preloadScene),nG.on(nH.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(r){var u=this.getCurrentScene(),f=this.getTestScene();return f&&(null==u?void 0:u.name)!==f?f:null!=u&&u.isValid?r===ef.DASHBOARD_SCENE?ef.GAME_SCENE:r===u.name?null:r:r}},{key:"startScene",value:(r=m(function(r){var u,f,y,m;var S=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:return u=this,f=S.length>1&&void 0!==S[1]?S[1]:0,y=r.sceneName,[4,this.waitSceneLoaded(y)];case 1:return _.sent(),this.startMeasure("start",r),null==(m=Q.getBundle("main"))||m.loadScene(y,{},null,function(m,S){if(m)return console.warn("SceneManager.startScene",{error:m,sceneName:y,retries:f}),void u.startScene(r,f+1);P.runScene(S,void 0,u.onSceneLoaded(r,f))}),[2]}})}),function(u){return r.apply(this,arguments)})},{key:"mark",get:function(){return nq.LoadResources?nj:null}},{key:"getCurrentScene",value:function(){return P.getScene()}},{key:"getTestScene",value:function(){var r;return null!==(r=Object.keys(this.testScene)[0])&&void 0!==r?r:null}},{key:"onSwitchScene",value:function(r){this.callbackSwitchScene=r}},{key:"setSceneData",value:function(r,u){if(u&&("data"in r||r.scene.attr({data:{}}),"data"in r)){var f=r.data||{};r.scene.attr({data:C(C({},f),u)}),console.debug("SceneManager.setSceneData",{sceneName:r.name,sceneData:u,currentData:f})}}}]),e}();T._RF.pop(),T._RF.push({},"a3a11eRcsNI5aahAZL2xA8X","ScreenEntry",void 0);var nW=function(){function e(r){var u,f,m=arguments.length>0&&void 0!==r?r:{};y(this,e),this.state="queued",this.order=0,this.parent=null,this.useCount=0,this.name="Unknown";var S=m.state,_=m.order,w=m.prefab,b=m.screen,A=m.parent,D=m.name;this.state=null!=S?S:this.state,this.order=null!=_?_:this.order,this.prefab=w,this.screen=b,this.parent=null!=A?A:null,this.name=null!==(u=null!=D?D:null==b||null===(f=b.node)||void 0===f?void 0:f.name)&&void 0!==u?u:"Unknown"}return f(e,[{key:"resetParent",value:function(){var r,u;if(this.screen){if(this.parent)null===(u=this.screen.node)||void 0===u||u.removeFromParent();null===(r=this.screen.node)||void 0===r||r.destroy(),this.screen=void 0,this.parent=null}}},{key:"incrementUseCount",value:function(){this.useCount+=1,console.debug("Screen ".concat(this.name," use count: ").concat(this.useCount))}}]),e}();T._RF.pop(),T._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var nY=globalThis.game,nK=nY.event,nZ=nY.monitorError,nJ=GameCore,nX=nJ.Events,n$=nJ.Utils,n0=n$.Object,n1=n$.Valid,n2=function(r){return r.READY="ready",r.LOADING="loading",r.QUEUED="queued",r}(n2||{}),n3=function(){var r,u,S,_,b,A,D,k,R,T;function e(){var r=this;y(this,e),this.screens={},this.isScreenLoading=!1,this.screenLoadingQueue=[],this.handleOpenScreen=function(u){r.openScreen(u.screenName,u.screenData)},this.handleCloseScreen=function(u){r.closeScreen(u.screenName,!0)},this.handlePreloadScreens=function(){var u=P.getScene();r.validateScene(u)&&(r.initScreens(u),r.preloadScreens())},this.handleSwitchScene=function(){r.resetAllScreenParents()}}return f(e,[{key:"init",value:function(){this.bindEventHandlers(),console.info("Screen Manager: Initialized")}},{key:"bindEventHandlers",value:function(){nK.on(nX.OPEN_SCREEN,this.handleOpenScreen),nK.on(nX.CLOSE_SCREEN,this.handleCloseScreen),nK.on(nX.PRELOAD_SCREENS,this.handlePreloadScreens),nK.on(nX.SWITCH_SCENE,this.handleSwitchScene)}},{key:"resetAllScreenParents",value:function(){for(var r in this.screens){var u=this.screens[r];u&&u.resetParent()}}},{key:"validateScene",value:function(r){return!!r||(console.warn("No scene found for preloading screens"),!1)}},{key:"initScreens",value:function(r){var u=r.getComponentsInChildren("BaseScreen");if(!n1.isEmpty(u)){var f=u.map(function(r){return null==r?void 0:r.node.name}).join(", ");console.info("\uD83D\uDCFA Active Screens in ".concat(r.name,": ").concat(f)),this.addScreens(u)}var y=this.getScreenHolder();if(y){var m=y.screenKeys.filter(function(r){return!u.some(function(u){return u.node.name===ey[r]})});if(!n1.isEmpty(m)){var S=m.map(function(r){return ey[r]});console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(r.name,": ").concat(S.join(", "))),this.addScreenQueues(S)}}}},{key:"getScreenHolder",value:function(){var r=P.getScene();return null==r?void 0:r.getComponentInChildren("Screens")}},{key:"addScreens",value:function(r){var u=this;r.forEach(function(r,f){var y=r.node.name;if(u.isScreenNameValid(y)){if(u.isScreenReady(y)){var m=u.screens[y];return m.screen=r,void(m.parent=r.node.parent)}u.screens[y]=new nW({state:n2.READY,order:f,screen:r,parent:r.node.parent,name:y})}else console.warn("ScreenManager.addScreens: Invalid screen name ".concat(y))})}},{key:"isScreenReady",value:function(r){var u;return(null===(u=this.screens[r])||void 0===u?void 0:u.state)===n2.READY}},{key:"isScreenCreated",value:function(r){var u,f=null===(u=this.screens[r])||void 0===u?void 0:u.screen;if(!f)return!1;var y=f.node;return!!y&&y.isValid}},{key:"isScreenNameValid",value:function(r){return n1.isString(r)&&n0.vals(ey).includes(r)}},{key:"addScreenQueues",value:function(r){var u=this,f=this.getScreenHolder();null!=f&&f.isValid?(r.forEach(function(r,y){if(u.isScreenNameValid(r)){var m=u.screens[r];m?u.isScreenReady(r)||(m.state=n2.QUEUED,m.order=y,console.warn("ScreenManager.addScreenQueues: Screen ".concat(r," queued"))):u.screens[r]=new nW({state:n2.QUEUED,order:y,parent:f.node,name:r})}else console.warn("ScreenManager.addScreenQueues: Invalid screen name ".concat(r))}),console.debug("ScreenManager.addScreenQueues: Screens Info",C({},this.screens))):console.warn("ScreenManager.addScreenQueues: No valid screen holder found")}},{key:"loadScreen",value:(T=m(function(r){var u,f,y;return _ts_generator(this,function(m){switch(m.label){case 0:if(u=this.screens[r],!this.validateScreenEntry(u,n2.QUEUED))return[2,null];m.label=1;case 1:return m.trys.push([1,3,,4]),u.state=n2.LOADING,[4,ec.loadPrefabAsync("screens/".concat(r))];case 2:return[2,(f=m.sent())?(u.state=n2.READY,u.prefab=f,console.debug("ScreenManager.loadScreen: ".concat(r," loaded successfully")),f):null];case 3:return y=m.sent(),[2,(console.warn("ScreenManager.loadScreen: Failed to load ".concat(r),y),u.state=n2.QUEUED,null)];case 4:return[2]}})}),function(r){return T.apply(this,arguments)})},{key:"validateScreenEntry",value:function(r,u){return!(!r||u&&r.state!==u)}},{key:"preloadScreens",value:(R=m(function(){var r,u,f,y;return _ts_generator(this,function(m){switch(m.label){case 0:for(u in r=[],this.screens)r.push(u);f=0,m.label=1;case 1:if(!(f<r.length))return[3,4];return y=r[f],[4,this.loadScreen(y)];case 2:m.sent(),m.label=3;case 3:return f++,[3,1];case 4:return[2]}})}),function(){return R.apply(this,arguments)})},{key:"getScreenPrefab",value:(k=m(function(r){var u,f,y,m,S;return _ts_generator(this,function(_){switch(_.label){case 0:if(!((y=this.screens[r])||(this.addScreenQueues([r]),y=this.screens[r])))return[3,5];if(!(null!==(u=y.parent)&&void 0!==u&&u.isValid))return[3,3];if(this.isScreenReady(r))return[3,2];return[4,this.loadScreen(r)];case 1:_.sent(),_.label=2;case 2:return S=null!==(f=y.prefab)&&void 0!==f?f:null,[3,4];case 3:console.warn("ScreenManager.getScreenPrefab: Invalid parent for ".concat(r)),S=null,_.label=4;case 4:return m=S,[3,6];case 5:console.warn("ScreenManager.getScreenPrefab: Failed to create entry for ".concat(r)),m=null,_.label=6;case 6:return[2,m]}})}),function(r){return k.apply(this,arguments)})},{key:"updateScreenParent",value:function(r,u){var f;r.screen&&r.parent!==u&&null!==(f=r.screen)&&void 0!==f&&f.node&&null!=u&&u.isValid&&(u.addChild(r.screen.node),r.parent=u)}},{key:"getScreen",value:(D=m(function(r){var u,f,y,m,S;return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.isScreenNameValid(r))return[2,null];if(null==(f=this.getScreenHolder())||!f.isValid)throw new Error("ScreenManager.getScreen: Invalid screen holder");if(!(y=!this.isScreenReady(r)))return[3,2];return[4,this.getScreenPrefab(r)];case 1:y=!_.sent(),_.label=2;case 2:if(y)throw new Error("ScreenManager.getScreen: Prefab not found for ".concat(r));if(!(m=this.screens[r]))throw new Error("ScreenManager.getScreen: Entry not found for ".concat(r));if(!this.isScreenCreated(r))(S=K(m.prefab)).name=r,m.screen=S.getComponent("BaseScreen"),f.node.addChild(S),S.active=!1;if(null===(u=m=this.screens[r])||void 0===u||!u.screen)throw new Error("ScreenManager.getScreen: Screen component not found for ".concat(r));return[2,(this.updateScreenParent(m,f.node),this.reorderScreens(),console.debug("ScreenManager.getScreen: Retrieved ".concat(r),m),m.screen)]}})}),function(r){return D.apply(this,arguments)})},{key:"reorderScreens",value:function(){var r,u=this,f=n0.vals(this.screens).filter(function(r){return u.isScreenReady(r.name)}).sort(function(r,u){return r.order-u.order}),y=w(f);try{for(y.s();!(r=y.n()).done;){var m,S,_=r.value;null!==(m=_.parent)&&void 0!==m&&m.isValid&&(null===(S=_.screen)||void 0===S||S.node.setSiblingIndex(_.order))}}catch(r){y.e(r)}finally{y.f()}}},{key:"waitForScreenLoading",value:(A=m(function(){var r;return _ts_generator(this,function(u){if(r=this,this.isScreenLoading)return[2,new Promise(function(u){!function n(){r.isScreenLoading?requestAnimationFrame(n):u()}()})];return[2]})}),function(){return A.apply(this,arguments)})},{key:"processScreenQueue",value:function(){if(!this.isScreenLoading&&0!==this.screenLoadingQueue.length){var r=this.screenLoadingQueue.shift();r&&this.openScreen(r.screenName,r.screenData)}}},{key:"openScreen",value:(b=m(function(r,u){var f;return _ts_generator(this,function(y){switch(y.label){case 0:if(!this.isScreenNameValid(r))return[3,5];if(!this.isScreenLoading)return[3,1];return this.queueScreen(r,u),[3,5];case 1:return y.trys.push([1,3,4,5]),[4,this.performScreenOpen(r,u)];case 2:return y.sent(),[3,5];case 3:return f=y.sent(),console.error("ScreenManager.openScreen: Error opening ".concat(r),f),[3,5];case 4:return this.finishScreenOpen(),[7];case 5:return[2]}})}),function(r,u){return b.apply(this,arguments)})},{key:"queueScreen",value:function(r,u){console.debug("ScreenManager.queueScreen: Queuing ".concat(r)),this.screenLoadingQueue.push({screenName:r,screenData:u})}},{key:"performScreenOpen",value:(_=m(function(r,u){var f,y;return _ts_generator(this,function(m){switch(m.label){case 0:return this.isScreenLoading=!0,em.setBlockInput(!0),[4,this.getScreen(r)];case 1:if(null==(f=m.sent())||!f.isValid)throw new Error("ScreenManager.performScreenOpen: Invalid screen ".concat(r));return null==(y=this.screens[r])||y.incrementUseCount(),[4,this.showScreen(f,r,u)];case 2:return m.sent(),[2]}})}),function(r,u){return _.apply(this,arguments)})},{key:"showScreen",value:(S=m(function(r,u,f){var y;return _ts_generator(this,function(m){switch(m.label){case 0:return r.node.active=!0,y={screenName:u,screenData:f},nK.emit(nX.OPENING_SCREEN,y),[4,new Promise(function(r){return requestAnimationFrame(r)})];case 1:return m.sent(),r.open(f),this.updateAnalytics(u),[2]}})}),function(r,u,f){return S.apply(this,arguments)})},{key:"finishScreenOpen",value:function(){this.isScreenLoading=!1,em.setBlockInput(!1),this.processScreenQueue()}},{key:"closeScreen",value:(u=m(function(r){var u,f;var y=arguments;return _ts_generator(this,function(m){switch(m.label){case 0:if(u=y.length>1&&void 0!==y[1]&&y[1],!this.isScreenNameValid(r))return[3,7];if(!this.isScreenReady(r))return[3,6];return[4,this.waitForScreenLoading()];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,4,,5]),[4,this.performScreenClose(r,u)];case 3:return m.sent(),[3,5];case 4:return f=m.sent(),console.error("ScreenManager.closeScreen: Error closing ".concat(r),f),[3,5];case 5:return[3,7];case 6:console.debug("ScreenManager.closeScreen: ".concat(r," is not ready")),m.label=7;case 7:return[2]}})}),function(r){return u.apply(this,arguments)})},{key:"performScreenClose",value:(r=m(function(r,u){var f;return _ts_generator(this,function(y){switch(y.label){case 0:return[4,this.getScreen(r)];case 1:return null!=(f=y.sent())&&f.isValid&&f.node.active&&(nK.emit(nX.CLOSING_SCREEN,{screenName:r}),f.close(),u&&this.updateAnalytics(r,!1)),[2]}})}),function(u,f){return r.apply(this,arguments)})},{key:"updateAnalytics",value:function(r,u){var f=!(arguments.length>1&&void 0!==u)||u;ev.trackCurrentPage(r,f),f?null==nZ||nZ.addMetadata({currentScreen:r}):null==nZ||nZ.removeMetadata("currentScreen")}},{key:"closeAllScreens",value:function(){for(var r in this.screens)this.closeScreen(r,false)}}]),e}();T._RF.pop(),T._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var n4=GameCore,n5=n4.Configs.Core,n6=n4.Events,n8=n4.Plugins.Analytics.Events,n7=globalThis.game,n9=n7.context,re=n7.storage,rt=n7.event,rn=n7.analytics,rr=n7.monitorError;new(function(){var r,u;function e(){var r=this;y(this,e),this.coreManager=new eM,this.adsManager=new eC,this.sceneManager=new nQ,this.screenManager=new n3,this.engineManager=new eH,this.layoutManager=new e9,this.playerManager=new ti,this.pluginsManager=new nU,this.handleWhenCoreBoot=function(){console.warn("Corecos System: Core boot",{inited:L.inited,game:L}),L.inited?r.handleCocosInit():L.once(Z.EVENT_GAME_INITED,r.handleCocosInit)},this.handleCocosInit=function(){r.coreManager.requestStart()},this.handleWhenCoreStart=function(){r.playerManager.setupDefaultGameData(),console.groupEnd()},this.handleWhenCoreReady=function(){r.initPlugins(),console.groupEnd(),rn.event(n8.LOAD_START),rt.catchUp(n6.BUNDLE_READY,r.processPreStartGame)},this.processPreStartGame=function(){rt.catchUp(n6.SCENE_LOADED,r.preloadScenes),rt.catchUp(n6.SCENE_LAUNCHED,r.processBootSceneLaunched),r.runBootScene()},this.processBootSceneLaunched=m(function(){return _ts_generator(this,function(u){switch(u.label){case 0:if(!n5.StartSDKAfterLoadGame)return[3,2];return[4,rt.waitTo(n6.SCENE_LOADED)];case 1:u.sent(),u.label=2;case 2:return r.processStartGame(),[2]}})}),this.preloadScenes=function(){"solo"===re.getStorageData("context","sessionContextType")?eg.preloadDashboardScene():eg.preloadGameScene()},this.handleSwitchScene=function(){rt.emit(n6.PRELOAD_SCREENS),console.groupEnd()},this.startProcessContextData=m(function(){var u;return _ts_generator(this,function(f){switch(f.label){case 0:rn.event(n8.APP_READY),f.label=1;case 1:return f.trys.push([1,3,4,5]),r.playerManager.requestConnectedPlayers(),[4,n9.processContextData()];case 2:return f.sent(),[3,5];case 3:return console.error("startProcessContextData",u=f.sent()),_instanceof(u,Error)&&(null==rr||rr.sendException(u)),[3,5];case 4:return rt.emit(n6.GAME_READY),[7];case 5:return[2]}})}),rn.event(n8.ENGINE_READY),console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.initManagers(),this.listenEvents(),console.groupEnd()}return f(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"runBootScene",value:function(){eg.switchScene(ef.BOOT_SCENE)}},{key:"processStartGame",value:(u=m(function(){return _ts_generator(this,function(r){switch(r.label){case 0:return console.groupEnd(),rn.event(n8.LOAD_COMPLETE),[4,this.startGameAsync()];case 1:return r.sent(),rt.catchUp(n6.PLAYER_INFO_LOADED,this.startProcessContextData),[2]}})}),function(){return u.apply(this,arguments)})},{key:"startGameAsync",value:(r=m(function(){var r,u,f;var y=arguments;return _ts_generator(this,function(m){switch(m.label){case 0:r=this,u=y.length>0&&void 0!==y[0]?y[0]:0,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,GameSDK.startGameAsync()];case 2:return m.sent(),[3,4];case 3:return console.warn("GameSDK.startGameAsync",f=m.sent()),u<=3?setTimeout(function(){r.startGameAsync(u+1)},1e3):null==rr||rr.sendException(_instanceof(f,Error)?f:new Error(JSON.stringify(f))),[3,4];case 4:return[2]}})}),function(){return r.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initLanguages(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAtlas(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),T._RF.pop(),T._RF.push({},"826b3i39nhICrG3S59Y/cpR","PipelineData",void 0);var ri=f(function e(r,u,f,m){y(this,e),this.id=0xffffffff,this.width=0,this.height=0,this.id=r,this.width=u,this.height=f,this.framebuffer=m});void 0===T.user&&(T.user=new Object,T.user.windowID=0,T.user.windows=new WeakMap),T._RF.pop(),T._RF.push({},"c7df3pBHqRChZTjXMfWIy6H","Optimized2DPipeline",void 0);var ra=X.ccclass,rs=function(){function e(){y(this,e),this._viewport=new J.Viewport,this._clearColor=new J.Color(0,0,0,1),this.usesMask=!0}return f(e,[{key:"setup",value:function(r,u){for(var f=0;f<r.length;f++){var y=r[f];if(y&&null!==y.scene&&null!==y.window){var m=this.prepareCameraResources(u,y);this.buildForward(u,y,m.id,m.width,m.height)}}}},{key:"prepareCameraResources",value:function(r,u){var f=function(r){var u=T.user.windows.get(r.window);return void 0!==u||(u=new ri(T.user.windowID,0,0,r.window.framebuffer),++T.user.windowID,T.user.windows.set(r.window,u)),u}(u);return 0===f.width&&0===f.height?(f.width=u.window.width,f.height=u.window.height,this.initCameraResources(r,u,f.id,f.width,f.height)):f.framebuffer===u.window.framebuffer&&f.width===u.window.width&&f.height===u.window.height||(f.framebuffer=u.window.framebuffer,f.width=u.window.width,f.height=u.window.height,this.initCameraResources(r,u,f.id,f.width,f.height)),f}},{key:"initCameraResources",value:function(r,u,f,y,m){r.addRenderWindow("Color".concat(f),J.Format.RGBA8,y,m,u.window),this.usesMask&&r.addDepthStencil("DepthStencil".concat(f),J.Format.DEPTH_STENCIL,y,m)}},{key:"buildForward",value:function(r,u,f,y,m){this._clearColor.x=u.clearColor.x,this._clearColor.y=u.clearColor.y,this._clearColor.z=u.clearColor.z,this._clearColor.w=u.clearColor.w,this._viewport.left=u.viewport.x*y,this._viewport.top=u.viewport.y*m,this._viewport.width=u.viewport.z*y,this._viewport.height=u.viewport.w*m;var S=r.addRenderPass(y,m,"default");S.setViewport(this._viewport),function(r){return 0!=(r.clearFlag&J.ClearFlagBit.COLOR)}(u)?S.addRenderTarget("Color".concat(f),J.LoadOp.CLEAR,J.StoreOp.STORE,this._clearColor):S.addRenderTarget("Color".concat(f),J.LoadOp.LOAD),this.usesMask&&(u.clearFlag&J.ClearFlagBit.DEPTH_STENCIL?S.addDepthStencil("DepthStencil".concat(f),J.LoadOp.CLEAR,J.StoreOp.STORE,u.clearDepth,u.clearStencil,u.clearFlag&J.ClearFlagBit.DEPTH_STENCIL):S.addDepthStencil("DepthStencil".concat(f),J.LoadOp.LOAD))}}]),e}();$&&(console.log("register pipeline"),$.setCustomPipeline("Optimized2DPipeline",new rs)),ra("Optimized2DPipeline")(function(r){k(a,r);var u=R(a);function a(){return y(this,a),u.apply(this,arguments)}return f(a,[{key:"start",value:function(){}},{key:"update",value:function(r){}}]),a}(ee)),T._RF.pop()}}}),function(r){r("virtual:///prerequisite-imports/systems","chunks:///systems.js")}(function(r,u){System.register(r,[u],function(r,u){return{setters:[function(u){var f={};for(var y in u)if("default"!==y&&"__esModule"!==y)f[y]=u[y];r(f)}],execute:function(){}}})});