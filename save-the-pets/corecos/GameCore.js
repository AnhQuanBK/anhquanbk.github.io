function _array_like_to_array(e,t){if(null==t||t>e.length)t=e.length;for(var r=0,c=new Array(t);r<t;r++)c[r]=e[r];return c}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function _assert_this_initialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function asyncGeneratorStep(e,t,r,c,d,h,_){try{var y=e[h](_);var f=y.value}catch(e){r(e);return}if(y.done)t(f);else Promise.resolve(f).then(c,d)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise(function(c,d){var h=e.apply(t,r);function _next(e){asyncGeneratorStep(h,c,d,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(h,c,d,_next,_throw,"throw",e)}_next(void 0)})}}function _call_super(e,t,r){t=_get_prototype_of(t);return _possible_constructor_return(e,_is_native_reflect_construct()?Reflect.construct(t,r||[],_get_prototype_of(e).constructor):t.apply(e,r))}function _class_call_check(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _construct(){_construct=_is_native_reflect_construct()?Reflect.construct:function construct(e,t,r){var c=[null];c.push.apply(c,t);var d=Function.bind.apply(e,c);var h=new d;if(r)_set_prototype_of(h,r.prototype);return h};return _construct.apply(null,arguments)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var c=t[r];c.enumerable=c.enumerable||false;c.configurable=true;if("value"in c)c.writable=true;Object.defineProperty(e,c.key,c)}}function _create_class(e,t,r){if(t)_defineProperties(e.prototype,t);if(r)_defineProperties(e,r);return e}function _define_property(e,t,r){if(t in e)Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true});else e[t]=r;return e}function _get(e,t,r){_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function get(e,t,r){var c=_super_prop_base(e,t);if(!c)return;var d=Object.getOwnPropertyDescriptor(c,t);if(d.get)return d.get.call(r||e);return d.value};return _get(e,t,r||e)}function _get_prototype_of(e){_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)};return _get_prototype_of(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)_set_prototype_of(e,t)}function _instanceof(e,t){if(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance])return!!t[Symbol.hasInstance](e);return e instanceof t}function _is_native_function(e){return -1!==Function.toString.call(e).indexOf("[native code]")}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var c=[];var d=true;var h=false;var _,y;try{for(r=r.call(e);!(d=(_=r.next()).done);d=true){c.push(_.value);if(t&&c.length===t)break}}catch(e){h=true;y=e}finally{try{if(!d&&null!=r.return)r.return()}finally{if(h)throw y}}return c}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};var c=Object.keys(r);if("function"==typeof Object.getOwnPropertySymbols)c=c.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}));c.forEach(function(t){_define_property(e,t,r[t])})}return e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);if(t)c=c.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable});r.push.apply(r,c)}return r}function _object_spread_props(e,t){t=null!=t?t:{};if(Object.getOwnPropertyDescriptors)Object.defineProperties(e,Object.getOwnPropertyDescriptors(t));else ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))});return e}function _object_without_properties(e,t){if(null==e)return{};var r=_object_without_properties_loose(e,t);var c,d;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(e);for(d=0;d<h.length;d++){c=h[d];if(!(t.indexOf(c)>=0)){if(!!Object.prototype.propertyIsEnumerable.call(e,c))r[c]=e[c]}}}return r}function _object_without_properties_loose(e,t){if(null==e)return{};var r={};var c=Object.keys(e);var d,h;for(h=0;h<c.length;h++){d=c[h];if(!(t.indexOf(d)>=0))r[d]=e[d]}return r}function _possible_constructor_return(e,t){if(t&&("object"===_type_of(t)||"function"==typeof t))return t;return _assert_this_initialized(e)}function _set_prototype_of(e,t){_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(e,t){e.__proto__=t;return e};return _set_prototype_of(e,t)}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _super_prop_base(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=_get_prototype_of(e);if(null===e)break}return e}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,t){if(!e)return;if("string"==typeof e)return _array_like_to_array(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor)r=e.constructor.name;if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _array_like_to_array(e,t)}function _wrap_native_super(e){var t="function"==typeof Map?new Map:void 0;_wrap_native_super=function wrapNativeSuper(e){if(null===e||!_is_native_function(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_get_prototype_of(this).constructor)}Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _set_prototype_of(Wrapper,e)};return _wrap_native_super(e)}function _is_native_reflect_construct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_is_native_reflect_construct=function(){return!!e})()}function _ts_generator(e,t){var r,c,d,h,_={label:0,sent:function(){if(1&d[0])throw d[1];return d[1]},trys:[],ops:[]};return h={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function verb(e){return function(t){return step([e,t])}}function step(h){if(r)throw new TypeError("Generator is already executing.");while(_)try{if(r=1,c&&(d=2&h[0]?c.return:h[0]?c.throw||((d=c.return)&&d.call(c),0):c.next)&&!(d=d.call(c,h[1])).done)return d;if(c=0,d)h=[2&h[0],d.value];switch(h[0]){case 0:case 1:d=h;break;case 4:_.label++;return{value:h[1],done:false};case 5:_.label++;c=h[1];h=[0];continue;case 7:h=_.ops.pop();_.trys.pop();continue;default:if(d=_.trys,!(d=d.length>0&&d[d.length-1])&&(6===h[0]||2===h[0])){_=0;continue}if(3===h[0]&&(!d||h[1]>d[0]&&h[1]<d[3])){_.label=h[1];break}if(6===h[0]&&_.label<d[1]){_.label=d[1];d=h;break}if(d&&_.label<d[2]){_.label=d[2];_.ops.push(h);break}if(d[2])_.ops.pop();_.trys.pop();continue}h=t.call(e,_)}catch(e){h=[6,e];c=0}finally{r=d=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:true}}}var Yo=Object.defineProperty;var Al=function(e,t,r){return t in e?Yo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r};var l=function(e,t){return Yo(e,"name",{value:t,configurable:!0})};var u=function(e,t,r){return Al(e,(void 0===t?"undefined":_type_of(t))!="symbol"?t+"":t,r)};System.register(["./bundle/core.js","./bundle/__commonjsHelpers__.js"],function(e,t){"use strict";var r,c,d,h,_,y,f;return{setters:[function(e){r=e.G,c=e.P,d=e.M,h=e._,_=e.a,y=e.C},function(e){f=e.g}],execute:l(function(){var e,p,v;var g=r.Utils,m=g.Valid,A=g.Object,w=g.String,I=g.Json,b="is invalid",k=/*#__PURE__*/function(){function Y(e){_class_call_check(this,Y);this.defaultData(),this.processData(e)}_create_class(Y,[{key:"processData",value:function processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}},{key:"defaultData",value:function defaultData(){var e=this.constructor,t=e.name;this.lazyDefaultData(Y.data[t])}},{key:"lazyDefaultData",value:function lazyDefaultData(e){m.isObject(e)||this.exception("data",b);for(var t in e)if(A.hasOwn(e,t)){var r=e[t];A.assign(this,_define_property({},t,r))}}},{key:"lazyValidateStructure",value:function lazyValidateStructure(e){m.isObject(e)||this.exception("structure","is not object");var t=this.getKeys();var r=true,c=false,d=void 0;try{for(var h=t[Symbol.iterator](),_;!(r=(_=h.next()).done);r=true){var y=_.value;var f=this[y];void 0===f&&this.exception("structure","has no key ".concat(y)),A.hasOwn(e,y)||void 0===f||this.setDefaultData(y,e)}}catch(e){c=true;d=e}finally{try{if(!r&&null!=h.return)h.return()}finally{if(c)throw d}}}},{key:"setDefaultData",value:function setDefaultData(e,t){m.isObject(t)||this.exception("data",b);var r=this[e];void 0===r&&this.exception("default","has no key ".concat(e)),A.assign(t,_define_property({},e,r))}},{key:"lazyValidateData",value:function lazyValidateData(e){var t=this.getKeys();var r=true,c=false,d=void 0;try{for(var h=t[Symbol.iterator](),_;!(r=(_=h.next()).done);r=true){var y=_.value;var f=e[y],p=w.removeDiacritics(y).replace(/[^a-zA-Z0-9]/g,""),v="validate".concat(w.capitalize(p)),g=this[v];if("function"==typeof g)try{g.call(this,f)}catch(t){console.warn(t),this.setDefaultData(y,e)}else this.exception("validate","has no function ".concat(v))}}catch(e){c=true;d=e}finally{try{if(!r&&null!=h.return)h.return()}finally{if(c)throw d}}}},{key:"lazySetupData",value:function lazySetupData(e){var t=this.getKeys();var r=true,c=false,d=void 0;try{for(var h=t[Symbol.iterator](),_;!(r=(_=h.next()).done);r=true){var y=_.value;var f=e[y];A.assign(this,_define_property({},y,f))}}catch(e){c=true;d=e}finally{try{if(!r&&null!=h.return)h.return()}finally{if(c)throw d}}}},{key:"validate",value:function validate(){this.validateData(this.toObject())}},{key:"exception",value:function exception(e,t){throw new Error("".concat(this.constructor.name,": ").concat(e," ").concat(t))}},{key:"toObject",value:function toObject(){return Object.fromEntries(Object.entries(this).filter(function(e){var t=_sliced_to_array(e,1),r=t[0];return"toObject"!==r}))}},{key:"getKeys",value:function getKeys(){return Object.keys(this).filter(function(e){return"toObject"!==e})}}],[{key:"addDefaultData",value:function addDefaultData(e){m.isObject(e)||this.prototype.exception("default data",b),e=I.clone(e);var t=this,r=t.name;m.isObject(Y.data[r])||(Y.data[r]={}),Y.data[r]=A.merge(Y.data[r],e),console.info("".concat(r," default data:"),Y.data[r])}},{key:"getDefaultData",value:function getDefaultData(){var e=this,t=e.name;return I.clone(Y.data[t])}},{key:"addValidateFunction",value:function addValidateFunction(e,t){m.isString(e)||this.prototype.exception("validate key",b),"function"!=typeof t&&this.prototype.exception("validate function",b);var r="validate".concat(w.capitalize(e));A.assign(this.prototype,_define_property({},r,t))}}]);return Y}();l(k,"BaseDtos"),u(k,"data",{});var S=k;r.Dtos={Base:S};var D={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded"},P={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},E=r.Utils,C=E.Valid,x=P.playerId,N=P.name,T=P.photo,M=P.locale,L="is invalid",O=/*#__PURE__*/function(e){_inherits(Pa,e);function Pa(){_class_call_check(this,Pa);return _call_super(this,Pa,arguments)}_create_class(Pa,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){C.isString(e)&&e||this.exception("_id",L)}},{key:"validatePlayerId",value:function validatePlayerId(e){C.isString(e)&&e||this.exception("playerId",L)}},{key:"validateName",value:function validateName(e){C.isString(e)&&e||this.exception("name",L)}},{key:"validatePhoto",value:function validatePhoto(e){C.isString(e)||this.exception("photo",L)}},{key:"validateLocale",value:function validateLocale(e){C.isString(e)&&e||this.exception("locale",L)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Pa.prototype),"toObject",this).call(this)}}]);return Pa}(S);l(O,"PlayerInfoDtos");var R=O;R.addDefaultData({playerId:x,name:N,photo:T,locale:M});var G=new R({playerId:"10",name:"Your Friend"}).toObject(),F=/*#__PURE__*/function(e){_inherits(Ea,e);function Ea(e){_class_call_check(this,Ea);var t;t=_call_super(this,Ea,[e]);u(t,"code");t.code="CREATE_MATCH_FAILED";return t}return Ea}(_wrap_native_super(Error));l(F,"ACreateMatchFailed");var B=F;var V=/*#__PURE__*/function(e){_inherits(xa,e);function xa(e){_class_call_check(this,xa);var t;t=_call_super(this,xa,[e]),t.name="PlayerIdNotValid",t.message=null!=e?e:"Player id is not valid";return t}return xa}(B);l(V,"PlayerIdNotValid");var j=V;var U=r.Dtos,H=r.Utils,K=r.Events,W=H.Array,z=H.Object,q=H.Json,J=H.Valid,va=function va(e){var t=this;_class_call_check(this,va);var r=this;u(this,"game");u(this,"initContext",l(function(){var e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},r=new U.Context.Info(e),c=r.toObject(),d=c.contextId,h=c.contextType,_=c.entryPointData;t.game.context.receiveContext(d,h,_)},"initContext"));u(this,"initPlayer",l(/*#__PURE__*/_async_to_generator(function(){var e,t,c,d,h,_;return _ts_generator(this,function(y){switch(y.label){case 0:e=r.game,t=e.player,c=r.getPlayerInfo();console.info("playerInfo",q.clone(c));d=W.unique(z.vals(D));console.info("dataKeys",d);return[4,GameSDK.player.getDataAsync(d)];case 1:h=y.sent();console.info("rawData",q.clone(h));_=new U.Player.Data(h).toObject();console.info("playerData",q.clone(_)),t.receiveData(c,_),r.game.event.emit(K.PLAYER_INFO_LOADED);return[2]}})}),"initPlayer"));u(this,"getPlayerInfo",l(function(){try{var e=GameSDK.player.getID();var t=GameSDK.player.getName();var r=GameSDK.player.getPhoto(),c=GameSDK.getLocale();if(!J.isString(e))throw new j;return J.isString(t)||(t="You"),new U.Player.Info({playerId:e,name:t,photo:r,locale:c}).toObject()}catch(e){return G}},"getPlayerInfo"));this.game=e};l(va,"StateInitiator");var Q=va;var X=/*#__PURE__*/function(e){_inherits(Sa,e);function Sa(e,t){_class_call_check(this,Sa);var r;r=_call_super(this,Sa,[e]);u(r,"payload");r.name="BadRequest",r.message=null!=e?e:"This request is bad",r.payload=t;return r}return Sa}(_wrap_native_super(Error));l(X,"BadRequest");var Z=X;var $=/*#__PURE__*/function(e){_inherits(ba,e);function ba(e,t){_class_call_check(this,ba);var r;r=_call_super(this,ba,[e]);u(r,"payload");r.name="RequestTimeout",r.message=null!=e?e:"This request is timeout",r.payload=t;return r}return ba}(_wrap_native_super(Error));l($,"RequestTimeout");var ee=$;var et=r.Utils,ea=r.Configs,er=ea.AppId,es=ea.Network,eo=l(function(e){if(!e.ok)throw new Z(void 0,{response:e})},"validateResponse"),ec=l(function(){var e=window.game.auth.getToken();return{token:e,timeout:es.Timeout,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},"defaultConfig"),el=l(function(e,t,c,d){return /*#__PURE__*/_async_to_generator(function(){var h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:v.trys.push([0,3,,4]);if(!er)throw new Z("AppId is not defined");h="".concat(e,"/apps/").concat(er,"/").concat(t),_=new AbortController;c.signal=_.signal;y=setTimeout(function(){_.abort()},c.timeout);r.Utils.Valid.isObject(d)&&(c.body=JSON.stringify(d));return[4,fetch(h,c)];case 1:f=v.sent();clearTimeout(y),eo(f);return[4,f.json()];case 2:return[2,v.sent()||{}];case 3:p=v.sent();if(_instanceof(p,Z))return[2,null];throw _instanceof(p,Object)&&"name"in p&&"AbortError"===p.name?new ee:p;case 4:return[2]}})})},"requester"),eu=l(/*#__PURE__*/function(){var e=_async_to_generator(function(e,t){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,1,,7]);return[2,e()];case 1:r=c.sent();if(!(_instanceof(r,ee)&&t>0))return[3,6];c.label=2;case 2:c.trys.push([2,5,,6]);return[4,et.Time.sleepAsync(600)];case 3:c.sent();return[4,eu(e,t-1)];case 4:return[2,c.sent()];case 5:c.sent();return[2,{}];case 6:return[2,_instanceof(r,ee)?{}:(console.warn("Request error",r),{})];case 7:return[2]}})});return function(t,r){return e.apply(this,arguments)}}(),"handleRequest"),ed=l(/*#__PURE__*/function(){var e=_async_to_generator(function(e,t,r){var c,d,h,_;var y=arguments;return _ts_generator(this,function(f){switch(f.label){case 0:c=y.length>3&&void 0!==y[3]?y[3]:es.Retries;f.label=1;case 1:f.trys.push([1,3,,4]);d=_object_spread_props(_object_spread({},ec(),t),{method:"GET"}),h=el(r,e,d);return[4,eu(h,c)];case 2:return[2,f.sent()];case 3:_=f.sent();return[2,(console.warn("Get error",_),{})];case 4:return[2]}})});return function(t,r,c){return e.apply(this,arguments)}}(),"get"),eh=l(/*#__PURE__*/function(){var e=_async_to_generator(function(e,t,r,c){var d,h,_,y;var f=arguments;return _ts_generator(this,function(p){switch(p.label){case 0:d=f.length>4&&void 0!==f[4]?f[4]:es.Retries;p.label=1;case 1:p.trys.push([1,3,,4]);h=_object_spread_props(_object_spread({},ec(),r),{method:"POST"}),_=el(c,e,h,t);return[4,eu(_,d)];case 2:return[2,p.sent()];case 3:y=p.sent();return[2,(console.warn("Post error",y),{})];case 4:return[2]}})});return function(t,r,c,d){return e.apply(this,arguments)}}(),"post"),e_=r.Configs,ey=e_.Notification,ef=ey.ApiUrl,ep=r.Utils,ev=ep.Object,eg=l(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!ev.hasOwn(e,"playerId"))throw new Error("Missing playerId");t=e.playerId;return[4,eh("players/".concat(t),e,{},ef,10)];case 1:r.sent();return[2]}})});return function(t){return e.apply(this,arguments)}}(),"updatePlayerProfileNotificationAsync");var em=function(e){return e.IDLE="idle",e.LOADING="loading",e.FILLED="filled",e.SHOWING="showing",e}(em||{});var eA=em;var ew=function(e){return e.BANNER="banner",e.INTERSTITIAL="interstitial",e.REWARDED_VIDEO="rewarded_video",e.REWARDED_INTERSTITIAL="rewarded_interstitial",e}(ew||{});var eI=ew;var eb=(e=/*#__PURE__*/function(e){_inherits(Ot,e);function Ot(e,t){_class_call_check(this,Ot);var r;r=_call_super(this,Ot,[t]);u(r,"code");r.code=e,r.message=t;return r}return Ot}(_wrap_native_super(Error)),l(e,"AdError"),e);var ek=/*#__PURE__*/function(){function Na(e,t){_class_call_check(this,Na);u(this,"type");u(this,"placementId");u(this,"_status");this.type=e,this._status=eA.IDLE,this.placementId=t}_create_class(Na,[{key:"setStatus",value:function setStatus(e){this._status!==e&&(this._status=e)}},{key:"status",get:function get(){return this._status}},{key:"exception",value:function exception(e){throw new eb("AD_INSTANCE_ERROR",e)}}]);return Na}();l(ek,"BaseInstance");var eS=ek,eD=(p=/*#__PURE__*/function(e){_inherits(Mt,e);function Mt(){_class_call_check(this,Mt);return _call_super(this,Mt,arguments)}_create_class(Mt,[{key:"loadAsync",value:function loadAsync(){this.exception("This method is not implemented")}},{key:"showAsync",value:function showAsync(){this.exception("This method is not implemented")}},{key:"hideAsync",value:function hideAsync(){this.exception("Unsupported method")}}]);return Mt}(eS),l(p,"AdInstance"),p);r.Plugins.Ads={Types:eI,Status:eA,AdError:eb,AdInstance:eD};var eP=r.Utils,eE=eP.Array,eC=eP.Object,ex=/*#__PURE__*/function(e){_inherits(La,e);function La(){_class_call_check(this,La);var e;e=_call_super(this,La,arguments);u(e,"enabled");u(e,"config");u(e,"lastCallAdShownTime");u(e,"isAdFullSizeShowed");u(e,"ads",{});u(e,"safeAreaBottom");return e}_create_class(La,[{key:"init",value:function init(){var e;this.lastCallAdShownTime=(e={},_define_property(e,eI.BANNER,0),_define_property(e,eI.INTERSTITIAL,0),_define_property(e,eI.REWARDED_VIDEO,0),_define_property(e,eI.REWARDED_INTERSTITIAL,0),e),this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}},{key:"calculateSafeAreaBottom",value:function calculateSafeAreaBottom(){try{var e=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=Number.parseInt(e,10),Number.isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch(e){this.safeAreaBottom=0}}},{key:"configure",value:function configure(e){this.config=e,this.enabled=this.config.Enabled}},{key:"checkEnabled",value:function checkEnabled(){if(!this.enabled)throw new eb("ADS_NOT_ENABLED","Ads is't enabled")}},{key:"isAdFullSizeShowing",value:function isAdFullSizeShowing(){return this.isAdFullSizeShowed}},{key:"setAdInstance",value:function setAdInstance(e,t,r){if(this.ads[t]){console.warn("AdsPlugin: Ad instance with placementId ".concat(t," already exists"));return}this.ads[t]={type:e,placementId:t,interval:null,instance:new r(e,t)}}},{key:"loadAdAsync",value:function loadAdAsync(e,t){var r=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:r.checkEnabled();return[4,r.getAd(e,t).instance.loadAsync()];case 1:c.sent();return[2]}})})()}},{key:"showAdAsync",value:function showAdAsync(e,t){var c=this;return _async_to_generator(function(){var d,h,_;return _ts_generator(this,function(y){switch(y.label){case 0:c.checkEnabled();d=c.game,h=d.event,_=c.getAd(e,t);c.lastCallAdShownTime[e]=window.performance.now()/1e3;y.label=1;case 1:y.trys.push([1,,3,4]);h.emit(r.Events.AD_SHOWING,{placementId:t}),c.isAdFullSizeShowed=!0;return[4,_.instance.showAsync()];case 2:y.sent();return[3,4];case 3:h.emit(r.Events.AD_CLOSED,{placementId:t}),c.isAdFullSizeShowed=!1;return[7];case 4:return[2]}})})()}},{key:"getAdStatus",value:function getAdStatus(e,t){return this.checkEnabled(),this.getAd(e,t).instance.status}},{key:"getAd",value:function getAd(e,t){var r=null;if(t?r=this.getAdByPlacementId(t):r=this.getPriorityAdByType(e),!r)throw new eb("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return r}},{key:"getAdsByType",value:function getAdsByType(e){return eC.vals(this.ads).filter(function(t){return t.type===e})}},{key:"getAdByPlacementId",value:function getAdByPlacementId(e){var t=this.ads[e];return t||null}},{key:"getPriorityAdByType",value:function getPriorityAdByType(e){var t=this.getAdsByType(e);if(!t.length)return null;var r=eE.search(t,function(t){return t.type===e});return r||null}},{key:"canbeShowInterstitialAd",value:function canbeShowInterstitialAd(e){return this.canbeShowInterstitialAdByTime(e)}},{key:"canbeShowInterstitialAdByTime",value:function canbeShowInterstitialAdByTime(e){try{var t=window.performance.now()/1e3;var r;if(e)r=this.getCommonAdConfig(e);else{var c=this.getPriorityAdByType(eI.INTERSTITIAL);if(!c)return!1;r=this.getCommonAdConfig(c.placementId)}var d=r.SecondsBetweenAds,h=r.SecondsFirstTime,_=t-this.lastCallAdShownTime[eI.INTERSTITIAL],y=_>d,f=_>h;return this.lastCallAdShownTime[eI.INTERSTITIAL]>0?y:f}catch(e){return console.warn("Error while checking canbeShowInterstitialAdByTime",e),!1}}},{key:"canbeShowBannerAd",value:function canbeShowBannerAd(e){try{var t=this.getBannerConfig(e),r=t.Platform;if("ALL"===r)return!0;var c=GameSDK.getPlatform();return!!c&&c===r}catch(e){return console.warn("Error while checking canbeShowBannerAd",e),!1}}},{key:"showBannerAdAsync",value:function showBannerAdAsync(e){var t=this;return _async_to_generator(function(){var c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:t.checkEnabled();c=t.getAd(eI.BANNER,e);if(!t.canbeShowBannerAd(c.placementId))throw new Error("Banner ad can not be shown");t.cleanBannerReloadTimer(c.placementId);return[4,c.instance.showAsync()];case 1:f.sent();d=t.game,h=d.event;if(h.emit(r.Events.AD_SHOWING,{placementId:e}),"MsGames"===GameSDK.getSDKName())return[2];_=t.getBannerConfig(c.placementId),y=_.SecondsReload;y<=0||(c.interval=setTimeout(function(){t.showBannerAdAsync(c.placementId)},1e3*y));return[2]}})})()}},{key:"hideBannerAdAsync",value:function hideBannerAdAsync(e){var t=this;return _async_to_generator(function(){var c,d,h;return _ts_generator(this,function(_){switch(_.label){case 0:t.checkEnabled();c=t.getAd(eI.BANNER,e);t.cleanBannerReloadTimer(c.placementId);return[4,c.instance.hideAsync()];case 1:_.sent();d=t.game,h=d.event;h.emit(r.Events.AD_CLOSED,{placementId:e});return[2]}})})()}},{key:"cleanBannerReloadTimer",value:function cleanBannerReloadTimer(e){try{var t=this.getAd(eI.BANNER,e),r=t.interval;if(!r)return;clearInterval(r)}catch(e){console.warn("Error while cleaning banner reload timer",e)}}},{key:"getCommonAdConfig",value:function getCommonAdConfig(e){var t=_to_consumable_array(this.config.InterstitialAdOptions).concat(_to_consumable_array(this.config.RewardedVideoAdOptions)),r=eE.search(t,function(t){return t.PlacementId===e});if(!r)throw new Error("Ad config with placementId ".concat(e," not found"));return r}},{key:"getBannerConfig",value:function getBannerConfig(e){var t=eE.search(this.config.BannerDisplayAdOptions,function(t){return t.PlacementId===e});if(!t)throw new Error("Banner config with placementId ".concat(e," not found"));return t}},{key:"getBannerHeight",value:function getBannerHeight(e,t,r){var c=!(arguments.length>2)||void 0===r||r;this.checkEnabled();var d=this.getBannerConfig(e),h=GameSDK.getBannerHeight(d);return c?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(h+this.safeAreaBottom)*t):h*t}},{key:"getSafeAreaBottom",value:function getSafeAreaBottom(e){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*e}}]);return La}(c.Plugins.BasePlugin);l(ex,"AdsPlugin");var eN=ex;var eT={ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",MESSAGE:"message",INVITE:"invite",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_SHOWING:"ad_showing",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GET_FREE_ITEM:"get_free_item",USE_ITEM:"use_item",EARN_ITEM:"earn_item"},eM=r.Utils,eL=eM.String,eO=eM.Valid;var eR=(v=/*#__PURE__*/function(){function Rt(e,t,r){_class_call_check(this,Rt);u(this,"game");u(this,"name");u(this,"color");u(this,"options");u(this,"selfLog");u(this,"currentPath");this.game=e,this.name=t,this.options=r,this.color=r.color||"#FFF",this.selfLog=r.log,this.currentPath="/",console.info("%c".concat(this.name,": init"),"color: ".concat(this.color),this.options)}_create_class(Rt,[{key:"event",value:function event(e,t){this.logInfo("event",{name:e,payload:t});var r=this.formatEventName(e);this.processEvent(r,t)}},{key:"logInfo",value:function logInfo(e,t){this.selfLog&&console.info("%c".concat(this.name,": ").concat(e),"color: ".concat(this.color),t)}},{key:"pageview",value:function pageview(e){var t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),document.title=t,this.event(eT.PAGE_VIEW,{path_path:e,page_title:t})}},{key:"levelStart",value:function levelStart(e,t,r){this.event(eT.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e),game_mode:r?eL.toUpperCamelCase(r):void 0})}},{key:"levelFail",value:function levelFail(e,t,r){this.event(eT.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e),game_mode:r?eL.toUpperCamelCase(r):void 0})}},{key:"levelRescue",value:function levelRescue(e,t,r){this.event(eT.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e),game_mode:r?eL.toUpperCamelCase(r):void 0})}},{key:"levelComplete",value:function levelComplete(e,t,r){this.event(eT.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e),game_mode:r?eL.toUpperCamelCase(r):void 0})}},{key:"loadAdEvent",value:function loadAdEvent(e,t){this.event(eT.AD_LOAD,{ad_type:e,screen_name:t})}},{key:"showAdEvent",value:function showAdEvent(e,t){this.event(eT.AD_SHOW,{ad_type:e,screen_name:t})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}},{key:"showInterstitialAd",value:function showInterstitialAd(e){this.showAdEvent("interstitial",e)}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}},{key:"receiveVideoReward",value:function receiveVideoReward(e){this.event(eT.AD_REWARD,{screen_name:e})}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(e){this.loadAdEvent("rewarded_interstitial",e)}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(e){this.showAdEvent("rewarded_interstitial",e)}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(e){this.event(eT.AD_REWARD,{screen_name:e})}},{key:"loadAdFail",value:function loadAdFail(e,t){this.event(eT.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}},{key:"showAdFail",value:function showAdFail(e,t){this.event(eT.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}},{key:"showingAd",value:function showingAd(e,t){this.event(eT.AD_SHOWING,{ad_type:e,screen_name:t})}},{key:"formatEventName",value:function formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(eL.padStart(e.toString(),5,"0"))}},{key:"getPageTitle",value:function getPageTitle(e){var t=e.split("/").pop();if(!eO.isString(t))return e;var r=t.replace(/([-_\s.])/g," $1");return eL.toUpperCamelCase(r)}},{key:"addGameModeToPageTitle",value:function addGameModeToPageTitle(e){var t=this.game,r=t.match,c=r.getMatchState();var d=c.mode;return d||(d="Normal"),"".concat(eL.toUpperCamelCase(d),"::").concat(e)}}]);return Rt}(),l(v,"BaseAnalytics"),v);r.Plugins.Analytics={Events:eT,BaseAnalytics:eR};var eG=/*#__PURE__*/function(e){_inherits(Ta,e);function Ta(){_class_call_check(this,Ta);var e;e=_call_super(this,Ta,arguments);u(e,"analytics",[]);u(e,"placement","unknown");u(e,"pageview",l(function(t){if(!e.isActive())return;e.placement=t;var r=e.getPageByKey(t);var c=true,d=false,h=void 0;try{for(var _=e.analytics[Symbol.iterator](),y;!(c=(y=_.next()).done);c=true){var f=y.value;f.pageview(r)}}catch(e){d=true;h=e}finally{try{if(!c&&null!=_.return)_.return()}finally{if(d)throw h}}},"pageview"));return e}_create_class(Ta,[{key:"add",value:function add(e){this.analytics.some(function(t){return t.name===e.name})||this.analytics.push(e)}},{key:"isActive",value:function isActive(){return this.analytics.length>=1}},{key:"event",value:function event(e,t){var r=true,c=false,d=void 0;if(this.isActive())try{for(var h=this.analytics[Symbol.iterator](),_;!(r=(_=h.next()).done);r=true){var y=_.value;y.event(e,t)}}catch(e){c=true;d=e}finally{try{if(!r&&null!=h.return)h.return()}finally{if(c)throw d}}}},{key:"levelStart",value:function levelStart(e,t,r){var c=true,d=false,h=void 0;if(this.isActive())try{for(var _=this.analytics[Symbol.iterator](),y;!(c=(y=_.next()).done);c=true){var f=y.value;f.levelStart(e,t,r)}}catch(e){d=true;h=e}finally{try{if(!c&&null!=_.return)_.return()}finally{if(d)throw h}}}},{key:"levelRescue",value:function levelRescue(e,t,r){var c=true,d=false,h=void 0;if(this.isActive())try{for(var _=this.analytics[Symbol.iterator](),y;!(c=(y=_.next()).done);c=true){var f=y.value;f.levelRescue(e,t,r)}}catch(e){d=true;h=e}finally{try{if(!c&&null!=_.return)_.return()}finally{if(d)throw h}}}},{key:"levelFail",value:function levelFail(e,t,r){var c=true,d=false,h=void 0;if(this.isActive())try{for(var _=this.analytics[Symbol.iterator](),y;!(c=(y=_.next()).done);c=true){var f=y.value;f.levelFail(e,t,r)}}catch(e){d=true;h=e}finally{try{if(!c&&null!=_.return)_.return()}finally{if(d)throw h}}}},{key:"levelComplete",value:function levelComplete(e,t,r){var c=true,d=false,h=void 0;if(this.isActive())try{for(var _=this.analytics[Symbol.iterator](),y;!(c=(y=_.next()).done);c=true){var f=y.value;f.levelComplete(e,t,r)}}catch(e){d=true;h=e}finally{try{if(!c&&null!=_.return)_.return()}finally{if(d)throw h}}}},{key:"loadInterstitialAd",value:function loadInterstitialAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;h.loadInterstitialAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"showInterstitialAd",value:function showInterstitialAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;h.showInterstitialAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;h.loadRewardedVideoAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;h.showRewardedVideoAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"receiveVideoReward",value:function receiveVideoReward(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;h.receiveVideoReward(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;h.loadRewardedInterstitialAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;h.showRewardedInterstitialAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;h.receiveInterstitialReward(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"loadAdFail",value:function loadAdFail(e){var t=true,r=false,c=void 0;if(this.isActive())try{for(var d=this.analytics[Symbol.iterator](),h;!(t=(h=d.next()).done);t=true){var _=h.value;_.loadAdFail(e,this.placement)}}catch(e){r=true;c=e}finally{try{if(!t&&null!=d.return)d.return()}finally{if(r)throw c}}}},{key:"showAdFail",value:function showAdFail(e){var t=true,r=false,c=void 0;if(this.isActive())try{for(var d=this.analytics[Symbol.iterator](),h;!(t=(h=d.next()).done);t=true){var _=h.value;_.showAdFail(e,this.placement)}}catch(e){r=true;c=e}finally{try{if(!t&&null!=d.return)d.return()}finally{if(r)throw c}}}},{key:"showingAd",value:function showingAd(e){var t=true,r=false,c=void 0;if(this.isActive())try{for(var d=this.analytics[Symbol.iterator](),h;!(t=(h=d.next()).done);t=true){var _=h.value;_.showingAd(e,this.placement)}}catch(e){r=true;c=e}finally{try{if(!t&&null!=d.return)d.return()}finally{if(r)throw c}}}},{key:"getPageByKey",value:function getPageByKey(e){var t=e;if(t.indexOf("_")>-1){var r=t.replace(/_/g,"-");return r.toLowerCase()}var c=t.length-1,d="";for(;c>0;){d=t.charAt(c);var h=Number.isNaN(Number.parseInt(d,10)),_=d===d.toUpperCase();h&&_&&(t="".concat(t.slice(0,c),"-").concat(t.slice(c))),c--}return t.toLowerCase()}}]);return Ta}(c.Plugins.BasePlugin);l(eG,"AnalyticsPlugin");var eF=eG;var eB=/*#__PURE__*/function(){function Ca(e){_class_call_check(this,Ca);u(this,"key");this.key=e}_create_class(Ca,[{key:"getKey",value:function getKey(){return this.key}}]);return Ca}();l(eB,"BaseAudioPlayer");var eV=eB;var ej=/*#__PURE__*/function(){function Oa(e){_class_call_check(this,Oa);u(this,"id");u(this,"isMuteAll");u(this,"masterVolume");u(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}_create_class(Oa,[{key:"getId",value:function getId(){return this.id}},{key:"getAudioClip",value:function getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}},{key:"setAudioClip",value:function setAudioClip(e,t){this.audioClips[e]=_object_spread({},this.audioClips[e],t)}},{key:"play",value:function play(e,t){var r=this;return _async_to_generator(function(){var c,d;return _ts_generator(this,function(h){switch(h.label){case 0:c=r.getAudioClip(e);if(!c)return[3,1];d=c.audioPlayer;r.playWithRealConfig(d,t);return[3,3];case 1:return[4,r.loadAndPlay(e,t)];case 2:h.sent();h.label=3;case 3:return[2]}})})()}},{key:"loadAndPlay",value:function loadAndPlay(e,t){var r=this;return _async_to_generator(function(){var c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,2,,3]);return[4,r.onLoadAudio(e,t)];case 1:c=f.sent(),d=t||{},h=d.volume,_=void 0===h?1:h;r.setAudioClip(e,{volume:_,audioPlayer:c}),r.playWithRealConfig(c,t);return[3,3];case 2:y=f.sent();console.warn("playAudio",y);return[3,3];case 3:return[2]}})})()}},{key:"playWithRealConfig",value:function playWithRealConfig(e,t){if(t){var r=t.volume,c=void 0===r?1:r;t.volume=this.masterVolume*c}e.play(t)}},{key:"pause",value:function pause(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.pause(),!0}},{key:"resume",value:function resume(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.resume(),!0}},{key:"stop",value:function stop(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.stop(),!0}},{key:"stopAll",value:function stopAll(){this.callAudioPlayers("stop")}},{key:"muteAll",value:function muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}},{key:"unmuteAll",value:function unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}},{key:"setVolume",value:function setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}},{key:"getVolume",value:function getVolume(){return this.masterVolume}},{key:"queueAudioPlayer",value:function queueAudioPlayer(e,t){try{var r=e.audioPlayer,c=e.volume,d=void 0===c?1:c;switch(t){case"play":r.play();break;case"pause":r.pause();break;case"resume":r.resume();break;case"stop":r.stop();break;case"mute":r.setVolume(0);break;case"unmute":case"setVolume":r.setVolume(this.masterVolume*d);break;default:throw new Error("Unsupported function: ".concat(t))}}catch(e){console.warn("queueAudioPlayer",e)}}},{key:"callAudioPlayers",value:function callAudioPlayers(e){var t=r.Utils,c=t.Object,d=c.vals(this.audioClips);var h=true,_=false,y=void 0;try{for(var f=d[Symbol.iterator](),p;!(h=(p=f.next()).done);h=true){var v=p.value;this.queueAudioPlayer(v,e)}}catch(e){_=true;y=e}finally{try{if(!h&&null!=f.return)f.return()}finally{if(_)throw y}}}}]);return Oa}();l(ej,"BaseChannelManager");var eU=ej;r.Plugins.Audio={BaseAudioPlayer:eV,BaseChannelManager:eU};var eH=/*#__PURE__*/function(e){_inherits(Ma,e);function Ma(){_class_call_check(this,Ma);var e;e=_call_super(this,Ma,arguments);u(e,"firstChannelId");u(e,"channels",{});return e}_create_class(Ma,[{key:"addChannel",value:function addChannel(e){var t=e.getId();this.channels[t]=e,this.firstChannelId||(this.firstChannelId=t)}},{key:"getChannel",value:function getChannel(e){if(void 0===e)return this.channels[this.firstChannelId];var t=this.channels[e];if(!t)throw new Error("Channel ".concat(e," not found"));return t}},{key:"play",value:function play(e,t,r){var c=this;return _async_to_generator(function(){var d;return _ts_generator(this,function(h){switch(h.label){case 0:h.trys.push([0,2,,3]);return[4,c.getChannel(r).play(e,t)];case 1:h.sent();return[3,3];case 2:d=h.sent();console.warn("playSound",d);return[3,3];case 3:return[2]}})})()}},{key:"pause",value:function pause(e,t){try{this.getChannel(t).pause(e)}catch(e){console.warn("pauseSound",e)}}},{key:"resume",value:function resume(e,t){try{this.getChannel(t).resume(e)}catch(e){console.warn("resumeSound",e)}}},{key:"stop",value:function stop(e,t){try{this.getChannel(t).stop(e)}catch(e){console.warn("stopSound",e)}}},{key:"stopAll",value:function stopAll(e){try{this.getChannel(e).stopAll()}catch(e){console.warn("stopAllSounds",e)}}},{key:"mute",value:function mute(e){try{this.getChannel(e).muteAll()}catch(e){console.warn("mute",e)}}},{key:"unmute",value:function unmute(e){try{this.getChannel(e).unmuteAll()}catch(e){console.warn("unmute",e)}}},{key:"setVolume",value:function setVolume(e,t){try{this.getChannel(t).setVolume(e)}catch(e){console.warn("setSoundVolume",e)}}},{key:"getVolume",value:function getVolume(e){try{return this.getChannel(e).getVolume()}catch(e){return console.warn("getSoundVolume",e),-1}}}]);return Ma}(c.Plugins.BasePlugin);l(eH,"AudioPlugin");var eK=eH;var eW={token:"",isRequesting:!1},ez=/*#__PURE__*/function(e){_inherits(Ra,e);function Ra(){_class_call_check(this,Ra);return _call_super(this,Ra,arguments)}_create_class(Ra,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("auth",eW)}},{key:"requestToken",value:function requestToken(){var e=this;return _async_to_generator(function(){var t,c,d,h;return _ts_generator(this,function(_){switch(_.label){case 0:t=e.game,c=t.storage;_.label=1;case 1:_.trys.push([1,3,4,5]);if(c.getStorageData("auth","isRequesting")||""!==c.getStorageData("auth","token"))return[2];c.setStorageData("auth","isRequesting",!0);return[4,GameSDK.player.getSignedPlayerInfoAsync()];case 2:d=_.sent().getSignature();c.setStorageData("auth","token",d);return[3,5];case 3:h=_.sent();if(r.Utils.Object.hasOwn(h,"code")&&"PENDING_REQUEST"===h.code)return[2];c.setStorageData("auth","token",""),console.error(h);return[3,5];case 4:c.setStorageData("auth","isRequesting",!1);return[7];case 5:return[2]}})})()}},{key:"getToken",value:function getToken(){var e=this.game,t=e.storage;return t.getStorageData("auth","token")}}]);return Ra}(c.Plugins.BasePlugin);l(ez,"AuthPlugin");var eq=ez;var eY=function(e){return e.SOLO="solo",e.TOURNAMENT="tournament",e.SHARE_INVITE="share_invite",e.MATCHING_GROUP="matching_group_match",e.CHALLENGE_FRIEND="challenge_friend_match",e}(eY||{});var eJ=eY,eQ=d,eX=r.Configs,eZ=r.Utils,e$=eZ.Array,e0=eZ.Valid,e2=eZ.Browser,e3=/*#__PURE__*/function(){function _a(e){_class_call_check(this,_a);u(this,"game");this.game=e}_create_class(_a,[{key:"isValidContextType",value:function isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}},{key:"isValidEntryPointData",value:function isValidEntryPointData(e){return e0.isObject(e)}},{key:"isTournamentEntryPoint",value:function isTournamentEntryPoint(e){return e$.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],e)}},{key:"receiveContext",value:function receiveContext(e,t,r){var c=this.game,d=c.storage;d.setStorageData("context","contextId",e),this.isValidEntryPointData(r)?d.setStorageData("context","entryPointData",r):console.warn("Invalid context type: ".concat(t)),this.isValidContextType(t)?d.setStorageData("context","contextType",t):console.warn("Invalid context type: ".concat(t))}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:t=e.game,r=t.storage,c=r.getStorageData("context","entryPointData"),d=c.type,h=eJ.SOLO,_=eJ.TOURNAMENT,y=eJ.MATCHING_GROUP,f=eJ.SHARE_INVITE,p=eJ.CHALLENGE_FRIEND;v=h;if(d===_&&(v=_),d===y&&(v=y),(d===p||d===f)&&(v=p),v!==h)return[3,6];g.label=1;case 1:g.trys.push([1,5,,6]);if(!eX.Core.FastCheckTournamentContext)return[3,2];v=e.fastCheckTournamentContext()||v;return[3,4];case 2:return[4,e.outdatedCheckTournamentContext()];case 3:v=g.sent()||v;g.label=4;case 4:return[3,6];case 5:g.sent();return[3,6];case 6:r.setStorageData("context","sessionContextType",v);return[2]}})})()}},{key:"fastCheckTournamentContext",value:function fastCheckTournamentContext(){var e=e2.getQueryParams().entry_point;return!!("string"==typeof e&&this.isTournamentEntryPoint(e))&&eJ.TOURNAMENT}},{key:"outdatedCheckTournamentContext",value:function outdatedCheckTournamentContext(){return _async_to_generator(function(){var e;return _ts_generator(this,function(t){switch(t.label){case 0:e="getTournamentAsync"in GameSDK;if(!e)return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:e=t.sent().getEndTime()>Date.now()/1e3;t.label=2;case 2:return[2,!!e&&eJ.TOURNAMENT]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){var e=this.game,t=e.player,r=e.storage,c=r.getStorageData("context","entryPointData"),d=r.getStorageData("context","sessionContextType"),h=t.getPlayerId(),_=c.matchId,y=c.playerId,f=c.opponentId,p=void 0===f?G.playerId:f,v=h===y,g=p===G.playerId||[p,y].indexOf(h)>=0,m=eJ.TOURNAMENT,A=eJ.MATCHING_GROUP,w=eJ.SHARE_INVITE,I=eJ.CHALLENGE_FRIEND;var b=eQ.SINGLE;d===m&&(b=eQ.TOURNAMENT),d!==w||v||(b=eQ.CHALLENGE_FRIEND),d===I&&_&&g&&(b=eQ.CHALLENGE_FRIEND),d===A&&(b=eQ.MATCHING_GROUP),r.setStorageData("context","contextGameMode",b)}}]);return _a}();l(e3,"Context");var e1=e3;var e4=/*#__PURE__*/function(e){_inherits($a,e);function $a(e){_class_call_check(this,$a);var t;t=_call_super(this,$a,[e]),t.name="PlayerHasFinishedMatch",t.message=null!=e?e:"Player has finished match";return t}return $a}(_wrap_native_super(Error));l(e4,"PlayerHasFinishedMatch");var e5=e4;var e7=/*#__PURE__*/function(e){_inherits(Ga,e);function Ga(e){_class_call_check(this,Ga);var t;t=_call_super(this,Ga,[e]),t.name="PlayerNotJoinInMatch",t.message=e||"Player is not join in match";return t}return Ga}(_wrap_native_super(Error));l(e7,"PlayerNotJoinInMatch");var e6=e7;var e8=r.Events,e9=r.Plugins,te=e9.Analytics,tt=/*#__PURE__*/function(){function Va(e){_class_call_check(this,Va);u(this,"game");this.game=e}_create_class(Va,[{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y,f,p,v,g,m,A,w,I,b,k,S,D,P;return _ts_generator(this,function(E){switch(E.label){case 0:t=e.game,r=t.player,c=t.storage,d=t.monitorError,h=c.getStorageData("context","contextId"),_=c.getStorageData("context","entryPointData"),y=c.getStorageData("context","sessionContextType"),f=_||{},p=f.type,v=f.matchId,g=f.playerId,m=f.opponentId,A=f.playerScore,w=f.action;I=w;if(!I)return[3,2];return[4,e.processEntryPointAction(w)];case 1:I=E.sent();E.label=2;case 2:b=r.isFirstLogin();setTimeout(function(){e.logUserAnalytics(b)},1e3);k=eJ.TOURNAMENT,S=eJ.SHARE_INVITE,D=eJ.MATCHING_GROUP,P=eJ.CHALLENGE_FRIEND;if(y!==k)return[3,6];E.label=3;case 3:E.trys.push([3,5,,6]);return[4,e.processTournamentModeAsync(h)];case 4:E.sent();return[2];case 5:E.sent();null==d||d.sendException(new Error("Process Tournament Fail"),{contextId:h,isFirstLogin:b,entryPointData:_,playerData:r.getPlayerData()});return[3,6];case 6:if(y!==P)return[3,10];if(!(p===S&&"string"==typeof g))return[3,8];return[4,e.processChallengeFromPostAsync(g)];case 7:E.sent();return[2];case 8:if(!(p===P&&"string"==typeof v&&"string"==typeof g&&"string"==typeof m))return[3,10];return[4,e.processChallengeFromMessageAsync({contextId:h,matchId:v,playerId:g,opponentId:m})];case 9:E.sent();return[2];case 10:if(!(y===D&&"string"==typeof g&&"number"==typeof A))return[3,12];return[4,e.processMatchingGroupModeAsync(g,A)];case 11:E.sent();return[2];case 12:if(!b)return[3,14];return[4,e.processSingleModeAsync(!0)];case 13:E.sent(),r.loggedIn();return[2];case 14:e.switchToDashboardScene();return[2]}})})()}},{key:"logUserAnalytics",value:function logUserAnalytics(e){try{var t=this.game,r=t.player,c=t.analytics;if(e)c.event(te.Events.NEW_USER);else{var d=r.getPlayerData().gameData,h=d.coins;c.event(te.Events.RETURNING_USER,{coins:h})}}catch(e){}}},{key:"processEntryPointAction",value:function processEntryPointAction(e){var t=this;return _async_to_generator(function(){var r,c,d;return _ts_generator(this,function(h){switch(h.label){case 0:h.trys.push([0,7,,8]);r=t.game,c=r.player;switch(e){case"reset_data":return[3,1];case"enable_debug":return[3,3];case"set_locale_en":return[3,4];case"set_locale_ru":return[3,5]}return[3,6];case 1:c.setPlayerDataByName("score",0),c.setPlayerDataByName("endlessScore",0),c.setGameData({coins:0,level:1});return[4,c.syncProfileToServer()];case 2:h.sent();return[3,6];case 3:c.setPlayerDataByName("debug",!0);return[3,6];case 4:t.requestSetLocale("en");return[3,6];case 5:t.requestSetLocale("ru");return[3,6];case 6:return[3,8];case 7:d=h.sent();console.warn("processEntryPointAction",d);return[3,8];case 8:return[2]}})})()}},{key:"requestSetLocale",value:function requestSetLocale(e){var t=this.game,r=t.event;r.emit(e8.REQUEST_LANGUAGE,{locale:e})}},{key:"processTournamentModeAsync",value:function processTournamentModeAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h;return _ts_generator(this,function(_){switch(_.label){case 0:r=t.game,c=r.match,d=r.player,h=d.getPlayerId();if("string"!=typeof e)throw new Error("Cannot get contextId");return[4,c.tournament.continue.processAsync({playerId:h,contextId:e})];case 1:_.sent(),t.switchToGameScene();return[2]}})})()}},{key:"processChallengeFromPostAsync",value:function processChallengeFromPostAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_;return _ts_generator(this,function(y){switch(y.label){case 0:r=t.game,c=r.match,d=r.player,h=d.getPlayerId();if(h!==e)return[3,2];return[4,c.single.start.processAsync({playerId:h})];case 1:y.sent();return[3,6];case 2:y.trys.push([2,4,,6]);return[4,c.challenge.friend.processAsync({playerId:h,opponentId:e})];case 3:y.sent();return[3,6];case 4:_=y.sent();console.warn("processChallengeFromPostAsync",_);return[4,c.single.start.processAsync({playerId:h})];case 5:y.sent();return[3,6];case 6:t.switchToGameScene();return[2]}})})()}},{key:"processChallengeFromMessageAsync",value:function processChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,7]);return[4,t.processContinueChallengeFromMessageAsync(e)];case 1:c.sent();return[3,7];case 2:r=c.sent();if(console.warn("processContinueChallengeFromMessageAsync",r),!_instanceof(r,e5))return[3,4];return[4,t.processAwaitChallengeFromMessageAsync(e)];case 3:c.sent();return[2];case 4:if(!_instanceof(r,e6))return[3,6];return[4,t.processJoinChallengeFromMessageAsync(e)];case 5:c.sent();return[2];case 6:t.switchToDashboardScene();return[3,7];case 7:return[2]}})})()}},{key:"processContinueChallengeFromMessageAsync",value:function processContinueChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:r=e.contextId,c=e.matchId,d=e.playerId,h=e.opponentId,_=t.game,y=_.match,f=_.player,p=f.getPlayerId();if(d!==p)return[3,2];return[4,y.challenge.continue.processAsync({contextId:r,matchId:c,playerId:p,opponentId:h})];case 1:g.sent();return[3,4];case 2:v=h===G.playerId;return[4,y.challenge.continue.processAsync({contextId:r,matchId:c,playerId:p,opponentId:v?h:d})];case 3:g.sent();g.label=4;case 4:t.switchToGameScene();return[2]}})})()}},{key:"processJoinChallengeFromMessageAsync",value:function processJoinChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:r=e.contextId,c=e.matchId,d=e.playerId,h=t.game,_=h.match,y=h.player,f=y.getPlayerId();return[4,_.challenge.join.processAsync({contextId:r,matchId:c,playerId:f,opponentId:d})];case 1:p.sent(),t.switchToGameScene();return[2]}})})()}},{key:"processAwaitChallengeFromMessageAsync",value:function processAwaitChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.contextId,c=e.matchId,d=e.playerId,h=t.game,_=h.match,y=h.player,f=y.getPlayerId();v.label=1;case 1:v.trys.push([1,3,,5]);return[4,_.challenge.await.processAsync({contextId:r,matchId:c,playerId:f,opponentId:d})];case 2:v.sent(),t.switchToChallengeResultScene();return[3,5];case 3:p=v.sent();console.warn("processAwaitChallengeFromMessageAsync",p);return[4,t.processResultChallengeFromMessageAsync(e)];case 4:v.sent();return[3,5];case 5:return[2]}})})()}},{key:"processResultChallengeFromMessageAsync",value:function processResultChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:r=e.contextId,c=e.matchId,d=e.playerId,h=t.game,_=h.match,y=h.player,f=y.getPlayerId();p.label=1;case 1:p.trys.push([1,3,,4]);return[4,_.challenge.result.processAsync({contextId:r,matchId:c,playerId:f,opponentId:d})];case 2:p.sent(),t.switchToChallengeResultScene();return[3,4];case 3:p.sent();t.switchToDashboardScene();return[3,4];case 4:return[2]}})})()}},{key:"processMatchingGroupModeAsync",value:function processMatchingGroupModeAsync(e,t){var r=this;return _async_to_generator(function(){var c,d,h;return _ts_generator(this,function(_){switch(_.label){case 0:c=r.game,d=c.match,h=c.player;return[4,d.group.join.processAsync({playerId:h.getPlayerId(),opponentId:e,opponentScore:t})];case 1:_.sent(),r.switchToGameScene();return[2]}})})()}},{key:"processSingleModeAsync",value:function processSingleModeAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_;return _ts_generator(this,function(y){switch(y.label){case 0:r=t.game,c=r.match,d=r.player,h=d.getPlayerId();_=e;if(!_)return[3,2];return[4,c.handler.setMatchCustomData({level:0})];case 1:_=y.sent();y.label=2;case 2:return[4,c.single.start.processAsync({playerId:h})];case 3:y.sent(),t.switchToGameScene();return[2]}})})()}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){var e=this.game,t=e.event;t.emit(e8.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}},{key:"switchToGameScene",value:function switchToGameScene(){var e=this.game,t=e.event;t.emit(e8.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}},{key:"switchToChallengeResultScene",value:function switchToChallengeResultScene(){var e=this.game,t=e.event;t.emit(e8.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}}]);return Va}();l(tt,"Loader");var ta=tt;var tr={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},ts=r.Events,tc=/*#__PURE__*/function(e){_inherits(ka,e);function ka(e){_class_call_check(this,ka);var t;t=_call_super(this,ka,[e]);u(t,"context");u(t,"loader");t.loader=new ta(e),t.context=new e1(e);return t}_create_class(ka,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("context",tr)}},{key:"getSessionContextTypes",value:function getSessionContextTypes(){return eJ}},{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.loader.processContextData()];case 1:r.sent();return[3,3];case 2:t=r.sent();console.error("processContextData",t),e.switchToDashboardScene();return[3,3];case 3:return[2]}})})()}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.context.detectContextSessionType()];case 1:r.sent();return[3,3];case 2:t=r.sent();console.error("detectContextSessionType",t);return[3,3];case 3:return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){this.context.detectContextGameMode()}},{key:"receiveContext",value:function receiveContext(e,t,r){this.context.receiveContext(e,t,r)}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){var e=this.game,t=e.event;t.emit(ts.SWITCH_SCENE,{sceneName:"DashboardScene"})}}]);return ka}(c.Plugins.BasePlugin);l(tc,"ContextPlugin");var tl=tc;var tu=r.Utils,td=tu.Valid,th=tr.contextId,t_=tr.contextType,ty=tr.entryPointData,tf="is invalid",tp=/*#__PURE__*/function(e){_inherits(Ua,e);function Ua(){_class_call_check(this,Ua);var e;e=_call_super(this,Ua,arguments);u(e,"data");return e}_create_class(Ua,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateContextId",value:function validateContextId(e){td.isString(e)||this.exception("contextId",tf)}},{key:"validateContextType",value:function validateContextType(e){td.isString(e)&&e||this.exception("contextType",tf)}},{key:"validateEntryPointData",value:function validateEntryPointData(e){td.isObject(e)||this.exception("entryPointData",tf)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ua.prototype),"toObject",this).call(this)}}]);return Ua}(S);l(tp,"ContextInfoDtos");var tv=tp;tv.addDefaultData({contextId:th,contextType:t_,entryPointData:ty}),r.Dtos.Context={Info:tv};var tg={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},tm=r.Utils,tA=tm.Object,tw=/*#__PURE__*/function(){function Fa(){_class_call_check(this,Fa)}_create_class(Fa,[{key:"getDailyRewardsAsync",value:function getDailyRewardsAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,tA.vals(tg)]})})()}}]);return Fa}();l(tw,"DailyRewardsAPI");var tI=tw;var tb={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},tk={dailyRewards:{}},tS=r.Configs.DailyRewards,tD=/*#__PURE__*/function(e){_inherits(Ba,e);function Ba(){_class_call_check(this,Ba);var e;e=_call_super(this,Ba,arguments);u(e,"dailyRewardsApi",new tI);return e}_create_class(Ba,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("dailyRewards",tk)}},{key:"requestDailyRewardsAsync",value:function requestDailyRewardsAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,e.dailyRewardsApi.getDailyRewardsAsync()];case 1:t=r.sent();0!==t.length&&e.receiveDailyRewards(t);return[2]}})})()}},{key:"getDailyRewards",value:function getDailyRewards(){var e=this.game,t=e.storage,r=t.getStorageData("dailyRewards","dailyRewards");return r||null}},{key:"logLoginReward",value:function logLoginReward(){var e=this.game,t=e.player,r=t.getPlayerData().dailyRewarded,c=r.logDays,d=_to_consumable_array(c);d[d.length-1]=!0,this.logDailyRewards(d)}},{key:"logDailyRewards",value:function logDailyRewards(e,t){var r=arguments.length>1&&void 0!==t&&t;var c=this.game,d=c.player;d.setPlayerDataByName("dailyRewarded",{logDays:e,lastRewarded:r?0:Date.now()})}},{key:"receiveDailyRewards",value:function receiveDailyRewards(e){var t=this.game,r=t.player,c=r.getPlayerData().dailyRewarded,d=c.logDays,h=c.lastRewarded,_=new Date,y=new Date(h),f=new Date(y.toDateString()),p=Math.abs(_.valueOf()-f.valueOf()),v=Math.floor(p/864e5)>1,g=tS.CheckInterrupt&&v||d.length>=tS.MaxDays,m=g?[!1]:_to_consumable_array(d).concat([!1]);this.logDailyRewards(m);var A=e.map(function(e,t){var r=t<m.length,c=m.length===t+1,d=!1===m[t];var h=tb.WAITING;return c?h=tb.READY:g?h=tb.WAITING:r&&d?h=tb.SKIPPED:r&&(h=tb.REWARDED),_object_spread_props(_object_spread({},e),{status:h})});this.setDailyRewards(A)}},{key:"setDailyRewards",value:function setDailyRewards(e){var t=this.game,r=t.storage;r.setStorageData("dailyRewards","dailyRewards",e)}}]);return Ba}(c.Plugins.BasePlugin);l(tD,"DailyRewardsPlugin");var tP=tD;var tE={exports:{}};tE.exports,function(e){var t=Object.prototype.hasOwnProperty,r="~";function s(){}l(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}l(a,"EE");function n(e,t,c,d,h){if("function"!=typeof c)throw new TypeError("The listener must be a function");var _=new a(c,d||e,h),y=r?r+t:t;return e._events[y]?e._events[y].fn?e._events[y]=[e._events[y],_]:e._events[y].push(_):(e._events[y]=_,e._eventsCount++),e}l(n,"addListener");function i(e,t){0===--e._eventsCount?e._events=new s:delete e._events[t]}l(i,"clearEvent");function o(){this._events=new s,this._eventsCount=0}l(o,"EventEmitter"),o.prototype.eventNames=l(function(){var e=[],c,d;if(0===this._eventsCount)return e;for(d in c=this._events)t.call(c,d)&&e.push(r?d.slice(1):d);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(c)):e},"eventNames"),o.prototype.listeners=l(function(e){var t=r?r+e:e,c=this._events[t];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,h=c.length,_=new Array(h);d<h;d++)_[d]=c[d].fn;return _},"listeners"),o.prototype.listenerCount=l(function(e){var t=r?r+e:e,c=this._events[t];return c?c.fn?1:c.length:0},"listenerCount"),o.prototype.emit=l(function(e,t,c,d,h,_){var y=r?r+e:e;if(!this._events[y])return!1;var f=this._events[y],p=arguments.length,v,g;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),p){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,c),!0;case 4:return f.fn.call(f.context,t,c,d),!0;case 5:return f.fn.call(f.context,t,c,d,h),!0;case 6:return f.fn.call(f.context,t,c,d,h,_),!0}for(g=1,v=new Array(p-1);g<p;g++)v[g-1]=arguments[g];f.fn.apply(f.context,v)}else{var m=f.length,A;for(g=0;g<m;g++)switch(f[g].once&&this.removeListener(e,f[g].fn,void 0,!0),p){case 1:f[g].fn.call(f[g].context);break;case 2:f[g].fn.call(f[g].context,t);break;case 3:f[g].fn.call(f[g].context,t,c);break;case 4:f[g].fn.call(f[g].context,t,c,d);break;default:if(!v)for(A=1,v=new Array(p-1);A<p;A++)v[A-1]=arguments[A];f[g].fn.apply(f[g].context,v)}}return!0},"emit"),o.prototype.on=l(function(e,t,r){return n(this,e,t,r,!1)},"on"),o.prototype.once=l(function(e,t,r){return n(this,e,t,r,!0)},"once"),o.prototype.removeListener=l(function(e,t,c,d){var h=r?r+e:e;if(!this._events[h])return this;if(!t)return i(this,h),this;var _=this._events[h];if(_.fn)_.fn!==t||d&&!_.once||c&&_.context!==c||i(this,h);else{for(var y=0,f=[],p=_.length;y<p;y++)(_[y].fn!==t||d&&!_[y].once||c&&_[y].context!==c)&&f.push(_[y]);f.length?this._events[h]=1===f.length?f[0]:f:i(this,h)}return this},"removeListener"),o.prototype.removeAllListeners=l(function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(tE);var tC=tE.exports;var tx=f(tC),tN=new tx,tT={names:[],history:[]},tM=/*#__PURE__*/function(e){_inherits(ja,e);function ja(){_class_call_check(this,ja);var e;e=_call_super(this,ja,arguments);u(e,"enableLog",!1);u(e,"muteEvents",[]);return e}_create_class(ja,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("event",tT)}},{key:"enableLogEvent",value:function enableLogEvent(){this.enableLog=!0}},{key:"on",value:function on(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"on","listening"),tN.on(e,t)}},{key:"once",value:function once(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"once","listening"),tN.once(e,t)}},{key:"catchUp",value:function catchUp(e,t){if(this.validateCallback(t),this.once(e,t),!(this.getEventEmitCount(e)>0))return;var r;var c=null!==(r=this.getLastEventInfo(e))&&void 0!==r?r:{},d=c.payload;this.emit(e,d)}},{key:"off",value:function off(e,t){this.validateCallback(t),tN.off(e,t),this.addHistory(e,"action","removed")}},{key:"mute",value:function mute(e){this.muteEvents.indexOf(e)>-1||this.muteEvents.push(e)}},{key:"clear",value:function clear(e){tN.removeAllListeners(e),this.addHistory(e,"action","removed")}},{key:"emit",value:function emit(e,t){var r;if(this.muteEvents.indexOf(e)>-1)return;var c=[];t&&(c=[t]),this.addHistory(e,"action","called",t),(r=tN).emit.apply(r,[e].concat(_to_consumable_array(c)))}},{key:"validateCallback",value:function validateCallback(e){if("function"!=typeof e)throw new Error("Callback must be a function")}},{key:"addEventName",value:function addEventName(e){var t=this.game,r=t.storage,c=r.getStorageData("event","names");c.indexOf(e)<0&&c.push(e)}},{key:"getEventListeners",value:function getEventListeners(){var e=tN.eventNames();return Object.keys(e)}},{key:"getHistory",value:function getHistory(){var e=this.game,t=e.storage;return t.getStorageData("event","history")}},{key:"getEventEmitCount",value:function getEventEmitCount(e){return this.getHistory().filter(function(t){return t.name===e&&"called"===t.status}).length}},{key:"getLastEventInfo",value:function getLastEventInfo(e){var t=this.getHistory();var r=null;for(var c=t.length-1;c>=0;c--)if(t[c].name===e){r=t[c];break}return r}},{key:"getTypeFromHistory",value:function getTypeFromHistory(e){var t=this.getLastEventInfo(e);var r;return null!==(r=null==t?void 0:t.type)&&void 0!==r?r:null}},{key:"getCallsFromHistory",value:function getCallsFromHistory(e){var t=this.getLastEventInfo(e);var r;return null!==(r=null==t?void 0:t.called)&&void 0!==r?r:0}},{key:"addHistory",value:function addHistory(e,t,r,c){var d;var h=null!==(d=this.getTypeFromHistory(e))&&void 0!==d?d:t,_=this.getCallsFromHistory(e),y="called"===r?_+1:_;this.getHistory().push({type:h,status:r,name:e,called:y,payload:null!=c?c:{}}),this.logEventInfo(e,h,r,y)}},{key:"logEventInfo",value:function logEventInfo(e,t,r,c){if(this.enableLog){if("listening"===r){console.info("Event (".concat(t,") ").concat(e,": ").concat(r));var d=tN.listenerCount(e);d>1&&console.warn("Event ".concat(e," has ").concat(d," listener"))}else"action"!==t&&console.info("Event (".concat(t,") ").concat(e,": ").concat(r," (").concat(c," times)"));"called"===r&&tN.listenerCount(e)<=0&&console.warn("Event ".concat(e," is called but not listening"))}}}]);return ja}(c.Plugins.BasePlugin);l(tM,"EventPlugin");var tL=tM;var tO={},tR=Object.freeze(Object.defineProperty({__proto__:null,default:tO},Symbol.toStringTag,{value:"Module"})),tG=/*#__PURE__*/function(e){_inherits(Ka,e);function Ka(e,t){_class_call_check(this,Ka);var r;var c=String(e);r=_call_super(this,Ka,['Text with key "'.concat(c,'" not found in locale "').concat(t,'"')]);u(r,"key");u(r,"locale");r.name="MissingKeyInLocaleError",r.key=c,r.locale=t;return r}return Ka}(_wrap_native_super(Error));l(tG,"MissingKeyInLocaleError");var tF=tG;var tB=/*#__PURE__*/function(e){_inherits(Wa,e);function Wa(e){_class_call_check(this,Wa);var t;t=_call_super(this,Wa,['Locale "'.concat(e,'" not found')]);u(t,"locale");t.name="LocaleNotFoundError",t.locale=e;return t}return Wa}(_wrap_native_super(Error));l(tB,"LocaleNotFoundError");var tV=tB;var tj=r.Utils,tU=tj.Object,tH=tj.Function,tK=/*#__PURE__*/function(e){_inherits(za,e);function za(){_class_call_check(this,za);var e;e=_call_super(this,za,arguments);u(e,"locale");u(e,"fallbackLocale");u(e,"data",{});return e}_create_class(za,[{key:"setFallbackLocale",value:function setFallbackLocale(e){this.fallbackLocale=e}},{key:"hasTextKey",value:function hasTextKey(e,t){var r=null!=t?t:this.getCurrentLocale(),c=this.getLocaleData(r),d=c.text;return tU.hasOwn(d,e)}},{key:"hasTextureKey",value:function hasTextureKey(e,t){var r=null!=t?t:this.getCurrentLocale(),c=this.getLocaleData(r),d=c.texture;return tU.hasOwn(d,e)}},{key:"add",value:function add(e,t,r){var c=arguments.length>2&&void 0!==r&&r;this.data[e]=t,c&&this.setFallbackLocale(e)}},{key:"choose",value:function choose(e){this.locale=e;var t=this.game,c=t.event;c.emit(r.Events.LANGUAGE_CHANGED,{locale:e})}},{key:"getText",value:function getText(e,t,r,c){var d=arguments.length>3&&void 0!==c&&c;try{return this.uncaughtGetText(e,t,r,!d)}catch(t){return _instanceof(t,tF)||_instanceof(t,tV)?console.warn(t.message):console.error(t),String(e)}}},{key:"getTexture",value:function getTexture(e,t,r){var c=arguments.length>2&&void 0!==r&&r;return this.uncaughtGetTexture(e,t,!c)}},{key:"uncaughtGetText",value:function uncaughtGetText(e,t,r,c){var d=this;var h=arguments.length>1&&void 0!==t?t:[],_=arguments.length>2?r:void 0,y=!(arguments.length>3)||void 0===c||c;if(!y||void 0===this.fallbackLocale){var f=this.getRawText(e,null!=_?_:this.getCurrentLocale());return this.replaceVariables(f,h)}var p=this.fallbackLocale,v=tH.retry(function(){return d.getRawText(e,null!=_?_:d.getCurrentLocale())},function(){return d.getRawText(e,p)});return this.replaceVariables(v,h)}},{key:"getRawText",value:function getRawText(e,t){if(!this.hasTextKey(e,t))throw new tF(e,t);var r=this.getLocaleData(t),c=r.text;return c[e]}},{key:"uncaughtGetTexture",value:function uncaughtGetTexture(e,t,r){var c=this;var d=!(arguments.length>2)||void 0===r||r;if(!d||void 0===this.fallbackLocale)return this.getRawTexture(e,null!=t?t:this.getCurrentLocale());var h=this.fallbackLocale;return tH.retry(function(){return c.getRawTexture(e,null!=t?t:c.getCurrentLocale())},function(){return c.getRawTexture(e,h)})}},{key:"getRawTexture",value:function getRawTexture(e,t){if(!this.hasTextureKey(e,t))throw new tF(e,t);var r=this.getLocaleData(t),c=r.texture;return c[e]}},{key:"getCurrentLocale",value:function getCurrentLocale(){var e;return null!==(e=this.locale)&&void 0!==e?e:"en"}},{key:"getLocaleData",value:function getLocaleData(e){var t=null!=e?e:this.getCurrentLocale();if(!tU.hasOwn(this.data,t))throw new tV(t);return this.data[t]}},{key:"replaceVariables",value:function replaceVariables(e,t){var r=t.length;if(0===r)return e;var c=e;for(var d=0;d<r;d++){var h=t[d],_="%{".concat(d,"}");c=c.replace(_,h)}return c}}]);return za}(c.Plugins.BasePlugin);l(tK,"LanguagePlugin");var tW=tK;var tz={_id:"",name:"",createdBy:"",description:"",expireTime:6048e5,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15},tq=r.Configs,tY=r.Utils,tJ=tY.Object,tQ=tY.String,tX=tY.Valid,tZ=tq.OtherHost,t$=tq.Mockup,t0=tq.AppId,t2=/*#__PURE__*/function(){function Ha(){_class_call_check(this,Ha);u(this,"mockAPI")}_create_class(Ha,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:if(e.mockAPI)return[2];return[4,h(/*#__PURE__*/_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:r=c.sent().default;if("function"!=typeof r)throw new Error("Cannot load LeaderboardAPIMock");e.mockAPI=new r;return[2]}})})()}},{key:"getLeadersAsync",value:function getLeadersAsync(e,t,r){var c=this;return _async_to_generator(function(){var d,h;return _ts_generator(this,function(_){switch(_.label){case 0:d=tQ.params(r);if(!t$.Leaderboards.Enabled)return[3,6];return[4,c.initMockAPI()];case 1:_.sent();if(!("playerIds"in r))return[3,3];return[4,c.mockAPI.getPlayers(e,r)];case 2:h=_.sent();return[3,5];case 3:return[4,c.mockAPI.getLeaders(e,r)];case 4:h=_.sent();_.label=5;case 5:return[3,8];case 6:return[4,ed("".concat(t,"?").concat(d),{},tZ)];case 7:h=_.sent();_.label=8;case 8:return[2,tJ.hasOwn(h,"data")&&Array.isArray(h.data)?h.data:[]]}})})()}},{key:"getLeaderboardAsync",value:function getLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:c="leaderboards/".concat(e);if(!t$.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:d.sent();return[4,t.mockAPI.getLeaderboardAsync(e)];case 2:r=d.sent();return[3,5];case 3:return[4,ed(c,{},tZ)];case 4:r=d.sent(),tJ.hasOwn(r,"data")&&tX.isObject(r.data)&&(r=r.data);d.label=5;case 5:return[2,r]}})})()}},{key:"getLeaderboardsAsync",value:function getLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){var c,d;return _ts_generator(this,function(h){switch(h.label){case 0:d=r.Utils.String.params(e);if(!t$.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:h.sent();return[4,t.mockAPI.getLeaderboardsAsync(e)];case 2:c=h.sent();return[3,5];case 3:return[4,ed("leaderboards?".concat(d),{},tZ)];case 4:c=h.sent(),tJ.hasOwn(c,"data")&&Array.isArray(c.data)?c=c.data:c=[];h.label=5;case 5:return[2,c]}})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){var t=this;return _async_to_generator(function(){var r,c,d;return _ts_generator(this,function(h){switch(h.label){case 0:r=e.leaderboardId,c=e.playerId,d=e.score;if(!t$.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:h.sent();return[4,t.mockAPI.setScoreAsync(r,c,d)];case 2:h.sent();return[3,5];case 3:return[4,eh("leaderboards/".concat(r,"/players/").concat(c),{score:d},{},tZ)];case 4:h.sent();h.label=5;case 5:return[2]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:c=null!==(r=e._id)&&void 0!==r?r:tQ.generateObjectId(),d=e.numberOfLeaders,h=_object_spread_props(_object_spread({},tz,e),{_id:c,appId:t0,numberOfLeaders:d}),_="leaderboards";if(!t$.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:f.sent();return[4,t.mockAPI.createLeaderboard(h)];case 2:y=f.sent();return[3,5];case 3:return[4,eh(_,h,{},tZ)];case 4:y=f.sent(),tJ.hasOwn(y,"data")&&tX.isObject(y.data)&&(y=y.data);f.label=5;case 5:if(!tJ.hasOwn(y,"_id")||y._id!==c)throw new Error("Create leaderboard failed");return[2,c]}})})()}}]);return Ha}();l(t2,"LeaderboardAPI");var t3=t2;var t1={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},t4={leaderboards:{}},t5=r.Utils,t7=t5.Array,t6=t5.Valid,t8=t5.Json,t9=t5.Object,ne=/*#__PURE__*/function(e){_inherits(qa,e);function qa(){_class_call_check(this,qa);var e;e=_call_super(this,qa,arguments);u(e,"lbAPI",new t3);u(e,"configs");return e}_create_class(qa,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("leaderboard",t4),this.configs={}}},{key:"addLeaderboard",value:function addLeaderboard(e){var t=e.name,r=e.type,c=e.leaderboardId,d=e.autoSortRank;if(this.getLeaderboard(t)){console.warn("Leaderboard with name ".concat(t," already exists"));return}var h="leaderboards/".concat(c,"/");("global"===r||"tournament"===r)&&(h+="leaders"),"friends"===r&&(h+="players"),this.configs[t]={id:c,name:t,type:r,host:h,autoSortRank:d};var _=t8.clone(t1);this.setLeaderboard(t,_object_spread({},_))}},{key:"requestLeaderboardsAsync",value:function requestLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,3]);return[4,t.lbAPI.getLeaderboardsAsync(e)];case 1:return[2,c.sent()];case 2:r=c.sent();return[2,(console.warn("requestGlobalLeaderboardsAsync",r),[])];case 3:return[2]}})})()}},{key:"requestLeaderboardAsync",value:function requestLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var c,d,h,_,y,f,p,v,g,m,A,w,I;return _ts_generator(this,function(b){switch(b.label){case 0:b.trys.push([0,,6,8]);r.validateLeaderboard(e),r.clearLeaderboard(e),r.setLeaderboard(e,{isRequesting:!0});c=r.configs[e],d=c.id,h=c.type,_=c.host;y=[];if("friends"!==h)return[3,2];f=r.game,p=f.player,v=p.getPlayerId(),g=p.getConnectedPlayerIds(t,0),m=[v].concat(_to_consumable_array(g));r.configs[e].playerIds=_to_consumable_array(m);return[4,r.lbAPI.getLeadersAsync(d,_,{playerIds:m})];case 1:y=b.sent();return[3,4];case 2:return[4,r.lbAPI.getLeadersAsync(d,_,{limit:t,offset:0})];case 3:y=b.sent();b.label=4;case 4:if(0===y.length)return[2];return[4,r.receiveLeaderboardAsync(e,y)];case 5:b.sent(),r.setLeaderboard(e,{limit:t,offset:0});return[3,8];case 6:return[4,r.lbAPI.getLeaderboardAsync(r.configs[e].id)];case 7:A=b.sent(),w=A?A.resettable:"",I=A?A.amountPlayer:0;r.setLeaderboard(e,{isRequesting:!1,resettable:w,amountPlayer:I});return[7];case 8:return[2]}})})()}},{key:"loadMoreLeaderboardAsync",value:function loadMoreLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var c,d,h,_,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:c=r.getLeaderboard(e);if(!c)return[3,4];if("friends"===r.configs[e].type){console.warn("Cannot load more leaderboard with type friend");return[2]}g.label=1;case 1:g.trys.push([1,,3,4]);r.setLeaderboard(e,{isRequesting:!0});d=r.configs[e],h=d.id,_=d.host,y=c.offset,f=c.limit,p=y+f;return[4,r.lbAPI.getLeadersAsync(h,_,{limit:t,offset:p})];case 2:v=g.sent();if(0===v.length)return[2];r.receiveLeaderboardAsync(e,v),r.setLeaderboard(e,{limit:t,offset:p});return[3,4];case 3:r.setLeaderboard(e,{isRequesting:!1});return[7];case 4:return[2]}})})()}},{key:"getLeaderboard",value:function getLeaderboard(e){var t=this.game,r=t.storage,c=r.getStorageData("leaderboard","leaderboards");return c[e]?c[e]:null}},{key:"getLeadersByPlayerIdsAsync",value:function getLeadersByPlayerIdsAsync(e,t){var r=this;return _async_to_generator(function(){var c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,2,,3]);r.validateLeaderboard(e);c=r.configs[e],d=c.id,h="leaderboards/".concat(d,"/players");return[4,r.lbAPI.getLeadersAsync(d,h,{playerIds:t})];case 1:_=f.sent();return[2,0===_.length?[]:r.toLeaders(_)];case 2:y=f.sent();return[2,(console.warn(y),[])];case 3:return[2]}})})()}},{key:"getLeaderboardResponseAsync",value:function getLeaderboardResponseAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){switch(r.label){case 0:return[4,t.lbAPI.getLeaderboardAsync(e)];case 1:return[2,r.sent()]}})})()}},{key:"clearLeaderboard",value:function clearLeaderboard(e){try{this.validateLeaderboard(e);var t=t8.clone(t1);this.setLeaderboard(e,null),this.setLeaderboard(e,_object_spread({},t))}catch(e){console.warn(e)}}},{key:"isLeaderboardEmpty",value:function isLeaderboardEmpty(e){var t=this.getLeaderboard(e);if(!t)return!0;var r=t.leaders;return 0===Object.keys(r).length}},{key:"isExistLeaderboardId",value:function isExistLeaderboardId(e){var t=this,r=t.configs;return t9.vals(r).some(function(t){return t.id===e})}},{key:"getLeaderboardName",value:function getLeaderboardName(e){var t=this,r=t.configs,c=t7.search(t9.vals(r),function(t){return t.id===e});return c?c.name:null}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e,t,r){var c=this;return _async_to_generator(function(){var d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,3,,4]);c.validateLeaderboard(e);d=c.configs[e],h=d.id;return[4,c.getLastScoreOnLeaderboard(e,t)];case 1:_=f.sent();if(_&&r<=_)return[2];return[4,c.lbAPI.setLeaderboardScoreAsync({leaderboardId:h,playerId:t,score:r})];case 2:f.sent();return[3,4];case 3:y=f.sent();console.warn(y);return[3,4];case 4:return[2]}})})()}},{key:"getLastScoreOnLeaderboard",value:function getLastScoreOnLeaderboard(e,t){var r=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(d){switch(d.label){case 0:return[4,r.getLeadersByPlayerIdsAsync(e,[t])];case 1:c=d.sent();return[2,0===c.length?null:c[0].score]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){return[2,t.lbAPI.createLeaderboardAsync(e)]})})()}},{key:"validateLeaderboard",value:function validateLeaderboard(e){var t=this.getLeaderboard(e);if(!t6.isObject(t))throw new Error("Leaderboard with name ".concat(e," not found"))}},{key:"setLeaderboard",value:function setLeaderboard(e,t){var r=this.game,c=r.storage;c.setStorageData("leaderboard","leaderboards",_define_property({},e,t))}},{key:"receiveLeaderboardAsync",value:function receiveLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var c,d,h,_,y,f,p,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:r.validateLeaderboard(e);return[4,r.toLeaders(t)];case 1:d=I.sent().filter(function(e){return e.name&&e.photo}),h=null!==(c=r.getLeaderboard(e))&&void 0!==c?c:{},_=h.offset,y=void 0===_?0:_,f=h.leaders,p=void 0===f?{}:f,v=d.filter(function(e){return!p[e.playerId]});if(y>0&&v.length>0){m=t9.vals(p);(g=v).unshift.apply(g,_to_consumable_array(m))}A=v.sort(function(e,t){return t.score-e.score});r.configs[e].autoSortRank&&(A=A.map(function(e,t){return _object_spread_props(_object_spread({},e),{rank:t+1})}));w=t9.keyBy(A,"playerId");r.setLeaderboard(e,{leaders:w});return[2]}})})()}},{key:"toLeaders",value:function toLeaders(e){var t=this;return _async_to_generator(function(){var r,c,d,h;return _ts_generator(this,function(_){switch(_.label){case 0:r=t.game,c=r.profile,d=e.map(function(e){return e.playerId});return[4,c.requestProfiles(d)];case 1:_.sent();h=c.getProfiles();return[2,e.map(function(e){var t=e.playerId,r=h[t];return r?_object_spread_props(_object_spread({},e),{name:r.name,photo:r.photo}):_object_spread_props(_object_spread({},e),{name:"Nameless",photo:"default"})}).map(function(e){return _object_spread_props(_object_spread({},e),{score:Number.parseInt(e.score,10)})})]}})})()}}]);return qa}(c.Plugins.BasePlugin);l(ne,"LeaderboardPlugin");var nt=ne;var na=/*#__PURE__*/function(){function Ya(){_class_call_check(this,Ya);u(this,"APIHost")}_create_class(Ya,[{key:"setAPIHost",value:function setAPIHost(e){this.APIHost=e}},{key:"getAPIHost",value:function getAPIHost(){return this.APIHost}}]);return Ya}();l(na,"BaseAPI");var nr=na;var ns=r.Utils,no=/*#__PURE__*/function(e){_inherits(Qa,e);function Qa(){_class_call_check(this,Qa);return _call_super(this,Qa,arguments)}_create_class(Qa,[{key:"createSingleMatchAsync",value:function createSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,eh("single-matches",e,{},t.getAPIHost())];case 1:r=c.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"getSingleMatchDetailAsync",value:function getSingleMatchDetailAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,ed("single-matches/active",{},e.getAPIHost())];case 1:t=r.sent();return[2,e.returnValidMatchData(t)]}})})()}},{key:"updateSingleMatchMoveAsync",value:function updateSingleMatchMoveAsync(e,t){var r=this;return _async_to_generator(function(){var c,d;return _ts_generator(this,function(h){switch(h.label){case 0:c="single-matches/".concat(e,"/move");return[4,eh(c,t,{},r.getAPIHost())];case 1:d=h.sent();return[2,r.returnValidMatchData(d)]}})})()}},{key:"finishSingleMatchAsync",value:function finishSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r="single-matches/".concat(e,"/finish");return[4,eh(r,{},{},t.getAPIHost())];case 1:c=d.sent();return[2,t.returnValidMatchData(c)]}})})()}},{key:"createEndlessMatchAsync",value:function createEndlessMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,eh("endless-matches",e,{},t.getAPIHost())];case 1:r=c.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"getEndlessMatchDetailAsync",value:function getEndlessMatchDetailAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,ed("endless-matches/active",{},e.getAPIHost())];case 1:t=r.sent();return[2,e.returnValidMatchData(t)]}})})()}},{key:"updateEndlessMatchMilestoneAsync",value:function updateEndlessMatchMilestoneAsync(e,t){var r=this;return _async_to_generator(function(){var c,d;return _ts_generator(this,function(h){switch(h.label){case 0:c="endless-matches/".concat(e,"/milestone");return[4,eh(c,t,{},r.getAPIHost())];case 1:d=h.sent();return[2,r.returnValidMatchData(d)]}})})()}},{key:"finishEndlessMatchAsync",value:function finishEndlessMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r="endless-matches/".concat(e,"/finish");return[4,eh(r,{},{},t.getAPIHost())];case 1:c=d.sent();return[2,t.returnValidMatchData(c)]}})})()}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,eh("matches",e,{},t.getAPIHost())];case 1:r=c.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r="matches/".concat(e,"/join");return[4,eh(r,{},{},t.getAPIHost())];case 1:c=d.sent();return[2,t.returnValidMatchData(c)]}})})()}},{key:"getMatchDetailByIdAsync",value:function getMatchDetailByIdAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r="matches/".concat(e);return[4,ed(r,{},t.getAPIHost())];case 1:c=d.sent();return[2,t.returnValidMatchData(c)]}})})()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:r=e.matchId,c=void 0===r?"":r,d=e.score,h=void 0===d?0:d,_=e.level,y=void 0===_?0:_,f=e.extraData,p=void 0===f?{}:f,v="matches/".concat(c,"/finish");return[4,eh(v,{matchId:c,score:h,level:y,extraData:p},{},t.getAPIHost())];case 1:g=m.sent();return[2,t.returnValidMatchData(g)]}})})()}},{key:"returnValidMatchData",value:function returnValidMatchData(e){var t={};return ns.Valid.isObject(e)&&ns.Object.hasOwn(e,"data")&&(t=e.data),t}}]);return Qa}(nr);l(no,"MatchAPI");var nc=no;var nl=/*#__PURE__*/function(){function Xa(e){_class_call_check(this,Xa);u(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}_create_class(Xa,[{key:"createAPI",value:function createAPI(){this.matchAPI=new nc}},{key:"setAPIConfig",value:function setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}},{key:"setMatchAPIInstance",value:function setMatchAPIInstance(e){this.matchAPI=e}},{key:"getMatchAPI",value:function getMatchAPI(){return this.matchAPI}}]);return Xa}();l(nl,"APIHandler");var nu=nl;var nd=/*#__PURE__*/function(){function Ja(e,t){_class_call_check(this,Ja);u(this,"game");u(this,"match");this.game=e,this.match=t}_create_class(Ja,[{key:"startLog",value:function startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group("\uD83D\uDE80 ".concat(this.constructor.name)),e&&console.log("\uD83D\uDCE6 ? Payload:",e)}},{key:"endLog",value:function endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}},{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(e){throw new Error("Not implemented")})})()}}]);return Ja}();l(nd,"BaseConcrete");var nh=nd;var n_=/*#__PURE__*/function(e){_inherits(Za,e);function Za(e){_class_call_check(this,Za);var t;t=_call_super(this,Za,[e]),t.name="LevelNotDefined",t.message=null!=e?e:"Level is not defined";return t}return Za}(B);l(n_,"LevelNotDefined");var ny=n_;var nf=/*#__PURE__*/function(e){_inherits(tn,e);function tn(e){_class_call_check(this,tn);var t;t=_call_super(this,tn,[e]),t.name="MatchModeNotDefined",t.message=null!=e?e:"Match id is not defined";return t}return tn}(B);l(nf,"MatchModeNotDefined");var np=nf;var nv=r.Utils,ng=nv.Object,nm=nv.Valid,nA=/*#__PURE__*/function(){function en(e){_class_call_check(this,en);u(this,"game");u(this,"match");u(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}_create_class(en,[{key:"setNext",value:function setNext(e){return this.nextHandler=e,e}},{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){console.groupCollapsed("➡️ ".concat(t.constructor.name)),t.logData("Before",e);return[2]})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:t.logData("After",e),console.groupEnd();r=t.nextHandler;if(!r)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:r=c.sent();c.label=2;case 2:return[2]}})})()}},{key:"logData",value:function logData(e,t){if(!nm.isDebugger())return;console.groupCollapsed("\uD83D\uDCE6 MatchState: ".concat(e));var r=t.profiles,c=t.customData,d=_object_without_properties(t,["profiles","customData"]);console.info("\uD83D\uDCBE Base"),console.table(ng.clone(d)),console.info("\uD83D\uDCBE Profile"),console.table(ng.clone(r)),console.info("\uD83D\uDCBE Custom"),console.table(ng.clone(c)),console.groupEnd()}}]);return en}();l(nA,"BaseHandler");var nw=nA;var nI=r.Plugins,nb=r.Utils,nk=nI.Analytics,nS=nb.String,nD=nb.Valid,nP=/*#__PURE__*/function(e){_inherits(sn,e);function sn(){_class_call_check(this,sn);return _call_super(this,sn,arguments)}_create_class(sn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(sn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h,_;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,c=e.customData,d=c.level;r.validateMode(t),r.validateLevel(d);h=r.game,_=h.analytics;_.event(nk.Events.MATCH_START,{level:d,game_mode:nS.toUpperCamelCase(t),level_name:r.getLevelName(d)});return[4,r.nextAsync(e)];case 1:y.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!nD.isString(e))throw new np}},{key:"validateLevel",value:function validateLevel(e){if(!nD.isNumber(e))throw new ny}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(nS.padStart(e.toString(),5,"0"))}}]);return sn}(nw);l(nP,"LogMatchStartHandler");var nE=nP;var nC={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},nx=/*#__PURE__*/function(e){_inherits(an,e);function an(){_class_call_check(this,an);return _call_super(this,an,arguments)}_create_class(an,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(an.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d;return _ts_generator(this,function(h){switch(h.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,c=e.status;d=null!=t?t:eQ.SINGLE;c===nC.FINISHED&&(d=eQ.SINGLE),r.contextGameModeDetected(d);return[4,r.nextAsync(e)];case 1:h.sent();return[2]}})})()}},{key:"contextGameModeDetected",value:function contextGameModeDetected(e){var t=this.game,r=t.storage;r.setStorageData("context","contextGameMode",e)}}]);return an}(nw);l(nx,"ContextGameModeHandler");var nN=nx;var nT=/*#__PURE__*/function(e){_inherits(nn,e);function nn(e){_class_call_check(this,nn);var t;t=_call_super(this,nn,[e]),t.name="GetMatchDetailFailed",t.message=null!=e?e:"Get match detail failed";return t}return nn}(_wrap_native_super(Error));l(nT,"GetMatchDetailFailed");var nM=nT;var nL=/*#__PURE__*/function(e){_inherits(on,e);function on(e){_class_call_check(this,on);var t;t=_call_super(this,on,[e]),t.name="MatchAreNotActive",t.message=null!=e?e:"Match are not active";return t}return on}(_wrap_native_super(Error));l(nL,"MatchAreNotActive");var nO=nL;var nR=/*#__PURE__*/function(e){_inherits(rn,e);function rn(e){_class_call_check(this,rn);var t;t=_call_super(this,rn,[e]),t.name="MatchIdNotValid",t.message=null!=e?e:"Match id is not valid";return t}return rn}(B);l(nR,"MatchIdNotValid");var nG=nR;var nF=/*#__PURE__*/function(e){_inherits(cn,e);function cn(e){_class_call_check(this,cn);var t;t=_call_super(this,cn,[e]),t.name="OpponentHasFinishedMatch",t.message=e||"Opponent has finished match";return t}return cn}(_wrap_native_super(Error));l(nF,"OpponentHasFinishedMatch");var nB=nF;var nV=/*#__PURE__*/function(e){_inherits(ln,e);function ln(e){_class_call_check(this,ln);var t;t=_call_super(this,ln,[e]),t.name="OpponentIdNotValid",t.message=null!=e?e:"Opponent id is not valid";return t}return ln}(B);l(nV,"OpponentIdNotValid");var nj=nV;var nU=/*#__PURE__*/function(e){_inherits(dn,e);function dn(e){_class_call_check(this,dn);var t;t=_call_super(this,dn,[e]),t.name="PlayerNotCurrentInMatch",t.message=null!=e?e:"The player is not currently in this match";return t}return dn}(_wrap_native_super(Error));l(nU,"PlayerNotCurrentInMatch");var nH=nU;var nK=/*#__PURE__*/function(e){_inherits(hn,e);function hn(e){_class_call_check(this,hn);var t;t=_call_super(this,hn,[e]),t.name="PlayerNotFinishedMatch",t.message=e||"Player not finished match";return t}return hn}(_wrap_native_super(Error));l(nK,"PlayerNotFinishedMatch");var nW=nK;var nz=r.Dtos,nq=/*#__PURE__*/function(e){_inherits(un,e);function un(){_class_call_check(this,un);return _call_super(this,un,arguments)}_create_class(un,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(un.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=d.sent(),c=new nz.Match.Data(t).toObject();r.validateAwaitMatchData(e,c),r.updateMatchData(e,c),r.validateMatchStatus(e),r.validatePlayerTurn(e),r.validateOpponentTurn(e);return[4,r.nextAsync(e)];case 2:d.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id;if("string"!=typeof t)throw new nG}},{key:"validateMatchStatus",value:function validateMatchStatus(e){var t=e.status;if(t!==nC.ACTIVE)throw new nO}},{key:"validateAwaitMatchData",value:function validateAwaitMatchData(e,t){var r=e.id,c=e.customData,d=t._id,h=t.whitePlayerId,_=t.blackPlayerId;if("string"!=typeof d||d!==r)throw new nM;var y=c.playerId,f=h===y,p=_===y;if(!f&&_===G.playerId)throw new e6;if(!f&&!p)throw new nH}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,c=r.playerId;if("string"!=typeof c)throw new j;var d=t[c],h=d.finished;if(!h)throw new nW}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,r=e.customData,c=r.opponentId;if("string"!=typeof c)throw new nj;var d=t[c],h=d.finished;if(h)throw new nB}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,c=t.whitePlayerId,d=t.blackPlayerId,h=t.whitePlayerScore,_=t.blackPlayerScore,y=t.whitePlayerFinish,f=t.blackPlayerFinish,p=t.status;e.status=p;var v=c===r.playerId,g=v?c:d,m=v?d:c;e.customData.playerId=g,e.customData.opponentId=m,e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1}),e.profiles[m]||(e.profiles[m]={id:m,name:"",photo:"",finished:!1});var A=v?h:_,w=v?_:h;e.profiles[g].score=A,e.profiles[m].score=w;var I=v?y:f,b=v?f:y;e.profiles[g].finished=I,e.profiles[m].finished=b}}]);return un}(nw);l(nq,"AwaitMatchHandler");var nY=nq;var nJ={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},nQ=/*#__PURE__*/function(e){_inherits(yn,e);function yn(e,t){_class_call_check(this,yn);var r;r=_call_super(this,yn,[e]);u(r,"payload");r.payload=t;return r}_create_class(yn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(yn.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.initializeMatch(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"initializeMatch",value:function initializeMatch(e){var t=this.payload,r=t.id,c=t.mode,d=t.customData;e.id=null!=r?r:null,e.mode=c||null,e.status=nC.OPEN,e.startAt=0,e.finishAt=0,e.profiles={},e.customData=_object_spread({},nJ,e.customData,d)}}]);return yn}(nw);l(nQ,"PrepareMatchHandler");var nX=nQ;var nZ=eJ,n$=/*#__PURE__*/function(e){_inherits(pn,e);function pn(e){_class_call_check(this,pn);var t;t=_call_super(this,pn,[e]),t.name="UnavailableFeature",t.message="Unavailable feature: ".concat(e);return t}return pn}(_wrap_native_super(Error));l(n$,"UnavailableFeature");var n0=n$;var n2=/*#__PURE__*/function(e){_inherits(fn,e);function fn(e){_class_call_check(this,fn);var t;t=_call_super(this,fn,[e]),t.name="ContextIdNotValid",t.message=null!=e?e:"Context id is not valid";return t}return fn}(B);l(n2,"ContextIdNotValid");var n3=n2;var n1=/*#__PURE__*/function(e){_inherits(gn,e);function gn(){_class_call_check(this,gn);return _call_super(this,gn,arguments)}_create_class(gn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(gn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesAwaitingAsync(e)];case 1:t=c.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,d=r.opponentId;if(!t||"string"!=typeof t)throw new nG;if(!c||"string"!=typeof c)throw new n3;if(!d||"string"!=typeof d)throw new nj}},{key:"createWideframesAwaitingAsync",value:function createWideframesAwaitingAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A,w,I,b,k,S,D;return _ts_generator(this,function(P){switch(P.label){case 0:P.trys.push([0,4,,5]);r=t.game,c=r.frameCapture,d=e.profiles,h=e.customData,_=h.playerId,y=h.opponentId;if(!_||!y)return[2,null];f=d[_],p=d[y],v=f.photo,g=f.score,m=void 0===g?0:g,A=f.finished;if(!A)return[2,null];w=p.photo,I=p.score,b=void 0===I?0:I,k=p.finished;if(!k)return[3,1];S=null;return[3,3];case 1:return[4,c.wideframe.renderResultChallenge({playerId:_,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:w,opponentScore:b,isPlayerFinished:!0,isOpponentFinished:!1})];case 2:S=P.sent();P.label=3;case 3:return[2,S];case 4:D=P.sent();return[2,(console.warn("createWideframesAwaitingAsync",D),null)];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,c=e.profiles,d=e.customData,h=d.playerId,_=d.opponentId;if(!h||"string"!=typeof h)throw new j;if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");y=c[h],f=y.name,p={data:{type:nZ.CHALLENGE_FRIEND,matchId:r,playerId:h,opponentId:_},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(f," is waiting for you to finish this game. Play now!"),localizations:{vi_VN:"".concat(f," đang chờ bạn kết th\xfac trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}}]);return gn}(nw);l(n1,"SendAwaitingMessageHandler");var n4=n1;var n5=/*#__PURE__*/function(e){_inherits(wn,e);function wn(){_class_call_check(this,wn);return _call_super(this,wn,arguments)}_create_class(wn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){switch(r.label){case 0:return[4,t.nextAsync(e)];case 1:r.sent();return[2]}})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:r=t.nextHandler;if(!r)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:r=c.sent();c.label=2;case 2:return[2]}})})()}}]);return wn}(nw);l(n5,"NothingHandler");var n7=n5;var n6=/*#__PURE__*/function(e){_inherits(mn,e);function mn(e){_class_call_check(this,mn);var t;t=_call_super(this,mn,[e]),t.name="ProfileNotFound",t.message=null!=e?e:"Profile not found";return t}return mn}(B);l(n6,"ProfileNotFound");var n8=n6;var n9=r.Dtos,ae=/*#__PURE__*/function(e){_inherits(An,e);function An(){_class_call_check(this,An);return _call_super(this,An,arguments)}_create_class(An,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(An.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);t=e.customData,c=t.playerId,d=t.opponentId;h=c;return[4,r.getProfile(h)];case 1:_=f.sent();if(!_)throw new n8;if(r.updateMatchProfile(e,h,_),h=d,h===G.playerId)return[3,3];return[4,r.getProfile(h)];case 2:y=f.sent();if(!y)throw new n8;r.updateMatchProfile(e,h,y);return[3,4];case 3:r.updateMatchProfile(e,h);f.label=4;case 4:return[4,r.nextAsync(e)];case 5:f.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.customData,r=t.playerId,c=t.opponentId;if(!r||"string"!=typeof r)throw new j;if(!c||"string"!=typeof c)throw new nj}},{key:"getProfile",value:function getProfile(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r=t.game,c=r.profile;return[4,c.requestProfiles([e])];case 1:return[2,(d.sent(),c.getProfiles()[e])]}})})()}},{key:"updateMatchProfile",value:function updateMatchProfile(e,t,r){var c=null!=r?r:G,d=c.name,h=c.photo,_=new n9.Match.Profile({id:t,name:d,photo:h}).toObject();e.profiles[t]?(e.profiles[t].name=_.name,e.profiles[t].photo=_.photo):e.profiles[t]=_}}]);return An}(nw);l(ae,"GetMatchProfilesHandler");var at=ae;var aa=/*#__PURE__*/function(e){_inherits(In,e);function In(){_class_call_check(this,In);return _call_super(this,In,arguments)}_create_class(In,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,c=e.playerId,d=e.opponentId,h=new n7(t),y=new nX(t,{id:r,mode:_.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:d}});h.setNext(y);f=new nY(t);y.setNext(f);p=new at(t);f.setNext(p);v=new n4(t);p.setNext(v);g=new nE(t);v.setNext(g);m=new nN(t);g.setNext(m);A=t.match.getMatchState();return[4,h.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return In}(nh);l(aa,"AwaitChallengeMatchConcrete");var ar=aa;var as=/*#__PURE__*/function(e){_inherits(Dn,e);function Dn(e){_class_call_check(this,Dn);var t;t=_call_super(this,Dn,[e]),t.name="CreateContextFailed",t.message=null!=e?e:"Create context failed";return t}return Dn}(B);l(as,"CreateContextFailed");var ao=as;var ac=r.Utils,al=ac.Valid,au=ac.Object,ad=/*#__PURE__*/function(e){_inherits(Pn,e);function Pn(e,t){_class_call_check(this,Pn);var r;r=_call_super(this,Pn,[e]);u(r,"payload");r.payload=t;return r}_create_class(Pn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Pn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d;return _ts_generator(this,function(h){switch(h.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.opponentId;return[4,r.createAsync(c)];case 1:d=h.sent();e.customData.contextId=d;return[4,r.nextAsync(e)];case 2:h.sent();return[2]}})})()}},{key:"createAsync",value:function createAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:d.trys.push([0,2,,3]);return[4,GameSDK.context.createAsync(e)];case 1:d.sent();return[3,3];case 2:r=d.sent();t.validateError(r);return[3,3];case 3:c=GameSDK.context.getID();if(!al.isString(c))throw new ao;return[2,c]}})})()}},{key:"validateError",value:function validateError(e){if(!au.hasOwn(e,"code"))throw e;if("SAME_CONTEXT"!==e.code){if("INVALID_PARAM"===e.code){if(!this.isNotConnectedPlayerError(e))throw e;return}throw e}}},{key:"validateErrorMessage",value:function validateErrorMessage(e){if(!au.hasOwn(e,"message")||!al.isString(e.message))throw e}},{key:"isNotConnectedPlayerError",value:function isNotConnectedPlayerError(e){return this.validateErrorMessage(e),e.message.indexOf("is not a connected player of the current player")>-1}}]);return Pn}(nw);l(ad,"CreateContextHandler");var ah=ad;var a_=/*#__PURE__*/function(e){_inherits(En,e);function En(e){_class_call_check(this,En);var t;t=_call_super(this,En,[e]),t.name="MatchAreNotOpen",t.message=null!=e?e:"Match are not open";return t}return En}(B);l(a_,"MatchAreNotOpen");var ay=a_;var af=r.Dtos,ap=/*#__PURE__*/function(e){_inherits(xn,e);function xn(e,t){_class_call_check(this,xn);var r;r=_call_super(this,xn,[e]);u(r,"payload");r.payload=t;return r}_create_class(xn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(xn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createMatchAsync(e)];case 1:t=d.sent(),c=new af.Match.Data(t).toObject();r.updateMatchState(e,c);return[4,r.nextAsync(e)];case 2:d.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.status,r=e.customData,c=r.opponentId;if("string"!=typeof c)throw new nj;if(t!==nC.OPEN)throw new ay}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_;return _ts_generator(this,function(y){r=e.customData,c=r.opponentId,d=t.payload,h=d.extraData;if(!c)return[2,{}];_={opponentPlayerId:c,extraData:h};return[2,t.match.api.getMatchAPI().createMatchAsync(_)]})})()}},{key:"updateMatchState",value:function updateMatchState(e,t){var r=e.customData,c=t._id,d=t.whitePlayerId,h=t.blackPlayerId,_=t.whitePlayerFinish,y=t.blackPlayerFinish,f=d===r.opponentId;e.id=c||null;var p=f?h:d,v=f?d:h;e.customData.playerId=p,e.customData.opponentId=v,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1});var g=f?y:_,m=f?_:y;e.profiles[p].finished=g,e.profiles[v].finished=m}}]);return xn}(nw);l(ap,"CreateMatchHandler");var av=ap;var ag=/*#__PURE__*/function(e){_inherits(vn,e);function vn(){_class_call_check(this,vn);return _call_super(this,vn,arguments)}_create_class(vn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(vn.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(_superprop_get_processAsync().call(r,e),e.status!==nC.OPEN)throw new ay;r.startMatch(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"startMatch",value:function startMatch(e){e.status=nC.ACTIVE,e.startAt=Date.now()}}]);return vn}(nw);l(ag,"StartMatchHandler");var am=ag;var aA=/*#__PURE__*/function(e){_inherits(Sn,e);function Sn(){_class_call_check(this,Sn);return _call_super(this,Sn,arguments)}_create_class(Sn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Sn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesChallengeAsync(e)];case 1:t=c.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,d=r.opponentId;if(!t||"string"!=typeof t)throw new nG;if(!c||"string"!=typeof c)throw new n3;if(!d||"string"!=typeof d)throw new nj}},{key:"createWideframesChallengeAsync",value:function createWideframesChallengeAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A,w,I,b;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);r=t.game,c=r.frameCapture,d=e.profiles,h=e.customData,_=h.playerId,y=h.opponentId;if(!_||!y)return[2,null];f=d[_],p=d[y],v=f.photo,g=f.score,m=void 0===g?0:g,A=p.photo,w=p.score,I=void 0===w?0:w;return[4,c.wideframe.renderResultChallenge({playerId:_,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:A,opponentScore:I,isPlayerFinished:!1,isOpponentFinished:!1})];case 1:return[2,k.sent()];case 2:b=k.sent();return[2,(console.warn("createWideframesChallengeAsync",b),null)];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,c=e.profiles,d=e.customData,h=d.playerId,_=d.opponentId;if(!h||"string"!=typeof h)throw new j;if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");y=c[h],f=y.name,p={data:{type:nZ.CHALLENGE_FRIEND,matchId:r,playerId:h,opponentId:_},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(f," challenges you"),localizations:{vi_VN:"".concat(f," thử th\xe1ch bạn trong trận đấu n\xe0y. Chơi ngay!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}}]);return Sn}(nw);l(aA,"SendChallengeMessageHandler");var aw=aA;var aI=/*#__PURE__*/function(e){_inherits(bn,e);function bn(){_class_call_check(this,bn);return _call_super(this,bn,arguments)}_create_class(bn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.opponentId,d=new n7(t),h=new ah(t,{opponentId:c});d.setNext(h);y=new nX(t,{mode:_.CHALLENGE_FRIEND,customData:{playerId:r,opponentId:c}});h.setNext(y);f=new av(t,{extraData:e.extraData});y.setNext(f);p=new at(t);f.setNext(p);v=new am(t);p.setNext(v);g=new nE(t);v.setNext(g);m=new aw(t);g.setNext(m);A=new nN(t);m.setNext(A);w=t.match.getMatchState();return[4,d.processAsync(w)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return bn}(nh);l(aI,"ChallengeFriendConcrete");var ab=aI;var ak=/*#__PURE__*/function(e){_inherits(Nn,e);function Nn(e){_class_call_check(this,Nn);var t;t=_call_super(this,Nn,[e]),t.name="SameContext",t.message=null!=e?e:"Same context";return t}return Nn}(_wrap_native_super(Error));l(ak,"SameContext");var aS=ak;var aD=r.Utils,aP=/*#__PURE__*/function(e){_inherits(Ln,e);function Ln(e,t){_class_call_check(this,Ln);var r;r=_call_super(this,Ln,[e]);u(r,"payload");r.payload=t;return r}_create_class(Ln,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ln.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.contextId;return[4,r.switchAsync(c)];case 1:d.sent(),e.customData.contextId=c;return[4,r.nextAsync(e)];case 2:d.sent();return[2]}})})()}},{key:"checkSameContext",value:function checkSameContext(e){var t="SOLO"===e,r=GameSDK.context.getID();if(r===e)throw new aS;if(t&&null===r)throw new aS}},{key:"switchAsync",value:function switchAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r="SOLO"===e;d.label=1;case 1:d.trys.push([1,3,,4]);t.checkSameContext(e);return[4,GameSDK.context.switchAsync(e,r)];case 2:d.sent();return[3,4];case 3:c=d.sent();if(_instanceof(c,aS))return[2];if(!aD.Object.hasOwn(c,"code"))throw c;if(aD.Device.isAndroid()&&r&&"INVALID_PARAM"===c.code)return[2];if("SAME_CONTEXT"!==c.code)throw c;return[3,4];case 4:return[2]}})})()}}]);return Ln}(nw);l(aP,"SwitchContextHandler");var aE=aP;var aC=r.Dtos,ax=/*#__PURE__*/function(e){_inherits(Tn,e);function Tn(){_class_call_check(this,Tn);return _call_super(this,Tn,arguments)}_create_class(Tn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Tn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=d.sent(),c=new aC.Match.Data(t).toObject();r.validateContinueMatchData(e,c),r.updateMatchData(e,c),r.validatePlayerTurn(e);return[4,r.nextAsync(e)];case 2:d.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id,r=e.status;if("string"!=typeof t)throw new nG;if(r!==nC.OPEN)throw new ay}},{key:"validateContinueMatchData",value:function validateContinueMatchData(e,t){var r=e.id,c=e.customData,d=t._id,h=t.whitePlayerId,_=t.blackPlayerId;if("string"!=typeof d||d!==r)throw console.warn("\uD83E\uDD16 ? respMatchDataValidated",t),new nM;var y=c.playerId,f=h===y,p=_===y;if(!f&&_===G.playerId)throw new e6;if(!f&&!p)throw new nH}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,c=r.playerId;if("string"!=typeof c)throw new j;var d=t[c],h=d.finished;if(h)throw new e5}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,c=t.whitePlayerId,d=t.blackPlayerId,h=t.whitePlayerScore,_=t.blackPlayerScore,y=t.whitePlayerFinish,f=t.blackPlayerFinish,p=c===r.playerId,v=p?c:d,g=p?d:c;e.customData.playerId=v,e.customData.opponentId=g,e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});var m=p?h:_,A=p?_:h;e.profiles[v].score=m,e.profiles[g].score=A;var w=p?y:f,I=p?f:y;e.profiles[v].finished=w,e.profiles[g].finished=I}}]);return Tn}(nw);l(ax,"ContinueMatchHandler");var aN=ax;var aT=/*#__PURE__*/function(e){_inherits(Cn,e);function Cn(){_class_call_check(this,Cn);return _call_super(this,Cn,arguments)}_create_class(Cn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Cn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesCurrentScoreAsync()];case 1:t=c.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,d=r.opponentId;if(!t||"string"!=typeof t)throw new nG;if(!c||"string"!=typeof c)throw new n3;if(!d||"string"!=typeof d)throw new nj}},{key:"createWideframesCurrentScoreAsync",value:function createWideframesCurrentScoreAsync(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,2,,3]);t=e.game,r=t.player,c=t.frameCapture,d=r.getPlayer(),h=d.playerId,_=d.photo,y=e.match.getMatchState(),f=y.profiles,p=f[h]||{},v=p.score,g=void 0===v?0:v;return[4,c.wideframe.renderShareScore({playerId:h,playerPhoto:_,playerScore:g})];case 1:return[2,A.sent()];case 2:m=A.sent();return[2,(console.warn("createWideframesCurrentScoreAsync",m),null)];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,c=e.profiles,d=e.customData,h=d.playerId,_=d.opponentId;if(!h||"string"!=typeof h)throw new j;if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");y=c[h],f=y.name,p={data:{type:nZ.CHALLENGE_FRIEND,matchId:r,playerId:h,opponentId:_},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(f," made an update."),localizations:{vi_VN:"".concat(f," đ\xe3 cập nhật trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}}]);return Cn}(nw);l(aT,"SendUpdateMessageHandler");var aM=aT;var aL=/*#__PURE__*/function(e){_inherits(On,e);function On(){_class_call_check(this,On);return _call_super(this,On,arguments)}_create_class(On,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A,w,I,b;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,,2,3]);t.startLog(e);r=e.contextId,c=e.matchId,d=e.playerId,h=e.opponentId,y=new n7(t),f=new aE(t,{contextId:r});y.setNext(f);p=new nX(t,{id:c,mode:_.CHALLENGE_FRIEND,customData:{playerId:d,opponentId:h}});f.setNext(p);v=new aN(t);p.setNext(v);g=new at(t);v.setNext(g);m=new am(t);g.setNext(m);A=new aM(t);m.setNext(A);w=new nE(t);A.setNext(w);I=new nN(t);w.setNext(I);b=t.match.getMatchState();return[4,y.processAsync(b)];case 1:k.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return On}(nh);l(aL,"ContinueChallengeMatchConcrete");var aO=aL;var aR=r.Plugins,aG=r.Utils,aF=aR.Analytics,aB=aG.String,aV=aG.Valid,aj=/*#__PURE__*/function(e){_inherits(Mn,e);function Mn(){_class_call_check(this,Mn);return _call_super(this,Mn,arguments)}_create_class(Mn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Mn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:_superprop_get_processAsync().call(r,e);t=e.customData,c=e.mode,d=e.startAt,h=e.finishAt,_=t.level;r.validateMode(c),r.validateLevel(_);y=r.game,f=y.analytics,p=Math.floor((h-d)/1e3);f.event(aF.Events.MATCH_END,{level:_,game_mode:aB.toUpperCamelCase(c),level_name:r.getLevelName(_),time_played:p});return[4,r.nextAsync(e)];case 1:v.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!aV.isString(e))throw new np}},{key:"validateLevel",value:function validateLevel(e){if(!aV.isNumber(e))throw new ny}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(aB.padStart(e.toString(),5,"0"))}}]);return Mn}(nw);l(aj,"LogMatchFinishedHandler");var aU=aj;var aH=/*#__PURE__*/function(e){_inherits(Rn,e);function Rn(e){_class_call_check(this,Rn);var t;t=_call_super(this,Rn,[e]),t.name="ScoreNotValid",t.message=null!=e?e:"Score is not valid";return t}return Rn}(_wrap_native_super(Error));l(aH,"ScoreNotValid");var aK=aH;var aW=/*#__PURE__*/function(e){_inherits(_n,e);function _n(e){_class_call_check(this,_n);var t;t=_call_super(this,_n,[e]),t.name="LeaderboardIdNotValid",t.message=null!=e?e:"Leaderboard id is not valid";return t}return _n}(_wrap_native_super(Error));l(aW,"LeaderboardIdNotValid");var az=aW;var aq=/*#__PURE__*/function(e){_inherits($n,e);function $n(e){_class_call_check(this,$n);var t;t=_call_super(this,$n,[e]),t.name="LeaderboardNotExist",t.message=null!=e?e:"Leaderboard not exist in game";return t}return $n}(_wrap_native_super(Error));l(aq,"LeaderboardNotExist");var aY=aq;var aJ=r.Utils,aQ=aJ.Valid,aX=/*#__PURE__*/function(e){_inherits(Gn,e);function Gn(e,t){_class_call_check(this,Gn);var r;r=_call_super(this,Gn,[e]);u(r,"payload");u(r,"leaderboardPayload");r.payload=t;return r}_create_class(Gn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Gn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.setupSetScorePayload(e);t="submitGameResultsAsync"in GameSDK.extra;if(!t)return[3,2];return[4,GameSDK.extra.submitGameResultsAsync(r.payload.score)];case 1:t=c.sent();c.label=2;case 2:r.setLeaderboardScoreAsync();return[4,r.nextAsync(e)];case 3:c.sent();return[2]}})})()}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y;return _ts_generator(this,function(f){r=e.profiles,c=e.customData,d=c.playerId;if(!d||!r[d])throw new n8;h=t.payload,_=h.score,y=h.leaderboardId;if(!aQ.isNumber(_))throw new aK;if(!aQ.isString(y))throw new az;t.leaderboardPayload={score:_,playerId:d,leaderboardId:y};return[2]})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);t=e.leaderboardPayload,r=t.playerId,c=t.score,d=t.leaderboardId,h=e.game.leaderboard.getLeaderboardName(d);if(!h)throw new aY;return[4,e.game.leaderboard.setLeaderboardScoreAsync(h,r,c)];case 1:y.sent();return[3,3];case 2:_=y.sent();console.warn("setLeaderboardScoreAsync",_);return[3,3];case 3:return[2]}})})()}}]);return Gn}(nw);l(aX,"SetLeaderboardScoreHandler");var aZ=aX;var a$=r.Utils,a0=a$.Valid,a2=r.Configs,a3=a2.Leaderboards,a1=/*#__PURE__*/function(e){_inherits(Vn,e);function Vn(e){_class_call_check(this,Vn);return _call_super(this,Vn,[e,{score:0,leaderboardId:a3.LeaderboardId}])}_create_class(Vn,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(Vn.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,c,d,h,_;return _ts_generator(this,function(y){t=e.profiles,c=e.customData,d=c.playerId;if(!d||!t[d])throw new n8;h=t[d],_=h.score;if(!a0.isNumber(_))throw new aK;r.payload.score=_,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return Vn}(aZ);l(a1,"PostGlobalLeaderboardScoreHandler");var a4=a1;var a5=r.Dtos,a7=r.Utils,a6=a7.Valid,a8=a7.Object,a9=/*#__PURE__*/function(e){_inherits(kn,e);function kn(e,t){_class_call_check(this,kn);var r;r=_call_super(this,kn,[e]);u(r,"payload");r.payload=t;return r}_create_class(kn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(kn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);t=r.payload,c=t.useAPI;if(!c)return[3,2];return[4,r.finishMatchAsync(e)];case 1:d=_.sent(),h=new a5.Match.Data(d).toObject();r.updateMatchFromAPI(e,h);return[3,3];case 2:r.updateMatchData(e);_.label=3;case 3:r.updateMatchState(e);return[4,r.nextAsync(e)];case 4:_.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status,r=e.profiles,c=e.customData;if(t!==nC.ACTIVE)throw new nO;var d=c.playerId;if(!d||!a8.hasOwn(r,d))throw new nH}},{key:"updateMatchData",value:function updateMatchData(e){var t=e.customData,r=t.playerId;if(!a6.isString(r))throw new j;e.profiles[r].finished=!0}},{key:"updateMatchState",value:function updateMatchState(e){e.status=nC.FINISHED,e.finishAt=Date.now()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g;return _ts_generator(this,function(m){r=e.id,c=e.profiles,d=e.customData,h=d.level,_=d.playerId;if(!a6.isString(_))throw new j;y=c[_],f=y.score,p=t.payload,v=p.extraData,g={matchId:null!=r?r:"",score:f,level:h,extraData:v};return[2,t.match.api.getMatchAPI().finishMatchAsync(g)]})})()}},{key:"updateMatchFromAPI",value:function updateMatchFromAPI(e,t){var r=e.customData,c=r.playerId,d=r.opponentId;if(!a6.isString(c))throw new j;if(!a6.isString(d))throw new nj;var h=t.whitePlayerId,_=t.whitePlayerScore,y=t.blackPlayerScore,f=t.whitePlayerFinish,p=t.blackPlayerFinish,v=c===h,g=v?_:y,m=v?y:_,A=v?f:p,w=v?p:f;e.profiles[c].score=g,e.profiles[d].score=m,e.profiles[c].finished=A,e.profiles[d].finished=w}}]);return kn}(nw);l(a9,"FinishMatchHandler");var re=a9;var rt=/*#__PURE__*/function(e){_inherits(Un,e);function Un(){_class_call_check(this,Un);return _call_super(this,Un,arguments)}_create_class(Un,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Un.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesResultAsync(e)];case 1:t=c.sent();t&&r.progressSendFinishedMessage(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,d=r.opponentId;if(!t||"string"!=typeof t)throw new nG;if(!c||"string"!=typeof c)throw new n3;if(!d||"string"!=typeof d)throw new nj}},{key:"createWideframesResultAsync",value:function createWideframesResultAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A,w,I,b,k,S;return _ts_generator(this,function(D){switch(D.label){case 0:D.trys.push([0,2,,3]);r=t.game,c=r.frameCapture,d=e.profiles,h=e.customData,_=h.playerId,y=h.opponentId;if(!_||!y)return[2,null];f=d[_],p=d[y],v=f.photo,g=f.score,m=void 0===g?0:g,A=f.finished,w=p.photo,I=p.score,b=void 0===I?0:I,k=p.finished;return[4,c.wideframe.renderResultChallenge({playerId:_,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:w,opponentScore:b,isPlayerFinished:!!A,isOpponentFinished:!!k})];case 1:return[2,D.sent()];case 2:S=D.sent();return[2,(console.warn("createWideframesResultAsync",S),null)];case 3:return[2]}})})()}},{key:"progressSendFinishedMessage",value:function progressSendFinishedMessage(e,t){var r=e.profiles,c=e.customData,d=c.playerId,h=c.opponentId;if(!d||"string"!=typeof d)throw new j;if(!h||"string"!=typeof h)throw new nj;var _=r[d],y=_.score,f=void 0===y?0:y,p=_.finished,v=r[h],g=v.score,m=void 0===g?0:g,A=v.finished;p?this.sendFinishMessageAsync(e,t):A&&f>m?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}},{key:"sendFinishMessageAsync",value:function sendFinishMessageAsync(e,t){return _async_to_generator(function(){var r,c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,c=e.profiles,d=e.customData,h=d.playerId,_=d.opponentId;if(!h||"string"!=typeof h)throw new j;if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");y=c[h],f=y.name,p={data:{type:nZ.CHALLENGE_FRIEND,matchId:r,playerId:h,opponentId:_,status:nC.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(f," just finished. Check them now."),localizations:{vi_VN:"".concat(f," vừa ho\xe0n th\xe0nh m\xe0n chơi. Nhấn để xem kết quả trận đấu.")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}},{key:"sendPlayTurnMessageAsync",value:function sendPlayTurnMessageAsync(e,t){return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:r=e.id,c=e.profiles,d=e.customData,h=d.playerId,_=d.opponentId;if(!h||"string"!=typeof h)throw new j;y=c[h],f=y.name,p=y.score,v={data:{type:nZ.CHALLENGE_FRIEND,matchId:r,playerId:h,opponentId:_,status:nC.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(f," got ").concat(p," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(f," đ\xe3 đạt ").concat(p," điểm! Nhấn Chơi để so t\xe0i!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");return[4,GameSDK.extra.updateAsync(v)];case 1:g.sent();return[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:r=e.id,c=e.profiles,d=e.customData,h=d.playerId,_=d.opponentId;if(!h||"string"!=typeof h)throw new j;y=c[h],f=y.name,p=y.score,v={data:{type:nZ.CHALLENGE_FRIEND,matchId:r,playerId:h,opponentId:_,status:nC.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(f," beat your high score. Their score: ").concat(p),localizations:{vi_VN:"".concat(f," đ\xe3 vượt qua điểm số của bạn, với ").concat(p," điểm!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");return[4,GameSDK.extra.updateAsync(v)];case 1:g.sent();return[2]}})})()}}]);return Un}(nw);l(rt,"SendFinishedMessageHandler");var ra=rt;var rr=/*#__PURE__*/function(e){_inherits(Fn,e);function Fn(){_class_call_check(this,Fn);return _call_super(this,Fn,arguments)}_create_class(Fn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Fn.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.setPlayerBestScore(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"setPlayerBestScore",value:function setPlayerBestScore(e){var t=e.profiles,r=e.customData,c=r.playerId;if(!c||!t[c])throw new n8;var d=this.game,h=d.player,_=h.getBestScore()||0,y=t[c],f=y.score,p=void 0===f?0:f;p<=_||(h.setBestScore(p),t[c].bestScore=p)}}]);return Fn}(nw);l(rr,"SetPlayerBestScoreHandler");var rs=rr;var ro=/*#__PURE__*/function(e){_inherits(Bn,e);function Bn(){_class_call_check(this,Bn);return _call_super(this,Bn,arguments)}_create_class(Bn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,,2,3]);t.startLog(e);r=null!=e?e:{},c=r.extraData,d=new n7(t),h=new re(t,{useAPI:!0,extraData:c});d.setNext(h);_=new ra(t);h.setNext(_);y=new aU(t);_.setNext(y);f=new rs(t);y.setNext(f);p=new a4(t);f.setNext(p);v=new nN(t);p.setNext(v);g=t.match.getMatchState();return[4,d.processAsync(g)];case 1:m.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Bn}(nh);l(ro,"FinishChallengeMatchConcrete");var rc=ro;var rl=/*#__PURE__*/function(e){_inherits(jn,e);function jn(e){_class_call_check(this,jn);var t;t=_call_super(this,jn,[e]),t.name="ContextAreSolo",t.message=null!=e?e:"Context are solo";return t}return jn}(_wrap_native_super(Error));l(rl,"ContextAreSolo");var ru=rl;var rd=/*#__PURE__*/function(e){_inherits(Kn,e);function Kn(e){_class_call_check(this,Kn);var t;t=_call_super(this,Kn,[e]),t.name="ContextNotChallenge",t.message=null!=e?e:"Context is not a challenge";return t}return Kn}(_wrap_native_super(Error));l(rd,"ContextNotChallenge");var rh=rd;var r_=/*#__PURE__*/function(e){_inherits(Wn,e);function Wn(e){_class_call_check(this,Wn);var t;t=_call_super(this,Wn,[e]),t.name="NetworkFailure",t.message=null!=e?e:"Network failure";return t}return Wn}(_wrap_native_super(Error));l(r_,"NetworkFailure");var ry=r_;var rf=r.Utils,rp=r.Dtos,rv=rf.Array,rg=rf.Object,rm=/*#__PURE__*/function(e){_inherits(zn,e);function zn(e,t){_class_call_check(this,zn);var r;r=_call_super(this,zn,[e]);u(r,"payload");r.payload=t;return r}_create_class(zn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(zn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.checkCurrentContext();return[4,r.getOpponentIdFromContextAsync()];case 1:t=c.sent();e.customData.opponentId=t;return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"checkCurrentContext",value:function checkCurrentContext(){var e=GameSDK.context.getID();if("string"!=typeof e)throw new n3;if("SOLO"===e)throw new ru}},{key:"getOpponentIdFromContextAsync",value:function getOpponentIdFromContextAsync(){var e=this;return _async_to_generator(function(){var t,r,c,d;return _ts_generator(this,function(h){switch(h.label){case 0:t=e.payload,r=t.ignoreId;return[4,e.getContextPlayers([r])];case 1:c=h.sent();if(c.length>1)throw new rh;d=G;return[2,(1===c.length&&(d=c[0]),d.playerId)]}})})()}},{key:"getContextPlayers",value:function getContextPlayers(e){return _async_to_generator(function(){var t,r,c,d,h,_,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,2,,3]);return[4,GameSDK.context.getPlayersAsync()];case 1:t=A.sent(),r=[];c=true,d=false,h=void 0;try{for(_=t[Symbol.iterator]();!(c=(y=_.next()).done);c=true){f=y.value;p=f.getID();if(!(e.indexOf(p)>-1)){v=f.getName();if(!!v){g=f.getPhoto();r.push(new rp.Player.Info({playerId:p,name:v,photo:g}).toObject())}}}}catch(e){d=true;h=e}finally{try{if(!c&&null!=_.return)_.return()}finally{if(d)throw h}}return[2,rv.unique(r)];case 2:m=A.sent();if(rg.hasOwn(m,"code")&&"NETWORK_FAILURE"===m.code)throw new ry;return[2,[]];case 3:return[2]}})})()}}]);return zn}(nw);l(rm,"GetOpponentChallengeContextHandler");var rA=rm;var rw=/*#__PURE__*/function(e){_inherits(Hn,e);function Hn(e){_class_call_check(this,Hn);var t;t=_call_super(this,Hn,[e]),t.name="ContextIsTournament",t.message=null!=e?e:"Context is a tournament";return t}return Hn}(_wrap_native_super(Error));l(rw,"ContextIsTournament");var rI=rw;var rb=r.Utils,rk=rb.Object,rS=/*#__PURE__*/function(e){_inherits(qn,e);function qn(){_class_call_check(this,qn);return _call_super(this,qn,arguments)}_create_class(qn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(qn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.chooseAsync()];case 1:t=c.sent();return[4,r.checkContextTournament()];case 2:c.sent(),e.customData.contextId=t;return[4,r.nextAsync(e)];case 3:c.sent();return[2]}})})()}},{key:"chooseAsync",value:function chooseAsync(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})];case 1:r.sent();return[3,3];case 2:e=r.sent();if(!rk.hasOwn(e,"code")||"SAME_CONTEXT"!==e.code)throw e;return[3,3];case 3:t=GameSDK.context.getID();if("string"!=typeof t)throw new ao;return[2,t]}})})()}},{key:"checkContextTournament",value:function checkContextTournament(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,4,,5]);if(!GameSDK.context.getID())return[2];if(!("getTournamentAsync"in GameSDK))return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:e=(r.sent(),new rI);return[3,3];case 2:e=new n0("getTournamentAsync");r.label=3;case 3:throw e;case 4:t=r.sent();if(_instanceof(t,rI))throw t;return[3,5];case 5:return[2]}})})()}}]);return qn}(nw);l(rS,"ChooseContextHandler");var rD=rS;var rP=/*#__PURE__*/function(e){_inherits(Yn,e);function Yn(){_class_call_check(this,Yn);return _call_super(this,Yn,arguments)}_create_class(Yn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=new n7(t),d=new rD(t);c.setNext(d);h=new nX(t,{mode:_.CHALLENGE_FRIEND,customData:{playerId:r}});d.setNext(h);y=new rA(t,{ignoreId:r});h.setNext(y);f=new av(t,{extraData:e.extraData});y.setNext(f);p=new at(t);f.setNext(p);v=new am(t);p.setNext(v);g=new nE(t);v.setNext(g);m=new aw(t);g.setNext(m);A=new nN(t);m.setNext(A);w=t.match.getMatchState();return[4,c.processAsync(w)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Yn}(nh);l(rP,"InviteFriendsConcrete");var rE=rP;var rC=/*#__PURE__*/function(e){_inherits(Qn,e);function Qn(e){_class_call_check(this,Qn);var t;t=_call_super(this,Qn,[e]),t.name="JoinMatchFailed",t.message=null!=e?e:"Join match failed";return t}return Qn}(_wrap_native_super(Error));l(rC,"JoinMatchFailed");var rx=rC;var rN=/*#__PURE__*/function(e){_inherits(Xn,e);function Xn(e){_class_call_check(this,Xn);var t;t=_call_super(this,Xn,[e]),t.name="MatchAreFinished",t.message=null!=e?e:"Match are finished";return t}return Xn}(_wrap_native_super(Error));l(rN,"MatchAreFinished");var rT=rN;var rM=/*#__PURE__*/function(e){_inherits(Jn,e);function Jn(e){_class_call_check(this,Jn);var t;t=_call_super(this,Jn,[e]),t.name="OtherPlayerHasJoinedMatch",t.message=null!=e?e:"Other player has joined match";return t}return Jn}(_wrap_native_super(Error));l(rM,"OtherPlayerHasJoinedMatch");var rL=rM;var rO=r.Dtos,rR=/*#__PURE__*/function(e){_inherits(Zn,e);function Zn(){_class_call_check(this,Zn);return _call_super(this,Zn,arguments)}_create_class(Zn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Zn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.joinMatchAsync(e)];case 1:t=d.sent(),c=new rO.Match.Data(t).toObject();r.validateJoinMatchData(e,c),r.updateMatchData(e,c);return[4,r.nextAsync(e)];case 2:d.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status;if(t!==nC.OPEN)throw new ay}},{key:"validateJoinMatchData",value:function validateJoinMatchData(e,t){var r=e.id,c=e.customData,d=t._id,h=t.blackPlayerId,_=t.whitePlayerId,y=t.whitePlayerFinish,f=t.blackPlayerFinish,p=h===c.playerId,v=_===c.opponentId;if("string"!=typeof d||d!==r||!v)throw console.warn("\uD83E\uDD16 ? matchData",t),new rx;if(y&&f)throw new rT;if(!p)throw new rL}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){r=e.id;return[2,r?t.match.api.getMatchAPI().joinMatchAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,c=t.whitePlayerId,d=t.blackPlayerId,h=t.whitePlayerScore,_=t.blackPlayerScore,y=t.whitePlayerFinish,f=t.blackPlayerFinish,p=c===r.playerId,v=p?c:d,g=p?d:c;e.customData.playerId=v,e.customData.opponentId=g,e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});var m=p?h:_,A=p?_:h;e.profiles[v].score=m,e.profiles[g].score=A;var w=p?y:f,I=p?f:y;e.profiles[v].finished=w,e.profiles[g].finished=I}}]);return Zn}(nw);l(rR,"JoinMatchHandler");var rG=rR;var rF=/*#__PURE__*/function(e){_inherits(ti,e);function ti(){_class_call_check(this,ti);return _call_super(this,ti,arguments)}_create_class(ti,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ti.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesAcceptedAsync(e)];case 1:t=c.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,d=r.opponentId;if(!t||"string"!=typeof t)throw new nG;if(!c||"string"!=typeof c)throw new n3;if(!d||"string"!=typeof d)throw new nj}},{key:"createWideframesAcceptedAsync",value:function createWideframesAcceptedAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A,w,I,b,k,S,D;return _ts_generator(this,function(P){switch(P.label){case 0:P.trys.push([0,4,,5]);r=t.game,c=r.frameCapture,d=e.profiles,h=e.customData,_=h.playerId,y=h.opponentId;if(!_||!y)return[2,null];f=d[_],p=d[y],v=f.photo,g=f.score,m=void 0===g?0:g,A=f.finished;if(A)return[2,null];w=p.photo,I=p.score,b=void 0===I?0:I,k=p.finished;if(!k)return[3,2];return[4,c.wideframe.renderResultChallenge({playerId:_,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:w,opponentScore:b,isPlayerFinished:!1,isOpponentFinished:!0})];case 1:S=P.sent();return[3,3];case 2:S=null;P.label=3;case 3:return[2,S];case 4:D=P.sent();return[2,(console.warn("createWideframesAcceptedAsync",D),null)];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,c=e.profiles,d=e.customData,h=d.playerId,_=d.opponentId;if(!h||"string"!=typeof h)throw new j;if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");y=c[h],f=y.name,p={data:{type:nZ.CHALLENGE_FRIEND,matchId:r,playerId:h,opponentId:_},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(f," accepted the challenge."),localizations:{vi_VN:"".concat(f," đ\xe3 chấp nhận tham gia trận đấu.")}},image:t,strategy:"LAST",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}}]);return ti}(nw);l(rF,"SendAcceptedMessageHandler");var rB=rF;var rV=/*#__PURE__*/function(e){_inherits(ei,e);function ei(){_class_call_check(this,ei);return _call_super(this,ei,arguments)}_create_class(ei,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,c=e.playerId,d=e.opponentId,h=new n7(t),y=new nX(t,{id:r,mode:_.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:d}});h.setNext(y);f=new rG(t);y.setNext(f);p=new at(t);f.setNext(p);v=new am(t);p.setNext(v);g=new rB(t);v.setNext(g);m=new nE(t);g.setNext(m);A=new nN(t);m.setNext(A);w=t.match.getMatchState();return[4,h.processAsync(w)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return ei}(nh);l(rV,"JoinChallengeMatchConcrete");var rj=rV;var rU={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},rH=r.Utils,rK=rH.Valid,rW="is invalid",rz=/*#__PURE__*/function(e){_inherits(si,e);function si(){_class_call_check(this,si);return _call_super(this,si,arguments)}_create_class(si,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){rK.isString(e)&&e||this.exception("_id",rW)}},{key:"validateStatus",value:function validateStatus(e){rK.isString(e)&&e||this.exception("status",rW)}},{key:"validateWinnerId",value:function validateWinnerId(e){null===e||rK.isString(e)&&e||this.exception("winnerId",rW)}},{key:"validateWhitePlayerId",value:function validateWhitePlayerId(e){rK.isString(e)&&e||this.exception("whitePlayerId",rW)}},{key:"validateBlackPlayerId",value:function validateBlackPlayerId(e){rK.isString(e)&&e||this.exception("blackPlayerId",rW)}},{key:"validateWhitePlayerScore",value:function validateWhitePlayerScore(e){rK.isNumber(e)||this.exception("whitePlayerScore",rW)}},{key:"validateBlackPlayerScore",value:function validateBlackPlayerScore(e){rK.isNumber(e)||this.exception("blackPlayerScore",rW)}},{key:"validateWhitePlayerFinish",value:function validateWhitePlayerFinish(e){rK.isBoolean(e)||this.exception("whitePlayerFinish",rW)}},{key:"validateBlackPlayerFinish",value:function validateBlackPlayerFinish(e){rK.isBoolean(e)||this.exception("blackPlayerFinish",rW)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(si.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return rU}}]);return si}(S);l(rz,"RespMatchDataDtos");var rq=rz;rq.addDefaultData(rU);var rY=/*#__PURE__*/function(e){_inherits(ai,e);function ai(e){_class_call_check(this,ai);var t;t=_call_super(this,ai,[e]),t.name="MatchAreNotFinished",t.message=e||"Match are not finished";return t}return ai}(_wrap_native_super(Error));l(rY,"MatchAreNotFinished");var rJ=rY;var rQ=/*#__PURE__*/function(e){_inherits(ni,e);function ni(e){_class_call_check(this,ni);var t;t=_call_super(this,ni,[e]),t.name="OpponentNotFinishedMatch",t.message=e||"Opponent not finished match";return t}return ni}(_wrap_native_super(Error));l(rQ,"OpponentNotFinishedMatch");var rX=rQ;var rZ=/*#__PURE__*/function(e){_inherits(ii,e);function ii(){_class_call_check(this,ii);return _call_super(this,ii,arguments)}_create_class(ii,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ii.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=d.sent(),c=new rq(t).toObject();r.validateResultMatchData(e,c),r.updateMatchData(e,c),r.validatePlayerTurn(e),r.validateOpponentTurn(e);return[4,r.nextAsync(e)];case 2:d.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id;if("string"!=typeof t)throw new nG}},{key:"validateResultMatchData",value:function validateResultMatchData(e,t){var r=e.id,c=t._id,d=t.whitePlayerFinish,h=t.blackPlayerFinish;if("string"!=typeof c||c!==r)throw new nM;if(!d&&!h)throw new rJ}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,c=r.playerId;if("string"!=typeof c)throw new j;var d=t[c],h=d.finished;if(!h)throw new nW}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,r=e.customData,c=r.opponentId;if("string"!=typeof c)throw new nj;var d=t[c],h=d.finished;if(!h)throw new rX}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,c=t.whitePlayerId,d=t.blackPlayerId,h=t.whitePlayerScore,_=t.blackPlayerScore,y=t.whitePlayerFinish,f=t.blackPlayerFinish,p=c===r.playerId,v=p?c:d,g=p?d:c;e.customData.playerId=v,e.customData.opponentId=g,e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!0}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!0});var m=p?h:_,A=p?_:h;e.profiles[v].score=m,e.profiles[g].score=A;var w=p?y:f,I=p?f:y;e.profiles[v].finished=w,e.profiles[g].finished=I}}]);return ii}(nw);l(rZ,"ResultMatchHandler");var r$=rZ;var r0=/*#__PURE__*/function(e){_inherits(oi,e);function oi(){_class_call_check(this,oi);return _call_super(this,oi,arguments)}_create_class(oi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,c=e.playerId,d=e.opponentId,h=new n7(t),y=new nX(t,{id:r,mode:_.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:d}});h.setNext(y);f=new r$(t);y.setNext(f);p=new at(t);f.setNext(p);v=new nN(t);p.setNext(v);g=t.match.getMatchState();return[4,h.processAsync(g)];case 1:m.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return oi}(nh);l(r0,"ResultChallengeMatchConcrete");var r2=r0;var r3=/*#__PURE__*/function(e){_inherits(ri,e);function ri(){_class_call_check(this,ri);var e;var t;e=_call_super(this,ri,arguments),t=e;u(e,"fallbackSingleMode");u(e,"startFLowChallengeFriend",l(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,3]);return[4,t.match.challenge.invite.processAsync(e)];case 1:return[2,(c.sent(),!0)];case 2:r=c.sent();return[2,r];case 3:return[2]}})});return function(t){return e.apply(this,arguments)}}(),"startFLowChallengeFriend"));u(e,"startFlowTournament",l(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,4]);r=GameSDK.context.getID();if("string"!=typeof r)throw new n3;return[4,t.match.tournament.continue.processAsync({playerId:e,contextId:r})];case 1:c.sent();return[3,4];case 2:c.sent();return[4,t.startFlowSingle(e)];case 3:c.sent();return[3,4];case 4:return[2]}})});return function(t){return e.apply(this,arguments)}}(),"startFlowTournament"));u(e,"startFlowSingle",l(/*#__PURE__*/function(){var e=_async_to_generator(function(e){return _ts_generator(this,function(r){switch(r.label){case 0:if(!t.fallbackSingleMode){console.warn("Fallback single mode is not enabled");return[2]}return[4,t.match.single.start.processAsync({playerId:e})];case 1:r.sent();return[2]}})});return function(t){return e.apply(this,arguments)}}(),"startFlowSingle"));return e}_create_class(ri,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,,6,7]);t.startLog(e);r=e.playerId,c=e.extraData,d=e.fallbackSingleMode;t.fallbackSingleMode=d;return[4,t.startFLowChallengeFriend({playerId:r,extraData:c})];case 1:h=_.sent();if(!0===h)return[2];if(!_instanceof(h,rI))return[3,3];return[4,t.startFlowTournament(r)];case 2:_.sent();return[3,5];case 3:return[4,t.startFlowSingle(r)];case 4:_.sent();_.label=5;case 5:return[3,7];case 6:t.endLog();return[7];case 7:return[2]}})})()}}]);return ri}(nh);l(r3,"ChooseContextConcrete");var r1=r3;var r4=r.Utils,r5=r4.Valid,r7=r.Configs,r6=r7.Leaderboards,r8=/*#__PURE__*/function(e){_inherits(ci,e);function ci(e){_class_call_check(this,ci);return _call_super(this,ci,[e,{score:0,leaderboardId:r6.LeaderboardEndlessId}])}_create_class(ci,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(ci.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,c,d,h,_;return _ts_generator(this,function(y){t=e.profiles,c=e.customData,d=c.playerId;if(!d||!t[d])throw new n8;h=t[d],_=h.endlessScore;if(!r5.isNumber(_))throw new aK;r.payload.score=_,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return ci}(aZ);l(r8,"PostGlobalLeaderboardEndlessScoreHandler");var r9=r8;var se=/*#__PURE__*/function(e){_inherits(li,e);function li(){_class_call_check(this,li);return _call_super(this,li,arguments)}_create_class(li,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(li.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.setPlayerEndlessScore(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"setPlayerEndlessScore",value:function setPlayerEndlessScore(e){var t=e.profiles,r=e.customData,c=r.playerId;if(!c||!t[c])throw new n8;var d;var h=this.game,_=h.player,y=null!==(d=_.getBestEndlessScore())&&void 0!==d?d:0,f=t[c],p=f.endlessScore,v=void 0===p?0:p,g=y<v?v:y;_.setBestEndlessScore(g),t[c].bestEndlessScore=g}}]);return li}(nw);l(se,"SetPlayerEndlessScoreHandler");var st=se;var sa=/*#__PURE__*/function(e){_inherits(di,e);function di(){_class_call_check(this,di);return _call_super(this,di,arguments)}_create_class(di,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,,2,3]);e.startLog();t=new n7(e),r=new re(e,{useAPI:!1});t.setNext(r);c=new aU(e);r.setNext(c);d=new st(e);c.setNext(d);h=new r9(e);d.setNext(h);_=new nN(e);h.setNext(_);y=e.match.getMatchState();return[4,t.processAsync(y)];case 1:f.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return di}(nh);l(sa,"FinishEndlessConcrete");var sr=sa;var ss=/*#__PURE__*/function(e){_inherits(hi,e);function hi(e){_class_call_check(this,hi);var t;t=_call_super(this,hi,[e]),t.name="ProfileIdNotDefined",t.message=null!=e?e:"Profile id is not defined";return t}return hi}(_wrap_native_super(Error));l(ss,"ProfileIdNotDefined");var so=ss;var sc=r.Dtos,sl=/*#__PURE__*/function(e){_inherits(ui,e);function ui(e,t){_class_call_check(this,ui);var r;r=_call_super(this,ui,[e]);u(r,"payload");r.payload=t;return r}_create_class(ui,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ui.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.profileId;if(!c)throw new so;d=r.game,h=d.player,_=h.getPlayerId();if(c!==_)return[3,1];y=r.getPlayerProfile();return[3,3];case 1:return[4,r.getProfileAsync(c)];case 2:if(y=f.sent(),!y)throw new n8;f.label=3;case 3:r.updateMatchData(y,e);return[4,r.nextAsync(e)];case 4:f.sent();return[2]}})})()}},{key:"getPlayerProfile",value:function getPlayerProfile(){var e=this.game,t=e.player,r=t.getPlayer(),c=r.playerId,d=r.name,h=r.photo,_=r.locale;return{playerId:c,name:d,photo:h,locale:_}}},{key:"getProfileAsync",value:function getProfileAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r=t.game,c=r.profile;return[4,c.requestProfiles([e])];case 1:return[2,(d.sent(),c.getProfiles()[e])]}})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.playerId,c=e.name,d=e.photo,h=new sc.Match.Profile({id:r,name:c,photo:d}).toObject();t.profiles[r]=h}}]);return ui}(nw);l(sl,"GetProfileHandler");var su=sl;var sd=/*#__PURE__*/function(e){_inherits(yi,e);function yi(){_class_call_check(this,yi);return _call_super(this,yi,arguments)}_create_class(yi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=new n7(t),d=new aE(t,{contextId:"SOLO"});c.setNext(d);h=new nX(t,{id:"234567",mode:_.ENDLESS,customData:{playerId:r}});d.setNext(h);y=new am(t);h.setNext(y);f=new su(t,{profileId:r});y.setNext(f);p=new nE(t);f.setNext(p);v=new nN(t);p.setNext(v);g=t.match.getMatchState();return[4,c.processAsync(g)];case 1:m.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return yi}(nh);l(sd,"StartEndlessConcrete");var sh=sd;var s_=r.Utils,sy=s_.Valid,sf=/*#__PURE__*/function(e){_inherits(pi,e);function pi(e){_class_call_check(this,pi);return _call_super(this,pi,[e,{score:0,leaderboardId:""}])}_create_class(pi,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(pi.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,c,d,h,_,y;return _ts_generator(this,function(f){t=e.profiles,c=e.customData,d=c.playerId,h=c.leaderboardId;if(!h)throw new az;if(!d||!t[d])throw new n8;_=t[d],y=_.score;if(!sy.isNumber(y))throw new aK;r.payload.score=y,r.payload.leaderboardId=h,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return pi}(aZ);l(sf,"PostLeaderboardScoreHandler");var sp=sf;var sv=/*#__PURE__*/function(e){_inherits(fi,e);function fi(){_class_call_check(this,fi);return _call_super(this,fi,arguments)}_create_class(fi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(fi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e),r.progressSendGroupMessage(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,d=r.opponentId;if(!t||"string"!=typeof t)throw new nG;if(!c||"string"!=typeof c)throw new n3;if(!d||"string"!=typeof d)throw new nj}},{key:"createWideframesResultGroupAsync",value:function createWideframesResultGroupAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A,w,I,b;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);r=t.game,c=r.frameCapture,d=e.profiles,h=e.customData,_=h.playerId,y=h.opponentId;if(!_||!y)return[2,null];f=d[_],p=d[y],v=f.photo,g=f.score,m=void 0===g?0:g,A=p.photo,w=p.score,I=void 0===w?0:w;return[4,c.wideframe.renderResultChallenge({playerId:_,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:A,opponentScore:I,isPlayerFinished:!0,isOpponentFinished:!0})];case 1:return[2,k.sent()];case 2:b=k.sent();return[2,(console.warn("createWideframesResultGroupAsync",b),null)];case 3:return[2]}})})()}},{key:"createWideframesBestScoreAsync",value:function createWideframesBestScoreAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,2,,3]);r=t.game,c=r.player,d=r.frameCapture,h=e.customData,_=h.playerId,y=c.getPlayer(),f=y.playerId,p=y.photo,v=y.data;if(_!==f)return[2,null];g=v||{},m=g.score;return[4,d.wideframe.renderShareScore({playerId:f,playerPhoto:p,playerScore:m})];case 1:return[2,w.sent()];case 2:A=w.sent();return[2,(console.warn("createWideframesBestScoreAsync",A),null)];case 3:return[2]}})})()}},{key:"progressSendGroupMessage",value:function progressSendGroupMessage(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:r=e.profiles,c=e.customData,d=c.playerId,h=c.opponentId;if(!(h&&"string"==typeof h))return[3,2];if(!d||"string"!=typeof d)throw new j;_=r[d]||{},y=_.score,f=void 0===y?0:y,p=r[h]||{},v=p.score,g=void 0===v?0:v;if(!(f>g))return[3,2];return[4,t.createWideframesResultGroupAsync(e)];case 1:m=w.sent();if(!m)return[2];t.sendBestScoreMessageAsync(e,m);return[2];case 2:return[4,t.createWideframesBestScoreAsync(e)];case 3:A=w.sent();A&&t.sendChallengeMessageAsync(e,A);return[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){var r=this;return _async_to_generator(function(){var c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:c=e.profiles,d=e.customData,h=d.playerId;if(!h||"string"!=typeof h)throw new j;if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");_=c[h],y=_.name,f=_.score,p={data:{type:r.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:h,playerName:y,playerScore:f},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:"".concat(y," beats your high score. Their score: ").concat(f,"."),localizations:{vi_VN:"".concat(y," vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}},{key:"sendChallengeMessageAsync",value:function sendChallengeMessageAsync(e,t){var r=this;return _async_to_generator(function(){var c,d,h,_,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:c=e.profiles,d=e.customData,h=d.playerId;if(!h||"string"!=typeof h)throw new j;_=c[h],y=_.name,f=_.score,p={data:{type:r.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:h,playerName:y,playerScore:f},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," got ").concat(f," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(y," đ\xe3 đạt ").concat(f," điểm! Qu\xe1 dễ lu\xf4n. Chơi lại n\xe0o!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new n0("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}}]);return fi}(nw);l(sv,"SendGroupMessageHandler");var sg=sv;var sm=/*#__PURE__*/function(e){_inherits(gi,e);function gi(){_class_call_check(this,gi);return _call_super(this,gi,arguments)}_create_class(gi,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:p.trys.push([0,,2,3]);e.startLog();t=new n7(e),r=new re(e,{useAPI:!1});t.setNext(r);c=new sg(e);r.setNext(c);d=new aU(e);c.setNext(d);h=new rs(e);d.setNext(h);_=new sp(e);h.setNext(_);y=new nN(e);_.setNext(y);f=e.match.getMatchState();return[4,t.processAsync(f)];case 1:p.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return gi}(nh);l(sm,"FinishGroupConcrete");var sA=sm;var sw=r.Dtos,sI=/*#__PURE__*/function(e){_inherits(wi,e);function wi(e,t){_class_call_check(this,wi);var r;r=_call_super(this,wi,[e]);u(r,"payload");r.payload=t;return r}_create_class(wi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(wi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.updateProfileMatchData(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"updateProfileMatchData",value:function updateProfileMatchData(e){var t=this.payload,r=t.id,c=e.profiles;if(!c[r])throw new n8;var d=_object_spread({},c[r],this.payload),h=new sw.Match.Profile(d).toObject();c[h.id]=h}}]);return wi}(nw);l(sI,"SetProfileDataHandler");var sb=sI;var sk=/*#__PURE__*/function(e){_inherits(mi,e);function mi(){_class_call_check(this,mi);return _call_super(this,mi,arguments)}_create_class(mi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.opponentId,d=e.opponentScore,h=new n7(t),y=new nX(t,{id:"7749",mode:_.MATCHING_GROUP,customData:{playerId:r,opponentId:c}});h.setNext(y);f=new at(t);y.setNext(f);p=new sb(t,{id:r,score:d});f.setNext(p);v=new am(t);p.setNext(v);g=new nE(t);v.setNext(g);m=new nN(t);g.setNext(m);A=t.match.getMatchState();return[4,h.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return mi}(nh);l(sk,"JoinGroupConcrete");var sS=sk;var sD=/*#__PURE__*/function(e){_inherits(Ai,e);function Ai(e){_class_call_check(this,Ai);var t;t=_call_super(this,Ai,[e]),t.name="MatchGroupNotSupported",t.message=null!=e?e:"Match group is not supported";return t}return Ai}(_wrap_native_super(Error));l(sD,"MatchGroupNotSupported");var sP=sD;var sE=/*#__PURE__*/function(e){_inherits(Ii,e);function Ii(e,t){_class_call_check(this,Ii);var r;r=_call_super(this,Ii,[e]);u(r,"payload");r.payload=t;return r}_create_class(Ii,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ii.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.checkMatchGroupSupported()];case 1:c.sent();return[4,r.matchingGroup()];case 2:t=c.sent();e.customData.contextId=t;return[4,r.nextAsync(e)];case 3:c.sent();return[2]}})})()}},{key:"checkMatchGroupSupported",value:function checkMatchGroupSupported(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:if(!("getSupportedAPIs"in GameSDK))throw new n0("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new n0("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new sP;return[4,GameSDK.extra.checkCanPlayerMatchAsync()];case 1:if(!e.sent())throw new sP;return[2]}})})()}},{key:"matchingGroup",value:function matchingGroup(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:if(!("matchPlayerAsync"in GameSDK.extra))throw new n0("matchPlayerAsync");t=e.payload,r=t.matchTag,c=t.autoSwitch,d=void 0!==c&&c,h=t.onlyExisting,_=void 0!==h&&h;return[4,GameSDK.extra.matchPlayerAsync(r,d,_)];case 1:f.sent();y=GameSDK.context.getID();if("string"!=typeof y)throw new ao;return[2,y]}})})()}}]);return Ii}(nw);l(sE,"GroupContextHandler");var sC=sE;var sx=/*#__PURE__*/function(e){_inherits(Di,e);function Di(){_class_call_check(this,Di);return _call_super(this,Di,arguments)}_create_class(Di,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.matchTag,c=e.playerId,d=e.options,h=new n7(t),y=new sC(t,_object_spread({matchTag:r},d));h.setNext(y);f=new nX(t,{id:"7749",mode:_.MATCHING_GROUP,customData:{playerId:c}});y.setNext(f);p=new rA(t,{ignoreId:c});f.setNext(p);v=new am(t);p.setNext(v);g=new at(t);v.setNext(g);m=new nE(t);g.setNext(m);A=new nN(t);m.setNext(A);w=t.match.getMatchState();return[4,h.processAsync(w)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Di}(nh);l(sx,"StartGroupConcrete");var sN=sx;var sT=/*#__PURE__*/function(e){_inherits(Pi,e);function Pi(){_class_call_check(this,Pi);return _call_super(this,Pi,arguments)}_create_class(Pi,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,,2,3]);e.startLog();t=new n7(e),r=new re(e,{useAPI:!1});t.setNext(r);c=new aU(e);r.setNext(c);d=new rs(e);c.setNext(d);h=new a4(e);d.setNext(h);_=new nN(e);h.setNext(_);y=e.match.getMatchState();return[4,t.processAsync(y)];case 1:f.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return Pi}(nh);l(sT,"FinishSingleConcrete");var sM=sT;var sL=/*#__PURE__*/function(e){_inherits(Ei,e);function Ei(){_class_call_check(this,Ei);return _call_super(this,Ei,arguments)}_create_class(Ei,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=new n7(t),d=new aE(t,{contextId:"SOLO"});c.setNext(d);h=new nX(t,{id:"123456",mode:_.SINGLE,customData:{playerId:r}});d.setNext(h);y=new am(t);h.setNext(y);f=new su(t,{profileId:r});y.setNext(f);p=new nE(t);f.setNext(p);v=new nN(t);p.setNext(v);g=t.match.getMatchState();return[4,c.processAsync(g)];case 1:m.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Ei}(nh);l(sL,"StartSingleConcrete");var sO=sL;var sR=r.Plugins,sG=r.Utils,sF=sR.Analytics,sB=sG.String,sV=sG.Valid,sj=/*#__PURE__*/function(e){_inherits(xi,e);function xi(){_class_call_check(this,xi);return _call_super(this,xi,arguments)}_create_class(xi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(xi.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,c=e.customData;r.validateMode(t);d=r.game,h=d.analytics,_=c.tournamentId,y=c.leaderboardId;h.event(sF.Events.TOURNAMENT_START,{success:!0,game_mode:sB.toUpperCamelCase(t),tournament_id:_,leaderboard_id:y});return[4,r.nextAsync(e)];case 1:f.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!sV.isString(e))throw new np}}]);return xi}(nw);l(sj,"LogTournamentStartHandler");var sU=sj;var sH=/*#__PURE__*/function(e){_inherits(vi,e);function vi(e){_class_call_check(this,vi);var t;t=_call_super(this,vi,[e]),t.name="TournamentIdNotValid",t.message=null!=e?e:"Tournament id is not valid";return t}return vi}(_wrap_native_super(Error));l(sH,"TournamentIdNotValid");var sK=sH;var sW=r.Utils,sz=sW.Valid,sq=/*#__PURE__*/function(e){_inherits(Si,e);function Si(e,t){_class_call_check(this,Si);var r;r=_call_super(this,Si,[e]);u(r,"payload");r.payload=t;return r}_create_class(Si,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Si.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.contextId;r.validateContextId(c);return[4,GameSDK.getTournamentAsync()];case 1:d=f.sent(),h=d.getID().toString();r.validateTournamentId(h);_=JSON.parse(d.getPayload()||"{}"),y=_.leaderboardId;r.validateLeaderboardId(y),e.customData.contextId=c,e.customData.tournamentId=h,e.customData.leaderboardId=y;return[4,r.nextAsync(e)];case 2:f.sent();return[2]}})})()}},{key:"validateContextId",value:function validateContextId(e){if(!sz.isString(e))throw new n3}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!sz.isString(e))throw new sK}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!sz.isString(e)||""===e)throw new az}}]);return Si}(nw);l(sq,"ContinueTournamentHandler");var sY=sq;var sJ=/*#__PURE__*/function(e){_inherits(bi,e);function bi(){_class_call_check(this,bi);return _call_super(this,bi,arguments)}_create_class(bi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.contextId,d=new n7(t),h=new sY(t,{contextId:c});d.setNext(h);y=new nX(t,{id:"1997",mode:_.TOURNAMENT,customData:{playerId:r}});h.setNext(y);f=new am(t);y.setNext(f);p=new su(t,{profileId:r});f.setNext(p);v=new nE(t);p.setNext(v);g=new sU(t);v.setNext(g);m=new nN(t);v.setNext(m);A=t.match.getMatchState();return[4,d.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return bi}(nh);l(sJ,"ContinueTournamentConcrete");var sQ=sJ;var sX=r.Plugins,sZ=sX.Analytics,s$=/*#__PURE__*/function(e){_inherits(Ni,e);function Ni(){_class_call_check(this,Ni);return _call_super(this,Ni,arguments)}_create_class(Ni,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ni.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h,_;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e);t=e.customData,c=r.game,d=c.analytics,h=t.tournamentId,_=t.leaderboardId;d.event(sZ.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:h,leaderboard_id:_});return[4,r.nextAsync(e)];case 1:y.sent();return[2]}})})()}}]);return Ni}(nw);l(s$,"LogTournamentCreateHandler");var s0=s$;var s2=/*#__PURE__*/function(e){_inherits(Li,e);function Li(e,t){_class_call_check(this,Li);var r;r=_call_super(this,Li,[e]);u(r,"payload");r.payload=t;return r}_create_class(Li,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Li.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.createTournamentAsync()];case 1:t.sent();return[4,r.updateMatchStateAsync(e)];case 2:t.sent();return[4,r.nextAsync(e)];case 3:t.sent();return[2]}})})()}},{key:"createTournamentAsync",value:function createTournamentAsync(){var e=this;return _async_to_generator(function(){var t,r,c,d;return _ts_generator(this,function(h){switch(h.label){case 0:t=e.payload,r=t.name,c=t.score,d=t.customData;return[4,GameSDK.tournament.createAsync({initialScore:c,config:{title:r,tournamentTitle:r},data:d})];case 1:h.sent();return[2]}})})()}},{key:"updateMatchStateAsync",value:function updateMatchStateAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,2,,3]);if(!("getTournamentAsync"in GameSDK))throw new n0("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 1:r=f.sent(),c=r.getContextID(),d=r.getID().toString(),h=t.payload,_=h.playerId;e.customData.playerId=_,e.customData.contextId=c,e.customData.tournamentId=d;return[3,3];case 2:y=f.sent();if(_instanceof(y,n0))return[2];return[3,3];case 3:return[2]}})})()}}]);return Li}(nw);l(s2,"CreateTournamentHandler");var s3=s2;var s1=r.Utils,s4=s1.Valid,s5=/*#__PURE__*/function(e){_inherits(Ti,e);function Ti(e,t){_class_call_check(this,Ti);var r;r=_call_super(this,Ti,[e]);u(r,"payload");u(r,"leaderboardPayload");r.payload=t;return r}_create_class(Ti,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ti.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validatePayload();return[4,r.setupCreatePayload(e)];case 1:t.sent();return[4,r.createLeaderboardAsync(e)];case 2:t.sent();return[4,r.nextAsync(e)];case 3:t.sent();return[2]}})})()}},{key:"validatePayload",value:function validatePayload(){var e=this.payload,t=e.leaderboardId;if(!s4.isString(t))throw new az}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!s4.isString(e))throw new j}},{key:"setupCreatePayload",value:function setupCreatePayload(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y;return _ts_generator(this,function(f){r=e.customData,c=r.playerId;t.validatePlayerId(c);d=t.payload,h=d.name,_=d.leaderboardId,y=d.customData;t.leaderboardPayload={_id:_,name:null!=h?h:"",createdBy:c,description:JSON.stringify(y)};return[2]})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,t.game.leaderboard.createLeaderboardAsync(t.leaderboardPayload)];case 1:r=c.sent();e.customData.leaderboardId=r;return[2]}})})()}}]);return Ti}(nw);l(s5,"CreateLeaderboardHandler");var s7=s5;var s6=/*#__PURE__*/function(e){_inherits(Ci,e);function Ci(){_class_call_check(this,Ci);return _call_super(this,Ci,arguments)}_create_class(Ci,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A,w,I;return _ts_generator(this,function(b){switch(b.label){case 0:b.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.name,d=e.score,h=e.leaderboardId,_=e.payload,y=new n7(t),f=new aE(t,{contextId:"SOLO"});y.setNext(f);p=new s3(t,{name:c,score:d,playerId:r,customData:_});f.setNext(p);v=new su(t,{profileId:r});p.setNext(v);g=new sb(t,{id:r,score:d});v.setNext(g);m=new s7(t,{name:c,customData:_,leaderboardId:h});g.setNext(m);A=new sp(t);m.setNext(A);w=new s0(t);A.setNext(w);I=t.match.getMatchState();return[4,y.processAsync(I)];case 1:b.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Ci}(nh);l(s6,"CreateTournamentConcrete");var s8=s6;var s9=r.Plugins,ie=s9.Analytics,it=r.Utils,ia=it.Valid,ir=/*#__PURE__*/function(e){_inherits(Oi,e);function Oi(e,t){_class_call_check(this,Oi);var r;r=_call_super(this,Oi,[e]);u(r,"payload");r.payload=t;return r}_create_class(Oi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Oi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.postScoreTournamentAsync(e)];case 1:t.sent();return[4,r.nextAsync(e)];case 2:t.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.profiles,r=e.customData,c=r.playerId;if(this.validatePlayerId(c),!t[c])throw new n8}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!ia.isString(e))throw new j}},{key:"getPlayerProfile",value:function getPlayerProfile(e){var t=e.profiles,r=e.customData,c=r.playerId;return this.validatePlayerId(c),t[c]}},{key:"isNewBestScore",value:function isNewBestScore(e){var t=this.getPlayerProfile(e),r=t.score,c=void 0===r?0:r,d=t.bestScore,h=void 0===d?0:d;return c>h}},{key:"postScoreTournamentAsync",value:function postScoreTournamentAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:r=window.game,c=r.analytics,d=t.getPlayerProfile(e),h=d.score,_=void 0===h?0:h;y=null,f=!1;p=t.payload,v=p.checkBestScore,g=t.isNewBestScore(e);A.label=1;case 1:A.trys.push([1,7,8,9]);if(!("getTournamentAsync"in GameSDK))throw new n0("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 2:A.sent();if(!(!v||g))return[3,4];y=ie.Events.TOURNAMENT_SHARE;return[4,GameSDK.tournament.shareAsync({score:_})];case 3:A.sent();return[3,6];case 4:y=ie.Events.TOURNAMENT_POST_SCORE;return[4,GameSDK.tournament.postScoreAsync(_)];case 5:A.sent();A.label=6;case 6:f=!0;return[3,9];case 7:m=A.sent();console.warn("Post Score Tournament",m);return[3,9];case 8:y&&c.event(y,{success:f});return[7];case 9:return[2]}})})()}}]);return Oi}(nw);l(ir,"PostScoreTournamentHandler");var is=ir;var io=/*#__PURE__*/function(e){_inherits(Mi,e);function Mi(){_class_call_check(this,Mi);return _call_super(this,Mi,arguments)}_create_class(Mi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_,y,f,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.bestScore,d=new n7(t),h=new re(t,{useAPI:!1});d.setNext(h);_=new sb(t,{id:r,bestScore:c});h.setNext(_);y=new is(t,{checkBestScore:!1});_.setNext(y);f=new aU(t);y.setNext(f);p=new rs(t);f.setNext(p);v=new sp(t);p.setNext(v);g=new a4(t);v.setNext(g);m=new nN(t);g.setNext(m);A=t.match.getMatchState();return[4,d.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Mi}(nh);l(io,"FinishTournamentConcrete");var ic=io;var il=r.Utils,iu=il.Valid,id=il.Object,ih=/*#__PURE__*/function(e){_inherits(Ri,e);function Ri(e,t){_class_call_check(this,Ri);var r;r=_call_super(this,Ri,[e]);u(r,"payload");r.payload=t;return r}_create_class(Ri,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ri.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,d,h,_,y;return _ts_generator(this,function(f){switch(f.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.tournamentId;r.validateTournamentId(c);return[4,r.joinTournamentAsync(c)];case 1:f.sent();return[4,GameSDK.getTournamentAsync()];case 2:d=f.sent(),h=d.getContextID();r.validateContextId(h);_=JSON.parse(d.getPayload()||"{}"),y=_.leaderboardId;r.validateLeaderboardId(y),e.customData.contextId=h,e.customData.tournamentId=c,e.customData.leaderboardId=y;return[4,r.nextAsync(e)];case 3:f.sent();return[2]}})})()}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!iu.isString(e))throw new sK}},{key:"validateContextId",value:function validateContextId(e){if(!iu.isString(e))throw new n3}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!iu.isString(e)||""===e)throw new az}},{key:"joinTournamentAsync",value:function joinTournamentAsync(e){return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!("tournament"in GameSDK))throw new n0("tournament");r.label=1;case 1:r.trys.push([1,3,,4]);return[4,GameSDK.tournament.joinAsync(e)];case 2:r.sent();return[3,4];case 3:t=r.sent();if(!id.hasOwn(t,"code")||"SAME_CONTEXT"!==t.code)throw t;return[3,4];case 4:return[2]}})})()}}]);return Ri}(nw);l(ih,"JoinTournamentHandler");var i_=ih;var iy=/*#__PURE__*/function(e){_inherits(_i,e);function _i(){_class_call_check(this,_i);return _call_super(this,_i,arguments)}_create_class(_i,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,d,h,y,f,p,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.tournamentId,d=new n7(t),h=new i_(t,{tournamentId:c});d.setNext(h);y=new nX(t,{id:"1997",mode:_.TOURNAMENT,customData:{playerId:r}});h.setNext(y);f=new am(t);y.setNext(f);p=new su(t,{profileId:r});f.setNext(p);v=new nE(t);p.setNext(v);g=new sU(t);v.setNext(g);m=new nN(t);g.setNext(m);A=t.match.getMatchState();return[4,d.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return _i}(nh);l(iy,"JoinTournamentConcrete");var ip=iy;var iv=r.Dtos,ig=r.Utils,im=ig.Object,iA=/*#__PURE__*/function(e){_inherits($i,e);function $i(e,t){_class_call_check(this,$i);var r;r=_call_super(this,$i,[e]);u(r,"payload");r.payload=t;return r}_create_class($i,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of($i.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.updateMatchCustomData(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e){var t=im.merge(e.customData,this.payload),r=new iv.Match.CustomData(t).toObject();e.customData=r}}]);return $i}(nw);l(iA,"SetMatchCustomDataHandler");var iw=iA;var iI={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:_object_spread({},nJ)},ib=r.Configs,ik=/*#__PURE__*/function(e){_inherits(Gi,e);function Gi(){_class_call_check(this,Gi);var e;e=_call_super(this,Gi,arguments);u(e,"base");u(e,"group");u(e,"single");u(e,"endless");u(e,"context");u(e,"challenge");u(e,"tournament");u(e,"api");u(e,"handler");u(e,"useCPUProfile");return e}_create_class(Gi,[{key:"init",value:function init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}},{key:"setUseCPUProfile",value:function setUseCPUProfile(e){this.useCPUProfile=e}},{key:"createMatchData",value:function createMatchData(){var e=this.game,t=e.storage;t.addStorage("match",iI)}},{key:"getMatchState",value:function getMatchState(){var e=this.game,t=e.storage;return t.getStorage("match")}},{key:"createBaseConcrete",value:function createBaseConcrete(){this.base=new nh(this.game,this)}},{key:"createConcreteFlows",value:function createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}},{key:"createConcreteHandlers",value:function createConcreteHandlers(){var e=this;this.handler={setProfileData:l(/*#__PURE__*/function(){var t=_async_to_generator(function(t){var r;return _ts_generator(this,function(c){switch(c.label){case 0:r=new sb(e.base,t);return[4,e.processHandlerAsync(r)];case 1:c.sent();return[2]}})});return function(e){return t.apply(this,arguments)}}(),"setProfileData"),setMatchCustomData:l(/*#__PURE__*/function(){var t=_async_to_generator(function(t){var r;return _ts_generator(this,function(c){switch(c.label){case 0:r=new iw(e.base,t);return[4,e.processHandlerAsync(r)];case 1:c.sent();return[2]}})});return function(e){return t.apply(this,arguments)}}(),"setMatchCustomData"),setLeaderboardScore:l(/*#__PURE__*/function(){var t=_async_to_generator(function(t){var r;return _ts_generator(this,function(c){switch(c.label){case 0:r=new aZ(e.base,t);return[4,e.processHandlerAsync(r)];case 1:c.sent();return[2]}})});return function(e){return t.apply(this,arguments)}}(),"setLeaderboardScore")}}},{key:"createAPIHandler",value:function createAPIHandler(){var e={appId:ib.AppId,matchAPIHost:ib.ApiHost};this.api=new nu(e)}},{key:"createGroupFlows",value:function createGroupFlows(){this.group={join:new sS(this.game,this),start:new sN(this.game,this),finish:new sA(this.game,this)}}},{key:"createSingleFlows",value:function createSingleFlows(){this.single={start:new sO(this.game,this),finish:new sM(this.game,this)}}},{key:"createEndlessFlows",value:function createEndlessFlows(){this.endless={start:new sh(this.game,this),finish:new sr(this.game,this)}}},{key:"createContextFlows",value:function createContextFlows(){this.context={choose:new r1(this.game,this)}}},{key:"createChallengeFlows",value:function createChallengeFlows(){this.challenge={invite:new rE(this.game,this),friend:new ab(this.game,this),join:new rj(this.game,this),await:new ar(this.game,this),result:new r2(this.game,this),finish:new rc(this.game,this),continue:new aO(this.game,this)}}},{key:"createTournamentFlows",value:function createTournamentFlows(){this.tournament={join:new ip(this.game,this),create:new s8(this.game,this),finish:new ic(this.game,this),continue:new sQ(this.game,this)}}},{key:"processHandlerAsync",value:function processHandlerAsync(e){var t=this.getMatchState();return e.processAsync(t)}}]);return Gi}(c.Plugins.BasePlugin);l(ik,"MatchPlugin");var iS=ik;var iD=r.Utils,iP=iD.Valid,iE="is invalid",iC=/*#__PURE__*/function(e){_inherits(Vi,e);function Vi(){_class_call_check(this,Vi);return _call_super(this,Vi,arguments)}_create_class(Vi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!iP.isNumber(e)||e<0)&&this.exception("level",iE)}},{key:"validateRescued",value:function validateRescued(e){(!iP.isNumber(e)||e<0)&&this.exception("rescued",iE)}},{key:"validateContextId",value:function validateContextId(e){iP.isString(e)||this.exception("contextId",iE)}},{key:"validatePlayerId",value:function validatePlayerId(e){iP.isString(e)||this.exception("playerId",iE)}},{key:"validateOpponentId",value:function validateOpponentId(e){iP.isString(e)||this.exception("opponentId",iE)}},{key:"validateTournamentId",value:function validateTournamentId(e){iP.isString(e)||this.exception("tournamentId",iE)}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){iP.isString(e)||this.exception("leaderboardId",iE)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Vi.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return S.getDefaultData()}}]);return Vi}(S);l(iC,"MatchCustomDataDtos");var ix=iC;ix.addDefaultData(nJ);var iN=r.Utils,iT=iN.Valid,iM="is invalid",iL=/*#__PURE__*/function(e){_inherits(ki,e);function ki(){_class_call_check(this,ki);return _call_super(this,ki,arguments)}_create_class(ki,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){iT.isString(e)&&e||this.exception("id",iM)}},{key:"validateName",value:function validateName(e){iT.isString(e)&&e||this.exception("name",iM)}},{key:"validatePhoto",value:function validatePhoto(e){iT.isString(e)||this.exception("photo",iM)}},{key:"validateScore",value:function validateScore(e){(!iT.isNumber(e)||e<0)&&this.exception("score",iM)}},{key:"validateBestScore",value:function validateBestScore(e){(!iT.isNumber(e)||e<0)&&this.exception("bestScore",iM)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!iT.isNumber(e)||e<0)&&this.exception("endlessScore",iM)}},{key:"validateBestEndlessScore",value:function validateBestEndlessScore(e){(!iT.isNumber(e)||e<0)&&this.exception("bestEndlessScore",iM)}},{key:"validateFinished",value:function validateFinished(e){iT.isBoolean(e)||this.exception("finished",iM)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(ki.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return S.getDefaultData()}}]);return ki}(S);l(iL,"MatchProfileDtos");var iO=iL;iO.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0}),r.Dtos.Match={Data:rq,CustomData:ix,Profile:iO};var iR=r.Utils,iG=r.Configs,iF=iG.ApiHost,iB=l(/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,r;return _ts_generator(this,function(c){switch(c.label){case 0:t="players";"MsGames"===GameSDK.getSDKName()&&(t="players?platform=ms-games");return[4,eh(t,e,{},iF,10)];case 1:r=c.sent();return[2,iR.Object.hasOwn(r,"data")?r.data||{}:{}]}})});return function(t){return e.apply(this,arguments)}}(),"updatePlayerProfileAsync"),iV=r.Utils,ij=r.Configs,iU=ij.AppId,iH=iV.Array,iK=iV.Object,iW=iV.Valid,iz=/*#__PURE__*/function(e){_inherits(Ui,e);function Ui(){_class_call_check(this,Ui);return _call_super(this,Ui,arguments)}_create_class(Ui,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("player",P)}},{key:"saveToCloud",value:function saveToCloud(){var e=this;return _async_to_generator(function(){var t,r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,3]);t=e.getPlayerData();return[4,GameSDK.player.setDataAsync(t)];case 1:c.sent();return[3,3];case 2:r=c.sent();console.warn(r);return[3,3];case 3:return[2]}})})()}},{key:"receiveData",value:function receiveData(e,t){var r=this.game,c=r.storage,d=e.playerId,h=e.name,_=e.photo,y=e.locale;c.setStorageData("player","playerId",d),c.setStorageData("player","name",h),c.setStorageData("player","photo",_),c.setStorageData("player","locale",y),t&&this.setPlayerData(t)}},{key:"syncProfileToServer",value:function syncProfileToServer(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:t=e.game,r=t.storage,c=e.getPlayer(),d=c.playerId,h=c.name,_=c.photo,y=c.locale;f=e.getPlayerASID();v=!iW.isString(f)&&"getASIDAsync"in GameSDK.player;if(!v)return[3,2];return[4,GameSDK.player.getASIDAsync()];case 1:v=(f=null!==(p=g.sent())&&void 0!==p?p:f,r.setStorageData("player","ASID","".concat(f)));g.label=2;case 2:return[4,iB({appId:iU,ASID:f,playerId:d,name:h,photo:_,locale:y})];case 3:g.sent();return[2]}})})()}},{key:"setPlayerDataByName",value:function setPlayerDataByName(e,t){this.setPlayerData(_define_property({},e,t))}},{key:"setPlayerData",value:function setPlayerData(e){var t=this.game,r=t.storage;r.setStorageData("player","data",e),this.saveToCloud()}},{key:"setBestScore",value:function setBestScore(e){this.setPlayerDataByName("score",e)}},{key:"setBestEndlessScore",value:function setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}},{key:"setSetting",value:function setSetting(e,t){this.setPlayerDataByName("settings",_define_property({},e,t))}},{key:"setGameData",value:function setGameData(e){var t;var r=null!==(t=this.getGameData())&&void 0!==t?t:{},c=iK.merge(r,e);this.setPlayerDataByName("gameData",c)}},{key:"requestConnectedPlayers",value:function requestConnectedPlayers(){var e=this;return _async_to_generator(function(){var t,r,c,d,h;return _ts_generator(this,function(_){switch(_.label){case 0:t=e.game,r=t.storage;return[4,GameSDK.player.getConnectedPlayersAsync()];case 1:c=_.sent().map(function(e){var t=e.getID(),r=e.getName(),c=e.getPhoto();return t&&r&&c?new R({playerId:t,name:r,photo:c}).toObject():null}),d=iH.unique(c);if(d.length<1)return[2];h=iK.keyBy(d,"playerId");r.setStorageData("player","connectedPlayers",h);return[2]}})})()}},{key:"getPlayer",value:function getPlayer(){var e=this.game,t=e.storage;return t.getStorage("player")}},{key:"getPlayerId",value:function getPlayerId(){var e=this.game,t=e.storage;return t.getStorageData("player","playerId")}},{key:"getPlayerASID",value:function getPlayerASID(){var e=this.game,t=e.storage;return t.getStorageData("player","ASID")}},{key:"getPlayerLocale",value:function getPlayerLocale(){var e=this.game,t=e.storage;return t.getStorageData("player","locale")}},{key:"getPlayerData",value:function getPlayerData(){var e=this.game,t=e.storage;return t.getStorageData("player","data")}},{key:"getPlayerDataByKey",value:function getPlayerDataByKey(e){var t=this.getPlayerData();return iK.hasOwn(t,e)?t[e]:null}},{key:"getGameData",value:function getGameData(){return this.getPlayerDataByKey("gameData")}},{key:"getPlayerSetting",value:function getPlayerSetting(e){var t=this.getPlayerSettings();return iK.hasOwn(t,e)?t[e]:null}},{key:"getPlayerSettings",value:function getPlayerSettings(){var e=this.getPlayerData(),t=e.settings;return t}},{key:"isFirstLogin",value:function isFirstLogin(){var e;return null!==(e=this.getPlayerDataByKey("isFirstLogin"))&&void 0!==e?e:P.data.isFirstLogin}},{key:"loggedIn",value:function loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}},{key:"getBestScore",value:function getBestScore(){var e=this.getPlayerData(),t=e.score;return t}},{key:"getBestEndlessScore",value:function getBestEndlessScore(){var e=this.getPlayerData(),t=e.endlessScore;return t}},{key:"getConnectedPlayers",value:function getConnectedPlayers(){var e=this.game,t=e.storage;return t.getStorageData("player","connectedPlayers")}},{key:"getConnectedPlayerIds",value:function getConnectedPlayerIds(e,t){var r=this.getConnectedPlayers();return Object.keys(r).slice(t,t+e)}}]);return Ui}(c.Plugins.BasePlugin);l(iz,"PlayerPlugin");var iq=iz;var iY=r.Dtos,iJ=r.Utils,iQ=iJ.Valid,iX=P.data,iZ=iX.score,i$=iX.endlessScore,i0=iX.settings,i2=iX.gameData,i3=iX.isFirstLogin,i1=iX.dailyRewarded,i4="is invalid",i5=/*#__PURE__*/function(e){_inherits(Fi,e);function Fi(){_class_call_check(this,Fi);return _call_super(this,Fi,arguments)}_create_class(Fi,[{key:"processData",value:function processData(e){this.validateStructure(e),e.settings=new iY.Player.Settings(e.settings).toObject(),e.gameData=new iY.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}},{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateScore",value:function validateScore(e){(!iQ.isNumber(e)||e<0)&&this.exception("score",i4)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!iQ.isNumber(e)||iZ<0)&&this.exception("endlessScore",i4)}},{key:"validateSettings",value:function validateSettings(e){iQ.isObject(e)||this.exception("settings",i4)}},{key:"validateGameData",value:function validateGameData(e){iQ.isObject(e)||this.exception("gameData",i4)}},{key:"validateIsFirstLogin",value:function validateIsFirstLogin(e){iQ.isBoolean(e)||this.exception("isFirstLogin",i4)}},{key:"validateDailyRewarded",value:function validateDailyRewarded(e){iQ.isObject(e)||this.exception("dailyRewarded",i4)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Fi.prototype),"toObject",this).call(this)}}]);return Fi}(S);l(i5,"PlayerDataDtos");var i7=i5;i7.addDefaultData({score:iZ,endlessScore:i$,settings:i0,gameData:i2,isFirstLogin:i3,dailyRewarded:i1});var i6=r.Utils,i8=i6.Valid,i9=P.data.gameData,oe=i9.level,ot=i9.coins,oa=/*#__PURE__*/function(e){_inherits(Bi,e);function Bi(){_class_call_check(this,Bi);return _call_super(this,Bi,arguments)}_create_class(Bi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!i8.isNumber(e)||e<0)&&this.exception("level","is invalid")}},{key:"validateCoins",value:function validateCoins(e){(!i8.isNumber(e)||e<0)&&this.exception("coins","is invalid")}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Bi.prototype),"toObject",this).call(this)}}]);return Bi}(S);l(oa,"PlayerGameDataDtos");var or=oa;or.addDefaultData({level:oe,coins:ot});var os=r.Utils,oo=os.Valid,oc=P.data.settings,ol=oc.sound,ou=oc.music,od=oc.vibrate,oh=oc.language,o_="is invalid",oy=/*#__PURE__*/function(e){_inherits(ji,e);function ji(){_class_call_check(this,ji);return _call_super(this,ji,arguments)}_create_class(ji,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateSound",value:function validateSound(e){oo.isBoolean(e)||this.exception("sound",o_)}},{key:"validateMusic",value:function validateMusic(e){oo.isBoolean(e)||this.exception("music",o_)}},{key:"validateVibrate",value:function validateVibrate(e){oo.isBoolean(e)||this.exception("vibrate",o_)}},{key:"validateLanguage",value:function validateLanguage(e){oo.isString(e)&&e||this.exception("language",o_)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(ji.prototype),"toObject",this).call(this)}}]);return ji}(S);l(oy,"PlayerSettingsDtos");var of=oy;of.addDefaultData({sound:ol,music:ou,vibrate:od,language:oh}),r.Dtos.Player={Info:R,Data:i7,Settings:of,GameData:or};var op=r.Configs,ov=r.Utils,og=ov.Object,om=ov.String,oA=op.ApiHost,ow=op.Mockup,oI=/*#__PURE__*/function(){function Ki(){_class_call_check(this,Ki);u(this,"mockAPI")}_create_class(Ki,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:if(e.mockAPI)return[2];return[4,h(/*#__PURE__*/_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:r=c.sent().default;if("function"!=typeof r)throw new Error("Cannot load ProfileAPIMock");e.mockAPI=new r;return[2]}})})()}},{key:"getPlayersAsync",value:function getPlayersAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r=om.params(e);if(!ow.Profile.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:d.sent();return[4,t.mockAPI.getPlayersAsync(e)];case 2:c=d.sent();return[3,5];case 3:return[4,ed("players?".concat(r),{},oA)];case 4:c=d.sent();d.label=5;case 5:return[2,og.hasOwn(c,"data")&&Array.isArray(c.data)?c.data:[]]}})})()}}]);return Ki}();l(oI,"ProfileAPI");var ob=oI;var ok={profiles:{},profileIds:[]},oS=r.Utils,oD=r.Dtos,oP=oS.Array,oE=oS.Valid,oC=oS.Object,ox=oS.Function,oN=/*#__PURE__*/function(e){_inherits(Wi,e);function Wi(){_class_call_check(this,Wi);var e;e=_call_super(this,Wi,arguments);u(e,"profileAPI",new ob);return e}_create_class(Wi,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("profile",ok)}},{key:"requestProfiles",value:function requestProfiles(e){var t=this;return _async_to_generator(function(){var r,c,d,h,_;return _ts_generator(this,function(y){switch(y.label){case 0:r=t.getProfileIds(),c=oP.difference(e,r);if(c.length<1)return[2];d=oP.chunk(c,400).map(function(e){return t.profileAPI.getPlayersAsync({playerIds:e})});return[4,ox.allSettled(d)];case 1:h=y.sent().reduce(function(e,t){return"fulfilled"===t.status?e.concat(t.value):e},[]);if(!t.validateProfilesResponse(h))return[2];_=t.convertToProfiles(h);t.setProfiles(_);return[2]}})})()}},{key:"getProfile",value:function getProfile(e){var t;return null!==(t=this.getProfiles()[e])&&void 0!==t?t:null}},{key:"getProfiles",value:function getProfiles(){var e=this.game,t=e.storage;return t.getStorageData("profile","profiles")}},{key:"setProfiles",value:function setProfiles(e){var t=this.game,r=t.storage;r.setStorageData("profile","profiles",e),r.setStorageData("profile","profileIds",Object.keys(e))}},{key:"getProfileIds",value:function getProfileIds(){var e=this.game,t=e.storage;return t.getStorageData("profile","profileIds")}},{key:"validateProfilesResponse",value:function validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}},{key:"convertToProfiles",value:function convertToProfiles(e){var t={};var r=true,c=false,d=void 0;try{for(var h=e[Symbol.iterator](),_;!(r=(_=h.next()).done);r=true){var y=_.value;oC.hasOwn(y,"playerId")&&oE.isString(y.playerId)&&(t[y.playerId]=new oD.Player.Info(y).toObject())}}catch(e){c=true;d=e}finally{try{if(!r&&null!=h.return)h.return()}finally{if(c)throw d}}return t}}]);return Wi}(c.Plugins.BasePlugin);l(oN,"ProfilePlugin");var oT=oN;var oM="Game Core",oL=r.Utils,oO=oL.Object,oR=oL.Valid,oG=oL.Browser,oF=/*#__PURE__*/function(e){_inherits(zi,e);function zi(e){_class_call_check(this,zi);var t;t=_call_super(this,zi,[e]);u(t,"storages");u(t,"storageLocalKeys",{});t.storages={};return t}_create_class(zi,[{key:"addStorage",value:function addStorage(e,t,r){var c=arguments.length>2&&void 0!==r&&r;var d=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(h){switch(h.label){case 0:console.info("addStorage",e,t),d.storages[e]=t;r=c;if(!r)return[3,2];return[4,d.initFromWebStorage(e,t)];case 1:r=h.sent();h.label=2;case 2:return[2]}})})()}},{key:"initFromWebStorage",value:function initFromWebStorage(e,t){var r=this;return _async_to_generator(function(){var c,d,h,_,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:r.storageLocalKeys[e]=!0;return[4,oG.getIndexedDB("".concat(oM,"_S_").concat(e))];case 1:c=g.sent();if(!oR.isObject(c))return[2];d=Object.keys(t);h=true,_=false,y=void 0;try{for(f=d[Symbol.iterator]();!(h=(p=f.next()).done);h=true){v=p.value;oO.hasOwn(c,v)&&_type_of(t[v])==_type_of(c[v])&&r.setStorageData(e,v,c[v])}}catch(e){_=true;y=e}finally{try{if(!h&&null!=f.return)f.return()}finally{if(_)throw y}}return[2]}})})()}},{key:"setStorageData",value:function setStorageData(e,t,r){var c;if(oR.isObject(r)){var d=this.getStorageData(e,t);c=oO.merge(d,r)}else c=r;this.storages[e][t]=c}},{key:"getStorageData",value:function getStorageData(e,t){return this.getStorage(e)[t]}},{key:"getStorage",value:function getStorage(e){return this.storages[e]}},{key:"updateToWebStorage",value:function updateToWebStorage(e){this.storageLocalKeys[e]&&this.saveToWebStorage(e)}},{key:"saveToWebStorage",value:function saveToWebStorage(e){var t=this.getStorage(e);oG.setIndexedDB("".concat(oM,"_S_").concat(e),t)}}]);return zi}(c.Plugins.BasePlugin);l(oF,"StoragePlugin");var oB=oF;var oV=/*#__PURE__*/function(e){_inherits(Hi,e);function Hi(){_class_call_check(this,Hi);var e;e=_call_super(this,Hi,arguments);u(e,"isVisible",!0);u(e,"browserPrefixes",["moz","ms","o","","webkit"]);u(e,"handleVisibilityChange",l(function(t){if(["focus","blur"].indexOf(t)>-1)return"focus"===t?e.onVisibleEvent():e.onHiddenEvent();var r=e.getBrowserPrefix();return e.getHiddenPropertyName(r) in document?e.onHiddenEvent():e.onVisibleEvent()},"handleVisibilityChange"));return e}_create_class(Hi,[{key:"init",value:function init(){var e=this;var t=this.getBrowserPrefix(),r=[this.getVisibilityEvent(t),"focus","blur"];var c=true,d=false,h=void 0;try{var _loop=function(){var t=y.value;window.addEventListener(t,function(){e.handleVisibilityChange(t)},!1),document.addEventListener(t,function(){e.handleVisibilityChange(t)},!1)};for(var _=r[Symbol.iterator](),y;!(c=(y=_.next()).done);c=true)_loop()}catch(e){d=true;h=e}finally{try{if(!c&&null!=_.return)_.return()}finally{if(d)throw h}}GameSDK.extra&&"onPause"in GameSDK.extra&&GameSDK.extra.onPause(function(){e.handleVisibilityChange("blur")})}},{key:"isGameVisible",value:function isGameVisible(){return this.isVisible}},{key:"getHiddenPropertyName",value:function getHiddenPropertyName(e){return e?"".concat(e,"Hidden"):"hidden"}},{key:"getVisibilityEvent",value:function getVisibilityEvent(e){return"".concat(e||"","visibilitychange")}},{key:"getBrowserPrefix",value:function getBrowserPrefix(){var e=true,t=false,r=void 0;try{for(var c=this.browserPrefixes[Symbol.iterator](),d;!(e=(d=c.next()).done);e=true){var h=d.value;if(this.getHiddenPropertyName(h) in document)return h}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}return""}},{key:"onVisibleEvent",value:function onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(r.Events.VISIBILITY_VISIBLE))}},{key:"onHiddenEvent",value:function onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(r.Events.VISIBILITY_HIDDEN))}}]);return Hi}(c.Plugins.BasePlugin);l(oV,"VisibilityPlugin");var oj=oV;var oU=/*#__PURE__*/function(e){_inherits(qi,e);function qi(){_class_call_check(this,qi);return _call_super(this,qi,arguments)}_create_class(qi,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("Unsupported method");return[2]})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("This method is not implemented");return[2]})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("This method is not implemented");return[2]})})()}}]);return qi}(eD);l(oU,"BannerInstance");var oH=oU;var oK=r.Plugins.Ads,oW=oK.Status,oz=/*#__PURE__*/function(e){_inherits(Yi,e);function Yi(){_class_call_check(this,Yi);return _call_super(this,Yi,arguments)}_create_class(Yi,[{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.loadBannerAdAsync(e.placementId)];case 1:t.sent(),e.setStatus(oW.SHOWING);return[2]}})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.hideBannerAdAsync(e.placementId)];case 1:t.sent(),e.setStatus(oW.IDLE);return[2]}})})()}}]);return Yi}(oH);l(oz,"BannerAdInstance");var oq=oz;var oY=r.Utils,oJ=oY.Object,oQ=r.Plugins.Ads,oX=oQ.Status,oZ=oQ.Types,o$=oQ.AdError,o0=oQ.AdInstance,o2=/*#__PURE__*/function(e){_inherits(Qi,e);function Qi(e,t){_class_call_check(this,Qi);var r;r=_call_super(this,Qi,[e,t]);u(r,"instance");u(r,"interstitialAdInstanceList",[]);u(r,"rewardedVideoAdInstanceList",[]);u(r,"rewardedInterstitialAdInstanceList",[]);r.instance=null;return r}_create_class(Qi,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(console.info("AdInstance","loadAsync called",{type:e.type,status:e.status}),!!(e.instance&&e.status===oX.FILLED))return[3,5];if(e.status!==oX.IDLE)throw new o$("AD_NOT_READY","Ad is not ready.");r.label=1;case 1:r.trys.push([1,4,,5]);return[4,e.createInstanceByType(e.type)];case 2:if(e.instance=r.sent(),null===e.instance)throw new o$("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");e.setStatus(oX.LOADING);return[4,e.instance.loadAsync()];case 3:r.sent(),e.setStatus(oX.FILLED),console.info("AdInstance","loadAsync success",{type:e.type,status:e.status}),e.logAdLoad();return[3,5];case 4:t=r.sent();throw console.warn("AdInstance","loadAsync failed",{type:e.type,status:e.status,error:t}),e.setStatus(oX.IDLE),_instanceof(t,Object)&&"code"in t&&"INVALID_PARAM"===t.code&&(e.instance=null),e.instance&&e.pushInstanceToQueue(e.instance),self.game.analytics.loadAdFail(e.type),t;case 5:return[2]}})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){var t,c;return _ts_generator(this,function(d){switch(d.label){case 0:if(console.info("AdInstance","showAsync called",{type:e.type,status:e.status}),e.status!==oX.FILLED)throw new o$("AD_NOT_FILLED","Ad is not filled.");if(null===e.instance)throw new o$("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");t=!1;d.label=1;case 1:d.trys.push([1,3,4,5]);e.setStatus(oX.SHOWING),self.game.analytics.showingAd(e.type);return[4,e.instance.showAsync()];case 2:d.sent(),t=!0,e.setStatus(oX.IDLE),e.instance=null,console.info("AdInstance","showAsync success",{type:e.type,status:e.status});return[3,5];case 3:c=d.sent();throw console.warn("AdInstance","showAsync failed",{type:e.type,status:e.status,error:c}),r.Utils.Object.hasOwn(c,"code")&&("AD_NOT_LOADED"===c.code&&e.setStatus(oX.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf("".concat(c.code))>-1&&(e.setStatus(oX.IDLE),e.instance=null),"USER_INPUT"===c.code&&(t=!0)),e.status===oX.SHOWING&&(e.setStatus(oX.IDLE),e.instance=null),c;case 4:t?e.logAdShown():self.game.analytics.showAdFail(e.type);return[7];case 5:return[2]}})})()}},{key:"createInstanceByType",value:function createInstanceByType(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,3]);return[4,t.getAdInstanceByType(e)];case 1:return[2,c.sent()];case 2:r=c.sent();return[2,oJ.hasOwn(r,"code")&&"ADS_TOO_MANY_INSTANCES"===r.code?t.getAdInstanceFailed(e):null];case 3:return[2]}})})()}},{key:"getAdInstanceByType",value:function getAdInstanceByType(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){switch(r.label){case 0:switch(e){case oZ.REWARDED_VIDEO:return[3,1];case oZ.INTERSTITIAL:return[3,3];case oZ.REWARDED_INTERSTITIAL:return[3,5]}return[3,7];case 1:return[4,GameSDK.getRewardedVideoAsync(t.placementId)];case 2:return[2,r.sent()];case 3:return[4,GameSDK.getInterstitialAdAsync(t.placementId)];case 4:return[2,r.sent()];case 5:return[4,GameSDK.getRewardedInterstitialAsync(t.placementId)];case 6:return[2,r.sent()];case 7:return[2,null];case 8:return[2]}})})()}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(e){var t=null;switch(e){case oZ.INTERSTITIAL:t=this.interstitialAdInstanceList;break;case oZ.REWARDED_VIDEO:t=this.rewardedVideoAdInstanceList;break;case oZ.REWARDED_INTERSTITIAL:t=this.rewardedInterstitialAdInstanceList;break}if(null===t)return null;if(!("canBeLoadedAd"in GameSDK.extra))return t.shift()||null;var r=true,c=false,d=void 0;try{for(var h=t[Symbol.iterator](),_;!(r=(_=h.next()).done);r=true){var y=_.value;if(GameSDK.extra.canBeLoadedAd(y))return t.splice(t.indexOf(y),1),y}}catch(e){c=true;d=e}finally{try{if(!r&&null!=h.return)h.return()}finally{if(c)throw d}}return null}},{key:"logAdLoad",value:function logAdLoad(){switch(this.type){case oZ.INTERSTITIAL:self.game.analytics.loadInterstitialAd();break;case oZ.REWARDED_VIDEO:self.game.analytics.loadRewardedVideoAd();break;case oZ.REWARDED_INTERSTITIAL:self.game.analytics.loadRewardedInterstitialAd();break}}},{key:"logAdShown",value:function logAdShown(){switch(this.type){case oZ.INTERSTITIAL:self.game.analytics.showInterstitialAd();break;case oZ.REWARDED_VIDEO:self.game.analytics.showRewardedVideoAd();break;case oZ.REWARDED_INTERSTITIAL:self.game.analytics.showRewardedInterstitialAd();break}}},{key:"pushInstanceToQueue",value:function pushInstanceToQueue(e){var t=null;switch(this.type){case oZ.INTERSTITIAL:t=this.interstitialAdInstanceList;break;case oZ.REWARDED_VIDEO:t=this.rewardedVideoAdInstanceList;break;case oZ.REWARDED_INTERSTITIAL:t=this.rewardedInterstitialAdInstanceList;break}t&&t.push(e)}}]);return Qi}(o0);l(o2,"NormalAdInstance");var o3=o2;var o1=r.Plugins.Analytics,o4=o1.BaseAnalytics,o5=o1.Events,o7=[o5.BUTTON_CLICK,o5.SCREEN_OPEN],o6=r.Utils,o8=o6.Array,o9=/*#__PURE__*/function(e){_inherits(Xi,e);function Xi(e,t){_class_call_check(this,Xi);var r;r=_call_super(this,Xi,[e,"FacebookAnalytics",_object_spread_props(_object_spread({},t),{color:"#0F52BA"})]);u(r,"prefix");r.prefix=t.prefix;return r}_create_class(Xi,[{key:"processEvent",value:function processEvent(e,t){if(!("logEvent"in GameSDK.extra)||o8.has(o7,e))return;var r=this.addPrefixToEventName(e);GameSDK.extra.logEvent(r,1,t)}},{key:"addPrefixToEventName",value:function addPrefixToEventName(e){return"".concat(this.prefix,"_").concat(e)}}]);return Xi}(o4);l(o9,"FacebookAnalytics");var ce=o9;var ct=r.Plugins.Analytics,ca=ct.BaseAnalytics,cr=ct.Events,cs=[cr.SCREEN_OPEN],co=r.Utils,cc=co.Array,cl=/*#__PURE__*/function(e){_inherits(Ji,e);function Ji(e,t){_class_call_check(this,Ji);return _call_super(this,Ji,[e,"FirebaseAnalytics",_object_spread_props(_object_spread({},t),{color:"#FFCA28"})])}_create_class(Ji,[{key:"setUser",value:function setUser(e,t){var r;null==(r=this.game.firebase.services.analytics)||r.setUser(e,t)}},{key:"processEvent",value:function processEvent(e,t){var r;cc.has(cs,e)||null==(r=this.game.firebase.services.analytics)||r.event(e,t)}}]);return Ji}(ca);l(cl,"FirebaseAnalytics");var cu=cl;var cd=r.Plugins.Analytics,ch=cd.BaseAnalytics,c_=cd.Events,cy=[c_.SCREEN_OPEN],cf=r.Utils,cp=cf.Array,cv=/*#__PURE__*/function(e){_inherits(Zi,e);function Zi(e,t){_class_call_check(this,Zi);return _call_super(this,Zi,[e,"GoogleAnalytics",_object_spread_props(_object_spread({},t),{color:"#E35335"})])}_create_class(Zi,[{key:"processEvent",value:function processEvent(e,t){cp.has(cy,e)||(this.customEvent(e,t),gtag("event",e,t))}},{key:"customEvent",value:function customEvent(e,t){switch(e){case c_.AD_SHOW:case c_.AD_SHOW_FAILED:case c_.AD_SHOWING:case c_.USE_ITEM:case c_.EARN_ITEM:this.addLevelName(t);break}}},{key:"addLevelName",value:function addLevelName(e){if(!e||!(null!=game&&game.match))return;var t=game.match.getMatchState().customData.level;t<0||(e.level_name=this.getLevelName(t))}}]);return Zi}(ch);l(cv,"GoogleAnalytics");var cg=cv;var cm="production",cA="0",cw=r.Dtos,cI=r.Events,cb=r.Configs,ck=r.Utils,cS=ck.Object,cD=ck.Json,cP=ck.String,cE=ck.Valid,cC=ck.Mark,cx=/*#__PURE__*/function(e){_inherits(to,e);function to(){_class_call_check(this,to);var e;e=_call_super(this,to,arguments);u(e,"markName","Core Initialize");u(e,"modulePlugins",[]);u(e,"handleProtectGameInstance",l(function(){var t=e.event.getEventEmitCount(y.MODULE_PLUGIN_READY),r=e.modulePlugins.length;t<r||(window.game=Object.freeze(window.game))},"handleProtectGameInstance"));u(e,"initMonitorErrorPlugin",l(function(){var t;if(!e.monitorError)return;null==(t=window.disableSimpleTrackErrors)||t.call(window);var r=cb.Debugger,c=r.MonitorError,d=r.ListPlayerDevIds,h=c.ApiKey,_=c.Service,y=c.Feedback,f=c.TrackUser,p=c.FilterErrors,v=GameSDK.player.getID(),g=GameSDK.player.getName();v&&d.indexOf(v)>=0||(e.monitorError.configure({apiKey:h,service:_,feedback:y,trackUser:f,releaseStage:cm,buildVersion:"".concat(cA)}),e.monitorError.setUser({id:v,name:g}),e.monitorError.addFilterErrors(p),e.monitorError.initFeedbackTrackErrors(),e.updateMonitorErrorUserAndMetadata(),e.processErrorsQueue())},"initMonitorErrorPlugin"));u(e,"updateMonitorErrorUserAndMetadata",l(function(){e.event.catchUp(cI.PLAYER_INFO_LOADED,e.processWhenPlayerInfoLoaded)},"updateMonitorErrorUserAndMetadata"));u(e,"processErrorsQueue",l(function(){if(e.monitorError&&window.__errorQueue){var t=true,r=false,c=void 0;try{for(var d=window.__errorQueue[Symbol.iterator](),h;!(t=(h=d.next()).done);t=true){var _=h.value;if(_instanceof(_,Error))e.monitorError.sendException(_);else{var y=_||{message:"",code:"Unknown",stack:"Unknown stack"},f=y.message,p=y.code,v=y.stack,g=new Error(f||p);g.stack=v,e.monitorError.sendException(g)}}}catch(e){r=true;c=e}finally{try{if(!t&&null!=d.return)d.return()}finally{if(r)throw c}}window.__errorQueue=null}},"processErrorsQueue"));u(e,"processWhenPlayerInfoLoaded",l(function(){if(!e.monitorError)return;var t=e.player.getPlayer(),r=t.playerId,c=t.name;e.monitorError.setUser({id:r,name:c}),e.monitorError.addMetadata({isFirstLogin:e.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));u(e,"handleSaveRemoteConfig",l(function(t){try{var r=_define_property({},t.type,t);e.player.setPlayerDataByName("remoteConfig",r)}catch(e){console.warn("handleSaveGameCoreConfig",e)}},"handleSaveRemoteConfig"));u(e,"handleUpdateGameCoreConfig",l(function(t){try{var c=t.id,d=t.type;if("GameCore"!==d)return;r.Configs=cS.merge(r.Configs,t.config);var h=r.Configs,_=h.Ads;e.ads.configure(_),e.event.emit(y.REMOTE_CONFIG_UPDATED,{id:c,type:d})}catch(e){console.warn("handleUpdateGameCoreConfig",e)}},"handleUpdateGameCoreConfig"));u(e,"handleStorageCurrentRemoteConfig",l(function(){var t=e.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",cD.clone(t)),!!t){for(var r in t)if(cS.hasOwn(t,r)){var c=t[r],d=cD.clone(c);console.log("newRemoteConfig",d);var h=new cw.RemoteConfig.Data(d).toObject();console.info("remoteConfigValid",h),e.remoteConfig.setRemoteConfig(h),e.remoteConfig.processUpdateConfig(h.id,h.type)}}},"handleStorageCurrentRemoteConfig"));u(e,"initAdaptivePerformancePlugin",l(function(){if(!e.adaptivePerformance)return;var t=cD.clone(cb.AdaptivePerformance);e.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));u(e,"processAfterSyncProfile",l(function(){var t=cb.Notification;t.Enabled&&e.updatePlayerProfileToNotificationService()},"processAfterSyncProfile"));return e}_create_class(to,[{key:"getBuildVersion",value:function getBuildVersion(){return Number.parseInt("".concat(cA))||0}},{key:"boot",value:function boot(){var e=this;var t=this,_superprop_get_boot=function(){return _get(_get_prototype_of(to.prototype),"boot",e)};return _async_to_generator(function(){return _ts_generator(this,function(e){console.groupEnd(),console.groupCollapsed("\uD83E\uDDEC GameCore Boot"),_superprop_get_boot().call(t),t.addPlugins(),t.initEventPlugin(),t.event.emit(cI.CORE_BOOTING),t.initFirebasePlugin(),t.initMarkCoreInitialize(),cC.putAttr(t.markName,"Step","Init Plugins"),t.initAds(),t.initMatchPlugin(),t.initRemoteConfig(),cC.putAttr(t.markName,"Step","Load Lazy Plugins"),cE.isDebugger()||t.event.on(cI.MODULE_PLUGIN_READY,t.handleProtectGameInstance),t.addMonitorPlugin().then(t.initMonitorErrorPlugin),t.addAdaptivePerformancePlugin().then(t.initAdaptivePerformancePlugin),cC.putAttr(t.markName,"Step","Load Dev Plugins"),t.addDevPlugins();return[2]})})()}},{key:"start",value:function start(){var e=this;var t=this,_superprop_get_start=function(){return _get(_get_prototype_of(to.prototype),"start",e)};return _async_to_generator(function(){var e;return _ts_generator(this,function(r){switch(r.label){case 0:console.groupEnd(),console.groupCollapsed("\uD83E\uDDEC GameCore Start"),_superprop_get_start().call(t),cC.putAttr(t.markName,"Step","Core Start"),t.event.emit(cI.CORE_STARTING),cC.putAttr(t.markName,"Step","Request Token");return[4,t.auth.requestToken()];case 1:r.sent(),cC.putAttr(t.markName,"Step","Init States");return[4,t.initState()];case 2:r.sent(),cC.putAttr(t.markName,"Step","Process Player Profile"),t.processPlayerProfile(),cC.putAttr(t.markName,"Step","Process Context Payload");return[4,t.context.detectContextSessionType()];case 3:r.sent(),t.context.detectContextGameMode();e=t.storage.getStorageData("context","sessionContextType");cC.putAttr(t.markName,"Context Mode",e),cC.putAttr(t.markName,"Step","Init Analytics"),t.initGoogleAnalytics(),t.initFirebaseAnalytics(),t.initFacebookAnalytics(),cC.putAttr(t.markName,"Step","Core Ready"),cC.putAttr(t.markName,"Success","true"),cC.stop(t.markName),t.event.emit(cI.CORE_READY);return[2]}})})()}},{key:"addPlugins",value:function addPlugins(){this.installPlugin("Storage",oB),this.installPlugin("Event",tL),this.installPlugin("Ads",eN),this.installPlugin("Auth",eq),this.installPlugin("Audio",eK),this.installPlugin("Match",iS),this.installPlugin("Player",iq),this.installPlugin("Profile",oT),this.installPlugin("Context",tl),this.installPlugin("Language",tW),this.installPlugin("Analytics",eF),this.installPlugin("Visibility",oj),this.installPlugin("Leaderboard",nt),this.installPlugin("DailyRewards",tP),this.installPlugin("FrameCapture",tO),this.installPlugin("RemoteConfig",tO),"Proxy"in window&&this.installPlugin("Firebase",tO)}},{key:"installPlugin",value:function installPlugin(e,t,r){var c=arguments.length>2&&void 0!==r&&r;var d=cP.toCamelCase(cP.capitalize(e));this.plugins.install(e,t,!0,d),"Storage"!==e&&(c?this.emitModulePluginReady(e):this.emitCorePluginReady(e))}},{key:"addMonitorPlugin",value:function addMonitorPlugin(){var e=this;return _async_to_generator(function(){var r,c,d;return _ts_generator(this,function(_){switch(_.label){case 0:r=cb.Debugger,c=r.MonitorError;if(!c.Enabled)return[2];e.modulePlugins.push("MonitorError");return[4,h(/*#__PURE__*/_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:d=_.sent().default;"function"==typeof d&&e.installPlugin("MonitorError",d,!0);return[2]}})})()}},{key:"addAdaptivePerformancePlugin",value:function addAdaptivePerformancePlugin(){var e=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(d){switch(d.label){case 0:r=cb.AdaptivePerformance;if(!r.Enabled)return[2];e.modulePlugins.push("AdaptivePerformance");return[4,h(/*#__PURE__*/_async_to_generator(function(){var e,r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,t.import("./bundle/index.js")];case 1:e=c.sent(),r=e.default;return[2,{default:r}]}})}),void 0,t.meta.url)];case 1:c=d.sent().default;"function"==typeof c&&e.installPlugin("AdaptivePerformance",c,!0);return[2]}})})()}},{key:"addDevPlugins",value:function addDevPlugins(){var e=cb.Debugger,t=e.ListPlayerDevIds,r=GameSDK.player.getID();!r||t.indexOf(r)<0||(this.addConsolePlugin(),this.addProfilerPlugin(),this.addCanvasRecorderPlugin())}},{key:"addConsolePlugin",value:function addConsolePlugin(){var e=this;return _async_to_generator(function(){var r,c,d,_;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);r=cb.Debugger,c=r.Console;if(!c.Enabled)return[2];e.modulePlugins.push("Console");return[4,h(/*#__PURE__*/_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:d=y.sent().default;if("function"!=typeof d)throw new Error("ConsolePlugin is not a function");e.installPlugin("Console",d,!0),e.initConsolePlugin();return[3,3];case 2:_=y.sent();console.error("Error importing Console plugin:",_);return[3,3];case 3:return[2]}})})()}},{key:"addProfilerPlugin",value:function addProfilerPlugin(){var e=this;return _async_to_generator(function(){var r,c,d,_;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);r=cb.Debugger,c=r.Profiler;if(!c.Enabled)return[2];e.modulePlugins.push("Profiler");return[4,h(/*#__PURE__*/_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:d=y.sent().default;if("function"!=typeof d)throw new Error("ProfilerPlugin is not a function");e.installPlugin("Profiler",d,!0),e.initProfilerPlugin();return[3,3];case 2:_=y.sent();console.error("Error importing Profiler plugin:",_);return[3,3];case 3:return[2]}})})()}},{key:"addCanvasRecorderPlugin",value:function addCanvasRecorderPlugin(){var e=this;return _async_to_generator(function(){var r,c,d,_;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);r=cb.Debugger,c=r.CanvasRecorder;if(!c.Enabled)return[2];e.modulePlugins.push("CanvasRecorder");return[4,h(/*#__PURE__*/_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:d=y.sent().default;if("function"!=typeof d)throw new Error("CanvasRecorderPlugin is not a function");e.installPlugin("CanvasRecorder",d,!0),e.initCanvasRecorderPlugin();return[3,3];case 2:_=y.sent();console.error("Error importing Canvas Recorder plugin:",_);return[3,3];case 3:return[2]}})})()}},{key:"emitCorePluginReady",value:function emitCorePluginReady(e){this.event.emit(y.CORE_PLUGIN_READY,{name:e})}},{key:"emitModulePluginReady",value:function emitModulePluginReady(e){this.event.emit(y.MODULE_PLUGIN_READY,{name:e})}},{key:"initEventPlugin",value:function initEventPlugin(){var e=cb.Debugger,t=e.EventLogging;t.Enabled&&this.event.enableLogEvent()}},{key:"initMatchPlugin",value:function initMatchPlugin(){this.match.setUseCPUProfile(!1)}},{key:"initAds",value:function initAds(){var e=r.Plugins,t=e.Ads;this.ads.configure(cb.Ads),this.initAdInstance(t,cb)}},{key:"initAdInstance",value:function initAdInstance(e,t){var r=t.Ads,c=r.InterstitialAdOptions,d=r.RewardedVideoAdOptions,h=r.RewardedInterstitialAdOptions,_=r.BannerDisplayAdOptions;var y=true,f=false,p=void 0;try{for(var v=c[Symbol.iterator](),g;!(y=(g=v.next()).done);y=true){var m=g.value;this.ads.setAdInstance(e.Types.INTERSTITIAL,m.PlacementId,o3)}}catch(e){f=true;p=e}finally{try{if(!y&&null!=v.return)v.return()}finally{if(f)throw p}}var A=true,w=false,I=void 0;try{for(var b=d[Symbol.iterator](),k;!(A=(k=b.next()).done);A=true){var S=k.value;this.ads.setAdInstance(e.Types.REWARDED_VIDEO,S.PlacementId,o3)}}catch(e){w=true;I=e}finally{try{if(!A&&null!=b.return)b.return()}finally{if(w)throw I}}var D=true,P=false,E=void 0;try{for(var C=h[Symbol.iterator](),x;!(D=(x=C.next()).done);D=true){var N=x.value;this.ads.setAdInstance(e.Types.REWARDED_INTERSTITIAL,N.PlacementId,o3)}}catch(e){P=true;E=e}finally{try{if(!D&&null!=C.return)C.return()}finally{if(P)throw E}}var T=true,M=false,L=void 0;try{for(var O=_[Symbol.iterator](),R;!(T=(R=O.next()).done);T=true){var G=R.value;this.ads.setAdInstance(e.Types.BANNER,G.PlacementId,oq)}}catch(e){M=true;L=e}finally{try{if(!T&&null!=O.return)O.return()}finally{if(M)throw L}}}},{key:"initState",value:function initState(){var e=this;return _async_to_generator(function(){var t,r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,3]);t=new Q(e);t.initContext();return[4,t.initPlayer()];case 1:c.sent();return[3,3];case 2:r=c.sent();console.error("StateInitiator",r);return[3,3];case 3:return[2]}})})()}},{key:"initConsolePlugin",value:function initConsolePlugin(){this.console&&this.console.configure()}},{key:"initProfilerPlugin",value:function initProfilerPlugin(){this.profiler&&this.profiler.configure()}},{key:"initCanvasRecorderPlugin",value:function initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;var e=cb.Debugger,t=e.CanvasRecorder,r=t.Options,c=r.Type,d=r.Quality,h=r.RecordFps,_=r.SyncFps;this.canvasRecorder.configure({type:c,quality:d,syncFps:_,recordFps:h});var y=document.querySelector("canvas");if(!y){console.error("Canvas not found");return}this.canvasRecorder.setCanvas(y)}},{key:"initRemoteConfig",value:function initRemoteConfig(){var e=cb.RemoteConfig;if(!e.Enabled)return;var t=cD.clone(e);this.remoteConfig.configure(t),this.event.on(y.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(y.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.catchUp(y.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}},{key:"initFirebasePlugin",value:function initFirebasePlugin(){var e=cb.Firebase;if(!e.Enabled||!this.firebase)return;var t=cD.clone(e);this.firebase.configure(t),cC.setService(this.firebase.services.performance)}},{key:"initMarkCoreInitialize",value:function initMarkCoreInitialize(){cb.PerformanceMonitor.CoreFlows&&(cC.measure(this.markName),cC.putAttr(this.markName,"Build","".concat(cA)),cC.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),cC.putAttr(this.markName,"Platform",GameSDK.getPlatform()),cC.putAttr(this.markName,"Success","false"),cC.start(this.markName))}},{key:"processPlayerProfile",value:function processPlayerProfile(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.player.syncProfileToServer()];case 1:r.sent(),e.processAfterSyncProfile();return[3,3];case 2:t=r.sent();console.warn("processPlayerProfile fail",t);return[3,3];case 3:return[2]}})})()}},{key:"updatePlayerProfileToNotificationService",value:function updatePlayerProfileToNotificationService(){var e=this;return _async_to_generator(function(){var t,r,c,d,h,_,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:p.trys.push([0,2,,3]);t=cb.AppId,r=e.player.getPlayer(),c=r.ASID,d=r.playerId,h=r.name,_=r.photo,y=r.locale;return[4,eg({appId:t,ASID:c,playerId:d,name:h,photo:_,locale:y})];case 1:p.sent();return[3,3];case 2:f=p.sent();console.warn("updatePlayerProfileToNotificationService",f);return[3,3];case 3:return[2]}})})()}},{key:"initGoogleAnalytics",value:function initGoogleAnalytics(){var e;var t=null!==(e=cb.Analytics.GoogleAnalytics)&&void 0!==e?e:{},r=t.Enabled,c=t.ConsoleLog;r&&this.analytics.add(new cg(this.game,{log:!!c}))}},{key:"initFirebaseAnalytics",value:function initFirebaseAnalytics(){var e=this;var t;var r=null!==(t=cb.Analytics.FirebaseAnalytics)&&void 0!==t?t:{},c=r.Enabled,d=r.ConsoleLog;if(!c)return;var h=new cu(this.game,{log:!!d});this.analytics.add(h);var _="no_entry";GameSDK.getEntryPointAsync().then(function(e){_=e}).catch(function(e){console.warn(e)}).finally(function(){var t=e.player.getPlayer(),r=t.playerId,c=t.locale,d=GameSDK.getEntryPointData()||{},y=d.fbig_ad_id,f=d.fbig_adset_id,p=d.fbig_campaign_id;h.setUser(r,{locale:c,ad_id:y,adset_id:f,campaign_id:p,traffic_source:_})})}},{key:"initFacebookAnalytics",value:function initFacebookAnalytics(){var e;var t=null!==(e=cb.Analytics.FacebookAnalytics)&&void 0!==e?e:{},r=t.Enabled,c=t.Prefix,d=t.ConsoleLog;if(r){if("string"!=typeof c){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new ce(this.game,{prefix:c,log:!!d}))}}}]);return to}(c.Game);l(cx,"MagicGame");var cN=cx;var cT=r.Configs,cM=cT.GameEngine,cL=cM.ForceDesktopDPR,cO=r.Utils,cR=cO.Device,cG=r.Events,cF=l(/*#__PURE__*/_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:e=new cN;window.game=e;t=20;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t),window.__gameCoreStart=!0;return[4,e.boot()];case 1:r.sent(),e.event.catchUp(cG.REQUEST_CORE_START,cB),cV(e);return[2]}})}),"initGame"),cB=l(function(){if(!window.__sdkInitiated){game.event.catchUp(cG.GAME_SDK_READY,cB);return}window.game.start(),console.warn("Game started");var e=25;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e)},"startGame"),cV=l(function(e){var t=setInterval(function(){if(!window.__sdkInitiated)return;clearInterval(t);var r=10;window.__sdkLoadingCount<r&&(window.__sdkLoadingCount=r),e.event.emit(cG.GAME_SDK_READY)},5)},"waitGameSDK");!1!==cL&&cR.isDesktop()&&"number"==typeof cL&&cL>0&&(window.devicePixelRatio=cL),cF()},"execute")}});