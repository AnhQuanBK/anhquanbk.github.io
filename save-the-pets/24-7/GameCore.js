function _array_like_to_array(e,t){if(null==t||t>e.length)t=e.length;for(var o=0,c=new Array(t);o<t;o++)c[o]=e[o];return c}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function _assert_this_initialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function asyncGeneratorStep(e,t,o,c,l,u,d){try{var f=e[u](d);var y=f.value}catch(e){o(e);return}if(f.done)t(y);else Promise.resolve(y).then(c,l)}function _async_to_generator(e){return function(){var t=this,o=arguments;return new Promise(function(c,l){var u=e.apply(t,o);function _next(e){asyncGeneratorStep(u,c,l,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(u,c,l,_next,_throw,"throw",e)}_next(void 0)})}}function _call_super(e,t,o){return t=_get_prototype_of(t),_possible_constructor_return(e,_is_native_reflect_construct()?Reflect.construct(t,o||[],_get_prototype_of(e).constructor):t.apply(e,o))}function _class_call_check(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _construct(){return(_construct=_is_native_reflect_construct()?Reflect.construct:function construct(e,t,o){var c=[null];c.push.apply(c,t);var l=new(Function.bind.apply(e,c));if(o)_set_prototype_of(l,o.prototype);return l}).apply(null,arguments)}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var c=t[o];if(c.enumerable=c.enumerable||false,c.configurable=true,"value"in c)c.writable=true;Object.defineProperty(e,c.key,c)}}function _create_class(e,t,o){if(t)_defineProperties(e.prototype,t);if(o)_defineProperties(e,o);return e}function _define_property(e,t,o){if(t in e)Object.defineProperty(e,t,{value:o,enumerable:true,configurable:true,writable:true});else e[t]=o;return e}function _get(e,t,o){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function get(e,t,o){var c=_super_prop_base(e,t);if(!c)return;var l=Object.getOwnPropertyDescriptor(c,t);if(l.get)return l.get.call(o||e);return l.value})(e,t,o||e)}function _get_prototype_of(e){return(_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");if(e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}}),t)_set_prototype_of(e,t)}function _instanceof(e,t){if(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance])return!!t[Symbol.hasInstance](e);return e instanceof t}function _is_native_function(e){return -1!==Function.toString.call(e).indexOf("[native code]")}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,t){var o,c,l=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==l)return;var u=[];var d=true;var f=false;try{for(l=l.call(e);!(d=(o=l.next()).done)&&(u.push(o.value),!t||u.length!==t);d=true);}catch(e){f=true,c=e}finally{try{if(!d&&null!=l.return)l.return()}finally{if(f)throw c}}return u}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};var c=Object.keys(o);if("function"==typeof Object.getOwnPropertySymbols)c=c.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}));c.forEach(function(t){_define_property(e,t,o[t])})}return e}function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);if(t)c=c.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable});o.push.apply(o,c)}return o}function _object_spread_props(e,t){if(t=null!=t?t:{},Object.getOwnPropertyDescriptors)Object.defineProperties(e,Object.getOwnPropertyDescriptors(t));else ownKeys(Object(t)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))});return e}function _possible_constructor_return(e,t){if(t&&("object"===_type_of(t)||"function"==typeof t))return t;return _assert_this_initialized(e)}function _set_prototype_of(e,t){return(_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(e,t){return e.__proto__=t,e})(e,t)}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _super_prop_base(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(null===(e=_get_prototype_of(e)))break;return e}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,t){if(!e)return;if("string"==typeof e)return _array_like_to_array(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);if("Object"===o&&e.constructor)o=e.constructor.name;if("Map"===o||"Set"===o)return Array.from(o);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _array_like_to_array(e,t)}function _wrap_native_super(e){var t="function"==typeof Map?new Map:void 0;return(_wrap_native_super=function wrapNativeSuper(e){if(null===e||!_is_native_function(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_get_prototype_of(this).constructor)}return Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}}),_set_prototype_of(Wrapper,e)})(e)}function _is_native_reflect_construct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_is_native_reflect_construct=function(){return!!e})()}function _ts_generator(e,t){var o,c,l,u,d={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return u={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function verb(e){return function(t){return step([e,t])}}function step(u){if(o)throw new TypeError("Generator is already executing.");while(d)try{if(o=1,c&&(l=2&u[0]?c.return:u[0]?c.throw||((l=c.return)&&l.call(c),0):c.next)&&!(l=l.call(c,u[1])).done)return l;if(c=0,l)u=[2&u[0],l.value];switch(u[0]){case 0:case 1:l=u;break;case 4:return d.label++,{value:u[1],done:false};case 5:d.label++,c=u[1],u=[0];continue;case 7:u=d.ops.pop(),d.trys.pop();continue;default:if(!(l=(l=d.trys).length>0&&l[l.length-1])&&(6===u[0]||2===u[0])){d=0;continue}if(3===u[0]&&(!l||u[1]>l[0]&&u[1]<l[3])){d.label=u[1];break}if(6===u[0]&&d.label<l[1]){d.label=l[1],l=u;break}if(l&&d.label<l[2]){d.label=l[2],d.ops.push(u);break}if(l[2])d.ops.pop();d.trys.pop();continue}u=t.call(e,d)}catch(e){u=[6,e],c=0}finally{o=l=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:true}}}var wc=Object.defineProperty;var h=function(e,t,o){return function(e,t,o){return t in e?wc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o}(e,(void 0===t?"undefined":_type_of(t))!="symbol"?t+"":t,o)};System.register(["./bundle/core.js","./bundle/monitor-error.js","./bundle/canvas-recorder.js"],function(e,t){"use strict";var o,c,l,u,d,f,y,p,g;return{setters:[function(e){o=e.G,c=e.P,l=e.M,u=e._,d=e.a,f=e.C,y=e.w},function(e){p=e.g},function(e){g=e.d}],execute:function execute(){var m=o.Utils,A=m.Valid,I=m.Object,D=m.String,k=m.Json,E="is invalid",x=/*#__PURE__*/function(){function ne(e){_class_call_check(this,ne),this.defaultData(),this.processData(e)}return _create_class(ne,[{key:"processData",value:function processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}},{key:"defaultData",value:function defaultData(){var e=this.constructor.name;this.lazyDefaultData(ne.data[e])}},{key:"lazyDefaultData",value:function lazyDefaultData(e){for(var t in A.isObject(e)||this.exception("data",E),e)if(I.hasOwn(e,t)){var o=e[t];I.assign(this,_define_property({},t,o))}}},{key:"lazyValidateStructure",value:function lazyValidateStructure(e){A.isObject(e)||this.exception("structure","is not object");var t=this.getKeys();var o=true,c=false,l=void 0;try{for(var u,d=t[Symbol.iterator]();!(o=(u=d.next()).done);o=true){var f=u.value;var y=this[f];void 0===y&&this.exception("structure","has no key ".concat(f)),I.hasOwn(e,f)||void 0===y||this.setDefaultData(f,e)}}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}}},{key:"setDefaultData",value:function setDefaultData(e,t){A.isObject(t)||this.exception("data",E);var o=this[e];void 0===o&&this.exception("default","has no key ".concat(e)),I.assign(t,_define_property({},e,o))}},{key:"lazyValidateData",value:function lazyValidateData(e){var t=this.getKeys();var o=true,c=false,l=void 0;try{for(var u,d=t[Symbol.iterator]();!(o=(u=d.next()).done);o=true){var f=u.value;var y=e[f],p=D.removeDiacritics(f).replace(/[^a-zA-Z0-9]/g,""),g="validate".concat(D.capitalize(p)),m=this[g];if("function"==typeof m)try{m.call(this,y)}catch(t){this.setDefaultData(f,e)}else this.exception("validate","has no function ".concat(g))}}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}}},{key:"lazySetupData",value:function lazySetupData(e){var t=this.getKeys();var o=true,c=false,l=void 0;try{for(var u,d=t[Symbol.iterator]();!(o=(u=d.next()).done);o=true){var f=u.value;var y=e[f];I.assign(this,_define_property({},f,y))}}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}}},{key:"validate",value:function validate(){this.validateData(this.toObject())}},{key:"exception",value:function exception(e,t){throw new Error("".concat(this.constructor.name,": ").concat(e," ").concat(t))}},{key:"toObject",value:function toObject(){return Object.fromEntries(Object.entries(this).filter(function(e){return"toObject"!==_sliced_to_array(e,1)[0]}))}},{key:"getKeys",value:function getKeys(){return Object.keys(this).filter(function(e){return"toObject"!==e})}}],[{key:"addDefaultData",value:function addDefaultData(e){A.isObject(e)||this.prototype.exception("default data",E),e=k.clone(e);var t=this.name;A.isObject(ne.data[t])||(ne.data[t]={}),ne.data[t]=I.merge(ne.data[t],e)}},{key:"getDefaultData",value:function getDefaultData(){var e=this.name;return k.clone(ne.data[e])}},{key:"addValidateFunction",value:function addValidateFunction(e,t){A.isString(e)||this.prototype.exception("validate key",E),"function"!=typeof t&&this.prototype.exception("validate function",E);var o="validate".concat(D.capitalize(e));I.assign(this.prototype,_define_property({},o,t))}}]),ne}();h(x,"data",{}),o.Dtos={Base:x};var C={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded",notificationData:"notificationData",lastCallSwitchGame:"lastCallSwitchGame"},T={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],firstReward:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0,notificationData:{D1:{arrivalDate:0},D2:{arrivalDate:0},D3:{arrivalDate:0},D4:{arrivalDate:0},D5:{arrivalDate:0},D6:{arrivalDate:0},D7:{arrivalDate:0}},lastCallSwitchGame:0}},N=o.Utils.Valid,O=T.playerId,R=T.name,M=T.photo,F=T.locale,G="is invalid";var B=/*#__PURE__*/function(e){function ke(){return _class_call_check(this,ke),_call_super(this,ke,arguments)}return _inherits(ke,e),_create_class(ke,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){N.isString(e)&&e||this.exception("_id",G)}},{key:"validatePlayerId",value:function validatePlayerId(e){N.isString(e)&&e||this.exception("playerId",G)}},{key:"validateName",value:function validateName(e){N.isString(e)&&e||this.exception("name",G)}},{key:"validatePhoto",value:function validatePhoto(e){N.isString(e)||this.exception("photo",G)}},{key:"validateLocale",value:function validateLocale(e){N.isString(e)&&e||this.exception("locale",G)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(ke.prototype),"toObject",this).call(this)}}]),ke}(x);B.addDefaultData({playerId:O,name:R,photo:M,locale:F});var V=new B({playerId:"10",name:"Your Friend"}).toObject();var K=/*#__PURE__*/function(e){function X(e){var t;return _class_call_check(this,X),h(t=_call_super(this,X,[e]),"code"),t.code="CREATE_MATCH_FAILED",t}return _inherits(X,e),X}(_wrap_native_super(Error));var W=/*#__PURE__*/function(e){function P(e){var t;return _class_call_check(this,P),(t=_call_super(this,P,[e])).name="PlayerIdNotValid",t.message=null!=e?e:"Player id is not valid",t}return _inherits(P,e),P}(K);var Q=o.Dtos,$=o.Utils,ee=$.Array,et=$.Object,ea=($.Json,$.Valid),ei=o.Events;var Na=function Na(e){var t=this;_class_call_check(this,Na);var o=this;h(this,"game"),h(this,"initContext",function(){var e;var o={contextId:null!==(e=GameSDK.context.getID())&&void 0!==e?e:"",contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},c=new Q.Context.Info(o).toObject(),l=c.contextId,u=c.contextType,d=c.entryPointData;t.game.context.receiveContext(l,u,d)}),h(this,"initPlayer",/*#__PURE__*/_async_to_generator(function(){var e,t,c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,3,4]),e=o.game.player,t=o.getPlayerInfo(),c=ee.unique(et.vals(C)),[4,GameSDK.player.getDataAsync(c)];case 1:return l=d.sent(),u=new Q.Player.Data(l).toObject(),e.receiveData(t,u),[3,4];case 2:return d.sent(),[3,4];case 3:return o.game.event.emit(ei.PLAYER_INFO_LOADED),[7];case 4:return[2]}})})),h(this,"getPlayerInfo",function(){try{var e=GameSDK.player.getID();var t=GameSDK.player.getName();var o=GameSDK.player.getPhoto();var c=GameSDK.getLocale();if(!ea.isString(e))throw new W;return ea.isString(t)||(t="You"),ea.isString(c)&&c||(c="en"),new Q.Player.Info({playerId:e,name:t,photo:o,locale:c}).toObject()}catch(e){return V}}),this.game=e};var eo=/*#__PURE__*/function(e){function ft(e,t){var o;return _class_call_check(this,ft),h(o=_call_super(this,ft,[e]),"payload"),o.name="BadRequest",o.message=null!=e?e:"This request is bad",o.payload=t,o}return _inherits(ft,e),ft}(_wrap_native_super(Error));var ec=/*#__PURE__*/function(e){function gt(e,t){var o;return _class_call_check(this,gt),h(o=_call_super(this,gt,[e]),"payload"),o.name="RequestTimeout",o.message=null!=e?e:"This request is timeout",o.payload=t,o}return _inherits(gt,e),gt}(_wrap_native_super(Error));var el=o.Utils,eu=o.Configs,ed=eu.AppId,eh=eu.Network,Oa=function(e){if(!e.ok)throw new eo(void 0,{response:e})},es=function(){var e=window.game.auth.getToken();return{token:e,timeout:eh.Timeout,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},ts=function(e,t,c,l){return /*#__PURE__*/_async_to_generator(function(){var u,d,f,y,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(g.trys.push([0,3,,4]),!ed)throw new eo("AppId is not defined");return u="".concat(e,"/apps/").concat(ed,"/").concat(t),d=new AbortController,c.signal=d.signal,f=setTimeout(function(){d.abort()},c.timeout),o.Utils.Valid.isObject(l)&&(c.body=JSON.stringify(l)),[4,fetch(u,c)];case 1:return y=g.sent(),clearTimeout(f),Oa(y),[4,y.json()];case 2:return[2,g.sent()||{}];case 3:if(_instanceof(p=g.sent(),eo))return[2,null];throw _instanceof(p,Object)&&"name"in p&&"AbortError"===p.name?new ec:p;case 4:return[2]}})})},ef=/*#__PURE__*/function(){var e=_async_to_generator(function(e,t){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,1,,7]),[2,e()];case 1:if(!(_instanceof(o=c.sent(),ec)&&t>0))return[3,6];c.label=2;case 2:return c.trys.push([2,5,,6]),[4,el.Time.sleepAsync(600)];case 3:return c.sent(),[4,ef(e,t-1)];case 4:return[2,c.sent()];case 5:return c.sent(),[2,{}];case 6:return[2,_instanceof(o,ec)?{}:{}];case 7:return[2]}})});return function At(t,o){return e.apply(this,arguments)}}(),ey=/*#__PURE__*/function(){var e=_async_to_generator(function(e,t,o){var c;var l=arguments;return _ts_generator(this,function(u){switch(u.label){case 0:c=l.length>3&&void 0!==l[3]?l[3]:eh.Retries,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,ef(ts(o,e,_object_spread_props(_object_spread({},es(),t),{method:"GET"})),c)];case 2:return[2,u.sent()];case 3:return u.sent(),[2,{}];case 4:return[2]}})});return function Ie(t,o,c){return e.apply(this,arguments)}}(),e_=/*#__PURE__*/function(){var e=_async_to_generator(function(e,t,o,c){var l;var u=arguments;return _ts_generator(this,function(d){switch(d.label){case 0:l=u.length>4&&void 0!==u[4]?u[4]:eh.Retries,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,ef(ts(c,e,_object_spread_props(_object_spread({},es(),o),{method:"POST"}),t),l)];case 2:return[2,d.sent()];case 3:return d.sent(),[2,{}];case 4:return[2]}})});return function z(t,o,c,l){return e.apply(this,arguments)}}(),ev=o.Configs.Notification.ApiUrl,ep=o.Utils.Object,eg=/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(!ep.hasOwn(e,"playerId"))throw new Error("Missing playerId");return t=e.playerId,[4,e_("players/".concat(t),e,{},ev,10)];case 1:return o.sent(),[2]}})});return function Fa(t){return e.apply(this,arguments)}}();var em=function(e){return e.IDLE="idle",e.LOADING="loading",e.FILLED="filled",e.SHOWING="showing",e}(em||{}),eA=function(e){return e.BANNER="banner",e.INTERSTITIAL="interstitial",e.REWARDED_VIDEO="rewarded_video",e.REWARDED_INTERSTITIAL="rewarded_interstitial",e}(eA||{});var ew=/*#__PURE__*/function(e){function Ve(e,t){var o;return _class_call_check(this,Ve),h(o=_call_super(this,Ve,[t]),"code"),o.code=e,o.message=t,o}return _inherits(Ve,e),Ve}(_wrap_native_super(Error));var eI=/*#__PURE__*/function(e){function ss(){return _class_call_check(this,ss),_call_super(this,ss,arguments)}return _inherits(ss,e),_create_class(ss,[{key:"loadAsync",value:function loadAsync(){this.exception("This method is not implemented")}},{key:"showAsync",value:function showAsync(){this.exception("This method is not implemented")}},{key:"hideAsync",value:function hideAsync(){this.exception("Unsupported method")}}]),ss}(/*#__PURE__*/function(){function Ga(e,t){_class_call_check(this,Ga),h(this,"type"),h(this,"service"),h(this,"placementId"),h(this,"_status"),this.type=e,this._status=em.IDLE,this.placementId=t}return _create_class(Ga,[{key:"setStatus",value:function setStatus(e){this._status!==e&&(this._status=e)}},{key:"status",get:function get(){return this._status}},{key:"exception",value:function exception(e){throw new ew("AD_INSTANCE_ERROR",e)}}]),Ga}());o.Plugins.Ads={Types:eA,Status:em,AdError:ew,AdInstance:eI};var eD=o.Utils,ek=eD.Array,eb=eD.Object;var eS=/*#__PURE__*/function(e){function $a(){var e;return _class_call_check(this,$a),e=_call_super(this,$a,arguments),h(e,"enabled"),h(e,"config"),h(e,"lastCallAdShownTime"),h(e,"isAdFullSizeShowed"),h(e,"ads",{}),h(e,"safeAreaBottom"),h(e,"degradationTracking",{failedAttempts:0,lastSuccessTime:0}),e}return _inherits($a,e),_create_class($a,[{key:"init",value:function init(){var e;this.lastCallAdShownTime=(_define_property(e={},eA.BANNER,0),_define_property(e,eA.INTERSTITIAL,0),_define_property(e,eA.REWARDED_VIDEO,0),_define_property(e,eA.REWARDED_INTERSTITIAL,0),e),this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom(),this.resetDegradationTracking()}},{key:"calculateSafeAreaBottom",value:function calculateSafeAreaBottom(){try{var e=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(e,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch(e){this.safeAreaBottom=0}}},{key:"configure",value:function configure(e){this.config=e,this.enabled=this.config.Enabled}},{key:"checkEnabled",value:function checkEnabled(){if(!this.enabled)throw new ew("ADS_NOT_ENABLED","Ads is't enabled")}},{key:"isAdFullSizeShowing",value:function isAdFullSizeShowing(){return this.isAdFullSizeShowed}},{key:"setAdInstance",value:function setAdInstance(e,t,o){var c="".concat(e,"-").concat(t);this.ads[c]||(this.ads[c]={type:e,placementId:t,interval:null,instance:new o(e,t)})}},{key:"loadAdAsync",value:function loadAdAsync(e,t){var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:o.checkEnabled(),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,o.getAd(e,t).instance.loadAsync()];case 2:return l.sent(),[3,4];case 3:throw c=l.sent(),o.degradationTracking.failedAttempts++,c;case 4:return[2]}})})()}},{key:"showAdAsync",value:function showAdAsync(e,t){var c=this;return _async_to_generator(function(){var l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(c.checkEnabled(),!c.canbeShowAd(e,t))return[2];l=c.game.event,u=c.getAd(e,t),f.label=1;case 1:return f.trys.push([1,3,4,5]),l.emit(o.Events.AD_SHOWING,{type:e,placementId:t}),c.isAdFullSizeShowed=!0,[4,u.instance.showAsync()];case 2:return f.sent(),c.resetDegradationTracking(),c.lastCallAdShownTime[e]=Date.now()/1e3,[3,5];case 3:throw d=f.sent(),c.degradationTracking.failedAttempts++,d;case 4:return l.emit(o.Events.AD_CLOSED,{type:e,placementId:t}),c.isAdFullSizeShowed=!1,[7];case 5:return[2]}})})()}},{key:"getAdStatus",value:function getAdStatus(e,t){return this.checkEnabled(),this.getAd(e,t).instance.status}},{key:"getAd",value:function getAd(e,t){var o=null;if(t?o=this.getAdByPlacementId(t,e):o=this.getPriorityAdByType(e),!o)throw new ew("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return o}},{key:"getAdsByType",value:function getAdsByType(e){return eb.vals(this.ads).filter(function(t){return t.type===e})}},{key:"getAdByPlacementId",value:function getAdByPlacementId(e,t){var o=eb.vals(this.ads);return ek.search(o,function(o){return o.placementId===e&&(!t||o.type===t)})||null}},{key:"getPriorityAdByType",value:function getPriorityAdByType(e){var t=this.getAdsByType(e);if(!t.length)return null;return ek.search(t,function(t){return t.type===e})||null}},{key:"canbeShowAd",value:function canbeShowAd(e,t){return this.canbeShowAdByTime(e,t)}},{key:"canbeShowAdByTime",value:function canbeShowAdByTime(e,t){try{var o,c=Date.now()/1e3;if(t)o=this.getCommonAdConfig(t);else{var l=this.getPriorityAdByType(e);if(!l)return!1;o=this.getCommonAdConfig(l.placementId)}var u=o.SecondsBetweenAds,d=o.SecondsFirstTime,f=c-this.lastCallAdShownTime[e];return this.lastCallAdShownTime[e]>0?f>u:f>d}catch(e){return!1}}},{key:"canbeShowBannerAd",value:function canbeShowBannerAd(e){try{var t=this.getBannerConfig(e).Platform;if("ALL"===t)return!0;var o=GameSDK.getPlatform();return!!o&&o===t}catch(e){return!1}}},{key:"showBannerAdAsync",value:function showBannerAdAsync(e,t){var o=!(arguments.length>1)||void 0===t||t;var c=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(l){switch(l.label){case 0:if(c.checkEnabled(),t=c.getAd(eA.BANNER,e),!c.canbeShowBannerAd(t.placementId))throw new Error("Banner ad can not be shown");if(c.cleanBannerReloadTimer(t),!o)return[3,2];return[4,c.showBannerAdWithSchedule(t)];case 1:return l.sent(),[3,4];case 2:return[4,c.showBannerAdOnce(t)];case 3:l.sent(),l.label=4;case 4:return[2]}})})()}},{key:"showBannerAdOnce",value:function showBannerAdOnce(e){var t=this;return _async_to_generator(function(){var c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(c=t.game.event,!!t.isAdFullSizeShowing())return[3,8];d.label=1;case 1:return d.trys.push([1,3,,8]),[4,e.instance.showAsync()];case 2:return d.sent(),c.emit(o.Events.AD_SHOWING,{type:eA.BANNER,placementId:e.placementId}),[3,8];case 3:u=_instanceof(l=d.sent(),Error)?l:new Error("AdsPlugin.startShowBannerAdInterval: Failed to show banner ad"),d.label=4;case 4:return d.trys.push([4,6,,7]),[4,e.instance.hideAsync()];case 5:return d.sent(),[3,7];case 6:return d.sent(),[3,7];case 7:return c.emit(o.Events.AD_FAILED,{type:eA.BANNER,placementId:e.placementId,error:u}),[3,8];case 8:return[2]}})})()}},{key:"showBannerAdWithSchedule",value:function showBannerAdWithSchedule(e){var t=this;return _async_to_generator(function(){var o,c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,t.showBannerAdOnce(e)];case 1:if(l.sent(),(o=t.getBannerConfig(e.placementId).SecondsReload)<=0)return[2];return c=function(){return t.showBannerAdWithSchedule(e)},e.interval=setTimeout(c,1e3*o),[2]}})})()}},{key:"hideBannerAdAsync",value:function hideBannerAdAsync(e){var t=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return t.checkEnabled(),c=t.getAd(eA.BANNER,e),t.cleanBannerReloadTimer(c),[4,c.instance.hideAsync()];case 1:return l.sent(),t.game.event.emit(o.Events.AD_CLOSED,{type:eA.BANNER,placementId:e}),[2]}})})()}},{key:"cleanBannerReloadTimer",value:function cleanBannerReloadTimer(e){try{var t=e.interval;if(!t)return;clearInterval(t)}catch(e){}}},{key:"getCommonAdConfig",value:function getCommonAdConfig(e){var t=_to_consumable_array(this.config.InterstitialAdOptions).concat(_to_consumable_array(this.config.RewardedVideoAdOptions),_to_consumable_array(this.config.RewardedInterstitialAdOptions)),o=ek.search(t,function(t){return t.PlacementId===e});if(!o)throw new Error("Ad config with placementId ".concat(e," not found"));return o}},{key:"getBannerConfig",value:function getBannerConfig(e){var t=ek.search(this.config.BannerDisplayAdOptions,function(t){return t.PlacementId===e});if(!t)throw new Error("Banner config with placementId ".concat(e," not found"));return t}},{key:"getBannerHeight",value:function getBannerHeight(e,t,o){var c=!(arguments.length>2)||void 0===o||o;this.checkEnabled();var l=this.getBannerConfig(e),u=GameSDK.getBannerHeight(l);return c?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(u+this.safeAreaBottom)*t):u*t}},{key:"getSafeAreaBottom",value:function getSafeAreaBottom(e){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*e}},{key:"resetDegradationTracking",value:function resetDegradationTracking(){this.degradationTracking={failedAttempts:0,lastSuccessTime:Date.now()}}},{key:"isServiceDegraded",value:function isServiceDegraded(){var e=Date.now(),t=this.config.DegradationTracking,o=t.MaxFailedAttempts,c=t.ResetTimeMinutes,l=this.degradationTracking,u=l.lastSuccessTime,d=l.failedAttempts;return e-u>6e4*c&&this.resetDegradationTracking(),d>=o}}]),$a}(c.Plugins.BasePlugin);var eP={APP_LAUNCH:"app_launch",APP_INITIALIZED:"app_initialized",ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",USE_ITEM:"use_item",EARN_ITEM:"earn_item",GET_FREE_ITEM:"get_free_item",SHARE:"share",INVITE:"invite",MESSAGE:"message",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_INIT:"ad_init",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOWING:"ad_showing",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",SWITCH_GAME_POPUP:"switch_game_popup",SWITCH_GAME:"switch_game"};var eE=/*#__PURE__*/function(){function Ue(){_class_call_check(this,Ue),h(this,"history",[]),h(this,"missing",[]),h(this,"outOfOrder",[]),h(this,"completed",!1),h(this,"failed",!1),h(this,"warned",[]),h(this,"debug",!1)}return _create_class(Ue,[{key:"addEvent",value:function addEvent(e,t){if(this.completed||this.failed){this.debugLog("Skip event:",e);return}this.history.push(e),this.validateAndUpdate(e)}},{key:"validateAndUpdate",value:function validateAndUpdate(e){var t=this.validateFunnelState();if(t.hasFailed){this.failed=!0,this.logValidationError();return}t.hasWarnings&&this.handleWarnings(t.warnings),this.checkFunnelCompletion(e)}},{key:"validateFunnelState",value:function validateFunnelState(){var e={hasFailed:!1,hasWarnings:!1,warnings:[]},t=this.getCurrentSteps().filter(function(e){return e.required});for(var o=0;o<t.length;o++){var c=t[o],l=this.history.indexOf(c.name);if(-1===l)return this.missing=[c.name],e.hasFailed=!0,e;if(o>0){var u=t[o-1];if(this.history.indexOf(u.name)>l)return this.missing=[u.name],e.hasFailed=!0,e}}var d=this.validateDependencies();return d.length>0&&(e.hasWarnings=!0,e.warnings=d,this.outOfOrder=d),e}},{key:"getCurrentSteps",value:function getCurrentSteps(){var e=this.history[this.history.length-1],t=this.funnelSteps.findIndex(function(t){return t.name===e});return this.funnelSteps.slice(0,t+1)}},{key:"validateDependencies",value:function validateDependencies(){var e=this;var t=[];return this.history.forEach(function(o,c){var l;var u=e.funnelSteps.find(function(e){return e.name===o});if(!(null!=(l=null==u?void 0:u.dependencies)&&l.length))return;var d=u.dependencies.find(function(t){return!e.history.includes(t)||e.history.indexOf(t)>c});d&&!e.warned.includes(o)&&(t.push({event:o,missingDependency:d}),e.warned.push(o))}),t}},{key:"checkFunnelCompletion",value:function checkFunnelCompletion(e){var t=this;if(e!==this.funnelSteps[this.funnelSteps.length-1].name)return;this.funnelSteps.filter(function(e){return e.required}).every(function(e){return t.history.includes(e.name)})&&(this.completed=!0,this.logCompletion())}},{key:"handleWarnings",value:function handleWarnings(e){var t=true,o=false,c=void 0;try{for(var l,u=e[Symbol.iterator]();!(t=(l=u.next()).done);t=true)l.value}catch(e){o=true,c=e}finally{try{if(!t&&null!=u.return)u.return()}finally{if(o)throw c}}}},{key:"logValidationError",value:function logValidationError(){}},{key:"logCompletion",value:function logCompletion(){}},{key:"debugLog",value:function debugLog(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o]}},{key:"isFunnelCompleted",value:function isFunnelCompleted(){return this.completed}},{key:"isFunnelFailed",value:function isFunnelFailed(){return this.failed}},{key:"getEventHistory",value:function getEventHistory(){return _to_consumable_array(this.history)}},{key:"getMissingEvents",value:function getMissingEvents(){return _to_consumable_array(this.missing)}},{key:"getOutOfOrderEvents",value:function getOutOfOrderEvents(){return _to_consumable_array(this.outOfOrder)}}]),Ue}();var ex=/*#__PURE__*/function(e){function ka(){var e;return _class_call_check(this,ka),e=_call_super(this,ka,arguments),h(e,"debug",!1),h(e,"funnelSteps",[{name:eP.AD_INIT,required:!0,payload:{service:"adsense"},description:"Init adsense ad"},{name:eP.AD_LOAD_FAILED,required:!1,payload:{service:e.service},description:"Platform ad load failed (trigger for adsense)"},{name:eP.AD_LOAD,required:!0,payload:{service:"adsense"},description:"Start loading adsense ad"},{name:eP.AD_LOAD_FAILED,required:!1,dependencies:[eP.AD_LOAD],payload:{service:"adsense"},description:"Adsense ad load failed"},{name:eP.AD_SHOWING,required:!0,dependencies:[eP.AD_LOAD],payload:{service:"adsense"},description:"Adsense ad is showing"},{name:eP.AD_SHOW,required:!1,dependencies:[eP.AD_SHOWING],payload:{service:"adsense"},description:"Adsense ad shown successfully"},{name:eP.AD_SHOW_FAILED,required:!1,dependencies:[eP.AD_SHOWING],payload:{service:"adsense"},description:"Adsense ad show failed"},{name:eP.AD_LOAD,required:!1,payload:{service:"adsense"},description:"Preload adsense ad"}]),e}return _inherits(ka,e),_create_class(ka,[{key:"service",get:function get(){var e;return null!==(e=null==GameSDK?void 0:GameSDK.getSDKName())&&void 0!==e?e:"GameCore"}},{key:"addEvent",value:function addEvent(e,t){((null==t?void 0:t.service)==="adsense"||e===eP.AD_LOAD_FAILED&&(null==t?void 0:t.service)==="platform")&&_get(_get_prototype_of(ka.prototype),"addEvent",this).call(this,e,t)}}]),ka}(eE);var eC=/*#__PURE__*/function(e){function Va(){var e;return _class_call_check(this,Va),e=_call_super(this,Va,arguments),h(e,"debug",!1),h(e,"funnelSteps",[{name:eP.APP_LAUNCH,required:!0,description:"Application launched"},{name:eP.APP_INITIALIZED,required:!0,dependencies:[eP.APP_LAUNCH],description:"Application initialized"},{name:eP.ENGINE_READY,required:!0,dependencies:[eP.APP_INITIALIZED],description:"Game engine initialized"},{name:eP.LOAD_START,required:!0,dependencies:[eP.ENGINE_READY],description:"Start loading game assets"},{name:eP.LOAD_COMPLETE,required:!0,dependencies:[eP.LOAD_START],description:"Game assets loaded completely"},{name:eP.APP_READY,required:!0,dependencies:[eP.LOAD_COMPLETE],description:"Game is ready to play"}]),e}return _inherits(Va,e),Va}(eE);var eT=/*#__PURE__*/function(e){function Ba(){var e;return _class_call_check(this,Ba),e=_call_super(this,Ba,arguments),h(e,"debug",!1),h(e,"funnelSteps",[{name:eP.AD_INIT,required:!0,payload:{service:e.service},description:"Init platform ad"},{name:eP.AD_LOAD,required:!0,payload:{service:e.service},description:"Start loading platform ad"},{name:eP.AD_LOAD_FAILED,required:!1,dependencies:[eP.AD_LOAD],payload:{service:e.service},description:"Platform ad load failed"},{name:eP.AD_SHOWING,required:!0,dependencies:[eP.AD_LOAD],payload:{service:e.service},description:"Platform ad is showing"},{name:eP.AD_SHOW,required:!1,dependencies:[eP.AD_SHOWING],payload:{service:e.service},description:"Platform ad shown successfully"},{name:eP.AD_SHOW_FAILED,required:!1,dependencies:[eP.AD_SHOWING],payload:{service:e.service},description:"Platform ad show failed"},{name:eP.AD_LOAD,required:!1,payload:{service:e.service},description:"Preload platform ad"}]),e}return _inherits(Ba,e),_create_class(Ba,[{key:"service",get:function get(){var e;return null!==(e=null==GameSDK?void 0:GameSDK.getSDKName())&&void 0!==e?e:"GameCore"}},{key:"addEvent",value:function addEvent(e,t){(null==t?void 0:t.service)===this.service&&_get(_get_prototype_of(Ba.prototype),"addEvent",this).call(this,e,t)}}]),Ba}(eE);var eL=o.Utils,eN=eL.String,eO=eL.Valid;var eR=/*#__PURE__*/function(){function Ha(e,t,o){_class_call_check(this,Ha),h(this,"game"),h(this,"name"),h(this,"color"),h(this,"options"),h(this,"selfLog"),h(this,"currentPath"),this.game=e,this.name=t,this.options=o,this.color=o.color||"#FFF",this.selfLog=o.log,this.currentPath="/"}return _create_class(Ha,[{key:"event",value:function event(e,t){this.logInfo("event",{name:e,payload:t});var o=this.formatEventName(e);this.processEvent(o,t)}},{key:"logInfo",value:function logInfo(e,t){this.selfLog}},{key:"pageview",value:function pageview(e){var t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),document.title=t,this.event(eP.PAGE_VIEW,{path_path:e,page_title:t})}},{key:"levelStart",value:function levelStart(e,t,o){this.event(eP.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e),game_mode:o?eN.toUpperCamelCase(o):void 0})}},{key:"levelFail",value:function levelFail(e,t,o){this.event(eP.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e),game_mode:o?eN.toUpperCamelCase(o):void 0})}},{key:"levelRescue",value:function levelRescue(e,t,o){this.event(eP.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e),game_mode:o?eN.toUpperCamelCase(o):void 0})}},{key:"levelComplete",value:function levelComplete(e,t,o){this.event(eP.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e),game_mode:o?eN.toUpperCamelCase(o):void 0})}},{key:"initAdEvent",value:function initAdEvent(e){var t=e.adService,o=e.state;this.event(eP.AD_INIT,{ad_service:t,state:o})}},{key:"loadAdEvent",value:function loadAdEvent(e){var t=e.type,o=e.placement,c=e.service;this.event(eP.AD_LOAD,{ad_type:t,screen_name:o,ad_service:c})}},{key:"showAdEvent",value:function showAdEvent(e){var t=e.type,o=e.placement,c=e.service;this.event(eP.AD_SHOW,{ad_type:t,screen_name:o,ad_service:c})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){var t=e.placement,o=e.service;this.loadAdEvent({type:"interstitial",placement:t,service:o})}},{key:"showInterstitialAd",value:function showInterstitialAd(e){var t=e.placement,o=e.service;this.showAdEvent({type:"interstitial",placement:t,service:o})}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){var t=e.placement,o=e.service;this.loadAdEvent({type:"rewarded_video",placement:t,service:o})}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){var t=e.placement,o=e.service;this.showAdEvent({type:"rewarded_video",placement:t,service:o})}},{key:"receiveVideoReward",value:function receiveVideoReward(e){var t=e.placement,o=e.service;this.event(eP.AD_REWARD,{screen_name:t,ad_service:o})}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(e){var t=e.placement,o=e.service;this.loadAdEvent({type:"rewarded_interstitial",placement:t,service:o})}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(e){var t=e.placement,o=e.service;this.showAdEvent({type:"rewarded_interstitial",placement:t,service:o})}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(e){var t=e.placement,o=e.service;this.event(eP.AD_REWARD,{screen_name:t,ad_service:o})}},{key:"loadAdFail",value:function loadAdFail(e){var t=e.type,o=e.placement,c=e.service;this.event(eP.AD_LOAD_FAILED,{ad_type:t,screen_name:o,ad_service:c})}},{key:"showAdFail",value:function showAdFail(e){var t=e.type,o=e.placement,c=e.service;this.event(eP.AD_SHOW_FAILED,{ad_type:t,screen_name:o,ad_service:c})}},{key:"showingAd",value:function showingAd(e){var t=e.type,o=e.placement,c=e.service;this.event(eP.AD_SHOWING,{ad_type:t,screen_name:o,ad_service:c})}},{key:"formatEventName",value:function formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(eN.padStart(e.toString(),5,"0"))}},{key:"getPageTitle",value:function getPageTitle(e){var t=e.split("/").pop();if(!eO.isString(t))return e;var o=t.replace(/([-_\s.])/g," $1");return eN.toUpperCamelCase(o)}},{key:"addGameModeToPageTitle",value:function addGameModeToPageTitle(e){var t=this.game.match.getMatchState().mode;return t||(t="Normal"),"".concat(eN.toUpperCamelCase(t),"::").concat(e)}}]),Ha}();o.Plugins.Analytics={Events:eP,BaseFunnel:eE,BaseAnalytics:eR};var eM=/*#__PURE__*/function(e){function ja(e){var t;return _class_call_check(this,ja),h(t=_call_super(this,ja,[e]),"analytics",[]),h(t,"placement","unknown"),h(t,"funnels",[]),h(t,"pageview",function(e){if(!t.isActive())return;t.placement=e;var o=t.getPageByKey(e);var c=true,l=false,u=void 0;try{for(var d,f=t.analytics[Symbol.iterator]();!(c=(d=f.next()).done);c=true)d.value.pageview(o)}catch(e){l=true,u=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw u}}t.logFunnelEvent(eP.PAGE_VIEW)}),t.initFunnels(),t}return _inherits(ja,e),_create_class(ja,[{key:"add",value:function add(e){var t=this.analytics.findIndex(function(t){return t.name===e.name});-1!==t?this.analytics[t]=e:this.analytics.push(e)}},{key:"isActive",value:function isActive(){return this.analytics.length>=1}},{key:"initFunnels",value:function initFunnels(){this.addFunnel(new eC),this.addFunnel(new ex),this.addFunnel(new eT)}},{key:"addFunnel",value:function addFunnel(e){this.funnels.push(e)}},{key:"logFunnelEvent",value:function logFunnelEvent(e,t){var o=true,c=false,l=void 0;try{for(var u,d=this.funnels[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.addEvent(e,t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}}},{key:"event",value:function event(e,t){if(this.isActive()){var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.event(e,t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(e,t)}}},{key:"levelStart",value:function levelStart(e,t,o){if(this.isActive()){var c=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(c=(d=f.next()).done);c=true)d.value.levelStart(e,t,o)}catch(e){l=true,u=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(eP.LEVEL_START,{score:t,mode:o})}}},{key:"levelRescue",value:function levelRescue(e,t,o){if(this.isActive()){var c=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(c=(d=f.next()).done);c=true)d.value.levelRescue(e,t,o)}catch(e){l=true,u=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(eP.LEVEL_RESCUE,{score:t,mode:o})}}},{key:"levelFail",value:function levelFail(e,t,o){if(this.isActive()){var c=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(c=(d=f.next()).done);c=true)d.value.levelFail(e,t,o)}catch(e){l=true,u=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(eP.LEVEL_END,{score:t,mode:o})}}},{key:"levelComplete",value:function levelComplete(e,t,o){if(this.isActive()){var c=true,l=false,u=void 0;try{for(var d,f=this.analytics[Symbol.iterator]();!(c=(d=f.next()).done);c=true)d.value.levelComplete(e,t,o)}catch(e){l=true,u=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw u}}this.logFunnelEvent(eP.LEVEL_END,{score:t,mode:o})}}},{key:"initAdEvent",value:function initAdEvent(e){var t=true,o=false,c=void 0;if(this.isActive())try{for(var l,u=this.analytics[Symbol.iterator]();!(t=(l=u.next()).done);t=true)l.value.initAdEvent(e)}catch(e){o=true,c=e}finally{try{if(!t&&null!=u.return)u.return()}finally{if(o)throw c}}}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.loadInterstitialAd(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_LOAD,t)}},{key:"showInterstitialAd",value:function showInterstitialAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.showInterstitialAd(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_SHOW,t)}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.loadRewardedVideoAd(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_LOAD,t)}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.showRewardedVideoAd(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_SHOW,t)}},{key:"receiveVideoReward",value:function receiveVideoReward(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.receiveVideoReward(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_REWARD,t)}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.loadRewardedInterstitialAd(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_LOAD,t)}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.showRewardedInterstitialAd(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_SHOW,t)}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.receiveInterstitialReward(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_REWARD,t)}},{key:"loadAdFail",value:function loadAdFail(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.loadAdFail(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_LOAD_FAILED,t)}},{key:"showAdFail",value:function showAdFail(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.showAdFail(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_SHOW_FAILED,t)}},{key:"showingAd",value:function showingAd(e){if(!this.isActive())return;var t=_object_spread_props(_object_spread({},e),{placement:this.placement});var o=true,c=false,l=void 0;try{for(var u,d=this.analytics[Symbol.iterator]();!(o=(u=d.next()).done);o=true)u.value.showingAd(t)}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}this.logFunnelEvent(eP.AD_SHOWING,t)}},{key:"getPageByKey",value:function getPageByKey(e){var t=e;if(t.indexOf("_")>-1)return t.replace(/_/g,"-").toLowerCase();var o=t.length-1,c="";for(;o>0;){var l=isNaN(parseInt(c=t.charAt(o),10)),u=c===c.toUpperCase();l&&u&&(t="".concat(t.slice(0,o),"-").concat(t.slice(o))),o--}return t.toLowerCase()}}]),ja}(c.Plugins.BasePlugin);var eF=/*#__PURE__*/function(){function Wa(e){_class_call_check(this,Wa),h(this,"key"),this.key=e}return _create_class(Wa,[{key:"getKey",value:function getKey(){return this.key}}]),Wa}();var eG=Object.defineProperty,ej=Object.getOwnPropertyDescriptor;var eB=o.Utils.Decorator;var eV=/*#__PURE__*/function(){function is(e){_class_call_check(this,is),h(this,"id"),h(this,"isMuteAll"),h(this,"masterVolume"),h(this,"audioClips"),this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}return _create_class(is,[{key:"getId",value:function getId(){return this.id}},{key:"getAudioClip",value:function getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}},{key:"setAudioClip",value:function setAudioClip(e,t){this.audioClips[e]=_object_spread({},this.audioClips[e],t)}},{key:"play",value:function play(e,t){var o=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(!(c=o.getAudioClip(e)))return[3,1];return l=c.audioPlayer,o.playWithRealConfig(l,t),[3,3];case 1:return[4,o.loadAndPlay(e,t)];case 2:u.sent(),u.label=3;case 3:return[2]}})})()}},{key:"loadAndPlay",value:function loadAndPlay(e,t){var o=this;return _async_to_generator(function(){var c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return[4,o.onLoadAudio(e,t)];case 1:if(!(c=d.sent()))return[2];return u=void 0===(l=(t||{}).volume)?1:l,o.setAudioClip(e,{volume:u,audioPlayer:c}),o.playWithRealConfig(c,t),[2]}})})()}},{key:"playWithRealConfig",value:function playWithRealConfig(e,t){if(t){var o=t.volume;t.volume=this.masterVolume*(void 0===o?1:o)}e.play(t)}},{key:"pause",value:function pause(e){var t=this.getAudioClip(e);if(!t)return!1;return t.audioPlayer.pause(),!0}},{key:"resume",value:function resume(e){var t=this.getAudioClip(e);if(!t)return!1;return t.audioPlayer.resume(),!0}},{key:"stop",value:function stop(e){var t=this.getAudioClip(e);if(!t)return!1;return t.audioPlayer.stop(),!0}},{key:"stopAll",value:function stopAll(){this.callAudioPlayers("stop")}},{key:"muteAll",value:function muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}},{key:"unmuteAll",value:function unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}},{key:"setVolume",value:function setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}},{key:"getVolume",value:function getVolume(){return this.masterVolume}},{key:"queueAudioPlayer",value:function queueAudioPlayer(e,t){try{var o=e.audioPlayer,c=e.volume;switch(t){case"play":o.play();break;case"pause":o.pause();break;case"resume":o.resume();break;case"stop":o.stop();break;case"mute":o.setVolume(0);break;case"unmute":case"setVolume":o.setVolume(this.masterVolume*(void 0===c?1:c));break;default:throw new Error("Unsupported function: ".concat(t))}}catch(e){}}},{key:"callAudioPlayers",value:function callAudioPlayers(e){var t=o.Utils.Object.vals(this.audioClips);var c=true,l=false,u=void 0;try{for(var d,f=t[Symbol.iterator]();!(c=(d=f.next()).done);c=true){var y=d.value;this.queueAudioPlayer(y,e)}}catch(e){l=true,u=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw u}}}}]),is}();(function(e,t,o,c){for(var l,u=ej(t,o),d=e.length-1;d>=0;d--)(l=e[d])&&(u=l(t,o,u)||u);u&&eG(t,o,u)})([eB.tryCatch(),eB.validateParams("string")],eV.prototype,"loadAndPlay");var eU=Object.defineProperty,eH=Object.getOwnPropertyDescriptor;o.Plugins.Audio={BaseAudioPlayer:eF,BaseChannelManager:eV};var eK=o.Utils.Decorator;var eW=/*#__PURE__*/function(e){function os(){var e;return _class_call_check(this,os),e=_call_super(this,os,arguments),h(e,"firstChannelId"),h(e,"channels",{}),e}return _inherits(os,e),_create_class(os,[{key:"addChannel",value:function addChannel(e){var t=e.getId();this.channels[t]=e,this.firstChannelId||(this.firstChannelId=t)}},{key:"getChannel",value:function getChannel(e){if(void 0===e)return this.channels[this.firstChannelId];var t=this.channels[e];if(!t)throw new Error("Channel ".concat(e," not found"));return t}},{key:"play",value:function play(e,t,o){var c=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:return[4,c.getChannel(o).play(e,t)];case 1:return l.sent(),[2]}})})()}},{key:"pause",value:function pause(e,t){try{this.getChannel(t).pause(e)}catch(e){}}},{key:"resume",value:function resume(e,t){try{this.getChannel(t).resume(e)}catch(e){}}},{key:"stop",value:function stop(e,t){try{this.getChannel(t).stop(e)}catch(e){}}},{key:"stopAll",value:function stopAll(e){try{this.getChannel(e).stopAll()}catch(e){}}},{key:"mute",value:function mute(e){try{this.getChannel(e).muteAll()}catch(e){}}},{key:"unmute",value:function unmute(e){try{this.getChannel(e).unmuteAll()}catch(e){}}},{key:"setVolume",value:function setVolume(e,t){try{this.getChannel(t).setVolume(e)}catch(e){}}},{key:"getVolume",value:function getVolume(e){try{return this.getChannel(e).getVolume()}catch(e){return -1}}}]),os}(c.Plugins.BasePlugin);(function(e,t,o,c){for(var l,u=eH(t,o),d=e.length-1;d>=0;d--)(l=e[d])&&(u=l(t,o,u)||u);u&&eU(t,o,u)})([eK.tryCatch(),eK.validateParams("string")],eW.prototype,"play");var ez={token:"",isRequesting:!1},eq=o.Utils.Object;var eY=/*#__PURE__*/function(e){function en(){return _class_call_check(this,en),_call_super(this,en,arguments)}return _inherits(en,e),_create_class(en,[{key:"init",value:function init(){this.game.storage.addStorage("auth",ez)}},{key:"requestToken",value:function requestToken(){var e=this;return _async_to_generator(function(){var t,o,c;return _ts_generator(this,function(l){switch(l.label){case 0:t=e.game.storage,l.label=1;case 1:if(l.trys.push([1,3,4,5]),t.getStorageData("auth","isRequesting")||""!==t.getStorageData("auth","token"))return[2];return t.setStorageData("auth","isRequesting",!0),[4,GameSDK.player.getSignedPlayerInfoAsync()];case 2:return o=l.sent().getSignature(),t.setStorageData("auth","token",o),[3,5];case 3:if(c=l.sent(),eq.hasOwn(c,"code")&&"PENDING_REQUEST"===c.code)return[2];return t.setStorageData("auth","token",""),[3,5];case 4:return t.setStorageData("auth","isRequesting",!1),[7];case 5:return[2]}})})()}},{key:"getToken",value:function getToken(){var e;return null!==(e=this.game.storage.getStorageData("auth","token"))&&void 0!==e?e:""}}]),en}(c.Plugins.BasePlugin);var eJ=function(e){return e.SOLO="solo",e.TOURNAMENT="tournament",e.SHARE_INVITE="share_invite",e.MATCHING_GROUP="matching_group_match",e.CHALLENGE_FRIEND="challenge_friend_match",e}(eJ||{});var eX=l,eZ=o.Configs,eQ=o.Utils,e$=eQ.Array,e0=eQ.Valid,e2=eQ.Browser;var e3=/*#__PURE__*/function(){function rn(e){_class_call_check(this,rn),h(this,"game"),this.game=e}return _create_class(rn,[{key:"isValidContextType",value:function isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}},{key:"isValidEntryPointData",value:function isValidEntryPointData(e){return e0.isObject(e)}},{key:"isTournamentEntryPoint",value:function isTournamentEntryPoint(e){return e$.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],e)}},{key:"receiveContext",value:function receiveContext(e,t,o){var c=this.game.storage;c.setStorageData("context","contextId",e),this.isValidEntryPointData(o)&&c.setStorageData("context","entryPointData",o),this.isValidContextType(t)&&c.setStorageData("context","contextType",t)}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t,o,c,l,u,d,f,y,p,g;return _ts_generator(this,function(g){switch(g.label){case 0:if(c=(null!=(o=(t=e.game.storage).getStorageData("context","entryPointData"))?o:{}).type,l=eJ.SOLO,u=eJ.TOURNAMENT,d=eJ.MATCHING_GROUP,f=eJ.SHARE_INVITE,y=eJ.CHALLENGE_FRIEND,p=l,c===u&&(p=u),c===d&&(p=d),(c===y||c===f)&&(p=y),p!==l)return[3,4];if(!eZ.Core.FastCheckTournamentContext)return[3,1];return p=e.fastCheckTournamentContext()||p,[3,3];case 1:return[4,e.outdatedCheckTournamentContext()];case 2:p=g.sent()||p,g.label=3;case 3:g.label=4;case 4:return t.setStorageData("context","sessionContextType",p),[2]}})})()}},{key:"fastCheckTournamentContext",value:function fastCheckTournamentContext(){var e=e2.getQueryParams().entry_point;return!!("string"==typeof e&&this.isTournamentEntryPoint(e))&&eJ.TOURNAMENT}},{key:"outdatedCheckTournamentContext",value:function outdatedCheckTournamentContext(){var e=this;return _async_to_generator(function(){var t,o;return _ts_generator(this,function(c){switch(c.label){case 0:if(t=e.game.storage,!("getTournamentAsync"in GameSDK))return[2,!1];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,GameSDK.getTournamentAsync()];case 2:return o=c.sent(),[2,(t.setStorageData("context","contextId",o.getContextID()),o.getEndTime()>Date.now()/1e3&&eJ.TOURNAMENT)];case 3:return c.sent(),[2,!1];case 4:return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){var e=this.game,t=e.player,o=e.storage,c=o.getStorageData("context","entryPointData"),l=o.getStorageData("context","sessionContextType"),u=t.getPlayerId(),d=null!=c?c:{},f=d.matchId,y=d.playerId,p=d.opponentId,g=void 0===p?V.playerId:p,m=u===y,A=g===V.playerId||[g,y].indexOf(u)>=0,I=eJ.TOURNAMENT,D=eJ.MATCHING_GROUP,k=eJ.SHARE_INVITE,E=eJ.CHALLENGE_FRIEND;var x=eX.SINGLE;l===I&&(x=eX.TOURNAMENT),l!==k||m||(x=eX.CHALLENGE_FRIEND),l===E&&f&&A&&(x=eX.CHALLENGE_FRIEND),l===D&&(x=eX.MATCHING_GROUP),o.setStorageData("context","contextGameMode",x)}}]),rn}();var e1=/*#__PURE__*/function(e){function cs(e){var t;return _class_call_check(this,cs),(t=_call_super(this,cs,[e])).name="PlayerHasFinishedMatch",t.message=null!=e?e:"Player has finished match",t}return _inherits(cs,e),cs}(_wrap_native_super(Error));var e4=/*#__PURE__*/function(e){function Dt(e){var t;return _class_call_check(this,Dt),(t=_call_super(this,Dt,[e])).name="PlayerNotJoinInMatch",t.message=e||"Player is not join in match",t}return _inherits(Dt,e),Dt}(_wrap_native_super(Error));var e5=o.Events,e6=o.Plugins.Analytics,e7=o.Utils.Valid;var e8=/*#__PURE__*/function(){function cn(e){_class_call_check(this,cn),h(this,"game"),this.game=e}return _create_class(cn,[{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t,o,c,l,u,d,f,y,p,g,m,A,I,D,k,E,x,C,T,N,O;return _ts_generator(this,function(R){switch(R.label){case 0:if(u=(l=e.game).player,d=l.storage,f=l.monitorError,y=null!==(t=d.getStorageData("context","contextId"))&&void 0!==t?t:"",p=null!==(o=d.getStorageData("context","entryPointData"))&&void 0!==o?o:{},g=null!==(c=d.getStorageData("context","sessionContextType"))&&void 0!==c?c:"",m=p.type,A=p.matchId,I=p.playerId,D=p.opponentId,k=p.playerScore,!(E=p.action))return[3,2];return[4,e.processEntryPointAction(E)];case 1:R.sent(),R.label=2;case 2:if(x=u.isFirstLogin(),setTimeout(function(){e.logUserAnalytics(x)},1e3),C=eJ.TOURNAMENT,T=eJ.SHARE_INVITE,N=eJ.MATCHING_GROUP,O=eJ.CHALLENGE_FRIEND,g!==C)return[3,6];R.label=3;case 3:return R.trys.push([3,5,,6]),[4,e.processTournamentModeAsync(y)];case 4:return R.sent(),[2];case 5:return R.sent(),null==f||f.sendException(new Error("Process Tournament Fail"),{contextId:y,isFirstLogin:x,entryPointData:p,playerData:u.getPlayerData()}),[3,6];case 6:if(g!==O)return[3,10];if(!(m===T&&"string"==typeof I))return[3,8];return[4,e.processChallengeFromPostAsync(I)];case 7:return R.sent(),[2];case 8:if(!(m===O&&"string"==typeof A&&"string"==typeof I&&"string"==typeof D))return[3,10];return[4,e.processChallengeFromMessageAsync({contextId:y,matchId:A,playerId:I,opponentId:D})];case 9:return R.sent(),[2];case 10:if(!(g===N&&"string"==typeof I&&"number"==typeof k))return[3,12];return[4,e.processMatchingGroupModeAsync(I,k)];case 11:return R.sent(),[2];case 12:if(!x)return[3,14];return[4,e.processSingleModeAsync(!0)];case 13:return R.sent(),u.loggedIn(),[2];case 14:return e.switchToDashboardScene(),[2]}})})()}},{key:"logUserAnalytics",value:function logUserAnalytics(e){try{var t=this.game,o=t.player,c=t.analytics;if(e)c.event(e6.Events.NEW_USER);else{var l=o.getPlayerData().gameData.coins;c.event(e6.Events.RETURNING_USER,{coins:l})}}catch(e){}}},{key:"processEntryPointAction",value:function processEntryPointAction(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:switch(c.trys.push([0,7,,8]),o=t.game.player,e){case"reset_data":return[3,1];case"enable_debug":return[3,3];case"set_locale_en":return[3,4];case"set_locale_ru":return[3,5]}return[3,6];case 1:return o.setPlayerDataByName("score",0),o.setPlayerDataByName("endlessScore",0),o.setGameData({coins:0,level:1}),[4,o.syncProfileToServer()];case 2:return c.sent(),[3,6];case 3:return o.setPlayerDataByName("debug",!0),[3,6];case 4:return t.requestSetLocale("en"),[3,6];case 5:return t.requestSetLocale("ru"),[3,6];case 6:return[3,8];case 7:return c.sent(),[3,8];case 8:return[2]}})})()}},{key:"requestSetLocale",value:function requestSetLocale(e){this.game.event.emit(e5.REQUEST_LANGUAGE,{locale:e})}},{key:"processTournamentModeAsync",value:function processTournamentModeAsync(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(c=(o=t.game).match,l=o.player.getPlayerId(),e7.isEmpty(e))throw new Error("Cannot get contextId");return[4,c.tournament.continue.processAsync({playerId:l,contextId:e})];case 1:return u.sent(),t.switchToGameScene(),[2]}})})()}},{key:"processChallengeFromPostAsync",value:function processChallengeFromPostAsync(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(c=(o=t.game).match,(l=o.player.getPlayerId())!==e)return[3,2];return[4,c.single.start.processAsync({playerId:l})];case 1:return u.sent(),[3,6];case 2:return u.trys.push([2,4,,6]),[4,c.challenge.friend.processAsync({playerId:l,opponentId:e})];case 3:return u.sent(),[3,6];case 4:return u.sent(),[4,c.single.start.processAsync({playerId:l})];case 5:return u.sent(),[3,6];case 6:return t.switchToGameScene(),[2]}})})()}},{key:"processChallengeFromMessageAsync",value:function processChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,7]),[4,t.processContinueChallengeFromMessageAsync(e)];case 1:return c.sent(),[3,7];case 2:if(!_instanceof(o=c.sent(),e1))return[3,4];return[4,t.processAwaitChallengeFromMessageAsync(e)];case 3:return c.sent(),[2];case 4:if(!_instanceof(o,e4))return[3,6];return[4,t.processJoinChallengeFromMessageAsync(e)];case 5:return c.sent(),[2];case 6:return t.switchToDashboardScene(),[3,7];case 7:return[2]}})})()}},{key:"processContinueChallengeFromMessageAsync",value:function processContinueChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(o=e.contextId,c=e.matchId,l=e.playerId,u=e.opponentId,f=(d=t.game).match,y=d.player.getPlayerId(),l!==y)return[3,2];return[4,f.challenge.continue.processAsync({contextId:o,matchId:c,playerId:y,opponentId:u})];case 1:return g.sent(),[3,4];case 2:return p=u===V.playerId,[4,f.challenge.continue.processAsync({contextId:o,matchId:c,playerId:y,opponentId:p?u:l})];case 3:g.sent(),g.label=4;case 4:return t.switchToGameScene(),[2]}})})()}},{key:"processJoinChallengeFromMessageAsync",value:function processJoinChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:return o=e.contextId,c=e.matchId,l=e.playerId,d=(u=t.game).match,f=u.player.getPlayerId(),[4,d.challenge.join.processAsync({contextId:o,matchId:c,playerId:f,opponentId:l})];case 1:return y.sent(),t.switchToGameScene(),[2]}})})()}},{key:"processAwaitChallengeFromMessageAsync",value:function processAwaitChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:o=e.contextId,c=e.matchId,l=e.playerId,d=(u=t.game).match,f=u.player.getPlayerId(),y.label=1;case 1:return y.trys.push([1,3,,5]),[4,d.challenge.await.processAsync({contextId:o,matchId:c,playerId:f,opponentId:l})];case 2:return y.sent(),t.switchToChallengeResultScene(),[3,5];case 3:return y.sent(),[4,t.processResultChallengeFromMessageAsync(e)];case 4:return y.sent(),[3,5];case 5:return[2]}})})()}},{key:"processResultChallengeFromMessageAsync",value:function processResultChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:o=e.contextId,c=e.matchId,l=e.playerId,d=(u=t.game).match,f=u.player.getPlayerId(),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,d.challenge.result.processAsync({contextId:o,matchId:c,playerId:f,opponentId:l})];case 2:return y.sent(),t.switchToChallengeResultScene(),[3,4];case 3:return y.sent(),t.switchToDashboardScene(),[3,4];case 4:return[2]}})})()}},{key:"processMatchingGroupModeAsync",value:function processMatchingGroupModeAsync(e,t){var o=this;return _async_to_generator(function(){var c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return l=(c=o.game).match,u=c.player,[4,l.group.join.processAsync({playerId:u.getPlayerId(),opponentId:e,opponentScore:t})];case 1:return d.sent(),o.switchToGameScene(),[2]}})})()}},{key:"processSingleModeAsync",value:function processSingleModeAsync(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(c=(o=t.game).match,l=o.player.getPlayerId(),!e)return[3,2];return[4,c.handler.setMatchCustomData({level:0})];case 1:u.sent(),u.label=2;case 2:return[4,c.single.start.processAsync({playerId:l})];case 3:return u.sent(),t.switchToGameScene(),[2]}})})()}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){this.game.event.emit(e5.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}},{key:"switchToGameScene",value:function switchToGameScene(){this.game.event.emit(e5.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}},{key:"switchToChallengeResultScene",value:function switchToChallengeResultScene(){this.game.event.emit(e5.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}}]),cn}();var e9={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},te=o.Events;var tt=/*#__PURE__*/function(e){function ln(e){var t;return _class_call_check(this,ln),h(t=_call_super(this,ln,[e]),"context"),h(t,"loader"),t.loader=new e8(e),t.context=new e3(e),t}return _inherits(ln,e),_create_class(ln,[{key:"init",value:function init(){this.game.storage.addStorage("context",e9)}},{key:"getSessionContextTypes",value:function getSessionContextTypes(){return eJ}},{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t,o,c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:o=(t=e.game).event,c=t.monitorError,d.label=1;case 1:if(d.trys.push([1,5,,6]),o.getEventEmitCount(te.CONTEXT_SESSION_TYPE_DETECTED)>0)return[3,3];return[4,o.waitTo(te.CONTEXT_SESSION_TYPE_DETECTED,3e3)];case 2:d.sent(),d.label=3;case 3:return[4,e.loader.processContextData()];case 4:return d.sent(),o.emit(te.CONTEXT_DATA_PROCESSED),[3,6];case 5:if(l=d.sent(),e.switchToDashboardScene(),c)u=_instanceof(l,Error)?l:new Error(JSON.stringify(l)),c.sendException(u);return[3,6];case 6:return[2]}})})()}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t,o,c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:o=(t=e.game).event,c=t.monitorError,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,e.context.detectContextSessionType()];case 2:return d.sent(),o.emit(te.CONTEXT_SESSION_TYPE_DETECTED),[3,4];case 3:if(l=d.sent(),c)u=_instanceof(l,Error)?l:new Error(JSON.stringify(l)),c.sendException(u);return[3,4];case 4:return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){this.context.detectContextGameMode()}},{key:"receiveContext",value:function receiveContext(e,t,o){this.context.receiveContext(e,t,o)}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){this.game.event.emit(te.SWITCH_SCENE,{sceneName:"DashboardScene"})}}]),ln}(c.Plugins.BasePlugin);var ta=o.Utils.Valid,tn=e9.contextId,tr=e9.contextType,ti=e9.entryPointData,to="is invalid";var tc=/*#__PURE__*/function(e){function hs(){var e;return _class_call_check(this,hs),e=_call_super(this,hs,arguments),h(e,"data"),e}return _inherits(hs,e),_create_class(hs,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateContextId",value:function validateContextId(e){ta.isString(e)||this.exception("contextId",to)}},{key:"validateContextType",value:function validateContextType(e){ta.isString(e)&&e||this.exception("contextType",to)}},{key:"validateEntryPointData",value:function validateEntryPointData(e){ta.isObject(e)||this.exception("entryPointData",to)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(hs.prototype),"toObject",this).call(this)}}]),hs}(x);tc.addDefaultData({contextId:tn,contextType:tr,entryPointData:ti}),o.Dtos.Context={Info:tc};var tl={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},tu=o.Utils.Object;var td=/*#__PURE__*/function(){function fn(){_class_call_check(this,fn)}return _create_class(fn,[{key:"getDailyRewardsAsync",value:function getDailyRewardsAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,tu.vals(tl)]})})()}}]),fn}();var th={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},tf={dailyRewards:{}},ty=o.Configs.DailyRewards,t_=ty.CheckInterrupt,tv=ty.MaxDays,tp=ty.MockTime,tg=o.Utils,tm=tg.Array,tA=tg.Valid,tw=tp>0?tp:864e5;var tI=/*#__PURE__*/function(e){function mn(){var e;return _class_call_check(this,mn),e=_call_super(this,mn,arguments),h(e,"dailyRewardsApi",new td),e}return _inherits(mn,e),_create_class(mn,[{key:"init",value:function init(){this.game.storage.addStorage("dailyRewards",tf)}},{key:"requestDailyRewardsAsync",value:function requestDailyRewardsAsync(){var e=this;return _async_to_generator(function(){var t,o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return[4,e.dailyRewardsApi.getDailyRewardsAsync()];case 1:return t=u.sent(),c=(o=e.parseDailyRewards(t)).logs,l=o.rewards,e.setRewardsLog(c),e.setDailyRewards(l),[2]}})})()}},{key:"getDailyRewards",value:function getDailyRewards(){return this.game.storage.getStorageData("dailyRewards","dailyRewards")||null}},{key:"logLoginReward",value:function logLoginReward(){t_?this.logFromFirstReward():this.logFromLastReward()}},{key:"logFromFirstReward",value:function logFromFirstReward(){var e=this.game.player.getPlayerData().dailyRewarded,t=e.logDays,o=e.firstReward,c=new Date,l=_to_consumable_array(t);if(0===o){l[0]=!0,tA.isDebugger()||c.setHours(0,0,0,0),this.setRewardsLog({logDays:l,firstReward:c.valueOf(),lastReward:c.valueOf()});return}var u=Math.floor((c.valueOf()-o)/tw);u>=tv||u>=t.length||(l[u]=!0,tA.isDebugger()||c.setHours(0,0,0,0),this.setRewardsLog({logDays:l,lastReward:c.valueOf()}))}},{key:"logFromLastReward",value:function logFromLastReward(){var e=this.game.player.getPlayerData().dailyRewarded,t=e.logDays,o=e.lastReward,c=new Date,l=_to_consumable_array(t);if(0===o){l[0]=!0,tA.isDebugger()||c.setHours(0,0,0,0),this.setRewardsLog({logDays:l,firstReward:c.valueOf(),lastReward:c.valueOf()});return}if(Math.floor((c.valueOf()-o)/tw)<1)return;var u=tm.searchIndex(l,function(e){return!1===e});void 0!==u&&(l[u]=!0,tA.isDebugger()||c.setHours(0,0,0,0),this.setRewardsLog({logDays:l,lastReward:c.valueOf()}))}},{key:"setRewardsLog",value:function setRewardsLog(e){var t=e.logDays,o=e.firstReward,c=e.lastReward,l=this.game.player,u=l.getPlayerData().dailyRewarded;l.setPlayerDataByName("dailyRewarded",{logDays:void 0!==t?_to_consumable_array(t):_to_consumable_array(u.logDays),firstReward:null!=o?o:u.firstReward,lastReward:null!=c?c:u.lastReward})}},{key:"parseDailyRewards",value:function parseDailyRewards(e){var t=this.game.player.getPlayerData().dailyRewarded,o=t.logDays,c=t.firstReward,l=t.lastReward;if(void 0===o||void 0===c||0===c||void 0===l||0===l||o.length!==e.length){var u=this.getDefaultDailyRewards(e);return{logs:{logDays:u.logDays,firstReward:0,lastReward:0},rewards:u.rewards}}return t_?this.parseFromFirstReward(e,o,c,l):this.parseFromLastReward(e,o,c,l)}},{key:"parseFromFirstReward",value:function parseFromFirstReward(e,t,o,c){var l=Date.now()-o;if(l<0){var u=this.getDefaultDailyRewards(e);return{logs:{logDays:u.logDays,firstReward:0,lastReward:0},rewards:u.rewards}}var d=Math.floor(l/tw),f=d>=tv||d>=t.length,y=void 0!==tm.search(t.slice(0,d),function(e){return!1===e});if(f||y){var p=this.getDefaultDailyRewards(e);return{logs:{logDays:p.logDays,firstReward:0,lastReward:c},rewards:p.rewards}}var g=[],m={};for(var A=0;A<e.length;A++){var I=e[A],D=g.length>d,k=g.length===d,E=t[A];if(D){g.push(!1),m[I.id]=_object_spread_props(_object_spread({},I),{status:th.WAITING});continue}if(g.push(E),k){m[I.id]=_object_spread_props(_object_spread({},I),{status:E?th.REWARDED:th.READY});continue}m[I.id]=_object_spread_props(_object_spread({},I),{status:E?th.REWARDED:th.SKIPPED})}return{logs:{logDays:g,firstReward:o,lastReward:c},rewards:m}}},{key:"parseFromLastReward",value:function parseFromLastReward(e,t,o,c){var l=Date.now()-c;if(l<0){var u=this.getDefaultDailyRewards(e);return{logs:{logDays:u.logDays,firstReward:0,lastReward:0},rewards:u.rewards}}var d=Math.floor(l/tw)>=1,f=tm.searchIndex(t,function(e){return!1===e});if(-1===f&&d){var y=this.getDefaultDailyRewards(e);return y.rewards[e[0].id].status=d?th.READY:th.WAITING,{logs:{logDays:y.logDays,firstReward:0,lastReward:c},rewards:y.rewards}}var p=[],g={};for(var m=0,A=e.length;m<A;m++){var I=e[m],D=-1!==f&&m>f,k=m===f;if(D){p.push(!1),g[I.id]=_object_spread_props(_object_spread({},I),{status:th.WAITING});continue}if(k){p.push(!1),g[I.id]=_object_spread_props(_object_spread({},I),{status:d?th.READY:th.WAITING});continue}p.push(!0),g[I.id]=_object_spread_props(_object_spread({},I),{status:th.REWARDED})}return{logs:{logDays:p,firstReward:o,lastReward:c},rewards:g}}},{key:"getDefaultDailyRewards",value:function getDefaultDailyRewards(e){var t=[],o={};var c=true,l=false,u=void 0;try{for(var d,f=e[Symbol.iterator]();!(c=(d=f.next()).done);c=true){var y=d.value;t.push(!1),o[y.id]=_object_spread_props(_object_spread({},y),{status:th.WAITING})}}catch(e){l=true,u=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw u}}return o[e[0].id].status=th.READY,{logDays:t,rewards:o}}},{key:"setDailyRewards",value:function setDailyRewards(e){this.game.storage.setStorageData("dailyRewards","dailyRewards",e)}}]),mn}(c.Plugins.BasePlugin);var tD={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,o="~";function s(){}function a(e,t,o){this.fn=e,this.context=t,this.once=o||!1}function n(e,t,c,l,u){if("function"!=typeof c)throw new TypeError("The listener must be a function");var d=new a(c,l||e,u),f=o?o+t:t;return e._events[f]?e._events[f].fn?e._events[f]=[e._events[f],d]:e._events[f].push(d):(e._events[f]=d,e._eventsCount++),e}function i(e,t){0===--e._eventsCount?e._events=new s:delete e._events[t]}function r(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(o=!1)),r.prototype.eventNames=function(){var e,c,l=[];if(0===this._eventsCount)return l;for(c in e=this._events)t.call(e,c)&&l.push(o?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(e)):l},r.prototype.listeners=function(e){var t=o?o+e:e,c=this._events[t];if(!c)return[];if(c.fn)return[c.fn];for(var l=0,u=c.length,d=new Array(u);l<u;l++)d[l]=c[l].fn;return d},r.prototype.listenerCount=function(e){var t=o?o+e:e,c=this._events[t];return c?c.fn?1:c.length:0},r.prototype.emit=function(e,t,c,l,u,d){var f=o?o+e:e;if(!this._events[f])return!1;var y,p,g=this._events[f],m=arguments.length;if(g.fn){switch(g.once&&this.removeListener(e,g.fn,void 0,!0),m){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,t),!0;case 3:return g.fn.call(g.context,t,c),!0;case 4:return g.fn.call(g.context,t,c,l),!0;case 5:return g.fn.call(g.context,t,c,l,u),!0;case 6:return g.fn.call(g.context,t,c,l,u,d),!0}for(p=1,y=new Array(m-1);p<m;p++)y[p-1]=arguments[p];g.fn.apply(g.context,y)}else{var A,I=g.length;for(p=0;p<I;p++)switch(g[p].once&&this.removeListener(e,g[p].fn,void 0,!0),m){case 1:g[p].fn.call(g[p].context);break;case 2:g[p].fn.call(g[p].context,t);break;case 3:g[p].fn.call(g[p].context,t,c);break;case 4:g[p].fn.call(g[p].context,t,c,l);break;default:if(!y)for(A=1,y=new Array(m-1);A<m;A++)y[A-1]=arguments[A];g[p].fn.apply(g[p].context,y)}}return!0},r.prototype.on=function(e,t,o){return n(this,e,t,o,!1)},r.prototype.once=function(e,t,o){return n(this,e,t,o,!0)},r.prototype.removeListener=function(e,t,c,l){var u=o?o+e:e;if(!this._events[u])return this;if(!t)return i(this,u),this;var d=this._events[u];if(d.fn)d.fn!==t||l&&!d.once||c&&d.context!==c||i(this,u);else{for(var f=0,y=[],p=d.length;f<p;f++)(d[f].fn!==t||l&&!d[f].once||c&&d[f].context!==c)&&y.push(d[f]);y.length?this._events[u]=1===y.length?y[0]:y:i(this,u)}return this},r.prototype.removeAllListeners=function(e){var t;return e?(t=o?o+e:e,this._events[t]&&i(this,t)):(this._events=new s,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=o,r.EventEmitter=r,e.exports=r})(tD);var tk=tD.exports;var tb=new(p(tk)),tS={names:[],history:[]};var tP=/*#__PURE__*/function(e){function In(){var e;return _class_call_check(this,In),e=_call_super(this,In,arguments),h(e,"enableLog",!1),h(e,"muteEvents",[]),e}return _inherits(In,e),_create_class(In,[{key:"init",value:function init(){this.game.storage.addStorage("event",tS)}},{key:"enableLogEvent",value:function enableLogEvent(){this.enableLog=!0}},{key:"on",value:function on(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"on","listening"),tb.on(e,t)}},{key:"once",value:function once(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"once","listening"),tb.once(e,t)}},{key:"waitTo",value:function waitTo(e,t){var o=this;return new Promise(function(c,l){var u;var r=function(e){clearTimeout(u),c(e)};o.once(e,r),t&&t>0&&(u=setTimeout(function(){o.off(e,r),l(new Error("Event ".concat(e," timeout")))},t))})}},{key:"catchUp",value:function catchUp(e,t){if(this.validateCallback(t),this.once(e,t),!(this.getEventEmitCount(e)>0))return;var o,c=(null!==(o=this.getLastEventInfo(e))&&void 0!==o?o:{}).payload;this.emit(e,c)}},{key:"off",value:function off(e,t){this.validateCallback(t),tb.off(e,t),this.addHistory(e,"action","removed")}},{key:"mute",value:function mute(e){this.muteEvents.indexOf(e)>-1||this.muteEvents.push(e)}},{key:"clear",value:function clear(e){tb.removeAllListeners(e),this.addHistory(e,"action","removed")}},{key:"emit",value:function emit(e,t){if(this.muteEvents.indexOf(e)>-1)return;var o=[];t&&(o=[t]),this.addHistory(e,"action","called",t),tb.emit.apply(tb,[e].concat(_to_consumable_array(o)))}},{key:"validateCallback",value:function validateCallback(e){if("function"!=typeof e)throw new Error("Callback must be a function")}},{key:"addEventName",value:function addEventName(e){var t=this.game.storage.getStorageData("event","names");t&&t.indexOf(e)<0&&t.push(e)}},{key:"limitHistory",value:function limitHistory(e){if(e.length<=1e4)return e;return o.Utils.Array.limit(e,1e4)}},{key:"getEventListeners",value:function getEventListeners(){return Object.keys(tb.eventNames())}},{key:"getHistory",value:function getHistory(){var e;var t=null!==(e=this.game.storage.getStorageData("event","history"))&&void 0!==e?e:[];return this.limitHistory(t)}},{key:"getEventEmitCount",value:function getEventEmitCount(e){return this.getHistory().filter(function(t){return t.name===e&&"called"===t.status}).length}},{key:"getLastEventInfo",value:function getLastEventInfo(e){var t=this.getHistory();var o=null;for(var c=t.length-1;c>=0;c--)if(t[c].name===e){o=t[c];break}return o}},{key:"getTypeFromHistory",value:function getTypeFromHistory(e){var t,o=this.getLastEventInfo(e);return null!==(t=null==o?void 0:o.type)&&void 0!==t?t:null}},{key:"getCallsFromHistory",value:function getCallsFromHistory(e){var t,o=this.getLastEventInfo(e);return null!==(t=null==o?void 0:o.called)&&void 0!==t?t:0}},{key:"addHistory",value:function addHistory(e,t,o,c){var l;var u=null!==(l=this.getTypeFromHistory(e))&&void 0!==l?l:t,d=this.getCallsFromHistory(e),f="called"===o?d+1:d;this.getHistory().push({type:u,status:o,name:e,called:f,payload:null!=c?c:{}}),this.logEventInfo(e,u,o,f)}},{key:"logEventInfo",value:function logEventInfo(e,t,o,c){this.enableLog&&("listening"===o&&tb.listenerCount(e),"called"===o&&tb.listenerCount(e))}}]),In}(c.Plugins.BasePlugin);var tE=o.Configs,tx=o.Utils.Object,tC=tE.FrameCapture,tT=tC.Enabled,tL=tC.WideframeConfigs,tN=/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,o,c,l,u;return _ts_generator(this,function(d){if(!tT)return[2,null];if(!(t=bn(e)))return[2,null];return Cn(t,tL.ResultChallenge),o=window.game.frameCapture,l=(c=tL.ResultChallenge).Width,u=c.Height,[2,o.captureAsync({name:"ResultChallenge",width:l,height:u,renderOptions:t})]})});return function xn(t){return e.apply(this,arguments)}}(),Cn=function(e,t){var o=t.Width,c=t.Height,l=t.Wideframe;e.wideframe={name:"result-challenge",type:"image",depth:0,image:l,size:[o,c],position:[0,0]}},bn=function(e){try{var t=e.playerId,o=e.playerPhoto,c=e.playerScore,l=void 0===c?0:c,u=e.opponentId,d=e.opponentPhoto,f=e.opponentScore,y=void 0===f?0:f,p=e.isPlayerFinished,g=e.isOpponentFinished,m=tL.ResultChallenge.RenderOptions,A=tx.clone(m);if(!A)return null;var I=tx.clear(A),D=tx.camelCaseKeys(I),k=D.playerPhoto,E=D.opponentPhoto,x=l===y,C=l>y,T=null!=p?p:g,N=p&&g;return"image"===k.type&&(k.name="".concat(void 0===t?"10":t),k.image=void 0===o?"":o),"image"===E.type&&(E.name="".concat(void 0===u?"20":u),E.image=void 0===d?"":d),T?_n(D,{playerScore:l,opponentScore:y,isPlayerFinished:p,isOpponentFinished:g}):(delete D.leftScore,delete D.rightScore),!N||x?(delete D.leftCrown,delete D.rightCrown,D):(C?delete D.rightCrown:delete D.leftCrown,D)}catch(e){return null}},_n=function(e,t){var o=e.leftScore,c=e.rightScore,l=t.playerScore,u=t.opponentScore,d=t.isPlayerFinished,f=t.isOpponentFinished;(null==o?void 0:o.type)==="text"&&(o.text=d?"".concat(void 0===l?0:l):"???"),(null==c?void 0:c.type)==="text"&&(c.text=f?"".concat(void 0===u?0:u):"???")},tO=o.Configs,tR=o.Utils.Object,tM=tO.FrameCapture,tF=tM.Enabled,tG=tM.WideframeConfigs,tj=/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,o,c,l,u;return _ts_generator(this,function(d){if(!tF)return[2,null];if(!(t=Rn(e)))return[2,null];return Mn(t,tG.ShareLeaderboard),o=window.game.frameCapture,l=(c=tG.ShareLeaderboard).Width,u=c.Height,[2,o.captureAsync({name:"ShareLeaderboard",width:l,height:u,renderOptions:t})]})});return function On(t){return e.apply(this,arguments)}}(),Mn=function(e,t){var o=t.Width,c=t.Height,l=t.Wideframe;e.wideframe={name:"share-leaderboard",type:"image",depth:0,image:l,size:[o,c],position:[0,0]}},Rn=function(e){try{var t=e.playerId,o=e.playerPhoto,c=e.leaders,l=tG.ShareLeaderboard.RenderOptions,u=tR.clone(l);if(!u)return null;var d=tR.clear(u),f=tR.camelCaseKeys(d),y=f.avatar;return"image"===y.type&&(y.name="".concat(t),y.image=o),Fn(f,c),f}catch(e){return null}},Fn=function(e,t){var o="600 48px";t.forEach(function(t,c){var l=t.id,u=t.name,d=t.photo,f=t.score;var y=1294+180*c;e["photo_".concat(l)]={depth:-1,name:l,type:"image",image:d,size:[96,96],position:[436,y]},y=1360+180*c,e["name_".concat(l)]={font:o,depth:1,name:l,type:"text",text:u,position:[600,y]},e["score_".concat(l)]={font:o,depth:1,name:l,type:"text",text:"".concat(f),position:[100,y]}})},tB=o.Configs,tV=o.Utils.Object,tU=tB.FrameCapture,tH=tU.Enabled,tK=tU.WideframeConfigs,tW=/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,o,c,l,u;return _ts_generator(this,function(d){if(!tH)return[2,null];if(!(t=Un(e)))return[2,null];return Bn(t,tK.ShareScore),o=window.game.frameCapture,l=(c=tK.ShareScore).Width,u=c.Height,[2,o.captureAsync({name:"ShareScore",width:l,height:u,renderOptions:t})]})});return function Vn(t){return e.apply(this,arguments)}}(),Bn=function(e,t){var o=t.Width,c=t.Height,l=t.Wideframe;e.wideframe={name:"share-score",type:"image",depth:0,image:l,size:[o,c],position:[0,0]}},Un=function(e){try{var t=e.playerId,o=e.playerPhoto,c=e.playerScore,l=tK.ShareScore.RenderOptions,u=tV.clone(l);if(!u)return null;var d=tV.clear(u),f=tV.camelCaseKeys(d),y=f.avatar,p=f.playerScore;return"image"===y.type&&(y.name="".concat(t),y.image=o),"text"===p.type&&(p.text="".concat(c)),f}catch(e){return null}},tz=o.Configs.FrameCapture.Options,tq=o.Utils,tY=tq.Browser,tJ=tq.Image,tX=tq.Object,tZ=tq.Valid;var tQ=/*#__PURE__*/function(e){function jn(){var e;return _class_call_check(this,jn),e=_call_super(this,jn,arguments),h(e,"width"),h(e,"height"),h(e,"canvas",null),h(e,"context",null),h(e,"testRenderOptions",null),h(e,"caches",{}),h(e,"wideframe",{}),e}return _inherits(jn,e),_create_class(jn,[{key:"init",value:function init(){this.addWideframeRender("renderShareScore",tW),this.addWideframeRender("renderResultChallenge",tN),this.addWideframeRender("renderShareLeaderboard",tj)}},{key:"preloadAsync",value:function preloadAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return o=e.renderOptions,[4,t.loadImages(o)];case 1:return c.sent(),[2]}})})()}},{key:"captureAsync",value:function captureAsync(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return o=e.width,c=e.height,l=e.renderOptions,[4,t.loadImages(l)];case 1:return[2,(u.sent(),t.width=o,t.height=c,t.createCanvas(),t.drawObjects(l),t.snapshotFrameAsync())]}})})()}},{key:"addWideframeRender",value:function addWideframeRender(e,t){this.wideframe[e]=t}},{key:"setTestRenderOptions",value:function setTestRenderOptions(e){if(!e){this.testRenderOptions=null;return}var t=tX.camelCaseKeys(e);this.testRenderOptions=tX.merge(this.testRenderOptions,t)}},{key:"createCanvas",value:function createCanvas(){if(!this.canvas){var e=tY.createCanvas({type:"canvas",contextAttributes:{alpha:!1,desynchronized:!0,willReadFrequently:!0},contextType:"2d"});this.canvas=null==e?void 0:e.canvas,this.context=null==e?void 0:e.context}if(!this.canvas)throw new Error("Failed to create canvas");this.context&&this.context.clearRect(0,0,this.width,this.height),this.canvas.width=this.width,this.canvas.height=this.height}},{key:"loadImages",value:function loadImages(e){var t=this;return _async_to_generator(function(){var o,c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(o=tX.vals(e).filter(function(e){return"image"===e.type}),c=t.prepareLoadImages(o),(l=tX.vals(c)).length<1)return[2];return[4,Promise.all(l)];case 1:return u=d.sent(),t.cacheImages(c,u),[2]}})})()}},{key:"prepareLoadImages",value:function prepareLoadImages(e){var t={};var o=true,c=false,l=void 0;try{for(var u,d,f=e[Symbol.iterator]();!(o=(d=f.next()).done);o=true)u=this,function(){var e=d.value;var o=e.name,c=e.image,l=e.fallbackImage,f=u.caches[o];!tZ.isString(c)||f||(""===c&&tZ.isString(l)&&(e.image=l),t[o]=new Promise(function(t){tJ.loadImage(c).then(function(e){t(e)}).catch(function(){tZ.isString(l)?(e.image=l,tJ.loadImage(e.image).then(function(e){t(e)}).catch(function(){t(null)})):t(null)})}))}()}catch(e){c=true,l=e}finally{try{if(!o&&null!=f.return)f.return()}finally{if(c)throw l}}return t}},{key:"cacheImages",value:function cacheImages(e,t){for(var o in e){var c=t.shift();c&&(this.caches[o]=c)}}},{key:"drawObjects",value:function drawObjects(e){var t=tX.vals(e).sort(function(e,t){return e.depth-t.depth});var o=true,c=false,l=void 0;try{for(var u,d=t[Symbol.iterator]();!(o=(u=d.next()).done);o=true){var f=u.value;switch(f.type){case"text":this.drawText(f);break;case"image":this.drawImage(f);break}}}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}}},{key:"drawText",value:function drawText(e){if(!this.canvas||!this.context)return;var t=e.position,o=e.font,c=e.text,l=e.color,u=e.lineWidth,d=e.textAlign;this.context.font="".concat(o," ").concat('nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif'),this.context.fillStyle=null!=l?l:"#ffffff",u&&(this.context.lineWidth=u),d&&(this.context.textAlign=d);var f=_sliced_to_array(t,2),y=f[0],p=f[1];this.context.fillText(c,y,p)}},{key:"drawImage",value:function drawImage(e){if(!this.canvas||!this.context)return;var t=e.name,o=e.size,c=e.position,l=e.fallbackImage;var u=this.caches[t];if(!u&&l&&(u=this.caches[l]),!u)throw new Error("Image ".concat(t," not found"));var d=_sliced_to_array(c,2),f=d[0],y=d[1],p=_sliced_to_array(o,2),g=p[0],m=p[1];this.context.drawImage(u,f,y,g,m)}},{key:"snapshotFrameAsync",value:function snapshotFrameAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(!e.canvas)return[2,null];if(t=null,!(tz.UseBlobIfPossible&&"toBlob"in e.canvas))return[3,2];return[4,e.createAsBlob()];case 1:return t=o.sent(),[3,3];case 2:t=e.createAsDataImage(),o.label=3;case 3:if(!t)throw new Error("Image data is null");return[2,(tZ.isDebugger()&&tJ.logImage(t),t)]}})})()}},{key:"createAsDataImage",value:function createAsDataImage(){if(!this.canvas||!this.context)return null;var e=tz.Quality,t=tz.RenderType;return this.context.canvas.toDataURL("image/".concat(t),e)}},{key:"createAsBlob",value:function createAsBlob(){var e=this;return new Promise(function(t){if(!e.canvas){t(null);return}var o=tz.Quality,c=tz.RenderType;e.canvas.toBlob(function(e){if(!e){t(null);return}tJ.blobToDataImage(e).then(function(e){t(e)})},"image/".concat(c),o)})}}]),jn}(c.Plugins.BasePlugin);var t$=/*#__PURE__*/function(e){function gs(e,t){_class_call_check(this,gs);var o,c=String(e);return h(o=_call_super(this,gs,['Text with key "'.concat(c,'" not found in locale "').concat(t,'"')]),"key"),h(o,"locale"),o.name="MissingKeyInLocaleError",o.key=c,o.locale=t,o}return _inherits(gs,e),gs}(_wrap_native_super(Error));var t0=/*#__PURE__*/function(e){function Wn(e){var t;return _class_call_check(this,Wn),h(t=_call_super(this,Wn,['Locale "'.concat(e,'" not found')]),"locale"),t.name="LocaleNotFoundError",t.locale=e,t}return _inherits(Wn,e),Wn}(_wrap_native_super(Error));var t2=o.Utils,t3=t2.Object,t1=t2.Function,t4=t2.Browser,t5=o.Configs.Languages.DetectPlayerLocale;var t6=/*#__PURE__*/function(e){function zn(){var e;return _class_call_check(this,zn),e=_call_super(this,zn,arguments),h(e,"locale"),h(e,"fallbackLocale"),h(e,"data",{}),e}return _inherits(zn,e),_create_class(zn,[{key:"setFallbackLocale",value:function setFallbackLocale(e){this.fallbackLocale=e}},{key:"hasTextKey",value:function hasTextKey(e,t){var o=null!=t?t:this.getCurrentLocale(),c=this.getLocaleData(o).text;return t3.hasOwn(c,e)}},{key:"hasTextureKey",value:function hasTextureKey(e,t){var o=null!=t?t:this.getCurrentLocale(),c=this.getLocaleData(o).texture;return t3.hasOwn(c,e)}},{key:"add",value:function add(e,t,o){var c=arguments.length>2&&void 0!==o&&o;this.data[e]=t,c&&this.setFallbackLocale(e)}},{key:"choose",value:function choose(e){this.locale=e,this.game.event.emit(o.Events.LANGUAGE_CHANGED,{locale:e})}},{key:"getText",value:function getText(e,t,o,c){var l=arguments.length>3&&void 0!==c&&c;try{return this.uncaughtGetText(e,t,o,!l)}catch(t){return String(e)}}},{key:"getTexture",value:function getTexture(e,t,o){var c=arguments.length>2&&void 0!==o&&o;return this.uncaughtGetTexture(e,t,!c)}},{key:"uncaughtGetText",value:function uncaughtGetText(e,t,o,c){var l=this;var u=arguments.length>1&&void 0!==t?t:[],d=arguments.length>2?o:void 0,f=!(arguments.length>3)||void 0===c||c;if(!f||void 0===this.fallbackLocale){var y=this.getRawText(e,null!=d?d:this.getCurrentLocale());return this.replaceVariables(y,u)}var p=this.fallbackLocale,g=t1.retry(function(){return l.getRawText(e,null!=d?d:l.getCurrentLocale())},function(){return l.getRawText(e,p)});return this.replaceVariables(g,u)}},{key:"getRawText",value:function getRawText(e,t){if(!this.hasTextKey(e,t))throw new t$(e,t);return this.getLocaleData(t).text[e]}},{key:"uncaughtGetTexture",value:function uncaughtGetTexture(e,t,o){var c=this;var l=!(arguments.length>2)||void 0===o||o;if(!l||void 0===this.fallbackLocale)return this.getRawTexture(e,null!=t?t:this.getCurrentLocale());var u=this.fallbackLocale;return t1.retry(function(){return c.getRawTexture(e,null!=t?t:c.getCurrentLocale())},function(){return c.getRawTexture(e,u)})}},{key:"getRawTexture",value:function getRawTexture(e,t){if(!this.hasTextureKey(e,t))throw new t$(e,t);return this.getLocaleData(t).texture[e]}},{key:"getCurrentLocale",value:function getCurrentLocale(){var e;return null!==(e=this.locale)&&void 0!==e?e:"en"}},{key:"getLocaleData",value:function getLocaleData(e){var t=null!=e?e:this.getCurrentLocale();if(!t3.hasOwn(this.data,t))throw new t0(t);return this.data[t]}},{key:"replaceVariables",value:function replaceVariables(e,t){var o=t.length;if(0===o)return e;var c=e;for(var l=0;l<o;l++){var u=t[l],d="%{".concat(l,"}");c=c.replace(d,u)}return c}},{key:"getPlayerLanguage",value:function getPlayerLanguage(){var e,t=globalThis.game.player,o=GameSDK.getLocale(),c=null==o?void 0:o.trim().split(/[-_]/)[0],l=this.getBrowserLanguage();return c!==l?null!=c?c:l:t.getPlayerDataByKey("isFirstLogin")?l:null!==(e=t.getPlayerSetting("language"))&&void 0!==e?e:l}},{key:"getBrowserLanguage",value:function getBrowserLanguage(){var e;if(!1===t5)return"en";var t=t4.getLocale();return null==(e=null==t?void 0:t.trim())?void 0:e.split(/[-_]/)[0]}}]),zn}(c.Plugins.BasePlugin);var t7=e("D",{_id:"",name:"",createdBy:"",description:"",expireTime:6048e5,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15}),t8=o.Configs,t9=o.Utils,ae=t9.Object,at=t9.String,aa=t9.Valid,an=t8.OtherHost,as=t8.Mockup,ao=t8.AppId;var ac=/*#__PURE__*/function(){function Zn(){_class_call_check(this,Zn),h(this,"mockAPI")}return _create_class(Zn,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:if(e.mockAPI)return[2];return[4,u(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/LeaderboardAPIMock.js")];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=c.sent().default))throw new Error("Cannot load LeaderboardAPIMock");return e.mockAPI=new o,[2]}})})()}},{key:"getLeadersAsync",value:function getLeadersAsync(e,t,o){var c=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(l=at.params(o),!as.Leaderboards.Enabled)return[3,6];return[4,c.initMockAPI()];case 1:if(d.sent(),!("playerIds"in o))return[3,3];return[4,c.mockAPI.getPlayers(e,o)];case 2:return u=d.sent(),[3,5];case 3:return[4,c.mockAPI.getLeaders(e,o)];case 4:u=d.sent(),d.label=5;case 5:return[3,8];case 6:return[4,ey("".concat(t,"?").concat(l),{},an)];case 7:u=d.sent(),d.label=8;case 8:return[2,ae.hasOwn(u,"data")&&Array.isArray(u.data)?u.data:[]]}})})()}},{key:"getLeaderboardAsync",value:function getLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var o,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(c="leaderboards/".concat(e),!as.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return l.sent(),[4,t.mockAPI.getLeaderboardAsync(e)];case 2:return o=l.sent(),[3,5];case 3:return[4,ey(c,{},an)];case 4:o=l.sent(),ae.hasOwn(o,"data")&&aa.isObject(o.data)&&(o=o.data),l.label=5;case 5:return[2,o]}})})()}},{key:"getLeaderboardsAsync",value:function getLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(l=o.Utils.String.params(e),!as.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return u.sent(),[4,t.mockAPI.getLeaderboardsAsync(e)];case 2:return c=u.sent(),[3,5];case 3:return[4,ey("leaderboards?".concat(l),{},an)];case 4:c=u.sent(),ae.hasOwn(c,"data")&&Array.isArray(c.data)?c=c.data:c=[],u.label=5;case 5:return[2,c]}})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(o=e.leaderboardId,c=e.playerId,l=e.score,!as.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return u.sent(),[4,t.mockAPI.setScoreAsync(o,c,l)];case 2:return u.sent(),[3,5];case 3:return[4,e_("leaderboards/".concat(o,"/players/").concat(c),{score:l},{},an)];case 4:u.sent(),u.label=5;case 5:return[2]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:if(c=null!==(o=e._id)&&void 0!==o?o:at.generateObjectId(),l=e.numberOfLeaders,u=_object_spread_props(_object_spread({},t7,e),{_id:c,appId:ao,numberOfLeaders:l}),d="leaderboards",!as.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return y.sent(),[4,t.mockAPI.createLeaderboard(u)];case 2:return f=y.sent(),[3,5];case 3:return[4,e_(d,u,{},an)];case 4:f=y.sent(),ae.hasOwn(f,"data")&&aa.isObject(f.data)&&(f=f.data),y.label=5;case 5:if(!ae.hasOwn(f,"_id")||f._id!==c)throw new Error("Create leaderboard failed");return[2,c]}})})()}}]),Zn}();var al={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},au={leaderboards:{}},ad=o.Utils,ah=ad.Array,af=ad.Valid,ay=ad.Json,a_=ad.Object;var av=/*#__PURE__*/function(e){function ai(){var e;return _class_call_check(this,ai),e=_call_super(this,ai,arguments),h(e,"lbAPI",new ac),h(e,"configs"),e}return _inherits(ai,e),_create_class(ai,[{key:"init",value:function init(){this.game.storage.addStorage("leaderboard",au),this.configs={}}},{key:"addLeaderboard",value:function addLeaderboard(e){var t=e.name,o=e.type,c=e.leaderboardId,l=e.autoSortRank;if(this.getLeaderboard(t))return;var u="leaderboards/".concat(c,"/");("global"===o||"tournament"===o)&&(u+="leaders"),"friends"===o&&(u+="players"),this.configs[t]={id:c,name:t,type:o,host:u,autoSortRank:l};var d=ay.clone(al);this.setLeaderboard(t,_object_spread({},d))}},{key:"requestLeaderboardsAsync",value:function requestLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,t.lbAPI.getLeaderboardsAsync(e)];case 1:return[2,o.sent()];case 2:return o.sent(),[2,[]];case 3:return[2]}})})()}},{key:"requestLeaderboardAsync",value:function requestLeaderboardAsync(e,t){var o=this;return _async_to_generator(function(){var c,l,u,d,f,y,p,g,m,A;return _ts_generator(this,function(I){switch(I.label){case 0:if(I.trys.push([0,,6,8]),o.validateLeaderboard(e),o.clearLeaderboard(e),o.setLeaderboard(e,{isRequesting:!0}),l=(c=o.configs[e]).id,u=c.type,d=c.host,f=[],"friends"!==u)return[3,2];return p=[(y=o.game.player).getPlayerId()].concat(_to_consumable_array(y.getConnectedPlayerIds(t,0))),o.configs[e].playerIds=_to_consumable_array(p),[4,o.lbAPI.getLeadersAsync(l,d,{playerIds:p})];case 1:return f=I.sent(),[3,4];case 2:return[4,o.lbAPI.getLeadersAsync(l,d,{limit:t,offset:0})];case 3:f=I.sent(),I.label=4;case 4:if(0===f.length)return[2];return[4,o.receiveLeaderboardAsync(e,f)];case 5:return I.sent(),o.setLeaderboard(e,{limit:t,offset:0}),[3,8];case 6:return[4,o.lbAPI.getLeaderboardAsync(o.configs[e].id)];case 7:return m=(g=I.sent())?g.resettable:"",A=g?g.amountPlayer:0,o.setLeaderboard(e,{isRequesting:!1,resettable:m,amountPlayer:A}),[7];case 8:return[2]}})})()}},{key:"loadMoreLeaderboardAsync",value:function loadMoreLeaderboardAsync(e,t){var o=this;return _async_to_generator(function(){var c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:if(!((c=o.getLeaderboard(e))&&"friends"!==o.configs[e].type))return[3,4];p.label=1;case 1:return p.trys.push([1,,3,4]),o.setLeaderboard(e,{isRequesting:!0}),u=(l=o.configs[e]).id,d=l.host,f=c.offset+c.limit,[4,o.lbAPI.getLeadersAsync(u,d,{limit:t,offset:f})];case 2:if(0===(y=p.sent()).length)return[2];return o.receiveLeaderboardAsync(e,y),o.setLeaderboard(e,{limit:t,offset:f}),[3,4];case 3:return o.setLeaderboard(e,{isRequesting:!1}),[7];case 4:return[2]}})})()}},{key:"getLeaderboard",value:function getLeaderboard(e){var t=this.game.storage.getStorageData("leaderboard","leaderboards");return t&&t[e]?t[e]:null}},{key:"getLeadersByPlayerIdsAsync",value:function getLeadersByPlayerIdsAsync(e,t){var o=this;return _async_to_generator(function(){var c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),o.validateLeaderboard(e),c=o.configs[e].id,l="leaderboards/".concat(c,"/players"),[4,o.lbAPI.getLeadersAsync(c,l,{playerIds:t})];case 1:return[2,0===(u=d.sent()).length?[]:o.toLeaders(u)];case 2:return d.sent(),[2,[]];case 3:return[2]}})})()}},{key:"getLeaderboardResponseAsync",value:function getLeaderboardResponseAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.lbAPI.getLeaderboardAsync(e)];case 1:return[2,o.sent()]}})})()}},{key:"clearLeaderboard",value:function clearLeaderboard(e){try{this.validateLeaderboard(e);var t=ay.clone(al);this.setLeaderboard(e,null),this.setLeaderboard(e,_object_spread({},t))}catch(e){}}},{key:"isLeaderboardEmpty",value:function isLeaderboardEmpty(e){var t=this.getLeaderboard(e);if(!t)return!0;return 0===Object.keys(t.leaders).length}},{key:"isExistLeaderboardId",value:function isExistLeaderboardId(e){var t=this.configs;return a_.vals(t).some(function(t){return t.id===e})}},{key:"getLeaderboardName",value:function getLeaderboardName(e){var t=this.configs,o=ah.search(a_.vals(t),function(t){return t.id===e});return o?o.name:null}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e,t,o){var c=this;return _async_to_generator(function(){var l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(d.trys.push([0,3,,4]),GameSDK.extra.isGuest)return[2];return c.validateLeaderboard(e),l=c.configs[e].id,[4,c.getLastScoreOnLeaderboard(e,t)];case 1:if((u=d.sent())&&o<=u)return[2];return[4,c.lbAPI.setLeaderboardScoreAsync({leaderboardId:l,playerId:t,score:o})];case 2:return d.sent(),[3,4];case 3:return d.sent(),[3,4];case 4:return[2]}})})()}},{key:"getLastScoreOnLeaderboard",value:function getLastScoreOnLeaderboard(e,t){var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,o.getLeadersByPlayerIdsAsync(e,[t])];case 1:return[2,0===(c=l.sent()).length?null:c[0].score]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){return[2,t.lbAPI.createLeaderboardAsync(e)]})})()}},{key:"validateLeaderboard",value:function validateLeaderboard(e){var t=this.getLeaderboard(e);if(!af.isObject(t))throw new Error("Leaderboard with name ".concat(e," not found"))}},{key:"setLeaderboard",value:function setLeaderboard(e,t){if(!t)return;this.game.storage.setStorageData("leaderboard","leaderboards",_define_property({},e,t))}},{key:"receiveLeaderboardAsync",value:function receiveLeaderboardAsync(e,t){var o=this;return _async_to_generator(function(){var c,l,u,d,f,y,p,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:return o.validateLeaderboard(e),[4,o.toLeaders(t)];case 1:return u=A.sent().filter(function(e){return e.name&&e.photo}),f=void 0===(d=(null!==(l=o.getLeaderboard(e))&&void 0!==l?l:{}).leaders)?{}:d,y=u.filter(function(e){return!f[e.playerId]||(f[e.playerId]=e,!1)}),p=a_.vals(f),y.length>0&&(c=p).unshift.apply(c,_to_consumable_array(y)),g=p.sort(function(e,t){return t.score-e.score}),o.configs[e].autoSortRank&&(g=g.map(function(e,t){return _object_spread_props(_object_spread({},e),{rank:t+1})})),m=a_.keyBy(g,"playerId"),o.setLeaderboard(e,{leaders:m}),[2]}})})()}},{key:"toLeaders",value:function toLeaders(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return o=t.game.profile,c=e.map(function(e){return e.playerId}),[4,o.requestProfiles(c)];case 1:return u.sent(),l=o.getProfiles(),[2,e.map(function(e){var t=l[e.playerId];return t?_object_spread_props(_object_spread({},e),{name:t.name,photo:t.photo}):_object_spread_props(_object_spread({},e),{name:"Nameless",photo:"default"})}).map(function(e){return _object_spread_props(_object_spread({},e),{score:parseInt(e.score,10)})})]}})})()}}]),ai}(c.Plugins.BasePlugin);var ap=/*#__PURE__*/function(){function ni(){_class_call_check(this,ni),h(this,"APIHost")}return _create_class(ni,[{key:"setAPIHost",value:function setAPIHost(e){this.APIHost=e}},{key:"getAPIHost",value:function getAPIHost(){return this.APIHost}}]),ni}();var ag=o.Utils;var am=/*#__PURE__*/function(e){function ii(){return _class_call_check(this,ii),_call_super(this,ii,arguments)}return _inherits(ii,e),_create_class(ii,[{key:"createSingleMatchAsync",value:function createSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,e_("single-matches",e,{},t.getAPIHost())];case 1:return o=c.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"getSingleMatchDetailAsync",value:function getSingleMatchDetailAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,ey("single-matches/active",{},e.getAPIHost())];case 1:return t=o.sent(),[2,e.returnValidMatchData(t)]}})})()}},{key:"updateSingleMatchMoveAsync",value:function updateSingleMatchMoveAsync(e,t){var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,e_("single-matches/".concat(e,"/move"),t,{},o.getAPIHost())];case 1:return c=l.sent(),[2,o.returnValidMatchData(c)]}})})()}},{key:"finishSingleMatchAsync",value:function finishSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,e_("single-matches/".concat(e,"/finish"),{},{},t.getAPIHost())];case 1:return o=c.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,e_("matches",e,{},t.getAPIHost())];case 1:return o=c.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,e_("matches/".concat(e,"/join"),{},{},t.getAPIHost())];case 1:return o=c.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"getMatchDetailByIdAsync",value:function getMatchDetailByIdAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,ey("matches/".concat(e),{},t.getAPIHost())];case 1:return o=c.sent(),[2,t.returnValidMatchData(o)]}})})()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:return c=void 0===(o=e.matchId)?"":o,u=void 0===(l=e.score)?0:l,f=void 0===(d=e.level)?0:d,p=void 0===(y=e.extraData)?{}:y,[4,e_("matches/".concat(c,"/finish"),{matchId:c,score:u,level:f,extraData:p},{},t.getAPIHost())];case 1:return g=m.sent(),[2,t.returnValidMatchData(g)]}})})()}},{key:"returnValidMatchData",value:function returnValidMatchData(e){var t;return ag.Valid.isObject(e)?ag.Object.hasOwn(e,"data")?null!==(t=e.data)&&void 0!==t?t:{}:{}:{}}}]),ii}(ap);var aA=/*#__PURE__*/function(){function ri(e){_class_call_check(this,ri),h(this,"matchAPI"),this.createAPI(),this.setAPIConfig(e)}return _create_class(ri,[{key:"createAPI",value:function createAPI(){this.matchAPI=new am}},{key:"setAPIConfig",value:function setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}},{key:"setMatchAPIInstance",value:function setMatchAPIInstance(e){this.matchAPI=e}},{key:"getMatchAPI",value:function getMatchAPI(){return this.matchAPI}}]),ri}();var aw=/*#__PURE__*/function(){function v(e,t){_class_call_check(this,v),h(this,"game"),h(this,"match"),this.game=e,this.match=t}return _create_class(v,[{key:"startLog",value:function startLog(e){}},{key:"endLog",value:function endLog(){}},{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(e){throw new Error("Not implemented")})})()}}]),v}();var aI=/*#__PURE__*/function(e){function vs(e){var t;return _class_call_check(this,vs),(t=_call_super(this,vs,[e])).name="LevelNotDefined",t.message=null!=e?e:"Level is not defined",t}return _inherits(vs,e),vs}(K);var aD=/*#__PURE__*/function(e){function Tt(e){var t;return _class_call_check(this,Tt),(t=_call_super(this,Tt,[e])).name="MatchModeNotDefined",t.message=null!=e?e:"Match id is not defined",t}return _inherits(Tt,e),Tt}(K);var ak=o.Utils,ab=(ak.Object,ak.Valid);var aS=/*#__PURE__*/function(){function w(e){_class_call_check(this,w),h(this,"game"),h(this,"match"),h(this,"nextHandler"),this.game=e.game,this.match=e.match,this.nextHandler=null}return _create_class(w,[{key:"setNext",value:function setNext(e){return this.nextHandler=e,e}},{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){return t.logData("Before",e),[2]})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:if(t.logData("After",e),!t.nextHandler)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:o.sent(),o.label=2;case 2:return[2]}})})()}},{key:"logData",value:function logData(e,t){ab.isDebugger()}}]),w}();var aP=o.Plugins,aE=o.Utils,ax=aP.Analytics,aC=aE.String,aT=aE.Valid;var aL=/*#__PURE__*/function(e){function q(){return _class_call_check(this,q),_call_super(this,q,arguments)}return _inherits(q,e),_create_class(q,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(q.prototype),"processAsync",t)})().call(o,e),c=e.mode,l=e.customData.level,o.validateMode(c),o.validateLevel(l),o.game.analytics.event(ax.Events.MATCH_START,{level:l,game_mode:aC.toUpperCamelCase(c),level_name:o.getLevelName(l)}),[4,o.nextAsync(e)];case 1:return u.sent(),[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!aT.isString(e))throw new aD}},{key:"validateLevel",value:function validateLevel(e){if(!aT.isNumber(e))throw new aI}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(aC.padStart(e.toString(),5,"0"))}}]),q}(aS);var aN={OPEN:"open",ACTIVE:"active",FINISHED:"finished"};var aO=/*#__PURE__*/function(e){function L(){return _class_call_check(this,L),_call_super(this,L,arguments)}return _inherits(L,e),_create_class(L,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return(function(){return _get(_get_prototype_of(L.prototype),"processAsync",t)})().call(o,e),c=e.mode,l=e.status,u=null!=c?c:eX.SINGLE,l===aN.FINISHED&&(u=eX.SINGLE),o.contextGameModeDetected(u),[4,o.nextAsync(e)];case 1:return d.sent(),[2]}})})()}},{key:"contextGameModeDetected",value:function contextGameModeDetected(e){this.game.storage.setStorageData("context","contextGameMode",e)}}]),L}(aS);var aR=/*#__PURE__*/function(e){function Ot(e){var t;return _class_call_check(this,Ot),(t=_call_super(this,Ot,[e])).name="GetMatchDetailFailed",t.message=null!=e?e:"Get match detail failed",t}return _inherits(Ot,e),Ot}(_wrap_native_super(Error));var aM=/*#__PURE__*/function(e){function xs(e){var t;return _class_call_check(this,xs),(t=_call_super(this,xs,[e])).name="MatchAreNotActive",t.message=null!=e?e:"Match are not active",t}return _inherits(xs,e),xs}(_wrap_native_super(Error));var aF=/*#__PURE__*/function(e){function Z(e){var t;return _class_call_check(this,Z),(t=_call_super(this,Z,[e])).name="MatchIdNotValid",t.message=null!=e?e:"Match id is not valid",t}return _inherits(Z,e),Z}(K);var aG=/*#__PURE__*/function(e){function hi(e){var t;return _class_call_check(this,hi),(t=_call_super(this,hi,[e])).name="OpponentHasFinishedMatch",t.message=e||"Opponent has finished match",t}return _inherits(hi,e),hi}(_wrap_native_super(Error));var aj=/*#__PURE__*/function(e){function U(e){var t;return _class_call_check(this,U),(t=_call_super(this,U,[e])).name="OpponentIdNotValid",t.message=null!=e?e:"Opponent id is not valid",t}return _inherits(U,e),U}(K);var aB=/*#__PURE__*/function(e){function Mt(e){var t;return _class_call_check(this,Mt),(t=_call_super(this,Mt,[e])).name="PlayerNotCurrentInMatch",t.message=null!=e?e:"The player is not currently in this match",t}return _inherits(Mt,e),Mt}(_wrap_native_super(Error));var aV=/*#__PURE__*/function(e){function Cs(e){var t;return _class_call_check(this,Cs),(t=_call_super(this,Cs,[e])).name="PlayerNotFinishedMatch",t.message=e||"Player not finished match",t}return _inherits(Cs,e),Cs}(_wrap_native_super(Error));var aU=o.Dtos,aH=o.Utils.Object;var aK=/*#__PURE__*/function(e){function yi(){return _class_call_check(this,yi),_call_super(this,yi,arguments)}return _inherits(yi,e),_create_class(yi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(yi.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),[4,o.getMatchAsync(e)];case 1:return c=u.sent(),l=new aU.Match.Data(c).toObject(),o.validateAwaitMatchData(e,l),o.updateMatchData(e,l),o.validateMatchStatus(e),o.validatePlayerTurn(e),o.validateOpponentTurn(e),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){if("string"!=typeof e.id)throw new aF}},{key:"validateMatchStatus",value:function validateMatchStatus(e){if(e.status!==aN.ACTIVE)throw new aM}},{key:"validateAwaitMatchData",value:function validateAwaitMatchData(e,t){var o=e.id,c=e.customData,l=t._id,u=t.whitePlayerId,d=t.blackPlayerId;if("string"!=typeof l||l!==o)throw new aR;var f=c.playerId,y=u===f;if(!y&&d===V.playerId)throw new e4;if(!y&&d!==f)throw new aB}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,o=e.customData.playerId;if("string"!=typeof o)throw new W;if(!t[o].finished)throw new aV}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,o=e.customData.opponentId;if("string"!=typeof o)throw new aj;if(t[o].finished)throw new aG}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){return[2,(o=e.id)?t.match.api.getMatchAPI().getMatchDetailByIdAsync(o):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t.status,c=t.extraData;e.status=o,e.customData=aH.merge(e.customData,c)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,c=t.blackPlayerId,l=o===e.customData.playerId;e.customData.playerId=l?o:c,e.customData.opponentId=l?c:o}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,c=t.opponentId;if(!o||!c)return;var l={name:"",photo:"",finished:!1};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},l)),e.profiles[c]||(e.profiles[c]=_object_spread({id:c},l))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,t){var o=e.customData,c=o.playerId,l=o.opponentId;if(!c||!l)return;var u=t.whitePlayerId,d=t.whitePlayerScore,f=t.whitePlayerFinish,y=t.blackPlayerScore,p=t.blackPlayerFinish,g=u===c;e.profiles[c].score=g?d:y,e.profiles[l].score=g?y:d,e.profiles[c].finished=g?f:p,e.profiles[l].finished=g?p:f}}]),yi}(aS);var aW={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null};var az=/*#__PURE__*/function(e){function H(e,t){var o;return _class_call_check(this,H),h(o=_call_super(this,H,[e]),"payload"),o.payload=t,o}return _inherits(H,e),_create_class(H,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return(function(){return _get(_get_prototype_of(H.prototype),"processAsync",t)})().call(o,e),o.initializeMatch(e),[4,o.nextAsync(e)];case 1:return c.sent(),[2]}})})()}},{key:"initializeMatch",value:function initializeMatch(e){var t=this.payload,o=t.id,c=t.mode,l=t.customData;e.id=null!=o?o:null,e.mode=c||null,e.status=aN.OPEN,e.startAt=0,e.finishAt=0,e.profiles={},e.customData=_object_spread({},aW,e.customData,l)}}]),H}(aS);var aq=/*#__PURE__*/function(e){function S(e){var t;return _class_call_check(this,S),(t=_call_super(this,S,[e])).name="UnavailableFeature",t.message="Unavailable feature: ".concat(e),t}return _inherits(S,e),S}(_wrap_native_super(Error));var aY=/*#__PURE__*/function(e){function Y(e){var t;return _class_call_check(this,Y),(t=_call_super(this,Y,[e])).name="ContextIdNotValid",t.message=null!=e?e:"Context id is not valid",t}return _inherits(Y,e),Y}(K);var aJ=/*#__PURE__*/function(e){function b(e){var t;return _class_call_check(this,b),(t=_call_super(this,b,[e])).name="ProfileNotFound",t.message=null!=e?e:"Profile not found",t}return _inherits(b,e),b}(K);var aX=/*#__PURE__*/function(e){function fi(){return _class_call_check(this,fi),_call_super(this,fi,arguments)}return _inherits(fi,e),_create_class(fi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(fi.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createWideframesAwaitingAsync(e)];case 1:return(c=l.sent())&&o.sendMessageAsync(e,c),[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,c=o.contextId,l=o.opponentId;if(!t||"string"!=typeof t)throw new aF;if(!c||"string"!=typeof c)throw new aY;if(!l||"string"!=typeof l)throw new aj}},{key:"createWideframesAwaitingAsync",value:function createWideframesAwaitingAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I,D,k;return _ts_generator(this,function(E){switch(E.label){case 0:if(E.trys.push([0,4,,5]),o=t.game.frameCapture,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||!d)return[2,null];if(f=c[u],y=c[d],!f||!y)return[2,null];if(p=f.photo,m=void 0===(g=f.score)?0:g,!f.finished)return[2,null];if(A=y.photo,D=void 0===(I=y.score)?0:I,!y.finished)return[3,1];return k=null,[3,3];case 1:return[4,o.wideframe.renderResultChallenge({playerId:u,playerPhoto:p,playerScore:m,opponentId:d,opponentPhoto:A,opponentScore:D,isPlayerFinished:!0,isOpponentFinished:!1})];case 2:k=E.sent(),E.label=3;case 3:return[2,k];case 4:return E.sent(),[2,null];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var o,c,l,u,d,f,y,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(o=e.id,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||"string"!=typeof u)throw new W;if(!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");if(!(f=c[u]))throw new aJ;return y=f.name,p={data:{type:eJ.CHALLENGE_FRIEND,matchId:o,playerId:u,opponentId:d},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," is waiting for you to finish this game. Play now!"),localizations:{vi_VN:"".concat(y," đang chờ bạn kết th\xfac trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"},[4,GameSDK.extra.updateAsync(p)];case 1:return g.sent(),[2]}})})()}}]),fi}(aS);var aZ=/*#__PURE__*/function(e){function _(){return _class_call_check(this,_),_call_super(this,_,arguments)}return _inherits(_,e),_create_class(_,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.nextAsync(e)];case 1:return o.sent(),[2]}})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:if(!t.nextHandler)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:o.sent(),o.label=2;case 2:return[2]}})})()}}]),_}(aS);var aQ=o.Dtos;var a$=/*#__PURE__*/function(e){function de(){return _class_call_check(this,de),_call_super(this,de,arguments)}return _inherits(de,e),_create_class(de,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:return(function(){return _get(_get_prototype_of(de.prototype),"processAsync",t)})().call(o,e),o.validateData(e),l=(c=e.customData).playerId,u=c.opponentId,d=l,[4,o.getProfile(d)];case 1:if(!(f=p.sent()))throw new aJ;if(o.updateMatchProfile(e,d,f),(d=u)===V.playerId)return[3,3];return[4,o.getProfile(d)];case 2:if(!(y=p.sent()))throw new aJ;return o.updateMatchProfile(e,d,y),[3,4];case 3:o.updateMatchProfile(e,d),p.label=4;case 4:return[4,o.nextAsync(e)];case 5:return p.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.customData,o=t.playerId,c=t.opponentId;if(!o||"string"!=typeof o)throw new W;if(!c||"string"!=typeof c)throw new aj}},{key:"getProfile",value:function getProfile(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,(o=t.game.profile).requestProfiles([e])];case 1:return[2,(c.sent(),o.getProfiles()[e])]}})})()}},{key:"updateMatchProfile",value:function updateMatchProfile(e,t,o){var c=null!=o?o:V,l=c.name,u=c.photo,d=new aQ.Match.Profile({id:t,name:l,photo:u}).toObject();e.profiles[t]?(e.profiles[t].name=d.name,e.profiles[t].photo=d.photo):e.profiles[t]=d}}]),de}(aS);var a0=/*#__PURE__*/function(e){function mi(){return _class_call_check(this,mi),_call_super(this,mi,arguments)}return _inherits(mi,e),_create_class(mi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),t.startLog(e),o=e.matchId,c=e.playerId,l=e.opponentId,u=new aZ(t),f=new az(t,{id:o,mode:d.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:l}}),u.setNext(f),y=new aK(t),f.setNext(y),p=new a$(t),y.setNext(p),g=new aX(t),p.setNext(g),m=new aL(t),g.setNext(m),A=new aO(t),m.setNext(A),I=t.match.getMatchState(),[4,u.processAsync(I)];case 1:return D.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),mi}(aw);var a2=/*#__PURE__*/function(e){function Ft(e){var t;return _class_call_check(this,Ft),(t=_call_super(this,Ft,[e])).name="CreateContextFailed",t.message=null!=e?e:"Create context failed",t}return _inherits(Ft,e),Ft}(K);var a3=o.Utils,a1=a3.Valid,a4=a3.Object;var a5=/*#__PURE__*/function(e){function Ai(e,t){var o;return _class_call_check(this,Ai),h(o=_call_super(this,Ai,[e]),"payload"),o.payload=t,o}return _inherits(Ai,e),_create_class(Ai,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Ai.prototype),"processAsync",t)})().call(o,e),c=o.payload.opponentId,[4,o.createAsync(c)];case 1:return l=u.sent(),e.customData.contextId=l,[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"createAsync",value:function createAsync(e){var t=this;return _async_to_generator(function(){var o,c;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,GameSDK.context.createAsync(e)];case 1:return l.sent(),[3,3];case 2:return o=l.sent(),t.validateError(o),[3,3];case 3:if(c=GameSDK.context.getID(),!a1.isString(c))throw new a2;return[2,c]}})})()}},{key:"validateError",value:function validateError(e){if(!a4.hasOwn(e,"code"))throw e;if("SAME_CONTEXT"!==e.code){if("INVALID_PARAM"===e.code){if(!this.isNotConnectedPlayerError(e))throw e;return}throw e}}},{key:"validateErrorMessage",value:function validateErrorMessage(e){if(!a4.hasOwn(e,"message")||!a1.isString(e.message))throw e}},{key:"isNotConnectedPlayerError",value:function isNotConnectedPlayerError(e){return this.validateErrorMessage(e),e.message.indexOf("is not a connected player of the current player")>-1}}]),Ai}(aS);var a6=/*#__PURE__*/function(e){function Ye(e){var t;return _class_call_check(this,Ye),(t=_call_super(this,Ye,[e])).name="MatchAreNotOpen",t.message=null!=e?e:"Match are not open",t}return _inherits(Ye,e),Ye}(K);var a7=o.Dtos,a8=o.Utils.Object;var a9=/*#__PURE__*/function(e){function Ns(e,t){var o;return _class_call_check(this,Ns),h(o=_call_super(this,Ns,[e]),"payload"),o.payload=t,o}return _inherits(Ns,e),_create_class(Ns,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Ns.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createMatchAsync(e)];case 1:return c=u.sent(),l=new a7.Match.Data(c).toObject(),o.updateMatchState(e,l),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.status;if("string"!=typeof e.customData.opponentId)throw new aj;if(t!==aN.OPEN)throw new a6}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){if(o=e.customData.opponentId,c=t.payload.extraData,!o)return[2,{}];return l={opponentPlayerId:o,extraData:c},[2,t.match.api.getMatchAPI().createMatchAsync(l)]})})()}},{key:"updateMatchState",value:function updateMatchState(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateFinishStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t._id,c=t.extraData;e.id=o||null,e.customData=a8.merge(e.customData,c)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,c=t.blackPlayerId,l=o===e.customData.opponentId;e.customData.playerId=l?c:o,e.customData.opponentId=l?o:c}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,c=t.opponentId;if(!o||!c)return;var l={name:"",photo:"",finished:!1};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},l)),e.profiles[c]||(e.profiles[c]=_object_spread({id:c},l))}},{key:"updateFinishStatus",value:function updateFinishStatus(e,t){var o=e.customData,c=o.playerId,l=o.opponentId;if(!c||!l)return;var u=t.whitePlayerId,d=t.whitePlayerFinish,f=t.blackPlayerFinish,y=u===e.customData.opponentId;e.profiles[c].finished=y?f:d,e.profiles[l].finished=y?d:f}}]),Ns}(aS);var nt=/*#__PURE__*/function(e){function J(){return _class_call_check(this,J),_call_super(this,J,arguments)}return _inherits(J,e),_create_class(J,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:if((function(){return _get(_get_prototype_of(J.prototype),"processAsync",t)})().call(o,e),e.status!==aN.OPEN)throw new a6;return o.startMatch(e),[4,o.nextAsync(e)];case 1:return c.sent(),[2]}})})()}},{key:"startMatch",value:function startMatch(e){e.status=aN.ACTIVE,e.startAt=Date.now()}}]),J}(aS);var na=/*#__PURE__*/function(e){function Ls(){return _class_call_check(this,Ls),_call_super(this,Ls,arguments)}return _inherits(Ls,e),_create_class(Ls,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Ls.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createWideframesChallengeAsync(e)];case 1:return(c=l.sent())&&o.sendMessageAsync(e,c),[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,c=o.contextId,l=o.opponentId;if(!t||"string"!=typeof t)throw new aF;if(!c||"string"!=typeof c)throw new aY;if(!l||"string"!=typeof l)throw new aj}},{key:"createWideframesChallengeAsync",value:function createWideframesChallengeAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I,D;return _ts_generator(this,function(k){switch(k.label){case 0:if(k.trys.push([0,2,,3]),o=t.game.frameCapture,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||!d)return[2,null];if(f=c[u],y=c[d],!f||!y)return[2,null];return p=f.photo,m=void 0===(g=f.score)?0:g,A=y.photo,D=void 0===(I=y.score)?0:I,[4,o.wideframe.renderResultChallenge({playerId:u,playerPhoto:p,playerScore:m,opponentId:d,opponentPhoto:A,opponentScore:D,isPlayerFinished:!1,isOpponentFinished:!1})];case 1:return[2,k.sent()];case 2:return k.sent(),[2,null];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var o,c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:if(o=e.id,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||"string"!=typeof u)throw new W;if(!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");return f=c[u].name,y={data:{type:eJ.CHALLENGE_FRIEND,matchId:o,playerId:u,opponentId:d},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(f," challenges you"),localizations:{vi_VN:"".concat(f," thử th\xe1ch bạn trong trận đấu n\xe0y. Chơi ngay!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},[4,GameSDK.extra.updateAsync(y)];case 1:return p.sent(),[2]}})})()}}]),Ls}(aS);var nn=/*#__PURE__*/function(e){function Ii(){return _class_call_check(this,Ii),_call_super(this,Ii,arguments)}return _inherits(Ii,e),_create_class(Ii,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I,D,k;return _ts_generator(this,function(E){switch(E.label){case 0:return E.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,c=e.opponentId,l=e.extraData,u=new aZ(t),f=new a5(t,{opponentId:c}),u.setNext(f),y=new az(t,{mode:d.CHALLENGE_FRIEND,customData:{playerId:o,opponentId:c}}),f.setNext(y),p=new a9(t,{extraData:l}),y.setNext(p),g=new a$(t),p.setNext(g),m=new nt(t),g.setNext(m),A=new aL(t),m.setNext(A),I=new na(t),A.setNext(I),D=new aO(t),I.setNext(D),k=t.match.getMatchState(),[4,u.processAsync(k)];case 1:return E.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Ii}(aw);var nr=/*#__PURE__*/function(e){function Gt(e){var t;return _class_call_check(this,Gt),(t=_call_super(this,Gt,[e])).name="SameContext",t.message=null!=e?e:"Same context",t}return _inherits(Gt,e),Gt}(_wrap_native_super(Error));var ns=o.Utils;var no=/*#__PURE__*/function(e){function Je(e,t){var o;return _class_call_check(this,Je),h(o=_call_super(this,Je,[e]),"payload"),o.payload=t,o}return _inherits(Je,e),_create_class(Je,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Je.prototype),"processAsync",t)})().call(o,e),c=o.payload.contextId,[4,o.switchAsync(c)];case 1:return l.sent(),e.customData.contextId=c,[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"checkSameContext",value:function checkSameContext(e){var t=GameSDK.context.getID();if(t===e)throw new nr;if("SOLO"===e&&null===t)throw new nr}},{key:"switchAsync",value:function switchAsync(e){var t=this;return _async_to_generator(function(){var o,c;return _ts_generator(this,function(l){switch(l.label){case 0:o="SOLO"===e,l.label=1;case 1:return l.trys.push([1,3,,4]),t.checkSameContext(e),[4,GameSDK.context.switchAsync(e,o)];case 2:return l.sent(),[3,4];case 3:if(_instanceof(c=l.sent(),nr))return[2];if(!ns.Object.hasOwn(c,"code"))throw c;if(ns.Device.isAndroid()&&o&&"INVALID_PARAM"===c.code)return[2];if("SAME_CONTEXT"!==c.code)throw c;return[3,4];case 4:return[2]}})})()}}]),Je}(aS);var nc=o.Dtos,nl=o.Utils.Object;var nu=/*#__PURE__*/function(e){function Si(){return _class_call_check(this,Si),_call_super(this,Si,arguments)}return _inherits(Si,e),_create_class(Si,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Si.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),[4,o.getMatchAsync(e)];case 1:return c=u.sent(),l=new nc.Match.Data(c).toObject(),o.validateContinueMatchData(e,l),o.updateMatchData(e,l),o.validatePlayerTurn(e),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id,o=e.status;if("string"!=typeof t)throw new aF;if(o!==aN.OPEN)throw new a6}},{key:"validateContinueMatchData",value:function validateContinueMatchData(e,t){var o=e.id,c=e.customData,l=t._id,u=t.whitePlayerId,d=t.blackPlayerId;if("string"!=typeof l||l!==o)throw new aR;var f=c.playerId,y=u===f;if(!y&&d===V.playerId)throw new e4;if(!y&&d!==f)throw new aB}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,o=e.customData.playerId;if("string"!=typeof o)throw new W;if(t[o].finished)throw new e1}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){return[2,(o=e.id)?t.match.api.getMatchAPI().getMatchDetailByIdAsync(o):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t.extraData;e.customData=nl.merge(e.customData,o)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,c=t.blackPlayerId,l=o===e.customData.playerId;e.customData.playerId=l?o:c,e.customData.opponentId=l?c:o}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,c=t.opponentId;if(!o||!c)return;var l={name:"",photo:"",finished:!1};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},l)),e.profiles[c]||(e.profiles[c]=_object_spread({id:c},l))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,t){var o=e.customData,c=o.playerId,l=o.opponentId;if(!c||!l)return;var u=t.whitePlayerId,d=t.whitePlayerScore,f=t.whitePlayerFinish,y=t.blackPlayerScore,p=t.blackPlayerFinish,g=u===c;e.profiles[c].score=g?d:y,e.profiles[l].score=g?y:d,e.profiles[c].finished=g?f:p,e.profiles[l].finished=g?p:f}}]),Si}(aS);var nd=/*#__PURE__*/function(e){function Ei(e,t){var o;return _class_call_check(this,Ei),h(o=_call_super(this,Ei,[e]),"payload"),o.payload=t,o}return _inherits(Ei,e),_create_class(Ei,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:if((function(){return _get(_get_prototype_of(Ei.prototype),"processAsync",t)})().call(o,e),!o.payload.ignore)return[3,2];return[4,o.nextAsync(e)];case 1:return l.sent(),[2];case 2:return o.validateData(e),[4,o.createWideframesCurrentScoreAsync()];case 3:return(c=l.sent())&&o.sendMessageAsync(e,c),[4,o.nextAsync(e)];case 4:return l.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,c=o.contextId,l=o.opponentId;if(!t||"string"!=typeof t)throw new aF;if(!c||"string"!=typeof c)throw new aY;if(!l||"string"!=typeof l)throw new aj}},{key:"createWideframesCurrentScoreAsync",value:function createWideframesCurrentScoreAsync(){var e=this;return _async_to_generator(function(){var t,o,c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),o=(t=e.game).player,c=t.frameCapture,u=(l=o.getPlayer()).playerId,d=l.photo,y=void 0===(f=(e.match.getMatchState().profiles[u]||{}).score)?0:f,[4,c.wideframe.renderShareScore({playerId:u,playerPhoto:d,playerScore:y})];case 1:return[2,p.sent()];case 2:return p.sent(),[2,null];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var o,c,l,u,d,f,y,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(o=e.id,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||"string"!=typeof u)throw new W;if(!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");if(!(f=c[u]))throw new aJ;if(y=f.name,p={data:{type:eJ.CHALLENGE_FRIEND,matchId:o,playerId:u,opponentId:d},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," made an update."),localizations:{vi_VN:"".concat(y," đ\xe3 cập nhật trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:return g.sent(),[2]}})})()}}]),Ei}(aS);var nh=/*#__PURE__*/function(e){function xi(){return _class_call_check(this,xi),_call_super(this,xi,arguments)}return _inherits(xi,e),_create_class(xi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I,D,k,E,x,C;return _ts_generator(this,function(T){switch(T.label){case 0:return T.trys.push([0,,2,3]),t.startLog(e),o=e.contextId,c=e.matchId,l=e.playerId,u=e.opponentId,y=void 0===(f=e.sendUpdateMessage)||f,p=new aZ(t),g=new no(t,{contextId:o}),p.setNext(g),m=new az(t,{id:c,mode:d.CHALLENGE_FRIEND,customData:{playerId:l,opponentId:u}}),g.setNext(m),A=new nu(t),m.setNext(A),I=new a$(t),A.setNext(I),D=new nt(t),I.setNext(D),k=new nd(t,{ignore:!y}),D.setNext(k),E=new aL(t),k.setNext(E),x=new aO(t),E.setNext(x),C=t.match.getMatchState(),[4,p.processAsync(C)];case 1:return T.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),xi}(aw);var nf=o.Plugins,ny=o.Utils,n_=nf.Analytics,nv=ny.String,np=ny.Valid;var ng=/*#__PURE__*/function(e){function Oe(){return _class_call_check(this,Oe),_call_super(this,Oe,arguments)}return _inherits(Oe,e),_create_class(Oe,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u,d,f,y,p;return _ts_generator(this,function(g){switch(g.label){case 0:return(function(){return _get(_get_prototype_of(Oe.prototype),"processAsync",t)})().call(o,e),c=e.customData,l=e.mode,u=e.startAt,d=e.finishAt,f=c.level,o.validateMode(l),o.validateLevel(f),y=o.game.analytics,p=Math.floor((d-u)/1e3),y.event(n_.Events.MATCH_END,{level:f,game_mode:nv.toUpperCamelCase(l),level_name:o.getLevelName(f),time_played:p}),[4,o.nextAsync(e)];case 1:return g.sent(),[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!np.isString(e))throw new aD}},{key:"validateLevel",value:function validateLevel(e){if(!np.isNumber(e))throw new aI}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(nv.padStart(e.toString(),5,"0"))}}]),Oe}(aS);var nm=/*#__PURE__*/function(e){function Rs(e){var t;return _class_call_check(this,Rs),(t=_call_super(this,Rs,[e])).name="LeaderboardNotExist",t.message=null!=e?e:"Leaderboard not exist in game",t}return _inherits(Rs,e),Rs}(_wrap_native_super(Error));var nA=/*#__PURE__*/function(e){function $t(e){var t;return _class_call_check(this,$t),(t=_call_super(this,$t,[e])).name="ScoreNotValid",t.message=null!=e?e:"Score is not valid",t}return _inherits($t,e),$t}(_wrap_native_super(Error));var nw=o.Utils.Valid,nI=o.Configs.Leaderboards.LeaderboardList;var nD=/*#__PURE__*/function(e){function Qe(e,t){var o;return _class_call_check(this,Qe),h(o=_call_super(this,Qe,[e]),"payload"),h(o,"skipPostScore"),o.payload={score:0,playerId:""},o.skipPostScore=!!(null!=t&&t.ignore),o}return _inherits(Qe,e),_create_class(Qe,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u,d,f,y,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:if((function(){return _get(_get_prototype_of(Qe.prototype),"processAsync",t)})().call(o,e),!o.skipPostScore)return[3,2];return[4,o.nextAsync(e)];case 1:return m.sent(),[2];case 2:if(o.setupSetScorePayload(e),!("submitGameResultsAsync"in GameSDK.extra))return[3,4];return[4,GameSDK.extra.submitGameResultsAsync(o.payload.score)];case 3:m.sent(),m.label=4;case 4:c=true,l=false,u=void 0;try{for(d=nI[Symbol.iterator]();!(c=(f=d.next()).done);c=true)p=(y=f.value).Id,g=y.Mode,e.mode&&o.isValidMode(g,e.mode)&&o.setLeaderboardScoreAsync(_object_spread({leaderboardId:p},o.payload))}catch(e){l=true,u=e}finally{try{if(!c&&null!=d.return)d.return()}finally{if(l)throw u}}return[4,o.nextAsync(e)];case 5:return m.sent(),[2]}})})()}},{key:"isValidMode",value:function isValidMode(e,t){return e===t}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){if(o=e.profiles,!(c=e.customData.playerId)||!o[c])throw new aJ;if(l=o[c].score,!nw.isNumber(l))throw new nA;return t.payload={score:l,playerId:c},[2]})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(d.trys.push([0,2,,3]),o=e.playerId,c=e.score,l=e.leaderboardId,!(u=t.game.leaderboard.getLeaderboardName(l)))throw new nm;return[4,t.game.leaderboard.setLeaderboardScoreAsync(u,o,c)];case 1:return d.sent(),[3,3];case 2:return d.sent(),[3,3];case 3:return[2]}})})()}}]),Qe}(aS);var nk=o.Dtos,nb=o.Utils,nS=nb.Valid,nP=nb.Object;var nE=/*#__PURE__*/function(e){function Me(e,t){var o;return _class_call_check(this,Me),h(o=_call_super(this,Me,[e]),"payload"),o.payload=t,o}return _inherits(Me,e),_create_class(Me,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:if((function(){return _get(_get_prototype_of(Me.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),!o.payload.useAPI)return[3,2];return[4,o.finishMatchAsync(e)];case 1:return c=u.sent(),l=new nk.Match.Data(c).toObject(),o.updateMatchFromAPI(e,l),[3,3];case 2:o.updateMatchData(e),u.label=3;case 3:return o.updateMatchState(e),[4,o.nextAsync(e)];case 4:return u.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status,o=e.profiles,c=e.customData;if(t!==aN.ACTIVE)throw new aM;var l=c.playerId;if(!l||!nP.hasOwn(o,l))throw new aB}},{key:"updateMatchData",value:function updateMatchData(e){var t=e.customData.playerId;if(!nS.isString(t))throw new W;e.profiles[t].finished=!0}},{key:"updateMatchState",value:function updateMatchState(e){e.status=aN.FINISHED,e.finishAt=Date.now()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f;return _ts_generator(this,function(y){if(o=e.id,c=e.profiles,u=(l=e.customData).level,d=l.playerId,!nS.isString(d))throw new W;return f={matchId:null!=o?o:"",score:c[d].score,level:u,extraData:t.payload.extraData},[2,t.match.api.getMatchAPI().finishMatchAsync(f)]})})()}},{key:"updateMatchFromAPI",value:function updateMatchFromAPI(e,t){var o=e.customData,c=o.playerId,l=o.opponentId;if(!nS.isString(c))throw new W;if(!nS.isString(l))throw new aj;var u=t.whitePlayerId,d=t.whitePlayerScore,f=t.blackPlayerScore,y=t.whitePlayerFinish,p=t.blackPlayerFinish,g=c===u;e.profiles[c].score=g?d:f,e.profiles[l].score=g?f:d,e.profiles[c].finished=g?y:p,e.profiles[l].finished=g?p:y}}]),Me}(aS);var nx=/*#__PURE__*/function(e){function Ri(){return _class_call_check(this,Ri),_call_super(this,Ri,arguments)}return _inherits(Ri,e),_create_class(Ri,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Ri.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createWideframesResultAsync(e)];case 1:return(c=l.sent())&&o.progressSendFinishedMessage(e,c),[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,c=o.contextId,l=o.opponentId;if(!t||"string"!=typeof t)throw new aF;if(!c||"string"!=typeof c)throw new aY;if(!l||"string"!=typeof l)throw new aj}},{key:"createWideframesResultAsync",value:function createWideframesResultAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I,D,k,E;return _ts_generator(this,function(x){switch(x.label){case 0:if(x.trys.push([0,2,,3]),o=t.game.frameCapture,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||!d)return[2,null];if(f=c[u],y=c[d],!f||!y)return[2,null];return p=f.photo,m=void 0===(g=f.score)?0:g,A=f.finished,I=y.photo,k=void 0===(D=y.score)?0:D,E=y.finished,[4,o.wideframe.renderResultChallenge({playerId:u,playerPhoto:p,playerScore:m,opponentId:d,opponentPhoto:I,opponentScore:k,isPlayerFinished:!!A,isOpponentFinished:!!E})];case 1:return[2,x.sent()];case 2:return x.sent(),[2,null];case 3:return[2]}})})()}},{key:"progressSendFinishedMessage",value:function progressSendFinishedMessage(e,t){var o=e.profiles,c=e.customData,l=c.playerId,u=c.opponentId;if(!l||"string"!=typeof l)throw new W;if(!u||"string"!=typeof u)throw new aj;if(!o[l]||!o[u])throw new aJ;var d=o[l],f=d.score,y=d.finished,p=o[u],g=p.score,m=p.finished;y?this.sendFinishMessageAsync(e,t):m&&(void 0===f?0:f)>(void 0===g?0:g)?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}},{key:"sendFinishMessageAsync",value:function sendFinishMessageAsync(e,t){return _async_to_generator(function(){var o,c,l,u,d,f,y,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(o=e.id,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||"string"!=typeof u)throw new W;if(!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");if(!(f=c[u]))throw new aJ;if(y=f.name,p={data:{type:eJ.CHALLENGE_FRIEND,matchId:o,playerId:u,opponentId:d,status:aN.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(y," just finished. Check them now."),localizations:{vi_VN:"".concat(y," vừa ho\xe0n th\xe0nh m\xe0n chơi. Nhấn để xem kết quả trận đấu.")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:return g.sent(),[2]}})})()}},{key:"sendPlayTurnMessageAsync",value:function sendPlayTurnMessageAsync(e,t){return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:if(o=e.id,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||"string"!=typeof u)throw new W;if(!(f=c[u]))throw new aJ;if(y=f.name,p=f.score,g={data:{type:eJ.CHALLENGE_FRIEND,matchId:o,playerId:u,opponentId:d,status:aN.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," got ").concat(p," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(y," đ\xe3 đạt ").concat(p," điểm! Nhấn Chơi để so t\xe0i!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");return[4,GameSDK.extra.updateAsync(g)];case 1:return m.sent(),[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:if(o=e.id,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||"string"!=typeof u)throw new W;if(!(f=c[u]))throw new aJ;if(y=f.name,p=f.score,g={data:{type:eJ.CHALLENGE_FRIEND,matchId:o,playerId:u,opponentId:d,status:aN.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(y," beat your high score. Their score: ").concat(p),localizations:{vi_VN:"".concat(y," đ\xe3 vượt qua điểm số của bạn, với ").concat(p," điểm!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");return[4,GameSDK.extra.updateAsync(g)];case 1:return m.sent(),[2]}})})()}}]),Ri}(aS);var nC=/*#__PURE__*/function(e){function Re(e,t){var o;return _class_call_check(this,Re),h(o=_call_super(this,Re,[e]),"ignore"),o.ignore=!!(null!=t&&t.ignore),o}return _inherits(Re,e),_create_class(Re,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return(function(){return _get(_get_prototype_of(Re.prototype),"processAsync",t)})().call(o,e),o.setPlayerBestScore(e),[4,o.nextAsync(e)];case 1:return c.sent(),[2]}})})()}},{key:"setPlayerBestScore",value:function setPlayerBestScore(e){if(this.ignore)return;var t=e.profiles,o=e.customData.playerId;if(!o||!t[o])throw new aJ;var c=this.game.player,l=c.getBestScore()||0,u=t[o].score,d=void 0===u?0:u;d<=l||(c.setBestScore(d),t[o].bestScore=d)}}]),Re}(aS);var nT=/*#__PURE__*/function(e){function Fi(){return _class_call_check(this,Fi),_call_super(this,Fi,arguments)}return _inherits(Fi,e),_create_class(Fi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,,2,3]),t.startLog(e),o=(null!=e?e:{}).extraData,c=new aZ(t),l=new nE(t,{useAPI:!0,extraData:o}),c.setNext(l),u=new nx(t),l.setNext(u),d=new ng(t),u.setNext(d),f=new nC(t),d.setNext(f),y=new nD(t),f.setNext(y),p=new aO(t),y.setNext(p),g=t.match.getMatchState(),[4,c.processAsync(g)];case 1:return m.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Fi}(aw);var nL=/*#__PURE__*/function(e){function Gi(e){var t;return _class_call_check(this,Gi),(t=_call_super(this,Gi,[e])).name="ContextAreSolo",t.message=null!=e?e:"Context are solo",t}return _inherits(Gi,e),Gi}(_wrap_native_super(Error));var nN=/*#__PURE__*/function(e){function $i(e){var t;return _class_call_check(this,$i),(t=_call_super(this,$i,[e])).name="ContextNotChallenge",t.message=null!=e?e:"Context is not a challenge",t}return _inherits($i,e),$i}(_wrap_native_super(Error));var nO=/*#__PURE__*/function(e){function ki(e){var t;return _class_call_check(this,ki),(t=_call_super(this,ki,[e])).name="NetworkFailure",t.message=null!=e?e:"Network failure",t}return _inherits(ki,e),ki}(_wrap_native_super(Error));var nR=o.Utils,nM=o.Dtos,nF=nR.Array,nG=nR.Object;var nj=/*#__PURE__*/function(e){function Fs(e,t){var o;return _class_call_check(this,Fs),h(o=_call_super(this,Fs,[e]),"payload"),o.payload=t,o}return _inherits(Fs,e),_create_class(Fs,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Fs.prototype),"processAsync",t)})().call(o,e),o.checkCurrentContext(),[4,o.getOpponentIdFromContextAsync()];case 1:return c=l.sent(),e.customData.opponentId=c,[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"checkCurrentContext",value:function checkCurrentContext(){var e=GameSDK.context.getID();if("string"!=typeof e)throw new aY;if("SOLO"===e)throw new nL}},{key:"getOpponentIdFromContextAsync",value:function getOpponentIdFromContextAsync(){var e=this;return _async_to_generator(function(){var t,o,c;return _ts_generator(this,function(l){switch(l.label){case 0:return t=e.payload.ignoreId,[4,e.getContextPlayers([t])];case 1:if((o=l.sent()).length>1)throw new nN;return c=V,[2,(1===o.length&&(c=o[0]),c.playerId)]}})})()}},{key:"getContextPlayers",value:function getContextPlayers(e){return _async_to_generator(function(){var t,o,c,l,u,d,f,y,p,g,m,A;return _ts_generator(this,function(I){switch(I.label){case 0:return I.trys.push([0,2,,3]),[4,GameSDK.context.getPlayersAsync()];case 1:t=I.sent(),o=[],c=true,l=false,u=void 0;try{for(d=t[Symbol.iterator]();!(c=(f=d.next()).done);c=true)if(p=(y=f.value).getID(),!(e.indexOf(p)>-1)){if(!!(g=y.getName()))m=y.getPhoto(),o.push(new nM.Player.Info({playerId:p,name:g,photo:m}).toObject())}}catch(e){l=true,u=e}finally{try{if(!c&&null!=d.return)d.return()}finally{if(l)throw u}}return[2,nF.unique(o)];case 2:if(A=I.sent(),nG.hasOwn(A,"code")&&"NETWORK_FAILURE"===A.code)throw new nO;return[2,[]];case 3:return[2]}})})()}}]),Fs}(aS);var nB=/*#__PURE__*/function(e){function kt(e){var t;return _class_call_check(this,kt),(t=_call_super(this,kt,[e])).name="ContextIsTournament",t.message=null!=e?e:"Context is a tournament",t}return _inherits(kt,e),kt}(_wrap_native_super(Error));var nV=o.Utils.Object;var nU=/*#__PURE__*/function(e){function Wi(){return _class_call_check(this,Wi),_call_super(this,Wi,arguments)}return _inherits(Wi,e),_create_class(Wi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Wi.prototype),"processAsync",t)})().call(o,e),[4,o.chooseAsync()];case 1:return c=l.sent(),[4,o.checkContextTournament()];case 2:return l.sent(),e.customData.contextId=c,[4,o.nextAsync(e)];case 3:return l.sent(),[2]}})})()}},{key:"chooseAsync",value:function chooseAsync(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})];case 1:return o.sent(),[3,3];case 2:if(e=o.sent(),!nV.hasOwn(e,"code")||"SAME_CONTEXT"!==e.code)throw e;return[3,3];case 3:if("string"!=typeof(t=GameSDK.context.getID()))throw new a2;return[2,t]}})})()}},{key:"checkContextTournament",value:function checkContextTournament(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(o){switch(o.label){case 0:if(o.trys.push([0,4,,5]),!GameSDK.context.getID())return[2];if(!("getTournamentAsync"in GameSDK))return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:return o.sent(),e=new nB,[3,3];case 2:e=new aq("getTournamentAsync"),o.label=3;case 3:throw e;case 4:if(_instanceof(t=o.sent(),nB))throw t;return[3,5];case 5:return[2]}})})()}}]),Wi}(aS);var nH=/*#__PURE__*/function(e){function Ki(){return _class_call_check(this,Ki),_call_super(this,Ki,arguments)}return _inherits(Ki,e),_create_class(Ki,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I,D,k;return _ts_generator(this,function(E){switch(E.label){case 0:return E.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,c=e.extraData,l=new aZ(t),u=new nU(t),l.setNext(u),f=new az(t,{mode:d.CHALLENGE_FRIEND,customData:{playerId:o}}),u.setNext(f),y=new nj(t,{ignoreId:o}),f.setNext(y),p=new a9(t,{extraData:c}),y.setNext(p),g=new a$(t),p.setNext(g),m=new nt(t),g.setNext(m),A=new aL(t),m.setNext(A),I=new na(t),A.setNext(I),D=new aO(t),I.setNext(D),k=t.match.getMatchState(),[4,l.processAsync(k)];case 1:return E.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Ki}(aw);var nK=/*#__PURE__*/function(e){function qi(e){var t;return _class_call_check(this,qi),(t=_call_super(this,qi,[e])).name="JoinMatchFailed",t.message=null!=e?e:"Join match failed",t}return _inherits(qi,e),qi}(_wrap_native_super(Error));var nW=/*#__PURE__*/function(e){function zi(e){var t;return _class_call_check(this,zi),(t=_call_super(this,zi,[e])).name="MatchAreFinished",t.message=null!=e?e:"Match are finished",t}return _inherits(zi,e),zi}(_wrap_native_super(Error));var nz=/*#__PURE__*/function(e){function Yi(e){var t;return _class_call_check(this,Yi),(t=_call_super(this,Yi,[e])).name="OtherPlayerHasJoinedMatch",t.message=null!=e?e:"Other player has joined match",t}return _inherits(Yi,e),Yi}(_wrap_native_super(Error));var nq=o.Dtos,nY=o.Utils.Object;var nJ=/*#__PURE__*/function(e){function Xi(){return _class_call_check(this,Xi),_call_super(this,Xi,arguments)}return _inherits(Xi,e),_create_class(Xi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return(function(){return _get(_get_prototype_of(Xi.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),[4,o.joinMatchAsync(e)];case 1:return c=u.sent(),l=new nq.Match.Data(c).toObject(),o.validateJoinMatchData(e,l),o.updateMatchData(e,l),[4,o.nextAsync(e)];case 2:return u.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){if(e.status!==aN.OPEN)throw new a6}},{key:"validateJoinMatchData",value:function validateJoinMatchData(e,t){var o=e.id,c=e.customData,l=t._id,u=t.blackPlayerId,d=t.whitePlayerId,f=t.whitePlayerFinish,y=t.blackPlayerFinish,p=u===c.playerId,g=d===c.opponentId;if("string"!=typeof l||l!==o||!g)throw new nK;if(f&&y)throw new nW;if(!p)throw new nz}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){return[2,(o=e.id)?t.match.api.getMatchAPI().joinMatchAsync(o):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t.extraData;e.customData=nY.merge(e.customData,o)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,c=t.blackPlayerId,l=o===e.customData.playerId;e.customData.playerId=l?o:c,e.customData.opponentId=l?c:o}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,c=t.opponentId;if(!o||!c)return;var l={name:"",photo:"",finished:!1};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},l)),e.profiles[c]||(e.profiles[c]=_object_spread({id:c},l))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,t){var o=e.customData,c=o.playerId,l=o.opponentId;if(!c||!l)return;var u=t.whitePlayerId,d=t.whitePlayerScore,f=t.whitePlayerFinish,y=t.blackPlayerScore,p=t.blackPlayerFinish,g=u===e.customData.playerId;e.profiles[c].score=g?d:y,e.profiles[l].score=g?y:d,e.profiles[c].finished=g?f:p,e.profiles[l].finished=g?p:f}}]),Xi}(aS);var nX=/*#__PURE__*/function(e){function Zi(){return _class_call_check(this,Zi),_call_super(this,Zi,arguments)}return _inherits(Zi,e),_create_class(Zi,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Zi.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.createWideframesAcceptedAsync(e)];case 1:return(c=l.sent())&&o.sendMessageAsync(e,c),[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,c=o.contextId,l=o.opponentId;if(!t||"string"!=typeof t)throw new aF;if(!c||"string"!=typeof c)throw new aY;if(!l||"string"!=typeof l)throw new aj}},{key:"createWideframesAcceptedAsync",value:function createWideframesAcceptedAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I,D,k;return _ts_generator(this,function(E){switch(E.label){case 0:if(E.trys.push([0,4,,5]),o=t.game.frameCapture,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||!d)return[2,null];if(f=c[u],y=c[d],!f||!y)return[2,null];if(p=f.photo,m=void 0===(g=f.score)?0:g,f.finished)return[2,null];if(A=y.photo,D=void 0===(I=y.score)?0:I,!y.finished)return[3,2];return[4,o.wideframe.renderResultChallenge({playerId:u,playerPhoto:p,playerScore:m,opponentId:d,opponentPhoto:A,opponentScore:D,isPlayerFinished:!1,isOpponentFinished:!0})];case 1:return k=E.sent(),[3,3];case 2:k=null,E.label=3;case 3:return[2,k];case 4:return E.sent(),[2,null];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var o,c,l,u,d,f,y,p;return _ts_generator(this,function(g){switch(g.label){case 0:if(o=e.id,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||"string"!=typeof u)throw new W;if(!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");if(!(f=c[u]))throw new aJ;return y=f.name,p={data:{type:eJ.CHALLENGE_FRIEND,matchId:o,playerId:u,opponentId:d},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," accepted the challenge."),localizations:{vi_VN:"".concat(y," đ\xe3 chấp nhận tham gia trận đấu.")}},image:t,strategy:"LAST",notification:"PUSH"},[4,GameSDK.extra.updateAsync(p)];case 1:return g.sent(),[2]}})})()}}]),Zi}(aS);var nZ=/*#__PURE__*/function(e){function er(){return _class_call_check(this,er),_call_super(this,er,arguments)}return _inherits(er,e),_create_class(er,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I,D;return _ts_generator(this,function(k){switch(k.label){case 0:return k.trys.push([0,,2,3]),t.startLog(e),o=e.matchId,c=e.playerId,l=e.opponentId,u=new aZ(t),f=new az(t,{id:o,mode:d.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:l}}),u.setNext(f),y=new nJ(t),f.setNext(y),p=new a$(t),y.setNext(p),g=new nt(t),p.setNext(g),m=new nX(t),g.setNext(m),A=new aL(t),m.setNext(A),I=new aO(t),A.setNext(I),D=t.match.getMatchState(),[4,u.processAsync(D)];case 1:return k.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),er}(aw);var nQ={_id:"",status:"",appId:"",createdAt:"",startedAt:null,finishedAt:null,winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1,extraData:{}},n$=o.Configs.AppId,n0=o.Utils.Valid,n2="is invalid";var n3=/*#__PURE__*/function(e){function Vt(){return _class_call_check(this,Vt),_call_super(this,Vt,arguments)}return _inherits(Vt,e),_create_class(Vt,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){n0.isString(e)&&e||this.exception("_id",n2)}},{key:"validateStatus",value:function validateStatus(e){n0.isString(e)&&e||this.exception("status",n2)}},{key:"validateAppId",value:function validateAppId(e){n0.isString(e)&&e===n$||this.exception("appId",n2)}},{key:"validateCreatedAt",value:function validateCreatedAt(e){n0.isString(e)||this.exception("createdAt",n2)}},{key:"validateStartedAt",value:function validateStartedAt(e){null!==e&&(n0.isString(e)||this.exception("startedAt",n2))}},{key:"validateFinishedAt",value:function validateFinishedAt(e){null!==e&&(n0.isString(e)||this.exception("finishedAt",n2))}},{key:"validateExtraData",value:function validateExtraData(e){null!==e&&(n0.isObject(e)||this.exception("extraData",n2))}},{key:"validateWinnerId",value:function validateWinnerId(e){null===e||n0.isString(e)&&e||this.exception("winnerId",n2)}},{key:"validateWhitePlayerId",value:function validateWhitePlayerId(e){n0.isString(e)&&e||this.exception("whitePlayerId",n2)}},{key:"validateBlackPlayerId",value:function validateBlackPlayerId(e){n0.isString(e)&&e||this.exception("blackPlayerId",n2)}},{key:"validateWhitePlayerScore",value:function validateWhitePlayerScore(e){n0.isNumber(e)||this.exception("whitePlayerScore",n2)}},{key:"validateBlackPlayerScore",value:function validateBlackPlayerScore(e){n0.isNumber(e)||this.exception("blackPlayerScore",n2)}},{key:"validateWhitePlayerFinish",value:function validateWhitePlayerFinish(e){n0.isBoolean(e)||this.exception("whitePlayerFinish",n2)}},{key:"validateBlackPlayerFinish",value:function validateBlackPlayerFinish(e){n0.isBoolean(e)||this.exception("blackPlayerFinish",n2)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Vt.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return nQ}}]),Vt}(x);n3.addDefaultData(nQ);var n1=/*#__PURE__*/function(e){function sr(e){var t;return _class_call_check(this,sr),(t=_call_super(this,sr,[e])).name="MatchAreNotFinished",t.message=e||"Match are not finished",t}return _inherits(sr,e),sr}(_wrap_native_super(Error));var n4=/*#__PURE__*/function(e){function ar(e){var t;return _class_call_check(this,ar),(t=_call_super(this,ar,[e])).name="OpponentNotFinishedMatch",t.message=e||"Opponent not finished match",t}return _inherits(ar,e),ar}(_wrap_native_super(Error));var n5=o.Utils.Object;var n6=/*#__PURE__*/function(e){function ir(){return _class_call_check(this,ir),_call_super(this,ir,arguments)}return _inherits(ir,e),_create_class(ir,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(ir.prototype),"processAsync",t)})().call(o,e),o.validateMatchData(e),[4,o.getMatchAsync(e)];case 1:return c=new n3(l.sent()).toObject(),o.validateResultMatchData(e,c),o.updateMatchData(e,c),o.validatePlayerTurn(e),o.validateOpponentTurn(e),[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){if("string"!=typeof e.id)throw new aF}},{key:"validateResultMatchData",value:function validateResultMatchData(e,t){var o=e.id,c=t._id,l=t.whitePlayerFinish,u=t.blackPlayerFinish;if("string"!=typeof c||c!==o)throw new aR;if(!l&&!u)throw new n1}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,o=e.customData.playerId;if("string"!=typeof o)throw new W;if(!t[o].finished)throw new aV}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,o=e.customData.opponentId;if("string"!=typeof o)throw new aj;if(!t[o].finished)throw new n4}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){return[2,(o=e.id)?t.match.api.getMatchAPI().getMatchDetailByIdAsync(o):null]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){this.updateMatchGeneral(e,t),this.updatePlayerIds(e,t),this.initializeProfiles(e),this.updateScoresAndStatus(e,t)}},{key:"updateMatchGeneral",value:function updateMatchGeneral(e,t){var o=t.extraData;e.status=aN.FINISHED,e.customData=n5.merge(e.customData,o)}},{key:"updatePlayerIds",value:function updatePlayerIds(e,t){var o=t.whitePlayerId,c=t.blackPlayerId,l=o===e.customData.playerId;e.customData.playerId=l?o:c,e.customData.opponentId=l?c:o}},{key:"initializeProfiles",value:function initializeProfiles(e){var t=e.customData,o=t.playerId,c=t.opponentId;if(!o||!c)return;var l={name:"",photo:"",finished:!0};e.profiles[o]||(e.profiles[o]=_object_spread({id:o},l)),e.profiles[c]||(e.profiles[c]=_object_spread({id:c},l))}},{key:"updateScoresAndStatus",value:function updateScoresAndStatus(e,t){var o=e.customData,c=o.playerId,l=o.opponentId;if(!c||!l)return;var u=t.whitePlayerId,d=t.whitePlayerScore,f=t.whitePlayerFinish,y=t.blackPlayerScore,p=t.blackPlayerFinish,g=u===e.customData.playerId;e.profiles[c].score=g?d:y,e.profiles[l].score=g?y:d,e.profiles[c].finished=g?f:p,e.profiles[l].finished=g?p:f}}]),ir}(aS);var n7=/*#__PURE__*/function(e){function rr(){return _class_call_check(this,rr),_call_super(this,rr,arguments)}return _inherits(rr,e),_create_class(rr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:return A.trys.push([0,,2,3]),t.startLog(e),o=e.matchId,c=e.playerId,l=e.opponentId,u=new aZ(t),f=new az(t,{id:o,mode:d.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:l}}),u.setNext(f),y=new n6(t),f.setNext(y),p=new a$(t),y.setNext(p),g=new aO(t),p.setNext(g),m=t.match.getMatchState(),[4,u.processAsync(m)];case 1:return A.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),rr}(aw);var n8=/*#__PURE__*/function(e){function or(){var e;return _class_call_check(this,or),e=_call_super(this,or,arguments),h(e,"fallbackSingleMode"),h(e,"startFLowChallengeFriend",/*#__PURE__*/function(){var t=_async_to_generator(function(t){return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e.match.challenge.invite.processAsync(t)];case 1:return[2,(o.sent(),!0)];case 2:return[2,o.sent()];case 3:return[2]}})});return function(e){return t.apply(this,arguments)}}()),h(e,"startFlowTournament",/*#__PURE__*/function(){var t=_async_to_generator(function(t){var o;return _ts_generator(this,function(c){switch(c.label){case 0:if(c.trys.push([0,2,,4]),"string"!=typeof(o=GameSDK.context.getID()))throw new aY;return[4,e.match.tournament.continue.processAsync({playerId:t,contextId:o})];case 1:return c.sent(),[3,4];case 2:return c.sent(),[4,e.startFlowSingle(t)];case 3:return c.sent(),[3,4];case 4:return[2]}})});return function(e){return t.apply(this,arguments)}}()),h(e,"startFlowSingle",/*#__PURE__*/function(){var t=_async_to_generator(function(t){return _ts_generator(this,function(o){return[2,e.match.single.start.processAsync({playerId:t})]})});return function(e){return t.apply(this,arguments)}}()),e}return _inherits(or,e),_create_class(or,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:return d.trys.push([0,,7,8]),t.startLog(e),o=e.playerId,c=e.extraData,l=e.fallbackSingleMode,t.fallbackSingleMode=l,[4,t.startFLowChallengeFriend({playerId:o,extraData:c})];case 1:if(!0===(u=d.sent()))return[2];if(!_instanceof(u,nB))return[3,3];return[4,t.startFlowTournament(o)];case 2:return d.sent(),[3,6];case 3:if(!t.fallbackSingleMode)return[3,5];return[4,t.startFlowSingle(o)];case 4:return d.sent(),[3,6];case 5:throw u;case 6:return[3,8];case 7:return t.endLog(),[7];case 8:return[2]}})})()}}]),or}(aw);var n9=/*#__PURE__*/function(e){function Fe(e){var t;return _class_call_check(this,Fe),(t=_call_super(this,Fe,[e])).name="LeaderboardIdNotValid",t.message=null!=e?e:"Leaderboard id is not valid",t}return _inherits(Fe,e),Fe}(_wrap_native_super(Error));var re=o.Utils.Valid;var ra=/*#__PURE__*/function(e){function ks(e,t){var o;return _class_call_check(this,ks),h(o=_call_super(this,ks,[e]),"payload"),h(o,"leaderboardPayload"),o.payload=t,o}return _inherits(ks,e),_create_class(ks,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:if((function(){return _get(_get_prototype_of(ks.prototype),"processAsync",t)})().call(o,e),o.setupSetScorePayload(e),!("submitGameResultsAsync"in GameSDK.extra))return[3,2];return[4,GameSDK.extra.submitGameResultsAsync(o.payload.score)];case 1:c.sent(),c.label=2;case 2:return o.setLeaderboardScoreAsync(),[4,o.nextAsync(e)];case 3:return c.sent(),[2]}})})()}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d;return _ts_generator(this,function(f){if(o=e.profiles,!(c=e.customData.playerId)||!o[c])throw new aJ;if(u=(l=t.payload).score,d=l.leaderboardId,!re.isNumber(u))throw new nA;if(!re.isString(d))throw new n9;return t.leaderboardPayload={score:u,playerId:c,leaderboardId:d},[2]})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(){var e=this;return _async_to_generator(function(){var t,o,c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(d.trys.push([0,2,,3]),o=(t=e.leaderboardPayload).playerId,c=t.score,l=t.leaderboardId,!(u=e.game.leaderboard.getLeaderboardName(l)))throw new nm;return[4,e.game.leaderboard.setLeaderboardScoreAsync(u,o,c)];case 1:return d.sent(),[3,3];case 2:return d.sent(),[3,3];case 3:return[2]}})})()}}]),ks}(aS);var rs=o.Utils.Valid;var ro=/*#__PURE__*/function(e){function Bt(e){return _class_call_check(this,Bt),_call_super(this,Bt,[e,{score:0,leaderboardId:""}])}return _inherits(Bt,e),_create_class(Bt,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u,d,f;return _ts_generator(this,function(y){if(c=e.profiles,u=(l=e.customData).playerId,!(d=l.leaderboardId))throw new n9;if(!u||!c[u])throw new aJ;if(f=c[u].score,!rs.isNumber(f))throw new nA;return o.payload.score=f,o.payload.leaderboardId=d,(function(){return _get(_get_prototype_of(Bt.prototype),"setupSetScorePayload",t)})().call(o,e),[2]})})()}}]),Bt}(ra);var rl=/*#__PURE__*/function(e){function lr(){return _class_call_check(this,lr),_call_super(this,lr,arguments)}return _inherits(lr,e),_create_class(lr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return(function(){return _get(_get_prototype_of(lr.prototype),"processAsync",t)})().call(o,e),o.validateData(e),o.progressSendGroupMessage(e),[4,o.nextAsync(e)];case 1:return c.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,o=e.customData,c=o.contextId,l=o.opponentId;if(!t||"string"!=typeof t)throw new aF;if(!c||"string"!=typeof c)throw new aY;if(!l||"string"!=typeof l)throw new aj}},{key:"createWideframesResultGroupAsync",value:function createWideframesResultGroupAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I,D;return _ts_generator(this,function(k){switch(k.label){case 0:if(k.trys.push([0,2,,3]),o=t.game.frameCapture,c=e.profiles,u=(l=e.customData).playerId,d=l.opponentId,!u||!d)return[2,null];if(f=c[u],y=c[d],!f||!y)return[2,null];return p=f.photo,m=void 0===(g=f.score)?0:g,A=y.photo,D=void 0===(I=y.score)?0:I,[4,o.wideframe.renderResultChallenge({playerId:u,playerPhoto:p,playerScore:m,opponentId:d,opponentPhoto:A,opponentScore:D,isPlayerFinished:!0,isOpponentFinished:!0})];case 1:return[2,k.sent()];case 2:return k.sent(),[2,null];case 3:return[2]}})})()}},{key:"createWideframesBestScoreAsync",value:function createWideframesBestScoreAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:if(m.trys.push([0,2,,3]),c=(o=t.game).player,l=o.frameCapture,u=e.customData.playerId,f=(d=c.getPlayer()).playerId,y=d.photo,p=d.data,u!==f)return[2,null];return g=(p||{}).score,[4,l.wideframe.renderShareScore({playerId:f,playerPhoto:y,playerScore:g})];case 1:return[2,m.sent()];case 2:return m.sent(),[2,null];case 3:return[2]}})})()}},{key:"progressSendGroupMessage",value:function progressSendGroupMessage(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:if(o=e.profiles,l=(c=e.customData).playerId,!((u=c.opponentId)&&"string"==typeof u))return[3,2];if(!l||"string"!=typeof l)throw new W;if(d=o[l],f=o[u],!d||!f)return[2];if(!((void 0===(y=d.score)?0:y)>(void 0===(p=f.score)?0:p)))return[3,2];return[4,t.createWideframesResultGroupAsync(e)];case 1:if(!(g=A.sent()))return[2];return t.sendBestScoreMessageAsync(e,g),[2];case 2:return[4,t.createWideframesBestScoreAsync(e)];case 3:return(m=A.sent())&&t.sendChallengeMessageAsync(e,m),[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){var o=this;return _async_to_generator(function(){var c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:if(c=e.profiles,!(l=e.customData.playerId)||"string"!=typeof l)throw new W;if(!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");if(!(u=c[l]))throw new aJ;if(d=u.name,f=u.score,y={data:{type:o.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:l,playerName:d,playerScore:f},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:"".concat(d," beats your high score. Their score: ").concat(f,"."),localizations:{vi_VN:"".concat(d," vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");return[4,GameSDK.extra.updateAsync(y)];case 1:return p.sent(),[2]}})})()}},{key:"sendChallengeMessageAsync",value:function sendChallengeMessageAsync(e,t){var o=this;return _async_to_generator(function(){var c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:if(c=e.profiles,!(l=e.customData.playerId)||"string"!=typeof l)throw new W;if(!(u=c[l]))throw new aJ;if(d=u.name,f=u.score,y={data:{type:o.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:l,playerName:d,playerScore:f},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(d," got ").concat(f," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(d," đ\xe3 đạt ").concat(f," điểm! Qu\xe1 dễ lu\xf4n. Chơi lại n\xe0o!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"},!("updateAsync"in GameSDK.extra))throw new aq("updateAsync");return[4,GameSDK.extra.updateAsync(y)];case 1:return p.sent(),[2]}})})()}}]),lr}(aS);var ru=/*#__PURE__*/function(e){function dr(){return _class_call_check(this,dr),_call_super(this,dr,arguments)}return _inherits(dr,e),_create_class(dr,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,o,c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:return p.trys.push([0,,2,3]),e.startLog(),t=new aZ(e),o=new nE(e,{useAPI:!1}),t.setNext(o),c=new rl(e),o.setNext(c),l=new ng(e),c.setNext(l),u=new nC(e),l.setNext(u),d=new ro(e),u.setNext(d),f=new aO(e),d.setNext(f),y=e.match.getMatchState(),[4,t.processAsync(y)];case 1:return p.sent(),[3,3];case 2:return e.endLog(),[7];case 3:return[2]}})})()}}]),dr}(aw);var rd=o.Dtos;var rh=/*#__PURE__*/function(e){function Ze(e,t){var o;return _class_call_check(this,Ze),h(o=_call_super(this,Ze,[e]),"payload"),o.payload=t,o}return _inherits(Ze,e),_create_class(Ze,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return(function(){return _get(_get_prototype_of(Ze.prototype),"processAsync",t)})().call(o,e),o.updateProfileMatchData(e),[4,o.nextAsync(e)];case 1:return c.sent(),[2]}})})()}},{key:"updateProfileMatchData",value:function updateProfileMatchData(e){var t=this.payload.id,o=e.profiles;if(!o[t])throw new aJ;var c=_object_spread({},o[t],this.payload),l=new rd.Match.Profile(c).toObject();o[l.id]=l}}]),Ze}(aS);var rf=/*#__PURE__*/function(e){function ur(){return _class_call_check(this,ur),_call_super(this,ur,arguments)}return _inherits(ur,e),_create_class(ur,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,c=e.opponentId,l=e.opponentScore,u=new aZ(t),f=new az(t,{id:"7749",mode:d.MATCHING_GROUP,customData:{playerId:o,opponentId:c}}),u.setNext(f),y=new a$(t),f.setNext(y),p=new rh(t,{id:o,score:l}),y.setNext(p),g=new nt(t),p.setNext(g),m=new aL(t),g.setNext(m),A=new aO(t),m.setNext(A),I=t.match.getMatchState(),[4,u.processAsync(I)];case 1:return D.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),ur}(aw);var ry=/*#__PURE__*/function(e){function Vs(e){var t;return _class_call_check(this,Vs),(t=_call_super(this,Vs,[e])).name="MatchGroupNotSupported",t.message=null!=e?e:"Match group is not supported",t}return _inherits(Vs,e),Vs}(_wrap_native_super(Error));var r_=/*#__PURE__*/function(e){function pr(e,t){var o;return _class_call_check(this,pr),h(o=_call_super(this,pr,[e]),"payload"),o.payload=t,o}return _inherits(pr,e),_create_class(pr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(pr.prototype),"processAsync",t)})().call(o,e),[4,o.checkMatchGroupSupported()];case 1:return l.sent(),[4,o.matchingGroup()];case 2:return c=l.sent(),e.customData.contextId=c,[4,o.nextAsync(e)];case 3:return l.sent(),[2]}})})()}},{key:"checkMatchGroupSupported",value:function checkMatchGroupSupported(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:if(!("getSupportedAPIs"in GameSDK))throw new aq("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new aq("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new ry;return[4,GameSDK.extra.checkCanPlayerMatchAsync()];case 1:if(!e.sent())throw new ry;return[2]}})})()}},{key:"matchingGroup",value:function matchingGroup(){var e=this;return _async_to_generator(function(){var t,o,c,l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:if(!("matchPlayerAsync"in GameSDK.extra))throw new aq("matchPlayerAsync");return o=(t=e.payload).matchTag,l=void 0!==(c=t.autoSwitch)&&c,d=void 0!==(u=t.onlyExisting)&&u,[4,GameSDK.extra.matchPlayerAsync(o,l,d)];case 1:if(y.sent(),"string"!=typeof(f=GameSDK.context.getID()))throw new a2;return[2,f]}})})()}}]),pr}(aS);var rv=/*#__PURE__*/function(e){function yr(){return _class_call_check(this,yr),_call_super(this,yr,arguments)}return _inherits(yr,e),_create_class(yr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I,D;return _ts_generator(this,function(k){switch(k.label){case 0:return k.trys.push([0,,2,3]),t.startLog(e),o=e.matchTag,c=e.playerId,l=e.options,u=new aZ(t),f=new r_(t,_object_spread({matchTag:o},l)),u.setNext(f),y=new az(t,{id:"7749",mode:d.MATCHING_GROUP,customData:{playerId:c}}),f.setNext(y),p=new nj(t,{ignoreId:c}),y.setNext(p),g=new nt(t),p.setNext(g),m=new a$(t),g.setNext(m),A=new aL(t),m.setNext(A),I=new aO(t),A.setNext(I),D=t.match.getMatchState(),[4,u.processAsync(D)];case 1:return k.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),yr}(aw);var rp=/*#__PURE__*/function(e){function fr(){return _class_call_check(this,fr),_call_super(this,fr,arguments)}return _inherits(fr,e),_create_class(fr,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,o,c,l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:return y.trys.push([0,,2,3]),e.startLog(),t=new aZ(e),o=new nE(e,{useAPI:!1}),t.setNext(o),c=new ng(e),o.setNext(c),l=new nC(e),c.setNext(l),u=new nD(e),l.setNext(u),d=new aO(e),u.setNext(d),f=e.match.getMatchState(),[4,t.processAsync(f)];case 1:return y.sent(),[3,3];case 2:return e.endLog(),[7];case 3:return[2]}})})()}}]),fr}(aw);var rg=/*#__PURE__*/function(e){function gr(e){var t;return _class_call_check(this,gr),(t=_call_super(this,gr,[e])).name="ProfileIdNotDefined",t.message=null!=e?e:"Profile id is not defined",t}return _inherits(gr,e),gr}(_wrap_native_super(Error));var rm=o.Dtos;var rA=/*#__PURE__*/function(e){function Ge(e,t){var o;return _class_call_check(this,Ge),h(o=_call_super(this,Ge,[e]),"payload"),o.payload=t,o}return _inherits(Ge,e),_create_class(Ge,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if((function(){return _get(_get_prototype_of(Ge.prototype),"processAsync",t)})().call(o,e),!(c=o.payload.profileId))throw new rg;if(l=o.game.player.getPlayerId(),c!==l)return[3,1];return u=o.getPlayerProfile(),[3,3];case 1:return[4,o.getProfileAsync(c)];case 2:if(!(u=d.sent()))throw new aJ;d.label=3;case 3:return o.updateMatchData(u,e),[4,o.nextAsync(e)];case 4:return d.sent(),[2]}})})()}},{key:"getPlayerProfile",value:function getPlayerProfile(){var e=this.game.player.getPlayer();return{playerId:e.playerId,name:e.name,photo:e.photo,locale:e.locale}}},{key:"getProfileAsync",value:function getProfileAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,(o=t.game.profile).requestProfiles([e])];case 1:return[2,(c.sent(),o.getProfiles()[e])]}})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var o=e.playerId,c=e.name,l=e.photo,u=new rm.Match.Profile({id:o,name:c,photo:l}).toObject();t.profiles[o]=u}}]),Ge}(aS);var rw=/*#__PURE__*/function(e){function Ar(){return _class_call_check(this,Ar),_call_super(this,Ar,arguments)}return _inherits(Ar,e),_create_class(Ar,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:return A.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,c=new aZ(t),l=new no(t,{contextId:"SOLO"}),c.setNext(l),u=new az(t,{id:"123456",mode:d.SINGLE,customData:{playerId:o}}),l.setNext(u),f=new nt(t),u.setNext(f),y=new rA(t,{profileId:o}),f.setNext(y),p=new aL(t),y.setNext(p),g=new aO(t),p.setNext(g),m=t.match.getMatchState(),[4,c.processAsync(m)];case 1:return A.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Ar}(aw);var rI=/*#__PURE__*/function(e){function wr(){return _class_call_check(this,wr),_call_super(this,wr,arguments)}return _inherits(wr,e),_create_class(wr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),t.startLog(e),l=void 0!==(c=(o=null!=e?e:{}).setPlayerBestScore)&&c,d=void 0!==(u=o.postGlobalLeaderboard)&&u,f=new aZ(t),y=new nE(t,{useAPI:!1}),f.setNext(y),p=new ng(t),y.setNext(p),g=new nC(t,{ignore:!l}),p.setNext(g),m=new nD(t,{ignore:!d}),g.setNext(m),A=new aO(t),m.setNext(A),I=t.match.getMatchState(),[4,f.processAsync(I)];case 1:return D.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),wr}(aw);var rD=/*#__PURE__*/function(e){function Dr(){return _class_call_check(this,Dr),_call_super(this,Dr,arguments)}return _inherits(Dr,e),_create_class(Dr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I,D;return _ts_generator(this,function(k){switch(k.label){case 0:return k.trys.push([0,,2,3]),t.startLog(e),o=e.matchId,c=e.playerId,l=e.gameMode,d=void 0===(u=e.extraData)?{}:u,f=new aZ(t),y=new no(t,{contextId:"SOLO"}),f.setNext(y),p=new az(t,{id:o,mode:l,customData:_object_spread({playerId:c},d)}),y.setNext(p),g=new nt(t),p.setNext(g),m=new rA(t,{profileId:c}),g.setNext(m),A=new aL(t),m.setNext(A),I=new aO(t),A.setNext(I),D=t.match.getMatchState(),[4,f.processAsync(D)];case 1:return k.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Dr}(aw);var rk=o.Plugins,rb=o.Utils,rS=rk.Analytics,rP=rb.String,rE=rb.Valid;var rx=/*#__PURE__*/function(e){function Bs(){return _class_call_check(this,Bs),_call_super(this,Bs,arguments)}return _inherits(Bs,e),_create_class(Bs,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u,d,f;return _ts_generator(this,function(y){switch(y.label){case 0:return(function(){return _get(_get_prototype_of(Bs.prototype),"processAsync",t)})().call(o,e),c=e.mode,l=e.customData,o.validateMode(c),u=o.game.analytics,d=l.tournamentId,f=l.leaderboardId,u.event(rS.Events.TOURNAMENT_START,{success:!0,game_mode:rP.toUpperCamelCase(c),tournament_id:d,leaderboard_id:f}),[4,o.nextAsync(e)];case 1:return y.sent(),[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!rE.isString(e))throw new aD}}]),Bs}(aS);var rC=/*#__PURE__*/function(e){function Us(e){var t;return _class_call_check(this,Us),(t=_call_super(this,Us,[e])).name="TournamentIdNotValid",t.message=null!=e?e:"Tournament id is not valid",t}return _inherits(Us,e),Us}(_wrap_native_super(Error));var rT=o.Utils.Valid;var rL=/*#__PURE__*/function(e){function xr(e,t){var o;return _class_call_check(this,xr),h(o=_call_super(this,xr,[e]),"payload"),o.payload=t,o}return _inherits(xr,e),_create_class(xr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(xr.prototype),"processAsync",t)})().call(o,e),c=o.payload.contextId,o.validateContextId(c),[4,GameSDK.getTournamentAsync()];case 1:return u=(l=f.sent()).getID().toString(),o.validateTournamentId(u),d=JSON.parse(l.getPayload()||"{}").leaderboardId,o.validateLeaderboardId(d),e.customData.contextId=c,e.customData.tournamentId=u,e.customData.leaderboardId=d,[4,o.nextAsync(e)];case 2:return f.sent(),[2]}})})()}},{key:"validateContextId",value:function validateContextId(e){if(!rT.isString(e))throw new aY}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!rT.isString(e))throw new rC}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!rT.isString(e)||""===e)throw new n9}}]),xr}(aS);var rN=/*#__PURE__*/function(e){function Cr(){return _class_call_check(this,Cr),_call_super(this,Cr,arguments)}return _inherits(Cr,e),_create_class(Cr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,c=e.contextId,l=new aZ(t),u=new rL(t,{contextId:c}),l.setNext(u),f=new az(t,{id:"1997",mode:d.TOURNAMENT,customData:{playerId:o}}),u.setNext(f),y=new nt(t),f.setNext(y),p=new rA(t,{profileId:o}),y.setNext(p),g=new aL(t),p.setNext(g),m=new rx(t),g.setNext(m),A=new aO(t),g.setNext(A),I=t.match.getMatchState(),[4,l.processAsync(I)];case 1:return D.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Cr}(aw);var rO=o.Plugins.Analytics;var rR=/*#__PURE__*/function(e){function Nr(){return _class_call_check(this,Nr),_call_super(this,Nr,arguments)}return _inherits(Nr,e),_create_class(Nr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of(Nr.prototype),"processAsync",t)})().call(o,e),c=e.customData,l=o.game.analytics,u=c.tournamentId,d=c.leaderboardId,l.event(rO.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:u,leaderboard_id:d}),[4,o.nextAsync(e)];case 1:return f.sent(),[2]}})})()}}]),Nr}(aS);var rM=/*#__PURE__*/function(e){function Lr(e,t){var o;return _class_call_check(this,Lr),h(o=_call_super(this,Lr,[e]),"payload"),o.payload=t,o}return _inherits(Lr,e),_create_class(Lr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return(function(){return _get(_get_prototype_of(Lr.prototype),"processAsync",t)})().call(o,e),[4,o.createTournamentAsync()];case 1:return c.sent(),[4,o.updateMatchStateAsync(e)];case 2:return c.sent(),[4,o.nextAsync(e)];case 3:return c.sent(),[2]}})})()}},{key:"createTournamentAsync",value:function createTournamentAsync(){var e=this;return _async_to_generator(function(){var t,o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return o=(t=e.payload).name,c=t.score,l=t.customData,[4,GameSDK.tournament.createAsync({initialScore:c,config:{title:o,tournamentTitle:o},data:l})];case 1:return u.sent(),[2]}})})()}},{key:"updateMatchStateAsync",value:function updateMatchStateAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u;return _ts_generator(this,function(d){switch(d.label){case 0:if(d.trys.push([0,2,,3]),!("getTournamentAsync"in GameSDK))throw new aq("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 1:return c=(o=d.sent()).getContextID(),l=o.getID().toString(),u=t.payload.playerId,e.customData.playerId=u,e.customData.contextId=c,e.customData.tournamentId=l,[3,3];case 2:if(_instanceof(d.sent(),aq))return[2];return[3,3];case 3:return[2]}})})()}}]),Lr}(aS);var rF=o.Utils.Valid;var rG=/*#__PURE__*/function(e){function Tr(e,t){var o;return _class_call_check(this,Tr),h(o=_call_super(this,Tr,[e]),"payload"),h(o,"leaderboardPayload"),o.payload=t,o}return _inherits(Tr,e),_create_class(Tr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return(function(){return _get(_get_prototype_of(Tr.prototype),"processAsync",t)})().call(o,e),o.validatePayload(),[4,o.setupCreatePayload(e)];case 1:return c.sent(),[4,o.createLeaderboardAsync(e)];case 2:return c.sent(),[4,o.nextAsync(e)];case 3:return c.sent(),[2]}})})()}},{key:"validatePayload",value:function validatePayload(){var e=this.payload.leaderboardId;if(!rF.isString(e))throw new n9}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!rF.isString(e))throw new W}},{key:"setupCreatePayload",value:function setupCreatePayload(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d;return _ts_generator(this,function(f){return o=e.customData.playerId,t.validatePlayerId(o),l=(c=t.payload).name,u=c.leaderboardId,d=c.customData,t.leaderboardPayload={_id:u,name:null!=l?l:"",createdBy:o,description:JSON.stringify(d)},[2]})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,t.game.leaderboard.createLeaderboardAsync(t.leaderboardPayload)];case 1:return o=c.sent(),e.customData.leaderboardId=o,[2]}})})()}}]),Tr}(aS);var rj=/*#__PURE__*/function(e){function Or(){return _class_call_check(this,Or),_call_super(this,Or,arguments)}return _inherits(Or,e),_create_class(Or,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I,D,k;return _ts_generator(this,function(E){switch(E.label){case 0:return E.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,c=e.name,l=e.score,u=e.leaderboardId,d=e.payload,f=new aZ(t),y=new no(t,{contextId:"SOLO"}),f.setNext(y),p=new rM(t,{name:c,score:l,playerId:o,customData:d}),y.setNext(p),g=new rA(t,{profileId:o}),p.setNext(g),m=new rh(t,{id:o,score:l}),g.setNext(m),A=new rG(t,{name:c,customData:d,leaderboardId:u}),m.setNext(A),I=new ro(t),A.setNext(I),D=new rR(t),I.setNext(D),k=t.match.getMatchState(),[4,f.processAsync(k)];case 1:return E.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Or}(aw);var rB=o.Plugins.Analytics,rV=o.Utils.Valid;var rU=/*#__PURE__*/function(e){function Rr(e,t){var o;return _class_call_check(this,Rr),h(o=_call_super(this,Rr,[e]),"payload"),o.payload=t,o}return _inherits(Rr,e),_create_class(Rr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return(function(){return _get(_get_prototype_of(Rr.prototype),"processAsync",t)})().call(o,e),o.validateData(e),[4,o.postScoreTournamentAsync(e)];case 1:return c.sent(),[4,o.nextAsync(e)];case 2:return c.sent(),[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.profiles,o=e.customData.playerId;if(this.validatePlayerId(o),!t[o])throw new aJ}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!rV.isString(e))throw new W}},{key:"getPlayerProfile",value:function getPlayerProfile(e){var t=e.profiles,o=e.customData.playerId;return this.validatePlayerId(o),t[o]}},{key:"isNewBestScore",value:function isNewBestScore(e){var t=this.getPlayerProfile(e),o=t.score,c=t.bestScore;return(void 0===o?0:o)>(void 0===c?0:c)}},{key:"postScoreTournamentAsync",value:function postScoreTournamentAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:o=window.game.analytics,l=void 0===(c=t.getPlayerProfile(e).score)?0:c,u=null,d=!1,f=t.payload.checkBestScore,y=t.isNewBestScore(e),p.label=1;case 1:if(p.trys.push([1,7,8,9]),!("getTournamentAsync"in GameSDK))throw new aq("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 2:if(p.sent(),!(!f||y))return[3,4];return u=rB.Events.TOURNAMENT_SHARE,[4,GameSDK.tournament.shareAsync({score:l})];case 3:return p.sent(),[3,6];case 4:return u=rB.Events.TOURNAMENT_POST_SCORE,[4,GameSDK.tournament.postScoreAsync(l)];case 5:p.sent(),p.label=6;case 6:return d=!0,[3,9];case 7:return p.sent(),[3,9];case 8:return u&&o.event(u,{success:d}),[7];case 9:return[2]}})})()}}]),Rr}(aS);var rH=/*#__PURE__*/function(e){function Fr(){return _class_call_check(this,Fr),_call_super(this,Fr,arguments)}return _inherits(Fr,e),_create_class(Fr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d,f,y,p,g,m,A,I,D,k;return _ts_generator(this,function(E){switch(E.label){case 0:return E.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,c=e.bestScore,u=void 0!==(l=e.checkBestScore)&&l,d=new aZ(t),f=new nE(t,{useAPI:!1}),d.setNext(f),y=new rh(t,{id:o,bestScore:c}),f.setNext(y),p=new rU(t,{checkBestScore:u}),y.setNext(p),g=new ng(t),p.setNext(g),m=new nC(t),g.setNext(m),A=new ro(t),m.setNext(A),I=new nD(t),A.setNext(I),D=new aO(t),I.setNext(D),k=t.match.getMatchState(),[4,d.processAsync(k)];case 1:return E.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),Fr}(aw);var rK=o.Utils,rW=rK.Valid,rz=rK.Object;var rq=/*#__PURE__*/function(e){function $r(e,t){var o;return _class_call_check(this,$r),h(o=_call_super(this,$r,[e]),"payload"),o.payload=t,o}return _inherits($r,e),_create_class($r,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:return(function(){return _get(_get_prototype_of($r.prototype),"processAsync",t)})().call(o,e),c=o.payload.tournamentId,o.validateTournamentId(c),[4,o.joinTournamentAsync(c)];case 1:return f.sent(),[4,GameSDK.getTournamentAsync()];case 2:return u=(l=f.sent()).getContextID(),o.validateContextId(u),d=JSON.parse(l.getPayload()||"{}").leaderboardId,o.validateLeaderboardId(d),e.customData.contextId=u,e.customData.tournamentId=c,e.customData.leaderboardId=d,[4,o.nextAsync(e)];case 3:return f.sent(),[2]}})})()}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!rW.isString(e))throw new rC}},{key:"validateContextId",value:function validateContextId(e){if(!rW.isString(e))throw new aY}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!rW.isString(e)||""===e)throw new n9}},{key:"joinTournamentAsync",value:function joinTournamentAsync(e){return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(!("tournament"in GameSDK))throw new aq("tournament");o.label=1;case 1:return o.trys.push([1,3,,4]),[4,GameSDK.tournament.joinAsync(e)];case 2:return o.sent(),[3,4];case 3:if(t=o.sent(),!rz.hasOwn(t,"code")||"SAME_CONTEXT"!==t.code)throw t;return[3,4];case 4:return[2]}})})()}}]),$r}(aS);var rY=/*#__PURE__*/function(e){function kr(){return _class_call_check(this,kr),_call_super(this,kr,arguments)}return _inherits(kr,e),_create_class(kr,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var o,c,l,u,f,y,p,g,m,A,I;return _ts_generator(this,function(D){switch(D.label){case 0:return D.trys.push([0,,2,3]),t.startLog(e),o=e.playerId,c=e.tournamentId,l=new aZ(t),u=new rq(t,{tournamentId:c}),l.setNext(u),f=new az(t,{id:"1997",mode:d.TOURNAMENT,customData:{playerId:o}}),u.setNext(f),y=new nt(t),f.setNext(y),p=new rA(t,{profileId:o}),y.setNext(p),g=new aL(t),p.setNext(g),m=new rx(t),g.setNext(m),A=new aO(t),m.setNext(A),I=t.match.getMatchState(),[4,l.processAsync(I)];case 1:return D.sent(),[3,3];case 2:return t.endLog(),[7];case 3:return[2]}})})()}}]),kr}(aw);var rJ=o.Dtos,rX=o.Utils.Object;var rZ=/*#__PURE__*/function(e){function Hr(){return _class_call_check(this,Hr),_call_super(this,Hr,arguments)}return _inherits(Hr,e),_create_class(Hr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return(function(){return _get(_get_prototype_of(Hr.prototype),"processAsync",t)})().call(o,e),[4,o.getMatchCustomData(e)];case 1:return c=l.sent(),o.updateMatchCustomData(e,c),[4,o.nextAsync(e)];case 2:return l.sent(),[2]}})})()}},{key:"getMatchCustomData",value:function getMatchCustomData(e){var t=this;return _async_to_generator(function(){var o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:if(!(o=e.id))return[2,{}];return[4,t.match.api.getMatchAPI().getMatchDetailByIdAsync(o)];case 1:return[2,null!==(l=null==(c=u.sent())?void 0:c.extraData)&&void 0!==l?l:{}]}})})()}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e,t){var o=rX.merge(e.customData,t),c=new rJ.Match.CustomData(o).toObject();e.customData=c}}]),Hr}(aS);var rQ=o.Dtos,r$=o.Utils.Object;var r0=/*#__PURE__*/function(e){function qr(e,t){var o;return _class_call_check(this,qr),h(o=_call_super(this,qr,[e]),"payload"),o.payload=t,o}return _inherits(qr,e),_create_class(qr,[{key:"processAsync",value:function processAsync(e){var t=this;var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:return(function(){return _get(_get_prototype_of(qr.prototype),"processAsync",t)})().call(o,e),o.updateMatchCustomData(e),[4,o.nextAsync(e)];case 1:return c.sent(),[2]}})})()}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e){var t=r$.merge(e.customData,this.payload),o=new rQ.Match.CustomData(t).toObject();e.customData=o}}]),qr}(aS);var r2={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:_object_spread({},aW)},r3=o.Configs;var r1=/*#__PURE__*/function(e){function Yr(){var e;return _class_call_check(this,Yr),e=_call_super(this,Yr,arguments),h(e,"base"),h(e,"group"),h(e,"single"),h(e,"context"),h(e,"strategy"),h(e,"challenge"),h(e,"tournament"),h(e,"api"),h(e,"handler"),h(e,"useCPUProfile"),e}return _inherits(Yr,e),_create_class(Yr,[{key:"init",value:function init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}},{key:"setUseCPUProfile",value:function setUseCPUProfile(e){this.useCPUProfile=e}},{key:"createMatchData",value:function createMatchData(){this.game.storage.addStorage("match",r2)}},{key:"getMatchState",value:function getMatchState(){return this.game.storage.getStorage("match")}},{key:"createBaseConcrete",value:function createBaseConcrete(){this.base=new aw(this.game,this)}},{key:"createConcreteFlows",value:function createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createContextFlows(),this.createStrategyFlows(),this.createChallengeFlows(),this.createTournamentFlows()}},{key:"createConcreteHandlers",value:function createConcreteHandlers(){var e=this;this.handler={setProfileData:/*#__PURE__*/function(){var t=_async_to_generator(function(t){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return o=new rh(e.base,t),[4,e.processHandlerAsync(o)];case 1:return c.sent(),[2]}})});return function(e){return t.apply(this,arguments)}}(),setMatchCustomData:/*#__PURE__*/function(){var t=_async_to_generator(function(t){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return o=new r0(e.base,t),[4,e.processHandlerAsync(o)];case 1:return c.sent(),[2]}})});return function(e){return t.apply(this,arguments)}}(),getMatchCustomData:/*#__PURE__*/_async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return t=new rZ(e.base),[4,e.processHandlerAsync(t)];case 1:return o.sent(),[2]}})}),setLeaderboardScore:/*#__PURE__*/function(){var t=_async_to_generator(function(t){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return o=new ra(e.base,t),[4,e.processHandlerAsync(o)];case 1:return c.sent(),[2]}})});return function(e){return t.apply(this,arguments)}}()}}},{key:"createAPIHandler",value:function createAPIHandler(){var e={appId:r3.AppId,matchAPIHost:r3.ApiHost};this.api=new aA(e)}},{key:"createGroupFlows",value:function createGroupFlows(){this.group={join:new rf(this.game,this),start:new rv(this.game,this),finish:new ru(this.game,this)}}},{key:"createSingleFlows",value:function createSingleFlows(){this.single={start:new rw(this.game,this),finish:new rp(this.game,this)}}},{key:"createStrategyFlows",value:function createStrategyFlows(){this.strategy={start:new rD(this.game,this),finish:new rI(this.game,this)}}},{key:"createContextFlows",value:function createContextFlows(){this.context={choose:new n8(this.game,this)}}},{key:"createChallengeFlows",value:function createChallengeFlows(){this.challenge={invite:new nH(this.game,this),friend:new nn(this.game,this),join:new nZ(this.game,this),await:new a0(this.game,this),result:new n7(this.game,this),finish:new nT(this.game,this),continue:new nh(this.game,this)}}},{key:"createTournamentFlows",value:function createTournamentFlows(){this.tournament={join:new rY(this.game,this),create:new rj(this.game,this),finish:new rH(this.game,this),continue:new rN(this.game,this)}}},{key:"processHandlerAsync",value:function processHandlerAsync(e){var t=this.getMatchState();return e.processAsync(t)}}]),Yr}(c.Plugins.BasePlugin);var r4=o.Utils.Valid,r5="is invalid";var r6=/*#__PURE__*/function(e){function Ks(){return _class_call_check(this,Ks),_call_super(this,Ks,arguments)}return _inherits(Ks,e),_create_class(Ks,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!r4.isNumber(e)||e<0)&&this.exception("level",r5)}},{key:"validateRescued",value:function validateRescued(e){(!r4.isNumber(e)||e<0)&&this.exception("rescued",r5)}},{key:"validateContextId",value:function validateContextId(e){r4.isString(e)||this.exception("contextId",r5)}},{key:"validatePlayerId",value:function validatePlayerId(e){r4.isString(e)||this.exception("playerId",r5)}},{key:"validateOpponentId",value:function validateOpponentId(e){r4.isString(e)||null===e||this.exception("opponentId",r5)}},{key:"validateTournamentId",value:function validateTournamentId(e){r4.isString(e)||null===e||this.exception("tournamentId",r5)}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){r4.isString(e)||null===e||this.exception("leaderboardId",r5)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ks.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return x.getDefaultData()}}]),Ks}(x);r6.addDefaultData(aW);var r7=o.Utils.Valid,r8="is invalid";var r9=/*#__PURE__*/function(e){function qs(){return _class_call_check(this,qs),_call_super(this,qs,arguments)}return _inherits(qs,e),_create_class(qs,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){r7.isString(e)&&e||this.exception("id",r8)}},{key:"validateName",value:function validateName(e){r7.isString(e)&&e||this.exception("name",r8)}},{key:"validatePhoto",value:function validatePhoto(e){r7.isString(e)||this.exception("photo",r8)}},{key:"validateScore",value:function validateScore(e){(!r7.isNumber(e)||e<0)&&this.exception("score",r8)}},{key:"validateBestScore",value:function validateBestScore(e){(!r7.isNumber(e)||e<0)&&this.exception("bestScore",r8)}},{key:"validateFinished",value:function validateFinished(e){r7.isBoolean(e)||this.exception("finished",r8)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(qs.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return x.getDefaultData()}}]),qs}(x);r9.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1}),o.Dtos.Match={Data:n3,Profile:r9,CustomData:r6};var se=o.Utils.Object,st=o.Configs.ApiHost,sa=/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,o;return _ts_generator(this,function(c){switch(c.label){case 0:return t="players","MsGames"===GameSDK.getSDKName()&&(t="players?platform=ms-games"),[4,e_(t,e,{},st,10)];case 1:return o=c.sent(),[2,se.hasOwn(o,"data")?o.data||{}:{}]}})});return function Xr(t){return e.apply(this,arguments)}}(),sn=o.Utils,si=sn.Array,sl=sn.Object,su=sn.Valid,sd=o.Configs.AppId;var sh=/*#__PURE__*/function(e){function so(){return _class_call_check(this,so),_call_super(this,so,arguments)}return _inherits(so,e),_create_class(so,[{key:"init",value:function init(){this.game.storage.addStorage("player",T)}},{key:"saveToCloud",value:function saveToCloud(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=e.getPlayerData(),[4,GameSDK.player.setDataAsync(t)];case 1:return o.sent(),[3,3];case 2:return o.sent(),[3,3];case 3:return[2]}})})()}},{key:"receiveData",value:function receiveData(e,t){var o=this.game.storage,c=e.playerId,l=e.name,u=e.photo,d=e.locale;o.setStorageData("player","playerId",c),o.setStorageData("player","name",l),o.setStorageData("player","photo",u),o.setStorageData("player","locale",d),t&&this.setPlayerData(t)}},{key:"syncProfileToServer",value:function syncProfileToServer(){var e=this;return _async_to_generator(function(){var t,o,c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:if(GameSDK.extra.isGuest)throw new Error("Guest player cannot sync profile to server");if(t=e.game.storage,c=(o=e.getPlayer()).playerId,l=o.name,u=o.photo,d=o.locale,f=e.getPlayerASID(),!(!su.isString(f)&&"getASIDAsync"in GameSDK.player))return[3,2];return[4,GameSDK.player.getASIDAsync()];case 1:f=null!==(y=p.sent())&&void 0!==y?y:f,t.setStorageData("player","ASID","".concat(f)),p.label=2;case 2:return[4,sa({appId:sd,ASID:f,playerId:c,name:l,photo:u,locale:d})];case 3:return p.sent(),[2]}})})()}},{key:"setPlayerDataByName",value:function setPlayerDataByName(e,t){this.setPlayerData(_define_property({},e,t))}},{key:"setPlayerData",value:function setPlayerData(e){this.game.storage.setStorageData("player","data",e),this.saveToCloud()}},{key:"setBestScore",value:function setBestScore(e){this.setPlayerDataByName("score",e)}},{key:"setBestEndlessScore",value:function setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}},{key:"setSetting",value:function setSetting(e,t){this.setPlayerDataByName("settings",_define_property({},e,t))}},{key:"setGameData",value:function setGameData(e){var t;var o=null!==(t=this.getGameData())&&void 0!==t?t:{},c=sl.merge(o,e);this.setPlayerDataByName("gameData",c)}},{key:"requestConnectedPlayers",value:function requestConnectedPlayers(){var e=this;return _async_to_generator(function(){var t,o,c,l;return _ts_generator(this,function(u){switch(u.label){case 0:return t=e.game.storage,[4,GameSDK.player.getConnectedPlayersAsync()];case 1:if(o=u.sent().map(function(e){var t=e.getID(),o=e.getName(),c=e.getPhoto();return t&&o&&c?new B({playerId:t,name:o,photo:c}).toObject():null}),(c=si.unique(o)).length<1)return[2];return l=sl.keyBy(c,"playerId"),t.setStorageData("player","connectedPlayers",l),[2]}})})()}},{key:"getPlayer",value:function getPlayer(){return this.game.storage.getStorage("player")}},{key:"getPlayerId",value:function getPlayerId(){var e;return null!==(e=this.game.storage.getStorageData("player","playerId"))&&void 0!==e?e:""}},{key:"getPlayerASID",value:function getPlayerASID(){var e;return null!==(e=this.game.storage.getStorageData("player","ASID"))&&void 0!==e?e:null}},{key:"getPlayerLocale",value:function getPlayerLocale(){var e;return null!==(e=this.game.storage.getStorageData("player","locale"))&&void 0!==e?e:""}},{key:"getPlayerData",value:function getPlayerData(){var e;return null!==(e=this.game.storage.getStorageData("player","data"))&&void 0!==e?e:T.data}},{key:"getPlayerDataByKey",value:function getPlayerDataByKey(e){var t=this.getPlayerData();return sl.hasOwn(t,e)?t[e]:null}},{key:"getGameData",value:function getGameData(){return this.getPlayerDataByKey("gameData")}},{key:"getPlayerSetting",value:function getPlayerSetting(e){var t=this.getPlayerSettings();return sl.hasOwn(t,e)?t[e]:null}},{key:"getPlayerSettings",value:function getPlayerSettings(){return this.getPlayerData().settings}},{key:"isFirstLogin",value:function isFirstLogin(){var e;return null!==(e=this.getPlayerDataByKey("isFirstLogin"))&&void 0!==e?e:T.data.isFirstLogin}},{key:"loggedIn",value:function loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}},{key:"getBestScore",value:function getBestScore(){return this.getPlayerData().score}},{key:"getBestEndlessScore",value:function getBestEndlessScore(){return this.getPlayerData().endlessScore}},{key:"getConnectedPlayers",value:function getConnectedPlayers(){var e;return null!==(e=this.game.storage.getStorageData("player","connectedPlayers"))&&void 0!==e?e:{}}},{key:"getConnectedPlayerIds",value:function getConnectedPlayerIds(e,t){return Object.keys(this.getConnectedPlayers()).slice(t,t+e)}},{key:"getNotificationData",value:function getNotificationData(){var e;return null!==(e=this.getPlayerDataByKey("notificationData"))&&void 0!==e?e:T.data.notificationData}}]),so}(c.Plugins.BasePlugin);var sf=o.Dtos,sy=o.Utils.Valid,s_=T.data,sv=s_.score,sp=s_.endlessScore,sg=s_.settings,sm=s_.gameData,sA=s_.isFirstLogin,sw=s_.dailyRewarded,sI=s_.notificationData,sD=s_.lastCallSwitchGame,sk="is invalid";var sb=/*#__PURE__*/function(e){function Js(){return _class_call_check(this,Js),_call_super(this,Js,arguments)}return _inherits(Js,e),_create_class(Js,[{key:"processData",value:function processData(e){this.validateStructure(e),e.settings=new sf.Player.Settings(e.settings).toObject(),e.gameData=new sf.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}},{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateScore",value:function validateScore(e){(!sy.isNumber(e)||e<0)&&this.exception("score",sk)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!sy.isNumber(e)||sv<0)&&this.exception("endlessScore",sk)}},{key:"validateSettings",value:function validateSettings(e){sy.isObject(e)||this.exception("settings",sk)}},{key:"validateNotificationData",value:function validateNotificationData(e){sy.isObject(e)||this.exception("notificationData",sk),"D1"in e&&sy.isObject(e.D1)||this.exception("notificationData.D1",sk),"D2"in e&&sy.isObject(e.D2)||this.exception("notificationData.D2",sk),"D3"in e&&sy.isObject(e.D3)||this.exception("notificationData.D3",sk),"D4"in e&&sy.isObject(e.D4)||this.exception("notificationData.D4",sk),"D5"in e&&sy.isObject(e.D5)||this.exception("notificationData.D5",sk),"D6"in e&&sy.isObject(e.D6)||this.exception("notificationData.D6",sk),"D7"in e&&sy.isObject(e.D7)||this.exception("notificationData.D7",sk)}},{key:"validateGameData",value:function validateGameData(e){sy.isObject(e)||this.exception("gameData",sk)}},{key:"validateIsFirstLogin",value:function validateIsFirstLogin(e){sy.isBoolean(e)||this.exception("isFirstLogin",sk)}},{key:"validateDailyRewarded",value:function validateDailyRewarded(e){sy.isObject(e)||this.exception("dailyRewarded",sk)}},{key:"validateLastCallSwitchGame",value:function validateLastCallSwitchGame(e){sy.isNumber(e)||this.exception("lastCallSwitchGame",sk),e<0&&this.exception("lastCallSwitchGame",sk)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Js.prototype),"toObject",this).call(this)}}]),Js}(x);sb.addDefaultData({score:sv,endlessScore:sp,settings:sg,gameData:sm,isFirstLogin:sA,dailyRewarded:sw,notificationData:sI,lastCallSwitchGame:sD});var sS=o.Utils.Valid,sP=T.data.gameData,sE=sP.level,sx=sP.coins;var sC=/*#__PURE__*/function(e){function Xs(){return _class_call_check(this,Xs),_call_super(this,Xs,arguments)}return _inherits(Xs,e),_create_class(Xs,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!sS.isNumber(e)||e<0)&&this.exception("level","is invalid")}},{key:"validateCoins",value:function validateCoins(e){(!sS.isNumber(e)||e<0)&&this.exception("coins","is invalid")}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Xs.prototype),"toObject",this).call(this)}}]),Xs}(x);sC.addDefaultData({level:sE,coins:sx});var sT=o.Utils.Valid,sL=T.data.settings,sN=sL.sound,sO=sL.music,sR=sL.vibrate,sM=sL.language,sF="is invalid";var sG=/*#__PURE__*/function(e){function Zs(){return _class_call_check(this,Zs),_call_super(this,Zs,arguments)}return _inherits(Zs,e),_create_class(Zs,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateSound",value:function validateSound(e){sT.isBoolean(e)||this.exception("sound",sF)}},{key:"validateMusic",value:function validateMusic(e){sT.isBoolean(e)||this.exception("music",sF)}},{key:"validateVibrate",value:function validateVibrate(e){sT.isBoolean(e)||this.exception("vibrate",sF)}},{key:"validateLanguage",value:function validateLanguage(e){sT.isString(e)&&e||this.exception("language",sF)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Zs.prototype),"toObject",this).call(this)}}]),Zs}(x);sG.addDefaultData({sound:sN,music:sO,vibrate:sR,language:sM}),o.Dtos.Player={Info:B,Data:sb,Settings:sG,GameData:sC};var sj=o.Configs,sB=o.Utils,sV=sB.Object,sU=sB.String,sH=sj.ApiHost,sK=sj.Mockup;var sW=/*#__PURE__*/function(){function So(){_class_call_check(this,So),h(this,"mockAPI")}return _create_class(So,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:if(e.mockAPI)return[2];return[4,u(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/ProfileAPIMock.js")];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=c.sent().default))throw new Error("Cannot load ProfileAPIMock");return e.mockAPI=new o,[2]}})})()}},{key:"getPlayersAsync",value:function getPlayersAsync(e){var t=this;return _async_to_generator(function(){var o,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(o=sU.params(e),!sK.Profile.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:return l.sent(),[4,t.mockAPI.getPlayersAsync(e)];case 2:return c=l.sent(),[3,5];case 3:return[4,ey("players?".concat(o),{},sH)];case 4:c=l.sent(),l.label=5;case 5:return[2,sV.hasOwn(c,"data")&&Array.isArray(c.data)?c.data:[]]}})})()}}]),So}();var sz={profiles:{},profileIds:[]},sq=o.Utils,sY=o.Dtos,sJ=sq.Array,sX=sq.Valid,sZ=sq.Object,sQ=sq.Function;var s$=/*#__PURE__*/function(e){function No(){var e;return _class_call_check(this,No),e=_call_super(this,No,arguments),h(e,"profileAPI",new sW),e}return _inherits(No,e),_create_class(No,[{key:"init",value:function init(){this.game.storage.addStorage("profile",sz)}},{key:"requestProfiles",value:function requestProfiles(e){var t=this;return _async_to_generator(function(){var o,c,l,u,d;return _ts_generator(this,function(f){switch(f.label){case 0:if(o=t.getProfileIds(),(c=sJ.difference(e,o)).length<1)return[2];return l=sJ.chunk(c,400).map(function(e){return t.profileAPI.getPlayersAsync({playerIds:e})}),[4,sQ.allSettled(l)];case 1:if(u=f.sent().reduce(function(e,t){return"fulfilled"===t.status?e.concat(t.value):e},[]),!t.validateProfilesResponse(u))return[2];return d=t.convertToProfiles(u),t.setProfiles(d),[2]}})})()}},{key:"getProfile",value:function getProfile(e){var t;return null!==(t=this.getProfiles()[e])&&void 0!==t?t:null}},{key:"getProfiles",value:function getProfiles(){var e;return null!==(e=this.game.storage.getStorageData("profile","profiles"))&&void 0!==e?e:sz.profiles}},{key:"setProfiles",value:function setProfiles(e){var t=this.game.storage;t.setStorageData("profile","profiles",e),t.setStorageData("profile","profileIds",Object.keys(e))}},{key:"getProfileIds",value:function getProfileIds(){var e;return null!==(e=this.game.storage.getStorageData("profile","profileIds"))&&void 0!==e?e:[]}},{key:"validateProfilesResponse",value:function validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}},{key:"convertToProfiles",value:function convertToProfiles(e){var t={};var o=true,c=false,l=void 0;try{for(var u,d=e[Symbol.iterator]();!(o=(u=d.next()).done);o=true){var f=u.value;sZ.hasOwn(f,"playerId")&&sX.isString(f.playerId)&&(t[f.playerId]=new sY.Player.Info(f).toObject())}}catch(e){c=true,l=e}finally{try{if(!o&&null!=d.return)d.return()}finally{if(c)throw l}}return t}}]),No}(c.Plugins.BasePlugin);var s0="Save The Pets",s2=o.Utils,s3=s2.Object,s1=s2.Valid,s4=s2.Browser;var s5=/*#__PURE__*/function(e){function Lo(e){var t;return _class_call_check(this,Lo),h(t=_call_super(this,Lo,[e]),"storages"),h(t,"storageLocalKeys",{}),t.storages={},t}return _inherits(Lo,e),_create_class(Lo,[{key:"addStorage",value:function addStorage(e,t,o){var c=arguments.length>2&&void 0!==o&&o;var l=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:if(l.storages[e]=t,!c)return[3,2];return[4,l.initFromWebStorage(e,t)];case 1:o.sent(),o.label=2;case 2:return[2]}})})()}},{key:"initFromWebStorage",value:function initFromWebStorage(e,t){var o=this;return _async_to_generator(function(){var c,l,u,d,f,y,p,g;return _ts_generator(this,function(m){switch(m.label){case 0:return o.storageLocalKeys[e]=!0,[4,s4.getIndexedDB("".concat(s0,"_S_").concat(e))];case 1:if(c=m.sent(),!s1.isObject(c))return[2];l=Object.keys(t),u=true,d=false,f=void 0;try{for(y=l[Symbol.iterator]();!(u=(p=y.next()).done);u=true)g=p.value,s3.hasOwn(c,g)&&_type_of(t[g])==_type_of(c[g])&&o.setStorageData(e,g,c[g])}catch(e){d=true,f=e}finally{try{if(!u&&null!=y.return)y.return()}finally{if(d)throw f}}return[2]}})})()}},{key:"initStorageData",value:function initStorageData(e,t,o){this.storages[e][t]=o}},{key:"setStorageData",value:function setStorageData(e,t,o){var c;if(s1.isObject(o)){var l=this.getStorageData(e,t);c=s3.merge(l,o)}else c=o;this.storages[e][t]=c}},{key:"getStorageData",value:function getStorageData(e,t){return this.getStorage(e)[t]}},{key:"getStorage",value:function getStorage(e){return this.storages[e]}},{key:"updateToWebStorage",value:function updateToWebStorage(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){if(t.storageLocalKeys[e])return[2,t.saveToWebStorage(e)];return[2]})})()}},{key:"saveToWebStorage",value:function saveToWebStorage(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){return o=t.getStorage(e),[2,s4.setIndexedDB("".concat(s0,"_S_").concat(e),o)]})})()}}]),Lo}(c.Plugins.BasePlugin);var s6=/*#__PURE__*/function(e){function To(){var e;return _class_call_check(this,To),e=_call_super(this,To,arguments),h(e,"isVisible",!0),h(e,"browserPrefixes",["moz","ms","o","","webkit"]),h(e,"handleVisibilityChange",function(t){if(["focus","blur"].indexOf(t)>-1)return"focus"===t?e.onVisibleEvent():e.onHiddenEvent();var o=e.getBrowserPrefix();return e.getHiddenPropertyName(o)in document?e.onHiddenEvent():e.onVisibleEvent()}),e}return _inherits(To,e),_create_class(To,[{key:"init",value:function init(){var e=this;var t=this.getBrowserPrefix(),o=[this.getVisibilityEvent(t),"focus","blur"];var c=true,l=false,u=void 0;try{for(var d,f=o[Symbol.iterator]();!(c=(d=f.next()).done);c=true)(function(){var t=d.value;window.addEventListener(t,function(){e.handleVisibilityChange(t)},!1),document.addEventListener(t,function(){e.handleVisibilityChange(t)},!1)})()}catch(e){l=true,u=e}finally{try{if(!c&&null!=f.return)f.return()}finally{if(l)throw u}}GameSDK.extra&&("onPause"in GameSDK.extra&&GameSDK.extra.onPause(function(){e.handleVisibilityChange("blur")}),"onResume"in GameSDK.extra&&GameSDK.extra.onResume(function(){e.handleVisibilityChange("focus")}))}},{key:"isGameVisible",value:function isGameVisible(){return this.isVisible}},{key:"getHiddenPropertyName",value:function getHiddenPropertyName(e){return e?"".concat(e,"Hidden"):"hidden"}},{key:"getVisibilityEvent",value:function getVisibilityEvent(e){return"".concat(e||"","visibilitychange")}},{key:"getBrowserPrefix",value:function getBrowserPrefix(){var e=true,t=false,o=void 0;try{for(var c,l=this.browserPrefixes[Symbol.iterator]();!(e=(c=l.next()).done);e=true){var u=c.value;if(this.getHiddenPropertyName(u)in document)return u}}catch(e){t=true,o=e}finally{try{if(!e&&null!=l.return)l.return()}finally{if(t)throw o}}return""}},{key:"onVisibleEvent",value:function onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(o.Events.VISIBILITY_VISIBLE))}},{key:"onHiddenEvent",value:function onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(o.Events.VISIBILITY_HIDDEN))}}]),To}(c.Plugins.BasePlugin);var s7=o.Utils.Array,s8={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed"},s9={NOT_STARTED:"not-started",IN_PROGRESS:"in-progress",COMPLETED:"completed",FAILED:"failed"},ie=["next","preroll","browse","pause","start"],it=["reward"];var ia=/*#__PURE__*/function(){function j(){_class_call_check(this,j)}return _create_class(j,null,[{key:"initStatus",get:function get(){return this._initStatus},set:function set(e){var t,o;this._initStatus!==e&&(null==(o=null==(t=this.game)?void 0:t.analytics)||o.initAdEvent({adService:"adsense",state:e}),this._initStatus=e)}},{key:"getRewardedVideoAsync",value:function getRewardedVideoAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.ensureInitialized()];case 1:return[2,(o.sent(),t.createAdInstance(t.rewardedType,e))]}})})()}},{key:"getInterstitialAdAsync",value:function getInterstitialAdAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.ensureInitialized()];case 1:return[2,(o.sent(),t.createAdInstance(t.interstitialType,e))]}})})()}},{key:"getRewardedInterstitialAsync",value:function getRewardedInterstitialAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return[4,t.ensureInitialized()];case 1:return[2,(o.sent(),t.createAdInstance(t.rewardedType,e))]}})})()}},{key:"setGame",value:function setGame(e){this.game=e}},{key:"setRewardType",value:function setRewardType(e){s7.has(it,e)&&(this.rewardedType=e)}},{key:"setInterstitialType",value:function setInterstitialType(e){s7.has(ie,e)&&(this.interstitialType=e)}},{key:"initAsync",value:function initAsync(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:switch(c.trys.push([0,2,,3]),t.initStatus){case s8.LOADED:return[2];case s8.LOADING:return[2]}if(!t.validateConfig(e))throw new Error("Invalid Google Ads configuration");return t.initStatus=s8.LOADING,t.config=e,[4,t.loadScriptElementAsync()];case 1:return c.sent(),[3,3];case 2:throw o=c.sent(),t.initStatus=s8.FAILED,o;case 3:return[2]}})})()}},{key:"validateConfig",value:function validateConfig(e){if(!e)return!1;var t=e.dataAdClient,o=e.dataAdHost;if(!t&&!o)return!1;if(e.dataAdFrequencyHint){var c=Number(e.dataAdFrequencyHint);if(isNaN(c)||c<=0)return!1}return!0}},{key:"loadScriptElementAsync",value:function loadScriptElementAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,e.injectMainScript()];case 1:return t.sent(),[4,e.configureGoogleAds()];case 2:return t.sent(),[3,4];case 3:throw t.sent();case 4:return[2]}})})()}},{key:"injectMainScript",value:function injectMainScript(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return[2,new Promise(function(t,o){try{var c=document.createElement("script");e.configureScriptAttributes(c),c.onload=function(){e.initStatus=s8.LOADED,t()},c.onerror=function(t){e.initStatus=s8.FAILED,o(new Error("Failed to load Google Ads script: ".concat(t)))},document.head.appendChild(c)}catch(e){o(e)}})]})})()}},{key:"configureGoogleAds",value:function configureGoogleAds(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(t.trys.push([0,3,,4]),window.adsbygoogle=window.adsbygoogle||[],window.adBreak=function(e){return adsbygoogle.push(e)},window.adConfig=function(e){return adsbygoogle.push(e)},!e.config.usePreload)return[3,2];return[4,e.preloadAdConfig()];case 1:t.sent(),t.label=2;case 2:return[3,4];case 3:throw t.sent();case 4:return[2]}})})()}},{key:"configureScriptAttributes",value:function configureScriptAttributes(e){var t=this.config,o=t.dataAdClient,c=t.dataAdHost,l=t.dataAdChannel,u=t.dataAdBreakTest,d=t.dataAdFrequencyHint;e.async=!0,e.crossOrigin="anonymous";var f="";d&&e.setAttribute("data-ad-frequency-hint","".concat(d,"s")),o&&(e.setAttribute("data-ad-client",o),f+="?client=".concat(o)),l&&e.setAttribute("data-ad-channel",l),c&&(e.setAttribute("data-ad-host",c),f+="&host=".concat(c)),u&&e.setAttribute("data-adbreak-test","on"),e.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js".concat(f)}},{key:"ensureInitialized",value:function ensureInitialized(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(e.initStatus!==s8.LOADED)throw new Error("Google Ads not initialized. Call initAsync first.");return[4,e.ensurePreloaded()];case 1:return t.sent(),[2]}})})()}},{key:"ensurePreloaded",value:function ensurePreloaded(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(!(e.preloadStatus!==s9.COMPLETED))return[3,2];return[4,e.preloadAdPlacement()];case 1:t.sent(),t.label=2;case 2:return[2]}})})()}},{key:"createAdInstance",value:function createAdInstance(e,t){var o=this;return{getPlacementID:function(){return t},loadAsync:function(){return o.preloadAdPlacement()},showAsync:function(){return o.showAd(e,t)},hideAsync:function(){return Promise.resolve()}}}},{key:"showAd",value:function showAd(e,t){var o=this;return _async_to_generator(function(){return _ts_generator(this,function(c){return[2,new Promise(function(c,l){try{var u=o.createAdBreakConfig({type:e,placementId:t,resolve:c,reject:l});window.adBreak(u)}catch(e){l(e)}})]})})()}},{key:"createAdBreakConfig",value:function createAdBreakConfig(e){var t=this.createBaseAdBreakConfig({placementId:e.placementId}),o=e.type;if(s7.has(ie,o))return this.createInterstitialAdBreakConfig(t,e);if(s7.has(it,o))return this.createRewardAdBreakConfig(t,e);throw new Error("Ad type: ".concat(o," is not supported."))}},{key:"createBaseAdBreakConfig",value:function createBaseAdBreakConfig(e){return{name:e.placementId,beforeAd:function(){},adBreakDone:function(e){}}}},{key:"createInterstitialAdBreakConfig",value:function createInterstitialAdBreakConfig(e,t){var o=this;var c=t.resolve,l=t.reject;return _object_spread_props(_object_spread({},e),{type:this.interstitialType,adBreakDone:function(t){var u;null==(u=e.adBreakDone)||u.call(e,t),o.handleAdBreakDone({info:t,resolve:c,reject:l})}})}},{key:"createRewardAdBreakConfig",value:function createRewardAdBreakConfig(e,t){var o=t.resolve,c=t.reject;return _object_spread_props(_object_spread({},e),{type:this.rewardedType,beforeReward:function(e){e()},adDismissed:function(){c(new Error("USER_INPUT"))},adViewed:function(){o()}})}},{key:"handleAdBreakDone",value:function handleAdBreakDone(e){var t=e.info,o=e.resolve,c=e.reject;switch(t.breakStatus){case"viewed":o();break;case"frequencyCapped":c(new Error("AD_FREQUENCY_CAPPED"));break;default:c(new Error(t.breakStatus))}}},{key:"preloadAdPlacement",value:function preloadAdPlacement(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return[2,e.initStatus!==s8.LOADED?Promise.reject(new Error("Google Ads not initiated.")):e.preloadAdConfig()]})})()}},{key:"getInitStatus",value:function getInitStatus(){return this.initStatus}},{key:"getPreloadStatus",value:function getPreloadStatus(){return this.preloadStatus}},{key:"preloadAdConfig",value:function preloadAdConfig(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){if(e.preloadStatus!==s9.COMPLETED&&e.preloadStatus!==s9.IN_PROGRESS)return[2,(e.preloadStatus=s9.IN_PROGRESS,new Promise(function(t,o){var c=setTimeout(function(){e.preloadStatus===s9.IN_PROGRESS&&(e.preloadStatus=s9.FAILED,o(new Error("Failed to preload ad config in time.")))},5e3);window.adConfig({preloadAdBreaks:"on",onReady:function(){clearTimeout(c),e.preloadStatus=s9.COMPLETED,t()}})}))];return[2]})})()}}]),j}();h(ia,"game"),h(ia,"_initStatus",s8.IDLE),h(ia,"preloadStatus",s9.NOT_STARTED),h(ia,"config"),h(ia,"rewardedType","reward"),h(ia,"interstitialType","next"),window.GoogleAds=ia;var io=o.Utils.Object,ic=o.Plugins.Ads,il=ic.Status,iu=ic.Types,id=ic.AdError;var ih=/*#__PURE__*/function(e){function la(e,t){var o;return _class_call_check(this,la),h(o=_call_super(this,la,[e,t]),"service"),h(o,"instance"),h(o,"instanceQueue",[]),o.service=GameSDK.getSDKName(),o.instance=null,o}return _inherits(la,e),_create_class(la,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:if(!!(e.instance&&e.status===il.FILLED))return[3,5];if(e.status!==il.IDLE)throw new id("AD_NOT_READY","Ad is not ready.");o.label=1;case 1:return o.trys.push([1,4,,5]),[4,e.createInstanceByType(e.type)];case 2:if(e.instance=o.sent(),null===e.instance)throw new id("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");return e.setStatus(il.LOADING),[4,e.instance.loadAsync()];case 3:return o.sent(),e.setStatus(il.FILLED),e.logAdLoad(),[3,5];case 4:throw t=o.sent(),e.setStatus(il.IDLE),_instanceof(t,Object)&&"code"in t&&"INVALID_PARAM"===t.code&&(e.instance=null),e.instance&&e.pushInstanceToQueue(e.instance),self.game.analytics.loadAdFail({type:e.type,service:e.service}),t;case 5:return[2]}})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){var t,o;return _ts_generator(this,function(c){switch(c.label){case 0:if(e.status!==il.FILLED)throw new id("AD_NOT_FILLED","Ad is not filled.");if(null===e.instance)throw new id("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");t=!1,c.label=1;case 1:return c.trys.push([1,3,4,5]),e.setStatus(il.SHOWING),self.game.analytics.showingAd({type:e.type,service:e.service}),[4,e.instance.showAsync()];case 2:return c.sent(),t=!0,e.setStatus(il.IDLE),e.instance=null,[3,5];case 3:throw o=c.sent(),io.hasOwn(o,"code")&&("AD_NOT_LOADED"===o.code&&e.setStatus(il.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf("".concat(o.code))>-1&&(e.setStatus(il.IDLE),e.instance=null),"USER_INPUT"===o.code&&(t=!0)),e.status===il.SHOWING&&(e.setStatus(il.IDLE),e.instance=null),o;case 4:return t?e.logAdShown():self.game.analytics.showAdFail({type:e.type,service:e.service}),[7];case 5:return[2]}})})()}},{key:"createInstanceByType",value:function createInstanceByType(e){var t=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,t.getAdInstanceByType(e)];case 1:return[2,c.sent()];case 2:return o=c.sent(),[2,io.hasOwn(o,"code")&&"ADS_TOO_MANY_INSTANCES"===o.code?t.getAdInstanceFailed():null];case 3:return[2]}})})()}},{key:"getAdInstanceByType",value:function getAdInstanceByType(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:switch(e){case iu.REWARDED_VIDEO:return[3,1];case iu.INTERSTITIAL:return[3,3];case iu.REWARDED_INTERSTITIAL:return[3,5]}return[3,7];case 1:return[4,GameSDK.getRewardedVideoAsync(t.placementId)];case 2:return[2,o.sent()];case 3:return[4,GameSDK.getInterstitialAdAsync(t.placementId)];case 4:return[2,o.sent()];case 5:return[4,GameSDK.getRewardedInterstitialAsync(t.placementId)];case 6:return[2,o.sent()];case 7:return[2,null];case 8:return[2]}})})()}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(){if(!("canBeLoadedAd"in GameSDK.extra))return this.instanceQueue.shift()||null;var e=true,t=false,o=void 0;try{for(var c,l=this.instanceQueue[Symbol.iterator]();!(e=(c=l.next()).done);e=true){var u=c.value;if(GameSDK.extra.canBeLoadedAd(u))return this.instanceQueue.splice(this.instanceQueue.indexOf(u),1),u}}catch(e){t=true,o=e}finally{try{if(!e&&null!=l.return)l.return()}finally{if(t)throw o}}return null}},{key:"logAdLoad",value:function logAdLoad(){switch(this.type){case iu.INTERSTITIAL:self.game.analytics.loadInterstitialAd({service:this.service});break;case iu.REWARDED_VIDEO:self.game.analytics.loadRewardedVideoAd({service:this.service});break;case iu.REWARDED_INTERSTITIAL:self.game.analytics.loadRewardedInterstitialAd({service:this.service});break}}},{key:"logAdShown",value:function logAdShown(){switch(this.type){case iu.INTERSTITIAL:self.game.analytics.showInterstitialAd({service:this.service});break;case iu.REWARDED_VIDEO:self.game.analytics.showRewardedVideoAd({service:this.service});break;case iu.REWARDED_INTERSTITIAL:self.game.analytics.showRewardedInterstitialAd({service:this.service});break}}},{key:"pushInstanceToQueue",value:function pushInstanceToQueue(e){this.instanceQueue.push(e)}}]),la}(ic.AdInstance);var iy=o.Plugins.Ads.Types;var i_=/*#__PURE__*/function(e){function Mo(e,t){var o;return _class_call_check(this,Mo),(o=_call_super(this,Mo,[e,t])).service="adsense",o}return _inherits(Mo,e),_create_class(Mo,[{key:"createInstanceByType",value:function createInstanceByType(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:switch(o.trys.push([0,9,,10]),e){case iy.REWARDED_VIDEO:return[3,1];case iy.INTERSTITIAL:return[3,3];case iy.REWARDED_INTERSTITIAL:return[3,5]}return[3,7];case 1:return[4,ia.getRewardedVideoAsync(t.placementId)];case 2:return[2,o.sent()];case 3:return[4,ia.getInterstitialAdAsync(t.placementId)];case 4:return[2,o.sent()];case 5:return[4,ia.getRewardedInterstitialAsync(t.placementId)];case 6:return[2,o.sent()];case 7:return[2,null];case 8:return[3,10];case 9:return o.sent(),[2,null];case 10:return[2]}})})()}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(){return null}}]),Mo}(ih);var iv=/*#__PURE__*/function(e){function Ro(){return _class_call_check(this,Ro),_call_super(this,Ro,arguments)}return _inherits(Ro,e),_create_class(Ro,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return e.exception("Unsupported method"),[2]})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return e.exception("This method is not implemented"),[2]})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){return e.exception("This method is not implemented"),[2]})})()}}]),Ro}(eI);var ip=o.Plugins.Ads.Status;var ig=/*#__PURE__*/function(e){function Fo(){return _class_call_check(this,Fo),_call_super(this,Fo,arguments)}return _inherits(Fo,e),_create_class(Fo,[{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.loadBannerAdAsync(e.placementId)];case 1:return t.sent(),e.setStatus(ip.SHOWING),[2]}})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.hideBannerAdAsync(e.placementId)];case 1:return t.sent(),e.setStatus(ip.IDLE),[2]}})})()}}]),Fo}(iv);var im=Object.defineProperty,iA=Object.getOwnPropertyDescriptor,Wt=function(e,t,o,c){for(var l,u=iA(t,o),d=e.length-1;d>=0;d--)(l=e[d])&&(u=l(t,o,u)||u);return u&&im(t,o,u),u};var iw=o.Plugins.Analytics,iI=iw.BaseAnalytics,iD=iw.Events,ik=o.Events,ib=ik.VISIBILITY_HIDDEN,iS=ik.VISIBILITY_VISIBLE,iP=o.Utils,iE=iP.Array,ix=iP.Object,iC=iP.Image,iT=iP.Decorator,iL=o.Configs.Analytics.ClarityAnalytics,iN=ix.invert(iD),iO=[iD.SCREEN_OPEN];var iR=/*#__PURE__*/function(e){function rt(e,t){var o;return _class_call_check(this,rt),h(o=_call_super(this,rt,[e,"ClarityAnalytics",_object_spread_props(_object_spread({},t),{color:"#9692FF"})]),"image"),h(o,"screenshotCount",4),h(o,"isCapturing",!1),h(o,"isScreenshotByEvent",!1),h(o,"handleVisibilityHidden",function(){var e;null==(e=o.clarity)||e.call(o,"set","Visibility","hidden")}),h(o,"handleVisibilityVisible",function(){var e;null==(e=o.clarity)||e.call(o,"set","Visibility","visible")}),h(o,"makeScreenshotByEvent",/*#__PURE__*/function(){var e=_async_to_generator(function(e){var t,c;var l=arguments;return _ts_generator(this,function(u){switch(u.label){case 0:if(t=l.length>1&&void 0!==l[1]?l[1]:0,!o.game.canvasRecorder||!o.isScreenshotByEvent||!ix.hasOwn(iN,e))return[2];if(c=iN[e],!iE.has(iL.ScreenshotCanvas.ByEvent,c))return[3,2];return[4,o.setScreenshotToHtml()];case 1:u.sent(),t<o.screenshotCount&&setTimeout(function(){return o.makeScreenshotByEvent(e,t+1)},300),u.label=2;case 2:return[2]}})});return function(t){return e.apply(this,arguments)}}()),h(o,"setScreenshotToHtml",/*#__PURE__*/_async_to_generator(function(){var e;return _ts_generator(this,function(t){switch(t.label){case 0:if(t.trys.push([0,,2,3]),o.isCapturing||(o.isCapturing=!0,!o.image))return[2];return[4,o.captureScreenshot()];case 1:if(!(e=t.sent()))return[2];return o.image.src=e,[3,3];case 2:return o.isCapturing=!1,[7];case 3:return[2]}})})),o.setupScreenshots(),o.listenVisibilityEvents(),o}return _inherits(rt,e),_create_class(rt,[{key:"clarity",get:function get(){return ix.hasOwn(window,"clarity")?window.clarity:null}},{key:"setUser",value:function setUser(e){var t;null==(t=this.clarity)||t.call(this,"identify",e)}},{key:"listenVisibilityEvents",value:function listenVisibilityEvents(){this.game.event.on(ib,this.handleVisibilityHidden),this.game.event.on(iS,this.handleVisibilityVisible)}},{key:"processEvent",value:function processEvent(e,t){var o;this.setTagByEvent(e,t),this.makeScreenshotByEvent(e),iE.has(iO,e)||null==(o=this.clarity)||o.call(this,"event",e,t)}},{key:"setTagByEvent",value:function setTagByEvent(e,t){if(t)switch(e){case iD.PAGE_VIEW:case iD.SCREEN_OPEN:this.setPageTag(t);break;case iD.AD_SHOWING:this.setAdTag(t);break;case iD.BUTTON_CLICK:this.setButtonTag(t);break;case iD.TUTORIAL_STEP:this.setTutorialTag(t);break;case iD.LEVEL_START:this.setLevelTag(t);break;case iD.USE_ITEM:this.setItemTag(t);break}}},{key:"setPageTag",value:function setPageTag(e){var t;if(!e.page_title&&!e.path_path)return;var o=e.page_title||e.path_path;o&&(null==(t=this.clarity)||t.call(this,"set","Page",o))}},{key:"setAdTag",value:function setAdTag(e){var t;if(!e.ad_type||!e.ad_service)return;var o="".concat(e.ad_type,":").concat(e.ad_service);null==(t=this.clarity)||t.call(this,"set","Ad",o)}},{key:"setButtonTag",value:function setButtonTag(e){var t;if(!e.button_name||!e.screen_name)return;var o="".concat(e.button_name,":").concat(e.screen_name);null==(t=this.clarity)||t.call(this,"set","Button",o)}},{key:"setTutorialTag",value:function setTutorialTag(e){var t;if(!e.step)return;var o=e.step.toString();null==(t=this.clarity)||t.call(this,"set","Tutorial",o)}},{key:"setLevelTag",value:function setLevelTag(e){var t;if(!e.level_name||!e.game_mode)return;var o="".concat(e.game_mode,":").concat(e.level_name);null==(t=this.clarity)||t.call(this,"set","Level",o)}},{key:"setItemTag",value:function setItemTag(e){var t;e.item_name&&(null==(t=this.clarity)||t.call(this,"set","Item",e.item_name))}},{key:"setupScreenshots",value:function setupScreenshots(){if(("undefined"==typeof FileReader?"undefined":_type_of(FileReader))>"u")return;this.initImage();var e=iL.ScreenshotCanvas,t=e.ByEvent,o=e.Interval;if(t.length>0){this.isScreenshotByEvent=!0;return}setInterval(this.setScreenshotToHtml,o)}},{key:"initImage",value:function initImage(){if(this.image)return;var e=document.getElementById("Cocos3dGameContainer");e&&(this.image=document.createElement("img"),this.image.id="clarity-screenshot",this.image.setAttribute("data-clarity-unmask","true"),ix.assign(this.image.style,{position:"absolute",display:"flex",width:"100%",top:0,left:0,pointerEvents:"none"}),e.insertBefore(this.image,e.firstChild))}},{key:"captureScreenshot",value:function captureScreenshot(){var e=this;return _async_to_generator(function(){var t,o;return _ts_generator(this,function(c){switch(c.label){case 0:if(!e.game.canvasRecorder)return[2,null];return[4,e.game.canvasRecorder.snapshotFrameAsync({force:!0,type:"jpeg",quality:.1,resolution:.5})];case 1:if(t=c.sent(),e.game.canvasRecorder.waitNextFrame(),!t)return[3,3];return[4,iC.blobToDataImage(t)];case 2:return o=c.sent(),[3,4];case 3:o=null,c.label=4;case 4:return[2,o]}})})()}}]),rt}(iI);Wt([iT.tryCatch()],iR.prototype,"setupScreenshots"),Wt([iT.tryCatch()],iR.prototype,"initImage"),Wt([iT.tryCatch()],iR.prototype,"captureScreenshot");var iM=o.Plugins.Analytics,iF=iM.BaseAnalytics,iG=iM.Events,ij=[iG.BUTTON_CLICK,iG.SCREEN_OPEN],iB=o.Utils.Array;var iV=/*#__PURE__*/function(e){function qo(e,t){var o;return _class_call_check(this,qo),h(o=_call_super(this,qo,[e,"FacebookAnalytics",_object_spread_props(_object_spread({},t),{color:"#0F52BA"})]),"prefix"),o.prefix=t.prefix,o}return _inherits(qo,e),_create_class(qo,[{key:"processEvent",value:function processEvent(e,t){if(!("logEvent"in GameSDK.extra)||iB.has(ij,e))return;var o=this.addPrefixToEventName(e);GameSDK.extra.logEvent(o,1,t)}},{key:"addPrefixToEventName",value:function addPrefixToEventName(e){return"".concat(this.prefix,"_").concat(e)}}]),qo}(iF);var iU=o.Plugins.Analytics,iH=iU.BaseAnalytics,iK=[iU.Events.SCREEN_OPEN],iW=o.Utils.Array;var iz=/*#__PURE__*/function(e){function Xo(e,t){return _class_call_check(this,Xo),_call_super(this,Xo,[e,"FirebaseAnalytics",_object_spread_props(_object_spread({},t),{color:"#FFCA28"})])}return _inherits(Xo,e),_create_class(Xo,[{key:"setUser",value:function setUser(e,t){var o,c;null==(c=null==(o=this.game.firebase)?void 0:o.services.analytics)||c.setUser(e,t)}},{key:"processEvent",value:function processEvent(e,t){var o,c;iW.has(iK,e)||null==(c=null==(o=this.game.firebase)?void 0:o.services.analytics)||c.event(e,t)}}]),Xo}(iH);var iq=o.Plugins.Analytics,iY=iq.BaseAnalytics,iJ=iq.Events,iX=[iJ.SCREEN_OPEN],iZ=o.Utils.Array;var iQ=/*#__PURE__*/function(e){function sc(e,t){return _class_call_check(this,sc),_call_super(this,sc,[e,"GoogleAnalytics",_object_spread_props(_object_spread({},t),{color:"#E35335"})])}return _inherits(sc,e),_create_class(sc,[{key:"processEvent",value:function processEvent(e,t){iZ.has(iX,e)||(this.customEvent(e,t),gtag("event",e,t))}},{key:"customEvent",value:function customEvent(e,t){switch(e){case iJ.AD_SHOW:case iJ.AD_SHOW_FAILED:case iJ.AD_SHOWING:case iJ.USE_ITEM:case iJ.EARN_ITEM:this.addLevelName(t);break}}},{key:"addLevelName",value:function addLevelName(e){if(!e||!(null!=game&&game.match))return;var t=game.match.getMatchState().customData.level;t<0||(e.level_name=this.getLevelName(t))}}]),sc}(iY);var i$=o.Plugins.Analytics,i0=i$.BaseAnalytics,i2=i$.Events,i3=[i2.LEVEL_START,i2.LEVEL_END],i1=o.Utils.Array;var i4=/*#__PURE__*/function(e){function rc(e){return _class_call_check(this,rc),_call_super(this,rc,[e,"YandexAnalytics",{color:"#FFB02E"}])}return _inherits(rc,e),_create_class(rc,[{key:"processEvent",value:function processEvent(e){"logEvent"in GameSDK.extra&&i1.has(i3,e)&&GameSDK.extra.logEvent(e)}}]),rc}(i0);var i5=o.Dtos,i6=o.Events,i7=o.Configs,i8=i7.AppId,i9=i7.Ads,oe=i7.Analytics,ot=i7.AdaptivePerformance,oa=i7.Debugger,oi=i7.Firebase,oo=i7.Notification,oc=i7.RemoteConfig,ol=i7.PerformanceMonitor,ou=o.Plugins.Ads.Types,od=o.Utils,oh=od.Device,of=od.Object,oy=od.Json,o_=od.String,ov=od.Valid,op=od.Mark;var og=/*#__PURE__*/function(e){function yc(){var e;return _class_call_check(this,yc),e=_call_super(this,yc,arguments),h(e,"markName","Core Initialize"),h(e,"modulePlugins",[]),h(e,"processContextSession",/*#__PURE__*/_async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return op.putAttr(e.markName,"Step","Process Context Payload"),[4,e.context.detectContextSessionType()];case 1:return o.sent(),e.context.detectContextGameMode(),t=e.storage.getStorageData("context","sessionContextType")||"unknown",op.putAttr(e.markName,"Context Mode",t),op.stop(e.markName),[2]}})})),h(e,"addDevPlugins",function(){var t;var o=oa.ListPlayerDevIds,c=null==(t=null==GameSDK?void 0:GameSDK.player)?void 0:t.getID();!c||o.indexOf(c)<0||(e.addConsolePlugin(),e.addProfilerPlugin())}),h(e,"handleProtectGameInstance",function(){e.event.getEventEmitCount(f.MODULE_PLUGIN_READY)<e.modulePlugins.length||(window.game=Object.freeze(window.game),y(window,"game"))}),h(e,"initCanvasRecorderPlugin",function(){if(!e.canvasRecorder)return;var t=oa.CanvasRecorder,o=t.Options,c=o.Type,l=o.Quality,u=o.RecordFps,d=o.SyncFps;e.canvasRecorder.configure({type:c,quality:l,syncFps:d,recordFps:u}),e.canvasRecorder.setPanelExpanded(t.PanelExpanded);var f=document.querySelector("canvas");f&&e.canvasRecorder.setCanvas(f)}),h(e,"initMonitorErrorPlugin",function(){var t;if(!e.monitorError)return;var o=oa.MonitorError,c=oa.ListPlayerDevIds,l=o.ApiKey,u=o.Service,d=o.Feedback,f=o.TrackUser,y=o.FilterErrors,p=GameSDK.player.getID(),g=GameSDK.player.getName();p&&c.indexOf(p)>=0||(null==(t=window.disableSimpleTrackErrors)||t.call(window),e.monitorError.configure({apiKey:l,service:u,feedback:d,trackUser:f,releaseStage:"production",buildVersion:"".concat("24")}),e.monitorError.setUser({id:p,name:g}),e.monitorError.addFilterErrors(y),e.monitorError.initFeedbackTrackErrors(),e.updateMonitorErrorUserAndMetadata(),e.processErrorsQueue())}),h(e,"updateMonitorErrorUserAndMetadata",function(){e.event.catchUp(i6.PLAYER_INFO_LOADED,e.processWhenPlayerInfoLoaded)}),h(e,"processErrorsQueue",function(){if(e.monitorError&&window.__errorQueue){var t=true,o=false,c=void 0;try{for(var l,u=window.__errorQueue[Symbol.iterator]();!(t=(l=u.next()).done);t=true){var d=l.value;if(_instanceof(d,Error))e.monitorError.sendException(d);else{var f=d||{message:"",code:"Unknown",stack:"Unknown stack"},y=f.message,p=f.code,g=f.stack,m=new Error(y||p);m.stack=g,e.monitorError.sendException(m)}}}catch(e){o=true,c=e}finally{try{if(!t&&null!=u.return)u.return()}finally{if(o)throw c}}window.__errorQueue=null}}),h(e,"processWhenPlayerInfoLoaded",function(){if(!e.monitorError)return;var t=e.player.getPlayer(),o=t.playerId,c=t.name;e.monitorError.setUser({id:o,name:c}),e.monitorError.addMetadata({isFirstLogin:e.player.isFirstLogin()})}),h(e,"handleSaveRemoteConfig",function(t){try{var o=_define_property({},t.type,t);e.player.setPlayerDataByName("remoteConfig",o)}catch(e){}}),h(e,"handleUpdateGameCoreConfig",function(t){try{var c=t.id,l=t.type;if("GameCore"!==l)return;o.Configs=of.merge(o.Configs,t.config);var u=o.Configs.Ads;e.ads.configure(u),e.event.emit(f.REMOTE_CONFIG_UPDATED,{id:c,type:l})}catch(e){}}),h(e,"handleStorageCurrentRemoteConfig",function(){var t=e.player.getPlayerDataByKey("remoteConfig");if(t){for(var o in t)if(of.hasOwn(t,o)){var c=t[o],l=oy.clone(c),u=new i5.RemoteConfig.Data(l).toObject();e.remoteConfig.setRemoteConfig(u),e.remoteConfig.processUpdateConfig(u.id,u.type)}}}),h(e,"initAdaptivePerformancePlugin",function(){if(!e.adaptivePerformance)return;var t=oy.clone(ot);e.adaptivePerformance.configure(t)}),h(e,"processAfterSyncProfile",function(){oo.Enabled&&e.updatePlayerProfileToNotificationService()}),e}return _inherits(yc,e),_create_class(yc,[{key:"getBuildVersion",value:function getBuildVersion(){return parseInt("".concat("24"))||0}},{key:"boot",value:function boot(){var e=this;var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){return(function(){return _get(_get_prototype_of(yc.prototype),"boot",e)})().call(t),t.addPlugins(),t.initEventPlugin(),t.event.emit(i6.CORE_BOOTING),t.initFirebasePlugin(),t.initMarkCoreInitialize(),op.putAttr(t.markName,"Step","Init Analytics"),t.initGoogleAnalytics(),t.initClarityAnalytics(),t.initFirebaseAnalytics(),t.initYandexAnalytics(),t.initFacebookAnalytics(),op.putAttr(t.markName,"Step","Init Plugins"),t.initAds(),t.initMatchPlugin(),t.initRemoteConfig(),op.putAttr(t.markName,"Step","Load Lazy Plugins"),ov.isDebugger()||t.event.on(i6.MODULE_PLUGIN_READY,t.handleProtectGameInstance),t.addMonitorPlugin().then(t.initMonitorErrorPlugin),t.addCanvasRecorderPlugin().then(t.initCanvasRecorderPlugin),t.addAdaptivePerformancePlugin().then(t.initAdaptivePerformancePlugin),op.putAttr(t.markName,"Step","Load Dev Plugins"),t.event.catchUp(i6.GAME_SDK_READY,t.addDevPlugins),[2]})})()}},{key:"start",value:function start(){var e=this;var t=this;return _async_to_generator(function(){return _ts_generator(this,function(o){switch(o.label){case 0:return(function(){return _get(_get_prototype_of(yc.prototype),"start",e)})().call(t),op.putAttr(t.markName,"Step","Core Start"),t.event.emit(i6.CORE_STARTING),op.putAttr(t.markName,"Step","Request Token"),[4,t.auth.requestToken()];case 1:return o.sent(),op.putAttr(t.markName,"Step","Init States"),[4,t.initState()];case 2:if(o.sent(),op.putAttr(t.markName,"Step","Process Player Profile"),t.processPlayerProfile(),!("FacebookInstant"===GameSDK.getSDKName()&&oh.isIOS()))return[3,3];return t.event.catchUp(i6.GAME_SDK_STARTED,t.processContextSession),[3,5];case 3:return[4,t.processContextSession()];case 4:o.sent(),o.label=5;case 5:return op.putAttr(t.markName,"Step","Core Ready"),op.putAttr(t.markName,"Success","true"),t.event.emit(i6.CORE_READY),[2]}})})()}},{key:"addPlugins",value:function addPlugins(){this.installPlugin("Storage",s5),this.installPlugin("Event",tP),this.installPlugin("Ads",eS),this.installPlugin("Auth",eY),this.installPlugin("Audio",eW),this.installPlugin("Match",r1),this.installPlugin("Player",sh),this.installPlugin("Profile",s$),this.installPlugin("Context",tt),this.installPlugin("Language",t6),this.installPlugin("Analytics",eM),this.installPlugin("Visibility",s6),this.installPlugin("Leaderboard",av),this.installPlugin("DailyRewards",tI),this.installPlugin("FrameCapture",tQ),this.installPlugin("RemoteConfig",g),"Proxy"in window&&this.installPlugin("Firebase",g)}},{key:"installPlugin",value:function installPlugin(e,t,o){var c=arguments.length>2&&void 0!==o&&o;var l=o_.toCamelCase(o_.capitalize(e));this.plugins.install(e,t,!0,l),"Storage"!==e&&(c?this.emitModulePluginReady(e):this.emitCorePluginReady(e))}},{key:"addMonitorPlugin",value:function addMonitorPlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!oa.MonitorError.Enabled)return[2];return e.modulePlugins.push("MonitorError"),[4,u(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/monitor-error.js").then(function(e){return e.i})];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=c.sent().default))return[2];return e.installPlugin("MonitorError",o,!0),[3,3];case 2:return c.sent(),[3,3];case 3:return[2]}})})()}},{key:"addCanvasRecorderPlugin",value:function addCanvasRecorderPlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!oa.CanvasRecorder.Enabled)return[2];return e.modulePlugins.push("CanvasRecorder"),[4,u(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/canvas-recorder.js").then(function(e){return e.i})];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=c.sent().default))throw new Error("CanvasRecorderPlugin is not a function");return e.installPlugin("CanvasRecorder",o,!0),[3,3];case 2:return c.sent(),[3,3];case 3:return[2]}})})()}},{key:"addAdaptivePerformancePlugin",value:function addAdaptivePerformancePlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!ot.Enabled)return[2];return e.modulePlugins.push("AdaptivePerformance"),[4,u(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/index.js")];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=c.sent().default))return[2];return e.installPlugin("AdaptivePerformance",o,!0),[3,3];case 2:return c.sent(),[3,3];case 3:return[2]}})})()}},{key:"addConsolePlugin",value:function addConsolePlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!oa.Console.Enabled)return[2];return e.modulePlugins.push("Console"),[4,u(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/canvas-recorder.js").then(function(e){return e.e})];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=c.sent().default))throw new Error("ConsolePlugin is not a function");return e.installPlugin("Console",o,!0),e.initConsolePlugin(),[3,3];case 2:return c.sent(),[3,3];case 3:return[2]}})})()}},{key:"addProfilerPlugin",value:function addProfilerPlugin(){var e=this;return _async_to_generator(function(){var o;return _ts_generator(this,function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),!oa.Profiler.Enabled)return[2];return e.modulePlugins.push("Profiler"),[4,u(/*#__PURE__*/_async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,t.import("./bundle/canvas-recorder.js").then(function(e){return e.e})];case 1:return[2,{default:e.sent().default}]}})}),void 0,t.meta.url)];case 1:if("function"!=typeof(o=c.sent().default))throw new Error("ProfilerPlugin is not a function");return e.installPlugin("Profiler",o,!0),e.initProfilerPlugin(),[3,3];case 2:return c.sent(),[3,3];case 3:return[2]}})})()}},{key:"emitCorePluginReady",value:function emitCorePluginReady(e){this.event.emit(f.CORE_PLUGIN_READY,{name:e})}},{key:"emitModulePluginReady",value:function emitModulePluginReady(e){this.event.emit(f.MODULE_PLUGIN_READY,{name:e})}},{key:"initEventPlugin",value:function initEventPlugin(){oa.EventLogging.Enabled&&this.event.enableLogEvent()}},{key:"initMatchPlugin",value:function initMatchPlugin(){this.match.setUseCPUProfile(!1)}},{key:"initAds",value:function initAds(){this.ads.configure(i9),this.initGoogleAds(),this.initAdInstance(),i9.Enabled&&this.analytics.initAdEvent({adService:"platform",state:"loaded"})}},{key:"initGoogleAds",value:function initGoogleAds(){var e=this;return _async_to_generator(function(){var t,o,c,l,u,d,f,y;return _ts_generator(this,function(p){switch(p.label){case 0:if(p.trys.push([0,2,,3]),!i9.Enabled)return[2];if(o=(t=i9.AdServiceConfigs.AdSense).Enabled,c=t.UsePreload,l=t.DataAdBreakTest,u=t.DataAdClient,d=t.DataAdChannel,f=t.DataAdFrequencyHint,y=t.DataAdHost,!o)return[2];return ia.setGame(e),[4,ia.initAsync({usePreload:c,dataAdHost:y,dataAdClient:u,dataAdChannel:d,dataAdBreakTest:l,dataAdFrequencyHint:f})];case 1:return p.sent(),[3,3];case 2:return p.sent(),[3,3];case 3:return[2]}})})()}},{key:"getAdInstanceByService",value:function getAdInstanceByService(e,t){var o=arguments.length>1&&void 0!==t&&t;var c=i9.AdServiceConfigs,l=c.AdSense;switch(c.AppLovin,e){case"adsense":if(l.Enabled)return i_;break;case"applovin":break;default:return o?ig:ih}return null}},{key:"initAdInstance",value:function initAdInstance(){var e=true,t=false,o=void 0;try{for(var c,l=i9.InterstitialAdOptions[Symbol.iterator]();!(e=(c=l.next()).done);e=true){var u=c.value;var d=this.getAdInstanceByService(u.AdService);d&&this.ads.setAdInstance(ou.INTERSTITIAL,u.PlacementId,d)}}catch(e){t=true,o=e}finally{try{if(!e&&null!=l.return)l.return()}finally{if(t)throw o}}var f=true,y=false,p=void 0;try{for(var g,m=i9.RewardedVideoAdOptions[Symbol.iterator]();!(f=(g=m.next()).done);f=true){var A=g.value;var I=this.getAdInstanceByService(A.AdService);I&&this.ads.setAdInstance(ou.REWARDED_VIDEO,A.PlacementId,I)}}catch(e){y=true,p=e}finally{try{if(!f&&null!=m.return)m.return()}finally{if(y)throw p}}var D=true,k=false,E=void 0;try{for(var x,C=i9.RewardedInterstitialAdOptions[Symbol.iterator]();!(D=(x=C.next()).done);D=true){var T=x.value;var N=this.getAdInstanceByService(T.AdService);N&&this.ads.setAdInstance(ou.REWARDED_INTERSTITIAL,T.PlacementId,N)}}catch(e){k=true,E=e}finally{try{if(!D&&null!=C.return)C.return()}finally{if(k)throw E}}var O=true,R=false,M=void 0;try{for(var F,G=i9.BannerDisplayAdOptions[Symbol.iterator]();!(O=(F=G.next()).done);O=true){var B=F.value;var V=this.getAdInstanceByService(B.AdService,!0);V&&this.ads.setAdInstance(ou.BANNER,B.PlacementId,V)}}catch(e){R=true,M=e}finally{try{if(!O&&null!=G.return)G.return()}finally{if(R)throw M}}}},{key:"initState",value:function initState(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),(t=new Na(e)).initContext(),[4,t.initPlayer()];case 1:return o.sent(),[3,3];case 2:return o.sent(),[3,3];case 3:return[2]}})})()}},{key:"initConsolePlugin",value:function initConsolePlugin(){this.console&&this.console.configure()}},{key:"initProfilerPlugin",value:function initProfilerPlugin(){this.profiler&&this.profiler.configure()}},{key:"initRemoteConfig",value:function initRemoteConfig(){if(!oc.Enabled)return;var e=oy.clone(oc);this.remoteConfig.configure(e),this.event.on(f.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(f.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.catchUp(f.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}},{key:"initFirebasePlugin",value:function initFirebasePlugin(){if(!oi.Enabled||!this.firebase)return;var e=oy.clone(oi);this.firebase.configure(e),op.setService(this.firebase.services.performance)}},{key:"initMarkCoreInitialize",value:function initMarkCoreInitialize(){ol.CoreFlows&&(op.measure(this.markName),op.putAttr(this.markName,"Build","".concat("24")),op.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),op.putAttr(this.markName,"Platform",GameSDK.getPlatform()),op.putAttr(this.markName,"Success","false"),op.start(this.markName))}},{key:"processPlayerProfile",value:function processPlayerProfile(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.player.syncProfileToServer()];case 1:return t.sent(),e.processAfterSyncProfile(),[3,3];case 2:return t.sent(),[3,3];case 3:return[2]}})})()}},{key:"updatePlayerProfileToNotificationService",value:function updatePlayerProfileToNotificationService(){var e=this;return _async_to_generator(function(){var t,o,c;return _ts_generator(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),o=(t=e.player.getPlayer()).ASID,c=t.playerId,[4,eg({appId:i8,ASID:o,playerId:c,name:t.name,photo:t.photo,locale:t.locale})];case 1:return l.sent(),[3,3];case 2:return l.sent(),[3,3];case 3:return[2]}})})()}},{key:"initGoogleAnalytics",value:function initGoogleAnalytics(){var e;var t=null!==(e=oe.GoogleAnalytics)&&void 0!==e?e:{},o=t.Enabled,c=t.ConsoleLog;o&&this.analytics.add(new iQ(this.game,{log:!!c}))}},{key:"initClarityAnalytics",value:function initClarityAnalytics(){var e;var t=null!==(e=oe.ClarityAnalytics)&&void 0!==e?e:{},o=t.Enabled,c=t.ConsoleLog;if(!o)return;var l=new iR(this.game,{log:!!c});if(!GameSDK.extra.isGuest){var u=this.player.getPlayer().playerId;l.setUser(u)}this.analytics.add(l)}},{key:"initFirebaseAnalytics",value:function initFirebaseAnalytics(){var e,t=this;var o=null!==(e=oe.FirebaseAnalytics)&&void 0!==e?e:{},c=o.Enabled,l=o.ConsoleLog;if(!c)return;var u=new iz(this.game,{log:!!l});this.analytics.add(u);var d="no_entry";GameSDK.getEntryPointAsync().then(function(e){d=e}).catch(function(e){}).finally(function(){var e=t.player.getPlayer(),o=e.playerId,c=e.locale,l=GameSDK.getEntryPointData()||{},f=l.fbig_ad_id,y=l.fbig_adset_id,p=l.fbig_campaign_id;u.setUser(o,{locale:c,ad_id:f,adset_id:y,campaign_id:p,traffic_source:d})})}},{key:"initYandexAnalytics",value:function initYandexAnalytics(){"Yandex"===GameSDK.getSDKName()&&this.analytics.add(new i4(this.game))}},{key:"initFacebookAnalytics",value:function initFacebookAnalytics(){var e;var t=GameSDK.getSDKName(),o=null!==(e=oe.FacebookAnalytics)&&void 0!==e?e:{},c=o.Enabled,l=o.Prefix,u=o.ConsoleLog;c&&"FacebookInstant"===t&&"string"==typeof l&&this.analytics.add(new iV(this.game,{prefix:l,log:!!u}))}}]),yc}(c.Game);var om=o.Configs.GameEngine.ForceDesktopDPR,oA=o.Utils.Device,ow=o.Events,oI=/*#__PURE__*/function(){var e=_async_to_generator(function(){var e;return _ts_generator(this,function(t){switch(t.label){case 0:return e=new og,window.game=e,window.__sdkLoadingCount<20&&(window.__sdkLoadingCount=20),window.__gameCoreStart=!0,[4,e.boot()];case 1:return t.sent(),e.event.catchUp(ow.REQUEST_CORE_START,Ia),mc(e),[2]}})});return function gc(){return e.apply(this,arguments)}}(),Ia=function(){if(!window.__sdkInitiated){game.event.catchUp(ow.GAME_SDK_READY,Ia);return}window.game.start(),window.__sdkLoadingCount<25&&(window.__sdkLoadingCount=25)},mc=function(e){var t=setInterval(function(){if(!window.__sdkInitiated)return;clearInterval(t),window.__sdkLoadingCount<10&&(window.__sdkLoadingCount=10),e.event.emit(ow.GAME_SDK_READY)},5)};!1!==om&&oA.isDesktop()&&"number"==typeof om&&om>0&&(window.devicePixelRatio=om),window.originalRequestAnimationFrame=window.requestAnimationFrame,window.isCustomRequestAnimationFrame=!0,window.requestAnimationFrame=function(e){return window.isCustomRequestAnimationFrame?(setTimeout(e,1e3/60),0):window.originalRequestAnimationFrame(e)},oI()}}});