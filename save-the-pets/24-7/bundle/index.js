function _assert_this_initialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _call_super(t,i,n){return i=_get_prototype_of(i),_possible_constructor_return(t,_is_native_reflect_construct()?Reflect.construct(i,n||[],_get_prototype_of(t).constructor):i.apply(t,n))}function _class_call_check(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var n=0;n<i.length;n++){var r=i[n];if(r.enumerable=r.enumerable||false,r.configurable=true,"value"in r)r.writable=true;Object.defineProperty(t,r.key,r)}}function _create_class(t,i,n){if(i)_defineProperties(t.prototype,i);if(n)_defineProperties(t,n);return t}function _get_prototype_of(t){return(_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");if(t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:true,configurable:true}}),i)_set_prototype_of(t,i)}function _possible_constructor_return(t,i){if(i&&("object"===_type_of(i)||"function"==typeof i))return i;return _assert_this_initialized(t)}function _set_prototype_of(t,i){return(_set_prototype_of=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function _type_of(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function _is_native_reflect_construct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_is_native_reflect_construct=function(){return!!t})()}var d=Object.defineProperty;var e=function(t,i,n){return function(t,i,n){return i in t?d(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n}(t,(void 0===i?"undefined":_type_of(i))!="symbol"?i+"":i,n)};System.register(["./core.js"],function(t,i){"use strict";var n,r;return{setters:[function(t){n=t.P,r=t.C}],execute:function(){var i=/*#__PURE__*/function(){function o(t,i){var n=this;_class_call_check(this,o),e(this,"options"),e(this,"performance"),e(this,"isRunning",!1),e(this,"checkTimer"),e(this,"fpsHistory"),e(this,"actualFPS",0),e(this,"start",function(){n.isRunning||(n.isRunning=!0,n.checkTimer=n.options.CheckInterval,n.fpsHistory=[])}),e(this,"stop",function(){n.isRunning&&(n.isRunning=!1,n.options.OnlyUpdateWhenSwitchScene&&n.checkFps())}),e(this,"postStep",function(t){n.isRunning&&(n.checkTimer-=t,!(n.checkTimer>0)&&(n.checkTimer+=n.options.CheckInterval,n.fpsHistory.push(n.actualFPS),n.options.OnlyUpdateWhenSwitchScene||n.fpsHistory.length>=5&&n.checkFps()))}),this.options=i,this.performance=t}return _create_class(o,[{key:"checkFps",value:function(){if(this.performance.game.ads.isAdFullSizeShowing()||0===this.fpsHistory.length)return;var t=!1;this.options.AutoUpgradeQuality&&this.isHighFps()&&(t=this.performance.upgradeGraphicsQuality()),this.isLowFps()&&(t=this.performance.downgradeGraphicsQuality()),t&&(this.fpsHistory=[])}},{key:"getFpsMedian",value:function(){return this.getMedian(this.fpsHistory)}},{key:"getMedian",value:function(t){if(0===t.length)return Number.NaN;var i=t.sort(function(t,i){return t-i}),n=Math.floor(i.length/2);return i.length%2===0?(i[n-1]+i[n])/2:i[n]}},{key:"isLowFps",value:function(){return this.getFpsMedian()<this.options.FpsThreshold}},{key:"isHighFps",value:function(){return this.getFpsMedian()>1.2*this.options.FpsThreshold}}]),o}();t("default",/*#__PURE__*/function(t){function u(){var t;return _class_call_check(this,u),t=_call_super(this,u,arguments),e(t,"enabled",!1),e(t,"quality"),e(t,"fpsTracker"),e(t,"pixelRatio"),e(t,"trackingSceneNames",[]),e(t,"trackingScene",function(i){t.trackingSceneNames.indexOf(i)<0||(t.stopFPSTracker(),t.startFPSTracker())}),e(t,"startFPSTracker",function(){t.fpsTracker.start()}),e(t,"stopFPSTracker",function(){t.fpsTracker.stop()}),t}return _inherits(u,t),_create_class(u,[{key:"configure",value:function(t){var i=t.Enabled,n=t.Quality,r=t.Options,s=t.TrackingSceneNames;this.enabled=i,this.quality=n,this.pixelRatio=window.devicePixelRatio,this.trackingSceneNames=s,this.createFPSTracker(r)}},{key:"getCurrentQuality",value:function(){return this.pixelRatio}},{key:"downgradeGraphicsQuality",value:function(){var t=this.quality,i=t.Min,n=t.AdjustStep,r=this.pixelRatio;if(r<=i)return!1;var s=+(r-n).toFixed(2);return!(s<i)&&(this.pixelRatio=s,this.resizeGameWorld(this.pixelRatio),!0)}},{key:"upgradeGraphicsQuality",value:function(){var t=this.quality,i=t.Max,n=t.AdjustStep,r=this.pixelRatio;if(r>=i)return!1;var s=+(r+n).toFixed(2);return!(s>i)&&(this.pixelRatio=s,this.resizeGameWorld(this.pixelRatio),!0)}},{key:"createFPSTracker",value:function(t){this.fpsTracker=new i(this,t)}},{key:"event",get:function(){return this.game.event}},{key:"resizeGameWorld",value:function(t){this.event.emit(r.REQUEST_RESIZE_GAME,{forcePixelRatio:t})}},{key:"updatePostStepDeltaTime",value:function(t){this.fpsTracker.postStep(t)}},{key:"updateActualFPS",value:function(t){this.fpsTracker.actualFPS=t}}]),u}(n.Plugins.BasePlugin))}}});