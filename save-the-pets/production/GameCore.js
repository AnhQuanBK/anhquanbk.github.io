var Go=Object.defineProperty;var Fo=(ut,v,p)=>v in ut?Go(ut,v,{enumerable:!0,configurable:!0,writable:!0,value:p}):ut[v]=p;var u=(ut,v,p)=>Fo(ut,typeof v!="symbol"?v+"":v,p);System.register(["./bundle/core.js","./bundle/monitor-error.js"],function(ut,v){"use strict";var p,b,Ve,at,L,nt,Be,Ue;return{setters:[M=>{p=M.G,b=M.P,Ve=M.M,at=M._,L=M.a,nt=M.C,Be=M.w},M=>{Ue=M.g}],execute:function(){const{Valid:M,Object:yt,String:ne,Json:He}=p.Utils,St="is invalid",st=class st{static addDefaultData(e){M.isObject(e)||this.prototype.exception("default data",St),e=He.clone(e);const{name:t}=this;M.isObject(st.data[t])||(st.data[t]={}),st.data[t]=yt.merge(st.data[t],e)}static getDefaultData(){const{name:e}=this;return He.clone(st.data[e])}static addValidateFunction(e,t){M.isString(e)||this.prototype.exception("validate key",St),typeof t!="function"&&this.prototype.exception("validate function",St);const s=`validate${ne.capitalize(e)}`;yt.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){const{name:e}=this.constructor;this.lazyDefaultData(st.data[e])}lazyDefaultData(e){M.isObject(e)||this.exception("data",St);for(const t in e)if(yt.hasOwn(e,t)){const s=e[t];yt.assign(this,{[t]:s})}}lazyValidateStructure(e){M.isObject(e)||this.exception("structure","is not object");const t=this.getKeys();for(const s of t){const a=this[s];a===void 0&&this.exception("structure",`has no key ${s}`),!yt.hasOwn(e,s)&&a!==void 0&&this.setDefaultData(s,e)}}setDefaultData(e,t){M.isObject(t)||this.exception("data",St);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),yt.assign(t,{[e]:s})}lazyValidateData(e){const t=this.getKeys();for(const s of t){const a=e[s],n=ne.removeDiacritics(s).replace(/[^a-zA-Z0-9]/g,""),i=`validate${ne.capitalize(n)}`,r=this[i];if(typeof r=="function")try{r.call(this,a)}catch{this.setDefaultData(s,e)}else this.exception("validate",`has no function ${i}`)}}lazySetupData(e){const t=this.getKeys();for(const s of t){const a=e[s];yt.assign(this,{[s]:a})}}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};u(st,"data",{});let T=st;p.Dtos={Base:T};const ta={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded",notificationData:"notificationData"},pt={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0,notificationData:{currentId:0,lastSent:0}}},{Valid:Et}=p.Utils,{playerId:ea,name:sa,photo:aa,locale:na}=pt,vt="is invalid";class Gt extends T{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Et.isString(e)||!e)&&this.exception("_id",vt)}validatePlayerId(e){(!Et.isString(e)||!e)&&this.exception("playerId",vt)}validateName(e){(!Et.isString(e)||!e)&&this.exception("name",vt)}validatePhoto(e){Et.isString(e)||this.exception("photo",vt)}validateLocale(e){(!Et.isString(e)||!e)&&this.exception("locale",vt)}toObject(){return super.toObject()}}Gt.addDefaultData({playerId:ea,name:sa,photo:aa,locale:na});const z=new Gt({playerId:"10",name:"Your Friend"}).toObject();class q extends Error{constructor(t){super(t);u(this,"code");this.code="CREATE_MATCH_FAILED"}}class D extends q{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}}const{Dtos:ie,Utils:ia,Events:ra}=p,{Array:oa,Object:ca,Json:$o,Valid:je}=ia;class la{constructor(e){u(this,"game");u(this,"initContext",()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new ie.Context.Info(e),{contextId:s,contextType:a,entryPointData:n}=t.toObject();this.game.context.receiveContext(s,a,n)});u(this,"initPlayer",async()=>{const{player:e}=this.game,t=this.getPlayerInfo(),s=oa.unique(ca.vals(ta)),a=await GameSDK.player.getDataAsync(s),n=new ie.Player.Data(a).toObject();e.receiveData(t,n),this.game.event.emit(ra.PLAYER_INFO_LOADED)});u(this,"getPlayerInfo",()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),a=GameSDK.getLocale();if(!je.isString(e))throw new D;return je.isString(t)||(t="You"),new ie.Player.Info({playerId:e,name:t,photo:s,locale:a}).toObject()}catch{return z}});this.game=e}}class re extends Error{constructor(t,s){super(t);u(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}}class oe extends Error{constructor(t,s){super(t);u(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}}const{Utils:da,Configs:ha}=p,{AppId:Ke,Network:ce}=ha,ua=c=>{if(!c.ok)throw new re(void 0,{response:c})},We=()=>{const c=window.game.auth.getToken();return{token:c,timeout:ce.Timeout,headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}}},ze=(c,e,t,s)=>async()=>{try{if(!Ke)throw new re("AppId is not defined");const a=`${c}/apps/${Ke}/${e}`,n=new AbortController;t.signal=n.signal;const i=setTimeout(()=>{n.abort()},t.timeout);p.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const r=await fetch(a,t);return clearTimeout(i),ua(r),await r.json()||{}}catch(a){if(a instanceof re)return null;throw a instanceof Object&&"name"in a&&a.name==="AbortError"?new oe:a}},le=async(c,e)=>{try{return c()}catch(t){if(t instanceof oe&&e>0)try{return await da.Time.sleepAsync(600),await le(c,e-1)}catch{return{}}return t instanceof oe?{}:{}}},ft=async(c,e,t,s=ce.Retries)=>{try{const a={...We(),...e,method:"GET"},n=ze(t,c,a);return await le(n,s)}catch{return{}}},_=async(c,e,t,s,a=ce.Retries)=>{try{const n={...We(),...t,method:"POST"},i=ze(s,c,n,e);return await le(i,a)}catch{return{}}},{Configs:{Notification:{ApiUrl:ya}},Utils:{Object:pa}}=p,fa=async c=>{if(!pa.hasOwn(c,"playerId"))throw new Error("Missing playerId");const{playerId:e}=c;await _(`players/${e}`,c,{},ya,10)};var de=(c=>(c.IDLE="idle",c.LOADING="loading",c.FILLED="filled",c.SHOWING="showing",c))(de||{}),O=(c=>(c.BANNER="banner",c.INTERSTITIAL="interstitial",c.REWARDED_VIDEO="rewarded_video",c.REWARDED_INTERSTITIAL="rewarded_interstitial",c))(O||{});let Ft=class extends Error{constructor(t,s){super(s);u(this,"code");this.code=t,this.message=s}};class ga{constructor(e,t){u(this,"type");u(this,"service");u(this,"placementId");u(this,"_status");this.type=e,this._status=de.IDLE,this.placementId=t}setStatus(e){this._status!==e&&(this._status=e)}get status(){return this._status}exception(e){throw new Ft("AD_INSTANCE_ERROR",e)}}let qe=class extends ga{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}};p.Plugins.Ads={Types:O,Status:de,AdError:Ft,AdInstance:qe};const{Array:$t,Object:Je}=p.Utils;class ma extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"enabled");u(this,"config");u(this,"lastCallAdShownTime");u(this,"isAdFullSizeShowed");u(this,"ads",{});u(this,"safeAreaBottom")}init(){this.lastCallAdShownTime={[O.BANNER]:0,[O.INTERSTITIAL]:0,[O.REWARDED_VIDEO]:0,[O.REWARDED_INTERSTITIAL]:0},this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=Number.parseInt(t,10),Number.isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new Ft("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(t,s,a){const n=`${t}-${s}`;this.ads[n]||(this.ads[n]={type:t,placementId:s,interval:null,instance:new a(t,s)})}async loadAdAsync(t,s){this.checkEnabled(),await this.getAd(t,s).instance.loadAsync()}async showAdAsync(t,s){this.checkEnabled();const{event:a}=this.game,n=this.getAd(t,s);this.lastCallAdShownTime[t]=window.performance.now()/1e3;try{a.emit(p.Events.AD_SHOWING,{type:t,placementId:s}),this.isAdFullSizeShowed=!0,await n.instance.showAsync()}finally{a.emit(p.Events.AD_CLOSED,{type:t,placementId:s}),this.isAdFullSizeShowed=!1}}getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.status}getAd(t,s){let a=null;if(s?a=this.getAdByPlacementId(s,t):a=this.getPriorityAdByType(t),!a)throw new Ft("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}getAdsByType(t){return Je.vals(this.ads).filter(s=>s.type===t)}getAdByPlacementId(t,s){const a=Je.vals(this.ads),n=$t.search(a,i=>i.placementId===t&&(!s||i.type===s));return n||null}getPriorityAdByType(t){const s=this.getAdsByType(t);if(!s.length)return null;const a=$t.search(s,n=>n.type===t);return a||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let a;if(t)a=this.getCommonAdConfig(t);else{const d=this.getPriorityAdByType(O.INTERSTITIAL);if(!d)return!1;a=this.getCommonAdConfig(d.placementId)}const{SecondsBetweenAds:n,SecondsFirstTime:i}=a,r=s-this.lastCallAdShownTime[O.INTERSTITIAL],o=r>n,l=r>i;return this.lastCallAdShownTime[O.INTERSTITIAL]>0?o:l}catch{return!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:a}=s;if(a==="ALL")return!0;const n=GameSDK.getPlatform();return n?n===a:!1}catch{return!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd(O.BANNER,t);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const{event:a}=this.game;if(a.emit(p.Events.AD_SHOWING,{type:O.BANNER,placementId:t}),GameSDK.getSDKName()==="MsGames")return;const n=this.getBannerConfig(s.placementId),{SecondsReload:i}=n;i<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},i*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd(O.BANNER,t);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync();const{event:a}=this.game;a.emit(p.Events.AD_CLOSED,{placementId:t})}cleanBannerReloadTimer(t){try{const s=this.getAd(O.BANNER,t),{interval:a}=s;if(!a)return;clearInterval(a)}catch{}}getCommonAdConfig(t){const s=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions],a=$t.search(s,n=>n.PlacementId===t);if(!a)throw new Error(`Ad config with placementId ${t} not found`);return a}getBannerConfig(t){const s=$t.search(this.config.BannerDisplayAdOptions,a=>a.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t,s,a=!0){this.checkEnabled();const n=this.getBannerConfig(t),i=GameSDK.getBannerHeight(n);return a?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(i+this.safeAreaBottom)*s):i*s}getSafeAreaBottom(t){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*t}}const R={ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",MESSAGE:"message",INVITE:"invite",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_SHOWING:"ad_showing",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GET_FREE_ITEM:"get_free_item",USE_ITEM:"use_item",EARN_ITEM:"earn_item"},{String:gt,Valid:wa}=p.Utils;let Aa=class{constructor(e,t,s){u(this,"game");u(this,"name");u(this,"color");u(this,"options");u(this,"selfLog");u(this,"currentPath");this.game=e,this.name=t,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/"}event(e,t){this.logInfo("event",{name:e,payload:t});const s=this.formatEventName(e);this.processEvent(s,t)}logInfo(e,t){this.selfLog}pageview(e){let t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),document.title=t,this.event(R.PAGE_VIEW,{path_path:e,page_title:t})}levelStart(e,t,s){this.event(R.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e),game_mode:s?gt.toUpperCamelCase(s):void 0})}levelFail(e,t,s){this.event(R.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e),game_mode:s?gt.toUpperCamelCase(s):void 0})}levelRescue(e,t,s){this.event(R.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e),game_mode:s?gt.toUpperCamelCase(s):void 0})}levelComplete(e,t,s){this.event(R.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e),game_mode:s?gt.toUpperCamelCase(s):void 0})}loadAdEvent(e){const{type:t,placement:s,adService:a}=e;this.event(R.AD_LOAD,{ad_type:t,screen_name:s,ad_service:a})}showAdEvent(e){const{type:t,placement:s,adService:a}=e;this.event(R.AD_SHOW,{ad_type:t,screen_name:s,ad_service:a})}loadInterstitialAd(e){const{placement:t,adService:s}=e;this.loadAdEvent({type:"interstitial",placement:t,adService:s})}showInterstitialAd(e){const{placement:t,adService:s}=e;this.showAdEvent({type:"interstitial",placement:t,adService:s})}loadRewardedVideoAd(e){const{placement:t,adService:s}=e;this.loadAdEvent({type:"rewarded_video",placement:t,adService:s})}showRewardedVideoAd(e){const{placement:t,adService:s}=e;this.showAdEvent({type:"rewarded_video",placement:t,adService:s})}receiveVideoReward(e){const{placement:t,adService:s}=e;this.event(R.AD_REWARD,{screen_name:t,ad_service:s})}loadRewardedInterstitialAd(e){const{placement:t,adService:s}=e;this.loadAdEvent({type:"rewarded_interstitial",placement:t,adService:s})}showRewardedInterstitialAd(e){const{placement:t,adService:s}=e;this.showAdEvent({type:"rewarded_interstitial",placement:t,adService:s})}receiveInterstitialReward(e){const{placement:t,adService:s}=e;this.event(R.AD_REWARD,{screen_name:t,ad_service:s})}loadAdFail(e){const{type:t,placement:s,adService:a}=e;this.event(R.AD_LOAD_FAILED,{ad_type:t,screen_name:s,ad_service:a})}showAdFail(e){const{type:t,placement:s,adService:a}=e;this.event(R.AD_SHOW_FAILED,{ad_type:t,screen_name:s,ad_service:a})}showingAd(e){const{type:t,placement:s,adService:a}=e;this.event(R.AD_SHOWING,{ad_type:t,screen_name:s,ad_service:a})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}getLevelName(e){return`Level ${gt.padStart(e.toString(),5,"0")}`}getPageTitle(e){const t=e.split("/").pop();if(!wa.isString(t))return e;const s=t.replace(/([-_\s.])/g," $1");return gt.toUpperCamelCase(s)}addGameModeToPageTitle(e){const{match:t}=this.game,s=t.getMatchState();let{mode:a}=s;return a||(a="Normal"),`${gt.toUpperCamelCase(a)}::${e}`}};p.Plugins.Analytics={Events:R,BaseAnalytics:Aa};class Ia extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"analytics",[]);u(this,"placement","unknown");u(this,"pageview",t=>{if(!this.isActive())return;this.placement=t;const s=this.getPageByKey(t);for(const a of this.analytics)a.pageview(s)})}add(t){this.analytics.some(a=>a.name===t.name)||this.analytics.push(t)}isActive(){return this.analytics.length>=1}event(t,s){if(this.isActive())for(const a of this.analytics)a.event(t,s)}levelStart(t,s,a){if(this.isActive())for(const n of this.analytics)n.levelStart(t,s,a)}levelRescue(t,s,a){if(this.isActive())for(const n of this.analytics)n.levelRescue(t,s,a)}levelFail(t,s,a){if(this.isActive())for(const n of this.analytics)n.levelFail(t,s,a)}levelComplete(t,s,a){if(this.isActive())for(const n of this.analytics)n.levelComplete(t,s,a)}loadInterstitialAd(t){if(this.isActive())for(const s of this.analytics)s.loadInterstitialAd({...t,placement:this.placement})}showInterstitialAd(t){if(this.isActive())for(const s of this.analytics)s.showInterstitialAd({...t,placement:this.placement})}loadRewardedVideoAd(t){if(this.isActive())for(const s of this.analytics)s.loadRewardedVideoAd({...t,placement:this.placement})}showRewardedVideoAd(t){if(this.isActive())for(const s of this.analytics)s.showRewardedVideoAd({...t,placement:this.placement})}receiveVideoReward(t){if(this.isActive())for(const s of this.analytics)s.receiveVideoReward({...t,placement:this.placement})}loadRewardedInterstitialAd(t){if(this.isActive())for(const s of this.analytics)s.loadRewardedInterstitialAd({...t,placement:this.placement})}showRewardedInterstitialAd(t){if(this.isActive())for(const s of this.analytics)s.showRewardedInterstitialAd({...t,placement:this.placement})}receiveInterstitialReward(t){if(this.isActive())for(const s of this.analytics)s.receiveInterstitialReward({...t,placement:this.placement})}loadAdFail(t){if(this.isActive())for(const s of this.analytics)s.loadAdFail({...t,placement:this.placement})}showAdFail(t){if(this.isActive())for(const s of this.analytics)s.showAdFail({...t,placement:this.placement})}showingAd(t){if(this.isActive())for(const s of this.analytics)s.showingAd({...t,placement:this.placement})}getPageByKey(t){let s=t;if(s.indexOf("_")>-1){let i=s.replace(/_/g,"-");return i=i.toLowerCase(),i}let a=s.length-1,n="";for(;a>0;){n=s.charAt(a);const i=Number.isNaN(Number.parseInt(n,10)),r=n===n.toUpperCase();i&&r&&(s=`${s.slice(0,a)}-${s.slice(a)}`),a--}return s.toLowerCase()}}class Da{constructor(e){u(this,"key");this.key=e}getKey(){return this.key}}class Pa{constructor(e){u(this,"id");u(this,"isMuteAll");u(this,"masterVolume");u(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}async play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:a}=s;this.playWithRealConfig(a,t)}else await this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:a=1}=t||{};this.setAudioClip(e,{volume:a,audioPlayer:s}),this.playWithRealConfig(s,t)}catch{}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:a=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*a);break;default:throw new Error(`Unsupported function: ${t}`)}}catch{}}callAudioPlayers(e){const{Object:t}=p.Utils,s=t.vals(this.audioClips);for(const a of s)this.queueAudioPlayer(a,e)}}p.Plugins.Audio={BaseAudioPlayer:Da,BaseChannelManager:Pa};class Sa extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"firstChannelId");u(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}async play(t,s,a){try{await this.getChannel(a).play(t,s)}catch{}}pause(t,s){try{this.getChannel(s).pause(t)}catch{}}resume(t,s){try{this.getChannel(s).resume(t)}catch{}}stop(t,s){try{this.getChannel(s).stop(t)}catch{}}stopAll(t){try{this.getChannel(t).stopAll()}catch{}}mute(t){try{this.getChannel(t).muteAll()}catch{}}unmute(t){try{this.getChannel(t).unmuteAll()}catch{}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch{}}getVolume(t){try{return this.getChannel(t).getVolume()}catch{return-1}}}const Ea={token:"",isRequesting:!1};class va extends b.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",Ea)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const n=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",n)}catch(t){if(p.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token","")}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}}var it=(c=>(c.SOLO="solo",c.TOURNAMENT="tournament",c.SHARE_INVITE="share_invite",c.MATCHING_GROUP="matching_group_match",c.CHALLENGE_FRIEND="challenge_friend_match",c))(it||{});const mt=Ve,{Configs:xa,Utils:{Array:Ca,Valid:ba,Browser:Na}}=p;class Ma{constructor(e){u(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return ba.isObject(e)}isTournamentEntryPoint(e){return Ca.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],e)}receiveContext(e,t,s){const{storage:a}=this.game;a.setStorageData("context","contextId",e),this.isValidEntryPointData(s)&&a.setStorageData("context","entryPointData",s),this.isValidContextType(t)&&a.setStorageData("context","contextType",t)}async detectContextSessionType(){const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:a,TOURNAMENT:n,MATCHING_GROUP:i,SHARE_INVITE:r,CHALLENGE_FRIEND:o}=it;let l=a;if(s===n&&(l=n),s===i&&(l=i),(s===o||s===r)&&(l=o),l===a)try{xa.Core.FastCheckTournamentContext?l=this.fastCheckTournamentContext()||l:l=await this.outdatedCheckTournamentContext()||l}catch{}e.setStorageData("context","sessionContextType",l)}fastCheckTournamentContext(){const t=Na.getQueryParams().entry_point;return typeof t!="string"||!this.isTournamentEntryPoint(t)?!1:it.TOURNAMENT}async outdatedCheckTournamentContext(){return"getTournamentAsync"in GameSDK&&(await GameSDK.getTournamentAsync()).getEndTime()>Date.now()/1e3?it.TOURNAMENT:!1}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),a=t.getStorageData("context","sessionContextType"),n=e.getPlayerId(),{matchId:i,playerId:r,opponentId:o=z.playerId}=s,l=n===r,h=o===z.playerId||[o,r].indexOf(n)>=0,{TOURNAMENT:y,MATCHING_GROUP:f,SHARE_INVITE:g,CHALLENGE_FRIEND:A}=it;let m=mt.SINGLE;a===y&&(m=mt.TOURNAMENT),a===g&&!l&&(m=mt.CHALLENGE_FRIEND),a===A&&i&&h&&(m=mt.CHALLENGE_FRIEND),a===f&&(m=mt.MATCHING_GROUP),t.setStorageData("context","contextGameMode",m)}}class Ye extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e??"Player has finished match"}}class he extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}}const{Events:kt,Plugins:{Analytics:Qe}}=p;class La{constructor(e){u(this,"game");this.game=e}async processContextData(){const{player:e,storage:t,monitorError:s}=this.game,a=t.getStorageData("context","contextId"),n=t.getStorageData("context","entryPointData"),i=t.getStorageData("context","sessionContextType"),{type:r,matchId:o,playerId:l,opponentId:d,playerScore:h,action:y}=n||{};y&&await this.processEntryPointAction(y);const f=e.isFirstLogin();setTimeout(()=>{this.logUserAnalytics(f)},1e3);const{TOURNAMENT:g,SHARE_INVITE:A,MATCHING_GROUP:m,CHALLENGE_FRIEND:x}=it;if(i===g)try{await this.processTournamentModeAsync(a);return}catch{s==null||s.sendException(new Error("Process Tournament Fail"),{contextId:a,isFirstLogin:f,entryPointData:n,playerData:e.getPlayerData()})}if(i===x){if(r===A&&typeof l=="string"){await this.processChallengeFromPostAsync(l);return}if(r===x&&typeof o=="string"&&typeof l=="string"&&typeof d=="string"){await this.processChallengeFromMessageAsync({contextId:a,matchId:o,playerId:l,opponentId:d});return}}if(i===m&&typeof l=="string"&&typeof h=="number"){await this.processMatchingGroupModeAsync(l,h);return}if(f){await this.processSingleModeAsync(!0),e.loggedIn();return}this.switchToDashboardScene()}logUserAnalytics(e){try{const{player:t,analytics:s}=this.game;if(e)s.event(Qe.Events.NEW_USER);else{const{coins:a}=t.getPlayerData().gameData;s.event(Qe.Events.RETURNING_USER,{coins:a})}}catch{}}async processEntryPointAction(e){try{const{player:t}=this.game;switch(e){case"reset_data":t.setPlayerDataByName("score",0),t.setPlayerDataByName("endlessScore",0),t.setGameData({coins:0,level:1}),await t.syncProfileToServer();break;case"enable_debug":t.setPlayerDataByName("debug",!0);break;case"set_locale_en":this.requestSetLocale("en");break;case"set_locale_ru":this.requestSetLocale("ru");break}}catch{}}requestSetLocale(e){const{event:t}=this.game;t.emit(kt.REQUEST_LANGUAGE,{locale:e})}async processTournamentModeAsync(e){const{match:t,player:s}=this.game,a=s.getPlayerId();if(typeof e!="string")throw new Error("Cannot get contextId");await t.tournament.continue.processAsync({playerId:a,contextId:e}),this.switchToGameScene()}async processChallengeFromPostAsync(e){const{match:t,player:s}=this.game,a=s.getPlayerId();if(a===e)await t.single.start.processAsync({playerId:a});else try{await t.challenge.friend.processAsync({playerId:a,opponentId:e})}catch{await t.single.start.processAsync({playerId:a})}this.switchToGameScene()}async processChallengeFromMessageAsync(e){try{await this.processContinueChallengeFromMessageAsync(e)}catch(t){if(t instanceof Ye){await this.processAwaitChallengeFromMessageAsync(e);return}if(t instanceof he){await this.processJoinChallengeFromMessageAsync(e);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,{match:i,player:r}=this.game,o=r.getPlayerId();if(a===o)await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:o,opponentId:n});else{const d=n===z.playerId;await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:o,opponentId:d?n:a})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,r=i.getPlayerId();await n.challenge.join.processAsync({contextId:t,matchId:s,playerId:r,opponentId:a}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,r=i.getPlayerId();try{await n.challenge.await.processAsync({contextId:t,matchId:s,playerId:r,opponentId:a}),this.switchToChallengeResultScene()}catch{await this.processResultChallengeFromMessageAsync(e)}}async processResultChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,r=i.getPlayerId();try{await n.challenge.result.processAsync({contextId:t,matchId:s,playerId:r,opponentId:a}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(e,t){const{match:s,player:a}=this.game;await s.group.join.processAsync({playerId:a.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processSingleModeAsync(e){const{match:t,player:s}=this.game,a=s.getPlayerId();e&&await t.handler.setMatchCustomData({level:0}),await t.single.start.processAsync({playerId:a}),this.switchToGameScene()}switchToDashboardScene(){const{event:e}=this.game;e.emit(kt.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}switchToGameScene(){const{event:e}=this.game;e.emit(kt.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}switchToChallengeResultScene(){const{event:e}=this.game;e.emit(kt.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}}const Xe={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},{Events:Ta}=p;class _a extends b.Plugins.BasePlugin{constructor(t){super(t);u(this,"context");u(this,"loader");this.loader=new La(t),this.context=new Ma(t)}init(){const{storage:t}=this.game;t.addStorage("context",Xe)}getSessionContextTypes(){return it}async processContextData(){try{await this.loader.processContextData()}catch{this.switchToDashboardScene()}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch{}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,a){this.context.receiveContext(t,s,a)}switchToDashboardScene(){const{event:t}=this.game;t.emit(Ta.SWITCH_SCENE,{sceneName:"DashboardScene"})}}const{Valid:ue}=p.Utils,{contextId:Oa,contextType:Ra,entryPointData:Ga}=Xe,ye="is invalid";class Ze extends T{constructor(){super(...arguments);u(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){ue.isString(t)||this.exception("contextId",ye)}validateContextType(t){(!ue.isString(t)||!t)&&this.exception("contextType",ye)}validateEntryPointData(t){ue.isObject(t)||this.exception("entryPointData",ye)}toObject(){return super.toObject()}}Ze.addDefaultData({contextId:Oa,contextType:Ra,entryPointData:Ga}),p.Dtos.Context={Info:Ze};const Fa={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},{Object:$a}=p.Utils;class ka{async getDailyRewardsAsync(){return $a.vals(Fa)}}const xt={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},Va={dailyRewards:{}},ts=p.Configs.DailyRewards;class Ba extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"dailyRewardsApi",new ka)}init(){const{storage:t}=this.game;t.addStorage("dailyRewards",Va)}async requestDailyRewardsAsync(){const t=await this.dailyRewardsApi.getDailyRewardsAsync();t.length!==0&&this.receiveDailyRewards(t)}getDailyRewards(){const{storage:t}=this.game,s=t.getStorageData("dailyRewards","dailyRewards");return s||null}logLoginReward(){const{player:t}=this.game,{logDays:s}=t.getPlayerData().dailyRewarded,a=[...s];a[a.length-1]=!0,this.logDailyRewards(a)}logDailyRewards(t,s=!1){const{player:a}=this.game;a.setPlayerDataByName("dailyRewarded",{logDays:t,lastRewarded:s?0:Date.now()})}receiveDailyRewards(t){const{player:s}=this.game,{logDays:a,lastRewarded:n}=s.getPlayerData().dailyRewarded,i=new Date,r=new Date(n),o=new Date(r.toDateString()),l=Math.abs(i.valueOf()-o.valueOf()),h=Math.floor(l/864e5)>1,f=ts.CheckInterrupt&&h||a.length>=ts.MaxDays,g=f?[!1]:[...a,!1];this.logDailyRewards(g);const A=t.map((m,x)=>{const F=x<g.length,I=g.length===x+1,ke=g[x]===!1;let j=xt.WAITING;return I?j=xt.READY:f?j=xt.WAITING:F&&ke?j=xt.SKIPPED:F&&(j=xt.REWARDED),{...m,status:j}});this.setDailyRewards(A)}setDailyRewards(t){const{storage:s}=this.game;s.setStorageData("dailyRewards","dailyRewards",t)}}var es={exports:{}};(function(c){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function a(o,l,d){this.fn=o,this.context=l,this.once=d||!1}function n(o,l,d,h,y){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new a(d,h||o,y),g=t?t+l:l;return o._events[g]?o._events[g].fn?o._events[g]=[o._events[g],f]:o._events[g].push(f):(o._events[g]=f,o._eventsCount++),o}function i(o,l){--o._eventsCount===0?o._events=new s:delete o._events[l]}function r(){this._events=new s,this._eventsCount=0}r.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},r.prototype.listeners=function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var y=0,f=h.length,g=new Array(f);y<f;y++)g[y]=h[y].fn;return g},r.prototype.listenerCount=function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},r.prototype.emit=function(l,d,h,y,f,g){var A=t?t+l:l;if(!this._events[A])return!1;var m=this._events[A],x=arguments.length,F,I;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),x){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,d),!0;case 3:return m.fn.call(m.context,d,h),!0;case 4:return m.fn.call(m.context,d,h,y),!0;case 5:return m.fn.call(m.context,d,h,y,f),!0;case 6:return m.fn.call(m.context,d,h,y,f,g),!0}for(I=1,F=new Array(x-1);I<x;I++)F[I-1]=arguments[I];m.fn.apply(m.context,F)}else{var ke=m.length,j;for(I=0;I<ke;I++)switch(m[I].once&&this.removeListener(l,m[I].fn,void 0,!0),x){case 1:m[I].fn.call(m[I].context);break;case 2:m[I].fn.call(m[I].context,d);break;case 3:m[I].fn.call(m[I].context,d,h);break;case 4:m[I].fn.call(m[I].context,d,h,y);break;default:if(!F)for(j=1,F=new Array(x-1);j<x;j++)F[j-1]=arguments[j];m[I].fn.apply(m[I].context,F)}}return!0},r.prototype.on=function(l,d,h){return n(this,l,d,h,!1)},r.prototype.once=function(l,d,h){return n(this,l,d,h,!0)},r.prototype.removeListener=function(l,d,h,y){var f=t?t+l:l;if(!this._events[f])return this;if(!d)return i(this,f),this;var g=this._events[f];if(g.fn)g.fn===d&&(!y||g.once)&&(!h||g.context===h)&&i(this,f);else{for(var A=0,m=[],x=g.length;A<x;A++)(g[A].fn!==d||y&&!g[A].once||h&&g[A].context!==h)&&m.push(g[A]);m.length?this._events[f]=m.length===1?m[0]:m:i(this,f)}return this},r.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&i(this,d)):(this._events=new s,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=t,r.EventEmitter=r,c.exports=r})(es);var Ua=es.exports;const Ha=Ue(Ua),rt=new Ha,ja={names:[],history:[]};class Ka extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"enableLog",!1);u(this,"muteEvents",[])}init(){const{storage:t}=this.game;t.addStorage("event",ja)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),rt.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),rt.once(t,s)}catchUp(t,s){if(this.validateCallback(s),this.once(t,s),!(this.getEventEmitCount(t)>0))return;const{payload:n}=this.getLastEventInfo(t)??{};this.emit(t,n)}off(t,s){this.validateCallback(s),rt.off(t,s),this.addHistory(t,"action","removed")}mute(t){this.muteEvents.indexOf(t)>-1||this.muteEvents.push(t)}clear(t){rt.removeAllListeners(t),this.addHistory(t,"action","removed")}emit(t,s){if(this.muteEvents.indexOf(t)>-1)return;let a=[];s&&(a=[s]),this.addHistory(t,"action","called",s),rt.emit(t,...a)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,a=s.getStorageData("event","names");a.indexOf(t)<0&&a.push(t)}getEventListeners(){const t=rt.eventNames();return Object.keys(t)}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}getEventEmitCount(t){return this.getHistory().filter(a=>a.name===t&&a.status==="called").length}getLastEventInfo(t){const s=this.getHistory();let a=null;for(let n=s.length-1;n>=0;n--)if(s[n].name===t){a=s[n];break}return a}getTypeFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.type)??null}getCallsFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.called)??0}addHistory(t,s,a,n){const r=this.getTypeFromHistory(t)??s,o=this.getCallsFromHistory(t),l=a==="called"?o+1:o;this.getHistory().push({type:r,status:a,name:t,called:l,payload:n??{}}),this.logEventInfo(t,r,a,l)}logEventInfo(t,s,a,n){this.enableLog&&(a==="listening"&&rt.listenerCount(t),a==="called"&&rt.listenerCount(t))}}const pe={},fe=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"})),Wa='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',{Configs:za,Utils:qa}=p,{Object:ge}=qa,{Enabled:Ja,WideframeConfigs:me}=za.FrameCapture,Ya=async c=>{if(!Ja)return null;const e=Xa(c);if(!e)return null;Qa(e,me.ResultChallenge);const{frameCapture:t}=window.game,{Width:s,Height:a}=me.ResultChallenge;return t.captureAsync({name:"ResultChallenge",width:s,height:a,renderOptions:e})},Qa=(c,e)=>{const{Width:t,Height:s,Wideframe:a}=e;c.wideframe={name:"result-challenge",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},Xa=c=>{try{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:a="20",opponentPhoto:n="",opponentScore:i=0,isPlayerFinished:r,isOpponentFinished:o}=c,{RenderOptions:l}=me.ResultChallenge,d=ge.clone(l);if(!d)return null;const h=ge.clear(d),y=ge.camelCaseKeys(h),{playerPhoto:f,opponentPhoto:g}=y,A=s===i,m=s>i,x=r??o,F=r&&o;return f.type==="image"&&(f.name=`${e}`,f.image=t),g.type==="image"&&(g.name=`${a}`,g.image=n),x&&Za(y,{playerScore:s,opponentScore:i,isPlayerFinished:r,isOpponentFinished:o}),!F||A?(delete y.leftCrown,delete y.rightCrown,y):(m?delete y.rightCrown:delete y.leftCrown,y)}catch{return null}},Za=(c,e)=>{const{leftScore:t,rightScore:s}=c,{playerScore:a=0,opponentScore:n=0,isPlayerFinished:i,isOpponentFinished:r}=e;(t==null?void 0:t.type)==="text"&&(t.text=i?`${a}`:"???"),(s==null?void 0:s.type)==="text"&&(s.text=r?`${n}`:"???")},{Configs:tn,Utils:en}=p,{Object:we}=en,{Enabled:sn,WideframeConfigs:Ae}=tn.FrameCapture,an=async c=>{if(!sn)return null;const e=rn(c);if(!e)return null;nn(e,Ae.ShareLeaderboard);const{frameCapture:t}=window.game,{Width:s,Height:a}=Ae.ShareLeaderboard;return t.captureAsync({name:"ShareLeaderboard",width:s,height:a,renderOptions:e})},nn=(c,e)=>{const{Width:t,Height:s,Wideframe:a}=e;c.wideframe={name:"share-leaderboard",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},rn=c=>{try{const{playerId:e,playerPhoto:t,leaders:s}=c,{RenderOptions:a}=Ae.ShareLeaderboard,n=we.clone(a);if(!n)return null;const i=we.clear(n),r=we.camelCaseKeys(i),{avatar:o}=r;return o.type==="image"&&(o.name=`${e}`,o.image=t),on(r,s),r}catch{return null}},on=(c,e)=>{const t="600 48px";e.forEach((s,a)=>{const{id:n,name:i,photo:r,score:o}=s;let l=1294+180*a;c[`photo_${n}`]={depth:-1,name:n,type:"image",image:r,size:[96,96],position:[436,l]},l=1360+180*a,c[`name_${n}`]={font:t,depth:1,name:n,type:"text",text:i,position:[600,l]},c[`score_${n}`]={font:t,depth:1,name:n,type:"text",text:`${o}`,position:[100,l]}})},{Configs:cn,Utils:ln}=p,{Object:Ie}=ln,{Enabled:dn,WideframeConfigs:De}=cn.FrameCapture,hn=async c=>{if(!dn)return null;const e=yn(c);if(!e)return null;un(e,De.ShareScore);const{frameCapture:t}=window.game,{Width:s,Height:a}=De.ShareScore;return t.captureAsync({name:"ShareScore",width:s,height:a,renderOptions:e})},un=(c,e)=>{const{Width:t,Height:s,Wideframe:a}=e;c.wideframe={name:"share-score",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},yn=c=>{try{const{playerId:e,playerPhoto:t,playerScore:s}=c,{RenderOptions:a}=De.ShareScore,n=Ie.clone(a);if(!n)return null;const i=Ie.clear(n),r=Ie.camelCaseKeys(i),{avatar:o,playerScore:l}=r;return o.type==="image"&&(o.name=`${e}`,o.image=t),l.type==="text"&&(l.text=`${s}`),r}catch{return null}},{Configs:pn,Utils:fn}=p,{Image:Vt,Object:Ct,Valid:Bt}=fn,{Options:Pe}=pn.FrameCapture;class gn extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"width");u(this,"height");u(this,"canvas",null);u(this,"testRenderOptions",null);u(this,"caches",{});u(this,"wideframe",{})}init(){this.addWideframeRender("renderShareScore",hn),this.addWideframeRender("renderResultChallenge",Ya),this.addWideframeRender("renderShareLeaderboard",an)}async preloadAsync(t){const{renderOptions:s}=t;await this.loadImages(s)}async captureAsync(t){const{width:s,height:a,renderOptions:n}=t;return await this.loadImages(n),this.width=s,this.height=a,this.createCanvas(),this.drawObjects(n),this.snapshotFrameAsync()}addWideframeRender(t,s){this.wideframe[t]=s}setTestRenderOptions(t){if(!t){this.testRenderOptions=null;return}const s=Ct.camelCaseKeys(t);this.testRenderOptions=Ct.merge(this.testRenderOptions,s)}createCanvas(){if(this.canvas){const t=this.canvas.getContext("2d");t?t.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}async loadImages(t){const s=Ct.vals(t).filter(r=>r.type==="image"),a=this.prepareLoadImages(s),n=Ct.vals(a);if(n.length<1)return;const i=await Promise.all(n);this.cacheImages(a,i)}prepareLoadImages(t){const s={};for(const a of t){const{name:n,image:i,fallbackImage:r}=a,o=this.caches[n];!Bt.isString(i)||o||(i===""&&Bt.isString(r)&&(a.image=r),s[n]=new Promise(l=>{Vt.loadImage(i).then(h=>{l(h)}).catch(()=>{Bt.isString(r)?(a.image=r,Vt.loadImage(a.image).then(h=>{l(h)}).catch(()=>{l(null)})):l(null)})}))}return s}cacheImages(t,s){for(const a in t){const n=s.shift();n&&(this.caches[a]=n)}}drawObjects(t){const s=Ct.vals(t).sort((a,n)=>a.depth-n.depth);for(const a of s)switch(a.type){case"text":this.drawText(a);break;case"image":this.drawImage(a);break}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{position:a,font:n,text:i,color:r,lineWidth:o,textAlign:l}=t;s.font=`${n} ${Wa}`,s.fillStyle=r??"#ffffff",o&&(s.lineWidth=o),l&&(s.textAlign=l);const[d,h]=a;s.fillText(i,d,h)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{name:a,size:n,position:i,fallbackImage:r}=t;let o=this.caches[a];if(!o&&r&&(o=this.caches[r]),!o)throw new Error(`Image ${a} not found`);const[l,d]=i,[h,y]=n;s.drawImage(o,l,d,h,y)}async snapshotFrameAsync(){if(!this.canvas)return null;let t=null;if(Pe.UseBlobIfPossible&&"toBlob"in this.canvas?t=await this.createAsBlob():t=this.createAsDataImage(),!t)throw new Error("Image data is null");return Bt.isDebugger()&&Vt.logImage(t),t}createAsDataImage(){if(!this.canvas)return null;const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return null;const{Quality:s,RenderType:a}=Pe;return t.canvas.toDataURL(`image/${a}`,s)}createAsBlob(){return new Promise(t=>{if(!this.canvas){t(null);return}const{Quality:s,RenderType:a}=Pe;this.canvas.toBlob(n=>{if(!n){t(null);return}Vt.blobToDataImage(n).then(i=>{t(i)})},`image/${a}`,s)})}}class ss extends Error{constructor(t,s){const a=String(t);super(`Text with key "${a}" not found in locale "${s}"`);u(this,"key");u(this,"locale");this.name="MissingKeyInLocaleError",this.key=a,this.locale=s}}class mn extends Error{constructor(t){super(`Locale "${t}" not found`);u(this,"locale");this.name="LocaleNotFoundError",this.locale=t}}const{Utils:{Object:Se,Function:as}}=p;class wn extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"locale");u(this,"fallbackLocale");u(this,"data",{})}setFallbackLocale(t){this.fallbackLocale=t}hasTextKey(t,s){const a=s??this.getCurrentLocale(),{text:n}=this.getLocaleData(a);return Se.hasOwn(n,t)}hasTextureKey(t,s){const a=s??this.getCurrentLocale(),{texture:n}=this.getLocaleData(a);return Se.hasOwn(n,t)}add(t,s,a=!1){this.data[t]=s,a&&this.setFallbackLocale(t)}choose(t){this.locale=t;const{event:s}=this.game;s.emit(p.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,a,n=!1){try{return this.uncaughtGetText(t,s,a,!n)}catch{return String(t)}}getTexture(t,s,a=!1){return this.uncaughtGetTexture(t,s,!a)}uncaughtGetText(t,s=[],a,n=!0){if(!n||this.fallbackLocale===void 0){const o=this.getRawText(t,a??this.getCurrentLocale());return this.replaceVariables(o,s)}const i=this.fallbackLocale,r=as.retry(()=>this.getRawText(t,a??this.getCurrentLocale()),()=>this.getRawText(t,i));return this.replaceVariables(r,s)}getRawText(t,s){if(!this.hasTextKey(t,s))throw new ss(t,s);const{text:a}=this.getLocaleData(s);return a[t]}uncaughtGetTexture(t,s,a=!0){if(!a||this.fallbackLocale===void 0)return this.getRawTexture(t,s??this.getCurrentLocale());const n=this.fallbackLocale;return as.retry(()=>this.getRawTexture(t,s??this.getCurrentLocale()),()=>this.getRawTexture(t,n))}getRawTexture(t,s){if(!this.hasTextureKey(t,s))throw new ss(t,s);const{texture:a}=this.getLocaleData(s);return a[t]}getCurrentLocale(){return this.locale??"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!Se.hasOwn(this.data,s))throw new mn(s);return this.data[s]}replaceVariables(t,s){const a=s.length;if(a===0)return t;let n=t;for(let i=0;i<a;i++){const r=s[i],o=`%{${i}}`;n=n.replace(o,r)}return n}}const An=ut("D",{_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15}),{Configs:In,Utils:Dn}=p,{Object:bt,String:ns,Valid:is}=Dn,{OtherHost:Nt,Mockup:Mt,AppId:Pn}=In;class Sn{constructor(){u(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await at(async()=>{const{default:t}=await v.import("./bundle/LeaderboardAPIMock.js");return{default:t}},void 0,v.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new e}async getLeadersAsync(e,t,s){const a=ns.params(s);let n;return Mt.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in s?n=await this.mockAPI.getPlayers(e,s):n=await this.mockAPI.getLeaders(e,s)):n=await ft(`${t}?${a}`,{},Nt),!bt.hasOwn(n,"data")||!Array.isArray(n.data)?[]:n.data}async getLeaderboardAsync(e){let t;const s=`leaderboards/${e}`;return Mt.Leaderboards.Enabled?(await this.initMockAPI(),t=await this.mockAPI.getLeaderboardAsync(e)):(t=await ft(s,{},Nt),bt.hasOwn(t,"data")&&is.isObject(t.data)&&(t=t.data)),t}async getLeaderboardsAsync(e){let t;const s=p.Utils.String.params(e);return Mt.Leaderboards.Enabled?(await this.initMockAPI(),t=await this.mockAPI.getLeaderboardsAsync(e)):(t=await ft(`leaderboards?${s}`,{},Nt),bt.hasOwn(t,"data")&&Array.isArray(t.data)?t=t.data:t=[]),t}async setLeaderboardScoreAsync(e){const{leaderboardId:t,playerId:s,score:a}=e;Mt.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(t,s,a)):await _(`leaderboards/${t}/players/${s}`,{score:a},{},Nt)}async createLeaderboardAsync(e){const t=e._id??ns.generateObjectId(),s=e.numberOfLeaders,a={...An,...e,_id:t,appId:Pn,numberOfLeaders:s},n="leaderboards";let i;if(Mt.Leaderboards.Enabled?(await this.initMockAPI(),i=await this.mockAPI.createLeaderboard(a)):(i=await _(n,a,{},Nt),bt.hasOwn(i,"data")&&is.isObject(i.data)&&(i=i.data)),!bt.hasOwn(i,"_id")||i._id!==t)throw new Error("Create leaderboard failed");return t}}const rs={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},En={leaderboards:{}},{Array:vn,Valid:xn,Json:os,Object:Ut}=p.Utils;class Cn extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"lbAPI",new Sn);u(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",En),this.configs={}}addLeaderboard(t){const{name:s,type:a,leaderboardId:n,autoSortRank:i}=t;if(this.getLeaderboard(s))return;let o=`leaderboards/${n}/`;(a==="global"||a==="tournament")&&(o+="leaders"),a==="friends"&&(o+="players"),this.configs[s]={id:n,name:s,type:a,host:o,autoSortRank:i};const l=os.clone(rs);this.setLeaderboard(s,{...l})}async requestLeaderboardsAsync(t){try{return await this.lbAPI.getLeaderboardsAsync(t)}catch{return[]}}async requestLeaderboardAsync(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{id:a,type:n,host:i}=this.configs[t];let r=[];if(n==="friends"){const{player:o}=this.game,l=o.getPlayerId(),d=o.getConnectedPlayerIds(s,0),h=[l,...d];this.configs[t].playerIds=[...h],r=await this.lbAPI.getLeadersAsync(a,i,{playerIds:h})}else r=await this.lbAPI.getLeadersAsync(a,i,{limit:s,offset:0});if(r.length===0)return;await this.receiveLeaderboardAsync(t,r),this.setLeaderboard(t,{limit:s,offset:0})}finally{const a=await this.lbAPI.getLeaderboardAsync(this.configs[t].id),n=a?a.resettable:"",i=a?a.amountPlayer:0;this.setLeaderboard(t,{isRequesting:!1,resettable:n,amountPlayer:i})}}async loadMoreLeaderboardAsync(t,s){const a=this.getLeaderboard(t);if(a&&this.configs[t].type!=="friends")try{this.setLeaderboard(t,{isRequesting:!0});const{id:n,host:i}=this.configs[t],{offset:r,limit:o}=a,l=r+o,d=await this.lbAPI.getLeadersAsync(n,i,{limit:s,offset:l});if(d.length===0)return;this.receiveLeaderboardAsync(t,d),this.setLeaderboard(t,{limit:s,offset:l})}finally{this.setLeaderboard(t,{isRequesting:!1})}}getLeaderboard(t){const{storage:s}=this.game,a=s.getStorageData("leaderboard","leaderboards");return!a||!a[t]?null:a[t]}async getLeadersByPlayerIdsAsync(t,s){try{this.validateLeaderboard(t);const{id:a}=this.configs[t],n=`leaderboards/${a}/players`,i=await this.lbAPI.getLeadersAsync(a,n,{playerIds:s});return i.length===0?[]:this.toLeaders(i)}catch{return[]}}async getLeaderboardResponseAsync(t){return await this.lbAPI.getLeaderboardAsync(t)}clearLeaderboard(t){try{this.validateLeaderboard(t);const s=os.clone(rs);this.setLeaderboard(t,null),this.setLeaderboard(t,{...s})}catch{}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:a}=s;return Object.keys(a).length===0}isExistLeaderboardId(t){const{configs:s}=this;return Ut.vals(s).some(a=>a.id===t)}getLeaderboardName(t){const{configs:s}=this,a=vn.search(Ut.vals(s),n=>n.id===t);return a?a.name:null}async setLeaderboardScoreAsync(t,s,a){try{this.validateLeaderboard(t);const{id:n}=this.configs[t],i=await this.getLastScoreOnLeaderboard(t,s);if(i&&a<=i)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:n,playerId:s,score:a})}catch{}}async getLastScoreOnLeaderboard(t,s){const a=await this.getLeadersByPlayerIdsAsync(t,[s]);return a.length===0?null:a[0].score}async createLeaderboardAsync(t){return this.lbAPI.createLeaderboardAsync(t)}validateLeaderboard(t){const s=this.getLeaderboard(t);if(!xn.isObject(s))throw new Error(`Leaderboard with name ${t} not found`)}setLeaderboard(t,s){const{storage:a}=this.game;a.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboardAsync(t,s){this.validateLeaderboard(t);const n=(await this.toLeaders(s)).filter(h=>h.name&&h.photo),{offset:i=0,leaders:r={}}=this.getLeaderboard(t)??{},o=n.filter(h=>!r[h.playerId]);if(i>0&&o.length>0){const h=Ut.vals(r);o.unshift(...h)}let l=o.sort((h,y)=>y.score-h.score);this.configs[t].autoSortRank&&(l=l.map((h,y)=>({...h,rank:y+1})));const d=Ut.keyBy(l,"playerId");this.setLeaderboard(t,{leaders:d})}async toLeaders(t){const{profile:s}=this.game,a=t.map(o=>o.playerId);await s.requestProfiles(a);const n=s.getProfiles();return t.map(o=>{const{playerId:l}=o,d=n[l];return d?{...o,name:d.name,photo:d.photo}:{...o,name:"Nameless",photo:"default"}}).map(o=>({...o,score:Number.parseInt(o.score,10)}))}}class bn{constructor(){u(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}}const{Utils:cs}=p;class Nn extends bn{async createSingleMatchAsync(e){const s=await _("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await ft("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,a=await _(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await _(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createEndlessMatchAsync(e){const s=await _("endless-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getEndlessMatchDetailAsync(){const t=await ft("endless-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateEndlessMatchMilestoneAsync(e,t){const s=`endless-matches/${e}/milestone`,a=await _(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishEndlessMatchAsync(e){const t=`endless-matches/${e}/finish`,s=await _(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await _("matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await _(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await ft(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:a=0,extraData:n={}}=e,i=`matches/${t}/finish`,r=await _(i,{matchId:t,score:s,level:a,extraData:n},{},this.getAPIHost());return this.returnValidMatchData(r)}returnValidMatchData(e){let t={};return!cs.Valid.isObject(e)||!cs.Object.hasOwn(e,"data")||(t=e.data),t}}class Mn{constructor(e){u(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new Nn}setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}setMatchAPIInstance(e){this.matchAPI=e}getMatchAPI(){return this.matchAPI}}class P{constructor(e,t){u(this,"game");u(this,"match");this.game=e,this.match=t}startLog(e){}endLog(){}async processAsync(e){throw new Error("Not implemented")}}class ls extends q{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}}class Ee extends q{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}}const{Object:ko,Valid:Ln}=p.Utils;class w{constructor(e){u(this,"game");u(this,"match");u(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){this.logData("Before",e)}async nextAsync(e){this.logData("After",e),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){Ln.isDebugger()}}const{Plugins:Tn,Utils:_n}=p,{Analytics:On}=Tn,{String:ds,Valid:hs}=_n;class U extends w{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e,{level:a}=s;this.validateMode(t),this.validateLevel(a);const{analytics:n}=this.game;n.event(On.Events.MATCH_START,{level:a,game_mode:ds.toUpperCamelCase(t),level_name:this.getLevelName(a)}),await this.nextAsync(e)}validateMode(e){if(!hs.isString(e))throw new Ee}validateLevel(e){if(!hs.isNumber(e))throw new ls}getLevelName(e){return`Level ${ds.padStart(e.toString(),5,"0")}`}}const G={OPEN:"open",ACTIVE:"active",FINISHED:"finished"};class N extends w{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let a=t??mt.SINGLE;s===G.FINISHED&&(a=mt.SINGLE),this.contextGameModeDetected(a),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}}class ve extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}}class us extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}}class J extends q{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}}class Rn extends Error{constructor(e){super(e),this.name="OpponentHasFinishedMatch",this.message=e||"Opponent has finished match"}}class $ extends q{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}}class xe extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e??"The player is not currently in this match"}}class ys extends Error{constructor(e){super(e),this.name="PlayerNotFinishedMatch",this.message=e||"Player not finished match"}}const{Dtos:Gn}=p;class Fn extends w{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Gn.Match.Data(t).toObject();this.validateAwaitMatchData(e,s),this.updateMatchData(e,s),this.validateMatchStatus(e),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new J}validateMatchStatus(e){const{status:t}=e;if(t!==G.ACTIVE)throw new us}validateAwaitMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:r}=t;if(typeof n!="string"||n!==s)throw new ve;const{playerId:o}=a,l=i===o,d=r===o;if(!l&&r===z.playerId)throw new he;if(!l&&!d)throw new xe}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(!n)throw new ys}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new $;const{finished:n}=t[a];if(n)throw new Rn}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:o,blackPlayerFinish:l,status:d}=t;e.status=d;const h=a===s.playerId,y=h?a:n,f=h?n:a;e.customData.playerId=y,e.customData.opponentId=f,e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1}),e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1});const g=h?i:r,A=h?r:i;e.profiles[y].score=g,e.profiles[f].score=A;const m=h?o:l,x=h?l:o;e.profiles[y].finished=m,e.profiles[f].finished=x}}const Ce={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null};class k extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:a,customData:n}=this.payload;t.id=s??null,t.mode=a||null,t.status=G.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...Ce,...t.customData,...n}}}const wt=it;class S extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}}class K extends q{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}}class $n extends w{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAwaitingAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new J;if(!a||typeof a!="string")throw new K;if(!n||typeof n!="string")throw new $}async createWideframesAwaitingAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:l,score:d=0,finished:h}=r;if(!h)return null;const{photo:y,score:f=0,finished:g}=o;return g?null:await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:f,isPlayerFinished:!0,isOpponentFinished:!1})}catch{return null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:o}=a[i],l={data:{type:wt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${o} đang chờ bạn kết thúc trận đấu. Chơi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}}class C extends w{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}}class H extends q{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}}const{Dtos:kn}=p;class ot extends w{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:a}=t;let n=s;const i=await this.getProfile(n);if(!i)throw new H;if(this.updateMatchProfile(e,n,i),n=a,n!==z.playerId){const r=await this.getProfile(n);if(!r)throw new H;this.updateMatchProfile(e,n,r)}else this.updateMatchProfile(e,n);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:a}=t;if(!s||typeof s!="string")throw new D;if(!a||typeof a!="string")throw new $}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:a,photo:n}=s??z,i=new kn.Match.Profile({id:t,name:a,photo:n}).toObject();e.profiles[t]?(e.profiles[t].name=i.name,e.profiles[t].photo=i.photo):e.profiles[t]=i}}class Vn extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new C(this),i=new k(this,{id:t,mode:L.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const r=new Fn(this);i.setNext(r);const o=new ot(this);r.setNext(o);const l=new $n(this);o.setNext(l);const d=new U(this);l.setNext(d);const h=new N(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}}class be extends q{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}}const{Valid:ps,Object:fs}=p.Utils;class Bn extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,a=await this.createAsync(s);t.customData.contextId=a,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(a){this.validateError(a)}const s=GameSDK.context.getID();if(!ps.isString(s))throw new be;return s}validateError(t){if(!fs.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}validateErrorMessage(t){if(!fs.hasOwn(t,"message")||!ps.isString(t.message))throw t}isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.indexOf("is not a connected player of the current player")>-1}}class Ht extends q{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}}const{Dtos:Un}=p;class gs extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t);const s=await this.createMatchAsync(t),a=new Un.Match.Data(s).toObject();this.updateMatchState(t,a),await this.nextAsync(t)}validateData(t){const{status:s,customData:a}=t,{opponentId:n}=a;if(typeof n!="string")throw new $;if(s!==G.OPEN)throw new Ht}async createMatchAsync(t){const{opponentId:s}=t.customData,{extraData:a}=this.payload;if(!s)return{};const n={opponentPlayerId:s,extraData:a};return this.match.api.getMatchAPI().createMatchAsync(n)}updateMatchState(t,s){const{customData:a}=t,{_id:n,whitePlayerId:i,blackPlayerId:r,whitePlayerFinish:o,blackPlayerFinish:l}=s,d=i===a.opponentId;t.id=n||null;const h=d?r:i,y=d?i:r;t.customData.playerId=h,t.customData.opponentId=y,t.profiles[h]||(t.profiles[h]={id:h,name:"",photo:"",finished:!1}),t.profiles[y]||(t.profiles[y]={id:y,name:"",photo:"",finished:!1});const f=d?l:o,g=d?o:l;t.profiles[h].finished=f,t.profiles[y].finished=g}}class W extends w{async processAsync(e){if(super.processAsync(e),e.status!==G.OPEN)throw new Ht;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=G.ACTIVE,e.startAt=Date.now()}}class ms extends w{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesChallengeAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new J;if(!a||typeof a!="string")throw new K;if(!n||typeof n!="string")throw new $}async createWideframesChallengeAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:l,score:d=0}=r,{photo:h,score:y=0}=o;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!1,isOpponentFinished:!1})}catch{return null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:o}=a[i],l={data:{type:wt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} challenges you`,localizations:{vi_VN:`${o} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}}class Hn extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,a=new C(this),n=new Bn(this,{opponentId:s});a.setNext(n);const i=new k(this,{mode:L.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});n.setNext(i);const r=new gs(this,{extraData:e.extraData});i.setNext(r);const o=new ot(this);r.setNext(o);const l=new W(this);o.setNext(l);const d=new U(this);l.setNext(d);const h=new ms(this);d.setNext(h);const y=new N(this);h.setNext(y);const f=this.match.getMatchState();await a.processAsync(f)}finally{this.endLog()}}}class Ne extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}}const{Utils:ws}=p;class jt extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",a=GameSDK.context.getID();if(a===t)throw new Ne;if(s&&a===null)throw new Ne}async switchAsync(t){const s=t==="SOLO";try{this.checkSameContext(t),await GameSDK.context.switchAsync(t,s)}catch(a){if(a instanceof Ne)return;if(!ws.Object.hasOwn(a,"code"))throw a;if(ws.Device.isAndroid()&&s&&a.code==="INVALID_PARAM")return;if(a.code!=="SAME_CONTEXT")throw a}}}const{Dtos:jn}=p;class Kn extends w{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new jn.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new J;if(s!==G.OPEN)throw new Ht}validateContinueMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:r}=t;if(typeof n!="string"||n!==s)throw new ve;const{playerId:o}=a,l=i===o,d=r===o;if(!l&&r===z.playerId)throw new he;if(!l&&!d)throw new xe}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(n)throw new Ye}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:o,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const f=d?i:r,g=d?r:i;e.profiles[h].score=f,e.profiles[y].score=g;const A=d?o:l,m=d?l:o;e.profiles[h].finished=A,e.profiles[y].finished=m}}class Wn extends w{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesCurrentScoreAsync();t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new J;if(!a||typeof a!="string")throw new K;if(!n||typeof n!="string")throw new $}async createWideframesCurrentScoreAsync(){try{const{player:e,frameCapture:t}=this.game,{playerId:s,photo:a}=e.getPlayer(),{profiles:n}=this.match.getMatchState(),{score:i=0}=n[s]||{};return await t.wideframe.renderShareScore({playerId:s,playerPhoto:a,playerScore:i})}catch{return null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:o}=a[i],l={data:{type:wt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} made an update.`,localizations:{vi_VN:`${o} đã cập nhật trận đấu. Chơi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(l)}}class zn extends P{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,i=new C(this),r=new jt(this,{contextId:t});i.setNext(r);const o=new k(this,{id:s,mode:L.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:n}});r.setNext(o);const l=new Kn(this);o.setNext(l);const d=new ot(this);l.setNext(d);const h=new W(this);d.setNext(h);const y=new Wn(this);h.setNext(y);const f=new U(this);y.setNext(f);const g=new N(this);f.setNext(g);const A=this.match.getMatchState();await i.processAsync(A)}finally{this.endLog()}}}const{Plugins:qn,Utils:Jn}=p,{Analytics:Yn}=qn,{String:As,Valid:Is}=Jn;class Lt extends w{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:a,finishAt:n}=e,{level:i}=t;this.validateMode(s),this.validateLevel(i);const{analytics:r}=this.game,o=Math.floor((n-a)/1e3);r.event(Yn.Events.MATCH_END,{level:i,game_mode:As.toUpperCamelCase(s),level_name:this.getLevelName(i),time_played:o}),await this.nextAsync(e)}validateMode(e){if(!Is.isString(e))throw new Ee}validateLevel(e){if(!Is.isNumber(e))throw new ls}getLevelName(e){return`Level ${As.padStart(e.toString(),5,"0")}`}}class Kt extends Error{constructor(e){super(e),this.name="ScoreNotValid",this.message=e??"Score is not valid"}}class Tt extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}}class Qn extends Error{constructor(e){super(e),this.name="LeaderboardNotExist",this.message=e??"Leaderboard not exist in game"}}const{Valid:Ds}=p.Utils;class Wt extends w{constructor(t,s){super(t);u(this,"payload");u(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.setupSetScorePayload(t),"submitGameResultsAsync"in GameSDK.extra&&await GameSDK.extra.submitGameResultsAsync(this.payload.score),this.setLeaderboardScoreAsync(),await this.nextAsync(t)}async setupSetScorePayload(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(!n||!s[n])throw new H;const{score:i,leaderboardId:r}=this.payload;if(!Ds.isNumber(i))throw new Kt;if(!Ds.isString(r))throw new Tt;this.leaderboardPayload={score:i,playerId:n,leaderboardId:r}}async setLeaderboardScoreAsync(){try{const{playerId:t,score:s,leaderboardId:a}=this.leaderboardPayload,n=this.game.leaderboard.getLeaderboardName(a);if(!n)throw new Qn;await this.game.leaderboard.setLeaderboardScoreAsync(n,t,s)}catch{}}}const{Valid:Xn}=p.Utils,{Leaderboards:Zn}=p.Configs;class Me extends Wt{constructor(e){super(e,{score:0,leaderboardId:Zn.LeaderboardId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new H;const{score:n}=t[a];if(!Xn.isNumber(n))throw new Kt;this.payload.score=n,super.setupSetScorePayload(e)}}const{Dtos:ti,Utils:ei}=p,{Valid:zt,Object:si}=ei;class _t extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateMatchData(t);const{useAPI:s}=this.payload;if(s){const a=await this.finishMatchAsync(t),n=new ti.Match.Data(a).toObject();this.updateMatchFromAPI(t,n)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}validateMatchData(t){const{status:s,profiles:a,customData:n}=t;if(s!==G.ACTIVE)throw new us;const{playerId:i}=n;if(!i||!si.hasOwn(a,i))throw new xe}updateMatchData(t){const{playerId:s}=t.customData;if(!zt.isString(s))throw new D;t.profiles[s].finished=!0}updateMatchState(t){t.status=G.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:a,customData:n}=t,{level:i,playerId:r}=n;if(!zt.isString(r))throw new D;const{score:o}=a[r],{extraData:l}=this.payload,d={matchId:s??"",score:o,level:i,extraData:l};return this.match.api.getMatchAPI().finishMatchAsync(d)}updateMatchFromAPI(t,s){const{playerId:a,opponentId:n}=t.customData;if(!zt.isString(a))throw new D;if(!zt.isString(n))throw new $;const{whitePlayerId:i,whitePlayerScore:r,blackPlayerScore:o,whitePlayerFinish:l,blackPlayerFinish:d}=s,h=a===i,y=h?r:o,f=h?o:r,g=h?l:d,A=h?d:l;t.profiles[a].score=y,t.profiles[n].score=f,t.profiles[a].finished=g,t.profiles[n].finished=A}}class ai extends w{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync(e);t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new J;if(!a||typeof a!="string")throw new K;if(!n||typeof n!="string")throw new $}async createWideframesResultAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:l,score:d=0,finished:h}=r,{photo:y,score:f=0,finished:g}=o;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:f,isPlayerFinished:!!h,isOpponentFinished:!!g})}catch{return null}}progressSendFinishedMessage(e,t){const{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||typeof n!="string")throw new D;if(!i||typeof i!="string")throw new $;const{score:r=0,finished:o}=s[n],{score:l=0,finished:d}=s[i];o?this.sendFinishMessageAsync(e,t):d&&r>l?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:o}=a[i],l={data:{type:wt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:G.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${o} just finished. Check them now.`,localizations:{vi_VN:`${o} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(l)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;const{name:o,score:l}=a[i],d={data:{type:wt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:G.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} got ${l} scores. So easy! Can you?`,localizations:{vi_VN:`${o} đã đạt ${l} điểm! Nhấn Chơi để so tài!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(d)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;const{name:o,score:l}=a[i],d={data:{type:wt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:G.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${o} beat your high score. Their score: ${l}`,localizations:{vi_VN:`${o} đã vượt qua điểm số của bạn, với ${l} điểm!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(d)}}class qt extends w{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new H;const{player:n}=this.game,i=n.getBestScore()||0,{score:r=0}=t[a];r<=i||(n.setBestScore(r),t[a].bestScore=r)}}class ni extends P{async processAsync(e){try{this.startLog(e);const{extraData:t}=e??{},s=new C(this),a=new _t(this,{useAPI:!0,extraData:t});s.setNext(a);const n=new ai(this);a.setNext(n);const i=new Lt(this);n.setNext(i);const r=new qt(this);i.setNext(r);const o=new Me(this);r.setNext(o);const l=new N(this);o.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}class ii extends Error{constructor(e){super(e),this.name="ContextAreSolo",this.message=e??"Context are solo"}}class ri extends Error{constructor(e){super(e),this.name="ContextNotChallenge",this.message=e??"Context is not a challenge"}}class oi extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}}const{Utils:ci,Dtos:li}=p,{Array:di,Object:hi}=ci;class Ps extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new K;if(t==="SOLO")throw new ii}async getOpponentIdFromContextAsync(){const{ignoreId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new ri;let a=z;return s.length===1&&(a=s[0]),a.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),a=[];for(const n of s){const i=n.getID();if(t.indexOf(i)>-1)continue;const r=n.getName();if(!r)continue;const o=n.getPhoto();a.push(new li.Player.Info({playerId:i,name:r,photo:o}).toObject())}return di.unique(a)}catch(s){if(hi.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new oi;return[]}}}class Le extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}}const{Object:ui}=p.Utils;class yi extends w{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!ui.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new be;return e}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new Le):new S("getTournamentAsync")}catch(e){if(e instanceof Le)throw e}}}class pi extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new C(this),a=new yi(this);s.setNext(a);const n=new k(this,{mode:L.CHALLENGE_FRIEND,customData:{playerId:t}});a.setNext(n);const i=new Ps(this,{ignoreId:t});n.setNext(i);const r=new gs(this,{extraData:e.extraData});i.setNext(r);const o=new ot(this);r.setNext(o);const l=new W(this);o.setNext(l);const d=new U(this);l.setNext(d);const h=new ms(this);d.setNext(h);const y=new N(this);h.setNext(y);const f=this.match.getMatchState();await s.processAsync(f)}finally{this.endLog()}}}class fi extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}}class gi extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}}class mi extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}}const{Dtos:wi}=p;class Ai extends w{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new wi.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==G.OPEN)throw new Ht}validateJoinMatchData(e,t){const{id:s,customData:a}=e,{_id:n,blackPlayerId:i,whitePlayerId:r,whitePlayerFinish:o,blackPlayerFinish:l}=t,d=i===a.playerId,h=r===a.opponentId;if(typeof n!="string"||n!==s||!h)throw new fi;if(o&&l)throw new gi;if(!d)throw new mi}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:o,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const f=d?i:r,g=d?r:i;e.profiles[h].score=f,e.profiles[y].score=g;const A=d?o:l,m=d?l:o;e.profiles[h].finished=A,e.profiles[y].finished=m}}class Ii extends w{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAcceptedAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new J;if(!a||typeof a!="string")throw new K;if(!n||typeof n!="string")throw new $}async createWideframesAcceptedAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:l,score:d=0,finished:h}=r;if(h)return null;const{photo:y,score:f=0,finished:g}=o;return g?await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:f,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch{return null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:o}=a[i],l={data:{type:wt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} accepted the challenge.`,localizations:{vi_VN:`${o} đã chấp nhận tham gia trận đấu.`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}}class Di extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new C(this),i=new k(this,{id:t,mode:L.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const r=new Ai(this);i.setNext(r);const o=new ot(this);r.setNext(o);const l=new W(this);o.setNext(l);const d=new Ii(this);l.setNext(d);const h=new U(this);d.setNext(h);const y=new N(this);h.setNext(y);const f=this.match.getMatchState();await n.processAsync(f)}finally{this.endLog()}}}const Ss={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},{Valid:Y}=p.Utils,Q="is invalid";class Te extends T{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Y.isString(e)||!e)&&this.exception("_id",Q)}validateStatus(e){(!Y.isString(e)||!e)&&this.exception("status",Q)}validateWinnerId(e){e!==null&&(!Y.isString(e)||!e)&&this.exception("winnerId",Q)}validateWhitePlayerId(e){(!Y.isString(e)||!e)&&this.exception("whitePlayerId",Q)}validateBlackPlayerId(e){(!Y.isString(e)||!e)&&this.exception("blackPlayerId",Q)}validateWhitePlayerScore(e){Y.isNumber(e)||this.exception("whitePlayerScore",Q)}validateBlackPlayerScore(e){Y.isNumber(e)||this.exception("blackPlayerScore",Q)}validateWhitePlayerFinish(e){Y.isBoolean(e)||this.exception("whitePlayerFinish",Q)}validateBlackPlayerFinish(e){Y.isBoolean(e)||this.exception("blackPlayerFinish",Q)}toObject(){return super.toObject()}static getDefaultData(){return Ss}}Te.addDefaultData(Ss);class Pi extends Error{constructor(e){super(e),this.name="MatchAreNotFinished",this.message=e||"Match are not finished"}}class Si extends Error{constructor(e){super(e),this.name="OpponentNotFinishedMatch",this.message=e||"Opponent not finished match"}}class Ei extends w{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Te(t).toObject();this.validateResultMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new J}validateResultMatchData(e,t){const{id:s}=e,{_id:a,whitePlayerFinish:n,blackPlayerFinish:i}=t;if(typeof a!="string"||a!==s)throw new ve;if(!n&&!i)throw new Pi}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(!n)throw new ys}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new $;const{finished:n}=t[a];if(!n)throw new Si}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:o,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!0}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!0});const f=d?i:r,g=d?r:i;e.profiles[h].score=f,e.profiles[y].score=g;const A=d?o:l,m=d?l:o;e.profiles[h].finished=A,e.profiles[y].finished=m}}class vi extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new C(this),i=new k(this,{id:t,mode:L.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const r=new Ei(this);i.setNext(r);const o=new ot(this);r.setNext(o);const l=new N(this);o.setNext(l);const d=this.match.getMatchState();await n.processAsync(d)}finally{this.endLog()}}}class xi extends P{constructor(){super(...arguments);u(this,"fallbackSingleMode");u(this,"startFLowChallengeFriend",async t=>{try{return await this.match.challenge.invite.processAsync(t),!0}catch(s){return s}});u(this,"startFlowTournament",async t=>{try{const s=GameSDK.context.getID();if(typeof s!="string")throw new K;await this.match.tournament.continue.processAsync({playerId:t,contextId:s})}catch{await this.startFlowSingle(t)}});u(this,"startFlowSingle",async t=>{this.fallbackSingleMode&&await this.match.single.start.processAsync({playerId:t})})}async processAsync(t){try{this.startLog(t);const{playerId:s,extraData:a,fallbackSingleMode:n}=t;this.fallbackSingleMode=n;const i=await this.startFLowChallengeFriend({playerId:s,extraData:a});if(i===!0)return;i instanceof Le?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}}const{Valid:Ci}=p.Utils,{Leaderboards:bi}=p.Configs;class Ni extends Wt{constructor(e){super(e,{score:0,leaderboardId:bi.LeaderboardEndlessId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new H;const{endlessScore:n}=t[a];if(!Ci.isNumber(n))throw new Kt;this.payload.score=n,super.setupSetScorePayload(e)}}class Mi extends w{async processAsync(e){super.processAsync(e),this.setPlayerEndlessScore(e),await this.nextAsync(e)}setPlayerEndlessScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new H;const{player:n}=this.game,i=n.getBestEndlessScore()??0,{endlessScore:r=0}=t[a],o=i<r?r:i;n.setBestEndlessScore(o),t[a].bestEndlessScore=o}}class Li extends P{async processAsync(){try{this.startLog();const e=new C(this),t=new _t(this,{useAPI:!1});e.setNext(t);const s=new Lt(this);t.setNext(s);const a=new Mi(this);s.setNext(a);const n=new Ni(this);a.setNext(n);const i=new N(this);n.setNext(i);const r=this.match.getMatchState();await e.processAsync(r)}finally{this.endLog()}}}class Ti extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}}const{Dtos:_i}=p;class Ot extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new Ti;const{player:a}=this.game,n=a.getPlayerId();let i;if(s===n)i=this.getPlayerProfile();else if(i=await this.getProfileAsync(s),!i)throw new H;this.updateMatchData(i,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:a,photo:n,locale:i}=t.getPlayer();return{playerId:s,name:a,photo:n,locale:i}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:a,name:n,photo:i}=t,r=new _i.Match.Profile({id:a,name:n,photo:i}).toObject();s.profiles[a]=r}}class Oi extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new C(this),a=new jt(this,{contextId:"SOLO"});s.setNext(a);const n=new k(this,{id:"234567",mode:L.ENDLESS,customData:{playerId:t}});a.setNext(n);const i=new W(this);n.setNext(i);const r=new Ot(this,{profileId:t});i.setNext(r);const o=new U(this);r.setNext(o);const l=new N(this);o.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}const{Valid:Ri}=p.Utils;class _e extends Wt{constructor(e){super(e,{score:0,leaderboardId:""})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a,leaderboardId:n}=s;if(!n)throw new Tt;if(!a||!t[a])throw new H;const{score:i}=t[a];if(!Ri.isNumber(i))throw new Kt;this.payload.score=i,this.payload.leaderboardId=n,super.setupSetScorePayload(e)}}class Gi extends w{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new J;if(!a||typeof a!="string")throw new K;if(!n||typeof n!="string")throw new $}async createWideframesResultGroupAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:l,score:d=0}=r,{photo:h,score:y=0}=o;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!0,isOpponentFinished:!0})}catch{return null}}async createWideframesBestScoreAsync(e){try{const{player:t,frameCapture:s}=this.game,{playerId:a}=e.customData,{playerId:n,photo:i,data:r}=t.getPlayer();if(a!==n)return null;const{score:o}=r||{};return await s.wideframe.renderShareScore({playerId:n,playerPhoto:i,playerScore:o})}catch{return null}}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:a,opponentId:n}=s;if(n&&typeof n=="string"){if(!a||typeof a!="string")throw new D;const{score:r=0}=t[a]||{},{score:o=0}=t[n]||{};if(r>o){const l=await this.createWideframesResultGroupAsync(e);if(!l)return;this.sendBestScoreMessageAsync(e,l);return}}const i=await this.createWideframesBestScoreAsync(e);i&&this.sendChallengeMessageAsync(e,i)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:i,score:r}=s[n],l={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:r},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:`${i} beats your high score. Their score: ${r}.`,localizations:{vi_VN:`${i} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(l)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new D;const{name:i,score:r}=s[n],l={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:r},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${i} got ${r} scores. So easy! Can you?`,localizations:{vi_VN:`${i} đã đạt ${r} điểm! Quá dễ luôn. Chơi lại nào!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(l)}}class Fi extends P{async processAsync(){try{this.startLog();const e=new C(this),t=new _t(this,{useAPI:!1});e.setNext(t);const s=new Gi(this);t.setNext(s);const a=new Lt(this);s.setNext(a);const n=new qt(this);a.setNext(n);const i=new _e(this);n.setNext(i);const r=new N(this);i.setNext(r);const o=this.match.getMatchState();await e.processAsync(o)}finally{this.endLog()}}}const{Dtos:$i}=p;class Jt extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:a}=t;if(!a[s])throw new H;const n={...a[s],...this.payload},i=new $i.Match.Profile(n).toObject();a[i.id]=i}}class ki extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:a}=e,n=new C(this),i=new k(this,{id:"7749",mode:L.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});n.setNext(i);const r=new ot(this);i.setNext(r);const o=new Jt(this,{id:t,score:a});r.setNext(o);const l=new W(this);o.setNext(l);const d=new U(this);l.setNext(d);const h=new N(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}}class Es extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}}class Vi extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=await this.matchingGroup();t.customData.contextId=s,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new S("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new S("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new Es;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new Es}async matchingGroup(){if(!("matchPlayerAsync"in GameSDK.extra))throw new S("matchPlayerAsync");const{matchTag:t,autoSwitch:s=!1,onlyExisting:a=!1}=this.payload;await GameSDK.extra.matchPlayerAsync(t,s,a);const n=GameSDK.context.getID();if(typeof n!="string")throw new be;return n}}class Bi extends P{async processAsync(e){try{this.startLog(e);const{matchTag:t,playerId:s,options:a}=e,n=new C(this),i=new Vi(this,{matchTag:t,...a});n.setNext(i);const r=new k(this,{id:"7749",mode:L.MATCHING_GROUP,customData:{playerId:s}});i.setNext(r);const o=new Ps(this,{ignoreId:s});r.setNext(o);const l=new W(this);o.setNext(l);const d=new ot(this);l.setNext(d);const h=new U(this);d.setNext(h);const y=new N(this);h.setNext(y);const f=this.match.getMatchState();await n.processAsync(f)}finally{this.endLog()}}}class Ui extends P{async processAsync(){try{this.startLog();const e=new C(this),t=new _t(this,{useAPI:!1});e.setNext(t);const s=new Lt(this);t.setNext(s);const a=new qt(this);s.setNext(a);const n=new Me(this);a.setNext(n);const i=new N(this);n.setNext(i);const r=this.match.getMatchState();await e.processAsync(r)}finally{this.endLog()}}}class Hi extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new C(this),a=new jt(this,{contextId:"SOLO"});s.setNext(a);const n=new k(this,{id:"123456",mode:L.SINGLE,customData:{playerId:t}});a.setNext(n);const i=new W(this);n.setNext(i);const r=new Ot(this,{profileId:t});i.setNext(r);const o=new U(this);r.setNext(o);const l=new N(this);o.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}const{Plugins:ji,Utils:Ki}=p,{Analytics:Wi}=ji,{String:zi,Valid:qi}=Ki;class vs extends w{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e;this.validateMode(t);const{analytics:a}=this.game,{tournamentId:n,leaderboardId:i}=s;a.event(Wi.Events.TOURNAMENT_START,{success:!0,game_mode:zi.toUpperCamelCase(t),tournament_id:n,leaderboard_id:i}),await this.nextAsync(e)}validateMode(e){if(!qi.isString(e))throw new Ee}}class xs extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}}const{Valid:Oe}=p.Utils;class Ji extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s);const a=await GameSDK.getTournamentAsync(),n=a.getID().toString();this.validateTournamentId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:r}=i;this.validateLeaderboardId(r),t.customData.contextId=s,t.customData.tournamentId=n,t.customData.leaderboardId=r,await this.nextAsync(t)}validateContextId(t){if(!Oe.isString(t))throw new K}validateTournamentId(t){if(!Oe.isString(t))throw new xs}validateLeaderboardId(t){if(!Oe.isString(t)||t==="")throw new Tt}}class Yi extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,a=new C(this),n=new Ji(this,{contextId:s});a.setNext(n);const i=new k(this,{id:"1997",mode:L.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const r=new W(this);i.setNext(r);const o=new Ot(this,{profileId:t});r.setNext(o);const l=new U(this);o.setNext(l);const d=new vs(this);l.setNext(d);const h=new N(this);l.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}}const{Plugins:Qi}=p,{Analytics:Xi}=Qi;class Zi extends w{async processAsync(e){super.processAsync(e);const{customData:t}=e,{analytics:s}=this.game,{tournamentId:a,leaderboardId:n}=t;s.event(Xi.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:a,leaderboard_id:n}),await this.nextAsync(e)}}class tr extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.createTournamentAsync(),await this.updateMatchStateAsync(t),await this.nextAsync(t)}async createTournamentAsync(){const{name:t,score:s,customData:a}=this.payload;await GameSDK.tournament.createAsync({initialScore:s,config:{title:t,tournamentTitle:t},data:a})}async updateMatchStateAsync(t){try{if(!("getTournamentAsync"in GameSDK))throw new S("getTournamentAsync");const s=await GameSDK.getTournamentAsync(),a=s.getContextID(),n=s.getID().toString(),{playerId:i}=this.payload;t.customData.playerId=i,t.customData.contextId=a,t.customData.tournamentId=n}catch(s){if(s instanceof S)return}}}const{Valid:Cs}=p.Utils;class er extends w{constructor(t,s){super(t);u(this,"payload");u(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.validatePayload(),await this.setupCreatePayload(t),await this.createLeaderboardAsync(t),await this.nextAsync(t)}validatePayload(){const{leaderboardId:t}=this.payload;if(!Cs.isString(t))throw new Tt}validatePlayerId(t){if(!Cs.isString(t))throw new D}async setupCreatePayload(t){const{playerId:s}=t.customData;this.validatePlayerId(s);const{name:a,leaderboardId:n,customData:i}=this.payload;this.leaderboardPayload={_id:n,name:a??"",createdBy:s,description:JSON.stringify(i)}}async createLeaderboardAsync(t){const s=await this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload);t.customData.leaderboardId=s}}class sr extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,name:s,score:a,leaderboardId:n,payload:i}=e,r=new C(this),o=new jt(this,{contextId:"SOLO"});r.setNext(o);const l=new tr(this,{name:s,score:a,playerId:t,customData:i});o.setNext(l);const d=new Ot(this,{profileId:t});l.setNext(d);const h=new Jt(this,{id:t,score:a});d.setNext(h);const y=new er(this,{name:s,customData:i,leaderboardId:n});h.setNext(y);const f=new _e(this);y.setNext(f);const g=new Zi(this);f.setNext(g);const A=this.match.getMatchState();await r.processAsync(A)}finally{this.endLog()}}}const{Analytics:bs}=p.Plugins,{Valid:ar}=p.Utils;class nr extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),await this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(this.validatePlayerId(n),!s[n])throw new H}validatePlayerId(t){if(!ar.isString(t))throw new D}getPlayerProfile(t){const{profiles:s,customData:a}=t,{playerId:n}=a;return this.validatePlayerId(n),s[n]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:a=0,bestScore:n=0}=s;return a>n}async postScoreTournamentAsync(t){const{analytics:s}=window.game,a=this.getPlayerProfile(t),{score:n=0}=a;let i=null,r=!1;const{checkBestScore:o}=this.payload,l=this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new S("getTournamentAsync");await GameSDK.getTournamentAsync(),!o||l?(i=bs.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:n})):(i=bs.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(n)),r=!0}catch{}finally{i&&s.event(i,{success:r})}}}class ir extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,bestScore:s}=e,a=new C(this),n=new _t(this,{useAPI:!1});a.setNext(n);const i=new Jt(this,{id:t,bestScore:s});n.setNext(i);const r=new nr(this,{checkBestScore:!1});i.setNext(r);const o=new Lt(this);r.setNext(o);const l=new qt(this);o.setNext(l);const d=new _e(this);l.setNext(d);const h=new Me(this);d.setNext(h);const y=new N(this);h.setNext(y);const f=this.match.getMatchState();await a.processAsync(f)}finally{this.endLog()}}}const{Valid:Re,Object:rr}=p.Utils;class or extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const a=await GameSDK.getTournamentAsync(),n=a.getContextID();this.validateContextId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:r}=i;this.validateLeaderboardId(r),t.customData.contextId=n,t.customData.tournamentId=s,t.customData.leaderboardId=r,await this.nextAsync(t)}validateTournamentId(t){if(!Re.isString(t))throw new xs}validateContextId(t){if(!Re.isString(t))throw new K}validateLeaderboardId(t){if(!Re.isString(t)||t==="")throw new Tt}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new S("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!rr.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}}class cr extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,a=new C(this),n=new or(this,{tournamentId:s});a.setNext(n);const i=new k(this,{id:"1997",mode:L.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const r=new W(this);i.setNext(r);const o=new Ot(this,{profileId:t});r.setNext(o);const l=new U(this);o.setNext(l);const d=new vs(this);l.setNext(d);const h=new N(this);d.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}}const{Dtos:lr,Utils:dr}=p,{Object:hr}=dr;class ur extends w{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateMatchCustomData(t),await this.nextAsync(t)}updateMatchCustomData(t){const s=hr.merge(t.customData,this.payload),a=new lr.Match.CustomData(s).toObject();t.customData=a}}const yr={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...Ce}},{Configs:Ns}=p;class pr extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"base");u(this,"group");u(this,"single");u(this,"endless");u(this,"context");u(this,"challenge");u(this,"tournament");u(this,"api");u(this,"handler");u(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",yr)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createBaseConcrete(){this.base=new P(this.game,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:async t=>{const s=new Jt(this.base,t);await this.processHandlerAsync(s)},setMatchCustomData:async t=>{const s=new ur(this.base,t);await this.processHandlerAsync(s)},setLeaderboardScore:async t=>{const s=new Wt(this.base,t);await this.processHandlerAsync(s)}}}createAPIHandler(){const t={appId:Ns.AppId,matchAPIHost:Ns.ApiHost};this.api=new Mn(t)}createGroupFlows(){this.group={join:new ki(this.game,this),start:new Bi(this.game,this),finish:new Fi(this.game,this)}}createSingleFlows(){this.single={start:new Hi(this.game,this),finish:new Ui(this.game,this)}}createEndlessFlows(){this.endless={start:new Oi(this.game,this),finish:new Li(this.game,this)}}createContextFlows(){this.context={choose:new xi(this.game,this)}}createChallengeFlows(){this.challenge={invite:new pi(this.game,this),friend:new Hn(this.game,this),join:new Di(this.game,this),await:new Vn(this.game,this),result:new vi(this.game,this),finish:new ni(this.game,this),continue:new zn(this.game,this)}}createTournamentFlows(){this.tournament={join:new cr(this.game,this),create:new sr(this.game,this),finish:new ir(this.game,this),continue:new Yi(this.game,this)}}processHandlerAsync(t){const s=this.getMatchState();return t.processAsync(s)}}const{Valid:At}=p.Utils,It="is invalid";class Ms extends T{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!At.isNumber(e)||e<0)&&this.exception("level",It)}validateRescued(e){(!At.isNumber(e)||e<0)&&this.exception("rescued",It)}validateContextId(e){At.isString(e)||this.exception("contextId",It)}validatePlayerId(e){At.isString(e)||this.exception("playerId",It)}validateOpponentId(e){At.isString(e)||this.exception("opponentId",It)}validateTournamentId(e){At.isString(e)||this.exception("tournamentId",It)}validateLeaderboardId(e){At.isString(e)||this.exception("leaderboardId",It)}toObject(){return super.toObject()}static getDefaultData(){return T.getDefaultData()}}Ms.addDefaultData(Ce);const{Valid:ct}=p.Utils,lt="is invalid";class Ls extends T{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!ct.isString(e)||!e)&&this.exception("id",lt)}validateName(e){(!ct.isString(e)||!e)&&this.exception("name",lt)}validatePhoto(e){ct.isString(e)||this.exception("photo",lt)}validateScore(e){(!ct.isNumber(e)||e<0)&&this.exception("score",lt)}validateBestScore(e){(!ct.isNumber(e)||e<0)&&this.exception("bestScore",lt)}validateEndlessScore(e){(!ct.isNumber(e)||e<0)&&this.exception("endlessScore",lt)}validateBestEndlessScore(e){(!ct.isNumber(e)||e<0)&&this.exception("bestEndlessScore",lt)}validateFinished(e){ct.isBoolean(e)||this.exception("finished",lt)}toObject(){return super.toObject()}static getDefaultData(){return T.getDefaultData()}}Ls.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0}),p.Dtos.Match={Data:Te,CustomData:Ms,Profile:Ls};const{Utils:fr}=p,{ApiHost:gr}=p.Configs,mr=async c=>{let e="players";GameSDK.getSDKName()==="MsGames"&&(e="players?platform=ms-games");const t=await _(e,c,{},gr,10);return fr.Object.hasOwn(t,"data")?t.data||{}:{}},{Utils:wr,Configs:Ar}=p,{AppId:Ir}=Ar,{Array:Dr,Object:Yt,Valid:Pr}=wr;class Sr extends b.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",pt)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch{}}receiveData(e,t){const{storage:s}=this.game,{playerId:a,name:n,photo:i,locale:r}=e;s.setStorageData("player","playerId",a),s.setStorageData("player","name",n),s.setStorageData("player","photo",i),s.setStorageData("player","locale",r),t&&this.setPlayerData(t)}async syncProfileToServer(){const{storage:e}=this.game,t=this.getPlayer(),{playerId:s,name:a,photo:n,locale:i}=t;let r=this.getPlayerASID();!Pr.isString(r)&&"getASIDAsync"in GameSDK.player&&(r=await GameSDK.player.getASIDAsync()??r,e.setStorageData("player","ASID",`${r}`)),await mr({appId:Ir,ASID:r,playerId:s,name:a,photo:n,locale:i})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=Yt.merge(t,e);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(i=>{const r=i.getID(),o=i.getName(),l=i.getPhoto();return!r||!o||!l?null:new Gt({playerId:r,name:o,photo:l}).toObject()}),a=Dr.unique(s);if(a.length<1)return;const n=Yt.keyBy(a,"playerId");e.setStorageData("player","connectedPlayers",n)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerLocale(){const{storage:e}=this.game;return e.getStorageData("player","locale")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return Yt.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return Yt.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??pt.data.isFirstLogin}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:e}=this.getPlayerData();return e}getBestEndlessScore(){const{endlessScore:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,t+e)}getNotificationData(){return this.getPlayerDataByKey("notificationData")??pt.data.notificationData}}const{Dtos:Ts,Utils:Er}=p,{Valid:X}=Er,{score:_s,endlessScore:vr,settings:xr,gameData:Cr,isFirstLogin:br,dailyRewarded:Nr,notificationData:Mr}=pt.data,Z="is invalid";class Os extends T{processData(e){this.validateStructure(e),e.settings=new Ts.Player.Settings(e.settings).toObject(),e.gameData=new Ts.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!X.isNumber(e)||e<0)&&this.exception("score",Z)}validateEndlessScore(e){(!X.isNumber(e)||_s<0)&&this.exception("endlessScore",Z)}validateSettings(e){X.isObject(e)||this.exception("settings",Z)}validateNotificationData(e){X.isObject(e)||this.exception("notificationData",Z),(!("lastSent"in e)||!X.isNumber(e.lastSent))&&this.exception("notificationData.lastSent",Z),(!("currentId"in e)||!X.isNumber(e.currentId))&&this.exception("notificationData.currentId",Z)}validateGameData(e){X.isObject(e)||this.exception("gameData",Z)}validateIsFirstLogin(e){X.isBoolean(e)||this.exception("isFirstLogin",Z)}validateDailyRewarded(e){X.isObject(e)||this.exception("dailyRewarded",Z)}toObject(){return super.toObject()}}Os.addDefaultData({score:_s,endlessScore:vr,settings:xr,gameData:Cr,isFirstLogin:br,dailyRewarded:Nr,notificationData:Mr});const{Valid:Rs}=p.Utils,{level:Lr,coins:Tr}=pt.data.gameData;class Gs extends T{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!Rs.isNumber(e)||e<0)&&this.exception("level","is invalid")}validateCoins(e){(!Rs.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}}Gs.addDefaultData({level:Lr,coins:Tr});const{Valid:Qt}=p.Utils,{sound:_r,music:Or,vibrate:Rr,language:Gr}=pt.data.settings,Xt="is invalid";class Fs extends T{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){Qt.isBoolean(e)||this.exception("sound",Xt)}validateMusic(e){Qt.isBoolean(e)||this.exception("music",Xt)}validateVibrate(e){Qt.isBoolean(e)||this.exception("vibrate",Xt)}validateLanguage(e){(!Qt.isString(e)||!e)&&this.exception("language",Xt)}toObject(){return super.toObject()}}Fs.addDefaultData({sound:_r,music:Or,vibrate:Rr,language:Gr}),p.Dtos.Player={Info:Gt,Data:Os,Settings:Fs,GameData:Gs};const{Configs:Fr,Utils:$r}=p,{Object:kr,String:Vr}=$r,{ApiHost:Br,Mockup:Ur}=Fr;class Hr{constructor(){u(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await at(async()=>{const{default:t}=await v.import("./bundle/ProfileAPIMock.js");return{default:t}},void 0,v.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new e}async getPlayersAsync(e){const t=Vr.params(e);let s;return Ur.Profile.Enabled?(await this.initMockAPI(),s=await this.mockAPI.getPlayersAsync(e)):s=await ft(`players?${t}`,{},Br),!kr.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data}}const jr={profiles:{},profileIds:[]},{Utils:Kr,Dtos:Wr}=p,{Array:$s,Valid:zr,Object:qr,Function:Jr}=Kr;class Yr extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"profileAPI",new Hr)}init(){const{storage:t}=this.game;t.addStorage("profile",jr)}async requestProfiles(t){const s=this.getProfileIds(),a=$s.difference(t,s);if(a.length<1)return;const i=$s.chunk(a,400).map(d=>this.profileAPI.getPlayersAsync({playerIds:d})),o=(await Jr.allSettled(i)).reduce((d,h)=>h.status==="fulfilled"?d.concat(h.value):d,[]);if(!this.validateProfilesResponse(o))return;const l=this.convertToProfiles(o);this.setProfiles(l)}getProfile(t){return this.getProfiles()[t]??null}getProfiles(){const{storage:t}=this.game;return t.getStorageData("profile","profiles")}setProfiles(t){const{storage:s}=this.game;s.setStorageData("profile","profiles",t),s.setStorageData("profile","profileIds",Object.keys(t))}getProfileIds(){const{storage:t}=this.game;return t.getStorageData("profile","profileIds")}validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}convertToProfiles(t){const s={};for(const a of t)qr.hasOwn(a,"playerId")&&zr.isString(a.playerId)&&(s[a.playerId]=new Wr.Player.Info(a).toObject());return s}}const ks="Save The Pets",{Utils:{Object:Vs,Valid:Bs,Browser:Us}}=p;class Qr extends b.Plugins.BasePlugin{constructor(t){super(t);u(this,"storages");u(this,"storageLocalKeys",{});this.storages={}}async addStorage(t,s,a=!1){this.storages[t]=s,a&&await this.initFromWebStorage(t,s)}async initFromWebStorage(t,s){this.storageLocalKeys[t]=!0;const a=await Us.getIndexedDB(`${ks}_S_${t}`);if(!Bs.isObject(a))return;const n=Object.keys(s);for(const i of n)Vs.hasOwn(a,i)&&typeof s[i]==typeof a[i]&&this.setStorageData(t,i,a[i])}setStorageData(t,s,a){let n;if(Bs.isObject(a)){const i=this.getStorageData(t,s);n=Vs.merge(i,a)}else n=a;this.storages[t][s]=n}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}updateToWebStorage(t){this.storageLocalKeys[t]&&this.saveToWebStorage(t)}saveToWebStorage(t){const s=this.getStorage(t);Us.setIndexedDB(`${ks}_S_${t}`,s)}}class Xr extends b.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"isVisible",!0);u(this,"browserPrefixes",["moz","ms","o","","webkit"]);u(this,"handleVisibilityChange",t=>{if(["focus","blur"].indexOf(t)>-1)return t==="focus"?this.onVisibleEvent():this.onHiddenEvent();const a=this.getBrowserPrefix();return this.getHiddenPropertyName(a)in document?this.onHiddenEvent():this.onVisibleEvent()})}init(){const t=this.getBrowserPrefix(),a=[this.getVisibilityEvent(t),"focus","blur"];for(const n of a)window.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1),document.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1);GameSDK.extra&&"onPause"in GameSDK.extra&&GameSDK.extra.onPause(()=>{this.handleVisibilityChange("blur")})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?`${t}Hidden`:"hidden"}getVisibilityEvent(t){return`${t||""}visibilitychange`}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(p.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(p.Events.VISIBILITY_HIDDEN))}}const tt={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed"},dt={NOT_STARTED:"not-started",IN_PROGRESS:"in-progress",COMPLETED:"completed",FAILED:"failed"},Zr=["next","preroll","browse","pause","start"],to=["reward"];class V{static async getRewardedVideoAsync(e){return await this.ensureInitialized(),this.createAdInstance(this.rewardedType,e)}static async getInterstitialAdAsync(e){return await this.ensureInitialized(),this.createAdInstance(this.interstitialType,e)}static async getRewardedInterstitialAsync(e){return await this.ensureInitialized(),this.createAdInstance(this.rewardedType,e)}static setGame(e){this.game=e}static setInterstitialType(e){this.interstitialType=e}static setRewardType(e){this.rewardedType=e}static async initAsync(e){try{switch(this.initStatus){case tt.LOADED:return;case tt.LOADING:return}if(!this.validateConfig(e))throw new Error("Invalid Google Ads configuration");this.initStatus=tt.LOADING,this.config=e,await this.loadScriptElementAsync()}catch(t){throw this.initStatus=tt.FAILED,t}}static validateConfig(e){if(!e)return!1;const{dataAdClient:t,dataAdHost:s}=e;if(!t&&!s)return!1;if(e.dataAdFrequencyHint){const a=Number(e.dataAdFrequencyHint);if(Number.isNaN(a)||a<=0)return!1}return!0}static async loadScriptElementAsync(){try{await this.injectMainScript(),await this.configureGoogleAds()}catch(e){throw e}}static async injectMainScript(){return new Promise((e,t)=>{try{const s=document.createElement("script");this.configureScriptAttributes(s),s.onload=()=>{this.initStatus=tt.LOADED,e()},s.onerror=a=>{this.initStatus=tt.FAILED,t(new Error(`Failed to load Google Ads script: ${a}`))},document.head.appendChild(s)}catch(s){t(s)}})}static async configureGoogleAds(){try{window.adsbygoogle=window.adsbygoogle||[],window.adBreak=e=>adsbygoogle.push(e),window.adConfig=e=>adsbygoogle.push(e),await this.preloadAdConfig()}catch(e){throw e}}static configureScriptAttributes(e){const{dataAdClient:t,dataAdHost:s,dataAdChannel:a,dataAdBreakTest:n,dataAdFrequencyHint:i}=this.config;e.async=!0,e.crossOrigin="anonymous";let r="";i&&e.setAttribute("data-ad-frequency-hint",`${i}s`),t&&(e.setAttribute("data-ad-client",t),r+=`?client=${t}`),a&&e.setAttribute("data-ad-channel",a),s&&(e.setAttribute("data-ad-host",s),r+=`&host=${s}`),n&&e.setAttribute("data-adbreak-test","on"),e.src=`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js${r}`}static async ensureInitialized(){if(this.initStatus!==tt.LOADED)throw new Error("Google Ads not initialized. Call initAsync first.");await this.ensurePreloaded()}static async ensurePreloaded(){this.preloadStatus!==dt.COMPLETED&&await this.preloadAdPlacement()}static createAdInstance(e,t){return{getPlacementID:()=>t,loadAsync:()=>this.preloadAdPlacement(),showAsync:()=>this.showAd(e,t),hideAsync:()=>Promise.resolve()}}static async showAd(e,t){return new Promise((s,a)=>{try{const n=this.createAdBreakConfig({type:e,placementId:t,resolve:s,reject:a});window.adBreak(n)}catch(n){a(n)}})}static createAdBreakConfig(e){const t=this.createBaseAdBreakConfig({placementId:e.placementId}),{type:s}=e;if(Zr.includes(s))return this.createInterstitialAdBreakConfig(t,e);if(to.includes(s))return this.createRewardAdBreakConfig(t,e);throw new Error(`Ad type: ${s} is not supported.`)}static createBaseAdBreakConfig(e){return{name:e.placementId,beforeAd:()=>{},adBreakDone:t=>{}}}static createInterstitialAdBreakConfig(e,{resolve:t,reject:s}){return{...e,type:this.interstitialType,adBreakDone:a=>{var n;(n=e.adBreakDone)==null||n.call(e,a),this.handleAdBreakDone({info:a,resolve:t,reject:s})}}}static createRewardAdBreakConfig(e,{resolve:t,reject:s}){return{...e,type:this.rewardedType,beforeReward:a=>{a()},adDismissed:()=>{s(new Error("USER_INPUT"))},adViewed:()=>{t()}}}static handleAdBreakDone(e){const{info:t,resolve:s,reject:a}=e;switch(t.breakStatus){case"viewed":s();break;case"frequencyCapped":a(new Error("AD_FREQUENCY_CAPPED"));break;default:a(new Error(t.breakStatus))}}static async preloadAdPlacement(){return this.initStatus!==tt.LOADED?Promise.reject(new Error("Google Ads not initiated.")):this.preloadAdConfig()}static getInitStatus(){return this.initStatus}static getPreloadStatus(){return this.preloadStatus}static async preloadAdConfig(){if(this.preloadStatus!==dt.COMPLETED&&this.preloadStatus!==dt.IN_PROGRESS)return this.preloadStatus=dt.IN_PROGRESS,new Promise((e,t)=>{const s=setTimeout(()=>{this.preloadStatus===dt.IN_PROGRESS&&(this.preloadStatus=dt.FAILED,t(new Error("Failed to preload ad config in time.")))},5e3);window.adConfig({preloadAdBreaks:"on",onReady:()=>{clearTimeout(s),this.preloadStatus=dt.COMPLETED,e()}})})}}u(V,"game"),u(V,"initStatus",tt.IDLE),u(V,"preloadStatus",dt.NOT_STARTED),u(V,"config"),u(V,"interstitialType","next"),u(V,"rewardedType","reward"),window.GoogleAds=V;const{Utils:{Object:Hs},Plugins:{Ads:{Status:B,Types:et,AdError:Zt,AdInstance:eo}}}=p;class js extends eo{constructor(t,s){super(t,s);u(this,"service");u(this,"instance");u(this,"instanceQueue",[]);this.service=GameSDK.getSDKName(),this.instance=null}async loadAsync(){if(!(this.instance&&this.status===B.FILLED)){if(this.status!==B.IDLE)throw new Zt("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new Zt("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.setStatus(B.LOADING),await this.instance.loadAsync(),this.setStatus(B.FILLED),this.logAdLoad()}catch(t){throw this.setStatus(B.IDLE),t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.pushInstanceToQueue(this.instance),self.game.analytics.loadAdFail({type:this.type,adService:this.service}),t}}}async showAsync(){if(this.status!==B.FILLED)throw new Zt("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new Zt("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let t=!1;try{this.setStatus(B.SHOWING),self.game.analytics.showingAd({type:this.type,adService:this.service}),await this.instance.showAsync(),t=!0,this.setStatus(B.IDLE),this.instance=null}catch(s){throw Hs.hasOwn(s,"code")&&(s.code==="AD_NOT_LOADED"&&this.setStatus(B.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf(`${s.code}`)>-1&&(this.setStatus(B.IDLE),this.instance=null),s.code==="USER_INPUT"&&(t=!0)),this.status===B.SHOWING&&(this.setStatus(B.IDLE),this.instance=null),s}finally{t?this.logAdShown():self.game.analytics.showAdFail({type:this.type,adService:this.service})}}async createInstanceByType(t){try{return await this.getAdInstanceByType(t)}catch(s){return Hs.hasOwn(s,"code")&&s.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed():null}}async getAdInstanceByType(t){switch(t){case et.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case et.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);case et.REWARDED_INTERSTITIAL:return await GameSDK.getRewardedInterstitialAsync(this.placementId);default:return null}}getAdInstanceFailed(){if("canBeLoadedAd"in GameSDK.extra){for(const t of this.instanceQueue)if(GameSDK.extra.canBeLoadedAd(t))return this.instanceQueue.splice(this.instanceQueue.indexOf(t),1),t}else return this.instanceQueue.shift()||null;return null}logAdLoad(){switch(this.type){case et.INTERSTITIAL:self.game.analytics.loadInterstitialAd({adService:this.service});break;case et.REWARDED_VIDEO:self.game.analytics.loadRewardedVideoAd({adService:this.service});break;case et.REWARDED_INTERSTITIAL:self.game.analytics.loadRewardedInterstitialAd({adService:this.service});break}}logAdShown(){switch(this.type){case et.INTERSTITIAL:self.game.analytics.showInterstitialAd({adService:this.service});break;case et.REWARDED_VIDEO:self.game.analytics.showRewardedVideoAd({adService:this.service});break;case et.REWARDED_INTERSTITIAL:self.game.analytics.showRewardedInterstitialAd({adService:this.service});break}}pushInstanceToQueue(t){this.instanceQueue.push(t)}}const{Plugins:{Ads:{Types:Ge}}}=p;class so extends js{constructor(e,t){super(e,t),this.service="adsense"}async createInstanceByType(e){try{switch(e){case Ge.REWARDED_VIDEO:return await V.getRewardedVideoAsync(this.placementId);case Ge.INTERSTITIAL:return await V.getInterstitialAdAsync(this.placementId);case Ge.REWARDED_INTERSTITIAL:return await V.getRewardedInterstitialAsync(this.placementId);default:return null}}catch{return null}}getAdInstanceFailed(){return null}}class ao extends qe{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}}const{Status:Ks}=p.Plugins.Ads;class no extends ao{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.setStatus(Ks.SHOWING)}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.setStatus(Ks.IDLE)}}const{BaseAnalytics:io,Events:Ws}=p.Plugins.Analytics,ro=[Ws.SCREEN_OPEN],{Utils:{Array:oo,Object:co,Image:lo},Configs:{Analytics:{ClarityAnalytics:ho}}}=p;class uo extends io{constructor(t,s){super(t,"ClarityAnalytics",{...s,color:"#9692FF"});u(this,"image");u(this,"isCapturing",!1);u(this,"setScreenshotToHtml",async()=>{try{if(this.isCapturing||(this.isCapturing=!0,!this.image))return;const t=await this.captureScreenshot();if(!t)return;this.image.src=t}finally{this.isCapturing=!1}});this.setupScreenshots()}setUser(t){clarity("identify",t)}processEvent(t,s){oo.has(ro,t)||(this.markByEvent(t,s),clarity("event",t,s))}markByEvent(t,s){switch(t){case Ws.PAGE_VIEW:clarity("set",t,co.vals(s));break}}setupScreenshots(){this.game.canvasRecorder&&(typeof FileReader>"u"||(this.initImage(),setInterval(this.setScreenshotToHtml,ho.DelayScreenshot)))}initImage(){if(this.image)return;const t=document.getElementById("Cocos3dGameContainer");t&&(this.image=document.createElement("img"),this.image.id="clarity-screenshot",this.image.setAttribute("data-clarity-unmask","true"),Object.assign(this.image.style,{position:"absolute",display:"flex",width:"100%",top:0,left:0,pointerEvents:"none"}),t.insertBefore(this.image,t.firstChild))}async captureScreenshot(){if(!this.game.canvasRecorder)return null;const t=await this.game.canvasRecorder.snapshotFrameAsync({force:!0,type:"jpeg",quality:.1,resolution:.5});return t?await lo.blobToDataImage(t):null}}const{BaseAnalytics:yo,Events:zs}=p.Plugins.Analytics,po=[zs.BUTTON_CLICK,zs.SCREEN_OPEN],{Utils:{Array:fo}}=p;class go extends yo{constructor(t,s){super(t,"FacebookAnalytics",{...s,color:"#0F52BA"});u(this,"prefix");this.prefix=s.prefix}processEvent(t,s){if(!("logEvent"in GameSDK.extra)||fo.has(po,t))return;const a=this.addPrefixToEventName(t);GameSDK.extra.logEvent(a,1,s)}addPrefixToEventName(t){return`${this.prefix}_${t}`}}const{BaseAnalytics:mo,Events:wo}=p.Plugins.Analytics,Ao=[wo.SCREEN_OPEN],{Utils:{Array:Io}}=p;class Do extends mo{constructor(e,t){super(e,"FirebaseAnalytics",{...t,color:"#FFCA28"})}setUser(e,t){var s,a;(a=(s=this.game.firebase)==null?void 0:s.services.analytics)==null||a.setUser(e,t)}processEvent(e,t){var s,a;Io.has(Ao,e)||(a=(s=this.game.firebase)==null?void 0:s.services.analytics)==null||a.event(e,t)}}const{BaseAnalytics:Po,Events:Pt}=p.Plugins.Analytics,So=[Pt.SCREEN_OPEN],{Utils:{Array:Eo}}=p;class vo extends Po{constructor(e,t){super(e,"GoogleAnalytics",{...t,color:"#E35335"})}processEvent(e,t){Eo.has(So,e)||(this.customEvent(e,t),gtag("event",e,t))}customEvent(e,t){switch(e){case Pt.AD_SHOW:case Pt.AD_SHOW_FAILED:case Pt.AD_SHOWING:case Pt.USE_ITEM:case Pt.EARN_ITEM:this.addLevelName(t);break}}addLevelName(e){if(!e||!(game!=null&&game.match))return;const s=game.match.getMatchState().customData.level;s<0||(e.level_name=this.getLevelName(s))}}const xo="production",Fe="6",{Dtos:Co,Events:Rt,Configs:{AppId:bo,Ads:Dt,Analytics:te,AdaptivePerformance:qs,Debugger:ht,Firebase:Js,Notification:No,RemoteConfig:Ys,PerformanceMonitor:Mo},Plugins:{Ads:{Types:ee}},Utils:{Object:Qs,Json:se,String:Xs,Valid:Lo,Mark:E}}=p;class To extends b.Game{constructor(){super(...arguments);u(this,"markName","Core Initialize");u(this,"modulePlugins",[]);u(this,"handleProtectGameInstance",()=>{const t=this.event.getEventEmitCount(nt.MODULE_PLUGIN_READY),s=this.modulePlugins.length;t<s||(window.game=Object.freeze(window.game),Be(window,"game"))});u(this,"initMonitorErrorPlugin",()=>{if(!this.monitorError)return;const{MonitorError:t,ListPlayerDevIds:s}=ht,{ApiKey:a,Service:n,Feedback:i,TrackUser:r,FilterErrors:o}=t,l=GameSDK.player.getID(),d=GameSDK.player.getName();l&&s.indexOf(l)>=0||(this.monitorError.configure({apiKey:a,service:n,feedback:i,trackUser:r,releaseStage:xo,buildVersion:`${Fe}`}),this.monitorError.setUser({id:l,name:d}),this.monitorError.addFilterErrors(o),this.monitorError.initFeedbackTrackErrors(),this.updateMonitorErrorUserAndMetadata(),this.processErrorsQueue())});u(this,"updateMonitorErrorUserAndMetadata",()=>{this.event.catchUp(Rt.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded)});u(this,"processErrorsQueue",()=>{if(this.monitorError&&window.__errorQueue){for(const t of window.__errorQueue)if(t instanceof Error)this.monitorError.sendException(t);else{const{message:s,code:a,stack:n}=t||{message:"",code:"Unknown",stack:"Unknown stack"},i=new Error(s||a);i.stack=n,this.monitorError.sendException(i)}window.__errorQueue=null}});u(this,"processWhenPlayerInfoLoaded",()=>{if(!this.monitorError)return;const{playerId:t,name:s}=this.player.getPlayer();this.monitorError.setUser({id:t,name:s}),this.monitorError.addMetadata({isFirstLogin:this.player.isFirstLogin()})});u(this,"handleSaveRemoteConfig",t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch{}});u(this,"handleUpdateGameCoreConfig",t=>{try{const{id:s,type:a}=t;if(a!=="GameCore")return;p.Configs=Qs.merge(p.Configs,t.config);const{Ads:n}=p.Configs;this.ads.configure(n),this.event.emit(nt.REMOTE_CONFIG_UPDATED,{id:s,type:a})}catch{}});u(this,"handleStorageCurrentRemoteConfig",()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(t){for(const s in t)if(Qs.hasOwn(t,s)){const a=t[s],n=se.clone(a),i=new Co.RemoteConfig.Data(n).toObject();this.remoteConfig.setRemoteConfig(i),this.remoteConfig.processUpdateConfig(i.id,i.type)}}});u(this,"initAdaptivePerformancePlugin",()=>{if(!this.adaptivePerformance)return;const t=se.clone(qs);this.adaptivePerformance.configure(t)});u(this,"processAfterSyncProfile",()=>{No.Enabled&&this.updatePlayerProfileToNotificationService()})}getBuildVersion(){return Number.parseInt(`${Fe}`)||0}async boot(){super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(Rt.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),E.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),E.putAttr(this.markName,"Step","Load Lazy Plugins"),Lo.isDebugger()||this.event.on(Rt.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),E.putAttr(this.markName,"Step","Load Dev Plugins"),this.addDevPlugins()}async start(){super.start(),E.putAttr(this.markName,"Step","Core Start"),this.event.emit(Rt.CORE_STARTING),E.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),E.putAttr(this.markName,"Step","Init States"),await this.initState(),E.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),E.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();const t=this.storage.getStorageData("context","sessionContextType")||"unknown";E.putAttr(this.markName,"Context Mode",t),E.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initClarityAnalytics(),this.initFirebaseAnalytics(),this.initFacebookAnalytics(),E.putAttr(this.markName,"Step","Core Ready"),E.putAttr(this.markName,"Success","true"),E.stop(this.markName),this.event.emit(Rt.CORE_READY)}addPlugins(){this.installPlugin("Storage",Qr),this.installPlugin("Event",Ka),this.installPlugin("Ads",ma),this.installPlugin("Auth",va),this.installPlugin("Audio",Sa),this.installPlugin("Match",pr),this.installPlugin("Player",Sr),this.installPlugin("Profile",Yr),this.installPlugin("Context",_a),this.installPlugin("Language",wn),this.installPlugin("Analytics",Ia),this.installPlugin("Visibility",Xr),this.installPlugin("Leaderboard",Cn),this.installPlugin("DailyRewards",Ba),this.installPlugin("FrameCapture",gn),this.installPlugin("RemoteConfig",pe),"Proxy"in window&&this.installPlugin("Firebase",pe)}installPlugin(t,s,a=!1){const n=Xs.toCamelCase(Xs.capitalize(t));this.plugins.install(t,s,!0,n),t!=="Storage"&&(a?this.emitModulePluginReady(t):this.emitCorePluginReady(t))}async addMonitorPlugin(){var a;(a=window.disableSimpleTrackErrors)==null||a.call(window);const{MonitorError:t}=ht;if(!t.Enabled)return;this.modulePlugins.push("MonitorError");const s=(await at(async()=>{const{default:n}=await v.import("./bundle/monitor-error.js").then(i=>i.i);return{default:n}},void 0,v.meta.url)).default;typeof s=="function"&&this.installPlugin("MonitorError",s,!0)}async addAdaptivePerformancePlugin(){if(!qs.Enabled)return;this.modulePlugins.push("AdaptivePerformance");const t=(await at(async()=>{const{default:s}=await v.import("./bundle/index.js");return{default:s}},void 0,v.meta.url)).default;typeof t=="function"&&this.installPlugin("AdaptivePerformance",t,!0)}addDevPlugins(){var a;const{ListPlayerDevIds:t}=ht,s=(a=GameSDK==null?void 0:GameSDK.player)==null?void 0:a.getID();!s||t.indexOf(s)<0||(this.addConsolePlugin(),this.addProfilerPlugin(),this.addCanvasRecorderPlugin())}async addConsolePlugin(){try{const{Console:t}=ht;if(!t.Enabled)return;this.modulePlugins.push("Console");const s=(await at(async()=>{const{default:a}=await Promise.resolve().then(()=>fe);return{default:a}},void 0,v.meta.url)).default;if(typeof s!="function")throw new Error("ConsolePlugin is not a function");this.installPlugin("Console",s,!0),this.initConsolePlugin()}catch{}}async addProfilerPlugin(){try{const{Profiler:t}=ht;if(!t.Enabled)return;this.modulePlugins.push("Profiler");const s=(await at(async()=>{const{default:a}=await Promise.resolve().then(()=>fe);return{default:a}},void 0,v.meta.url)).default;if(typeof s!="function")throw new Error("ProfilerPlugin is not a function");this.installPlugin("Profiler",s,!0),this.initProfilerPlugin()}catch{}}async addCanvasRecorderPlugin(){try{const{CanvasRecorder:t}=ht;if(!t.Enabled)return;this.modulePlugins.push("CanvasRecorder");const s=(await at(async()=>{const{default:a}=await Promise.resolve().then(()=>fe);return{default:a}},void 0,v.meta.url)).default;if(typeof s!="function")throw new Error("CanvasRecorderPlugin is not a function");this.installPlugin("CanvasRecorder",s,!0),this.initCanvasRecorderPlugin()}catch{}}emitCorePluginReady(t){this.event.emit(nt.CORE_PLUGIN_READY,{name:t})}emitModulePluginReady(t){this.event.emit(nt.MODULE_PLUGIN_READY,{name:t})}initEventPlugin(){const{EventLogging:t}=ht;t.Enabled&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){this.ads.configure(Dt),this.initGoogleAds(),this.initAdInstance()}async initGoogleAds(){try{const{Enabled:t,DataAdBreakTest:s,DataAdClient:a,DataAdChannel:n,DataAdFrequencyHint:i,DataAdHost:r}=Dt.AdServiceConfigs.AdSense;if(!t)return;V.setGame(this),await V.initAsync({dataAdClient:a,dataAdChannel:n,dataAdHost:r,dataAdFrequencyHint:i,dataAdBreakTest:s})}catch{}}getAdInstanceByService(t,s=!1){const{AdSense:a,AppLovin:n}=Dt.AdServiceConfigs;switch(t){case"adsense":if(a.Enabled)return so;break;case"applovin":break;default:return s?no:js}return null}initAdInstance(){for(const s of Dt.InterstitialAdOptions){const a=this.getAdInstanceByService(s.AdService);a&&this.ads.setAdInstance(ee.INTERSTITIAL,s.PlacementId,a)}for(const s of Dt.RewardedVideoAdOptions){const a=this.getAdInstanceByService(s.AdService);a&&this.ads.setAdInstance(ee.REWARDED_VIDEO,s.PlacementId,a)}for(const s of Dt.RewardedInterstitialAdOptions){const a=this.getAdInstanceByService(s.AdService);a&&this.ads.setAdInstance(ee.REWARDED_INTERSTITIAL,s.PlacementId,a)}const t=!0;for(const s of Dt.BannerDisplayAdOptions){const a=this.getAdInstanceByService(s.AdService,t);a&&this.ads.setAdInstance(ee.BANNER,s.PlacementId,a)}}async initState(){try{const t=new la(this);t.initContext(),await t.initPlayer()}catch{}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;const{CanvasRecorder:t}=ht,{Type:s,Quality:a,RecordFps:n,SyncFps:i}=t.Options;this.canvasRecorder.configure({type:s,quality:a,syncFps:i,recordFps:n}),this.canvasRecorder.setPanelExpanded(t.PanelExpanded);const r=document.querySelector("canvas");r&&this.canvasRecorder.setCanvas(r)}initRemoteConfig(){if(!Ys.Enabled)return;const t=se.clone(Ys);this.remoteConfig.configure(t),this.event.on(nt.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(nt.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.catchUp(nt.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initFirebasePlugin(){if(!Js.Enabled||!this.firebase)return;const t=se.clone(Js);this.firebase.configure(t),E.setService(this.firebase.services.performance)}initMarkCoreInitialize(){Mo.CoreFlows&&(E.measure(this.markName),E.putAttr(this.markName,"Build",`${Fe}`),E.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),E.putAttr(this.markName,"Platform",GameSDK.getPlatform()),E.putAttr(this.markName,"Success","false"),E.start(this.markName))}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch{}}async updatePlayerProfileToNotificationService(){try{const t=this.player.getPlayer(),{ASID:s,playerId:a,name:n,photo:i,locale:r}=t;await fa({appId:bo,ASID:s,playerId:a,name:n,photo:i,locale:r})}catch{}}initGoogleAnalytics(){const{Enabled:t,ConsoleLog:s}=te.GoogleAnalytics??{};t&&this.analytics.add(new vo(this.game,{log:!!s}))}initClarityAnalytics(){const{Enabled:t,ConsoleLog:s}=te.ClarityAnalytics??{};if(!t)return;const a=new uo(this.game,{log:!!s}),n=this.player.getPlayer(),{playerId:i}=n;a.setUser(i),this.analytics.add(a)}initFirebaseAnalytics(){const{Enabled:t,ConsoleLog:s}=te.FirebaseAnalytics??{};if(!t)return;const a=new Do(this.game,{log:!!s});this.analytics.add(a);let n="no_entry";GameSDK.getEntryPointAsync().then(i=>{n=i}).catch(i=>{}).finally(()=>{const i=this.player.getPlayer(),{playerId:r,locale:o}=i,{fbig_ad_id:l,fbig_adset_id:d,fbig_campaign_id:h}=GameSDK.getEntryPointData()||{};a.setUser(r,{locale:o,ad_id:l,adset_id:d,campaign_id:h,traffic_source:n})})}initFacebookAnalytics(){const{Enabled:t,Prefix:s,ConsoleLog:a}=te.FacebookAnalytics??{};t&&typeof s=="string"&&this.analytics.add(new go(this.game,{prefix:s,log:!!a}))}}const{Configs:{GameEngine:{ForceDesktopDPR:ae}},Utils:{Device:_o},Events:$e}=p,Oo=async()=>{const c=new To;window.game=c;const e=20;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreStart=!0,await c.boot(),c.event.catchUp($e.REQUEST_CORE_START,Zs),Ro(c)},Zs=()=>{if(!window.__sdkInitiated){game.event.catchUp($e.GAME_SDK_READY,Zs);return}window.game.start();const c=25;window.__sdkLoadingCount<c&&(window.__sdkLoadingCount=c)},Ro=c=>{const t=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(t);const s=10;window.__sdkLoadingCount<s&&(window.__sdkLoadingCount=s),c.event.emit($e.GAME_SDK_READY)},5)};ae!==!1&&_o.isDesktop()&&typeof ae=="number"&&ae>0&&(window.devicePixelRatio=ae),Oo()}}});
