function asyncGeneratorStep(e,r,t,a,n,o,s){try{var i=e[o](s);var u=i.value}catch(e){t(e);return}if(i.done)r(u);else Promise.resolve(u).then(a,n)}function _async_to_generator(e){return function(){var r=this,t=arguments;return new Promise(function(a,n){var o=e.apply(r,t);function _next(e){asyncGeneratorStep(o,a,n,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(o,a,n,_next,_throw,"throw",e)}_next(void 0)})}}function _class_call_check(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function _create_class(e,r,t){if(r)_defineProperties(e.prototype,r);if(t)_defineProperties(e,t);return e}function _define_property(e,r,t){if(r in e)Object.defineProperty(e,r,{value:t,enumerable:true,configurable:true,writable:true});else e[r]=t;return e}function _object_spread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};var a=Object.keys(t);if("function"==typeof Object.getOwnPropertySymbols)a=a.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}));a.forEach(function(r){_define_property(e,r,t[r])})}return e}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);if(r)a=a.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable});t.push.apply(t,a)}return t}function _object_spread_props(e,r){r=null!=r?r:{};if(Object.getOwnPropertyDescriptors)Object.defineProperties(e,Object.getOwnPropertyDescriptors(r));else ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}function _ts_generator(e,r){var t,a,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function verb(e){return function(r){return step([e,r])}}function step(o){if(t)throw new TypeError("Generator is already executing.");while(s)try{if(t=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;if(a=0,n)o=[2&o[0],n.value];switch(o[0]){case 0:case 1:n=o;break;case 4:s.label++;return{value:o[1],done:false};case 5:s.label++;a=o[1];o=[0];continue;case 7:o=s.ops.pop();s.trys.pop();continue;default:if(n=s.trys,!(n=n.length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1];n=o;break}if(n&&s.label<n[2]){s.label=n[2];s.ops.push(o);break}if(n[2])s.ops.pop();s.trys.pop();continue}o=r.call(e,s)}catch(e){o=[6,e];a=0}finally{t=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}System.register(["./core.js","../GameCore.js"],function(e,r){"use strict";var t,a;return{setters:[function(e){t=e.G},function(e){a=e.D}],execute:function(){var r=t.Configs,n=t.Utils,o=r.Mockup.Leaderboards,s=o.MinScore,i=o.MaxScore,u=o.NumOfLeaders,c=o.ErrorRate,l=o.DefaultLimit,f=o.RandomDelayMs,d=n.Valid,y=n.Browser,p=n.Time,b=n.Object,v=n.Number,_="LeadersMockKey",h="LeaderboardsMockKey";var g=/*#__PURE__*/function(){function O(){_class_call_check(this,O)}_create_class(O,[{key:"getPlayers",value:function(e,r){var t=this;return _async_to_generator(function(){var a,n,o,s,i,u,c,l,f,d;return _ts_generator(this,function(y){switch(y.label){case 0:return[4,t.awaitRandomDelay()];case 1:if(y.sent(),t.randomResponseError("Get players error"))return[2,{data:[]}];a=r.playerIds,n=[];if(a&&a.length>0){o=t.getLeadersData(e);s=true,i=false,u=void 0;try{for(c=a[Symbol.iterator]();!(s=(l=c.next()).done);s=true){f=l.value;d=o[f];d&&n.push(d)}}catch(e){i=true;u=e}finally{try{if(!s&&null!=c.return)c.return()}finally{if(i)throw u}}}return[2,{data:n}]}})})()}},{key:"getLeaders",value:function(e,r){var t=this;return _async_to_generator(function(){var a,n,o,s,i,u,c,f,d;return _ts_generator(this,function(y){switch(y.label){case 0:return[4,t.awaitRandomDelay()];case 1:if(y.sent(),t.randomResponseError("Get leaders error"))return[2,{data:[]}];a=r.limit,n=r.offset,o=t.getLeadersData(e),s=b.vals(o);t.sortLeadersRank(s);i=[],u=n,c=0===a?l:n+a;for(f=u;f<c;f++){d=s[f];d&&i.push(d)}return[2,(t.sortLeadersRank(i),{data:i})]}})})()}},{key:"getLeaderboardAsync",value:function(e){var r=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(a){switch(a.label){case 0:return[4,r.awaitRandomDelay()];case 1:if(a.sent(),r.randomResponseError("Get leaderboard error"))return[2,null];t=r.getLeaderBoard(e);return[2,t||null]}})})()}},{key:"getLeaderboardsAsync",value:function(e){var r=this;return _async_to_generator(function(){var t,a,n,o,s;return _ts_generator(this,function(i){switch(i.label){case 0:return[4,r.awaitRandomDelay()];case 1:if(i.sent(),r.randomResponseError("Get leaderboards error"))return[2,[]];t=e.limit,a=void 0===t?9999:t,n=e.type;if(a<=0)return[2,[]];o=r.getLeaderBoardsData(),s=b.vals(o);return[2,void 0===n?s.slice(0,a):s.filter(function(e){return e.type===n}).slice(0,a)]}})})()}},{key:"getLeadersData",value:function(e){var r=this.getPlayersData(),t=Object.keys(r[e]),a={};var n=true,o=false,s=void 0;try{for(var i=t[Symbol.iterator](),u;!(n=(u=i.next()).done);n=true){var c=u.value;var l=r[e][c];d.isObject(l)&&(a[c]=l)}}catch(e){o=true;s=e}finally{try{if(!n&&null!=i.return)i.return()}finally{if(o)throw s}}return a}},{key:"sortLeadersRank",value:function(e){e.sort(function(e,r){return Number.parseInt(r.score,10)-Number.parseInt(e.score,10)}),e.forEach(function(e,r){e.rank=r+1})}},{key:"setScoreAsync",value:function(e,r,t){var a=this;return _async_to_generator(function(){var n,o,s,i,u;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,a.awaitRandomDelay()];case 1:if(c.sent(),a.randomResponseError("Set score error"))return[2,null];n={success:!1},o=a.getLeaderBoard(e);if(!o)return[2,n];s=a.getPlayersData();i=s[e][r];i||(i=a.createPlayerData(r),o.amountPlayer+=1,o.numberOfLeaders+=1,a.writeLeaderBoard(e,o)),i.score=t.toString(),s[e][r]=i;u=b.vals(s[e]);return[2,(a.sortLeadersRank(u),u.forEach(function(r,t){s[e][r.playerId]=r}),a.writePlayersData(e,s),n.success=!0,n)]}})})()}},{key:"createLeaderboard",value:function(e){var r=this;return _async_to_generator(function(){var t,a,n;return _ts_generator(this,function(o){switch(o.label){case 0:return[4,r.awaitRandomDelay()];case 1:if(o.sent(),r.randomResponseError("Create leaderboard error"))return[2,null];t=e._id,a=r.getLeaderBoardsData();if(a[t])return[2,a[t]];n=e.numberOfLeaders;return[2,(n=null!=n?n:v.random(u.Max-u.Min)+u.Min,r.createPlayersData(e,n),r.createLeaderboardData(e,n))]}})})()}},{key:"createLeaderboardData",value:function(e,r){var t=e._id,n=_object_spread_props(_object_spread({},a,e),{createdAt:new Date().toISOString(),createdBy:"mock",numberOfLeaders:r,amountPlayer:r});return this.writeLeaderBoard(t,n),n}},{key:"createPlayersData",value:function(e,r){var t=e._id,a=e.name,n="friends-leaderboard-key"===a,o=_define_property({},t,{}),s=[];for(var i=0;i<r;i++){var u=n?"connected-player-".concat(i):i.toString(),c=this.createPlayerData(u);s.push(c)}return this.sortLeadersRank(s),s.forEach(function(e,r){o[t][e.playerId]=e}),this.writePlayersData(t,o),o}},{key:"createPlayerData",value:function(e){return{playerId:e,score:this.randomScore(),rank:0}}},{key:"randomScore",value:function(){return Math.floor(Math.random()*(i-s)+s).toString()}},{key:"getLeaderBoardsData",value:function(){var e=y.getLocalStorage(h);return d.isObject(e)?e:{}}},{key:"writeLeaderBoardsData",value:function(e){d.isObject(e)&&y.writeLocalStorage(h,e)}},{key:"getLeaderBoard",value:function(e){var r=this.getLeaderBoardsData();return r[e]?r[e]:null}},{key:"writeLeaderBoard",value:function(e,r){var t=this.getLeaderBoardsData();t[e]=r,this.writeLeaderBoardsData(t)}},{key:"getPlayersData",value:function(){var e=y.getLocalStorage(_);return d.isObject(e)?e:{}}},{key:"writePlayersData",value:function(e,r){var t=this.getPlayersData();t[e]||(t[e]={}),b.assign(t[e],r[e]),y.writeLocalStorage(_,t)}},{key:"randomResponseError",value:function(e){return 100*Math.random()<c}},{key:"awaitRandomDelay",value:function(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:return[4,p.sleepAsync(Math.random()*f)];case 1:e.sent();return[2]}})})()}}]);return O}();e("default",g)}}});