function _assert_this_initialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _class_call_check(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function _create_class(t,i,r){if(i)_defineProperties(t.prototype,i);if(r)_defineProperties(t,r);return t}function _get_prototype_of(t){_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)};return _get_prototype_of(t)}function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:true,configurable:true}});if(i)_set_prototype_of(t,i)}function _possible_constructor_return(t,i){if(i&&("object"===_type_of(i)||"function"==typeof i))return i;return _assert_this_initialized(t)}function _set_prototype_of(t,i){_set_prototype_of=Object.setPrototypeOf||function(t,i){t.__proto__=i;return t};return _set_prototype_of(t,i)}function _type_of(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function _is_native_reflect_construct(){if("undefined"==typeof Reflect||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if("function"==typeof Proxy)return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(t){return false}}function _create_super(t){var i=_is_native_reflect_construct();return function(){var r=_get_prototype_of(t),n;if(i){var s=_get_prototype_of(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return _possible_constructor_return(this,n)}}var d=Object.defineProperty;var g=function(t,i,r){return i in t?d(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r};var e=function(t,i,r){return g(t,(void 0===i?"undefined":_type_of(i))!="symbol"?i+"":i,r)};System.register(["./core.js"],function(t,i){"use strict";var r,n;return{setters:[function(t){r=t.P,n=t.C}],execute:function(){var i=function(){function o(t,i){var r=this;_class_call_check(this,o);e(this,"options");e(this,"performance");e(this,"isRunning",!1);e(this,"checkTimer");e(this,"fpsHistory");e(this,"actualFPS",0);e(this,"start",function(){r.isRunning||(r.isRunning=!0,r.checkTimer=r.options.CheckInterval,r.fpsHistory=[])});e(this,"stop",function(){r.isRunning&&(r.isRunning=!1,r.options.OnlyUpdateWhenSwitchScene&&r.checkFps())});e(this,"postStep",function(t){r.isRunning&&(r.checkTimer-=t,!(r.checkTimer>0)&&(r.checkTimer+=r.options.CheckInterval,r.fpsHistory.push(r.actualFPS),r.options.OnlyUpdateWhenSwitchScene||r.fpsHistory.length>=5&&r.checkFps()))});this.options=i,this.performance=t}_create_class(o,[{key:"checkFps",value:function(){if(0===this.fpsHistory.length)return;var t=!1;this.options.AutoUpgradeQuality&&this.isHighFps()&&(t=this.performance.upgradeGraphicsQuality()),this.isLowFps()&&(t=this.performance.downgradeGraphicsQuality()),t&&(this.fpsHistory=[])}},{key:"getFpsMedian",value:function(){return this.getMedian(this.fpsHistory)}},{key:"getMedian",value:function(t){if(0===t.length)return Number.NaN;var i=t.sort(function(t,i){return t-i}),r=Math.floor(i.length/2);return i.length%2===0?(i[r-1]+i[r])/2:i[r]}},{key:"isLowFps",value:function(){return this.getFpsMedian()<this.options.FpsThreshold}},{key:"isHighFps",value:function(){return this.getFpsMedian()>1.2*this.options.FpsThreshold}}]);return o}();var s=function(t){_inherits(u,t);var r=_create_super(u);function u(){_class_call_check(this,u);var t;t=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments)));e(_assert_this_initialized(t),"enabled",!1);e(_assert_this_initialized(t),"quality");e(_assert_this_initialized(t),"fpsTracker");e(_assert_this_initialized(t),"pixelRatio");e(_assert_this_initialized(t),"trackingSceneNames",[]);e(_assert_this_initialized(t),"trackingScene",function(i){t.trackingSceneNames.indexOf(i)<0||(t.stopFPSTracker(),t.startFPSTracker())});e(_assert_this_initialized(t),"startFPSTracker",function(){t.fpsTracker.start()});e(_assert_this_initialized(t),"stopFPSTracker",function(){t.fpsTracker.stop()});return t}_create_class(u,[{key:"configure",value:function(t){var i=t.Enabled,r=t.Quality,n=t.Options,s=t.TrackingSceneNames;this.enabled=i,this.quality=r,this.pixelRatio=window.devicePixelRatio,this.trackingSceneNames=s,this.createFPSTracker(n)}},{key:"getCurrentQuality",value:function(){return this.pixelRatio}},{key:"downgradeGraphicsQuality",value:function(){var t=this.quality,i=t.Min,r=t.AdjustStep,n=this.pixelRatio;if(n<=i)return!1;var s=+(n-r).toFixed(2);return!(s<i)&&(this.pixelRatio=s,this.resizeGameWorld(this.pixelRatio),!0)}},{key:"upgradeGraphicsQuality",value:function(){var t=this.quality,i=t.Max,r=t.AdjustStep,n=this.pixelRatio;if(n>=i)return!1;var s=+(n+r).toFixed(2);return!(s>i)&&(this.pixelRatio=s,this.resizeGameWorld(this.pixelRatio),!0)}},{key:"createFPSTracker",value:function(t){this.fpsTracker=new i(this,t)}},{key:"event",get:function(){return this.game.event}},{key:"resizeGameWorld",value:function(t){var i={forcePixelRatio:t};this.event.emit(n.REQUEST_RESIZE_GAME,i)}},{key:"updatePostStepDeltaTime",value:function(t){this.fpsTracker.postStep(t)}},{key:"updateActualFPS",value:function(t){this.fpsTracker.actualFPS=t}}]);return u}(r.Plugins.BasePlugin);t("default",s)}}});