System.register("chunks:///systems.js",["./rollupPluginModLoBabelHelpers-63d6a2bf.js","cc","./GeneralUtils-77504ad0.js"],(function(e,t){var n,i,a,r,s,o,c,u,l,d,h,f,p,v,y,m,g,E,S,A,_,w,b,k,C,D,R,T,I,L,F,x,M,N,O,P,U,G,z,B,H,V,q,W,j,Y,Q,K,Z,J;return{setters:[function(e){n=e.f,i=e.c,a=e.h,r=e._,s=e.d,o=e.i,c=e.g,u=e.m,l=e.o,d=e.l},function(e){h=e.cclegacy,f=e.game,p=e.settings,v=e.Settings,y=e.View,m=e.AssetManager,g=e.director,E=e.input,S=e.Input,A=e.sys,_=e.macro,w=e.DynamicAtlasManager,b=e.screen,k=e.math,C=e.Director,D=e.ResolutionPolicy,R=e.ImageAsset,T=e.UIRenderer,I=e.Texture2D,L=e.instantiate,F=e.Vec3,x=e.Game},function(e){M=e.G,N=e.k,O=e.h,P=e.a,U=e.b,G=e.P,z=e.o,B=e.E,e.B,H=e.L,V=e.p,q=e.f,W=e.d,j=e.q,Y=e.m,Q=e.R,K=e.r,Z=e.s,J=e.j}],execute:function(){h._RF.push({},"0b067Iz+iFJLJjNpsfblY7S","AdsManager",void 0);var e=GameCore,X=e.Events,$=e.Configs.Ads,ee=$.Enabled,te=$.PreloadAds,ne=$.ShowAdOnLoad,ie=$.BannerDisplayAdOptions,ae=e.Utils.Time,re=globalThis.game,se=re.player,oe=re.event,ce=function(){function e(){var t=this;i(this,e),this.currentLayout="",this.handleShowBannerAds=function(e){e.sceneName!==N.BOOT_SCENE&&(se.isFirstLogin()||(oe.off(X.SCENE_LAUNCHED,t.handleShowBannerAds),O.showBannerAds()))},this.handleWhenGameReady=a((function*(){yield t.handleShowInterstitialAdWhenGameReady(),te&&(yield ae.sleepAsync(3e3),O.preloadAds())})),this.handleShowInterstitialAdWhenGameReady=a((function*(){try{if(!ee)return;var e=ne.Enabled,t=ne.DelaySeconds;if(!e)return;t>0&&(yield ae.sleepAsync(1e3*t)),O.showInterstitialAdAsync()}catch(e){console.warn("handleShowAdWhenLoadGame failed",e)}})),this.handleLayoutChanged=function(e){t.currentLayout!==e&&(t.currentLayout=e,e!==P.Layout.Landscape?ie.forEach((function(e){var t=e.PlacementId,n=e.Position;"bottom"===n||"top"===n?O.showBannerAd(t):O.hideBannerAd(t)})):O.showBannerAds())}}return n(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){f.on(M.LAYOUT_CHANGED,this.handleLayoutChanged),oe.on(X.SCENE_LAUNCHED,this.handleShowBannerAds),oe.catchUp(X.GAME_READY,this.handleWhenGameReady)}}]),e}();h._RF.pop(),h._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var ue,le,de,he=GameCore.Events,fe=globalThis.game.event,pe=function(){function e(){i(this,e)}return n(e,[{key:"init",value:function(){console.info("Core Manager: Initialized")}},{key:"requestStart",value:function(){fe.emit(he.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(e){fe.catchUp(he.CORE_BOOTING,e)}},{key:"onCoreStart",value:function(e){fe.catchUp(he.CORE_STARTING,e)}},{key:"onCoreReady",value:function(e){fe.catchUp(he.CORE_READY,e)}}]),e}();h._RF.pop(),h._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var ve=GameCore,ye=ve.Events,me=ve.Configs.GameEngine,ge=me.DynamicAtlas,Ee=me.PreferredFPS,Se=ve.Utils,Ae=Se.Valid,_e=Se.Device,we=Se.Decorator,be=globalThis.game.event,ke=(ue=we.debounce(600),de=r((le=function(){function e(){var t=this;i(this,e),this.handlePauseEngine=a((function*(){console.info("Engine: Paused",f.isPaused()),f.isPaused()})),this.handleResumeEngine=a((function*(){t.restoreRequestAnimationFrame(),console.info("Engine: Resumed",f.isPaused()),f.isPaused()})),this.handleResizeView=function(e){var n=e.width,i=e.height;t.resizeView(n,i)},s(this,"handleViewResized",de,this)}var t;return n(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){f.on(M.VIEW_RESIZE,this.handleResizeView),f.on(M.VIEW_RESIZED,this.handleViewResized)}},{key:"overrideSettings",value:function(){p.overrideSettings(v.Category.ENGINE,"debug",Ae.isDebugger()),y.instance.resizeWithBrowserSize(!1),_e.isDesktop()?f.frameRate=Ee.Desktop:f.frameRate=Ee.Mobile}},{key:"setupAutoAtlas",value:function(){m.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var e=m.instance.downloader;e.maxConcurrency=30,e.maxRequestsPerFrame=30}},{key:"getPipelineFlows",value:function(){var e,t;return null!==(e=null===(t=g.root)||void 0===t||null===(t=t.pipeline)||void 0===t?void 0:t.flows)&&void 0!==e?e:[]}},{key:"getRenderQueues",value:function(e){var t=this.getPipelineFlows()[0];return null!=t&&t.stages?t.stages[e].renderQueues:[]}},{key:"setupOptimalPipelines",value:(t=a((function*(){m.instance.transformPipeline.remove(1)})),function(){return t.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var e=this;E.on(S.EventType.TOUCH_START,this.handleResumeEngine),be.catchUp(ye.GAME_READY,(function(){be.on(ye.VISIBILITY_HIDDEN,e.handlePauseEngine),be.on(ye.VISIBILITY_VISIBLE,e.handleResumeEngine),e.restoreRequestAnimationFrame()}))}},{key:"restoreRequestAnimationFrame",value:function(){window.requestAnimationFrame=window.originalRequestAnimationFrame}},{key:"setupDynamicAtlas",value:function(){switch(A.os){case A.OS.IOS:this.setupDynamicAtlasForIOS();break;case A.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(e){var t=e.Enabled,n=e.AutoAtlasSize,i=e.MaxAtlasCount,a=e.MaxAtlasSize,r=e.MaxFrameSize;if(_.CLEANUP_IMAGE_CACHE=!1,w.instance.enabled=t,w.instance.textureSize=a,w.instance.maxFrameSize=r,w.instance.maxAtlasCount=i,w.instance.textureBleeding=ge.TextureBleeding,n){var s=this.getMaxTextureSize();if(!s)return;w.instance.textureSize=s}}},{key:"getMaxTextureSize",value:function(){if(!g.root)return-1;var e=g.root.device.capabilities.maxTextureSize;if(e>8192)return 7168;var t=w.instance.maxFrameSize,n=e-1024;return n<=(void 0===t?0:t)||n<=0?-1:n}},{key:"setupDynamicAtlasForIOS",value:function(){var e=ge.IOS;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForAndroid",value:function(){var e=ge.Android;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForDesktop",value:function(){var e=ge.Desktop;this.setDynamicAtlas(e)}},{key:"setupBatcherLimit",value:function(){_.BATCHER2D_MEM_INCREMENT=288,_.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(e,t){var n,i=window.devicePixelRatio,a=i>=2?2/i:1,r=Math.round(e*i*a),s=Math.round(t*i*a);null===(n=g.root)||void 0===n||n.resize(r,s);var o=y.instance.getDesignResolutionSize();o.width>0&&o.height>0&&(b.windowSize=new k.Size(r,s)),g.once(C.EVENT_AFTER_UPDATE,(function(){f.emit(M.VIEW_RESIZED,{width:r,height:s})}))}}]),e}()).prototype,"handleViewResized",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e){var t=e.width,n=e.height;console.info("âœ¨ New View Size",{width:t,height:n})}}}),le);h._RF.pop();var Ce,De=new(function(){function e(){i(this,e),this._registry={},this._moduleCache={}}return n(e,[{key:"define",value:function(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function(e,t){throw new Error("Module '".concat(e,"' imported from '").concat(t,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(e,t){var n=this._moduleCache[e];if(n)return n.exports;var i={id:e,exports:{}};return this._moduleCache[e]=i,this._tryModuleLoad(i,e),i.exports}},{key:"_resolve",value:function(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function(e,t){var n,i;return e in cjsInfos?e:t&&null!==(n=null===(i=cjsInfos[t])||void 0===i?void 0:i.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function(e,t){var n=this._loadWrapper(t),i=n.factory,a=n.resolveMap,r=this._createRequire(e),s=a?this._createRequireWithResolveMap("function"==typeof a?a():a,r):r;i(e.exports,s,e)}},{key:"_loadWrapper",value:function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function(e){return{factory:function(t,n,i){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(e,"'."));try{i.exports=require(e)}catch(t){throw new Error("Exception thrown when calling host defined require('".concat(e,"')."),{cause:t})}}}}},{key:"_createRequire",value:function(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function(e,t){return function(n){var i=e[n];if(i)return t(i);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function(e,t){throw new Error("Unable to resolve ".concat(e," from ").concat(parent,"."))}}]),e}());function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Te,Ie,Le,Fe,xe,Me,Ne,Oe="file:///C:/Tests/save-the-pets/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";De.define(Oe,(function(e,t,n,i,a){!function(t,i){"object"===Re(e)&&void 0!==n?n.exports=i():"function"==typeof define&&define.amd?define(i):t.ResizeObserver=i()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,i){return e[0]===t&&(n=i,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var a=i[n];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],r="undefined"!=typeof MutationObserver,s=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,a=!1,r=0;function s(){n&&(n=!1,e()),a&&c()}function o(){i(s)}function c(){var e=Date.now();if(n){if(e-r<2)return;a=!0}else n=!0,a=!1,setTimeout(o,t);r=e}return c}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),r?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;a.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),o=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},c=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},u=v(0,0,0,0);function l(e){return parseFloat(e)||0}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+l(e["border-"+n+"-width"])}),0)}function h(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return u;var i=c(e).getComputedStyle(e),a=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var a=i[n],r=e["padding-"+a];t[a]=l(r)}return t}(i),r=a.left+a.right,s=a.top+a.bottom,o=l(i.width),h=l(i.height);if("border-box"===i.boxSizing&&(Math.round(o+r)!==t&&(o-=d(i,"left","right")+r),Math.round(h+s)!==n&&(h-=d(i,"top","bottom")+s)),!function(e){return e===c(e).document.documentElement}(e)){var f=Math.round(o+r)-t,p=Math.round(h+s)-n;1!==Math.abs(f)&&(o-=f),1!==Math.abs(p)&&(h-=p)}return v(a.left,a.top,o,h)}var f="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof c(e).SVGGraphicsElement}:function(e){return e instanceof c(e).SVGElement&&"function"==typeof e.getBBox};function p(e){return t?f(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):h(e):u}function v(e,t,n,i){return{x:e,y:t,width:n,height:i}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=p(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),m=function(e,t){var n,i,a,r,s,c,u,l=(i=(n=t).x,a=n.y,r=n.width,s=n.height,c="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(c.prototype),o(u,{x:i,y:a,width:r,height:s,top:a,right:i+r,bottom:s+a,left:i}),u);o(this,{target:e,contentRect:l})},g=function(){function t(t,n,i){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=i}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof c(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof c(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new m(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),E="undefined"!=typeof WeakMap?new WeakMap:new e,S=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=s.getInstance(),i=new g(t,n,this);E.set(this,i)};return["observe","unobserve","disconnect"].forEach((function(e){S.prototype[e]=function(){var t;return(t=E.get(this))[e].apply(t,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:S})),Ce=n.exports}),{}),De.require(Oe),h._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var Pe=P.Layout,Ue=P.DesignSize,Ge=Ue.Portrait,ze=Ue.Landscape,Be=GameCore,He=Be.Utils.Decorator,Ve=Be.Configs.GameEngine,qe=Ve.AutoResizeCanvas,We=Ve.AutoChangeOrientation,je=(Te=He.debounce(200),Ie=He.debounce(200),Le=He.debounce(200),xe=r((Fe=function(){function e(){i(this,e),this.currentLayout="",s(this,"handleViewResizeBySystem",xe,this),s(this,"handleViewResize",Me,this),s(this,"handleBodyResize",Ne,this)}return n(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){qe&&(b.on("window-resize",this.handleViewResize,this),b.on("orientation-change",this.handleViewResize,this)),f.on(M.REQUEST_VIEW_RESIZE,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){qe&&new Ce(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){We&&(y.instance.resizeWithBrowserSize(!0),y.instance.setOrientation(_.ORIENTATION_AUTO),this.resolutionPolicy=y.instance.getResolutionPolicy(),this.resolutionPolicy.setContentStrategy(D.ContentStrategy.EXACT_FIT),this.resolutionPolicy.setContainerStrategy(D.ContainerStrategy.EQUAL_TO_FRAME))}},{key:"setupOrientationByScreenSize",value:function(){We&&(this.getScreenRatio()<=Ge.WIDTH/Ge.HEIGHT?this.setPortraitView():this.setLandscapeView())}},{key:"resizeGameDiv",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.getElementById("GameDiv");if(!t)return!1;var n=U.getScreenWidthCss(),i=U.getScreenHeightCss(),a=t.getBoundingClientRect(),r=a.width,s=a.height;return!(n===r&&i===s&&!e)&&(t.style.width="".concat(n,"px"),t.style.height="".concat(i,"px"),!0)}},{key:"resizeGameView",value:function(){var e=U.getScreenWidthCss(),t=U.getScreenHeightCss();f.emit(M.VIEW_RESIZE,{width:e,height:t})}},{key:"setPortraitView",value:function(){var e=Ge.WIDTH,t=Ge.HEIGHT;this.currentLayout!==Pe.Portrait&&(this.currentLayout=Pe.Portrait,this.changeDesignResolutionSize(e,t))}},{key:"setLandscapeView",value:function(){var e=ze.WIDTH,t=ze.HEIGHT;this.currentLayout!==Pe.Landscape&&(this.currentLayout=Pe.Landscape,this.changeDesignResolutionSize(e,t))}},{key:"changeDesignResolutionSize",value:function(e,t){this.currentLayout===Pe.Portrait?this.resolutionPolicy.setContentStrategy(D.ContentStrategy.FIXED_WIDTH):this.resolutionPolicy.setContentStrategy(D.ContentStrategy.FIXED_HEIGHT);var n=this.currentLayout===Pe.Portrait,i=this.currentLayout===Pe.Landscape;n&&!P.FULL_PORTRAIT_SIZE?this.resolutionPolicy.setContentStrategy(D.ContentStrategy.SHOW_ALL):i&&!P.FULL_LANDSCAPE_SIZE&&this.resolutionPolicy.setContentStrategy(D.ContentStrategy.EXACT_FIT),y.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),f.emit(M.LAYOUT_CHANGED,this.currentLayout),console.info("ðŸ“± Change layout to",this.currentLayout,this.resolutionPolicy)}},{key:"getScreenRatio",value:function(){return U.getScreenWidthCss()/U.getScreenHeightCss()}}]),e}()).prototype,"handleViewResizeBySystem",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){console.debug("ðŸ“± View resize by system"),window.devicePixelRatio=t||window.devicePixelRatio,e.setupOrientationByScreenSize(),e.resizeGameView()}}}),Me=r(Fe.prototype,"handleViewResize",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){console.debug("ðŸ“± View resize by window"),e.setupOrientationByScreenSize(),e.resizeGameView()}}}),Ne=r(Fe.prototype,"handleBodyResize",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.resizeGameDiv()&&(console.debug("ðŸ“± View resize by body"),e.setupOrientationByScreenSize(),e.resizeGameView())}}}),Fe);h._RF.pop(),h._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var Ye=GameCore,Qe=Ye.Utils,Ke=Ye.Dtos,Ze=Qe.Valid,Je=globalThis.game.player,Xe=function(){function e(){i(this,e)}return n(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var e=Ke.Player;e.Data.addDefaultData(G),e.GameData.addDefaultData(z),e.GameData.addValidateFunction("totalLevel",(function(e){if(!Ze.isNumber(e)||e<1)throw new Error("totalLevel ".concat(e," is invalid"))})),e.GameData.addValidateFunction("passAllLevels",(function(e){if(!Ze.isBoolean(e))throw new Error("passAllLevels ".concat(e," is invalid"))})),e.GameData.addValidateFunction("levelProgress",(function(e){if(!Ze.isObject(e))throw new Error("levelProgress ".concat(e," is invalid"))})),e.GameData.addValidateFunction("bestEndlessScore",(function(e){if(!Ze.isNumber(e)||e<0)throw new Error("bestEndlessScore ".concat(e," is invalid"))}))}},{key:"requestConnectedPlayers",value:function(){Je.requestConnectedPlayers().catch((function(e){console.warn("player.requestConnectedPlayers",e)}))}}]),e}();h._RF.pop(),h._RF.push({},"c510204p3JAXLCuogskxTkP","AdaptivePerformance",void 0);var $e=GameCore,et=$e.Events,tt=$e.Utils.Valid,nt=globalThis.game,it=nt.event,at=nt.adaptivePerformance,rt=function(){function e(){var t=this;i(this,e),this.handleBeginFrame=function(){g.on(C.EVENT_AFTER_UPDATE,t.lateUpdate),g.on(C.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){at&&at.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;tt.isNumber(t)&&f.emit(M.REQUEST_VIEW_RESIZE,t)},this.lateUpdate=function(){var e=1e3*f.deltaTime;null==at||at.updatePostStepDeltaTime(e)},this.updateActualFPS=function(){var e,t=null===(e=g.root)||void 0===e?void 0:e.fps;tt.isNumber(t)&&(null==at||at.updateActualFPS(t))}}return n(e,[{key:"init",value:function(){at&&this.listenEvents()}},{key:"listenEvents",value:function(){it.on(et.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),g.once(C.EVENT_BEGIN_FRAME,this.handleBeginFrame),g.on(C.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();h._RF.pop(),h._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var st=globalThis.game.canvasRecorder,ot=function(){function e(){i(this,e)}return n(e,[{key:"init",value:function(){if(f.canvas&&st){st.setCanvas(f.canvas);var e=st.getOptions(),t=function(){f.pause(),f.step()},n=st.waitNextFrame;st.waitNextFrame=function(){var i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(a,r){i||st.isCapturing()?e.syncFps?(g.once(C.EVENT_AFTER_RENDER,a),t()):n(i).then(a).catch(r):f.resume()}))}}}}]),e}();h._RF.pop(),h._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var ct,ut,lt=GameCore,dt=lt.Configs.GameEngine.DynamicAssets,ht=lt.Events,ft=lt.Utils.Array,pt=globalThis.game,vt=pt.event,yt=pt.storage,mt=pt.getBuildVersion,gt=[".png",".jpg",".jpeg",".webp"],Et=function(){function e(){var t=this;i(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradableAssets=new Map,this.handleSceneLaunched=function(e){var t=e.sceneName,n=[N.BOOT_SCENE];ft.has(n,t)||f.emit(M.CHANGE_QUALITY_ASSETS,{quality:"highest"})},this.requestUpdateDynamicAssets=function(){f.emit(M.UPGRADE_DYNAMIC_ATLAS,{force:!0})},this.collectUpgradableAssets=function(e){var n,i=e.output=e.input,a=dt.Resolution,r=a.Adjust,s=a.Original,o=c(i);try{for(o.s();!(n=o.n()).done;){var u=n.value;if(ft.has(gt,u.ext)&&!t.upgradableAssets.has(u.uuid)){t.useHighQuality?(u.url=t.replaceAssetUrl(u.url),u.resolution=s,u.upgradeOnNextRequest=!0):r<s&&(u.resolution=r);var l={ext:u.ext,url:u.url,uuid:u.uuid,options:u.options,upgraded:u.upgraded,resolution:u.resolution,upgradeOnNextRequest:u.upgradeOnNextRequest};t.upgradableAssets.set(u.uuid,l)}}}catch(e){o.e(e)}finally{o.f()}},this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.handleChangeQuality=a((function*(){t.isProcessing=!0;var e,n=[],i=c(t.upgradableAssets.values());try{for(i.s();!(e=i.n()).done;){var a=e.value,r=t.processUpgradeQualityAsync(a);n.push(r)}}catch(e){i.e(e)}finally{i.f()}var s=yield Promise.all(n);t.isProcessing=!1;var o=s.filter((function(e){return e})).length;t.requestUpdateDynamicAssets(),console.warn("DynamicAssets: Upgradable Assets Info",{total:o,results:s})}))}var t,r,s,u;return n(e,[{key:"init",value:(u=a((function*(){var e=dt.Enabled,t=dt.Resolution;console.info("DynamicAssets: init",{EDITOR:B,Enabled:e}),e&&(m.instance.transformPipeline.insert(this.collectUpgradableAssets,2),yield this.initStorage(),yield this.checkCacheVersion(),this.listenEvents(),window.requestIdleCallback=window.requestIdleCallback||function(e){e()},t.Adjust,t.Original)})),function(){return u.apply(this,arguments)})},{key:"initStorage",value:(s=a((function*(){yield yt.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0)})),function(){return s.apply(this,arguments)})},{key:"checkCacheVersion",value:(r=a((function*(){var e=mt().toString(),t=yt.getStorage("DynamicAssets"),n=null!=t?t:{},i=n.buildVersion,a=n.useHighQuality;"boolean"==typeof a&&(this.useHighQuality=a&&i===e),yt.setStorageData("DynamicAssets","buildVersion",e),yield yt.updateToWebStorage("DynamicAssets")})),function(){return r.apply(this,arguments)})},{key:"listenEvents",value:function(){var e=this;f.on(M.CHANGE_QUALITY_ASSETS,this.handleChangeQuality),setTimeout((function(){e.useHighQuality=!0,e.autoUpgradeQuality(),vt.on(ht.SCENE_LAUNCHED,e.handleSceneLaunched)}),4e3)}},{key:"autoUpgradeQuality",value:function(){var e=this;requestIdleCallback(a((function*(){if(!e.isProcessing&&!f.isPaused()){var t=o(e.upgradableAssets.values()).find((function(e){return!e.upgraded&&!e.upgradeOnNextRequest}));if(!t)return yt.setStorageData("DynamicAssets","useHighQuality",!0),yt.updateToWebStorage("DynamicAssets"),void e.requestUpdateDynamicAssets();console.debug("DynamicAssets: Auto upgrade quality",t),e.isProcessing=!0,yield e.processUpgradeQualityAsync(t),e.isProcessing=!1,e.autoUpgradeQuality()}})),{timeout:1e3})}},{key:"processUpgradeQualityAsync",value:(t=a((function*(e){var t=this;if(e.upgraded||e.upgradeOnNextRequest)return!0;var n=m.instance,i=n.assets,a=n.loadAny,r=i.get(e.uuid);return r instanceof R?(e.url=this.replaceAssetUrl(e.url),new Promise((function(n){a(e,e.options,(function(i,a){if(i)return console.warn("DynamicAssets: Upgrade error",i),void n(!1);r.reset(a),e.upgraded=!0,t.upgradableAssets.set(e.uuid,e),f.emit(M.ASSET_QUALITY_CHANGE,{asset:r,item:e}),n(!0)}))}))):(console.warn("DynamicAssets: Asset not found",e.uuid),!1)})),function(e){return t.apply(this,arguments)})}]),e}();h._RF.pop(),h._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var St=GameCore,At=St.Events,_t=St.Configs.GameEngine.DynamicAtlas,wt=_t.UsePowerOfTwo,bt=_t.TextureAtlasOptimize,kt=St.Utils,Ct=kt.Array,Dt=kt.Json,Rt=kt.Object,Tt=kt.Decorator,It=globalThis.game.event,Lt=(ct=Tt.debounce(600),r((ut=function(){function e(){var t=this;i(this,e),this.atlasTexId=null,this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.setupRenderListeners=function(){g.on(C.EVENT_BEFORE_RENDER,t.updateBeforeRenderTime),g.on(C.EVENT_AFTER_RENDER,t.updateAfterRenderTime),It.catchUp(At.SCENE_LAUNCHED,(function(){g.once(C.EVENT_AFTER_RENDER,t.checkRenderTimeHighers)}))},this.checkRenderTimeHighers=function(){var e=t.getMeanRenderTime();e>8&&t.handleLaggyFrame(e),g.once(C.EVENT_AFTER_RENDER,(function(){setTimeout(t.checkRenderTimeHighers,t.renderTimeInterval)}))},this.resetPendingSprites=function(){console.debug("DynamicAtlas: Reset pending sprites"),t.pendingSprites={}},this.updateBeforeRenderTime=function(){t.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){t.renderTimes.push(performance.now()-t.lastRenderTime)},this.requestUpdateDynamicAtlas=function(e){t.isProcessing||(t.forceUpdateDynamicAtlas||(t.forceUpdateDynamicAtlas=(null==e?void 0:e.force)||!1),t.updateDynamicAtlas())},this.generateDrawInfo=function(e){if(!(e.length<1)){var n=e.sort((function(e,t){return t.usageCount-e.usageCount})),i=w.instance.textureSize;if(t.calculateOptimizedAtlas(n,i),t.atlasInfo){var a,r=t.atlasInfo.textures,s=c(r);try{for(s.s();!(a=s.n()).done;){var o=a.value;t.drawInfo.push(o)}}catch(e){s.e(e)}finally{s.f()}var u=n.filter((function(e){return!r.some((function(t){return t.id===e.id}))}));u.length>0&&(console.warn("DynamicAtlas: Missing textures",u),t.generateDrawInfo(u))}else console.warn("DynamicAtlas: Atlas info not found",{textures:n})}},this.calculateOptimizedAtlas=function(e,n){var i=function(e){var t,n=0,i=0,a=c(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n+=r.w*r.h,i=Math.max(i,r.w)}}catch(e){a.e(e)}finally{a.f()}e.sort((function(e,t){return t.h-e.h}));var s,o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),i),h:1/0}],u=0,l=0,d=c(e);try{for(d.s();!(s=d.n()).done;)for(var h=s.value,f=o.length-1;f>=0;f--){var p=o[f];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,l=Math.max(l,h.y+h.h),u=Math.max(u,h.x+h.w),h.w===p.w&&h.h===p.h){var v=o.pop();f<o.length&&(o[f]=v)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(o.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}}catch(e){d.e(e)}finally{d.f()}return{w:u,h:l,fill:n/(u*l)||0}}(e),a=i.w,r=i.h,s=i.fill;if(s<.6)console.warn("DynamicAtlas: Fill rate is too low",s,o(e));else{if(a>n||r>n)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",a,r,n),void(e.pop()?t.calculateOptimizedAtlas(e,n):console.warn("DynamicAtlas: Texture size is too big",a,r,n));t.atlasInfo={textures:e,atlasSize:n,packedInfo:{width:Math.round(a),height:Math.round(r),fillRate:s}}}},this.drawTexture=function(e,n,i){var a,r,s=n.texture,o=s.image,c=s.getId(),u=Ct.search(t.drawInfo,(function(e){return e.id===c}))||{x:-1,y:-1},l=u.x,d=u.y;if(!(l<0||d<0)){var h=i?2:0;l+=h,d+=h;var f=e._innerTextureInfos[c];f||(i&&((o.width<=8||o.height<=8)&&(e._texture.drawTextureAt(o,l-1,d-1),e._texture.drawTextureAt(o,l-1,d+1),e._texture.drawTextureAt(o,l+1,d-1),e._texture.drawTextureAt(o,l+1,d+1)),e._texture.drawTextureAt(o,l-1,d),e._texture.drawTextureAt(o,l+1,d),e._texture.drawTextureAt(o,l,d-1),e._texture.drawTextureAt(o,l,d+1)),e._texture.drawTextureAt(o,l,d),e._count++,e._innerTextureInfos[c]={texture:s,x:l,y:d});var p=n.rect,v=p.x,y=p.y;v+=null!==(a=null==f?void 0:f.x)&&void 0!==a?a:l,y+=null!==(r=null==f?void 0:f.y)&&void 0!==r?r:d;var m={texture:e._texture,x:v,y:y};return l-=h,d-=h,e._innerSpriteFrames.push(n),m}t.pendingSprites[n.uuid]=n},this.refreshComponents=function(e){var t,n=c(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.node.active&&(i.node.active=!1,i.node.active=!0)}}catch(e){n.e(e)}finally{n.f()}},this.isSameAtlas=function(e,t){if(!e||!t)return!1;var n=e.textures,i=t.textures;if(n.length!==i.length)return!1;var a=n.slice().sort((function(e,t){return e.id.localeCompare(t.id)})),r=i.slice().sort((function(e,t){return e.id.localeCompare(t.id)}));return a.every((function(e,t){var n=r[t];if(!n)return!1;var i=e.id,a=e.name,s=e.w,o=e.h,c=n.id,u=n.name,l=n.w,d=n.h;return!a||i===c&&(a===u&&s===l&&o===d)}))}}return n(e,[{key:"init",value:function(){bt&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:bt}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){f.on(M.UPGRADE_DYNAMIC_ATLAS,this.requestUpdateDynamicAtlas),It.on(At.SWITCH_SCENE,this.resetPendingSprites),It.on(At.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas),It.catchUp(At.GAME_READY,this.setupRenderListeners)}},{key:"handleLaggyFrame",value:function(e){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(e.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var e,t=0,n=c(this.renderTimes);try{for(n.s();!(e=n.n()).done;){t+=e.value}}catch(e){n.e(e)}finally{n.f()}return t/=this.renderTimes.length,this.renderTimes=[],t}},{key:"overrideDynamicAtlas",value:function(){var e=this,t=w.instance;w.instance.insertSpriteFrame=function(n){if(!t.enabled)return null;if(t._atlasIndex>=t._maxAtlasCount)return null;if(!n||n.original)return console.warn("DynamicAtlas: Skip original texture",n),null;if(!n.packable)return console.warn("DynamicAtlas: Skip non-packable texture",n),null;var i=e.getAtlas(),a=i?i.insertSpriteFrame(n):null;return!a&&t._atlasIndex<t._maxAtlasCount&&(a=(i=e.getAtlas())?i.insertSpriteFrame(n):null),a}}},{key:"createAtlas",value:function(){return w.instance.newAtlas()}},{key:"getAtlas",value:function(){var e=this,t=w.instance,n=t._atlases,i=void 0===n?[]:n,a=t._atlasIndex,r=t.textureBleeding,s=i[a];return s||(s=this.createAtlas()),s?(s.originalInsertSpriteFrame||(s.originalInsertSpriteFrame=s.insertSpriteFrame,s.insertSpriteFrame=function(t){return e.drawTexture(s,t,r)}),this.atlasTexId=s._texture.getId(),s):null}},{key:"updateDynamicAtlas",value:function(){try{var e=g.getScene();if(!e)return;var t=this.collectPackageInfo();if(Object.keys(t).length<1)return;if(this.drawInfo=[],this.atlasInfo=null,this.isProcessing=!0,this.generateDrawInfo(Rt.vals(t)),!this.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!this.updateAtlasData()&&!this.forceUpdateDynamicAtlas)return;var n=e.getComponentsInChildren(T);this.refreshComponents(n)}catch(e){console.error("DynamicAtlas: Error updating dynamic atlas",e)}finally{this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1}}},{key:"collectPackageInfo",value:function(){var e,t=Rt.vals(this.pendingSprites),n={},i=c(t);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(this.isValidSpriteFrame(a)){var r=a.texture,s=a.original,o=r.getId(),u=null==s?void 0:s._texture.getId();if(o!==u){u&&(o=u),this.collectInfo[o]||this.initializeCollectInfo(o,a);var l=this.collectInfo[o];l&&(l.usageCount++,n[o]=l)}else console.warn("DynamicAtlas: Skip original texture",{texId:o,oriTexId:u})}}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"isValidSpriteFrame",value:function(e){var t=e.packable,n=e.texture,i=e.original,a=e.name,r=e.uuid;if(!t)return console.warn("DynamicAtlas: Skip non-packable texture",a,r),!1;if(!(n instanceof I))return console.warn("DynamicAtlas: Skip non-texture2d texture",a,r),!1;var s=null==i?void 0:i._texture.getId();return this.atlasTexId!==s||(console.warn("DynamicAtlas: Skip texture in atlas",a,r),!1)}},{key:"initializeCollectInfo",value:function(e,t){var n=t.texture,i=t.original,a=t.uuid,r=n.width,s=n.height,o=(null==i?void 0:i._texture)||{width:0,height:0},c=o.width,u=o.height,l=Math.max(r,c)+2,d=Math.max(s,u)+2;l<=1||d<=1?console.warn("DynamicAtlas: Skip invalid texture size",a,{w:l,h:d}):this.collectInfo[e]={id:e,w:l,h:d,x:-1,y:-1,usageCount:0,name:a}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var e=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!e,e)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.debug("DynamicAtlas: atlas info",this.atlasInfo);var t=this.getAtlas();if(!t||!t._texture)return!1;var n=this.atlasInfo.packedInfo,i=t._texture,a={width:i.width,height:i.height},r=n.width+20,s=n.height+20,o=Math.max(r,s),c=wt?o:r,u=a.width!==c||a.height!==c;return console.debug("DynamicAtlas: Update atlas data",{currentSize:a,newSize:c,needsResize:u}),!!u&&(w.instance.reset(),!(!(t=this.getAtlas())||!t._texture)&&(wt?(t._texture.initWithSize(c,c),console.debug("DynamicAtlas: Resize atlas (PO2)",c,t)):(t._texture.initWithSize(r,s),console.debug("DynamicAtlas: Resize atlas",r,s,t)),this.lastAtlasInfo=Dt.clone(this.atlasInfo),!0))}}]),e}()).prototype,"updateDynamicAtlas",[ct],Object.getOwnPropertyDescriptor(ut.prototype,"updateDynamicAtlas"),ut.prototype),ut);h._RF.pop(),h._RF.push({},"2f36c+IsKJAU5s61TqQdaJ6","HybridFileCache",void 0);var Ft=GameCore,xt=Ft.Events,Mt=Ft.Configs.GameEngine.HybridFileCache,Nt=Mt.Enabled,Ot=Mt.PreviewMode,Pt=Mt.BuildMode,Ut=Ft.Utils,Gt=Ut.Object,zt=Ut.Function,Bt=Ut.Json,Ht=globalThis.game,Vt=Ht.event,qt=Ht.storage,Wt=Ht.getBuildVersion,jt=h.internal.CCON,Yt=m.instance,Qt=Yt.downloader,Kt=Yt.pipeline,Zt=Yt.fetchPipeline,Jt=function(){function e(){var t=this;i(this,e),this.supportTypes=[],this.bundledFiles={},this.originDownloaders={},this.downloadFile=function(e){return function(n,i,a){var r=t.getCache(e,n);if(r)return a(null,r);var s=t.getDownloader(e);if(!s)return a(new Error("Downloader not found"),null);s(n,i,(function(i,r){return!i&&t.setCache(e,n,r),a(i,r)}))}},this.clearCache=function(){return qt.initStorageData("HybridFileCache","cachedFiles",{}),qt.initStorageData("HybridFileCache","cachedBundles",{}),qt.initStorageData("HybridFileCache","cachedExtensions",{}),qt.updateToWebStorage("HybridFileCache")}}var t,r,s,o,d;return n(e,[{key:"init",value:(d=a((function*(){Nt&&!B?(yield this.initStorage(),yield this.checkCacheVersion(),this.initSupportedTypes(),this.setupOptimalPipelines(),this.saveOriginDownloaders(),this.registerCustomDownloader(),this.setupBundledFiles(),this.listenEvents(),console.info("Hybrid File Cache: Initialized",{supportTypes:this.supportTypes})):Vt.emit(xt.BUNDLE_READY)})),function(){return d.apply(this,arguments)})},{key:"initStorage",value:(o=a((function*(){yield qt.addStorage("HybridFileCache",{buildVersion:"0",cachedFiles:{},cachedBundles:{},cachedExtensions:{}},!0)})),function(){return o.apply(this,arguments)})},{key:"checkCacheVersion",value:(s=a((function*(){var e=Wt().toString(),t=qt.getStorageData("HybridFileCache","buildVersion");qt.setStorageData("HybridFileCache","buildVersion",e),t!==e?yield this.clearCache():qt.updateToWebStorage("HybridFileCache")})),function(){return s.apply(this,arguments)})},{key:"initSupportedTypes",value:function(){this.supportTypes=Pt.SupportedExtensions}},{key:"setupBundledFiles",value:(r=a((function*(){try{var e,t=[],n=c(this.supportTypes);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.getCachedBundles(i)||t.push(this.downloadBundledFile(i))}}catch(e){n.e(e)}finally{n.f()}t.length>0&&(yield zt.allSettled(t))}finally{Vt.emit(xt.BUNDLE_READY)}})),function(){return r.apply(this,arguments)})},{key:"downloadBundledFile",value:(t=a((function*(e){try{var t=e.replace(".",""),n="./cache/bundle".concat(t.toUpperCase(),".").concat(t);"bundle"===e&&(n="./cache/bundleBUNDLE.json");var i=yield fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}),a=yield i.json();this.setBundledCache(e,a)}catch(t){console.error("Hybrid File Cache: Downloaded bundled file",{type:e,error:t})}})),function(e){return t.apply(this,arguments)})},{key:"setupOptimalPipelines",value:function(){var e=this;if(Ot.Enabled&&Ot.CacheUuidExtension){var t=function(t,n){t.output=t.input;for(var i=0;i<t.input.length;i++){var a=t.input[i];if(a.uuid&&!a.isNative){var r=e.getCacheExtension(a.uuid);r&&(a.overrideUuid=a.uuid,a.uuid="",a.isCached=!0,a.url=a.url.replace(a.ext,r),a.ext=r)}}n(null,null)},n=function(t,n){t.output=t.input;for(var i=0;i<t.input.length;i++){var a=t.input[i];a.overrideUuid&&(a.uuid=a.overrideUuid,a.overrideUuid=""),a.uuid&&(a.isCached||a.isNative||e.setCacheExtension(a.uuid,a.ext))}n()};Kt.insert(t,1),Kt.insert(n,3),Zt.insert(t,1),Zt.insert(n,3),console.debug("Hybrid File Cache: setup optimal pipelines",Kt,Zt)}}},{key:"saveOriginDownloaders",value:function(){var e,t=c(this.supportTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originDownloaders[n]=Qt._downloaders[n]}}catch(e){t.e(e)}finally{t.f()}}},{key:"registerCustomDownloader",value:function(){var e,t=c(this.supportTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;"bundle"!==n&&Qt.register(n,this.downloadFile(n))}}catch(e){t.e(e)}finally{t.f()}}},{key:"listenEvents",value:function(){Vt.on(xt.SCENE_LOADED,(function(){qt.updateToWebStorage("HybridFileCache")})),f.on(M.CLEAR_HYBRID_FILE_CACHE,this.clearCache)}},{key:"getDownloader",value:function(e){var t;return null!==(t=this.originDownloaders[e])&&void 0!==t?t:null}},{key:"getCacheKey",value:function(e,t){var n=t.match(/.*\/([-a-z0-9@]+)\.([^\.]+)$/);if(!n)return null;var i=u(n,3),a=(i[0],i[1]),r=i[2];return!r||e.indexOf(r)<0?null:"".concat(a,":").concat(e)}},{key:"validateDataType",value:function(e,t){Array.isArray(t)&&Gt.hasOwn(t[0],"__type__");return!(".cconb"===e&&Gt.hasOwn(t,"chunks")&&!(Array.isArray(t.chunks)&&t instanceof jt))||(console.warn("Hybrid File Cache: Invalid cconb",{type:e,data:t}),!1)}},{key:"encodeData",value:function(e,t){return".cconb"===e?Gt.hasOwn(t,"_document")&&Gt.hasOwn(t,"_chunks")?new jt(t._document,t._chunks):null:Bt.clone(t)}},{key:"decodeData",value:function(e,t){if(".cconb"===e){if(!Gt.hasOwn(t,"_document")||!Gt.hasOwn(t,"_chunks"))return null;if(!Array.isArray(t._chunks))return null;var n,i=[],a=c(t._chunks);try{for(a.s();!(n=a.n()).done;){var r=n.value;r instanceof Uint8Array?i.push(r):i.push(new Uint8Array(Object.values(r)))}}catch(e){a.e(e)}finally{a.f()}return new jt(t._document,i)}return Bt.clone(t)}},{key:"setCache",value:function(e,t,n){var i=this.getCacheKey(e,t);if(i&&this.validateDataType(e,n)){var a=this.encodeData(e,n);qt.setStorageData("HybridFileCache","cachedFiles",l({},i,a))}}},{key:"getCache",value:function(e,t){var n=this.getCacheKey(e,t);if(!n)return null;var i=this.getFileCaches()[n];return i||(i=this.getBundledCache(e,n)),i?this.decodeData(e,i):(console.warn("Hybrid File Cache: Cache not found",{cacheKey:n,type:e,url:t}),null)}},{key:"getFileCaches",value:function(){var e;return null!==(e=qt.getStorageData("HybridFileCache","cachedFiles"))&&void 0!==e?e:{}}},{key:"getCachedBundles",value:function(e){var t=qt.getStorageData("HybridFileCache","cachedBundles");if(!t)return null;var n=t[e];return n?(this.bundledFiles[e]=n,n):null}},{key:"getBundledCache",value:function(e,t){var n,i=this.bundledFiles[e];return i&&null!==(n=i[t.replace(":".concat(e),"")])&&void 0!==n?n:null}},{key:"setBundledCache",value:function(e,t){this.bundledFiles[e]=t,qt.setStorageData("HybridFileCache","cachedBundles",l({},e,t))}},{key:"getCacheExtension",value:function(e){return this.getCachedExtensions()[e]}},{key:"setCacheExtension",value:function(e,t){qt.setStorageData("HybridFileCache","cachedExtensions",l({},e,t))}},{key:"getCachedExtensions",value:function(){var e;return null!==(e=qt.getStorageData("HybridFileCache","cachedExtensions"))&&void 0!==e?e:{}}}]),e}();h._RF.pop();var Xt={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};h._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var $t=GameCore.Events,en=globalThis.game,tn=en.event,nn=en.language,an=function(){function e(){var t=this;i(this,e),this.handleLanguageChanged=function(){var e=a((function*(e){var n=e.locale;f.emit("update-language",n),t.updateComponentInEditor()}));return function(t){return e.apply(this,arguments)}}()}var r,s,o;return n(e,[{key:"init",value:function(){var e=this;this.addLanguage("en").then((function(){e.setLanguage("en"),e.listenEvent()}))}},{key:"listenEvent",value:function(){tn.on($t.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(o=a((function*(e){var t=yield this.getLangData(e);nn.add(e,t)})),function(e){return o.apply(this,arguments)})},{key:"setLanguage",value:function(e){nn.choose(e)}},{key:"getLangData",value:(s=a((function*(e){switch(e){case"en":return Xt;case"ru":return this.loadLanguageAsync(e);default:throw new Error("Language ".concat(e," not supported"))}})),function(e){return s.apply(this,arguments)})},{key:"loadLanguageAsync",value:(r=a((function*(e){var n=(yield t.import("db://assets/loadable/locales/".concat(e,".json"))).default;nn.add(e,n)})),function(e){return r.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();h._RF.pop(),h._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var rn=GameCore,sn=rn.Configs,on=rn.Utils,cn=sn.Mockup,un=on.Number,ln=globalThis.game.leaderboard,dn=function(){function e(){i(this,e)}var t,r,s,o;return n(e,[{key:"init",value:function(){cn.Leaderboards.Enabled?this.setupLeaderboardsMockup():this.setupLeaderboards()}},{key:"setupLeaderboards",value:(o=a((function*(){this.setupLeaderboardByConfigs()})),function(){return o.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var e=sn.Leaderboards.LeaderboardId;e?(ln.addLeaderboard({name:H.GLOBAL,type:"global",autoSortRank:!0,leaderboardId:e}),ln.addLeaderboard({name:H.FRIENDS,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(s=a((function*(){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard()})),function(){return s.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(r=a((function*(){var e=H.GLOBAL,t=V.GLOBAL,n=yield ln.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:100});ln.addLeaderboard({name:e,type:"global",autoSortRank:!0,leaderboardId:n})})),function(){return r.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(t=a((function*(){var e=H.FRIENDS,t=V.FRIENDS,n=0,i=cn.GameSDK.Player.ConnectedPlayers;i.Enabled&&(n=un.random(i.NumOfPlayers));var a=yield ln.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:n});ln.addLeaderboard({name:e,type:"friends",autoSortRank:!0,leaderboardId:a})})),function(){return t.apply(this,arguments)})}]),e}();h._RF.pop(),h._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var hn=GameCore,fn=hn.Utils,pn=hn.Events,vn=hn.Configs.PerformanceMonitor.FpsTracking,yn=globalThis.game.event,mn=function(){function e(){var t=this;i(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps(),g.on(C.EVENT_AFTER_UPDATE,t.handleLateUpdate)},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=f.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=f.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return n(e,[{key:"mark",get:function(){return vn.Enabled?fn.Mark:null}},{key:"init",value:function(){var e=vn.TrackingDuration,t=vn.TrackingInterval;this.mark&&(this.fpsTraceDuration=null!=e?e:60,this.fpsTraceInterval=null!=t?t:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents())}},{key:"listenEvents",value:function(){yn.catchUp(pn.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){g.off(C.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var e,t;if(this.mark){var n=this.getFPS(),i=this.getDrawCalls(),a=this.getDeviceRender(),r=this.getTextureMemory();this.minFps=Math.min(null!==(e=this.minFps)&&void 0!==e?e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",a),this.mark.putAttr(this.markName,"Draw Calls",i.toString()),this.mark.putAttr(this.markName,"Texture Memory",r.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.debug("FPS: ".concat(n," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(i,", texture memory: ").concat(r.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!g.root)return 0;var e=g.root.fps;return Math.floor(e)||0}},{key:"getDrawCalls",value:function(){return g.root&&g.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return g.root&&g.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return g.root&&g.root.device.memoryStatus.textureSize/1048576||0}}]),e}();h._RF.pop(),h._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var gn=GameCore.Events,En=globalThis.game.event,Sn=function(){function e(){i(this,e),this.handleHotReload=function(){f.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){f.emit(M.GAMEPLAY_UPDATE_CONFIG,e.config);var t=e.id,n=e.type;En.emit(gn.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return n(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){En.on(gn.REQUEST_HOT_RELOAD,this.handleHotReload),En.on(gn.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();h._RF.pop(),h._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var An=function(){function e(){i(this,e)}return n(e,[{key:"init",value:function(){this.initHybridFileCache(),console.info("Plugins Manager: Initialized")}},{key:"initLanguages",value:function(){(new an).init()}},{key:"initLeaderboards",value:function(){(new dn).init()}},{key:"initRemoteConfig",value:function(){(new Sn).init()}},{key:"initDynamicAtlas",value:function(){(new Lt).init()}},{key:"initDynamicAssets",value:function(){(new Et).init()}},{key:"initHybridFileCache",value:function(){(new Jt).init()}},{key:"initCanvasRecorder",value:function(){(new ot).init()}},{key:"initPerformanceMonitor",value:function(){(new mn).init()}},{key:"initAdaptivePerformance",value:function(){(new rt).init()}}]),e}();h._RF.pop(),h._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var _n=globalThis.game,wn=_n.event,bn=_n.monitorError,kn=GameCore,Cn=kn.Events,Dn=kn.Configs.PerformanceMonitor,Rn=kn.Utils.Mark,Tn=function(){function e(){var t=this;i(this,e),this.markName="Load Scene",this.testScene={},this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var e=a((function*(e){var n=e.sceneName,i=e.sceneData,a=t.correctSceneName(n);console.debug("Switching",a,null!=i?i:{}),a&&(f.emit(M.REQUEST_VIEW_RESIZE),setTimeout((function(){q.showLoadingFullScreen(a)}),0),t.startScene({sceneName:a,sceneData:i}))}));return function(t){return e.apply(this,arguments)}}(),this.preloadScene=function(e,n){var i=e.sceneName;t.startMeasure(e),g.preloadScene(i,t.onSceneProgress,t.onScenePreloaded(i,n))},this.startMeasure=function(e){if(t.mark){var n=e.sceneName,i=e.startScene;t.queueLoadScene[n]&&(t.mark.putAttr(t.markName,"Canceled","true"),t.stopMeasure(n)),console.groupCollapsed("ðŸ“¦ ".concat(n,": ").concat(i?"start":"preload"," progress")),t.mark.measure(t.markName),t.mark.putAttr(t.markName,"Cancel","false"),t.mark.putAttr(t.markName,"Success","false"),t.mark.putMetric(t.markName,n),t.mark.start(t.markName),t.queueLoadScene[n]=!0}},this.stopMeasure=function(e){t.mark&&t.queueLoadScene[e]&&(t.mark.rmAttr(t.markName,"File"),t.mark.putAttr(t.markName,"Success","true"),t.mark.stop(t.markName),t.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=function(e,n,i){var a=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File","".concat(i.id," (").concat(i.ext,")"));var r=Math.floor(70*a+30);GameSDK.setLoadingProgress(r)},this.onScenePreloaded=function(e,t){return function(n){n?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:n}):(t&&t(e,n),wn.emit(Cn.SCENE_LOADED,{sceneName:e,isPreload:!0}))}},this.onDirectorLoadScene=function(e){return function(n,i){if(n)console.warn("SceneManager.onSceneLoaded",n);else if(null!=i&&i.scene){var a=i.name;t.handleBeforeSceneLaunch(i,e)(),g.once(C.EVENT_AFTER_SCENE_LAUNCH,t.handleSceneLaunched(a,e))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(e,n){return function(){t.setSceneData(e,null!=n?n:{}),f.emit(M.REQUEST_VIEW_RESIZE),wn.emit(Cn.SCENE_LOADED,{sceneName:e.name}),wn.clear(Cn.MARK_IS_TEST_SCENE)}},this.handleSceneLaunched=function(e,n){return function(){var i;q.hideLoadingFullScreen(e),W.switchSceneTracking(),null==bn||bn.addMetadata({currentScene:e}),null===(i=t.callbackSwitchScene)||void 0===i||i.call(t,{sceneName:e,sceneData:n}),wn.emit(Cn.SCENE_LAUNCHED,{sceneName:e})}},this.handleSceneLoaded=function(e){var n=e.sceneName;t.stopMeasure(n)},this.setTestScene=function(e){var n=e.sceneName;t.testScene[n]=!0}}return n(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){wn.catchUp(Cn.MARK_IS_TEST_SCENE,this.setTestScene),wn.on(Cn.SWITCH_SCENE,this.switchScene),wn.on(Cn.PRELOAD_SCENE,this.preloadScene),wn.on(Cn.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(e){var t=this.getCurrentScene(),n=this.getTestScene();return n&&(null==t?void 0:t.name)!==n?n:t?e===N.DASHBOARD_SCENE?N.GAME_SCENE:e===t.name?null:e:e}},{key:"startScene",value:function(e){var t=this,n=e.sceneName,i=e.sceneData;this.preloadScene({sceneName:n,startScene:!0},(function(e,a){e===n&&(a?console.warn("SceneManager.startScene",{sceneName:n,error:a}):g.loadScene(n,t.onDirectorLoadScene(i)))}))}},{key:"mark",get:function(){return Dn.LoadResources?Rn:null}},{key:"getCurrentScene",value:function(){return g.getScene()}},{key:"getTestScene",value:function(){var e;return null!==(e=Object.keys(this.testScene)[0])&&void 0!==e?e:null}},{key:"onSwitchScene",value:function(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:d(d({},n),t)}),console.debug("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();h._RF.pop(),h._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var In=globalThis.game,Ln=In.event,Fn=In.monitorError,xn=GameCore,Mn=xn.Events,Nn=xn.Utils,On=Nn.Object,Pn=Nn.Valid,Un=(Nn.Time,function(){function e(){var t=this;i(this,e),this.screens={},this.queueInstantiatingScreens={},this.handleOpenScreen=function(e){var n=e.screenName,i=e.screenData;t.openScreen(n,i)},this.handleOpenedScreen=a((function*(){})),this.handleCloseScreen=function(e){var n=e.screenName;t.closeScreen(n)},this.handleClosedScreen=a((function*(){})),this.handlePreloadScreens=function(){var e=g.getScene();e&&(t.initScreens(e),t.preloadScreens())}}var t,r,s,o;return n(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){Ln.on(Mn.OPEN_SCREEN,this.handleOpenScreen),Ln.on(Mn.OPENED_SCREEN,this.handleOpenedScreen),Ln.on(Mn.CLOSE_SCREEN,this.handleCloseScreen),Ln.on(Mn.CLOSED_SCREEN,this.handleClosedScreen),Ln.on(Mn.PRELOAD_SCREENS,this.handlePreloadScreens)}},{key:"initScreens",value:function(e){var t=e.getComponentsInChildren("BaseScreen");if(!Pn.isEmpty(t)){var n=t.map((function(e){return null==e?void 0:e.node.name})).join(", ");console.info("ðŸ“º Loaded Screens in ".concat(e.name,": ").concat(n)),this.addScreens(t)}var i=null==e?void 0:e.getComponentInChildren(j);if(i){var a=i.screenKeys.filter((function(e){return!t.some((function(t){return t.node.name===Y[e]}))}));if(!Pn.isEmpty(a)){var r=a.map((function(e){return Y[e]})).join(", ");console.info("ðŸ“º Lazy-loading Screens in ".concat(e.name,": ").concat(r)),this.addScreenKeys(a,i.node)}}}},{key:"reorderScreens",value:function(){var e=On.vals(this.screens).filter((function(e){return"ready"===e.state}));e.sort((function(e,t){return e.order-t.order}));for(var t=0;t<e.length;t++){var n=e[t];n&&(n.order=t,n.comp.node.setSiblingIndex(n.order))}}},{key:"addScreenKeys",value:function(e,t){var n=this;e.forEach((function(e,i){var a=Y[e];n.screens[a]&&(n.screens[a].order=i),n.screens[Y[e]]={state:"key",parent:t,key:e,order:i}}))}},{key:"addScreens",value:function(e){var t=this;e.forEach((function(e,n){t.screens[e.node.name]={state:"ready",comp:e,order:n}}))}},{key:"preloadScreens",value:(o=a((function*(){var e=On.vals(this.screens).reduce((function(e,t){if("key"===t.state){var n=Q.loadPrefabAsync("screens/".concat(Y[t.key]));e.push(n)}return e}),[]);return yield Promise.all(e)})),function(){return o.apply(this,arguments)})},{key:"getScreen",value:(s=a((function*(e){var t=this.screens[e];if(null==t)return this.sendException(e,"not found"),null;if("ready"===t.state)return t.comp;console.debug("ScreenManager.getScreen","Screen ".concat(e," not found in cache, instantiating it...")),this.queueInstantiatingScreens[e]=!0;var n=t.key,i=t.order,a=yield Q.loadPrefabAsync("screens/".concat(Y[n]));if(delete this.queueInstantiatingScreens[e],!a)return this.sendException(e,"failed to load prefab"),null;if(!t.parent||!t.parent.isValid)return this.sendException(e,"no parent node"),null;var r=L(a);r.name=e,t.parent.addChild(r),r.active=!1;var s=r.getComponent("BaseScreen");return s?(this.screens[e]={state:"ready",comp:s,order:i},this.reorderScreens(),s):(this.sendException(e,"prefab doesn't have BaseScreen component"),null)})),function(e){return s.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var e=this;return Object.keys(this.screens).map((function(t){var n=e.screens[t];return n?"ready"===n.state?"".concat(n.comp.node.name,"(loaded)"):"".concat(Y[n.key],"(not-loaded)"):null})).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(r=a((function*(e,t){try{if(this.queueInstantiatingScreens[e])return;K.setBlockInput(!0);var n=yield this.getScreen(e);if(K.setBlockInput(!1),null==n||!n.node)return void console.warn("ScreenManager.openScreen","Screen ".concat(e," not found"));n.node.active=!0,n.node.setPosition(new F(0,0,0));var i={screenName:e,screenData:t};Ln.emit(Mn.OPENING_SCREEN,i),W.trackCurrentPage(e,!0),null==Fn||Fn.addMetadata({currentScreen:e}),yield Z.waitTweenAsync(0),n.open(t),Ln.emit(Mn.OPENED_SCREEN,i)}catch(e){console.error("ScreenManager.openScreen",e)}})),function(e,t){return r.apply(this,arguments)})},{key:"closeScreen",value:(t=a((function*(e){try{var t;if(this.queueInstantiatingScreens[e])return;var n=yield this.getScreen(e);if(!n)return void console.warn("ScreenManager.closeScreen","Screen ".concat(e," not found"));if(null===(t=n.node)||void 0===t||!t.active)return;var i={screenName:e};Ln.emit(Mn.CLOSING_SCREEN,i),n.close(),W.trackCurrentPage(e,!1),null==Fn||Fn.removeMetadata("currentScreen")}catch(e){console.error("ScreenManager.closeScreen",e)}})),function(e){return t.apply(this,arguments)})},{key:"closeAllScreens",value:function(){for(var e in this.screens){var t=this.screens[e];t&&("ready"===t.state&&this.closeScreen(e))}}},{key:"sendException",value:function(e,t,n){null==Fn||Fn.sendException(new Error("Screen ".concat(e," ").concat(t)),d(d({},n),{},{screens:this.getScreensAsMetadata()}))}}]),e}());h._RF.pop(),h._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var Gn=GameCore,zn=Gn.Configs.Core,Bn=Gn.Events,Hn=Gn.Plugins.Analytics.Events,Vn=globalThis.game,qn=Vn.context,Wn=Vn.storage,jn=Vn.event,Yn=Vn.analytics,Qn=Vn.monitorError;new(function(){function e(){var t=this;i(this,e),this.coreManager=new pe,this.adsManager=new ce,this.sceneManager=new Tn,this.screenManager=new Un,this.engineManager=new ke,this.layoutManager=new je,this.playerManager=new Xe,this.pluginsManager=new An,this.handleWhenCoreBoot=function(){console.warn("Corecos System: Core boot",{inited:f.inited,game:f}),f.inited?t.handleCocosInit():f.once(x.EVENT_GAME_INITED,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),console.groupEnd(),Yn.event(Hn.LOAD_START),jn.catchUp(Bn.BUNDLE_READY,t.processPreStartGame)},this.processPreStartGame=function(){jn.once(Bn.SCENE_LOADED,t.preloadScenes),jn.once(Bn.SCENE_LAUNCHED,t.handleBootSceneLaunched),t.runBootScene()},this.handleBootSceneLaunched=function(){zn.StartSDKAfterLoadGame?jn.once(Bn.SCENE_LOADED,t.handleStartGameWhenMainSceneReady):t.processStartGame()},this.preloadScenes=function(){"solo"===Wn.getStorageData("context","sessionContextType")?J.preloadDashboardScene():J.preloadGameScene()},this.handleStartGameWhenMainSceneReady=function(){t.processStartGame()},this.handleSwitchScene=function(e){var n=e.sceneName,i=t.sceneManager.getCurrentScene();(null==i?void 0:i.name)===n&&i&&(t.screenManager.closeAllScreens(),t.screenManager.clearScreens(),t.screenManager.initScreens(i),t.screenManager.preloadScreens(),console.groupEnd())},this.startProcessContextData=a((function*(){Yn.event(Hn.APP_READY);try{t.playerManager.requestConnectedPlayers(),yield qn.processContextData()}catch(e){console.error("startProcessContextData",e),e instanceof Error&&(null==Qn||Qn.sendException(e))}finally{jn.emit(Bn.GAME_READY)}})),Yn.event(Hn.ENGINE_READY),console.groupCollapsed("ðŸ“¦ Corecos System"),console.info("Corecos Initializing..."),this.initManagers(),this.listenEvents(),console.groupEnd()}var t,r;return n(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"runBootScene",value:function(){J.switchScene(N.BOOT_SCENE)}},{key:"processStartGame",value:(r=a((function*(){console.groupEnd(),Yn.event(Hn.LOAD_COMPLETE),yield this.startGameAsync(),jn.catchUp(Bn.PLAYER_INFO_LOADED,this.startProcessContextData)})),function(){return r.apply(this,arguments)})},{key:"startGameAsync",value:(t=a((function*(){try{yield GameSDK.startGameAsync()}catch(e){console.warn("GameSDK.startGameAsync",e),e instanceof Error&&(null==Qn||Qn.sendException(e))}})),function(){return t.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initLanguages(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAtlas(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),h._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/systems', 'chunks:///systems.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});