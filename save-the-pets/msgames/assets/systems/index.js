System.register("chunks:///systems.js",["./rollupPluginModLoBabelHelpers-60801af6.js","cc","./GeneralUtils-b16822d6.js"],(function(e,t){var n,i,a,r,o,s,c,u,l,d,h,f,p,v,y,g,m,S,E,w,A,_,b,C,D,k,R,T,L,F,M,I,P,x,N,O,U,z,G,B,V,H,q,j,Q,W,Y,K,Z,J,X,$,ee,te,ne,ie;return{setters:[function(e){n=e.f,i=e.c,a=e.g,r=e._,o=e.d,s=e.h,c=e.i,u=e.j,l=e.k,d=e.l,h=e.a,f=e.b},function(e){p=e.cclegacy,v=e.game,y=e.settings,g=e.Settings,m=e.View,S=e.AssetManager,E=e.director,w=e.input,A=e.Input,_=e.sys,b=e.macro,C=e.DynamicAtlasManager,D=e.screen,k=e.math,R=e.Director,T=e.ResolutionPolicy,L=e.Texture2D,F=e.assetManager,M=e.Layers,I=e.ImageAsset,P=e.instantiate,x=e.Game,N=e.gfx,O=e._decorator,U=e.rendering,z=e.Component},function(e){G=e.G,B=e.A,V=e.a,H=e.C,q=e.P,j=e.b,Q=e.E,e.B,W=e.c,Y=e.R,K=e.L,Z=e.d,J=e.e,X=e.S,$=e.f,ee=e.g,te=e.h,ne=e.i,ie=e.j}],execute:function(){p._RF.push({},"0b067Iz+iFJLJjNpsfblY7S","AdsManager",void 0);var e=GameCore,t=e.Events,ae=e.Configs.Ads,re=ae.Enabled,oe=ae.PreloadAds,se=ae.ShowAdOnLoad,ce=ae.BannerDisplayAdOptions,ue=e.Utils.Time,le=globalThis.game.event,de=function(){function e(){var t=this;i(this,e),this.currentLayout="",this.processShowBannerAds=function(){B.showBannerAds()},this.processPreloadAds=a((function*(){oe&&(yield ue.sleepAsync(3e3),B.preloadAds())})),this.processShowFirstInterstitialAd=a((function*(){try{if(!re)return;var e=se.Enabled,t=se.DelaySeconds;if(!e)return;t>0&&(yield ue.sleepAsync(1e3*t)),B.showInterstitialAdAsync({forceLoad:!0,contextType:"preroll"})}catch(e){console.warn("processShowFirstInterstitialAd failed",e)}})),this.handleLayoutChanged=function(e){t.currentLayout!==e&&(t.currentLayout=e,e!==V.Layout.Landscape?ce.forEach((function(e){var t=e.PlacementId,n=e.Position;"bottom"===n||"top"===n?B.showBannerAd(t):B.hideBannerAd(t)})):t.processShowBannerAds())}}return n(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){v.on(G.LAYOUT_CHANGED,this.handleLayoutChanged),le.catchUp(t.GAME_READY,this.processPreloadAds),le.catchUp(t.GAME_READY,this.processShowBannerAds),le.catchUp(t.GAME_SDK_STARTED,this.processShowFirstInterstitialAd)}}]),e}();p._RF.pop(),p._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var he,fe,pe,ve=GameCore.Events,ye=globalThis.game.event,ge=function(){function e(){i(this,e)}return n(e,[{key:"init",value:function(){console.info("Core Manager: Initialized")}},{key:"requestStart",value:function(){ye.emit(ve.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(e){ye.catchUp(ve.CORE_BOOTING,e)}},{key:"onCoreStart",value:function(e){ye.catchUp(ve.CORE_STARTING,e)}},{key:"onCoreReady",value:function(e){ye.catchUp(ve.CORE_READY,e)}}]),e}();p._RF.pop(),p._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var me=GameCore,Se=me.Events,Ee=me.Configs.GameEngine,we=Ee.DynamicAtlas,Ae=Ee.PreferredFPS,_e=me.Utils,be=_e.Valid,Ce=_e.Device,De=_e.Decorator,ke=globalThis.game.event,Re=(he=De.debounce(600),pe=r((fe=function(){function e(){var t=this;i(this,e),this.handlePauseEngine=a((function*(){console.info("Engine: Paused",v.isPaused()),v.isPaused()})),this.handleResumeEngine=a((function*(){t.restoreRequestAnimationFrame(),console.info("Engine: Resumed",v.isPaused()),v.isPaused()})),this.handleResizeView=function(e){var n=e.width,i=e.height;t.resizeView(n,i)},o(this,"handleViewResized",pe,this)}var t;return n(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){v.on(G.VIEW_RESIZE,this.handleResizeView),v.on(G.VIEW_RESIZED,this.handleViewResized)}},{key:"overrideSettings",value:function(){y.overrideSettings(g.Category.ENGINE,"debug",be.isDebugger()),m.instance.resizeWithBrowserSize(!1),Ce.isDesktop()?v.frameRate=Ae.Desktop:v.frameRate=Ae.Mobile}},{key:"setupAutoAtlas",value:function(){S.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var e=S.instance.downloader;e.maxConcurrency=30,e.maxRequestsPerFrame=30}},{key:"getPipelineFlows",value:function(){var e,t;return null!==(e=null===(t=E.root)||void 0===t||null===(t=t.pipeline)||void 0===t?void 0:t.flows)&&void 0!==e?e:[]}},{key:"getRenderQueues",value:function(e){var t=this.getPipelineFlows()[0];return null!=t&&t.stages?t.stages[e].renderQueues:[]}},{key:"setupOptimalPipelines",value:(t=a((function*(){S.instance.transformPipeline.remove(1)})),function(){return t.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var e=this;w.on(A.EventType.TOUCH_START,this.handleResumeEngine),ke.catchUp(Se.GAME_READY,(function(){ke.on(Se.VISIBILITY_HIDDEN,e.handlePauseEngine),ke.on(Se.VISIBILITY_VISIBLE,e.handleResumeEngine),e.restoreRequestAnimationFrame()}))}},{key:"restoreRequestAnimationFrame",value:function(){window.isCustomRequestAnimationFrame=!1}},{key:"setupDynamicAtlas",value:function(){switch(_.os){case _.OS.IOS:this.setupDynamicAtlasForIOS();break;case _.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(e){var t=e.Enabled,n=e.AutoAtlasSize,i=e.MaxAtlasCount,a=e.MaxAtlasSize,r=e.MaxFrameSize;if(b.CLEANUP_IMAGE_CACHE=!t,C.instance.enabled=t,C.instance.textureSize=a,C.instance.maxFrameSize=r,C.instance.maxAtlasCount=i,C.instance.textureBleeding=we.TextureBleeding,n){var o=this.getMaxTextureSize();if(!o)return;C.instance.textureSize=o}}},{key:"getMaxTextureSize",value:function(){if(!E.root)return-1;var e=E.root.device.capabilities.maxTextureSize;if(e>8192)return 7168;var t=C.instance.maxFrameSize,n=e-1024;return n<=(void 0===t?0:t)||n<=0?-1:n}},{key:"setupDynamicAtlasForIOS",value:function(){var e=we.IOS;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForAndroid",value:function(){var e=we.Android;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForDesktop",value:function(){var e=we.Desktop;this.setDynamicAtlas(e)}},{key:"setupBatcherLimit",value:function(){b.BATCHER2D_MEM_INCREMENT=288,b.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(e,t){var n,i=window.devicePixelRatio,a=i>=2?2/i:1,r=Math.round(e*i*a),o=Math.round(t*i*a);if(!(r<1||o<1)){null===(n=E.root)||void 0===n||n.resize(r,o);var s=m.instance.getDesignResolutionSize();s.width>0&&s.height>0&&(D.windowSize=new k.Size(r,o)),E.once(R.EVENT_AFTER_UPDATE,(function(){v.emit(G.VIEW_RESIZED,{width:r,height:o})}))}}}]),e}()).prototype,"handleViewResized",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e){var t=e.width,n=e.height;console.info("✨ New View Size",{width:t,height:n})}}}),fe);p._RF.pop();var Te,Le=new(function(){function e(){i(this,e),this._registry={},this._moduleCache={}}return n(e,[{key:"define",value:function(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function(e,t){throw new Error("Module '".concat(e,"' imported from '").concat(t,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(e,t){var n=this._moduleCache[e];if(n)return n.exports;var i={id:e,exports:{}};return this._moduleCache[e]=i,this._tryModuleLoad(i,e),i.exports}},{key:"_resolve",value:function(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function(e,t){var n,i;return e in cjsInfos?e:t&&null!==(n=null===(i=cjsInfos[t])||void 0===i?void 0:i.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function(e,t){var n=this._loadWrapper(t),i=n.factory,a=n.resolveMap,r=this._createRequire(e),o=a?this._createRequireWithResolveMap("function"==typeof a?a():a,r):r;i(e.exports,o,e)}},{key:"_loadWrapper",value:function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function(e){return{factory:function(t,n,i){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(e,"'."));try{i.exports=require(e)}catch(t){throw new Error("Exception thrown when calling host defined require('".concat(e,"')."),{cause:t})}}}}},{key:"_createRequire",value:function(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function(e,t){return function(n){var i=e[n];if(i)return t(i);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function(e,t){throw new Error("Unable to resolve ".concat(e," from ").concat(parent,"."))}}]),e}());function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Me,Ie,Pe,xe,Ne,Oe,Ue,ze="file:///C:/Tests/save-the-pets/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";Le.define(ze,(function(e,t,n,i,a){!function(t,i){"object"===Fe(e)&&void 0!==n?n.exports=i():"function"==typeof define&&define.amd?define(i):t.ResizeObserver=i()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,i){return e[0]===t&&(n=i,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var a=i[n];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],r="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,a=!1,r=0;function o(){n&&(n=!1,e()),a&&c()}function s(){i(o)}function c(){var e=Date.now();if(n){if(e-r<2)return;a=!0}else n=!0,a=!1,setTimeout(s,t);r=e}return c}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),r?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;a.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},c=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},u=v(0,0,0,0);function l(e){return parseFloat(e)||0}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+l(e["border-"+n+"-width"])}),0)}function h(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return u;var i=c(e).getComputedStyle(e),a=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var a=i[n],r=e["padding-"+a];t[a]=l(r)}return t}(i),r=a.left+a.right,o=a.top+a.bottom,s=l(i.width),h=l(i.height);if("border-box"===i.boxSizing&&(Math.round(s+r)!==t&&(s-=d(i,"left","right")+r),Math.round(h+o)!==n&&(h-=d(i,"top","bottom")+o)),!function(e){return e===c(e).document.documentElement}(e)){var f=Math.round(s+r)-t,p=Math.round(h+o)-n;1!==Math.abs(f)&&(s-=f),1!==Math.abs(p)&&(h-=p)}return v(a.left,a.top,s,h)}var f="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof c(e).SVGGraphicsElement}:function(e){return e instanceof c(e).SVGElement&&"function"==typeof e.getBBox};function p(e){return t?f(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):h(e):u}function v(e,t,n,i){return{x:e,y:t,width:n,height:i}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=p(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),g=function(e,t){var n,i,a,r,o,c,u,l=(i=(n=t).x,a=n.y,r=n.width,o=n.height,c="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(c.prototype),s(u,{x:i,y:a,width:r,height:o,top:a,right:i+r,bottom:o+a,left:i}),u);s(this,{target:e,contentRect:l})},m=function(){function t(t,n,i){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=i}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof c(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof c(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new g(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),S="undefined"!=typeof WeakMap?new WeakMap:new e,E=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=o.getInstance(),i=new m(t,n,this);S.set(this,i)};return["observe","unobserve","disconnect"].forEach((function(e){E.prototype[e]=function(){var t;return(t=S.get(this))[e].apply(t,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:E})),Te=n.exports}),{}),Le.require(ze),p._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var Ge=V.Layout,Be=V.DesignSize,Ve=Be.Portrait,He=Be.Landscape,qe=GameCore,je=qe.Utils.Decorator,Qe=qe.Configs.GameEngine,We=Qe.AutoResizeCanvas,Ye=Qe.AutoChangeOrientation,Ke=(Me=je.debounce(200),Ie=je.debounce(200),Pe=je.debounce(200),Ne=r((xe=function(){function e(){i(this,e),o(this,"handleViewResizeBySystem",Ne,this),o(this,"handleViewResize",Oe,this),o(this,"handleBodyResize",Ue,this)}return n(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){We&&(D.on("window-resize",this.handleViewResize,this),D.on("orientation-change",this.handleViewResize,this)),v.on(G.REQUEST_VIEW_RESIZE,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){We&&new Te(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){Ye&&(m.instance.resizeWithBrowserSize(!0),m.instance.setOrientation(b.ORIENTATION_AUTO),this.resolutionPolicy=m.instance.getResolutionPolicy(),this.resolutionPolicy.setContentStrategy(T.ContentStrategy.EXACT_FIT),this.resolutionPolicy.setContainerStrategy(T.ContainerStrategy.EQUAL_TO_FRAME))}},{key:"setupOrientationByScreenSize",value:function(){Ye&&(this.getScreenRatio()<=Ve.WIDTH/Ve.HEIGHT?this.setPortraitView():this.setLandscapeView())}},{key:"resizeGameDiv",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.getElementById("GameDiv");if(!t)return!1;var n=H.getScreenWidthCss(),i=H.getScreenHeightCss(),a=t.getBoundingClientRect(),r=a.width,o=a.height;return!(n===r&&i===o&&!e)&&(t.style.width="".concat(n,"px"),t.style.height="".concat(i,"px"),!0)}},{key:"resizeGameView",value:function(){if(globalThis.game.ads.isAdFullSizeShowing())console.error("⚠️ LayoutManager:resizeGameView skipped because ad is showing");else{var e=H.getScreenWidthCss(),t=H.getScreenHeightCss();v.emit(G.VIEW_RESIZE,{width:e,height:t})}}},{key:"setPortraitView",value:function(){var e=Ve.WIDTH,t=Ve.HEIGHT;this.currentLayout!==Ge.Portrait&&(this.currentLayout=Ge.Portrait,this.changeDesignResolutionSize(e,t))}},{key:"setLandscapeView",value:function(){var e=He.WIDTH,t=He.HEIGHT;this.currentLayout!==Ge.Landscape&&(this.currentLayout=Ge.Landscape,this.changeDesignResolutionSize(e,t))}},{key:"changeDesignResolutionSize",value:function(e,t){this.currentLayout===Ge.Portrait?this.resolutionPolicy.setContentStrategy(T.ContentStrategy.FIXED_WIDTH):this.resolutionPolicy.setContentStrategy(T.ContentStrategy.FIXED_HEIGHT);var n=this.currentLayout===Ge.Portrait,i=this.currentLayout===Ge.Landscape;n&&!V.FULL_PORTRAIT_SIZE?this.resolutionPolicy.setContentStrategy(T.ContentStrategy.SHOW_ALL):i&&!V.FULL_LANDSCAPE_SIZE&&this.resolutionPolicy.setContentStrategy(T.ContentStrategy.EXACT_FIT),m.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),v.emit(G.LAYOUT_CHANGED,this.currentLayout),console.info("📱 Change layout to",this.currentLayout,this.resolutionPolicy)}},{key:"getScreenRatio",value:function(){return H.getScreenWidthCss()/H.getScreenHeightCss()}}]),e}()).prototype,"handleViewResizeBySystem",[Me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){globalThis.game.ads.isAdFullSizeShowing()?console.error("⚠️ LayoutManager:handleViewResizeBySystem skipped because ad is showing"):(console.debug("📱 View resize by system"),window.devicePixelRatio=t||window.devicePixelRatio,e.setupOrientationByScreenSize(),e.resizeGameView())}}}),Oe=r(xe.prototype,"handleViewResize",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){globalThis.game.ads.isAdFullSizeShowing()?console.error("⚠️ LayoutManager:handleViewResize skipped because ad is showing"):(console.debug("📱 View resize by window"),e.setupOrientationByScreenSize(),e.resizeGameView())}}}),Ue=r(xe.prototype,"handleBodyResize",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.resizeGameDiv()&&(console.debug("📱 View resize by body"),e.setupOrientationByScreenSize(),e.resizeGameView())}}}),xe);p._RF.pop(),p._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var Ze=GameCore,Je=Ze.Utils.Valid,Xe=Ze.Dtos.Player,$e=globalThis.game.player,et=function(){function e(){i(this,e)}return n(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){Xe.Data.addDefaultData(q),Xe.GameData.addDefaultData(j),Xe.GameData.addValidateFunction("bestEndlessScore",(function(e){if(!Je.isNumber(e)||e<0)throw new Error("bestEndlessScore ".concat(e," is invalid"))}))}},{key:"requestConnectedPlayers",value:function(){$e.requestConnectedPlayers().catch((function(e){console.warn("player.requestConnectedPlayers",e)}))}}]),e}();p._RF.pop(),p._RF.push({},"c510204p3JAXLCuogskxTkP","AdaptivePerformance",void 0);var tt=GameCore,nt=tt.Events,it=tt.Utils.Valid,at=globalThis.game,rt=at.event,ot=at.adaptivePerformance,st=function(){function e(){var t=this;i(this,e),this.handleBeginFrame=function(){E.on(R.EVENT_AFTER_UPDATE,t.lateUpdate),E.on(R.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){ot&&ot.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;it.isNumber(t)&&v.emit(G.REQUEST_VIEW_RESIZE,t)},this.lateUpdate=function(){var e=1e3*v.deltaTime;null==ot||ot.updatePostStepDeltaTime(e)},this.updateActualFPS=function(){var e,t=null===(e=E.root)||void 0===e?void 0:e.fps;it.isNumber(t)&&(null==ot||ot.updateActualFPS(t))}}return n(e,[{key:"init",value:function(){ot&&this.listenEvents()}},{key:"listenEvents",value:function(){rt.on(nt.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),E.once(R.EVENT_BEGIN_FRAME,this.handleBeginFrame),E.on(R.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();p._RF.pop(),p._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var ct,ut,lt,dt=globalThis.game.canvasRecorder,ht=function(){function e(){i(this,e)}return n(e,[{key:"init",value:function(){if(v.canvas&&dt){dt.setCanvas(v.canvas);var e=dt.getOptions(),t=function(){v.pause(),v.step()},n=dt.waitNextFrame;dt.waitNextFrame=function(){var i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(a,r){i||dt.isCapturing()?e.syncFps?(E.once(R.EVENT_AFTER_RENDER,a),t()):n(i).then(a).catch(r):v.resume()}))}}}}]),e}();p._RF.pop(),p._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var ft,pt,vt=GameCore,yt=vt.Configs.GameEngine.DynamicAssets,gt=yt.Enabled,mt=yt.Resolution,St=yt.IgnoreFiles,Et=vt.Events,wt=vt.Utils,At=wt.Array,_t=wt.Function,bt=wt.Time,Ct=wt.Decorator,Dt=globalThis.game,kt=Dt.event,Rt=Dt.storage,Tt=Dt.getBuildVersion,Lt=[".png",".jpg",".jpeg",".webp"],Ft=(ct=Ct.debounce(1e3),lt=r((ut=function(){function e(){var t=this;i(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradedAssets={},this.upgradableAssets={},o(this,"handleChangeQuality",lt,this),this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.requestUpdateDynamicAssets=function(){v.emit(G.UPGRADE_DYNAMIC_ATLAS,{force:!0})},this.collectUpgradableAssets=function(e){var n,i=e.output=e.input,a=mt.Adjust,r=mt.Original,o=a<r?a:r,c=!1,u=s(i);try{for(u.s();!(n=u.n()).done;){var l=n.value;if(At.has(Lt,l.ext)&&(!At.has(St,l.uuid)&&(l.url=t.replaceAssetUrl(l.url),!(l.uuid in t.upgradableAssets)))){var d={ext:l.ext,url:l.url,uuid:l.uuid,options:l.options,resolution:o};console.debug("DynamicAssets: Collect upgradable asset",l,d),t.upgradableAssets[l.uuid]=d,c=!0}}}catch(e){u.e(e)}finally{u.f()}c&&v.emit(G.REQUEST_UPGRADE_ASSET)}}var t,r,c,u;return n(e,[{key:"init",value:(u=a((function*(){console.info("DynamicAssets: init",{EDITOR:Q,Enabled:gt}),gt&&(yield this.initStorage(),this.checkCacheVersion(),F.transformPipeline.insert(this.collectUpgradableAssets,2),this.useHighQuality||this.injectTextureResolution(),this.listenEvents())})),function(){return u.apply(this,arguments)})},{key:"initStorage",value:(c=a((function*(){yield Rt.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0)})),function(){return c.apply(this,arguments)})},{key:"checkCacheVersion",value:function(){var e=Tt().toString(),t=Rt.getStorage("DynamicAssets"),n=null!=t?t:{},i=n.buildVersion,a=n.useHighQuality;"boolean"==typeof a&&(this.useHighQuality=a&&i===e),Rt.setStorageData("DynamicAssets","buildVersion",e),Rt.updateToWebStorage("DynamicAssets")}},{key:"listenEvents",value:function(){var e=this;this.useHighQuality||kt.catchUp(Et.GAME_READY,(function(){e.useHighQuality=!0,v.on(G.REQUEST_UPGRADE_ASSET,e.handleChangeQuality)}))}},{key:"injectTextureResolution",value:function(){var e=mt.Adjust,t=mt.Original;if(!(e>=t||t<=0)){var n=e/t;Object.defineProperty(L.prototype,"width",{get:function(){var e,t;return this.isValid?this.uuid?(null===(e=this.image.data)||void 0===e||null===(e=e.src)||void 0===e?void 0:e.indexOf("native32/"))>=0?this._width:(console.debug("DynamicAssets: Texture2D image",this),(null===(t=this.image)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.width)/n||this._width):this._width/n:this._width}}),Object.defineProperty(L.prototype,"height",{get:function(){var e,t;return this.isValid?this.uuid?(null===(e=this.image.data)||void 0===e||null===(e=e.src)||void 0===e?void 0:e.indexOf("native32/"))>=0?this._height:(null===(t=this.image)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.height)/n||this._height:this._height/n:this._height}})}}},{key:"saveStateToStorage",value:function(){Rt.setStorageData("DynamicAssets","useHighQuality",this.useHighQuality),Rt.updateToWebStorage("DynamicAssets")}},{key:"updateSpriteFrames",value:(r=a((function*(){var e=E.getScene();if(e){var t,n=e.getComponentsInChildren("cc.Sprite"),i=s(n);try{for(i.s();!(t=i.n()).done;){var a,r=t.value,o=r.spriteFrame;if(null!=o&&o.texture){var c=o.texture;this.upgradedAssets[null===(a=c.image)||void 0===a?void 0:a.uuid]&&(console.debug("DynamicAssets: Update sprite frame",c),r.node.layer=M.Enum.UI_2D,c.updateImage(),yield bt.sleepAsync(8))}}}catch(e){i.e(e)}finally{i.f()}}})),function(){return r.apply(this,arguments)})},{key:"processUpgradeQualityAsync",value:(t=a((function*(e){var t=this,n=F.assets.get(e.uuid);return n instanceof I?(e.url=this.replaceAssetUrl(e.url),console.debug("DynamicAssets: Process upgrade quality",e.uuid,e),new Promise((function(i){F.loadAny(e,e.options,(function(a,r){if(a)return console.warn("DynamicAssets: Upgrade error",a),void i(!1);n.reset(r),n._nativeUrl=t.replaceAssetUrl(n.nativeUrl),t.upgradedAssets[e.uuid]=!0,console.debug("DynamicAssets: Upgrade done",e.uuid,r,n),v.emit(G.ASSET_QUALITY_CHANGE,{asset:n,item:e}),i(!0)}))}))):(console.warn("DynamicAssets: Asset not found",e.uuid,n),this.upgradedAssets[e.uuid]=!1,!1)})),function(e){return t.apply(this,arguments)})}]),e}()).prototype,"handleChangeQuality",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return a((function*(){if(!e.isProcessing)try{e.isProcessing=!0;var t=[];for(var n in e.upgradableAssets){var i=e.upgradableAssets[n];if(i&&!e.upgradedAssets[n]){var a=e.processUpgradeQualityAsync(i);t.push(a)}}if(t.length<1)return;var r=yield _t.allSettled(t),o=r.filter((function(e){return"fulfilled"===e.status})).length;console.debug("DynamicAssets: Upgradable Assets Info",{total:o,results:r}),e.saveStateToStorage(),yield e.updateSpriteFrames(),e.requestUpdateDynamicAssets()}catch(e){console.warn("DynamicAssets: Handle change quality error",e)}finally{e.isProcessing=!1}}))}}),ut);p._RF.pop(),p._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var Mt,It,Pt,xt=GameCore,Nt=xt.Events,Ot=xt.Configs.GameEngine.DynamicAtlas,Ut=Ot.UsePowerOfTwo,zt=Ot.TextureAtlasOptimize,Gt=Ot.AllowNonePackable,Bt=Ot.OnlyOptimizeWhenRenderTooLong,Vt=xt.Utils,Ht=Vt.Array,qt=Vt.Json,jt=Vt.Object,Qt=Vt.Decorator,Wt=globalThis.game.event,Yt=(ft=Qt.debounce(2e3),r((pt=function(){function e(){var t=this;i(this,e),this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.pendingTextures={},this.setupRenderListeners=function(){E.on(R.EVENT_BEFORE_RENDER,t.updateBeforeRenderTime),E.on(R.EVENT_AFTER_RENDER,t.updateAfterRenderTime),Bt&&Wt.catchUp(Nt.SCENE_LAUNCHED,(function(){E.once(R.EVENT_AFTER_RENDER,t.checkRenderTimeHighers)}))},this.checkRenderTimeHighers=function(){var e=t.getMeanRenderTime();e>8&&t.handleLaggyFrame(e),E.once(R.EVENT_AFTER_RENDER,(function(){setTimeout(t.checkRenderTimeHighers,t.renderTimeInterval)}))},this.resetPendingInfo=function(){t.pendingSprites={},t.pendingTextures={}},this.updateBeforeRenderTime=function(){t.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){t.renderTimes.push(performance.now()-t.lastRenderTime)},this.tryInsertSpriteFrame=function(e){var n=t.getAtlas();if(!n)throw new Error("DynamicAtlas: Atlas not found");if(Ht.has(n._innerSpriteFrames,e))throw new Error("DynamicAtlas: Sprite frame already exists");var i=n.insertSpriteFrame(e);if(!1===i)throw new Error("DynamicAtlas: Failed to insert sprite frame");return i},this.requestUpdateDynamicAtlas=function(e){t.isProcessing||(t.forceUpdateDynamicAtlas||(t.forceUpdateDynamicAtlas=(null==e?void 0:e.force)||!1),t.updateDynamicAtlas())},this.generateDrawInfo=function(e){if(!(e.length<1)){var n=e.sort((function(e,t){return t.usageCount-e.usageCount})),i=C.instance.textureSize;if(t.calculateOptimizedAtlas(n,i),t.atlasInfo){var a,r=t.atlasInfo.textures,o=s(r);try{for(o.s();!(a=o.n()).done;){var c=a.value;t.drawInfo.push(c)}}catch(e){o.e(e)}finally{o.f()}var u=n.filter((function(e){return!r.some((function(t){return t.id===e.id}))}));u.length>0&&(console.warn("DynamicAtlas: Missing textures",u),t.generateDrawInfo(u))}else console.warn("DynamicAtlas: Atlas info not found",{textures:n})}},this.calculateOptimizedAtlas=function(e,n){var i=function(e){var t,n=0,i=0,a=s(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n+=r.w*r.h,i=Math.max(i,r.w)}}catch(e){a.e(e)}finally{a.f()}e.sort((function(e,t){return t.h-e.h}));var o,c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),i),h:1/0}],u=0,l=0,d=s(e);try{for(d.s();!(o=d.n()).done;)for(var h=o.value,f=c.length-1;f>=0;f--){var p=c[f];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,l=Math.max(l,h.y+h.h),u=Math.max(u,h.x+h.w),h.w===p.w&&h.h===p.h){var v=c.pop();f<c.length&&(c[f]=v)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(c.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}}catch(e){d.e(e)}finally{d.f()}return{w:u,h:l,fill:n/(u*l)||0}}(e),a=i.w,r=i.h,o=i.fill;if(o<.6)console.warn("DynamicAtlas: Fill rate is too low",o,c(e));else{if(a>n||r>n)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",a,r,n),void(e.pop()?t.calculateOptimizedAtlas(e,n):console.warn("DynamicAtlas: Texture size is too big",a,r,n));t.atlasInfo={textures:e,atlasSize:n,packedInfo:{width:Math.round(a),height:Math.round(r),fillRate:o}}}},this.drawTexture=function(e,n,i){var a,r,o=n.texture,s=o.image,c=o.getId(),u=Ht.search(t.drawInfo,(function(e){return e.id===c}))||{x:-1,y:-1},l=u.x,d=u.y;if(l<0||d<0)return t.pendingSprites[n.uuid]||(t.pendingSprites[n.uuid]=n),t.pendingTextures[c]||(t.pendingTextures[c]=o,Bt||t.requestUpdateDynamicAtlas()),!1;var h=i?2:0;l+=h,d+=h;var f=e._innerTextureInfos[c];f||(i&&((s.width<=8||s.height<=8)&&(e._texture.drawTextureAt(s,l-1,d-1),e._texture.drawTextureAt(s,l-1,d+1),e._texture.drawTextureAt(s,l+1,d-1),e._texture.drawTextureAt(s,l+1,d+1)),e._texture.drawTextureAt(s,l-1,d),e._texture.drawTextureAt(s,l+1,d),e._texture.drawTextureAt(s,l,d-1),e._texture.drawTextureAt(s,l,d+1)),e._texture.drawTextureAt(s,l,d),e._count++,e._innerTextureInfos[c]={texture:o,x:l,y:d});var p=n.rect,v=p.x,y=p.y;v+=null!==(a=null==f?void 0:f.x)&&void 0!==a?a:l,y+=null!==(r=null==f?void 0:f.y)&&void 0!==r?r:d;var g={texture:e._texture,x:v,y:y};return l-=h,d-=h,e._innerSpriteFrames.push(n),g},this.refreshComponents=function(e){var t,n=s(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.node.active&&(i.node.active=!1,i.node.active=!0)}}catch(e){n.e(e)}finally{n.f()}},this.isSameAtlas=function(e,t){if(!e||!t)return!1;var n=e.textures,i=t.textures;if(n.length!==i.length)return!1;var a=n.slice().sort((function(e,t){return e.id.localeCompare(t.id)})),r=i.slice().sort((function(e,t){return e.id.localeCompare(t.id)}));return a.every((function(e,t){var n=r[t];if(!n)return!1;var i=e.id,a=e.name,o=e.w,s=e.h,c=n.id,u=n.name,l=n.w,d=n.h;return!a||i===c&&(a===u&&o===l&&s===d)}))}}return n(e,[{key:"init",value:function(){zt&&C.instance.enabled&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:zt}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){v.on(G.UPGRADE_DYNAMIC_ATLAS,this.requestUpdateDynamicAtlas,this),Wt.on(Nt.SWITCH_SCENE,this.resetPendingInfo),Wt.on(Nt.SCENE_RENDERED,this.requestUpdateDynamicAtlas),Wt.catchUp(Nt.GAME_READY,this.setupRenderListeners)}},{key:"handleLaggyFrame",value:function(e){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(e.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var e,t=0,n=s(this.renderTimes);try{for(n.s();!(e=n.n()).done;){t+=e.value}}catch(e){n.e(e)}finally{n.f()}return t/=this.renderTimes.length,this.renderTimes=[],t}},{key:"overrideDynamicAtlas",value:function(){var e=this,t=C.instance;t.insertSpriteFrame=function(n){if(!t.enabled)return null;var i=t.maxAtlasCount,a=(t._atlases,t._atlasIndex),r=void 0===a?-1:a;if(r>=i)return null;try{var o=e.tryInsertSpriteFrame(n);return o||r>=i?o:o=e.tryInsertSpriteFrame(n)}catch(e){return null}}}},{key:"createAtlas",value:function(){return C.instance.newAtlas()}},{key:"getAtlas",value:function(){var e=this,t=C.instance,n=t._atlases,i=void 0===n?[]:n,a=t._atlasIndex,r=t.textureBleeding,o=i[a];return o||(o=this.createAtlas()),o?(o.originalInsertSpriteFrame||(o.originalInsertSpriteFrame=o.insertSpriteFrame,o.insertSpriteFrame=function(t){return e.drawTexture(o,t,r)}),o):null}},{key:"updateDynamicAtlas",value:function(){try{var e=E.getScene();if(!e)return;var t=this.collectPackageInfo();if(Object.keys(t).length<1)return;if(this.drawInfo=[],this.atlasInfo=null,this.isProcessing=!0,this.generateDrawInfo(jt.vals(t)),!this.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!this.updateAtlasData()&&!this.forceUpdateDynamicAtlas)return;var n=e.getComponentsInChildren("cc.UIRenderer");this.refreshComponents(n)}catch(e){console.error("DynamicAtlas: Error updating dynamic atlas",e)}finally{this.isProcessing=!1,this.forceUpdateDynamicAtlas&&(this.forceUpdateDynamicAtlas=!1)}}},{key:"collectAllSpriteFrames",value:function(){var e=E.getScene();if(e){var t,n=e.getComponentsInChildren("cc.UIRenderer"),i=s(n);try{for(i.s();!(t=i.n()).done;){var a=t.value,r=a.spriteFrame;a.__classname__;if(a.enabled&&r&&(r.packable&&r.texture)){var o=r.uuid;o&&(this.pendingSprites[o]||(a.node.layer=M.Enum.UI_2D,this.pendingSprites[o]=r))}}}catch(e){i.e(e)}finally{i.f()}}}},{key:"collectPackageInfo",value:function(){Gt&&this.collectAllSpriteFrames();var e,t=jt.vals(this.pendingSprites),n={},i=s(t);try{for(i.s();!(e=i.n()).done;){var a,r=e.value,o=r.texture,c=r.original,u=null==o?void 0:o.getId(),l=null==c||null===(a=c._texture)||void 0===a?void 0:a.getId();if(l&&(u=l),u){this.collectInfo[u]||this.initializeCollectInfo(u,r);var d=this.collectInfo[u];d&&(d.usageCount++,n[u]=d)}}}catch(e){i.e(e)}finally{i.f()}return n}},{key:"initializeCollectInfo",value:function(e,t){var n=t.texture,i=t.original,a=t.uuid,r=n.width,o=n.height,s=(null==i?void 0:i._texture)||{width:0,height:0},c=s.width,u=s.height,l=Math.max(r,c)+2,d=Math.max(o,u)+2;l<=1||d<=1?console.warn("DynamicAtlas: Skip invalid texture size",a,{w:l,h:d}):this.collectInfo[e]={id:e,w:l,h:d,x:-1,y:-1,usageCount:0,name:a}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var e=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!e,e)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.debug("DynamicAtlas: atlas info",this.atlasInfo);var t=this.getAtlas();if(!t||!t._texture)return!1;var n=this.atlasInfo.packedInfo,i=t._texture,a={width:i.width,height:i.height},r=n.width+20,o=n.height+20,s=Math.max(r,o),c=Ut?s:r,u=a.width!==c||a.height!==c;return console.debug("DynamicAtlas: Update atlas data",{currentSize:a,newSize:c,needsResize:u}),!!u&&(C.instance.reset(),!(!(t=this.getAtlas())||!t._texture)&&(console.debug("DynamicAtlas: Update atlas data",{newSize:c,currentSize:a}),Ut?(t._texture.initWithSize(c,c),console.debug("DynamicAtlas: Resize atlas (PO2)",c,t)):(t._texture.initWithSize(r,o),console.debug("DynamicAtlas: Resize atlas",r,o,t)),this.lastAtlasInfo=qt.clone(this.atlasInfo),!0))}}]),e}()).prototype,"updateDynamicAtlas",[ft],Object.getOwnPropertyDescriptor(pt.prototype,"updateDynamicAtlas"),pt.prototype),pt);p._RF.pop(),p._RF.push({},"2f36c+IsKJAU5s61TqQdaJ6","HybridFileCache",void 0);var Kt=GameCore,Zt=Kt.Events,Jt=Kt.Configs.GameEngine.HybridFileCache,Xt=Jt.Enabled,$t=Jt.PreviewMode,en=Jt.BuildMode,tn=Kt.Utils,nn=tn.Object,an=tn.Function,rn=tn.Json,on=tn.Decorator,sn=globalThis.game,cn=sn.event,un=sn.storage,ln=sn.getBuildVersion,dn=p.internal.CCON,hn=S.instance,fn=hn.downloader,pn=hn.pipeline,vn=hn.fetchPipeline,yn=(Mt=on.throttle(1e3),Pt=r((It=function(){function e(){var t=this;i(this,e),this.supportTypes=[],this.bundledFiles={},this.originDownloaders={},this.nativeAssetDictionary={},this.downloadFile=function(e){return function(n,i,a){var r=t.getCache(e,n);if(r)return a(null,r);var o=t.getDownloader(e);if(!o)return a(new Error("Downloader not found"),null);o(n,i,(function(i,r){return!i&&t.setCache(e,n,r),a(i,r)}))}},o(this,"requestUpdateStorage",Pt,this),this.clearCache=function(){un.initStorageData("HybridFileCache","cachedFiles",{}),un.initStorageData("HybridFileCache","cachedBundles",{}),un.updateToWebStorage("HybridFileCache")}}var t,r,d,h,f;return n(e,[{key:"init",value:(f=a((function*(){Xt&&!Q?(yield this.initStorage(),yield this.checkCacheVersion(),this.initSupportedTypes(),this.injectOptimalLoadPipeline(),this.injectOptimalFetchPipeline(),this.injectCacheExtensionPipeline(),this.saveOriginDownloaders(),this.registerCustomDownloader(),this.setupBundledFiles(),this.listenEvents(),console.info("Hybrid File Cache: Initialized",{supportTypes:this.supportTypes})):cn.emit(Zt.BUNDLE_READY)})),function(){return f.apply(this,arguments)})},{key:"initStorage",value:(h=a((function*(){return un.addStorage("HybridFileCache",{buildVersion:"0",cachedFiles:{},cachedBundles:{},cachedExtensions:{}},!0)})),function(){return h.apply(this,arguments)})},{key:"checkCacheVersion",value:(d=a((function*(){var e=ln().toString(),t=un.getStorageData("HybridFileCache","buildVersion");un.setStorageData("HybridFileCache","buildVersion",e),t!==e&&(yield this.clearCache()),this.requestUpdateStorage()})),function(){return d.apply(this,arguments)})},{key:"initSupportedTypes",value:function(){this.supportTypes=en.SupportedExtensions}},{key:"setupBundledFiles",value:(r=a((function*(){try{if(!en.Enabled)return;var e,t=[],n=s(this.supportTypes);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.getCachedBundles(i)||t.push(this.downloadBundledFile(i))}}catch(e){n.e(e)}finally{n.f()}t.length>0&&(yield an.allSettled(t))}finally{cn.emit(Zt.BUNDLE_READY)}})),function(){return r.apply(this,arguments)})},{key:"downloadBundledFile",value:(t=a((function*(e){try{var t=e.replace(".",""),n="./cache/bundle".concat(t.toUpperCase(),".").concat(t);"bundle"===e&&(n="./cache/bundleBUNDLE.json");var i=yield fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}),a=yield i.json();this.setBundledCache(e,a)}catch(t){console.error("Hybrid File Cache: Downloaded bundled file",{type:e,error:t})}})),function(e){return t.apply(this,arguments)})},{key:"injectOptimalFetchPipeline",value:function(){if($t.Enabled||en.Enabled){var e=vn.pipes[1];if(e){vn.remove(2),vn.insert((function(t,n){try{e(t,n)}catch(e){console.error("Hybrid File Cache: optimized fetch pipeline",{error:e})}}),2),console.debug("Hybrid File Cache: injected optimal fetch pipeline",c(vn.pipes))}}}},{key:"injectOptimalLoadPipeline",value:function(){if($t.Enabled||en.Enabled){var e=pn.pipes[2];if(e){pn.remove(2),pn.insert((function(t,n){try{e(t,n)}catch(e){console.error("Hybrid File Cache: optimized load pipeline",{error:e})}}),2),console.debug("Hybrid File Cache: injected optimal load pipeline",c(pn.pipes))}}}},{key:"injectCacheExtensionPipeline",value:function(){var e=this;if($t.Enabled&&$t.CacheUuidExtension){var t={},n=function(n,i){n.output=n.input;for(var a=0;a<n.input.length;a++){var r=n.input[a];if(r.id){var o=e.getCacheExtension(r.id);o?(r.url=r.url.replace(r.ext,o),r.ext=o,t[r.id]=!0):t[r.id]=!1}}i(null,null)},i=function(n){return function(i,a){for(var r=c(i.input),o=0;o<r.length;o++){var s=r[o];if(s.id){var u,l=t[s.id];if(!e.nativeAssetDictionary.hasOwnProperty(s.id))e.nativeAssetDictionary[s.id]=null!==(u=s.isNative)&&void 0!==u&&u;l&&(s.isNative=!0)}}i.input.length>0&&console.debug("Hybrid File Cache: process cache extension"),n(i,a)}},a=function(n,i){n.output=n.input;for(var a=0;a<n.output.length;a++){var r,o=n.output[a];if(o.id){var s=null!==(r=e.nativeAssetDictionary[o.id])&&void 0!==r&&r;o.isNative=s,t[o.id]||e.setCacheExtension(o.id,o.ext)}}i(null,null)};pn.insert(n,1),vn.insert(n,1),pn.insert(a,3),vn.insert(a,3);var r=c(pn.pipes),o=c(vn.pipes);pn.pipes[2]=i(r[2]),vn.pipes[2]=i(o[2]);var s=c(pn.pipes),u=c(vn.pipes);console.debug("Hybrid File Cache: inject cache extension pipelines",r,o,s,u)}}},{key:"saveOriginDownloaders",value:function(){var e,t=s(this.supportTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originDownloaders[n]=fn._downloaders[n]}}catch(e){t.e(e)}finally{t.f()}}},{key:"registerCustomDownloader",value:function(){var e,t=s(this.supportTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;"bundle"!==n&&fn.register(n,this.downloadFile(n))}}catch(e){t.e(e)}finally{t.f()}}},{key:"listenEvents",value:function(){cn.on(Zt.SCENE_LOADED,this.requestUpdateStorage),v.on(G.CLEAR_HYBRID_FILE_CACHE,this.clearCache)}},{key:"getDownloader",value:function(e){var t;return null!==(t=this.originDownloaders[e])&&void 0!==t?t:null}},{key:"getCacheKey",value:function(e,t){var n=t.match(/.*\/([-a-z0-9@]+)\.([^\.]+)$/);if(!n)return null;var i=u(n,3),a=(i[0],i[1]),r=i[2];return!r||e.indexOf(r)<0?null:"".concat(a,":").concat(e)}},{key:"validateDataType",value:function(e,t){Array.isArray(t)&&nn.hasOwn(t[0],"__type__");return!(".cconb"===e&&nn.hasOwn(t,"chunks")&&!(Array.isArray(t.chunks)&&t instanceof dn))||(console.warn("Hybrid File Cache: Invalid cconb",{type:e,data:t}),!1)}},{key:"encodeData",value:function(e,t){return".cconb"===e?nn.hasOwn(t,"_document")&&nn.hasOwn(t,"_chunks")?new dn(t._document,t._chunks):null:rn.clone(t)}},{key:"decodeData",value:function(e,t){if(".cconb"===e){if(!nn.hasOwn(t,"_document")||!nn.hasOwn(t,"_chunks"))return null;if(!Array.isArray(t._chunks))return null;var n,i=[],a=s(t._chunks);try{for(a.s();!(n=a.n()).done;){var r=n.value;r instanceof Uint8Array?i.push(r):i.push(new Uint8Array(Object.values(r)))}}catch(e){a.e(e)}finally{a.f()}return new dn(t._document,i)}return rn.clone(t)}},{key:"setCache",value:function(e,t,n){var i=this.getCacheKey(e,t);if(i&&this.validateDataType(e,n)){var a=this.encodeData(e,n);un.setStorageData("HybridFileCache","cachedFiles",l({},i,a)),this.requestUpdateStorage()}}},{key:"getCache",value:function(e,t){var n=this.getCacheKey(e,t);if(!n)return null;var i=this.getFileCaches()[n];return i||(i=this.getBundledCache(e,n)),i?this.decodeData(e,i):null}},{key:"getFileCaches",value:function(){var e;return null!==(e=un.getStorageData("HybridFileCache","cachedFiles"))&&void 0!==e?e:{}}},{key:"getCachedBundles",value:function(e){var t=un.getStorageData("HybridFileCache","cachedBundles");if(!t)return null;var n=t[e];return n?(this.bundledFiles[e]=n,n):null}},{key:"getBundledCache",value:function(e,t){var n,i=this.bundledFiles[e];return i&&null!==(n=i[t.replace(":".concat(e),"")])&&void 0!==n?n:null}},{key:"setBundledCache",value:function(e,t){this.bundledFiles[e]=t,un.setStorageData("HybridFileCache","cachedBundles",l({},e,t)),this.requestUpdateStorage()}},{key:"getCacheExtension",value:function(e){return this.getCachedExtensions()[e]}},{key:"setCacheExtension",value:function(e,t){un.setStorageData("HybridFileCache","cachedExtensions",l({},e,t)),this.requestUpdateStorage()}},{key:"getCachedExtensions",value:function(){var e;return null!==(e=un.getStorageData("HybridFileCache","cachedExtensions"))&&void 0!==e?e:{}}}]),e}()).prototype,"requestUpdateStorage",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(){un.updateToWebStorage("HybridFileCache")}}}),It);p._RF.pop();var gn={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};p._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var mn=GameCore,Sn=mn.Events,En=mn.Utils.Array,wn=globalThis.game,An=wn.player,_n=wn.event,bn=wn.language,Cn=wn.monitorError,Dn=function(){function e(){var t=this;i(this,e),this.handlePreloadLanguage=function(){var e=a((function*(e){var n=e.locale,i=e.onLoad,a=e.onError;if(!t.isSupportedLocale(n))return console.warn("Preload language ".concat(n," not found")),void(null==a||a(new Error("Language ".concat(n," not found"))));try{yield t.addLanguage(n),null==i||i(n)}catch(e){var r=t.toError(e,"handleLanguageRequested");console.error(r),null==Cn||Cn.sendException(r),null==a||a(e)}}));return function(t){return e.apply(this,arguments)}}(),this.handleChooseLanguage=function(e){var n=e.locale,i=e.saveToPlayerData,a=void 0!==i&&i;if(t.isSupportedLocale(n))try{t.setLanguage(n,a)}catch(e){var r=t.toError(e,"handleLanguageRequested");console.error(r),null==Cn||Cn.sendException(r)}else console.warn("Choose language ".concat(n," not found"))},this.handleLanguageRequested=function(){var e=a((function*(e){var n=e.locale,i=e.saveToPlayerData,a=void 0!==i&&i,r=e.onLoad,o=e.onError;if(!t.isSupportedLocale(n))return console.warn("Request language ".concat(n," not found")),void(null==o||o(new Error("Language ".concat(n," not found"))));try{yield t.addLanguage(n),null==r||r(n),t.setLanguage(n,a)}catch(e){var s=t.toError(e,"handleLanguageRequested");console.error(s),null==Cn||Cn.sendException(s),null==o||o(s)}}));return function(t){return e.apply(this,arguments)}}()}var t,r,o,s,c;return n(e,[{key:"init",value:(c=a((function*(){try{yield this.initDefaultLanguage(),this.listenEvent(),yield this.initPlayerLanguage()}catch(t){var e=this.toError(t,"handleLanguageRequested");console.error(e),null==Cn||Cn.sendException(e)}})),function(){return c.apply(this,arguments)})},{key:"initDefaultLanguage",value:(s=a((function*(){bn.add("en",gn,!0),this.setLanguage("en")})),function(){return s.apply(this,arguments)})},{key:"initPlayerLanguage",value:(o=a((function*(){var e,t=bn.getPlayerLanguage();if(!t||!this.isSupportedLocale(t))return console.warn("Language ".concat(t," not supported. Overriding with default language")),void this.setLanguage("en",!0);yield this.addLanguage(t);var n=null!==(e=An.getPlayerDataByKey("isFirstLogin"))&&void 0!==e&&e;this.setLanguage(t,n)})),function(){return o.apply(this,arguments)})},{key:"isSupportedLocale",value:function(e){return En.has(W,e)}},{key:"listenEvent",value:function(){_n.on(Sn.REQUEST_LANGUAGE,this.handleLanguageRequested),v.on(Sn.REQUEST_LANGUAGE,this.handleLanguageRequested),v.on(G.PRELOAD_LANGUAGE,this.handlePreloadLanguage),v.on(G.CHOOSE_LANGUAGE,this.handleChooseLanguage)}},{key:"addLanguage",value:(r=a((function*(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=yield this.getLangData(e);bn.add(e,n,t)})),function(e){return r.apply(this,arguments)})},{key:"setLanguage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(bn.choose(e),t){var n=An.getPlayerSettings(),i=d(d({},n),{},{language:e});An.setPlayerDataByName("settings",i)}}},{key:"getLangData",value:(t=a((function*(e){if("en"===e)return gn;var t=yield Y.loadJsonAsync(K[e]);if(null===t)throw new Error("Language ".concat(e," not found"));if(null===t.json)throw new Error("Language ".concat(e," is empty"));return t.json})),function(e){return t.apply(this,arguments)})},{key:"toError",value:function(e,t){return e instanceof Error?e:"string"==typeof e?new Error("LanguagePlugin: ".concat(e)):new Error("LanguagePlugin: Unknown error in module: <".concat(t,">"))}}]),e}();p._RF.pop(),p._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var kn=GameCore,Rn=kn.Configs,Tn=Rn.Mockup,Ln=Tn.Leaderboards,Fn=Tn.GameSDK.Player,Mn=Rn.Leaderboards,In=kn.Utils.Number,Pn=globalThis.game.leaderboard,xn=function(){function e(){var t=this;i(this,e),this.handleWhenGameSDKStarted=function(){Ln.Enabled?t.setupLeaderboardsMockup():t.setupLeaderboards()}}var t,r,o,c;return n(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(c=a((function*(){this.setupLeaderboardByConfigs()})),function(){return c.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var e,t=Mn.LeaderboardList,n=s(t);try{for(n.s();!(e=n.n()).done;){var i=e.value,a=i.Id,r=i.Name;Pn.addLeaderboard({name:r,type:"global",autoSortRank:!0,leaderboardId:a})}}catch(e){n.e(e)}finally{n.f()}}},{key:"setupLeaderboardsMockup",value:(o=a((function*(){this.setupMockGlobalLeaderboards(),this.setupMockFriendsLeaderboard()})),function(){return o.apply(this,arguments)})},{key:"setupMockGlobalLeaderboards",value:(r=a((function*(){var e,t=Ln.NumOfLeaders,n=Mn.LeaderboardList,i=s(n);try{for(i.s();!(e=i.n()).done;){var a=e.value,r=a.Name,o=a.Id;if(r){var c=yield Pn.createLeaderboardAsync({_id:o,name:r,numberOfLeaders:In.random(t.Max-t.Min)+t.Min});Pn.addLeaderboard({name:r,type:"global",autoSortRank:!0,leaderboardId:c}),yield Pn.requestLeaderboardAsync(r,10);var u=Pn.getLeaderboard(r);console.info("setupGlobalLeaderboard fetch new",u,u&&Object.keys(u.leaders).length),u=Pn.getLeaderboard(r),console.info("setupGlobalLeaderboard load more",u,u&&Object.keys(u.leaders).length)}}}catch(e){i.e(e)}finally{i.f()}})),function(){return r.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(t=a((function*(){var e=Z.FRIENDS,t=J.FRIENDS,n=0,i=Fn.ConnectedPlayers;i.Enabled&&(n=In.random(i.NumOfPlayers-1)+1);var a=yield Pn.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:n});Pn.addLeaderboard({name:e,type:"friends",autoSortRank:!0,leaderboardId:a}),yield Pn.requestLeaderboardAsync(e,10);var r=Pn.getLeaderboard(e);console.info("setupFriendsLeaderboard done",r)})),function(){return t.apply(this,arguments)})}]),e}();p._RF.pop(),p._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var Nn=GameCore,On=Nn.Utils,Un=Nn.Events,zn=Nn.Configs.PerformanceMonitor.FpsTracking,Gn=globalThis.game.event,Bn=function(){function e(){var t=this;i(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps(),E.on(R.EVENT_AFTER_UPDATE,t.handleLateUpdate)},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=v.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=v.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return n(e,[{key:"mark",get:function(){return zn.Enabled?On.Mark:null}},{key:"init",value:function(){var e=zn.TrackingDuration,t=zn.TrackingInterval;this.mark&&(this.fpsTraceDuration=null!=e?e:60,this.fpsTraceInterval=null!=t?t:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents())}},{key:"listenEvents",value:function(){Gn.catchUp(Un.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){E.off(R.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var e,t;if(this.mark){var n=this.getFPS(),i=this.getDrawCalls(),a=this.getDeviceRender(),r=this.getTextureMemory();this.minFps=Math.min(null!==(e=this.minFps)&&void 0!==e?e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",a),this.mark.putAttr(this.markName,"Draw Calls",i.toString()),this.mark.putAttr(this.markName,"Texture Memory",r.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.debug("FPS: ".concat(n," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(i,", texture memory: ").concat(r.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!E.root)return 0;var e=E.root.fps;return Math.floor(e)||0}},{key:"getDrawCalls",value:function(){return E.root&&E.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return E.root&&E.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return E.root&&E.root.device.memoryStatus.textureSize/1048576||0}}]),e}();p._RF.pop(),p._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var Vn=GameCore.Events,Hn=globalThis.game.event,qn=function(){function e(){i(this,e),this.handleHotReload=function(){v.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){v.emit(G.GAMEPLAY_UPDATE_CONFIG,e.config);var t=e.id,n=e.type;Hn.emit(Vn.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return n(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){Hn.on(Vn.REQUEST_HOT_RELOAD,this.handleHotReload),Hn.on(Vn.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();p._RF.pop(),p._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var jn=function(){function e(){i(this,e)}return n(e,[{key:"init",value:function(){this.initHybridFileCache(),console.info("Plugins Manager: Initialized")}},{key:"initLanguages",value:function(){(new Dn).init()}},{key:"initLeaderboards",value:function(){(new xn).init()}},{key:"initRemoteConfig",value:function(){(new qn).init()}},{key:"initDynamicAtlas",value:function(){(new Yt).init()}},{key:"initDynamicAssets",value:function(){(new Ft).init()}},{key:"initHybridFileCache",value:function(){(new yn).init()}},{key:"initCanvasRecorder",value:function(){(new ht).init()}},{key:"initPerformanceMonitor",value:function(){(new Bn).init()}},{key:"initAdaptivePerformance",value:function(){(new st).init()}}]),e}();p._RF.pop(),p._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var Qn=globalThis.game,Wn=Qn.event,Yn=Qn.monitorError,Kn=GameCore,Zn=Kn.Events,Jn=Kn.Configs.PerformanceMonitor,Xn=Kn.Utils.Mark,$n=function(){function e(){var t=this;i(this,e),this.markName="Load Scene",this.testScene={},this.isClearedMark=!1,this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var e=a((function*(e){var n=e.sceneName,i=e.sceneData,a=t.correctSceneName(n);console.debug("Switching",a,null!=i?i:{}),a&&(v.emit(G.REQUEST_VIEW_RESIZE),setTimeout((function(){$.showLoadingFullScreen(a)}),0),t.startScene({sceneName:a,sceneData:i}))}));return function(t){return e.apply(this,arguments)}}(),this.preloadScene=function(){var e=a((function*(e,n){var i=e.sceneName;yield t.waitSceneLoaded(i),t.startMeasure("preload",e);var a=F.getBundle("main");null==a||a.loadScene(i,{},t.onSceneProgress,t.onScenePreloaded(i,n))}));return function(t,n){return e.apply(this,arguments)}}(),this.waitSceneLoaded=function(){var e=a((function*(e){if(t.queueLoadScene[e]){var n=yield Wn.waitTo(Zn.SCENE_LOADED);console.info("SceneManager.waitSceneLoaded",{payload:n})}}));return function(t){return e.apply(this,arguments)}}(),this.startMeasure=function(e,n){if(t.mark){var i=n.sceneName;t.queueLoadScene[i]&&(t.mark.putAttr(t.markName,"Canceled","true"),t.stopMeasure(i)),console.groupCollapsed("📦 ".concat(i,": ").concat(e," progress")),t.mark.measure(t.markName),t.mark.putAttr(t.markName,"Cancel","false"),t.mark.putAttr(t.markName,"Success","false"),t.mark.putMetric(t.markName,i),t.mark.start(t.markName),t.queueLoadScene[i]=!0}},this.stopMeasure=function(e){t.mark&&t.queueLoadScene[e]&&(t.mark.rmAttr(t.markName,"File"),t.mark.putAttr(t.markName,"Success","true"),t.mark.stop(t.markName),t.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=function(e,n,i){var a=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File","".concat(i.id," (").concat(i.ext,")"));var r=Math.floor(70*a+30);GameSDK.setLoadingProgress(r)},this.onScenePreloaded=function(e,t){return function(n){t&&t(e,null!=n?n:null),console.debug("SceneManager.onScenePreloaded",{sceneName:e,error:n}),n||Wn.emit(Zn.SCENE_LOADED,{sceneName:e,isPreload:!0})}},this.onSceneLoaded=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(i,a){var r=e.sceneName,o=e.sceneData;if(i||!a||a.name!==r)return console.warn("SceneManager.onSceneLoaded",{error:i,scene:a,sceneName:r,retries:n}),void t.startScene(e,n+1);t.handleBeforeSceneLaunch(a,o)(),E.once(R.EVENT_AFTER_SCENE_LAUNCH,t.handleSceneLaunched(r,o))}},this.handleBeforeSceneLaunch=function(e,n){return function(){t.setSceneData(e,null!=n?n:{}),Wn.emit(Zn.SCENE_LOADED,{sceneName:e.name}),t.isClearedMark||(Wn.clear(Zn.MARK_IS_TEST_SCENE),t.isClearedMark=!0)}},this.handleSceneLaunched=function(e,n){return function(){var i;$.hideLoadingFullScreen(e),ee.switchSceneTracking(),null==Yn||Yn.addMetadata({currentScene:e}),null===(i=t.callbackSwitchScene)||void 0===i||i.call(t,{sceneName:e,sceneData:n}),Wn.emit(Zn.SCENE_LAUNCHED,{sceneName:e}),E.once(R.EVENT_AFTER_RENDER,(function(){v.emit(G.REQUEST_VIEW_RESIZE),Wn.emit(Zn.SCENE_RENDERED,{sceneName:e})}))}},this.handleSceneLoaded=function(e){var n=e.sceneName;t.stopMeasure(n),te.markIsSceneLoaded(n)},this.setTestScene=function(e){var n=e.sceneName;console.warn("SceneManager.setTestScene",n),t.testScene[n]=!0}}var t;return n(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){Wn.catchUp(Zn.MARK_IS_TEST_SCENE,this.setTestScene),Wn.on(Zn.SWITCH_SCENE,this.switchScene),Wn.on(Zn.PRELOAD_SCENE,this.preloadScene),Wn.on(Zn.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(e){var t=this.getCurrentScene(),n=this.getTestScene();return n&&(null==t?void 0:t.name)!==n?n:null!=t&&t.isValid?e===X.DASHBOARD_SCENE?X.GAME_SCENE:e===t.name?null:e:e}},{key:"startScene",value:(t=a((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.sceneName;yield this.waitSceneLoaded(i),this.startMeasure("start",e);var a=F.getBundle("main");null==a||a.loadScene(i,{},null,(function(a,r){if(a)return console.warn("SceneManager.startScene",{error:a,sceneName:i,retries:n}),void t.startScene(e,n+1);E.runScene(r,void 0,t.onSceneLoaded(e,n))}))})),function(e){return t.apply(this,arguments)})},{key:"mark",get:function(){return Jn.LoadResources?Xn:null}},{key:"getCurrentScene",value:function(){return E.getScene()}},{key:"getTestScene",value:function(){var e;return null!==(e=Object.keys(this.testScene)[0])&&void 0!==e?e:null}},{key:"onSwitchScene",value:function(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:d(d({},n),t)}),console.debug("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();p._RF.pop(),p._RF.push({},"a3a11eRcsNI5aahAZL2xA8X","ScreenEntry",void 0);var ei=function(){function e(){var t,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.state="queued",this.order=0,this.parent=null,this.useCount=0,this.name="Unknown";var r=a.state,o=a.order,s=a.prefab,c=a.screen,u=a.parent,l=a.name;this.state=null!=r?r:this.state,this.order=null!=o?o:this.order,this.prefab=s,this.screen=c,this.parent=null!=u?u:null,this.name=null!==(t=null!=l?l:null==c||null===(n=c.node)||void 0===n?void 0:n.name)&&void 0!==t?t:"Unknown"}return n(e,[{key:"resetParent",value:function(){var e;if(this.screen){var t;if(this.parent)null===(t=this.screen.node)||void 0===t||t.removeFromParent();null===(e=this.screen.node)||void 0===e||e.destroy(),this.screen=void 0,this.parent=null}}},{key:"incrementUseCount",value:function(){this.useCount+=1,console.debug("Screen ".concat(this.name," use count: ").concat(this.useCount))}}]),e}();p._RF.pop(),p._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var ti=globalThis.game,ni=ti.event,ii=ti.monitorError,ai=GameCore,ri=ai.Events,oi=ai.Utils,si=oi.Object,ci=oi.Valid,ui=function(e){return e.READY="ready",e.LOADING="loading",e.QUEUED="queued",e}(ui||{}),li=function(){function e(){var t=this;i(this,e),this.screens={},this.isScreenLoading=!1,this.screenLoadingQueue=[],this.handleOpenScreen=function(e){t.openScreen(e.screenName,e.screenData)},this.handleCloseScreen=function(e){t.closeScreen(e.screenName,!0)},this.handlePreloadScreens=function(){var e=E.getScene();t.validateScene(e)&&(t.initScreens(e),t.preloadScreens())},this.handleSwitchScene=function(){t.resetAllScreenParents()}}var t,r,o,c,u,l,h,f,p,v;return n(e,[{key:"init",value:function(){this.bindEventHandlers(),console.info("Screen Manager: Initialized")}},{key:"bindEventHandlers",value:function(){ni.on(ri.OPEN_SCREEN,this.handleOpenScreen),ni.on(ri.CLOSE_SCREEN,this.handleCloseScreen),ni.on(ri.PRELOAD_SCREENS,this.handlePreloadScreens),ni.on(ri.SWITCH_SCENE,this.handleSwitchScene)}},{key:"resetAllScreenParents",value:function(){for(var e in this.screens){var t=this.screens[e];t&&t.resetParent()}}},{key:"validateScene",value:function(e){return!!e||(console.warn("No scene found for preloading screens"),!1)}},{key:"initScreens",value:function(e){var t=e.getComponentsInChildren("BaseScreen");if(!ci.isEmpty(t)){var n=t.map((function(e){return null==e?void 0:e.node.name})).join(", ");console.info("📺 Active Screens in ".concat(e.name,": ").concat(n)),this.addScreens(t)}var i=this.getScreenHolder();if(i){var a=i.screenKeys.filter((function(e){return!t.some((function(t){return t.node.name===ne[e]}))}));if(!ci.isEmpty(a)){var r=a.map((function(e){return ne[e]}));console.info("📺 Lazy-loading Screens in ".concat(e.name,": ").concat(r.join(", "))),this.addScreenQueues(r)}}}},{key:"getScreenHolder",value:function(){var e=E.getScene();return null==e?void 0:e.getComponentInChildren("Screens")}},{key:"addScreens",value:function(e){var t=this;e.forEach((function(e,n){var i=e.node.name;if(t.isScreenNameValid(i)){if(t.isScreenReady(i)){var a=t.screens[i];return a.screen=e,void(a.parent=e.node.parent)}t.screens[i]=new ei({state:ui.READY,order:n,screen:e,parent:e.node.parent,name:i})}else console.warn("ScreenManager.addScreens: Invalid screen name ".concat(i))}))}},{key:"isScreenReady",value:function(e){var t;return(null===(t=this.screens[e])||void 0===t?void 0:t.state)===ui.READY}},{key:"isScreenCreated",value:function(e){var t;return!(null===(t=this.screens[e])||void 0===t||!t.screen)}},{key:"isScreenNameValid",value:function(e){return ci.isString(e)&&si.vals(ne).includes(e)}},{key:"addScreenQueues",value:function(e){var t=this,n=this.getScreenHolder();null!=n&&n.isValid?(e.forEach((function(e,i){if(t.isScreenNameValid(e)){var a=t.screens[e];a?t.isScreenReady(e)||(a.state=ui.QUEUED,a.order=i,console.warn("ScreenManager.addScreenQueues: Screen ".concat(e," queued"))):t.screens[e]=new ei({state:ui.QUEUED,order:i,parent:n.node,name:e})}else console.warn("ScreenManager.addScreenQueues: Invalid screen name ".concat(e))})),console.debug("ScreenManager.addScreenQueues: Screens Info",d({},this.screens))):console.warn("ScreenManager.addScreenQueues: No valid screen holder found")}},{key:"loadScreen",value:(v=a((function*(e){var t=this.screens[e];if(!this.validateScreenEntry(t,ui.QUEUED))return null;try{t.state=ui.LOADING;var n=yield Y.loadPrefabAsync("screens/".concat(e));return n?(t.state=ui.READY,t.prefab=n,console.debug("ScreenManager.loadScreen: ".concat(e," loaded successfully")),n):null}catch(n){return console.warn("ScreenManager.loadScreen: Failed to load ".concat(e),n),t.state=ui.QUEUED,null}})),function(e){return v.apply(this,arguments)})},{key:"validateScreenEntry",value:function(e,t){return!(!e||t&&e.state!==t)}},{key:"preloadScreens",value:(p=a((function*(){for(var e in this.screens)yield this.loadScreen(e)})),function(){return p.apply(this,arguments)})},{key:"getScreenPrefab",value:(f=a((function*(e){var t,n,i=this.screens[e];return i||(this.addScreenQueues([e]),i=this.screens[e])?null!==(t=i.parent)&&void 0!==t&&t.isValid?(this.isScreenReady(e)||(yield this.loadScreen(e)),null!==(n=i.prefab)&&void 0!==n?n:null):(console.warn("ScreenManager.getScreenPrefab: Invalid parent for ".concat(e)),null):(console.warn("ScreenManager.getScreenPrefab: Failed to create entry for ".concat(e)),null)})),function(e){return f.apply(this,arguments)})},{key:"updateScreenParent",value:function(e,t){var n;e.parent!==t&&null!==(n=e.screen)&&void 0!==n&&n.node&&null!=t&&t.isValid&&(t.addChild(e.screen.node),e.parent=t)}},{key:"getScreen",value:(h=a((function*(e){var t;if(!this.isScreenNameValid(e))return null;var n=this.getScreenHolder();if(null==n||!n.isValid)throw new Error("ScreenManager.getScreen: Invalid screen holder");if(!this.isScreenReady(e)&&!(yield this.getScreenPrefab(e)))throw new Error("ScreenManager.getScreen: Prefab not found for ".concat(e));var i=this.screens[e];if(!i)throw new Error("ScreenManager.getScreen: Entry not found for ".concat(e));if(!this.isScreenCreated(e)){var a=P(i.prefab);a.name=e,i.screen=a.getComponent("BaseScreen"),n.node.addChild(a),a.active=!1}if(null===(t=i=this.screens[e])||void 0===t||!t.screen)throw new Error("ScreenManager.getScreen: Screen component not found for ".concat(e));return this.updateScreenParent(i,n.node),this.reorderScreens(),console.debug("ScreenManager.getScreen: Retrieved ".concat(e),i),i.screen})),function(e){return h.apply(this,arguments)})},{key:"reorderScreens",value:function(){var e,t=this,n=si.vals(this.screens).filter((function(e){return t.isScreenReady(e.name)})).sort((function(e,t){return e.order-t.order})),i=s(n);try{for(i.s();!(e=i.n()).done;){var a,r,o=e.value;null!==(a=o.parent)&&void 0!==a&&a.isValid&&(null===(r=o.screen)||void 0===r||r.node.setSiblingIndex(o.order))}}catch(e){i.e(e)}finally{i.f()}}},{key:"waitForScreenLoading",value:(l=a((function*(){var e=this;if(this.isScreenLoading)return new Promise((function(t){!function n(){e.isScreenLoading?requestAnimationFrame(n):t()}()}))})),function(){return l.apply(this,arguments)})},{key:"processScreenQueue",value:function(){if(!this.isScreenLoading&&0!==this.screenLoadingQueue.length){var e=this.screenLoadingQueue.shift();e&&this.openScreen(e.screenName,e.screenData)}}},{key:"openScreen",value:(u=a((function*(e,t){if(this.isScreenNameValid(e))if(this.isScreenLoading)this.queueScreen(e,t);else try{yield this.performScreenOpen(e,t)}catch(t){console.error("ScreenManager.openScreen: Error opening ".concat(e),t)}finally{this.finishScreenOpen()}})),function(e,t){return u.apply(this,arguments)})},{key:"queueScreen",value:function(e,t){console.debug("ScreenManager.queueScreen: Queuing ".concat(e)),this.screenLoadingQueue.push({screenName:e,screenData:t})}},{key:"performScreenOpen",value:(c=a((function*(e,t){this.isScreenLoading=!0,ie.setBlockInput(!0);var n=yield this.getScreen(e);if(null==n||!n.isValid)throw new Error("ScreenManager.performScreenOpen: Invalid screen ".concat(e));var i=this.screens[e];null==i||i.incrementUseCount(),yield this.showScreen(n,e,t)})),function(e,t){return c.apply(this,arguments)})},{key:"showScreen",value:(o=a((function*(e,t,n){e.node.active=!0;var i={screenName:t,screenData:n};ni.emit(ri.OPENING_SCREEN,i),yield new Promise((function(e){return requestAnimationFrame(e)})),e.open(n),this.updateAnalytics(t)})),function(e,t,n){return o.apply(this,arguments)})},{key:"finishScreenOpen",value:function(){this.isScreenLoading=!1,ie.setBlockInput(!1),this.processScreenQueue()}},{key:"closeScreen",value:(r=a((function*(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isScreenNameValid(e))if(this.isScreenReady(e)){yield this.waitForScreenLoading();try{yield this.performScreenClose(e,t)}catch(t){console.error("ScreenManager.closeScreen: Error closing ".concat(e),t)}}else console.debug("ScreenManager.closeScreen: ".concat(e," is not ready"))})),function(e){return r.apply(this,arguments)})},{key:"performScreenClose",value:(t=a((function*(e,t){var n=yield this.getScreen(e);null!=n&&n.isValid&&n.node.active&&(ni.emit(ri.CLOSING_SCREEN,{screenName:e}),n.close(),t&&this.updateAnalytics(e,!1))})),function(e,n){return t.apply(this,arguments)})},{key:"updateAnalytics",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];ee.trackCurrentPage(e,t),t?null==ii||ii.addMetadata({currentScreen:e}):null==ii||ii.removeMetadata("currentScreen")}},{key:"closeAllScreens",value:function(){for(var e in this.screens)this.closeScreen(e,false)}}]),e}();p._RF.pop(),p._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var di=GameCore,hi=di.Configs.Core,fi=di.Events,pi=di.Plugins.Analytics.Events,vi=globalThis.game,yi=vi.context,gi=vi.storage,mi=vi.event,Si=vi.analytics,Ei=vi.monitorError;new(function(){function e(){var t=this;i(this,e),this.coreManager=new ge,this.adsManager=new de,this.sceneManager=new $n,this.screenManager=new li,this.engineManager=new Re,this.layoutManager=new Ke,this.playerManager=new et,this.pluginsManager=new jn,this.handleWhenCoreBoot=function(){console.warn("Corecos System: Core boot",{inited:v.inited,game:v}),v.inited?t.handleCocosInit():v.once(x.EVENT_GAME_INITED,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),console.groupEnd(),Si.event(pi.LOAD_START),mi.catchUp(fi.BUNDLE_READY,t.processPreStartGame)},this.processPreStartGame=function(){mi.catchUp(fi.SCENE_LOADED,t.preloadScenes),mi.catchUp(fi.SCENE_LAUNCHED,t.processBootSceneLaunched),t.runBootScene()},this.processBootSceneLaunched=a((function*(){hi.StartSDKAfterLoadGame&&(yield mi.waitTo(fi.SCENE_LOADED)),t.processStartGame()})),this.preloadScenes=function(){"solo"===gi.getStorageData("context","sessionContextType")?te.preloadDashboardScene():te.preloadGameScene()},this.handleSwitchScene=function(){mi.emit(fi.PRELOAD_SCREENS),console.groupEnd()},this.startProcessContextData=a((function*(){Si.event(pi.APP_READY);try{t.playerManager.requestConnectedPlayers(),yield yi.processContextData()}catch(e){console.error("startProcessContextData",e),e instanceof Error&&(null==Ei||Ei.sendException(e))}finally{mi.emit(fi.GAME_READY)}})),Si.event(pi.ENGINE_READY),console.groupCollapsed("📦 Corecos System"),console.info("Corecos Initializing..."),this.initManagers(),this.listenEvents(),console.groupEnd()}var t,r;return n(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"runBootScene",value:function(){te.switchScene(X.BOOT_SCENE)}},{key:"processStartGame",value:(r=a((function*(){console.groupEnd(),Si.event(pi.LOAD_COMPLETE),yield this.startGameAsync(),mi.catchUp(fi.PLAYER_INFO_LOADED,this.startProcessContextData)})),function(){return r.apply(this,arguments)})},{key:"startGameAsync",value:(t=a((function*(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;try{yield GameSDK.startGameAsync()}catch(n){console.warn("GameSDK.startGameAsync",n),t<=3?setTimeout((function(){e.startGameAsync(t+1)}),1e3):null==Ei||Ei.sendException(n instanceof Error?n:new Error(JSON.stringify(n)))}})),function(){return t.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initLanguages(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAtlas(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),p._RF.pop(),p._RF.push({},"826b3i39nhICrG3S59Y/cpR","PipelineData",void 0);var wi,Ai=n((function e(t,n,a,r){i(this,e),this.id=4294967295,this.width=0,this.height=0,this.id=t,this.width=n,this.height=a,this.framebuffer=r}));void 0===p.user&&(p.user=new Object,p.user.windowID=0,p.user.windows=new WeakMap),p._RF.pop(),p._RF.push({},"c7df3pBHqRChZTjXMfWIy6H","Optimized2DPipeline",void 0);var _i=O.ccclass,bi=function(){function e(){i(this,e),this._viewport=new N.Viewport,this._clearColor=new N.Color(0,0,0,1),this.usesMask=!0}return n(e,[{key:"setup",value:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i&&null!==i.scene&&null!==i.window){var a=this.prepareCameraResources(t,i);this.buildForward(t,i,a.id,a.width,a.height)}}}},{key:"prepareCameraResources",value:function(e,t){var n=function(e){var t=p.user.windows.get(e.window);return void 0!==t||(t=new Ai(p.user.windowID,0,0,e.window.framebuffer),++p.user.windowID,p.user.windows.set(e.window,t)),t}(t);return 0===n.width&&0===n.height?(n.width=t.window.width,n.height=t.window.height,this.initCameraResources(e,t,n.id,n.width,n.height)):n.framebuffer===t.window.framebuffer&&n.width===t.window.width&&n.height===t.window.height||(n.framebuffer=t.window.framebuffer,n.width=t.window.width,n.height=t.window.height,this.initCameraResources(e,t,n.id,n.width,n.height)),n}},{key:"initCameraResources",value:function(e,t,n,i,a){e.addRenderWindow("Color".concat(n),N.Format.RGBA8,i,a,t.window),this.usesMask&&e.addDepthStencil("DepthStencil".concat(n),N.Format.DEPTH_STENCIL,i,a)}},{key:"buildForward",value:function(e,t,n,i,a){this._clearColor.x=t.clearColor.x,this._clearColor.y=t.clearColor.y,this._clearColor.z=t.clearColor.z,this._clearColor.w=t.clearColor.w,this._viewport.left=t.viewport.x*i,this._viewport.top=t.viewport.y*a,this._viewport.width=t.viewport.z*i,this._viewport.height=t.viewport.w*a;var r=e.addRenderPass(i,a,"default");r.setViewport(this._viewport),!function(e){return 0!=(e.clearFlag&N.ClearFlagBit.COLOR)}(t)?r.addRenderTarget("Color".concat(n),N.LoadOp.LOAD):r.addRenderTarget("Color".concat(n),N.LoadOp.CLEAR,N.StoreOp.STORE,this._clearColor),this.usesMask&&(t.clearFlag&N.ClearFlagBit.DEPTH_STENCIL?r.addDepthStencil("DepthStencil".concat(n),N.LoadOp.CLEAR,N.StoreOp.STORE,t.clearDepth,t.clearStencil,t.clearFlag&N.ClearFlagBit.DEPTH_STENCIL):r.addDepthStencil("DepthStencil".concat(n),N.LoadOp.LOAD))}}]),e}();U&&(console.log("register pipeline"),U.setCustomPipeline("Optimized2DPipeline",new bi));_i("Optimized2DPipeline")(wi=function(e){h(a,e);var t=f(a);function a(){return i(this,a),t.apply(this,arguments)}return n(a,[{key:"start",value:function(){}},{key:"update",value:function(e){}}]),a}(z));p._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/systems', 'chunks:///systems.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});