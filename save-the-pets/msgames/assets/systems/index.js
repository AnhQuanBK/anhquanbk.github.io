function _instanceof(n,a){if(null!=a&&"undefined"!=typeof Symbol&&a[Symbol.hasInstance])return!!a[Symbol.hasInstance](n);return n instanceof a}function _type_of(n){return n&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n}function _ts_generator(n,a){var r,i,u,f,y={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return f={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function verb(n){return function(a){return step([n,a])}}function step(f){if(r)throw new TypeError("Generator is already executing.");while(y)try{if(r=1,i&&(u=2&f[0]?i.return:f[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,f[1])).done)return u;if(i=0,u)f=[2&f[0],u.value];switch(f[0]){case 0:case 1:u=f;break;case 4:y.label++;return{value:f[1],done:false};case 5:y.label++;i=f[1];f=[0];continue;case 7:f=y.ops.pop();y.trys.pop();continue;default:if(u=y.trys,!(u=u.length>0&&u[u.length-1])&&(6===f[0]||2===f[0])){y=0;continue}if(3===f[0]&&(!u||f[1]>u[0]&&f[1]<u[3])){y.label=f[1];break}if(6===f[0]&&y.label<u[1]){y.label=u[1];u=f;break}if(u&&y.label<u[2]){y.label=u[2];y.ops.push(f);break}if(u[2])y.ops.pop();y.trys.pop();continue}f=a.call(n,y)}catch(n){f=[6,n];i=0}finally{r=u=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:true}}}function _ts_values(n){var a="function"==typeof Symbol&&Symbol.iterator,r=a&&n[a],i=0;if(r)return r.call(n);if(n&&"number"==typeof n.length)return{next:function(){if(n&&i>=n.length)n=void 0;return{value:n&&n[i++],done:!n}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}System.register("chunks:///systems.js",["./Screens-e0f3e6d7.js","cc"],function(n,a){var r,i,u,f,y,g,_,E,A,w,b,k,C,D,R,T,I,F,M,L,x,N,O,P,G,B,U,z,H,V,q,W,j,Y,Q,K,J,Z,X,$,ee,et,en,ea,er,ei,es,eo,ec,eu,el;return{setters:[function(n){r=n.f,i=n.G,u=n.c,f=n.y,y=n.u,g=n.t,_=n.g,E=n.A,A=n.h,w=n.P,b=n.H,k=n.E,C=n.m,D=n.k,R=n.x,T=n.I,n.J,I=n.L,F=n.K,M=n.s,L=n.q,x=n.j,N=n.F,O=n.N,P=n.B,G=n.p,B=n.O,U=n.w},function(n){z=n.cclegacy,H=n.game,V=n.settings,q=n.Settings,W=n.AssetManager,j=n.director,Y=n.input,Q=n.Input,K=n.sys,J=n.macro,Z=n.DynamicAtlasManager,X=n.screen,$=n.math,ee=n.Director,et=n.View,en=n.ResolutionPolicy,ea=n.profiler,er=n.ImageAsset,ei=n.Texture2D,es=n.UIRenderer,eo=n.assetManager,ec=n.instantiate,eu=n.Vec3,el=n.Game}],execute:function(){z._RF.push({},"0b067Iz+iFJLJjNpsfblY7S","AdsManager",void 0);var n=GameCore,eh=n.Events,ed=n.Configs,ef=n.Utils.Time,ev=globalThis.game,ep=ev.ads,ey=ev.player,eg=ev.event,em=function(){function e(){var n=this;u(this,e),this.currentLayout="",this.handleShowBannerAds=function(a){a.sceneName!==f.BOOT_SCENE&&(ey.isFirstLogin()||(y.showBannerAds(),eg.off(eh.SCENE_LAUNCHED,n.handleShowBannerAds)))},this.handleWhenGameReady=g(function(){return _ts_generator(this,function(a){switch(a.label){case 0:return[4,n.handleShowInterstitialAdWhenGameReady()];case 1:a.sent();return[4,ef.sleepAsync(1e4)];case 2:a.sent(),y.preloadAds();return[2]}})}),this.handleShowInterstitialAdWhenGameReady=g(function(){var a,r,i,u,f,y,g,_,E;return _ts_generator(this,function(A){switch(A.label){case 0:a=ed.Ads,r=a.Enabled,i=a.ShowAdOnLoad;if(!r)return[3,6];u=i.Enabled,f=i.DelaySeconds,y=i.PlacementId;if(!u)return[3,6];A.label=1;case 1:A.trys.push([1,5,,6]);g=f>0;if(!g)return[3,3];return[4,ef.sleepAsync(1e3*f)];case 2:g=A.sent();A.label=3;case 3:_=ep.getAdByPlacementId(y,!1);if(!_)return[2];return[4,n.showAdByConfig(_)];case 4:A.sent();return[3,6];case 5:E=A.sent();console.warn("handleShowAdWhenLoadGame failed",E);return[3,6];case 6:return[2]}})}),this.handleLayoutChanged=function(a){if(n.currentLayout!==a){n.currentLayout=a;var r=ed.Ads.BannerDisplayAdOptions;a!==_.Layout.Landscape?r.forEach(function(n){var a=n.PlacementId,r=n.Position;"bottom"===r||"top"===r?y.showBannerAd(a):y.hideBannerAd(a)}):y.showBannerAds()}}}var n;return r(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){H.on(i.LAYOUT_CHANGED,this.handleLayoutChanged),eg.on(eh.SCENE_LAUNCHED,this.handleShowBannerAds),eg.catchUp(eh.GAME_READY,this.handleWhenGameReady)}},{key:"showAdByConfig",value:(n=g(function(n){var a,r,i;return _ts_generator(this,function(u){switch(u.label){case 0:u.trys.push([0,3,4,5]);a=n.type,r=n.placementId;return[4,ep.loadAdAsync(a,r)];case 1:u.sent(),E.muteAudio(!0);return[4,ep.showAdAsync(a,r)];case 2:u.sent();return[3,5];case 3:i=u.sent();console.warn("showAdByConfig failed",i);return[3,5];case 4:H.resume(),E.muteAudio(!1);return[7];case 5:return[2]}})}),function(a){return n.apply(this,arguments)})}]),e}();z._RF.pop(),z._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var eS=GameCore.Events,e_=globalThis.game.event,eE=function(){function e(){u(this,e)}return r(e,[{key:"init",value:function(){console.info("Core Manager: Initialized")}},{key:"requestStart",value:function(){e_.emit(eS.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(n){e_.catchUp(eS.CORE_BOOTING,n)}},{key:"onCoreStart",value:function(n){e_.catchUp(eS.CORE_STARTING,n)}},{key:"onCoreReady",value:function(n){e_.catchUp(eS.CORE_READY,n)}}]),e}();z._RF.pop(),z._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var eA=GameCore,ew=eA.Events,eb=eA.Configs.GameEngine.DynamicAtlas,ek=eA.Utils,eC=ek.Valid,eD=ek.Device,eR=ek.Function,eT=globalThis.game.event,eI=function(){function e(){var n=this;u(this,e),this.handlePauseEngine=g(function(){return _ts_generator(this,function(n){console.info("Engine: Paused",H.isPaused()),H.isPaused();return[2]})}),this.handleResumeEngine=g(function(){return _ts_generator(this,function(n){console.info("Engine: Resumed",H.isPaused()),H.isPaused();return[2]})}),this.handleResizeView=function(a){et.instance.resizeWithBrowserSize(!1);var r=a.width,i=a.height;n.resizeView(r,i)},this.handleViewResized=eR.throttle(function(n){var a=n.width,r=n.height;et.instance.resizeWithBrowserSize(!0),console.info("âœ¨ New View Size",{width:a,height:r})},600)}var n;return r(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){H.on(i.VIEW_RESIZE,this.handleResizeView),H.on(i.VIEW_RESIZED,this.handleViewResized)}},{key:"overrideSettings",value:function(){V.overrideSettings(q.Category.ENGINE,"debug",eC.isDebugger()),H.frameRate=eD.isDesktop()?60:48}},{key:"setupAutoAtlas",value:function(){W.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var n=W.instance.downloader;n.maxConcurrency=15,n.maxRequestsPerFrame=15}},{key:"getPipelineFlows",value:function(){var n,a;return null!==(n=null===(a=j.root)||void 0===a||null===(a=a.pipeline)||void 0===a?void 0:a.flows)&&void 0!==n?n:[]}},{key:"getRenderQueues",value:function(n){var a=this.getPipelineFlows()[0];return null!=a&&a.stages?a.stages[n].renderQueues:[]}},{key:"setupOptimalPipelines",value:(n=g(function(){var n,a;return _ts_generator(this,function(r){switch(r.label){case 0:W.instance.transformPipeline.remove(1);return[4,eC.isValueChangeAsync(function(){return!!j.root},!0,{timeout:1e4})];case 1:r.sent();n=this.getPipelineFlows();n.shift(),n.shift();a=this.getRenderQueues(0);a.shift(),a.shift();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var n=this;Y.on(Q.EventType.TOUCH_START,this.handleResumeEngine),eT.catchUp(ew.GAME_READY,function(){eT.on(ew.VISIBILITY_HIDDEN,n.handlePauseEngine),eT.on(ew.VISIBILITY_VISIBLE,n.handleResumeEngine)})}},{key:"setupDynamicAtlas",value:function(){switch(K.os){case K.OS.IOS:this.setupDynamicAtlasForIOS();break;case K.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(n){var a=n.Enabled,r=n.AutoAtlasSize,i=n.MaxAtlasCount,u=n.MaxAtlasSize,f=n.MaxFrameSize;if(J.CLEANUP_IMAGE_CACHE=!1,Z.instance.enabled=a,Z.instance.textureSize=u,Z.instance.maxFrameSize=f,Z.instance.maxAtlasCount=i,Z.instance.textureBleeding=!0,r){var y=this.getMaxTextureSize();if(!y)return;Z.instance.maxAtlasCount=1,Z.instance.textureSize=y}}},{key:"getMaxTextureSize",value:function(){if(!j.root)return -1;var n=j.root.device.capabilities.maxTextureSize,a=1024;return n-a<=Z.instance.maxFrameSize?-1:n>8192?7168:n-a}},{key:"setupDynamicAtlasForIOS",value:function(){var n=eb.IOS;this.setDynamicAtlas(n)}},{key:"setupDynamicAtlasForAndroid",value:function(){var n=eb.Android;this.setDynamicAtlas(n)}},{key:"setupDynamicAtlasForDesktop",value:function(){var n=eb.Desktop;this.setDynamicAtlas(n)}},{key:"setupBatcherLimit",value:function(){J.BATCHER2D_MEM_INCREMENT=288,J.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(n,a){var r,u=window.devicePixelRatio,f=u>=2?2/u:1,y=Math.round(n*u*f),g=Math.round(a*u*f);null===(r=j.root)||void 0===r||r.resize(y,g),X.windowSize=new $.Size(y,g),j.once(ee.EVENT_AFTER_UPDATE,function(){H.emit(i.VIEW_RESIZED,{width:y,height:g})})}}]),e}();z._RF.pop();var eF,eM=new(function(){function e(){u(this,e),this._registry={},this._moduleCache={}}return r(e,[{key:"define",value:function(n,a,r){this._registry[n]={factory:a,resolveMap:r}}},{key:"require",value:function(n){return this._require(n)}},{key:"throwInvalidWrapper",value:function(n,a){throw new Error("Module '".concat(n,"' imported from '").concat(a,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(n,a){var r=this._moduleCache[n];if(r)return r.exports;var i={id:n,exports:{}};return this._moduleCache[n]=i,this._tryModuleLoad(i,n),i.exports}},{key:"_resolve",value:function(n,a){return this._resolveFromInfos(n,a)||this._throwUnresolved(n,a)}},{key:"_resolveFromInfos",value:function(n,a){var r,i;return n in cjsInfos?n:a&&null!==(r=null===(i=cjsInfos[a])||void 0===i?void 0:i.resolveCache[n])&&void 0!==r?r:void 0}},{key:"_tryModuleLoad",value:function(n,a){var r=!0;try{this._load(n,a),r=!1}finally{r&&delete this._moduleCache[a]}}},{key:"_load",value:function(n,a){var r=this._loadWrapper(a),i=r.factory,u=r.resolveMap,f=this._createRequire(n),y=u?this._createRequireWithResolveMap("function"==typeof u?u():u,f):f;i(n.exports,y,n)}},{key:"_loadWrapper",value:function(n){return n in this._registry?this._registry[n]:this._loadHostProvidedModules(n)}},{key:"_loadHostProvidedModules",value:function(n){return{factory:function(a,r,i){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(n,"'."));try{i.exports=require(n)}catch(a){throw new Error("Exception thrown when calling host defined require('".concat(n,"')."),{cause:a})}}}}},{key:"_createRequire",value:function(n){var a=this;return function(r){return a._require(r,n)}}},{key:"_createRequireWithResolveMap",value:function(n,a){return function(r){var i=n[r];if(i)return a(i);throw new Error("Unresolved specifier "+r)}}},{key:"_throwUnresolved",value:function(n,a){throw new Error("Unable to resolve ".concat(n," from ").concat(parent,"."))}}]),e}());function Ae(n){return(Ae="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function(n){return void 0===n?"undefined":_type_of(n)}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":void 0===n?"undefined":_type_of(n)})(n)}var eL="file:///C:/Tests/save-the-pets/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";eM.define(eL,function(n,a,r,i,u){(function(a,i){"object"===Ae(n)&&void 0!==r?r.exports=i():"function"==typeof define&&define.amd?define(i):a.ResizeObserver=i()})(this,function(){var n=function(){if("undefined"!=typeof Map)return Map;function e(n,a){var r=-1;return n.some(function(n,i){return n[0]===a&&(r=i,!0)}),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(n){var a=e(this.__entries__,n),r=this.__entries__[a];return r&&r[1]},t.prototype.set=function(n,a){var r=e(this.__entries__,n);~r?this.__entries__[r][1]=a:this.__entries__.push([n,a])},t.prototype.delete=function(n){var a=this.__entries__,r=e(a,n);~r&&a.splice(r,1)},t.prototype.has=function(n){return!!~e(this.__entries__,n)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(n,a){void 0===a&&(a=null);for(var r=0,i=this.__entries__;r<i.length;r++){var u=i[r];n.call(a,u[1],u[0])}},t}()}(),a="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,r="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(r):function(n){return setTimeout(function(){return n(Date.now())},1e3/60)};var u=["top","right","bottom","left","width","height","size","weight"],f="undefined"!=typeof MutationObserver,y=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(n,a){var r=!1,u=!1,f=0;function s(){r&&(r=!1,n()),u&&c()}function o(){i(s)}function c(){var n=Date.now();if(r){if(n-f<2)return;u=!0}else r=!0,u=!1,setTimeout(o,a);f=n}return c}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(n){~this.observers_.indexOf(n)||this.observers_.push(n),this.connected_||this.connect_()},e.prototype.removeObserver=function(n){var a=this.observers_,r=a.indexOf(n);~r&&a.splice(r,1),!a.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var n=this.observers_.filter(function(n){return n.gatherActive(),n.hasActive()});return n.forEach(function(n){return n.broadcastActive()}),n.length>0},e.prototype.connect_=function(){a&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),f?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){a&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(n){var a=n.propertyName,r=void 0===a?"":a;u.some(function(n){return!!~r.indexOf(n)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),o=function(n,a){for(var r=0,i=Object.keys(a);r<i.length;r++){var u=i[r];Object.defineProperty(n,u,{value:a[u],enumerable:!1,writable:!1,configurable:!0})}return n},c=function(n){return n&&n.ownerDocument&&n.ownerDocument.defaultView||r},g=p(0,0,0,0);function l(n){return parseFloat(n)||0}function d(n){for(var a=[],r=1;r<arguments.length;r++)a[r-1]=arguments[r];return a.reduce(function(a,r){return a+l(n["border-"+r+"-width"])},0)}function h(n){var a=n.clientWidth,r=n.clientHeight;if(!a&&!r)return g;var i=c(n).getComputedStyle(n),u=function(n){for(var a={},r=0,i=["top","right","bottom","left"];r<i.length;r++){var u=i[r],f=n["padding-"+u];a[u]=l(f)}return a}(i),f=u.left+u.right,y=u.top+u.bottom,_=l(i.width),E=l(i.height);if("border-box"===i.boxSizing&&(Math.round(_+f)!==a&&(_-=d(i,"left","right")+f),Math.round(E+y)!==r&&(E-=d(i,"top","bottom")+y)),!function(n){return n===c(n).document.documentElement}(n)){var A=Math.round(_+f)-a,w=Math.round(E+y)-r;1!==Math.abs(A)&&(_-=A),1!==Math.abs(w)&&(E-=w)}return p(u.left,u.top,_,E)}var _="undefined"!=typeof SVGGraphicsElement?function(n){return _instanceof(n,c(n).SVGGraphicsElement)}:function(n){return _instanceof(n,c(n).SVGElement)&&"function"==typeof n.getBBox};function v(n){return a?_(n)?function(n){var a=n.getBBox();return p(0,0,a.width,a.height)}(n):h(n):g}function p(n,a,r,i){return{x:n,y:a,width:r,height:i}}var E=function(){function e(n){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=p(0,0,0,0),this.target=n}return e.prototype.isActive=function(){var n=v(this.target);return this.contentRect_=n,n.width!==this.broadcastWidth||n.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var n=this.contentRect_;return this.broadcastWidth=n.width,this.broadcastHeight=n.height,n},e}(),m=function(n,a){var r,i,u,f,y,g,_,E=(i=(r=a).x,u=r.y,f=r.width,y=r.height,g="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,_=Object.create(g.prototype),o(_,{x:i,y:u,width:f,height:y,top:u,right:i+f,bottom:y+u,left:i}),_);o(this,{target:n,contentRect:E})},A=function(){function t(a,r,i){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof a)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=a,this.controller_=r,this.callbackCtx_=i}return t.prototype.observe=function(n){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(n,c(n).Element))throw new TypeError('parameter 1 is not of type "Element".');var a=this.observations_;a.has(n)||(a.set(n,new E(n)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(n){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(n,c(n).Element))throw new TypeError('parameter 1 is not of type "Element".');var a=this.observations_;a.has(n)&&(a.delete(n),a.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var n=this;this.clearActive(),this.observations_.forEach(function(a){a.isActive()&&n.activeObservations_.push(a)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var n=this.callbackCtx_,a=this.activeObservations_.map(function(n){return new m(n.target,n.broadcastRect())});this.callback_.call(n,a,n),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),w="undefined"!=typeof WeakMap?new WeakMap:new n,S=function e(n){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var a=y.getInstance(),r=new A(n,a,this);w.set(this,r)};return["observe","unobserve","disconnect"].forEach(function(n){S.prototype[n]=function(){var a;return(a=w.get(this))[n].apply(a,arguments)}}),void 0!==r.ResizeObserver?r.ResizeObserver:S}),eF=r.exports},{}),eM.require(eL),z._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var ex=_.Layout,eN=_.DesignSize,eO=eN.Portrait,eP=eN.Landscape,eG=GameCore,eB=eG.Utils.Function,eU=eG.Configs.GameEngine,ez=eU.AutoResizeCanvas,eH=eU.AutoChangeOrientation,eV=function(){function e(){var n=this;u(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(a){console.info("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=a||window.devicePixelRatio,n.setupOrientationByScreenSize(),n.resizeGameView()},this.handleViewResize=eB.debounce(function(){console.info("\uD83D\uDCF1 View resize by window"),n.setupOrientationByScreenSize(),n.resizeGameView()},300),this.handleBodyResize=eB.debounce(function(){n.resizeGameDiv()&&(console.info("\uD83D\uDCF1 View resize by body"),n.setupOrientationByScreenSize(),n.resizeGameView())},300)}return r(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){ez&&(X.on("window-resize",this.handleViewResize,this),X.on("orientation-change",this.handleViewResize,this)),H.on(i.REQUEST_VIEW_RESIZE,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){ez&&new eF(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){eH&&(et.instance.resizeWithBrowserSize(!0),et.instance.setOrientation(J.ORIENTATION_AUTO),et.instance.setResolutionPolicy(en.ContentStrategy.FIXED_WIDTH),et.instance.setResolutionPolicy(en.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=et.instance.getResolutionPolicy())}},{key:"setupOrientationByScreenSize",value:function(){eH&&(this.getScreenRatio()<1?this.setPortraitView():this.setLandscapeView())}},{key:"resizeGameDiv",value:function(n){var a=arguments.length>0&&void 0!==n&&n,r=document.getElementById("GameDiv");if(!r)return!1;var i=A.getScreenWidthCss(),u=A.getScreenHeightCss(),f=r.getBoundingClientRect(),y=f.width,g=f.height;return!(i===y&&u===g&&!a)&&(r.style.width="".concat(i,"px"),r.style.height="".concat(u,"px"),!0)}},{key:"resizeGameView",value:function(){var n=A.getScreenWidthCss(),a=A.getScreenHeightCss();if(this.currentLayout===ex.Portrait){var r=Math.min(n/eO.WIDTH,a/eO.HEIGHT);n=eO.WIDTH*r,a=eO.HEIGHT*r}if(this.currentLayout===ex.Landscape){var u=Math.min(n/eP.WIDTH,a/eP.HEIGHT);n=eP.WIDTH*u,a=eP.HEIGHT*u}H.emit(i.VIEW_RESIZE,{width:n,height:a})}},{key:"setPortraitView",value:function(){var n=eO.WIDTH,a=eO.HEIGHT;this.currentLayout!==ex.Portrait&&(this.currentLayout=ex.Portrait,this.changeDesignResolutionSize(n,a))}},{key:"setLandscapeView",value:function(){var n=eP.WIDTH,a=eP.HEIGHT;this.currentLayout!==ex.Landscape&&(this.currentLayout=ex.Landscape,this.changeDesignResolutionSize(n,a))}},{key:"changeDesignResolutionSize",value:function(n,a){this.currentLayout,ex.Portrait,this.currentLayout,ex.Landscape;this.resolutionPolicy.setContentStrategy(en.ContentStrategy.FIXED_WIDTH),et.instance.setDesignResolutionSize(n,a,this.resolutionPolicy),H.emit(i.LAYOUT_CHANGED,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout,this.resolutionPolicy)}},{key:"getScreenRatio",value:function(){return A.getScreenWidthCss()/A.getScreenHeightCss()}}]),e}();z._RF.pop(),z._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var eq=GameCore,eW=eq.Utils,ej=eq.Dtos,eY=eW.Valid,eQ=globalThis.game.player,eK=function(){function e(){u(this,e)}return r(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var n=ej.Player;n.Data.addDefaultData(w),n.GameData.addDefaultData(b),n.GameData.addValidateFunction("totalLevel",function(n){if(!eY.isNumber(n)||n<1)throw new Error("totalLevel ".concat(n," is invalid"))}),n.GameData.addValidateFunction("passAllLevels",function(n){if(!eY.isBoolean(n))throw new Error("passAllLevels ".concat(n," is invalid"))}),n.GameData.addValidateFunction("levelProgress",function(n){if(!eY.isObject(n))throw new Error("levelProgress ".concat(n," is invalid"))}),n.GameData.addValidateFunction("bestEndlessScore",function(n){if(!eY.isNumber(n)||n<0)throw new Error("bestEndlessScore ".concat(n," is invalid"))})}},{key:"requestConnectedPlayers",value:function(){eQ.requestConnectedPlayers().catch(function(n){console.warn("player.requestConnectedPlayers",n)})}}]),e}();z._RF.pop(),z._RF.push({},"c510204p3JAXLCuogskxTkP","AdaptivePerformance",void 0);var eJ=GameCore,eZ=eJ.Events,eX=eJ.Utils.Valid,e$=globalThis.game,e0=e$.event,e1=e$.adaptivePerformance,e2=function(){function e(){var n=this;u(this,e),this.handleBeginFrame=function(){j.on(ee.EVENT_AFTER_UPDATE,n.lateUpdate),j.on(ee.EVENT_BEFORE_UPDATE,n.updateActualFPS)},this.handleAfterSceneLaunch=function(n){e1&&e1.trackingScene(n.name)},this.handleRequestResizeGame=function(n){var a=n.forcePixelRatio;eX.isNumber(a)&&H.emit(i.REQUEST_VIEW_RESIZE,a)},this.lateUpdate=function(){var n=1e3*H.deltaTime;null==e1||e1.updatePostStepDeltaTime(n)},this.updateActualFPS=function(){var n,a=null===(n=j.root)||void 0===n?void 0:n.fps;eX.isNumber(a)&&(null==e1||e1.updateActualFPS(a))}}return r(e,[{key:"init",value:function(){e1&&this.listenEvents()}},{key:"listenEvents",value:function(){e0.on(eZ.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),j.once(ee.EVENT_BEGIN_FRAME,this.handleBeginFrame),j.on(ee.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();z._RF.pop(),z._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var e3=globalThis.game.canvasRecorder,e4=function(){function e(){u(this,e)}return r(e,[{key:"init",value:function(){if(H.canvas&&e3){e3.setCanvas(H.canvas);var n=e3.getOptions(),a=e3.waitNextFrame;e3.waitNextFrame=g(function(){var r;return _ts_generator(this,function(i){switch(i.label){case 0:if(!n.syncFps)return[3,1];r=new Promise(function(n){j.once(ee.EVENT_AFTER_RENDER,n),H.pause(),H.step()});return[3,3];case 1:H.resume();return[4,a.call(e3)];case 2:r=(i.sent(),Promise.resolve());i.label=3;case 3:return[2,r]}})})}}}]),e}();z._RF.pop(),z._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var e5=function(){function e(){var n=this;u(this,e),this.hideCocosStats=function(){clearInterval(n.waiter),n.waiter=setInterval(n.checkProfilerReady,100)},this.checkProfilerReady=function(){if(ea){ea._showFPS=!1;var a=ea._rootNode;a&&(a.active=!1,a.isValid&&(a.destroyAllChildren(),a.removeAllChildren(),a.destroy(),clearInterval(n.waiter)))}}}return r(e,[{key:"init",value:function(){j.on(ee.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();z._RF.pop(),z._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var e6=GameCore,e8=e6.Configs.GameEngine.DynamicAssets,e7=e6.Events,e9=e6.Utils.Array,te=globalThis.game,tt=te.event,tn=te.storage,ta=te.getBuildVersion,tr=[".png",".jpg",".jpeg",".webp"],ti=function(){function e(){var n=this;u(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradableAssets=new Map,this.handleSceneLaunched=function(n){var a=n.sceneName,r=[f.BOOT_SCENE];e9.has(r,a)||H.emit(i.CHANGE_QUALITY_ASSETS,{quality:"highest"})},this.requestUpdateDynamicAssets=function(){H.emit(i.UPGRADE_DYNAMIC_ATLAS,{force:!0})},this.collectUpgradableAssets=function(a){var r,i=a.output=a.input,u=e8.Resolution,f=u.Adjust,y=u.Original,g=D(i);try{for(g.s();!(r=g.n()).done;){var _=r.value;if(e9.has(tr,_.ext)&&!n.upgradableAssets.has(_.uuid)){n.useHighQuality?(_.url=n.replaceAssetUrl(_.url),_.resolution=y,_.upgradeOnNextRequest=!0):f<y&&(_.resolution=f);var E={ext:_.ext,url:_.url,uuid:_.uuid,options:_.options,upgraded:_.upgraded,resolution:_.resolution,upgradeOnNextRequest:_.upgradeOnNextRequest};n.upgradableAssets.set(_.uuid,E)}}}catch(n){g.e(n)}finally{g.f()}},this.replaceAssetUrl=function(a){return n.useHighQuality?a.replace("native/","native32/"):a},this.handleChangeQuality=g(function(){var a,r,i,u,f,y,g;return _ts_generator(this,function(_){switch(_.label){case 0:n.isProcessing=!0;r=[],i=D(n.upgradableAssets.values());try{for(i.s();!(a=i.n()).done;){u=a.value,f=n.processUpgradeQualityAsync(u);r.push(f)}}catch(n){i.e(n)}finally{i.f()}return[4,Promise.all(r)];case 1:y=_.sent();n.isProcessing=!1;g=y.filter(function(n){return n}).length;n.requestUpdateDynamicAssets(),console.warn("DynamicAssets: Upgradable Assets Info",{total:g,results:y});return[2]}})})}var n;return r(e,[{key:"init",value:function(){var n=e8.Enabled,a=e8.Resolution;console.info("DynamicAssets: init",{EDITOR:k,Enabled:n}),n&&(W.instance.transformPipeline.insert(this.collectUpgradableAssets,2),this.initState(),this.listenEvents(),window.requestIdleCallback=window.requestIdleCallback||function(n){n()},a.Adjust,a.Original)}},{key:"initState",value:function(){var n=ta().toString();tn.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0);var a=tn.getStorage("DynamicAssets"),r=null!=a?a:{},i=r.buildVersion,u=r.useHighQuality;"boolean"==typeof u&&(this.useHighQuality=u&&i===n),tn.setStorageData("DynamicAssets","buildVersion",n),tn.updateToWebStorage("DynamicAssets")}},{key:"listenEvents",value:function(){var n=this;H.on(i.CHANGE_QUALITY_ASSETS,this.handleChangeQuality),setTimeout(function(){n.useHighQuality=!0,n.autoUpgradeQuality(),tt.on(e7.SCENE_LAUNCHED,n.handleSceneLaunched)},4e3)}},{key:"autoUpgradeQuality",value:function(){var n=this;requestIdleCallback(g(function(){var a;return _ts_generator(this,function(r){switch(r.label){case 0:if(!(!n.isProcessing&&!H.isPaused()))return[3,2];a=C(n.upgradableAssets.values()).find(function(n){return!n.upgraded&&!n.upgradeOnNextRequest});if(!a)return[2,(tn.setStorageData("DynamicAssets","useHighQuality",!0),tn.updateToWebStorage("DynamicAssets"),void n.requestUpdateDynamicAssets())];console.info("DynamicAssets: Auto upgrade quality",a),n.isProcessing=!0;return[4,n.processUpgradeQualityAsync(a)];case 1:r.sent(),n.isProcessing=!1,n.autoUpgradeQuality();r.label=2;case 2:return[2]}})}),{timeout:1e3})}},{key:"processUpgradeQualityAsync",value:(n=g(function(n){var a,r,u,f,y;return _ts_generator(this,function(g){a=this;if(n.upgraded||n.upgradeOnNextRequest)return[2,!0];r=W.instance,u=r.assets,f=r.loadAny,y=u.get(n.uuid);return[2,_instanceof(y,er)?(n.url=this.replaceAssetUrl(n.url),new Promise(function(r){f(n,n.options,function(u,f){if(u)return console.warn("DynamicAssets: Upgrade error",u),void r(!1);y.reset(f),n.upgraded=!0,a.upgradableAssets.set(n.uuid,n),H.emit(i.ASSET_QUALITY_CHANGE,{asset:y,item:n}),r(!0)})})):(console.warn("DynamicAssets: Asset not found",n.uuid),!1)]})}),function(a){return n.apply(this,arguments)})}]),e}();z._RF.pop(),z._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var ts=GameCore,to=ts.Events,tc=ts.Configs.GameEngine.DynamicAtlas,tu=tc.UsePowerOfTwo,tl=tc.TextureAtlasOptimize,th=ts.Utils,td=th.Array,tf=th.Json,tv=th.Object,tp=th.Function,ty=globalThis.game.event,tg=function(){function e(){var n=this;u(this,e),this.atlasTexId=null,this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.setupRenderListeners=function(){j.on(ee.EVENT_BEFORE_RENDER,n.updateBeforeRenderTime),j.on(ee.EVENT_AFTER_RENDER,n.updateAfterRenderTime),ty.once(to.SCENE_LAUNCHED,function(){j.once(ee.EVENT_AFTER_RENDER,n.checkRenderTimeHighers)})},this.checkRenderTimeHighers=function(){var a=n.getMeanRenderTime();a>8&&n.handleLaggyFrame(a),j.once(ee.EVENT_AFTER_RENDER,function(){setTimeout(n.checkRenderTimeHighers,n.renderTimeInterval)})},this.resetPendingSprites=function(){n.pendingSprites={}},this.updateBeforeRenderTime=function(){n.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){n.renderTimes.push(performance.now()-n.lastRenderTime)},this.requestUpdateDynamicAtlas=tp.throttle(function(a){n.isProcessing||(n.isProcessing=!0,n.forceUpdateDynamicAtlas=(null==a?void 0:a.force)||!1,j.once(ee.EVENT_AFTER_RENDER,n.updateDynamicAtlas))},5e3),this.updateDynamicAtlas=function(){try{var a=j.getScene();if(!a)return;var r=n.collectPackageInfo();if(Object.keys(r).length<1)return;if(n.drawInfo=[],n.atlasInfo=null,n.generateDrawInfo(tv.vals(r)),!n.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!n.updateAtlasData()&&!n.forceUpdateDynamicAtlas)return;var i=a.getComponentsInChildren(es);n.refreshComponents(i)}catch(n){console.error("DynamicAtlas: Error updating dynamic atlas",n)}finally{n.isProcessing=!1,n.forceUpdateDynamicAtlas=!1}},this.generateDrawInfo=function(a){if(!(a.length<1)){console.info("DynamicAtlas: generate draw info",a);var r=a.sort(function(n,a){return a.usageCount-n.usageCount}),i=Z.instance.textureSize;if(n.calculateOptimizedAtlas(r,i),n.atlasInfo){var u,f=n.atlasInfo.textures,y=D(f);try{for(y.s();!(u=y.n()).done;){var g=u.value;n.drawInfo.push(g)}}catch(n){y.e(n)}finally{y.f()}var _=r.filter(function(n){return!f.some(function(a){return a.id===n.id})});_.length>0&&(console.warn("DynamicAtlas: Missing textures",_),n.generateDrawInfo(_))}else console.warn("DynamicAtlas: Atlas info not found",{textures:r})}},this.calculateOptimizedAtlas=function(a,r){var i=function(n){var a,r=0,i=0,u=D(n);try{for(u.s();!(a=u.n()).done;){var f=a.value;r+=f.w*f.h,i=Math.max(i,f.w)}}catch(n){u.e(n)}finally{u.f()}n.sort(function(n,a){return a.h-n.h});var y,g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),i),h:1/0}],_=0,E=0,A=D(n);try{for(A.s();!(y=A.n()).done;)for(var w=y.value,b=g.length-1;b>=0;b--){var k=g[b];if(!(w.w>k.w||w.h>k.h)){if(w.x=k.x,w.y=k.y,E=Math.max(E,w.y+w.h),_=Math.max(_,w.x+w.w),w.w===k.w&&w.h===k.h){var C=g.pop();b<g.length&&(g[b]=C)}else w.h===k.h?(k.x+=w.w,k.w-=w.w):w.w===k.w?(k.y+=w.h,k.h-=w.h):(g.push({x:k.x+w.w,y:k.y,w:k.w-w.w,h:w.h}),k.y+=w.h,k.h-=w.h);break}}}catch(n){A.e(n)}finally{A.f()}return{w:_,h:E,fill:r/(_*E)||0}}(a),u=i.w,f=i.h,y=i.fill;if(y<.6)console.warn("DynamicAtlas: Fill rate is too low",y,C(a));else{if(u>r||f>r)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",u,f,r),void(a.pop()?n.calculateOptimizedAtlas(a,r):console.warn("DynamicAtlas: Texture size is too big",u,f,r));n.atlasInfo={textures:a,atlasSize:r,packedInfo:{width:Math.round(u),height:Math.round(f),fillRate:y}}}},this.drawTexture=function(a,r,i){var u=r.texture,f=u.image;if(!f||f.width<1||f.height<1)console.warn("DynamicAtlas: Texture image not found",u);else if(!f.data||f.data.width<1||f.data.height<1)console.warn("DynamicAtlas: Texture image data not found",f);else{var y=u.getId(),g=td.search(C(n.drawInfo),function(n){return n.id===y})||{x:-1,y:-1},_=g.x,E=g.y;if(!(_<0||E<0)){var A=a._innerTextureInfos[y];A||(i&&(a._texture.drawTextureAt(f,_-1,E),a._texture.drawTextureAt(f,_+1,E),a._texture.drawTextureAt(f,_,E-1),a._texture.drawTextureAt(f,_,E+1)),a._texture.drawTextureAt(f,_,E),a._count++,a._innerTextureInfos[y]={texture:u,x:_,y:E});var w=r.rect,b=w.x,k=w.y;b+=(null==A?void 0:A.x)||_,k+=(null==A?void 0:A.y)||E;var D={texture:a._texture,x:b,y:k};return a._innerSpriteFrames.push(r),D}n.pendingSprites[r.uuid]=r}},this.refreshComponents=function(n){var a,r=D(n);try{for(r.s();!(a=r.n()).done;){var i=a.value;i.node.active&&(i.node.active=!1,i.node.active=!0)}}catch(n){r.e(n)}finally{r.f()}},this.isSameAtlas=function(n,a){if(!n||!a)return!1;var r=n.packedInfo,i=n.textures,u=a.packedInfo,f=a.textures;return r.width===u.width&&r.height===u.height&&i.length===f.length&&i.every(function(n,a){var r=n.id,i=n.w,u=n.h,y=f[a]||{},g=y.id,_=y.w,E=y.h;return r===g&&i===_&&u===E})}}return r(e,[{key:"init",value:function(){tl&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:tl}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){H.on(i.UPGRADE_DYNAMIC_ATLAS,this.requestUpdateDynamicAtlas),j.on(ee.EVENT_BEFORE_SCENE_LAUNCH,this.resetPendingSprites),ty.catchUp(to.GAME_READY,this.setupRenderListeners)}},{key:"handleLaggyFrame",value:function(n){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(n.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var n,a=0,r=D(this.renderTimes);try{for(r.s();!(n=r.n()).done;)a+=n.value}catch(n){r.e(n)}finally{r.f()}return a/=this.renderTimes.length,this.renderTimes=[],a}},{key:"overrideDynamicAtlas",value:function(){var n=this,a=Z.instance;Z.instance.insertSpriteFrame=function(r){if(a._atlasIndex>=a._maxAtlasCount)return null;if(!r||r.original)return console.warn("DynamicAtlas: Skip original texture",r),null;if(!r.packable)return console.warn("DynamicAtlas: Skip non-packable texture",r),null;var i=n.getAtlas(),u=i?i.insertSpriteFrame(r):null;return!u&&a._atlasIndex<a._maxAtlasCount&&(u=(i=n.getAtlas())?i.insertSpriteFrame(r):null),u}}},{key:"createAtlas",value:function(){return Z.instance.newAtlas()}},{key:"getAtlas",value:function(){var n=this,a=Z.instance,r=a._atlases,i=void 0===r?[]:r,u=a._atlasIndex,f=a.textureBleeding,y=i[u];return y||(y=this.createAtlas()),y?(y.originalInsertSpriteFrame||(y.originalInsertSpriteFrame=y.insertSpriteFrame,y.insertSpriteFrame=function(a){return n.drawTexture(y,a,f)}),this.atlasTexId=y._texture.getId(),y):null}},{key:"collectPackageInfo",value:function(){var n,a=tv.vals(this.pendingSprites),r={},i=D(a);try{for(i.s();!(n=i.n()).done;){var u=n.value;if(this.isValidSpriteFrame(u)){var f=u.texture,y=u.original,g=f.getId(),_=null==y?void 0:y._texture.getId();if(g!==_){_&&(g=_),this.collectInfo[g]||this.initializeCollectInfo(g,u);var E=this.collectInfo[g];E&&(E.usageCount++,r[g]=E)}else console.warn("DynamicAtlas: Skip original texture",{texId:g,oriTexId:_})}}}catch(n){i.e(n)}finally{i.f()}return r}},{key:"isValidSpriteFrame",value:function(n){var a=n.packable,r=n.texture,i=n.original,u=n.name,f=n.uuid;if(!a)return console.warn("DynamicAtlas: Skip non-packable texture",u,f),!1;if(!_instanceof(r,ei))return console.warn("DynamicAtlas: Skip non-texture2d texture",u,f),!1;var y=null==i?void 0:i._texture.getId();return this.atlasTexId!==y||(console.warn("DynamicAtlas: Skip texture in atlas",u,f),!1)}},{key:"initializeCollectInfo",value:function(n,a){var r=a.texture,i=a.original,u=a.uuid,f=r.width,y=r.height,g=(null==i?void 0:i._texture)||{width:0,height:0},_=g.width,E=g.height,A=Math.max(f,_)+2,w=Math.max(y,E)+2;A<=1||w<=1?console.warn("DynamicAtlas: Skip invalid texture size",u,{w:A,h:w}):this.collectInfo[n]={id:n,w:A,h:w,x:-1,y:-1,usageCount:0,name:u}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var n=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!n,n)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.info("DynamicAtlas: atlas info",this.atlasInfo);var a=this.getAtlas();if(!a||!a._texture)return!1;var r=this.atlasInfo.packedInfo,i=a._texture,u=i.width,f=i.height,y=r.width+20,g=r.height+20,_=Math.max(y,g),E=tu?_:y;return(u!==E||f!==E)&&(Z.instance.reset(),!(!(a=this.getAtlas())||!a._texture)&&(tu?(a._texture.initWithSize(E,E),console.info("DynamicAtlas: Resize atlas (PO2)",E,a)):(a._texture.initWithSize(y,g),console.info("DynamicAtlas: Resize atlas",y,g,a)),this.lastAtlasInfo=tf.clone(this.atlasInfo),!0))}}]),e}();z._RF.pop(),z._RF.push({},"2f36c+IsKJAU5s61TqQdaJ6","HybridFileCache",void 0);var tm=GameCore,tS=tm.Events,t_=tm.Configs.GameEngine.HybridFileCache,tE=t_.Enabled,tA=t_.PreviewMode,tw=t_.BuildMode,tb=tm.Utils,tk=tb.Object,tC=tb.Function,tD=tb.Json,tR=globalThis.game,tT=tR.event,tI=tR.storage,tF=tR.getBuildVersion,tM=z.internal.CCON,tL=z.resources,tx=z.Material,tN=z.builtinResMgr,tO=W.instance,tP=tO.downloader,tG=tO.fetchPipeline,tB=function(){function e(){var n=this;u(this,e),this.supportTypes=[],this.bundledFiles={},this.originDownloaders={},this.downloadFile=function(a){return function(r,i,u){var f=n.getCache(a,r);if(f)return u(null,f);var y=n.getDownloader(a);if(!y)return u(new Error("Downloader not found"),null);y(r,i,function(i,f){return i||n.setCache(a,r,f),u(i,f)})}},this.clearCache=function(){tI.setStorageData("HybridFileCache","cachedFiles",void 0),tI.setStorageData("HybridFileCache","cachedExtensions",void 0),tI.updateToWebStorage("HybridFileCache")}}var n,a,f,y,_;return r(e,[{key:"init",value:(_=g(function(){return _ts_generator(this,function(n){switch(n.label){case 0:if(!(tE&&!k))return[3,2];return[4,this.initStorage()];case 1:n.sent(),this.checkCacheVersion(),this.initSupportedTypes(),this.setupOptimalPipelines(),this.saveOriginDownloaders(),this.registerCustomDownloader(),this.setupBundledFiles(),this.listenEvents(),console.info("Hybrid File Cache: Initialized",{supportTypes:this.supportTypes});return[3,3];case 2:tT.emit(tS.BUNDLE_READY);n.label=3;case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"initStorage",value:(y=g(function(){var n;return _ts_generator(this,function(a){switch(a.label){case 0:n=tF().toString();return[4,tI.addStorage("HybridFileCache",{buildVersion:n,cachedFiles:{},cachedBundles:{},cachedExtensions:{}},!0)];case 1:a.sent();return[2]}})}),function(){return y.apply(this,arguments)})},{key:"checkCacheVersion",value:function(){var n=tF().toString(),a=tI.getStorageData("HybridFileCache","buildVersion");tI.setStorageData("HybridFileCache","buildVersion",n),a!==n?this.clearCache():tI.updateToWebStorage("HybridFileCache")}},{key:"initSupportedTypes",value:function(){this.supportTypes=tw.SupportedExtensions}},{key:"setupBundledFiles",value:(f=g(function(){var n,a,r,i,u;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,,4,5]);a=[],r=D(this.supportTypes);try{for(r.s();!(n=r.n()).done;){i=n.value;this.getCachedBundles(i)||a.push(this.downloadBundledFile(i))}}catch(n){r.e(n)}finally{r.f()}u=a.length>0;if(!u)return[3,2];return[4,tC.allSettled(a)];case 1:u=f.sent();f.label=2;case 2:return[4,this.loadBundles()];case 3:f.sent();return[3,5];case 4:tT.emit(tS.BUNDLE_READY);return[7];case 5:return[2]}})}),function(){return f.apply(this,arguments)})},{key:"downloadBundledFile",value:(a=g(function(n){var a,r,i,u,f;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,3,,4]);a=n.replace(".",""),r="./cache/bundle".concat(a.toUpperCase(),".").concat(a);"bundle"===n&&(r="./cache/bundleBUNDLE.json");return[4,fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}})];case 1:i=y.sent();return[4,i.json()];case 2:u=y.sent();this.setBundledCache(n,u);return[3,4];case 3:f=y.sent();console.error("Hybrid File Cache: Downloaded bundled file",{type:n,error:f});return[3,4];case 4:return[2]}})}),function(n){return a.apply(this,arguments)})},{key:"loadBundles",value:(n=g(function(){var n,a,r,i,u,f;return _ts_generator(this,function(y){switch(y.label){case 0:n=this;y.label=1;case 1:y.trys.push([1,7,,8]);if(!this.supportTypes.includes("bundle"))return[2];a=[],r=function(){var r,f;return _ts_generator(this,function(y){r=u[i],f=new Promise(function(a,i){try{var u=n.getBundledCache("bundle","config:".concat(r));if(!u)return i(new Error("Bundle cache not found"));u.base="assets/".concat(r,"/");var f=eo.getBundle(r);f||(f="resources"===r?tL:new W.Bundle),f.init(tD.clone(u)),eo.bundles.add(r,f),n.loadBundleAssets(r,f).then(a).catch(i)}catch(n){console.error("Hybrid File Cache: Load bundle assets",{name:r,error:n}),i(n)}});a.push(f);return[2]})},i=0,u=["internal","main","resources","animation"];y.label=2;case 2:if(!(i<u.length))return[3,5];return[5,_ts_values(r())];case 3:y.sent();y.label=4;case 4:i++;return[3,2];case 5:return[4,tC.allSettled(a)];case 6:y.sent();return[3,8];case 7:f=y.sent();console.error("Hybrid File Cache: loadBundleAssets",{error:f});return[3,8];case 8:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"loadBundleAssets",value:function(n,a){return new Promise(function(r,i){if("internal"!==n)return r([]);var u=Object.values(a.config.paths.map).map(function(n){return n[0].uuid});if(u.length<1)return r([]);eo.loadAny(u,{},function(n,a){if(n)console.warn("Hybrid File Cache: Load internal assets",{err:n}),i(n);else{var u,f=D(a);try{for(f.s();!(u=f.n()).done;){var y=u.value;tN.addAsset(y.name,y),_instanceof(y,tx)&&tN._materialsToBeCompiled.push(y)}}catch(n){f.e(n)}finally{f.f()}tN.compileBuiltinMaterial()}r(a)})})}},{key:"setupOptimalPipelines",value:function(){var n=this;if(tA.Enabled)tG.insert(function(a,r){a.output=a.input;for(var i=0;i<a.input.length;i++){var u=a.input[i];if(u.uuid&&!u.isNative){var f=n.getCacheExtension(u.uuid);f&&(u.isNative=!0,u.isCached=!0,u.url=u.url.replace(u.ext,f),u.ext=f)}}r()},1),tG.insert(function(a,r){a.output=a.input;for(var i=0;i<a.input.length;i++){var u=a.input[i];u.uuid&&(u.isCached?u.isNative=!1:u.isNative||n.setCacheExtension(u.uuid,u.ext))}r()},3)}},{key:"saveOriginDownloaders",value:function(){var n,a=D(this.supportTypes);try{for(a.s();!(n=a.n()).done;){var r=n.value;this.originDownloaders[r]=tP._downloaders[r]}}catch(n){a.e(n)}finally{a.f()}}},{key:"registerCustomDownloader",value:function(){var n,a=D(this.supportTypes);try{for(a.s();!(n=a.n()).done;){var r=n.value;tP.register(r,this.downloadFile(r))}}catch(n){a.e(n)}finally{a.f()}}},{key:"listenEvents",value:function(){tT.on(tS.SCENE_LOADED,function(){tI.updateToWebStorage("HybridFileCache")}),H.on(i.CLEAR_HYBRID_FILE_CACHE,this.clearCache)}},{key:"getDownloader",value:function(n){var a;return null!==(a=this.originDownloaders[n])&&void 0!==a?a:null}},{key:"getCacheKey",value:function(n,a){var r=a.match(/.*\/([-a-z0-9@]+)\.([^\.]+)$/);if(!r)return null;var i=R(r,3),u=(i[0],i[1]),f=i[2];return!f||n.indexOf(f)<0?null:"".concat(u,":").concat(n)}},{key:"validateDataType",value:function(n,a){Array.isArray(a)&&tk.hasOwn(a[0],"__type__");return!(".cconb"===n&&tk.hasOwn(a,"chunks")&&!(Array.isArray(a.chunks)&&_instanceof(a,tM)))}},{key:"encodeData",value:function(n,a){return".cconb"===n?tk.hasOwn(a,"_document")&&tk.hasOwn(a,"_chunks")?new tM(a._document,a._chunks):null:a}},{key:"decodeData",value:function(n,a){if(".cconb"===n){if(!tk.hasOwn(a,"_document")||!tk.hasOwn(a,"_chunks"))return null;var r,i=[],u=D(a._chunks);try{for(u.s();!(r=u.n()).done;){var f=r.value;_instanceof(f,Uint8Array)?i.push(f):i.push(new Uint8Array(Object.values(f)))}}catch(n){u.e(n)}finally{u.f()}return new tM(a._document,i)}return a}},{key:"setCache",value:function(n,a,r){var i=this.getCacheKey(n,a);if(i&&this.validateDataType(n,r)){var u=this.encodeData(n,r);tI.setStorageData("HybridFileCache","cachedFiles",T({},i,u))}}},{key:"getCache",value:function(n,a){var r=this.getCacheKey(n,a);if(!r)return null;var i=this.getFileCaches()[r];return i||(i=this.getBundledCache(n,r)),i?this.decodeData(n,i):null}},{key:"getFileCaches",value:function(){return tI.getStorageData("HybridFileCache","cachedFiles")}},{key:"getCachedBundles",value:function(n){var a=tI.getStorageData("HybridFileCache","cachedBundles");if(!a)return null;var r=tD.clone(a[n]);return r?(this.bundledFiles[n]=r,r):null}},{key:"getBundledCache",value:function(n,a){var r,i=this.bundledFiles[n];return i&&null!==(r=i[a.replace(":".concat(n),"")])&&void 0!==r?r:null}},{key:"setBundledCache",value:function(n,a){var r=tD.clone(a);this.bundledFiles[n]=r,tI.setStorageData("HybridFileCache","cachedBundles",T({},n,r))}},{key:"getCacheExtension",value:function(n){return this.getCachedExtensions()[n]}},{key:"setCacheExtension",value:function(n,a){tI.setStorageData("HybridFileCache","cachedExtensions",T({},n,a))}},{key:"getCachedExtensions",value:function(){return tI.getStorageData("HybridFileCache","cachedExtensions")}}]),e}();z._RF.pop();var tU={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};z._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var tz=GameCore.Events,tH=globalThis.game,tV=tH.event,tq=tH.language,tW=function(){function e(){var n=this;u(this,e),this.handleLanguageChanged=function(){var a=g(function(a){var r;return _ts_generator(this,function(i){r=a.locale;H.emit("update-language",r),n.updateComponentInEditor();return[2]})});return function(n){return a.apply(this,arguments)}}()}var n,i,f;return r(e,[{key:"init",value:function(){var n=this;this.addLanguage("en").then(function(){n.setLanguage("en"),n.listenEvent()})}},{key:"listenEvent",value:function(){tV.on(tz.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(f=g(function(n){var a;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,this.getLangData(n)];case 1:a=r.sent();tq.add(n,a);return[2]}})}),function(n){return f.apply(this,arguments)})},{key:"setLanguage",value:function(n){tq.choose(n)}},{key:"getLangData",value:(i=g(function(n){return _ts_generator(this,function(a){switch(n){case"en":return[2,tU];case"ru":return[2,this.loadLanguageAsync(n)];default:throw new Error("Language ".concat(n," not supported"))}return[2]})}),function(n){return i.apply(this,arguments)})},{key:"loadLanguageAsync",value:(n=g(function(n){var r;return _ts_generator(this,function(i){switch(i.label){case 0:return[4,a.import("db://assets/resources/locales/".concat(n,".json"))];case 1:r=i.sent().default;tq.add(n,r);return[2]}})}),function(a){return n.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();z._RF.pop(),z._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var tj=GameCore,tY=tj.Configs,tQ=tj.Utils,tK=tY.Mockup,tJ=tQ.Number,tZ=globalThis.game.leaderboard,tX=function(){function e(){u(this,e)}var n,a,i,f;return r(e,[{key:"init",value:function(){tK.Leaderboards.Enabled?this.setupLeaderboardsMockup():this.setupLeaderboards()}},{key:"setupLeaderboards",value:(f=g(function(){return _ts_generator(this,function(n){this.setupLeaderboardByConfigs();return[2]})}),function(){return f.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var n=tY.Leaderboards.LeaderboardId;n?(tZ.addLeaderboard({name:I.GLOBAL,type:"global",autoSortRank:!0,leaderboardId:n}),tZ.addLeaderboard({name:I.FRIENDS,type:"friends",autoSortRank:!0,leaderboardId:n})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(i=g(function(){return _ts_generator(this,function(n){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard();return[2]})}),function(){return i.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(a=g(function(){var n,a,r;return _ts_generator(this,function(i){switch(i.label){case 0:n=I.GLOBAL,a=F.GLOBAL;return[4,tZ.createLeaderboardAsync({_id:a,name:n,numberOfLeaders:100})];case 1:r=i.sent();tZ.addLeaderboard({name:n,type:"global",autoSortRank:!0,leaderboardId:r});return[2]}})}),function(){return a.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(n=g(function(){var n,a,r,i,u;return _ts_generator(this,function(f){switch(f.label){case 0:n=I.FRIENDS,a=F.FRIENDS,r=0,i=tK.GameSDK.Player.ConnectedPlayers;i.Enabled&&(r=tJ.random(i.NumOfPlayers));return[4,tZ.createLeaderboardAsync({_id:a,name:n,numberOfLeaders:r})];case 1:u=f.sent();tZ.addLeaderboard({name:n,type:"friends",autoSortRank:!0,leaderboardId:u});return[2]}})}),function(){return n.apply(this,arguments)})}]),e}();z._RF.pop(),z._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var t$=GameCore,t0=t$.Utils,t1=t$.Events,t2=t$.Configs.PerformanceMonitor.FpsTracking,t3=globalThis.game.event,t4=function(){function e(){var n=this;u(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){n.startTraceFps(),j.on(ee.EVENT_AFTER_UPDATE,n.handleLateUpdate)},this.handleLateUpdate=function(){if(n.mark){if(n.fpsTraceDuration-=H.deltaTime,n.fpsTraceDuration<=0&&!n.traceStopped)return n.traceStopped=!0,n.unListenEvents(),n.updateFPS(),void n.mark.stop(n.markName);n.fpsTraceIntervalTimer-=H.deltaTime,n.fpsTraceIntervalTimer>0||(n.fpsTraceIntervalTimer=n.fpsTraceInterval,n.updateFPS(),n.mark.stop(n.markName),n.startTraceFps())}}}return r(e,[{key:"mark",get:function(){return t2.Enabled?t0.Mark:null}},{key:"init",value:function(){var n=t2.TrackingDuration,a=t2.TrackingInterval;this.fpsTraceDuration=null!=n?n:60,this.fpsTraceInterval=null!=a?a:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){t3.catchUp(t1.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){j.off(ee.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var n,a;if(this.mark){var r=this.getFPS(),i=this.getDrawCalls(),u=this.getDeviceRender(),f=this.getTextureMemory();this.minFps=Math.min(null!==(n=this.minFps)&&void 0!==n?n:r,r),this.maxFps=Math.max(null!==(a=this.maxFps)&&void 0!==a?a:0,r),this.mark.putMetric(this.markName,"FPS Metric",r),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",u),this.mark.putAttr(this.markName,"Draw Calls",i.toString()),this.mark.putAttr(this.markName,"Texture Memory",f.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(r," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(i,", texture memory: ").concat(f.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!j.root)return 0;var n=j.root.fps;return Math.floor(n)||0}},{key:"getDrawCalls",value:function(){return j.root&&j.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return j.root&&j.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return j.root&&j.root.device.memoryStatus.textureSize/1048576||0}}]),e}();z._RF.pop(),z._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var t5=GameCore.Events,t6=globalThis.game.event,t8=function(){function e(){u(this,e),this.handleHotReload=function(){H.restart()},this.handleUpdateConfig=function(n){if("Gameplay"===n.type){H.emit(i.GAMEPLAY_UPDATE_CONFIG,n.config);var a=n.id,r=n.type;t6.emit(t5.REMOTE_CONFIG_UPDATED,{id:a,type:r})}}}return r(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){t6.on(t5.REQUEST_HOT_RELOAD,this.handleHotReload),t6.on(t5.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();z._RF.pop(),z._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var t7=function(){function e(){u(this,e)}return r(e,[{key:"init",value:function(){this.initCocosStats(),this.initDynamicAtlas(),this.initHybridFileCache(),console.info("Plugins Manager: Initialized")}},{key:"initLanguages",value:function(){(new tW).init()}},{key:"initCocosStats",value:function(){(new e5).init()}},{key:"initLeaderboards",value:function(){(new tX).init()}},{key:"initRemoteConfig",value:function(){(new t8).init()}},{key:"initDynamicAtlas",value:function(){(new tg).init()}},{key:"initDynamicAssets",value:function(){(new ti).init()}},{key:"initHybridFileCache",value:function(){(new tB).init()}},{key:"initCanvasRecorder",value:function(){(new e4).init()}},{key:"initPerformanceMonitor",value:function(){(new t4).init()}},{key:"initAdaptivePerformance",value:function(){(new e2).init()}}]),e}();z._RF.pop(),z._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var t9=globalThis.game,ne=t9.event,nt=t9.monitorError,nn=GameCore,na=nn.Events,nr=nn.Configs.PerformanceMonitor,ni=nn.Utils.Mark,ns=function(){function e(){var n=this;u(this,e),this.markName="Load Scene",this.testScene={},this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var a=g(function(a){var r,i,u;return _ts_generator(this,function(f){r=a.sceneName,i=a.sceneData,u=n.correctSceneName(r);console.info("Switching",u,null!=i?i:{}),u&&(L.showLoadingFullScreen(u),n.startScene({sceneName:u,sceneData:i}));return[2]})});return function(n){return a.apply(this,arguments)}}(),this.preloadScene=function(a,r){var i=a.sceneName;n.startMeasure(a),j.preloadScene(i,n.onSceneProgress,n.onScenePreloaded(i,r))},this.startMeasure=function(a){if(n.mark){var r=a.sceneName,i=a.startScene;n.queueLoadScene[r]&&(n.mark.putAttr(n.markName,"Canceled","true"),n.stopMeasure(r)),console.groupCollapsed("\uD83D\uDCE6 ".concat(r,": ").concat(i?"start":"preload"," progress")),n.mark.measure(n.markName),n.mark.putAttr(n.markName,"Cancel","false"),n.mark.putAttr(n.markName,"Success","false"),n.mark.putMetric(n.markName,r),n.mark.start(n.markName),n.queueLoadScene[r]=!0}},this.stopMeasure=function(a){n.mark&&n.queueLoadScene[a]&&(n.mark.rmAttr(n.markName,"File"),n.mark.putAttr(n.markName,"Success","true"),n.mark.stop(n.markName),n.queueLoadScene[a]=!1,console.groupEnd())},this.onSceneProgress=function(a,r,i){var u=a/r;n.mark&&n.mark.putAttr(n.markName,"Last File","".concat(i.id," (").concat(i.ext,")"));var f=Math.floor(70*u+30);GameSDK.setLoadingProgress(f)},this.onScenePreloaded=function(n,a){return function(r){r?console.warn("SceneManager.onScenePreloaded",{sceneName:n,error:r}):(a&&a(n,r),ne.emit(na.SCENE_LOADED,{sceneName:n,isPreload:!0}))}},this.onDirectorLoadScene=function(a){return function(r,i){if(r)console.warn("SceneManager.onSceneLoaded",r);else if(null!=i&&i.scene){var u=i.name;n.handleBeforeSceneLaunch(i,a)(),j.once(ee.EVENT_AFTER_SCENE_LAUNCH,n.handleSceneLaunched(u,a))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(a,r){return function(){n.setSceneData(a,null!=r?r:{}),H.emit(i.REQUEST_VIEW_RESIZE),ne.emit(na.SCENE_LOADED,{sceneName:a.name})}},this.handleSceneLaunched=function(a,r){return function(){var i;L.hideLoadingFullScreen(a),x.switchSceneTracking(),null==nt||nt.addMetadata({currentScene:a}),null===(i=n.callbackSwitchScene)||void 0===i||i.call(n,{sceneName:a,sceneData:r}),ne.emit(na.SCENE_LAUNCHED,{sceneName:a})}},this.handleSceneLoaded=function(a){var r=a.sceneName;n.stopMeasure(r)},this.setTestScene=function(a){var r=a.sceneName;n.testScene[r]=!0}}return r(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){ne.catchUp(na.MARK_IS_TEST_SCENE,this.setTestScene),ne.on(na.SWITCH_SCENE,this.switchScene),ne.on(na.PRELOAD_SCENE,this.preloadScene),ne.on(na.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(n){var a=this.getCurrentScene(),r=this.getTestScene();return r&&(null==a?void 0:a.name)!==r?r:a&&n===a.name?null:n}},{key:"startScene",value:function(n){var a=this,r=n.sceneName,i=n.sceneData;this.preloadScene({sceneName:r,startScene:!0},function(n,u){n===r&&(u?console.warn("SceneManager.startScene",{sceneName:r,error:u}):j.loadScene(r,a.onDirectorLoadScene(i)))})}},{key:"mark",get:function(){return nr.LoadResources?ni:null}},{key:"getCurrentScene",value:function(){return j.getScene()}},{key:"getTestScene",value:function(){var n;return null!==(n=Object.keys(this.testScene)[0])&&void 0!==n?n:null}},{key:"onSwitchScene",value:function(n){this.callbackSwitchScene=n}},{key:"setSceneData",value:function(n,a){if(a&&("data"in n||n.scene.attr({data:{}}),"data"in n)){var r=n.data||{};n.scene.attr({data:M(M({},r),a)}),console.info("SceneManager.setSceneData",{sceneName:n.name,sceneData:a,currentData:r})}}}]),e}();z._RF.pop(),z._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var no=globalThis.game,nc=no.event,nu=no.monitorError,nl=GameCore,nh=nl.Events,nd=nl.Utils,nf=nd.Object,nv=nd.Valid,np=function(){function e(){var n=this;u(this,e),this.screens={},this.queueInstantiatingScreens={},this.handleOpenScreen=function(a){var r=a.screenName,i=a.screenData;n.openScreen(r,i)},this.handleCloseScreen=function(a){var r=a.screenName;n.closeScreen(r)},this.handlePreloadScreens=function(){var a=j.getScene();a&&(n.initScreens(a),n.preloadScreens())}}var n,a,i,f;return r(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){nc.on(nh.OPEN_SCREEN,this.handleOpenScreen),nc.on(nh.CLOSE_SCREEN,this.handleCloseScreen),nc.on(nh.PRELOAD_SCREENS,this.handlePreloadScreens)}},{key:"initScreens",value:function(n){var a=n.getComponentsInChildren(N);if(!nv.isFalsy(a)){var r=a.map(function(n){return null==n?void 0:n.node.name}).join(", ");console.info("\uD83D\uDCFA Loaded Screens in ".concat(n.name,": ").concat(r)),this.addScreens(a)}var i=null==n?void 0:n.getComponentInChildren(O);if(i){var u=i.screenKeys.filter(function(n){return!a.some(function(a){return a.node.name===P[n]})});if(!nv.isEmpty(u)){var f=u.map(function(n){return P[n]}).join(", ");console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(n.name,": ").concat(f)),this.addScreenKeys(u,i.node)}}}},{key:"reorderScreens",value:function(){var n=nf.vals(this.screens).filter(function(n){return"ready"===n.state});n.sort(function(n,a){return n.order-a.order});for(var a=0;a<n.length;a++){var r=n[a];r&&(r.order=a,r.comp.node.setSiblingIndex(r.order))}}},{key:"addScreenKeys",value:function(n,a){var r=this;n.forEach(function(n,i){var u=P[n];r.screens[u]&&(r.screens[u].order=i),r.screens[P[n]]={state:"key",parent:a,key:n,order:i}})}},{key:"addScreens",value:function(n){var a=this;n.forEach(function(n,r){a.screens[n.node.name]={state:"ready",comp:n,order:r}})}},{key:"preloadScreens",value:(f=g(function(){var n;return _ts_generator(this,function(a){switch(a.label){case 0:n=nf.vals(this.screens).reduce(function(n,a){if("key"===a.state){var r=G.loadPrefabAsync("screens/".concat(P[a.key]));n.push(r)}return n},[]);return[4,Promise.all(n)];case 1:return[2,a.sent()]}})}),function(){return f.apply(this,arguments)})},{key:"getScreen",value:(i=g(function(n){var a,r,i,u,f,y,g;return _ts_generator(this,function(_){switch(_.label){case 0:a=this.screens[n];if(null==a)return[2,(null==nu||nu.sendException(new Error("ScreenManager.openScreen Screen ".concat(n," not found")),{screenName:n,screens:this.getScreensAsMetadata()}),null)];if("ready"===a.state)return[2,a.comp];console.info("ScreenManager.getScreen","Screen ".concat(n," not found in cache, instantiating it...")),this.queueInstantiatingScreens[n]=!0;r=a.parent,i=a.key,u=a.order;return[4,G.loadPrefabAsync("screens/".concat(P[i]))];case 1:f=_.sent();if(delete this.queueInstantiatingScreens[n],!f)return[2,(null==nu||nu.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(n," prefab...")),{screenName:n,screens:this.getScreensAsMetadata()}),null)];y=ec(f);y.name=n,r.addChild(y),y.active=!1;g=y.getComponent(N);return[2,g?(this.screens[n]={state:"ready",comp:g,order:u},this.reorderScreens(),g):(null==nu||nu.sendException(new Error("ScreenManager.getScreen: Screen ".concat(n," prefab doesn't have BaseScreen component...")),{screenName:n,screens:this.getScreensAsMetadata()}),null)]}})}),function(n){return i.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var n=this;return Object.keys(this.screens).map(function(a){var r=n.screens[a];return r?"ready"===r.state?"".concat(r.comp.node.name,"(loaded)"):"".concat(P[r.key],"(not-loaded)"):null}).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(a=g(function(n,a){var r,i,u;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,3,,4]);if(this.queueInstantiatingScreens[n])return[2];G.setBlockInput(!0);return[4,this.getScreen(n)];case 1:r=f.sent();if(G.setBlockInput(!1),null==r||!r.node)return[2,void console.warn("ScreenManager.openScreen","Screen ".concat(n," not found"))];r.node.active=!0,r.node.setPosition(new eu(0,0,0));i={screenName:n,screenData:a};nc.emit(nh.OPENING_SCREEN,i),x.trackCurrentPage(n,!0),null==nu||nu.addMetadata({currentScreen:n});return[4,B.waitTweenAsync(0)];case 2:f.sent(),r.open(a),nc.emit(nh.OPENED_SCREEN,i);return[3,4];case 3:u=f.sent();console.error("ScreenManager.openScreen",u);return[3,4];case 4:return[2]}})}),function(n,r){return a.apply(this,arguments)})},{key:"closeScreen",value:(n=g(function(n){var a,r,i,u;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,2,,3]);if(this.queueInstantiatingScreens[n])return[2];return[4,this.getScreen(n)];case 1:r=f.sent();if(!r)return[2,void console.warn("ScreenManager.closeScreen","Screen ".concat(n," not found"))];if(null===(a=r.node)||void 0===a||!a.active)return[2];i={screenName:n};nc.emit(nh.CLOSING_SCREEN,i),r.close(),x.trackCurrentPage(n,!1),null==nu||nu.removeMetadata("currentScreen");return[3,3];case 2:u=f.sent();console.error("ScreenManager.closeScreen",u);return[3,3];case 3:return[2]}})}),function(a){return n.apply(this,arguments)})},{key:"closeAllScreens",value:function(){for(var n in this.screens){var a=this.screens[n];a&&"ready"===a.state&&this.closeScreen(n)}}}]),e}();z._RF.pop(),z._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var ny=GameCore,ng=ny.Configs.Core,nm=ny.Events,nS=ny.Plugins.Analytics.Events,n_=globalThis.game,nE=n_.context,nA=n_.storage,nw=n_.event,nb=n_.analytics,nk=n_.monitorError;new(function(){function e(){var n=this;u(this,e),this.coreManager=new eE,this.adsManager=new em,this.sceneManager=new ns,this.screenManager=new np,this.engineManager=new eI,this.layoutManager=new eV,this.playerManager=new eK,this.pluginsManager=new t7,this.handleWhenCoreBoot=function(){console.warn("Corecos System: Core boot",{inited:H.inited,game:H}),H.inited?n.handleCocosInit():H.once(el.EVENT_GAME_INITED,n.handleCocosInit)},this.handleCocosInit=function(){n.coreManager.requestStart()},this.handleWhenCoreStart=function(){n.playerManager.setupDefaultGameData(),console.groupEnd()},this.handleWhenCoreReady=function(){n.initPlugins(),console.groupEnd(),nb.event(nS.LOAD_START),nw.catchUp(nm.BUNDLE_READY,n.processPreStartGame)},this.processPreStartGame=function(){nw.once(nm.SCENE_LAUNCHED,n.handleBootSceneLaunched),n.runBootScene()},this.handleBootSceneLaunched=function(){ng.StartSDKAfterLoadGame?nw.once(nm.SCENE_LOADED,n.handleStartGameWhenMainSceneReady):n.processStartGame()},this.preloadScenes=function(){"solo"===nA.getStorageData("context","sessionContextType")?U.preloadDashboardScene():U.preloadGameScene()},this.handleStartGameWhenMainSceneReady=function(){n.processStartGame()},this.handleSwitchScene=function(a){var r=a.sceneName,i=n.sceneManager.getCurrentScene();(null==i?void 0:i.name)===r&&i&&(n.screenManager.closeAllScreens(),n.screenManager.clearScreens(),n.screenManager.initScreens(i),n.screenManager.preloadScreens(),console.groupEnd())},this.startProcessContextData=g(function(){var a;return _ts_generator(this,function(r){switch(r.label){case 0:nb.event(nS.APP_READY);r.label=1;case 1:r.trys.push([1,3,4,5]);n.playerManager.requestConnectedPlayers();return[4,nE.processContextData()];case 2:r.sent();return[3,5];case 3:a=r.sent();console.error("startProcessContextData",a),_instanceof(a,Error)&&(null==nk||nk.sendException(a));return[3,5];case 4:nw.emit(nm.GAME_READY);return[7];case 5:return[2]}})}),console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.initManagers(),this.listenEvents(),console.groupEnd()}var n,a;return r(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"runBootScene",value:function(){nw.once(nm.SCENE_LOADED,this.preloadScenes),U.switchScene(f.BOOT_SCENE)}},{key:"processStartGame",value:(a=g(function(){return _ts_generator(this,function(n){switch(n.label){case 0:console.groupEnd(),nb.event(nS.LOAD_COMPLETE);return[4,this.startGameAsync()];case 1:n.sent(),nw.catchUp(nm.PLAYER_INFO_LOADED,this.startProcessContextData);return[2]}})}),function(){return a.apply(this,arguments)})},{key:"startGameAsync",value:(n=g(function(){var n;return _ts_generator(this,function(a){switch(a.label){case 0:a.trys.push([0,2,,3]);return[4,GameSDK.startGameAsync()];case 1:a.sent();return[3,3];case 2:n=a.sent();console.warn("GameSDK.startGameAsync",n),_instanceof(n,Error)&&(null==nk||nk.sendException(n));return[3,3];case 3:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),z._RF.pop()}}});(function(n){n("virtual:///prerequisite-imports/systems","chunks:///systems.js")})(function(n,a){System.register(n,[a],function(n,a){return{setters:[function(a){var r={};for(var i in a)if("default"!==i&&"__esModule"!==i)r[i]=a[i];n(r)}],execute:function(){}}})});