function _array_like_to_array(e,t){if(null==t||t>e.length)t=e.length;for(var r=0,c=new Array(t);r<t;r++)c[r]=e[r];return c}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function _assert_this_initialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function asyncGeneratorStep(e,t,r,c,l,_,h){try{var d=e[_](h);var y=d.value}catch(e){r(e);return}if(d.done)t(y);else Promise.resolve(y).then(c,l)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise(function(c,l){var _=e.apply(t,r);function _next(e){asyncGeneratorStep(_,c,l,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(_,c,l,_next,_throw,"throw",e)}_next(void 0)})}}function _class_call_check(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _construct(){_construct=_is_native_reflect_construct()?Reflect.construct:function construct(e,t,r){var c=[null];c.push.apply(c,t);var l=Function.bind.apply(e,c);var _=new l;if(r)_set_prototype_of(_,r.prototype);return _};return _construct.apply(null,arguments)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var c=t[r];c.enumerable=c.enumerable||false;c.configurable=true;if("value"in c)c.writable=true;Object.defineProperty(e,c.key,c)}}function _create_class(e,t,r){if(t)_defineProperties(e.prototype,t);if(r)_defineProperties(e,r);return e}function _define_property(e,t,r){if(t in e)Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true});else e[t]=r;return e}function _get(e,t,r){_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function get(e,t,r){var c=_super_prop_base(e,t);if(!c)return;var l=Object.getOwnPropertyDescriptor(c,t);if(l.get)return l.get.call(r||e);return l.value};return _get(e,t,r||e)}function _get_prototype_of(e){_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)};return _get_prototype_of(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)_set_prototype_of(e,t)}function _instanceof(e,t){if(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance])return!!t[Symbol.hasInstance](e);return e instanceof t}function _is_native_function(e){return -1!==Function.toString.call(e).indexOf("[native code]")}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var c=[];var l=true;var _=false;var h,d;try{for(r=r.call(e);!(l=(h=r.next()).done);l=true){c.push(h.value);if(t&&c.length===t)break}}catch(e){_=true;d=e}finally{try{if(!l&&null!=r.return)r.return()}finally{if(_)throw d}}return c}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};var c=Object.keys(r);if("function"==typeof Object.getOwnPropertySymbols)c=c.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}));c.forEach(function(t){_define_property(e,t,r[t])})}return e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);if(t)c=c.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable});r.push.apply(r,c)}return r}function _object_spread_props(e,t){t=null!=t?t:{};if(Object.getOwnPropertyDescriptors)Object.defineProperties(e,Object.getOwnPropertyDescriptors(t));else ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))});return e}function _possible_constructor_return(e,t){if(t&&("object"===_type_of(t)||"function"==typeof t))return t;return _assert_this_initialized(e)}function _set_prototype_of(e,t){_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(e,t){e.__proto__=t;return e};return _set_prototype_of(e,t)}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _super_prop_base(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=_get_prototype_of(e);if(null===e)break}return e}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,t){if(!e)return;if("string"==typeof e)return _array_like_to_array(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor)r=e.constructor.name;if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _array_like_to_array(e,t)}function _wrap_native_super(e){var t="function"==typeof Map?new Map:void 0;_wrap_native_super=function wrapNativeSuper(e){if(null===e||!_is_native_function(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_get_prototype_of(this).constructor)}Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _set_prototype_of(Wrapper,e)};return _wrap_native_super(e)}function _is_native_reflect_construct(){if("undefined"==typeof Reflect||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if("function"==typeof Proxy)return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _create_super(e){var t=_is_native_reflect_construct();return function _createSuperInternal(){var r=_get_prototype_of(e),c;if(t){var l=_get_prototype_of(this).constructor;c=Reflect.construct(r,arguments,l)}else c=r.apply(this,arguments);return _possible_constructor_return(this,c)}}function _ts_generator(e,t){var r,c,l,_,h={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return _={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(_[Symbol.iterator]=function(){return this}),_;function verb(e){return function(t){return step([e,t])}}function step(_){if(r)throw new TypeError("Generator is already executing.");while(h)try{if(r=1,c&&(l=2&_[0]?c.return:_[0]?c.throw||((l=c.return)&&l.call(c),0):c.next)&&!(l=l.call(c,_[1])).done)return l;if(c=0,l)_=[2&_[0],l.value];switch(_[0]){case 0:case 1:l=_;break;case 4:h.label++;return{value:_[1],done:false};case 5:h.label++;c=_[1];_=[0];continue;case 7:_=h.ops.pop();h.trys.pop();continue;default:if(l=h.trys,!(l=l.length>0&&l[l.length-1])&&(6===_[0]||2===_[0])){h=0;continue}if(3===_[0]&&(!l||_[1]>l[0]&&_[1]<l[3])){h.label=_[1];break}if(6===_[0]&&h.label<l[1]){h.label=l[1];l=_;break}if(l&&h.label<l[2]){h.label=l[2];h.ops.push(_);break}if(l[2])h.ops.pop();h.trys.pop();continue}_=t.call(e,h)}catch(e){_=[6,e];c=0}finally{r=l=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:true}}}var ur=Object.defineProperty;var yr=function(e,t,r){return t in e?ur(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r};var u=function(e,t,r){return yr(e,(void 0===t?"undefined":_type_of(t))!="symbol"?t+"":t,r)};System.register(["./bundle/core.js"],function(e,t){"use strict";var r,c,l,_,h,d,y;return{setters:[function(e){r=e.G,c=e.P,l=e.M,_=e._,h=e.a,d=e.C,y=e.w}],execute:function execute(){var f=r.Utils,p=f.Valid,v=f.Object,g=f.String,m=f.Json,A="is invalid",I=function(){function Z(e){_class_call_check(this,Z);this.defaultData(),this.processData(e)}_create_class(Z,[{key:"processData",value:function processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}},{key:"defaultData",value:function defaultData(){var e=this.constructor,t=e.name;this.lazyDefaultData(Z.data[t])}},{key:"lazyDefaultData",value:function lazyDefaultData(e){p.isObject(e)||this.exception("data",A);for(var t in e)if(v.hasOwn(e,t)){var r=e[t];v.assign(this,_define_property({},t,r))}}},{key:"lazyValidateStructure",value:function lazyValidateStructure(e){p.isObject(e)||this.exception("structure","is not object");var t=this.getKeys();var r=true,c=false,l=void 0;try{for(var _=t[Symbol.iterator](),h;!(r=(h=_.next()).done);r=true){var d=h.value;var y=this[d];void 0===y&&this.exception("structure","has no key ".concat(d)),v.hasOwn(e,d)||void 0===y||this.setDefaultData(d,e)}}catch(e){c=true;l=e}finally{try{if(!r&&null!=_.return)_.return()}finally{if(c)throw l}}}},{key:"setDefaultData",value:function setDefaultData(e,t){p.isObject(t)||this.exception("data",A);var r=this[e];void 0===r&&this.exception("default","has no key ".concat(e)),v.assign(t,_define_property({},e,r))}},{key:"lazyValidateData",value:function lazyValidateData(e){var t=this.getKeys();var r=true,c=false,l=void 0;try{for(var _=t[Symbol.iterator](),h;!(r=(h=_.next()).done);r=true){var d=h.value;var y=e[d],f=g.removeDiacritics(d).replace(/[^a-zA-Z0-9]/g,""),p="validate".concat(g.capitalize(f)),v=this[p];if("function"==typeof v)try{v.call(this,y)}catch(t){this.setDefaultData(d,e)}else this.exception("validate","has no function ".concat(p))}}catch(e){c=true;l=e}finally{try{if(!r&&null!=_.return)_.return()}finally{if(c)throw l}}}},{key:"lazySetupData",value:function lazySetupData(e){var t=this.getKeys();var r=true,c=false,l=void 0;try{for(var _=t[Symbol.iterator](),h;!(r=(h=_.next()).done);r=true){var d=h.value;var y=e[d];v.assign(this,_define_property({},d,y))}}catch(e){c=true;l=e}finally{try{if(!r&&null!=_.return)_.return()}finally{if(c)throw l}}}},{key:"validate",value:function validate(){this.validateData(this.toObject())}},{key:"exception",value:function exception(e,t){throw new Error("".concat(this.constructor.name,": ").concat(e," ").concat(t))}},{key:"toObject",value:function toObject(){return Object.fromEntries(Object.entries(this).filter(function(e){var t=_sliced_to_array(e,1),r=t[0];return"toObject"!==r}))}},{key:"getKeys",value:function getKeys(){return Object.keys(this).filter(function(e){return"toObject"!==e})}}],[{key:"addDefaultData",value:function addDefaultData(e){p.isObject(e)||this.prototype.exception("default data",A),e=m.clone(e);var t=this,r=t.name;p.isObject(Z.data[r])||(Z.data[r]={}),Z.data[r]=v.merge(Z.data[r],e)}},{key:"getDefaultData",value:function getDefaultData(){var e=this,t=e.name;return m.clone(Z.data[t])}},{key:"addValidateFunction",value:function addValidateFunction(e,t){p.isString(e)||this.prototype.exception("validate key",A),"function"!=typeof t&&this.prototype.exception("validate function",A);var r="validate".concat(g.capitalize(e));v.assign(this.prototype,_define_property({},r,t))}}]);return Z}();u(I,"data",{});var E=I;r.Dtos={Base:E};var x={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded"},C={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},N=r.Utils,T=N.Valid,L=C.playerId,O=C.name,F=C.photo,G=C.locale,V="is invalid";var H=function(e){_inherits(_t,e);var t=_create_super(_t);function _t(){_class_call_check(this,_t);return t.apply(this,arguments)}_create_class(_t,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){T.isString(e)&&e||this.exception("_id",V)}},{key:"validatePlayerId",value:function validatePlayerId(e){T.isString(e)&&e||this.exception("playerId",V)}},{key:"validateName",value:function validateName(e){T.isString(e)&&e||this.exception("name",V)}},{key:"validatePhoto",value:function validatePhoto(e){T.isString(e)||this.exception("photo",V)}},{key:"validateLocale",value:function validateLocale(e){T.isString(e)&&e||this.exception("locale",V)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(_t.prototype),"toObject",this).call(this)}}]);return _t}(E);H.addDefaultData({playerId:L,name:O,photo:F,locale:G});var K=new H({playerId:"10",name:"Your Friend"}).toObject();var q=function(e){_inherits(J,e);var t=_create_super(J);function J(e){_class_call_check(this,J);var r;r=t.call(this,e);u(_assert_this_initialized(r),"code");r.code="CREATE_MATCH_FAILED";return r}return J}(_wrap_native_super(Error));var Q=function(e){_inherits(D,e);var t=_create_super(D);function D(e){_class_call_check(this,D);var r;r=t.call(this,e),r.name="PlayerIdNotValid",r.message=null!=e?e:"Player id is not valid";return _possible_constructor_return(r)}return D}(q);var $=r.Dtos,X=r.Utils,et=r.Events,er=X.Array,en=X.Object,eo=(X.Json,X.Valid);var Js=function Js(e){var t=this;_class_call_check(this,Js);u(this,"game");u(this,"initContext",function(){var e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},r=new $.Context.Info(e),c=r.toObject(),l=c.contextId,_=c.contextType,h=c.entryPointData;t.game.context.receiveContext(l,_,h)});var r=this;u(this,"initPlayer",_async_to_generator(function(){var e,t,c,l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:e=r.game,t=e.player,c=r.getPlayerInfo(),l=er.unique(en.vals(x));return[4,GameSDK.player.getDataAsync(l)];case 1:_=d.sent(),h=new $.Player.Data(_).toObject();t.receiveData(c,h),r.game.event.emit(et.PLAYER_INFO_LOADED);return[2]}})}));u(this,"getPlayerInfo",function(){try{var e=GameSDK.player.getID();var t=GameSDK.player.getName();var r=GameSDK.player.getPhoto(),c=GameSDK.getLocale();if(!eo.isString(e))throw new Q;return eo.isString(t)||(t="You"),new $.Player.Info({playerId:e,name:t,photo:r,locale:c}).toObject()}catch(e){return K}});this.game=e};var ec=function(e){_inherits(te,e);var t=_create_super(te);function te(e,r){_class_call_check(this,te);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.name="BadRequest",c.message=null!=e?e:"This request is bad",c.payload=r;return c}return te}(_wrap_native_super(Error));var eu=function(e){_inherits(ee,e);var t=_create_super(ee);function ee(e,r){_class_call_check(this,ee);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.name="RequestTimeout",c.message=null!=e?e:"This request is timeout",c.payload=r;return c}return ee}(_wrap_native_super(Error));var el=r.Utils,e_=r.Configs,eh=e_.AppId,ed=e_.Network,Xs=function(e){if(!e.ok)throw new ec(void 0,{response:e})},Ve=function(){var e=window.game.auth.getToken();return{token:e,timeout:ed.Timeout,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},ke=function(e,t,c,l){return _async_to_generator(function(){var _,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:p.trys.push([0,3,,4]);if(!eh)throw new ec("AppId is not defined");_="".concat(e,"/apps/").concat(eh,"/").concat(t),h=new AbortController;c.signal=h.signal;d=setTimeout(function(){h.abort()},c.timeout);r.Utils.Valid.isObject(l)&&(c.body=JSON.stringify(l));return[4,fetch(_,c)];case 1:y=p.sent();clearTimeout(d),Xs(y);return[4,y.json()];case 2:return[2,p.sent()||{}];case 3:f=p.sent();if(_instanceof(f,ec))return[2,null];throw _instanceof(f,Object)&&"name"in f&&"AbortError"===f.name?new eu:f;case 4:return[2]}})})},ey=function(){var e=_async_to_generator(function(e,t){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,1,,7]);return[2,e()];case 1:r=c.sent();if(!(_instanceof(r,eu)&&t>0))return[3,6];c.label=2;case 2:c.trys.push([2,5,,6]);return[4,el.Time.sleepAsync(600)];case 3:c.sent();return[4,ey(e,t-1)];case 4:return[2,c.sent()];case 5:c.sent();return[2,{}];case 6:return[2,_instanceof(r,eu)?{}:{}];case 7:return[2]}})});return function ae(t,r){return e.apply(this,arguments)}}(),ef=function(){var e=_async_to_generator(function(e,t,r){var c,l,_;var h=arguments;return _ts_generator(this,function(d){switch(d.label){case 0:c=h.length>3&&void 0!==h[3]?h[3]:ed.Retries;d.label=1;case 1:d.trys.push([1,3,,4]);l=_object_spread_props(_object_spread({},Ve(),t),{method:"GET"}),_=ke(r,e,l);return[4,ey(_,c)];case 2:return[2,d.sent()];case 3:d.sent();return[2,{}];case 4:return[2]}})});return function lt(t,r,c){return e.apply(this,arguments)}}(),ep=function(){var e=_async_to_generator(function(e,t,r,c){var l,_,h;var d=arguments;return _ts_generator(this,function(y){switch(y.label){case 0:l=d.length>4&&void 0!==d[4]?d[4]:ed.Retries;y.label=1;case 1:y.trys.push([1,3,,4]);_=_object_spread_props(_object_spread({},Ve(),r),{method:"POST"}),h=ke(c,e,_,t);return[4,ey(h,l)];case 2:return[2,y.sent()];case 3:y.sent();return[2,{}];case 4:return[2]}})});return function R(t,r,c,l){return e.apply(this,arguments)}}(),ev=r.Configs,eg=ev.Notification,em=eg.ApiUrl,eA=r.Utils,ew=eA.Object,eb=function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!ew.hasOwn(e,"playerId"))throw new Error("Missing playerId");t=e.playerId;return[4,ep("players/".concat(t),e,{},em,10)];case 1:r.sent();return[2]}})});return function ea(t){return e.apply(this,arguments)}}();var eI=function(e){return e.IDLE="idle",e.LOADING="loading",e.FILLED="filled",e.SHOWING="showing",e}(eI||{}),ek=function(e){return e.BANNER="banner",e.INTERSTITIAL="interstitial",e.REWARDED_VIDEO="rewarded_video",e.REWARDED_INTERSTITIAL="rewarded_interstitial",e}(ek||{});var eS=function(e){_inherits(Tt,e);var t=_create_super(Tt);function Tt(e,r){_class_call_check(this,Tt);var c;c=t.call(this,r);u(_assert_this_initialized(c),"code");c.code=e,c.message=r;return c}return Tt}(_wrap_native_super(Error));var eD=function(){function sa(e,t){_class_call_check(this,sa);u(this,"type");u(this,"placementId");u(this,"_status");this.type=e,this._status=eI.IDLE,this.placementId=t}_create_class(sa,[{key:"setStatus",value:function setStatus(e){this._status!==e&&(this._status=e)}},{key:"status",get:function get(){return this._status}},{key:"exception",value:function exception(e){throw new eS("AD_INSTANCE_ERROR",e)}}]);return sa}();var eP=function(e){_inherits(Ue,e);var t=_create_super(Ue);function Ue(){_class_call_check(this,Ue);return t.apply(this,arguments)}_create_class(Ue,[{key:"loadAsync",value:function loadAsync(){this.exception("This method is not implemented")}},{key:"showAsync",value:function showAsync(){this.exception("This method is not implemented")}},{key:"hideAsync",value:function hideAsync(){this.exception("Unsupported method")}}]);return Ue}(eD);r.Plugins.Ads={Types:ek,Status:eI,AdError:eS,AdInstance:eP};var eE=r.Utils,ex=eE.Array,eC=eE.Object;var eN=function(e){_inherits(na,e);var t=_create_super(na);function na(){_class_call_check(this,na);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"enabled");u(_assert_this_initialized(e),"config");u(_assert_this_initialized(e),"lastCallAdShownTime");u(_assert_this_initialized(e),"isAdFullSizeShowed");u(_assert_this_initialized(e),"ads",{});u(_assert_this_initialized(e),"safeAreaBottom");return e}_create_class(na,[{key:"init",value:function init(){var e;this.lastCallAdShownTime=(e={},_define_property(e,ek.BANNER,0),_define_property(e,ek.INTERSTITIAL,0),_define_property(e,ek.REWARDED_VIDEO,0),_define_property(e,ek.REWARDED_INTERSTITIAL,0),e),this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}},{key:"calculateSafeAreaBottom",value:function calculateSafeAreaBottom(){try{var e=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=Number.parseInt(e,10),Number.isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch(e){this.safeAreaBottom=0}}},{key:"configure",value:function configure(e){this.config=e,this.enabled=this.config.Enabled}},{key:"checkEnabled",value:function checkEnabled(){if(!this.enabled)throw new eS("ADS_NOT_ENABLED","Ads is't enabled")}},{key:"isAdFullSizeShowing",value:function isAdFullSizeShowing(){return this.isAdFullSizeShowed}},{key:"setAdInstance",value:function setAdInstance(e,t,r){this.ads[t]||(this.ads[t]={type:e,placementId:t,interval:null,instance:new r(e,t)})}},{key:"loadAdAsync",value:function loadAdAsync(e,t){var r=this;return _async_to_generator(function(){return _ts_generator(this,function(c){switch(c.label){case 0:r.checkEnabled();return[4,r.getAd(e,t).instance.loadAsync()];case 1:c.sent();return[2]}})})()}},{key:"showAdAsync",value:function showAdAsync(e,t){var c=this;return _async_to_generator(function(){var l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:c.checkEnabled();l=c.game,_=l.event,h=c.getAd(e,t);c.lastCallAdShownTime[e]=window.performance.now()/1e3;d.label=1;case 1:d.trys.push([1,,3,4]);_.emit(r.Events.AD_SHOWING,{placementId:t}),c.isAdFullSizeShowed=!0;return[4,h.instance.showAsync()];case 2:d.sent();return[3,4];case 3:_.emit(r.Events.AD_CLOSED,{placementId:t}),c.isAdFullSizeShowed=!1;return[7];case 4:return[2]}})})()}},{key:"getAdStatus",value:function getAdStatus(e,t){return this.checkEnabled(),this.getAd(e,t).instance.status}},{key:"getAd",value:function getAd(e,t){var r=null;if(t?r=this.getAdByPlacementId(t):r=this.getPriorityAdByType(e),!r)throw new eS("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return r}},{key:"getAdsByType",value:function getAdsByType(e){return eC.vals(this.ads).filter(function(t){return t.type===e})}},{key:"getAdByPlacementId",value:function getAdByPlacementId(e){var t=this.ads[e];return t||null}},{key:"getPriorityAdByType",value:function getPriorityAdByType(e){var t=this.getAdsByType(e);if(!t.length)return null;var r=ex.search(t,function(t){return t.type===e});return r||null}},{key:"canbeShowInterstitialAd",value:function canbeShowInterstitialAd(e){return this.canbeShowInterstitialAdByTime(e)}},{key:"canbeShowInterstitialAdByTime",value:function canbeShowInterstitialAdByTime(e){try{var t=window.performance.now()/1e3;var r;if(e)r=this.getCommonAdConfig(e);else{var c=this.getPriorityAdByType(ek.INTERSTITIAL);if(!c)return!1;r=this.getCommonAdConfig(c.placementId)}var l=r.SecondsBetweenAds,_=r.SecondsFirstTime,h=t-this.lastCallAdShownTime[ek.INTERSTITIAL],d=h>l,y=h>_;return this.lastCallAdShownTime[ek.INTERSTITIAL]>0?d:y}catch(e){return!1}}},{key:"canbeShowBannerAd",value:function canbeShowBannerAd(e){try{var t=this.getBannerConfig(e),r=t.Platform;if("ALL"===r)return!0;var c=GameSDK.getPlatform();return!!c&&c===r}catch(e){return!1}}},{key:"showBannerAdAsync",value:function showBannerAdAsync(e){var t=this;return _async_to_generator(function(){var c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:t.checkEnabled();c=t.getAd(ek.BANNER,e);if(!t.canbeShowBannerAd(c.placementId))throw new Error("Banner ad can not be shown");t.cleanBannerReloadTimer(c.placementId);return[4,c.instance.showAsync()];case 1:y.sent();l=t.game,_=l.event;if(_.emit(r.Events.AD_SHOWING,{placementId:e}),"MsGames"===GameSDK.getSDKName())return[2];h=t.getBannerConfig(c.placementId),d=h.SecondsReload;d<=0||(c.interval=setTimeout(function(){t.showBannerAdAsync(c.placementId)},1e3*d));return[2]}})})()}},{key:"hideBannerAdAsync",value:function hideBannerAdAsync(e){var t=this;return _async_to_generator(function(){var c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:t.checkEnabled();c=t.getAd(ek.BANNER,e);t.cleanBannerReloadTimer(c.placementId);return[4,c.instance.hideAsync()];case 1:h.sent();l=t.game,_=l.event;_.emit(r.Events.AD_CLOSED,{placementId:e});return[2]}})})()}},{key:"cleanBannerReloadTimer",value:function cleanBannerReloadTimer(e){try{var t=this.getAd(ek.BANNER,e),r=t.interval;if(!r)return;clearInterval(r)}catch(e){}}},{key:"getCommonAdConfig",value:function getCommonAdConfig(e){var t=_to_consumable_array(this.config.InterstitialAdOptions).concat(_to_consumable_array(this.config.RewardedVideoAdOptions)),r=ex.search(t,function(t){return t.PlacementId===e});if(!r)throw new Error("Ad config with placementId ".concat(e," not found"));return r}},{key:"getBannerConfig",value:function getBannerConfig(e){var t=ex.search(this.config.BannerDisplayAdOptions,function(t){return t.PlacementId===e});if(!t)throw new Error("Banner config with placementId ".concat(e," not found"));return t}},{key:"getBannerHeight",value:function getBannerHeight(e,t,r){var c=!(arguments.length>2)||void 0===r||r;this.checkEnabled();var l=this.getBannerConfig(e),_=GameSDK.getBannerHeight(l);return c?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(_+this.safeAreaBottom)*t):_*t}},{key:"getSafeAreaBottom",value:function getSafeAreaBottom(e){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*e}}]);return na}(c.Plugins.BasePlugin);var eT={ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",MESSAGE:"message",INVITE:"invite",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_SHOWING:"ad_showing",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GET_FREE_ITEM:"get_free_item",USE_ITEM:"use_item",EARN_ITEM:"earn_item"},eL=r.Utils,eM=eL.String,eO=eL.Valid;var eR=function(){function oa(e,t,r){_class_call_check(this,oa);u(this,"game");u(this,"name");u(this,"color");u(this,"options");u(this,"selfLog");u(this,"currentPath");this.game=e,this.name=t,this.options=r,this.color=r.color||"#FFF",this.selfLog=r.log,this.currentPath="/"}_create_class(oa,[{key:"event",value:function event(e,t){this.logInfo("event",{name:e,payload:t});var r=this.formatEventName(e);this.processEvent(r,t)}},{key:"logInfo",value:function logInfo(e,t){this.selfLog}},{key:"pageview",value:function pageview(e){var t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),document.title=t,this.event(eT.PAGE_VIEW,{path_path:e,page_title:t})}},{key:"levelStart",value:function levelStart(e,t,r){this.event(eT.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e),game_mode:r?eM.toUpperCamelCase(r):void 0})}},{key:"levelFail",value:function levelFail(e,t,r){this.event(eT.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e),game_mode:r?eM.toUpperCamelCase(r):void 0})}},{key:"levelRescue",value:function levelRescue(e,t,r){this.event(eT.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e),game_mode:r?eM.toUpperCamelCase(r):void 0})}},{key:"levelComplete",value:function levelComplete(e,t,r){this.event(eT.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e),game_mode:r?eM.toUpperCamelCase(r):void 0})}},{key:"loadAdEvent",value:function loadAdEvent(e,t){this.event(eT.AD_LOAD,{ad_type:e,screen_name:t})}},{key:"showAdEvent",value:function showAdEvent(e,t){this.event(eT.AD_SHOW,{ad_type:e,screen_name:t})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}},{key:"showInterstitialAd",value:function showInterstitialAd(e){this.showAdEvent("interstitial",e)}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}},{key:"receiveVideoReward",value:function receiveVideoReward(e){this.event(eT.AD_REWARD,{screen_name:e})}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(e){this.loadAdEvent("rewarded_interstitial",e)}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(e){this.showAdEvent("rewarded_interstitial",e)}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(e){this.event(eT.AD_REWARD,{screen_name:e})}},{key:"loadAdFail",value:function loadAdFail(e,t){this.event(eT.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}},{key:"showAdFail",value:function showAdFail(e,t){this.event(eT.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}},{key:"showingAd",value:function showingAd(e,t){this.event(eT.AD_SHOWING,{ad_type:e,screen_name:t})}},{key:"formatEventName",value:function formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(eM.padStart(e.toString(),5,"0"))}},{key:"getPageTitle",value:function getPageTitle(e){var t=e.split("/").pop();if(!eO.isString(t))return e;var r=t.replace(/([-_\s.])/g," $1");return eM.toUpperCamelCase(r)}},{key:"addGameModeToPageTitle",value:function addGameModeToPageTitle(e){var t=this.game,r=t.match,c=r.getMatchState();var l=c.mode;return l||(l="Normal"),"".concat(eM.toUpperCamelCase(l),"::").concat(e)}}]);return oa}();r.Plugins.Analytics={Events:eT,BaseAnalytics:eR};var eF=function(e){_inherits(ra,e);var t=_create_super(ra);function ra(){_class_call_check(this,ra);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"analytics",[]);u(_assert_this_initialized(e),"placement","unknown");u(_assert_this_initialized(e),"pageview",function(t){if(!e.isActive())return;e.placement=t;var r=e.getPageByKey(t);var c=true,l=false,_=void 0;try{for(var h=e.analytics[Symbol.iterator](),d;!(c=(d=h.next()).done);c=true){var y=d.value;y.pageview(r)}}catch(e){l=true;_=e}finally{try{if(!c&&null!=h.return)h.return()}finally{if(l)throw _}}});return e}_create_class(ra,[{key:"add",value:function add(e){this.analytics.some(function(t){return t.name===e.name})||this.analytics.push(e)}},{key:"isActive",value:function isActive(){return this.analytics.length>=1}},{key:"event",value:function event(e,t){var r=true,c=false,l=void 0;if(this.isActive())try{for(var _=this.analytics[Symbol.iterator](),h;!(r=(h=_.next()).done);r=true){var d=h.value;d.event(e,t)}}catch(e){c=true;l=e}finally{try{if(!r&&null!=_.return)_.return()}finally{if(c)throw l}}}},{key:"levelStart",value:function levelStart(e,t,r){var c=true,l=false,_=void 0;if(this.isActive())try{for(var h=this.analytics[Symbol.iterator](),d;!(c=(d=h.next()).done);c=true){var y=d.value;y.levelStart(e,t,r)}}catch(e){l=true;_=e}finally{try{if(!c&&null!=h.return)h.return()}finally{if(l)throw _}}}},{key:"levelRescue",value:function levelRescue(e,t,r){var c=true,l=false,_=void 0;if(this.isActive())try{for(var h=this.analytics[Symbol.iterator](),d;!(c=(d=h.next()).done);c=true){var y=d.value;y.levelRescue(e,t,r)}}catch(e){l=true;_=e}finally{try{if(!c&&null!=h.return)h.return()}finally{if(l)throw _}}}},{key:"levelFail",value:function levelFail(e,t,r){var c=true,l=false,_=void 0;if(this.isActive())try{for(var h=this.analytics[Symbol.iterator](),d;!(c=(d=h.next()).done);c=true){var y=d.value;y.levelFail(e,t,r)}}catch(e){l=true;_=e}finally{try{if(!c&&null!=h.return)h.return()}finally{if(l)throw _}}}},{key:"levelComplete",value:function levelComplete(e,t,r){var c=true,l=false,_=void 0;if(this.isActive())try{for(var h=this.analytics[Symbol.iterator](),d;!(c=(d=h.next()).done);c=true){var y=d.value;y.levelComplete(e,t,r)}}catch(e){l=true;_=e}finally{try{if(!c&&null!=h.return)h.return()}finally{if(l)throw _}}}},{key:"loadInterstitialAd",value:function loadInterstitialAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;_.loadInterstitialAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"showInterstitialAd",value:function showInterstitialAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;_.showInterstitialAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;_.loadRewardedVideoAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;_.showRewardedVideoAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"receiveVideoReward",value:function receiveVideoReward(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;_.receiveVideoReward(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"loadRewardedInterstitialAd",value:function loadRewardedInterstitialAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;_.loadRewardedInterstitialAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"showRewardedInterstitialAd",value:function showRewardedInterstitialAd(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;_.showRewardedInterstitialAd(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"receiveInterstitialReward",value:function receiveInterstitialReward(){var e=true,t=false,r=void 0;if(this.isActive())try{for(var c=this.analytics[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;_.receiveInterstitialReward(this.placement)}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}}},{key:"loadAdFail",value:function loadAdFail(e){var t=true,r=false,c=void 0;if(this.isActive())try{for(var l=this.analytics[Symbol.iterator](),_;!(t=(_=l.next()).done);t=true){var h=_.value;h.loadAdFail(e,this.placement)}}catch(e){r=true;c=e}finally{try{if(!t&&null!=l.return)l.return()}finally{if(r)throw c}}}},{key:"showAdFail",value:function showAdFail(e){var t=true,r=false,c=void 0;if(this.isActive())try{for(var l=this.analytics[Symbol.iterator](),_;!(t=(_=l.next()).done);t=true){var h=_.value;h.showAdFail(e,this.placement)}}catch(e){r=true;c=e}finally{try{if(!t&&null!=l.return)l.return()}finally{if(r)throw c}}}},{key:"showingAd",value:function showingAd(e){var t=true,r=false,c=void 0;if(this.isActive())try{for(var l=this.analytics[Symbol.iterator](),_;!(t=(_=l.next()).done);t=true){var h=_.value;h.showingAd(e,this.placement)}}catch(e){r=true;c=e}finally{try{if(!t&&null!=l.return)l.return()}finally{if(r)throw c}}}},{key:"getPageByKey",value:function getPageByKey(e){var t=e;if(t.indexOf("_")>-1){var r=t.replace(/_/g,"-");return r.toLowerCase()}var c=t.length-1,l="";for(;c>0;){l=t.charAt(c);var _=Number.isNaN(Number.parseInt(l,10)),h=l===l.toUpperCase();_&&h&&(t="".concat(t.slice(0,c),"-").concat(t.slice(c))),c--}return t.toLowerCase()}}]);return ra}(c.Plugins.BasePlugin);var eG=function(){function ca(e){_class_call_check(this,ca);u(this,"key");this.key=e}_create_class(ca,[{key:"getKey",value:function getKey(){return this.key}}]);return ca}();var eU=function(){function la(e){_class_call_check(this,la);u(this,"id");u(this,"isMuteAll");u(this,"masterVolume");u(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}_create_class(la,[{key:"getId",value:function getId(){return this.id}},{key:"getAudioClip",value:function getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}},{key:"setAudioClip",value:function setAudioClip(e,t){this.audioClips[e]=_object_spread({},this.audioClips[e],t)}},{key:"play",value:function play(e,t){var r=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(_){switch(_.label){case 0:c=r.getAudioClip(e);if(!c)return[3,1];l=c.audioPlayer;r.playWithRealConfig(l,t);return[3,3];case 1:return[4,r.loadAndPlay(e,t)];case 2:_.sent();_.label=3;case 3:return[2]}})})()}},{key:"loadAndPlay",value:function loadAndPlay(e,t){var r=this;return _async_to_generator(function(){var c,l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:d.trys.push([0,2,,3]);return[4,r.onLoadAudio(e,t)];case 1:c=d.sent(),l=t||{},_=l.volume,h=void 0===_?1:_;r.setAudioClip(e,{volume:h,audioPlayer:c}),r.playWithRealConfig(c,t);return[3,3];case 2:d.sent();return[3,3];case 3:return[2]}})})()}},{key:"playWithRealConfig",value:function playWithRealConfig(e,t){if(t){var r=t.volume,c=void 0===r?1:r;t.volume=this.masterVolume*c}e.play(t)}},{key:"pause",value:function pause(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.pause(),!0}},{key:"resume",value:function resume(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.resume(),!0}},{key:"stop",value:function stop(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.stop(),!0}},{key:"stopAll",value:function stopAll(){this.callAudioPlayers("stop")}},{key:"muteAll",value:function muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}},{key:"unmuteAll",value:function unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}},{key:"setVolume",value:function setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}},{key:"getVolume",value:function getVolume(){return this.masterVolume}},{key:"queueAudioPlayer",value:function queueAudioPlayer(e,t){try{var r=e.audioPlayer,c=e.volume,l=void 0===c?1:c;switch(t){case"play":r.play();break;case"pause":r.pause();break;case"resume":r.resume();break;case"stop":r.stop();break;case"mute":r.setVolume(0);break;case"unmute":case"setVolume":r.setVolume(this.masterVolume*l);break;default:throw new Error("Unsupported function: ".concat(t))}}catch(e){}}},{key:"callAudioPlayers",value:function callAudioPlayers(e){var t=r.Utils,c=t.Object,l=c.vals(this.audioClips);var _=true,h=false,d=void 0;try{for(var y=l[Symbol.iterator](),f;!(_=(f=y.next()).done);_=true){var p=f.value;this.queueAudioPlayer(p,e)}}catch(e){h=true;d=e}finally{try{if(!_&&null!=y.return)y.return()}finally{if(h)throw d}}}}]);return la}();r.Plugins.Audio={BaseAudioPlayer:eG,BaseChannelManager:eU};var eV=function(e){_inherits(da,e);var t=_create_super(da);function da(){_class_call_check(this,da);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"firstChannelId");u(_assert_this_initialized(e),"channels",{});return e}_create_class(da,[{key:"addChannel",value:function addChannel(e){var t=e.getId();this.channels[t]=e,this.firstChannelId||(this.firstChannelId=t)}},{key:"getChannel",value:function getChannel(e){if(void 0===e)return this.channels[this.firstChannelId];var t=this.channels[e];if(!t)throw new Error("Channel ".concat(e," not found"));return t}},{key:"play",value:function play(e,t,r){var c=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,2,,3]);return[4,c.getChannel(r).play(e,t)];case 1:l.sent();return[3,3];case 2:l.sent();return[3,3];case 3:return[2]}})})()}},{key:"pause",value:function pause(e,t){try{this.getChannel(t).pause(e)}catch(e){}}},{key:"resume",value:function resume(e,t){try{this.getChannel(t).resume(e)}catch(e){}}},{key:"stop",value:function stop(e,t){try{this.getChannel(t).stop(e)}catch(e){}}},{key:"stopAll",value:function stopAll(e){try{this.getChannel(e).stopAll()}catch(e){}}},{key:"mute",value:function mute(e){try{this.getChannel(e).muteAll()}catch(e){}}},{key:"unmute",value:function unmute(e){try{this.getChannel(e).unmuteAll()}catch(e){}}},{key:"setVolume",value:function setVolume(e,t){try{this.getChannel(t).setVolume(e)}catch(e){}}},{key:"getVolume",value:function getVolume(e){try{return this.getChannel(e).getVolume()}catch(e){return -1}}}]);return da}(c.Plugins.BasePlugin);var ej={token:"",isRequesting:!1};var eB=function(e){_inherits(ua,e);var t=_create_super(ua);function ua(){_class_call_check(this,ua);return t.apply(this,arguments)}_create_class(ua,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("auth",ej)}},{key:"requestToken",value:function requestToken(){var e=this;return _async_to_generator(function(){var t,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:t=e.game,c=t.storage;h.label=1;case 1:h.trys.push([1,3,4,5]);if(c.getStorageData("auth","isRequesting")||""!==c.getStorageData("auth","token"))return[2];c.setStorageData("auth","isRequesting",!0);return[4,GameSDK.player.getSignedPlayerInfoAsync()];case 2:l=h.sent().getSignature();c.setStorageData("auth","token",l);return[3,5];case 3:_=h.sent();if(r.Utils.Object.hasOwn(_,"code")&&"PENDING_REQUEST"===_.code)return[2];c.setStorageData("auth","token","");return[3,5];case 4:c.setStorageData("auth","isRequesting",!1);return[7];case 5:return[2]}})})()}},{key:"getToken",value:function getToken(){var e=this.game,t=e.storage;return t.getStorageData("auth","token")}}]);return ua}(c.Plugins.BasePlugin);var ez=function(e){return e.SOLO="solo",e.TOURNAMENT="tournament",e.SHARE_INVITE="share_invite",e.MATCHING_GROUP="matching_group_match",e.CHALLENGE_FRIEND="challenge_friend_match",e}(ez||{});var eH=l,eK=r.Configs,eW=r.Utils,eq=eW.Array,eJ=eW.Valid,eY=eW.Browser;var eZ=function(){function ma(e){_class_call_check(this,ma);u(this,"game");this.game=e}_create_class(ma,[{key:"isValidContextType",value:function isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}},{key:"isValidEntryPointData",value:function isValidEntryPointData(e){return eJ.isObject(e)}},{key:"isTournamentEntryPoint",value:function isTournamentEntryPoint(e){return eq.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],e)}},{key:"receiveContext",value:function receiveContext(e,t,r){var c=this.game,l=c.storage;l.setStorageData("context","contextId",e),this.isValidEntryPointData(r)&&l.setStorageData("context","entryPointData",r),this.isValidContextType(t)&&l.setStorageData("context","contextType",t)}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:t=e.game,r=t.storage,c=r.getStorageData("context","entryPointData"),l=c.type,_=ez.SOLO,h=ez.TOURNAMENT,d=ez.MATCHING_GROUP,y=ez.SHARE_INVITE,f=ez.CHALLENGE_FRIEND;p=_;if(l===h&&(p=h),l===d&&(p=d),(l===f||l===y)&&(p=f),p!==_)return[3,6];v.label=1;case 1:v.trys.push([1,5,,6]);if(!eK.Core.FastCheckTournamentContext)return[3,2];p=e.fastCheckTournamentContext()||p;return[3,4];case 2:return[4,e.outdatedCheckTournamentContext()];case 3:p=v.sent()||p;v.label=4;case 4:return[3,6];case 5:v.sent();return[3,6];case 6:r.setStorageData("context","sessionContextType",p);return[2]}})})()}},{key:"fastCheckTournamentContext",value:function fastCheckTournamentContext(){var e=eY.getQueryParams().entry_point;return!!("string"==typeof e&&this.isTournamentEntryPoint(e))&&ez.TOURNAMENT}},{key:"outdatedCheckTournamentContext",value:function outdatedCheckTournamentContext(){return _async_to_generator(function(){var e;return _ts_generator(this,function(t){switch(t.label){case 0:e="getTournamentAsync"in GameSDK;if(!e)return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:e=t.sent().getEndTime()>Date.now()/1e3;t.label=2;case 2:return[2,!!e&&ez.TOURNAMENT]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){var e=this.game,t=e.player,r=e.storage,c=r.getStorageData("context","entryPointData"),l=r.getStorageData("context","sessionContextType"),_=t.getPlayerId(),h=c.matchId,d=c.playerId,y=c.opponentId,f=void 0===y?K.playerId:y,p=_===d,v=f===K.playerId||[f,d].indexOf(_)>=0,g=ez.TOURNAMENT,m=ez.MATCHING_GROUP,A=ez.SHARE_INVITE,I=ez.CHALLENGE_FRIEND;var E=eH.SINGLE;l===g&&(E=eH.TOURNAMENT),l!==A||p||(E=eH.CHALLENGE_FRIEND),l===I&&h&&v&&(E=eH.CHALLENGE_FRIEND),l===m&&(E=eH.MATCHING_GROUP),r.setStorageData("context","contextGameMode",E)}}]);return ma}();var eQ=function(e){_inherits(He,e);var t=_create_super(He);function He(e){_class_call_check(this,He);var r;r=t.call(this,e),r.name="PlayerHasFinishedMatch",r.message=null!=e?e:"Player has finished match";return _possible_constructor_return(r)}return He}(_wrap_native_super(Error));var e$=function(e){_inherits(oe,e);var t=_create_super(oe);function oe(e){_class_call_check(this,oe);var r;r=t.call(this,e),r.name="PlayerNotJoinInMatch",r.message=e||"Player is not join in match";return _possible_constructor_return(r)}return oe}(_wrap_native_super(Error));var eX=r.Events,e0=r.Plugins,e2=e0.Analytics;var e3=function(){function wa(e){_class_call_check(this,wa);u(this,"game");this.game=e}_create_class(wa,[{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d,y,f,p,v,g,m,A,I,E,x,C,N,T;return _ts_generator(this,function(L){switch(L.label){case 0:t=e.game,r=t.player,c=t.storage,l=t.monitorError,_=c.getStorageData("context","contextId"),h=c.getStorageData("context","entryPointData"),d=c.getStorageData("context","sessionContextType"),y=h||{},f=y.type,p=y.matchId,v=y.playerId,g=y.opponentId,m=y.playerScore,A=y.action;I=A;if(!I)return[3,2];return[4,e.processEntryPointAction(A)];case 1:I=L.sent();L.label=2;case 2:E=r.isFirstLogin();setTimeout(function(){e.logUserAnalytics(E)},1e3);x=ez.TOURNAMENT,C=ez.SHARE_INVITE,N=ez.MATCHING_GROUP,T=ez.CHALLENGE_FRIEND;if(d!==x)return[3,6];L.label=3;case 3:L.trys.push([3,5,,6]);return[4,e.processTournamentModeAsync(_)];case 4:L.sent();return[2];case 5:L.sent();null==l||l.sendException(new Error("Process Tournament Fail"),{contextId:_,isFirstLogin:E,entryPointData:h,playerData:r.getPlayerData()});return[3,6];case 6:if(d!==T)return[3,10];if(!(f===C&&"string"==typeof v))return[3,8];return[4,e.processChallengeFromPostAsync(v)];case 7:L.sent();return[2];case 8:if(!(f===T&&"string"==typeof p&&"string"==typeof v&&"string"==typeof g))return[3,10];return[4,e.processChallengeFromMessageAsync({contextId:_,matchId:p,playerId:v,opponentId:g})];case 9:L.sent();return[2];case 10:if(!(d===N&&"string"==typeof v&&"number"==typeof m))return[3,12];return[4,e.processMatchingGroupModeAsync(v,m)];case 11:L.sent();return[2];case 12:if(!E)return[3,14];return[4,e.processSingleModeAsync(!0)];case 13:L.sent(),r.loggedIn();return[2];case 14:e.processSingleModeAsync(!1);return[2]}})})()}},{key:"logUserAnalytics",value:function logUserAnalytics(e){try{var t=this.game,r=t.player,c=t.analytics;if(e)c.event(e2.Events.NEW_USER);else{var l=r.getPlayerData().gameData,_=l.coins;c.event(e2.Events.RETURNING_USER,{coins:_})}}catch(e){}}},{key:"processEntryPointAction",value:function processEntryPointAction(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,7,,8]);r=t.game,c=r.player;switch(e){case"reset_data":return[3,1];case"enable_debug":return[3,3];case"set_locale_en":return[3,4];case"set_locale_ru":return[3,5]}return[3,6];case 1:c.setPlayerDataByName("score",0),c.setPlayerDataByName("endlessScore",0),c.setGameData({coins:0,level:1});return[4,c.syncProfileToServer()];case 2:l.sent();return[3,6];case 3:c.setPlayerDataByName("debug",!0);return[3,6];case 4:t.requestSetLocale("en");return[3,6];case 5:t.requestSetLocale("ru");return[3,6];case 6:return[3,8];case 7:l.sent();return[3,8];case 8:return[2]}})})()}},{key:"requestSetLocale",value:function requestSetLocale(e){var t=this.game,r=t.event;r.emit(eX.REQUEST_LANGUAGE,{locale:e})}},{key:"processTournamentModeAsync",value:function processTournamentModeAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:r=t.game,c=r.match,l=r.player,_=l.getPlayerId();if("string"!=typeof e)throw new Error("Cannot get contextId");return[4,c.tournament.continue.processAsync({playerId:_,contextId:e})];case 1:h.sent(),t.switchToGameScene();return[2]}})})()}},{key:"processChallengeFromPostAsync",value:function processChallengeFromPostAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:r=t.game,c=r.match,l=r.player,_=l.getPlayerId();if(_!==e)return[3,2];return[4,c.single.start.processAsync({playerId:_})];case 1:h.sent();return[3,6];case 2:h.trys.push([2,4,,6]);return[4,c.challenge.friend.processAsync({playerId:_,opponentId:e})];case 3:h.sent();return[3,6];case 4:h.sent();return[4,c.single.start.processAsync({playerId:_})];case 5:h.sent();return[3,6];case 6:t.switchToGameScene();return[2]}})})()}},{key:"processChallengeFromMessageAsync",value:function processChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,7]);return[4,t.processContinueChallengeFromMessageAsync(e)];case 1:c.sent();return[3,7];case 2:r=c.sent();if(!_instanceof(r,eQ))return[3,4];return[4,t.processAwaitChallengeFromMessageAsync(e)];case 3:c.sent();return[2];case 4:if(!_instanceof(r,e$))return[3,6];return[4,t.processJoinChallengeFromMessageAsync(e)];case 5:c.sent();return[2];case 6:t.switchToDashboardScene();return[3,7];case 7:return[2]}})})()}},{key:"processContinueChallengeFromMessageAsync",value:function processContinueChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.contextId,c=e.matchId,l=e.playerId,_=e.opponentId,h=t.game,d=h.match,y=h.player,f=y.getPlayerId();if(l!==f)return[3,2];return[4,d.challenge.continue.processAsync({contextId:r,matchId:c,playerId:f,opponentId:_})];case 1:v.sent();return[3,4];case 2:p=_===K.playerId;return[4,d.challenge.continue.processAsync({contextId:r,matchId:c,playerId:f,opponentId:p?_:l})];case 3:v.sent();v.label=4;case 4:t.switchToGameScene();return[2]}})})()}},{key:"processJoinChallengeFromMessageAsync",value:function processJoinChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y;return _ts_generator(this,function(f){switch(f.label){case 0:r=e.contextId,c=e.matchId,l=e.playerId,_=t.game,h=_.match,d=_.player,y=d.getPlayerId();return[4,h.challenge.join.processAsync({contextId:r,matchId:c,playerId:y,opponentId:l})];case 1:f.sent(),t.switchToGameScene();return[2]}})})()}},{key:"processAwaitChallengeFromMessageAsync",value:function processAwaitChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y;return _ts_generator(this,function(f){switch(f.label){case 0:r=e.contextId,c=e.matchId,l=e.playerId,_=t.game,h=_.match,d=_.player,y=d.getPlayerId();f.label=1;case 1:f.trys.push([1,3,,5]);return[4,h.challenge.await.processAsync({contextId:r,matchId:c,playerId:y,opponentId:l})];case 2:f.sent(),t.switchToChallengeResultScene();return[3,5];case 3:f.sent();return[4,t.processResultChallengeFromMessageAsync(e)];case 4:f.sent();return[3,5];case 5:return[2]}})})()}},{key:"processResultChallengeFromMessageAsync",value:function processResultChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y;return _ts_generator(this,function(f){switch(f.label){case 0:r=e.contextId,c=e.matchId,l=e.playerId,_=t.game,h=_.match,d=_.player,y=d.getPlayerId();f.label=1;case 1:f.trys.push([1,3,,4]);return[4,h.challenge.result.processAsync({contextId:r,matchId:c,playerId:y,opponentId:l})];case 2:f.sent(),t.switchToChallengeResultScene();return[3,4];case 3:f.sent();t.switchToDashboardScene();return[3,4];case 4:return[2]}})})()}},{key:"processMatchingGroupModeAsync",value:function processMatchingGroupModeAsync(e,t){var r=this;return _async_to_generator(function(){var c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:c=r.game,l=c.match,_=c.player;return[4,l.group.join.processAsync({playerId:_.getPlayerId(),opponentId:e,opponentScore:t})];case 1:h.sent(),r.switchToGameScene();return[2]}})})()}},{key:"processSingleModeAsync",value:function processSingleModeAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:r=t.game,c=r.match,l=r.player,_=l.getPlayerId();h=e;if(!h)return[3,2];return[4,c.handler.setMatchCustomData({level:0})];case 1:h=d.sent();d.label=2;case 2:return[4,c.single.start.processAsync({playerId:_})];case 3:d.sent(),t.switchToGameScene();return[2]}})})()}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){var e=this.game,t=e.event;t.emit(eX.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}},{key:"switchToGameScene",value:function switchToGameScene(){var e=this.game,t=e.event;t.emit(eX.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}},{key:"switchToChallengeResultScene",value:function switchToChallengeResultScene(){var e=this.game,t=e.event;t.emit(eX.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}}]);return wa}();var e1={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},e4=r.Events;var e5=function(e){_inherits(Ia,e);var t=_create_super(Ia);function Ia(e){_class_call_check(this,Ia);var r;r=t.call(this,e);u(_assert_this_initialized(r),"context");u(_assert_this_initialized(r),"loader");r.loader=new e3(e),r.context=new eZ(e);return r}_create_class(Ia,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("context",e1)}},{key:"getSessionContextTypes",value:function getSessionContextTypes(){return ez}},{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,e.loader.processContextData()];case 1:t.sent();return[3,3];case 2:t.sent();e.switchToDashboardScene();return[3,3];case 3:return[2]}})})()}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,e.context.detectContextSessionType()];case 1:t.sent();return[3,3];case 2:t.sent();return[3,3];case 3:return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){this.context.detectContextGameMode()}},{key:"receiveContext",value:function receiveContext(e,t,r){this.context.receiveContext(e,t,r)}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){var e=this.game,t=e.event;t.emit(e4.SWITCH_SCENE,{sceneName:"DashboardScene"})}}]);return Ia}(c.Plugins.BasePlugin);var e6=r.Utils,e7=e6.Valid,e8=e1.contextId,e9=e1.contextType,tt=e1.entryPointData,ta="is invalid";var tr=function(e){_inherits(Ke,e);var t=_create_super(Ke);function Ke(){_class_call_check(this,Ke);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"data");return e}_create_class(Ke,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateContextId",value:function validateContextId(e){e7.isString(e)||this.exception("contextId",ta)}},{key:"validateContextType",value:function validateContextType(e){e7.isString(e)&&e||this.exception("contextType",ta)}},{key:"validateEntryPointData",value:function validateEntryPointData(e){e7.isObject(e)||this.exception("entryPointData",ta)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ke.prototype),"toObject",this).call(this)}}]);return Ke}(E);tr.addDefaultData({contextId:e8,contextType:e9,entryPointData:tt}),r.Dtos.Context={Info:tr};var ts={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},ti=r.Utils,tc=ti.Object;var tu=function(){function va(){_class_call_check(this,va)}_create_class(va,[{key:"getDailyRewardsAsync",value:function getDailyRewardsAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,tc.vals(ts)]})})()}}]);return va}();var tl={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},t_={dailyRewards:{}},th=r.Configs.DailyRewards;var td=function(e){_inherits(ba,e);var t=_create_super(ba);function ba(){_class_call_check(this,ba);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"dailyRewardsApi",new tu);return e}_create_class(ba,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("dailyRewards",t_)}},{key:"requestDailyRewardsAsync",value:function requestDailyRewardsAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,e.dailyRewardsApi.getDailyRewardsAsync()];case 1:t=r.sent();0!==t.length&&e.receiveDailyRewards(t);return[2]}})})()}},{key:"getDailyRewards",value:function getDailyRewards(){var e=this.game,t=e.storage,r=t.getStorageData("dailyRewards","dailyRewards");return r||null}},{key:"logLoginReward",value:function logLoginReward(){var e=this.game,t=e.player,r=t.getPlayerData().dailyRewarded,c=r.logDays,l=_to_consumable_array(c);l[l.length-1]=!0,this.logDailyRewards(l)}},{key:"logDailyRewards",value:function logDailyRewards(e,t){var r=arguments.length>1&&void 0!==t&&t;var c=this.game,l=c.player;l.setPlayerDataByName("dailyRewarded",{logDays:e,lastRewarded:r?0:Date.now()})}},{key:"receiveDailyRewards",value:function receiveDailyRewards(e){var t=this.game,r=t.player,c=r.getPlayerData().dailyRewarded,l=c.logDays,_=c.lastRewarded,h=new Date,d=new Date(_),y=new Date(d.toDateString()),f=Math.abs(h.valueOf()-y.valueOf()),p=Math.floor(f/864e5)>1,v=th.CheckInterrupt&&p||l.length>=th.MaxDays,g=v?[!1]:_to_consumable_array(l).concat([!1]);this.logDailyRewards(g);var m=e.map(function(e,t){var r=t<g.length,c=g.length===t+1,l=!1===g[t];var _=tl.WAITING;return c?_=tl.READY:v?_=tl.WAITING:r&&l?_=tl.SKIPPED:r&&(_=tl.REWARDED),_object_spread_props(_object_spread({},e),{status:_})});this.setDailyRewards(m)}},{key:"setDailyRewards",value:function setDailyRewards(e){var t=this.game,r=t.storage;r.setStorageData("dailyRewards","dailyRewards",e)}}]);return ba}(c.Plugins.BasePlugin);function Na(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ty={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,c,l,_){if("function"!=typeof c)throw new TypeError("The listener must be a function");var h=new a(c,l||e,_),d=r?r+t:t;return e._events[d]?e._events[d].fn?e._events[d]=[e._events[d],h]:e._events[d].push(h):(e._events[d]=h,e._eventsCount++),e}function i(e,t){0===--e._eventsCount?e._events=new s:delete e._events[t]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var e=[],c,l;if(0===this._eventsCount)return e;for(l in c=this._events)t.call(c,l)&&e.push(r?l.slice(1):l);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(c)):e},o.prototype.listeners=function(e){var t=r?r+e:e,c=this._events[t];if(!c)return[];if(c.fn)return[c.fn];for(var l=0,_=c.length,h=new Array(_);l<_;l++)h[l]=c[l].fn;return h},o.prototype.listenerCount=function(e){var t=r?r+e:e,c=this._events[t];return c?c.fn?1:c.length:0},o.prototype.emit=function(e,t,c,l,_,h){var d=r?r+e:e;if(!this._events[d])return!1;var y=this._events[d],f=arguments.length,p,v;if(y.fn){switch(y.once&&this.removeListener(e,y.fn,void 0,!0),f){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,t),!0;case 3:return y.fn.call(y.context,t,c),!0;case 4:return y.fn.call(y.context,t,c,l),!0;case 5:return y.fn.call(y.context,t,c,l,_),!0;case 6:return y.fn.call(y.context,t,c,l,_,h),!0}for(v=1,p=new Array(f-1);v<f;v++)p[v-1]=arguments[v];y.fn.apply(y.context,p)}else{var g=y.length,m;for(v=0;v<g;v++)switch(y[v].once&&this.removeListener(e,y[v].fn,void 0,!0),f){case 1:y[v].fn.call(y[v].context);break;case 2:y[v].fn.call(y[v].context,t);break;case 3:y[v].fn.call(y[v].context,t,c);break;case 4:y[v].fn.call(y[v].context,t,c,l);break;default:if(!p)for(m=1,p=new Array(f-1);m<f;m++)p[m-1]=arguments[m];y[v].fn.apply(y[v].context,p)}}return!0},o.prototype.on=function(e,t,r){return n(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return n(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,c,l){var _=r?r+e:e;if(!this._events[_])return this;if(!t)return i(this,_),this;var h=this._events[_];if(h.fn)h.fn!==t||l&&!h.once||c&&h.context!==c||i(this,_);else{for(var d=0,y=[],f=h.length;d<f;d++)(h[d].fn!==t||l&&!h[d].once||c&&h[d].context!==c)&&y.push(h[d]);y.length?this._events[_]=1===y.length?y[0]:y:i(this,_)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o})(ty);var tf=ty.exports;var tp=Na(tf),tv=new tp,tg={names:[],history:[]};var tm=function(e){_inherits(Ta,e);var t=_create_super(Ta);function Ta(){_class_call_check(this,Ta);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"enableLog",!1);u(_assert_this_initialized(e),"muteEvents",[]);return e}_create_class(Ta,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("event",tg)}},{key:"enableLogEvent",value:function enableLogEvent(){this.enableLog=!0}},{key:"on",value:function on(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"on","listening"),tv.on(e,t)}},{key:"once",value:function once(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"once","listening"),tv.once(e,t)}},{key:"catchUp",value:function catchUp(e,t){if(this.validateCallback(t),this.once(e,t),!(this.getEventEmitCount(e)>0))return;var r;var c=null!==(r=this.getLastEventInfo(e))&&void 0!==r?r:{},l=c.payload;this.emit(e,l)}},{key:"off",value:function off(e,t){this.validateCallback(t),tv.off(e,t),this.addHistory(e,"action","removed")}},{key:"mute",value:function mute(e){this.muteEvents.indexOf(e)>-1||this.muteEvents.push(e)}},{key:"clear",value:function clear(e){tv.removeAllListeners(e),this.addHistory(e,"action","removed")}},{key:"emit",value:function emit(e,t){var r;if(this.muteEvents.indexOf(e)>-1)return;var c=[];t&&(c=[t]),this.addHistory(e,"action","called",t),(r=tv).emit.apply(r,[e].concat(_to_consumable_array(c)))}},{key:"validateCallback",value:function validateCallback(e){if("function"!=typeof e)throw new Error("Callback must be a function")}},{key:"addEventName",value:function addEventName(e){var t=this.game,r=t.storage,c=r.getStorageData("event","names");c.indexOf(e)<0&&c.push(e)}},{key:"getEventListeners",value:function getEventListeners(){var e=tv.eventNames();return Object.keys(e)}},{key:"getHistory",value:function getHistory(){var e=this.game,t=e.storage;return t.getStorageData("event","history")}},{key:"getEventEmitCount",value:function getEventEmitCount(e){return this.getHistory().filter(function(t){return t.name===e&&"called"===t.status}).length}},{key:"getLastEventInfo",value:function getLastEventInfo(e){var t=this.getHistory();var r=null;for(var c=t.length-1;c>=0;c--)if(t[c].name===e){r=t[c];break}return r}},{key:"getTypeFromHistory",value:function getTypeFromHistory(e){var t=this.getLastEventInfo(e);var r;return null!==(r=null==t?void 0:t.type)&&void 0!==r?r:null}},{key:"getCallsFromHistory",value:function getCallsFromHistory(e){var t=this.getLastEventInfo(e);var r;return null!==(r=null==t?void 0:t.called)&&void 0!==r?r:0}},{key:"addHistory",value:function addHistory(e,t,r,c){var l;var _=null!==(l=this.getTypeFromHistory(e))&&void 0!==l?l:t,h=this.getCallsFromHistory(e),d="called"===r?h+1:h;this.getHistory().push({type:_,status:r,name:e,called:d,payload:null!=c?c:{}}),this.logEventInfo(e,_,r,d)}},{key:"logEventInfo",value:function logEventInfo(e,t,r,c){this.enableLog&&("listening"===r&&tv.listenerCount(e),"called"===r&&tv.listenerCount(e))}}]);return Ta}(c.Plugins.BasePlugin);var tA={},tw=Object.freeze(Object.defineProperty({__proto__:null,default:tA},Symbol.toStringTag,{value:"Module"})),tb='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',tI=r.Configs,tk=r.Utils,tS=tk.Object,tD=tI.FrameCapture,tP=tD.Enabled,tE=tD.WideframeConfigs,tx=function(){var e=_async_to_generator(function(e){var t,r,c,l,_,h;return _ts_generator(this,function(d){if(!tP)return[2,null];t=ka(e);if(!t)return[2,null];Va(t,tE.ResultChallenge);r=window.game,c=r.frameCapture,l=tE.ResultChallenge,_=l.Width,h=l.Height;return[2,c.captureAsync({name:"ResultChallenge",width:_,height:h,renderOptions:t})]})});return function $a(t){return e.apply(this,arguments)}}(),Va=function(e,t){var r=t.Width,c=t.Height,l=t.Wideframe;e.wideframe={name:"result-challenge",type:"image",depth:0,image:l,size:[r,c],position:[0,0]}},ka=function(e){try{var t=e.playerId,r=void 0===t?"10":t,c=e.playerPhoto,l=void 0===c?"":c,_=e.playerScore,h=void 0===_?0:_,d=e.opponentId,y=void 0===d?"20":d,f=e.opponentPhoto,p=void 0===f?"":f,v=e.opponentScore,g=void 0===v?0:v,m=e.isPlayerFinished,A=e.isOpponentFinished,I=tE.ResultChallenge,E=I.RenderOptions,x=tS.clone(E);if(!x)return null;var C=tS.clear(x),N=tS.camelCaseKeys(C),T=N.playerPhoto,L=N.opponentPhoto,O=h===g,F=h>g,G=null!=m?m:A,V=m&&A;return"image"===T.type&&(T.name="".concat(r),T.image=l),"image"===L.type&&(L.name="".concat(y),L.image=p),G&&Ua(N,{playerScore:h,opponentScore:g,isPlayerFinished:m,isOpponentFinished:A}),!V||O?(delete N.leftCrown,delete N.rightCrown,N):(F?delete N.rightCrown:delete N.leftCrown,N)}catch(e){return null}},Ua=function(e,t){var r=e.leftScore,c=e.rightScore,l=t.playerScore,_=void 0===l?0:l,h=t.opponentScore,d=void 0===h?0:h,y=t.isPlayerFinished,f=t.isOpponentFinished;(null==r?void 0:r.type)==="text"&&(r.text=y?"".concat(_):"???"),(null==c?void 0:c.type)==="text"&&(c.text=f?"".concat(d):"???")},tC=r.Configs,tN=r.Utils,tT=tN.Object,tL=tC.FrameCapture,tM=tL.Enabled,tO=tL.WideframeConfigs,tR=function(){var e=_async_to_generator(function(e){var t,r,c,l,_,h;return _ts_generator(this,function(d){if(!tM)return[2,null];t=za(e);if(!t)return[2,null];Wa(t,tO.ShareLeaderboard);r=window.game,c=r.frameCapture,l=tO.ShareLeaderboard,_=l.Width,h=l.Height;return[2,c.captureAsync({name:"ShareLeaderboard",width:_,height:h,renderOptions:t})]})});return function Ka(t){return e.apply(this,arguments)}}(),Wa=function(e,t){var r=t.Width,c=t.Height,l=t.Wideframe;e.wideframe={name:"share-leaderboard",type:"image",depth:0,image:l,size:[r,c],position:[0,0]}},za=function(e){try{var t=e.playerId,r=e.playerPhoto,c=e.leaders,l=tO.ShareLeaderboard,_=l.RenderOptions,h=tT.clone(_);if(!h)return null;var d=tT.clear(h),y=tT.camelCaseKeys(d),f=y.avatar;return"image"===f.type&&(f.name="".concat(t),f.image=r),qa(y,c),y}catch(e){return null}},qa=function(e,t){var r="600 48px";t.forEach(function(t,c){var l=t.id,_=t.name,h=t.photo,d=t.score;var y=1294+180*c;e["photo_".concat(l)]={depth:-1,name:l,type:"image",image:h,size:[96,96],position:[436,y]},y=1360+180*c,e["name_".concat(l)]={font:r,depth:1,name:l,type:"text",text:_,position:[600,y]},e["score_".concat(l)]={font:r,depth:1,name:l,type:"text",text:"".concat(d),position:[100,y]}})},tF=r.Configs,tG=r.Utils,tU=tG.Object,tV=tF.FrameCapture,tj=tV.Enabled,tB=tV.WideframeConfigs,tz=function(){var e=_async_to_generator(function(e){var t,r,c,l,_,h;return _ts_generator(this,function(d){if(!tj)return[2,null];t=tn(e);if(!t)return[2,null];Za(t,tB.ShareScore);r=window.game,c=r.frameCapture,l=tB.ShareScore,_=l.Width,h=l.Height;return[2,c.captureAsync({name:"ShareScore",width:_,height:h,renderOptions:t})]})});return function Xa(t){return e.apply(this,arguments)}}(),Za=function(e,t){var r=t.Width,c=t.Height,l=t.Wideframe;e.wideframe={name:"share-score",type:"image",depth:0,image:l,size:[r,c],position:[0,0]}},tn=function(e){try{var t=e.playerId,r=e.playerPhoto,c=e.playerScore,l=tB.ShareScore,_=l.RenderOptions,h=tU.clone(_);if(!h)return null;var d=tU.clear(h),y=tU.camelCaseKeys(d),f=y.avatar,p=y.playerScore;return"image"===f.type&&(f.name="".concat(t),f.image=r),"text"===p.type&&(p.text="".concat(c)),y}catch(e){return null}},tH=r.Configs,tK=r.Utils,tW=tK.Image,tq=tK.Object,tJ=tK.Valid,tY=tH.FrameCapture,tZ=tY.Options;var tQ=function(e){_inherits(an,e);var t=_create_super(an);function an(){_class_call_check(this,an);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"width");u(_assert_this_initialized(e),"height");u(_assert_this_initialized(e),"canvas",null);u(_assert_this_initialized(e),"testRenderOptions",null);u(_assert_this_initialized(e),"caches",{});u(_assert_this_initialized(e),"wideframe",{});return e}_create_class(an,[{key:"init",value:function init(){this.addWideframeRender("renderShareScore",tz),this.addWideframeRender("renderResultChallenge",tx),this.addWideframeRender("renderShareLeaderboard",tR)}},{key:"preloadAsync",value:function preloadAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:r=e.renderOptions;return[4,t.loadImages(r)];case 1:c.sent();return[2]}})})()}},{key:"captureAsync",value:function captureAsync(e){var t=this;return _async_to_generator(function(){var r,c,l;return _ts_generator(this,function(_){switch(_.label){case 0:r=e.width,c=e.height,l=e.renderOptions;return[4,t.loadImages(l)];case 1:return[2,(_.sent(),t.width=r,t.height=c,t.createCanvas(),t.drawObjects(l),t.snapshotFrameAsync())]}})})()}},{key:"addWideframeRender",value:function addWideframeRender(e,t){this.wideframe[e]=t}},{key:"setTestRenderOptions",value:function setTestRenderOptions(e){if(!e){this.testRenderOptions=null;return}var t=tq.camelCaseKeys(e);this.testRenderOptions=tq.merge(this.testRenderOptions,t)}},{key:"createCanvas",value:function createCanvas(){if(this.canvas){var e=this.canvas.getContext("2d");e?e.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}},{key:"loadImages",value:function loadImages(e){var t=this;return _async_to_generator(function(){var r,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:r=tq.vals(e).filter(function(e){return"image"===e.type}),c=t.prepareLoadImages(r),l=tq.vals(c);if(l.length<1)return[2];return[4,Promise.all(l)];case 1:_=h.sent();t.cacheImages(c,_);return[2]}})})()}},{key:"prepareLoadImages",value:function prepareLoadImages(e){var t={};var r=true,c=false,l=void 0;try{var _,_loop=function(){var e=d.value;var r=e.name,c=e.image,l=e.fallbackImage,h=_.caches[r];!tJ.isString(c)||h||(""===c&&tJ.isString(l)&&(e.image=l),t[r]=new Promise(function(t){tW.loadImage(c).then(function(e){t(e)}).catch(function(){tJ.isString(l)?(e.image=l,tW.loadImage(e.image).then(function(e){t(e)}).catch(function(){t(null)})):t(null)})}))};for(var h=e[Symbol.iterator](),d;!(r=(d=h.next()).done);r=true)_=this,_loop()}catch(e){c=true;l=e}finally{try{if(!r&&null!=h.return)h.return()}finally{if(c)throw l}}return t}},{key:"cacheImages",value:function cacheImages(e,t){for(var r in e){var c=t.shift();c&&(this.caches[r]=c)}}},{key:"drawObjects",value:function drawObjects(e){var t=tq.vals(e).sort(function(e,t){return e.depth-t.depth});var r=true,c=false,l=void 0;try{for(var _=t[Symbol.iterator](),h;!(r=(h=_.next()).done);r=true){var d=h.value;switch(d.type){case"text":this.drawText(d);break;case"image":this.drawImage(d);break}}}catch(e){c=true;l=e}finally{try{if(!r&&null!=_.return)_.return()}finally{if(c)throw l}}}},{key:"drawText",value:function drawText(e){if(!this.canvas)return;var t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return;var r=e.position,c=e.font,l=e.text,_=e.color,h=e.lineWidth,d=e.textAlign;t.font="".concat(c," ").concat(tb),t.fillStyle=null!=_?_:"#ffffff",h&&(t.lineWidth=h),d&&(t.textAlign=d);var y=_sliced_to_array(r,2),f=y[0],p=y[1];t.fillText(l,f,p)}},{key:"drawImage",value:function drawImage(e){if(!this.canvas)return;var t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return;var r=e.name,c=e.size,l=e.position,_=e.fallbackImage;var h=this.caches[r];if(!h&&_&&(h=this.caches[_]),!h)throw new Error("Image ".concat(r," not found"));var d=_sliced_to_array(l,2),y=d[0],f=d[1],p=_sliced_to_array(c,2),v=p[0],g=p[1];t.drawImage(h,y,f,v,g)}},{key:"snapshotFrameAsync",value:function snapshotFrameAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!e.canvas)return[2,null];t=null;if(!(tZ.UseBlobIfPossible&&"toBlob"in e.canvas))return[3,2];return[4,e.createAsBlob()];case 1:t=r.sent();return[3,3];case 2:t=e.createAsDataImage();r.label=3;case 3:if(!t)throw new Error("Image data is null");return[2,(tJ.isDebugger()&&tW.logImage(t),t)]}})})()}},{key:"createAsDataImage",value:function createAsDataImage(){if(!this.canvas)return null;var e=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!e)return null;var t=tZ.Quality,r=tZ.RenderType;return e.canvas.toDataURL("image/".concat(r),t)}},{key:"createAsBlob",value:function createAsBlob(){var e=this;return new Promise(function(t){if(!e.canvas){t(null);return}var r=tZ.Quality,c=tZ.RenderType;e.canvas.toBlob(function(e){if(!e){t(null);return}tW.blobToDataImage(e).then(function(e){t(e)})},"image/".concat(c),r)})}}]);return an}(c.Plugins.BasePlugin);var t$=function(e){_inherits(qe,e);var t=_create_super(qe);function qe(e,r){_class_call_check(this,qe);var c;var l=String(e);c=t.call(this,'Text with key "'.concat(l,'" not found in locale "').concat(r,'"'));u(_assert_this_initialized(c),"key");u(_assert_this_initialized(c),"locale");c.name="MissingKeyInLocaleError",c.key=l,c.locale=r;return c}return qe}(_wrap_native_super(Error));var tX=function(e){_inherits(nn,e);var t=_create_super(nn);function nn(e){_class_call_check(this,nn);var r;r=t.call(this,'Locale "'.concat(e,'" not found'));u(_assert_this_initialized(r),"locale");r.name="LocaleNotFoundError",r.locale=e;return r}return nn}(_wrap_native_super(Error));var t0=r.Utils,t2=t0.Object,t3=t0.Function;var t1=function(e){_inherits(on,e);var t=_create_super(on);function on(){_class_call_check(this,on);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"locale");u(_assert_this_initialized(e),"fallbackLocale");u(_assert_this_initialized(e),"data",{});return e}_create_class(on,[{key:"setFallbackLocale",value:function setFallbackLocale(e){this.fallbackLocale=e}},{key:"hasTextKey",value:function hasTextKey(e,t){var r=null!=t?t:this.getCurrentLocale(),c=this.getLocaleData(r),l=c.text;return t2.hasOwn(l,e)}},{key:"hasTextureKey",value:function hasTextureKey(e,t){var r=null!=t?t:this.getCurrentLocale(),c=this.getLocaleData(r),l=c.texture;return t2.hasOwn(l,e)}},{key:"add",value:function add(e,t,r){var c=arguments.length>2&&void 0!==r&&r;this.data[e]=t,c&&this.setFallbackLocale(e)}},{key:"choose",value:function choose(e){this.locale=e;var t=this.game,c=t.event;c.emit(r.Events.LANGUAGE_CHANGED,{locale:e})}},{key:"getText",value:function getText(e,t,r,c){var l=arguments.length>3&&void 0!==c&&c;try{return this.uncaughtGetText(e,t,r,!l)}catch(t){return String(e)}}},{key:"getTexture",value:function getTexture(e,t,r){var c=arguments.length>2&&void 0!==r&&r;return this.uncaughtGetTexture(e,t,!c)}},{key:"uncaughtGetText",value:function uncaughtGetText(e,t,r,c){var l=this;var _=arguments.length>1&&void 0!==t?t:[],h=arguments.length>2?r:void 0,d=!(arguments.length>3)||void 0===c||c;if(!d||void 0===this.fallbackLocale){var y=this.getRawText(e,null!=h?h:this.getCurrentLocale());return this.replaceVariables(y,_)}var f=this.fallbackLocale,p=t3.retry(function(){return l.getRawText(e,null!=h?h:l.getCurrentLocale())},function(){return l.getRawText(e,f)});return this.replaceVariables(p,_)}},{key:"getRawText",value:function getRawText(e,t){if(!this.hasTextKey(e,t))throw new t$(e,t);var r=this.getLocaleData(t),c=r.text;return c[e]}},{key:"uncaughtGetTexture",value:function uncaughtGetTexture(e,t,r){var c=this;var l=!(arguments.length>2)||void 0===r||r;if(!l||void 0===this.fallbackLocale)return this.getRawTexture(e,null!=t?t:this.getCurrentLocale());var _=this.fallbackLocale;return t3.retry(function(){return c.getRawTexture(e,null!=t?t:c.getCurrentLocale())},function(){return c.getRawTexture(e,_)})}},{key:"getRawTexture",value:function getRawTexture(e,t){if(!this.hasTextureKey(e,t))throw new t$(e,t);var r=this.getLocaleData(t),c=r.texture;return c[e]}},{key:"getCurrentLocale",value:function getCurrentLocale(){var e;return null!==(e=this.locale)&&void 0!==e?e:"en"}},{key:"getLocaleData",value:function getLocaleData(e){var t=null!=e?e:this.getCurrentLocale();if(!t2.hasOwn(this.data,t))throw new tX(t);return this.data[t]}},{key:"replaceVariables",value:function replaceVariables(e,t){var r=t.length;if(0===r)return e;var c=e;for(var l=0;l<r;l++){var _=t[l],h="%{".concat(l,"}");c=c.replace(h,_)}return c}}]);return on}(c.Plugins.BasePlugin);var t4=e("D",{_id:"",name:"",createdBy:"",description:"",expireTime:6048e5,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15}),t5=r.Configs,t6=r.Utils,t7=t6.Object,t8=t6.String,t9=t6.Valid,at=t5.OtherHost,aa=t5.Mockup,as=t5.AppId;var ao=function(){function hn(){_class_call_check(this,hn);u(this,"mockAPI")}_create_class(hn,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:if(e.mockAPI)return[2];return[4,_(_async_to_generator(function(){var e,r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,t.import("./bundle/LeaderboardAPIMock.js")];case 1:e=c.sent(),r=e.default;return[2,{default:r}]}})}),void 0,t.meta.url)];case 1:r=c.sent().default;if("function"!=typeof r)throw new Error("Cannot load LeaderboardAPIMock");e.mockAPI=new r;return[2]}})})()}},{key:"getLeadersAsync",value:function getLeadersAsync(e,t,r){var c=this;return _async_to_generator(function(){var l,_;return _ts_generator(this,function(h){switch(h.label){case 0:l=t8.params(r);if(!aa.Leaderboards.Enabled)return[3,6];return[4,c.initMockAPI()];case 1:h.sent();if(!("playerIds"in r))return[3,3];return[4,c.mockAPI.getPlayers(e,r)];case 2:_=h.sent();return[3,5];case 3:return[4,c.mockAPI.getLeaders(e,r)];case 4:_=h.sent();h.label=5;case 5:return[3,8];case 6:return[4,ef("".concat(t,"?").concat(l),{},at)];case 7:_=h.sent();h.label=8;case 8:return[2,t7.hasOwn(_,"data")&&Array.isArray(_.data)?_.data:[]]}})})()}},{key:"getLeaderboardAsync",value:function getLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:c="leaderboards/".concat(e);if(!aa.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:l.sent();return[4,t.mockAPI.getLeaderboardAsync(e)];case 2:r=l.sent();return[3,5];case 3:return[4,ef(c,{},at)];case 4:r=l.sent(),t7.hasOwn(r,"data")&&t9.isObject(r.data)&&(r=r.data);l.label=5;case 5:return[2,r]}})})()}},{key:"getLeaderboardsAsync",value:function getLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(_){switch(_.label){case 0:l=r.Utils.String.params(e);if(!aa.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:_.sent();return[4,t.mockAPI.getLeaderboardsAsync(e)];case 2:c=_.sent();return[3,5];case 3:return[4,ef("leaderboards?".concat(l),{},at)];case 4:c=_.sent(),t7.hasOwn(c,"data")&&Array.isArray(c.data)?c=c.data:c=[];_.label=5;case 5:return[2,c]}})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){var t=this;return _async_to_generator(function(){var r,c,l;return _ts_generator(this,function(_){switch(_.label){case 0:r=e.leaderboardId,c=e.playerId,l=e.score;if(!aa.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:_.sent();return[4,t.mockAPI.setScoreAsync(r,c,l)];case 2:_.sent();return[3,5];case 3:return[4,ep("leaderboards/".concat(r,"/players/").concat(c),{score:l},{},at)];case 4:_.sent();_.label=5;case 5:return[2]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:c=null!==(r=e._id)&&void 0!==r?r:t8.generateObjectId(),l=e.numberOfLeaders,_=_object_spread_props(_object_spread({},t4,e),{_id:c,appId:as,numberOfLeaders:l}),h="leaderboards";if(!aa.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:y.sent();return[4,t.mockAPI.createLeaderboard(_)];case 2:d=y.sent();return[3,5];case 3:return[4,ep(h,_,{},at)];case 4:d=y.sent(),t7.hasOwn(d,"data")&&t9.isObject(d.data)&&(d=d.data);y.label=5;case 5:if(!t7.hasOwn(d,"_id")||d._id!==c)throw new Error("Create leaderboard failed");return[2,c]}})})()}}]);return hn}();var ac={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},au={leaderboards:{}},al=r.Utils,a_=al.Array,ah=al.Valid,ad=al.Json,ay=al.Object;var af=function(e){_inherits(fn,e);var t=_create_super(fn);function fn(){_class_call_check(this,fn);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"lbAPI",new ao);u(_assert_this_initialized(e),"configs");return e}_create_class(fn,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("leaderboard",au),this.configs={}}},{key:"addLeaderboard",value:function addLeaderboard(e){var t=e.name,r=e.type,c=e.leaderboardId,l=e.autoSortRank;if(this.getLeaderboard(t))return;var _="leaderboards/".concat(c,"/");("global"===r||"tournament"===r)&&(_+="leaders"),"friends"===r&&(_+="players"),this.configs[t]={id:c,name:t,type:r,host:_,autoSortRank:l};var h=ad.clone(ac);this.setLeaderboard(t,_object_spread({},h))}},{key:"requestLeaderboardsAsync",value:function requestLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,t.lbAPI.getLeaderboardsAsync(e)];case 1:return[2,r.sent()];case 2:r.sent();return[2,[]];case 3:return[2]}})})()}},{key:"requestLeaderboardAsync",value:function requestLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var c,l,_,h,d,y,f,p,v,g,m,A,I;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,,6,8]);r.validateLeaderboard(e),r.clearLeaderboard(e),r.setLeaderboard(e,{isRequesting:!0});c=r.configs[e],l=c.id,_=c.type,h=c.host;d=[];if("friends"!==_)return[3,2];y=r.game,f=y.player,p=f.getPlayerId(),v=f.getConnectedPlayerIds(t,0),g=[p].concat(_to_consumable_array(v));r.configs[e].playerIds=_to_consumable_array(g);return[4,r.lbAPI.getLeadersAsync(l,h,{playerIds:g})];case 1:d=E.sent();return[3,4];case 2:return[4,r.lbAPI.getLeadersAsync(l,h,{limit:t,offset:0})];case 3:d=E.sent();E.label=4;case 4:if(0===d.length)return[2];return[4,r.receiveLeaderboardAsync(e,d)];case 5:E.sent(),r.setLeaderboard(e,{limit:t,offset:0});return[3,8];case 6:return[4,r.lbAPI.getLeaderboardAsync(r.configs[e].id)];case 7:m=E.sent(),A=m?m.resettable:"",I=m?m.amountPlayer:0;r.setLeaderboard(e,{isRequesting:!1,resettable:A,amountPlayer:I});return[7];case 8:return[2]}})})()}},{key:"loadMoreLeaderboardAsync",value:function loadMoreLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var c,l,_,h,d,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:c=r.getLeaderboard(e);if(!(c&&"friends"!==r.configs[e].type))return[3,4];v.label=1;case 1:v.trys.push([1,,3,4]);r.setLeaderboard(e,{isRequesting:!0});l=r.configs[e],_=l.id,h=l.host,d=c.offset,y=c.limit,f=d+y;return[4,r.lbAPI.getLeadersAsync(_,h,{limit:t,offset:f})];case 2:p=v.sent();if(0===p.length)return[2];r.receiveLeaderboardAsync(e,p),r.setLeaderboard(e,{limit:t,offset:f});return[3,4];case 3:r.setLeaderboard(e,{isRequesting:!1});return[7];case 4:return[2]}})})()}},{key:"getLeaderboard",value:function getLeaderboard(e){var t=this.game,r=t.storage,c=r.getStorageData("leaderboard","leaderboards");return c[e]?c[e]:null}},{key:"getLeadersByPlayerIdsAsync",value:function getLeadersByPlayerIdsAsync(e,t){var r=this;return _async_to_generator(function(){var c,l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:d.trys.push([0,2,,3]);r.validateLeaderboard(e);c=r.configs[e],l=c.id,_="leaderboards/".concat(l,"/players");return[4,r.lbAPI.getLeadersAsync(l,_,{playerIds:t})];case 1:h=d.sent();return[2,0===h.length?[]:r.toLeaders(h)];case 2:d.sent();return[2,[]];case 3:return[2]}})})()}},{key:"getLeaderboardResponseAsync",value:function getLeaderboardResponseAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){switch(r.label){case 0:return[4,t.lbAPI.getLeaderboardAsync(e)];case 1:return[2,r.sent()]}})})()}},{key:"clearLeaderboard",value:function clearLeaderboard(e){try{this.validateLeaderboard(e);var t=ad.clone(ac);this.setLeaderboard(e,null),this.setLeaderboard(e,_object_spread({},t))}catch(e){}}},{key:"isLeaderboardEmpty",value:function isLeaderboardEmpty(e){var t=this.getLeaderboard(e);if(!t)return!0;var r=t.leaders;return 0===Object.keys(r).length}},{key:"isExistLeaderboardId",value:function isExistLeaderboardId(e){var t=this,r=t.configs;return ay.vals(r).some(function(t){return t.id===e})}},{key:"getLeaderboardName",value:function getLeaderboardName(e){var t=this,r=t.configs,c=a_.search(ay.vals(r),function(t){return t.id===e});return c?c.name:null}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e,t,r){var c=this;return _async_to_generator(function(){var l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:d.trys.push([0,3,,4]);c.validateLeaderboard(e);l=c.configs[e],_=l.id;return[4,c.getLastScoreOnLeaderboard(e,t)];case 1:h=d.sent();if(h&&r<=h)return[2];return[4,c.lbAPI.setLeaderboardScoreAsync({leaderboardId:_,playerId:t,score:r})];case 2:d.sent();return[3,4];case 3:d.sent();return[3,4];case 4:return[2]}})})()}},{key:"getLastScoreOnLeaderboard",value:function getLastScoreOnLeaderboard(e,t){var r=this;return _async_to_generator(function(){var c;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,r.getLeadersByPlayerIdsAsync(e,[t])];case 1:c=l.sent();return[2,0===c.length?null:c[0].score]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){return[2,t.lbAPI.createLeaderboardAsync(e)]})})()}},{key:"validateLeaderboard",value:function validateLeaderboard(e){var t=this.getLeaderboard(e);if(!ah.isObject(t))throw new Error("Leaderboard with name ".concat(e," not found"))}},{key:"setLeaderboard",value:function setLeaderboard(e,t){var r=this.game,c=r.storage;c.setStorageData("leaderboard","leaderboards",_define_property({},e,t))}},{key:"receiveLeaderboardAsync",value:function receiveLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var c,l,_,h,d,y,f,p,v,g,m,A;return _ts_generator(this,function(I){switch(I.label){case 0:r.validateLeaderboard(e);return[4,r.toLeaders(t)];case 1:l=I.sent().filter(function(e){return e.name&&e.photo}),_=null!==(c=r.getLeaderboard(e))&&void 0!==c?c:{},h=_.offset,d=void 0===h?0:h,y=_.leaders,f=void 0===y?{}:y,p=l.filter(function(e){return!f[e.playerId]});if(d>0&&p.length>0){g=ay.vals(f);(v=p).unshift.apply(v,_to_consumable_array(g))}m=p.sort(function(e,t){return t.score-e.score});r.configs[e].autoSortRank&&(m=m.map(function(e,t){return _object_spread_props(_object_spread({},e),{rank:t+1})}));A=ay.keyBy(m,"playerId");r.setLeaderboard(e,{leaders:A});return[2]}})})()}},{key:"toLeaders",value:function toLeaders(e){var t=this;return _async_to_generator(function(){var r,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:r=t.game,c=r.profile,l=e.map(function(e){return e.playerId});return[4,c.requestProfiles(l)];case 1:h.sent();_=c.getProfiles();return[2,e.map(function(e){var t=e.playerId,r=_[t];return r?_object_spread_props(_object_spread({},e),{name:r.name,photo:r.photo}):_object_spread_props(_object_spread({},e),{name:"Nameless",photo:"default"})}).map(function(e){return _object_spread_props(_object_spread({},e),{score:Number.parseInt(e.score,10)})})]}})})()}}]);return fn}(c.Plugins.BasePlugin);var ap=function(){function gn(){_class_call_check(this,gn);u(this,"APIHost")}_create_class(gn,[{key:"setAPIHost",value:function setAPIHost(e){this.APIHost=e}},{key:"getAPIHost",value:function getAPIHost(){return this.APIHost}}]);return gn}();var av=r.Utils;var ag=function(e){_inherits(mn,e);var t=_create_super(mn);function mn(){_class_call_check(this,mn);return t.apply(this,arguments)}_create_class(mn,[{key:"createSingleMatchAsync",value:function createSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,ep("single-matches",e,{},t.getAPIHost())];case 1:r=c.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"getSingleMatchDetailAsync",value:function getSingleMatchDetailAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,ef("single-matches/active",{},e.getAPIHost())];case 1:t=r.sent();return[2,e.returnValidMatchData(t)]}})})()}},{key:"updateSingleMatchMoveAsync",value:function updateSingleMatchMoveAsync(e,t){var r=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(_){switch(_.label){case 0:c="single-matches/".concat(e,"/move");return[4,ep(c,t,{},r.getAPIHost())];case 1:l=_.sent();return[2,r.returnValidMatchData(l)]}})})()}},{key:"finishSingleMatchAsync",value:function finishSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r="single-matches/".concat(e,"/finish");return[4,ep(r,{},{},t.getAPIHost())];case 1:c=l.sent();return[2,t.returnValidMatchData(c)]}})})()}},{key:"createEndlessMatchAsync",value:function createEndlessMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,ep("endless-matches",e,{},t.getAPIHost())];case 1:r=c.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"getEndlessMatchDetailAsync",value:function getEndlessMatchDetailAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,ef("endless-matches/active",{},e.getAPIHost())];case 1:t=r.sent();return[2,e.returnValidMatchData(t)]}})})()}},{key:"updateEndlessMatchMilestoneAsync",value:function updateEndlessMatchMilestoneAsync(e,t){var r=this;return _async_to_generator(function(){var c,l;return _ts_generator(this,function(_){switch(_.label){case 0:c="endless-matches/".concat(e,"/milestone");return[4,ep(c,t,{},r.getAPIHost())];case 1:l=_.sent();return[2,r.returnValidMatchData(l)]}})})()}},{key:"finishEndlessMatchAsync",value:function finishEndlessMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r="endless-matches/".concat(e,"/finish");return[4,ep(r,{},{},t.getAPIHost())];case 1:c=l.sent();return[2,t.returnValidMatchData(c)]}})})()}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,ep("matches",e,{},t.getAPIHost())];case 1:r=c.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r="matches/".concat(e,"/join");return[4,ep(r,{},{},t.getAPIHost())];case 1:c=l.sent();return[2,t.returnValidMatchData(c)]}})})()}},{key:"getMatchDetailByIdAsync",value:function getMatchDetailByIdAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r="matches/".concat(e);return[4,ef(r,{},t.getAPIHost())];case 1:c=l.sent();return[2,t.returnValidMatchData(c)]}})})()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:r=e.matchId,c=void 0===r?"":r,l=e.score,_=void 0===l?0:l,h=e.level,d=void 0===h?0:h,y=e.extraData,f=void 0===y?{}:y,p="matches/".concat(c,"/finish");return[4,ep(p,{matchId:c,score:_,level:d,extraData:f},{},t.getAPIHost())];case 1:v=g.sent();return[2,t.returnValidMatchData(v)]}})})()}},{key:"returnValidMatchData",value:function returnValidMatchData(e){var t={};return av.Valid.isObject(e)&&av.Object.hasOwn(e,"data")&&(t=e.data),t}}]);return mn}(ap);var am=function(){function wn(e){_class_call_check(this,wn);u(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}_create_class(wn,[{key:"createAPI",value:function createAPI(){this.matchAPI=new ag}},{key:"setAPIConfig",value:function setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}},{key:"setMatchAPIInstance",value:function setMatchAPIInstance(e){this.matchAPI=e}},{key:"getMatchAPI",value:function getMatchAPI(){return this.matchAPI}}]);return wn}();var aA=function(){function P(e,t){_class_call_check(this,P);u(this,"game");u(this,"match");this.game=e,this.match=t}_create_class(P,[{key:"startLog",value:function startLog(e){}},{key:"endLog",value:function endLog(){}},{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(e){throw new Error("Not implemented")})})()}}]);return P}();var aw=function(e){_inherits(es,e);var t=_create_super(es);function es(e){_class_call_check(this,es);var r;r=t.call(this,e),r.name="LevelNotDefined",r.message=null!=e?e:"Level is not defined";return _possible_constructor_return(r)}return es}(q);var ab=function(e){_inherits(we,e);var t=_create_super(we);function we(e){_class_call_check(this,we);var r;r=t.call(this,e),r.name="MatchModeNotDefined",r.message=null!=e?e:"Match id is not defined";return _possible_constructor_return(r)}return we}(q);var aI=r.Utils,ak=(aI.Object,aI.Valid);var aS=function(){function w(e){_class_call_check(this,w);u(this,"game");u(this,"match");u(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}_create_class(w,[{key:"setNext",value:function setNext(e){return this.nextHandler=e,e}},{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){t.logData("Before",e);return[2]})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:t.logData("After",e);r=t.nextHandler;if(!r)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:r=c.sent();c.label=2;case 2:return[2]}})})()}},{key:"logData",value:function logData(e,t){ak.isDebugger()}}]);return w}();var aD=r.Plugins,aP=r.Utils,aE=aD.Analytics,ax=aP.String,aC=aP.Valid;var aN=function(e){_inherits(B,e);var t=_create_super(B);function B(){_class_call_check(this,B);return t.apply(this,arguments)}_create_class(B,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(B.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,c=e.customData,l=c.level;r.validateMode(t),r.validateLevel(l);_=r.game,h=_.analytics;h.event(aE.Events.MATCH_START,{level:l,game_mode:ax.toUpperCamelCase(t),level_name:r.getLevelName(l)});return[4,r.nextAsync(e)];case 1:d.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!aC.isString(e))throw new ab}},{key:"validateLevel",value:function validateLevel(e){if(!aC.isNumber(e))throw new aw}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(ax.padStart(e.toString(),5,"0"))}}]);return B}(aS);var aT={OPEN:"open",ACTIVE:"active",FINISHED:"finished"};var aL=function(e){_inherits(M,e);var t=_create_super(M);function M(){_class_call_check(this,M);return t.apply(this,arguments)}_create_class(M,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(M.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,c=e.status;l=null!=t?t:eH.SINGLE;c===aT.FINISHED&&(l=eH.SINGLE),r.contextGameModeDetected(l);return[4,r.nextAsync(e)];case 1:_.sent();return[2]}})})()}},{key:"contextGameModeDetected",value:function contextGameModeDetected(e){var t=this.game,r=t.storage;r.setStorageData("context","contextGameMode",e)}}]);return M}(aS);var aM=function(e){_inherits(Ae,e);var t=_create_super(Ae);function Ae(e){_class_call_check(this,Ae);var r;r=t.call(this,e),r.name="GetMatchDetailFailed",r.message=null!=e?e:"Get match detail failed";return _possible_constructor_return(r)}return Ae}(_wrap_native_super(Error));var aO=function(e){_inherits(ns,e);var t=_create_super(ns);function ns(e){_class_call_check(this,ns);var r;r=t.call(this,e),r.name="MatchAreNotActive",r.message=null!=e?e:"Match are not active";return _possible_constructor_return(r)}return ns}(_wrap_native_super(Error));var aR=function(e){_inherits(Y,e);var t=_create_super(Y);function Y(e){_class_call_check(this,Y);var r;r=t.call(this,e),r.name="MatchIdNotValid",r.message=null!=e?e:"Match id is not valid";return _possible_constructor_return(r)}return Y}(q);var aF=function(e){_inherits(Sn,e);var t=_create_super(Sn);function Sn(e){_class_call_check(this,Sn);var r;r=t.call(this,e),r.name="OpponentHasFinishedMatch",r.message=e||"Opponent has finished match";return _possible_constructor_return(r)}return Sn}(_wrap_native_super(Error));var aG=function(e){_inherits(k,e);var t=_create_super(k);function k(e){_class_call_check(this,k);var r;r=t.call(this,e),r.name="OpponentIdNotValid",r.message=null!=e?e:"Opponent id is not valid";return _possible_constructor_return(r)}return k}(q);var aU=function(e){_inherits(Ie,e);var t=_create_super(Ie);function Ie(e){_class_call_check(this,Ie);var r;r=t.call(this,e),r.name="PlayerNotCurrentInMatch",r.message=null!=e?e:"The player is not currently in this match";return _possible_constructor_return(r)}return Ie}(_wrap_native_super(Error));var aV=function(e){_inherits(is,e);var t=_create_super(is);function is(e){_class_call_check(this,is);var r;r=t.call(this,e),r.name="PlayerNotFinishedMatch",r.message=e||"Player not finished match";return _possible_constructor_return(r)}return is}(_wrap_native_super(Error));var aj=r.Dtos;var aB=function(e){_inherits(En,e);var t=_create_super(En);function En(){_class_call_check(this,En);return t.apply(this,arguments)}_create_class(En,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(En.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=l.sent(),c=new aj.Match.Data(t).toObject();r.validateAwaitMatchData(e,c),r.updateMatchData(e,c),r.validateMatchStatus(e),r.validatePlayerTurn(e),r.validateOpponentTurn(e);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id;if("string"!=typeof t)throw new aR}},{key:"validateMatchStatus",value:function validateMatchStatus(e){var t=e.status;if(t!==aT.ACTIVE)throw new aO}},{key:"validateAwaitMatchData",value:function validateAwaitMatchData(e,t){var r=e.id,c=e.customData,l=t._id,_=t.whitePlayerId,h=t.blackPlayerId;if("string"!=typeof l||l!==r)throw new aM;var d=c.playerId,y=_===d,f=h===d;if(!y&&h===K.playerId)throw new e$;if(!y&&!f)throw new aU}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,c=r.playerId;if("string"!=typeof c)throw new Q;var l=t[c],_=l.finished;if(!_)throw new aV}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,r=e.customData,c=r.opponentId;if("string"!=typeof c)throw new aG;var l=t[c],_=l.finished;if(_)throw new aF}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,c=t.whitePlayerId,l=t.blackPlayerId,_=t.whitePlayerScore,h=t.blackPlayerScore,d=t.whitePlayerFinish,y=t.blackPlayerFinish,f=t.status;e.status=f;var p=c===r.playerId,v=p?c:l,g=p?l:c;e.customData.playerId=v,e.customData.opponentId=g,e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});var m=p?_:h,A=p?h:_;e.profiles[v].score=m,e.profiles[g].score=A;var I=p?d:y,E=p?y:d;e.profiles[v].finished=I,e.profiles[g].finished=E}}]);return En}(aS);var az={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null};var aH=function(e){_inherits(U,e);var t=_create_super(U);function U(e,r){_class_call_check(this,U);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(U,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(U.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.initializeMatch(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"initializeMatch",value:function initializeMatch(e){var t=this.payload,r=t.id,c=t.mode,l=t.customData;e.id=null!=r?r:null,e.mode=c||null,e.status=aT.OPEN,e.startAt=0,e.finishAt=0,e.profiles={},e.customData=_object_spread({},az,e.customData,l)}}]);return U}(aS);var aK=ez;var aW=function(e){_inherits(S,e);var t=_create_super(S);function S(e){_class_call_check(this,S);var r;r=t.call(this,e),r.name="UnavailableFeature",r.message="Unavailable feature: ".concat(e);return _possible_constructor_return(r)}return S}(_wrap_native_super(Error));var aq=function(e){_inherits(W,e);var t=_create_super(W);function W(e){_class_call_check(this,W);var r;r=t.call(this,e),r.name="ContextIdNotValid",r.message=null!=e?e:"Context id is not valid";return _possible_constructor_return(r)}return W}(q);var aJ=function(e){_inherits(vn,e);var t=_create_super(vn);function vn(){_class_call_check(this,vn);return t.apply(this,arguments)}_create_class(vn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(vn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesAwaitingAsync(e)];case 1:t=c.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,l=r.opponentId;if(!t||"string"!=typeof t)throw new aR;if(!c||"string"!=typeof c)throw new aq;if(!l||"string"!=typeof l)throw new aG}},{key:"createWideframesAwaitingAsync",value:function createWideframesAwaitingAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g,m,A,I,E,x,C;return _ts_generator(this,function(N){switch(N.label){case 0:N.trys.push([0,4,,5]);r=t.game,c=r.frameCapture,l=e.profiles,_=e.customData,h=_.playerId,d=_.opponentId;if(!h||!d)return[2,null];y=l[h],f=l[d],p=y.photo,v=y.score,g=void 0===v?0:v,m=y.finished;if(!m)return[2,null];A=f.photo,I=f.score,E=void 0===I?0:I,x=f.finished;if(!x)return[3,1];C=null;return[3,3];case 1:return[4,c.wideframe.renderResultChallenge({playerId:h,playerPhoto:p,playerScore:g,opponentId:d,opponentPhoto:A,opponentScore:E,isPlayerFinished:!0,isOpponentFinished:!1})];case 2:C=N.sent();N.label=3;case 3:return[2,C];case 4:N.sent();return[2,null];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,c,l,_,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:r=e.id,c=e.profiles,l=e.customData,_=l.playerId,h=l.opponentId;if(!_||"string"!=typeof _)throw new Q;if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");d=c[_],y=d.name,f={data:{type:aK.CHALLENGE_FRIEND,matchId:r,playerId:_,opponentId:h},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," is waiting for you to finish this game. Play now!"),localizations:{vi_VN:"".concat(y," đang chờ bạn kết th\xfac trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(f)];case 1:p.sent();return[2]}})})()}}]);return vn}(aS);var aY=function(e){_inherits(b,e);var t=_create_super(b);function b(){_class_call_check(this,b);return t.apply(this,arguments)}_create_class(b,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){switch(r.label){case 0:return[4,t.nextAsync(e)];case 1:r.sent();return[2]}})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:r=t.nextHandler;if(!r)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:r=c.sent();c.label=2;case 2:return[2]}})})()}}]);return b}(aS);var aZ=function(e){_inherits(j,e);var t=_create_super(j);function j(e){_class_call_check(this,j);var r;r=t.call(this,e),r.name="ProfileNotFound",r.message=null!=e?e:"Profile not found";return _possible_constructor_return(r)}return j}(q);var aQ=r.Dtos;var a$=function(e){_inherits(nt,e);var t=_create_super(nt);function nt(){_class_call_check(this,nt);return t.apply(this,arguments)}_create_class(nt,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(nt.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);t=e.customData,c=t.playerId,l=t.opponentId;_=c;return[4,r.getProfile(_)];case 1:h=y.sent();if(!h)throw new aZ;if(r.updateMatchProfile(e,_,h),_=l,_===K.playerId)return[3,3];return[4,r.getProfile(_)];case 2:d=y.sent();if(!d)throw new aZ;r.updateMatchProfile(e,_,d);return[3,4];case 3:r.updateMatchProfile(e,_);y.label=4;case 4:return[4,r.nextAsync(e)];case 5:y.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.customData,r=t.playerId,c=t.opponentId;if(!r||"string"!=typeof r)throw new Q;if(!c||"string"!=typeof c)throw new aG}},{key:"getProfile",value:function getProfile(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r=t.game,c=r.profile;return[4,c.requestProfiles([e])];case 1:return[2,(l.sent(),c.getProfiles()[e])]}})})()}},{key:"updateMatchProfile",value:function updateMatchProfile(e,t,r){var c=null!=r?r:K,l=c.name,_=c.photo,h=new aQ.Match.Profile({id:t,name:l,photo:_}).toObject();e.profiles[t]?(e.profiles[t].name=h.name,e.profiles[t].photo=h.photo):e.profiles[t]=h}}]);return nt}(aS);var aX=function(e){_inherits(bn,e);var t=_create_super(bn);function bn(){_class_call_check(this,bn);return t.apply(this,arguments)}_create_class(bn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,c=e.playerId,l=e.opponentId,_=new aY(t),d=new aH(t,{id:r,mode:h.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:l}});_.setNext(d);y=new aB(t);d.setNext(y);f=new a$(t);y.setNext(f);p=new aJ(t);f.setNext(p);v=new aN(t);p.setNext(v);g=new aL(t);v.setNext(g);m=t.match.getMatchState();return[4,_.processAsync(m)];case 1:A.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return bn}(aA);var a0=function(e){_inherits(Pe,e);var t=_create_super(Pe);function Pe(e){_class_call_check(this,Pe);var r;r=t.call(this,e),r.name="CreateContextFailed",r.message=null!=e?e:"Create context failed";return _possible_constructor_return(r)}return Pe}(q);var a2=r.Utils,a3=a2.Valid,a1=a2.Object;var a4=function(e){_inherits(Nn,e);var t=_create_super(Nn);function Nn(e,r){_class_call_check(this,Nn);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(Nn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Nn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.opponentId;return[4,r.createAsync(c)];case 1:l=_.sent();e.customData.contextId=l;return[4,r.nextAsync(e)];case 2:_.sent();return[2]}})})()}},{key:"createAsync",value:function createAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,2,,3]);return[4,GameSDK.context.createAsync(e)];case 1:l.sent();return[3,3];case 2:r=l.sent();t.validateError(r);return[3,3];case 3:c=GameSDK.context.getID();if(!a3.isString(c))throw new a0;return[2,c]}})})()}},{key:"validateError",value:function validateError(e){if(!a1.hasOwn(e,"code"))throw e;if("SAME_CONTEXT"!==e.code){if("INVALID_PARAM"===e.code){if(!this.isNotConnectedPlayerError(e))throw e;return}throw e}}},{key:"validateErrorMessage",value:function validateErrorMessage(e){if(!a1.hasOwn(e,"message")||!a3.isString(e.message))throw e}},{key:"isNotConnectedPlayerError",value:function isNotConnectedPlayerError(e){return this.validateErrorMessage(e),e.message.indexOf("is not a connected player of the current player")>-1}}]);return Nn}(aS);var a5=function(e){_inherits(Vt,e);var t=_create_super(Vt);function Vt(e){_class_call_check(this,Vt);var r;r=t.call(this,e),r.name="MatchAreNotOpen",r.message=null!=e?e:"Match are not open";return _possible_constructor_return(r)}return Vt}(q);var a6=r.Dtos;var a7=function(e){_inherits(cs,e);var t=_create_super(cs);function cs(e,r){_class_call_check(this,cs);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(cs,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(cs.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createMatchAsync(e)];case 1:t=l.sent(),c=new a6.Match.Data(t).toObject();r.updateMatchState(e,c);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.status,r=e.customData,c=r.opponentId;if("string"!=typeof c)throw new aG;if(t!==aT.OPEN)throw new a5}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h;return _ts_generator(this,function(d){r=e.customData,c=r.opponentId,l=t.payload,_=l.extraData;if(!c)return[2,{}];h={opponentPlayerId:c,extraData:_};return[2,t.match.api.getMatchAPI().createMatchAsync(h)]})})()}},{key:"updateMatchState",value:function updateMatchState(e,t){var r=e.customData,c=t._id,l=t.whitePlayerId,_=t.blackPlayerId,h=t.whitePlayerFinish,d=t.blackPlayerFinish,y=l===r.opponentId;e.id=c||null;var f=y?_:l,p=y?l:_;e.customData.playerId=f,e.customData.opponentId=p,e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1});var v=y?d:h,g=y?h:d;e.profiles[f].finished=v,e.profiles[p].finished=g}}]);return cs}(aS);var a8=function(e){_inherits(z,e);var t=_create_super(z);function z(){_class_call_check(this,z);return t.apply(this,arguments)}_create_class(z,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(z.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(_superprop_get_processAsync().call(r,e),e.status!==aT.OPEN)throw new a5;r.startMatch(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"startMatch",value:function startMatch(e){e.status=aT.ACTIVE,e.startAt=Date.now()}}]);return z}(aS);var a9=function(e){_inherits(ls,e);var t=_create_super(ls);function ls(){_class_call_check(this,ls);return t.apply(this,arguments)}_create_class(ls,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ls.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesChallengeAsync(e)];case 1:t=c.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,l=r.opponentId;if(!t||"string"!=typeof t)throw new aR;if(!c||"string"!=typeof c)throw new aq;if(!l||"string"!=typeof l)throw new aG}},{key:"createWideframesChallengeAsync",value:function createWideframesChallengeAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g,m,A,I;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);r=t.game,c=r.frameCapture,l=e.profiles,_=e.customData,h=_.playerId,d=_.opponentId;if(!h||!d)return[2,null];y=l[h],f=l[d],p=y.photo,v=y.score,g=void 0===v?0:v,m=f.photo,A=f.score,I=void 0===A?0:A;return[4,c.wideframe.renderResultChallenge({playerId:h,playerPhoto:p,playerScore:g,opponentId:d,opponentPhoto:m,opponentScore:I,isPlayerFinished:!1,isOpponentFinished:!1})];case 1:return[2,E.sent()];case 2:E.sent();return[2,null];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,c,l,_,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:r=e.id,c=e.profiles,l=e.customData,_=l.playerId,h=l.opponentId;if(!_||"string"!=typeof _)throw new Q;if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");d=c[_],y=d.name,f={data:{type:aK.CHALLENGE_FRIEND,matchId:r,playerId:_,opponentId:h},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," challenges you"),localizations:{vi_VN:"".concat(y," thử th\xe1ch bạn trong trận đấu n\xe0y. Chơi ngay!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(f)];case 1:p.sent();return[2]}})})()}}]);return ls}(aS);var re=function(e){_inherits(Ln,e);var t=_create_super(Ln);function Ln(){_class_call_check(this,Ln);return t.apply(this,arguments)}_create_class(Ln,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m,A;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.opponentId,l=new aY(t),_=new a4(t,{opponentId:c});l.setNext(_);d=new aH(t,{mode:h.CHALLENGE_FRIEND,customData:{playerId:r,opponentId:c}});_.setNext(d);y=new a7(t,{extraData:e.extraData});d.setNext(y);f=new a$(t);y.setNext(f);p=new a8(t);f.setNext(p);v=new aN(t);p.setNext(v);g=new a9(t);v.setNext(g);m=new aL(t);g.setNext(m);A=t.match.getMatchState();return[4,l.processAsync(A)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Ln}(aA);var rt=function(e){_inherits(Se,e);var t=_create_super(Se);function Se(e){_class_call_check(this,Se);var r;r=t.call(this,e),r.name="SameContext",r.message=null!=e?e:"Same context";return _possible_constructor_return(r)}return Se}(_wrap_native_super(Error));var rr=r.Utils;var rn=function(e){_inherits(kt,e);var t=_create_super(kt);function kt(e,r){_class_call_check(this,kt);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(kt,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(kt.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.contextId;return[4,r.switchAsync(c)];case 1:l.sent(),e.customData.contextId=c;return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"checkSameContext",value:function checkSameContext(e){var t="SOLO"===e,r=GameSDK.context.getID();if(r===e)throw new rt;if(t&&null===r)throw new rt}},{key:"switchAsync",value:function switchAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r="SOLO"===e;l.label=1;case 1:l.trys.push([1,3,,4]);t.checkSameContext(e);return[4,GameSDK.context.switchAsync(e,r)];case 2:l.sent();return[3,4];case 3:c=l.sent();if(_instanceof(c,rt))return[2];if(!rr.Object.hasOwn(c,"code"))throw c;if(rr.Device.isAndroid()&&r&&"INVALID_PARAM"===c.code)return[2];if("SAME_CONTEXT"!==c.code)throw c;return[3,4];case 4:return[2]}})})()}}]);return kt}(aS);var rs=r.Dtos;var ro=function(e){_inherits(Tn,e);var t=_create_super(Tn);function Tn(){_class_call_check(this,Tn);return t.apply(this,arguments)}_create_class(Tn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Tn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=l.sent(),c=new rs.Match.Data(t).toObject();r.validateContinueMatchData(e,c),r.updateMatchData(e,c),r.validatePlayerTurn(e);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id,r=e.status;if("string"!=typeof t)throw new aR;if(r!==aT.OPEN)throw new a5}},{key:"validateContinueMatchData",value:function validateContinueMatchData(e,t){var r=e.id,c=e.customData,l=t._id,_=t.whitePlayerId,h=t.blackPlayerId;if("string"!=typeof l||l!==r)throw new aM;var d=c.playerId,y=_===d,f=h===d;if(!y&&h===K.playerId)throw new e$;if(!y&&!f)throw new aU}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,c=r.playerId;if("string"!=typeof c)throw new Q;var l=t[c],_=l.finished;if(_)throw new eQ}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,c=t.whitePlayerId,l=t.blackPlayerId,_=t.whitePlayerScore,h=t.blackPlayerScore,d=t.whitePlayerFinish,y=t.blackPlayerFinish,f=c===r.playerId,p=f?c:l,v=f?l:c;e.customData.playerId=p,e.customData.opponentId=v,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1});var g=f?_:h,m=f?h:_;e.profiles[p].score=g,e.profiles[v].score=m;var A=f?d:y,I=f?y:d;e.profiles[p].finished=A,e.profiles[v].finished=I}}]);return Tn}(aS);var rc=function(e){_inherits(On,e);var t=_create_super(On);function On(){_class_call_check(this,On);return t.apply(this,arguments)}_create_class(On,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(On.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesCurrentScoreAsync()];case 1:t=c.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,l=r.opponentId;if(!t||"string"!=typeof t)throw new aR;if(!c||"string"!=typeof c)throw new aq;if(!l||"string"!=typeof l)throw new aG}},{key:"createWideframesCurrentScoreAsync",value:function createWideframesCurrentScoreAsync(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,2,,3]);t=e.game,r=t.player,c=t.frameCapture,l=r.getPlayer(),_=l.playerId,h=l.photo,d=e.match.getMatchState(),y=d.profiles,f=y[_]||{},p=f.score,v=void 0===p?0:p;return[4,c.wideframe.renderShareScore({playerId:_,playerPhoto:h,playerScore:v})];case 1:return[2,g.sent()];case 2:g.sent();return[2,null];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,c,l,_,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:r=e.id,c=e.profiles,l=e.customData,_=l.playerId,h=l.opponentId;if(!_||"string"!=typeof _)throw new Q;if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");d=c[_],y=d.name,f={data:{type:aK.CHALLENGE_FRIEND,matchId:r,playerId:_,opponentId:h},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," made an update."),localizations:{vi_VN:"".concat(y," đ\xe3 cập nhật trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");return[4,GameSDK.extra.updateAsync(f)];case 1:p.sent();return[2]}})})()}}]);return On}(aS);var ru=function(e){_inherits(Rn,e);var t=_create_super(Rn);function Rn(){_class_call_check(this,Rn);return t.apply(this,arguments)}_create_class(Rn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m,A,I,E;return _ts_generator(this,function(x){switch(x.label){case 0:x.trys.push([0,,2,3]);t.startLog(e);r=e.contextId,c=e.matchId,l=e.playerId,_=e.opponentId,d=new aY(t),y=new rn(t,{contextId:r});d.setNext(y);f=new aH(t,{id:c,mode:h.CHALLENGE_FRIEND,customData:{playerId:l,opponentId:_}});y.setNext(f);p=new ro(t);f.setNext(p);v=new a$(t);p.setNext(v);g=new a8(t);v.setNext(g);m=new rc(t);g.setNext(m);A=new aN(t);m.setNext(A);I=new aL(t);A.setNext(I);E=t.match.getMatchState();return[4,d.processAsync(E)];case 1:x.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Rn}(aA);var rl=r.Plugins,r_=r.Utils,rh=rl.Analytics,rd=r_.String,ry=r_.Valid;var rf=function(e){_inherits(Ct,e);var t=_create_super(Ct);function Ct(){_class_call_check(this,Ct);return t.apply(this,arguments)}_create_class(Ct,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ct.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:_superprop_get_processAsync().call(r,e);t=e.customData,c=e.mode,l=e.startAt,_=e.finishAt,h=t.level;r.validateMode(c),r.validateLevel(h);d=r.game,y=d.analytics,f=Math.floor((_-l)/1e3);y.event(rh.Events.MATCH_END,{level:h,game_mode:rd.toUpperCamelCase(c),level_name:r.getLevelName(h),time_played:f});return[4,r.nextAsync(e)];case 1:p.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!ry.isString(e))throw new ab}},{key:"validateLevel",value:function validateLevel(e){if(!ry.isNumber(e))throw new aw}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(rd.padStart(e.toString(),5,"0"))}}]);return Ct}(aS);var rp=function(e){_inherits(Ut,e);var t=_create_super(Ut);function Ut(e){_class_call_check(this,Ut);var r;r=t.call(this,e),r.name="ScoreNotValid",r.message=null!=e?e:"Score is not valid";return _possible_constructor_return(r)}return Ut}(_wrap_native_super(Error));var rv=function(e){_inherits(bt,e);var t=_create_super(bt);function bt(e){_class_call_check(this,bt);var r;r=t.call(this,e),r.name="LeaderboardIdNotValid",r.message=null!=e?e:"Leaderboard id is not valid";return _possible_constructor_return(r)}return bt}(_wrap_native_super(Error));var rg=function(e){_inherits(Vn,e);var t=_create_super(Vn);function Vn(e){_class_call_check(this,Vn);var r;r=t.call(this,e),r.name="LeaderboardNotExist",r.message=null!=e?e:"Leaderboard not exist in game";return _possible_constructor_return(r)}return Vn}(_wrap_native_super(Error));var rm=r.Utils,rA=rm.Valid;var rw=function(e){_inherits(Ht,e);var t=_create_super(Ht);function Ht(e,r){_class_call_check(this,Ht);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");u(_assert_this_initialized(c),"leaderboardPayload");c.payload=r;return c}_create_class(Ht,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ht.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.setupSetScorePayload(e);t="submitGameResultsAsync"in GameSDK.extra;if(!t)return[3,2];return[4,GameSDK.extra.submitGameResultsAsync(r.payload.score)];case 1:t=c.sent();c.label=2;case 2:r.setLeaderboardScoreAsync();return[4,r.nextAsync(e)];case 3:c.sent();return[2]}})})()}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d;return _ts_generator(this,function(y){r=e.profiles,c=e.customData,l=c.playerId;if(!l||!r[l])throw new aZ;_=t.payload,h=_.score,d=_.leaderboardId;if(!rA.isNumber(h))throw new rp;if(!rA.isString(d))throw new rv;t.leaderboardPayload={score:h,playerId:l,leaderboardId:d};return[2]})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(){var e=this;return _async_to_generator(function(){var t,r,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:h.trys.push([0,2,,3]);t=e.leaderboardPayload,r=t.playerId,c=t.score,l=t.leaderboardId,_=e.game.leaderboard.getLeaderboardName(l);if(!_)throw new rg;return[4,e.game.leaderboard.setLeaderboardScoreAsync(_,r,c)];case 1:h.sent();return[3,3];case 2:h.sent();return[3,3];case 3:return[2]}})})()}}]);return Ht}(aS);var rb=r.Utils,rI=rb.Valid,rk=r.Configs,rS=rk.Leaderboards;var rD=function(e){_inherits(xe,e);var t=_create_super(xe);function xe(e){_class_call_check(this,xe);return t.call(this,e,{score:0,leaderboardId:rS.LeaderboardId})}_create_class(xe,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(xe.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,c,l,_,h;return _ts_generator(this,function(d){t=e.profiles,c=e.customData,l=c.playerId;if(!l||!t[l])throw new aZ;_=t[l],h=_.score;if(!rI.isNumber(h))throw new rp;r.payload.score=h,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return xe}(rw);var rP=r.Dtos,rE=r.Utils,rx=rE.Valid,rC=rE.Object;var rN=function(e){_inherits(Nt,e);var t=_create_super(Nt);function Nt(e,r){_class_call_check(this,Nt);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(Nt,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Nt.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);t=r.payload,c=t.useAPI;if(!c)return[3,2];return[4,r.finishMatchAsync(e)];case 1:l=h.sent(),_=new rP.Match.Data(l).toObject();r.updateMatchFromAPI(e,_);return[3,3];case 2:r.updateMatchData(e);h.label=3;case 3:r.updateMatchState(e);return[4,r.nextAsync(e)];case 4:h.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status,r=e.profiles,c=e.customData;if(t!==aT.ACTIVE)throw new aO;var l=c.playerId;if(!l||!rC.hasOwn(r,l))throw new aU}},{key:"updateMatchData",value:function updateMatchData(e){var t=e.customData,r=t.playerId;if(!rx.isString(r))throw new Q;e.profiles[r].finished=!0}},{key:"updateMatchState",value:function updateMatchState(e){e.status=aT.FINISHED,e.finishAt=Date.now()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v;return _ts_generator(this,function(g){r=e.id,c=e.profiles,l=e.customData,_=l.level,h=l.playerId;if(!rx.isString(h))throw new Q;d=c[h],y=d.score,f=t.payload,p=f.extraData,v={matchId:null!=r?r:"",score:y,level:_,extraData:p};return[2,t.match.api.getMatchAPI().finishMatchAsync(v)]})})()}},{key:"updateMatchFromAPI",value:function updateMatchFromAPI(e,t){var r=e.customData,c=r.playerId,l=r.opponentId;if(!rx.isString(c))throw new Q;if(!rx.isString(l))throw new aG;var _=t.whitePlayerId,h=t.whitePlayerScore,d=t.blackPlayerScore,y=t.whitePlayerFinish,f=t.blackPlayerFinish,p=c===_,v=p?h:d,g=p?d:h,m=p?y:f,A=p?f:y;e.profiles[c].score=v,e.profiles[l].score=g,e.profiles[c].finished=m,e.profiles[l].finished=A}}]);return Nt}(aS);var rT=function(e){_inherits(Kn,e);var t=_create_super(Kn);function Kn(){_class_call_check(this,Kn);return t.apply(this,arguments)}_create_class(Kn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Kn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesResultAsync(e)];case 1:t=c.sent();t&&r.progressSendFinishedMessage(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,l=r.opponentId;if(!t||"string"!=typeof t)throw new aR;if(!c||"string"!=typeof c)throw new aq;if(!l||"string"!=typeof l)throw new aG}},{key:"createWideframesResultAsync",value:function createWideframesResultAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g,m,A,I,E,x;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,2,,3]);r=t.game,c=r.frameCapture,l=e.profiles,_=e.customData,h=_.playerId,d=_.opponentId;if(!h||!d)return[2,null];y=l[h],f=l[d],p=y.photo,v=y.score,g=void 0===v?0:v,m=y.finished,A=f.photo,I=f.score,E=void 0===I?0:I,x=f.finished;return[4,c.wideframe.renderResultChallenge({playerId:h,playerPhoto:p,playerScore:g,opponentId:d,opponentPhoto:A,opponentScore:E,isPlayerFinished:!!m,isOpponentFinished:!!x})];case 1:return[2,C.sent()];case 2:C.sent();return[2,null];case 3:return[2]}})})()}},{key:"progressSendFinishedMessage",value:function progressSendFinishedMessage(e,t){var r=e.profiles,c=e.customData,l=c.playerId,_=c.opponentId;if(!l||"string"!=typeof l)throw new Q;if(!_||"string"!=typeof _)throw new aG;var h=r[l],d=h.score,y=void 0===d?0:d,f=h.finished,p=r[_],v=p.score,g=void 0===v?0:v,m=p.finished;f?this.sendFinishMessageAsync(e,t):m&&y>g?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}},{key:"sendFinishMessageAsync",value:function sendFinishMessageAsync(e,t){return _async_to_generator(function(){var r,c,l,_,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:r=e.id,c=e.profiles,l=e.customData,_=l.playerId,h=l.opponentId;if(!_||"string"!=typeof _)throw new Q;if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");d=c[_],y=d.name,f={data:{type:aK.CHALLENGE_FRIEND,matchId:r,playerId:_,opponentId:h,status:aT.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(y," just finished. Check them now."),localizations:{vi_VN:"".concat(y," vừa ho\xe0n th\xe0nh m\xe0n chơi. Nhấn để xem kết quả trận đấu.")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");return[4,GameSDK.extra.updateAsync(f)];case 1:p.sent();return[2]}})})()}},{key:"sendPlayTurnMessageAsync",value:function sendPlayTurnMessageAsync(e,t){return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,c=e.profiles,l=e.customData,_=l.playerId,h=l.opponentId;if(!_||"string"!=typeof _)throw new Q;d=c[_],y=d.name,f=d.score,p={data:{type:aK.CHALLENGE_FRIEND,matchId:r,playerId:_,opponentId:h,status:aT.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," got ").concat(f," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(y," đ\xe3 đạt ").concat(f," điểm! Nhấn Chơi để so t\xe0i!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,c=e.profiles,l=e.customData,_=l.playerId,h=l.opponentId;if(!_||"string"!=typeof _)throw new Q;d=c[_],y=d.name,f=d.score,p={data:{type:aK.CHALLENGE_FRIEND,matchId:r,playerId:_,opponentId:h,status:aT.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(y," beat your high score. Their score: ").concat(f),localizations:{vi_VN:"".concat(y," đ\xe3 vượt qua điểm số của bạn, với ").concat(f," điểm!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");return[4,GameSDK.extra.updateAsync(p)];case 1:v.sent();return[2]}})})()}}]);return Kn}(aS);var rL=function(e){_inherits(jt,e);var t=_create_super(jt);function jt(){_class_call_check(this,jt);return t.apply(this,arguments)}_create_class(jt,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(jt.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.setPlayerBestScore(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"setPlayerBestScore",value:function setPlayerBestScore(e){var t=e.profiles,r=e.customData,c=r.playerId;if(!c||!t[c])throw new aZ;var l=this.game,_=l.player,h=_.getBestScore()||0,d=t[c],y=d.score,f=void 0===y?0:y;f<=h||(_.setBestScore(f),t[c].bestScore=f)}}]);return jt}(aS);var rM=function(e){_inherits(Wn,e);var t=_create_super(Wn);function Wn(){_class_call_check(this,Wn);return t.apply(this,arguments)}_create_class(Wn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,,2,3]);t.startLog(e);r=null!=e?e:{},c=r.extraData,l=new aY(t),_=new rN(t,{useAPI:!0,extraData:c});l.setNext(_);h=new rT(t);_.setNext(h);d=new rf(t);h.setNext(d);y=new rL(t);d.setNext(y);f=new rD(t);y.setNext(f);p=new aL(t);f.setNext(p);v=t.match.getMatchState();return[4,l.processAsync(v)];case 1:g.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Wn}(aA);var rO=function(e){_inherits(zn,e);var t=_create_super(zn);function zn(e){_class_call_check(this,zn);var r;r=t.call(this,e),r.name="ContextAreSolo",r.message=null!=e?e:"Context are solo";return _possible_constructor_return(r)}return zn}(_wrap_native_super(Error));var rR=function(e){_inherits(qn,e);var t=_create_super(qn);function qn(e){_class_call_check(this,qn);var r;r=t.call(this,e),r.name="ContextNotChallenge",r.message=null!=e?e:"Context is not a challenge";return _possible_constructor_return(r)}return qn}(_wrap_native_super(Error));var rF=function(e){_inherits(Jn,e);var t=_create_super(Jn);function Jn(e){_class_call_check(this,Jn);var r;r=t.call(this,e),r.name="NetworkFailure",r.message=null!=e?e:"Network failure";return _possible_constructor_return(r)}return Jn}(_wrap_native_super(Error));var rG=r.Utils,rU=r.Dtos,rV=rG.Array,rj=rG.Object;var rB=function(e){_inherits(ps,e);var t=_create_super(ps);function ps(e,r){_class_call_check(this,ps);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(ps,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ps.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.checkCurrentContext();return[4,r.getOpponentIdFromContextAsync()];case 1:t=c.sent();e.customData.opponentId=t;return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"checkCurrentContext",value:function checkCurrentContext(){var e=GameSDK.context.getID();if("string"!=typeof e)throw new aq;if("SOLO"===e)throw new rO}},{key:"getOpponentIdFromContextAsync",value:function getOpponentIdFromContextAsync(){var e=this;return _async_to_generator(function(){var t,r,c,l;return _ts_generator(this,function(_){switch(_.label){case 0:t=e.payload,r=t.ignoreId;return[4,e.getContextPlayers([r])];case 1:c=_.sent();if(c.length>1)throw new rR;l=K;return[2,(1===c.length&&(l=c[0]),l.playerId)]}})})()}},{key:"getContextPlayers",value:function getContextPlayers(e){return _async_to_generator(function(){var t,r,c,l,_,h,d,y,f,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,2,,3]);return[4,GameSDK.context.getPlayersAsync()];case 1:t=m.sent(),r=[];c=true,l=false,_=void 0;try{for(h=t[Symbol.iterator]();!(c=(d=h.next()).done);c=true){y=d.value;f=y.getID();if(!(e.indexOf(f)>-1)){p=y.getName();if(!!p){v=y.getPhoto();r.push(new rU.Player.Info({playerId:f,name:p,photo:v}).toObject())}}}}catch(e){l=true;_=e}finally{try{if(!c&&null!=h.return)h.return()}finally{if(l)throw _}}return[2,rV.unique(r)];case 2:g=m.sent();if(rj.hasOwn(g,"code")&&"NETWORK_FAILURE"===g.code)throw new rF;return[2,[]];case 3:return[2]}})})()}}]);return ps}(aS);var rz=function(e){_inherits(Ee,e);var t=_create_super(Ee);function Ee(e){_class_call_check(this,Ee);var r;r=t.call(this,e),r.name="ContextIsTournament",r.message=null!=e?e:"Context is a tournament";return _possible_constructor_return(r)}return Ee}(_wrap_native_super(Error));var rH=r.Utils,rK=rH.Object;var rW=function(e){_inherits(ei,e);var t=_create_super(ei);function ei(){_class_call_check(this,ei);return t.apply(this,arguments)}_create_class(ei,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ei.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.chooseAsync()];case 1:t=c.sent();return[4,r.checkContextTournament()];case 2:c.sent(),e.customData.contextId=t;return[4,r.nextAsync(e)];case 3:c.sent();return[2]}})})()}},{key:"chooseAsync",value:function chooseAsync(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})];case 1:r.sent();return[3,3];case 2:e=r.sent();if(!rK.hasOwn(e,"code")||"SAME_CONTEXT"!==e.code)throw e;return[3,3];case 3:t=GameSDK.context.getID();if("string"!=typeof t)throw new a0;return[2,t]}})})()}},{key:"checkContextTournament",value:function checkContextTournament(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,4,,5]);if(!GameSDK.context.getID())return[2];if(!("getTournamentAsync"in GameSDK))return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:e=(r.sent(),new rz);return[3,3];case 2:e=new aW("getTournamentAsync");r.label=3;case 3:throw e;case 4:t=r.sent();if(_instanceof(t,rz))throw t;return[3,5];case 5:return[2]}})})()}}]);return ei}(aS);var rq=function(e){_inherits(si,e);var t=_create_super(si);function si(){_class_call_check(this,si);return t.apply(this,arguments)}_create_class(si,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m,A;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=new aY(t),l=new rW(t);c.setNext(l);_=new aH(t,{mode:h.CHALLENGE_FRIEND,customData:{playerId:r}});l.setNext(_);d=new rB(t,{ignoreId:r});_.setNext(d);y=new a7(t,{extraData:e.extraData});d.setNext(y);f=new a$(t);y.setNext(f);p=new a8(t);f.setNext(p);v=new aN(t);p.setNext(v);g=new a9(t);v.setNext(g);m=new aL(t);g.setNext(m);A=t.match.getMatchState();return[4,c.processAsync(A)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return si}(aA);var rJ=function(e){_inherits(ai,e);var t=_create_super(ai);function ai(e){_class_call_check(this,ai);var r;r=t.call(this,e),r.name="JoinMatchFailed",r.message=null!=e?e:"Join match failed";return _possible_constructor_return(r)}return ai}(_wrap_native_super(Error));var rY=function(e){_inherits(ni,e);var t=_create_super(ni);function ni(e){_class_call_check(this,ni);var r;r=t.call(this,e),r.name="MatchAreFinished",r.message=null!=e?e:"Match are finished";return _possible_constructor_return(r)}return ni}(_wrap_native_super(Error));var rZ=function(e){_inherits(ii,e);var t=_create_super(ii);function ii(e){_class_call_check(this,ii);var r;r=t.call(this,e),r.name="OtherPlayerHasJoinedMatch",r.message=null!=e?e:"Other player has joined match";return _possible_constructor_return(r)}return ii}(_wrap_native_super(Error));var rQ=r.Dtos;var r$=function(e){_inherits(ri,e);var t=_create_super(ri);function ri(){_class_call_check(this,ri);return t.apply(this,arguments)}_create_class(ri,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ri.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.joinMatchAsync(e)];case 1:t=l.sent(),c=new rQ.Match.Data(t).toObject();r.validateJoinMatchData(e,c),r.updateMatchData(e,c);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status;if(t!==aT.OPEN)throw new a5}},{key:"validateJoinMatchData",value:function validateJoinMatchData(e,t){var r=e.id,c=e.customData,l=t._id,_=t.blackPlayerId,h=t.whitePlayerId,d=t.whitePlayerFinish,y=t.blackPlayerFinish,f=_===c.playerId,p=h===c.opponentId;if("string"!=typeof l||l!==r||!p)throw new rJ;if(d&&y)throw new rY;if(!f)throw new rZ}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){r=e.id;return[2,r?t.match.api.getMatchAPI().joinMatchAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,c=t.whitePlayerId,l=t.blackPlayerId,_=t.whitePlayerScore,h=t.blackPlayerScore,d=t.whitePlayerFinish,y=t.blackPlayerFinish,f=c===r.playerId,p=f?c:l,v=f?l:c;e.customData.playerId=p,e.customData.opponentId=v,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1});var g=f?_:h,m=f?h:_;e.profiles[p].score=g,e.profiles[v].score=m;var A=f?d:y,I=f?y:d;e.profiles[p].finished=A,e.profiles[v].finished=I}}]);return ri}(aS);var rX=function(e){_inherits(ci,e);var t=_create_super(ci);function ci(){_class_call_check(this,ci);return t.apply(this,arguments)}_create_class(ci,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ci.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesAcceptedAsync(e)];case 1:t=c.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:c.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,l=r.opponentId;if(!t||"string"!=typeof t)throw new aR;if(!c||"string"!=typeof c)throw new aq;if(!l||"string"!=typeof l)throw new aG}},{key:"createWideframesAcceptedAsync",value:function createWideframesAcceptedAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g,m,A,I,E,x,C;return _ts_generator(this,function(N){switch(N.label){case 0:N.trys.push([0,4,,5]);r=t.game,c=r.frameCapture,l=e.profiles,_=e.customData,h=_.playerId,d=_.opponentId;if(!h||!d)return[2,null];y=l[h],f=l[d],p=y.photo,v=y.score,g=void 0===v?0:v,m=y.finished;if(m)return[2,null];A=f.photo,I=f.score,E=void 0===I?0:I,x=f.finished;if(!x)return[3,2];return[4,c.wideframe.renderResultChallenge({playerId:h,playerPhoto:p,playerScore:g,opponentId:d,opponentPhoto:A,opponentScore:E,isPlayerFinished:!1,isOpponentFinished:!0})];case 1:C=N.sent();return[3,3];case 2:C=null;N.label=3;case 3:return[2,C];case 4:N.sent();return[2,null];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,c,l,_,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:r=e.id,c=e.profiles,l=e.customData,_=l.playerId,h=l.opponentId;if(!_||"string"!=typeof _)throw new Q;if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");d=c[_],y=d.name,f={data:{type:aK.CHALLENGE_FRIEND,matchId:r,playerId:_,opponentId:h},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," accepted the challenge."),localizations:{vi_VN:"".concat(y," đ\xe3 chấp nhận tham gia trận đấu.")}},image:t,strategy:"LAST",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(f)];case 1:p.sent();return[2]}})})()}}]);return ci}(aS);var r0=function(e){_inherits(li,e);var t=_create_super(li);function li(){_class_call_check(this,li);return t.apply(this,arguments)}_create_class(li,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m,A;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,c=e.playerId,l=e.opponentId,_=new aY(t),d=new aH(t,{id:r,mode:h.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:l}});_.setNext(d);y=new r$(t);d.setNext(y);f=new a$(t);y.setNext(f);p=new a8(t);f.setNext(p);v=new rX(t);p.setNext(v);g=new aN(t);v.setNext(g);m=new aL(t);g.setNext(m);A=t.match.getMatchState();return[4,_.processAsync(A)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return li}(aA);var r2={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},r3=r.Utils,r1=r3.Valid,r4="is invalid";var r5=function(e){_inherits(ve,e);var t=_create_super(ve);function ve(){_class_call_check(this,ve);return t.apply(this,arguments)}_create_class(ve,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){r1.isString(e)&&e||this.exception("_id",r4)}},{key:"validateStatus",value:function validateStatus(e){r1.isString(e)&&e||this.exception("status",r4)}},{key:"validateWinnerId",value:function validateWinnerId(e){null===e||r1.isString(e)&&e||this.exception("winnerId",r4)}},{key:"validateWhitePlayerId",value:function validateWhitePlayerId(e){r1.isString(e)&&e||this.exception("whitePlayerId",r4)}},{key:"validateBlackPlayerId",value:function validateBlackPlayerId(e){r1.isString(e)&&e||this.exception("blackPlayerId",r4)}},{key:"validateWhitePlayerScore",value:function validateWhitePlayerScore(e){r1.isNumber(e)||this.exception("whitePlayerScore",r4)}},{key:"validateBlackPlayerScore",value:function validateBlackPlayerScore(e){r1.isNumber(e)||this.exception("blackPlayerScore",r4)}},{key:"validateWhitePlayerFinish",value:function validateWhitePlayerFinish(e){r1.isBoolean(e)||this.exception("whitePlayerFinish",r4)}},{key:"validateBlackPlayerFinish",value:function validateBlackPlayerFinish(e){r1.isBoolean(e)||this.exception("blackPlayerFinish",r4)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(ve.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return r2}}]);return ve}(E);r5.addDefaultData(r2);var r6=function(e){_inherits(di,e);var t=_create_super(di);function di(e){_class_call_check(this,di);var r;r=t.call(this,e),r.name="MatchAreNotFinished",r.message=e||"Match are not finished";return _possible_constructor_return(r)}return di}(_wrap_native_super(Error));var r7=function(e){_inherits(hi,e);var t=_create_super(hi);function hi(e){_class_call_check(this,hi);var r;r=t.call(this,e),r.name="OpponentNotFinishedMatch",r.message=e||"Opponent not finished match";return _possible_constructor_return(r)}return hi}(_wrap_native_super(Error));var r8=function(e){_inherits(ui,e);var t=_create_super(ui);function ui(){_class_call_check(this,ui);return t.apply(this,arguments)}_create_class(ui,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ui.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=l.sent(),c=new r5(t).toObject();r.validateResultMatchData(e,c),r.updateMatchData(e,c),r.validatePlayerTurn(e),r.validateOpponentTurn(e);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id;if("string"!=typeof t)throw new aR}},{key:"validateResultMatchData",value:function validateResultMatchData(e,t){var r=e.id,c=t._id,l=t.whitePlayerFinish,_=t.blackPlayerFinish;if("string"!=typeof c||c!==r)throw new aM;if(!l&&!_)throw new r6}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,c=r.playerId;if("string"!=typeof c)throw new Q;var l=t[c],_=l.finished;if(!_)throw new aV}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,r=e.customData,c=r.opponentId;if("string"!=typeof c)throw new aG;var l=t[c],_=l.finished;if(!_)throw new r7}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,c=t.whitePlayerId,l=t.blackPlayerId,_=t.whitePlayerScore,h=t.blackPlayerScore,d=t.whitePlayerFinish,y=t.blackPlayerFinish,f=c===r.playerId,p=f?c:l,v=f?l:c;e.customData.playerId=p,e.customData.opponentId=v,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!0}),e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!0});var g=f?_:h,m=f?h:_;e.profiles[p].score=g,e.profiles[v].score=m;var A=f?d:y,I=f?y:d;e.profiles[p].finished=A,e.profiles[v].finished=I}}]);return ui}(aS);var r9=function(e){_inherits(yi,e);var t=_create_super(yi);function yi(){_class_call_check(this,yi);return t.apply(this,arguments)}_create_class(yi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,c=e.playerId,l=e.opponentId,_=new aY(t),d=new aH(t,{id:r,mode:h.CHALLENGE_FRIEND,customData:{playerId:c,opponentId:l}});_.setNext(d);y=new r8(t);d.setNext(y);f=new a$(t);y.setNext(f);p=new aL(t);f.setNext(p);v=t.match.getMatchState();return[4,_.processAsync(v)];case 1:g.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return yi}(aA);var ne=function(e){_inherits(pi,e);var t=_create_super(pi);function pi(){_class_call_check(this,pi);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"fallbackSingleMode");var r=_assert_this_initialized(e);u(_assert_this_initialized(e),"startFLowChallengeFriend",function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,3]);return[4,r.match.challenge.invite.processAsync(e)];case 1:return[2,(c.sent(),!0)];case 2:t=c.sent();return[2,t];case 3:return[2]}})});return function(t){return e.apply(this,arguments)}}());var c=_assert_this_initialized(e);u(_assert_this_initialized(e),"startFlowTournament",function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,4]);t=GameSDK.context.getID();if("string"!=typeof t)throw new aq;return[4,c.match.tournament.continue.processAsync({playerId:e,contextId:t})];case 1:r.sent();return[3,4];case 2:r.sent();return[4,c.startFlowSingle(e)];case 3:r.sent();return[3,4];case 4:return[2]}})});return function(t){return e.apply(this,arguments)}}());var l=_assert_this_initialized(e);u(_assert_this_initialized(e),"startFlowSingle",function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(r){switch(r.label){case 0:t=l.fallbackSingleMode;if(!t)return[3,2];return[4,l.match.single.start.processAsync({playerId:e})];case 1:t=r.sent();r.label=2;case 2:return[2]}})});return function(t){return e.apply(this,arguments)}}());return e}_create_class(pi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:h.trys.push([0,,6,7]);t.startLog(e);r=e.playerId,c=e.extraData,l=e.fallbackSingleMode;t.fallbackSingleMode=l;return[4,t.startFLowChallengeFriend({playerId:r,extraData:c})];case 1:_=h.sent();if(!0===_)return[2];if(!_instanceof(_,rz))return[3,3];return[4,t.startFlowTournament(r)];case 2:h.sent();return[3,5];case 3:return[4,t.startFlowSingle(r)];case 4:h.sent();h.label=5;case 5:return[3,7];case 6:t.endLog();return[7];case 7:return[2]}})})()}}]);return pi}(aA);var nr=r.Utils,no=nr.Valid,nc=r.Configs,nu=nc.Leaderboards;var nl=function(e){_inherits(mi,e);var t=_create_super(mi);function mi(e){_class_call_check(this,mi);return t.call(this,e,{score:0,leaderboardId:nu.LeaderboardEndlessId})}_create_class(mi,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(mi.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,c,l,_,h;return _ts_generator(this,function(d){t=e.profiles,c=e.customData,l=c.playerId;if(!l||!t[l])throw new aZ;_=t[l],h=_.endlessScore;if(!no.isNumber(h))throw new rp;r.payload.score=h,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return mi}(rw);var n_=function(e){_inherits(wi,e);var t=_create_super(wi);function wi(){_class_call_check(this,wi);return t.apply(this,arguments)}_create_class(wi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(wi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.setPlayerEndlessScore(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"setPlayerEndlessScore",value:function setPlayerEndlessScore(e){var t=e.profiles,r=e.customData,c=r.playerId;if(!c||!t[c])throw new aZ;var l;var _=this.game,h=_.player,d=null!==(l=h.getBestEndlessScore())&&void 0!==l?l:0,y=t[c],f=y.endlessScore,p=void 0===f?0:f,v=d<p?p:d;h.setBestEndlessScore(v),t[c].bestEndlessScore=v}}]);return wi}(aS);var nh=function(e){_inherits(Ai,e);var t=_create_super(Ai);function Ai(){_class_call_check(this,Ai);return t.apply(this,arguments)}_create_class(Ai,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,,2,3]);e.startLog();t=new aY(e),r=new rN(e,{useAPI:!1});t.setNext(r);c=new rf(e);r.setNext(c);l=new n_(e);c.setNext(l);_=new nl(e);l.setNext(_);h=new aL(e);_.setNext(h);d=e.match.getMatchState();return[4,t.processAsync(d)];case 1:y.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return Ai}(aA);var nd=function(e){_inherits(Ii,e);var t=_create_super(Ii);function Ii(e){_class_call_check(this,Ii);var r;r=t.call(this,e),r.name="ProfileIdNotDefined",r.message=null!=e?e:"Profile id is not defined";return _possible_constructor_return(r)}return Ii}(_wrap_native_super(Error));var ny=r.Dtos;var nf=function(e){_inherits(Mt,e);var t=_create_super(Mt);function Mt(e,r){_class_call_check(this,Mt);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(Mt,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Mt.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.profileId;if(!c)throw new nd;l=r.game,_=l.player,h=_.getPlayerId();if(c!==h)return[3,1];d=r.getPlayerProfile();return[3,3];case 1:return[4,r.getProfileAsync(c)];case 2:if(d=y.sent(),!d)throw new aZ;y.label=3;case 3:r.updateMatchData(d,e);return[4,r.nextAsync(e)];case 4:y.sent();return[2]}})})()}},{key:"getPlayerProfile",value:function getPlayerProfile(){var e=this.game,t=e.player,r=t.getPlayer(),c=r.playerId,l=r.name,_=r.photo,h=r.locale;return{playerId:c,name:l,photo:_,locale:h}}},{key:"getProfileAsync",value:function getProfileAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r=t.game,c=r.profile;return[4,c.requestProfiles([e])];case 1:return[2,(l.sent(),c.getProfiles()[e])]}})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.playerId,c=e.name,l=e.photo,_=new ny.Match.Profile({id:r,name:c,photo:l}).toObject();t.profiles[r]=_}}]);return Mt}(aS);var np=function(e){_inherits(Pi,e);var t=_create_super(Pi);function Pi(){_class_call_check(this,Pi);return t.apply(this,arguments)}_create_class(Pi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=new aY(t),l=new rn(t,{contextId:"SOLO"});c.setNext(l);_=new aH(t,{id:"234567",mode:h.ENDLESS,customData:{playerId:r}});l.setNext(_);d=new a8(t);_.setNext(d);y=new nf(t,{profileId:r});d.setNext(y);f=new aN(t);y.setNext(f);p=new aL(t);f.setNext(p);v=t.match.getMatchState();return[4,c.processAsync(v)];case 1:g.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Pi}(aA);var nv=r.Utils,ng=nv.Valid;var nm=function(e){_inherits(Ce,e);var t=_create_super(Ce);function Ce(e){_class_call_check(this,Ce);return t.call(this,e,{score:0,leaderboardId:""})}_create_class(Ce,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(Ce.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,c,l,_,h,d;return _ts_generator(this,function(y){t=e.profiles,c=e.customData,l=c.playerId,_=c.leaderboardId;if(!_)throw new rv;if(!l||!t[l])throw new aZ;h=t[l],d=h.score;if(!ng.isNumber(d))throw new rp;r.payload.score=d,r.payload.leaderboardId=_,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return Ce}(rw);var nA=function(e){_inherits(xi,e);var t=_create_super(xi);function xi(){_class_call_check(this,xi);return t.apply(this,arguments)}_create_class(xi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(xi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e),r.progressSendGroupMessage(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,c=r.contextId,l=r.opponentId;if(!t||"string"!=typeof t)throw new aR;if(!c||"string"!=typeof c)throw new aq;if(!l||"string"!=typeof l)throw new aG}},{key:"createWideframesResultGroupAsync",value:function createWideframesResultGroupAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g,m,A,I;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);r=t.game,c=r.frameCapture,l=e.profiles,_=e.customData,h=_.playerId,d=_.opponentId;if(!h||!d)return[2,null];y=l[h],f=l[d],p=y.photo,v=y.score,g=void 0===v?0:v,m=f.photo,A=f.score,I=void 0===A?0:A;return[4,c.wideframe.renderResultChallenge({playerId:h,playerPhoto:p,playerScore:g,opponentId:d,opponentPhoto:m,opponentScore:I,isPlayerFinished:!0,isOpponentFinished:!0})];case 1:return[2,E.sent()];case 2:E.sent();return[2,null];case 3:return[2]}})})()}},{key:"createWideframesBestScoreAsync",value:function createWideframesBestScoreAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,2,,3]);r=t.game,c=r.player,l=r.frameCapture,_=e.customData,h=_.playerId,d=c.getPlayer(),y=d.playerId,f=d.photo,p=d.data;if(h!==y)return[2,null];v=p||{},g=v.score;return[4,l.wideframe.renderShareScore({playerId:y,playerPhoto:f,playerScore:g})];case 1:return[2,m.sent()];case 2:m.sent();return[2,null];case 3:return[2]}})})()}},{key:"progressSendGroupMessage",value:function progressSendGroupMessage(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:r=e.profiles,c=e.customData,l=c.playerId,_=c.opponentId;if(!(_&&"string"==typeof _))return[3,2];if(!l||"string"!=typeof l)throw new Q;h=r[l]||{},d=h.score,y=void 0===d?0:d,f=r[_]||{},p=f.score,v=void 0===p?0:p;if(!(y>v))return[3,2];return[4,t.createWideframesResultGroupAsync(e)];case 1:g=A.sent();if(!g)return[2];t.sendBestScoreMessageAsync(e,g);return[2];case 2:return[4,t.createWideframesBestScoreAsync(e)];case 3:m=A.sent();m&&t.sendChallengeMessageAsync(e,m);return[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){var r=this;return _async_to_generator(function(){var c,l,_,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:c=e.profiles,l=e.customData,_=l.playerId;if(!_||"string"!=typeof _)throw new Q;if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");h=c[_],d=h.name,y=h.score,f={data:{type:r.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:_,playerName:d,playerScore:y},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:"".concat(d," beats your high score. Their score: ").concat(y,"."),localizations:{vi_VN:"".concat(d," vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");return[4,GameSDK.extra.updateAsync(f)];case 1:p.sent();return[2]}})})()}},{key:"sendChallengeMessageAsync",value:function sendChallengeMessageAsync(e,t){var r=this;return _async_to_generator(function(){var c,l,_,h,d,y,f;return _ts_generator(this,function(p){switch(p.label){case 0:c=e.profiles,l=e.customData,_=l.playerId;if(!_||"string"!=typeof _)throw new Q;h=c[_],d=h.name,y=h.score,f={data:{type:r.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:_,playerName:d,playerScore:y},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(d," got ").concat(y," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(d," đ\xe3 đạt ").concat(y," điểm! Qu\xe1 dễ lu\xf4n. Chơi lại n\xe0o!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aW("updateAsync");return[4,GameSDK.extra.updateAsync(f)];case 1:p.sent();return[2]}})})()}}]);return xi}(aS);var nw=function(e){_inherits(Ei,e);var t=_create_super(Ei);function Ei(){_class_call_check(this,Ei);return t.apply(this,arguments)}_create_class(Ei,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d,y;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,,2,3]);e.startLog();t=new aY(e),r=new rN(e,{useAPI:!1});t.setNext(r);c=new nA(e);r.setNext(c);l=new rf(e);c.setNext(l);_=new rL(e);l.setNext(_);h=new nm(e);_.setNext(h);d=new aL(e);h.setNext(d);y=e.match.getMatchState();return[4,t.processAsync(y)];case 1:f.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return Ei}(aA);var nb=r.Dtos;var nI=function(e){_inherits(Kt,e);var t=_create_super(Kt);function Kt(e,r){_class_call_check(this,Kt);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(Kt,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Kt.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.updateProfileMatchData(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"updateProfileMatchData",value:function updateProfileMatchData(e){var t=this.payload,r=t.id,c=e.profiles;if(!c[r])throw new aZ;var l=_object_spread({},c[r],this.payload),_=new nb.Match.Profile(l).toObject();c[_.id]=_}}]);return Kt}(aS);var nk=function(e){_inherits(Ci,e);var t=_create_super(Ci);function Ci(){_class_call_check(this,Ci);return t.apply(this,arguments)}_create_class(Ci,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.opponentId,l=e.opponentScore,_=new aY(t),d=new aH(t,{id:"7749",mode:h.MATCHING_GROUP,customData:{playerId:r,opponentId:c}});_.setNext(d);y=new a$(t);d.setNext(y);f=new nI(t,{id:r,score:l});y.setNext(f);p=new a8(t);f.setNext(p);v=new aN(t);p.setNext(v);g=new aL(t);v.setNext(g);m=t.match.getMatchState();return[4,_.processAsync(m)];case 1:A.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Ci}(aA);var nS=function(e){_inherits(gs,e);var t=_create_super(gs);function gs(e){_class_call_check(this,gs);var r;r=t.call(this,e),r.name="MatchGroupNotSupported",r.message=null!=e?e:"Match group is not supported";return _possible_constructor_return(r)}return gs}(_wrap_native_super(Error));var nD=function(e){_inherits(bi,e);var t=_create_super(bi);function bi(e,r){_class_call_check(this,bi);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(bi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(bi.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(c){switch(c.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.checkMatchGroupSupported()];case 1:c.sent();return[4,r.matchingGroup()];case 2:t=c.sent();e.customData.contextId=t;return[4,r.nextAsync(e)];case 3:c.sent();return[2]}})})()}},{key:"checkMatchGroupSupported",value:function checkMatchGroupSupported(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:if(!("getSupportedAPIs"in GameSDK))throw new aW("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new aW("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new nS;return[4,GameSDK.extra.checkCanPlayerMatchAsync()];case 1:if(!e.sent())throw new nS;return[2]}})})()}},{key:"matchingGroup",value:function matchingGroup(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:if(!("matchPlayerAsync"in GameSDK.extra))throw new aW("matchPlayerAsync");t=e.payload,r=t.matchTag,c=t.autoSwitch,l=void 0!==c&&c,_=t.onlyExisting,h=void 0!==_&&_;return[4,GameSDK.extra.matchPlayerAsync(r,l,h)];case 1:y.sent();d=GameSDK.context.getID();if("string"!=typeof d)throw new a0;return[2,d]}})})()}}]);return bi}(aS);var nP=function(e){_inherits(Ni,e);var t=_create_super(Ni);function Ni(){_class_call_check(this,Ni);return t.apply(this,arguments)}_create_class(Ni,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m,A;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.matchTag,c=e.playerId,l=e.options,_=new aY(t),d=new nD(t,_object_spread({matchTag:r},l));_.setNext(d);y=new aH(t,{id:"7749",mode:h.MATCHING_GROUP,customData:{playerId:c}});d.setNext(y);f=new rB(t,{ignoreId:c});y.setNext(f);p=new a8(t);f.setNext(p);v=new a$(t);p.setNext(v);g=new aN(t);v.setNext(g);m=new aL(t);g.setNext(m);A=t.match.getMatchState();return[4,_.processAsync(A)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Ni}(aA);var nE=function(e){_inherits(Mi,e);var t=_create_super(Mi);function Mi(){_class_call_check(this,Mi);return t.apply(this,arguments)}_create_class(Mi,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,,2,3]);e.startLog();t=new aY(e),r=new rN(e,{useAPI:!1});t.setNext(r);c=new rf(e);r.setNext(c);l=new rL(e);c.setNext(l);_=new rD(e);l.setNext(_);h=new aL(e);_.setNext(h);d=e.match.getMatchState();return[4,t.processAsync(d)];case 1:y.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return Mi}(aA);var nx=function(e){_inherits(Li,e);var t=_create_super(Li);function Li(){_class_call_check(this,Li);return t.apply(this,arguments)}_create_class(Li,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=new aY(t),l=new rn(t,{contextId:"SOLO"});c.setNext(l);_=new aH(t,{id:"123456",mode:h.SINGLE,customData:{playerId:r}});l.setNext(_);d=new a8(t);_.setNext(d);y=new nf(t,{profileId:r});d.setNext(y);f=new aN(t);y.setNext(f);p=new aL(t);f.setNext(p);v=t.match.getMatchState();return[4,c.processAsync(v)];case 1:g.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Li}(aA);var nC=r.Plugins,nN=r.Utils,nT=nC.Analytics,nL=nN.String,nM=nN.Valid;var nO=function(e){_inherits(ms,e);var t=_create_super(ms);function ms(){_class_call_check(this,ms);return t.apply(this,arguments)}_create_class(ms,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ms.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,c=e.customData;r.validateMode(t);l=r.game,_=l.analytics,h=c.tournamentId,d=c.leaderboardId;_.event(nT.Events.TOURNAMENT_START,{success:!0,game_mode:nL.toUpperCamelCase(t),tournament_id:h,leaderboard_id:d});return[4,r.nextAsync(e)];case 1:y.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!nM.isString(e))throw new ab}}]);return ms}(aS);var nR=function(e){_inherits(ws,e);var t=_create_super(ws);function ws(e){_class_call_check(this,ws);var r;r=t.call(this,e),r.name="TournamentIdNotValid",r.message=null!=e?e:"Tournament id is not valid";return _possible_constructor_return(r)}return ws}(_wrap_native_super(Error));var nF=r.Utils,nG=nF.Valid;var nU=function(e){_inherits(Fi,e);var t=_create_super(Fi);function Fi(e,r){_class_call_check(this,Fi);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(Fi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Fi.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.contextId;r.validateContextId(c);return[4,GameSDK.getTournamentAsync()];case 1:l=y.sent(),_=l.getID().toString();r.validateTournamentId(_);h=JSON.parse(l.getPayload()||"{}"),d=h.leaderboardId;r.validateLeaderboardId(d),e.customData.contextId=c,e.customData.tournamentId=_,e.customData.leaderboardId=d;return[4,r.nextAsync(e)];case 2:y.sent();return[2]}})})()}},{key:"validateContextId",value:function validateContextId(e){if(!nG.isString(e))throw new aq}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!nG.isString(e))throw new nR}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!nG.isString(e)||""===e)throw new rv}}]);return Fi}(aS);var nV=function(e){_inherits($i,e);var t=_create_super($i);function $i(){_class_call_check(this,$i);return t.apply(this,arguments)}_create_class($i,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.contextId,l=new aY(t),_=new nU(t,{contextId:c});l.setNext(_);d=new aH(t,{id:"1997",mode:h.TOURNAMENT,customData:{playerId:r}});_.setNext(d);y=new a8(t);d.setNext(y);f=new nf(t,{profileId:r});y.setNext(f);p=new aN(t);f.setNext(p);v=new nO(t);p.setNext(v);g=new aL(t);p.setNext(g);m=t.match.getMatchState();return[4,l.processAsync(m)];case 1:A.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return $i}(aA);var nj=r.Plugins,nB=nj.Analytics;var nz=function(e){_inherits(Ui,e);var t=_create_super(Ui);function Ui(){_class_call_check(this,Ui);return t.apply(this,arguments)}_create_class(Ui,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ui.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e);t=e.customData,c=r.game,l=c.analytics,_=t.tournamentId,h=t.leaderboardId;l.event(nB.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:_,leaderboard_id:h});return[4,r.nextAsync(e)];case 1:d.sent();return[2]}})})()}}]);return Ui}(aS);var nH=function(e){_inherits(Hi,e);var t=_create_super(Hi);function Hi(e,r){_class_call_check(this,Hi);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(Hi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Hi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.createTournamentAsync()];case 1:t.sent();return[4,r.updateMatchStateAsync(e)];case 2:t.sent();return[4,r.nextAsync(e)];case 3:t.sent();return[2]}})})()}},{key:"createTournamentAsync",value:function createTournamentAsync(){var e=this;return _async_to_generator(function(){var t,r,c,l;return _ts_generator(this,function(_){switch(_.label){case 0:t=e.payload,r=t.name,c=t.score,l=t.customData;return[4,GameSDK.tournament.createAsync({initialScore:c,config:{title:r,tournamentTitle:r},data:l})];case 1:_.sent();return[2]}})})()}},{key:"updateMatchStateAsync",value:function updateMatchStateAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);if(!("getTournamentAsync"in GameSDK))throw new aW("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 1:r=y.sent(),c=r.getContextID(),l=r.getID().toString(),_=t.payload,h=_.playerId;e.customData.playerId=h,e.customData.contextId=c,e.customData.tournamentId=l;return[3,3];case 2:d=y.sent();if(_instanceof(d,aW))return[2];return[3,3];case 3:return[2]}})})()}}]);return Hi}(aS);var nK=r.Utils,nW=nK.Valid;var nq=function(e){_inherits(Bi,e);var t=_create_super(Bi);function Bi(e,r){_class_call_check(this,Bi);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");u(_assert_this_initialized(c),"leaderboardPayload");c.payload=r;return c}_create_class(Bi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Bi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validatePayload();return[4,r.setupCreatePayload(e)];case 1:t.sent();return[4,r.createLeaderboardAsync(e)];case 2:t.sent();return[4,r.nextAsync(e)];case 3:t.sent();return[2]}})})()}},{key:"validatePayload",value:function validatePayload(){var e=this.payload,t=e.leaderboardId;if(!nW.isString(t))throw new rv}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!nW.isString(e))throw new Q}},{key:"setupCreatePayload",value:function setupCreatePayload(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d;return _ts_generator(this,function(y){r=e.customData,c=r.playerId;t.validatePlayerId(c);l=t.payload,_=l.name,h=l.leaderboardId,d=l.customData;t.leaderboardPayload={_id:h,name:null!=_?_:"",createdBy:c,description:JSON.stringify(d)};return[2]})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,t.game.leaderboard.createLeaderboardAsync(t.leaderboardPayload)];case 1:r=c.sent();e.customData.leaderboardId=r;return[2]}})})()}}]);return Bi}(aS);var nJ=function(e){_inherits(ji,e);var t=_create_super(ji);function ji(){_class_call_check(this,ji);return t.apply(this,arguments)}_create_class(ji,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g,m,A,I;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.name,l=e.score,_=e.leaderboardId,h=e.payload,d=new aY(t),y=new rn(t,{contextId:"SOLO"});d.setNext(y);f=new nH(t,{name:c,score:l,playerId:r,customData:h});y.setNext(f);p=new nf(t,{profileId:r});f.setNext(p);v=new nI(t,{id:r,score:l});p.setNext(v);g=new nq(t,{name:c,customData:h,leaderboardId:_});v.setNext(g);m=new nm(t);g.setNext(m);A=new nz(t);m.setNext(A);I=t.match.getMatchState();return[4,d.processAsync(I)];case 1:E.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return ji}(aA);var nY=r.Plugins,nZ=nY.Analytics,nQ=r.Utils,n$=nQ.Valid;var nX=function(e){_inherits(Wi,e);var t=_create_super(Wi);function Wi(e,r){_class_call_check(this,Wi);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(Wi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Wi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.postScoreTournamentAsync(e)];case 1:t.sent();return[4,r.nextAsync(e)];case 2:t.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.profiles,r=e.customData,c=r.playerId;if(this.validatePlayerId(c),!t[c])throw new aZ}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!n$.isString(e))throw new Q}},{key:"getPlayerProfile",value:function getPlayerProfile(e){var t=e.profiles,r=e.customData,c=r.playerId;return this.validatePlayerId(c),t[c]}},{key:"isNewBestScore",value:function isNewBestScore(e){var t=this.getPlayerProfile(e),r=t.score,c=void 0===r?0:r,l=t.bestScore,_=void 0===l?0:l;return c>_}},{key:"postScoreTournamentAsync",value:function postScoreTournamentAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v;return _ts_generator(this,function(g){switch(g.label){case 0:r=window.game,c=r.analytics,l=t.getPlayerProfile(e),_=l.score,h=void 0===_?0:_;d=null,y=!1;f=t.payload,p=f.checkBestScore,v=t.isNewBestScore(e);g.label=1;case 1:g.trys.push([1,7,8,9]);if(!("getTournamentAsync"in GameSDK))throw new aW("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 2:g.sent();if(!(!p||v))return[3,4];d=nZ.Events.TOURNAMENT_SHARE;return[4,GameSDK.tournament.shareAsync({score:h})];case 3:g.sent();return[3,6];case 4:d=nZ.Events.TOURNAMENT_POST_SCORE;return[4,GameSDK.tournament.postScoreAsync(h)];case 5:g.sent();g.label=6;case 6:y=!0;return[3,9];case 7:g.sent();return[3,9];case 8:d&&c.event(d,{success:y});return[7];case 9:return[2]}})})()}}]);return Wi}(aS);var n0=function(e){_inherits(zi,e);var t=_create_super(zi);function zi(){_class_call_check(this,zi);return t.apply(this,arguments)}_create_class(zi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h,d,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.bestScore,l=new aY(t),_=new rN(t,{useAPI:!1});l.setNext(_);h=new nI(t,{id:r,bestScore:c});_.setNext(h);d=new nX(t,{checkBestScore:!1});h.setNext(d);y=new rf(t);d.setNext(y);f=new rL(t);y.setNext(f);p=new nm(t);f.setNext(p);v=new rD(t);p.setNext(v);g=new aL(t);v.setNext(g);m=t.match.getMatchState();return[4,l.processAsync(m)];case 1:A.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return zi}(aA);var n2=r.Utils,n3=n2.Valid,n1=n2.Object;var n4=function(e){_inherits(Ji,e);var t=_create_super(Ji);function Ji(e,r){_class_call_check(this,Ji);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(Ji,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ji.prototype),"processAsync",t)};return _async_to_generator(function(){var t,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,c=t.tournamentId;r.validateTournamentId(c);return[4,r.joinTournamentAsync(c)];case 1:y.sent();return[4,GameSDK.getTournamentAsync()];case 2:l=y.sent(),_=l.getContextID();r.validateContextId(_);h=JSON.parse(l.getPayload()||"{}"),d=h.leaderboardId;r.validateLeaderboardId(d),e.customData.contextId=_,e.customData.tournamentId=c,e.customData.leaderboardId=d;return[4,r.nextAsync(e)];case 3:y.sent();return[2]}})})()}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!n3.isString(e))throw new nR}},{key:"validateContextId",value:function validateContextId(e){if(!n3.isString(e))throw new aq}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!n3.isString(e)||""===e)throw new rv}},{key:"joinTournamentAsync",value:function joinTournamentAsync(e){return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!("tournament"in GameSDK))throw new aW("tournament");r.label=1;case 1:r.trys.push([1,3,,4]);return[4,GameSDK.tournament.joinAsync(e)];case 2:r.sent();return[3,4];case 3:t=r.sent();if(!n1.hasOwn(t,"code")||"SAME_CONTEXT"!==t.code)throw t;return[3,4];case 4:return[2]}})})()}}]);return Ji}(aS);var n5=function(e){_inherits(Yi,e);var t=_create_super(Yi);function Yi(){_class_call_check(this,Yi);return t.apply(this,arguments)}_create_class(Yi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,c,l,_,d,y,f,p,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,c=e.tournamentId,l=new aY(t),_=new n4(t,{tournamentId:c});l.setNext(_);d=new aH(t,{id:"1997",mode:h.TOURNAMENT,customData:{playerId:r}});_.setNext(d);y=new a8(t);d.setNext(y);f=new nf(t,{profileId:r});y.setNext(f);p=new aN(t);f.setNext(p);v=new nO(t);p.setNext(v);g=new aL(t);v.setNext(g);m=t.match.getMatchState();return[4,l.processAsync(m)];case 1:A.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Yi}(aA);var n6=r.Dtos,n7=r.Utils,n8=n7.Object;var n9=function(e){_inherits(to,e);var t=_create_super(to);function to(e,r){_class_call_check(this,to);var c;c=t.call(this,e);u(_assert_this_initialized(c),"payload");c.payload=r;return c}_create_class(to,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(to.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.updateMatchCustomData(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e){var t=n8.merge(e.customData,this.payload),r=new n6.Match.CustomData(t).toObject();e.customData=r}}]);return to}(aS);var se={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:_object_spread({},az)},st=r.Configs;var sr=function(e){_inherits(so,e);var t=_create_super(so);function so(){_class_call_check(this,so);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"base");u(_assert_this_initialized(e),"group");u(_assert_this_initialized(e),"single");u(_assert_this_initialized(e),"endless");u(_assert_this_initialized(e),"context");u(_assert_this_initialized(e),"challenge");u(_assert_this_initialized(e),"tournament");u(_assert_this_initialized(e),"api");u(_assert_this_initialized(e),"handler");u(_assert_this_initialized(e),"useCPUProfile");return e}_create_class(so,[{key:"init",value:function init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}},{key:"setUseCPUProfile",value:function setUseCPUProfile(e){this.useCPUProfile=e}},{key:"createMatchData",value:function createMatchData(){var e=this.game,t=e.storage;t.addStorage("match",se)}},{key:"getMatchState",value:function getMatchState(){var e=this.game,t=e.storage;return t.getStorage("match")}},{key:"createBaseConcrete",value:function createBaseConcrete(){this.base=new aA(this.game,this)}},{key:"createConcreteFlows",value:function createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}},{key:"createConcreteHandlers",value:function createConcreteHandlers(){var e=this;var t=this;var r=this;this.handler={setProfileData:function(){var t=_async_to_generator(function(t){var r;return _ts_generator(this,function(c){switch(c.label){case 0:r=new nI(e.base,t);return[4,e.processHandlerAsync(r)];case 1:c.sent();return[2]}})});return function(e){return t.apply(this,arguments)}}(),setMatchCustomData:function(){var e=_async_to_generator(function(e){var r;return _ts_generator(this,function(c){switch(c.label){case 0:r=new n9(t.base,e);return[4,t.processHandlerAsync(r)];case 1:c.sent();return[2]}})});return function(t){return e.apply(this,arguments)}}(),setLeaderboardScore:function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(c){switch(c.label){case 0:t=new rw(r.base,e);return[4,r.processHandlerAsync(t)];case 1:c.sent();return[2]}})});return function(t){return e.apply(this,arguments)}}()}}},{key:"createAPIHandler",value:function createAPIHandler(){var e={appId:st.AppId,matchAPIHost:st.ApiHost};this.api=new am(e)}},{key:"createGroupFlows",value:function createGroupFlows(){this.group={join:new nk(this.game,this),start:new nP(this.game,this),finish:new nw(this.game,this)}}},{key:"createSingleFlows",value:function createSingleFlows(){this.single={start:new nx(this.game,this),finish:new nE(this.game,this)}}},{key:"createEndlessFlows",value:function createEndlessFlows(){this.endless={start:new np(this.game,this),finish:new nh(this.game,this)}}},{key:"createContextFlows",value:function createContextFlows(){this.context={choose:new ne(this.game,this)}}},{key:"createChallengeFlows",value:function createChallengeFlows(){this.challenge={invite:new rq(this.game,this),friend:new re(this.game,this),join:new r0(this.game,this),await:new aX(this.game,this),result:new r9(this.game,this),finish:new rM(this.game,this),continue:new ru(this.game,this)}}},{key:"createTournamentFlows",value:function createTournamentFlows(){this.tournament={join:new n5(this.game,this),create:new nJ(this.game,this),finish:new n0(this.game,this),continue:new nV(this.game,this)}}},{key:"processHandlerAsync",value:function processHandlerAsync(e){var t=this.getMatchState();return e.processAsync(t)}}]);return so}(c.Plugins.BasePlugin);var sn=r.Utils,ss=sn.Valid,sc="is invalid";var su=function(e){_inherits(Ps,e);var t=_create_super(Ps);function Ps(){_class_call_check(this,Ps);return t.apply(this,arguments)}_create_class(Ps,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!ss.isNumber(e)||e<0)&&this.exception("level",sc)}},{key:"validateRescued",value:function validateRescued(e){(!ss.isNumber(e)||e<0)&&this.exception("rescued",sc)}},{key:"validateContextId",value:function validateContextId(e){ss.isString(e)||this.exception("contextId",sc)}},{key:"validatePlayerId",value:function validatePlayerId(e){ss.isString(e)||this.exception("playerId",sc)}},{key:"validateOpponentId",value:function validateOpponentId(e){ss.isString(e)||this.exception("opponentId",sc)}},{key:"validateTournamentId",value:function validateTournamentId(e){ss.isString(e)||this.exception("tournamentId",sc)}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){ss.isString(e)||this.exception("leaderboardId",sc)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ps.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return E.getDefaultData()}}]);return Ps}(E);su.addDefaultData(az);var sl=r.Utils,s_=sl.Valid,sh="is invalid";var sd=function(e){_inherits(Ss,e);var t=_create_super(Ss);function Ss(){_class_call_check(this,Ss);return t.apply(this,arguments)}_create_class(Ss,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){s_.isString(e)&&e||this.exception("id",sh)}},{key:"validateName",value:function validateName(e){s_.isString(e)&&e||this.exception("name",sh)}},{key:"validatePhoto",value:function validatePhoto(e){s_.isString(e)||this.exception("photo",sh)}},{key:"validateScore",value:function validateScore(e){(!s_.isNumber(e)||e<0)&&this.exception("score",sh)}},{key:"validateBestScore",value:function validateBestScore(e){(!s_.isNumber(e)||e<0)&&this.exception("bestScore",sh)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!s_.isNumber(e)||e<0)&&this.exception("endlessScore",sh)}},{key:"validateBestEndlessScore",value:function validateBestEndlessScore(e){(!s_.isNumber(e)||e<0)&&this.exception("bestEndlessScore",sh)}},{key:"validateFinished",value:function validateFinished(e){s_.isBoolean(e)||this.exception("finished",sh)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ss.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return E.getDefaultData()}}]);return Ss}(E);sd.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0}),r.Dtos.Match={Data:r5,CustomData:su,Profile:sd};var sy=r.Utils,sf=r.Configs,sp=sf.ApiHost,sv=function(){var e=_async_to_generator(function(e){var t,r;return _ts_generator(this,function(c){switch(c.label){case 0:t="players";"MsGames"===GameSDK.getSDKName()&&(t="players?platform=ms-games");return[4,ep(t,e,{},sp,10)];case 1:r=c.sent();return[2,sy.Object.hasOwn(r,"data")?r.data||{}:{}]}})});return function io(t){return e.apply(this,arguments)}}(),sg=r.Utils,sm=r.Configs,sA=sm.AppId,sw=sg.Array,sb=sg.Object,sI=sg.Valid;var sk=function(e){_inherits(uo,e);var t=_create_super(uo);function uo(){_class_call_check(this,uo);return t.apply(this,arguments)}_create_class(uo,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("player",C)}},{key:"saveToCloud",value:function saveToCloud(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);t=e.getPlayerData();return[4,GameSDK.player.setDataAsync(t)];case 1:r.sent();return[3,3];case 2:r.sent();return[3,3];case 3:return[2]}})})()}},{key:"receiveData",value:function receiveData(e,t){var r=this.game,c=r.storage,l=e.playerId,_=e.name,h=e.photo,d=e.locale;c.setStorageData("player","playerId",l),c.setStorageData("player","name",_),c.setStorageData("player","photo",h),c.setStorageData("player","locale",d),t&&this.setPlayerData(t)}},{key:"syncProfileToServer",value:function syncProfileToServer(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:t=e.game,r=t.storage,c=e.getPlayer(),l=c.playerId,_=c.name,h=c.photo,d=c.locale;y=e.getPlayerASID();p=!sI.isString(y)&&"getASIDAsync"in GameSDK.player;if(!p)return[3,2];return[4,GameSDK.player.getASIDAsync()];case 1:p=(y=null!==(f=v.sent())&&void 0!==f?f:y,r.setStorageData("player","ASID","".concat(y)));v.label=2;case 2:return[4,sv({appId:sA,ASID:y,playerId:l,name:_,photo:h,locale:d})];case 3:v.sent();return[2]}})})()}},{key:"setPlayerDataByName",value:function setPlayerDataByName(e,t){this.setPlayerData(_define_property({},e,t))}},{key:"setPlayerData",value:function setPlayerData(e){var t=this.game,r=t.storage;r.setStorageData("player","data",e),this.saveToCloud()}},{key:"setBestScore",value:function setBestScore(e){this.setPlayerDataByName("score",e)}},{key:"setBestEndlessScore",value:function setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}},{key:"setSetting",value:function setSetting(e,t){this.setPlayerDataByName("settings",_define_property({},e,t))}},{key:"setGameData",value:function setGameData(e){var t;var r=null!==(t=this.getGameData())&&void 0!==t?t:{},c=sb.merge(r,e);this.setPlayerDataByName("gameData",c)}},{key:"requestConnectedPlayers",value:function requestConnectedPlayers(){var e=this;return _async_to_generator(function(){var t,r,c,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:t=e.game,r=t.storage;return[4,GameSDK.player.getConnectedPlayersAsync()];case 1:c=h.sent().map(function(e){var t=e.getID(),r=e.getName(),c=e.getPhoto();return t&&r&&c?new H({playerId:t,name:r,photo:c}).toObject():null}),l=sw.unique(c);if(l.length<1)return[2];_=sb.keyBy(l,"playerId");r.setStorageData("player","connectedPlayers",_);return[2]}})})()}},{key:"getPlayer",value:function getPlayer(){var e=this.game,t=e.storage;return t.getStorage("player")}},{key:"getPlayerId",value:function getPlayerId(){var e=this.game,t=e.storage;return t.getStorageData("player","playerId")}},{key:"getPlayerASID",value:function getPlayerASID(){var e=this.game,t=e.storage;return t.getStorageData("player","ASID")}},{key:"getPlayerLocale",value:function getPlayerLocale(){var e=this.game,t=e.storage;return t.getStorageData("player","locale")}},{key:"getPlayerData",value:function getPlayerData(){var e=this.game,t=e.storage;return t.getStorageData("player","data")}},{key:"getPlayerDataByKey",value:function getPlayerDataByKey(e){var t=this.getPlayerData();return sb.hasOwn(t,e)?t[e]:null}},{key:"getGameData",value:function getGameData(){return this.getPlayerDataByKey("gameData")}},{key:"getPlayerSetting",value:function getPlayerSetting(e){var t=this.getPlayerSettings();return sb.hasOwn(t,e)?t[e]:null}},{key:"getPlayerSettings",value:function getPlayerSettings(){var e=this.getPlayerData(),t=e.settings;return t}},{key:"isFirstLogin",value:function isFirstLogin(){var e;return null!==(e=this.getPlayerDataByKey("isFirstLogin"))&&void 0!==e?e:C.data.isFirstLogin}},{key:"loggedIn",value:function loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}},{key:"getBestScore",value:function getBestScore(){var e=this.getPlayerData(),t=e.score;return t}},{key:"getBestEndlessScore",value:function getBestEndlessScore(){var e=this.getPlayerData(),t=e.endlessScore;return t}},{key:"getConnectedPlayers",value:function getConnectedPlayers(){var e=this.game,t=e.storage;return t.getStorageData("player","connectedPlayers")}},{key:"getConnectedPlayerIds",value:function getConnectedPlayerIds(e,t){var r=this.getConnectedPlayers();return Object.keys(r).slice(t,t+e)}}]);return uo}(c.Plugins.BasePlugin);var sS=r.Dtos,sD=r.Utils,sP=sD.Valid,sE=C.data,sx=sE.score,sC=sE.endlessScore,sN=sE.settings,sT=sE.gameData,sL=sE.isFirstLogin,sM=sE.dailyRewarded,sO="is invalid";var sR=function(e){_inherits(vs,e);var t=_create_super(vs);function vs(){_class_call_check(this,vs);return t.apply(this,arguments)}_create_class(vs,[{key:"processData",value:function processData(e){this.validateStructure(e),e.settings=new sS.Player.Settings(e.settings).toObject(),e.gameData=new sS.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}},{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateScore",value:function validateScore(e){(!sP.isNumber(e)||e<0)&&this.exception("score",sO)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!sP.isNumber(e)||sx<0)&&this.exception("endlessScore",sO)}},{key:"validateSettings",value:function validateSettings(e){sP.isObject(e)||this.exception("settings",sO)}},{key:"validateGameData",value:function validateGameData(e){sP.isObject(e)||this.exception("gameData",sO)}},{key:"validateIsFirstLogin",value:function validateIsFirstLogin(e){sP.isBoolean(e)||this.exception("isFirstLogin",sO)}},{key:"validateDailyRewarded",value:function validateDailyRewarded(e){sP.isObject(e)||this.exception("dailyRewarded",sO)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(vs.prototype),"toObject",this).call(this)}}]);return vs}(E);sR.addDefaultData({score:sx,endlessScore:sC,settings:sN,gameData:sT,isFirstLogin:sL,dailyRewarded:sM});var sF=r.Utils,sG=sF.Valid,sU=C.data.gameData,sV=sU.level,sj=sU.coins;var sB=function(e){_inherits(bs,e);var t=_create_super(bs);function bs(){_class_call_check(this,bs);return t.apply(this,arguments)}_create_class(bs,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!sG.isNumber(e)||e<0)&&this.exception("level","is invalid")}},{key:"validateCoins",value:function validateCoins(e){(!sG.isNumber(e)||e<0)&&this.exception("coins","is invalid")}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(bs.prototype),"toObject",this).call(this)}}]);return bs}(E);sB.addDefaultData({level:sV,coins:sj});var sz=r.Utils,sH=sz.Valid,sK=C.data.settings,sW=sK.sound,sq=sK.music,sJ=sK.vibrate,sY=sK.language,sZ="is invalid";var sQ=function(e){_inherits(Ns,e);var t=_create_super(Ns);function Ns(){_class_call_check(this,Ns);return t.apply(this,arguments)}_create_class(Ns,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateSound",value:function validateSound(e){sH.isBoolean(e)||this.exception("sound",sZ)}},{key:"validateMusic",value:function validateMusic(e){sH.isBoolean(e)||this.exception("music",sZ)}},{key:"validateVibrate",value:function validateVibrate(e){sH.isBoolean(e)||this.exception("vibrate",sZ)}},{key:"validateLanguage",value:function validateLanguage(e){sH.isString(e)&&e||this.exception("language",sZ)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ns.prototype),"toObject",this).call(this)}}]);return Ns}(E);sQ.addDefaultData({sound:sW,music:sq,vibrate:sJ,language:sY}),r.Dtos.Player={Info:H,Data:sR,Settings:sQ,GameData:sB};var s$=r.Configs,sX=r.Utils,s0=sX.Object,s2=sX.String,s3=s$.ApiHost,s1=s$.Mockup;var s4=function(){function Lo(){_class_call_check(this,Lo);u(this,"mockAPI")}_create_class(Lo,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:if(e.mockAPI)return[2];return[4,_(_async_to_generator(function(){var e,r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,t.import("./bundle/ProfileAPIMock.js")];case 1:e=c.sent(),r=e.default;return[2,{default:r}]}})}),void 0,t.meta.url)];case 1:r=c.sent().default;if("function"!=typeof r)throw new Error("Cannot load ProfileAPIMock");e.mockAPI=new r;return[2]}})})()}},{key:"getPlayersAsync",value:function getPlayersAsync(e){var t=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r=s2.params(e);if(!s1.Profile.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:l.sent();return[4,t.mockAPI.getPlayersAsync(e)];case 2:c=l.sent();return[3,5];case 3:return[4,ef("players?".concat(r),{},s3)];case 4:c=l.sent();l.label=5;case 5:return[2,s0.hasOwn(c,"data")&&Array.isArray(c.data)?c.data:[]]}})})()}}]);return Lo}();var s5={profiles:{},profileIds:[]},s6=r.Utils,s7=r.Dtos,s8=s6.Array,s9=s6.Valid,ie=s6.Object,it=s6.Function;var ia=function(e){_inherits($o,e);var t=_create_super($o);function $o(){_class_call_check(this,$o);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"profileAPI",new s4);return e}_create_class($o,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("profile",s5)}},{key:"requestProfiles",value:function requestProfiles(e){var t=this;return _async_to_generator(function(){var r,c,l,_,h;return _ts_generator(this,function(d){switch(d.label){case 0:r=t.getProfileIds(),c=s8.difference(e,r);if(c.length<1)return[2];l=s8.chunk(c,400).map(function(e){return t.profileAPI.getPlayersAsync({playerIds:e})});return[4,it.allSettled(l)];case 1:_=d.sent().reduce(function(e,t){return"fulfilled"===t.status?e.concat(t.value):e},[]);if(!t.validateProfilesResponse(_))return[2];h=t.convertToProfiles(_);t.setProfiles(h);return[2]}})})()}},{key:"getProfile",value:function getProfile(e){var t;return null!==(t=this.getProfiles()[e])&&void 0!==t?t:null}},{key:"getProfiles",value:function getProfiles(){var e=this.game,t=e.storage;return t.getStorageData("profile","profiles")}},{key:"setProfiles",value:function setProfiles(e){var t=this.game,r=t.storage;r.setStorageData("profile","profiles",e),r.setStorageData("profile","profileIds",Object.keys(e))}},{key:"getProfileIds",value:function getProfileIds(){var e=this.game,t=e.storage;return t.getStorageData("profile","profileIds")}},{key:"validateProfilesResponse",value:function validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}},{key:"convertToProfiles",value:function convertToProfiles(e){var t={};var r=true,c=false,l=void 0;try{for(var _=e[Symbol.iterator](),h;!(r=(h=_.next()).done);r=true){var d=h.value;ie.hasOwn(d,"playerId")&&s9.isString(d.playerId)&&(t[d.playerId]=new s7.Player.Info(d).toObject())}}catch(e){c=true;l=e}finally{try{if(!r&&null!=_.return)_.return()}finally{if(c)throw l}}return t}}]);return $o}(c.Plugins.BasePlugin);var ir="Save The Pets",ic=r.Utils,iu=ic.Object,il=ic.Valid,i_=ic.Browser;var ih=function(e){_inherits(Vo,e);var t=_create_super(Vo);function Vo(e){_class_call_check(this,Vo);var r;r=t.call(this,e);u(_assert_this_initialized(r),"storages");u(_assert_this_initialized(r),"storageLocalKeys",{});r.storages={};return r}_create_class(Vo,[{key:"addStorage",value:function addStorage(e,t,r){var c=arguments.length>2&&void 0!==r&&r;var l=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(_){switch(_.label){case 0:l.storages[e]=t;r=c;if(!r)return[3,2];return[4,l.initFromWebStorage(e,t)];case 1:r=_.sent();_.label=2;case 2:return[2]}})})()}},{key:"initFromWebStorage",value:function initFromWebStorage(e,t){var r=this;return _async_to_generator(function(){var c,l,_,h,d,y,f,p;return _ts_generator(this,function(v){switch(v.label){case 0:r.storageLocalKeys[e]=!0;return[4,i_.getIndexedDB("".concat(ir,"_S_").concat(e))];case 1:c=v.sent();if(!il.isObject(c))return[2];l=Object.keys(t);_=true,h=false,d=void 0;try{for(y=l[Symbol.iterator]();!(_=(f=y.next()).done);_=true){p=f.value;iu.hasOwn(c,p)&&_type_of(t[p])==_type_of(c[p])&&r.setStorageData(e,p,c[p])}}catch(e){h=true;d=e}finally{try{if(!_&&null!=y.return)y.return()}finally{if(h)throw d}}return[2]}})})()}},{key:"setStorageData",value:function setStorageData(e,t,r){var c;if(il.isObject(r)){var l=this.getStorageData(e,t);c=iu.merge(l,r)}else c=r;this.storages[e][t]=c}},{key:"getStorageData",value:function getStorageData(e,t){return this.getStorage(e)[t]}},{key:"getStorage",value:function getStorage(e){return this.storages[e]}},{key:"updateToWebStorage",value:function updateToWebStorage(e){this.storageLocalKeys[e]&&this.saveToWebStorage(e)}},{key:"saveToWebStorage",value:function saveToWebStorage(e){var t=this.getStorage(e);i_.setIndexedDB("".concat(ir,"_S_").concat(e),t)}}]);return Vo}(c.Plugins.BasePlugin);var id=function(e){_inherits(ko,e);var t=_create_super(ko);function ko(){_class_call_check(this,ko);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"isVisible",!0);u(_assert_this_initialized(e),"browserPrefixes",["moz","ms","o","","webkit"]);u(_assert_this_initialized(e),"handleVisibilityChange",function(t){if(["focus","blur"].indexOf(t)>-1)return"focus"===t?e.onVisibleEvent():e.onHiddenEvent();var r=e.getBrowserPrefix(),c=e.getHiddenPropertyName(r);return document[c]?e.onHiddenEvent():e.onVisibleEvent()});return e}_create_class(ko,[{key:"init",value:function init(){var e=this;var t=this.getBrowserPrefix(),r=[this.getVisibilityEvent(t),"focus","blur"];var c=true,l=false,_=void 0;try{var _loop=function(){var t=d.value;window.addEventListener(t,function(){e.handleVisibilityChange(t)},!1),document.addEventListener(t,function(){e.handleVisibilityChange(t)},!1)};for(var h=r[Symbol.iterator](),d;!(c=(d=h.next()).done);c=true)_loop()}catch(e){l=true;_=e}finally{try{if(!c&&null!=h.return)h.return()}finally{if(l)throw _}}"onPause"in GameSDK.extra&&GameSDK.extra.onPause(function(){e.handleVisibilityChange("blur")})}},{key:"isGameVisible",value:function isGameVisible(){return this.isVisible}},{key:"getHiddenPropertyName",value:function getHiddenPropertyName(e){return e?"".concat(e,"Hidden"):"hidden"}},{key:"getVisibilityEvent",value:function getVisibilityEvent(e){return"".concat(e||"","visibilitychange")}},{key:"getBrowserPrefix",value:function getBrowserPrefix(){var e=true,t=false,r=void 0;try{for(var c=this.browserPrefixes[Symbol.iterator](),l;!(e=(l=c.next()).done);e=true){var _=l.value;if(this.getHiddenPropertyName(_) in document)return _}}catch(e){t=true;r=e}finally{try{if(!e&&null!=c.return)c.return()}finally{if(t)throw r}}return""}},{key:"onVisibleEvent",value:function onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(r.Events.VISIBILITY_VISIBLE))}},{key:"onHiddenEvent",value:function onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(r.Events.VISIBILITY_HIDDEN))}}]);return ko}(c.Plugins.BasePlugin);var iy=function(e){_inherits(Uo,e);var t=_create_super(Uo);function Uo(){_class_call_check(this,Uo);return t.apply(this,arguments)}_create_class(Uo,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("Unsupported method");return[2]})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("This method is not implemented");return[2]})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("This method is not implemented");return[2]})})()}}]);return Uo}(eP);var ip=r.Plugins.Ads,iv=ip.Status;var ig=function(e){_inherits(Ho,e);var t=_create_super(Ho);function Ho(){_class_call_check(this,Ho);return t.apply(this,arguments)}_create_class(Ho,[{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.loadBannerAdAsync(e.placementId)];case 1:t.sent(),e.setStatus(iv.SHOWING);return[2]}})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.hideBannerAdAsync(e.placementId)];case 1:t.sent(),e.setStatus(iv.IDLE);return[2]}})})()}}]);return Ho}(iy);var im=r.Utils,iA=im.Object,iw=r.Plugins.Ads,ib=iw.Status,iI=iw.Types,ik=iw.AdError,iS=iw.AdInstance;var iD=function(e){_inherits(Me,e);var t=_create_super(Me);function Me(e,r){_class_call_check(this,Me);var c;c=t.call(this,e,r);u(_assert_this_initialized(c),"instance");u(_assert_this_initialized(c),"interstitialAdInstanceList",[]);u(_assert_this_initialized(c),"rewardedVideoAdInstanceList",[]);u(_assert_this_initialized(c),"rewardedInterstitialAdInstanceList",[]);c.instance=null;return c}_create_class(Me,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!!(e.instance&&e.status===ib.FILLED))return[3,5];if(e.status!==ib.IDLE)throw new ik("AD_NOT_READY","Ad is not ready.");r.label=1;case 1:r.trys.push([1,4,,5]);return[4,e.createInstanceByType(e.type)];case 2:if(e.instance=r.sent(),null===e.instance)throw new ik("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");e.setStatus(ib.LOADING);return[4,e.instance.loadAsync()];case 3:r.sent(),e.setStatus(ib.FILLED),e.logAdLoad();return[3,5];case 4:t=r.sent();throw e.setStatus(ib.IDLE),_instanceof(t,Object)&&"code"in t&&"INVALID_PARAM"===t.code&&(e.instance=null),e.instance&&e.pushInstanceToQueue(e.instance),self.game.analytics.loadAdFail(e.type),t;case 5:return[2]}})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){var t,c;return _ts_generator(this,function(l){switch(l.label){case 0:if(e.status!==ib.FILLED)throw new ik("AD_NOT_FILLED","Ad is not filled.");if(null===e.instance)throw new ik("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");t=!1;l.label=1;case 1:l.trys.push([1,3,4,5]);e.setStatus(ib.SHOWING),self.game.analytics.showingAd(e.type);return[4,e.instance.showAsync()];case 2:l.sent(),t=!0,e.setStatus(ib.IDLE),e.instance=null;return[3,5];case 3:c=l.sent();throw r.Utils.Object.hasOwn(c,"code")&&("AD_NOT_LOADED"===c.code&&e.setStatus(ib.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf("".concat(c.code))>-1&&(e.setStatus(ib.IDLE),e.instance=null),"USER_INPUT"===c.code&&(t=!0)),e.status===ib.SHOWING&&(e.setStatus(ib.IDLE),e.instance=null),c;case 4:t?e.logAdShown():self.game.analytics.showAdFail(e.type);return[7];case 5:return[2]}})})()}},{key:"createInstanceByType",value:function createInstanceByType(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(c){switch(c.label){case 0:c.trys.push([0,2,,3]);return[4,t.getAdInstanceByType(e)];case 1:return[2,c.sent()];case 2:r=c.sent();return[2,iA.hasOwn(r,"code")&&"ADS_TOO_MANY_INSTANCES"===r.code?t.getAdInstanceFailed(e):null];case 3:return[2]}})})()}},{key:"getAdInstanceByType",value:function getAdInstanceByType(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){switch(r.label){case 0:switch(e){case iI.REWARDED_VIDEO:return[3,1];case iI.INTERSTITIAL:return[3,3];case iI.REWARDED_INTERSTITIAL:return[3,5]}return[3,7];case 1:return[4,GameSDK.getRewardedVideoAsync(t.placementId)];case 2:return[2,r.sent()];case 3:return[4,GameSDK.getInterstitialAdAsync(t.placementId)];case 4:return[2,r.sent()];case 5:return[4,GameSDK.getRewardedInterstitialAsync(t.placementId)];case 6:return[2,r.sent()];case 7:return[2,null];case 8:return[2]}})})()}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(e){var t=null;switch(e){case iI.INTERSTITIAL:t=this.interstitialAdInstanceList;break;case iI.REWARDED_VIDEO:t=this.rewardedVideoAdInstanceList;break;case iI.REWARDED_INTERSTITIAL:t=this.rewardedInterstitialAdInstanceList;break}if(null===t)return null;if(!("canBeLoadedAd"in GameSDK.extra))return t.shift()||null;var r=true,c=false,l=void 0;try{for(var _=t[Symbol.iterator](),h;!(r=(h=_.next()).done);r=true){var d=h.value;if(GameSDK.extra.canBeLoadedAd(d))return t.splice(t.indexOf(d),1),d}}catch(e){c=true;l=e}finally{try{if(!r&&null!=_.return)_.return()}finally{if(c)throw l}}return null}},{key:"logAdLoad",value:function logAdLoad(){switch(this.type){case iI.INTERSTITIAL:self.game.analytics.loadInterstitialAd();break;case iI.REWARDED_VIDEO:self.game.analytics.loadRewardedVideoAd();break;case iI.REWARDED_INTERSTITIAL:self.game.analytics.loadRewardedInterstitialAd();break}}},{key:"logAdShown",value:function logAdShown(){switch(this.type){case iI.INTERSTITIAL:self.game.analytics.showInterstitialAd();break;case iI.REWARDED_VIDEO:self.game.analytics.showRewardedVideoAd();break;case iI.REWARDED_INTERSTITIAL:self.game.analytics.showRewardedInterstitialAd();break}}},{key:"pushInstanceToQueue",value:function pushInstanceToQueue(e){var t=null;switch(this.type){case iI.INTERSTITIAL:t=this.interstitialAdInstanceList;break;case iI.REWARDED_VIDEO:t=this.rewardedVideoAdInstanceList;break;case iI.REWARDED_INTERSTITIAL:t=this.rewardedInterstitialAdInstanceList;break}t&&t.push(e)}}]);return Me}(iS);var iP=r.Plugins.Analytics,iE=iP.BaseAnalytics,ix=iP.Events,iC=[ix.BUTTON_CLICK,ix.SCREEN_OPEN],iN=r.Utils,iT=iN.Array;var iL=function(e){_inherits(qo,e);var t=_create_super(qo);function qo(e,r){_class_call_check(this,qo);var c;c=t.call(this,e,"FacebookAnalytics",_object_spread_props(_object_spread({},r),{color:"#0F52BA"}));u(_assert_this_initialized(c),"prefix");c.prefix=r.prefix;return c}_create_class(qo,[{key:"processEvent",value:function processEvent(e,t){if(!("logEvent"in GameSDK.extra)||iT.has(iC,e))return;var r=this.addPrefixToEventName(e);GameSDK.extra.logEvent(r,1,t)}},{key:"addPrefixToEventName",value:function addPrefixToEventName(e){return"".concat(this.prefix,"_").concat(e)}}]);return qo}(iE);var iM=r.Plugins.Analytics,iO=iM.BaseAnalytics,iR=iM.Events,iF=[iR.SCREEN_OPEN],iG=r.Utils,iU=iG.Array;var iV=function(e){_inherits(Zo,e);var t=_create_super(Zo);function Zo(e,r){_class_call_check(this,Zo);return t.call(this,e,"FirebaseAnalytics",_object_spread_props(_object_spread({},r),{color:"#FFCA28"}))}_create_class(Zo,[{key:"setUser",value:function setUser(e,t){var r;null==(r=this.game.firebase.services.analytics)||r.setUser(e,t)}},{key:"processEvent",value:function processEvent(e,t){var r;iU.has(iF,e)||null==(r=this.game.firebase.services.analytics)||r.event(e,t)}}]);return Zo}(iO);var ij=r.Plugins.Analytics,iB=ij.BaseAnalytics,iz=ij.Events,iH=[iz.SCREEN_OPEN],iK=r.Utils,iW=iK.Array;var iq=function(e){_inherits(ar,e);var t=_create_super(ar);function ar(e,r){_class_call_check(this,ar);return t.call(this,e,"GoogleAnalytics",_object_spread_props(_object_spread({},r),{color:"#E35335"}))}_create_class(ar,[{key:"processEvent",value:function processEvent(e,t){iW.has(iH,e)||(this.customEvent(e,t),gtag("event",e,t))}},{key:"customEvent",value:function customEvent(e,t){switch(e){case iz.AD_SHOW:case iz.AD_SHOW_FAILED:case iz.AD_SHOWING:case iz.USE_ITEM:case iz.EARN_ITEM:this.addLevelName(t);break}}},{key:"addLevelName",value:function addLevelName(e){if(!e||!(null!=game&&game.match))return;var t=game.match.getMatchState().customData.level;t<0||(e.level_name=this.getLevelName(t))}}]);return ar}(iB);var iJ="production",iY="0",iZ=r.Dtos,iQ=r.Events,i$=r.Configs,iX=r.Utils,i0=iX.Object,i2=iX.Json,i3=iX.String,i1=iX.Valid,i4=iX.Mark;var i5=function(e){_inherits(cr,e);var c=_create_super(cr);function cr(){_class_call_check(this,cr);var e;e=c.call.apply(c,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"markName","Core Initialize");u(_assert_this_initialized(e),"modulePlugins",[]);u(_assert_this_initialized(e),"handleProtectGameInstance",function(){var t=e.event.getEventEmitCount(d.MODULE_PLUGIN_READY),r=e.modulePlugins.length;t<r||(window.game=Object.freeze(window.game),y(window,"game"))});u(_assert_this_initialized(e),"initMonitorErrorPlugin",function(){var t;if(!e.monitorError)return;null==(t=window.disableSimpleTrackErrors)||t.call(window);var r=i$.Debugger,c=r.MonitorError,l=r.ListPlayerDevIds,_=c.ApiKey,h=c.Service,d=c.Feedback,y=c.TrackUser,f=c.FilterErrors,p=GameSDK.player.getID(),v=GameSDK.player.getName();p&&l.indexOf(p)>=0||(e.monitorError.configure({apiKey:_,service:h,feedback:d,trackUser:y,releaseStage:iJ,buildVersion:"".concat(iY)}),e.monitorError.setUser({id:p,name:v}),e.monitorError.addFilterErrors(f),e.monitorError.initFeedbackTrackErrors(),e.updateMonitorErrorUserAndMetadata(),e.processErrorsQueue())});u(_assert_this_initialized(e),"updateMonitorErrorUserAndMetadata",function(){e.event.catchUp(iQ.PLAYER_INFO_LOADED,e.processWhenPlayerInfoLoaded)});u(_assert_this_initialized(e),"processErrorsQueue",function(){if(e.monitorError&&window.__errorQueue){var t=true,r=false,c=void 0;try{for(var l=window.__errorQueue[Symbol.iterator](),_;!(t=(_=l.next()).done);t=true){var h=_.value;if(_instanceof(h,Error))e.monitorError.sendException(h);else{var d=h||{message:"",code:"Unknown",stack:"Unknown stack"},y=d.message,f=d.code,p=d.stack,v=new Error(y||f);v.stack=p,e.monitorError.sendException(v)}}}catch(e){r=true;c=e}finally{try{if(!t&&null!=l.return)l.return()}finally{if(r)throw c}}window.__errorQueue=null}});u(_assert_this_initialized(e),"processWhenPlayerInfoLoaded",function(){if(!e.monitorError)return;var t=e.player.getPlayer(),r=t.playerId,c=t.name;e.monitorError.setUser({id:r,name:c}),e.monitorError.addMetadata({isFirstLogin:e.player.isFirstLogin()})});u(_assert_this_initialized(e),"handleSaveRemoteConfig",function(t){try{var r=_define_property({},t.type,t);e.player.setPlayerDataByName("remoteConfig",r)}catch(e){}});u(_assert_this_initialized(e),"handleUpdateGameCoreConfig",function(t){try{var c=t.id,l=t.type;if("GameCore"!==l)return;r.Configs=i0.merge(r.Configs,t.config);var _=r.Configs,h=_.Ads;e.ads.configure(h),e.event.emit(d.REMOTE_CONFIG_UPDATED,{id:c,type:l})}catch(e){}});u(_assert_this_initialized(e),"handleStorageCurrentRemoteConfig",function(){var t=e.player.getPlayerDataByKey("remoteConfig");if(t){for(var r in t)if(i0.hasOwn(t,r)){var c=t[r],l=i2.clone(c),_=new iZ.RemoteConfig.Data(l).toObject();e.remoteConfig.setRemoteConfig(_),e.remoteConfig.processUpdateConfig(_.id,_.type)}}});u(_assert_this_initialized(e),"initAdaptivePerformancePlugin",function(){if(!e.adaptivePerformance)return;var t=i2.clone(i$.AdaptivePerformance);e.adaptivePerformance.configure(t)});u(_assert_this_initialized(e),"processAfterSyncProfile",function(){var t=i$.Notification;t.Enabled&&e.updatePlayerProfileToNotificationService()});return e}_create_class(cr,[{key:"getBuildVersion",value:function getBuildVersion(){return Number.parseInt("".concat(iY))||0}},{key:"boot",value:function boot(){var e=this;var t=this,_superprop_get_boot=function(){return _get(_get_prototype_of(cr.prototype),"boot",e)};return _async_to_generator(function(){return _ts_generator(this,function(e){_superprop_get_boot().call(t),t.addPlugins(),t.initEventPlugin(),t.event.emit(iQ.CORE_BOOTING),t.initFirebasePlugin(),t.initMarkCoreInitialize(),i4.putAttr(t.markName,"Step","Init Plugins"),t.initAds(),t.initMatchPlugin(),t.initRemoteConfig(),i4.putAttr(t.markName,"Step","Load Lazy Plugins"),i1.isDebugger()||t.event.on(iQ.MODULE_PLUGIN_READY,t.handleProtectGameInstance),t.addMonitorPlugin().then(t.initMonitorErrorPlugin),t.addAdaptivePerformancePlugin().then(t.initAdaptivePerformancePlugin),i4.putAttr(t.markName,"Step","Load Dev Plugins"),t.addDevPlugins();return[2]})})()}},{key:"start",value:function start(){var e=this;var t=this,_superprop_get_start=function(){return _get(_get_prototype_of(cr.prototype),"start",e)};return _async_to_generator(function(){var e;return _ts_generator(this,function(r){switch(r.label){case 0:_superprop_get_start().call(t),i4.putAttr(t.markName,"Step","Core Start"),t.event.emit(iQ.CORE_STARTING),i4.putAttr(t.markName,"Step","Request Token");return[4,t.auth.requestToken()];case 1:r.sent(),i4.putAttr(t.markName,"Step","Init States");return[4,t.initState()];case 2:r.sent(),i4.putAttr(t.markName,"Step","Process Player Profile"),t.processPlayerProfile(),i4.putAttr(t.markName,"Step","Process Context Payload");return[4,t.context.detectContextSessionType()];case 3:r.sent(),t.context.detectContextGameMode();e=t.storage.getStorageData("context","sessionContextType");i4.putAttr(t.markName,"Context Mode",e),i4.putAttr(t.markName,"Step","Init Analytics"),t.initGoogleAnalytics(),t.initFirebaseAnalytics(),t.initFacebookAnalytics(),i4.putAttr(t.markName,"Step","Core Ready"),i4.putAttr(t.markName,"Success","true"),i4.stop(t.markName),t.event.emit(iQ.CORE_READY);return[2]}})})()}},{key:"addPlugins",value:function addPlugins(){this.installPlugin("Storage",ih),this.installPlugin("Event",tm),this.installPlugin("Ads",eN),this.installPlugin("Auth",eB),this.installPlugin("Audio",eV),this.installPlugin("Match",sr),this.installPlugin("Player",sk),this.installPlugin("Profile",ia),this.installPlugin("Context",e5),this.installPlugin("Language",t1),this.installPlugin("Analytics",eF),this.installPlugin("Visibility",id),this.installPlugin("Leaderboard",af),this.installPlugin("DailyRewards",td),this.installPlugin("FrameCapture",tQ),this.installPlugin("RemoteConfig",tA),"Proxy"in window&&this.installPlugin("Firebase",tA)}},{key:"installPlugin",value:function installPlugin(e,t,r){var c=arguments.length>2&&void 0!==r&&r;var l=i3.toCamelCase(i3.capitalize(e));this.plugins.install(e,t,!0,l),"Storage"!==e&&(c?this.emitModulePluginReady(e):this.emitCorePluginReady(e))}},{key:"addMonitorPlugin",value:function addMonitorPlugin(){var e=this;return _async_to_generator(function(){var r,c,l;return _ts_generator(this,function(h){switch(h.label){case 0:r=i$.Debugger,c=r.MonitorError;if(!c.Enabled)return[2];e.modulePlugins.push("MonitorError");return[4,_(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tw})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:l=h.sent().default;"function"==typeof l&&e.installPlugin("MonitorError",l,!0);return[2]}})})()}},{key:"addAdaptivePerformancePlugin",value:function addAdaptivePerformancePlugin(){var e=this;return _async_to_generator(function(){var r,c;return _ts_generator(this,function(l){switch(l.label){case 0:r=i$.AdaptivePerformance;if(!r.Enabled)return[2];e.modulePlugins.push("AdaptivePerformance");return[4,_(_async_to_generator(function(){var e,r;return _ts_generator(this,function(c){switch(c.label){case 0:return[4,t.import("./bundle/index.js")];case 1:e=c.sent(),r=e.default;return[2,{default:r}]}})}),void 0,t.meta.url)];case 1:c=l.sent().default;"function"==typeof c&&e.installPlugin("AdaptivePerformance",c,!0);return[2]}})})()}},{key:"addDevPlugins",value:function addDevPlugins(){var e=i$.Debugger,t=e.ListPlayerDevIds,r=GameSDK.player.getID();!r||t.indexOf(r)<0||(this.addConsolePlugin(),this.addProfilerPlugin(),this.addCanvasRecorderPlugin())}},{key:"addConsolePlugin",value:function addConsolePlugin(){var e=this;return _async_to_generator(function(){var r,c,l;return _ts_generator(this,function(h){switch(h.label){case 0:h.trys.push([0,2,,3]);r=i$.Debugger,c=r.Console;if(!c.Enabled)return[2];e.modulePlugins.push("Console");return[4,_(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tw})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:l=h.sent().default;if("function"!=typeof l)throw new Error("ConsolePlugin is not a function");e.installPlugin("Console",l,!0),e.initConsolePlugin();return[3,3];case 2:h.sent();return[3,3];case 3:return[2]}})})()}},{key:"addProfilerPlugin",value:function addProfilerPlugin(){var e=this;return _async_to_generator(function(){var r,c,l;return _ts_generator(this,function(h){switch(h.label){case 0:h.trys.push([0,2,,3]);r=i$.Debugger,c=r.Profiler;if(!c.Enabled)return[2];e.modulePlugins.push("Profiler");return[4,_(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tw})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:l=h.sent().default;if("function"!=typeof l)throw new Error("ProfilerPlugin is not a function");e.installPlugin("Profiler",l,!0),e.initProfilerPlugin();return[3,3];case 2:h.sent();return[3,3];case 3:return[2]}})})()}},{key:"addCanvasRecorderPlugin",value:function addCanvasRecorderPlugin(){var e=this;return _async_to_generator(function(){var r,c,l;return _ts_generator(this,function(h){switch(h.label){case 0:h.trys.push([0,2,,3]);r=i$.Debugger,c=r.CanvasRecorder;if(!c.Enabled)return[2];e.modulePlugins.push("CanvasRecorder");return[4,_(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tw})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:l=h.sent().default;if("function"!=typeof l)throw new Error("CanvasRecorderPlugin is not a function");e.installPlugin("CanvasRecorder",l,!0),e.initCanvasRecorderPlugin();return[3,3];case 2:h.sent();return[3,3];case 3:return[2]}})})()}},{key:"emitCorePluginReady",value:function emitCorePluginReady(e){this.event.emit(d.CORE_PLUGIN_READY,{name:e})}},{key:"emitModulePluginReady",value:function emitModulePluginReady(e){this.event.emit(d.MODULE_PLUGIN_READY,{name:e})}},{key:"initEventPlugin",value:function initEventPlugin(){var e=i$.Debugger,t=e.EventLogging;t.Enabled&&this.event.enableLogEvent()}},{key:"initMatchPlugin",value:function initMatchPlugin(){this.match.setUseCPUProfile(!1)}},{key:"initAds",value:function initAds(){var e=r.Plugins,t=e.Ads;this.ads.configure(i$.Ads),this.initAdInstance(t,i$)}},{key:"initAdInstance",value:function initAdInstance(e,t){var r=t.Ads,c=r.InterstitialAdOptions,l=r.RewardedVideoAdOptions,_=r.RewardedInterstitialAdOptions,h=r.BannerDisplayAdOptions;var d=true,y=false,f=void 0;try{for(var p=c[Symbol.iterator](),v;!(d=(v=p.next()).done);d=true){var g=v.value;this.ads.setAdInstance(e.Types.INTERSTITIAL,g.PlacementId,iD)}}catch(e){y=true;f=e}finally{try{if(!d&&null!=p.return)p.return()}finally{if(y)throw f}}var m=true,A=false,I=void 0;try{for(var E=l[Symbol.iterator](),x;!(m=(x=E.next()).done);m=true){var C=x.value;this.ads.setAdInstance(e.Types.REWARDED_VIDEO,C.PlacementId,iD)}}catch(e){A=true;I=e}finally{try{if(!m&&null!=E.return)E.return()}finally{if(A)throw I}}var N=true,T=false,L=void 0;try{for(var O=_[Symbol.iterator](),F;!(N=(F=O.next()).done);N=true){var G=F.value;this.ads.setAdInstance(e.Types.REWARDED_INTERSTITIAL,G.PlacementId,iD)}}catch(e){T=true;L=e}finally{try{if(!N&&null!=O.return)O.return()}finally{if(T)throw L}}var V=true,H=false,K=void 0;try{for(var q=h[Symbol.iterator](),Q;!(V=(Q=q.next()).done);V=true){var $=Q.value;this.ads.setAdInstance(e.Types.BANNER,$.PlacementId,ig)}}catch(e){H=true;K=e}finally{try{if(!V&&null!=q.return)q.return()}finally{if(H)throw K}}}},{key:"initState",value:function initState(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);t=new Js(e);t.initContext();return[4,t.initPlayer()];case 1:r.sent();return[3,3];case 2:r.sent();return[3,3];case 3:return[2]}})})()}},{key:"initConsolePlugin",value:function initConsolePlugin(){this.console&&this.console.configure()}},{key:"initProfilerPlugin",value:function initProfilerPlugin(){this.profiler&&this.profiler.configure()}},{key:"initCanvasRecorderPlugin",value:function initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;var e=i$.Debugger,t=e.CanvasRecorder,r=t.Options,c=r.Type,l=r.Quality,_=r.RecordFps,h=r.SyncFps;this.canvasRecorder.configure({type:c,quality:l,syncFps:h,recordFps:_});var d=document.querySelector("canvas");d&&this.canvasRecorder.setCanvas(d)}},{key:"initRemoteConfig",value:function initRemoteConfig(){var e=i$.RemoteConfig;if(!e.Enabled)return;var t=i2.clone(e);this.remoteConfig.configure(t),this.event.on(d.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(d.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.catchUp(d.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}},{key:"initFirebasePlugin",value:function initFirebasePlugin(){var e=i$.Firebase;if(!e.Enabled||!this.firebase)return;var t=i2.clone(e);this.firebase.configure(t),i4.setService(this.firebase.services.performance)}},{key:"initMarkCoreInitialize",value:function initMarkCoreInitialize(){i$.PerformanceMonitor.CoreFlows&&(i4.measure(this.markName),i4.putAttr(this.markName,"Build","".concat(iY)),i4.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),i4.putAttr(this.markName,"Platform",GameSDK.getPlatform()),i4.putAttr(this.markName,"Success","false"),i4.start(this.markName))}},{key:"processPlayerProfile",value:function processPlayerProfile(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:t.trys.push([0,2,,3]);return[4,e.player.syncProfileToServer()];case 1:t.sent(),e.processAfterSyncProfile();return[3,3];case 2:t.sent();return[3,3];case 3:return[2]}})})()}},{key:"updatePlayerProfileToNotificationService",value:function updatePlayerProfileToNotificationService(){var e=this;return _async_to_generator(function(){var t,r,c,l,_,h,d;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);t=i$.AppId,r=e.player.getPlayer(),c=r.ASID,l=r.playerId,_=r.name,h=r.photo,d=r.locale;return[4,eb({appId:t,ASID:c,playerId:l,name:_,photo:h,locale:d})];case 1:y.sent();return[3,3];case 2:y.sent();return[3,3];case 3:return[2]}})})()}},{key:"initGoogleAnalytics",value:function initGoogleAnalytics(){var e;var t=null!==(e=i$.Analytics.GoogleAnalytics)&&void 0!==e?e:{},r=t.Enabled,c=t.ConsoleLog;r&&this.analytics.add(new iq(this.game,{log:!!c}))}},{key:"initFirebaseAnalytics",value:function initFirebaseAnalytics(){var e=this;var t;var r=null!==(t=i$.Analytics.FirebaseAnalytics)&&void 0!==t?t:{},c=r.Enabled,l=r.ConsoleLog;if(!c)return;var _=new iV(this.game,{log:!!l});this.analytics.add(_);var h="no_entry";GameSDK.getEntryPointAsync().then(function(e){h=e}).catch(function(e){}).finally(function(){var t=e.player.getPlayer(),r=t.playerId,c=t.locale,l=GameSDK.getEntryPointData()||{},d=l.fbig_ad_id,y=l.fbig_adset_id,f=l.fbig_campaign_id;_.setUser(r,{locale:c,ad_id:d,adset_id:y,campaign_id:f,traffic_source:h})})}},{key:"initFacebookAnalytics",value:function initFacebookAnalytics(){var e;var t=null!==(e=i$.Analytics.FacebookAnalytics)&&void 0!==e?e:{},r=t.Enabled,c=t.Prefix,l=t.ConsoleLog;r&&"string"==typeof c&&this.analytics.add(new iL(this.game,{prefix:c,log:!!l}))}}]);return cr}(c.Game);var i6=r.Configs,i7=i6.GameEngine,i8=i7.ForceDesktopDPR,i9=r.Utils,ot=i9.Device,or=r.Events,os=function(){var e=_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:e=new i5;window.game=e;t=20;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t),window.__gameCoreStart=!0;return[4,e.boot()];case 1:r.sent(),e.event.catchUp(or.REQUEST_CORE_START,Vs),hr(e);return[2]}})});return function dr(){return e.apply(this,arguments)}}(),Vs=function(){if(!window.__sdkInitiated){game.event.catchUp(or.GAME_SDK_READY,Vs);return}window.game.start();var e=25;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e)},hr=function(e){var t=setInterval(function(){if(!window.__sdkInitiated)return;clearInterval(t);var r=10;window.__sdkLoadingCount<r&&(window.__sdkLoadingCount=r),e.event.emit(or.GAME_SDK_READY)},5)};!1!==i8&&ot.isDesktop()&&"number"==typeof i8&&i8>0&&(window.devicePixelRatio=i8),os()}}});