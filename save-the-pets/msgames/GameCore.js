var yr=Object.defineProperty;var ld=(et,b,p)=>b in et?yr(et,b,{enumerable:!0,configurable:!0,writable:!0,value:p}):et[b]=p;var l=(et,b)=>yr(et,"name",{value:b,configurable:!0});var u=(et,b,p)=>ld(et,typeof b!="symbol"?b+"":b,p);System.register(["./bundle/core.js","./bundle/__commonjsHelpers__.js"],function(et,b){"use strict";var p,O,Do,rt,G,ct,Po;return{setters:[R=>{p=R.G,O=R.P,Do=R.M,rt=R._,G=R.a,ct=R.C},R=>{Po=R.g}],execute:l(function(){var Gt,kt,Vt;const{Valid:R,Object:yt,String:ke,Json:Eo}=p.Utils,Ft="is invalid",X=class X{static addDefaultData(e){R.isObject(e)||this.prototype.exception("default data",Ft),e=Eo.clone(e);const{name:t}=this;R.isObject(X.data[t])||(X.data[t]={}),X.data[t]=yt.merge(X.data[t],e),console.info(`${t} default data:`,X.data[t])}static getDefaultData(){const{name:e}=this;return Eo.clone(X.data[e])}static addValidateFunction(e,t){R.isString(e)||this.prototype.exception("validate key",Ft),typeof t!="function"&&this.prototype.exception("validate function",Ft);const s=`validate${ke.capitalize(e)}`;yt.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){const{name:e}=this.constructor;this.lazyDefaultData(X.data[e])}lazyDefaultData(e){R.isObject(e)||this.exception("data",Ft);for(const t in e)if(yt.hasOwn(e,t)){const s=e[t];yt.assign(this,{[t]:s})}}lazyValidateStructure(e){R.isObject(e)||this.exception("structure","is not object");const t=this.getKeys();for(const s of t){const a=this[s];a===void 0&&this.exception("structure",`has no key ${s}`),!yt.hasOwn(e,s)&&a!==void 0&&this.setDefaultData(s,e)}}setDefaultData(e,t){R.isObject(t)||this.exception("data",Ft);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),yt.assign(t,{[e]:s})}lazyValidateData(e){const t=this.getKeys();for(const s of t){const a=e[s],n=ke.removeDiacritics(s).replace(/[^a-zA-Z0-9]/g,""),i=`validate${ke.capitalize(n)}`,o=this[i];if(typeof o=="function")try{o.call(this,a)}catch(r){console.warn(r),this.setDefaultData(s,e)}else this.exception("validate",`has no function ${i}`)}}lazySetupData(e){const t=this.getKeys();for(const s of t){const a=e[s];yt.assign(this,{[s]:a})}}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};l(X,"BaseDtos"),u(X,"data",{});let k=X;p.Dtos={Base:k};const pr={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded",notificationData:"notificationData"},pt={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0,notificationData:{currentId:0,lastSent:0}}},{Valid:Ut}=p.Utils,{playerId:fr,name:gr,photo:wr,locale:mr}=pt,Bt="is invalid",Va=class Va extends k{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Ut.isString(e)||!e)&&this.exception("_id",Bt)}validatePlayerId(e){(!Ut.isString(e)||!e)&&this.exception("playerId",Bt)}validateName(e){(!Ut.isString(e)||!e)&&this.exception("name",Bt)}validatePhoto(e){Ut.isString(e)||this.exception("photo",Bt)}validateLocale(e){(!Ut.isString(e)||!e)&&this.exception("locale",Bt)}toObject(){return super.toObject()}};l(Va,"PlayerInfoDtos");let Nt=Va;Nt.addDefaultData({playerId:fr,name:gr,photo:wr,locale:mr});const st=new Nt({playerId:"10",name:"Your Friend"}).toObject(),Fa=class Fa extends Error{constructor(t){super(t);u(this,"code");this.code="CREATE_MATCH_FAILED"}};l(Fa,"ACreateMatchFailed");let q=Fa;const Ua=class Ua extends q{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}};l(Ua,"PlayerIdNotValid");let P=Ua;const{Dtos:Ve,Utils:Ar,Events:Ir}=p,{Array:Dr,Object:Pr,Json:Fe,Valid:So}=Ar,Ba=class Ba{constructor(e){u(this,"game");u(this,"initContext",l(()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new Ve.Context.Info(e),{contextId:s,contextType:a,entryPointData:n}=t.toObject();this.game.context.receiveContext(s,a,n)},"initContext"));u(this,"initPlayer",l(async()=>{const{player:e}=this.game,t=this.getPlayerInfo();console.info("playerInfo",Fe.clone(t));const s=Dr.unique(Pr.vals(pr));console.info("dataKeys",s);const a=await GameSDK.player.getDataAsync(s);console.info("rawData",Fe.clone(a));const n=new Ve.Player.Data(a).toObject();console.info("playerData",Fe.clone(n)),e.receiveData(t,n),this.game.event.emit(Ir.PLAYER_INFO_LOADED)},"initPlayer"));u(this,"getPlayerInfo",l(()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),a=GameSDK.getLocale();if(!So.isString(e))throw new P;return So.isString(t)||(t="You"),new Ve.Player.Info({playerId:e,name:t,photo:s,locale:a}).toObject()}catch{return st}},"getPlayerInfo"));this.game=e}};l(Ba,"StateInitiator");let Ue=Ba;const ja=class ja extends Error{constructor(t,s){super(t);u(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}};l(ja,"BadRequest");let jt=ja;const Ka=class Ka extends Error{constructor(t,s){super(t);u(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}};l(Ka,"RequestTimeout");let Kt=Ka;const{Utils:Er,Configs:Sr}=p,{AppId:vo,Network:Be}=Sr,vr=l(f=>{if(!f.ok)throw new jt(void 0,{response:f})},"validateResponse"),xo=l(()=>{const f=window.game.auth.getToken();return{token:f,timeout:Be.Timeout,headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}}},"defaultConfig"),bo=l((f,e,t,s)=>async()=>{try{if(!vo)throw new jt("AppId is not defined");const a=`${f}/apps/${vo}/${e}`,n=new AbortController;t.signal=n.signal;const i=setTimeout(()=>{n.abort()},t.timeout);p.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const o=await fetch(a,t);return clearTimeout(i),vr(o),await o.json()||{}}catch(a){if(a instanceof jt)return null;throw a instanceof Object&&"name"in a&&a.name==="AbortError"?new Kt:a}},"requester"),je=l(async(f,e)=>{try{return f()}catch(t){if(t instanceof Kt&&e>0)try{return await Er.Time.sleepAsync(600),await je(f,e-1)}catch{return{}}return t instanceof Kt?{}:(console.warn("Request error",t),{})}},"handleRequest"),ft=l(async(f,e,t,s=Be.Retries)=>{try{const a={...xo(),...e,method:"GET"},n=bo(t,f,a);return await je(n,s)}catch(a){return console.warn("Get error",a),{}}},"get"),V=l(async(f,e,t,s,a=Be.Retries)=>{try{const n={...xo(),...t,method:"POST"},i=bo(s,f,n,e);return await je(i,a)}catch(n){return console.warn("Post error",n),{}}},"post"),{Configs:{Notification:{ApiUrl:xr}},Utils:{Object:br}}=p,Nr=l(async f=>{if(!br.hasOwn(f,"playerId"))throw new Error("Missing playerId");const{playerId:e}=f;await V(`players/${e}`,f,{},xr,10)},"updatePlayerProfileNotificationAsync");var No=(f=>(f.IDLE="idle",f.LOADING="loading",f.FILLED="filled",f.SHOWING="showing",f))(No||{});const Co=No;var To=(f=>(f.BANNER="banner",f.INTERSTITIAL="interstitial",f.REWARDED_VIDEO="rewarded_video",f.REWARDED_INTERSTITIAL="rewarded_interstitial",f))(To||{});const Y=To;let de=(Gt=class extends Error{constructor(t,s){super(s);u(this,"code");this.code=t,this.message=s}},l(Gt,"AdError"),Gt);const Wa=class Wa{constructor(e,t){u(this,"type");u(this,"placementId");u(this,"_status");this.type=e,this._status=Co.IDLE,this.placementId=t}setStatus(e){this._status!==e&&(this._status=e)}get status(){return this._status}exception(e){throw new de("AD_INSTANCE_ERROR",e)}};l(Wa,"BaseInstance");let Ke=Wa,Lo=(kt=class extends Ke{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}},l(kt,"AdInstance"),kt);p.Plugins.Ads={Types:Y,Status:Co,AdError:de,AdInstance:Lo};const{Array:We,Object:Cr}=p.Utils,za=class za extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"enabled");u(this,"config");u(this,"lastCallAdShownTime");u(this,"isAdFullSizeShowed");u(this,"ads",{});u(this,"fallbackAds",{});u(this,"safeAreaBottom")}init(){this.lastCallAdShownTime={[Y.BANNER]:0,[Y.INTERSTITIAL]:0,[Y.REWARDED_VIDEO]:0,[Y.REWARDED_INTERSTITIAL]:0},this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=Number.parseInt(t,10),Number.isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new de("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(t,s,a,n=!1){const i=n?this.fallbackAds:this.ads;if(i[s]){console.warn(`AdsPlugin: Ad instance with placementId ${s} already exists`);return}i[s]={type:t,placementId:s,interval:null,instance:new a(t,s)}}async loadAdAsync(t){this.checkEnabled(),await this.getAd(t).instance.loadAsync()}async showAdAsync(t){this.checkEnabled();const{type:s,placementId:a}=t,{event:n}=this.game,i=this.getAd(t);this.lastCallAdShownTime[s]=window.performance.now()/1e3;try{n.emit(p.Events.AD_SHOWING,{placementId:a}),this.isAdFullSizeShowed=!0,await i.instance.showAsync()}finally{n.emit(p.Events.AD_CLOSED,{placementId:a}),this.isAdFullSizeShowed=!1}}getAdStatus(t){return this.checkEnabled(),this.getAd(t).instance.status}getAd(t){let s=null;const{type:a,placementId:n,isFallback:i=!1}=t;if(n?s=this.getAdByPlacementId(n,i):s=this.getPriorityAdByType(a,i),!s)throw new de("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return s}getAdsByType(t,s){const a=s?this.fallbackAds:this.ads;return Cr.vals(a).filter(n=>n.type===t)}getAdByPlacementId(t,s){const n=(s?this.fallbackAds:this.ads)[t];return n||null}getPriorityAdByType(t,s){const a=this.getAdsByType(t,s);if(!a.length)return null;const n=We.search(a,i=>i.type===t);return n||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let a;if(t)a=this.getCommonAdConfig(t);else{const d=this.getPriorityAdByType(Y.INTERSTITIAL,!1);if(!d)return!1;a=this.getCommonAdConfig(d.placementId)}const{SecondsBetweenAds:n,SecondsFirstTime:i}=a,o=s-this.lastCallAdShownTime[Y.INTERSTITIAL],r=o>n,c=o>i;return this.lastCallAdShownTime[Y.INTERSTITIAL]>0?r:c}catch(s){return console.warn("Error while checking canbeShowInterstitialAdByTime",s),!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:a}=s;if(a==="ALL")return!0;const n=GameSDK.getPlatform();return n?n===a:!1}catch(s){return console.warn("Error while checking canbeShowBannerAd",s),!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd({type:Y.BANNER,placementId:t,isFallback:!1});if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const{event:a}=this.game;if(a.emit(p.Events.AD_SHOWING,{placementId:t}),GameSDK.getSDKName()==="MsGames")return;const n=this.getBannerConfig(s.placementId),{SecondsReload:i}=n;i<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},i*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd({type:Y.BANNER,placementId:t,isFallback:!1});this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync();const{event:a}=this.game;a.emit(p.Events.AD_CLOSED,{placementId:t})}cleanBannerReloadTimer(t){try{const s=this.getAd({type:Y.BANNER,placementId:t,isFallback:!1}),{interval:a}=s;if(!a)return;clearInterval(a)}catch(s){console.warn("Error while cleaning banner reload timer",s)}}getCommonAdConfig(t){const s=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions],a=We.search(s,n=>n.PlacementId===t);if(!a)throw new Error(`Ad config with placementId ${t} not found`);return a}getBannerConfig(t){const s=We.search(this.config.BannerDisplayAdOptions,a=>a.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t,s,a=!0){this.checkEnabled();const n=this.getBannerConfig(t),i=GameSDK.getBannerHeight(n);return a?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(i+this.safeAreaBottom)*s):i*s}getSafeAreaBottom(t){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*t}};l(za,"AdsPlugin");let ze=za;const F={ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",MESSAGE:"message",INVITE:"invite",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_SHOWING:"ad_showing",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GET_FREE_ITEM:"get_free_item",USE_ITEM:"use_item",EARN_ITEM:"earn_item"},{String:gt,Valid:Tr}=p.Utils;let Lr=(Vt=class{constructor(e,t,s){u(this,"game");u(this,"name");u(this,"color");u(this,"options");u(this,"selfLog");u(this,"currentPath");this.game=e,this.name=t,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/",console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t){this.logInfo("event",{name:e,payload:t});const s=this.formatEventName(e);this.processEvent(s,t)}logInfo(e,t){this.selfLog&&console.info(`%c${this.name}: ${e}`,`color: ${this.color}`,t)}pageview(e){let t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),document.title=t,this.event(F.PAGE_VIEW,{path_path:e,page_title:t})}levelStart(e,t,s){this.event(F.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e),game_mode:s?gt.toUpperCamelCase(s):void 0})}levelFail(e,t,s){this.event(F.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e),game_mode:s?gt.toUpperCamelCase(s):void 0})}levelRescue(e,t,s){this.event(F.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e),game_mode:s?gt.toUpperCamelCase(s):void 0})}levelComplete(e,t,s){this.event(F.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e),game_mode:s?gt.toUpperCamelCase(s):void 0})}loadAdEvent(e,t,s){this.event(F.AD_LOAD,{ad_type:e,screen_name:t,ad_service:s})}showAdEvent(e,t,s){this.event(F.AD_SHOW,{ad_type:e,screen_name:t,ad_service:s})}loadInterstitialAd(e,t){this.loadAdEvent("interstitial",e,t)}showInterstitialAd(e,t){this.showAdEvent("interstitial",e,t)}loadRewardedVideoAd(e,t){this.loadAdEvent("rewarded_video",e,t)}showRewardedVideoAd(e,t){this.showAdEvent("rewarded_video",e,t)}receiveVideoReward(e,t){this.event(F.AD_REWARD,{screen_name:e,ad_service:t})}loadRewardedInterstitialAd(e,t){this.loadAdEvent("rewarded_interstitial",e,t)}showRewardedInterstitialAd(e,t){this.showAdEvent("rewarded_interstitial",e,t)}receiveInterstitialReward(e,t){this.event(F.AD_REWARD,{screen_name:e,ad_service:t})}loadAdFail(e,t,s){this.event(F.AD_LOAD_FAILED,{ad_type:e,screen_name:t,ad_service:s})}showAdFail(e,t,s){this.event(F.AD_SHOW_FAILED,{ad_type:e,screen_name:t,ad_service:s})}showingAd(e,t,s){this.event(F.AD_SHOWING,{ad_type:e,screen_name:t,ad_service:s})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}getLevelName(e){return`Level ${gt.padStart(e.toString(),5,"0")}`}getPageTitle(e){const t=e.split("/").pop();if(!Tr.isString(t))return e;const s=t.replace(/([-_\s.])/g," $1");return gt.toUpperCamelCase(s)}addGameModeToPageTitle(e){const{match:t}=this.game,s=t.getMatchState();let{mode:a}=s;return a||(a="Normal"),`${gt.toUpperCamelCase(a)}::${e}`}},l(Vt,"BaseAnalytics"),Vt);p.Plugins.Analytics={Events:F,BaseAnalytics:Lr};const Ha=class Ha extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"analytics",[]);u(this,"placement","unknown");u(this,"pageview",l(t=>{if(!this.isActive())return;this.placement=t;const s=this.getPageByKey(t);for(const a of this.analytics)a.pageview(s)},"pageview"))}add(t){this.analytics.some(a=>a.name===t.name)||this.analytics.push(t)}isActive(){return this.analytics.length>=1}event(t,s){if(this.isActive())for(const a of this.analytics)a.event(t,s)}levelStart(t,s,a){if(this.isActive())for(const n of this.analytics)n.levelStart(t,s,a)}levelRescue(t,s,a){if(this.isActive())for(const n of this.analytics)n.levelRescue(t,s,a)}levelFail(t,s,a){if(this.isActive())for(const n of this.analytics)n.levelFail(t,s,a)}levelComplete(t,s,a){if(this.isActive())for(const n of this.analytics)n.levelComplete(t,s,a)}loadInterstitialAd(t){if(this.isActive())for(const s of this.analytics)s.loadInterstitialAd(this.placement,t)}showInterstitialAd(t){if(this.isActive())for(const s of this.analytics)s.showInterstitialAd(this.placement,t)}loadRewardedVideoAd(t){if(this.isActive())for(const s of this.analytics)s.loadRewardedVideoAd(this.placement,t)}showRewardedVideoAd(t){if(this.isActive())for(const s of this.analytics)s.showRewardedVideoAd(this.placement,t)}receiveVideoReward(t){if(this.isActive())for(const s of this.analytics)s.receiveVideoReward(this.placement,t)}loadRewardedInterstitialAd(t){if(this.isActive())for(const s of this.analytics)s.loadRewardedInterstitialAd(this.placement,t)}showRewardedInterstitialAd(t){if(this.isActive())for(const s of this.analytics)s.showRewardedInterstitialAd(this.placement,t)}receiveInterstitialReward(t){if(this.isActive())for(const s of this.analytics)s.receiveInterstitialReward(this.placement,t)}loadAdFail(t,s){if(this.isActive())for(const a of this.analytics)a.loadAdFail(t,this.placement,s)}showAdFail(t,s){if(this.isActive())for(const a of this.analytics)a.showAdFail(t,this.placement,s)}showingAd(t,s){if(this.isActive())for(const a of this.analytics)a.showingAd(t,this.placement,s)}getPageByKey(t){let s=t;if(s.indexOf("_")>-1){let i=s.replace(/_/g,"-");return i=i.toLowerCase(),i}let a=s.length-1,n="";for(;a>0;){n=s.charAt(a);const i=Number.isNaN(Number.parseInt(n,10)),o=n===n.toUpperCase();i&&o&&(s=`${s.slice(0,a)}-${s.slice(a)}`),a--}return s.toLowerCase()}};l(Ha,"AnalyticsPlugin");let He=Ha;const qa=class qa{constructor(e){u(this,"key");this.key=e}getKey(){return this.key}};l(qa,"BaseAudioPlayer");let qe=qa;const Ya=class Ya{constructor(e){u(this,"id");u(this,"isMuteAll");u(this,"masterVolume");u(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}async play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:a}=s;this.playWithRealConfig(a,t)}else await this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:a=1}=t||{};this.setAudioClip(e,{volume:a,audioPlayer:s}),this.playWithRealConfig(s,t)}catch(s){console.warn("playAudio",s)}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:a=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*a);break;default:throw new Error(`Unsupported function: ${t}`)}}catch(s){console.warn("queueAudioPlayer",s)}}callAudioPlayers(e){const{Object:t}=p.Utils,s=t.vals(this.audioClips);for(const a of s)this.queueAudioPlayer(a,e)}};l(Ya,"BaseChannelManager");let Ye=Ya;p.Plugins.Audio={BaseAudioPlayer:qe,BaseChannelManager:Ye};const Qa=class Qa extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"firstChannelId");u(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}async play(t,s,a){try{await this.getChannel(a).play(t,s)}catch(n){console.warn("playSound",n)}}pause(t,s){try{this.getChannel(s).pause(t)}catch(a){console.warn("pauseSound",a)}}resume(t,s){try{this.getChannel(s).resume(t)}catch(a){console.warn("resumeSound",a)}}stop(t,s){try{this.getChannel(s).stop(t)}catch(a){console.warn("stopSound",a)}}stopAll(t){try{this.getChannel(t).stopAll()}catch(s){console.warn("stopAllSounds",s)}}mute(t){try{this.getChannel(t).muteAll()}catch(s){console.warn("mute",s)}}unmute(t){try{this.getChannel(t).unmuteAll()}catch(s){console.warn("unmute",s)}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch(a){console.warn("setSoundVolume",a)}}getVolume(t){try{return this.getChannel(t).getVolume()}catch(s){return console.warn("getSoundVolume",s),-1}}};l(Qa,"AudioPlugin");let Qe=Qa;const Or={token:"",isRequesting:!1},Xa=class Xa extends O.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",Or)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const n=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",n)}catch(t){if(p.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token",""),console.error(t)}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}};l(Xa,"AuthPlugin");let Xe=Xa;var Oo=(f=>(f.SOLO="solo",f.TOURNAMENT="tournament",f.SHARE_INVITE="share_invite",f.MATCHING_GROUP="matching_group_match",f.CHALLENGE_FRIEND="challenge_friend_match",f))(Oo||{});const wt=Oo,mt=Do,{Configs:Rr,Utils:{Array:Mr,Valid:_r,Browser:$r}}=p,Ja=class Ja{constructor(e){u(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return _r.isObject(e)}isTournamentEntryPoint(e){return Mr.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],e)}receiveContext(e,t,s){const{storage:a}=this.game;a.setStorageData("context","contextId",e),this.isValidEntryPointData(s)?a.setStorageData("context","entryPointData",s):console.warn(`Invalid context type: ${t}`),this.isValidContextType(t)?a.setStorageData("context","contextType",t):console.warn(`Invalid context type: ${t}`)}async detectContextSessionType(){const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:a,TOURNAMENT:n,MATCHING_GROUP:i,SHARE_INVITE:o,CHALLENGE_FRIEND:r}=wt;let c=a;if(s===n&&(c=n),s===i&&(c=i),(s===r||s===o)&&(c=r),c===a)try{Rr.Core.FastCheckTournamentContext?c=this.fastCheckTournamentContext()||c:c=await this.outdatedCheckTournamentContext()||c}catch{}e.setStorageData("context","sessionContextType",c)}fastCheckTournamentContext(){const t=$r.getQueryParams().entry_point;return typeof t!="string"||!this.isTournamentEntryPoint(t)?!1:wt.TOURNAMENT}async outdatedCheckTournamentContext(){return"getTournamentAsync"in GameSDK&&(await GameSDK.getTournamentAsync()).getEndTime()>Date.now()/1e3?wt.TOURNAMENT:!1}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),a=t.getStorageData("context","sessionContextType"),n=e.getPlayerId(),{matchId:i,playerId:o,opponentId:r=st.playerId}=s,c=n===o,h=r===st.playerId||[r,o].indexOf(n)>=0,{TOURNAMENT:y,MATCHING_GROUP:g,SHARE_INVITE:w,CHALLENGE_FRIEND:I}=wt;let m=mt.SINGLE;a===y&&(m=mt.TOURNAMENT),a===w&&!c&&(m=mt.CHALLENGE_FRIEND),a===I&&i&&h&&(m=mt.CHALLENGE_FRIEND),a===g&&(m=mt.MATCHING_GROUP),t.setStorageData("context","contextGameMode",m)}};l(Ja,"Context");let Je=Ja;const Za=class Za extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e??"Player has finished match"}};l(Za,"PlayerHasFinishedMatch");let he=Za;const tn=class tn extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}};l(tn,"PlayerNotJoinInMatch");let Wt=tn;const{Events:ue,Plugins:{Analytics:Ro}}=p,en=class en{constructor(e){u(this,"game");this.game=e}async processContextData(){const{player:e,storage:t,monitorError:s}=this.game,a=t.getStorageData("context","contextId"),n=t.getStorageData("context","entryPointData"),i=t.getStorageData("context","sessionContextType"),{type:o,matchId:r,playerId:c,opponentId:d,playerScore:h,action:y}=n||{};y&&await this.processEntryPointAction(y);const g=e.isFirstLogin();setTimeout(()=>{this.logUserAnalytics(g)},1e3);const{TOURNAMENT:w,SHARE_INVITE:I,MATCHING_GROUP:m,CHALLENGE_FRIEND:L}=wt;if(i===w)try{await this.processTournamentModeAsync(a);return}catch{s==null||s.sendException(new Error("Process Tournament Fail"),{contextId:a,isFirstLogin:g,entryPointData:n,playerData:e.getPlayerData()})}if(i===L){if(o===I&&typeof c=="string"){await this.processChallengeFromPostAsync(c);return}if(o===L&&typeof r=="string"&&typeof c=="string"&&typeof d=="string"){await this.processChallengeFromMessageAsync({contextId:a,matchId:r,playerId:c,opponentId:d});return}}if(i===m&&typeof c=="string"&&typeof h=="number"){await this.processMatchingGroupModeAsync(c,h);return}if(g){await this.processSingleModeAsync(!0),e.loggedIn();return}this.processSingleModeAsync(!1)}logUserAnalytics(e){try{const{player:t,analytics:s}=this.game;if(e)s.event(Ro.Events.NEW_USER);else{const{coins:a}=t.getPlayerData().gameData;s.event(Ro.Events.RETURNING_USER,{coins:a})}}catch{}}async processEntryPointAction(e){try{const{player:t}=this.game;switch(e){case"reset_data":t.setPlayerDataByName("score",0),t.setPlayerDataByName("endlessScore",0),t.setGameData({coins:0,level:1}),await t.syncProfileToServer();break;case"enable_debug":t.setPlayerDataByName("debug",!0);break;case"set_locale_en":this.requestSetLocale("en");break;case"set_locale_ru":this.requestSetLocale("ru");break}}catch(t){console.warn("processEntryPointAction",t)}}requestSetLocale(e){const{event:t}=this.game;t.emit(ue.REQUEST_LANGUAGE,{locale:e})}async processTournamentModeAsync(e){const{match:t,player:s}=this.game,a=s.getPlayerId();if(typeof e!="string")throw new Error("Cannot get contextId");await t.tournament.continue.processAsync({playerId:a,contextId:e}),this.switchToGameScene()}async processChallengeFromPostAsync(e){const{match:t,player:s}=this.game,a=s.getPlayerId();if(a===e)await t.single.start.processAsync({playerId:a});else try{await t.challenge.friend.processAsync({playerId:a,opponentId:e})}catch(i){console.warn("processChallengeFromPostAsync",i),await t.single.start.processAsync({playerId:a})}this.switchToGameScene()}async processChallengeFromMessageAsync(e){try{await this.processContinueChallengeFromMessageAsync(e)}catch(t){if(console.warn("processContinueChallengeFromMessageAsync",t),t instanceof he){await this.processAwaitChallengeFromMessageAsync(e);return}if(t instanceof Wt){await this.processJoinChallengeFromMessageAsync(e);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,{match:i,player:o}=this.game,r=o.getPlayerId();if(a===r)await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:r,opponentId:n});else{const d=n===st.playerId;await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:r,opponentId:d?n:a})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();await n.challenge.join.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();try{await n.challenge.await.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToChallengeResultScene()}catch(r){console.warn("processAwaitChallengeFromMessageAsync",r),await this.processResultChallengeFromMessageAsync(e)}}async processResultChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();try{await n.challenge.result.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(e,t){const{match:s,player:a}=this.game;await s.group.join.processAsync({playerId:a.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processSingleModeAsync(e){const{match:t,player:s}=this.game,a=s.getPlayerId();e&&await t.handler.setMatchCustomData({level:0}),await t.single.start.processAsync({playerId:a}),this.switchToGameScene()}switchToDashboardScene(){const{event:e}=this.game;e.emit(ue.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}switchToGameScene(){const{event:e}=this.game;e.emit(ue.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}switchToChallengeResultScene(){const{event:e}=this.game;e.emit(ue.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}};l(en,"Loader");let Ze=en;const Mo={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},{Events:Gr}=p,sn=class sn extends O.Plugins.BasePlugin{constructor(t){super(t);u(this,"context");u(this,"loader");this.loader=new Ze(t),this.context=new Je(t)}init(){const{storage:t}=this.game;t.addStorage("context",Mo)}getSessionContextTypes(){return wt}async processContextData(){try{await this.loader.processContextData()}catch(t){console.error("processContextData",t),this.switchToDashboardScene()}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch(t){console.error("detectContextSessionType",t)}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,a){this.context.receiveContext(t,s,a)}switchToDashboardScene(){const{event:t}=this.game;t.emit(Gr.SWITCH_SCENE,{sceneName:"DashboardScene"})}};l(sn,"ContextPlugin");let ts=sn;const{Valid:es}=p.Utils,{contextId:kr,contextType:Vr,entryPointData:Fr}=Mo,ss="is invalid",an=class an extends k{constructor(){super(...arguments);u(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){es.isString(t)||this.exception("contextId",ss)}validateContextType(t){(!es.isString(t)||!t)&&this.exception("contextType",ss)}validateEntryPointData(t){es.isObject(t)||this.exception("entryPointData",ss)}toObject(){return super.toObject()}};l(an,"ContextInfoDtos");let ye=an;ye.addDefaultData({contextId:kr,contextType:Vr,entryPointData:Fr}),p.Dtos.Context={Info:ye};const Ur={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},{Object:Br}=p.Utils,nn=class nn{async getDailyRewardsAsync(){return Br.vals(Ur)}};l(nn,"DailyRewardsAPI");let as=nn;const zt={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},jr={dailyRewards:{}},_o=p.Configs.DailyRewards,on=class on extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"dailyRewardsApi",new as)}init(){const{storage:t}=this.game;t.addStorage("dailyRewards",jr)}async requestDailyRewardsAsync(){const t=await this.dailyRewardsApi.getDailyRewardsAsync();t.length!==0&&this.receiveDailyRewards(t)}getDailyRewards(){const{storage:t}=this.game,s=t.getStorageData("dailyRewards","dailyRewards");return s||null}logLoginReward(){const{player:t}=this.game,{logDays:s}=t.getPlayerData().dailyRewarded,a=[...s];a[a.length-1]=!0,this.logDailyRewards(a)}logDailyRewards(t,s=!1){const{player:a}=this.game;a.setPlayerDataByName("dailyRewarded",{logDays:t,lastRewarded:s?0:Date.now()})}receiveDailyRewards(t){const{player:s}=this.game,{logDays:a,lastRewarded:n}=s.getPlayerData().dailyRewarded,i=new Date,o=new Date(n),r=new Date(o.toDateString()),c=Math.abs(i.valueOf()-r.valueOf()),h=Math.floor(c/864e5)>1,g=_o.CheckInterrupt&&h||a.length>=_o.MaxDays,w=g?[!1]:[...a,!1];this.logDailyRewards(w);const I=t.map((m,L)=>{const K=L<w.length,x=w.length===L+1,Io=w[L]===!1;let J=zt.WAITING;return x?J=zt.READY:g?J=zt.WAITING:K&&Io?J=zt.SKIPPED:K&&(J=zt.REWARDED),{...m,status:J}});this.setDailyRewards(I)}setDailyRewards(t){const{storage:s}=this.game;s.setStorageData("dailyRewards","dailyRewards",t)}};l(on,"DailyRewardsPlugin");let ns=on;var is={exports:{}};is.exports,function(f){var e=Object.prototype.hasOwnProperty,t="~";function s(){}l(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function a(r,c,d){this.fn=r,this.context=c,this.once=d||!1}l(a,"EE");function n(r,c,d,h,y){if(typeof d!="function")throw new TypeError("The listener must be a function");var g=new a(d,h||r,y),w=t?t+c:c;return r._events[w]?r._events[w].fn?r._events[w]=[r._events[w],g]:r._events[w].push(g):(r._events[w]=g,r._eventsCount++),r}l(n,"addListener");function i(r,c){--r._eventsCount===0?r._events=new s:delete r._events[c]}l(i,"clearEvent");function o(){this._events=new s,this._eventsCount=0}l(o,"EventEmitter"),o.prototype.eventNames=l(function(){var c=[],d,h;if(this._eventsCount===0)return c;for(h in d=this._events)e.call(d,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},"eventNames"),o.prototype.listeners=l(function(c){var d=t?t+c:c,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var y=0,g=h.length,w=new Array(g);y<g;y++)w[y]=h[y].fn;return w},"listeners"),o.prototype.listenerCount=l(function(c){var d=t?t+c:c,h=this._events[d];return h?h.fn?1:h.length:0},"listenerCount"),o.prototype.emit=l(function(c,d,h,y,g,w){var I=t?t+c:c;if(!this._events[I])return!1;var m=this._events[I],L=arguments.length,K,x;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),L){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,d),!0;case 3:return m.fn.call(m.context,d,h),!0;case 4:return m.fn.call(m.context,d,h,y),!0;case 5:return m.fn.call(m.context,d,h,y,g),!0;case 6:return m.fn.call(m.context,d,h,y,g,w),!0}for(x=1,K=new Array(L-1);x<L;x++)K[x-1]=arguments[x];m.fn.apply(m.context,K)}else{var Io=m.length,J;for(x=0;x<Io;x++)switch(m[x].once&&this.removeListener(c,m[x].fn,void 0,!0),L){case 1:m[x].fn.call(m[x].context);break;case 2:m[x].fn.call(m[x].context,d);break;case 3:m[x].fn.call(m[x].context,d,h);break;case 4:m[x].fn.call(m[x].context,d,h,y);break;default:if(!K)for(J=1,K=new Array(L-1);J<L;J++)K[J-1]=arguments[J];m[x].fn.apply(m[x].context,K)}}return!0},"emit"),o.prototype.on=l(function(c,d,h){return n(this,c,d,h,!1)},"on"),o.prototype.once=l(function(c,d,h){return n(this,c,d,h,!0)},"once"),o.prototype.removeListener=l(function(c,d,h,y){var g=t?t+c:c;if(!this._events[g])return this;if(!d)return i(this,g),this;var w=this._events[g];if(w.fn)w.fn===d&&(!y||w.once)&&(!h||w.context===h)&&i(this,g);else{for(var I=0,m=[],L=w.length;I<L;I++)(w[I].fn!==d||y&&!w[I].once||h&&w[I].context!==h)&&m.push(w[I]);m.length?this._events[g]=m.length===1?m[0]:m:i(this,g)}return this},"removeListener"),o.prototype.removeAllListeners=l(function(c){var d;return c?(d=t?t+c:c,this._events[d]&&i(this,d)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,f.exports=o}(is);var Kr=is.exports;const Wr=Po(Kr),lt=new Wr,zr={names:[],history:[]},rn=class rn extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"enableLog",!1);u(this,"muteEvents",[])}init(){const{storage:t}=this.game;t.addStorage("event",zr)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),lt.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),lt.once(t,s)}catchUp(t,s){if(this.validateCallback(s),this.once(t,s),!(this.getEventEmitCount(t)>0))return;const{payload:n}=this.getLastEventInfo(t)??{};this.emit(t,n)}off(t,s){this.validateCallback(s),lt.off(t,s),this.addHistory(t,"action","removed")}mute(t){this.muteEvents.indexOf(t)>-1||this.muteEvents.push(t)}clear(t){lt.removeAllListeners(t),this.addHistory(t,"action","removed")}emit(t,s){if(this.muteEvents.indexOf(t)>-1)return;let a=[];s&&(a=[s]),this.addHistory(t,"action","called",s),lt.emit(t,...a)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,a=s.getStorageData("event","names");a.indexOf(t)<0&&a.push(t)}getEventListeners(){const t=lt.eventNames();return Object.keys(t)}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}getEventEmitCount(t){return this.getHistory().filter(a=>a.name===t&&a.status==="called").length}getLastEventInfo(t){const s=this.getHistory();let a=null;for(let n=s.length-1;n>=0;n--)if(s[n].name===t){a=s[n];break}return a}getTypeFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.type)??null}getCallsFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.called)??0}addHistory(t,s,a,n){const o=this.getTypeFromHistory(t)??s,r=this.getCallsFromHistory(t),c=a==="called"?r+1:r;this.getHistory().push({type:o,status:a,name:t,called:c,payload:n??{}}),this.logEventInfo(t,o,a,c)}logEventInfo(t,s,a,n){if(this.enableLog){if(a==="listening"){console.info(`Event (${s}) ${t}: ${a}`);const i=lt.listenerCount(t);i>1&&console.warn(`Event ${t} has ${i} listener`)}else s!=="action"&&console.info(`Event (${s}) ${t}: ${a} (${n} times)`);a==="called"&&lt.listenerCount(t)<=0&&console.warn(`Event ${t} is called but not listening`)}}};l(rn,"EventPlugin");let os=rn;const rs={},cs=Object.freeze(Object.defineProperty({__proto__:null,default:rs},Symbol.toStringTag,{value:"Module"})),Hr='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',{Configs:qr,Utils:Yr}=p,{Object:ls}=Yr,{Enabled:Qr,WideframeConfigs:ds}=qr.FrameCapture,Xr=l(async f=>{if(!Qr)return console.warn("FrameCapture is not enabled"),null;const e=Zr(f);if(!e)return null;Jr(e,ds.ResultChallenge);const{frameCapture:t}=window.game,{Width:s,Height:a}=ds.ResultChallenge;return t.captureAsync({name:"ResultChallenge",width:s,height:a,renderOptions:e})},"renderResultChallenge"),Jr=l((f,e)=>{const{Width:t,Height:s,Wideframe:a}=e;f.wideframe={name:"result-challenge",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe$2"),Zr=l(f=>{try{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:a="20",opponentPhoto:n="",opponentScore:i=0,isPlayerFinished:o,isOpponentFinished:r}=f,{RenderOptions:c}=ds.ResultChallenge,d=ls.clone(c);if(!d)return null;const h=ls.clear(d),y=ls.camelCaseKeys(h),{playerPhoto:g,opponentPhoto:w}=y,I=s===i,m=s>i,L=o??r,K=o&&r;return g.type==="image"&&(g.name=`${e}`,g.image=t),w.type==="image"&&(w.name=`${a}`,w.image=n),L&&tc(y,{playerScore:s,opponentScore:i,isPlayerFinished:o,isOpponentFinished:r}),!K||I?(delete y.leftCrown,delete y.rightCrown,y):(m?delete y.rightCrown:delete y.leftCrown,y)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),tc=l((f,e)=>{const{leftScore:t,rightScore:s}=f,{playerScore:a=0,opponentScore:n=0,isPlayerFinished:i,isOpponentFinished:o}=e;(t==null?void 0:t.type)==="text"&&(t.text=i?`${a}`:"???"),(s==null?void 0:s.type)==="text"&&(s.text=o?`${n}`:"???")},"addRenderScores"),{Configs:ec,Utils:sc}=p,{Object:hs}=sc,{Enabled:ac,WideframeConfigs:us}=ec.FrameCapture,nc=l(async f=>{if(!ac)return console.warn("FrameCapture is not enabled"),null;const e=oc(f);if(!e)return null;ic(e,us.ShareLeaderboard);const{frameCapture:t}=window.game,{Width:s,Height:a}=us.ShareLeaderboard;return t.captureAsync({name:"ShareLeaderboard",width:s,height:a,renderOptions:e})},"renderShareLeaderboard"),ic=l((f,e)=>{const{Width:t,Height:s,Wideframe:a}=e;f.wideframe={name:"share-leaderboard",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe$1"),oc=l(f=>{try{const{playerId:e,playerPhoto:t,leaders:s}=f,{RenderOptions:a}=us.ShareLeaderboard,n=hs.clone(a);if(!n)return null;const i=hs.clear(n),o=hs.camelCaseKeys(i),{avatar:r}=o;return r.type==="image"&&(r.name=`${e}`,r.image=t),rc(o,s),o}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),rc=l((f,e)=>{const t="600 48px";e.forEach((s,a)=>{const{id:n,name:i,photo:o,score:r}=s;let c=1294+180*a;f[`photo_${n}`]={depth:-1,name:n,type:"image",image:o,size:[96,96],position:[436,c]},c=1360+180*a,f[`name_${n}`]={font:t,depth:1,name:n,type:"text",text:i,position:[600,c]},f[`score_${n}`]={font:t,depth:1,name:n,type:"text",text:`${r}`,position:[100,c]}})},"addLeaders"),{Configs:cc,Utils:lc}=p,{Object:ys}=lc,{Enabled:dc,WideframeConfigs:ps}=cc.FrameCapture,hc=l(async f=>{if(!dc)return console.warn("FrameCapture is not enabled"),null;const e=yc(f);if(!e)return null;uc(e,ps.ShareScore);const{frameCapture:t}=window.game,{Width:s,Height:a}=ps.ShareScore;return t.captureAsync({name:"ShareScore",width:s,height:a,renderOptions:e})},"renderShareScore"),uc=l((f,e)=>{const{Width:t,Height:s,Wideframe:a}=e;f.wideframe={name:"share-score",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe"),yc=l(f=>{try{const{playerId:e,playerPhoto:t,playerScore:s}=f,{RenderOptions:a}=ps.ShareScore,n=ys.clone(a);if(!n)return null;const i=ys.clear(n),o=ys.camelCaseKeys(i);console.log("renderOptions",o);const{avatar:r,playerScore:c}=o;return r.type==="image"&&(r.name=`${e}`,r.image=t),c.type==="text"&&(c.text=`${s}`),o}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),{Configs:pc,Utils:fc}=p,{Image:pe,Object:Ht,Valid:fe}=fc,{Options:fs}=pc.FrameCapture,cn=class cn extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"width");u(this,"height");u(this,"canvas",null);u(this,"testRenderOptions",null);u(this,"caches",{});u(this,"wideframe",{})}init(){this.addWideframeRender("renderShareScore",hc),this.addWideframeRender("renderResultChallenge",Xr),this.addWideframeRender("renderShareLeaderboard",nc)}async preloadAsync(t){const{renderOptions:s}=t;await this.loadImages(s)}async captureAsync(t){const{width:s,height:a,renderOptions:n}=t;return await this.loadImages(n),this.width=s,this.height=a,this.createCanvas(),this.drawObjects(n),this.snapshotFrameAsync()}addWideframeRender(t,s){this.wideframe[t]=s}setTestRenderOptions(t){if(!t){this.testRenderOptions=null;return}const s=Ht.camelCaseKeys(t);this.testRenderOptions=Ht.merge(this.testRenderOptions,s)}createCanvas(){if(this.canvas){const t=this.canvas.getContext("2d");t?t.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}async loadImages(t){const s=Ht.vals(t).filter(o=>o.type==="image"),a=this.prepareLoadImages(s),n=Ht.vals(a);if(n.length<1)return;const i=await Promise.all(n);this.cacheImages(a,i)}prepareLoadImages(t){const s={};for(const a of t){const{name:n,image:i,fallbackImage:o}=a,r=this.caches[n];!fe.isString(i)||r||(i===""&&fe.isString(o)&&(a.image=o),console.info("prepareLoadImages",a),s[n]=new Promise(c=>{pe.loadImage(i).then(h=>{c(h)}).catch(()=>{fe.isString(o)?(a.image=o,pe.loadImage(a.image).then(h=>{c(h)}).catch(()=>{c(null)})):c(null)})}))}return s}cacheImages(t,s){for(const a in t){const n=s.shift();n&&(this.caches[a]=n)}}drawObjects(t){const s=Ht.vals(t).sort((a,n)=>a.depth-n.depth);for(const a of s)switch(a.type){case"text":this.drawText(a);break;case"image":this.drawImage(a);break}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{position:a,font:n,text:i,color:o,lineWidth:r,textAlign:c}=t;s.font=`${n} ${Hr}`,s.fillStyle=o??"#ffffff",r&&(s.lineWidth=r),c&&(s.textAlign=c),console.info("drawText",t);const[d,h]=a;s.fillText(i,d,h)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{name:a,size:n,position:i,fallbackImage:o}=t;let r=this.caches[a];if(!r&&o&&(r=this.caches[o]),!r)throw new Error(`Image ${a} not found`);console.info("drawImage",t);const[c,d]=i,[h,y]=n;s.drawImage(r,c,d,h,y)}async snapshotFrameAsync(){if(!this.canvas)return null;let t=null;if(fs.UseBlobIfPossible&&"toBlob"in this.canvas?t=await this.createAsBlob():t=this.createAsDataImage(),!t)throw new Error("Image data is null");return fe.isDebugger()&&pe.logImage(t),t}createAsDataImage(){if(!this.canvas)return null;const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return null;const{Quality:s,RenderType:a}=fs;return t.canvas.toDataURL(`image/${a}`,s)}createAsBlob(){return new Promise(t=>{if(!this.canvas){t(null);return}const{Quality:s,RenderType:a}=fs;this.canvas.toBlob(n=>{if(!n){t(null);return}pe.blobToDataImage(n).then(i=>{t(i)})},`image/${a}`,s)})}};l(cn,"FrameCapturePlugin");let gs=cn;const ln=class ln extends Error{constructor(t,s){const a=String(t);super(`Text with key "${a}" not found in locale "${s}"`);u(this,"key");u(this,"locale");this.name="MissingKeyInLocaleError",this.key=a,this.locale=s}};l(ln,"MissingKeyInLocaleError");let qt=ln;const dn=class dn extends Error{constructor(t){super(`Locale "${t}" not found`);u(this,"locale");this.name="LocaleNotFoundError",this.locale=t}};l(dn,"LocaleNotFoundError");let ge=dn;const{Utils:{Object:ws,Function:$o}}=p,hn=class hn extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"locale");u(this,"fallbackLocale");u(this,"data",{})}setFallbackLocale(t){this.fallbackLocale=t}hasTextKey(t,s){const a=s??this.getCurrentLocale(),{text:n}=this.getLocaleData(a);return ws.hasOwn(n,t)}hasTextureKey(t,s){const a=s??this.getCurrentLocale(),{texture:n}=this.getLocaleData(a);return ws.hasOwn(n,t)}add(t,s,a=!1){this.data[t]=s,a&&this.setFallbackLocale(t)}choose(t){this.locale=t;const{event:s}=this.game;s.emit(p.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,a,n=!1){try{return this.uncaughtGetText(t,s,a,!n)}catch(i){return i instanceof qt||i instanceof ge?console.warn(i.message):console.error(i),String(t)}}getTexture(t,s,a=!1){return this.uncaughtGetTexture(t,s,!a)}uncaughtGetText(t,s=[],a,n=!0){if(!n||this.fallbackLocale===void 0){const r=this.getRawText(t,a??this.getCurrentLocale());return this.replaceVariables(r,s)}const i=this.fallbackLocale,o=$o.retry(()=>this.getRawText(t,a??this.getCurrentLocale()),()=>this.getRawText(t,i));return this.replaceVariables(o,s)}getRawText(t,s){if(!this.hasTextKey(t,s))throw new qt(t,s);const{text:a}=this.getLocaleData(s);return a[t]}uncaughtGetTexture(t,s,a=!0){if(!a||this.fallbackLocale===void 0)return this.getRawTexture(t,s??this.getCurrentLocale());const n=this.fallbackLocale;return $o.retry(()=>this.getRawTexture(t,s??this.getCurrentLocale()),()=>this.getRawTexture(t,n))}getRawTexture(t,s){if(!this.hasTextureKey(t,s))throw new qt(t,s);const{texture:a}=this.getLocaleData(s);return a[t]}getCurrentLocale(){return this.locale??"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!ws.hasOwn(this.data,s))throw new ge(s);return this.data[s]}replaceVariables(t,s){const a=s.length;if(a===0)return t;let n=t;for(let i=0;i<a;i++){const o=s[i],r=`%{${i}}`;n=n.replace(r,o)}return n}};l(hn,"LanguagePlugin");let ms=hn;const gc=et("D",{_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15}),{Configs:wc,Utils:mc}=p,{Object:Yt,String:Go,Valid:ko}=mc,{OtherHost:Qt,Mockup:Xt,AppId:Ac}=wc,un=class un{constructor(){u(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await rt(async()=>{const{default:t}=await b.import("./bundle/LeaderboardAPIMock.js");return{default:t}},void 0,b.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new e}async getLeadersAsync(e,t,s){const a=Go.params(s);let n;return Xt.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in s?n=await this.mockAPI.getPlayers(e,s):n=await this.mockAPI.getLeaders(e,s)):n=await ft(`${t}?${a}`,{},Qt),!Yt.hasOwn(n,"data")||!Array.isArray(n.data)?[]:n.data}async getLeaderboardAsync(e){let t;const s=`leaderboards/${e}`;return Xt.Leaderboards.Enabled?(await this.initMockAPI(),t=await this.mockAPI.getLeaderboardAsync(e)):(t=await ft(s,{},Qt),Yt.hasOwn(t,"data")&&ko.isObject(t.data)&&(t=t.data)),t}async getLeaderboardsAsync(e){let t;const s=p.Utils.String.params(e);return Xt.Leaderboards.Enabled?(await this.initMockAPI(),t=await this.mockAPI.getLeaderboardsAsync(e)):(t=await ft(`leaderboards?${s}`,{},Qt),Yt.hasOwn(t,"data")&&Array.isArray(t.data)?t=t.data:t=[]),t}async setLeaderboardScoreAsync(e){const{leaderboardId:t,playerId:s,score:a}=e;Xt.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(t,s,a)):await V(`leaderboards/${t}/players/${s}`,{score:a},{},Qt)}async createLeaderboardAsync(e){const t=e._id??Go.generateObjectId(),s=e.numberOfLeaders,a={...gc,...e,_id:t,appId:Ac,numberOfLeaders:s},n="leaderboards";let i;if(Xt.Leaderboards.Enabled?(await this.initMockAPI(),i=await this.mockAPI.createLeaderboard(a)):(i=await V(n,a,{},Qt),Yt.hasOwn(i,"data")&&ko.isObject(i.data)&&(i=i.data)),!Yt.hasOwn(i,"_id")||i._id!==t)throw new Error("Create leaderboard failed");return t}};l(un,"LeaderboardAPI");let As=un;const Vo={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},Ic={leaderboards:{}},{Array:Dc,Valid:Pc,Json:Fo,Object:we}=p.Utils,yn=class yn extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"lbAPI",new As);u(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",Ic),this.configs={}}addLeaderboard(t){const{name:s,type:a,leaderboardId:n,autoSortRank:i}=t;if(this.getLeaderboard(s)){console.warn(`Leaderboard with name ${s} already exists`);return}let r=`leaderboards/${n}/`;(a==="global"||a==="tournament")&&(r+="leaders"),a==="friends"&&(r+="players"),this.configs[s]={id:n,name:s,type:a,host:r,autoSortRank:i};const c=Fo.clone(Vo);this.setLeaderboard(s,{...c})}async requestLeaderboardsAsync(t){try{return await this.lbAPI.getLeaderboardsAsync(t)}catch(s){return console.warn("requestGlobalLeaderboardsAsync",s),[]}}async requestLeaderboardAsync(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{id:a,type:n,host:i}=this.configs[t];let o=[];if(n==="friends"){const{player:r}=this.game,c=r.getPlayerId(),d=r.getConnectedPlayerIds(s,0),h=[c,...d];this.configs[t].playerIds=[...h],o=await this.lbAPI.getLeadersAsync(a,i,{playerIds:h})}else o=await this.lbAPI.getLeadersAsync(a,i,{limit:s,offset:0});if(o.length===0)return;await this.receiveLeaderboardAsync(t,o),this.setLeaderboard(t,{limit:s,offset:0})}finally{const a=await this.lbAPI.getLeaderboardAsync(this.configs[t].id),n=a?a.resettable:"",i=a?a.amountPlayer:0;this.setLeaderboard(t,{isRequesting:!1,resettable:n,amountPlayer:i})}}async loadMoreLeaderboardAsync(t,s){const a=this.getLeaderboard(t);if(a){if(this.configs[t].type==="friends"){console.warn("Cannot load more leaderboard with type friend");return}try{this.setLeaderboard(t,{isRequesting:!0});const{id:n,host:i}=this.configs[t],{offset:o,limit:r}=a,c=o+r,d=await this.lbAPI.getLeadersAsync(n,i,{limit:s,offset:c});if(d.length===0)return;this.receiveLeaderboardAsync(t,d),this.setLeaderboard(t,{limit:s,offset:c})}finally{this.setLeaderboard(t,{isRequesting:!1})}}}getLeaderboard(t){const{storage:s}=this.game,a=s.getStorageData("leaderboard","leaderboards");return a[t]?a[t]:null}async getLeadersByPlayerIdsAsync(t,s){try{this.validateLeaderboard(t);const{id:a}=this.configs[t],n=`leaderboards/${a}/players`,i=await this.lbAPI.getLeadersAsync(a,n,{playerIds:s});return i.length===0?[]:this.toLeaders(i)}catch(a){return console.warn(a),[]}}async getLeaderboardResponseAsync(t){return await this.lbAPI.getLeaderboardAsync(t)}clearLeaderboard(t){try{this.validateLeaderboard(t);const s=Fo.clone(Vo);this.setLeaderboard(t,null),this.setLeaderboard(t,{...s})}catch(s){console.warn(s)}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:a}=s;return Object.keys(a).length===0}isExistLeaderboardId(t){const{configs:s}=this;return we.vals(s).some(a=>a.id===t)}getLeaderboardName(t){const{configs:s}=this,a=Dc.search(we.vals(s),n=>n.id===t);return a?a.name:null}async setLeaderboardScoreAsync(t,s,a){try{this.validateLeaderboard(t);const{id:n}=this.configs[t],i=await this.getLastScoreOnLeaderboard(t,s);if(i&&a<=i)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:n,playerId:s,score:a})}catch(n){console.warn(n)}}async getLastScoreOnLeaderboard(t,s){const a=await this.getLeadersByPlayerIdsAsync(t,[s]);return a.length===0?null:a[0].score}async createLeaderboardAsync(t){return this.lbAPI.createLeaderboardAsync(t)}validateLeaderboard(t){const s=this.getLeaderboard(t);if(!Pc.isObject(s))throw new Error(`Leaderboard with name ${t} not found`)}setLeaderboard(t,s){const{storage:a}=this.game;a.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboardAsync(t,s){this.validateLeaderboard(t);const n=(await this.toLeaders(s)).filter(h=>h.name&&h.photo),{offset:i=0,leaders:o={}}=this.getLeaderboard(t)??{},r=n.filter(h=>!o[h.playerId]);if(i>0&&r.length>0){const h=we.vals(o);r.unshift(...h)}let c=r.sort((h,y)=>y.score-h.score);this.configs[t].autoSortRank&&(c=c.map((h,y)=>({...h,rank:y+1})));const d=we.keyBy(c,"playerId");this.setLeaderboard(t,{leaders:d})}async toLeaders(t){const{profile:s}=this.game,a=t.map(r=>r.playerId);await s.requestProfiles(a);const n=s.getProfiles();return t.map(r=>{const{playerId:c}=r,d=n[c];return d?{...r,name:d.name,photo:d.photo}:{...r,name:"Nameless",photo:"default"}}).map(r=>({...r,score:Number.parseInt(r.score,10)}))}};l(yn,"LeaderboardPlugin");let Is=yn;const pn=class pn{constructor(){u(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}};l(pn,"BaseAPI");let Ds=pn;const{Utils:Uo}=p,fn=class fn extends Ds{async createSingleMatchAsync(e){const s=await V("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await ft("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,a=await V(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await V(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createEndlessMatchAsync(e){const s=await V("endless-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getEndlessMatchDetailAsync(){const t=await ft("endless-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateEndlessMatchMilestoneAsync(e,t){const s=`endless-matches/${e}/milestone`,a=await V(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishEndlessMatchAsync(e){const t=`endless-matches/${e}/finish`,s=await V(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await V("matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await V(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await ft(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:a=0,extraData:n={}}=e,i=`matches/${t}/finish`,o=await V(i,{matchId:t,score:s,level:a,extraData:n},{},this.getAPIHost());return this.returnValidMatchData(o)}returnValidMatchData(e){let t={};return!Uo.Valid.isObject(e)||!Uo.Object.hasOwn(e,"data")||(t=e.data),t}};l(fn,"MatchAPI");let Ps=fn;const gn=class gn{constructor(e){u(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new Ps}setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}setMatchAPIInstance(e){this.matchAPI=e}getMatchAPI(){return this.matchAPI}};l(gn,"APIHandler");let Es=gn;const wn=class wn{constructor(e,t){u(this,"game");u(this,"match");this.game=e,this.match=t}startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group(` ${this.constructor.name}`),e&&console.log(" ? Payload:",e)}endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}async processAsync(e){throw new Error("Not implemented")}};l(wn,"BaseConcrete");let E=wn;const mn=class mn extends q{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}};l(mn,"LevelNotDefined");let me=mn;const An=class An extends q{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}};l(An,"MatchModeNotDefined");let Jt=An;const{Object:Ss,Valid:Ec}=p.Utils,In=class In{constructor(e){u(this,"game");u(this,"match");u(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){console.groupCollapsed(` ${this.constructor.name}`),this.logData("Before",e)}async nextAsync(e){this.logData("After",e),console.groupEnd(),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){if(!Ec.isDebugger())return;console.groupCollapsed(` MatchState: ${e}`);const{profiles:s,customData:a,...n}=t;console.info(" Base"),console.table(Ss.clone(n)),console.info(" Profile"),console.table(Ss.clone(s)),console.info(" Custom"),console.table(Ss.clone(a)),console.groupEnd()}};l(In,"BaseHandler");let A=In;const{Plugins:Sc,Utils:vc}=p,{Analytics:xc}=Sc,{String:Bo,Valid:jo}=vc,Dn=class Dn extends A{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e,{level:a}=s;this.validateMode(t),this.validateLevel(a);const{analytics:n}=this.game;n.event(xc.Events.MATCH_START,{level:a,game_mode:Bo.toUpperCamelCase(t),level_name:this.getLevelName(a)}),await this.nextAsync(e)}validateMode(e){if(!jo.isString(e))throw new Jt}validateLevel(e){if(!jo.isNumber(e))throw new me}getLevelName(e){return`Level ${Bo.padStart(e.toString(),5,"0")}`}};l(Dn,"LogMatchStartHandler");let U=Dn;const B={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},Pn=class Pn extends A{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let a=t??mt.SINGLE;s===B.FINISHED&&(a=mt.SINGLE),this.contextGameModeDetected(a),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}};l(Pn,"ContextGameModeHandler");let T=Pn;const En=class En extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}};l(En,"GetMatchDetailFailed");let Zt=En;const Sn=class Sn extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}};l(Sn,"MatchAreNotActive");let Ae=Sn;const vn=class vn extends q{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}};l(vn,"MatchIdNotValid");let Q=vn;const xn=class xn extends Error{constructor(e){super(e),this.name="OpponentHasFinishedMatch",this.message=e||"Opponent has finished match"}};l(xn,"OpponentHasFinishedMatch");let vs=xn;const bn=class bn extends q{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}};l(bn,"OpponentIdNotValid");let _=bn;const Nn=class Nn extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e??"The player is not currently in this match"}};l(Nn,"PlayerNotCurrentInMatch");let te=Nn;const Cn=class Cn extends Error{constructor(e){super(e),this.name="PlayerNotFinishedMatch",this.message=e||"Player not finished match"}};l(Cn,"PlayerNotFinishedMatch");let Ie=Cn;const{Dtos:bc}=p,Tn=class Tn extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new bc.Match.Data(t).toObject();this.validateAwaitMatchData(e,s),this.updateMatchData(e,s),this.validateMatchStatus(e),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new Q}validateMatchStatus(e){const{status:t}=e;if(t!==B.ACTIVE)throw new Ae}validateAwaitMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:o}=t;if(typeof n!="string"||n!==s)throw new Zt;const{playerId:r}=a,c=i===r,d=o===r;if(!c&&o===st.playerId)throw new Wt;if(!c&&!d)throw new te}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new P;const{finished:n}=t[a];if(!n)throw new Ie}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new _;const{finished:n}=t[a];if(n)throw new vs}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:c,status:d}=t;e.status=d;const h=a===s.playerId,y=h?a:n,g=h?n:a;e.customData.playerId=y,e.customData.opponentId=g,e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});const w=h?i:o,I=h?o:i;e.profiles[y].score=w,e.profiles[g].score=I;const m=h?r:c,L=h?c:r;e.profiles[y].finished=m,e.profiles[g].finished=L}};l(Tn,"AwaitMatchHandler");let xs=Tn;const bs={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},Ln=class Ln extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:a,customData:n}=this.payload;t.id=s??null,t.mode=a||null,t.status=B.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...bs,...t.customData,...n}}};l(Ln,"PrepareMatchHandler");let $=Ln;const At=wt,On=class On extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}};l(On,"UnavailableFeature");let S=On;const Rn=class Rn extends q{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}};l(Rn,"ContextIdNotValid");let W=Rn;const Mn=class Mn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAwaitingAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new Q;if(!a||typeof a!="string")throw new W;if(!n||typeof n!="string")throw new _}async createWideframesAwaitingAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:c,score:d=0,finished:h}=o;if(!h)return null;const{photo:y,score:g=0,finished:w}=r;return w?null:await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!0,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesAwaitingAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new P;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:r}=a[i],c={data:{type:At.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${r} ang ch bn kt thc trn u. Chi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(c)}};l(Mn,"SendAwaitingMessageHandler");let Ns=Mn;const _n=class _n extends A{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}};l(_n,"NothingHandler");let N=_n;const $n=class $n extends q{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}};l($n,"ProfileNotFound");let j=$n;const{Dtos:Nc}=p,Gn=class Gn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:a}=t;let n=s;const i=await this.getProfile(n);if(!i)throw new j;if(this.updateMatchProfile(e,n,i),n=a,n!==st.playerId){const o=await this.getProfile(n);if(!o)throw new j;this.updateMatchProfile(e,n,o)}else this.updateMatchProfile(e,n);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:a}=t;if(!s||typeof s!="string")throw new P;if(!a||typeof a!="string")throw new _}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:a,photo:n}=s??st,i=new Nc.Match.Profile({id:t,name:a,photo:n}).toObject();e.profiles[t]?(e.profiles[t].name=i.name,e.profiles[t].photo=i.photo):e.profiles[t]=i}};l(Gn,"GetMatchProfilesHandler");let Z=Gn;const kn=class kn extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new N(this),i=new $(this,{id:t,mode:G.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new xs(this);i.setNext(o);const r=new Z(this);o.setNext(r);const c=new Ns(this);r.setNext(c);const d=new U(this);c.setNext(d);const h=new T(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};l(kn,"AwaitChallengeMatchConcrete");let Cs=kn;const Vn=class Vn extends q{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}};l(Vn,"CreateContextFailed");let ee=Vn;const{Valid:Ko,Object:Wo}=p.Utils,Fn=class Fn extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,a=await this.createAsync(s);t.customData.contextId=a,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(a){this.validateError(a)}const s=GameSDK.context.getID();if(!Ko.isString(s))throw new ee;return s}validateError(t){if(!Wo.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}validateErrorMessage(t){if(!Wo.hasOwn(t,"message")||!Ko.isString(t.message))throw t}isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.indexOf("is not a connected player of the current player")>-1}};l(Fn,"CreateContextHandler");let Ts=Fn;const Un=class Un extends q{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}};l(Un,"MatchAreNotOpen");let Ct=Un;const{Dtos:Cc}=p,Bn=class Bn extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t);const s=await this.createMatchAsync(t),a=new Cc.Match.Data(s).toObject();this.updateMatchState(t,a),await this.nextAsync(t)}validateData(t){const{status:s,customData:a}=t,{opponentId:n}=a;if(typeof n!="string")throw new _;if(s!==B.OPEN)throw new Ct}async createMatchAsync(t){const{opponentId:s}=t.customData,{extraData:a}=this.payload;if(!s)return{};const n={opponentPlayerId:s,extraData:a};return this.match.api.getMatchAPI().createMatchAsync(n)}updateMatchState(t,s){const{customData:a}=t,{_id:n,whitePlayerId:i,blackPlayerId:o,whitePlayerFinish:r,blackPlayerFinish:c}=s,d=i===a.opponentId;t.id=n||null;const h=d?o:i,y=d?i:o;t.customData.playerId=h,t.customData.opponentId=y,t.profiles[h]||(t.profiles[h]={id:h,name:"",photo:"",finished:!1}),t.profiles[y]||(t.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?c:r,w=d?r:c;t.profiles[h].finished=g,t.profiles[y].finished=w}};l(Bn,"CreateMatchHandler");let De=Bn;const jn=class jn extends A{async processAsync(e){if(super.processAsync(e),e.status!==B.OPEN)throw new Ct;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=B.ACTIVE,e.startAt=Date.now()}};l(jn,"StartMatchHandler");let z=jn;const Kn=class Kn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesChallengeAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new Q;if(!a||typeof a!="string")throw new W;if(!n||typeof n!="string")throw new _}async createWideframesChallengeAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:c,score:d=0}=o,{photo:h,score:y=0}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!1,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesChallengeAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new P;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:r}=a[i],c={data:{type:At.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} challenges you`,localizations:{vi_VN:`${r} th thch bn trong trn u ny. Chi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(c)}};l(Kn,"SendChallengeMessageHandler");let Pe=Kn;const Wn=class Wn extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,a=new N(this),n=new Ts(this,{opponentId:s});a.setNext(n);const i=new $(this,{mode:G.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});n.setNext(i);const o=new De(this,{extraData:e.extraData});i.setNext(o);const r=new Z(this);o.setNext(r);const c=new z(this);r.setNext(c);const d=new U(this);c.setNext(d);const h=new Pe(this);d.setNext(h);const y=new T(this);h.setNext(y);const g=this.match.getMatchState();await a.processAsync(g)}finally{this.endLog()}}};l(Wn,"ChallengeFriendConcrete");let Ls=Wn;const zn=class zn extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}};l(zn,"SameContext");let se=zn;const{Utils:zo}=p,Hn=class Hn extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",a=GameSDK.context.getID();if(a===t)throw new se;if(s&&a===null)throw new se}async switchAsync(t){const s=t==="SOLO";try{this.checkSameContext(t),await GameSDK.context.switchAsync(t,s)}catch(a){if(a instanceof se)return;if(!zo.Object.hasOwn(a,"code"))throw a;if(zo.Device.isAndroid()&&s&&a.code==="INVALID_PARAM")return;if(a.code!=="SAME_CONTEXT")throw a}}};l(Hn,"SwitchContextHandler");let Tt=Hn;const{Dtos:Tc}=p,qn=class qn extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Tc.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new Q;if(s!==B.OPEN)throw new Ct}validateContinueMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:o}=t;if(typeof n!="string"||n!==s)throw console.warn(" ? respMatchDataValidated",t),new Zt;const{playerId:r}=a,c=i===r,d=o===r;if(!c&&o===st.playerId)throw new Wt;if(!c&&!d)throw new te}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new P;const{finished:n}=t[a];if(n)throw new he}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:c}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?i:o,w=d?o:i;e.profiles[h].score=g,e.profiles[y].score=w;const I=d?r:c,m=d?c:r;e.profiles[h].finished=I,e.profiles[y].finished=m}};l(qn,"ContinueMatchHandler");let Os=qn;const Yn=class Yn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesCurrentScoreAsync();t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new Q;if(!a||typeof a!="string")throw new W;if(!n||typeof n!="string")throw new _}async createWideframesCurrentScoreAsync(){try{const{player:e,frameCapture:t}=this.game,{playerId:s,photo:a}=e.getPlayer(),{profiles:n}=this.match.getMatchState(),{score:i=0}=n[s]||{};return await t.wideframe.renderShareScore({playerId:s,playerPhoto:a,playerScore:i})}catch(e){return console.warn("createWideframesCurrentScoreAsync",e),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new P;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:r}=a[i],c={data:{type:At.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} made an update.`,localizations:{vi_VN:`${r}  cp nht trn u. Chi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(c)}};l(Yn,"SendUpdateMessageHandler");let Rs=Yn;const Qn=class Qn extends E{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,i=new N(this),o=new Tt(this,{contextId:t});i.setNext(o);const r=new $(this,{id:s,mode:G.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:n}});o.setNext(r);const c=new Os(this);r.setNext(c);const d=new Z(this);c.setNext(d);const h=new z(this);d.setNext(h);const y=new Rs(this);h.setNext(y);const g=new U(this);y.setNext(g);const w=new T(this);g.setNext(w);const I=this.match.getMatchState();await i.processAsync(I)}finally{this.endLog()}}};l(Qn,"ContinueChallengeMatchConcrete");let Ms=Qn;const{Plugins:Lc,Utils:Oc}=p,{Analytics:Rc}=Lc,{String:Ho,Valid:qo}=Oc,Xn=class Xn extends A{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:a,finishAt:n}=e,{level:i}=t;this.validateMode(s),this.validateLevel(i);const{analytics:o}=this.game,r=Math.floor((n-a)/1e3);o.event(Rc.Events.MATCH_END,{level:i,game_mode:Ho.toUpperCamelCase(s),level_name:this.getLevelName(i),time_played:r}),await this.nextAsync(e)}validateMode(e){if(!qo.isString(e))throw new Jt}validateLevel(e){if(!qo.isNumber(e))throw new me}getLevelName(e){return`Level ${Ho.padStart(e.toString(),5,"0")}`}};l(Xn,"LogMatchFinishedHandler");let It=Xn;const Jn=class Jn extends Error{constructor(e){super(e),this.name="ScoreNotValid",this.message=e??"Score is not valid"}};l(Jn,"ScoreNotValid");let Lt=Jn;const Zn=class Zn extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}};l(Zn,"LeaderboardIdNotValid");let Dt=Zn;const ti=class ti extends Error{constructor(e){super(e),this.name="LeaderboardNotExist",this.message=e??"Leaderboard not exist in game"}};l(ti,"LeaderboardNotExist");let _s=ti;const{Valid:Yo}=p.Utils,ei=class ei extends A{constructor(t,s){super(t);u(this,"payload");u(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.setupSetScorePayload(t),this.setLeaderboardScoreAsync(),await this.nextAsync(t)}async setupSetScorePayload(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(!n||!s[n])throw new j;const{score:i,leaderboardId:o}=this.payload;if(!Yo.isNumber(i))throw new Lt;if(!Yo.isString(o))throw new Dt;this.leaderboardPayload={score:i,playerId:n,leaderboardId:o}}async setLeaderboardScoreAsync(){try{const{playerId:t,score:s,leaderboardId:a}=this.leaderboardPayload,n=this.game.leaderboard.getLeaderboardName(a);if(!n)throw new _s;await this.game.leaderboard.setLeaderboardScoreAsync(n,t,s)}catch(t){console.warn("setLeaderboardScoreAsync",t)}}};l(ei,"SetLeaderboardScoreHandler");let Ot=ei;const{Valid:Mc}=p.Utils,{Leaderboards:_c}=p.Configs,si=class si extends Ot{constructor(e){const{player:t}=globalThis.game,s=t.getBestScore();super(e,{score:s,leaderboardId:_c.LeaderboardId}),"submitGameResultsAsync"in GameSDK.extra&&GameSDK.extra.submitGameResultsAsync(s)}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new j;const{score:n}=t[a];if(!Mc.isNumber(n))throw new Lt;this.payload.score=n,super.setupSetScorePayload(e)}};l(si,"PostGlobalLeaderboardScoreHandler");let ae=si;const{Dtos:$c,Utils:Gc}=p,{Valid:Ee,Object:kc}=Gc,ai=class ai extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateMatchData(t);const{useAPI:s}=this.payload;if(s){const a=await this.finishMatchAsync(t),n=new $c.Match.Data(a).toObject();this.updateMatchFromAPI(t,n)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}validateMatchData(t){const{status:s,profiles:a,customData:n}=t;if(s!==B.ACTIVE)throw new Ae;const{playerId:i}=n;if(!i||!kc.hasOwn(a,i))throw new te}updateMatchData(t){const{playerId:s}=t.customData;if(!Ee.isString(s))throw new P;t.profiles[s].finished=!0}updateMatchState(t){t.status=B.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:a,customData:n}=t,{level:i,playerId:o}=n;if(!Ee.isString(o))throw new P;const{score:r}=a[o],{extraData:c}=this.payload,d={matchId:s??"",score:r,level:i,extraData:c};return this.match.api.getMatchAPI().finishMatchAsync(d)}updateMatchFromAPI(t,s){const{playerId:a,opponentId:n}=t.customData;if(!Ee.isString(a))throw new P;if(!Ee.isString(n))throw new _;const{whitePlayerId:i,whitePlayerScore:o,blackPlayerScore:r,whitePlayerFinish:c,blackPlayerFinish:d}=s,h=a===i,y=h?o:r,g=h?r:o,w=h?c:d,I=h?d:c;t.profiles[a].score=y,t.profiles[n].score=g,t.profiles[a].finished=w,t.profiles[n].finished=I}};l(ai,"FinishMatchHandler");let Pt=ai;const ni=class ni extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync(e);t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new Q;if(!a||typeof a!="string")throw new W;if(!n||typeof n!="string")throw new _}async createWideframesResultAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:c,score:d=0,finished:h}=o,{photo:y,score:g=0,finished:w}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!!h,isOpponentFinished:!!w})}catch(t){return console.warn("createWideframesResultAsync",t),null}}progressSendFinishedMessage(e,t){const{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||typeof n!="string")throw new P;if(!i||typeof i!="string")throw new _;const{score:o=0,finished:r}=s[n],{score:c=0,finished:d}=s[i];r?this.sendFinishMessageAsync(e,t):d&&o>c?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new P;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:r}=a[i],c={data:{type:At.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:B.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kt qu"}},text:{default:`${r} just finished. Check them now.`,localizations:{vi_VN:`${r} va hon thnh mn chi. Nhn  xem kt qu trn u.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(c)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new P;const{name:r,score:c}=a[i],d={data:{type:At.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:B.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} got ${c} scores. So easy! Can you?`,localizations:{vi_VN:`${r}  t ${c} im! Nhn Chi  so ti!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(d)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new P;const{name:r,score:c}=a[i],d={data:{type:At.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:B.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kt qu"}},text:{default:`${r} beat your high score. Their score: ${c}`,localizations:{vi_VN:`${r}  vt qua im s ca bn, vi ${c} im!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(d)}};l(ni,"SendFinishedMessageHandler");let $s=ni;const ii=class ii extends A{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new j;const{player:n}=this.game,i=n.getBestScore()||0,{score:o=0}=t[a];o<=i||(n.setBestScore(o),t[a].bestScore=o)}};l(ii,"SetPlayerBestScoreHandler");let Rt=ii;const oi=class oi extends E{async processAsync(e){try{this.startLog(e);const{extraData:t}=e??{},s=new N(this),a=new Pt(this,{useAPI:!0,extraData:t});s.setNext(a);const n=new $s(this);a.setNext(n);const i=new It(this);n.setNext(i);const o=new Rt(this);i.setNext(o);const r=new ae(this);o.setNext(r);const c=new T(this);r.setNext(c);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};l(oi,"FinishChallengeMatchConcrete");let Gs=oi;const ri=class ri extends Error{constructor(e){super(e),this.name="ContextAreSolo",this.message=e??"Context are solo"}};l(ri,"ContextAreSolo");let ks=ri;const ci=class ci extends Error{constructor(e){super(e),this.name="ContextNotChallenge",this.message=e??"Context is not a challenge"}};l(ci,"ContextNotChallenge");let Vs=ci;const li=class li extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}};l(li,"NetworkFailure");let Fs=li;const{Utils:Vc,Dtos:Fc}=p,{Array:Uc,Object:Bc}=Vc,di=class di extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new W;if(t==="SOLO")throw new ks}async getOpponentIdFromContextAsync(){const{ignoreId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new Vs;let a=st;return s.length===1&&(a=s[0]),a.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),a=[];for(const n of s){const i=n.getID();if(t.indexOf(i)>-1)continue;const o=n.getName();if(!o)continue;const r=n.getPhoto();a.push(new Fc.Player.Info({playerId:i,name:o,photo:r}).toObject())}return Uc.unique(a)}catch(s){if(Bc.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new Fs;return[]}}};l(di,"GetOpponentChallengeContextHandler");let Se=di;const hi=class hi extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}};l(hi,"ContextIsTournament");let ne=hi;const{Object:jc}=p.Utils,ui=class ui extends A{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!jc.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new ee;return e}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new ne):new S("getTournamentAsync")}catch(e){if(e instanceof ne)throw e}}};l(ui,"ChooseContextHandler");let Us=ui;const yi=class yi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new N(this),a=new Us(this);s.setNext(a);const n=new $(this,{mode:G.CHALLENGE_FRIEND,customData:{playerId:t}});a.setNext(n);const i=new Se(this,{ignoreId:t});n.setNext(i);const o=new De(this,{extraData:e.extraData});i.setNext(o);const r=new Z(this);o.setNext(r);const c=new z(this);r.setNext(c);const d=new U(this);c.setNext(d);const h=new Pe(this);d.setNext(h);const y=new T(this);h.setNext(y);const g=this.match.getMatchState();await s.processAsync(g)}finally{this.endLog()}}};l(yi,"InviteFriendsConcrete");let Bs=yi;const pi=class pi extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}};l(pi,"JoinMatchFailed");let js=pi;const fi=class fi extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}};l(fi,"MatchAreFinished");let Ks=fi;const gi=class gi extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}};l(gi,"OtherPlayerHasJoinedMatch");let Ws=gi;const{Dtos:Kc}=p,wi=class wi extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new Kc.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==B.OPEN)throw new Ct}validateJoinMatchData(e,t){const{id:s,customData:a}=e,{_id:n,blackPlayerId:i,whitePlayerId:o,whitePlayerFinish:r,blackPlayerFinish:c}=t,d=i===a.playerId,h=o===a.opponentId;if(typeof n!="string"||n!==s||!h)throw console.warn(" ? matchData",t),new js;if(r&&c)throw new Ks;if(!d)throw new Ws}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:c}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?i:o,w=d?o:i;e.profiles[h].score=g,e.profiles[y].score=w;const I=d?r:c,m=d?c:r;e.profiles[h].finished=I,e.profiles[y].finished=m}};l(wi,"JoinMatchHandler");let zs=wi;const mi=class mi extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAcceptedAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new Q;if(!a||typeof a!="string")throw new W;if(!n||typeof n!="string")throw new _}async createWideframesAcceptedAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:c,score:d=0,finished:h}=o;if(h)return null;const{photo:y,score:g=0,finished:w}=r;return w?await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch(t){return console.warn("createWideframesAcceptedAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new P;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:r}=a[i],c={data:{type:At.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} accepted the challenge.`,localizations:{vi_VN:`${r}  chp nhn tham gia trn u.`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(c)}};l(mi,"SendAcceptedMessageHandler");let Hs=mi;const Ai=class Ai extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new N(this),i=new $(this,{id:t,mode:G.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new zs(this);i.setNext(o);const r=new Z(this);o.setNext(r);const c=new z(this);r.setNext(c);const d=new Hs(this);c.setNext(d);const h=new U(this);d.setNext(h);const y=new T(this);h.setNext(y);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}};l(Ai,"JoinChallengeMatchConcrete");let qs=Ai;const Qo={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},{Valid:at}=p.Utils,nt="is invalid",Ii=class Ii extends k{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!at.isString(e)||!e)&&this.exception("_id",nt)}validateStatus(e){(!at.isString(e)||!e)&&this.exception("status",nt)}validateWinnerId(e){e!==null&&(!at.isString(e)||!e)&&this.exception("winnerId",nt)}validateWhitePlayerId(e){(!at.isString(e)||!e)&&this.exception("whitePlayerId",nt)}validateBlackPlayerId(e){(!at.isString(e)||!e)&&this.exception("blackPlayerId",nt)}validateWhitePlayerScore(e){at.isNumber(e)||this.exception("whitePlayerScore",nt)}validateBlackPlayerScore(e){at.isNumber(e)||this.exception("blackPlayerScore",nt)}validateWhitePlayerFinish(e){at.isBoolean(e)||this.exception("whitePlayerFinish",nt)}validateBlackPlayerFinish(e){at.isBoolean(e)||this.exception("blackPlayerFinish",nt)}toObject(){return super.toObject()}static getDefaultData(){return Qo}};l(Ii,"RespMatchDataDtos");let ie=Ii;ie.addDefaultData(Qo);const Di=class Di extends Error{constructor(e){super(e),this.name="MatchAreNotFinished",this.message=e||"Match are not finished"}};l(Di,"MatchAreNotFinished");let Ys=Di;const Pi=class Pi extends Error{constructor(e){super(e),this.name="OpponentNotFinishedMatch",this.message=e||"Opponent not finished match"}};l(Pi,"OpponentNotFinishedMatch");let Qs=Pi;const Ei=class Ei extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new ie(t).toObject();this.validateResultMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new Q}validateResultMatchData(e,t){const{id:s}=e,{_id:a,whitePlayerFinish:n,blackPlayerFinish:i}=t;if(typeof a!="string"||a!==s)throw new Zt;if(!n&&!i)throw new Ys}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new P;const{finished:n}=t[a];if(!n)throw new Ie}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new _;const{finished:n}=t[a];if(!n)throw new Qs}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:c}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!0}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!0});const g=d?i:o,w=d?o:i;e.profiles[h].score=g,e.profiles[y].score=w;const I=d?r:c,m=d?c:r;e.profiles[h].finished=I,e.profiles[y].finished=m}};l(Ei,"ResultMatchHandler");let Xs=Ei;const Si=class Si extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new N(this),i=new $(this,{id:t,mode:G.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new Xs(this);i.setNext(o);const r=new Z(this);o.setNext(r);const c=new T(this);r.setNext(c);const d=this.match.getMatchState();await n.processAsync(d)}finally{this.endLog()}}};l(Si,"ResultChallengeMatchConcrete");let Js=Si;const vi=class vi extends E{constructor(){super(...arguments);u(this,"fallbackSingleMode");u(this,"startFLowChallengeFriend",l(async t=>{try{return await this.match.challenge.invite.processAsync(t),!0}catch(s){return s}},"startFLowChallengeFriend"));u(this,"startFlowTournament",l(async t=>{try{const s=GameSDK.context.getID();if(typeof s!="string")throw new W;await this.match.tournament.continue.processAsync({playerId:t,contextId:s})}catch{await this.startFlowSingle(t)}},"startFlowTournament"));u(this,"startFlowSingle",l(async t=>{if(!this.fallbackSingleMode){console.warn("Fallback single mode is not enabled");return}await this.match.single.start.processAsync({playerId:t})},"startFlowSingle"))}async processAsync(t){try{this.startLog(t);const{playerId:s,extraData:a,fallbackSingleMode:n}=t;this.fallbackSingleMode=n;const i=await this.startFLowChallengeFriend({playerId:s,extraData:a});if(i===!0)return;i instanceof ne?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}};l(vi,"ChooseContextConcrete");let Zs=vi;const{Valid:Wc}=p.Utils,{Leaderboards:zc}=p.Configs,xi=class xi extends Ot{constructor(e){super(e,{score:0,leaderboardId:zc.LeaderboardEndlessId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new j;const{endlessScore:n}=t[a];if(!Wc.isNumber(n))throw new Lt;this.payload.score=n,super.setupSetScorePayload(e)}};l(xi,"PostGlobalLeaderboardEndlessScoreHandler");let ta=xi;const bi=class bi extends A{async processAsync(e){super.processAsync(e),this.setPlayerEndlessScore(e),await this.nextAsync(e)}setPlayerEndlessScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new j;const{player:n}=this.game,i=n.getBestEndlessScore()??0,{endlessScore:o=0}=t[a],r=i<o?o:i;n.setBestEndlessScore(r),t[a].bestEndlessScore=r}};l(bi,"SetPlayerEndlessScoreHandler");let ea=bi;const Ni=class Ni extends E{async processAsync(){try{this.startLog();const e=new N(this),t=new Pt(this,{useAPI:!1});e.setNext(t);const s=new It(this);t.setNext(s);const a=new ea(this);s.setNext(a);const n=new ta(this);a.setNext(n);const i=new T(this);n.setNext(i);const o=this.match.getMatchState();await e.processAsync(o)}finally{this.endLog()}}};l(Ni,"FinishEndlessConcrete");let sa=Ni;const Ci=class Ci extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}};l(Ci,"ProfileIdNotDefined");let aa=Ci;const{Dtos:Hc}=p,Ti=class Ti extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new aa;const{player:a}=this.game,n=a.getPlayerId();let i;if(s===n)i=this.getPlayerProfile();else if(i=await this.getProfileAsync(s),!i)throw new j;this.updateMatchData(i,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:a,photo:n,locale:i}=t.getPlayer();return{playerId:s,name:a,photo:n,locale:i}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:a,name:n,photo:i}=t,o=new Hc.Match.Profile({id:a,name:n,photo:i}).toObject();s.profiles[a]=o}};l(Ti,"GetProfileHandler");let Et=Ti;const Li=class Li extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new N(this),a=new Tt(this,{contextId:"SOLO"});s.setNext(a);const n=new $(this,{id:"234567",mode:G.ENDLESS,customData:{playerId:t}});a.setNext(n);const i=new z(this);n.setNext(i);const o=new Et(this,{profileId:t});i.setNext(o);const r=new U(this);o.setNext(r);const c=new T(this);r.setNext(c);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};l(Li,"StartEndlessConcrete");let na=Li;const{Valid:qc}=p.Utils,Oi=class Oi extends Ot{constructor(e){super(e,{score:0,leaderboardId:""})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a,leaderboardId:n}=s;if(!n)throw new Dt;if(!a||!t[a])throw new j;const{score:i}=t[a];if(!qc.isNumber(i))throw new Lt;this.payload.score=i,this.payload.leaderboardId=n,super.setupSetScorePayload(e)}};l(Oi,"PostLeaderboardScoreHandler");let oe=Oi;const Ri=class Ri extends A{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new Q;if(!a||typeof a!="string")throw new W;if(!n||typeof n!="string")throw new _}async createWideframesResultGroupAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:c,score:d=0}=o,{photo:h,score:y=0}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!0,isOpponentFinished:!0})}catch(t){return console.warn("createWideframesResultGroupAsync",t),null}}async createWideframesBestScoreAsync(e){try{const{player:t,frameCapture:s}=this.game,{playerId:a}=e.customData,{playerId:n,photo:i,data:o}=t.getPlayer();if(a!==n)return null;const{score:r}=o||{};return await s.wideframe.renderShareScore({playerId:n,playerPhoto:i,playerScore:r})}catch(t){return console.warn("createWideframesBestScoreAsync",t),null}}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:a,opponentId:n}=s;if(n&&typeof n=="string"){if(!a||typeof a!="string")throw new P;const{score:o=0}=t[a]||{},{score:r=0}=t[n]||{};if(o>r){const c=await this.createWideframesResultGroupAsync(e);if(!c)return;this.sendBestScoreMessageAsync(e,c);return}}const i=await this.createWideframesBestScoreAsync(e);i&&this.sendChallengeMessageAsync(e,i)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new P;if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");const{name:i,score:o}=s[n],c={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chi"}},text:{default:`${i} beats your high score. Their score: ${o}.`,localizations:{vi_VN:`${i} va vt im s cao nht ca bn! Chi ln na ch?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(c)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new P;const{name:i,score:o}=s[n],c={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${i} got ${o} scores. So easy! Can you?`,localizations:{vi_VN:`${i}  t ${o} im! Qu d lun. Chi li no!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new S("updateAsync");await GameSDK.extra.updateAsync(c)}};l(Ri,"SendGroupMessageHandler");let ia=Ri;const Mi=class Mi extends E{async processAsync(){try{this.startLog();const e=new N(this),t=new Pt(this,{useAPI:!1});e.setNext(t);const s=new ia(this);t.setNext(s);const a=new It(this);s.setNext(a);const n=new Rt(this);a.setNext(n);const i=new oe(this);n.setNext(i);const o=new T(this);i.setNext(o);const r=this.match.getMatchState();await e.processAsync(r)}finally{this.endLog()}}};l(Mi,"FinishGroupConcrete");let oa=Mi;const{Dtos:Yc}=p,_i=class _i extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:a}=t;if(!a[s])throw new j;const n={...a[s],...this.payload},i=new Yc.Match.Profile(n).toObject();a[i.id]=i}};l(_i,"SetProfileDataHandler");let Mt=_i;const $i=class $i extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:a}=e,n=new N(this),i=new $(this,{id:"7749",mode:G.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});n.setNext(i);const o=new Z(this);i.setNext(o);const r=new Mt(this,{id:t,score:a});o.setNext(r);const c=new z(this);r.setNext(c);const d=new U(this);c.setNext(d);const h=new T(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};l($i,"JoinGroupConcrete");let ra=$i;const Gi=class Gi extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}};l(Gi,"MatchGroupNotSupported");let ve=Gi;const ki=class ki extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=await this.matchingGroup();t.customData.contextId=s,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new S("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new S("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new ve;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new ve}async matchingGroup(){if(!("matchPlayerAsync"in GameSDK.extra))throw new S("matchPlayerAsync");const{matchTag:t,autoSwitch:s=!1,onlyExisting:a=!1}=this.payload;await GameSDK.extra.matchPlayerAsync(t,s,a);const n=GameSDK.context.getID();if(typeof n!="string")throw new ee;return n}};l(ki,"GroupContextHandler");let ca=ki;const Vi=class Vi extends E{async processAsync(e){try{this.startLog(e);const{matchTag:t,playerId:s,options:a}=e,n=new N(this),i=new ca(this,{matchTag:t,...a});n.setNext(i);const o=new $(this,{id:"7749",mode:G.MATCHING_GROUP,customData:{playerId:s}});i.setNext(o);const r=new Se(this,{ignoreId:s});o.setNext(r);const c=new z(this);r.setNext(c);const d=new Z(this);c.setNext(d);const h=new U(this);d.setNext(h);const y=new T(this);h.setNext(y);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}};l(Vi,"StartGroupConcrete");let la=Vi;const Fi=class Fi extends E{async processAsync(){try{this.startLog();const e=new N(this),t=new Pt(this,{useAPI:!1});e.setNext(t);const s=new It(this);t.setNext(s);const a=new Rt(this);s.setNext(a);const n=new ae(this);a.setNext(n);const i=new T(this);n.setNext(i);const o=this.match.getMatchState();await e.processAsync(o)}finally{this.endLog()}}};l(Fi,"FinishSingleConcrete");let da=Fi;const Ui=class Ui extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new N(this),a=new Tt(this,{contextId:"SOLO"});s.setNext(a);const n=new $(this,{id:"123456",mode:G.SINGLE,customData:{playerId:t}});a.setNext(n);const i=new z(this);n.setNext(i);const o=new Et(this,{profileId:t});i.setNext(o);const r=new U(this);o.setNext(r);const c=new T(this);r.setNext(c);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};l(Ui,"StartSingleConcrete");let ha=Ui;const{Plugins:Qc,Utils:Xc}=p,{Analytics:Jc}=Qc,{String:Zc,Valid:tl}=Xc,Bi=class Bi extends A{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e;this.validateMode(t);const{analytics:a}=this.game,{tournamentId:n,leaderboardId:i}=s;a.event(Jc.Events.TOURNAMENT_START,{success:!0,game_mode:Zc.toUpperCamelCase(t),tournament_id:n,leaderboard_id:i}),await this.nextAsync(e)}validateMode(e){if(!tl.isString(e))throw new Jt}};l(Bi,"LogTournamentStartHandler");let xe=Bi;const ji=class ji extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}};l(ji,"TournamentIdNotValid");let be=ji;const{Valid:ua}=p.Utils,Ki=class Ki extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s);const a=await GameSDK.getTournamentAsync(),n=a.getID().toString();this.validateTournamentId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:o}=i;this.validateLeaderboardId(o),t.customData.contextId=s,t.customData.tournamentId=n,t.customData.leaderboardId=o,await this.nextAsync(t)}validateContextId(t){if(!ua.isString(t))throw new W}validateTournamentId(t){if(!ua.isString(t))throw new be}validateLeaderboardId(t){if(!ua.isString(t)||t==="")throw new Dt}};l(Ki,"ContinueTournamentHandler");let ya=Ki;const Wi=class Wi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,a=new N(this),n=new ya(this,{contextId:s});a.setNext(n);const i=new $(this,{id:"1997",mode:G.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const o=new z(this);i.setNext(o);const r=new Et(this,{profileId:t});o.setNext(r);const c=new U(this);r.setNext(c);const d=new xe(this);c.setNext(d);const h=new T(this);c.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}};l(Wi,"ContinueTournamentConcrete");let pa=Wi;const{Plugins:el}=p,{Analytics:sl}=el,zi=class zi extends A{async processAsync(e){super.processAsync(e);const{customData:t}=e,{analytics:s}=this.game,{tournamentId:a,leaderboardId:n}=t;s.event(sl.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:a,leaderboard_id:n}),await this.nextAsync(e)}};l(zi,"LogTournamentCreateHandler");let fa=zi;const Hi=class Hi extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.createTournamentAsync(),await this.updateMatchStateAsync(t),await this.nextAsync(t)}async createTournamentAsync(){const{name:t,score:s,customData:a}=this.payload;await GameSDK.tournament.createAsync({initialScore:s,config:{title:t,tournamentTitle:t},data:a})}async updateMatchStateAsync(t){try{if(!("getTournamentAsync"in GameSDK))throw new S("getTournamentAsync");const s=await GameSDK.getTournamentAsync(),a=s.getContextID(),n=s.getID().toString(),{playerId:i}=this.payload;t.customData.playerId=i,t.customData.contextId=a,t.customData.tournamentId=n}catch(s){if(s instanceof S)return}}};l(Hi,"CreateTournamentHandler");let ga=Hi;const{Valid:Xo}=p.Utils,qi=class qi extends A{constructor(t,s){super(t);u(this,"payload");u(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.validatePayload(),await this.setupCreatePayload(t),await this.createLeaderboardAsync(t),await this.nextAsync(t)}validatePayload(){const{leaderboardId:t}=this.payload;if(!Xo.isString(t))throw new Dt}validatePlayerId(t){if(!Xo.isString(t))throw new P}async setupCreatePayload(t){const{playerId:s}=t.customData;this.validatePlayerId(s);const{name:a,leaderboardId:n,customData:i}=this.payload;this.leaderboardPayload={_id:n,name:a??"",createdBy:s,description:JSON.stringify(i)}}async createLeaderboardAsync(t){const s=await this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload);t.customData.leaderboardId=s}};l(qi,"CreateLeaderboardHandler");let wa=qi;const Yi=class Yi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,name:s,score:a,leaderboardId:n,payload:i}=e,o=new N(this),r=new Tt(this,{contextId:"SOLO"});o.setNext(r);const c=new ga(this,{name:s,score:a,playerId:t,customData:i});r.setNext(c);const d=new Et(this,{profileId:t});c.setNext(d);const h=new Mt(this,{id:t,score:a});d.setNext(h);const y=new wa(this,{name:s,customData:i,leaderboardId:n});h.setNext(y);const g=new oe(this);y.setNext(g);const w=new fa(this);g.setNext(w);const I=this.match.getMatchState();await o.processAsync(I)}finally{this.endLog()}}};l(Yi,"CreateTournamentConcrete");let ma=Yi;const{Analytics:Jo}=p.Plugins,{Valid:al}=p.Utils,Qi=class Qi extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),await this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(this.validatePlayerId(n),!s[n])throw new j}validatePlayerId(t){if(!al.isString(t))throw new P}getPlayerProfile(t){const{profiles:s,customData:a}=t,{playerId:n}=a;return this.validatePlayerId(n),s[n]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:a=0,bestScore:n=0}=s;return a>n}async postScoreTournamentAsync(t){const{analytics:s}=window.game,a=this.getPlayerProfile(t),{score:n=0}=a;let i=null,o=!1;const{checkBestScore:r}=this.payload,c=this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new S("getTournamentAsync");await GameSDK.getTournamentAsync(),!r||c?(i=Jo.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:n})):(i=Jo.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(n)),o=!0}catch(d){console.warn("Post Score Tournament",d)}finally{i&&s.event(i,{success:o})}}};l(Qi,"PostScoreTournamentHandler");let Aa=Qi;const Xi=class Xi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,bestScore:s}=e,a=new N(this),n=new Pt(this,{useAPI:!1});a.setNext(n);const i=new Mt(this,{id:t,bestScore:s});n.setNext(i);const o=new Aa(this,{checkBestScore:!1});i.setNext(o);const r=new It(this);o.setNext(r);const c=new Rt(this);r.setNext(c);const d=new oe(this);c.setNext(d);const h=new ae(this);d.setNext(h);const y=new T(this);h.setNext(y);const g=this.match.getMatchState();await a.processAsync(g)}finally{this.endLog()}}};l(Xi,"FinishTournamentConcrete");let Ia=Xi;const{Valid:Da,Object:nl}=p.Utils,Ji=class Ji extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const a=await GameSDK.getTournamentAsync(),n=a.getContextID();this.validateContextId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:o}=i;this.validateLeaderboardId(o),t.customData.contextId=n,t.customData.tournamentId=s,t.customData.leaderboardId=o,await this.nextAsync(t)}validateTournamentId(t){if(!Da.isString(t))throw new be}validateContextId(t){if(!Da.isString(t))throw new W}validateLeaderboardId(t){if(!Da.isString(t)||t==="")throw new Dt}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new S("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!nl.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}};l(Ji,"JoinTournamentHandler");let Pa=Ji;const Zi=class Zi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,a=new N(this),n=new Pa(this,{tournamentId:s});a.setNext(n);const i=new $(this,{id:"1997",mode:G.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const o=new z(this);i.setNext(o);const r=new Et(this,{profileId:t});o.setNext(r);const c=new U(this);r.setNext(c);const d=new xe(this);c.setNext(d);const h=new T(this);d.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}};l(Zi,"JoinTournamentConcrete");let Ea=Zi;const{Dtos:il,Utils:ol}=p,{Object:rl}=ol,to=class to extends A{constructor(t,s){super(t);u(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateMatchCustomData(t),await this.nextAsync(t)}updateMatchCustomData(t){const s=rl.merge(t.customData,this.payload),a=new il.Match.CustomData(s).toObject();t.customData=a}};l(to,"SetMatchCustomDataHandler");let Sa=to;const cl={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...bs}},{Configs:Zo}=p,eo=class eo extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"base");u(this,"group");u(this,"single");u(this,"endless");u(this,"context");u(this,"challenge");u(this,"tournament");u(this,"api");u(this,"handler");u(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",cl)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createBaseConcrete(){this.base=new E(this.game,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:l(async t=>{const s=new Mt(this.base,t);await this.processHandlerAsync(s)},"setProfileData"),setMatchCustomData:l(async t=>{const s=new Sa(this.base,t);await this.processHandlerAsync(s)},"setMatchCustomData"),setLeaderboardScore:l(async t=>{const s=new Ot(this.base,t);await this.processHandlerAsync(s)},"setLeaderboardScore")}}createAPIHandler(){const t={appId:Zo.AppId,matchAPIHost:Zo.ApiHost};this.api=new Es(t)}createGroupFlows(){this.group={join:new ra(this.game,this),start:new la(this.game,this),finish:new oa(this.game,this)}}createSingleFlows(){this.single={start:new ha(this.game,this),finish:new da(this.game,this)}}createEndlessFlows(){this.endless={start:new na(this.game,this),finish:new sa(this.game,this)}}createContextFlows(){this.context={choose:new Zs(this.game,this)}}createChallengeFlows(){this.challenge={invite:new Bs(this.game,this),friend:new Ls(this.game,this),join:new qs(this.game,this),await:new Cs(this.game,this),result:new Js(this.game,this),finish:new Gs(this.game,this),continue:new Ms(this.game,this)}}createTournamentFlows(){this.tournament={join:new Ea(this.game,this),create:new ma(this.game,this),finish:new Ia(this.game,this),continue:new pa(this.game,this)}}processHandlerAsync(t){const s=this.getMatchState();return t.processAsync(s)}};l(eo,"MatchPlugin");let va=eo;const{Valid:St}=p.Utils,vt="is invalid",so=class so extends k{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!St.isNumber(e)||e<0)&&this.exception("level",vt)}validateRescued(e){(!St.isNumber(e)||e<0)&&this.exception("rescued",vt)}validateContextId(e){St.isString(e)||this.exception("contextId",vt)}validatePlayerId(e){St.isString(e)||this.exception("playerId",vt)}validateOpponentId(e){St.isString(e)||this.exception("opponentId",vt)}validateTournamentId(e){St.isString(e)||this.exception("tournamentId",vt)}validateLeaderboardId(e){St.isString(e)||this.exception("leaderboardId",vt)}toObject(){return super.toObject()}static getDefaultData(){return k.getDefaultData()}};l(so,"MatchCustomDataDtos");let Ne=so;Ne.addDefaultData(bs);const{Valid:dt}=p.Utils,ht="is invalid",ao=class ao extends k{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!dt.isString(e)||!e)&&this.exception("id",ht)}validateName(e){(!dt.isString(e)||!e)&&this.exception("name",ht)}validatePhoto(e){dt.isString(e)||this.exception("photo",ht)}validateScore(e){(!dt.isNumber(e)||e<0)&&this.exception("score",ht)}validateBestScore(e){(!dt.isNumber(e)||e<0)&&this.exception("bestScore",ht)}validateEndlessScore(e){(!dt.isNumber(e)||e<0)&&this.exception("endlessScore",ht)}validateBestEndlessScore(e){(!dt.isNumber(e)||e<0)&&this.exception("bestEndlessScore",ht)}validateFinished(e){dt.isBoolean(e)||this.exception("finished",ht)}toObject(){return super.toObject()}static getDefaultData(){return k.getDefaultData()}};l(ao,"MatchProfileDtos");let Ce=ao;Ce.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0}),p.Dtos.Match={Data:ie,CustomData:Ne,Profile:Ce};const{Utils:ll}=p,{ApiHost:dl}=p.Configs,hl=l(async f=>{let e="players";GameSDK.getSDKName()==="MsGames"&&(e="players?platform=ms-games");const t=await V(e,f,{},dl,10);return ll.Object.hasOwn(t,"data")?t.data||{}:{}},"updatePlayerProfileAsync"),{Utils:ul,Configs:yl}=p,{AppId:pl}=yl,{Array:fl,Object:Te,Valid:gl}=ul,no=class no extends O.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",pt)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch(e){console.warn(e)}}receiveData(e,t){const{storage:s}=this.game,{playerId:a,name:n,photo:i,locale:o}=e;s.setStorageData("player","playerId",a),s.setStorageData("player","name",n),s.setStorageData("player","photo",i),s.setStorageData("player","locale",o),t&&this.setPlayerData(t)}async syncProfileToServer(){const{storage:e}=this.game,t=this.getPlayer(),{playerId:s,name:a,photo:n,locale:i}=t;let o=this.getPlayerASID();!gl.isString(o)&&"getASIDAsync"in GameSDK.player&&(o=await GameSDK.player.getASIDAsync()??o,e.setStorageData("player","ASID",`${o}`)),await hl({appId:pl,ASID:o,playerId:s,name:a,photo:n,locale:i})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=Te.merge(t,e);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(i=>{const o=i.getID(),r=i.getName(),c=i.getPhoto();return!o||!r||!c?null:new Nt({playerId:o,name:r,photo:c}).toObject()}),a=fl.unique(s);if(a.length<1)return;const n=Te.keyBy(a,"playerId");e.setStorageData("player","connectedPlayers",n)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerLocale(){const{storage:e}=this.game;return e.getStorageData("player","locale")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return Te.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return Te.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??pt.data.isFirstLogin}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:e}=this.getPlayerData();return e}getBestEndlessScore(){const{endlessScore:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,t+e)}getNotificationData(){return this.getPlayerDataByKey("notificationData")??pt.data.notificationData}};l(no,"PlayerPlugin");let xa=no;const{Dtos:tr,Utils:wl}=p,{Valid:it}=wl,{score:er,endlessScore:ml,settings:Al,gameData:Il,isFirstLogin:Dl,dailyRewarded:Pl,notificationData:El}=pt.data,ot="is invalid",io=class io extends k{processData(e){this.validateStructure(e),e.settings=new tr.Player.Settings(e.settings).toObject(),e.gameData=new tr.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!it.isNumber(e)||e<0)&&this.exception("score",ot)}validateEndlessScore(e){(!it.isNumber(e)||er<0)&&this.exception("endlessScore",ot)}validateSettings(e){it.isObject(e)||this.exception("settings",ot)}validateNotificationData(e){it.isObject(e)||this.exception("notificationData",ot),(!("lastSent"in e)||!it.isNumber(e.lastSent))&&this.exception("notificationData.lastSent",ot),(!("currentId"in e)||!it.isNumber(e.currentId))&&this.exception("notificationData.currentId",ot)}validateGameData(e){it.isObject(e)||this.exception("gameData",ot)}validateIsFirstLogin(e){it.isBoolean(e)||this.exception("isFirstLogin",ot)}validateDailyRewarded(e){it.isObject(e)||this.exception("dailyRewarded",ot)}toObject(){return super.toObject()}};l(io,"PlayerDataDtos");let Le=io;Le.addDefaultData({score:er,endlessScore:ml,settings:Al,gameData:Il,isFirstLogin:Dl,dailyRewarded:Pl,notificationData:El});const{Valid:sr}=p.Utils,{level:Sl,coins:vl}=pt.data.gameData,oo=class oo extends k{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!sr.isNumber(e)||e<0)&&this.exception("level","is invalid")}validateCoins(e){(!sr.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}};l(oo,"PlayerGameDataDtos");let Oe=oo;Oe.addDefaultData({level:Sl,coins:vl});const{Valid:Re}=p.Utils,{sound:xl,music:bl,vibrate:Nl,language:Cl}=pt.data.settings,Me="is invalid",ro=class ro extends k{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){Re.isBoolean(e)||this.exception("sound",Me)}validateMusic(e){Re.isBoolean(e)||this.exception("music",Me)}validateVibrate(e){Re.isBoolean(e)||this.exception("vibrate",Me)}validateLanguage(e){(!Re.isString(e)||!e)&&this.exception("language",Me)}toObject(){return super.toObject()}};l(ro,"PlayerSettingsDtos");let _e=ro;_e.addDefaultData({sound:xl,music:bl,vibrate:Nl,language:Cl}),p.Dtos.Player={Info:Nt,Data:Le,Settings:_e,GameData:Oe};const{Configs:Tl,Utils:Ll}=p,{Object:Ol,String:Rl}=Ll,{ApiHost:Ml,Mockup:_l}=Tl,co=class co{constructor(){u(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await rt(async()=>{const{default:t}=await b.import("./bundle/ProfileAPIMock.js");return{default:t}},void 0,b.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new e}async getPlayersAsync(e){const t=Rl.params(e);let s;return _l.Profile.Enabled?(await this.initMockAPI(),s=await this.mockAPI.getPlayersAsync(e)):s=await ft(`players?${t}`,{},Ml),!Ol.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data}};l(co,"ProfileAPI");let ba=co;const $l={profiles:{},profileIds:[]},{Utils:Gl,Dtos:kl}=p,{Array:ar,Valid:Vl,Object:Fl,Function:Ul}=Gl,lo=class lo extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"profileAPI",new ba)}init(){const{storage:t}=this.game;t.addStorage("profile",$l)}async requestProfiles(t){const s=this.getProfileIds(),a=ar.difference(t,s);if(a.length<1)return;const i=ar.chunk(a,400).map(d=>this.profileAPI.getPlayersAsync({playerIds:d})),r=(await Ul.allSettled(i)).reduce((d,h)=>h.status==="fulfilled"?d.concat(h.value):d,[]);if(!this.validateProfilesResponse(r))return;const c=this.convertToProfiles(r);this.setProfiles(c)}getProfile(t){return this.getProfiles()[t]??null}getProfiles(){const{storage:t}=this.game;return t.getStorageData("profile","profiles")}setProfiles(t){const{storage:s}=this.game;s.setStorageData("profile","profiles",t),s.setStorageData("profile","profileIds",Object.keys(t))}getProfileIds(){const{storage:t}=this.game;return t.getStorageData("profile","profileIds")}validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}convertToProfiles(t){const s={};for(const a of t)Fl.hasOwn(a,"playerId")&&Vl.isString(a.playerId)&&(s[a.playerId]=new kl.Player.Info(a).toObject());return s}};l(lo,"ProfilePlugin");let Na=lo;const nr="Save The Pets",{Utils:{Object:ir,Valid:or,Browser:rr}}=p,ho=class ho extends O.Plugins.BasePlugin{constructor(t){super(t);u(this,"storages");u(this,"storageLocalKeys",{});this.storages={}}async addStorage(t,s,a=!1){console.info("addStorage",t,s),this.storages[t]=s,a&&await this.initFromWebStorage(t,s)}async initFromWebStorage(t,s){this.storageLocalKeys[t]=!0;const a=await rr.getIndexedDB(`${nr}_S_${t}`);if(!or.isObject(a))return;const n=Object.keys(s);for(const i of n)ir.hasOwn(a,i)&&typeof s[i]==typeof a[i]&&this.setStorageData(t,i,a[i])}setStorageData(t,s,a){let n;if(or.isObject(a)){const i=this.getStorageData(t,s);n=ir.merge(i,a)}else n=a;this.storages[t][s]=n}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}updateToWebStorage(t){this.storageLocalKeys[t]&&this.saveToWebStorage(t)}saveToWebStorage(t){const s=this.getStorage(t);rr.setIndexedDB(`${nr}_S_${t}`,s)}};l(ho,"StoragePlugin");let Ca=ho;const uo=class uo extends O.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"isVisible",!0);u(this,"browserPrefixes",["moz","ms","o","","webkit"]);u(this,"handleVisibilityChange",l(t=>{if(["focus","blur"].indexOf(t)>-1)return t==="focus"?this.onVisibleEvent():this.onHiddenEvent();const a=this.getBrowserPrefix();return this.getHiddenPropertyName(a)in document?this.onHiddenEvent():this.onVisibleEvent()},"handleVisibilityChange"))}init(){const t=this.getBrowserPrefix(),a=[this.getVisibilityEvent(t),"focus","blur"];for(const n of a)window.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1),document.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1);GameSDK.extra&&"onPause"in GameSDK.extra&&GameSDK.extra.onPause(()=>{this.handleVisibilityChange("blur")})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?`${t}Hidden`:"hidden"}getVisibilityEvent(t){return`${t||""}visibilitychange`}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(p.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(p.Events.VISIBILITY_HIDDEN))}};l(uo,"VisibilityPlugin");let Ta=uo;const yo=class yo extends Lo{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}};l(yo,"BannerInstance");let La=yo;const{Status:cr}=p.Plugins.Ads,po=class po extends La{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.setStatus(cr.SHOWING)}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.setStatus(cr.IDLE)}};l(po,"BannerAdInstance");let Oa=po;const{Object:Bl}=p.Utils,{Status:tt,Types:xt,AdError:bt,AdInstance:jl}=p.Plugins.Ads,_t={NOT_LOADED:"not-loaded",LOADING:"loading",LOADED:"loaded",PENDING:"pending"},D=class D extends jl{constructor(t,s){super(t,s);u(this,"instance");u(this,"adServiceName");this.instance=null,this.adServiceName="google"}static get initStatus(){return D._initStatus}static async initGoogleAdsAsync(t){if(D.initStatus==="loaded"){console.warn("Google Ads already initiated.");return}D._initStatus=_t.LOADING,D.adsByGoogleConfig=t,D.loadScriptElementAsync(t)}static async configGoogleAdsOnInit(){window.adsbygoogle=window.adsbygoogle||[],window.adBreak=function(t){adsbygoogle.push(t)},window.adConfig=function(t){adsbygoogle.push(t)},D._initStatus=_t.LOADED,D.runPreloadAdConfig()}static async runPreloadAdConfig(){return D.isPreloadingAdConfig=!0,D.preloadPromise=new Promise((t,s)=>{window.adConfig({preloadAdBreaks:"on",onReady:l(()=>{D.isPreloadConfigReady=!0,D.isPreloadingAdConfig=!1,t()},"onReady")}),setTimeout(()=>{D.isPreloadConfigReady||s(new Error("Failed to preload ad config in time."))},5e3)}),D.preloadPromise}static loadScriptElementAsync(t){return new Promise((s,a)=>{D.isPreloadingAdConfig=!0;const{dataAdClient:n,dataAdHost:i,dataAdChannel:o,dataAdBreakTest:r,dataAdFrequencyHint:c}=t;if(!n&&!i){D._initStatus=_t.NOT_LOADED,a(new Error("dataAdClient or dataAdHost is required."));return}const d=document.createElement("script");d.async=!0,d.setAttribute("data-ad-frequency-hint",`${c}s`),n&&d.setAttribute("data-ad-client",n),o&&d.setAttribute("data-ad-channel",o),i&&d.setAttribute("data-ad-host",i),r&&d.setAttribute("data-adbreak-test","on");let h="";if(n||i){h="?";const g=[];n&&g.push(`client=${n}`),i&&g.push(`host=${i}`),h+=g.join("&")}d.src=`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js${h}`,d.crossOrigin="anonymous",d.onload=()=>{D.configGoogleAdsOnInit(),s(!0)},d.onerror=()=>{D._initStatus=_t.NOT_LOADED,a(new Error("Failed to load Google Ads script."))};const y=document.createElement("script");y.text="window.adsbygoogle = window.adsbygoogle || []; var adBreak = adConfig = function(o) {adsbygoogle.push(o);}",document.head.appendChild(d),document.head.appendChild(y)})}makeAdInstance(){return{getPlacementID:l(()=>"","getPlacementID"),loadAsync:l(()=>this.preloadAdPlacement(),"loadAsync"),showAsync:l(()=>this.createAdPlacement(),"showAsync")}}preloadAdPlacement(){return console.log("preloadAdPlacement",this.type),D._initStatus!==_t.LOADED?Promise.reject(new Error("Google Ads not initiated.")):D.isPreloadConfigReady?Promise.resolve():D.preloadPromise?D.preloadPromise:D.runPreloadAdConfig()}createAdPlacement(){switch(this.type){case xt.REWARDED_VIDEO:return this.createAdPlacementRewarded();case xt.INTERSTITIAL:return this.createAdPlacementInterstitial();default:return Promise.reject(new bt("UNSUPPORTED_AD_TYPE","Unsupported."))}}createAdPlacementInterstitial(){return new Promise((t,s)=>{window.adBreak({type:"next",name:"interstitialAd",beforeAd:l(()=>{self.game.ads.hideBannerAdAsync()},"beforeAd"),adBreakDone:l(a=>{switch(console.info("GoogleAdInstance.adBreakDone hook called",a),self.game.ads.showBannerAdAsync(),a.breakStatus){case"dismissed":case"viewed":t();return;default:s(new bt(a.breakStatus,a.breakType));return}},"adBreakDone")})})}createAdPlacementRewarded(){return new Promise((t,s)=>{window.adBreak({type:"reward",name:"rewardedAd",beforeReward:l(a=>{console.info("GoogleAdInstance.beforeReward hook called"),self.game.ads.hideBannerAdAsync(),a()},"beforeReward"),adViewed:l(()=>{console.info("GoogleAdInstance.adViewed hook called")},"adViewed"),adDismissed:l(()=>{console.info("GoogleAdInstance.adDismissed hook called")},"adDismissed"),adBreakDone:l(a=>{switch(console.info("GoogleAdInstance.adBreakDone hook called",a),self.game.ads.showBannerAdAsync(),a.breakStatus){case"dismissed":s(new bt("USER_INPUT","User dismissed."));return;case"viewed":t();return;default:s(new bt(a.breakStatus,a.breakType));return}},"adBreakDone")})})}static setGame(t){self.game=t}getStatus(){return this.status}async loadAsync(){if(this.status===tt.IDLE)try{if(this.instance=this.makeAdInstance(),this.instance===null)throw new bt("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.loadAsync(),this.type===xt.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(this.adServiceName),this.type===xt.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd(this.adServiceName),this.setStatus(tt.FILLED)}catch(t){throw this.setStatus(tt.IDLE),this.isAdTypeValid(this.type)&&self.game.analytics.loadAdFail(this.type,this.adServiceName),t}}async showAsync(){let t=!1;try{if(this.status!==tt.FILLED)throw new bt("AD_NOT_FILLED","Ads no fill.");if(this.setStatus(tt.SHOWING),this.instance===null)throw new bt("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.showAsync(),t=!0,this.setStatus(tt.IDLE),this.instance=null}catch(s){throw s instanceof Object&&Bl.hasOwn(s,"code")?(s.code==="noAdPreloaded"?this.setStatus(tt.FILLED):(this.setStatus(tt.IDLE),this.instance=null),s.code==="USER_INPUT"&&(this.setStatus(tt.IDLE),this.instance=null,t=!0)):(this.setStatus(tt.IDLE),this.instance=null),s}finally{window.focus(),t?(this.type===xt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(this.adServiceName),this.type===xt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd(this.adServiceName)):this.isAdTypeValid(this.type)&&self.game.analytics.showAdFail(this.type,this.adServiceName)}}isAdTypeValid(t){return Object.values(xt).includes(t)}};l(D,"GoogleAdInstance"),u(D,"_initStatus",_t.NOT_LOADED),u(D,"isPreloadConfigReady",!1),u(D,"isPreloadingAdConfig",!1),u(D,"adsByGoogleConfig"),u(D,"preloadPromise");let ut=D;const{Object:Kl}=p.Utils,{Status:H,Types:M,AdError:$e,AdInstance:Wl}=p.Plugins.Ads,fo=class fo extends Wl{constructor(t,s){super(t,s);u(this,"instance");u(this,"interstitialAdInstanceList",[]);u(this,"rewardedVideoAdInstanceList",[]);u(this,"rewardedInterstitialAdInstanceList",[]);this.instance=null}async loadAsync(){if(console.info("AdInstance","loadAsync called",{type:this.type,status:this.status}),this.instance&&this.status===H.FILLED)return;if(this.status!==H.IDLE)throw new $e("AD_NOT_READY","Ad is not ready.");const t=GameSDK.getSDKName();try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new $e("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.setStatus(H.LOADING),await this.instance.loadAsync(),this.setStatus(H.FILLED),console.info("AdInstance","loadAsync success",{type:this.type,status:this.status}),this.logAdLoad()}catch(s){throw console.warn("AdInstance","loadAsync failed",{type:this.type,status:this.status,error:s}),this.setStatus(H.IDLE),s instanceof Object&&"code"in s&&s.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.pushInstanceToQueue(this.instance),self.game.analytics.loadAdFail(this.type,t),s}}async showAsync(){if(console.info("AdInstance","showAsync called",{type:this.type,status:this.status}),this.status!==H.FILLED)throw new $e("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new $e("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let t=!1;const s=GameSDK.getSDKName();try{this.setStatus(H.SHOWING),self.game.analytics.showingAd(this.type,s),await this.instance.showAsync(),t=!0,this.setStatus(H.IDLE),this.instance=null,console.info("AdInstance","showAsync success",{type:this.type,status:this.status})}catch(a){throw console.warn("AdInstance","showAsync failed",{type:this.type,status:this.status,error:a}),p.Utils.Object.hasOwn(a,"code")&&(a.code==="AD_NOT_LOADED"&&this.setStatus(H.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf(`${a.code}`)>-1&&(this.setStatus(H.IDLE),this.instance=null),a.code==="USER_INPUT"&&(t=!0)),this.status===H.SHOWING&&(this.setStatus(H.IDLE),this.instance=null),a}finally{t?this.logAdShown():self.game.analytics.showAdFail(this.type,s)}}async createInstanceByType(t){try{return await this.getAdInstanceByType(t)}catch(s){return Kl.hasOwn(s,"code")&&s.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed(t):null}}async getAdInstanceByType(t){switch(t){case M.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case M.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);case M.REWARDED_INTERSTITIAL:return await GameSDK.getRewardedInterstitialAsync(this.placementId);default:return null}}getAdInstanceFailed(t){let s=null;switch(t){case M.INTERSTITIAL:s=this.interstitialAdInstanceList;break;case M.REWARDED_VIDEO:s=this.rewardedVideoAdInstanceList;break;case M.REWARDED_INTERSTITIAL:s=this.rewardedInterstitialAdInstanceList;break}if(s===null)return null;if("canBeLoadedAd"in GameSDK.extra){for(const a of s)if(GameSDK.extra.canBeLoadedAd(a))return s.splice(s.indexOf(a),1),a}else return s.shift()||null;return null}logAdLoad(){const t=GameSDK.getSDKName();switch(this.type){case M.INTERSTITIAL:self.game.analytics.loadInterstitialAd(t);break;case M.REWARDED_VIDEO:self.game.analytics.loadRewardedVideoAd(t);break;case M.REWARDED_INTERSTITIAL:self.game.analytics.loadRewardedInterstitialAd(t);break}}logAdShown(){const t=GameSDK.getSDKName();switch(this.type){case M.INTERSTITIAL:self.game.analytics.showInterstitialAd(t);break;case M.REWARDED_VIDEO:self.game.analytics.showRewardedVideoAd(t);break;case M.REWARDED_INTERSTITIAL:self.game.analytics.showRewardedInterstitialAd(t);break}}pushInstanceToQueue(t){let s=null;switch(this.type){case M.INTERSTITIAL:s=this.interstitialAdInstanceList;break;case M.REWARDED_VIDEO:s=this.rewardedVideoAdInstanceList;break;case M.REWARDED_INTERSTITIAL:s=this.rewardedInterstitialAdInstanceList;break}s&&s.push(t)}};l(fo,"NormalAdInstance");let re=fo;const{BaseAnalytics:zl,Events:lr}=p.Plugins.Analytics,Hl=[lr.BUTTON_CLICK,lr.SCREEN_OPEN],{Utils:{Array:ql}}=p,go=class go extends zl{constructor(t,s){super(t,"FacebookAnalytics",{...s,color:"#0F52BA"});u(this,"prefix");this.prefix=s.prefix}processEvent(t,s){if(!("logEvent"in GameSDK.extra)||ql.has(Hl,t))return;const a=this.addPrefixToEventName(t);GameSDK.extra.logEvent(a,1,s)}addPrefixToEventName(t){return`${this.prefix}_${t}`}};l(go,"FacebookAnalytics");let Ra=go;const{BaseAnalytics:Yl,Events:Ql}=p.Plugins.Analytics,Xl=[Ql.SCREEN_OPEN],{Utils:{Array:Jl}}=p,wo=class wo extends Yl{constructor(e,t){super(e,"FirebaseAnalytics",{...t,color:"#FFCA28"})}setUser(e,t){var s,a;(a=(s=this.game.firebase)==null?void 0:s.services.analytics)==null||a.setUser(e,t)}processEvent(e,t){var s,a;Jl.has(Xl,e)||(a=(s=this.game.firebase)==null?void 0:s.services.analytics)==null||a.event(e,t)}};l(wo,"FirebaseAnalytics");let Ma=wo;const{BaseAnalytics:Zl,Events:$t}=p.Plugins.Analytics,td=[$t.SCREEN_OPEN],{Utils:{Array:ed}}=p,mo=class mo extends Zl{constructor(e,t){super(e,"GoogleAnalytics",{...t,color:"#E35335"})}processEvent(e,t){ed.has(td,e)||(this.customEvent(e,t),gtag("event",e,t))}customEvent(e,t){switch(e){case $t.AD_SHOW:case $t.AD_SHOW_FAILED:case $t.AD_SHOWING:case $t.USE_ITEM:case $t.EARN_ITEM:this.addLevelName(t);break}}addLevelName(e){if(!e||!(game!=null&&game.match))return;const s=game.match.getMatchState().customData.level;s<0||(e.level_name=this.getLevelName(s))}};l(mo,"GoogleAnalytics");let _a=mo;const sd="production",$a="0",{Dtos:ad,Events:ce,Configs:v,Utils:nd}=p,{Object:dr,Json:le,String:hr,Valid:id,Mark:C}=nd,Ao=class Ao extends O.Game{constructor(){super(...arguments);u(this,"markName","Core Initialize");u(this,"modulePlugins",[]);u(this,"handleProtectGameInstance",l(()=>{const t=this.event.getEventEmitCount(ct.MODULE_PLUGIN_READY),s=this.modulePlugins.length;t<s||(window.game=Object.freeze(window.game))},"handleProtectGameInstance"));u(this,"initMonitorErrorPlugin",l(()=>{if(!this.monitorError)return;const{MonitorError:t,ListPlayerDevIds:s}=v.Debugger,{ApiKey:a,Service:n,Feedback:i,TrackUser:o,FilterErrors:r}=t,c=GameSDK.player.getID(),d=GameSDK.player.getName();c&&s.indexOf(c)>=0||(this.monitorError.configure({apiKey:a,service:n,feedback:i,trackUser:o,releaseStage:sd,buildVersion:`${$a}`}),this.monitorError.setUser({id:c,name:d}),this.monitorError.addFilterErrors(r),this.monitorError.initFeedbackTrackErrors(),this.updateMonitorErrorUserAndMetadata(),this.processErrorsQueue())},"initMonitorErrorPlugin"));u(this,"updateMonitorErrorUserAndMetadata",l(()=>{this.event.catchUp(ce.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded)},"updateMonitorErrorUserAndMetadata"));u(this,"processErrorsQueue",l(()=>{if(this.monitorError&&window.__errorQueue){for(const t of window.__errorQueue)if(t instanceof Error)this.monitorError.sendException(t);else{const{message:s,code:a,stack:n}=t||{message:"",code:"Unknown",stack:"Unknown stack"},i=new Error(s||a);i.stack=n,this.monitorError.sendException(i)}window.__errorQueue=null}},"processErrorsQueue"));u(this,"processWhenPlayerInfoLoaded",l(()=>{if(!this.monitorError)return;const{playerId:t,name:s}=this.player.getPlayer();this.monitorError.setUser({id:t,name:s}),this.monitorError.addMetadata({isFirstLogin:this.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));u(this,"handleSaveRemoteConfig",l(t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch(s){console.warn("handleSaveGameCoreConfig",s)}},"handleSaveRemoteConfig"));u(this,"handleUpdateGameCoreConfig",l(t=>{try{const{id:s,type:a}=t;if(a!=="GameCore")return;p.Configs=dr.merge(p.Configs,t.config);const{Ads:n}=p.Configs;this.ads.configure(n),this.event.emit(ct.REMOTE_CONFIG_UPDATED,{id:s,type:a})}catch(s){console.warn("handleUpdateGameCoreConfig",s)}},"handleUpdateGameCoreConfig"));u(this,"handleStorageCurrentRemoteConfig",l(()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",le.clone(t)),!!t){for(const s in t)if(dr.hasOwn(t,s)){const a=t[s],n=le.clone(a);console.log("newRemoteConfig",n);const i=new ad.RemoteConfig.Data(n).toObject();console.info("remoteConfigValid",i),this.remoteConfig.setRemoteConfig(i),this.remoteConfig.processUpdateConfig(i.id,i.type)}}},"handleStorageCurrentRemoteConfig"));u(this,"initAdaptivePerformancePlugin",l(()=>{if(!this.adaptivePerformance)return;const t=le.clone(v.AdaptivePerformance);this.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));u(this,"processAfterSyncProfile",l(()=>{const{Notification:t}=v;t.Enabled&&this.updatePlayerProfileToNotificationService()},"processAfterSyncProfile"))}getBuildVersion(){return Number.parseInt(`${$a}`)||0}async boot(){console.groupEnd(),console.groupCollapsed(" GameCore Boot"),super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(ce.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),C.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),C.putAttr(this.markName,"Step","Load Lazy Plugins"),id.isDebugger()||this.event.on(ce.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),C.putAttr(this.markName,"Step","Load Dev Plugins"),this.addDevPlugins()}async start(){console.groupEnd(),console.groupCollapsed(" GameCore Start"),super.start(),C.putAttr(this.markName,"Step","Core Start"),this.event.emit(ce.CORE_STARTING),C.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),C.putAttr(this.markName,"Step","Init States"),await this.initState(),C.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),C.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();const t=this.storage.getStorageData("context","sessionContextType")||"unknown";C.putAttr(this.markName,"Context Mode",t),C.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initFirebaseAnalytics(),this.initFacebookAnalytics(),C.putAttr(this.markName,"Step","Core Ready"),C.putAttr(this.markName,"Success","true"),C.stop(this.markName),this.event.emit(ce.CORE_READY)}addPlugins(){this.installPlugin("Storage",Ca),this.installPlugin("Event",os),this.installPlugin("Ads",ze),this.installPlugin("Auth",Xe),this.installPlugin("Audio",Qe),this.installPlugin("Match",va),this.installPlugin("Player",xa),this.installPlugin("Profile",Na),this.installPlugin("Context",ts),this.installPlugin("Language",ms),this.installPlugin("Analytics",He),this.installPlugin("Visibility",Ta),this.installPlugin("Leaderboard",Is),this.installPlugin("DailyRewards",ns),this.installPlugin("FrameCapture",gs),this.installPlugin("RemoteConfig",rs),"Proxy"in window&&this.installPlugin("Firebase",rs)}installPlugin(t,s,a=!1){const n=hr.toCamelCase(hr.capitalize(t));this.plugins.install(t,s,!0,n),t!=="Storage"&&(a?this.emitModulePluginReady(t):this.emitCorePluginReady(t))}async addMonitorPlugin(){var a;(a=window.disableSimpleTrackErrors)==null||a.call(window);const{MonitorError:t}=v.Debugger;if(!t.Enabled)return;this.modulePlugins.push("MonitorError");const s=(await rt(async()=>{const{default:n}=await b.import("./bundle/monitor-error.js");return{default:n}},void 0,b.meta.url)).default;typeof s=="function"&&this.installPlugin("MonitorError",s,!0)}async addAdaptivePerformancePlugin(){const{AdaptivePerformance:t}=v;if(!t.Enabled)return;this.modulePlugins.push("AdaptivePerformance");const s=(await rt(async()=>{const{default:a}=await b.import("./bundle/index.js");return{default:a}},void 0,b.meta.url)).default;typeof s=="function"&&this.installPlugin("AdaptivePerformance",s,!0)}addDevPlugins(){var a;const{ListPlayerDevIds:t}=v.Debugger,s=(a=GameSDK==null?void 0:GameSDK.player)==null?void 0:a.getID();!s||t.indexOf(s)<0||(this.addConsolePlugin(),this.addProfilerPlugin(),this.addCanvasRecorderPlugin())}async addConsolePlugin(){try{const{Console:t}=v.Debugger;if(!t.Enabled)return;this.modulePlugins.push("Console");const s=(await rt(async()=>{const{default:a}=await Promise.resolve().then(()=>cs);return{default:a}},void 0,b.meta.url)).default;if(typeof s!="function")throw new Error("ConsolePlugin is not a function");this.installPlugin("Console",s,!0),this.initConsolePlugin()}catch(t){console.error("Error importing Console plugin:",t)}}async addProfilerPlugin(){try{const{Profiler:t}=v.Debugger;if(!t.Enabled)return;this.modulePlugins.push("Profiler");const s=(await rt(async()=>{const{default:a}=await Promise.resolve().then(()=>cs);return{default:a}},void 0,b.meta.url)).default;if(typeof s!="function")throw new Error("ProfilerPlugin is not a function");this.installPlugin("Profiler",s,!0),this.initProfilerPlugin()}catch(t){console.error("Error importing Profiler plugin:",t)}}async addCanvasRecorderPlugin(){try{const{CanvasRecorder:t}=v.Debugger;if(!t.Enabled)return;this.modulePlugins.push("CanvasRecorder");const s=(await rt(async()=>{const{default:a}=await Promise.resolve().then(()=>cs);return{default:a}},void 0,b.meta.url)).default;if(typeof s!="function")throw new Error("CanvasRecorderPlugin is not a function");this.installPlugin("CanvasRecorder",s,!0),this.initCanvasRecorderPlugin()}catch(t){console.error("Error importing Canvas Recorder plugin:",t)}}emitCorePluginReady(t){this.event.emit(ct.CORE_PLUGIN_READY,{name:t})}emitModulePluginReady(t){this.event.emit(ct.MODULE_PLUGIN_READY,{name:t})}initEventPlugin(){const{EventLogging:t}=v.Debugger;t.Enabled&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){const{Ads:t}=p.Plugins;this.ads.configure(v.Ads),this.initAdInstance(t,v),this.initFallbackAds()}initAdInstance(t,s){const{AdService:a,InterstitialAdOptions:n,RewardedVideoAdOptions:i,RewardedInterstitialAdOptions:o,BannerDisplayAdOptions:r}=s.Ads;if(a==="google"){this.initGoogleAds(!1);return}if(a!=="applovin"){for(const c of n)this.ads.setAdInstance(t.Types.INTERSTITIAL,c.PlacementId,re);for(const c of i)this.ads.setAdInstance(t.Types.REWARDED_VIDEO,c.PlacementId,re);for(const c of o)this.ads.setAdInstance(t.Types.REWARDED_INTERSTITIAL,c.PlacementId,re);for(const c of r)this.ads.setAdInstance(t.Types.BANNER,c.PlacementId,Oa)}}initFallbackAds(){const{FallbackAdService:t}=v.Ads;if(t!=="none"&&t==="google"){this.initGoogleAds(!0);return}}initGoogleAds(t){const{Ads:s}=p.Plugins,{AdServiceConfigs:a,InterstitialAdOptions:n,RewardedVideoAdOptions:i,RewardedInterstitialAdOptions:o}=v.Ads,{Google:r}=a;if(!r)return;const c=l(()=>{for(const d of n)this.ads.setAdInstance(s.Types.INTERSTITIAL,d.PlacementId,ut,t);for(const d of i)this.ads.setAdInstance(s.Types.REWARDED_VIDEO,d.PlacementId,ut,t);for(const d of o)this.ads.setAdInstance(s.Types.REWARDED_INTERSTITIAL,d.PlacementId,ut,t)},"assignAdInstance");if(ut.initStatus==="loaded"){c();return}try{ut.setGame(this),ut.initGoogleAdsAsync(r),c()}catch(d){console.error("initGoogleAds",d)}}async initState(){try{const t=new Ue(this);t.initContext(),await t.initPlayer()}catch(t){console.error("StateInitiator",t)}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;const{CanvasRecorder:t}=v.Debugger,{Type:s,Quality:a,RecordFps:n,SyncFps:i}=t.Options;this.canvasRecorder.configure({type:s,quality:a,syncFps:i,recordFps:n});const o=document.querySelector("canvas");if(!o){console.error("Canvas not found");return}this.canvasRecorder.setCanvas(o)}initRemoteConfig(){const{RemoteConfig:t}=v;if(!t.Enabled)return;const s=le.clone(t);this.remoteConfig.configure(s),this.event.on(ct.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(ct.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.catchUp(ct.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initFirebasePlugin(){const{Firebase:t}=v;if(!t.Enabled||!this.firebase)return;const s=le.clone(t);this.firebase.configure(s),C.setService(this.firebase.services.performance)}initMarkCoreInitialize(){v.PerformanceMonitor.CoreFlows&&(C.measure(this.markName),C.putAttr(this.markName,"Build",`${$a}`),C.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),C.putAttr(this.markName,"Platform",GameSDK.getPlatform()),C.putAttr(this.markName,"Success","false"),C.start(this.markName))}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch(t){console.warn("processPlayerProfile fail",t)}}async updatePlayerProfileToNotificationService(){try{const{AppId:t}=v,s=this.player.getPlayer(),{ASID:a,playerId:n,name:i,photo:o,locale:r}=s;await Nr({appId:t,ASID:a,playerId:n,name:i,photo:o,locale:r})}catch(t){console.warn("updatePlayerProfileToNotificationService",t)}}initGoogleAnalytics(){const{Enabled:t,ConsoleLog:s}=v.Analytics.GoogleAnalytics??{};t&&this.analytics.add(new _a(this.game,{log:!!s}))}initFirebaseAnalytics(){const{Enabled:t,ConsoleLog:s}=v.Analytics.FirebaseAnalytics??{};if(!t)return;const a=new Ma(this.game,{log:!!s});this.analytics.add(a);let n="no_entry";GameSDK.getEntryPointAsync().then(i=>{n=i}).catch(i=>{console.warn(i)}).finally(()=>{const i=this.player.getPlayer(),{playerId:o,locale:r}=i,{fbig_ad_id:c,fbig_adset_id:d,fbig_campaign_id:h}=GameSDK.getEntryPointData()||{};a.setUser(o,{locale:r,ad_id:c,adset_id:d,campaign_id:h,traffic_source:n})})}initFacebookAnalytics(){const{Enabled:t,Prefix:s,ConsoleLog:a}=v.Analytics.FacebookAnalytics??{};if(t){if(typeof s!="string"){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new Ra(this.game,{prefix:s,log:!!a}))}}};l(Ao,"MagicGame");let Ga=Ao;const{Configs:{GameEngine:{ForceDesktopDPR:Ge}},Utils:{Device:od},Events:ka}=p,rd=l(async()=>{const f=new Ga;window.game=f;const e=20;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreStart=!0,await f.boot(),f.event.catchUp(ka.REQUEST_CORE_START,ur),cd(f)},"initGame"),ur=l(()=>{if(!window.__sdkInitiated){game.event.catchUp(ka.GAME_SDK_READY,ur);return}window.game.start(),console.warn("Game started");const f=25;window.__sdkLoadingCount<f&&(window.__sdkLoadingCount=f)},"startGame"),cd=l(f=>{const t=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(t);const s=10;window.__sdkLoadingCount<s&&(window.__sdkLoadingCount=s),f.event.emit(ka.GAME_SDK_READY)},5)},"waitGameSDK");Ge!==!1&&od.isDesktop()&&typeof Ge=="number"&&Ge>0&&(window.devicePixelRatio=Ge),rd()},"execute")}});
