var Do=Object.defineProperty;var Po=(ue,C,p)=>C in ue?Do(ue,C,{enumerable:!0,configurable:!0,writable:!0,value:p}):ue[C]=p;var u=(ue,C,p)=>Po(ue,typeof C!="symbol"?C+"":C,p);System.register(["./bundle/core.js","./bundle/monitor-error.js"],function(ue,C){"use strict";var p,L,kt,ne,O,ie,Ut,Bt;return{setters:[M=>{p=M.G,L=M.P,kt=M.M,ne=M._,O=M.a,ie=M.C,Ut=M.w},M=>{Bt=M.g}],execute:function(){const{Valid:M,Object:ye,String:at,Json:Ht}=p.Utils,xe="is invalid",ae=class ae{static addDefaultData(t){M.isObject(t)||this.prototype.exception("default data",xe),t=Ht.clone(t);const{name:e}=this;M.isObject(ae.data[e])||(ae.data[e]={}),ae.data[e]=ye.merge(ae.data[e],t)}static getDefaultData(){const{name:t}=this;return Ht.clone(ae.data[t])}static addValidateFunction(t,e){M.isString(t)||this.prototype.exception("validate key",xe),typeof e!="function"&&this.prototype.exception("validate function",xe);const s=`validate${at.capitalize(t)}`;ye.assign(this.prototype,{[s]:e})}constructor(t){this.defaultData(),this.processData(t)}processData(t){this.validateStructure(t),this.validateData(t),this.setupData(t)}defaultData(){const{name:t}=this.constructor;this.lazyDefaultData(ae.data[t])}lazyDefaultData(t){M.isObject(t)||this.exception("data",xe);for(const e in t)if(ye.hasOwn(t,e)){const s=t[e];ye.assign(this,{[e]:s})}}lazyValidateStructure(t){M.isObject(t)||this.exception("structure","is not object");const e=this.getKeys();for(const s of e){const a=this[s];a===void 0&&this.exception("structure",`has no key ${s}`),!ye.hasOwn(t,s)&&a!==void 0&&this.setDefaultData(s,t)}}setDefaultData(t,e){M.isObject(e)||this.exception("data",xe);const s=this[t];s===void 0&&this.exception("default",`has no key ${t}`),ye.assign(e,{[t]:s})}lazyValidateData(t){const e=this.getKeys();for(const s of e){const a=t[s],n=at.removeDiacritics(s).replace(/[^a-zA-Z0-9]/g,""),i=`validate${at.capitalize(n)}`,r=this[i];if(typeof r=="function")try{r.call(this,a)}catch{this.setDefaultData(s,t)}else this.exception("validate",`has no function ${i}`)}}lazySetupData(t){const e=this.getKeys();for(const s of e){const a=t[s];ye.assign(this,{[s]:a})}}validate(){this.validateData(this.toObject())}exception(t,e){throw new Error(`${this.constructor.name}: ${t} ${e}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([t])=>t!=="toObject"))}getKeys(){return Object.keys(this).filter(t=>t!=="toObject")}};u(ae,"data",{});let R=ae;p.Dtos={Base:R};const zs={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded",notificationData:"notificationData"},pe={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0,notificationData:{currentId:0,lastSent:0}}},{Valid:ve}=p.Utils,{playerId:qs,name:Js,photo:Ys,locale:Qs}=pe,Ce="is invalid";class $e extends R{setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateId(t){(!ve.isString(t)||!t)&&this.exception("_id",Ce)}validatePlayerId(t){(!ve.isString(t)||!t)&&this.exception("playerId",Ce)}validateName(t){(!ve.isString(t)||!t)&&this.exception("name",Ce)}validatePhoto(t){ve.isString(t)||this.exception("photo",Ce)}validateLocale(t){(!ve.isString(t)||!t)&&this.exception("locale",Ce)}toObject(){return super.toObject()}}$e.addDefaultData({playerId:qs,name:Js,photo:Ys,locale:Qs});const Y=new $e({playerId:"10",name:"Your Friend"}).toObject();class Q extends Error{constructor(e){super(e);u(this,"code");this.code="CREATE_MATCH_FAILED"}}class S extends Q{constructor(t){super(t),this.name="PlayerIdNotValid",this.message=t??"Player id is not valid"}}const{Dtos:nt,Utils:Xs,Events:Zs}=p,{Array:ea,Object:ta,Json:So,Valid:jt}=Xs;class sa{constructor(t){u(this,"game");u(this,"initContext",()=>{const t={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},e=new nt.Context.Info(t),{contextId:s,contextType:a,entryPointData:n}=e.toObject();this.game.context.receiveContext(s,a,n)});u(this,"initPlayer",async()=>{const{player:t}=this.game,e=this.getPlayerInfo(),s=ea.unique(ta.vals(zs)),a=await GameSDK.player.getDataAsync(s),n=new nt.Player.Data(a).toObject();t.receiveData(e,n),this.game.event.emit(Zs.PLAYER_INFO_LOADED)});u(this,"getPlayerInfo",()=>{try{const t=GameSDK.player.getID();let e=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),a=GameSDK.getLocale();if(!jt.isString(t))throw new S;return jt.isString(e)||(e="You"),new nt.Player.Info({playerId:t,name:e,photo:s,locale:a}).toObject()}catch{return Y}});this.game=t}}class it extends Error{constructor(e,s){super(e);u(this,"payload");this.name="BadRequest",this.message=e??"This request is bad",this.payload=s}}class rt extends Error{constructor(e,s){super(e);u(this,"payload");this.name="RequestTimeout",this.message=e??"This request is timeout",this.payload=s}}const{Utils:aa,Configs:na}=p,{AppId:Kt,Network:ot}=na,ia=l=>{if(!l.ok)throw new it(void 0,{response:l})},Wt=()=>{const l=window.game.auth.getToken();return{token:l,timeout:ot.Timeout,headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}}},zt=(l,t,e,s)=>async()=>{try{if(!Kt)throw new it("AppId is not defined");const a=`${l}/apps/${Kt}/${t}`,n=new AbortController;e.signal=n.signal;const i=setTimeout(()=>{n.abort()},e.timeout);p.Utils.Valid.isObject(s)&&(e.body=JSON.stringify(s));const r=await fetch(a,e);return clearTimeout(i),ia(r),await r.json()||{}}catch(a){if(a instanceof it)return null;throw a instanceof Object&&"name"in a&&a.name==="AbortError"?new rt:a}},ct=async(l,t)=>{try{return l()}catch(e){if(e instanceof rt&&t>0)try{return await aa.Time.sleepAsync(600),await ct(l,t-1)}catch{return{}}return e instanceof rt?{}:{}}},fe=async(l,t,e,s=ot.Retries)=>{try{const a={...Wt(),...t,method:"GET"},n=zt(e,l,a);return await ct(n,s)}catch{return{}}},G=async(l,t,e,s,a=ot.Retries)=>{try{const n={...Wt(),...e,method:"POST"},i=zt(s,l,n,t);return await ct(i,a)}catch{return{}}},{Configs:{Notification:{ApiUrl:ra}},Utils:{Object:oa}}=p,ca=async l=>{if(!oa.hasOwn(l,"playerId"))throw new Error("Missing playerId");const{playerId:t}=l;await G(`players/${t}`,l,{},ra,10)};var lt=(l=>(l.IDLE="idle",l.LOADING="loading",l.FILLED="filled",l.SHOWING="showing",l))(lt||{}),k=(l=>(l.BANNER="banner",l.INTERSTITIAL="interstitial",l.REWARDED_VIDEO="rewarded_video",l.REWARDED_INTERSTITIAL="rewarded_interstitial",l))(k||{});let Ve=class extends Error{constructor(e,s){super(s);u(this,"code");this.code=e,this.message=s}};class la{constructor(t,e){u(this,"type");u(this,"placementId");u(this,"_status");this.type=t,this._status=lt.IDLE,this.placementId=e}setStatus(t){this._status!==t&&(this._status=t)}get status(){return this._status}exception(t){throw new Ve("AD_INSTANCE_ERROR",t)}}let qt=class extends la{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}};p.Plugins.Ads={Types:k,Status:lt,AdError:Ve,AdInstance:qt};const{Array:dt,Object:da}=p.Utils;class ha extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"enabled");u(this,"config");u(this,"lastCallAdShownTime");u(this,"isAdFullSizeShowed");u(this,"ads",{});u(this,"safeAreaBottom")}init(){this.lastCallAdShownTime={[k.BANNER]:0,[k.INTERSTITIAL]:0,[k.REWARDED_VIDEO]:0,[k.REWARDED_INTERSTITIAL]:0},this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const e=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=Number.parseInt(e,10),Number.isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(e){this.config=e,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new Ve("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(e,s,a){this.ads[s]||(this.ads[s]={type:e,placementId:s,interval:null,instance:new a(e,s)})}async loadAdAsync(e,s){this.checkEnabled(),await this.getAd(e,s).instance.loadAsync()}async showAdAsync(e,s){this.checkEnabled();const{event:a}=this.game,n=this.getAd(e,s);this.lastCallAdShownTime[e]=window.performance.now()/1e3;try{a.emit(p.Events.AD_SHOWING,{placementId:s}),this.isAdFullSizeShowed=!0,await n.instance.showAsync()}finally{a.emit(p.Events.AD_CLOSED,{placementId:s}),this.isAdFullSizeShowed=!1}}getAdStatus(e,s){return this.checkEnabled(),this.getAd(e,s).instance.status}getAd(e,s){let a=null;if(s?a=this.getAdByPlacementId(s):a=this.getPriorityAdByType(e),!a)throw new Ve("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}getAdsByType(e){return da.vals(this.ads).filter(s=>s.type===e)}getAdByPlacementId(e){const s=this.ads[e];return s||null}getPriorityAdByType(e){const s=this.getAdsByType(e);if(!s.length)return null;const a=dt.search(s,n=>n.type===e);return a||null}canbeShowInterstitialAd(e){return this.canbeShowInterstitialAdByTime(e)}canbeShowInterstitialAdByTime(e){try{const s=window.performance.now()/1e3;let a;if(e)a=this.getCommonAdConfig(e);else{const d=this.getPriorityAdByType(k.INTERSTITIAL);if(!d)return!1;a=this.getCommonAdConfig(d.placementId)}const{SecondsBetweenAds:n,SecondsFirstTime:i}=a,r=s-this.lastCallAdShownTime[k.INTERSTITIAL],o=r>n,c=r>i;return this.lastCallAdShownTime[k.INTERSTITIAL]>0?o:c}catch{return!1}}canbeShowBannerAd(e){try{const s=this.getBannerConfig(e),{Platform:a}=s;if(a==="ALL")return!0;const n=GameSDK.getPlatform();return n?n===a:!1}catch{return!1}}async showBannerAdAsync(e){this.checkEnabled();const s=this.getAd(k.BANNER,e);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const{event:a}=this.game;if(a.emit(p.Events.AD_SHOWING,{placementId:e}),GameSDK.getSDKName()==="MsGames")return;const n=this.getBannerConfig(s.placementId),{SecondsReload:i}=n;i<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},i*1e3))}async hideBannerAdAsync(e){this.checkEnabled();const s=this.getAd(k.BANNER,e);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync();const{event:a}=this.game;a.emit(p.Events.AD_CLOSED,{placementId:e})}cleanBannerReloadTimer(e){try{const s=this.getAd(k.BANNER,e),{interval:a}=s;if(!a)return;clearInterval(a)}catch{}}getCommonAdConfig(e){const s=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions],a=dt.search(s,n=>n.PlacementId===e);if(!a)throw new Error(`Ad config with placementId ${e} not found`);return a}getBannerConfig(e){const s=dt.search(this.config.BannerDisplayAdOptions,a=>a.PlacementId===e);if(!s)throw new Error(`Banner config with placementId ${e} not found`);return s}getBannerHeight(e,s,a=!0){this.checkEnabled();const n=this.getBannerConfig(e),i=GameSDK.getBannerHeight(n);return a?(this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),(i+this.safeAreaBottom)*s):i*s}getSafeAreaBottom(e){return this.safeAreaBottom<=0&&this.calculateSafeAreaBottom(),this.safeAreaBottom*e}}const F={ENGINE_READY:"engine_ready",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",PAGE_VIEW:"page_view",SCREEN_OPEN:"screen_open",BUTTON_CLICK:"button_click",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",MESSAGE:"message",INVITE:"invite",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_LOAD:"ad_load",AD_LOAD_FAILED:"ad_load_failed",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",AD_SHOWING:"ad_showing",AD_REWARD:"ad_reward",NEW_USER:"new_user",RETURNING_USER:"returning_user",JOIN_GROUP:"join_group",TOURNAMENT_START:"tournament_start",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GET_FREE_ITEM:"get_free_item",USE_ITEM:"use_item",EARN_ITEM:"earn_item"},{String:ge,Valid:ua}=p.Utils;let ya=class{constructor(t,e,s){u(this,"game");u(this,"name");u(this,"color");u(this,"options");u(this,"selfLog");u(this,"currentPath");this.game=t,this.name=e,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/"}event(t,e){this.logInfo("event",{name:t,payload:e});const s=this.formatEventName(t);this.processEvent(s,e)}logInfo(t,e){this.selfLog}pageview(t){let e=this.getPageTitle(t);e=this.addGameModeToPageTitle(e),document.title=e,this.event(F.PAGE_VIEW,{path_path:t,page_title:e})}levelStart(t,e,s){this.event(F.LEVEL_START,{level:t,score:e,level_name:this.getLevelName(t),game_mode:s?ge.toUpperCamelCase(s):void 0})}levelFail(t,e,s){this.event(F.LEVEL_END,{level:t,score:e,success:!1,level_name:this.getLevelName(t),game_mode:s?ge.toUpperCamelCase(s):void 0})}levelRescue(t,e,s){this.event(F.LEVEL_RESCUE,{level:t,score:e,level_name:this.getLevelName(t),game_mode:s?ge.toUpperCamelCase(s):void 0})}levelComplete(t,e,s){this.event(F.LEVEL_END,{level:t,score:e,success:!0,level_name:this.getLevelName(t),game_mode:s?ge.toUpperCamelCase(s):void 0})}loadAdEvent(t){const{type:e,placement:s,adService:a}=t;this.event(F.AD_LOAD,{ad_type:e,screen_name:s,ad_service:a})}showAdEvent(t){const{type:e,placement:s,adService:a}=t;this.event(F.AD_SHOW,{ad_type:e,screen_name:s,ad_service:a})}loadInterstitialAd(t){const{placement:e,adService:s}=t;this.loadAdEvent({type:"interstitial",placement:e,adService:s})}showInterstitialAd(t){const{placement:e,adService:s}=t;this.showAdEvent({type:"interstitial",placement:e,adService:s})}loadRewardedVideoAd(t){const{placement:e,adService:s}=t;this.loadAdEvent({type:"rewarded_video",placement:e,adService:s})}showRewardedVideoAd(t){const{placement:e,adService:s}=t;this.showAdEvent({type:"rewarded_video",placement:e,adService:s})}receiveVideoReward(t){const{placement:e,adService:s}=t;this.event(F.AD_REWARD,{screen_name:e,ad_service:s})}loadRewardedInterstitialAd(t){const{placement:e,adService:s}=t;this.loadAdEvent({type:"rewarded_interstitial",placement:e,adService:s})}showRewardedInterstitialAd(t){const{placement:e,adService:s}=t;this.showAdEvent({type:"rewarded_interstitial",placement:e,adService:s})}receiveInterstitialReward(t){const{placement:e,adService:s}=t;this.event(F.AD_REWARD,{screen_name:e,ad_service:s})}loadAdFail(t){const{type:e,placement:s,adService:a}=t;this.event(F.AD_LOAD_FAILED,{ad_type:e,screen_name:s,ad_service:a})}showAdFail(t){const{type:e,placement:s,adService:a}=t;this.event(F.AD_SHOW_FAILED,{ad_type:e,screen_name:s,ad_service:a})}showingAd(t){const{type:e,placement:s,adService:a}=t;this.event(F.AD_SHOWING,{ad_type:e,screen_name:s,ad_service:a})}formatEventName(t){return t.toLowerCase().replace(/:/g,"_")}getLevelName(t){return`Level ${ge.padStart(t.toString(),5,"0")}`}getPageTitle(t){const e=t.split("/").pop();if(!ua.isString(e))return t;const s=e.replace(/([-_\s.])/g," $1");return ge.toUpperCamelCase(s)}addGameModeToPageTitle(t){const{match:e}=this.game,s=e.getMatchState();let{mode:a}=s;return a||(a="Normal"),`${ge.toUpperCamelCase(a)}::${t}`}};p.Plugins.Analytics={Events:F,BaseAnalytics:ya};class pa extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"analytics",[]);u(this,"placement","unknown");u(this,"pageview",e=>{if(!this.isActive())return;this.placement=e;const s=this.getPageByKey(e);for(const a of this.analytics)a.pageview(s)})}add(e){this.analytics.some(a=>a.name===e.name)||this.analytics.push(e)}isActive(){return this.analytics.length>=1}event(e,s){if(this.isActive())for(const a of this.analytics)a.event(e,s)}levelStart(e,s,a){if(this.isActive())for(const n of this.analytics)n.levelStart(e,s,a)}levelRescue(e,s,a){if(this.isActive())for(const n of this.analytics)n.levelRescue(e,s,a)}levelFail(e,s,a){if(this.isActive())for(const n of this.analytics)n.levelFail(e,s,a)}levelComplete(e,s,a){if(this.isActive())for(const n of this.analytics)n.levelComplete(e,s,a)}loadInterstitialAd(e){if(this.isActive())for(const s of this.analytics)s.loadInterstitialAd({...e,placement:this.placement})}showInterstitialAd(e){if(this.isActive())for(const s of this.analytics)s.showInterstitialAd({...e,placement:this.placement})}loadRewardedVideoAd(e){if(this.isActive())for(const s of this.analytics)s.loadRewardedVideoAd({...e,placement:this.placement})}showRewardedVideoAd(e){if(this.isActive())for(const s of this.analytics)s.showRewardedVideoAd({...e,placement:this.placement})}receiveVideoReward(e){if(this.isActive())for(const s of this.analytics)s.receiveVideoReward({...e,placement:this.placement})}loadRewardedInterstitialAd(e){if(this.isActive())for(const s of this.analytics)s.loadRewardedInterstitialAd({...e,placement:this.placement})}showRewardedInterstitialAd(e){if(this.isActive())for(const s of this.analytics)s.showRewardedInterstitialAd({...e,placement:this.placement})}receiveInterstitialReward(e){if(this.isActive())for(const s of this.analytics)s.receiveInterstitialReward({...e,placement:this.placement})}loadAdFail(e){if(this.isActive())for(const s of this.analytics)s.loadAdFail({...e,placement:this.placement})}showAdFail(e){if(this.isActive())for(const s of this.analytics)s.showAdFail({...e,placement:this.placement})}showingAd(e){if(this.isActive())for(const s of this.analytics)s.showingAd({...e,placement:this.placement})}getPageByKey(e){let s=e;if(s.indexOf("_")>-1){let i=s.replace(/_/g,"-");return i=i.toLowerCase(),i}let a=s.length-1,n="";for(;a>0;){n=s.charAt(a);const i=Number.isNaN(Number.parseInt(n,10)),r=n===n.toUpperCase();i&&r&&(s=`${s.slice(0,a)}-${s.slice(a)}`),a--}return s.toLowerCase()}}class fa{constructor(t){u(this,"key");this.key=t}getKey(){return this.key}}class ga{constructor(t){u(this,"id");u(this,"isMuteAll");u(this,"masterVolume");u(this,"audioClips");this.id=t,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(t){return this.audioClips[t]?this.audioClips[t]:null}setAudioClip(t,e){this.audioClips[t]={...this.audioClips[t],...e}}async play(t,e){const s=this.getAudioClip(t);if(s){const{audioPlayer:a}=s;this.playWithRealConfig(a,e)}else await this.loadAndPlay(t,e)}async loadAndPlay(t,e){try{const s=await this.onLoadAudio(t,e),{volume:a=1}=e||{};this.setAudioClip(t,{volume:a,audioPlayer:s}),this.playWithRealConfig(s,e)}catch{}}playWithRealConfig(t,e){if(e){const{volume:s=1}=e;e.volume=this.masterVolume*s}t.play(e)}pause(t){const e=this.getAudioClip(t);if(!e)return!1;const{audioPlayer:s}=e;return s.pause(),!0}resume(t){const e=this.getAudioClip(t);if(!e)return!1;const{audioPlayer:s}=e;return s.resume(),!0}stop(t){const e=this.getAudioClip(t);if(!e)return!1;const{audioPlayer:s}=e;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(t){this.masterVolume=t,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(t,e){try{const{audioPlayer:s,volume:a=1}=t;switch(e){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*a);break;default:throw new Error(`Unsupported function: ${e}`)}}catch{}}callAudioPlayers(t){const{Object:e}=p.Utils,s=e.vals(this.audioClips);for(const a of s)this.queueAudioPlayer(a,t)}}p.Plugins.Audio={BaseAudioPlayer:fa,BaseChannelManager:ga};class ma extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"firstChannelId");u(this,"channels",{})}addChannel(e){const s=e.getId();this.channels[s]=e,this.firstChannelId||(this.firstChannelId=s)}getChannel(e){if(e===void 0)return this.channels[this.firstChannelId];const s=this.channels[e];if(!s)throw new Error(`Channel ${e} not found`);return s}async play(e,s,a){try{await this.getChannel(a).play(e,s)}catch{}}pause(e,s){try{this.getChannel(s).pause(e)}catch{}}resume(e,s){try{this.getChannel(s).resume(e)}catch{}}stop(e,s){try{this.getChannel(s).stop(e)}catch{}}stopAll(e){try{this.getChannel(e).stopAll()}catch{}}mute(e){try{this.getChannel(e).muteAll()}catch{}}unmute(e){try{this.getChannel(e).unmuteAll()}catch{}}setVolume(e,s){try{this.getChannel(s).setVolume(e)}catch{}}getVolume(e){try{return this.getChannel(e).getVolume()}catch{return-1}}}const wa={token:"",isRequesting:!1};class Aa extends L.Plugins.BasePlugin{init(){const{storage:t}=this.game;t.addStorage("auth",wa)}async requestToken(){const{storage:t}=this.game;try{if(t.getStorageData("auth","isRequesting")||t.getStorageData("auth","token")!=="")return;t.setStorageData("auth","isRequesting",!0);const n=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();t.setStorageData("auth","token",n)}catch(e){if(p.Utils.Object.hasOwn(e,"code")&&e.code==="PENDING_REQUEST")return;t.setStorageData("auth","token","")}finally{t.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:t}=this.game;return t.getStorageData("auth","token")}}var re=(l=>(l.SOLO="solo",l.TOURNAMENT="tournament",l.SHARE_INVITE="share_invite",l.MATCHING_GROUP="matching_group_match",l.CHALLENGE_FRIEND="challenge_friend_match",l))(re||{});const me=kt,{Configs:Ia,Utils:{Array:Da,Valid:Pa,Browser:Sa}}=p;class Ea{constructor(t){u(this,"game");this.game=t}isValidContextType(t){return["THREAD","POST","SOLO","GROUP"].indexOf(t)>=0}isValidEntryPointData(t){return Pa.isObject(t)}isTournamentEntryPoint(t){return Da.has(["facebook~game_list~tournaments","fb_feed_tournament_unit","messenger~bot_thread~tournaments"],t)}receiveContext(t,e,s){const{storage:a}=this.game;a.setStorageData("context","contextId",t),this.isValidEntryPointData(s)&&a.setStorageData("context","entryPointData",s),this.isValidContextType(e)&&a.setStorageData("context","contextType",e)}async detectContextSessionType(){const{storage:t}=this.game,e=t.getStorageData("context","entryPointData"),{type:s}=e,{SOLO:a,TOURNAMENT:n,MATCHING_GROUP:i,SHARE_INVITE:r,CHALLENGE_FRIEND:o}=re;let c=a;if(s===n&&(c=n),s===i&&(c=i),(s===o||s===r)&&(c=o),c===a)try{Ia.Core.FastCheckTournamentContext?c=this.fastCheckTournamentContext()||c:c=await this.outdatedCheckTournamentContext()||c}catch{}t.setStorageData("context","sessionContextType",c)}fastCheckTournamentContext(){const e=Sa.getQueryParams().entry_point;return typeof e!="string"||!this.isTournamentEntryPoint(e)?!1:re.TOURNAMENT}async outdatedCheckTournamentContext(){return"getTournamentAsync"in GameSDK&&(await GameSDK.getTournamentAsync()).getEndTime()>Date.now()/1e3?re.TOURNAMENT:!1}detectContextGameMode(){const{player:t,storage:e}=this.game,s=e.getStorageData("context","entryPointData"),a=e.getStorageData("context","sessionContextType"),n=t.getPlayerId(),{matchId:i,playerId:r,opponentId:o=Y.playerId}=s,c=n===r,h=o===Y.playerId||[o,r].indexOf(n)>=0,{TOURNAMENT:y,MATCHING_GROUP:f,SHARE_INVITE:g,CHALLENGE_FRIEND:A}=re;let m=me.SINGLE;a===y&&(m=me.TOURNAMENT),a===g&&!c&&(m=me.CHALLENGE_FRIEND),a===A&&i&&h&&(m=me.CHALLENGE_FRIEND),a===f&&(m=me.MATCHING_GROUP),e.setStorageData("context","contextGameMode",m)}}class Jt extends Error{constructor(t){super(t),this.name="PlayerHasFinishedMatch",this.message=t??"Player has finished match"}}class ht extends Error{constructor(t){super(t),this.name="PlayerNotJoinInMatch",this.message=t||"Player is not join in match"}}const{Events:ke,Plugins:{Analytics:Yt}}=p;class xa{constructor(t){u(this,"game");this.game=t}async processContextData(){const{player:t,storage:e,monitorError:s}=this.game,a=e.getStorageData("context","contextId"),n=e.getStorageData("context","entryPointData"),i=e.getStorageData("context","sessionContextType"),{type:r,matchId:o,playerId:c,opponentId:d,playerScore:h,action:y}=n||{};y&&await this.processEntryPointAction(y);const f=t.isFirstLogin();setTimeout(()=>{this.logUserAnalytics(f)},1e3);const{TOURNAMENT:g,SHARE_INVITE:A,MATCHING_GROUP:m,CHALLENGE_FRIEND:b}=re;if(i===g)try{await this.processTournamentModeAsync(a);return}catch{s==null||s.sendException(new Error("Process Tournament Fail"),{contextId:a,isFirstLogin:f,entryPointData:n,playerData:t.getPlayerData()})}if(i===b){if(r===A&&typeof c=="string"){await this.processChallengeFromPostAsync(c);return}if(r===b&&typeof o=="string"&&typeof c=="string"&&typeof d=="string"){await this.processChallengeFromMessageAsync({contextId:a,matchId:o,playerId:c,opponentId:d});return}}if(i===m&&typeof c=="string"&&typeof h=="number"){await this.processMatchingGroupModeAsync(c,h);return}if(f){await this.processSingleModeAsync(!0),t.loggedIn();return}this.processSingleModeAsync(!1)}logUserAnalytics(t){try{const{player:e,analytics:s}=this.game;if(t)s.event(Yt.Events.NEW_USER);else{const{coins:a}=e.getPlayerData().gameData;s.event(Yt.Events.RETURNING_USER,{coins:a})}}catch{}}async processEntryPointAction(t){try{const{player:e}=this.game;switch(t){case"reset_data":e.setPlayerDataByName("score",0),e.setPlayerDataByName("endlessScore",0),e.setGameData({coins:0,level:1}),await e.syncProfileToServer();break;case"enable_debug":e.setPlayerDataByName("debug",!0);break;case"set_locale_en":this.requestSetLocale("en");break;case"set_locale_ru":this.requestSetLocale("ru");break}}catch{}}requestSetLocale(t){const{event:e}=this.game;e.emit(ke.REQUEST_LANGUAGE,{locale:t})}async processTournamentModeAsync(t){const{match:e,player:s}=this.game,a=s.getPlayerId();if(typeof t!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:a,contextId:t}),this.switchToGameScene()}async processChallengeFromPostAsync(t){const{match:e,player:s}=this.game,a=s.getPlayerId();if(a===t)await e.single.start.processAsync({playerId:a});else try{await e.challenge.friend.processAsync({playerId:a,opponentId:t})}catch{await e.single.start.processAsync({playerId:a})}this.switchToGameScene()}async processChallengeFromMessageAsync(t){try{await this.processContinueChallengeFromMessageAsync(t)}catch(e){if(e instanceof Jt){await this.processAwaitChallengeFromMessageAsync(t);return}if(e instanceof ht){await this.processJoinChallengeFromMessageAsync(t);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(t){const{contextId:e,matchId:s,playerId:a,opponentId:n}=t,{match:i,player:r}=this.game,o=r.getPlayerId();if(a===o)await i.challenge.continue.processAsync({contextId:e,matchId:s,playerId:o,opponentId:n});else{const d=n===Y.playerId;await i.challenge.continue.processAsync({contextId:e,matchId:s,playerId:o,opponentId:d?n:a})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(t){const{contextId:e,matchId:s,playerId:a}=t,{match:n,player:i}=this.game,r=i.getPlayerId();await n.challenge.join.processAsync({contextId:e,matchId:s,playerId:r,opponentId:a}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(t){const{contextId:e,matchId:s,playerId:a}=t,{match:n,player:i}=this.game,r=i.getPlayerId();try{await n.challenge.await.processAsync({contextId:e,matchId:s,playerId:r,opponentId:a}),this.switchToChallengeResultScene()}catch{await this.processResultChallengeFromMessageAsync(t)}}async processResultChallengeFromMessageAsync(t){const{contextId:e,matchId:s,playerId:a}=t,{match:n,player:i}=this.game,r=i.getPlayerId();try{await n.challenge.result.processAsync({contextId:e,matchId:s,playerId:r,opponentId:a}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(t,e){const{match:s,player:a}=this.game;await s.group.join.processAsync({playerId:a.getPlayerId(),opponentId:t,opponentScore:e}),this.switchToGameScene()}async processSingleModeAsync(t){const{match:e,player:s}=this.game,a=s.getPlayerId();t&&await e.handler.setMatchCustomData({level:0}),await e.single.start.processAsync({playerId:a}),this.switchToGameScene()}switchToDashboardScene(){const{event:t}=this.game;t.emit(ke.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isFromLoader:!0}})}switchToGameScene(){const{event:t}=this.game;t.emit(ke.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isFromLoader:!0}})}switchToChallengeResultScene(){const{event:t}=this.game;t.emit(ke.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isFromLoader:!0}})}}const Qt={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},{Events:va}=p;class Ca extends L.Plugins.BasePlugin{constructor(e){super(e);u(this,"context");u(this,"loader");this.loader=new xa(e),this.context=new Ea(e)}init(){const{storage:e}=this.game;e.addStorage("context",Qt)}getSessionContextTypes(){return re}async processContextData(){try{await this.loader.processContextData()}catch{this.switchToDashboardScene()}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch{}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(e,s,a){this.context.receiveContext(e,s,a)}switchToDashboardScene(){const{event:e}=this.game;e.emit(va.SWITCH_SCENE,{sceneName:"DashboardScene"})}}const{Valid:ut}=p.Utils,{contextId:ba,contextType:Na,entryPointData:La}=Qt,yt="is invalid";class Xt extends R{constructor(){super(...arguments);u(this,"data")}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateContextId(e){ut.isString(e)||this.exception("contextId",yt)}validateContextType(e){(!ut.isString(e)||!e)&&this.exception("contextType",yt)}validateEntryPointData(e){ut.isObject(e)||this.exception("entryPointData",yt)}toObject(){return super.toObject()}}Xt.addDefaultData({contextId:ba,contextType:Na,entryPointData:La}),p.Dtos.Context={Info:Xt};const Ta={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},{Object:Ma}=p.Utils;class _a{async getDailyRewardsAsync(){return Ma.vals(Ta)}}const be={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},Oa={dailyRewards:{}},Zt=p.Configs.DailyRewards;class Ra extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"dailyRewardsApi",new _a)}init(){const{storage:e}=this.game;e.addStorage("dailyRewards",Oa)}async requestDailyRewardsAsync(){const e=await this.dailyRewardsApi.getDailyRewardsAsync();e.length!==0&&this.receiveDailyRewards(e)}getDailyRewards(){const{storage:e}=this.game,s=e.getStorageData("dailyRewards","dailyRewards");return s||null}logLoginReward(){const{player:e}=this.game,{logDays:s}=e.getPlayerData().dailyRewarded,a=[...s];a[a.length-1]=!0,this.logDailyRewards(a)}logDailyRewards(e,s=!1){const{player:a}=this.game;a.setPlayerDataByName("dailyRewarded",{logDays:e,lastRewarded:s?0:Date.now()})}receiveDailyRewards(e){const{player:s}=this.game,{logDays:a,lastRewarded:n}=s.getPlayerData().dailyRewarded,i=new Date,r=new Date(n),o=new Date(r.toDateString()),c=Math.abs(i.valueOf()-o.valueOf()),h=Math.floor(c/864e5)>1,f=Zt.CheckInterrupt&&h||a.length>=Zt.MaxDays,g=f?[!1]:[...a,!1];this.logDailyRewards(g);const A=e.map((m,b)=>{const V=b<g.length,P=g.length===b+1,Vt=g[b]===!1;let W=be.WAITING;return P?W=be.READY:f?W=be.WAITING:V&&Vt?W=be.SKIPPED:V&&(W=be.REWARDED),{...m,status:W}});this.setDailyRewards(A)}setDailyRewards(e){const{storage:s}=this.game;s.setStorageData("dailyRewards","dailyRewards",e)}}var es={exports:{}};(function(l){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function a(o,c,d){this.fn=o,this.context=c,this.once=d||!1}function n(o,c,d,h,y){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new a(d,h||o,y),g=e?e+c:c;return o._events[g]?o._events[g].fn?o._events[g]=[o._events[g],f]:o._events[g].push(f):(o._events[g]=f,o._eventsCount++),o}function i(o,c){--o._eventsCount===0?o._events=new s:delete o._events[c]}function r(){this._events=new s,this._eventsCount=0}r.prototype.eventNames=function(){var c=[],d,h;if(this._eventsCount===0)return c;for(h in d=this._events)t.call(d,h)&&c.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},r.prototype.listeners=function(c){var d=e?e+c:c,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var y=0,f=h.length,g=new Array(f);y<f;y++)g[y]=h[y].fn;return g},r.prototype.listenerCount=function(c){var d=e?e+c:c,h=this._events[d];return h?h.fn?1:h.length:0},r.prototype.emit=function(c,d,h,y,f,g){var A=e?e+c:c;if(!this._events[A])return!1;var m=this._events[A],b=arguments.length,V,P;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),b){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,d),!0;case 3:return m.fn.call(m.context,d,h),!0;case 4:return m.fn.call(m.context,d,h,y),!0;case 5:return m.fn.call(m.context,d,h,y,f),!0;case 6:return m.fn.call(m.context,d,h,y,f,g),!0}for(P=1,V=new Array(b-1);P<b;P++)V[P-1]=arguments[P];m.fn.apply(m.context,V)}else{var Vt=m.length,W;for(P=0;P<Vt;P++)switch(m[P].once&&this.removeListener(c,m[P].fn,void 0,!0),b){case 1:m[P].fn.call(m[P].context);break;case 2:m[P].fn.call(m[P].context,d);break;case 3:m[P].fn.call(m[P].context,d,h);break;case 4:m[P].fn.call(m[P].context,d,h,y);break;default:if(!V)for(W=1,V=new Array(b-1);W<b;W++)V[W-1]=arguments[W];m[P].fn.apply(m[P].context,V)}}return!0},r.prototype.on=function(c,d,h){return n(this,c,d,h,!1)},r.prototype.once=function(c,d,h){return n(this,c,d,h,!0)},r.prototype.removeListener=function(c,d,h,y){var f=e?e+c:c;if(!this._events[f])return this;if(!d)return i(this,f),this;var g=this._events[f];if(g.fn)g.fn===d&&(!y||g.once)&&(!h||g.context===h)&&i(this,f);else{for(var A=0,m=[],b=g.length;A<b;A++)(g[A].fn!==d||y&&!g[A].once||h&&g[A].context!==h)&&m.push(g[A]);m.length?this._events[f]=m.length===1?m[0]:m:i(this,f)}return this},r.prototype.removeAllListeners=function(c){var d;return c?(d=e?e+c:c,this._events[d]&&i(this,d)):(this._events=new s,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=e,r.EventEmitter=r,l.exports=r})(es);var Ga=es.exports;const Fa=Bt(Ga),oe=new Fa,$a={names:[],history:[]};class Va extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"enableLog",!1);u(this,"muteEvents",[])}init(){const{storage:e}=this.game;e.addStorage("event",$a)}enableLogEvent(){this.enableLog=!0}on(e,s){this.validateCallback(s),this.addEventName(e),this.addHistory(e,"on","listening"),oe.on(e,s)}once(e,s){this.validateCallback(s),this.addEventName(e),this.addHistory(e,"once","listening"),oe.once(e,s)}catchUp(e,s){if(this.validateCallback(s),this.once(e,s),!(this.getEventEmitCount(e)>0))return;const{payload:n}=this.getLastEventInfo(e)??{};this.emit(e,n)}off(e,s){this.validateCallback(s),oe.off(e,s),this.addHistory(e,"action","removed")}mute(e){this.muteEvents.indexOf(e)>-1||this.muteEvents.push(e)}clear(e){oe.removeAllListeners(e),this.addHistory(e,"action","removed")}emit(e,s){if(this.muteEvents.indexOf(e)>-1)return;let a=[];s&&(a=[s]),this.addHistory(e,"action","called",s),oe.emit(e,...a)}validateCallback(e){if(typeof e!="function")throw new Error("Callback must be a function")}addEventName(e){const{storage:s}=this.game,a=s.getStorageData("event","names");a.indexOf(e)<0&&a.push(e)}getEventListeners(){const e=oe.eventNames();return Object.keys(e)}getHistory(){const{storage:e}=this.game;return e.getStorageData("event","history")}getEventEmitCount(e){return this.getHistory().filter(a=>a.name===e&&a.status==="called").length}getLastEventInfo(e){const s=this.getHistory();let a=null;for(let n=s.length-1;n>=0;n--)if(s[n].name===e){a=s[n];break}return a}getTypeFromHistory(e){const s=this.getLastEventInfo(e);return(s==null?void 0:s.type)??null}getCallsFromHistory(e){const s=this.getLastEventInfo(e);return(s==null?void 0:s.called)??0}addHistory(e,s,a,n){const r=this.getTypeFromHistory(e)??s,o=this.getCallsFromHistory(e),c=a==="called"?o+1:o;this.getHistory().push({type:r,status:a,name:e,called:c,payload:n??{}}),this.logEventInfo(e,r,a,c)}logEventInfo(e,s,a,n){this.enableLog&&(a==="listening"&&oe.listenerCount(e),a==="called"&&oe.listenerCount(e))}}const pt={},ft=Object.freeze(Object.defineProperty({__proto__:null,default:pt},Symbol.toStringTag,{value:"Module"})),ka='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',{Configs:Ua,Utils:Ba}=p,{Object:gt}=Ba,{Enabled:Ha,WideframeConfigs:mt}=Ua.FrameCapture,ja=async l=>{if(!Ha)return null;const t=Wa(l);if(!t)return null;Ka(t,mt.ResultChallenge);const{frameCapture:e}=window.game,{Width:s,Height:a}=mt.ResultChallenge;return e.captureAsync({name:"ResultChallenge",width:s,height:a,renderOptions:t})},Ka=(l,t)=>{const{Width:e,Height:s,Wideframe:a}=t;l.wideframe={name:"result-challenge",type:"image",depth:0,image:a,size:[e,s],position:[0,0]}},Wa=l=>{try{const{playerId:t="10",playerPhoto:e="",playerScore:s=0,opponentId:a="20",opponentPhoto:n="",opponentScore:i=0,isPlayerFinished:r,isOpponentFinished:o}=l,{RenderOptions:c}=mt.ResultChallenge,d=gt.clone(c);if(!d)return null;const h=gt.clear(d),y=gt.camelCaseKeys(h),{playerPhoto:f,opponentPhoto:g}=y,A=s===i,m=s>i,b=r??o,V=r&&o;return f.type==="image"&&(f.name=`${t}`,f.image=e),g.type==="image"&&(g.name=`${a}`,g.image=n),b&&za(y,{playerScore:s,opponentScore:i,isPlayerFinished:r,isOpponentFinished:o}),!V||A?(delete y.leftCrown,delete y.rightCrown,y):(m?delete y.rightCrown:delete y.leftCrown,y)}catch{return null}},za=(l,t)=>{const{leftScore:e,rightScore:s}=l,{playerScore:a=0,opponentScore:n=0,isPlayerFinished:i,isOpponentFinished:r}=t;(e==null?void 0:e.type)==="text"&&(e.text=i?`${a}`:"???"),(s==null?void 0:s.type)==="text"&&(s.text=r?`${n}`:"???")},{Configs:qa,Utils:Ja}=p,{Object:wt}=Ja,{Enabled:Ya,WideframeConfigs:At}=qa.FrameCapture,Qa=async l=>{if(!Ya)return null;const t=Za(l);if(!t)return null;Xa(t,At.ShareLeaderboard);const{frameCapture:e}=window.game,{Width:s,Height:a}=At.ShareLeaderboard;return e.captureAsync({name:"ShareLeaderboard",width:s,height:a,renderOptions:t})},Xa=(l,t)=>{const{Width:e,Height:s,Wideframe:a}=t;l.wideframe={name:"share-leaderboard",type:"image",depth:0,image:a,size:[e,s],position:[0,0]}},Za=l=>{try{const{playerId:t,playerPhoto:e,leaders:s}=l,{RenderOptions:a}=At.ShareLeaderboard,n=wt.clone(a);if(!n)return null;const i=wt.clear(n),r=wt.camelCaseKeys(i),{avatar:o}=r;return o.type==="image"&&(o.name=`${t}`,o.image=e),en(r,s),r}catch{return null}},en=(l,t)=>{const e="600 48px";t.forEach((s,a)=>{const{id:n,name:i,photo:r,score:o}=s;let c=1294+180*a;l[`photo_${n}`]={depth:-1,name:n,type:"image",image:r,size:[96,96],position:[436,c]},c=1360+180*a,l[`name_${n}`]={font:e,depth:1,name:n,type:"text",text:i,position:[600,c]},l[`score_${n}`]={font:e,depth:1,name:n,type:"text",text:`${o}`,position:[100,c]}})},{Configs:tn,Utils:sn}=p,{Object:It}=sn,{Enabled:an,WideframeConfigs:Dt}=tn.FrameCapture,nn=async l=>{if(!an)return null;const t=on(l);if(!t)return null;rn(t,Dt.ShareScore);const{frameCapture:e}=window.game,{Width:s,Height:a}=Dt.ShareScore;return e.captureAsync({name:"ShareScore",width:s,height:a,renderOptions:t})},rn=(l,t)=>{const{Width:e,Height:s,Wideframe:a}=t;l.wideframe={name:"share-score",type:"image",depth:0,image:a,size:[e,s],position:[0,0]}},on=l=>{try{const{playerId:t,playerPhoto:e,playerScore:s}=l,{RenderOptions:a}=Dt.ShareScore,n=It.clone(a);if(!n)return null;const i=It.clear(n),r=It.camelCaseKeys(i),{avatar:o,playerScore:c}=r;return o.type==="image"&&(o.name=`${t}`,o.image=e),c.type==="text"&&(c.text=`${s}`),r}catch{return null}},{Configs:cn,Utils:ln}=p,{Image:Ue,Object:Ne,Valid:Be}=ln,{Options:Pt}=cn.FrameCapture;class dn extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"width");u(this,"height");u(this,"canvas",null);u(this,"testRenderOptions",null);u(this,"caches",{});u(this,"wideframe",{})}init(){this.addWideframeRender("renderShareScore",nn),this.addWideframeRender("renderResultChallenge",ja),this.addWideframeRender("renderShareLeaderboard",Qa)}async preloadAsync(e){const{renderOptions:s}=e;await this.loadImages(s)}async captureAsync(e){const{width:s,height:a,renderOptions:n}=e;return await this.loadImages(n),this.width=s,this.height=a,this.createCanvas(),this.drawObjects(n),this.snapshotFrameAsync()}addWideframeRender(e,s){this.wideframe[e]=s}setTestRenderOptions(e){if(!e){this.testRenderOptions=null;return}const s=Ne.camelCaseKeys(e);this.testRenderOptions=Ne.merge(this.testRenderOptions,s)}createCanvas(){if(this.canvas){const e=this.canvas.getContext("2d");e?e.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}async loadImages(e){const s=Ne.vals(e).filter(r=>r.type==="image"),a=this.prepareLoadImages(s),n=Ne.vals(a);if(n.length<1)return;const i=await Promise.all(n);this.cacheImages(a,i)}prepareLoadImages(e){const s={};for(const a of e){const{name:n,image:i,fallbackImage:r}=a,o=this.caches[n];!Be.isString(i)||o||(i===""&&Be.isString(r)&&(a.image=r),s[n]=new Promise(c=>{Ue.loadImage(i).then(h=>{c(h)}).catch(()=>{Be.isString(r)?(a.image=r,Ue.loadImage(a.image).then(h=>{c(h)}).catch(()=>{c(null)})):c(null)})}))}return s}cacheImages(e,s){for(const a in e){const n=s.shift();n&&(this.caches[a]=n)}}drawObjects(e){const s=Ne.vals(e).sort((a,n)=>a.depth-n.depth);for(const a of s)switch(a.type){case"text":this.drawText(a);break;case"image":this.drawImage(a);break}}drawText(e){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{position:a,font:n,text:i,color:r,lineWidth:o,textAlign:c}=e;s.font=`${n} ${ka}`,s.fillStyle=r??"#ffffff",o&&(s.lineWidth=o),c&&(s.textAlign=c);const[d,h]=a;s.fillText(i,d,h)}drawImage(e){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{name:a,size:n,position:i,fallbackImage:r}=e;let o=this.caches[a];if(!o&&r&&(o=this.caches[r]),!o)throw new Error(`Image ${a} not found`);const[c,d]=i,[h,y]=n;s.drawImage(o,c,d,h,y)}async snapshotFrameAsync(){if(!this.canvas)return null;let e=null;if(Pt.UseBlobIfPossible&&"toBlob"in this.canvas?e=await this.createAsBlob():e=this.createAsDataImage(),!e)throw new Error("Image data is null");return Be.isDebugger()&&Ue.logImage(e),e}createAsDataImage(){if(!this.canvas)return null;const e=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!e)return null;const{Quality:s,RenderType:a}=Pt;return e.canvas.toDataURL(`image/${a}`,s)}createAsBlob(){return new Promise(e=>{if(!this.canvas){e(null);return}const{Quality:s,RenderType:a}=Pt;this.canvas.toBlob(n=>{if(!n){e(null);return}Ue.blobToDataImage(n).then(i=>{e(i)})},`image/${a}`,s)})}}class ts extends Error{constructor(e,s){const a=String(e);super(`Text with key "${a}" not found in locale "${s}"`);u(this,"key");u(this,"locale");this.name="MissingKeyInLocaleError",this.key=a,this.locale=s}}class hn extends Error{constructor(e){super(`Locale "${e}" not found`);u(this,"locale");this.name="LocaleNotFoundError",this.locale=e}}const{Utils:{Object:St,Function:ss}}=p;class un extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"locale");u(this,"fallbackLocale");u(this,"data",{})}setFallbackLocale(e){this.fallbackLocale=e}hasTextKey(e,s){const a=s??this.getCurrentLocale(),{text:n}=this.getLocaleData(a);return St.hasOwn(n,e)}hasTextureKey(e,s){const a=s??this.getCurrentLocale(),{texture:n}=this.getLocaleData(a);return St.hasOwn(n,e)}add(e,s,a=!1){this.data[e]=s,a&&this.setFallbackLocale(e)}choose(e){this.locale=e;const{event:s}=this.game;s.emit(p.Events.LANGUAGE_CHANGED,{locale:e})}getText(e,s,a,n=!1){try{return this.uncaughtGetText(e,s,a,!n)}catch{return String(e)}}getTexture(e,s,a=!1){return this.uncaughtGetTexture(e,s,!a)}uncaughtGetText(e,s=[],a,n=!0){if(!n||this.fallbackLocale===void 0){const o=this.getRawText(e,a??this.getCurrentLocale());return this.replaceVariables(o,s)}const i=this.fallbackLocale,r=ss.retry(()=>this.getRawText(e,a??this.getCurrentLocale()),()=>this.getRawText(e,i));return this.replaceVariables(r,s)}getRawText(e,s){if(!this.hasTextKey(e,s))throw new ts(e,s);const{text:a}=this.getLocaleData(s);return a[e]}uncaughtGetTexture(e,s,a=!0){if(!a||this.fallbackLocale===void 0)return this.getRawTexture(e,s??this.getCurrentLocale());const n=this.fallbackLocale;return ss.retry(()=>this.getRawTexture(e,s??this.getCurrentLocale()),()=>this.getRawTexture(e,n))}getRawTexture(e,s){if(!this.hasTextureKey(e,s))throw new ts(e,s);const{texture:a}=this.getLocaleData(s);return a[e]}getCurrentLocale(){return this.locale??"en"}getLocaleData(e){const s=e??this.getCurrentLocale();if(!St.hasOwn(this.data,s))throw new hn(s);return this.data[s]}replaceVariables(e,s){const a=s.length;if(a===0)return e;let n=e;for(let i=0;i<a;i++){const r=s[i],o=`%{${i}}`;n=n.replace(o,r)}return n}}const yn=ue("D",{_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15,amountPlayer:15}),{Configs:pn,Utils:fn}=p,{Object:Le,String:as,Valid:ns}=fn,{OtherHost:Te,Mockup:Me,AppId:gn}=pn;class mn{constructor(){u(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const t=(await ne(async()=>{const{default:e}=await C.import("./bundle/LeaderboardAPIMock.js");return{default:e}},void 0,C.meta.url)).default;if(typeof t!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new t}async getLeadersAsync(t,e,s){const a=as.params(s);let n;return Me.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in s?n=await this.mockAPI.getPlayers(t,s):n=await this.mockAPI.getLeaders(t,s)):n=await fe(`${e}?${a}`,{},Te),!Le.hasOwn(n,"data")||!Array.isArray(n.data)?[]:n.data}async getLeaderboardAsync(t){let e;const s=`leaderboards/${t}`;return Me.Leaderboards.Enabled?(await this.initMockAPI(),e=await this.mockAPI.getLeaderboardAsync(t)):(e=await fe(s,{},Te),Le.hasOwn(e,"data")&&ns.isObject(e.data)&&(e=e.data)),e}async getLeaderboardsAsync(t){let e;const s=p.Utils.String.params(t);return Me.Leaderboards.Enabled?(await this.initMockAPI(),e=await this.mockAPI.getLeaderboardsAsync(t)):(e=await fe(`leaderboards?${s}`,{},Te),Le.hasOwn(e,"data")&&Array.isArray(e.data)?e=e.data:e=[]),e}async setLeaderboardScoreAsync(t){const{leaderboardId:e,playerId:s,score:a}=t;Me.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(e,s,a)):await G(`leaderboards/${e}/players/${s}`,{score:a},{},Te)}async createLeaderboardAsync(t){const e=t._id??as.generateObjectId(),s=t.numberOfLeaders,a={...yn,...t,_id:e,appId:gn,numberOfLeaders:s},n="leaderboards";let i;if(Me.Leaderboards.Enabled?(await this.initMockAPI(),i=await this.mockAPI.createLeaderboard(a)):(i=await G(n,a,{},Te),Le.hasOwn(i,"data")&&ns.isObject(i.data)&&(i=i.data)),!Le.hasOwn(i,"_id")||i._id!==e)throw new Error("Create leaderboard failed");return e}}const is={limit:0,offset:0,leaders:{},isRequesting:!1,amountPlayer:0},wn={leaderboards:{}},{Array:An,Valid:In,Json:rs,Object:He}=p.Utils;class Dn extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"lbAPI",new mn);u(this,"configs")}init(){const{storage:e}=this.game;e.addStorage("leaderboard",wn),this.configs={}}addLeaderboard(e){const{name:s,type:a,leaderboardId:n,autoSortRank:i}=e;if(this.getLeaderboard(s))return;let o=`leaderboards/${n}/`;(a==="global"||a==="tournament")&&(o+="leaders"),a==="friends"&&(o+="players"),this.configs[s]={id:n,name:s,type:a,host:o,autoSortRank:i};const c=rs.clone(is);this.setLeaderboard(s,{...c})}async requestLeaderboardsAsync(e){try{return await this.lbAPI.getLeaderboardsAsync(e)}catch{return[]}}async requestLeaderboardAsync(e,s){try{this.validateLeaderboard(e),this.clearLeaderboard(e),this.setLeaderboard(e,{isRequesting:!0});const{id:a,type:n,host:i}=this.configs[e];let r=[];if(n==="friends"){const{player:o}=this.game,c=o.getPlayerId(),d=o.getConnectedPlayerIds(s,0),h=[c,...d];this.configs[e].playerIds=[...h],r=await this.lbAPI.getLeadersAsync(a,i,{playerIds:h})}else r=await this.lbAPI.getLeadersAsync(a,i,{limit:s,offset:0});if(r.length===0)return;await this.receiveLeaderboardAsync(e,r),this.setLeaderboard(e,{limit:s,offset:0})}finally{const a=await this.lbAPI.getLeaderboardAsync(this.configs[e].id),n=a?a.resettable:"",i=a?a.amountPlayer:0;this.setLeaderboard(e,{isRequesting:!1,resettable:n,amountPlayer:i})}}async loadMoreLeaderboardAsync(e,s){const a=this.getLeaderboard(e);if(a&&this.configs[e].type!=="friends")try{this.setLeaderboard(e,{isRequesting:!0});const{id:n,host:i}=this.configs[e],{offset:r,limit:o}=a,c=r+o,d=await this.lbAPI.getLeadersAsync(n,i,{limit:s,offset:c});if(d.length===0)return;this.receiveLeaderboardAsync(e,d),this.setLeaderboard(e,{limit:s,offset:c})}finally{this.setLeaderboard(e,{isRequesting:!1})}}getLeaderboard(e){const{storage:s}=this.game,a=s.getStorageData("leaderboard","leaderboards");return a[e]?a[e]:null}async getLeadersByPlayerIdsAsync(e,s){try{this.validateLeaderboard(e);const{id:a}=this.configs[e],n=`leaderboards/${a}/players`,i=await this.lbAPI.getLeadersAsync(a,n,{playerIds:s});return i.length===0?[]:this.toLeaders(i)}catch{return[]}}async getLeaderboardResponseAsync(e){return await this.lbAPI.getLeaderboardAsync(e)}clearLeaderboard(e){try{this.validateLeaderboard(e);const s=rs.clone(is);this.setLeaderboard(e,null),this.setLeaderboard(e,{...s})}catch{}}isLeaderboardEmpty(e){const s=this.getLeaderboard(e);if(!s)return!0;const{leaders:a}=s;return Object.keys(a).length===0}isExistLeaderboardId(e){const{configs:s}=this;return He.vals(s).some(a=>a.id===e)}getLeaderboardName(e){const{configs:s}=this,a=An.search(He.vals(s),n=>n.id===e);return a?a.name:null}async setLeaderboardScoreAsync(e,s,a){try{this.validateLeaderboard(e);const{id:n}=this.configs[e],i=await this.getLastScoreOnLeaderboard(e,s);if(i&&a<=i)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:n,playerId:s,score:a})}catch{}}async getLastScoreOnLeaderboard(e,s){const a=await this.getLeadersByPlayerIdsAsync(e,[s]);return a.length===0?null:a[0].score}async createLeaderboardAsync(e){return this.lbAPI.createLeaderboardAsync(e)}validateLeaderboard(e){const s=this.getLeaderboard(e);if(!In.isObject(s))throw new Error(`Leaderboard with name ${e} not found`)}setLeaderboard(e,s){const{storage:a}=this.game;a.setStorageData("leaderboard","leaderboards",{[e]:s})}async receiveLeaderboardAsync(e,s){this.validateLeaderboard(e);const n=(await this.toLeaders(s)).filter(h=>h.name&&h.photo),{offset:i=0,leaders:r={}}=this.getLeaderboard(e)??{},o=n.filter(h=>!r[h.playerId]);if(i>0&&o.length>0){const h=He.vals(r);o.unshift(...h)}let c=o.sort((h,y)=>y.score-h.score);this.configs[e].autoSortRank&&(c=c.map((h,y)=>({...h,rank:y+1})));const d=He.keyBy(c,"playerId");this.setLeaderboard(e,{leaders:d})}async toLeaders(e){const{profile:s}=this.game,a=e.map(o=>o.playerId);await s.requestProfiles(a);const n=s.getProfiles();return e.map(o=>{const{playerId:c}=o,d=n[c];return d?{...o,name:d.name,photo:d.photo}:{...o,name:"Nameless",photo:"default"}}).map(o=>({...o,score:Number.parseInt(o.score,10)}))}}class Pn{constructor(){u(this,"APIHost")}setAPIHost(t){this.APIHost=t}getAPIHost(){return this.APIHost}}const{Utils:os}=p;class Sn extends Pn{async createSingleMatchAsync(t){const s=await G("single-matches",t,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const e=await fe("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(e)}async updateSingleMatchMoveAsync(t,e){const s=`single-matches/${t}/move`,a=await G(s,e,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishSingleMatchAsync(t){const e=`single-matches/${t}/finish`,s=await G(e,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createEndlessMatchAsync(t){const s=await G("endless-matches",t,{},this.getAPIHost());return this.returnValidMatchData(s)}async getEndlessMatchDetailAsync(){const e=await fe("endless-matches/active",{},this.getAPIHost());return this.returnValidMatchData(e)}async updateEndlessMatchMilestoneAsync(t,e){const s=`endless-matches/${t}/milestone`,a=await G(s,e,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishEndlessMatchAsync(t){const e=`endless-matches/${t}/finish`,s=await G(e,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(t){const s=await G("matches",t,{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(t){const e=`matches/${t}/join`,s=await G(e,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(t){const e=`matches/${t}`,s=await fe(e,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(t){const{matchId:e="",score:s=0,level:a=0,extraData:n={}}=t,i=`matches/${e}/finish`,r=await G(i,{matchId:e,score:s,level:a,extraData:n},{},this.getAPIHost());return this.returnValidMatchData(r)}returnValidMatchData(t){let e={};return!os.Valid.isObject(t)||!os.Object.hasOwn(t,"data")||(e=t.data),e}}class En{constructor(t){u(this,"matchAPI");this.createAPI(),this.setAPIConfig(t)}createAPI(){this.matchAPI=new Sn}setAPIConfig(t){t.matchAPIHost&&this.matchAPI.setAPIHost(t.matchAPIHost)}setMatchAPIInstance(t){this.matchAPI=t}getMatchAPI(){return this.matchAPI}}class E{constructor(t,e){u(this,"game");u(this,"match");this.game=t,this.match=e}startLog(t){}endLog(){}async processAsync(t){throw new Error("Not implemented")}}class cs extends Q{constructor(t){super(t),this.name="LevelNotDefined",this.message=t??"Level is not defined"}}class Et extends Q{constructor(t){super(t),this.name="MatchModeNotDefined",this.message=t??"Match id is not defined"}}const{Object:Eo,Valid:xn}=p.Utils;class w{constructor(t){u(this,"game");u(this,"match");u(this,"nextHandler");this.game=t.game,this.match=t.match,this.nextHandler=null}setNext(t){return this.nextHandler=t,t}async processAsync(t){this.logData("Before",t)}async nextAsync(t){this.logData("After",t),this.nextHandler&&await this.nextHandler.processAsync(t)}logData(t,e){xn.isDebugger()}}const{Plugins:vn,Utils:Cn}=p,{Analytics:bn}=vn,{String:ls,Valid:ds}=Cn;class j extends w{async processAsync(t){super.processAsync(t);const{mode:e,customData:s}=t,{level:a}=s;this.validateMode(e),this.validateLevel(a);const{analytics:n}=this.game;n.event(bn.Events.MATCH_START,{level:a,game_mode:ls.toUpperCamelCase(e),level_name:this.getLevelName(a)}),await this.nextAsync(t)}validateMode(t){if(!ds.isString(t))throw new Et}validateLevel(t){if(!ds.isNumber(t))throw new cs}getLevelName(t){return`Level ${ls.padStart(t.toString(),5,"0")}`}}const $={OPEN:"open",ACTIVE:"active",FINISHED:"finished"};class T extends w{async processAsync(t){super.processAsync(t);const{mode:e,status:s}=t;let a=e??me.SINGLE;s===$.FINISHED&&(a=me.SINGLE),this.contextGameModeDetected(a),await this.nextAsync(t)}contextGameModeDetected(t){const{storage:e}=this.game;e.setStorageData("context","contextGameMode",t)}}class xt extends Error{constructor(t){super(t),this.name="GetMatchDetailFailed",this.message=t??"Get match detail failed"}}class hs extends Error{constructor(t){super(t),this.name="MatchAreNotActive",this.message=t??"Match are not active"}}class X extends Q{constructor(t){super(t),this.name="MatchIdNotValid",this.message=t??"Match id is not valid"}}class Nn extends Error{constructor(t){super(t),this.name="OpponentHasFinishedMatch",this.message=t||"Opponent has finished match"}}class U extends Q{constructor(t){super(t),this.name="OpponentIdNotValid",this.message=t??"Opponent id is not valid"}}class vt extends Error{constructor(t){super(t),this.name="PlayerNotCurrentInMatch",this.message=t??"The player is not currently in this match"}}class us extends Error{constructor(t){super(t),this.name="PlayerNotFinishedMatch",this.message=t||"Player not finished match"}}const{Dtos:Ln}=p;class Tn extends w{async processAsync(t){super.processAsync(t),this.validateMatchData(t);const e=await this.getMatchAsync(t),s=new Ln.Match.Data(e).toObject();this.validateAwaitMatchData(t,s),this.updateMatchData(t,s),this.validateMatchStatus(t),this.validatePlayerTurn(t),this.validateOpponentTurn(t),await this.nextAsync(t)}validateMatchData(t){const{id:e}=t;if(typeof e!="string")throw new X}validateMatchStatus(t){const{status:e}=t;if(e!==$.ACTIVE)throw new hs}validateAwaitMatchData(t,e){const{id:s,customData:a}=t,{_id:n,whitePlayerId:i,blackPlayerId:r}=e;if(typeof n!="string"||n!==s)throw new xt;const{playerId:o}=a,c=i===o,d=r===o;if(!c&&r===Y.playerId)throw new ht;if(!c&&!d)throw new vt}validatePlayerTurn(t){const{profiles:e,customData:s}=t,{playerId:a}=s;if(typeof a!="string")throw new S;const{finished:n}=e[a];if(!n)throw new us}validateOpponentTurn(t){const{profiles:e,customData:s}=t,{opponentId:a}=s;if(typeof a!="string")throw new U;const{finished:n}=e[a];if(n)throw new Nn}async getMatchAsync(t){const{id:e}=t;return e?this.match.api.getMatchAPI().getMatchDetailByIdAsync(e):{}}updateMatchData(t,e){const{customData:s}=t,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:o,blackPlayerFinish:c,status:d}=e;t.status=d;const h=a===s.playerId,y=h?a:n,f=h?n:a;t.customData.playerId=y,t.customData.opponentId=f,t.profiles[y]||(t.profiles[y]={id:y,name:"",photo:"",finished:!1}),t.profiles[f]||(t.profiles[f]={id:f,name:"",photo:"",finished:!1});const g=h?i:r,A=h?r:i;t.profiles[y].score=g,t.profiles[f].score=A;const m=h?o:c,b=h?c:o;t.profiles[y].finished=m,t.profiles[f].finished=b}}const Ct={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null};class B extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),this.initializeMatch(e),await this.nextAsync(e)}initializeMatch(e){const{id:s,mode:a,customData:n}=this.payload;e.id=s??null,e.mode=a||null,e.status=$.OPEN,e.startAt=0,e.finishAt=0,e.profiles={},e.customData={...Ct,...e.customData,...n}}}const we=re;class x extends Error{constructor(t){super(t),this.name="UnavailableFeature",this.message=`Unavailable feature: ${t}`}}class z extends Q{constructor(t){super(t),this.name="ContextIdNotValid",this.message=t??"Context id is not valid"}}class Mn extends w{async processAsync(t){super.processAsync(t),this.validateData(t);const e=await this.createWideframesAwaitingAsync(t);e&&this.sendMessageAsync(t,e),await this.nextAsync(t)}validateData(t){const{id:e,customData:s}=t,{contextId:a,opponentId:n}=s;if(!e||typeof e!="string")throw new X;if(!a||typeof a!="string")throw new z;if(!n||typeof n!="string")throw new U}async createWideframesAwaitingAsync(t){try{const{frameCapture:e}=this.game,{profiles:s,customData:a}=t,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:c,score:d=0,finished:h}=r;if(!h)return null;const{photo:y,score:f=0,finished:g}=o;return g?null:await e.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:f,isPlayerFinished:!0,isOpponentFinished:!1})}catch{return null}}async sendMessageAsync(t,e){const{id:s,profiles:a,customData:n}=t,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new S;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:o}=a[i],c={data:{type:we.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${o} đang chờ bạn kết thúc trận đấu. Chơi ngay!`}},image:e,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(c)}}class N extends w{async processAsync(t){await this.nextAsync(t)}async nextAsync(t){this.nextHandler&&await this.nextHandler.processAsync(t)}}class K extends Q{constructor(t){super(t),this.name="ProfileNotFound",this.message=t??"Profile not found"}}const{Dtos:_n}=p;class ce extends w{async processAsync(t){super.processAsync(t),this.validateData(t);const{customData:e}=t,{playerId:s,opponentId:a}=e;let n=s;const i=await this.getProfile(n);if(!i)throw new K;if(this.updateMatchProfile(t,n,i),n=a,n!==Y.playerId){const r=await this.getProfile(n);if(!r)throw new K;this.updateMatchProfile(t,n,r)}else this.updateMatchProfile(t,n);await this.nextAsync(t)}validateData(t){const{customData:e}=t,{playerId:s,opponentId:a}=e;if(!s||typeof s!="string")throw new S;if(!a||typeof a!="string")throw new U}async getProfile(t){const{profile:e}=this.game;return await e.requestProfiles([t]),e.getProfiles()[t]}updateMatchProfile(t,e,s){const{name:a,photo:n}=s??Y,i=new _n.Match.Profile({id:e,name:a,photo:n}).toObject();t.profiles[e]?(t.profiles[e].name=i.name,t.profiles[e].photo=i.photo):t.profiles[e]=i}}class On extends E{async processAsync(t){try{this.startLog(t);const{matchId:e,playerId:s,opponentId:a}=t,n=new N(this),i=new B(this,{id:e,mode:O.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const r=new Tn(this);i.setNext(r);const o=new ce(this);r.setNext(o);const c=new Mn(this);o.setNext(c);const d=new j(this);c.setNext(d);const h=new T(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}}class bt extends Q{constructor(t){super(t),this.name="CreateContextFailed",this.message=t??"Create context failed"}}const{Valid:ys,Object:ps}=p.Utils;class Rn extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e);const{opponentId:s}=this.payload,a=await this.createAsync(s);e.customData.contextId=a,await this.nextAsync(e)}async createAsync(e){try{await GameSDK.context.createAsync(e)}catch(a){this.validateError(a)}const s=GameSDK.context.getID();if(!ys.isString(s))throw new bt;return s}validateError(e){if(!ps.hasOwn(e,"code"))throw e;if(e.code!=="SAME_CONTEXT"){if(e.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(e))throw e;return}throw e}}validateErrorMessage(e){if(!ps.hasOwn(e,"message")||!ys.isString(e.message))throw e}isNotConnectedPlayerError(e){return this.validateErrorMessage(e),e.message.indexOf("is not a connected player of the current player")>-1}}class je extends Q{constructor(t){super(t),this.name="MatchAreNotOpen",this.message=t??"Match are not open"}}const{Dtos:Gn}=p;class fs extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),this.validateData(e);const s=await this.createMatchAsync(e),a=new Gn.Match.Data(s).toObject();this.updateMatchState(e,a),await this.nextAsync(e)}validateData(e){const{status:s,customData:a}=e,{opponentId:n}=a;if(typeof n!="string")throw new U;if(s!==$.OPEN)throw new je}async createMatchAsync(e){const{opponentId:s}=e.customData,{extraData:a}=this.payload;if(!s)return{};const n={opponentPlayerId:s,extraData:a};return this.match.api.getMatchAPI().createMatchAsync(n)}updateMatchState(e,s){const{customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:r,whitePlayerFinish:o,blackPlayerFinish:c}=s,d=i===a.opponentId;e.id=n||null;const h=d?r:i,y=d?i:r;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const f=d?c:o,g=d?o:c;e.profiles[h].finished=f,e.profiles[y].finished=g}}class q extends w{async processAsync(t){if(super.processAsync(t),t.status!==$.OPEN)throw new je;this.startMatch(t),await this.nextAsync(t)}startMatch(t){t.status=$.ACTIVE,t.startAt=Date.now()}}class gs extends w{async processAsync(t){super.processAsync(t),this.validateData(t);const e=await this.createWideframesChallengeAsync(t);e&&this.sendMessageAsync(t,e),await this.nextAsync(t)}validateData(t){const{id:e,customData:s}=t,{contextId:a,opponentId:n}=s;if(!e||typeof e!="string")throw new X;if(!a||typeof a!="string")throw new z;if(!n||typeof n!="string")throw new U}async createWideframesChallengeAsync(t){try{const{frameCapture:e}=this.game,{profiles:s,customData:a}=t,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:c,score:d=0}=r,{photo:h,score:y=0}=o;return await e.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!1,isOpponentFinished:!1})}catch{return null}}async sendMessageAsync(t,e){const{id:s,profiles:a,customData:n}=t,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new S;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:o}=a[i],c={data:{type:we.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} challenges you`,localizations:{vi_VN:`${o} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(c)}}class Fn extends E{async processAsync(t){try{this.startLog(t);const{playerId:e,opponentId:s}=t,a=new N(this),n=new Rn(this,{opponentId:s});a.setNext(n);const i=new B(this,{mode:O.CHALLENGE_FRIEND,customData:{playerId:e,opponentId:s}});n.setNext(i);const r=new fs(this,{extraData:t.extraData});i.setNext(r);const o=new ce(this);r.setNext(o);const c=new q(this);o.setNext(c);const d=new j(this);c.setNext(d);const h=new gs(this);d.setNext(h);const y=new T(this);h.setNext(y);const f=this.match.getMatchState();await a.processAsync(f)}finally{this.endLog()}}}class Nt extends Error{constructor(t){super(t),this.name="SameContext",this.message=t??"Same context"}}const{Utils:ms}=p;class Ke extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e);const{contextId:s}=this.payload;await this.switchAsync(s),e.customData.contextId=s,await this.nextAsync(e)}checkSameContext(e){const s=e==="SOLO",a=GameSDK.context.getID();if(a===e)throw new Nt;if(s&&a===null)throw new Nt}async switchAsync(e){const s=e==="SOLO";try{this.checkSameContext(e),await GameSDK.context.switchAsync(e,s)}catch(a){if(a instanceof Nt)return;if(!ms.Object.hasOwn(a,"code"))throw a;if(ms.Device.isAndroid()&&s&&a.code==="INVALID_PARAM")return;if(a.code!=="SAME_CONTEXT")throw a}}}const{Dtos:$n}=p;class Vn extends w{async processAsync(t){super.processAsync(t),this.validateMatchData(t);const e=await this.getMatchAsync(t),s=new $n.Match.Data(e).toObject();this.validateContinueMatchData(t,s),this.updateMatchData(t,s),this.validatePlayerTurn(t),await this.nextAsync(t)}validateMatchData(t){const{id:e,status:s}=t;if(typeof e!="string")throw new X;if(s!==$.OPEN)throw new je}validateContinueMatchData(t,e){const{id:s,customData:a}=t,{_id:n,whitePlayerId:i,blackPlayerId:r}=e;if(typeof n!="string"||n!==s)throw new xt;const{playerId:o}=a,c=i===o,d=r===o;if(!c&&r===Y.playerId)throw new ht;if(!c&&!d)throw new vt}validatePlayerTurn(t){const{profiles:e,customData:s}=t,{playerId:a}=s;if(typeof a!="string")throw new S;const{finished:n}=e[a];if(n)throw new Jt}async getMatchAsync(t){const{id:e}=t;return e?this.match.api.getMatchAPI().getMatchDetailByIdAsync(e):{}}updateMatchData(t,e){const{customData:s}=t,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:o,blackPlayerFinish:c}=e,d=a===s.playerId,h=d?a:n,y=d?n:a;t.customData.playerId=h,t.customData.opponentId=y,t.profiles[h]||(t.profiles[h]={id:h,name:"",photo:"",finished:!1}),t.profiles[y]||(t.profiles[y]={id:y,name:"",photo:"",finished:!1});const f=d?i:r,g=d?r:i;t.profiles[h].score=f,t.profiles[y].score=g;const A=d?o:c,m=d?c:o;t.profiles[h].finished=A,t.profiles[y].finished=m}}class kn extends w{async processAsync(t){super.processAsync(t),this.validateData(t);const e=await this.createWideframesCurrentScoreAsync();e&&this.sendMessageAsync(t,e),await this.nextAsync(t)}validateData(t){const{id:e,customData:s}=t,{contextId:a,opponentId:n}=s;if(!e||typeof e!="string")throw new X;if(!a||typeof a!="string")throw new z;if(!n||typeof n!="string")throw new U}async createWideframesCurrentScoreAsync(){try{const{player:t,frameCapture:e}=this.game,{playerId:s,photo:a}=t.getPlayer(),{profiles:n}=this.match.getMatchState(),{score:i=0}=n[s]||{};return await e.wideframe.renderShareScore({playerId:s,playerPhoto:a,playerScore:i})}catch{return null}}async sendMessageAsync(t,e){const{id:s,profiles:a,customData:n}=t,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new S;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:o}=a[i],c={data:{type:we.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} made an update.`,localizations:{vi_VN:`${o} đã cập nhật trận đấu. Chơi ngay!`}},image:e,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(c)}}class Un extends E{async processAsync(t){try{this.startLog(t);const{contextId:e,matchId:s,playerId:a,opponentId:n}=t,i=new N(this),r=new Ke(this,{contextId:e});i.setNext(r);const o=new B(this,{id:s,mode:O.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:n}});r.setNext(o);const c=new Vn(this);o.setNext(c);const d=new ce(this);c.setNext(d);const h=new q(this);d.setNext(h);const y=new kn(this);h.setNext(y);const f=new j(this);y.setNext(f);const g=new T(this);f.setNext(g);const A=this.match.getMatchState();await i.processAsync(A)}finally{this.endLog()}}}const{Plugins:Bn,Utils:Hn}=p,{Analytics:jn}=Bn,{String:ws,Valid:As}=Hn;class _e extends w{async processAsync(t){super.processAsync(t);const{customData:e,mode:s,startAt:a,finishAt:n}=t,{level:i}=e;this.validateMode(s),this.validateLevel(i);const{analytics:r}=this.game,o=Math.floor((n-a)/1e3);r.event(jn.Events.MATCH_END,{level:i,game_mode:ws.toUpperCamelCase(s),level_name:this.getLevelName(i),time_played:o}),await this.nextAsync(t)}validateMode(t){if(!As.isString(t))throw new Et}validateLevel(t){if(!As.isNumber(t))throw new cs}getLevelName(t){return`Level ${ws.padStart(t.toString(),5,"0")}`}}class We extends Error{constructor(t){super(t),this.name="ScoreNotValid",this.message=t??"Score is not valid"}}class Oe extends Error{constructor(t){super(t),this.name="LeaderboardIdNotValid",this.message=t??"Leaderboard id is not valid"}}class Kn extends Error{constructor(t){super(t),this.name="LeaderboardNotExist",this.message=t??"Leaderboard not exist in game"}}const{Valid:Is}=p.Utils;class ze extends w{constructor(e,s){super(e);u(this,"payload");u(this,"leaderboardPayload");this.payload=s}async processAsync(e){super.processAsync(e),this.setupSetScorePayload(e),this.setLeaderboardScoreAsync(),await this.nextAsync(e)}async setupSetScorePayload(e){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||!s[n])throw new K;const{score:i,leaderboardId:r}=this.payload;if(!Is.isNumber(i))throw new We;if(!Is.isString(r))throw new Oe;this.leaderboardPayload={score:i,playerId:n,leaderboardId:r}}async setLeaderboardScoreAsync(){try{const{playerId:e,score:s,leaderboardId:a}=this.leaderboardPayload,n=this.game.leaderboard.getLeaderboardName(a);if(!n)throw new Kn;await this.game.leaderboard.setLeaderboardScoreAsync(n,e,s)}catch{}}}const{Valid:Wn}=p.Utils,{Leaderboards:zn}=p.Configs;class Lt extends ze{constructor(t){const{player:e}=globalThis.game,s=e.getBestScore();super(t,{score:s,leaderboardId:zn.LeaderboardId}),"submitGameResultsAsync"in GameSDK.extra&&GameSDK.extra.submitGameResultsAsync(s)}async setupSetScorePayload(t){const{profiles:e,customData:s}=t,{playerId:a}=s;if(!a||!e[a])throw new K;const{score:n}=e[a];if(!Wn.isNumber(n))throw new We;this.payload.score=n,super.setupSetScorePayload(t)}}const{Dtos:qn,Utils:Jn}=p,{Valid:qe,Object:Yn}=Jn;class Re extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),this.validateMatchData(e);const{useAPI:s}=this.payload;if(s){const a=await this.finishMatchAsync(e),n=new qn.Match.Data(a).toObject();this.updateMatchFromAPI(e,n)}else this.updateMatchData(e);this.updateMatchState(e),await this.nextAsync(e)}validateMatchData(e){const{status:s,profiles:a,customData:n}=e;if(s!==$.ACTIVE)throw new hs;const{playerId:i}=n;if(!i||!Yn.hasOwn(a,i))throw new vt}updateMatchData(e){const{playerId:s}=e.customData;if(!qe.isString(s))throw new S;e.profiles[s].finished=!0}updateMatchState(e){e.status=$.FINISHED,e.finishAt=Date.now()}async finishMatchAsync(e){const{id:s,profiles:a,customData:n}=e,{level:i,playerId:r}=n;if(!qe.isString(r))throw new S;const{score:o}=a[r],{extraData:c}=this.payload,d={matchId:s??"",score:o,level:i,extraData:c};return this.match.api.getMatchAPI().finishMatchAsync(d)}updateMatchFromAPI(e,s){const{playerId:a,opponentId:n}=e.customData;if(!qe.isString(a))throw new S;if(!qe.isString(n))throw new U;const{whitePlayerId:i,whitePlayerScore:r,blackPlayerScore:o,whitePlayerFinish:c,blackPlayerFinish:d}=s,h=a===i,y=h?r:o,f=h?o:r,g=h?c:d,A=h?d:c;e.profiles[a].score=y,e.profiles[n].score=f,e.profiles[a].finished=g,e.profiles[n].finished=A}}class Qn extends w{async processAsync(t){super.processAsync(t),this.validateData(t);const e=await this.createWideframesResultAsync(t);e&&this.progressSendFinishedMessage(t,e),await this.nextAsync(t)}validateData(t){const{id:e,customData:s}=t,{contextId:a,opponentId:n}=s;if(!e||typeof e!="string")throw new X;if(!a||typeof a!="string")throw new z;if(!n||typeof n!="string")throw new U}async createWideframesResultAsync(t){try{const{frameCapture:e}=this.game,{profiles:s,customData:a}=t,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:c,score:d=0,finished:h}=r,{photo:y,score:f=0,finished:g}=o;return await e.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:f,isPlayerFinished:!!h,isOpponentFinished:!!g})}catch{return null}}progressSendFinishedMessage(t,e){const{profiles:s,customData:a}=t,{playerId:n,opponentId:i}=a;if(!n||typeof n!="string")throw new S;if(!i||typeof i!="string")throw new U;const{score:r=0,finished:o}=s[n],{score:c=0,finished:d}=s[i];o?this.sendFinishMessageAsync(t,e):d&&r>c?this.sendBestScoreMessageAsync(t,e):this.sendPlayTurnMessageAsync(t,e)}async sendFinishMessageAsync(t,e){const{id:s,profiles:a,customData:n}=t,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new S;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:o}=a[i],c={data:{type:we.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:$.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${o} just finished. Check them now.`,localizations:{vi_VN:`${o} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(c)}async sendPlayTurnMessageAsync(t,e){const{id:s,profiles:a,customData:n}=t,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new S;const{name:o,score:c}=a[i],d={data:{type:we.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:$.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} got ${c} scores. So easy! Can you?`,localizations:{vi_VN:`${o} đã đạt ${c} điểm! Nhấn Chơi để so tài!`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(d)}async sendBestScoreMessageAsync(t,e){const{id:s,profiles:a,customData:n}=t,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new S;const{name:o,score:c}=a[i],d={data:{type:we.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r,status:$.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${o} beat your high score. Their score: ${c}`,localizations:{vi_VN:`${o} đã vượt qua điểm số của bạn, với ${c} điểm!`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(d)}}class Je extends w{async processAsync(t){super.processAsync(t),this.setPlayerBestScore(t),await this.nextAsync(t)}setPlayerBestScore(t){const{profiles:e,customData:s}=t,{playerId:a}=s;if(!a||!e[a])throw new K;const{player:n}=this.game,i=n.getBestScore()||0,{score:r=0}=e[a];r<=i||(n.setBestScore(r),e[a].bestScore=r)}}class Xn extends E{async processAsync(t){try{this.startLog(t);const{extraData:e}=t??{},s=new N(this),a=new Re(this,{useAPI:!0,extraData:e});s.setNext(a);const n=new Qn(this);a.setNext(n);const i=new _e(this);n.setNext(i);const r=new Je(this);i.setNext(r);const o=new Lt(this);r.setNext(o);const c=new T(this);o.setNext(c);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}class Zn extends Error{constructor(t){super(t),this.name="ContextAreSolo",this.message=t??"Context are solo"}}class ei extends Error{constructor(t){super(t),this.name="ContextNotChallenge",this.message=t??"Context is not a challenge"}}class ti extends Error{constructor(t){super(t),this.name="NetworkFailure",this.message=t??"Network failure"}}const{Utils:si,Dtos:ai}=p,{Array:ni,Object:ii}=si;class Ds extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();e.customData.opponentId=s,await this.nextAsync(e)}checkCurrentContext(){const e=GameSDK.context.getID();if(typeof e!="string")throw new z;if(e==="SOLO")throw new Zn}async getOpponentIdFromContextAsync(){const{ignoreId:e}=this.payload,s=await this.getContextPlayers([e]);if(s.length>1)throw new ei;let a=Y;return s.length===1&&(a=s[0]),a.playerId}async getContextPlayers(e){try{const s=await GameSDK.context.getPlayersAsync(),a=[];for(const n of s){const i=n.getID();if(e.indexOf(i)>-1)continue;const r=n.getName();if(!r)continue;const o=n.getPhoto();a.push(new ai.Player.Info({playerId:i,name:r,photo:o}).toObject())}return ni.unique(a)}catch(s){if(ii.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new ti;return[]}}}class Tt extends Error{constructor(t){super(t),this.name="ContextIsTournament",this.message=t??"Context is a tournament"}}const{Object:ri}=p.Utils;class oi extends w{async processAsync(t){super.processAsync(t);const e=await this.chooseAsync();await this.checkContextTournament(),t.customData.contextId=e,await this.nextAsync(t)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(e){if(!ri.hasOwn(e,"code")||e.code!=="SAME_CONTEXT")throw e}const t=GameSDK.context.getID();if(typeof t!="string")throw new bt;return t}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new Tt):new x("getTournamentAsync")}catch(t){if(t instanceof Tt)throw t}}}class ci extends E{async processAsync(t){try{this.startLog(t);const{playerId:e}=t,s=new N(this),a=new oi(this);s.setNext(a);const n=new B(this,{mode:O.CHALLENGE_FRIEND,customData:{playerId:e}});a.setNext(n);const i=new Ds(this,{ignoreId:e});n.setNext(i);const r=new fs(this,{extraData:t.extraData});i.setNext(r);const o=new ce(this);r.setNext(o);const c=new q(this);o.setNext(c);const d=new j(this);c.setNext(d);const h=new gs(this);d.setNext(h);const y=new T(this);h.setNext(y);const f=this.match.getMatchState();await s.processAsync(f)}finally{this.endLog()}}}class li extends Error{constructor(t){super(t),this.name="JoinMatchFailed",this.message=t??"Join match failed"}}class di extends Error{constructor(t){super(t),this.name="MatchAreFinished",this.message=t??"Match are finished"}}class hi extends Error{constructor(t){super(t),this.name="OtherPlayerHasJoinedMatch",this.message=t??"Other player has joined match"}}const{Dtos:ui}=p;class yi extends w{async processAsync(t){super.processAsync(t),this.validateMatchData(t);const e=await this.joinMatchAsync(t),s=new ui.Match.Data(e).toObject();this.validateJoinMatchData(t,s),this.updateMatchData(t,s),await this.nextAsync(t)}validateMatchData(t){const{status:e}=t;if(e!==$.OPEN)throw new je}validateJoinMatchData(t,e){const{id:s,customData:a}=t,{_id:n,blackPlayerId:i,whitePlayerId:r,whitePlayerFinish:o,blackPlayerFinish:c}=e,d=i===a.playerId,h=r===a.opponentId;if(typeof n!="string"||n!==s||!h)throw new li;if(o&&c)throw new di;if(!d)throw new hi}async joinMatchAsync(t){const{id:e}=t;return e?this.match.api.getMatchAPI().joinMatchAsync(e):{}}updateMatchData(t,e){const{customData:s}=t,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:o,blackPlayerFinish:c}=e,d=a===s.playerId,h=d?a:n,y=d?n:a;t.customData.playerId=h,t.customData.opponentId=y,t.profiles[h]||(t.profiles[h]={id:h,name:"",photo:"",finished:!1}),t.profiles[y]||(t.profiles[y]={id:y,name:"",photo:"",finished:!1});const f=d?i:r,g=d?r:i;t.profiles[h].score=f,t.profiles[y].score=g;const A=d?o:c,m=d?c:o;t.profiles[h].finished=A,t.profiles[y].finished=m}}class pi extends w{async processAsync(t){super.processAsync(t),this.validateData(t);const e=await this.createWideframesAcceptedAsync(t);e&&this.sendMessageAsync(t,e),await this.nextAsync(t)}validateData(t){const{id:e,customData:s}=t,{contextId:a,opponentId:n}=s;if(!e||typeof e!="string")throw new X;if(!a||typeof a!="string")throw new z;if(!n||typeof n!="string")throw new U}async createWideframesAcceptedAsync(t){try{const{frameCapture:e}=this.game,{profiles:s,customData:a}=t,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:c,score:d=0,finished:h}=r;if(h)return null;const{photo:y,score:f=0,finished:g}=o;return g?await e.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:f,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch{return null}}async sendMessageAsync(t,e){const{id:s,profiles:a,customData:n}=t,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new S;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:o}=a[i],c={data:{type:we.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${o} accepted the challenge.`,localizations:{vi_VN:`${o} đã chấp nhận tham gia trận đấu.`}},image:e,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(c)}}class fi extends E{async processAsync(t){try{this.startLog(t);const{matchId:e,playerId:s,opponentId:a}=t,n=new N(this),i=new B(this,{id:e,mode:O.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const r=new yi(this);i.setNext(r);const o=new ce(this);r.setNext(o);const c=new q(this);o.setNext(c);const d=new pi(this);c.setNext(d);const h=new j(this);d.setNext(h);const y=new T(this);h.setNext(y);const f=this.match.getMatchState();await n.processAsync(f)}finally{this.endLog()}}}const Ps={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},{Valid:Z}=p.Utils,ee="is invalid";class Mt extends R{setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateId(t){(!Z.isString(t)||!t)&&this.exception("_id",ee)}validateStatus(t){(!Z.isString(t)||!t)&&this.exception("status",ee)}validateWinnerId(t){t!==null&&(!Z.isString(t)||!t)&&this.exception("winnerId",ee)}validateWhitePlayerId(t){(!Z.isString(t)||!t)&&this.exception("whitePlayerId",ee)}validateBlackPlayerId(t){(!Z.isString(t)||!t)&&this.exception("blackPlayerId",ee)}validateWhitePlayerScore(t){Z.isNumber(t)||this.exception("whitePlayerScore",ee)}validateBlackPlayerScore(t){Z.isNumber(t)||this.exception("blackPlayerScore",ee)}validateWhitePlayerFinish(t){Z.isBoolean(t)||this.exception("whitePlayerFinish",ee)}validateBlackPlayerFinish(t){Z.isBoolean(t)||this.exception("blackPlayerFinish",ee)}toObject(){return super.toObject()}static getDefaultData(){return Ps}}Mt.addDefaultData(Ps);class gi extends Error{constructor(t){super(t),this.name="MatchAreNotFinished",this.message=t||"Match are not finished"}}class mi extends Error{constructor(t){super(t),this.name="OpponentNotFinishedMatch",this.message=t||"Opponent not finished match"}}class wi extends w{async processAsync(t){super.processAsync(t),this.validateMatchData(t);const e=await this.getMatchAsync(t),s=new Mt(e).toObject();this.validateResultMatchData(t,s),this.updateMatchData(t,s),this.validatePlayerTurn(t),this.validateOpponentTurn(t),await this.nextAsync(t)}validateMatchData(t){const{id:e}=t;if(typeof e!="string")throw new X}validateResultMatchData(t,e){const{id:s}=t,{_id:a,whitePlayerFinish:n,blackPlayerFinish:i}=e;if(typeof a!="string"||a!==s)throw new xt;if(!n&&!i)throw new gi}validatePlayerTurn(t){const{profiles:e,customData:s}=t,{playerId:a}=s;if(typeof a!="string")throw new S;const{finished:n}=e[a];if(!n)throw new us}validateOpponentTurn(t){const{profiles:e,customData:s}=t,{opponentId:a}=s;if(typeof a!="string")throw new U;const{finished:n}=e[a];if(!n)throw new mi}async getMatchAsync(t){const{id:e}=t;return e?this.match.api.getMatchAPI().getMatchDetailByIdAsync(e):{}}updateMatchData(t,e){const{customData:s}=t,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:r,whitePlayerFinish:o,blackPlayerFinish:c}=e,d=a===s.playerId,h=d?a:n,y=d?n:a;t.customData.playerId=h,t.customData.opponentId=y,t.profiles[h]||(t.profiles[h]={id:h,name:"",photo:"",finished:!0}),t.profiles[y]||(t.profiles[y]={id:y,name:"",photo:"",finished:!0});const f=d?i:r,g=d?r:i;t.profiles[h].score=f,t.profiles[y].score=g;const A=d?o:c,m=d?c:o;t.profiles[h].finished=A,t.profiles[y].finished=m}}class Ai extends E{async processAsync(t){try{this.startLog(t);const{matchId:e,playerId:s,opponentId:a}=t,n=new N(this),i=new B(this,{id:e,mode:O.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const r=new wi(this);i.setNext(r);const o=new ce(this);r.setNext(o);const c=new T(this);o.setNext(c);const d=this.match.getMatchState();await n.processAsync(d)}finally{this.endLog()}}}class Ii extends E{constructor(){super(...arguments);u(this,"fallbackSingleMode");u(this,"startFLowChallengeFriend",async e=>{try{return await this.match.challenge.invite.processAsync(e),!0}catch(s){return s}});u(this,"startFlowTournament",async e=>{try{const s=GameSDK.context.getID();if(typeof s!="string")throw new z;await this.match.tournament.continue.processAsync({playerId:e,contextId:s})}catch{await this.startFlowSingle(e)}});u(this,"startFlowSingle",async e=>{this.fallbackSingleMode&&await this.match.single.start.processAsync({playerId:e})})}async processAsync(e){try{this.startLog(e);const{playerId:s,extraData:a,fallbackSingleMode:n}=e;this.fallbackSingleMode=n;const i=await this.startFLowChallengeFriend({playerId:s,extraData:a});if(i===!0)return;i instanceof Tt?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}}const{Valid:Di}=p.Utils,{Leaderboards:Pi}=p.Configs;class Si extends ze{constructor(t){super(t,{score:0,leaderboardId:Pi.LeaderboardEndlessId})}async setupSetScorePayload(t){const{profiles:e,customData:s}=t,{playerId:a}=s;if(!a||!e[a])throw new K;const{endlessScore:n}=e[a];if(!Di.isNumber(n))throw new We;this.payload.score=n,super.setupSetScorePayload(t)}}class Ei extends w{async processAsync(t){super.processAsync(t),this.setPlayerEndlessScore(t),await this.nextAsync(t)}setPlayerEndlessScore(t){const{profiles:e,customData:s}=t,{playerId:a}=s;if(!a||!e[a])throw new K;const{player:n}=this.game,i=n.getBestEndlessScore()??0,{endlessScore:r=0}=e[a],o=i<r?r:i;n.setBestEndlessScore(o),e[a].bestEndlessScore=o}}class xi extends E{async processAsync(){try{this.startLog();const t=new N(this),e=new Re(this,{useAPI:!1});t.setNext(e);const s=new _e(this);e.setNext(s);const a=new Ei(this);s.setNext(a);const n=new Si(this);a.setNext(n);const i=new T(this);n.setNext(i);const r=this.match.getMatchState();await t.processAsync(r)}finally{this.endLog()}}}class vi extends Error{constructor(t){super(t),this.name="ProfileIdNotDefined",this.message=t??"Profile id is not defined"}}const{Dtos:Ci}=p;class Ge extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e);const{profileId:s}=this.payload;if(!s)throw new vi;const{player:a}=this.game,n=a.getPlayerId();let i;if(s===n)i=this.getPlayerProfile();else if(i=await this.getProfileAsync(s),!i)throw new K;this.updateMatchData(i,e),await this.nextAsync(e)}getPlayerProfile(){const{player:e}=this.game,{playerId:s,name:a,photo:n,locale:i}=e.getPlayer();return{playerId:s,name:a,photo:n,locale:i}}async getProfileAsync(e){const{profile:s}=this.game;return await s.requestProfiles([e]),s.getProfiles()[e]}updateMatchData(e,s){const{playerId:a,name:n,photo:i}=e,r=new Ci.Match.Profile({id:a,name:n,photo:i}).toObject();s.profiles[a]=r}}class bi extends E{async processAsync(t){try{this.startLog(t);const{playerId:e}=t,s=new N(this),a=new Ke(this,{contextId:"SOLO"});s.setNext(a);const n=new B(this,{id:"234567",mode:O.ENDLESS,customData:{playerId:e}});a.setNext(n);const i=new q(this);n.setNext(i);const r=new Ge(this,{profileId:e});i.setNext(r);const o=new j(this);r.setNext(o);const c=new T(this);o.setNext(c);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}const{Valid:Ni}=p.Utils;class _t extends ze{constructor(t){super(t,{score:0,leaderboardId:""})}async setupSetScorePayload(t){const{profiles:e,customData:s}=t,{playerId:a,leaderboardId:n}=s;if(!n)throw new Oe;if(!a||!e[a])throw new K;const{score:i}=e[a];if(!Ni.isNumber(i))throw new We;this.payload.score=i,this.payload.leaderboardId=n,super.setupSetScorePayload(t)}}class Li extends w{async processAsync(t){super.processAsync(t),this.validateData(t),this.progressSendGroupMessage(t),await this.nextAsync(t)}validateData(t){const{id:e,customData:s}=t,{contextId:a,opponentId:n}=s;if(!e||typeof e!="string")throw new X;if(!a||typeof a!="string")throw new z;if(!n||typeof n!="string")throw new U}async createWideframesResultGroupAsync(t){try{const{frameCapture:e}=this.game,{profiles:s,customData:a}=t,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const r=s[n],o=s[i],{photo:c,score:d=0}=r,{photo:h,score:y=0}=o;return await e.wideframe.renderResultChallenge({playerId:n,playerPhoto:c,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!0,isOpponentFinished:!0})}catch{return null}}async createWideframesBestScoreAsync(t){try{const{player:e,frameCapture:s}=this.game,{playerId:a}=t.customData,{playerId:n,photo:i,data:r}=e.getPlayer();if(a!==n)return null;const{score:o}=r||{};return await s.wideframe.renderShareScore({playerId:n,playerPhoto:i,playerScore:o})}catch{return null}}async progressSendGroupMessage(t){const{profiles:e,customData:s}=t,{playerId:a,opponentId:n}=s;if(n&&typeof n=="string"){if(!a||typeof a!="string")throw new S;const{score:r=0}=e[a]||{},{score:o=0}=e[n]||{};if(r>o){const c=await this.createWideframesResultGroupAsync(t);if(!c)return;this.sendBestScoreMessageAsync(t,c);return}}const i=await this.createWideframesBestScoreAsync(t);i&&this.sendChallengeMessageAsync(t,i)}async sendBestScoreMessageAsync(t,e){const{profiles:s,customData:a}=t,{playerId:n}=a;if(!n||typeof n!="string")throw new S;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:i,score:r}=s[n],c={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:r},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:`${i} beats your high score. Their score: ${r}.`,localizations:{vi_VN:`${i} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(c)}async sendChallengeMessageAsync(t,e){const{profiles:s,customData:a}=t,{playerId:n}=a;if(!n||typeof n!="string")throw new S;const{name:i,score:r}=s[n],c={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:r},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${i} got ${r} scores. So easy! Can you?`,localizations:{vi_VN:`${i} đã đạt ${r} điểm! Quá dễ luôn. Chơi lại nào!`}},image:e,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(c)}}class Ti extends E{async processAsync(){try{this.startLog();const t=new N(this),e=new Re(this,{useAPI:!1});t.setNext(e);const s=new Li(this);e.setNext(s);const a=new _e(this);s.setNext(a);const n=new Je(this);a.setNext(n);const i=new _t(this);n.setNext(i);const r=new T(this);i.setNext(r);const o=this.match.getMatchState();await t.processAsync(o)}finally{this.endLog()}}}const{Dtos:Mi}=p;class Ye extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),this.updateProfileMatchData(e),await this.nextAsync(e)}updateProfileMatchData(e){const{id:s}=this.payload,{profiles:a}=e;if(!a[s])throw new K;const n={...a[s],...this.payload},i=new Mi.Match.Profile(n).toObject();a[i.id]=i}}class _i extends E{async processAsync(t){try{this.startLog(t);const{playerId:e,opponentId:s,opponentScore:a}=t,n=new N(this),i=new B(this,{id:"7749",mode:O.MATCHING_GROUP,customData:{playerId:e,opponentId:s}});n.setNext(i);const r=new ce(this);i.setNext(r);const o=new Ye(this,{id:e,score:a});r.setNext(o);const c=new q(this);o.setNext(c);const d=new j(this);c.setNext(d);const h=new T(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}}class Ss extends Error{constructor(t){super(t),this.name="MatchGroupNotSupported",this.message=t??"Match group is not supported"}}class Oi extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),await this.checkMatchGroupSupported();const s=await this.matchingGroup();e.customData.contextId=s,await this.nextAsync(e)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new x("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new x("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new Ss;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new Ss}async matchingGroup(){if(!("matchPlayerAsync"in GameSDK.extra))throw new x("matchPlayerAsync");const{matchTag:e,autoSwitch:s=!1,onlyExisting:a=!1}=this.payload;await GameSDK.extra.matchPlayerAsync(e,s,a);const n=GameSDK.context.getID();if(typeof n!="string")throw new bt;return n}}class Ri extends E{async processAsync(t){try{this.startLog(t);const{matchTag:e,playerId:s,options:a}=t,n=new N(this),i=new Oi(this,{matchTag:e,...a});n.setNext(i);const r=new B(this,{id:"7749",mode:O.MATCHING_GROUP,customData:{playerId:s}});i.setNext(r);const o=new Ds(this,{ignoreId:s});r.setNext(o);const c=new q(this);o.setNext(c);const d=new ce(this);c.setNext(d);const h=new j(this);d.setNext(h);const y=new T(this);h.setNext(y);const f=this.match.getMatchState();await n.processAsync(f)}finally{this.endLog()}}}class Gi extends E{async processAsync(){try{this.startLog();const t=new N(this),e=new Re(this,{useAPI:!1});t.setNext(e);const s=new _e(this);e.setNext(s);const a=new Je(this);s.setNext(a);const n=new Lt(this);a.setNext(n);const i=new T(this);n.setNext(i);const r=this.match.getMatchState();await t.processAsync(r)}finally{this.endLog()}}}class Fi extends E{async processAsync(t){try{this.startLog(t);const{playerId:e}=t,s=new N(this),a=new Ke(this,{contextId:"SOLO"});s.setNext(a);const n=new B(this,{id:"123456",mode:O.SINGLE,customData:{playerId:e}});a.setNext(n);const i=new q(this);n.setNext(i);const r=new Ge(this,{profileId:e});i.setNext(r);const o=new j(this);r.setNext(o);const c=new T(this);o.setNext(c);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}const{Plugins:$i,Utils:Vi}=p,{Analytics:ki}=$i,{String:Ui,Valid:Bi}=Vi;class Es extends w{async processAsync(t){super.processAsync(t);const{mode:e,customData:s}=t;this.validateMode(e);const{analytics:a}=this.game,{tournamentId:n,leaderboardId:i}=s;a.event(ki.Events.TOURNAMENT_START,{success:!0,game_mode:Ui.toUpperCamelCase(e),tournament_id:n,leaderboard_id:i}),await this.nextAsync(t)}validateMode(t){if(!Bi.isString(t))throw new Et}}class xs extends Error{constructor(t){super(t),this.name="TournamentIdNotValid",this.message=t??"Tournament id is not valid"}}const{Valid:Ot}=p.Utils;class Hi extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e);const{contextId:s}=this.payload;this.validateContextId(s);const a=await GameSDK.getTournamentAsync(),n=a.getID().toString();this.validateTournamentId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:r}=i;this.validateLeaderboardId(r),e.customData.contextId=s,e.customData.tournamentId=n,e.customData.leaderboardId=r,await this.nextAsync(e)}validateContextId(e){if(!Ot.isString(e))throw new z}validateTournamentId(e){if(!Ot.isString(e))throw new xs}validateLeaderboardId(e){if(!Ot.isString(e)||e==="")throw new Oe}}class ji extends E{async processAsync(t){try{this.startLog(t);const{playerId:e,contextId:s}=t,a=new N(this),n=new Hi(this,{contextId:s});a.setNext(n);const i=new B(this,{id:"1997",mode:O.TOURNAMENT,customData:{playerId:e}});n.setNext(i);const r=new q(this);i.setNext(r);const o=new Ge(this,{profileId:e});r.setNext(o);const c=new j(this);o.setNext(c);const d=new Es(this);c.setNext(d);const h=new T(this);c.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}}const{Plugins:Ki}=p,{Analytics:Wi}=Ki;class zi extends w{async processAsync(t){super.processAsync(t);const{customData:e}=t,{analytics:s}=this.game,{tournamentId:a,leaderboardId:n}=e;s.event(Wi.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:a,leaderboard_id:n}),await this.nextAsync(t)}}class qi extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),await this.createTournamentAsync(),await this.updateMatchStateAsync(e),await this.nextAsync(e)}async createTournamentAsync(){const{name:e,score:s,customData:a}=this.payload;await GameSDK.tournament.createAsync({initialScore:s,config:{title:e,tournamentTitle:e},data:a})}async updateMatchStateAsync(e){try{if(!("getTournamentAsync"in GameSDK))throw new x("getTournamentAsync");const s=await GameSDK.getTournamentAsync(),a=s.getContextID(),n=s.getID().toString(),{playerId:i}=this.payload;e.customData.playerId=i,e.customData.contextId=a,e.customData.tournamentId=n}catch(s){if(s instanceof x)return}}}const{Valid:vs}=p.Utils;class Ji extends w{constructor(e,s){super(e);u(this,"payload");u(this,"leaderboardPayload");this.payload=s}async processAsync(e){super.processAsync(e),this.validatePayload(),await this.setupCreatePayload(e),await this.createLeaderboardAsync(e),await this.nextAsync(e)}validatePayload(){const{leaderboardId:e}=this.payload;if(!vs.isString(e))throw new Oe}validatePlayerId(e){if(!vs.isString(e))throw new S}async setupCreatePayload(e){const{playerId:s}=e.customData;this.validatePlayerId(s);const{name:a,leaderboardId:n,customData:i}=this.payload;this.leaderboardPayload={_id:n,name:a??"",createdBy:s,description:JSON.stringify(i)}}async createLeaderboardAsync(e){const s=await this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload);e.customData.leaderboardId=s}}class Yi extends E{async processAsync(t){try{this.startLog(t);const{playerId:e,name:s,score:a,leaderboardId:n,payload:i}=t,r=new N(this),o=new Ke(this,{contextId:"SOLO"});r.setNext(o);const c=new qi(this,{name:s,score:a,playerId:e,customData:i});o.setNext(c);const d=new Ge(this,{profileId:e});c.setNext(d);const h=new Ye(this,{id:e,score:a});d.setNext(h);const y=new Ji(this,{name:s,customData:i,leaderboardId:n});h.setNext(y);const f=new _t(this);y.setNext(f);const g=new zi(this);f.setNext(g);const A=this.match.getMatchState();await r.processAsync(A)}finally{this.endLog()}}}const{Analytics:Cs}=p.Plugins,{Valid:Qi}=p.Utils;class Xi extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),this.validateData(e),await this.postScoreTournamentAsync(e),await this.nextAsync(e)}validateData(e){const{profiles:s,customData:a}=e,{playerId:n}=a;if(this.validatePlayerId(n),!s[n])throw new K}validatePlayerId(e){if(!Qi.isString(e))throw new S}getPlayerProfile(e){const{profiles:s,customData:a}=e,{playerId:n}=a;return this.validatePlayerId(n),s[n]}isNewBestScore(e){const s=this.getPlayerProfile(e),{score:a=0,bestScore:n=0}=s;return a>n}async postScoreTournamentAsync(e){const{analytics:s}=window.game,a=this.getPlayerProfile(e),{score:n=0}=a;let i=null,r=!1;const{checkBestScore:o}=this.payload,c=this.isNewBestScore(e);try{if(!("getTournamentAsync"in GameSDK))throw new x("getTournamentAsync");await GameSDK.getTournamentAsync(),!o||c?(i=Cs.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:n})):(i=Cs.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(n)),r=!0}catch{}finally{i&&s.event(i,{success:r})}}}class Zi extends E{async processAsync(t){try{this.startLog(t);const{playerId:e,bestScore:s}=t,a=new N(this),n=new Re(this,{useAPI:!1});a.setNext(n);const i=new Ye(this,{id:e,bestScore:s});n.setNext(i);const r=new Xi(this,{checkBestScore:!1});i.setNext(r);const o=new _e(this);r.setNext(o);const c=new Je(this);o.setNext(c);const d=new _t(this);c.setNext(d);const h=new Lt(this);d.setNext(h);const y=new T(this);h.setNext(y);const f=this.match.getMatchState();await a.processAsync(f)}finally{this.endLog()}}}const{Valid:Rt,Object:er}=p.Utils;class tr extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const a=await GameSDK.getTournamentAsync(),n=a.getContextID();this.validateContextId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:r}=i;this.validateLeaderboardId(r),e.customData.contextId=n,e.customData.tournamentId=s,e.customData.leaderboardId=r,await this.nextAsync(e)}validateTournamentId(e){if(!Rt.isString(e))throw new xs}validateContextId(e){if(!Rt.isString(e))throw new z}validateLeaderboardId(e){if(!Rt.isString(e)||e==="")throw new Oe}async joinTournamentAsync(e){if(!("tournament"in GameSDK))throw new x("tournament");try{await GameSDK.tournament.joinAsync(e)}catch(s){if(!er.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}}class sr extends E{async processAsync(t){try{this.startLog(t);const{playerId:e,tournamentId:s}=t,a=new N(this),n=new tr(this,{tournamentId:s});a.setNext(n);const i=new B(this,{id:"1997",mode:O.TOURNAMENT,customData:{playerId:e}});n.setNext(i);const r=new q(this);i.setNext(r);const o=new Ge(this,{profileId:e});r.setNext(o);const c=new j(this);o.setNext(c);const d=new Es(this);c.setNext(d);const h=new T(this);d.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}}const{Dtos:ar,Utils:nr}=p,{Object:ir}=nr;class rr extends w{constructor(e,s){super(e);u(this,"payload");this.payload=s}async processAsync(e){super.processAsync(e),this.updateMatchCustomData(e),await this.nextAsync(e)}updateMatchCustomData(e){const s=ir.merge(e.customData,this.payload),a=new ar.Match.CustomData(s).toObject();e.customData=a}}const or={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...Ct}},{Configs:bs}=p;class cr extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"base");u(this,"group");u(this,"single");u(this,"endless");u(this,"context");u(this,"challenge");u(this,"tournament");u(this,"api");u(this,"handler");u(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(e){this.useCPUProfile=e}createMatchData(){const{storage:e}=this.game;e.addStorage("match",or)}getMatchState(){const{storage:e}=this.game;return e.getStorage("match")}createBaseConcrete(){this.base=new E(this.game,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:async e=>{const s=new Ye(this.base,e);await this.processHandlerAsync(s)},setMatchCustomData:async e=>{const s=new rr(this.base,e);await this.processHandlerAsync(s)},setLeaderboardScore:async e=>{const s=new ze(this.base,e);await this.processHandlerAsync(s)}}}createAPIHandler(){const e={appId:bs.AppId,matchAPIHost:bs.ApiHost};this.api=new En(e)}createGroupFlows(){this.group={join:new _i(this.game,this),start:new Ri(this.game,this),finish:new Ti(this.game,this)}}createSingleFlows(){this.single={start:new Fi(this.game,this),finish:new Gi(this.game,this)}}createEndlessFlows(){this.endless={start:new bi(this.game,this),finish:new xi(this.game,this)}}createContextFlows(){this.context={choose:new Ii(this.game,this)}}createChallengeFlows(){this.challenge={invite:new ci(this.game,this),friend:new Fn(this.game,this),join:new fi(this.game,this),await:new On(this.game,this),result:new Ai(this.game,this),finish:new Xn(this.game,this),continue:new Un(this.game,this)}}createTournamentFlows(){this.tournament={join:new sr(this.game,this),create:new Yi(this.game,this),finish:new Zi(this.game,this),continue:new ji(this.game,this)}}processHandlerAsync(e){const s=this.getMatchState();return e.processAsync(s)}}const{Valid:Ae}=p.Utils,Ie="is invalid";class Ns extends R{setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateLevel(t){(!Ae.isNumber(t)||t<0)&&this.exception("level",Ie)}validateRescued(t){(!Ae.isNumber(t)||t<0)&&this.exception("rescued",Ie)}validateContextId(t){Ae.isString(t)||this.exception("contextId",Ie)}validatePlayerId(t){Ae.isString(t)||this.exception("playerId",Ie)}validateOpponentId(t){Ae.isString(t)||this.exception("opponentId",Ie)}validateTournamentId(t){Ae.isString(t)||this.exception("tournamentId",Ie)}validateLeaderboardId(t){Ae.isString(t)||this.exception("leaderboardId",Ie)}toObject(){return super.toObject()}static getDefaultData(){return R.getDefaultData()}}Ns.addDefaultData(Ct);const{Valid:le}=p.Utils,de="is invalid";class Ls extends R{setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateId(t){(!le.isString(t)||!t)&&this.exception("id",de)}validateName(t){(!le.isString(t)||!t)&&this.exception("name",de)}validatePhoto(t){le.isString(t)||this.exception("photo",de)}validateScore(t){(!le.isNumber(t)||t<0)&&this.exception("score",de)}validateBestScore(t){(!le.isNumber(t)||t<0)&&this.exception("bestScore",de)}validateEndlessScore(t){(!le.isNumber(t)||t<0)&&this.exception("endlessScore",de)}validateBestEndlessScore(t){(!le.isNumber(t)||t<0)&&this.exception("bestEndlessScore",de)}validateFinished(t){le.isBoolean(t)||this.exception("finished",de)}toObject(){return super.toObject()}static getDefaultData(){return R.getDefaultData()}}Ls.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0}),p.Dtos.Match={Data:Mt,CustomData:Ns,Profile:Ls};const{Utils:lr}=p,{ApiHost:dr}=p.Configs,hr=async l=>{let t="players";GameSDK.getSDKName()==="MsGames"&&(t="players?platform=ms-games");const e=await G(t,l,{},dr,10);return lr.Object.hasOwn(e,"data")?e.data||{}:{}},{Utils:ur,Configs:yr}=p,{AppId:pr}=yr,{Array:fr,Object:Qe,Valid:gr}=ur;class mr extends L.Plugins.BasePlugin{init(){const{storage:t}=this.game;t.addStorage("player",pe)}async saveToCloud(){try{const t=this.getPlayerData();await GameSDK.player.setDataAsync(t)}catch{}}receiveData(t,e){const{storage:s}=this.game,{playerId:a,name:n,photo:i,locale:r}=t;s.setStorageData("player","playerId",a),s.setStorageData("player","name",n),s.setStorageData("player","photo",i),s.setStorageData("player","locale",r),e&&this.setPlayerData(e)}async syncProfileToServer(){const{storage:t}=this.game,e=this.getPlayer(),{playerId:s,name:a,photo:n,locale:i}=e;let r=this.getPlayerASID();!gr.isString(r)&&"getASIDAsync"in GameSDK.player&&(r=await GameSDK.player.getASIDAsync()??r,t.setStorageData("player","ASID",`${r}`)),await hr({appId:pr,ASID:r,playerId:s,name:a,photo:n,locale:i})}setPlayerDataByName(t,e){this.setPlayerData({[t]:e})}setPlayerData(t){const{storage:e}=this.game;e.setStorageData("player","data",t),this.saveToCloud()}setBestScore(t){this.setPlayerDataByName("score",t)}setBestEndlessScore(t){this.setPlayerDataByName("endlessScore",t)}setSetting(t,e){this.setPlayerDataByName("settings",{[t]:e})}setGameData(t){const e=this.getGameData()??{},s=Qe.merge(e,t);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:t}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(i=>{const r=i.getID(),o=i.getName(),c=i.getPhoto();return!r||!o||!c?null:new $e({playerId:r,name:o,photo:c}).toObject()}),a=fr.unique(s);if(a.length<1)return;const n=Qe.keyBy(a,"playerId");t.setStorageData("player","connectedPlayers",n)}getPlayer(){const{storage:t}=this.game;return t.getStorage("player")}getPlayerId(){const{storage:t}=this.game;return t.getStorageData("player","playerId")}getPlayerASID(){const{storage:t}=this.game;return t.getStorageData("player","ASID")}getPlayerLocale(){const{storage:t}=this.game;return t.getStorageData("player","locale")}getPlayerData(){const{storage:t}=this.game;return t.getStorageData("player","data")}getPlayerDataByKey(t){const e=this.getPlayerData();return Qe.hasOwn(e,t)?e[t]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(t){const e=this.getPlayerSettings();return Qe.hasOwn(e,t)?e[t]:null}getPlayerSettings(){const{settings:t}=this.getPlayerData();return t}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??pe.data.isFirstLogin}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:t}=this.getPlayerData();return t}getBestEndlessScore(){const{endlessScore:t}=this.getPlayerData();return t}getConnectedPlayers(){const{storage:t}=this.game;return t.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(t,e){const s=this.getConnectedPlayers();return Object.keys(s).slice(e,e+t)}getNotificationData(){return this.getPlayerDataByKey("notificationData")??pe.data.notificationData}}const{Dtos:Ts,Utils:wr}=p,{Valid:te}=wr,{score:Ms,endlessScore:Ar,settings:Ir,gameData:Dr,isFirstLogin:Pr,dailyRewarded:Sr,notificationData:Er}=pe.data,se="is invalid";class _s extends R{processData(t){this.validateStructure(t),t.settings=new Ts.Player.Settings(t.settings).toObject(),t.gameData=new Ts.Player.GameData(t.gameData).toObject(),this.validateData(t),this.setupData(t)}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateScore(t){(!te.isNumber(t)||t<0)&&this.exception("score",se)}validateEndlessScore(t){(!te.isNumber(t)||Ms<0)&&this.exception("endlessScore",se)}validateSettings(t){te.isObject(t)||this.exception("settings",se)}validateNotificationData(t){te.isObject(t)||this.exception("notificationData",se),(!("lastSent"in t)||!te.isNumber(t.lastSent))&&this.exception("notificationData.lastSent",se),(!("currentId"in t)||!te.isNumber(t.currentId))&&this.exception("notificationData.currentId",se)}validateGameData(t){te.isObject(t)||this.exception("gameData",se)}validateIsFirstLogin(t){te.isBoolean(t)||this.exception("isFirstLogin",se)}validateDailyRewarded(t){te.isObject(t)||this.exception("dailyRewarded",se)}toObject(){return super.toObject()}}_s.addDefaultData({score:Ms,endlessScore:Ar,settings:Ir,gameData:Dr,isFirstLogin:Pr,dailyRewarded:Sr,notificationData:Er});const{Valid:Os}=p.Utils,{level:xr,coins:vr}=pe.data.gameData;class Rs extends R{setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateLevel(t){(!Os.isNumber(t)||t<0)&&this.exception("level","is invalid")}validateCoins(t){(!Os.isNumber(t)||t<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}}Rs.addDefaultData({level:xr,coins:vr});const{Valid:Xe}=p.Utils,{sound:Cr,music:br,vibrate:Nr,language:Lr}=pe.data.settings,Ze="is invalid";class Gs extends R{setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateSound(t){Xe.isBoolean(t)||this.exception("sound",Ze)}validateMusic(t){Xe.isBoolean(t)||this.exception("music",Ze)}validateVibrate(t){Xe.isBoolean(t)||this.exception("vibrate",Ze)}validateLanguage(t){(!Xe.isString(t)||!t)&&this.exception("language",Ze)}toObject(){return super.toObject()}}Gs.addDefaultData({sound:Cr,music:br,vibrate:Nr,language:Lr}),p.Dtos.Player={Info:$e,Data:_s,Settings:Gs,GameData:Rs};const{Configs:Tr,Utils:Mr}=p,{Object:_r,String:Or}=Mr,{ApiHost:Rr,Mockup:Gr}=Tr;class Fr{constructor(){u(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const t=(await ne(async()=>{const{default:e}=await C.import("./bundle/ProfileAPIMock.js");return{default:e}},void 0,C.meta.url)).default;if(typeof t!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new t}async getPlayersAsync(t){const e=Or.params(t);let s;return Gr.Profile.Enabled?(await this.initMockAPI(),s=await this.mockAPI.getPlayersAsync(t)):s=await fe(`players?${e}`,{},Rr),!_r.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data}}const $r={profiles:{},profileIds:[]},{Utils:Vr,Dtos:kr}=p,{Array:Fs,Valid:Ur,Object:Br,Function:Hr}=Vr;class jr extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"profileAPI",new Fr)}init(){const{storage:e}=this.game;e.addStorage("profile",$r)}async requestProfiles(e){const s=this.getProfileIds(),a=Fs.difference(e,s);if(a.length<1)return;const i=Fs.chunk(a,400).map(d=>this.profileAPI.getPlayersAsync({playerIds:d})),o=(await Hr.allSettled(i)).reduce((d,h)=>h.status==="fulfilled"?d.concat(h.value):d,[]);if(!this.validateProfilesResponse(o))return;const c=this.convertToProfiles(o);this.setProfiles(c)}getProfile(e){return this.getProfiles()[e]??null}getProfiles(){const{storage:e}=this.game;return e.getStorageData("profile","profiles")}setProfiles(e){const{storage:s}=this.game;s.setStorageData("profile","profiles",e),s.setStorageData("profile","profileIds",Object.keys(e))}getProfileIds(){const{storage:e}=this.game;return e.getStorageData("profile","profileIds")}validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}convertToProfiles(e){const s={};for(const a of e)Br.hasOwn(a,"playerId")&&Ur.isString(a.playerId)&&(s[a.playerId]=new kr.Player.Info(a).toObject());return s}}const $s="Save The Pets",{Utils:{Object:Vs,Valid:ks,Browser:Us}}=p;class Kr extends L.Plugins.BasePlugin{constructor(e){super(e);u(this,"storages");u(this,"storageLocalKeys",{});this.storages={}}async addStorage(e,s,a=!1){this.storages[e]=s,a&&await this.initFromWebStorage(e,s)}async initFromWebStorage(e,s){this.storageLocalKeys[e]=!0;const a=await Us.getIndexedDB(`${$s}_S_${e}`);if(!ks.isObject(a))return;const n=Object.keys(s);for(const i of n)Vs.hasOwn(a,i)&&typeof s[i]==typeof a[i]&&this.setStorageData(e,i,a[i])}setStorageData(e,s,a){let n;if(ks.isObject(a)){const i=this.getStorageData(e,s);n=Vs.merge(i,a)}else n=a;this.storages[e][s]=n}getStorageData(e,s){return this.getStorage(e)[s]}getStorage(e){return this.storages[e]}updateToWebStorage(e){this.storageLocalKeys[e]&&this.saveToWebStorage(e)}saveToWebStorage(e){const s=this.getStorage(e);Us.setIndexedDB(`${$s}_S_${e}`,s)}}class Wr extends L.Plugins.BasePlugin{constructor(){super(...arguments);u(this,"isVisible",!0);u(this,"browserPrefixes",["moz","ms","o","","webkit"]);u(this,"handleVisibilityChange",e=>{if(["focus","blur"].indexOf(e)>-1)return e==="focus"?this.onVisibleEvent():this.onHiddenEvent();const a=this.getBrowserPrefix();return this.getHiddenPropertyName(a)in document?this.onHiddenEvent():this.onVisibleEvent()})}init(){const e=this.getBrowserPrefix(),a=[this.getVisibilityEvent(e),"focus","blur"];for(const n of a)window.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1),document.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1);GameSDK.extra&&"onPause"in GameSDK.extra&&GameSDK.extra.onPause(()=>{this.handleVisibilityChange("blur")})}isGameVisible(){return this.isVisible}getHiddenPropertyName(e){return e?`${e}Hidden`:"hidden"}getVisibilityEvent(e){return`${e||""}visibilitychange`}getBrowserPrefix(){for(const e of this.browserPrefixes)if(this.getHiddenPropertyName(e)in document)return e;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(p.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(p.Events.VISIBILITY_HIDDEN))}}class zr extends qt{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}}const{Status:Bs}=p.Plugins.Ads;class qr extends zr{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.setStatus(Bs.SHOWING)}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.setStatus(Bs.IDLE)}}const{Object:Jr}=p.Utils,{Status:J,Types:De,AdError:Pe,AdInstance:Yr}=p.Plugins.Ads,Se={NOT_LOADED:"not-loaded",LOADING:"loading",LOADED:"loaded",PENDING:"pending"},I=class I extends Yr{constructor(e,s){super(e,s);u(this,"instance");u(this,"adServiceName");this.instance=null,this.adServiceName="google"}static get initStatus(){return I._initStatus}static async initGoogleAdsAsync(e){I.initStatus!=="loaded"&&(I._initStatus=Se.LOADING,I.adsByGoogleConfig=e,I.loadScriptElementAsync(e))}static async configGoogleAdsOnInit(){window.adsbygoogle=window.adsbygoogle||[],window.adBreak=function(e){adsbygoogle.push(e)},window.adConfig=function(e){adsbygoogle.push(e)},I._initStatus=Se.LOADED,I.runPreloadAdConfig()}static async runPreloadAdConfig(){return I.isPreloadingAdConfig=!0,I.preloadPromise=new Promise((e,s)=>{window.adConfig({preloadAdBreaks:"on",onReady:()=>{I.isPreloadConfigReady=!0,I.isPreloadingAdConfig=!1,e()}}),setTimeout(()=>{I.isPreloadConfigReady||s(new Error("Failed to preload ad config in time."))},5e3)}),I.preloadPromise}static loadScriptElementAsync(e){return new Promise((s,a)=>{I.isPreloadingAdConfig=!0;const{dataAdClient:n,dataAdHost:i,dataAdChannel:r,dataAdBreakTest:o,dataAdFrequencyHint:c}=e;if(!n&&!i){I._initStatus=Se.NOT_LOADED,a(new Error("dataAdClient or dataAdHost is required."));return}const d=document.createElement("script");d.async=!0,d.setAttribute("data-ad-frequency-hint",`${c}s`),n&&d.setAttribute("data-ad-client",n),r&&d.setAttribute("data-ad-channel",r),i&&d.setAttribute("data-ad-host",i),o&&d.setAttribute("data-adbreak-test","on");let h="";if(n||i){h="?";const f=[];n&&f.push(`client=${n}`),i&&f.push(`host=${i}`),h+=f.join("&")}d.src=`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js${h}`,d.crossOrigin="anonymous",d.onload=()=>{I.configGoogleAdsOnInit(),s(!0)},d.onerror=()=>{I._initStatus=Se.NOT_LOADED,a(new Error("Failed to load Google Ads script."))};const y=document.createElement("script");y.text="window.adsbygoogle = window.adsbygoogle || []; var adBreak = adConfig = function(o) {adsbygoogle.push(o);}",document.head.appendChild(d),document.head.appendChild(y)})}makeAdInstance(){return{getPlacementID:()=>"",loadAsync:()=>this.preloadAdPlacement(),showAsync:()=>this.createAdPlacement()}}preloadAdPlacement(){return I._initStatus!==Se.LOADED?Promise.reject(new Error("Google Ads not initiated.")):I.isPreloadConfigReady?Promise.resolve():I.preloadPromise?I.preloadPromise:I.runPreloadAdConfig()}createAdPlacement(){switch(this.type){case De.REWARDED_VIDEO:return this.createAdPlacementRewarded();case De.INTERSTITIAL:return this.createAdPlacementInterstitial();default:return Promise.reject(new Pe("UNSUPPORTED_AD_TYPE","Unsupported."))}}createAdPlacementInterstitial(){return new Promise((e,s)=>{window.adBreak({type:"next",name:"interstitialAd",beforeAd:()=>{self.game.ads.hideBannerAdAsync()},adBreakDone:a=>{switch(self.game.ads.showBannerAdAsync(),a.breakStatus){case"dismissed":case"viewed":e();return;default:s(new Pe(a.breakStatus,a.breakType));return}}})})}createAdPlacementRewarded(){return new Promise((e,s)=>{window.adBreak({type:"reward",name:"rewardedAd",beforeReward:a=>{self.game.ads.hideBannerAdAsync(),a()},adViewed:()=>{},adDismissed:()=>{},adBreakDone:a=>{switch(self.game.ads.showBannerAdAsync(),a.breakStatus){case"dismissed":s(new Pe("USER_INPUT","User dismissed."));return;case"viewed":e();return;default:s(new Pe(a.breakStatus,a.breakType));return}}})})}static setGame(e){self.game=e}getStatus(){return this.status}async loadAsync(){if(this.status===J.IDLE)try{if(this.instance=this.makeAdInstance(),this.instance===null)throw new Pe("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.loadAsync(),this.type===De.INTERSTITIAL&&self.game.analytics.loadInterstitialAd({adService:this.adServiceName}),this.type===De.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd({adService:this.adServiceName}),this.setStatus(J.FILLED)}catch(e){throw this.setStatus(J.IDLE),this.isAdTypeValid(this.type)&&self.game.analytics.loadAdFail({type:this.type,adService:this.adServiceName}),e}}async showAsync(){let e=!1;try{if(this.status!==J.FILLED)throw new Pe("AD_NOT_FILLED","Ads no fill.");if(this.setStatus(J.SHOWING),this.instance===null)throw new Pe("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.showAsync(),e=!0,this.setStatus(J.IDLE),this.instance=null}catch(s){throw s instanceof Object&&Jr.hasOwn(s,"code")?(s.code==="noAdPreloaded"?this.setStatus(J.FILLED):(this.setStatus(J.IDLE),this.instance=null),s.code==="USER_INPUT"&&(this.setStatus(J.IDLE),this.instance=null,e=!0)):(this.setStatus(J.IDLE),this.instance=null),s}finally{window.focus(),e?(this.type===De.INTERSTITIAL&&self.game.analytics.showInterstitialAd({adService:this.adServiceName}),this.type===De.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd({adService:this.adServiceName})):this.isAdTypeValid(this.type)&&self.game.analytics.showAdFail({type:this.type,adService:this.adServiceName})}}isAdTypeValid(e){return Object.values(De).includes(e)}};u(I,"_initStatus",Se.NOT_LOADED),u(I,"isPreloadConfigReady",!1),u(I,"isPreloadingAdConfig",!1),u(I,"adsByGoogleConfig"),u(I,"preloadPromise");let he=I;const{Object:Qr}=p.Utils,{Status:H,Types:_,AdError:et,AdInstance:Xr}=p.Plugins.Ads;class Gt extends Xr{constructor(e,s){super(e,s);u(this,"instance");u(this,"interstitialAdInstanceList",[]);u(this,"rewardedVideoAdInstanceList",[]);u(this,"rewardedInterstitialAdInstanceList",[]);this.instance=null}async loadAsync(){if(this.instance&&this.status===H.FILLED)return;if(this.status!==H.IDLE)throw new et("AD_NOT_READY","Ad is not ready.");const e=GameSDK.getSDKName();try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new et("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.setStatus(H.LOADING),await this.instance.loadAsync(),this.setStatus(H.FILLED),this.logAdLoad()}catch(s){throw this.setStatus(H.IDLE),s instanceof Object&&"code"in s&&s.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.pushInstanceToQueue(this.instance),self.game.analytics.loadAdFail({type:this.type,adService:e}),s}}async showAsync(){if(this.status!==H.FILLED)throw new et("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new et("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let e=!1;const s=GameSDK.getSDKName();try{this.setStatus(H.SHOWING),self.game.analytics.showingAd({type:this.type,adService:s}),await this.instance.showAsync(),e=!0,this.setStatus(H.IDLE),this.instance=null}catch(a){throw p.Utils.Object.hasOwn(a,"code")&&(a.code==="AD_NOT_LOADED"&&this.setStatus(H.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf(`${a.code}`)>-1&&(this.setStatus(H.IDLE),this.instance=null),a.code==="USER_INPUT"&&(e=!0)),this.status===H.SHOWING&&(this.setStatus(H.IDLE),this.instance=null),a}finally{e?this.logAdShown():self.game.analytics.showAdFail({type:this.type,adService:s})}}async createInstanceByType(e){try{return await this.getAdInstanceByType(e)}catch(s){return Qr.hasOwn(s,"code")&&s.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed(e):null}}async getAdInstanceByType(e){switch(e){case _.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case _.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);case _.REWARDED_INTERSTITIAL:return await GameSDK.getRewardedInterstitialAsync(this.placementId);default:return null}}getAdInstanceFailed(e){let s=null;switch(e){case _.INTERSTITIAL:s=this.interstitialAdInstanceList;break;case _.REWARDED_VIDEO:s=this.rewardedVideoAdInstanceList;break;case _.REWARDED_INTERSTITIAL:s=this.rewardedInterstitialAdInstanceList;break}if(s===null)return null;if("canBeLoadedAd"in GameSDK.extra){for(const a of s)if(GameSDK.extra.canBeLoadedAd(a))return s.splice(s.indexOf(a),1),a}else return s.shift()||null;return null}logAdLoad(){const e=GameSDK.getSDKName();switch(this.type){case _.INTERSTITIAL:self.game.analytics.loadInterstitialAd({adService:e});break;case _.REWARDED_VIDEO:self.game.analytics.loadRewardedVideoAd({adService:e});break;case _.REWARDED_INTERSTITIAL:self.game.analytics.loadRewardedInterstitialAd({adService:e});break}}logAdShown(){const e=GameSDK.getSDKName();switch(this.type){case _.INTERSTITIAL:self.game.analytics.showInterstitialAd({adService:e});break;case _.REWARDED_VIDEO:self.game.analytics.showRewardedVideoAd({adService:e});break;case _.REWARDED_INTERSTITIAL:self.game.analytics.showRewardedInterstitialAd({adService:e});break}}pushInstanceToQueue(e){let s=null;switch(this.type){case _.INTERSTITIAL:s=this.interstitialAdInstanceList;break;case _.REWARDED_VIDEO:s=this.rewardedVideoAdInstanceList;break;case _.REWARDED_INTERSTITIAL:s=this.rewardedInterstitialAdInstanceList;break}s&&s.push(e)}}const{BaseAnalytics:Zr,Events:Hs}=p.Plugins.Analytics,eo=[Hs.BUTTON_CLICK,Hs.SCREEN_OPEN],{Utils:{Array:to}}=p;class so extends Zr{constructor(e,s){super(e,"FacebookAnalytics",{...s,color:"#0F52BA"});u(this,"prefix");this.prefix=s.prefix}processEvent(e,s){if(!("logEvent"in GameSDK.extra)||to.has(eo,e))return;const a=this.addPrefixToEventName(e);GameSDK.extra.logEvent(a,1,s)}addPrefixToEventName(e){return`${this.prefix}_${e}`}}const{BaseAnalytics:ao,Events:no}=p.Plugins.Analytics,io=[no.SCREEN_OPEN],{Utils:{Array:ro}}=p;class oo extends ao{constructor(t,e){super(t,"FirebaseAnalytics",{...e,color:"#FFCA28"})}setUser(t,e){var s,a;(a=(s=this.game.firebase)==null?void 0:s.services.analytics)==null||a.setUser(t,e)}processEvent(t,e){var s,a;ro.has(io,t)||(a=(s=this.game.firebase)==null?void 0:s.services.analytics)==null||a.event(t,e)}}const{BaseAnalytics:co,Events:Ee}=p.Plugins.Analytics,lo=[Ee.SCREEN_OPEN],{Utils:{Array:ho}}=p;class uo extends co{constructor(t,e){super(t,"GoogleAnalytics",{...e,color:"#E35335"})}processEvent(t,e){ho.has(lo,t)||(this.customEvent(t,e),gtag("event",t,e))}customEvent(t,e){switch(t){case Ee.AD_SHOW:case Ee.AD_SHOW_FAILED:case Ee.AD_SHOWING:case Ee.USE_ITEM:case Ee.EARN_ITEM:this.addLevelName(e);break}}addLevelName(t){if(!t||!(game!=null&&game.match))return;const s=game.match.getMatchState().customData.level;s<0||(t.level_name=this.getLevelName(s))}}const yo="production",Ft="6",{Dtos:po,Events:Fe,Configs:D,Utils:fo}=p,{Object:js,Json:tt,String:Ks,Valid:go,Mark:v}=fo;class mo extends L.Game{constructor(){super(...arguments);u(this,"markName","Core Initialize");u(this,"modulePlugins",[]);u(this,"handleProtectGameInstance",()=>{const e=this.event.getEventEmitCount(ie.MODULE_PLUGIN_READY),s=this.modulePlugins.length;e<s||(window.game=Object.freeze(window.game),Ut(window,"game"))});u(this,"initMonitorErrorPlugin",()=>{if(!this.monitorError)return;const{MonitorError:e,ListPlayerDevIds:s}=D.Debugger,{ApiKey:a,Service:n,Feedback:i,TrackUser:r,FilterErrors:o}=e,c=GameSDK.player.getID(),d=GameSDK.player.getName();c&&s.indexOf(c)>=0||(this.monitorError.configure({apiKey:a,service:n,feedback:i,trackUser:r,releaseStage:yo,buildVersion:`${Ft}`}),this.monitorError.setUser({id:c,name:d}),this.monitorError.addFilterErrors(o),this.monitorError.initFeedbackTrackErrors(),this.updateMonitorErrorUserAndMetadata(),this.processErrorsQueue())});u(this,"updateMonitorErrorUserAndMetadata",()=>{this.event.catchUp(Fe.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded)});u(this,"processErrorsQueue",()=>{if(this.monitorError&&window.__errorQueue){for(const e of window.__errorQueue)if(e instanceof Error)this.monitorError.sendException(e);else{const{message:s,code:a,stack:n}=e||{message:"",code:"Unknown",stack:"Unknown stack"},i=new Error(s||a);i.stack=n,this.monitorError.sendException(i)}window.__errorQueue=null}});u(this,"processWhenPlayerInfoLoaded",()=>{if(!this.monitorError)return;const{playerId:e,name:s}=this.player.getPlayer();this.monitorError.setUser({id:e,name:s}),this.monitorError.addMetadata({isFirstLogin:this.player.isFirstLogin()})});u(this,"handleSaveRemoteConfig",e=>{try{const s={[e.type]:e};this.player.setPlayerDataByName("remoteConfig",s)}catch{}});u(this,"handleUpdateGameCoreConfig",e=>{try{const{id:s,type:a}=e;if(a!=="GameCore")return;p.Configs=js.merge(p.Configs,e.config);const{Ads:n}=p.Configs;this.ads.configure(n),this.event.emit(ie.REMOTE_CONFIG_UPDATED,{id:s,type:a})}catch{}});u(this,"handleStorageCurrentRemoteConfig",()=>{const e=this.player.getPlayerDataByKey("remoteConfig");if(e){for(const s in e)if(js.hasOwn(e,s)){const a=e[s],n=tt.clone(a),i=new po.RemoteConfig.Data(n).toObject();this.remoteConfig.setRemoteConfig(i),this.remoteConfig.processUpdateConfig(i.id,i.type)}}});u(this,"initAdaptivePerformancePlugin",()=>{if(!this.adaptivePerformance)return;const e=tt.clone(D.AdaptivePerformance);this.adaptivePerformance.configure(e)});u(this,"processAfterSyncProfile",()=>{const{Notification:e}=D;e.Enabled&&this.updatePlayerProfileToNotificationService()})}getBuildVersion(){return Number.parseInt(`${Ft}`)||0}async boot(){super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(Fe.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),v.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),v.putAttr(this.markName,"Step","Load Lazy Plugins"),go.isDebugger()||this.event.on(Fe.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),v.putAttr(this.markName,"Step","Load Dev Plugins"),this.addDevPlugins()}async start(){super.start(),v.putAttr(this.markName,"Step","Core Start"),this.event.emit(Fe.CORE_STARTING),v.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),v.putAttr(this.markName,"Step","Init States"),await this.initState(),v.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),v.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();const e=this.storage.getStorageData("context","sessionContextType")||"unknown";v.putAttr(this.markName,"Context Mode",e),v.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initFirebaseAnalytics(),this.initFacebookAnalytics(),v.putAttr(this.markName,"Step","Core Ready"),v.putAttr(this.markName,"Success","true"),v.stop(this.markName),this.event.emit(Fe.CORE_READY)}addPlugins(){this.installPlugin("Storage",Kr),this.installPlugin("Event",Va),this.installPlugin("Ads",ha),this.installPlugin("Auth",Aa),this.installPlugin("Audio",ma),this.installPlugin("Match",cr),this.installPlugin("Player",mr),this.installPlugin("Profile",jr),this.installPlugin("Context",Ca),this.installPlugin("Language",un),this.installPlugin("Analytics",pa),this.installPlugin("Visibility",Wr),this.installPlugin("Leaderboard",Dn),this.installPlugin("DailyRewards",Ra),this.installPlugin("FrameCapture",dn),this.installPlugin("RemoteConfig",pt),"Proxy"in window&&this.installPlugin("Firebase",pt)}installPlugin(e,s,a=!1){const n=Ks.toCamelCase(Ks.capitalize(e));this.plugins.install(e,s,!0,n),e!=="Storage"&&(a?this.emitModulePluginReady(e):this.emitCorePluginReady(e))}async addMonitorPlugin(){var a;(a=window.disableSimpleTrackErrors)==null||a.call(window);const{MonitorError:e}=D.Debugger;if(!e.Enabled)return;this.modulePlugins.push("MonitorError");const s=(await ne(async()=>{const{default:n}=await C.import("./bundle/monitor-error.js").then(i=>i.i);return{default:n}},void 0,C.meta.url)).default;typeof s=="function"&&this.installPlugin("MonitorError",s,!0)}async addAdaptivePerformancePlugin(){const{AdaptivePerformance:e}=D;if(!e.Enabled)return;this.modulePlugins.push("AdaptivePerformance");const s=(await ne(async()=>{const{default:a}=await C.import("./bundle/index.js");return{default:a}},void 0,C.meta.url)).default;typeof s=="function"&&this.installPlugin("AdaptivePerformance",s,!0)}addDevPlugins(){var a;const{ListPlayerDevIds:e}=D.Debugger,s=(a=GameSDK==null?void 0:GameSDK.player)==null?void 0:a.getID();!s||e.indexOf(s)<0||(this.addConsolePlugin(),this.addProfilerPlugin(),this.addCanvasRecorderPlugin())}async addConsolePlugin(){try{const{Console:e}=D.Debugger;if(!e.Enabled)return;this.modulePlugins.push("Console");const s=(await ne(async()=>{const{default:a}=await Promise.resolve().then(()=>ft);return{default:a}},void 0,C.meta.url)).default;if(typeof s!="function")throw new Error("ConsolePlugin is not a function");this.installPlugin("Console",s,!0),this.initConsolePlugin()}catch{}}async addProfilerPlugin(){try{const{Profiler:e}=D.Debugger;if(!e.Enabled)return;this.modulePlugins.push("Profiler");const s=(await ne(async()=>{const{default:a}=await Promise.resolve().then(()=>ft);return{default:a}},void 0,C.meta.url)).default;if(typeof s!="function")throw new Error("ProfilerPlugin is not a function");this.installPlugin("Profiler",s,!0),this.initProfilerPlugin()}catch{}}async addCanvasRecorderPlugin(){try{const{CanvasRecorder:e}=D.Debugger;if(!e.Enabled)return;this.modulePlugins.push("CanvasRecorder");const s=(await ne(async()=>{const{default:a}=await Promise.resolve().then(()=>ft);return{default:a}},void 0,C.meta.url)).default;if(typeof s!="function")throw new Error("CanvasRecorderPlugin is not a function");this.installPlugin("CanvasRecorder",s,!0),this.initCanvasRecorderPlugin()}catch{}}emitCorePluginReady(e){this.event.emit(ie.CORE_PLUGIN_READY,{name:e})}emitModulePluginReady(e){this.event.emit(ie.MODULE_PLUGIN_READY,{name:e})}initEventPlugin(){const{EventLogging:e}=D.Debugger;e.Enabled&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){const{Ads:e}=p.Plugins;this.ads.configure(D.Ads),this.initAdInstance(e,D),this.initFallbackAds()}initAdInstance(e,s){const{AdService:a,InterstitialAdOptions:n,RewardedVideoAdOptions:i,RewardedInterstitialAdOptions:r,BannerDisplayAdOptions:o}=s.Ads;if(a==="google"){this.initGoogleAds();return}if(a!=="applovin"){for(const c of n)c.PlacementId.includes("_auto")&&this.ads.setAdInstance(e.Types.INTERSTITIAL,c.PlacementId,Gt);for(const c of i)c.PlacementId.includes("_auto")&&this.ads.setAdInstance(e.Types.REWARDED_VIDEO,c.PlacementId,Gt);for(const c of r)c.PlacementId.includes("_auto")&&this.ads.setAdInstance(e.Types.REWARDED_INTERSTITIAL,c.PlacementId,Gt);for(const c of o)c.PlacementId.includes("_auto")&&this.ads.setAdInstance(e.Types.BANNER,c.PlacementId,qr)}}initFallbackAds(){const{FallbackAdService:e}=D.Ads;if(e!=="none"&&e==="google"){this.initGoogleAds();return}}initGoogleAds(){const{Ads:e}=p.Plugins,{AdServiceConfigs:s,InterstitialAdOptions:a,RewardedVideoAdOptions:n,RewardedInterstitialAdOptions:i}=D.Ads,{Google:r}=s;if(!r)return;const{AdOptionSuffix:o}=r,c=()=>{for(const d of a)d.PlacementId.includes(o)&&this.ads.setAdInstance(e.Types.INTERSTITIAL,d.PlacementId,he);for(const d of n)d.PlacementId.includes(o)&&this.ads.setAdInstance(e.Types.REWARDED_VIDEO,d.PlacementId,he);for(const d of i)d.PlacementId.includes(o)&&this.ads.setAdInstance(e.Types.REWARDED_INTERSTITIAL,d.PlacementId,he)};if(he.initStatus==="loaded"){c();return}try{he.setGame(this),he.initGoogleAdsAsync(r.AdSenseConfig),c()}catch{}}async initState(){try{const e=new sa(this);e.initContext(),await e.initPlayer()}catch{}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;const{CanvasRecorder:e}=D.Debugger,{Type:s,Quality:a,RecordFps:n,SyncFps:i}=e.Options;this.canvasRecorder.configure({type:s,quality:a,syncFps:i,recordFps:n});const r=document.querySelector("canvas");r&&this.canvasRecorder.setCanvas(r)}initRemoteConfig(){const{RemoteConfig:e}=D;if(!e.Enabled)return;const s=tt.clone(e);this.remoteConfig.configure(s),this.event.on(ie.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(ie.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.catchUp(ie.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initFirebasePlugin(){const{Firebase:e}=D;if(!e.Enabled||!this.firebase)return;const s=tt.clone(e);this.firebase.configure(s),v.setService(this.firebase.services.performance)}initMarkCoreInitialize(){D.PerformanceMonitor.CoreFlows&&(v.measure(this.markName),v.putAttr(this.markName,"Build",`${Ft}`),v.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),v.putAttr(this.markName,"Platform",GameSDK.getPlatform()),v.putAttr(this.markName,"Success","false"),v.start(this.markName))}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch{}}async updatePlayerProfileToNotificationService(){try{const{AppId:e}=D,s=this.player.getPlayer(),{ASID:a,playerId:n,name:i,photo:r,locale:o}=s;await ca({appId:e,ASID:a,playerId:n,name:i,photo:r,locale:o})}catch{}}initGoogleAnalytics(){const{Enabled:e,ConsoleLog:s}=D.Analytics.GoogleAnalytics??{};e&&this.analytics.add(new uo(this.game,{log:!!s}))}initFirebaseAnalytics(){const{Enabled:e,ConsoleLog:s}=D.Analytics.FirebaseAnalytics??{};if(!e)return;const a=new oo(this.game,{log:!!s});this.analytics.add(a);let n="no_entry";GameSDK.getEntryPointAsync().then(i=>{n=i}).catch(i=>{}).finally(()=>{const i=this.player.getPlayer(),{playerId:r,locale:o}=i,{fbig_ad_id:c,fbig_adset_id:d,fbig_campaign_id:h}=GameSDK.getEntryPointData()||{};a.setUser(r,{locale:o,ad_id:c,adset_id:d,campaign_id:h,traffic_source:n})})}initFacebookAnalytics(){const{Enabled:e,Prefix:s,ConsoleLog:a}=D.Analytics.FacebookAnalytics??{};e&&typeof s=="string"&&this.analytics.add(new so(this.game,{prefix:s,log:!!a}))}}const{Configs:{GameEngine:{ForceDesktopDPR:st}},Utils:{Device:wo},Events:$t}=p,Ao=async()=>{const l=new mo;window.game=l;const t=20;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t),window.__gameCoreStart=!0,await l.boot(),l.event.catchUp($t.REQUEST_CORE_START,Ws),Io(l)},Ws=()=>{if(!window.__sdkInitiated){game.event.catchUp($t.GAME_SDK_READY,Ws);return}window.game.start();const l=25;window.__sdkLoadingCount<l&&(window.__sdkLoadingCount=l)},Io=l=>{const e=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(e);const s=10;window.__sdkLoadingCount<s&&(window.__sdkLoadingCount=s),l.event.emit($t.GAME_SDK_READY)},5)};st!==!1&&wo.isDesktop()&&typeof st=="number"&&st>0&&(window.devicePixelRatio=st),Ao()}}});
