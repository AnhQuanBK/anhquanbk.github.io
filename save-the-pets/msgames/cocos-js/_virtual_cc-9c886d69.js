function _instanceof(g,v){if(null!=v&&"undefined"!=typeof Symbol&&v[Symbol.hasInstance])return!!v[Symbol.hasInstance](g);return g instanceof v}function _type_of(g){return g&&"undefined"!=typeof Symbol&&g.constructor===Symbol?"symbol":typeof g}System.register([],function(g,v){"use strict";return{execute:function(){function i(g,v){for(var S=0;S<v.length;S++){var O=v[S];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(g,d(O.key),O)}}function n(g,v,S){return v&&i(g.prototype,v),S&&i(g,S),Object.defineProperty(g,"prototype",{writable:!1}),g}function r(){return(r=Object.assign?Object.assign.bind():function(g){for(var v=1;v<arguments.length;v++){var S=arguments[v];for(var O in S)Object.prototype.hasOwnProperty.call(S,O)&&(g[O]=S[O])}return g}).apply(this,arguments)}function s(g,v){g.prototype=Object.create(v.prototype),g.prototype.constructor=g,o(g,v)}function a(g){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)})(g)}function o(g,v){return(o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,v){return g.__proto__=v,g})(g,v)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(g){return!1}}function u(){return(u=h()?Reflect.construct.bind():function(g,v,S){var O=[null];O.push.apply(O,v);var X=new(Function.bind.apply(g,O));return S&&o(X,S.prototype),X}).apply(null,arguments)}function l(g){var v="function"==typeof Map?new Map:void 0;return(l=function(g){if(null===g||(S=g,-1===Function.toString.call(S).indexOf("[native code]")))return g;var S;if("function"!=typeof g)throw new TypeError("Super expression must either be null or a function");if(void 0!==v){if(v.has(g))return v.get(g);v.set(g,n)}function n(){return u(g,arguments,a(this).constructor)}return n.prototype=Object.create(g.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,g)})(g)}function c(g){if(void 0===g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function _(g,v){(null==v||v>g.length)&&(v=g.length);for(var S=0,O=new Array(v);S<v;S++)O[S]=g[S];return O}function f(g,v){var S="undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(S)return(S=S.call(g)).next.bind(S);if(Array.isArray(g)||(S=function(g,v){if(g){if("string"==typeof g)return _(g,v);var S=Object.prototype.toString.call(g).slice(8,-1);return"Object"===S&&g.constructor&&(S=g.constructor.name),"Map"===S||"Set"===S?Array.from(g):"Arguments"===S||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(S)?_(g,v):void 0}}(g))||v&&g&&"number"==typeof g.length){S&&(g=S);var O=0;return function(){return O>=g.length?{done:!0}:{done:!1,value:g[O++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(g){var v=function(g,v){if("object"!=(void 0===g?"undefined":_type_of(g))||null===g)return g;var S=g[Symbol.toPrimitive];if(void 0!==S){var O=S.call(g,v);if("object"!=(void 0===O?"undefined":_type_of(O)))return O;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(g)}(g,"string");return"symbol"==(void 0===v?"undefined":_type_of(v))?v:String(v)}function p(g,v,S,O,X){var Y={};return Object.keys(O).forEach(function(g){Y[g]=O[g]}),Y.enumerable=!!Y.enumerable,Y.configurable=!!Y.configurable,("value"in Y||Y.initializer)&&(Y.writable=!0),Y=S.slice().reverse().reduce(function(S,O){return O(g,v,S)||S},Y),X&&void 0!==Y.initializer&&(Y.value=Y.initializer?Y.initializer.call(X):void 0,Y.initializer=void 0),void 0===Y.initializer&&(Object.defineProperty(g,v,Y),Y=null),Y}function m(g,v){var S="undefined"==typeof window?global:window;return void 0===S[g]?S[g]=v:S[g]}g({A:YF,D:qF,E:KF,J:JF,K:QF,N:ZF,P:function(g){return BD.test(g)},Q:function(g){return BP.test(g)},W:iN,X:nN,Y:rN,_:f,a$:Ii,a9:sK,aA:pn,aD:Bn,aF:Dn,aH:bn,aM:di,aN:pi,aO:mi,aP:gi,aQ:vi,aR:yi,aS:Si,aT:Ai,aU:Ti,aV:Ei,aW:Ci,aX:bi,aY:xi,aZ:Ri,a_:wi,aa:aK,ac:function(g,v){for(var S=g,O="";null!==S&&S!==v;)O=S.name+"/"+O,S=S.parent;return O.slice(0,-1)},ad:function(g,v,S){for(e$.identity(S);g!==v;)e$.fromRTS(Wd,g.rotation,g.position,g.scale),e$.multiply(S,Wd,S),g=g.parent;return S},ar:vn,at:Yi,av:An,ax:un,b0:Bi,b1:Pi,b2:Di,b3:Oi,b4:Mi,b5:Vi,b6:Ui,bF:function(g){return g[n1]},bI:Su,bK:U,bL:N,bM:k,bN:G,bO:V,bP:j,bQ:J,bR:q,bS:$,bT:et,bU:it,bV:tt,bc:ie,bd:re,be:oe,bj:function(g){g>0&&(aU=g)},bn:function(g){for(var v in g){var S=g[v];aX[v]=S}},bo:function(g){for(var v,S=f(g);!(v=S()).done;)$u(v.value)},bp:function(g){return aW||(aW="undefined"==typeof Proxy?{}:new Proxy(g,{get:function(g,v,S){return $u(v),Reflect.get(g,v,S)}})),aW},bq:el,br:il,bu:ri,bv:si,cB:Oa,cC:Ma,cF:function(g,v){v.forEach(function(v){Object.getOwnPropertyNames(v.prototype).forEach(function(S){"constructor"!==S&&Object.defineProperty(g.prototype,S,Object.getOwnPropertyDescriptor(v.prototype,S))})})},cG:H,cH:function(g,v){return Ts(g,v,0)},cI:Ts,cJ:function(g,v,S){for(var O=0,X=g.length-1,Y=X>>>1;O<=X;Y=O+X>>>1){var te=g[Y];if(S(te,v)<0)X=Y-1;else{if(!(S(te,v)>0))return Y;O=Y+1}}return~O},cK:function(){},cL:function(){},cM:ne,cN:xl,cU:VP,ce:Sl,cf:lh,cg:Rh,cs:Ys,cu:function(g,v,S){if(ne(g,v),ne(g,S),v===S)return g;var O=g[v];if(v<S)for(var X=v+1;X<=S;++X)g[X-1]=g[X];else for(var Y=v;Y!==S;--Y)g[Y]=g[Y-1];return g[S]=O,g},cx:Ke,cy:Je,dL:yp,dN:i$,dg:VM,eZ:bet,e_:xet,y:function(){return 0}}),m("CC_WECHAT",!1),m("CC_BAIDU",!1),m("CC_XIAOMI",!1),m("CC_ALIPAY",!1),m("CC_BYTEDANCE",!1),m("CC_OPPO",!1),m("CC_VIVO",!1),m("CC_HUAWEI",!1),m("CC_COCOSPLAY",!1),m("CC_QTT",!1),m("CC_LINKSURE",!1);var S=!1;m("CC_EDITOR",!1);m("CC_PREVIEW",!1),m("CC_BUILD",!0),m("CC_TEST",!1),m("CC_DEBUG",!1),m("CC_DEV",!1),m("CC_MINIGAME",!1),m("CC_RUNTIME_BASED",!1),m("CC_SUPPORT_JIT",!0),m("CC_JSB",!1);var O="undefined"==typeof window?global:window,X=g("ao",{_global:O});X.internal={};var Y=g("an","3.8.3");O.CocosEngine=X.ENGINE_VERSION=Y,O.cc=X;var te=void 0!==globalThis.jsb&&void 0!==jsb.window?jsb.window:globalThis;function T(g){var v,S;return v=(g>65535)<<4,v|=S=((g>>>=v)>255)<<3,v|=S=((g>>>=S)>15)<<2,(v|=S=((g>>>=S)>3)<<1)|(g>>>=S)>>1}function E(g){return 0x1010101*((g=(0x33333333&(g-=g>>>1&0x55555555))+(g>>>2&0x33333333))+(g>>>4)&0xf0f0f0f)>>>24}function C(g){var v=32;return(g&=-g)&&v--,65535&g&&(v-=16),0xff00ff&g&&(v-=8),0xf0f0f0f&g&&(v-=4),0x33333333&g&&(v-=2),0x55555555&g&&(v-=1),v}function b(g){return--g,g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,1+(g|=g>>>16)}O.ccwindow=te;var ti=new Array(256);!function(g){for(var v=0;v<256;++v){var S=v,O=v,X=7;for(S>>>=1;S;S>>>=1)O<<=1,O|=1&S,--X;g[v]=O<<X&255}}(ti);var tr=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:0x7fffffff,INT_MIN:-0x80000000,sign:function(g){return(g>0)-(g<0)},abs:function(g){var v=g>>31;return(g^v)-v},min:function(g,v){return v^(g^v)&-(g<v)},max:function(g,v){return g^(g^v)&-(g<v)},isPow2:function(g){return!(g&g-1||!g)},log2:T,log10:function(g){return g>=1e9?9:g>=1e8?8:g>=1e7?7:g>=1e6?6:g>=1e5?5:g>=1e4?4:g>=1e3?3:g>=100?2:g>=10?1:0},popCount:E,countTrailingZeros:C,nextPow2:b,prevPow2:function(g){return g|=g>>>1,g|=g>>>2,g|=g>>>4,g|=g>>>8,(g|=g>>>16)-(g>>>1)},parity:function(g){return g^=g>>>16,g^=g>>>8,g^=g>>>4,27030>>>(g&=15)&1},reverse:function(g){return ti[255&g]<<24|ti[g>>>8&255]<<16|ti[g>>>16&255]<<8|ti[g>>>24&255]},interleave2:function(g,v){return(g=0x55555555&((g=0x33333333&((g=0xf0f0f0f&((g=0xff00ff&((g&=65535)|g<<8))|g<<4))|g<<2))|g<<1))|(v=0x55555555&((v=0x33333333&((v=0xf0f0f0f&((v=0xff00ff&((v&=65535)|v<<8))|v<<4))|v<<2))|v<<1))<<1},deinterleave2:function(g,v){return(g=65535&((g=0xff00ff&((g=0xf0f0f0f&((g=0x33333333&((g=g>>>v&0x55555555)|g>>>1))|g>>>2))|g>>>4))|g>>>16))<<16>>16},interleave3:function(g,v,S){return g=0x49249249&((g=0xc30c30c3&((g=0xf00f00f&((g=0xff0000ff&((g&=1023)|g<<16))|g<<8))|g<<4))|g<<2),(g|=(v=0x49249249&((v=0xc30c30c3&((v=0xf00f00f&((v=0xff0000ff&((v&=1023)|v<<16))|v<<8))|v<<4))|v<<2))<<1)|(S=0x49249249&((S=0xc30c30c3&((S=0xf00f00f&((S=0xff0000ff&((S&=1023)|S<<16))|S<<8))|S<<4))|S<<2))<<2},deinterleave3:function(g,v){return(g=1023&((g=0xff0000ff&((g=0xf00f00f&((g=0xc30c30c3&((g=g>>>v&0x49249249)|g>>>2))|g>>>4))|g>>>8))|g>>>16))<<22>>22},nextCombination:function(g){var v=g|g-1;return v+1|(~v&-~v)-1>>>C(g)+1}});g("ap",tr);var ta=te.document,th="https://github.com/cocos-creator/engine/blob/develop/EngineErrorMap.md",tu=null,tl=console.log.bind(console),tc=tl,t_=tl,M=function(g,v){if(!g){for(var S=arguments.length,O=new Array(S>2?S-2:0),X=2;X<S;X++)O[X-2]=arguments[X];console.log("ASSERT: "+F.apply(void 0,[v].concat(O)))}},tf=tl;function F(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];return X.js.formatStr.apply(null,v)}function N(){return tl.apply(void 0,arguments)}function G(){return tc.apply(void 0,arguments)}function k(){return t_.apply(void 0,arguments)}function V(g,v){for(var S=arguments.length,O=new Array(S>2?S-2:0),X=2;X<S;X++)O[X-2]=arguments[X];return M.apply(void 0,[g,v].concat(O))}function U(){return tf.apply(void 0,arguments)}function H(g){if(tl=tc=t_=M=tf=function(){},g!==tv.NONE){if(g>tv.ERROR){var e=function(g){if(X.game.canvas){if(!tu){var v=ta.createElement("Div");v.setAttribute("id","logInfoDiv"),v.setAttribute("width","200"),v.setAttribute("height",X.game.canvas.height);var S=v.style;S.zIndex="99999",S.position="absolute",S.top=S.left="0",(tu=ta.createElement("textarea")).setAttribute("rows","20"),tu.setAttribute("cols","30"),tu.setAttribute("disabled","true");var O=tu.style;O.backgroundColor="transparent",O.borderBottom="1px solid #cccccc",O.borderTopWidth=O.borderLeftWidth=O.borderRightWidth="0px",O.borderTopStyle=O.borderLeftStyle=O.borderRightStyle="none",O.padding="0px",O.margin="0px",v.appendChild(tu),X.game.canvas.parentNode.appendChild(v)}tu.value=tu.value+g+"\r\n",tu.scrollTop=tu.scrollHeight}};t_=function(){e("ERROR :  "+F.apply(void 0,arguments))},M=function(g,v){if(!g){for(var S=arguments.length,O=new Array(S>2?S-2:0),X=2;X<S;X++)O[X-2]=arguments[X];e("ASSERT: "+F.apply(void 0,[v].concat(O)))}},g!==tv.ERROR_FOR_WEB_PAGE&&(tc=function(){e("WARN :  "+F.apply(void 0,arguments))}),g===tv.INFO_FOR_WEB_PAGE&&(tl=function(){e(F.apply(void 0,arguments))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),t_=console.error.bind?console.error.bind(console):function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];return console.error.apply(console,v)},M=function(g,v){if(!g){for(var S=arguments.length,O=new Array(S>2?S-2:0),X=2;X<S;X++)O[X-2]=arguments[X];var Y=F.apply(void 0,[v].concat(O));throw new Error(Y)}});if(g!==tv.ERROR&&(tc=console.warn.bind?console.warn.bind(console):function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];return console.warn.apply(console,v)}),g<=tv.INFO&&(tl=console.log.bind?console.log.bind(console):function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];return console.log.apply(console,v)}),g<=tv.VERBOSE&&"function"==typeof console.debug){var v=console.debug.bind(console);tf=function(){return v.apply(void 0,arguments)}}}}function z(g){k(g.stack||g)}function W(g){return function(v){for(var S=g+" "+v+", please go to "+th+"#"+v+" to see details.",O=arguments.length,X=new Array(O>1?O-1:0),Y=1;Y<O;Y++)X[Y-1]=arguments[Y];return 0===X.length?S:S+" Arguments: "+X.join(", ")}}var tp=W("Log");function j(g){for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];N(tp.apply(void 0,[g].concat(S)))}var tm=W("Warning");function q(g){for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];G(tm.apply(void 0,[g].concat(S)))}var tg=W("Error");function J(g){for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];k(tg.apply(void 0,[g].concat(S)))}var tv,ty=W("Assert");function $(g,v){if(!g){for(var S=arguments.length,O=new Array(S>2?S-2:0),X=2;X<S;X++)O[X-2]=arguments[X];V(!1,ty.apply(void 0,[v].concat(O)))}}function tt(g){for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];return tg.apply(void 0,[g].concat(S))}function et(){return!!X.profiler&&X.profiler.isShowingStats()}function it(g){X.profiler&&(g?X.profiler.showStats():X.profiler.hideStats())}g("bW",tv),function(g){g[g.NONE=0]="NONE",g[g.VERBOSE=1]="VERBOSE",g[g.INFO=2]="INFO",g[g.WARN=3]="WARN",g[g.ERROR=4]="ERROR",g[g.INFO_FOR_WEB_PAGE=5]="INFO_FOR_WEB_PAGE",g[g.WARN_FOR_WEB_PAGE=6]="WARN_FOR_WEB_PAGE",g[g.ERROR_FOR_WEB_PAGE=7]="ERROR_FOR_WEB_PAGE"}(tv||g("bW",tv={}));var tS,tA=Object.freeze({__proto__:null,log:N,warn:G,error:k,assert:V,debug:U,_resetDebugSetting:H,_throw:z,logID:j,warnID:q,errorID:J,assertID:$,get DebugMode(){return tv},getError:tt,isDisplayStats:et,setDisplayStats:it}),tT=function(){function t1(g){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=g?g+".":""}return t1.prototype.getNewId=function(){return this.prefix+(++this.id).toString()},t1}();tS=tT,tT.global=new tS("global");var tE=new tT("TmpCId."),tC="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),tx="__cid__";function ut(g){return"number"==typeof g||_instanceof(g,Number)}function lt(g){return"string"==typeof g||_instanceof(g,String)}function ct(g){for(var v in g)return!1;return!0}var tb,tw=(tb={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(g,v,S,O,X){tb.value=S,tb.writable=O,tb.enumerable=X,Object.defineProperty(g,v,tb),tb.value=void 0}),tI=function(){var g={get:void 0,set:void 0,enumerable:!1};return function(v,S,O,X,Y,te){void 0===Y&&(Y=!1),void 0===te&&(te=!1),"boolean"==typeof X&&(console.log("Set `setter` to boolean is deprecated. Please don not use like this again."),Y=X,X=void 0),g.get=O,g.set=X,g.enumerable=Y,g.configurable=te,Object.defineProperty(v,S,g),g.get=void 0,g.set=void 0}}(),tB=function(){var g={get:void 0,enumerable:!1,configurable:!1};return function(v,S,O,X,Y){g.get=O,g.enumerable=X,g.configurable=Y,Object.defineProperty(v,S,g),g.get=void 0}}(),tP=function(){var g={set:void 0,enumerable:!1,configurable:!1};return function(v,S,O,X,Y){g.set=O,g.enumerable=X,g.configurable=Y,Object.defineProperty(v,S,g),g.set=void 0}}();function gt(g){var v=Object.create(null);return g&&(v["."]=1,v["/"]=1,delete v["."],delete v["/"]),v}function vt(g){if("function"==typeof g){var v=g.prototype;if(v&&v.hasOwnProperty("__classname__")&&v.__classname__)return v.__classname__;var S="";if(g.name&&(S=g.name),g.toString){var O,X=g.toString();(O="["===X.charAt(0)?/\[\w+\s*(\w+)\]/.exec(X):/function\s*(\w+)/.exec(X))&&2===O.length&&(S=O[1])}return"Object"!==S?S:""}return g&&g.constructor?vt(g.constructor):""}function yt(g,v,S,O){var X=/([^.]+)$/,Y=X.exec(v)[0],te=X.exec(S)[0];function o(){return this[te]}O?tI(g,Y,o,function(g){this[te]=g}):tB(g,Y,o)}function St(g,v,S,O){for(var X in S)yt(g,v+"."+X,S[X],O)}var tD=/(%d)|(%s)/,tM=/%s/;function Et(g){for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];if(0===arguments.length)return"";if(0===S.length)return""+g;var X="string"==typeof g&&tD.test(g);if(X)for(var Y,te=f(S);!(Y=te()).done;){var ti=Y.value,tr="number"==typeof ti?tD:tM;if(tr.test(g)){var ta=""+ti;g=g.replace(tr,ta)}else g+=" "+ti}else for(var th,tu=f(S);!(th=tu()).done;){var tl=th.value;g+=" "+tl}return g}function Ct(){for(var g=arguments.length-1,v=new Array(g),S=0;S<g;++S)v[S]=arguments[S+1];return v}function bt(g,v){for(;g;){var S=Object.getOwnPropertyDescriptor(g,v);if(S)return S;g=Object.getPrototypeOf(g)}return null}function xt(g,v,S){var O=bt(v,g);O&&Object.defineProperty(S,g,O)}function Rt(g){g=g||{};for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];for(var X=0,Y=S;X<Y.length;X++){var te=Y[X];if(te){if("object"!=(void 0===te?"undefined":_type_of(te))){J(5402,te);continue}for(var ti in te)ti in g||xt(ti,te,g)}}return g}function wt(g){g=g||{};for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];for(var X=0,Y=S;X<Y.length;X++){var te=Y[X];if(te){if("object"!=(void 0===te?"undefined":_type_of(te))){J(5403,te);continue}for(var ti in te)xt(ti,te,g)}}return g}function It(g,v){for(var S in v)v.hasOwnProperty(S)&&(g[S]=v[S]);return g.prototype=Object.create(v.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),g}function Bt(g){var v=g.prototype,S=v&&Object.getPrototypeOf(v);return S&&S.constructor}function Pt(g,v){if(g&&v){if("function"!=typeof g)return!1;if("function"!=typeof v)return!1;if(g===v)return!0;for(;;){if(!(g=Bt(g)))break;if(g===v)return!0}}return!1}function Dt(g){for(var v=0,S=Object.keys(g);v<S.length;v++)delete g[S[v]]}var tO=gt(!0),tk=gt(!0);function Lt(g,v,S){return function(O,X){if(X.prototype.hasOwnProperty(g)&&delete v[X.prototype[g]],tw(X.prototype,g,O),O){var Y=v[O];!S&&Y&&Y!==X?k("A Class already exists with the same "+g+' : "'+O+'".'):v[O]=X}}}var tG=Lt("__cid__",tO,!1),tV=Lt("__classname__",tk,!0);function Gt(g,v){if(tV(g,v),!v.prototype.hasOwnProperty(tx)){var S=g||tE.getNewId();S&&tG(S,v)}}function kt(g,v){var S=tk[v],O=tO[v],X=!0;if(S&&S!==g&&(k('"'+v+'" has already been set as name or alias of another class.'),X=!1),O&&O!==g&&(k('"'+v+'" has already been set as id or alias of another class.'),X=!1),X){var Y=g[tC];Y||(Y=[],g[tC]=Y),Y.push(v),tk[v]=g,tO[v]=g}}function Vt(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];for(var O=0,X=v;O<X.length;O++){var Y=X[O],te=Y.prototype,ti=te.__cid__;ti&&delete tO[ti];var tr=te.__classname__;tr&&delete tk[tr];var ta=te[tC];if(ta)for(var th=0;th<ta.length;++th){var tu=ta[th];delete tk[tu],delete tO[tu]}}}function Ut(g){return Ht(g)}function Ht(g){return tO[g]}function zt(g){return tk[g]}function Wt(g,v){return Xt(g,v)}function Xt(g,v){if(v=void 0===v||v,"function"==typeof g&&g.prototype.hasOwnProperty(tx))return g.prototype.__cid__;if(g&&g.constructor){var S=g.constructor.prototype;if(S&&S.hasOwnProperty(tx))return g.__cid__}return""}var tU=function(){var g=e.prototype;function e(g,v){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var S=void 0===v?g:v,O=void 0===v?null:g;this.count=0,this._pool=new Array(S),this._cleanup=O}return g.get=function(){return this._get()},g._get=function(){if(this.count>0){--this.count;var g=this._pool[this.count];return this._pool[this.count]=null,g}return null},g.put=function(g){var v=this._pool;if(this.count<v.length){if(this._cleanup&&!1===this._cleanup(g))return;v[this.count]=g,++this.count}},g.resize=function(g){g>=0&&(this._pool.length=g,this.count>g&&(this.count=g))},e}(),tH=function(){function t1(g){this.i=0,this.array=g}var g=t1.prototype;return g.remove=function(g){var v=this.array.indexOf(g);v>=0&&this.removeAt(v)},g.removeAt=function(g){this.array.splice(g,1),g<=this.i&&--this.i},g.fastRemove=function(g){var v=this.array.indexOf(g);v>=0&&this.fastRemoveAt(v)},g.fastRemoveAt=function(g){var v=this.array;v[g]=v[v.length-1],--v.length,g<=this.i&&--this.i},g.push=function(g){this.array.push(g)},n(t1,[{key:"length",get:function(){return this.array.length},set:function(g){this.array.length=g,this.i>=g&&(this.i=g-1)}}]),t1}();function qt(g,v){g.splice(v,1)}function Kt(g,v){var S=g.length;v<0||v>=S||(g[v]=g[S-1],g.length=S-1)}function Jt(g,v){var S=g.indexOf(v);return S>=0&&(qt(g,S),!0)}function Qt(g,v){var S=g.indexOf(v);S>=0&&(g[S]=g[g.length-1],--g.length)}function Zt(g,v){var S=g.findIndex(v);if(S>=0){var O=g[S];return qt(g,S),O}}function $t(g,v){return g.indexOf(v)>=0}var tz=Object.freeze({__proto__:null,removeAt:qt,fastRemoveAt:Kt,remove:Jt,fastRemove:Qt,removeIf:Zt,verifyType:function(g,v){if(g&&g.length>0){for(var S,O=f(g);!(S=O()).done;)if(!_instanceof(S.value,v))return j(1300),!1}return!0},removeArray:function(g,v){for(var S=0,O=v.length;S<O;S++)Jt(g,v[S])},appendObjectsAt:function(g,v,S){return g.splice.apply(g,[S,0].concat(v)),g},contains:$t,copy:function(g){for(var v=g.length,S=new Array(v),O=0;O<v;O+=1)S[O]=g[O];return S},MutableForwardIterator:tH}),tW={IDGenerator:tT,Pool:tU,array:tz,isNumber:ut,isString:lt,isEmptyObject:ct,getPropertyDescriptor:bt,addon:Rt,mixin:wt,extend:It,getSuper:Bt,isChildClassOf:Pt,clear:Dt,value:tw,getset:tI,get:tB,set:tP,unregisterClass:Vt,getClassName:vt,setClassName:Gt,setClassAlias:kt,getClassByName:zt,getClassById:Ht,get _registeredClassNames(){return r({},tk)},set _registeredClassNames(t){Dt(tk),Object.assign(tk,t)},get _registeredClassIds(){return r({},tO)},set _registeredClassIds(t){Dt(tO),Object.assign(tO,t)},_getClassId:Wt,getClassId:Xt,_setClassId:tG,_getClassById:Ut,obsolete:yt,obsoletes:St,formatStr:Et,shiftArguments:Ct,createMap:gt};function ie(g){if("__bitmask__"in g)return g;tw(g,"__bitmask__",null,!0);for(var v=-1,S=Object.keys(g),O=0;O<S.length;O++){var X=S[O],Y=g[X];if(-1===Y)Y=++v,g[X]=Y;else if("number"==typeof Y)v=Y;else if("string"==typeof Y&&Number.isInteger(parseFloat(X)))continue;var te=""+Y;X!==te&&tw(g,te,X)}return g}function ne(g,v){v>=0&&g.length,g.length}function re(g){return"__enums__"in g?g:(tw(g,"__enums__",null,!0),re.update(g))}function se(g){g.hasOwnProperty("__enums__")}function ae(g){se(g);var v=g.__enums__||[];for(var S in v.length=0,g){var O=g[S];Number.isInteger(O)&&v.push({name:S,value:O})}return v.sort(function(g,v){return g.value-v.value}),g.__enums__=v,v}function oe(g){"__enums__"in g||tw(g,"__enums__",null,!0)}X.js=tW,g("bg",Object.freeze({__proto__:null,array:tz,js:tW,IDGenerator:tT,Pool:tU,isNumber:ut,isString:lt,isEmptyObject:ct,value:tw,getset:tI,get:tB,set:tP,createMap:gt,getClassName:vt,obsolete:yt,obsoletes:St,formatStr:Et,shiftArguments:Ct,getPropertyDescriptor:bt,copyAllProperties:function(g,v,S){for(var O=Object.getOwnPropertyNames(g),X=0,Y=O.length;X<Y;++X){var te=O[X];-1===S.indexOf(te)&&xt(te,g,v)}},addon:Rt,mixin:wt,extend:It,getSuper:Bt,isChildClassOf:Pt,clear:Dt,_idToClass:tO,_nameToClass:tk,_setClassId:tG,setClassName:Gt,setClassAlias:kt,unregisterClass:Vt,_getClassById:Ut,getClassById:Ht,getClassByName:zt,_getClassId:Wt,getClassId:Xt})),ie.isBitMask=function(g){return g&&g.hasOwnProperty("__bitmask__")},ie.getList=function(g){return g.__bitmask__?g.__bitmask__:ie.update(g)},ie.update=function(g){Array.isArray(g.__bitmask__)||(g.__bitmask__=[]);var v=g.__bitmask__;for(var S in v.length=0,g){var O=g[S];Number.isInteger(O)&&v.push({name:S,value:O})}return v.sort(function(g,v){return g.value-v.value}),v},X.BitMask=ie,re.update=function(g){for(var v=-1,S=Object.keys(g),O=0;O<S.length;O++){var X=S[O],Y=g[X];if(-1===Y)Y=++v,g[X]=Y;else if("number"==typeof Y)v=Y;else if("string"==typeof Y&&Number.isInteger(parseFloat(X)))continue;var te=""+Y;X!==te&&tw(g,te,X)}return Array.isArray(g.__enums__)&&ae(g),g},re||g("bd",re={}),re.isEnum=function(g){return g&&g.hasOwnProperty("__enums__")},re.getList=function(g){return se(g),g.__enums__?g.__enums__:ae(g)},re.sortList=function(g,v){se(g),Array.isArray(g.__enums__)&&g.__enums__.sort(v)},X.Enum=re;var tj,tq=g("bf",function(){function t1(){}var g=t1.prototype;return g.clone=function(){return J(100,vt(this)+".clone"),this},g.equals=function(){return!1},g.set=function(){J(100,vt(this)+".set")},g.toString=function(){return""},t1}());Gt("cc.ValueType",tq),X.ValueType=tq,function(g){g.PATH="path",g.ENGINE="engine",g.ASSETS="assets",g.SCRIPTING="scripting",g.PHYSICS="physics",g.RENDERING="rendering",g.LAUNCH="launch",g.SCREEN="screen",g.SPLASH_SCREEN="splashScreen",g.ANIMATION="animation",g.PROFILING="profiling",g.PLUGINS="plugins",g.XR="xr"}(tj||(tj={}));var tK=g("ca",function(){function t1(){this._settings={},this._override={}}var g=t1.prototype;return g.init=function(g,v){var S=this;for(var O in void 0===g&&(g=""),void 0===v&&(v={}),v){var X=v[O];if(X)for(var Y in X)this.overrideSettings(O,Y,X[Y])}return g?new Promise(function(v,O){var X=new XMLHttpRequest;X.open("GET",g),X.responseType="text",X.onload=function(){S._settings=JSON.parse(X.response),v()},X.onerror=function(){O(new Error("request settings failed!"))},X.send(null)}):Promise.resolve()},g.overrideSettings=function(g,v,S){g in this._override||(this._override[g]={}),this._override[g][v]=S},g.querySettings=function(g,v){if(g in this._override){var S=this._override[g];if(S&&v in S)return S[v]}if(g in this._settings){var O=this._settings[g];if(O&&v in O)return O[v]}return null},t1}());tK.Category=tj;var tZ,tQ=g("cb",new tK);X.settings=tQ,function(g){g[g.PORTRAIT=1]="PORTRAIT",g[g.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",g[g.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",g[g.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",g[g.LANDSCAPE=12]="LANDSCAPE",g[g.AUTO=13]="AUTO"}(tZ||(tZ={}));var t$=g("bZ",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1192092896e-16,ORIENTATION_PORTRAIT:tZ.PORTRAIT,ORIENTATION_PORTRAIT_UPSIDE_DOWN:tZ.PORTRAIT_UPSIDE_DOWN,ORIENTATION_LANDSCAPE:tZ.LANDSCAPE,ORIENTATION_LANDSCAPE_LEFT:tZ.LANDSCAPE_LEFT,ORIENTATION_LANDSCAPE_RIGHT:tZ.LANDSCAPE_RIGHT,ORIENTATION_AUTO:tZ.AUTO,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,ENABLE_FLOAT_OUTPUT:!1,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20,ENABLE_WEBGL_HIGHP_STRUCT_VALUES:!1,BATCHER2D_MEM_INCREMENT:144,CUSTOM_PIPELINE_NAME:"",init:function(){var g=tQ.querySettings(tK.Category.ENGINE,"macros");if(g)for(var v in g)t$[v]=g[v]}});X.macro=t$;for(var t0=/^(?:cc|dragonBones|sp|ccsg)\..+/,t2=new Array(123),t3=0;t3<123;++t3)t2[t3]=64;for(var t4=0;t4<64;++t4)t2["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(t4)]=t4;var t8=t2;function ye(g,v,S){function n(g,v,S,O){var X=Object.getOwnPropertyDescriptor(g,v);if(X)X.get&&(g[S]=X.get),X.set&&O&&(g[O]=X.set);else{var Y=g[S];tI(g,v,Y,g[O])}}for(var O,X=g.prototype,Y=0;Y<v.length;Y++){var te=(O=v[Y])[0].toUpperCase()+O.slice(1);n(X,O,"get"+te,"set"+te)}for(O in S){var ti=S[O];n(X,O,ti[0],ti[1])}}function Se(g,v,S,O){var X=g[v];X?Array.isArray(X)?O?(X.push(X[0]),X[0]=S):X.push(S):g[v]=O?[S,X]:[X,S]:g[v]=S}function Ae(g,v){if("function"==typeof g.contains)return g.contains(v);if("function"==typeof g.compareDocumentPosition)return!!(16&g.compareDocumentPosition(v));var S=v.parentNode;if(S)do{if(S===g)return!0;S=S.parentNode}while(null!==S);return!1}function Te(g){return"object"==("undefined"==typeof window?"undefined":_type_of(window))&&"function"==typeof Node?_instanceof(g,Node):!!g&&"object"==(void 0===g?"undefined":_type_of(g))&&"number"==typeof g.nodeType&&"string"==typeof g.nodeName}function Ee(g,v,S){g&&function(g,v){for(var S,O=arguments.length,X=new Array(O>2?O-2:0),Y=2;Y<O;Y++)X[Y-2]=arguments[Y];var te=performance.now(),ti=requestAnimationFrame||window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(void 0===ti||null!==(S=globalThis.__globalXR)&&void 0!==S&&S.isWebXR)return setTimeout.apply(void 0,[g,v].concat(X));var h=function i(){performance.now()-te<v?ti(i):g.apply(void 0,X)};ti(h)}(function(){g(v,S)},0)}function Ce(g){return!(!g||g.constructor!==Object)&&ct(g)}function be(g,v,S){if(v>S){var O=v;v=S,S=O}return g<v?v:g<S?g:S}function xe(g){return g*t$.RAD}function Re(g){return g*t$.DEG}X.misc={BUILTIN_CLASSID_RE:t0,BASE64_VALUES:t8,propertyDefine:ye,pushToMap:Se,contains:Ae,isDomNode:Te,callInNextTick:Ee,isPlainEmptyObj_DEV:Ce,clampf:be,degreesToRadians:xe,radiansToDegrees:Re},g("bh",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:t0,BASE64_VALUES:t8,propertyDefine:ye,pushToMap:Se,contains:Ae,isDomNode:Te,callInNextTick:Ee,tryCatchFunctor_EDITOR:function(g){return Function("target","try {\n  target."+g+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:Ce,clampf:be,degreesToRadians:xe,radiansToDegrees:Re}));var t6="$_$";function Ie(g,v){var S=v?Object.create(v):{};return tw(g,"__attrs__",S),S}function Be(g){if("function"!=typeof g)return Ie(g,De(g.constructor));for(var v,S=X.Class.getInheritanceChain(g),O=S.length-1;O>=0;O--){var Y=S[O];Y.hasOwnProperty("__attrs__")&&Y.__attrs__||Ie(Y,(v=S[O+1])&&v.__attrs__)}return Ie(g,(v=S[0])&&v.__attrs__),g.__attrs__}function Pe(g,v){var S=De(g),O=v+t6,X={};for(var Y in S)Y.startsWith(O)&&(X[Y.slice(O.length)]=S[Y]);return X}function De(g){return g.hasOwnProperty("__attrs__")&&g.__attrs__||Be(g)}function Oe(g,v,S,O){De(g)[v+t6+S]=O}var t7=function(){function t1(g,v){this.name=void 0,this.default=void 0,this.name=g,this.default=v}return t1.prototype.toString=function(){return this.name},t1}(),t9=g("bx",new t7("Integer",0));X.Integer=t9,X.CCInteger=t9;var ee=g("by",new t7("Float",0));X.Float=ee,X.CCFloat=ee;var en=g("bz",new t7("Boolean",!1));X.Boolean=en,X.CCBoolean=en;var er=g("bA",new t7("String",""));function ke(g,v){return function(S,O){var X='"'+vt(S)+"."+O+'"',Y=Pe(S,O),te=Y.type;if(te===t9||te===ee?te="Number":te!==er&&te!==en||(te=""+te),te===g){if(Y.hasOwnProperty("default")){var ti=Y.default;if(void 0!==ti&&!Array.isArray(ti)&&!Ce(ti)){var tr=void 0===ti?"undefined":_type_of(ti),ta=g.toLowerCase();if(tr===ta){if("object"===ta){if(!ti||_instanceof(ti,Y.ctor))return;q(3605,X,vt(Y.ctor))}else"Number"!==g&&q(3606,v,X,g)}else{if("function"===tr)return;g===er.default&&null==ti?q(3607,X):q(3611,v,X,tr)}delete Y.type}}}else q(3604,X)}}X.String=er,X.CCString=er;var es=Object.freeze({__proto__:null,DELIMETER:t6,createAttrsSingle:Ie,createAttrs:Be,attr:Pe,getClassAttrs:De,setClassAttr:Oe,PrimitiveType:t7,CCInteger:t9,CCFloat:ee,CCBoolean:en,CCString:er,getTypeChecker_ET:ke,getObjTypeChecker_ET:function(g){return function(v,S){ke("Object","type")(v,S);var O=De(v)[S+t6+"default"],Y=X.Class.getDefault(O);if(!Array.isArray(Y)&&Pt(g,X.ValueType)){var te=vt(g),ti=Et('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',vt(v),S,te);O?N(ti):q(3612,ti,te,vt(v),S,te)}}}}),ea={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function He(g,v,S,O){if(!g.get&&!g.set&&g.hasOwnProperty("default")){var X="_N$"+v;g.get=function(){return this[X]},g.set=function(g){var v=this[X];this[X]=g,S.call(this,v)};var Y={};for(var te in O[X]=Y,ea){var ti=ea[te];g.hasOwnProperty(te)&&(Y[te]=g[te],ti.canUsedInGet||delete g[te])}}}function ze(g,v,S,O){if(Array.isArray(v)){if(!(v.length>0))return J(5508,S,O);g.type=v=v[0]}"function"==typeof v&&(v===String?g.type=X.String:v===Boolean?g.type=X.Boolean:v===Number&&(g.type=X.Float))}function We(g,v,S){var O=g||void 0===v?{_short:!0}:{_short:!0,default:v};return S&&(O.type=S),O}function Xe(g,v){if(!g||g.constructor!==Object){if(Array.isArray(g)&&g.length>0)return We(v,[],g);if("function"==typeof g){var S=g;return We(v,Pt(S,X.ValueType)?new S:null,S)}return _instanceof(g,t7)?We(v,void 0,g):We(v,g)}return null}var eh,eu=[];function qe(){return eu[eu.length-1]}function Ke(g,v,S){Je(De(g),v,S)}function Je(g,v,S){g[v+"$_$type"]="Enum",g[v+"$_$enumList"]=re.getList(S)}X._RF={push:function(g,v,S,O){void 0===S&&(S=v,v=""),eu.push({uuid:v,script:S,module:g,exports:g.exports,beh:null,importMeta:O})},pop:function(){var g=eu.pop(),v=g.module,S=v.exports;if(S===g.exports){for(var O in S)return;v.exports=S=g.cls}},peek:qe},function(g){g[g.STANDALONE=1]="STANDALONE",g[g.IMPLICIT_VISIBLE=2]="IMPLICIT_VISIBLE",g[g.IMPLICIT_SERIALIZABLE=4]="IMPLICIT_SERIALIZABLE"}(eh||(eh={}));var ec=t6,e_="__ctors__",ef=g("cz","Enum"),em=g("cA","BitMask");function ei(g,v,S,O){!function(g,v){!function(g,v){g.indexOf(v)<0&&g.push(v)}(g.__props__,v)}(g,S),oi(g,O,v,S)}function ii(g,v,S,O){var X=O.get;O.set,X&&(oi(g,O,v,S),Oe(g,S,"serializable",!1))}function ni(g){return"function"==typeof g?g():g}function ri(g){var v=g.name,S=g.extends,O=function(g,v,S){var O=X.Component,Y=qe();if(Y&&Pt(v,O)){if(Pt(Y.cls,O))return J(3615),null;g=g||Y.script}var te=function(g,v,S){var O=S.ctor;return tw(O,e_,!0,!0),O.prototype,v&&(O.$super=v),Gt(g,O),O}(g,v,S);if(Y){if(Pt(v,O)){var ti=Y.uuid;ti&&tG(ti,te),Y.cls=te}else Pt(Y.cls,O)||(Y.cls=te)}return te}(v,S,g);v||(v=X.js.getClassName(O)),O._sealed=!0,S&&(S._sealed=!1),function(g,v,S,O){if(g.__props__=[],O&&O.__props__&&(g.__props__=O.__props__.slice()),S)for(var X in function(g,v){for(var S in g){var O=g[S],X=Xe(O,!1);if(X&&(O=g[S]=X),O){var Y=O.notify;Y&&He(O,S,Y,g),"type"in O&&ze(O,O.type,v,S)}}}(S,v),S){var Y=S[X];Y.get||Y.set?ii(g,v,X,Y):ei(g,v,X,Y)}var te=De(g);g.__values__=g.__props__.filter(function(g){return!1!==te[g+"$_$serializable"]})}(O,v,g.properties,S);var Y=g.editor;return Y&&Pt(S,X.Component)&&X.Component._registerEditorProps(O,Y),O}function si(g){var v;return null==g||null===(v=g.hasOwnProperty)||void 0===v?void 0:v.call(g,"__values__")}ri._isCCClass=function(g){var v;return null==g||null===(v=g.hasOwnProperty)||void 0===v?void 0:v.call(g,e_)},ri.fastDefine=function(g,v,S){Gt(g,v);for(var O=v.__props__=v.__values__=Object.keys(S),X=De(v),Y=0;Y<O.length;Y++){var te=O[Y];X[te+ec+"visible"]=!1,X[te+ec+"default"]=S[te]}},ri.Attr=es,ri.attr=Pe,ri.isCCClassOrFastDefined=si,ri.getInheritanceChain=function(g){for(var v=[];g=Bt(g);)g!==Object&&v.push(g);return v};var eg={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function oi(g,v,S,O){var X=null,Y="";function a(){return Y=O+ec,X=De(g)}"type"in v&&void 0===v.type&&q(3660,O,S);var te=v.type;te&&(eg[te]?(X||a())[Y+"type"]=te:"Object"===te||("object"==(void 0===te?"undefined":_type_of(te))?re.isEnum(te)?Je(X||a(),O,te):ie.isBitMask(te)&&((X||a())[Y+"type"]=em,X[Y+"bitmaskList"]=ie.getList(te)):"function"==typeof te&&((X||a())[Y+"type"]="Object",X[Y+"ctor"]=te))),"default"in v&&((X||a())[Y+"default"]=v.default);var ti,u=function(g,S){if(g in v){var O=v[g];(void 0===O?"undefined":_type_of(O))===S&&((X||a())[Y+g]=O)}};v.editorOnly&&((X||a())[Y+"editorOnly"]=!0),v.__internalFlags&eh.STANDALONE?ti=!0===v.serializable||0!=(v.__internalFlags&eh.IMPLICIT_SERIALIZABLE):!1===v.serializable&&(ti=!1),void 0!==ti&&((X||a())[Y+"serializable"]=ti),u("formerlySerializedAs","string");var tr=v.range;tr&&Array.isArray(tr)&&tr.length>=2&&((X||a())[Y+"min"]=tr[0],X[Y+"max"]=tr[1],tr.length>2&&(X[Y+"step"]=tr[2])),u("min","number"),u("max","number"),u("step","number")}ri.isArray=function(g){return g=ni(g),Array.isArray(g)},ri.getDefault=ni,ri.escapeForJS=function(g){return JSON.stringify(g).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},ri.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,ri.getNewValueTypeCode=function(g){for(var v=vt(g),S=g.constructor,O="new "+v+"(",X=0;X<S.__props__.length;X++)O+=g[S.__props__[X]],X<S.__props__.length-1&&(O+=",");return O+")"},X.Class=ri;var ey=Math.PI/180,eS=180/Math.PI,eT=Math.random,eE=g("aJ",.5*Math.PI),eC=g("aK",2*Math.PI),ex=g("aL",1e-6);function di(g,v){return Math.abs(g-v)<=ex*Math.max(1,Math.abs(g),Math.abs(v))}function pi(g,v,S){return S=S||ex,Math.abs(g-v)<=S}function mi(g,v,S){if(v>S){var O=v;v=S,S=O}return g<v?v:g>S?S:g}function gi(g){return g<0?0:g>1?1:g}function vi(g,v,S){return g+(v-g)*S}function yi(g){return g*ey}function Si(g){return g*eS}function Ai(){return eT()}function Ti(g){eT=g}function Ei(g,v){return Ai()*(v-g)+g}function Ci(g,v){return Math.floor(Ei(g,v))}function bi(g){return(g=(9301*g+49297)%233280)/233280}function xi(g,v,S){return bi(g)*(S-v)+v}function Ri(g,v,S){return Math.floor(xi(g,v,S))}function wi(g){return b(g)}function Ii(g,v){return g-Math.floor(g/v)*v}function Bi(g,v){return g=Ii(g,2*v),v-Math.abs(g-v)}function Pi(g,v,S){return(S-g)/(v-g)}function Di(g){return Math.abs(g.x)>Math.abs(g.y)?Math.abs(g.x)>Math.abs(g.z)?g.x:g.z:Math.abs(g.y)>Math.abs(g.z)?g.y:g.z}function Oi(g,v){return Math.abs(g)>Math.abs(v)?g:v}function Mi(g,v){v.forEach(function(v){Object.defineProperty(g,v,{enumerable:!0})})}var eb,eR,ew,eI=(eb=new Float32Array(1),eR=new Int32Array(eb.buffer),function(g){eb[0]=g;var v=eR[0],S=v>>16&32768,O=0x7fffffff&v,X=O-0x38000000+4096>>13;return X=O<0x38800000?0:X,X=O>=0x47800000?31744:X,X=O>0x7f800000?32256:X,eR[0]=S|X,eR[0]}),eB=function(){var g=new Float32Array(1),v=new Int32Array(g.buffer);return function(S){var O,X=32767&S,Y=X<<13;return 31744!==Y?(Y+=0x38000000,0===X?Y=(1048575&Y)>>1:32767===X&&(Y=0x7fffffff)):Y=0x7f800000,O=(S>>15&1)<<31|Y,v[0]=O,g[0]}}();function Vi(g){return eI(g)}function Ui(g){return eB(g)}var eP,eD,eM,eO,eL=g("as",function(g){function e(v,S,O){var X;return X=g.call(this)||this,"object"==(void 0===v?"undefined":_type_of(v))?(X.x=v.x,X.y=v.y,X.z=v.z):(X.x=v||0,X.y=S||0,X.z=O||0),X}s(e,g),e.zero=function(g){return g.x=0,g.y=0,g.z=0,g},e.clone=function(g){return new e(g.x,g.y,g.z)},e.copy=function(g,v){return g.x=v.x,g.y=v.y,g.z=v.z,g},e.set=function(g,v,S,O){return g.x=v,g.y=S,g.z=O,g},e.add=function(g,v,S){return g.x=v.x+S.x,g.y=v.y+S.y,g.z=v.z+S.z,g},e.subtract=function(g,v,S){return g.x=v.x-S.x,g.y=v.y-S.y,g.z=v.z-S.z,g},e.multiply=function(g,v,S){return g.x=v.x*S.x,g.y=v.y*S.y,g.z=v.z*S.z,g},e.divide=function(g,v,S){return g.x=v.x/S.x,g.y=v.y/S.y,g.z=v.z/S.z,g},e.ceil=function(g,v){return g.x=Math.ceil(v.x),g.y=Math.ceil(v.y),g.z=Math.ceil(v.z),g},e.floor=function(g,v){return g.x=Math.floor(v.x),g.y=Math.floor(v.y),g.z=Math.floor(v.z),g},e.min=function(g,v,S){return g.x=Math.min(v.x,S.x),g.y=Math.min(v.y,S.y),g.z=Math.min(v.z,S.z),g},e.max=function(g,v,S){return g.x=Math.max(v.x,S.x),g.y=Math.max(v.y,S.y),g.z=Math.max(v.z,S.z),g},e.round=function(g,v){return g.x=Math.round(v.x),g.y=Math.round(v.y),g.z=Math.round(v.z),g},e.multiplyScalar=function(g,v,S){return g.x=v.x*S,g.y=v.y*S,g.z=v.z*S,g},e.scaleAndAdd=function(g,v,S,O){return g.x=v.x+S.x*O,g.y=v.y+S.y*O,g.z=v.z+S.z*O,g},e.distance=function(g,v){var S=v.x-g.x,O=v.y-g.y,X=v.z-g.z;return Math.sqrt(S*S+O*O+X*X)},e.squaredDistance=function(g,v){var S=v.x-g.x,O=v.y-g.y,X=v.z-g.z;return S*S+O*O+X*X},e.len=function(g){var v=g.x,S=g.y,O=g.z;return Math.sqrt(v*v+S*S+O*O)},e.lengthSqr=function(g){var v=g.x,S=g.y,O=g.z;return v*v+S*S+O*O},e.negate=function(g,v){return g.x=-v.x,g.y=-v.y,g.z=-v.z,g},e.invert=function(g,v){return g.x=1/v.x,g.y=1/v.y,g.z=1/v.z,g},e.invertSafe=function(g,v){var S=v.x,O=v.y,X=v.z;return Math.abs(S)<ex?g.x=0:g.x=1/S,Math.abs(O)<ex?g.y=0:g.y=1/O,Math.abs(X)<ex?g.z=0:g.z=1/X,g},e.normalize=function(g,v){var S=v.x,O=v.y,X=v.z,Y=S*S+O*O+X*X;return Y>0?(Y=1/Math.sqrt(Y),g.x=S*Y,g.y=O*Y,g.z=X*Y):(g.x=0,g.y=0,g.z=0),g},e.dot=function(g,v){return g.x*v.x+g.y*v.y+g.z*v.z},e.cross=function(g,v,S){var O=v.x,X=v.y,Y=v.z,te=S.x,ti=S.y,tr=S.z;return g.x=X*tr-Y*ti,g.y=Y*te-O*tr,g.z=O*ti-X*te,g},e.lerp=function(g,v,S,O){return g.x=v.x+O*(S.x-v.x),g.y=v.y+O*(S.y-v.y),g.z=v.z+O*(S.z-v.z),g},e.random=function(g,v){v=v||1;var S=2*Ai()*Math.PI,O=2*Ai()-1,X=Math.sqrt(1-O*O);return g.x=X*Math.cos(S)*v,g.y=X*Math.sin(S)*v,g.z=O*v,g},e.transformMat4=function(g,v,S){var O=v.x,X=v.y,Y=v.z,te=S.m03*O+S.m07*X+S.m11*Y+S.m15;return te=te?1/te:1,g.x=(S.m00*O+S.m04*X+S.m08*Y+S.m12)*te,g.y=(S.m01*O+S.m05*X+S.m09*Y+S.m13)*te,g.z=(S.m02*O+S.m06*X+S.m10*Y+S.m14)*te,g},e.transformMat4Normal=function(g,v,S){var O=v.x,X=v.y,Y=v.z,te=S.m03*O+S.m07*X+S.m11*Y;return te=te?1/te:1,g.x=(S.m00*O+S.m04*X+S.m08*Y)*te,g.y=(S.m01*O+S.m05*X+S.m09*Y)*te,g.z=(S.m02*O+S.m06*X+S.m10*Y)*te,g},e.transformMat3=function(g,v,S){var O=v.x,X=v.y,Y=v.z;return g.x=O*S.m00+X*S.m03+Y*S.m06,g.y=O*S.m01+X*S.m04+Y*S.m07,g.z=O*S.m02+X*S.m05+Y*S.m08,g},e.transformAffine=function(g,v,S){var O=v.x,X=v.y,Y=v.z;return g.x=S.m00*O+S.m04*X+S.m08*Y+S.m12,g.y=S.m01*O+S.m05*X+S.m09*Y+S.m13,g.z=S.m02*O+S.m06*X+S.m10*Y+S.m14,g},e.transformQuat=function(g,v,S){var O=S.w*v.x+S.y*v.z-S.z*v.y,X=S.w*v.y+S.z*v.x-S.x*v.z,Y=S.w*v.z+S.x*v.y-S.y*v.x,te=-S.x*v.x-S.y*v.y-S.z*v.z;return g.x=O*S.w+te*-S.x+X*-S.z-Y*-S.y,g.y=X*S.w+te*-S.y+Y*-S.x-O*-S.z,g.z=Y*S.w+te*-S.z+O*-S.y-X*-S.x,g},e.transformRTS=function(g,v,S,O,X){var Y=v.x*X.x,te=v.y*X.y,ti=v.z*X.z,tr=S.w*Y+S.y*ti-S.z*te,ta=S.w*te+S.z*Y-S.x*ti,th=S.w*ti+S.x*te-S.y*Y,tu=-S.x*Y-S.y*te-S.z*ti;return g.x=tr*S.w+tu*-S.x+ta*-S.z-th*-S.y+O.x,g.y=ta*S.w+tu*-S.y+th*-S.x-tr*-S.z+O.y,g.z=th*S.w+tu*-S.z+tr*-S.y-ta*-S.x+O.z,g},e.transformInverseRTS=function(g,v,S,O,X){var Y=v.x-O.x,te=v.y-O.y,ti=v.z-O.z,tr=S.w*Y-S.y*ti+S.z*te,ta=S.w*te-S.z*Y+S.x*ti,th=S.w*ti-S.x*te+S.y*Y,tu=S.x*Y+S.y*te+S.z*ti;return g.x=(tr*S.w+tu*S.x+ta*S.z-th*S.y)/X.x,g.y=(ta*S.w+tu*S.y+th*S.x-tr*S.z)/X.y,g.z=(th*S.w+tu*S.z+tr*S.y-ta*S.x)/X.z,g},e.rotateX=function(g,v,S,O){var X=v.x-S.x,Y=v.y-S.y,te=v.z-S.z,ti=Math.cos(O),tr=Math.sin(O),ta=X,th=Y*ti-te*tr,tu=Y*tr+te*ti;return g.x=ta+S.x,g.y=th+S.y,g.z=tu+S.z,g},e.rotateY=function(g,v,S,O){var X=v.x-S.x,Y=v.y-S.y,te=v.z-S.z,ti=Math.cos(O),tr=Math.sin(O),ta=te*tr+X*ti,th=Y,tu=te*ti-X*tr;return g.x=ta+S.x,g.y=th+S.y,g.z=tu+S.z,g},e.rotateZ=function(g,v,S,O){var X=v.x-S.x,Y=v.y-S.y,te=v.z-S.z,ti=Math.cos(O),tr=Math.sin(O),ta=X*ti-Y*tr,th=X*tr+Y*ti,tu=te;return g.x=ta+S.x,g.y=th+S.y,g.z=tu+S.z,g},e.rotateN=function(g,v,S,O,X){var Y=v.x-S.x,te=v.y-S.y,ti=v.z-S.z,tr=O.x,ta=O.y,th=O.z,tu=Math.cos(X),tl=Math.sin(X),tc=Y*(tr*tr*(1-tu)+tu)+te*(tr*ta*(1-tu)-th*tl)+ti*(tr*th*(1-tu)+ta*tl),t_=Y*(tr*ta*(1-tu)+th*tl)+te*(ta*ta*(1-tu)+tu)+ti*(ta*th*(1-tu)-tr*tl),tf=Y*(tr*th*(1-tu)-ta*tl)+te*(ta*th*(1-tu)+tr*tl)+ti*(th*th*(1-tu)+tu);return g.x=tc+S.x,g.y=t_+S.y,g.z=tf+S.z,g},e.toArray=function(g,v,S){return void 0===S&&(S=0),g[S+0]=v.x,g[S+1]=v.y,g[S+2]=v.z,g},e.fromArray=function(g,v,S){return void 0===S&&(S=0),g.x=v[S+0],g.y=v[S+1],g.z=v[S+2],g},e.strictEquals=function(g,v){return g.x===v.x&&g.y===v.y&&g.z===v.z},e.equals=function(g,v,S){void 0===S&&(S=ex);var O=g.x,X=g.y,Y=g.z,te=v.x,ti=v.y,tr=v.z;return Math.abs(O-te)<=S*Math.max(1,Math.abs(O),Math.abs(te))&&Math.abs(X-ti)<=S*Math.max(1,Math.abs(X),Math.abs(ti))&&Math.abs(Y-tr)<=S*Math.max(1,Math.abs(Y),Math.abs(tr))},e.angle=function(g,v){var S=g.x*g.x+g.y*g.y+g.z*g.z,O=v.x*v.x+v.y*v.y+v.z*v.z;if(0===S||0===O)return 0;var X=(g.x*v.x+g.y*v.y+g.z*v.z)/Math.sqrt(S*O);return X=mi(X,-1,1),Math.acos(X)},e.projectOnPlane=function(g,v,S){return e.subtract(g,v,e.project(g,v,S))},e.project=function(g,v,S){var O=e.lengthSqr(S);return O<1e-6?e.set(g,0,0,0):e.multiplyScalar(g,S,e.dot(v,S)/O)},e.moveTowards=function(g,v,S,O){var X=S.x-v.x,Y=S.y-v.y,te=S.z-v.z,ti=X*X+Y*Y+te*te;if(0===ti||O>=0&&ti<O*O)return g.x=S.x,g.y=S.y,g.z=S.z,g;var tr=O/Math.sqrt(ti);return g.x=v.x+X*tr,g.y=v.y+Y*tr,g.z=v.z+te*tr,g},e.generateOrthogonal=function(g,v){var S=v.x,O=v.y,X=v.z,Y=Math.abs(S),te=Math.abs(O),ti=Math.abs(X);return Y<te&&Y<ti?e.set(g,0,X,-O):te<ti?e.set(g,X,0,-S):e.set(g,O,-S,0),e.normalize(g,g)};var v=e.prototype;return v.clone=function(){return new e(this.x,this.y,this.z)},v.set=function(g,v,S){return"object"==(void 0===g?"undefined":_type_of(g))?(this.x=g.x,this.y=g.y,this.z=g.z):(this.x=g||0,this.y=v||0,this.z=S||0),this},v.equals=function(g,v){return void 0===v&&(v=ex),Math.abs(this.x-g.x)<=v&&Math.abs(this.y-g.y)<=v&&Math.abs(this.z-g.z)<=v},v.equals3f=function(g,v,S,O){return void 0===O&&(O=ex),Math.abs(this.x-g)<=O&&Math.abs(this.y-v)<=O&&Math.abs(this.z-S)<=O},v.strictEquals=function(g){return this.x===g.x&&this.y===g.y&&this.z===g.z},v.strictEquals3f=function(g,v,S){return this.x===g&&this.y===v&&this.z===S},v.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},v.lerp=function(g,v){return this.x+=v*(g.x-this.x),this.y+=v*(g.y-this.y),this.z+=v*(g.z-this.z),this},v.add=function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this},v.add3f=function(g,v,S){return this.x+=g,this.y+=v,this.z+=S,this},v.subtract=function(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this},v.subtract3f=function(g,v,S){return this.x-=g,this.y-=v,this.z-=S,this},v.multiplyScalar=function(g){return"object"==(void 0===g?"undefined":_type_of(g))&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=g,this.y*=g,this.z*=g,this},v.multiply=function(g){return"object"!=(void 0===g?"undefined":_type_of(g))&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=g.x,this.y*=g.y,this.z*=g.z,this},v.multiply3f=function(g,v,S){return this.x*=g,this.y*=v,this.z*=S,this},v.divide=function(g){return this.x/=g.x,this.y/=g.y,this.z/=g.z,this},v.divide3f=function(g,v,S){return this.x/=g,this.y/=v,this.z/=S,this},v.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},v.clampf=function(g,v){return this.x=mi(this.x,g.x,v.x),this.y=mi(this.y,g.y,v.y),this.z=mi(this.z,g.z,v.z),this},v.dot=function(g){return this.x*g.x+this.y*g.y+this.z*g.z},v.cross=function(g){var v=this.x,S=this.y,O=this.z,X=g.x,Y=g.y,te=g.z;return this.x=S*te-O*Y,this.y=O*X-v*te,this.z=v*Y-S*X,this},v.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},v.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},v.normalize=function(){var g=this.x,v=this.y,S=this.z,O=g*g+v*v+S*S;return O>0&&(O=1/Math.sqrt(O),this.x=g*O,this.y=v*O,this.z=S*O),this},v.transformMat4=function(g){var v=this.x,S=this.y,O=this.z,X=g.m03*v+g.m07*S+g.m11*O+g.m15;return X=X?1/X:1,this.x=(g.m00*v+g.m04*S+g.m08*O+g.m12)*X,this.y=(g.m01*v+g.m05*S+g.m09*O+g.m13)*X,this.z=(g.m02*v+g.m06*S+g.m10*O+g.m14)*X,this},e}(tq));function Yi(g,v,S){return new eL(g,v,S)}ew=eL,eL.UNIT_X=Object.freeze(new ew(1,0,0)),eL.UNIT_Y=Object.freeze(new ew(0,1,0)),eL.UNIT_Z=Object.freeze(new ew(0,0,1)),eL.RIGHT=Object.freeze(new ew(1,0,0)),eL.UP=Object.freeze(new ew(0,1,0)),eL.FORWARD=Object.freeze(new ew(0,0,-1)),eL.ZERO=Object.freeze(new ew(0,0,0)),eL.ONE=Object.freeze(new ew(1,1,1)),eL.NEG_ONE=Object.freeze(new ew(-1,-1,-1)),eL.slerp=(eP=new ew,eD=new ew,eM=new ew,function(g,v,S,O){var X=1e-5,Y=ew.len(v),te=ew.len(S);if(Y<X||te<X)return ew.lerp(g,v,S,O);var ti=vi(Y,te,O),tr=ew.dot(v,S)/(Y*te);if(tr>.99999)return ew.lerp(g,v,S,O);if(tr<-.99999){var ta=ew.multiplyScalar(eP,v,1/Y),th=ew.generateOrthogonal(eD,ta),tu=Math.PI*O;return eG(eM,ta,th,tu),ew.multiplyScalar(g,eM,ti),g}var tl=tr,tc=Math.acos(tl)*O,t_=ew.multiplyScalar(eP,v,1/Y),tf=ew.multiplyScalar(eD,S,1/te);return ew.scaleAndAdd(eM,tf,t_,-tl),ew.normalize(eM,eM),ew.multiplyScalar(eM,eM,Math.sin(tc)),ew.scaleAndAdd(eM,eM,t_,Math.cos(tc)),ew.multiplyScalar(g,eM,ti),g}),eL.signedAngle=(eO=new ew,function(g,v,S){var O=ew.angle(g,v),X=ew.cross(eO,g,v);return ew.dot(X,S)<0?-O:O}),ri.fastDefine("cc.Vec3",eL,{x:0,y:0,z:0}),X.Vec3=eL;var eF,ek,eG=(eF={x:0,y:0,z:0,w:0},function(g,v,S,O){var X=.5*O,Y=Math.sin(X);return eF.x=Y*S.x,eF.y=Y*S.y,eF.z=Y*S.z,eF.w=Math.cos(X),eL.transformQuat(g,v,eF),g});X.v3=Yi;var eV=g("ay",function(g){function e(v,S,O,X,Y,te,ti,tr,ta){var th;return void 0===v&&(v=1),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=1),void 0===te&&(te=0),void 0===ti&&(ti=0),void 0===tr&&(tr=0),void 0===ta&&(ta=1),th=g.call(this)||this,"object"==(void 0===v?"undefined":_type_of(v))?(th.m00=v.m00,th.m01=v.m01,th.m02=v.m02,th.m03=v.m03,th.m04=v.m04,th.m05=v.m05,th.m06=v.m06,th.m07=v.m07,th.m08=v.m08):(th.m00=v,th.m01=S,th.m02=O,th.m03=X,th.m04=Y,th.m05=te,th.m06=ti,th.m07=tr,th.m08=ta),th}s(e,g),e.clone=function(g){return new e(g.m00,g.m01,g.m02,g.m03,g.m04,g.m05,g.m06,g.m07,g.m08)},e.copy=function(g,v){return g.m00=v.m00,g.m01=v.m01,g.m02=v.m02,g.m03=v.m03,g.m04=v.m04,g.m05=v.m05,g.m06=v.m06,g.m07=v.m07,g.m08=v.m08,g},e.set=function(g,v,S,O,X,Y,te,ti,tr,ta){return g.m00=v,g.m01=S,g.m02=O,g.m03=X,g.m04=Y,g.m05=te,g.m06=ti,g.m07=tr,g.m08=ta,g},e.identity=function(g){return g.m00=1,g.m01=0,g.m02=0,g.m03=0,g.m04=1,g.m05=0,g.m06=0,g.m07=0,g.m08=1,g},e.transpose=function(g,v){if(g===v){var S=v.m01,O=v.m02,X=v.m05;g.m01=v.m03,g.m02=v.m06,g.m03=S,g.m05=v.m07,g.m06=O,g.m07=X}else g.m00=v.m00,g.m01=v.m03,g.m02=v.m06,g.m03=v.m01,g.m04=v.m04,g.m05=v.m07,g.m06=v.m02,g.m07=v.m05,g.m08=v.m08;return g},e.invert=function(g,v){var S=v.m00,O=v.m01,X=v.m02,Y=v.m03,te=v.m04,ti=v.m05,tr=v.m06,ta=v.m07,th=v.m08,tu=th*te-ti*ta,tl=-th*Y+ti*tr,tc=ta*Y-te*tr,t_=S*tu+O*tl+X*tc;return 0===t_?(g.m00=0,g.m01=0,g.m02=0,g.m03=0,g.m04=0,g.m05=0,g.m06=0,g.m07=0,g.m08=0,g):(t_=1/t_,g.m00=tu*t_,g.m01=(-th*O+X*ta)*t_,g.m02=(ti*O-X*te)*t_,g.m03=tl*t_,g.m04=(th*S-X*tr)*t_,g.m05=(-ti*S+X*Y)*t_,g.m06=tc*t_,g.m07=(-ta*S+O*tr)*t_,g.m08=(te*S-O*Y)*t_,g)},e.determinant=function(g){var v=g.m00,S=g.m01,O=g.m02,X=g.m03,Y=g.m04,te=g.m05,ti=g.m06,tr=g.m07,ta=g.m08;return v*(ta*Y-te*tr)+S*(-ta*X+te*ti)+O*(tr*X-Y*ti)},e.multiply=function(g,v,S){var O=v.m00,X=v.m01,Y=v.m02,te=v.m03,ti=v.m04,tr=v.m05,ta=v.m06,th=v.m07,tu=v.m08,tl=S.m00,tc=S.m01,t_=S.m02,tf=S.m03,tp=S.m04,tm=S.m05,tg=S.m06,tv=S.m07,ty=S.m08;return g.m00=tl*O+tc*te+t_*ta,g.m01=tl*X+tc*ti+t_*th,g.m02=tl*Y+tc*tr+t_*tu,g.m03=tf*O+tp*te+tm*ta,g.m04=tf*X+tp*ti+tm*th,g.m05=tf*Y+tp*tr+tm*tu,g.m06=tg*O+tv*te+ty*ta,g.m07=tg*X+tv*ti+ty*th,g.m08=tg*Y+tv*tr+ty*tu,g},e.multiplyMat4=function(g,v,S){var O=v.m00,X=v.m01,Y=v.m02,te=v.m03,ti=v.m04,tr=v.m05,ta=v.m06,th=v.m07,tu=v.m08,tl=S.m00,tc=S.m01,t_=S.m02,tf=S.m04,tp=S.m05,tm=S.m06,tg=S.m08,tv=S.m09,ty=S.m10;return g.m00=tl*O+tc*te+t_*ta,g.m01=tl*X+tc*ti+t_*th,g.m02=tl*Y+tc*tr+t_*tu,g.m03=tf*O+tp*te+tm*ta,g.m04=tf*X+tp*ti+tm*th,g.m05=tf*Y+tp*tr+tm*tu,g.m06=tg*O+tv*te+ty*ta,g.m07=tg*X+tv*ti+ty*th,g.m08=tg*Y+tv*tr+ty*tu,g},e.transform=function(g,v,S){this.translate(g,v,S)},e.translate=function(g,v,S){var O=v.m00,X=v.m01,Y=v.m02,te=v.m03,ti=v.m04,tr=v.m05,ta=v.m06,th=v.m07,tu=v.m08,tl=S.x,tc=S.y;return g.m00=O,g.m01=X,g.m02=Y,g.m03=te,g.m04=ti,g.m05=tr,g.m06=tl*O+tc*te+ta,g.m07=tl*X+tc*ti+th,g.m08=tl*Y+tc*tr+tu,g},e.scale=function(g,v,S){var O=S.x,X=S.y;return g.m00=O*v.m00,g.m01=O*v.m01,g.m02=O*v.m02,g.m03=X*v.m03,g.m04=X*v.m04,g.m05=X*v.m05,g.m06=v.m06,g.m07=v.m07,g.m08=v.m08,g},e.rotate=function(g,v,S){var O=v.m00,X=v.m01,Y=v.m02,te=v.m03,ti=v.m04,tr=v.m05,ta=v.m06,th=v.m07,tu=v.m08,tl=Math.sin(S),tc=Math.cos(S);return g.m00=tc*O+tl*te,g.m01=tc*X+tl*ti,g.m02=tc*Y+tl*tr,g.m03=tc*te-tl*O,g.m04=tc*ti-tl*X,g.m05=tc*tr-tl*Y,g.m06=ta,g.m07=th,g.m08=tu,g},e.fromMat4=function(g,v){return g.m00=v.m00,g.m01=v.m01,g.m02=v.m02,g.m03=v.m04,g.m04=v.m05,g.m05=v.m06,g.m06=v.m08,g.m07=v.m09,g.m08=v.m10,g},e.fromViewUp=function(g,v,S){return eL.lengthSqr(v)<ex*ex?(e.identity(g),g):(S=S||eL.UNIT_Y,eL.normalize(eH,eL.cross(eH,S,v)),eL.lengthSqr(eH)<ex*ex?(e.identity(g),g):(eL.cross(ez,v,eH),e.set(g,eH.x,eH.y,eH.z,ez.x,ez.y,ez.z,v.x,v.y,v.z),g))},e.fromTranslation=function(g,v){return g.m00=1,g.m01=0,g.m02=0,g.m03=0,g.m04=1,g.m05=0,g.m06=v.x,g.m07=v.y,g.m08=1,g},e.fromScaling=function(g,v){return g.m00=v.x,g.m01=0,g.m02=0,g.m03=0,g.m04=v.y,g.m05=0,g.m06=0,g.m07=0,g.m08=1,g},e.fromRotation=function(g,v){var S=Math.sin(v),O=Math.cos(v);return g.m00=O,g.m01=S,g.m02=0,g.m03=-S,g.m04=O,g.m05=0,g.m06=0,g.m07=0,g.m08=1,g},e.fromQuat=function(g,v){var S=v.x,O=v.y,X=v.z,Y=v.w,te=S+S,ti=O+O,tr=X+X,ta=S*te,th=O*te,tu=O*ti,tl=X*te,tc=X*ti,t_=X*tr,tf=Y*te,tp=Y*ti,tm=Y*tr;return g.m00=1-tu-t_,g.m03=th-tm,g.m06=tl+tp,g.m01=th+tm,g.m04=1-ta-t_,g.m07=tc-tf,g.m02=tl-tp,g.m05=tc+tf,g.m08=1-ta-tu,g},e.inverseTransposeMat4=function(g,v){var S=v.m00,O=v.m01,X=v.m02,Y=v.m03,te=v.m04,ti=v.m05,tr=v.m06,ta=v.m07,th=v.m08,tu=v.m09,tl=v.m10,tc=v.m11,t_=v.m12,tf=v.m13,tp=v.m14,tm=v.m15,tg=S*ti-O*te,tv=S*tr-X*te,ty=S*ta-Y*te,tS=O*tr-X*ti,tA=O*ta-Y*ti,tT=X*ta-Y*tr,tE=th*tf-tu*t_,tC=th*tp-tl*t_,tx=th*tm-tc*t_,tb=tu*tp-tl*tf,tw=tu*tm-tc*tf,tI=tl*tm-tc*tp,tB=tg*tI-tv*tw+ty*tb+tS*tx-tA*tC+tT*tE;return tB?(tB=1/tB,g.m00=(ti*tI-tr*tw+ta*tb)*tB,g.m01=(tr*tx-te*tI-ta*tC)*tB,g.m02=(te*tw-ti*tx+ta*tE)*tB,g.m03=(X*tw-O*tI-Y*tb)*tB,g.m04=(S*tI-X*tx+Y*tC)*tB,g.m05=(O*tx-S*tw-Y*tE)*tB,g.m06=(tf*tT-tp*tA+tm*tS)*tB,g.m07=(tp*ty-t_*tT-tm*tv)*tB,g.m08=(t_*tA-tf*ty+tm*tg)*tB,g):null},e.toArray=function(g,v,S){return void 0===S&&(S=0),g[S+0]=v.m00,g[S+1]=v.m01,g[S+2]=v.m02,g[S+3]=v.m03,g[S+4]=v.m04,g[S+5]=v.m05,g[S+6]=v.m06,g[S+7]=v.m07,g[S+8]=v.m08,g},e.fromArray=function(g,v,S){return void 0===S&&(S=0),g.m00=v[S+0],g.m01=v[S+1],g.m02=v[S+2],g.m03=v[S+3],g.m04=v[S+4],g.m05=v[S+5],g.m06=v[S+6],g.m07=v[S+7],g.m08=v[S+8],g},e.add=function(g,v,S){return g.m00=v.m00+S.m00,g.m01=v.m01+S.m01,g.m02=v.m02+S.m02,g.m03=v.m03+S.m03,g.m04=v.m04+S.m04,g.m05=v.m05+S.m05,g.m06=v.m06+S.m06,g.m07=v.m07+S.m07,g.m08=v.m08+S.m08,g},e.subtract=function(g,v,S){return g.m00=v.m00-S.m00,g.m01=v.m01-S.m01,g.m02=v.m02-S.m02,g.m03=v.m03-S.m03,g.m04=v.m04-S.m04,g.m05=v.m05-S.m05,g.m06=v.m06-S.m06,g.m07=v.m07-S.m07,g.m08=v.m08-S.m08,g},e.multiplyScalar=function(g,v,S){return g.m00=v.m00*S,g.m01=v.m01*S,g.m02=v.m02*S,g.m03=v.m03*S,g.m04=v.m04*S,g.m05=v.m05*S,g.m06=v.m06*S,g.m07=v.m07*S,g.m08=v.m08*S,g},e.multiplyScalarAndAdd=function(g,v,S,O){return g.m00=S.m00*O+v.m00,g.m01=S.m01*O+v.m01,g.m02=S.m02*O+v.m02,g.m03=S.m03*O+v.m03,g.m04=S.m04*O+v.m04,g.m05=S.m05*O+v.m05,g.m06=S.m06*O+v.m06,g.m07=S.m07*O+v.m07,g.m08=S.m08*O+v.m08,g},e.strictEquals=function(g,v){return g.m00===v.m00&&g.m01===v.m01&&g.m02===v.m02&&g.m03===v.m03&&g.m04===v.m04&&g.m05===v.m05&&g.m06===v.m06&&g.m07===v.m07&&g.m08===v.m08},e.equals=function(g,v,S){return void 0===S&&(S=ex),Math.abs(g.m00-v.m00)<=S*Math.max(1,Math.abs(g.m00),Math.abs(v.m00))&&Math.abs(g.m01-v.m01)<=S*Math.max(1,Math.abs(g.m01),Math.abs(v.m01))&&Math.abs(g.m02-v.m02)<=S*Math.max(1,Math.abs(g.m02),Math.abs(v.m02))&&Math.abs(g.m03-v.m03)<=S*Math.max(1,Math.abs(g.m03),Math.abs(v.m03))&&Math.abs(g.m04-v.m04)<=S*Math.max(1,Math.abs(g.m04),Math.abs(v.m04))&&Math.abs(g.m05-v.m05)<=S*Math.max(1,Math.abs(g.m05),Math.abs(v.m05))&&Math.abs(g.m06-v.m06)<=S*Math.max(1,Math.abs(g.m06),Math.abs(v.m06))&&Math.abs(g.m07-v.m07)<=S*Math.max(1,Math.abs(g.m07),Math.abs(v.m07))&&Math.abs(g.m08-v.m08)<=S*Math.max(1,Math.abs(g.m08),Math.abs(v.m08))},e.toEuler=function(g,v){var S=g.m00,O=g.m01;g.m02;var X=g.m03,Y=g.m04;g.m05;var te=g.m06,ti=g.m07,tr=g.m08;return ti<.999?ti>-.999?(v.x=Math.asin(-ti),v.y=Math.atan2(te,tr),v.z=Math.atan2(O,Y),!0):(v.x=eE,v.y=Math.atan2(X,S),v.z=0,!1):(v.x=-eE,v.y=Math.atan2(-X,S),v.z=0,!1)};var v=e.prototype;return v.clone=function(){var g=this;return new e(g.m00,g.m01,g.m02,g.m03,g.m04,g.m05,g.m06,g.m07,g.m08)},v.set=function(g,v,S,O,X,Y,te,ti,tr){return void 0===g&&(g=1),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=1),void 0===Y&&(Y=0),void 0===te&&(te=0),void 0===ti&&(ti=0),void 0===tr&&(tr=1),"object"==(void 0===g?"undefined":_type_of(g))?(this.m00=g.m00,this.m01=g.m01,this.m02=g.m02,this.m03=g.m03,this.m04=g.m04,this.m05=g.m05,this.m06=g.m06,this.m07=g.m07,this.m08=g.m08):(this.m00=g,this.m01=v,this.m02=S,this.m03=O,this.m04=X,this.m05=Y,this.m06=te,this.m07=ti,this.m08=tr),this},v.equals=function(g,v){return void 0===v&&(v=ex),Math.abs(this.m00-g.m00)<=v*Math.max(1,Math.abs(this.m00),Math.abs(g.m00))&&Math.abs(this.m01-g.m01)<=v*Math.max(1,Math.abs(this.m01),Math.abs(g.m01))&&Math.abs(this.m02-g.m02)<=v*Math.max(1,Math.abs(this.m02),Math.abs(g.m02))&&Math.abs(this.m03-g.m03)<=v*Math.max(1,Math.abs(this.m03),Math.abs(g.m03))&&Math.abs(this.m04-g.m04)<=v*Math.max(1,Math.abs(this.m04),Math.abs(g.m04))&&Math.abs(this.m05-g.m05)<=v*Math.max(1,Math.abs(this.m05),Math.abs(g.m05))&&Math.abs(this.m06-g.m06)<=v*Math.max(1,Math.abs(this.m06),Math.abs(g.m06))&&Math.abs(this.m07-g.m07)<=v*Math.max(1,Math.abs(this.m07),Math.abs(g.m07))&&Math.abs(this.m08-g.m08)<=v*Math.max(1,Math.abs(this.m08),Math.abs(g.m08))},v.strictEquals=function(g){return this.m00===g.m00&&this.m01===g.m01&&this.m02===g.m02&&this.m03===g.m03&&this.m04===g.m04&&this.m05===g.m05&&this.m06===g.m06&&this.m07===g.m07&&this.m08===g.m08},v.toString=function(){var g=this;return"[\n"+g.m00+", "+g.m01+", "+g.m02+",\n"+g.m03+",\n"+g.m04+", "+g.m05+",\n"+g.m06+", "+g.m07+",\n"+g.m08+"\n]"},v.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},v.transpose=function(){var g=this.m01,v=this.m02,S=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=g,this.m05=this.m07,this.m06=v,this.m07=S,this},v.invert=function(){var g=this.m00,v=this.m01,S=this.m02,O=this.m03,X=this.m04,Y=this.m05,te=this.m06,ti=this.m07,tr=this.m08,ta=tr*X-Y*ti,th=-tr*O+Y*te,tu=ti*O-X*te,tl=g*ta+v*th+S*tu;return 0===tl?(this.set(0,0,0,0,0,0,0,0,0),this):(tl=1/tl,this.m00=ta*tl,this.m01=(-tr*v+S*ti)*tl,this.m02=(Y*v-S*X)*tl,this.m03=th*tl,this.m04=(tr*g-S*te)*tl,this.m05=(-Y*g+S*O)*tl,this.m06=tu*tl,this.m07=(-ti*g+v*te)*tl,this.m08=(X*g-v*O)*tl,this)},v.determinant=function(){var g=this.m00,v=this.m01,S=this.m02,O=this.m03,X=this.m04,Y=this.m05,te=this.m06,ti=this.m07,tr=this.m08;return g*(tr*X-Y*ti)+v*(-tr*O+Y*te)+S*(ti*O-X*te)},v.add=function(g){return this.m00+=g.m00,this.m01+=g.m01,this.m02+=g.m02,this.m03+=g.m03,this.m04+=g.m04,this.m05+=g.m05,this.m06+=g.m06,this.m07+=g.m07,this.m08+=g.m08,this},v.subtract=function(g){return this.m00-=g.m00,this.m01-=g.m01,this.m02-=g.m02,this.m03-=g.m03,this.m04-=g.m04,this.m05-=g.m05,this.m06-=g.m06,this.m07-=g.m07,this.m08-=g.m08,this},v.multiply=function(g){var v=this.m00,S=this.m01,O=this.m02,X=this.m03,Y=this.m04,te=this.m05,ti=this.m06,tr=this.m07,ta=this.m08,th=g.m00,tu=g.m01,tl=g.m02,tc=g.m03,t_=g.m04,tf=g.m05,tp=g.m06,tm=g.m07,tg=g.m08;return this.m00=th*v+tu*X+tl*ti,this.m01=th*S+tu*Y+tl*tr,this.m02=th*O+tu*te+tl*ta,this.m03=tc*v+t_*X+tf*ti,this.m04=tc*S+t_*Y+tf*tr,this.m05=tc*O+t_*te+tf*ta,this.m06=tp*v+tm*X+tg*ti,this.m07=tp*S+tm*Y+tg*tr,this.m08=tp*O+tm*te+tg*ta,this},v.multiplyScalar=function(g){return this.m00*=g,this.m01*=g,this.m02*=g,this.m03*=g,this.m04*=g,this.m05*=g,this.m06*=g,this.m07*=g,this.m08*=g,this},v.scale=function(g){var v=g.x,S=g.y;return this.m00=v*this.m00,this.m01=v*this.m01,this.m02=v*this.m02,this.m03=S*this.m03,this.m04=S*this.m04,this.m05=S*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},v.rotate=function(g){var v=this.m00,S=this.m01,O=this.m02,X=this.m03,Y=this.m04,te=this.m05,ti=this.m06,tr=this.m07,ta=this.m08,th=Math.sin(g),tu=Math.cos(g);return this.m00=tu*v+th*X,this.m01=tu*S+th*Y,this.m02=tu*O+th*te,this.m03=tu*X-th*v,this.m04=tu*Y-th*S,this.m05=tu*te-th*O,this.m06=ti,this.m07=tr,this.m08=ta,this},v.fromQuat=function(g){var v=g.x,S=g.y,O=g.z,X=g.w,Y=v+v,te=S+S,ti=O+O,tr=v*Y,ta=S*Y,th=S*te,tu=O*Y,tl=O*te,tc=O*ti,t_=X*Y,tf=X*te,tp=X*ti;return this.m00=1-th-tc,this.m03=ta-tp,this.m06=tu+tf,this.m01=ta+tp,this.m04=1-tr-tc,this.m07=tl-t_,this.m02=tu-tf,this.m05=tl+t_,this.m08=1-tr-th,this},e}(tq));ek=eV,eV.IDENTITY=Object.freeze(new ek);var eU,eH=new eL,ez=new eL;ri.fastDefine("cc.Mat3",eV,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),X.Mat3=eV;var eW=g("aw",function(g){function e(v,S,O,X){var Y;return Y=g.call(this)||this,"object"==(void 0===v?"undefined":_type_of(v))?(Y.x=v.x,Y.y=v.y,Y.z=v.z,Y.w=v.w):(Y.x=v||0,Y.y=S||0,Y.z=O||0,Y.w=null!=X?X:1),Y}s(e,g),e.clone=function(g){return new e(g.x,g.y,g.z,g.w)},e.copy=function(g,v){return g.x=v.x,g.y=v.y,g.z=v.z,g.w=v.w,g},e.set=function(g,v,S,O,X){return g.x=v,g.y=S,g.z=O,g.w=X,g},e.identity=function(g){return g.x=0,g.y=0,g.z=0,g.w=1,g},e.rotationTo=function(g,v,S){var O=eL.dot(v,S);return O<-.999999?(eL.cross(eK,eL.UNIT_X,v),eK.length()<1e-6&&eL.cross(eK,eL.UNIT_Y,v),eL.normalize(eK,eK),e.fromAxisAngle(g,eK,Math.PI),g):O>.999999?(g.x=0,g.y=0,g.z=0,g.w=1,g):(eL.cross(eK,v,S),g.x=eK.x,g.y=eK.y,g.z=eK.z,g.w=1+O,e.normalize(g,g))},e.getAxisAngle=function(g,v){var S=2*Math.acos(v.w),O=Math.sin(S/2);return 0!==O?(g.x=v.x/O,g.y=v.y/O,g.z=v.z/O):(g.x=1,g.y=0,g.z=0),S},e.multiply=function(g,v,S){var O=v.x*S.w+v.w*S.x+v.y*S.z-v.z*S.y,X=v.y*S.w+v.w*S.y+v.z*S.x-v.x*S.z,Y=v.z*S.w+v.w*S.z+v.x*S.y-v.y*S.x,te=v.w*S.w-v.x*S.x-v.y*S.y-v.z*S.z;return g.x=O,g.y=X,g.z=Y,g.w=te,g},e.multiplyScalar=function(g,v,S){return g.x=v.x*S,g.y=v.y*S,g.z=v.z*S,g.w=v.w*S,g},e.scaleAndAdd=function(g,v,S,O){return g.x=v.x+S.x*O,g.y=v.y+S.y*O,g.z=v.z+S.z*O,g.w=v.w+S.w*O,g},e.rotateX=function(g,v,S){S*=.5;var O=Math.sin(S),X=Math.cos(S),Y=v.x,te=v.y,ti=v.z,tr=v.w;return g.x=Y*X+tr*O,g.y=te*X+ti*O,g.z=ti*X-te*O,g.w=tr*X-Y*O,g},e.rotateY=function(g,v,S){S*=.5;var O=Math.sin(S),X=Math.cos(S),Y=v.x,te=v.y,ti=v.z,tr=v.w;return g.x=Y*X-ti*O,g.y=te*X+tr*O,g.z=ti*X+Y*O,g.w=tr*X-te*O,g},e.rotateZ=function(g,v,S){S*=.5;var O=Math.sin(S),X=Math.cos(S),Y=v.x,te=v.y,ti=v.z,tr=v.w;return g.x=Y*X+te*O,g.y=te*X-Y*O,g.z=ti*X+tr*O,g.w=tr*X-ti*O,g},e.rotateAround=function(g,v,S,O){return e.invert(eq,v),eL.transformQuat(eK,S,eq),e.fromAxisAngle(eq,eK,O),e.multiply(g,v,eq),g},e.rotateAroundLocal=function(g,v,S,O){return e.fromAxisAngle(eq,S,O),e.multiply(g,v,eq),g},e.calculateW=function(g,v){return g.x=v.x,g.y=v.y,g.z=v.z,g.w=Math.sqrt(Math.abs(1-v.x*v.x-v.y*v.y-v.z*v.z)),g},e.dot=function(g,v){return g.x*v.x+g.y*v.y+g.z*v.z+g.w*v.w},e.lerp=function(g,v,S,O){return g.x=v.x+O*(S.x-v.x),g.y=v.y+O*(S.y-v.y),g.z=v.z+O*(S.z-v.z),g.w=v.w+O*(S.w-v.w),g},e.slerp=function(g,v,S,O){var X=0,Y=0,te=S.x,ti=S.y,tr=S.z,ta=S.w,th=v.x*S.x+v.y*S.y+v.z*S.z+v.w*S.w;if(th<0&&(th=-th,te=-te,ti=-ti,tr=-tr,ta=-ta),1-th>1e-6){var tu=Math.acos(th),tl=Math.sin(tu);X=Math.sin((1-O)*tu)/tl,Y=Math.sin(O*tu)/tl}else X=1-O,Y=O;return g.x=X*v.x+Y*te,g.y=X*v.y+Y*ti,g.z=X*v.z+Y*tr,g.w=X*v.w+Y*ta,g},e.sqlerp=function(g,v,S,O,X,Y){return e.slerp(eq,v,X,Y),e.slerp(eY,S,O,Y),e.slerp(g,eq,eY,2*Y*(1-Y)),g},e.invert=function(g,v){var S=v.x*v.x+v.y*v.y+v.z*v.z+v.w*v.w,O=S?1/S:0;return g.x=-v.x*O,g.y=-v.y*O,g.z=-v.z*O,g.w=v.w*O,g},e.conjugate=function(g,v){return g.x=-v.x,g.y=-v.y,g.z=-v.z,g.w=v.w,g},e.len=function(g){return Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z+g.w*g.w)},e.lengthSqr=function(g){return g.x*g.x+g.y*g.y+g.z*g.z+g.w*g.w},e.normalize=function(g,v){var S=v.x*v.x+v.y*v.y+v.z*v.z+v.w*v.w;return S>0?(S=1/Math.sqrt(S),g.x=v.x*S,g.y=v.y*S,g.z=v.z*S,g.w=v.w*S):(g.x=0,g.y=0,g.z=0,g.w=0),g},e.fromAxes=function(g,v,S,O){return eV.set(eJ,v.x,v.y,v.z,S.x,S.y,S.z,O.x,O.y,O.z),e.normalize(g,e.fromMat3(g,eJ))},e.fromViewUp=function(g,v,S){return eV.fromViewUp(eJ,v,S),e.normalize(g,e.fromMat3(g,eJ))},e.fromAxisAngle=function(g,v,S){S*=.5;var O=Math.sin(S);return g.x=O*v.x,g.y=O*v.y,g.z=O*v.z,g.w=Math.cos(S),g},e.fromMat3=function(g,v){var S=v.m00,O=v.m01,X=v.m02,Y=v.m03,te=v.m04,ti=v.m05,tr=v.m06,ta=v.m07,th=v.m08,tu=S-te-th,tl=te-S-th,tc=th-S-te,t_=0,tf=S+te+th;tu>tf&&(tf=tu,t_=1),tl>tf&&(tf=tl,t_=2),tc>tf&&(tf=tc,t_=3);var tp=.5*Math.sqrt(tf+1),tm=.25/tp;switch(t_){case 0:g.w=tp,g.x=(ti-ta)*tm,g.y=(tr-X)*tm,g.z=(O-Y)*tm;break;case 1:g.w=(ti-ta)*tm,g.x=tp,g.y=(O+Y)*tm,g.z=(tr+X)*tm;break;case 2:g.w=(tr-X)*tm,g.x=(O+Y)*tm,g.y=tp,g.z=(ti+ta)*tm;break;case 3:g.w=(O-Y)*tm,g.x=(tr+X)*tm,g.y=(ti+ta)*tm,g.z=tp;break;default:g.w=1,g.x=0,g.y=0,g.z=0}return g},e.fromEuler=function(g,v,S,O){v*=eZ,S*=eZ,O*=eZ;var X=Math.sin(v),Y=Math.cos(v),te=Math.sin(S),ti=Math.cos(S),tr=Math.sin(O),ta=Math.cos(O);return g.x=X*ti*ta+Y*te*tr,g.y=Y*te*ta+X*ti*tr,g.z=Y*ti*tr-X*te*ta,g.w=Y*ti*ta-X*te*tr,g},e.fromAngleZ=function(g,v){return v*=eZ,g.x=g.y=0,g.z=Math.sin(v),g.w=Math.cos(v),g},e.toAxisX=function(g,v){var S=2*v.y,O=2*v.z;return g.x=1-S*v.y-O*v.z,g.y=S*v.x+O*v.w,g.z=O*v.x-S*v.w,g},e.toAxisY=function(g,v){var S=2*v.x,O=2*v.y,X=2*v.z;return g.x=O*v.x-X*v.w,g.y=1-S*v.x-X*v.z,g.z=X*v.y+S*v.w,g},e.toAxisZ=function(g,v){var S=2*v.x,O=2*v.y,X=2*v.z;return g.x=X*v.x+O*v.w,g.y=X*v.y-S*v.w,g.z=1-S*v.x-O*v.y,g},e.toEuler=function(g,v,S){var O=v.x,X=v.y,Y=v.z,te=v.w,ti=0,tr=0,ta=0,th=O*X+Y*te;if(th>.499999)ti=0,tr=Si(2*Math.atan2(O,te)),ta=90;else if(th<-.499999)ti=0,tr=-Si(2*Math.atan2(O,te)),ta=-90;else{var tu=O*O,tl=X*X,tc=Y*Y;ti=Si(Math.atan2(2*O*te-2*X*Y,1-2*tu-2*tc)),tr=Si(Math.atan2(2*X*te-2*O*Y,1-2*tl-2*tc)),ta=Si(Math.asin(2*th)),S&&(ti=-180*Math.sign(ti+1e-6)+ti,tr=-180*Math.sign(tr+1e-6)+tr,ta=180*Math.sign(ta+1e-6)-ta)}return g.x=ti,g.y=tr,g.z=ta,g},e.toEulerInYXZOrder=function(g,v){eV.fromQuat(eJ,v),eV.toEuler(eJ,g),g.x=Si(g.x),g.y=Si(g.y),g.z=Si(g.z)},e.toArray=function(g,v,S){return void 0===S&&(S=0),g[S+0]=v.x,g[S+1]=v.y,g[S+2]=v.z,g[S+3]=v.w,g},e.fromArray=function(g,v,S){return void 0===S&&(S=0),g.x=v[S+0],g.y=v[S+1],g.z=v[S+2],g.w=v[S+3],g},e.strictEquals=function(g,v){return g.x===v.x&&g.y===v.y&&g.z===v.z&&g.w===v.w},e.equals=function(g,v,S){return void 0===S&&(S=ex),Math.abs(g.x-v.x)<=S*Math.max(1,Math.abs(g.x),Math.abs(v.x))&&Math.abs(g.y-v.y)<=S*Math.max(1,Math.abs(g.y),Math.abs(v.y))&&Math.abs(g.z-v.z)<=S*Math.max(1,Math.abs(g.z),Math.abs(v.z))&&Math.abs(g.w-v.w)<=S*Math.max(1,Math.abs(g.w),Math.abs(v.w))},e.angle=function(g,v){var S=Math.min(Math.abs(e.dot(g,v)),1);return 2*Math.acos(S)},e.rotateTowards=function(g,v,S,O){var X=e.angle(v,S);if(0===X)return g.x=S.x,g.y=S.y,g.z=S.z,g.w=S.w,g;var Y=Math.min(O/Si(X),1);return e.slerp(g,v,S,Y)};var v=e.prototype;return v.clone=function(){return new e(this.x,this.y,this.z,this.w)},v.set=function(g,v,S,O){return"object"==(void 0===g?"undefined":_type_of(g))?(this.x=g.x,this.y=g.y,this.z=g.z,this.w=g.w):(this.x=g||0,this.y=v||0,this.z=S||0,this.w=null!=O?O:1),this},v.equals=function(g,v){return void 0===v&&(v=ex),Math.abs(this.x-g.x)<=v*Math.max(1,Math.abs(this.x),Math.abs(g.x))&&Math.abs(this.y-g.y)<=v*Math.max(1,Math.abs(this.y),Math.abs(g.y))&&Math.abs(this.z-g.z)<=v*Math.max(1,Math.abs(this.z),Math.abs(g.z))&&Math.abs(this.w-g.w)<=v*Math.max(1,Math.abs(this.w),Math.abs(g.w))},v.strictEquals=function(g){return g&&this.x===g.x&&this.y===g.y&&this.z===g.z&&this.w===g.w},v.getEulerAngles=function(g){return e.toEuler(g,this)},v.lerp=function(g,v){return this.x+=v*(g.x-this.x),this.y+=v*(g.y-this.y),this.z+=v*(g.z-this.z),this.w+=v*(g.w-this.w),this},v.slerp=function(g,v){return e.slerp(this,this,g,v)},v.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},v.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e}(tq));eU=eW,eW.IDENTITY=Object.freeze(new eU);var ej,eq=new eW,eY=new eW,eK=new eL,eJ=new eV,eZ=.5*Math.PI/180;function un(g,v,S,O){return void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=1),new eW(g,v,S,O)}ri.fastDefine("cc.Quat",eW,{x:0,y:0,z:0,w:1}),X.Quat=eW,X.quat=un;var eQ=g("aI",Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])])),e$=g("az",function(g){function e(v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf,tp){var tm;return void 0===v&&(v=1),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=0),void 0===te&&(te=1),void 0===ti&&(ti=0),void 0===tr&&(tr=0),void 0===ta&&(ta=0),void 0===th&&(th=0),void 0===tu&&(tu=1),void 0===tl&&(tl=0),void 0===tc&&(tc=0),void 0===t_&&(t_=0),void 0===tf&&(tf=0),void 0===tp&&(tp=1),tm=g.call(this)||this,"object"==(void 0===v?"undefined":_type_of(v))?(tm.m00=v.m00,tm.m01=v.m01,tm.m02=v.m02,tm.m03=v.m03,tm.m04=v.m04,tm.m05=v.m05,tm.m06=v.m06,tm.m07=v.m07,tm.m08=v.m08,tm.m09=v.m09,tm.m10=v.m10,tm.m11=v.m11,tm.m12=v.m12,tm.m13=v.m13,tm.m14=v.m14,tm.m15=v.m15):(tm.m00=v,tm.m01=S,tm.m02=O,tm.m03=X,tm.m04=Y,tm.m05=te,tm.m06=ti,tm.m07=tr,tm.m08=ta,tm.m09=th,tm.m10=tu,tm.m11=tl,tm.m12=tc,tm.m13=t_,tm.m14=tf,tm.m15=tp),tm}s(e,g),e.clone=function(g){return new e(g.m00,g.m01,g.m02,g.m03,g.m04,g.m05,g.m06,g.m07,g.m08,g.m09,g.m10,g.m11,g.m12,g.m13,g.m14,g.m15)},e.copy=function(g,v){return g.m00=v.m00,g.m01=v.m01,g.m02=v.m02,g.m03=v.m03,g.m04=v.m04,g.m05=v.m05,g.m06=v.m06,g.m07=v.m07,g.m08=v.m08,g.m09=v.m09,g.m10=v.m10,g.m11=v.m11,g.m12=v.m12,g.m13=v.m13,g.m14=v.m14,g.m15=v.m15,g},e.set=function(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf,tp){return g.m00=v,g.m01=S,g.m02=O,g.m03=X,g.m04=Y,g.m05=te,g.m06=ti,g.m07=tr,g.m08=ta,g.m09=th,g.m10=tu,g.m11=tl,g.m12=tc,g.m13=t_,g.m14=tf,g.m15=tp,g},e.identity=function(g){return g.m00=1,g.m01=0,g.m02=0,g.m03=0,g.m04=0,g.m05=1,g.m06=0,g.m07=0,g.m08=0,g.m09=0,g.m10=1,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=1,g},e.transpose=function(g,v){if(g===v){var S=v.m01,O=v.m02,X=v.m03,Y=v.m06,te=v.m07,ti=v.m11;g.m01=v.m04,g.m02=v.m08,g.m03=v.m12,g.m04=S,g.m06=v.m09,g.m07=v.m13,g.m08=O,g.m09=Y,g.m11=v.m14,g.m12=X,g.m13=te,g.m14=ti}else g.m00=v.m00,g.m01=v.m04,g.m02=v.m08,g.m03=v.m12,g.m04=v.m01,g.m05=v.m05,g.m06=v.m09,g.m07=v.m13,g.m08=v.m02,g.m09=v.m06,g.m10=v.m10,g.m11=v.m14,g.m12=v.m03,g.m13=v.m07,g.m14=v.m11,g.m15=v.m15;return g},e.invert=function(g,v){var S=v.m00,O=v.m01,X=v.m02,Y=v.m03,te=v.m04,ti=v.m05,tr=v.m06,ta=v.m07,th=v.m08,tu=v.m09,tl=v.m10,tc=v.m11,t_=v.m12,tf=v.m13,tp=v.m14,tm=v.m15,tg=S*ti-O*te,tv=S*tr-X*te,ty=S*ta-Y*te,tS=O*tr-X*ti,tA=O*ta-Y*ti,tT=X*ta-Y*tr,tE=th*tf-tu*t_,tC=th*tp-tl*t_,tx=th*tm-tc*t_,tb=tu*tp-tl*tf,tw=tu*tm-tc*tf,tI=tl*tm-tc*tp,tB=tg*tI-tv*tw+ty*tb+tS*tx-tA*tC+tT*tE;return 0===tB?(g.m00=0,g.m01=0,g.m02=0,g.m03=0,g.m04=0,g.m05=0,g.m06=0,g.m07=0,g.m08=0,g.m09=0,g.m10=0,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=0,g):(tB=1/tB,g.m00=(ti*tI-tr*tw+ta*tb)*tB,g.m01=(X*tw-O*tI-Y*tb)*tB,g.m02=(tf*tT-tp*tA+tm*tS)*tB,g.m03=(tl*tA-tu*tT-tc*tS)*tB,g.m04=(tr*tx-te*tI-ta*tC)*tB,g.m05=(S*tI-X*tx+Y*tC)*tB,g.m06=(tp*ty-t_*tT-tm*tv)*tB,g.m07=(th*tT-tl*ty+tc*tv)*tB,g.m08=(te*tw-ti*tx+ta*tE)*tB,g.m09=(O*tx-S*tw-Y*tE)*tB,g.m10=(t_*tA-tf*ty+tm*tg)*tB,g.m11=(tu*ty-th*tA-tc*tg)*tB,g.m12=(ti*tC-te*tb-tr*tE)*tB,g.m13=(S*tb-O*tC+X*tE)*tB,g.m14=(tf*tv-t_*tS-tp*tg)*tB,g.m15=(th*tS-tu*tv+tl*tg)*tB,g)},e.determinant=function(g){var v=g.m00,S=g.m01,O=g.m02,X=g.m03,Y=g.m04,te=g.m05,ti=g.m06,tr=g.m07,ta=g.m08,th=g.m09,tu=g.m10,tl=g.m11,tc=g.m12,t_=g.m13,tf=g.m14,tp=g.m15;return(v*te-S*Y)*(tu*tp-tl*tf)-(v*ti-O*Y)*(th*tp-tl*t_)+(v*tr-X*Y)*(th*tf-tu*t_)+(S*ti-O*te)*(ta*tp-tl*tc)-(S*tr-X*te)*(ta*tf-tu*tc)+(O*tr-X*ti)*(ta*t_-th*tc)},e.multiply=function(g,v,S){var O=v.m00,X=v.m01,Y=v.m02,te=v.m03,ti=v.m04,tr=v.m05,ta=v.m06,th=v.m07,tu=v.m08,tl=v.m09,tc=v.m10,t_=v.m11,tf=v.m12,tp=v.m13,tm=v.m14,tg=v.m15,tv=S.m00,ty=S.m01,tS=S.m02,tA=S.m03;return g.m00=tv*O+ty*ti+tS*tu+tA*tf,g.m01=tv*X+ty*tr+tS*tl+tA*tp,g.m02=tv*Y+ty*ta+tS*tc+tA*tm,g.m03=tv*te+ty*th+tS*t_+tA*tg,tv=S.m04,ty=S.m05,tS=S.m06,tA=S.m07,g.m04=tv*O+ty*ti+tS*tu+tA*tf,g.m05=tv*X+ty*tr+tS*tl+tA*tp,g.m06=tv*Y+ty*ta+tS*tc+tA*tm,g.m07=tv*te+ty*th+tS*t_+tA*tg,tv=S.m08,ty=S.m09,tS=S.m10,tA=S.m11,g.m08=tv*O+ty*ti+tS*tu+tA*tf,g.m09=tv*X+ty*tr+tS*tl+tA*tp,g.m10=tv*Y+ty*ta+tS*tc+tA*tm,g.m11=tv*te+ty*th+tS*t_+tA*tg,tv=S.m12,ty=S.m13,tS=S.m14,tA=S.m15,g.m12=tv*O+ty*ti+tS*tu+tA*tf,g.m13=tv*X+ty*tr+tS*tl+tA*tp,g.m14=tv*Y+ty*ta+tS*tc+tA*tm,g.m15=tv*te+ty*th+tS*t_+tA*tg,g},e.transform=function(g,v,S){var O=S.x,X=S.y,Y=S.z;if(v===g)g.m12=v.m00*O+v.m04*X+v.m08*Y+v.m12,g.m13=v.m01*O+v.m05*X+v.m09*Y+v.m13,g.m14=v.m02*O+v.m06*X+v.m10*Y+v.m14,g.m15=v.m03*O+v.m07*X+v.m11*Y+v.m15;else{var te=v.m00,ti=v.m01,tr=v.m02,ta=v.m03,th=v.m04,tu=v.m05,tl=v.m06,tc=v.m07,t_=v.m08,tf=v.m09,tp=v.m10,tm=v.m11;g.m00=te,g.m01=ti,g.m02=tr,g.m03=ta,g.m04=th,g.m05=tu,g.m06=tl,g.m07=tc,g.m08=t_,g.m09=tf,g.m10=tp,g.m11=tm,g.m12=te*O+th*X+t_*Y+v.m12,g.m13=ti*O+tu*X+tf*Y+v.m13,g.m14=tr*O+tl*X+tp*Y+v.m14,g.m15=ta*O+tc*X+tm*Y+v.m15}return g},e.translate=function(g,v,S){return v===g?(g.m12+=S.x,g.m13+=S.y,g.m14+=S.z):(g.m00=v.m00,g.m01=v.m01,g.m02=v.m02,g.m03=v.m03,g.m04=v.m04,g.m05=v.m05,g.m06=v.m06,g.m07=v.m07,g.m08=v.m08,g.m09=v.m09,g.m10=v.m10,g.m11=v.m11,g.m12=v.m12+S.x,g.m13=v.m13+S.y,g.m14=v.m14+S.z,g.m15=v.m15),g},e.scale=function(g,v,S){var O=S.x,X=S.y,Y=S.z;return g.m00=v.m00*O,g.m01=v.m01*O,g.m02=v.m02*O,g.m03=v.m03*O,g.m04=v.m04*X,g.m05=v.m05*X,g.m06=v.m06*X,g.m07=v.m07*X,g.m08=v.m08*Y,g.m09=v.m09*Y,g.m10=v.m10*Y,g.m11=v.m11*Y,g.m12=v.m12,g.m13=v.m13,g.m14=v.m14,g.m15=v.m15,g},e.rotate=function(g,v,S,O){var X=O.x,Y=O.y,te=O.z,ti=Math.sqrt(X*X+Y*Y+te*te);if(Math.abs(ti)<ex)return null;X*=ti=1/ti,Y*=ti,te*=ti;var tr=Math.sin(S),ta=Math.cos(S),th=1-ta,tu=v.m00,tl=v.m01,tc=v.m02,t_=v.m03,tf=v.m04,tp=v.m05,tm=v.m06,tg=v.m07,tv=v.m08,ty=v.m09,tS=v.m10,tA=v.m11,tT=X*X*th+ta,tE=Y*X*th+te*tr,tC=te*X*th-Y*tr,tx=X*Y*th-te*tr,tb=Y*Y*th+ta,tw=te*Y*th+X*tr,tI=X*te*th+Y*tr,tB=Y*te*th-X*tr,tP=te*te*th+ta;return g.m00=tu*tT+tf*tE+tv*tC,g.m01=tl*tT+tp*tE+ty*tC,g.m02=tc*tT+tm*tE+tS*tC,g.m03=t_*tT+tg*tE+tA*tC,g.m04=tu*tx+tf*tb+tv*tw,g.m05=tl*tx+tp*tb+ty*tw,g.m06=tc*tx+tm*tb+tS*tw,g.m07=t_*tx+tg*tb+tA*tw,g.m08=tu*tI+tf*tB+tv*tP,g.m09=tl*tI+tp*tB+ty*tP,g.m10=tc*tI+tm*tB+tS*tP,g.m11=t_*tI+tg*tB+tA*tP,v!==g&&(g.m12=v.m12,g.m13=v.m13,g.m14=v.m14,g.m15=v.m15),g},e.rotateX=function(g,v,S){var O=Math.sin(S),X=Math.cos(S),Y=v.m04,te=v.m05,ti=v.m06,tr=v.m07,ta=v.m08,th=v.m09,tu=v.m10,tl=v.m11;return v!==g&&(g.m00=v.m00,g.m01=v.m01,g.m02=v.m02,g.m03=v.m03,g.m12=v.m12,g.m13=v.m13,g.m14=v.m14,g.m15=v.m15),g.m04=Y*X+ta*O,g.m05=te*X+th*O,g.m06=ti*X+tu*O,g.m07=tr*X+tl*O,g.m08=ta*X-Y*O,g.m09=th*X-te*O,g.m10=tu*X-ti*O,g.m11=tl*X-tr*O,g},e.rotateY=function(g,v,S){var O=Math.sin(S),X=Math.cos(S),Y=v.m00,te=v.m01,ti=v.m02,tr=v.m03,ta=v.m08,th=v.m09,tu=v.m10,tl=v.m11;return v!==g&&(g.m04=v.m04,g.m05=v.m05,g.m06=v.m06,g.m07=v.m07,g.m12=v.m12,g.m13=v.m13,g.m14=v.m14,g.m15=v.m15),g.m00=Y*X-ta*O,g.m01=te*X-th*O,g.m02=ti*X-tu*O,g.m03=tr*X-tl*O,g.m08=Y*O+ta*X,g.m09=te*O+th*X,g.m10=ti*O+tu*X,g.m11=tr*O+tl*X,g},e.rotateZ=function(g,v,S){var O=Math.sin(S),X=Math.cos(S),Y=v.m00,te=v.m01,ti=v.m02,tr=v.m03,ta=v.m04,th=v.m05,tu=v.m06,tl=v.m07;return v!==g&&(g.m08=v.m08,g.m09=v.m09,g.m10=v.m10,g.m11=v.m11,g.m12=v.m12,g.m13=v.m13,g.m14=v.m14,g.m15=v.m15),g.m00=Y*X+ta*O,g.m01=te*X+th*O,g.m02=ti*X+tu*O,g.m03=tr*X+tl*O,g.m04=ta*X-Y*O,g.m05=th*X-te*O,g.m06=tu*X-ti*O,g.m07=tl*X-tr*O,g},e.fromTranslation=function(g,v){return g.m00=1,g.m01=0,g.m02=0,g.m03=0,g.m04=0,g.m05=1,g.m06=0,g.m07=0,g.m08=0,g.m09=0,g.m10=1,g.m11=0,g.m12=v.x,g.m13=v.y,g.m14=v.z,g.m15=1,g},e.fromScaling=function(g,v){return g.m00=v.x,g.m01=0,g.m02=0,g.m03=0,g.m04=0,g.m05=v.y,g.m06=0,g.m07=0,g.m08=0,g.m09=0,g.m10=v.z,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=1,g},e.fromRotation=function(g,v,S){var O=S.x,X=S.y,Y=S.z,te=Math.sqrt(O*O+X*X+Y*Y);if(Math.abs(te)<ex)return null;O*=te=1/te,X*=te,Y*=te;var ti=Math.sin(v),tr=Math.cos(v),ta=1-tr;return g.m00=O*O*ta+tr,g.m01=X*O*ta+Y*ti,g.m02=Y*O*ta-X*ti,g.m03=0,g.m04=O*X*ta-Y*ti,g.m05=X*X*ta+tr,g.m06=Y*X*ta+O*ti,g.m07=0,g.m08=O*Y*ta+X*ti,g.m09=X*Y*ta-O*ti,g.m10=Y*Y*ta+tr,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=1,g},e.fromXRotation=function(g,v){var S=Math.sin(v),O=Math.cos(v);return g.m00=1,g.m01=0,g.m02=0,g.m03=0,g.m04=0,g.m05=O,g.m06=S,g.m07=0,g.m08=0,g.m09=-S,g.m10=O,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=1,g},e.fromYRotation=function(g,v){var S=Math.sin(v),O=Math.cos(v);return g.m00=O,g.m01=0,g.m02=-S,g.m03=0,g.m04=0,g.m05=1,g.m06=0,g.m07=0,g.m08=S,g.m09=0,g.m10=O,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=1,g},e.fromZRotation=function(g,v){var S=Math.sin(v),O=Math.cos(v);return g.m00=O,g.m01=S,g.m02=0,g.m03=0,g.m04=-S,g.m05=O,g.m06=0,g.m07=0,g.m08=0,g.m09=0,g.m10=1,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=1,g},e.fromRT=function(g,v,S){var O=v.x,X=v.y,Y=v.z,te=v.w,ti=O+O,tr=X+X,ta=Y+Y,th=O*ti,tu=O*tr,tl=O*ta,tc=X*tr,t_=X*ta,tf=Y*ta,tp=te*ti,tm=te*tr,tg=te*ta;return g.m00=1-(tc+tf),g.m01=tu+tg,g.m02=tl-tm,g.m03=0,g.m04=tu-tg,g.m05=1-(th+tf),g.m06=t_+tp,g.m07=0,g.m08=tl+tm,g.m09=t_-tp,g.m10=1-(th+tc),g.m11=0,g.m12=S.x,g.m13=S.y,g.m14=S.z,g.m15=1,g},e.getTranslation=function(g,v){return g.x=v.m12,g.y=v.m13,g.z=v.m14,g},e.getScaling=function(g,v){var S=e3.m00=v.m00,O=e3.m01=v.m01,X=e3.m02=v.m02,Y=e3.m03=v.m04,te=e3.m04=v.m05,ti=e3.m05=v.m06,tr=e3.m06=v.m08,ta=e3.m07=v.m09,th=e3.m08=v.m10;return g.x=Math.sqrt(S*S+O*O+X*X),g.y=Math.sqrt(Y*Y+te*te+ti*ti),g.z=Math.sqrt(tr*tr+ta*ta+th*th),eV.determinant(e3)<0&&(g.x*=-1),g},e.getRotation=function(g,v){var S=v.m00+v.m05+v.m10,O=0;return S>0?(O=2*Math.sqrt(S+1),g.w=.25*O,g.x=(v.m06-v.m09)/O,g.y=(v.m08-v.m02)/O,g.z=(v.m01-v.m04)/O):v.m00>v.m05&&v.m00>v.m10?(O=2*Math.sqrt(1+v.m00-v.m05-v.m10),g.w=(v.m06-v.m09)/O,g.x=.25*O,g.y=(v.m01+v.m04)/O,g.z=(v.m08+v.m02)/O):v.m05>v.m10?(O=2*Math.sqrt(1+v.m05-v.m00-v.m10),g.w=(v.m08-v.m02)/O,g.x=(v.m01+v.m04)/O,g.y=.25*O,g.z=(v.m06+v.m09)/O):(O=2*Math.sqrt(1+v.m10-v.m00-v.m05),g.w=(v.m01-v.m04)/O,g.x=(v.m08+v.m02)/O,g.y=(v.m06+v.m09)/O,g.z=.25*O),g},e.toRTS=function(g,v,S,O){var X=eL.set(e2,g.m00,g.m01,g.m02).length(),Y=eL.set(e2,g.m04,g.m05,g.m06).length(),te=eL.set(e2,g.m08,g.m09,g.m10).length();e3.m00=g.m00/X,e3.m01=g.m01/X,e3.m02=g.m02/X,e3.m03=g.m04/Y,e3.m04=g.m05/Y,e3.m05=g.m06/Y,e3.m06=g.m08/te,e3.m07=g.m09/te,e3.m08=g.m10/te;var ti=eV.determinant(e3);O&&(eL.set(O,X,Y,te),ti<0&&(O.x*=-1)),S&&eL.set(S,g.m12,g.m13,g.m14),v&&(ti<0&&(e3.m00*=-1,e3.m01*=-1,e3.m02*=-1),eW.fromMat3(v,e3))},e.toSRT=function(g,v,S,O){var X=eL.set(e2,g.m00,g.m01,g.m02).length(),Y=eL.set(e2,g.m04,g.m05,g.m06).length(),te=eL.set(e2,g.m08,g.m09,g.m10).length();O&&(O.x=X,O.y=Y,O.z=te),S&&eL.set(S,g.m12,g.m13,g.m14),v&&(e3.m00=g.m00/X,e3.m01=g.m01/X,e3.m02=g.m02/X,e3.m03=g.m04/Y,e3.m04=g.m05/Y,e3.m05=g.m06/Y,e3.m06=g.m08/te,e3.m07=g.m09/te,e3.m08=g.m10/te,eV.determinant(e3)<0&&(O&&(O.x*=-1),e3.m00*=-1,e3.m01*=-1,e3.m02*=-1),eW.fromMat3(v,e3))},e.toEuler=function(g,v){return eV.set(e3,g.m00,g.m01,g.m02,g.m04,g.m05,g.m06,g.m08,g.m09,g.m10),eV.toEuler(e3,v)},e.fromRTS=function(g,v,S,O){var X=v.x,Y=v.y,te=v.z,ti=v.w,tr=X+X,ta=Y+Y,th=te+te,tu=X*tr,tl=X*ta,tc=X*th,t_=Y*ta,tf=Y*th,tp=te*th,tm=ti*tr,tg=ti*ta,tv=ti*th,ty=O.x,tS=O.y,tA=O.z;return g.m00=(1-(t_+tp))*ty,g.m01=(tl+tv)*ty,g.m02=(tc-tg)*ty,g.m03=0,g.m04=(tl-tv)*tS,g.m05=(1-(tu+tp))*tS,g.m06=(tf+tm)*tS,g.m07=0,g.m08=(tc+tg)*tA,g.m09=(tf-tm)*tA,g.m10=(1-(tu+t_))*tA,g.m11=0,g.m12=S.x,g.m13=S.y,g.m14=S.z,g.m15=1,g},e.fromSRT=function(g,v,S,O){var X=v.x,Y=v.y,te=v.z,ti=v.w,tr=X+X,ta=Y+Y,th=te+te,tu=X*tr,tl=X*ta,tc=X*th,t_=Y*ta,tf=Y*th,tp=te*th,tm=ti*tr,tg=ti*ta,tv=ti*th,ty=O.x,tS=O.y,tA=O.z;return g.m00=(1-(t_+tp))*ty,g.m01=(tl+tv)*ty,g.m02=(tc-tg)*ty,g.m03=0,g.m04=(tl-tv)*tS,g.m05=(1-(tu+tp))*tS,g.m06=(tf+tm)*tS,g.m07=0,g.m08=(tc+tg)*tA,g.m09=(tf-tm)*tA,g.m10=(1-(tu+t_))*tA,g.m11=0,g.m12=S.x,g.m13=S.y,g.m14=S.z,g.m15=1,g},e.fromRTSOrigin=function(g,v,S,O,X){var Y=v.x,te=v.y,ti=v.z,tr=v.w,ta=Y+Y,th=te+te,tu=ti+ti,tl=Y*ta,tc=Y*th,t_=Y*tu,tf=te*th,tp=te*tu,tm=ti*tu,tg=tr*ta,tv=tr*th,ty=tr*tu,tS=O.x,tA=O.y,tT=O.z,tE=X.x,tC=X.y,tx=X.z;return g.m00=(1-(tf+tm))*tS,g.m01=(tc+ty)*tS,g.m02=(t_-tv)*tS,g.m03=0,g.m04=(tc-ty)*tA,g.m05=(1-(tl+tm))*tA,g.m06=(tp+tg)*tA,g.m07=0,g.m08=(t_+tv)*tT,g.m09=(tp-tg)*tT,g.m10=(1-(tl+tf))*tT,g.m11=0,g.m12=S.x+tE-(g.m00*tE+g.m04*tC+g.m08*tx),g.m13=S.y+tC-(g.m01*tE+g.m05*tC+g.m09*tx),g.m14=S.z+tx-(g.m02*tE+g.m06*tC+g.m10*tx),g.m15=1,g},e.fromSRTOrigin=function(g,v,S,O,X){var Y=v.x,te=v.y,ti=v.z,tr=v.w,ta=Y+Y,th=te+te,tu=ti+ti,tl=Y*ta,tc=Y*th,t_=Y*tu,tf=te*th,tp=te*tu,tm=ti*tu,tg=tr*ta,tv=tr*th,ty=tr*tu,tS=O.x,tA=O.y,tT=O.z,tE=X.x,tC=X.y,tx=X.z;return g.m00=(1-(tf+tm))*tS,g.m01=(tc+ty)*tS,g.m02=(t_-tv)*tS,g.m03=0,g.m04=(tc-ty)*tA,g.m05=(1-(tl+tm))*tA,g.m06=(tp+tg)*tA,g.m07=0,g.m08=(t_+tv)*tT,g.m09=(tp-tg)*tT,g.m10=(1-(tl+tf))*tT,g.m11=0,g.m12=S.x+tE-(g.m00*tE+g.m04*tC+g.m08*tx),g.m13=S.y+tC-(g.m01*tE+g.m05*tC+g.m09*tx),g.m14=S.z+tx-(g.m02*tE+g.m06*tC+g.m10*tx),g.m15=1,g},e.fromQuat=function(g,v){var S=v.x,O=v.y,X=v.z,Y=v.w,te=S+S,ti=O+O,tr=X+X,ta=S*te,th=O*te,tu=O*ti,tl=X*te,tc=X*ti,t_=X*tr,tf=Y*te,tp=Y*ti,tm=Y*tr;return g.m00=1-tu-t_,g.m01=th+tm,g.m02=tl-tp,g.m03=0,g.m04=th-tm,g.m05=1-ta-t_,g.m06=tc+tf,g.m07=0,g.m08=tl+tp,g.m09=tc-tf,g.m10=1-ta-tu,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=1,g},e.frustum=function(g,v,S,O,X,Y,te){var ti=1/(S-v),tr=1/(X-O),ta=1/(Y-te);return g.m00=2*Y*ti,g.m01=0,g.m02=0,g.m03=0,g.m04=0,g.m05=2*Y*tr,g.m06=0,g.m07=0,g.m08=(S+v)*ti,g.m09=(X+O)*tr,g.m10=(te+Y)*ta,g.m11=-1,g.m12=0,g.m13=0,g.m14=te*Y*2*ta,g.m15=0,g},e.perspective=function(g,v,S,O,X,Y,te,ti,tr){void 0===Y&&(Y=!0),void 0===te&&(te=-1),void 0===ti&&(ti=1),void 0===tr&&(tr=0);var ta=1/Math.tan(v/2),th=1/(O-X),tu=Y?ta/S:ta,tl=(Y?ta:ta*S)*ti,tc=eQ[tr];return g.m00=tu*tc[0],g.m01=tu*tc[1],g.m02=0,g.m03=0,g.m04=tl*tc[2],g.m05=tl*tc[3],g.m06=0,g.m07=0,g.m08=0,g.m09=0,g.m10=(X-te*O)*th,g.m11=-1,g.m12=0,g.m13=0,g.m14=X*O*th*(1-te),g.m15=0,g},e.ortho=function(g,v,S,O,X,Y,te,ti,tr,ta){void 0===ti&&(ti=-1),void 0===tr&&(tr=1),void 0===ta&&(ta=0);var th=1/(v-S),tu=1/(O-X)*tr,tl=1/(Y-te),tc=-2*th,t_=-2*tu,tf=(v+S)*th,tp=(X+O)*tu,tm=eQ[ta];return g.m00=tc*tm[0],g.m01=tc*tm[1],g.m02=0,g.m03=0,g.m04=t_*tm[2],g.m05=t_*tm[3],g.m06=0,g.m07=0,g.m08=0,g.m09=0,g.m10=tl*(1-ti),g.m11=0,g.m12=tf*tm[0]+tp*tm[2],g.m13=tf*tm[1]+tp*tm[3],g.m14=(Y-ti*te)*tl,g.m15=1,g},e.lookAt=function(g,v,S,O){var X=v.x,Y=v.y,te=v.z,ti=O.x,tr=O.y,ta=O.z,th=X-S.x,tu=Y-S.y,tl=te-S.z,tc=1/Math.sqrt(th*th+tu*tu+tl*tl),t_=tr*(tl*=tc)-ta*(tu*=tc),tf=ta*(th*=tc)-ti*tl,tp=ti*tu-tr*th,tm=tu*(tp*=tc=1/Math.sqrt(t_*t_+tf*tf+tp*tp))-tl*(tf*=tc),tg=tl*(t_*=tc)-th*tp,tv=th*tf-tu*t_;return g.m00=t_,g.m01=tm,g.m02=th,g.m03=0,g.m04=tf,g.m05=tg,g.m06=tu,g.m07=0,g.m08=tp,g.m09=tv,g.m10=tl,g.m11=0,g.m12=-(t_*X+tf*Y+tp*te),g.m13=-(tm*X+tg*Y+tv*te),g.m14=-(th*X+tu*Y+tl*te),g.m15=1,g},e.inverseTranspose=function(g,v){var S=v.m00,O=v.m01,X=v.m02,Y=v.m03,te=v.m04,ti=v.m05,tr=v.m06,ta=v.m07,th=v.m08,tu=v.m09,tl=v.m10,tc=v.m11,t_=v.m12,tf=v.m13,tp=v.m14,tm=v.m15,tg=S*ti-O*te,tv=S*tr-X*te,ty=S*ta-Y*te,tS=O*tr-X*ti,tA=O*ta-Y*ti,tT=X*ta-Y*tr,tE=th*tf-tu*t_,tC=th*tp-tl*t_,tx=th*tm-tc*t_,tb=tu*tp-tl*tf,tw=tu*tm-tc*tf,tI=tl*tm-tc*tp,tB=tg*tI-tv*tw+ty*tb+tS*tx-tA*tC+tT*tE;return tB?(tB=1/tB,g.m00=(ti*tI-tr*tw+ta*tb)*tB,g.m01=(tr*tx-te*tI-ta*tC)*tB,g.m02=(te*tw-ti*tx+ta*tE)*tB,g.m03=0,g.m04=(X*tw-O*tI-Y*tb)*tB,g.m05=(S*tI-X*tx+Y*tC)*tB,g.m06=(O*tx-S*tw-Y*tE)*tB,g.m07=0,g.m08=(tf*tT-tp*tA+tm*tS)*tB,g.m09=(tp*ty-t_*tT-tm*tv)*tB,g.m10=(t_*tA-tf*ty+tm*tg)*tB,g.m11=0,g.m12=0,g.m13=0,g.m14=0,g.m15=1,g):null},e.toArray=function(g,v,S){return void 0===S&&(S=0),g[S+0]=v.m00,g[S+1]=v.m01,g[S+2]=v.m02,g[S+3]=v.m03,g[S+4]=v.m04,g[S+5]=v.m05,g[S+6]=v.m06,g[S+7]=v.m07,g[S+8]=v.m08,g[S+9]=v.m09,g[S+10]=v.m10,g[S+11]=v.m11,g[S+12]=v.m12,g[S+13]=v.m13,g[S+14]=v.m14,g[S+15]=v.m15,g},e.fromArray=function(g,v,S){return void 0===S&&(S=0),g.m00=v[S+0],g.m01=v[S+1],g.m02=v[S+2],g.m03=v[S+3],g.m04=v[S+4],g.m05=v[S+5],g.m06=v[S+6],g.m07=v[S+7],g.m08=v[S+8],g.m09=v[S+9],g.m10=v[S+10],g.m11=v[S+11],g.m12=v[S+12],g.m13=v[S+13],g.m14=v[S+14],g.m15=v[S+15],g},e.add=function(g,v,S){return g.m00=v.m00+S.m00,g.m01=v.m01+S.m01,g.m02=v.m02+S.m02,g.m03=v.m03+S.m03,g.m04=v.m04+S.m04,g.m05=v.m05+S.m05,g.m06=v.m06+S.m06,g.m07=v.m07+S.m07,g.m08=v.m08+S.m08,g.m09=v.m09+S.m09,g.m10=v.m10+S.m10,g.m11=v.m11+S.m11,g.m12=v.m12+S.m12,g.m13=v.m13+S.m13,g.m14=v.m14+S.m14,g.m15=v.m15+S.m15,g},e.subtract=function(g,v,S){return g.m00=v.m00-S.m00,g.m01=v.m01-S.m01,g.m02=v.m02-S.m02,g.m03=v.m03-S.m03,g.m04=v.m04-S.m04,g.m05=v.m05-S.m05,g.m06=v.m06-S.m06,g.m07=v.m07-S.m07,g.m08=v.m08-S.m08,g.m09=v.m09-S.m09,g.m10=v.m10-S.m10,g.m11=v.m11-S.m11,g.m12=v.m12-S.m12,g.m13=v.m13-S.m13,g.m14=v.m14-S.m14,g.m15=v.m15-S.m15,g},e.multiplyScalar=function(g,v,S){return g.m00=v.m00*S,g.m01=v.m01*S,g.m02=v.m02*S,g.m03=v.m03*S,g.m04=v.m04*S,g.m05=v.m05*S,g.m06=v.m06*S,g.m07=v.m07*S,g.m08=v.m08*S,g.m09=v.m09*S,g.m10=v.m10*S,g.m11=v.m11*S,g.m12=v.m12*S,g.m13=v.m13*S,g.m14=v.m14*S,g.m15=v.m15*S,g},e.multiplyScalarAndAdd=function(g,v,S,O){return g.m00=v.m00+S.m00*O,g.m01=v.m01+S.m01*O,g.m02=v.m02+S.m02*O,g.m03=v.m03+S.m03*O,g.m04=v.m04+S.m04*O,g.m05=v.m05+S.m05*O,g.m06=v.m06+S.m06*O,g.m07=v.m07+S.m07*O,g.m08=v.m08+S.m08*O,g.m09=v.m09+S.m09*O,g.m10=v.m10+S.m10*O,g.m11=v.m11+S.m11*O,g.m12=v.m12+S.m12*O,g.m13=v.m13+S.m13*O,g.m14=v.m14+S.m14*O,g.m15=v.m15+S.m15*O,g},e.strictEquals=function(g,v){return g.m00===v.m00&&g.m01===v.m01&&g.m02===v.m02&&g.m03===v.m03&&g.m04===v.m04&&g.m05===v.m05&&g.m06===v.m06&&g.m07===v.m07&&g.m08===v.m08&&g.m09===v.m09&&g.m10===v.m10&&g.m11===v.m11&&g.m12===v.m12&&g.m13===v.m13&&g.m14===v.m14&&g.m15===v.m15},e.equals=function(g,v,S){return void 0===S&&(S=ex),Math.abs(g.m00-v.m00)<=S*Math.max(1,Math.abs(g.m00),Math.abs(v.m00))&&Math.abs(g.m01-v.m01)<=S*Math.max(1,Math.abs(g.m01),Math.abs(v.m01))&&Math.abs(g.m02-v.m02)<=S*Math.max(1,Math.abs(g.m02),Math.abs(v.m02))&&Math.abs(g.m03-v.m03)<=S*Math.max(1,Math.abs(g.m03),Math.abs(v.m03))&&Math.abs(g.m04-v.m04)<=S*Math.max(1,Math.abs(g.m04),Math.abs(v.m04))&&Math.abs(g.m05-v.m05)<=S*Math.max(1,Math.abs(g.m05),Math.abs(v.m05))&&Math.abs(g.m06-v.m06)<=S*Math.max(1,Math.abs(g.m06),Math.abs(v.m06))&&Math.abs(g.m07-v.m07)<=S*Math.max(1,Math.abs(g.m07),Math.abs(v.m07))&&Math.abs(g.m08-v.m08)<=S*Math.max(1,Math.abs(g.m08),Math.abs(v.m08))&&Math.abs(g.m09-v.m09)<=S*Math.max(1,Math.abs(g.m09),Math.abs(v.m09))&&Math.abs(g.m10-v.m10)<=S*Math.max(1,Math.abs(g.m10),Math.abs(v.m10))&&Math.abs(g.m11-v.m11)<=S*Math.max(1,Math.abs(g.m11),Math.abs(v.m11))&&Math.abs(g.m12-v.m12)<=S*Math.max(1,Math.abs(g.m12),Math.abs(v.m12))&&Math.abs(g.m13-v.m13)<=S*Math.max(1,Math.abs(g.m13),Math.abs(v.m13))&&Math.abs(g.m14-v.m14)<=S*Math.max(1,Math.abs(g.m14),Math.abs(v.m14))&&Math.abs(g.m15-v.m15)<=S*Math.max(1,Math.abs(g.m15),Math.abs(v.m15))};var v=e.prototype;return v.clone=function(){return new e(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},v.set=function(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf){return void 0===g&&(g=1),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=1),void 0===te&&(te=0),void 0===ti&&(ti=0),void 0===tr&&(tr=0),void 0===ta&&(ta=0),void 0===th&&(th=1),void 0===tu&&(tu=0),void 0===tl&&(tl=0),void 0===tc&&(tc=0),void 0===t_&&(t_=0),void 0===tf&&(tf=1),"object"==(void 0===g?"undefined":_type_of(g))?(this.m01=g.m01,this.m02=g.m02,this.m03=g.m03,this.m04=g.m04,this.m05=g.m05,this.m06=g.m06,this.m07=g.m07,this.m08=g.m08,this.m09=g.m09,this.m10=g.m10,this.m11=g.m11,this.m12=g.m12,this.m13=g.m13,this.m14=g.m14,this.m15=g.m15,this.m00=g.m00):(this.m01=v,this.m02=S,this.m03=O,this.m04=X,this.m05=Y,this.m06=te,this.m07=ti,this.m08=tr,this.m09=ta,this.m10=th,this.m11=tu,this.m12=tl,this.m13=tc,this.m14=t_,this.m15=tf,this.m00=g),this},v.equals=function(g,v){return void 0===v&&(v=ex),!(Math.abs(this.m00)===1/0||Math.abs(this.m01)===1/0||Math.abs(this.m02)===1/0||Math.abs(this.m03)===1/0||Math.abs(this.m04)===1/0||Math.abs(this.m05)===1/0||Math.abs(this.m06)===1/0||Math.abs(this.m07)===1/0||Math.abs(this.m08)===1/0||Math.abs(this.m09)===1/0||Math.abs(this.m10)===1/0||Math.abs(this.m11)===1/0||Math.abs(this.m12)===1/0||Math.abs(this.m13)===1/0||Math.abs(this.m14)===1/0||Math.abs(this.m15)===1/0)&&Math.abs(this.m00-g.m00)<=v*Math.max(1,Math.abs(this.m00),Math.abs(g.m00))&&Math.abs(this.m01-g.m01)<=v*Math.max(1,Math.abs(this.m01),Math.abs(g.m01))&&Math.abs(this.m02-g.m02)<=v*Math.max(1,Math.abs(this.m02),Math.abs(g.m02))&&Math.abs(this.m03-g.m03)<=v*Math.max(1,Math.abs(this.m03),Math.abs(g.m03))&&Math.abs(this.m04-g.m04)<=v*Math.max(1,Math.abs(this.m04),Math.abs(g.m04))&&Math.abs(this.m05-g.m05)<=v*Math.max(1,Math.abs(this.m05),Math.abs(g.m05))&&Math.abs(this.m06-g.m06)<=v*Math.max(1,Math.abs(this.m06),Math.abs(g.m06))&&Math.abs(this.m07-g.m07)<=v*Math.max(1,Math.abs(this.m07),Math.abs(g.m07))&&Math.abs(this.m08-g.m08)<=v*Math.max(1,Math.abs(this.m08),Math.abs(g.m08))&&Math.abs(this.m09-g.m09)<=v*Math.max(1,Math.abs(this.m09),Math.abs(g.m09))&&Math.abs(this.m10-g.m10)<=v*Math.max(1,Math.abs(this.m10),Math.abs(g.m10))&&Math.abs(this.m11-g.m11)<=v*Math.max(1,Math.abs(this.m11),Math.abs(g.m11))&&Math.abs(this.m12-g.m12)<=v*Math.max(1,Math.abs(this.m12),Math.abs(g.m12))&&Math.abs(this.m13-g.m13)<=v*Math.max(1,Math.abs(this.m13),Math.abs(g.m13))&&Math.abs(this.m14-g.m14)<=v*Math.max(1,Math.abs(this.m14),Math.abs(g.m14))&&Math.abs(this.m15-g.m15)<=v*Math.max(1,Math.abs(this.m15),Math.abs(g.m15))},v.strictEquals=function(g){return this.m00===g.m00&&this.m01===g.m01&&this.m02===g.m02&&this.m03===g.m03&&this.m04===g.m04&&this.m05===g.m05&&this.m06===g.m06&&this.m07===g.m07&&this.m08===g.m08&&this.m09===g.m09&&this.m10===g.m10&&this.m11===g.m11&&this.m12===g.m12&&this.m13===g.m13&&this.m14===g.m14&&this.m15===g.m15},v.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},v.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},v.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},v.transpose=function(){var g=this.m01,v=this.m02,S=this.m03,O=this.m06,X=this.m07,Y=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=g,this.m06=this.m09,this.m07=this.m13,this.m08=v,this.m09=O,this.m11=this.m14,this.m12=S,this.m13=X,this.m14=Y,this},v.invert=function(){var g=this.m00,v=this.m01,S=this.m02,O=this.m03,X=this.m04,Y=this.m05,te=this.m06,ti=this.m07,tr=this.m08,ta=this.m09,th=this.m10,tu=this.m11,tl=this.m12,tc=this.m13,t_=this.m14,tf=this.m15,tp=g*Y-v*X,tm=g*te-S*X,tg=g*ti-O*X,tv=v*te-S*Y,ty=v*ti-O*Y,tS=S*ti-O*te,tA=tr*tc-ta*tl,tT=tr*t_-th*tl,tE=tr*tf-tu*tl,tC=ta*t_-th*tc,tx=ta*tf-tu*tc,tb=th*tf-tu*t_,tw=tp*tb-tm*tx+tg*tC+tv*tE-ty*tT+tS*tA;return 0===tw?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(tw=1/tw,this.m00=(Y*tb-te*tx+ti*tC)*tw,this.m01=(S*tx-v*tb-O*tC)*tw,this.m02=(tc*tS-t_*ty+tf*tv)*tw,this.m03=(th*ty-ta*tS-tu*tv)*tw,this.m04=(te*tE-X*tb-ti*tT)*tw,this.m05=(g*tb-S*tE+O*tT)*tw,this.m06=(t_*tg-tl*tS-tf*tm)*tw,this.m07=(tr*tS-th*tg+tu*tm)*tw,this.m08=(X*tx-Y*tE+ti*tA)*tw,this.m09=(v*tE-g*tx-O*tA)*tw,this.m10=(tl*ty-tc*tg+tf*tp)*tw,this.m11=(ta*tg-tr*ty-tu*tp)*tw,this.m12=(Y*tT-X*tC-te*tA)*tw,this.m13=(g*tC-v*tT+S*tA)*tw,this.m14=(tc*tm-tl*tv-t_*tp)*tw,this.m15=(tr*tv-ta*tm+th*tp)*tw,this)},v.determinant=function(){var g=this.m00,v=this.m01,S=this.m02,O=this.m03,X=this.m04,Y=this.m05,te=this.m06,ti=this.m07,tr=this.m08,ta=this.m09,th=this.m10,tu=this.m11,tl=this.m12,tc=this.m13,t_=this.m14,tf=this.m15;return(g*Y-v*X)*(th*tf-tu*t_)-(g*te-S*X)*(ta*tf-tu*tc)+(g*ti-O*X)*(ta*t_-th*tc)+(v*te-S*Y)*(tr*tf-tu*tl)-(v*ti-O*Y)*(tr*t_-th*tl)+(S*ti-O*te)*(tr*tc-ta*tl)},v.add=function(g){return this.m00+=g.m00,this.m01+=g.m01,this.m02+=g.m02,this.m03+=g.m03,this.m04+=g.m04,this.m05+=g.m05,this.m06+=g.m06,this.m07+=g.m07,this.m08+=g.m08,this.m09+=g.m09,this.m10+=g.m10,this.m11+=g.m11,this.m12+=g.m12,this.m13+=g.m13,this.m14+=g.m14,this.m15+=g.m15,this},v.subtract=function(g){return this.m00-=g.m00,this.m01-=g.m01,this.m02-=g.m02,this.m03-=g.m03,this.m04-=g.m04,this.m05-=g.m05,this.m06-=g.m06,this.m07-=g.m07,this.m08-=g.m08,this.m09-=g.m09,this.m10-=g.m10,this.m11-=g.m11,this.m12-=g.m12,this.m13-=g.m13,this.m14-=g.m14,this.m15-=g.m15,this},v.multiply=function(g){var v=this.m00,S=this.m01,O=this.m02,X=this.m03,Y=this.m04,te=this.m05,ti=this.m06,tr=this.m07,ta=this.m08,th=this.m09,tu=this.m10,tl=this.m11,tc=this.m12,t_=this.m13,tf=this.m14,tp=this.m15,tm=g.m00,tg=g.m01,tv=g.m02,ty=g.m03;return this.m00=tm*v+tg*Y+tv*ta+ty*tc,this.m01=tm*S+tg*te+tv*th+ty*t_,this.m02=tm*O+tg*ti+tv*tu+ty*tf,this.m03=tm*X+tg*tr+tv*tl+ty*tp,tm=g.m04,tg=g.m05,tv=g.m06,ty=g.m07,this.m04=tm*v+tg*Y+tv*ta+ty*tc,this.m05=tm*S+tg*te+tv*th+ty*t_,this.m06=tm*O+tg*ti+tv*tu+ty*tf,this.m07=tm*X+tg*tr+tv*tl+ty*tp,tm=g.m08,tg=g.m09,tv=g.m10,ty=g.m11,this.m08=tm*v+tg*Y+tv*ta+ty*tc,this.m09=tm*S+tg*te+tv*th+ty*t_,this.m10=tm*O+tg*ti+tv*tu+ty*tf,this.m11=tm*X+tg*tr+tv*tl+ty*tp,tm=g.m12,tg=g.m13,tv=g.m14,ty=g.m15,this.m12=tm*v+tg*Y+tv*ta+ty*tc,this.m13=tm*S+tg*te+tv*th+ty*t_,this.m14=tm*O+tg*ti+tv*tu+ty*tf,this.m15=tm*X+tg*tr+tv*tl+ty*tp,this},v.multiplyScalar=function(g){return this.m00*=g,this.m01*=g,this.m02*=g,this.m03*=g,this.m04*=g,this.m05*=g,this.m06*=g,this.m07*=g,this.m08*=g,this.m09*=g,this.m10*=g,this.m11*=g,this.m12*=g,this.m13*=g,this.m14*=g,this.m15*=g,this},v.translate=function(g){return this.m12+=g.x,this.m13+=g.y,this.m14+=g.z,this},v.transform=function(g){var v=g.x,S=g.y,O=g.z,X=this.m00,Y=this.m01,te=this.m02,ti=this.m03,tr=this.m04,ta=this.m05,th=this.m06,tu=this.m07,tl=this.m08,tc=this.m09,t_=this.m10,tf=this.m11;return this.m12=X*v+tr*S+tl*O+this.m12,this.m13=Y*v+ta*S+tc*O+this.m13,this.m14=te*v+th*S+t_*O+this.m14,this.m15=ti*v+tu*S+tf*O+this.m15,this},v.scale=function(g){var v=g.x,S=g.y,O=g.z;return this.m00*=v,this.m01*=v,this.m02*=v,this.m03*=v,this.m04*=S,this.m05*=S,this.m06*=S,this.m07*=S,this.m08*=O,this.m09*=O,this.m10*=O,this.m11*=O,this},v.rotate=function(g,v){var S=v.x,O=v.y,X=v.z,Y=Math.sqrt(S*S+O*O+X*X);if(Math.abs(Y)<ex)return null;S*=Y=1/Y,O*=Y,X*=Y;var te=Math.sin(g),ti=Math.cos(g),tr=1-ti,ta=this.m00,th=this.m01,tu=this.m02,tl=this.m03,tc=this.m04,t_=this.m05,tf=this.m06,tp=this.m07,tm=this.m08,tg=this.m09,tv=this.m10,ty=this.m11,tS=S*S*tr+ti,tA=O*S*tr+X*te,tT=X*S*tr-O*te,tE=S*O*tr-X*te,tC=O*O*tr+ti,tx=X*O*tr+S*te,tb=S*X*tr+O*te,tw=O*X*tr-S*te,tI=X*X*tr+ti;return this.m00=ta*tS+tc*tA+tm*tT,this.m01=th*tS+t_*tA+tg*tT,this.m02=tu*tS+tf*tA+tv*tT,this.m03=tl*tS+tp*tA+ty*tT,this.m04=ta*tE+tc*tC+tm*tx,this.m05=th*tE+t_*tC+tg*tx,this.m06=tu*tE+tf*tC+tv*tx,this.m07=tl*tE+tp*tC+ty*tx,this.m08=ta*tb+tc*tw+tm*tI,this.m09=th*tb+t_*tw+tg*tI,this.m10=tu*tb+tf*tw+tv*tI,this.m11=tl*tb+tp*tw+ty*tI,this},v.getTranslation=function(g){return g.x=this.m12,g.y=this.m13,g.z=this.m14,g},v.getScale=function(g){var v=e3.m00=this.m00,S=e3.m01=this.m01,O=e3.m02=this.m02,X=e3.m03=this.m04,Y=e3.m04=this.m05,te=e3.m05=this.m06,ti=e3.m06=this.m08,tr=e3.m07=this.m09,ta=e3.m08=this.m10;return g.x=Math.sqrt(v*v+S*S+O*O),g.y=Math.sqrt(X*X+Y*Y+te*te),g.z=Math.sqrt(ti*ti+tr*tr+ta*ta),eV.determinant(e3)<0&&(g.x*=-1),g},v.getRotation=function(g){var v=eL.set(e2,this.m00,this.m01,this.m02).length(),S=eL.set(e2,this.m04,this.m05,this.m06).length(),O=eL.set(e2,this.m08,this.m09,this.m10).length();return e3.m00=this.m00/v,e3.m01=this.m01/v,e3.m02=this.m02/v,e3.m03=this.m04/S,e3.m04=this.m05/S,e3.m05=this.m06/S,e3.m06=this.m08/O,e3.m07=this.m09/O,e3.m08=this.m10/O,eV.determinant(e3)<0&&(e3.m00*=-1,e3.m01*=-1,e3.m02*=-1),eW.fromMat3(g,e3)},v.fromRTS=function(g,v,S){var O=g.x,X=g.y,Y=g.z,te=g.w,ti=O+O,tr=X+X,ta=Y+Y,th=O*ti,tu=O*tr,tl=O*ta,tc=X*tr,t_=X*ta,tf=Y*ta,tp=te*ti,tm=te*tr,tg=te*ta,tv=S.x,ty=S.y,tS=S.z;return this.m00=(1-(tc+tf))*tv,this.m01=(tu+tg)*tv,this.m02=(tl-tm)*tv,this.m03=0,this.m04=(tu-tg)*ty,this.m05=(1-(th+tf))*ty,this.m06=(t_+tp)*ty,this.m07=0,this.m08=(tl+tm)*tS,this.m09=(t_-tp)*tS,this.m10=(1-(th+tc))*tS,this.m11=0,this.m12=v.x,this.m13=v.y,this.m14=v.z,this.m15=1,this},v.fromSRT=function(g,v,S){var O=g.x,X=g.y,Y=g.z,te=g.w,ti=O+O,tr=X+X,ta=Y+Y,th=O*ti,tu=O*tr,tl=O*ta,tc=X*tr,t_=X*ta,tf=Y*ta,tp=te*ti,tm=te*tr,tg=te*ta,tv=S.x,ty=S.y,tS=S.z;return this.m00=(1-(tc+tf))*tv,this.m01=(tu+tg)*tv,this.m02=(tl-tm)*tv,this.m03=0,this.m04=(tu-tg)*ty,this.m05=(1-(th+tf))*ty,this.m06=(t_+tp)*ty,this.m07=0,this.m08=(tl+tm)*tS,this.m09=(t_-tp)*tS,this.m10=(1-(th+tc))*tS,this.m11=0,this.m12=v.x,this.m13=v.y,this.m14=v.z,this.m15=1,this},v.fromQuat=function(g){var v=g.x,S=g.y,O=g.z,X=g.w,Y=v+v,te=S+S,ti=O+O,tr=v*Y,ta=S*Y,th=S*te,tu=O*Y,tl=O*te,tc=O*ti,t_=X*Y,tf=X*te,tp=X*ti;return this.m00=1-th-tc,this.m01=ta+tp,this.m02=tu-tf,this.m03=0,this.m04=ta-tp,this.m05=1-tr-tc,this.m06=tl+t_,this.m07=0,this.m08=tu+tf,this.m09=tl-t_,this.m10=1-tr-th,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},e}(tq));ej=e$,e$.IDENTITY=Object.freeze(new ej);var e0,e2=new eL,e3=new eV;function pn(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf){return new e$(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf)}ri.fastDefine("cc.Mat4",e$,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),X.Mat4=e$,X.mat4=pn;var e4,e8=g("aq",function(g){function e(v,S){var O;return O=g.call(this)||this,"object"==(void 0===v?"undefined":_type_of(v))?(O.x=v.x,O.y=v.y):(O.x=v||0,O.y=S||0),O}s(e,g),e.clone=function(g){return new e(g.x,g.y)},e.copy=function(g,v){return g.x=v.x,g.y=v.y,g},e.set=function(g,v,S){return g.x=v,g.y=S,g},e.add=function(g,v,S){return g.x=v.x+S.x,g.y=v.y+S.y,g},e.subtract=function(g,v,S){return g.x=v.x-S.x,g.y=v.y-S.y,g},e.multiply=function(g,v,S){return g.x=v.x*S.x,g.y=v.y*S.y,g},e.divide=function(g,v,S){return g.x=v.x/S.x,g.y=v.y/S.y,g},e.ceil=function(g,v){return g.x=Math.ceil(v.x),g.y=Math.ceil(v.y),g},e.floor=function(g,v){return g.x=Math.floor(v.x),g.y=Math.floor(v.y),g},e.min=function(g,v,S){return g.x=Math.min(v.x,S.x),g.y=Math.min(v.y,S.y),g},e.max=function(g,v,S){return g.x=Math.max(v.x,S.x),g.y=Math.max(v.y,S.y),g},e.round=function(g,v){return g.x=Math.round(v.x),g.y=Math.round(v.y),g},e.multiplyScalar=function(g,v,S){return g.x=v.x*S,g.y=v.y*S,g},e.scaleAndAdd=function(g,v,S,O){return g.x=v.x+S.x*O,g.y=v.y+S.y*O,g},e.distance=function(g,v){var S=v.x-g.x,O=v.y-g.y;return Math.sqrt(S*S+O*O)},e.squaredDistance=function(g,v){var S=v.x-g.x,O=v.y-g.y;return S*S+O*O},e.len=function(g){var v=g.x,S=g.y;return Math.sqrt(v*v+S*S)},e.lengthSqr=function(g){var v=g.x,S=g.y;return v*v+S*S},e.negate=function(g,v){return g.x=-v.x,g.y=-v.y,g},e.inverse=function(g,v){return g.x=1/v.x,g.y=1/v.y,g},e.inverseSafe=function(g,v){var S=v.x,O=v.y;return Math.abs(S)<ex?g.x=0:g.x=1/S,Math.abs(O)<ex?g.y=0:g.y=1/O,g},e.normalize=function(g,v){var S=v.x,O=v.y,X=S*S+O*O;return X>0?(X=1/Math.sqrt(X),g.x=S*X,g.y=O*X):(g.x=0,g.y=0),g},e.dot=function(g,v){return g.x*v.x+g.y*v.y},e.cross=function(g,v,S){return _instanceof(g,eL)?(g.x=g.y=0,g.z=v.x*S.y-v.y*S.x,g):g.x*v.y-g.y*v.x},e.lerp=function(g,v,S,O){var X=v.x,Y=v.y;return g.x=X+O*(S.x-X),g.y=Y+O*(S.y-Y),g},e.random=function(g,v){v=v||1;var S=2*Ai()*Math.PI;return g.x=Math.cos(S)*v,g.y=Math.sin(S)*v,g},e.transformMat3=function(g,v,S){var O=v.x,X=v.y;return g.x=S.m00*O+S.m03*X+S.m06,g.y=S.m01*O+S.m04*X+S.m07,g},e.transformMat4=function(g,v,S){var O=v.x,X=v.y;return g.x=S.m00*O+S.m04*X+S.m12,g.y=S.m01*O+S.m05*X+S.m13,g},e.str=function(g){return"Vec2("+g.x+", "+g.y+")"},e.toArray=function(g,v,S){return void 0===S&&(S=0),g[S+0]=v.x,g[S+1]=v.y,g},e.fromArray=function(g,v,S){return void 0===S&&(S=0),g.x=v[S+0],g.y=v[S+1],g},e.strictEquals=function(g,v){return g.x===v.x&&g.y===v.y},e.equals=function(g,v,S){return void 0===S&&(S=ex),Math.abs(g.x-v.x)<=S*Math.max(1,Math.abs(g.x),Math.abs(v.x))&&Math.abs(g.y-v.y)<=S*Math.max(1,Math.abs(g.y),Math.abs(v.y))},e.angle=function(g,v){var S=g.x*g.x+g.y*g.y,O=v.x*v.x+v.y*v.y;if(0===S||0===O)return 0;var X=(g.x*v.x+g.y*v.y)/Math.sqrt(S*O);return X=mi(X,-1,1),Math.acos(X)};var v=e.prototype;return v.clone=function(){return new e(this.x,this.y)},v.set=function(g,v){return"object"==(void 0===g?"undefined":_type_of(g))?(this.x=g.x,this.y=g.y):(this.x=g||0,this.y=v||0),this},v.equals=function(g,v){return void 0===v&&(v=ex),Math.abs(this.x-g.x)<=v*Math.max(1,Math.abs(this.x),Math.abs(g.x))&&Math.abs(this.y-g.y)<=v*Math.max(1,Math.abs(this.y),Math.abs(g.y))},v.equals2f=function(g,v,S){return void 0===S&&(S=ex),Math.abs(this.x-g)<=S*Math.max(1,Math.abs(this.x),Math.abs(g))&&Math.abs(this.y-v)<=S*Math.max(1,Math.abs(this.y),Math.abs(v))},v.strictEquals=function(g){return g&&this.x===g.x&&this.y===g.y},v.strictEquals2f=function(g,v){return this.x===g&&this.y===v},v.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},v.lerp=function(g,v){var S=this.x,O=this.y;return this.x=S+v*(g.x-S),this.y=O+v*(g.y-O),this},v.clampf=function(g,v){return this.x=mi(this.x,g.x,v.x),this.y=mi(this.y,g.y,v.y),this},v.add=function(g){return this.x+=g.x,this.y+=g.y,this},v.add2f=function(g,v){return this.x+=g,this.y+=v,this},v.subtract=function(g){return this.x-=g.x,this.y-=g.y,this},v.subtract2f=function(g,v){return this.x-=g,this.y-=v,this},v.multiplyScalar=function(g){return"object"==(void 0===g?"undefined":_type_of(g))&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=g,this.y*=g,this},v.multiply=function(g){return"object"!=(void 0===g?"undefined":_type_of(g))&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=g.x,this.y*=g.y,this},v.multiply2f=function(g,v){return this.x*=g,this.y*=v,this},v.divide=function(g){return this.x/=g.x,this.y/=g.y,this},v.divide2f=function(g,v){return this.x/=g,this.y/=v,this},v.negative=function(){return this.x=-this.x,this.y=-this.y,this},v.dot=function(g){return this.x*g.x+this.y*g.y},v.cross=function(g){return this.x*g.y-this.y*g.x},v.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},v.lengthSqr=function(){return this.x*this.x+this.y*this.y},v.normalize=function(){var g=this.x,v=this.y,S=g*g+v*v;return S>0&&(S=1/Math.sqrt(S),this.x*=S,this.y*=S),this},v.angle=function(g){var v=this.lengthSqr(),S=g.lengthSqr();if(0===v||0===S)return 0;var O=this.dot(g)/Math.sqrt(v*S);return O=mi(O,-1,1),Math.acos(O)},v.signAngle=function(g){var v=this.cross(g),S=this.dot(g);return Math.atan2(v,S)},v.rotate=function(g){var v=this.x,S=this.y,O=Math.sin(g),X=Math.cos(g);return this.x=X*v-O*S,this.y=O*v+X*S,this},v.project=function(g){var v=this.dot(g)/g.dot(g);return this.x=g.x*v,this.y=g.y*v,this},v.transformMat4=function(g){var v=this.x,S=this.y;return this.x=g.m00*v+g.m04*S+g.m12,this.y=g.m01*v+g.m05*S+g.m13,this},e}(tq));function vn(g,v){return new e8(g,v)}e0=e8,e8.ZERO=Object.freeze(new e0(0,0)),e8.ONE=Object.freeze(new e0(1,1)),e8.NEG_ONE=Object.freeze(new e0(-1,-1)),e8.UNIT_X=Object.freeze(new e0(1,0)),e8.UNIT_Y=Object.freeze(new e0(0,1)),ri.fastDefine("cc.Vec2",e8,{x:0,y:0}),X.Vec2=e8,X.v2=vn;var e6,e7=g("au",function(g){function e(v,S,O,X){var Y;return Y=g.call(this)||this,"object"==(void 0===v?"undefined":_type_of(v))?(Y.x=v.x,Y.y=v.y,Y.z=v.z,Y.w=v.w):(Y.x=v||0,Y.y=S||0,Y.z=O||0,Y.w=X||0),Y}s(e,g),e.clone=function(g){return new e(g.x,g.y,g.z,g.w)},e.copy=function(g,v){return g.x=v.x,g.y=v.y,g.z=v.z,g.w=v.w,g},e.set=function(g,v,S,O,X){return g.x=v,g.y=S,g.z=O,g.w=X,g},e.fromColor=function(g,v){return g.x=v.r,g.y=v.g,g.z=v.b,g.w=v.a,g},e.angle=function(g,v){var S=g.y*v.z-g.z*v.y,O=g.z*v.x-g.x*v.z,X=g.x*v.y-g.y*v.x,Y=g.x*v.x+g.y*v.y+g.z*v.z;return Math.atan2(Math.sqrt(S*S+O*O+X*X),Y)},e.add=function(g,v,S){return g.x=v.x+S.x,g.y=v.y+S.y,g.z=v.z+S.z,g.w=v.w+S.w,g},e.subtract=function(g,v,S){return g.x=v.x-S.x,g.y=v.y-S.y,g.z=v.z-S.z,g.w=v.w-S.w,g},e.multiply=function(g,v,S){return g.x=v.x*S.x,g.y=v.y*S.y,g.z=v.z*S.z,g.w=v.w*S.w,g},e.divide=function(g,v,S){return g.x=v.x/S.x,g.y=v.y/S.y,g.z=v.z/S.z,g.w=v.w/S.w,g},e.ceil=function(g,v){return g.x=Math.ceil(v.x),g.y=Math.ceil(v.y),g.z=Math.ceil(v.z),g.w=Math.ceil(v.w),g},e.floor=function(g,v){return g.x=Math.floor(v.x),g.y=Math.floor(v.y),g.z=Math.floor(v.z),g.w=Math.floor(v.w),g},e.min=function(g,v,S){return g.x=Math.min(v.x,S.x),g.y=Math.min(v.y,S.y),g.z=Math.min(v.z,S.z),g.w=Math.min(v.w,S.w),g},e.max=function(g,v,S){return g.x=Math.max(v.x,S.x),g.y=Math.max(v.y,S.y),g.z=Math.max(v.z,S.z),g.w=Math.max(v.w,S.w),g},e.round=function(g,v){return g.x=Math.round(v.x),g.y=Math.round(v.y),g.z=Math.round(v.z),g.w=Math.round(v.w),g},e.multiplyScalar=function(g,v,S){return g.x=v.x*S,g.y=v.y*S,g.z=v.z*S,g.w=v.w*S,g},e.scaleAndAdd=function(g,v,S,O){return g.x=v.x+S.x*O,g.y=v.y+S.y*O,g.z=v.z+S.z*O,g.w=v.w+S.w*O,g},e.distance=function(g,v){var S=v.x-g.x,O=v.y-g.y,X=v.z-g.z,Y=v.w-g.w;return Math.sqrt(S*S+O*O+X*X+Y*Y)},e.squaredDistance=function(g,v){var S=v.x-g.x,O=v.y-g.y,X=v.z-g.z,Y=v.w-g.w;return S*S+O*O+X*X+Y*Y},e.len=function(g){var v=g.x,S=g.y,O=g.z,X=g.w;return Math.sqrt(v*v+S*S+O*O+X*X)},e.lengthSqr=function(g){var v=g.x,S=g.y,O=g.z,X=g.w;return v*v+S*S+O*O+X*X},e.negate=function(g,v){return g.x=-v.x,g.y=-v.y,g.z=-v.z,g.w=-v.w,g},e.inverse=function(g,v){return g.x=1/v.x,g.y=1/v.y,g.z=1/v.z,g.w=1/v.w,g},e.inverseSafe=function(g,v){var S=v.x,O=v.y,X=v.z,Y=v.w;return Math.abs(S)<ex?g.x=0:g.x=1/S,Math.abs(O)<ex?g.y=0:g.y=1/O,Math.abs(X)<ex?g.z=0:g.z=1/X,Math.abs(Y)<ex?g.w=0:g.w=1/Y,g},e.normalize=function(g,v){var S=v.x,O=v.y,X=v.z,Y=v.w,te=S*S+O*O+X*X+Y*Y;return te>0?(te=1/Math.sqrt(te),g.x=S*te,g.y=O*te,g.z=X*te,g.w=Y*te):(g.x=0,g.y=0,g.z=0,g.w=0),g},e.dot=function(g,v){return g.x*v.x+g.y*v.y+g.z*v.z+g.w*v.w},e.lerp=function(g,v,S,O){return g.x=v.x+O*(S.x-v.x),g.y=v.y+O*(S.y-v.y),g.z=v.z+O*(S.z-v.z),g.w=v.w+O*(S.w-v.w),g},e.scale=function(g,v,S){return g.x=v.x*S,g.y=v.y*S,g.z=v.z*S,g.w=v.w*S,g},e.random=function(g,v){v=v||1;var S=2*Ai()*Math.PI,O=2*Ai()-1,X=Math.sqrt(1-O*O);return g.x=X*Math.cos(S)*v,g.y=X*Math.sin(S)*v,g.z=O*v,g.w=0,g},e.transformMat4=function(g,v,S){var O=v.x,X=v.y,Y=v.z,te=v.w;return g.x=S.m00*O+S.m04*X+S.m08*Y+S.m12*te,g.y=S.m01*O+S.m05*X+S.m09*Y+S.m13*te,g.z=S.m02*O+S.m06*X+S.m10*Y+S.m14*te,g.w=S.m03*O+S.m07*X+S.m11*Y+S.m15*te,g},e.transformAffine=function(g,v,S){var O=v.x,X=v.y,Y=v.z,te=v.w;return g.x=S.m00*O+S.m04*X+S.m08*Y+S.m12*te,g.y=S.m01*O+S.m05*X+S.m09*Y+S.m13*te,g.z=S.m02*O+S.m06*X+S.m10*Y+S.m14*te,g.w=v.w,g},e.transformQuat=function(g,v,S){var O=v.x,X=v.y,Y=v.z,te=S.x,ti=S.y,tr=S.z,ta=S.w,th=ta*O+ti*Y-tr*X,tu=ta*X+tr*O-te*Y,tl=ta*Y+te*X-ti*O,tc=-te*O-ti*X-tr*Y;return g.x=th*ta+tc*-te+tu*-tr-tl*-ti,g.y=tu*ta+tc*-ti+tl*-te-th*-tr,g.z=tl*ta+tc*-tr+th*-ti-tu*-te,g.w=v.w,g},e.toArray=function(g,v,S){return void 0===S&&(S=0),g[S+0]=v.x,g[S+1]=v.y,g[S+2]=v.z,g[S+3]=v.w,g},e.fromArray=function(g,v,S){return void 0===S&&(S=0),g.x=v[S+0],g.y=v[S+1],g.z=v[S+2],g.w=v[S+3],g},e.strictEquals=function(g,v){return g.x===v.x&&g.y===v.y&&g.z===v.z&&g.w===v.w},e.equals=function(g,v,S){return void 0===S&&(S=ex),!(Math.abs(g.x)===1/0||Math.abs(g.y)===1/0||Math.abs(g.z)===1/0||Math.abs(g.w)===1/0||Math.abs(v.x)===1/0||Math.abs(v.y)===1/0||Math.abs(v.z)===1/0||Math.abs(v.w)===1/0)&&Math.abs(g.x-v.x)<=S*Math.max(1,Math.abs(g.x),Math.abs(v.x))&&Math.abs(g.y-v.y)<=S*Math.max(1,Math.abs(g.y),Math.abs(v.y))&&Math.abs(g.z-v.z)<=S*Math.max(1,Math.abs(g.z),Math.abs(v.z))&&Math.abs(g.w-v.w)<=S*Math.max(1,Math.abs(g.w),Math.abs(v.w))};var v=e.prototype;return v.clone=function(){return new e(this.x,this.y,this.z,this.w)},v.set=function(g,v,S,O){return"object"==(void 0===g?"undefined":_type_of(g))?(this.x=g.x,this.y=g.y,this.z=g.z,this.w=g.w):(this.x=g||0,this.y=v||0,this.z=S||0,this.w=O||0),this},v.equals=function(g,v){return void 0===v&&(v=ex),Math.abs(this.x-g.x)<=v*Math.max(1,Math.abs(this.x),Math.abs(g.x))&&Math.abs(this.y-g.y)<=v*Math.max(1,Math.abs(this.y),Math.abs(g.y))&&Math.abs(this.z-g.z)<=v*Math.max(1,Math.abs(this.z),Math.abs(g.z))&&Math.abs(this.w-g.w)<=v*Math.max(1,Math.abs(this.w),Math.abs(g.w))},v.equals4f=function(g,v,S,O,X){return void 0===X&&(X=ex),Math.abs(this.x-g)<=X*Math.max(1,Math.abs(this.x),Math.abs(g))&&Math.abs(this.y-v)<=X*Math.max(1,Math.abs(this.y),Math.abs(v))&&Math.abs(this.z-S)<=X*Math.max(1,Math.abs(this.z),Math.abs(S))&&Math.abs(this.w-O)<=X*Math.max(1,Math.abs(this.w),Math.abs(O))},v.strictEquals=function(g){return this.x===g.x&&this.y===g.y&&this.z===g.z&&this.w===g.w},v.strictEquals4f=function(g,v,S,O){return this.x===g&&this.y===v&&this.z===S&&this.w===O},v.lerp=function(g,v){var S=this.x,O=this.y,X=this.z,Y=this.w;return this.x=S+v*(g.x-S),this.y=O+v*(g.y-O),this.z=X+v*(g.z-X),this.w=Y+v*(g.w-Y),this},v.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},v.clampf=function(g,v){return this.x=mi(this.x,g.x,v.x),this.y=mi(this.y,g.y,v.y),this.z=mi(this.z,g.z,v.z),this.w=mi(this.w,g.w,v.w),this},v.add=function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this.w+=g.w,this},v.add4f=function(g,v,S,O){return this.x+=g,this.y+=v,this.z+=S,this.w+=O,this},v.subtract=function(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this.w-=g.w,this},v.subtract4f=function(g,v,S,O){return this.x-=g,this.y-=v,this.z-=S,this.w-=O,this},v.multiplyScalar=function(g){return"object"==(void 0===g?"undefined":_type_of(g))&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},v.multiply=function(g){return"object"!=(void 0===g?"undefined":_type_of(g))&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=g.x,this.y*=g.y,this.z*=g.z,this.w*=g.w,this},v.multiply4f=function(g,v,S,O){return this.x*=g,this.y*=v,this.z*=S,this.w*=O,this},v.divide=function(g){return this.x/=g.x,this.y/=g.y,this.z/=g.z,this.w/=g.w,this},v.divide4f=function(g,v,S,O){return this.x/=g,this.y/=v,this.z/=S,this.w/=O,this},v.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},v.dot=function(g){return this.x*g.x+this.y*g.y+this.z*g.z+this.w*g.w},v.cross=function(g){var v=this.x,S=this.y,O=this.z,X=g.x,Y=g.y,te=g.z;return this.x=S*te-O*Y,this.y=O*X-v*te,this.z=v*Y-S*X,this},v.length=function(){var g=this.x,v=this.y,S=this.z,O=this.w;return Math.sqrt(g*g+v*v+S*S+O*O)},v.lengthSqr=function(){var g=this.x,v=this.y,S=this.z,O=this.w;return g*g+v*v+S*S+O*O},v.normalize=function(){var g=this.x,v=this.y,S=this.z,O=this.w,X=g*g+v*v+S*S+O*O;return X>0&&(X=1/Math.sqrt(X),this.x=g*X,this.y=v*X,this.z=S*X,this.w=O*X),this},v.scale=function(g){return this.x*=g,this.y*=g,this.z*=g,this.w*=g,this},v.transformMat4=function(g){var v=this.x,S=this.y,O=this.z,X=this.w;return this.x=g.m00*v+g.m04*S+g.m08*O+g.m12*X,this.y=g.m01*v+g.m05*S+g.m09*O+g.m13*X,this.z=g.m02*v+g.m06*S+g.m10*O+g.m14*X,this.w=g.m03*v+g.m07*S+g.m11*O+g.m15*X,this},e}(tq));function An(g,v,S,O){return new e7(g,v,S,O)}e4=e7,e7.ZERO=Object.freeze(new e4(0,0,0,0)),e7.ONE=Object.freeze(new e4(1,1,1,1)),e7.NEG_ONE=Object.freeze(new e4(-1,-1,-1,-1)),e7.UNIT_X=Object.freeze(new e4(1,0,0,0)),e7.UNIT_Y=Object.freeze(new e4(0,1,0,0)),e7.UNIT_Z=Object.freeze(new e4(0,0,1,0)),e7.UNIT_W=Object.freeze(new e4(0,0,0,1)),ri.fastDefine("cc.Vec4",e7,{x:0,y:0,z:0,w:0}),X.Vec4=e7,X.v4=An;var e9,ir=1/255,is=g("aG",function(g){function e(v,S,O,X){var Y;return(Y=g.call(this)||this)._val=0,"string"==typeof v?Y.fromHEX(v):void 0!==S?Y.set(v,S,O,X):Y.set(v),Y}s(e,g),e.clone=function(g){var v=new e;return g._val?v._val=g._val:v._val=(g.a<<24>>>0)+(g.b<<16)+(g.g<<8)+g.r,v},e.copy=function(g,v){return g.r=v.r,g.g=v.g,g.b=v.b,g.a=v.a,g},e.set=function(g,v,S,O,X){return g.r=v,g.g=S,g.b=O,g.a=X,g},e.toVec4=function(g,v){return(v=void 0!==v?v:new e7).x=g.r*ir,v.y=g.g*ir,v.z=g.b*ir,v.w=g.a*ir,v},e.fromVec4=function(g,v){return(v=void 0===v?new e:v).r=Math.floor(g.x/ir),v.g=Math.floor(g.y/ir),v.b=Math.floor(g.z/ir),v.a=Math.floor(g.w/ir),v},e.fromHEX=function(g,v){var S;return"string"==typeof v?(6===(v="#"===v[0]?v.substring(1):v).length?v+="FF":3===v.length?v=v[0]+v[0]+v[1]+v[1]+v[2]+v[2]+"FF":4===v.length&&(v=v[0]+v[0]+v[1]+v[1]+v[2]+v[2]+v[3]+v[3]),S=Number("0x"+v)):(v<0x1000000&&(v=255+(v<<8)),S=v),g.r=S>>>24,g.g=(0xff0000&S)>>>16,g.b=(65280&S)>>>8,g.a=255&S,g._val=(g.a<<24>>>0)+(g.b<<16)+(g.g<<8)+g.r,g},e.add=function(g,v,S){return g.r=v.r+S.r,g.g=v.g+S.g,g.b=v.b+S.b,g.a=v.a+S.a,g},e.subtract=function(g,v,S){return g.r=v.r-S.r,g.g=v.g-S.g,g.b=v.b-S.b,g.a=v.a-S.a,g},e.multiply=function(g,v,S){return g.r=v.r*S.r,g.g=v.g*S.g,g.b=v.b*S.b,g.a=v.a*S.a,g},e.divide=function(g,v,S){return g.r=v.r/S.r,g.g=v.g/S.g,g.b=v.b/S.b,g.a=v.a/S.a,g},e.scale=function(g,v,S){return g.r=v.r*S,g.g=v.g*S,g.b=v.b*S,g.a=v.a*S,g},e.lerp=function(g,v,S,O){var X=v.r,Y=v.g,te=v.b,ti=v.a;return X+=(S.r-X)*O,Y+=(S.g-Y)*O,te+=(S.b-te)*O,ti+=(S.a-ti)*O,g._val=Math.floor((ti<<24>>>0)+(te<<16)+(Y<<8)+X),g},e.toArray=function(g,v,S){void 0===S&&(S=0);var O=_instanceof(v,e)||v.a>1?1/255:1;return g[S+0]=v.r*O,g[S+1]=v.g*O,g[S+2]=v.b*O,g[S+3]=v.a*O,g},e.fromArray=function(g,v,S){return void 0===S&&(S=0),v.r=255*g[S+0],v.g=255*g[S+1],v.b=255*g[S+2],v.a=255*g[S+3],v},e.fromUint32=function(g,v){return g._val=v,g},e.toUint32=function(g){return g._val},e.strictEquals=function(g,v){return g.r===v.r&&g.g===v.g&&g.b===v.b&&g.a===v.a},e.equals=function(g,v,S){return void 0===S&&(S=ex),!(Math.abs(g.r)===1/0||Math.abs(g.g)===1/0||Math.abs(g.b)===1/0||Math.abs(g.a)===1/0)&&Math.abs(g.r-v.r)<=S*Math.max(1,Math.abs(g.r),Math.abs(v.r))&&Math.abs(g.g-v.g)<=S*Math.max(1,Math.abs(g.g),Math.abs(v.g))&&Math.abs(g.b-v.b)<=S*Math.max(1,Math.abs(g.b),Math.abs(v.b))&&Math.abs(g.a-v.a)<=S*Math.max(1,Math.abs(g.a),Math.abs(v.a))},e.hex=function(g){return(255*g.r<<24|255*g.g<<16|255*g.b<<8|255*g.a)>>>0};var v=e.prototype;return v.clone=function(){var g=new e;return g._val=this._val,g},v.equals=function(g){return g&&this._val===g._val},v.lerp=function(g,v){var S=this.r,O=this.g,X=this.b,Y=this.a;return S+=(g.r-S)*v,O+=(g.g-O)*v,X+=(g.b-X)*v,Y+=(g.a-Y)*v,this._val=Math.floor((Y<<24>>>0)+(X<<16)+(O<<8)+S),this},v.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},v.toCSS=function(g){return void 0===g&&(g="rgba"),"rgba"===g?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*ir).toFixed(2)+")":"rgb"===g?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(g)},v.fromHEX=function(g){var v;"string"==typeof g?(6===(g="#"===g[0]?g.substring(1):g).length?g+="FF":3===g.length?g=g[0]+g[0]+g[1]+g[1]+g[2]+g[2]+"FF":4===g.length&&(g=g[0]+g[0]+g[1]+g[1]+g[2]+g[2]+g[3]+g[3]),v=Number("0x"+g)):(g<0x1000000&&(g=255+(g<<8)),v=g);var S=v>>>24,O=(0xff0000&v)>>>16,X=(65280&v)>>>8,Y=255&v;return this._val=(Y<<24>>>0)+(X<<16)+(O<<8)+S,this},v.toHEX=function(g){void 0===g&&(g="#rrggbb");var v="0",S=[(this.r<16?v:"")+this.r.toString(16),(this.g<16?v:"")+this.g.toString(16),(this.b<16?v:"")+this.b.toString(16)];return"#rgb"===g?(S[0]=S[0][0],S[1]=S[1][0],S[2]=S[2][0]):"#rrggbbaa"===g&&S.push((this.a<16?v:"")+this.a.toString(16)),S.join("")},v.toRGBValue=function(){return 0xffffff&this._val},v.fromHSV=function(g,v,S){var O=0,X=0,Y=0;if(0===v)O=X=Y=S;else if(0===S)O=X=Y=0;else{1===g&&(g=0),g*=6;var te=Math.floor(g),ti=g-te,tr=S*(1-v),ta=S*(1-v*ti),th=S*(1-v*(1-ti));switch(te){default:case 0:O=S,X=th,Y=tr;break;case 1:O=ta,X=S,Y=tr;break;case 2:O=tr,X=S,Y=th;break;case 3:O=tr,X=ta,Y=S;break;case 4:O=th,X=tr,Y=S;break;case 5:O=S,X=tr,Y=ta}}return O*=255,X*=255,Y*=255,this._val=(this.a<<24>>>0)+(Y<<16)+(X<<8)+(0|O),this},v.toHSV=function(){var g=this.r*ir,v=this.g*ir,S=this.b*ir,O={h:0,s:0,v:0},X=Math.max(g,v,S),Y=Math.min(g,v,S),te=0;return O.v=X,O.s=X?(X-Y)/X:0,O.s?(te=X-Y,O.h=g===X?(v-S)/te:v===X?2+(S-g)/te:4+(g-v)/te,O.h/=6,O.h<0&&(O.h+=1)):O.h=0,O},v.set=function(g,v,S,O){return"object"==(void 0===g?"undefined":_type_of(g))?null!=g._val?this._val=g._val:(v=g.g||0,S=g.b||0,O="number"==typeof g.a?g.a:255,g=g.r||0,this._val=(O<<24>>>0)+(S<<16)+(v<<8)+(0|g)):(g=g||0,v=v||0,S=S||0,O="number"==typeof O?O:255,this._val=(O<<24>>>0)+(S<<16)+(v<<8)+(0|g)),this},v.multiply=function(g){var v=(255&this._val)*g.r>>8,S=(65280&this._val)*g.g>>8,O=(0xff0000&this._val)*g.b>>8,X=((0xff000000&this._val)>>>8)*g.a;return this._val=0xff000000&X|0xff0000&O|65280&S|255&v,this},v._set_r_unsafe=function(g){return this._val=(0xffffff00&this._val|g)>>>0,this},v._set_g_unsafe=function(g){return this._val=(0xffff00ff&this._val|g<<8)>>>0,this},v._set_b_unsafe=function(g){return this._val=(0xff00ffff&this._val|g<<16)>>>0,this},v._set_a_unsafe=function(g){return this._val=(0xffffff&this._val|g<<24)>>>0,this},n(e,[{key:"r",get:function(){return 255&this._val},set:function(g){g=~~mi(g,0,255),this._val=(0xffffff00&this._val|g)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(g){g=~~mi(g,0,255),this._val=(0xffff00ff&this._val|g<<8)>>>0}},{key:"b",get:function(){return(0xff0000&this._val)>>16},set:function(g){g=~~mi(g,0,255),this._val=(0xff00ffff&this._val|g<<16)>>>0}},{key:"a",get:function(){return(0xff000000&this._val)>>>24},set:function(g){g=~~mi(g,0,255),this._val=(0xffffff&this._val|g<<24)>>>0}},{key:"x",get:function(){return this.r*ir},set:function(g){this.r=255*g}},{key:"y",get:function(){return this.g*ir},set:function(g){this.g=255*g}},{key:"z",get:function(){return this.b*ir},set:function(g){this.b=255*g}},{key:"w",get:function(){return this.a*ir},set:function(g){this.a=255*g}}]),e}(tq));function bn(g,v,S,O){return new is(g,v,S,O)}function xn(g){var v=g.clone();return v.x=Math.floor(g.x),v.y=Math.floor(g.y),v.z=Math.floor(g.z),v}e6=is,is.WHITE=Object.freeze(new e6(255,255,255,255)),is.GRAY=Object.freeze(new e6(127,127,127,255)),is.BLACK=Object.freeze(new e6(0,0,0,255)),is.TRANSPARENT=Object.freeze(new e6(0,0,0,0)),is.RED=Object.freeze(new e6(255,0,0,255)),is.GREEN=Object.freeze(new e6(0,255,0,255)),is.BLUE=Object.freeze(new e6(0,0,255,255)),is.CYAN=Object.freeze(new e6(0,255,255,255)),is.MAGENTA=Object.freeze(new e6(255,0,255,255)),is.YELLOW=Object.freeze(new e6(255,255,0,255)),ri.fastDefine("cc.Color",is,{r:0,g:0,b:0,a:255}),X.Color=is,X.color=bn,function(g){g[g.VEC2=0]="VEC2",g[g.VEC3=1]="VEC3",g[g.VEC4=2]="VEC4",g[g.QUATERNION=3]="QUATERNION",g[g.MAT3=4]="MAT3",g[g.MAT4=5]="MAT4",g[g.SIZE=6]="SIZE",g[g.RECT=7]="RECT",g[g.COLOR=8]="COLOR"}(e9||(e9={}));var ia,ih=g("aB",function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=1),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=1),void 0===X&&(X=0),void 0===Y&&(Y=0),this.a=g,this.b=v,this.c=S,this.d=O,this.tx=X,this.ty=Y}return t1.identity=function(){return new t1},t1.clone=function(g){return new t1(g.a,g.b,g.c,g.d,g.tx,g.ty)},t1.concat=function(g,v,S){var O=v.a,X=v.b,Y=v.c,te=v.d,ti=v.tx,tr=v.ty;g.a=O*S.a+X*S.c,g.b=O*S.b+X*S.d,g.c=Y*S.a+te*S.c,g.d=Y*S.b+te*S.d,g.tx=ti*S.a+tr*S.c+S.tx,g.ty=ti*S.b+tr*S.d+S.ty},t1.invert=function(g,v){var S=1/(v.a*v.d-v.b*v.c);g.a=S*v.d,g.b=-S*v.b,g.c=-S*v.c,g.d=S*v.a,g.tx=S*(v.c*v.ty-v.d*v.tx),g.ty=S*(v.b*v.tx-v.a*v.ty)},t1.fromMat4=function(g,v){g.a=v.m00,g.b=v.m01,g.c=v.m04,g.d=v.m05,g.tx=v.m12,g.ty=v.m13},t1.transformVec2=function(g,v,S,O){var X,Y;O?(X=v,Y=S):(O=S,X=v.x,Y=v.y),g.x=O.a*X+O.c*Y+O.tx,g.y=O.b*X+O.d*Y+O.ty},t1.transformSize=function(g,v,S){g.width=S.a*v.width+S.c*v.height,g.height=S.b*v.width+S.d*v.height},t1.transformRect=function(g,v,S){var O=v.x+v.width,X=v.y+v.height,Y=S.a*v.x+S.c*v.y+S.tx,te=S.b*v.x+S.d*v.y+S.ty,ti=S.a*O+S.c*v.y+S.tx,tr=S.b*O+S.d*v.y+S.ty,ta=S.a*v.x+S.c*X+S.tx,th=S.b*v.x+S.d*X+S.ty,tu=S.a*O+S.c*X+S.tx,tl=S.b*O+S.d*X+S.ty,tc=Math.min(Y,ti,ta,tu),t_=Math.max(Y,ti,ta,tu),tf=Math.min(te,tr,th,tl),tp=Math.max(te,tr,th,tl);g.x=tc,g.y=tf,g.width=t_-tc,g.height=tp-tf},t1.transformObb=function(g,v,S,O,X,Y,te){void 0===te&&(te=!0);var ti=Y.a*X.x+Y.c*X.y+Y.tx,tr=Y.b*X.x+Y.d*X.y+Y.ty,ta=Y.a*X.width,th=Y.b*X.width,tu=Y.c*X.height,tl=Y.d*X.height;te?(v.x=ti,v.y=tr,S.x=ta+ti,S.y=th+tr,g.x=tu+ti,g.y=tl+tr,O.x=ta+tu+ti,O.y=th+tl+tr):(g.x=ti,g.y=tr,O.x=ta+ti,O.y=th+tr,v.x=tu+ti,v.y=tl+tr,S.x=ta+tu+ti,S.y=th+tl+tr)},t1}());X.AffineTransform=ih;var iu=g("aC",function(g){function e(v,S){var O;return O=g.call(this)||this,"object"==(void 0===v?"undefined":_type_of(v))?(O.width=v.width,O.height=v.height):(O.width=v||0,O.height=S||0),O}s(e,g),e.lerp=function(g,v,S,O){return g.width=v.width+(S.width-v.width)*O,g.height=v.height+(S.height-v.height)*O,g},e.equals=function(g,v){return g.width===v.width&&g.height===v.height};var v=e.prototype;return v.clone=function(){return new e(this.width,this.height)},v.set=function(g,v){return"object"==(void 0===g?"undefined":_type_of(g))?(this.height=g.height,this.width=g.width):(this.width=g||0,this.height=v||0),this},v.equals=function(g){return this.width===g.width&&this.height===g.height},v.lerp=function(g,v){return this.width+=(g.width-this.width)*v,this.height+=(g.height-this.height)*v,this},v.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n(e,[{key:"x",get:function(){return this.width},set:function(g){this.width=g}},{key:"y",get:function(){return this.height},set:function(g){this.height=g}}]),e}(tq));function Bn(g,v){return void 0===g&&(g=0),void 0===v&&(v=0),new iu(g,v)}ia=iu,iu.ZERO=Object.freeze(new ia(0,0)),iu.ONE=Object.freeze(new ia(1,1)),ri.fastDefine("cc.Size",iu,{width:0,height:0}),X.size=Bn,X.Size=iu;var ic=g("aE",function(g){function e(v,S,O,X){var Y;return Y=g.call(this)||this,"object"==(void 0===v?"undefined":_type_of(v))?(Y.x=v.x,Y.y=v.y,Y.width=v.width,Y.height=v.height):(Y.x=v||0,Y.y=S||0,Y.width=O||0,Y.height=X||0),Y}s(e,g),e.fromMinMax=function(g,v,S){var O=Math.min(v.x,S.x),X=Math.min(v.y,S.y),Y=Math.max(v.x,S.x),te=Math.max(v.y,S.y);return g.x=O,g.y=X,g.width=Y-O,g.height=te-X,g},e.lerp=function(g,v,S,O){var X=v.x,Y=v.y,te=v.width,ti=v.height;return g.x=X+(S.x-X)*O,g.y=Y+(S.y-Y)*O,g.width=te+(S.width-te)*O,g.height=ti+(S.height-ti)*O,g},e.intersection=function(g,v,S){var O=v.x,X=v.y,Y=v.x+v.width,te=v.y+v.height,ti=S.x,tr=S.y,ta=S.x+S.width,th=S.y+S.height;return g.x=Math.max(O,ti),g.y=Math.max(X,tr),g.width=Math.min(Y,ta)-g.x,g.height=Math.min(te,th)-g.y,g},e.union=function(g,v,S){var O=v.x,X=v.y,Y=v.width,te=v.height,ti=S.x,tr=S.y,ta=S.width,th=S.height;return g.x=Math.min(O,ti),g.y=Math.min(X,tr),g.width=Math.max(O+Y,ti+ta)-g.x,g.height=Math.max(X+te,tr+th)-g.y,g},e.equals=function(g,v){return g.x===v.x&&g.y===v.y&&g.width===v.width&&g.height===v.height};var v=e.prototype;return v.clone=function(){return new e(this.x,this.y,this.width,this.height)},v.set=function(g,v,S,O){return"object"==(void 0===g?"undefined":_type_of(g))?(this.x=g.x,this.y=g.y,this.width=g.width,this.height=g.height):(this.x=g||0,this.y=v||0,this.width=S||0,this.height=O||0),this},v.equals=function(g){return this.x===g.x&&this.y===g.y&&this.width===g.width&&this.height===g.height},v.lerp=function(g,v){var S=this.x,O=this.y,X=this.width,Y=this.height;return this.x=S+(g.x-S)*v,this.y=O+(g.y-O)*v,this.width=X+(g.width-X)*v,this.height=Y+(g.height-Y)*v,this},v.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},v.intersects=function(g){var v=this.x+this.width,S=this.y+this.height,O=g.x+g.width,X=g.y+g.height;return!(v<g.x||O<this.x||S<g.y||X<this.y)},v.contains=function(g){return this.x<=g.x&&this.x+this.width>=g.x&&this.y<=g.y&&this.y+this.height>=g.y},v.containsRect=function(g){return this.x<=g.x&&this.x+this.width>=g.x+g.width&&this.y<=g.y&&this.y+this.height>=g.y+g.height},v.transformMat4=function(g){var v=this.x,S=this.y,O=v+this.width,X=S+this.height,Y=g.m00*v+g.m04*S+g.m12,te=g.m01*v+g.m05*S+g.m13,ti=g.m00*O+g.m04*S+g.m12,tr=g.m01*O+g.m05*S+g.m13,ta=g.m00*v+g.m04*X+g.m12,th=g.m01*v+g.m05*X+g.m13,tu=g.m00*O+g.m04*X+g.m12,tl=g.m01*O+g.m05*X+g.m13,tc=Math.min(Y,ti,ta,tu),t_=Math.max(Y,ti,ta,tu),tf=Math.min(te,tr,th,tl),tp=Math.max(te,tr,th,tl);return this.x=tc,this.y=tf,this.width=t_-tc,this.height=tp-tf,this},v.transformMat4ToPoints=function(g,v,S,O,X){var Y=this.x,te=this.y,ti=Y+this.width,tr=te+this.height;v.x=g.m00*Y+g.m04*te+g.m12,v.y=g.m01*Y+g.m05*te+g.m13,X.x=g.m00*ti+g.m04*te+g.m12,X.y=g.m01*ti+g.m05*te+g.m13,S.x=g.m00*Y+g.m04*tr+g.m12,S.y=g.m01*Y+g.m05*tr+g.m13,O.x=g.m00*ti+g.m04*tr+g.m12,O.y=g.m01*ti+g.m05*tr+g.m13},n(e,[{key:"xMin",get:function(){return this.x},set:function(g){this.width+=this.x-g,this.x=g}},{key:"yMin",get:function(){return this.y},set:function(g){this.height+=this.y-g,this.y=g}},{key:"xMax",get:function(){return this.x+this.width},set:function(g){this.width=g-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(g){this.height=g-this.y}},{key:"center",get:function(){return new e8(this.x+.5*this.width,this.y+.5*this.height)},set:function(g){this.x=g.x-.5*this.width,this.y=g.y-.5*this.height}},{key:"origin",get:function(){return new e8(this.x,this.y)},set:function(g){this.x=g.x,this.y=g.y}},{key:"size",get:function(){return new iu(this.width,this.height)},set:function(g){this.width=g.width,this.height=g.height}},{key:"z",get:function(){return this.width},set:function(g){this.width=g}},{key:"w",get:function(){return this.height},set:function(g){this.height=g}}]),e}(tq));function Dn(g,v,S,O){return void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),new ic(g,v,S,O)}ri.fastDefine("cc.Rect",ic,{x:0,y:0,width:0,height:0}),X.Rect=ic,X.rect=Dn;var i_=g("b7",Float64Array),id=g("b8",function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.createFloatArray=function(g){return new i_(g)},n(e,[{key:"array",get:function(){return this._array}}]),e}(tq)),ip=Object.freeze({__proto__:null,bits:tr,Vec2:e8,v2:vn,Vec3:eL,v3:Yi,Vec4:e7,v4:An,Quat:eW,quat:un,Mat3:eV,Mat4:e$,mat4:pn,AffineTransform:ih,Size:iu,size:Bn,Rect:ic,rect:Dn,Color:is,color:bn,preTransforms:eQ,HALF_PI:eE,TWO_PI:eC,EPSILON:ex,equals:di,approx:pi,clamp:mi,clamp01:gi,lerp:vi,toRadian:yi,toDegree:Si,random:Ai,setRandGenerator:Ti,randomRange:Ei,randomRangeInt:Ci,pseudoRandom:bi,pseudoRandomRange:xi,pseudoRandomRangeInt:Ri,nextPow2:wi,repeat:Ii,pingPong:Bi,inverseLerp:Pi,absMaxComponent:Di,absMax:Oi,enumerableProps:Mi,floatToHalf:Vi,halfToFloat:Ui,MATH_FLOAT_ARRAY:i_,MathBase:id});g("ak",ip);var im=new eL,ig=new eL,iS=new eL,iT=new eL,iE=new eL,iC=new eL,ix=new Array(3),ib=new Array(3);function Wn(g,v){return eL.dot(v.n,g)-v.d}function Xn(g,v,S){return eL.copy(g,v),eL.subtract(iE,S.center,S.halfExtents),eL.add(iC,S.center,S.halfExtents),g.x=g.x<iE.x?iE.x:g.x,g.y=g.y<iE.y?iE.y:g.y,g.z=g.z<iE.z?iE.z:g.z,g.x=g.x>iC.x?iC.x:g.x,g.y=g.y>iC.y?iC.y:g.y,g.z=g.z>iC.z?iC.z:g.z,g}function jn(g,v,S){eL.set(im,S.orientation.m00,S.orientation.m01,S.orientation.m02),eL.set(ig,S.orientation.m03,S.orientation.m04,S.orientation.m05),eL.set(iS,S.orientation.m06,S.orientation.m07,S.orientation.m08),ix[0]=im,ix[1]=ig,ix[2]=iS,ib[0]=S.halfExtents.x,ib[1]=S.halfExtents.y,ib[2]=S.halfExtents.z,eL.subtract(iT,v,S.center),eL.set(g,S.center.x,S.center.y,S.center.z);for(var O=0;O<3;O++){var X=eL.dot(iT,ix[O]);X>ib[O]&&(X=ib[O]),X<-ib[O]&&(X=-ib[O]),g.x+=X*ix[O].x,g.y+=X*ix[O].y,g.z+=X*ix[O].z}return g}var iR=Object.freeze({__proto__:null,point_plane:Wn,pt_point_plane:function(g,v,S){var O=Wn(v,S);return eL.subtract(g,v,eL.multiplyScalar(g,S.n,O))},pt_point_aabb:Xn,pt_point_obb:jn,pt_point_line:function(g,v,S,O){eL.subtract(im,S,O);var X=im.clone(),Y=eL.lengthSqr(X);if(0===Y)eL.copy(g,S);else{eL.subtract(im,v,S);var te=eL.dot(im,X)/Y;te<0?eL.copy(g,S):te>1?eL.copy(g,O):eL.scaleAndAdd(g,S,X,te)}}}),iw={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512,SHAPE_SPLINE:1024},iI=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=iw.SHAPE_LINE,this.s=new eL(g,v,S),this.e=new eL(O,X,Y)}return t1.create=function(g,v,S,O,X,Y){return new t1(g,v,S,O,X,Y)},t1.clone=function(g){return new t1(g.s.x,g.s.y,g.s.z,g.e.x,g.e.y,g.e.z)},t1.copy=function(g,v){return eL.copy(g.s,v.s),eL.copy(g.e,v.e),g},t1.fromPoints=function(g,v,S){return eL.copy(g.s,v),eL.copy(g.e,S),g},t1.set=function(g,v,S,O,X,Y,te){return g.s.x=v,g.s.y=S,g.s.z=O,g.e.x=X,g.e.y=Y,g.e.z=te,g},t1.len=function(g){return eL.distance(g.s,g.e)},t1.prototype.length=function(){return eL.distance(this.s,this.e)},n(t1,[{key:"type",get:function(){return this._type}}]),t1}(),iB=new eL(0,0,0),iP=new eL(0,0,0),iD=X.mat4(),iM=X.v4(),iO=function(){function t1(g,v,S,O){void 0===g&&(g=0),void 0===v&&(v=1),void 0===S&&(S=0),void 0===O&&(O=0),this.n=void 0,this._type=iw.SHAPE_PLANE,this.n=new eL(g,v,S),this.d=O}return t1.create=function(g,v,S,O){return new t1(g,v,S,O)},t1.clone=function(g){return new t1(g.n.x,g.n.y,g.n.z,g.d)},t1.copy=function(g,v){return eL.copy(g.n,v.n),g.d=v.d,g},t1.fromPoints=function(g,v,S,O){return eL.subtract(iB,S,v),eL.subtract(iP,O,v),eL.normalize(g.n,eL.cross(g.n,iB,iP)),g.d=eL.dot(g.n,v),g},t1.set=function(g,v,S,O,X){return g.n.x=v,g.n.y=S,g.n.z=O,g.d=X,g},t1.fromNormalAndPoint=function(g,v,S){return eL.copy(g.n,v),g.d=eL.dot(v,S),g},t1.normalize=function(g,v){var S=v.n.length();return eL.normalize(g.n,v.n),S>0&&(g.d=v.d/S),g},t1.prototype.transform=function(g){e$.invert(iD,g),e$.transpose(iD,iD),e7.set(iM,this.n.x,this.n.y,this.n.z,-this.d),e7.transformMat4(iM,iM,iD),eL.set(this.n,iM.x,iM.y,iM.z),this.d=-iM.w},n(t1,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(g){this.n.x=g}},{key:"y",get:function(){return this.n.y},set:function(g){this.n.y=g}},{key:"z",get:function(){return this.n.z},set:function(g){this.n.z=g}},{key:"w",get:function(){return this.d},set:function(g){this.d=g}}]),t1}(),iL=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=iw.SHAPE_RAY,this.o=new eL(g,v,S),this.d=new eL(O,X,Y)}return t1.create=function(g,v,S,O,X,Y){return void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=1),new t1(g,v,S,O,X,Y)},t1.clone=function(g){return new t1(g.o.x,g.o.y,g.o.z,g.d.x,g.d.y,g.d.z)},t1.copy=function(g,v){return eL.copy(g.o,v.o),eL.copy(g.d,v.d),g},t1.fromPoints=function(g,v,S){return eL.copy(g.o,v),eL.normalize(g.d,eL.subtract(g.d,S,v)),g},t1.set=function(g,v,S,O,X,Y,te){return g.o.x=v,g.o.y=S,g.o.z=O,g.d.x=X,g.d.y=Y,g.d.z=te,g},t1.prototype.computeHit=function(g,v){eL.normalize(g,this.d),eL.scaleAndAdd(g,this.o,g,v)},n(t1,[{key:"type",get:function(){return this._type}}]),t1}(),iF=function(){function t1(g,v,S,O,X,Y,te,ti,tr){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=1),void 0===X&&(X=0),void 0===Y&&(Y=0),void 0===te&&(te=0),void 0===ti&&(ti=1),void 0===tr&&(tr=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=iw.SHAPE_TRIANGLE,this.a=new eL(g,v,S),this.b=new eL(O,X,Y),this.c=new eL(te,ti,tr)}return t1.create=function(g,v,S,O,X,Y,te,ti,tr){return void 0===g&&(g=1),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=0),void 0===te&&(te=0),void 0===ti&&(ti=0),void 0===tr&&(tr=1),new t1(g,v,S,O,X,Y,te,ti,tr)},t1.clone=function(g){return new t1(g.a.x,g.a.y,g.a.z,g.b.x,g.b.y,g.b.z,g.c.x,g.c.y,g.c.z)},t1.copy=function(g,v){return eL.copy(g.a,v.a),eL.copy(g.b,v.b),eL.copy(g.c,v.c),g},t1.fromPoints=function(g,v,S,O){return eL.copy(g.a,v),eL.copy(g.b,S),eL.copy(g.c,O),g},t1.set=function(g,v,S,O,X,Y,te,ti,tr,ta){return g.a.x=v,g.a.y=S,g.a.z=O,g.b.x=X,g.b.y=Y,g.b.z=te,g.c.x=ti,g.c.y=tr,g.c.z=ta,g},n(t1,[{key:"type",get:function(){return this._type}}]),t1}(),ik=new eL,iG=new eL,iV=new eL,iU=new eL;function or(g){return Math.max(Math.max(g.x,g.y),g.z)}var iH=function(){function t1(g,v,S,O){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=1),this._center=new eL(0,0,0),this._radius=0,this._type=void 0,this._type=iw.SHAPE_SPHERE,this._center=new eL(g,v,S),this._radius=O}t1.create=function(g,v,S,O){return new t1(g,v,S,O)},t1.clone=function(g){return new t1(g.center.x,g.center.y,g.center.z,g.radius)},t1.copy=function(g,v){return eL.copy(g.center,v.center),g.radius=v.radius,g},t1.fromPoints=function(g,v,S){return eL.multiplyScalar(g.center,eL.add(ik,v,S),.5),g.radius=.5*eL.subtract(ik,S,v).length(),g},t1.set=function(g,v,S,O,X){return g.center.x=v,g.center.y=S,g.center.z=O,g.radius=X,g};var g=t1.prototype;return g.destroy=function(){},g.clone=function(){return t1.clone(this)},g.copy=function(g){return t1.copy(this,g)},g.getBoundary=function(g,v){eL.set(g,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),eL.set(v,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},g.transform=function(g,v,S,O,X){eL.transformMat4(X.center,this.center,g),X.radius=this.radius*or(O)},g.translateAndRotate=function(g,v,S){eL.transformMat4(S.center,this.center,g)},g.setScale=function(g,v){v.radius=this.radius*or(g)},g.mergePoint=function(g){this.radius<0&&(this.center.set(g),this.radius=0),eL.subtract(iG,g,this.center);var v=iG.length();if(v>this.radius){var S=.5*(v-this.radius);this.radius+=S,eL.multiplyScalar(iG,iG,S/v),eL.add(this.center,this.center,iG)}},g.mergePoints=function(g){var v=g.length;if(!(v<1)){this.radius=-1;for(var S=0;S<v;S++)this.mergePoint(g[S])}},g.mergeAABB=function(g){g.getBoundary(iV,iU),this.mergePoint(iV),this.mergePoint(iU)},n(t1,[{key:"center",get:function(){return this._center},set:function(g){this._center=g}},{key:"radius",get:function(){return this._radius},set:function(g){this._radius=g}},{key:"type",get:function(){return this._type}}]),t1}(),iz=new eL,iW=new eL,ij=new eL,iq=new eL,iY=new eV,dr=function(g,v,S){iY.m00=Math.abs(S.m00),iY.m01=Math.abs(S.m01),iY.m02=Math.abs(S.m02),iY.m03=Math.abs(S.m04),iY.m04=Math.abs(S.m05),iY.m05=Math.abs(S.m06),iY.m06=Math.abs(S.m08),iY.m07=Math.abs(S.m09),iY.m08=Math.abs(S.m10),eL.transformMat3(g,v,iY)},iK=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=1),void 0===X&&(X=1),void 0===Y&&(Y=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=iw.SHAPE_AABB,this.center=new eL(g,v,S),this.halfExtents=new eL(O,X,Y)}t1.create=function(g,v,S,O,X,Y){return new t1(g,v,S,O,X,Y)},t1.clone=function(g){return new t1(g.center.x,g.center.y,g.center.z,g.halfExtents.x,g.halfExtents.y,g.halfExtents.z)},t1.copy=function(g,v){return eL.copy(g.center,v.center),eL.copy(g.halfExtents,v.halfExtents),g},t1.fromPoints=function(g,v,S){return eL.add(iz,S,v),eL.subtract(iW,S,v),eL.multiplyScalar(g.center,iz,.5),eL.multiplyScalar(g.halfExtents,iW,.5),g},t1.set=function(g,v,S,O,X,Y,te){return g.center.set(v,S,O),g.halfExtents.set(X,Y,te),g},t1.merge=function(g,v,S){return eL.subtract(iz,v.center,v.halfExtents),eL.subtract(iW,S.center,S.halfExtents),eL.add(ij,v.center,v.halfExtents),eL.add(iq,S.center,S.halfExtents),eL.max(iq,ij,iq),eL.min(ij,iz,iW),t1.fromPoints(g,ij,iq)},t1.toBoundingSphere=function(g,v){return g.center.set(v.center),g.radius=v.halfExtents.length(),g},t1.transform=function(g,v,S){return eL.transformMat4(g.center,v.center,S),dr(g.halfExtents,v.halfExtents,S),g};var g=t1.prototype;return g.getBoundary=function(g,v){eL.subtract(g,this.center,this.halfExtents),eL.add(v,this.center,this.halfExtents)},g.transform=function(g,v,S,O,X){eL.transformMat4(X.center,this.center,g),dr(X.halfExtents,this.halfExtents,g)},g.clone=function(){return t1.clone(this)},g.copy=function(g){return t1.copy(this,g)},g.mergePoint=function(g){this.getBoundary(iz,iW),g.x<iz.x&&(iz.x=g.x),g.y<iz.y&&(iz.y=g.y),g.z<iz.z&&(iz.z=g.z),g.x>iW.x&&(iW.x=g.x),g.y>iW.y&&(iW.y=g.y),g.z>iW.z&&(iW.z=g.z),eL.add(ij,iz,iW),this.center.set(eL.multiplyScalar(ij,ij,.5)),this.halfExtents.set(iW.x-ij.x,iW.y-ij.y,iW.z-ij.z)},g.mergePoints=function(g){if(!(g.length<1))for(var v=0;v<g.length;v++)this.mergePoint(g[v])},g.mergeFrustum=function(g){this.mergePoints(g.vertices)},n(t1,[{key:"type",get:function(){return this._type}}]),t1}(),iJ=function(){function t1(g,v,S){void 0===g&&(g=.5),void 0===v&&(v=.5),void 0===S&&(S=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=iw.SHAPE_CAPSULE,this.radius=g,this.halfHeight=v,this.axis=S,this.center=new eL,this.rotation=new eW,this.ellipseCenter0=new eL(0,v,0),this.ellipseCenter1=new eL(0,-v,0),this.updateCache()}var g=t1.prototype;return g.transform=function(g,v,S,O,X){var Y=O,te=Di(Y);X.radius=this.radius*Math.abs(te);var ti=(this.halfHeight+this.radius)*Math.abs(Y.y)-X.radius;ti<0&&(ti=0),X.halfHeight=ti,eL.transformMat4(X.center,this.center,g),eW.multiply(X.rotation,this.rotation,S),X.updateCache()},g.updateCache=function(){this.updateLocalCenter(),eL.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),eL.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},g.updateLocalCenter=function(){var g=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(g,0,0),this.ellipseCenter1.set(-g,0,0);break;case 1:this.ellipseCenter0.set(0,g,0),this.ellipseCenter1.set(0,-g,0);break;case 2:this.ellipseCenter0.set(0,0,g),this.ellipseCenter1.set(0,0,-g)}},n(t1,[{key:"type",get:function(){return this._type}}]),t1}(),iZ=new Array(8);iZ[0]=new eL(1,1,1),iZ[1]=new eL(-1,1,1),iZ[2]=new eL(-1,-1,1),iZ[3]=new eL(1,-1,1),iZ[4]=new eL(1,1,-1),iZ[5]=new eL(-1,1,-1),iZ[6]=new eL(-1,-1,-1),iZ[7]=new eL(1,-1,-1);var iQ,i0,i2,i3,i4,i8=new eL,i6=new eL,i7=new eL,i9=function(){e.createOrthographic=function(g,v,S,O,X,Y){var te=v/2,ti=S/2;eL.set(i7,te,ti,-O),eL.transformMat4(g.vertices[0],i7,Y),eL.set(i7,-te,ti,-O),eL.transformMat4(g.vertices[1],i7,Y),eL.set(i7,-te,-ti,-O),eL.transformMat4(g.vertices[2],i7,Y),eL.set(i7,te,-ti,-O),eL.transformMat4(g.vertices[3],i7,Y),eL.set(i7,te,ti,-X),eL.transformMat4(g.vertices[4],i7,Y),eL.set(i7,-te,ti,-X),eL.transformMat4(g.vertices[5],i7,Y),eL.set(i7,-te,-ti,-X),eL.transformMat4(g.vertices[6],i7,Y),eL.set(i7,te,-ti,-X),eL.transformMat4(g.vertices[7],i7,Y),g.updatePlanes()},e.createOrtho=function(g,v,S,O,X,Y){return e.createOrthographic(g,v,S,O,X,Y)},e.createPerspective=function(g,v,S,O,X,Y){var te=Math.tan(.5*S),ti=te*v;i8.set(O*ti,O*te,O),i6.set(X*ti,X*te,X);var tr=g.vertices;i7.set(i8.x,i8.y,-i8.z),eL.transformMat4(tr[0],i7,Y),i7.set(-i8.x,i8.y,-i8.z),eL.transformMat4(tr[1],i7,Y),i7.set(-i8.x,-i8.y,-i8.z),eL.transformMat4(tr[2],i7,Y),i7.set(i8.x,-i8.y,-i8.z),eL.transformMat4(tr[3],i7,Y),i7.set(i6.x,i6.y,-i6.z),eL.transformMat4(tr[4],i7,Y),i7.set(-i6.x,i6.y,-i6.z),eL.transformMat4(tr[5],i7,Y),i7.set(-i6.x,-i6.y,-i6.z),eL.transformMat4(tr[6],i7,Y),i7.set(i6.x,-i6.y,-i6.z),eL.transformMat4(tr[7],i7,Y),g.updatePlanes()},e.createFromAABB=function(g,v){var S=new eL,O=new eL;return eL.subtract(S,v.center,v.halfExtents),eL.add(O,v.center,v.halfExtents),g.vertices[0].set(O.x,O.y,-S.z),g.vertices[1].set(S.x,O.y,-S.z),g.vertices[2].set(S.x,S.y,-S.z),g.vertices[3].set(O.x,S.y,-S.z),g.vertices[4].set(O.x,O.y,-O.z),g.vertices[5].set(S.x,O.y,-O.z),g.vertices[6].set(S.x,S.y,-O.z),g.vertices[7].set(O.x,S.y,-O.z),g.updatePlanes(),g};var g=e.prototype;function e(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=iw.SHAPE_FRUSTUM,this.planes=new Array(6);for(var g=0;g<6;++g)this.planes[g]=iO.create(0,0,0,0);this.vertices=new Array(8);for(var v=0;v<8;++v)this.vertices[v]=new eL}return g.split=function(g,v,S,O,X){return e.createPerspective(this,S,O,g,v,X)},e.create=function(){return new e},e.clone=function(g){return e.copy(new e,g)},e.copy=function(g,v){g._type=v.type;for(var S=0;S<6;++S)iO.copy(g.planes[S],v.planes[S]);for(var O=0;O<8;++O)eL.copy(g.vertices[O],v.vertices[O]);return g},g.update=function(g,v){eL.set(this.planes[0].n,g.m03+g.m00,g.m07+g.m04,g.m11+g.m08),this.planes[0].d=-(g.m15+g.m12),eL.set(this.planes[1].n,g.m03-g.m00,g.m07-g.m04,g.m11-g.m08),this.planes[1].d=-(g.m15-g.m12),eL.set(this.planes[2].n,g.m03+g.m01,g.m07+g.m05,g.m11+g.m09),this.planes[2].d=-(g.m15+g.m13),eL.set(this.planes[3].n,g.m03-g.m01,g.m07-g.m05,g.m11-g.m09),this.planes[3].d=-(g.m15-g.m13),eL.set(this.planes[4].n,g.m03+g.m02,g.m07+g.m06,g.m11+g.m10),this.planes[4].d=-(g.m15+g.m14),eL.set(this.planes[5].n,g.m03-g.m02,g.m07-g.m06,g.m11-g.m10),this.planes[5].d=-(g.m15-g.m14);for(var S=0;S<6;S++){var O=this.planes[S],X=1/O.n.length();eL.multiplyScalar(O.n,O.n,X),O.d*=X}for(var Y=0;Y<8;Y++)eL.transformMat4(this.vertices[Y],iZ[Y],v)},g.transform=function(g){for(var v=0;v<8;v++)eL.transformMat4(this.vertices[v],this.vertices[v],g);this.updatePlanes()},g.zero=function(){for(var g=0;g<8;g++)this.vertices[g].set(0,0,0);for(var v=0;v<6;v++)iO.set(this.planes[v],0,0,0,0)},g.updatePlanes=function(){iO.fromPoints(this.planes[0],this.vertices[1],this.vertices[6],this.vertices[5]),iO.fromPoints(this.planes[1],this.vertices[3],this.vertices[4],this.vertices[7]),iO.fromPoints(this.planes[2],this.vertices[6],this.vertices[3],this.vertices[7]),iO.fromPoints(this.planes[3],this.vertices[0],this.vertices[5],this.vertices[4]),iO.fromPoints(this.planes[4],this.vertices[2],this.vertices[0],this.vertices[3]),iO.fromPoints(this.planes[5],this.vertices[7],this.vertices[5],this.vertices[6])},n(e,[{key:"accurate",set:function(g){this._type=g?iw.SHAPE_FRUSTUM_ACCURATE:iw.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]),e}(),wr=function(g,v){var S=eL.dot(g.d,v.n);if(Math.abs(S)<Number.EPSILON)return 0;var O=-Wn(g.o,v)/S;return O<0?0:O},nn=(iQ=new eL(0,0,0),i0=new eL(0,0,0),i2=new eL(0,0,0),i3=new eL(0,0,0),i4=new eL(0,0,0),function(g,v,S){eL.subtract(iQ,v.b,v.a),eL.subtract(i0,v.c,v.a),eL.cross(i2,g.d,i0);var O=eL.dot(iQ,i2);if(O<Number.EPSILON&&(!S||O>-Number.EPSILON))return 0;var X=1/O;eL.subtract(i3,g.o,v.a);var Y=eL.dot(i3,i2)*X;if(Y<0||Y>1)return 0;eL.cross(i4,i3,iQ);var te=eL.dot(g.d,i4)*X;if(te<0||Y+te>1)return 0;var ti=eL.dot(i0,i4)*X;return ti<0?0:ti}),nr=function(){var g=new eL(0,0,0);return function(v,S){var O=S.radius,X=S.center,Y=v.o,te=v.d,ti=O*O;eL.subtract(g,X,Y);var tr=g.lengthSqr(),ta=eL.dot(g,te),th=ti-(tr-ta*ta);if(th<0)return 0;var tu=Math.sqrt(th),tl=tr<ti?ta+tu:ta-tu;return tl<0?0:tl}}(),ns=function(){var g=new eL,v=new eL;return function(S,O){return eL.subtract(g,O.center,O.halfExtents),eL.add(v,O.center,O.halfExtents),function(g,v,S){var O=g.o,X=g.d,Y=1/X.x,te=1/X.y,ti=1/X.z,tr=(v.x-O.x)*Y,ta=(S.x-O.x)*Y,th=(v.y-O.y)*te,tu=(S.y-O.y)*te,tl=(v.z-O.z)*ti,tc=(S.z-O.z)*ti,t_=Math.max(Math.max(Math.min(tr,ta),Math.min(th,tu)),Math.min(tl,tc)),tf=Math.min(Math.min(Math.max(tr,ta),Math.max(th,tu)),Math.max(tl,tc));return tf<0||t_>tf?0:t_>0?t_:tf}(S,g,v)}}(),na=function(){var g=new eL,v=new eL,S=new eL,O=new eL,X=new eL,Y=new eL,te=new eL,ti=new Array(3),tr=new Array(3),ta=new Array(3),th=new Array(6);return function(tu,tl){ti[0]=tl.halfExtents.x,ti[1]=tl.halfExtents.y,ti[2]=tl.halfExtents.z,g=tl.center,v=tu.o,S=tu.d,eL.set(O,tl.orientation.m00,tl.orientation.m01,tl.orientation.m02),eL.set(X,tl.orientation.m03,tl.orientation.m04,tl.orientation.m05),eL.set(Y,tl.orientation.m06,tl.orientation.m07,tl.orientation.m08),eL.subtract(te,g,v),tr[0]=eL.dot(O,S),tr[1]=eL.dot(X,S),tr[2]=eL.dot(Y,S),ta[0]=eL.dot(O,te),ta[1]=eL.dot(X,te),ta[2]=eL.dot(Y,te);for(var tc=0;tc<3;++tc){if(0===tr[tc]){if(-ta[tc]-ti[tc]>0||-ta[tc]+ti[tc]<0)return 0;tr[tc]=1e-7}th[2*tc+0]=(ta[tc]+ti[tc])/tr[tc],th[2*tc+1]=(ta[tc]-ti[tc])/tr[tc]}var t_=Math.max(Math.max(Math.min(th[0],th[1]),Math.min(th[2],th[3])),Math.min(th[4],th[5])),tf=Math.min(Math.min(Math.max(th[0],th[1]),Math.max(th[2],th[3])),Math.max(th[4],th[5]));return tf<0||t_>tf?0:t_>0?t_:tf}}(),nh=function(){var g=new eL,v=new eL,S=new eL,O=new eL,X=new eL,Y=new eL,te=new eL,ti=new iH;return function(tr,ta){var th=ta.ellipseCenter0,tu=ta.ellipseCenter1,tl=eL.subtract(v,tu,th);if(tl.length()<ex)return ti.radius=ta.radius,ti.center.set(ta.ellipseCenter0),nF.raySphere(tr,ti);var tc=tr.o,t_=eL.subtract(S,tc,th),tf=eL.normalize(g,tr.d),tp=eL.cross(O,tf,tl),tm=tp.lengthSqr();if(0===tm){ti.radius=ta.radius;var tg=eL.subtract(X,tu,tc);return t_.lengthSqr()<tg.lengthSqr()?ti.center.set(th):ti.center.set(tu),nF.raySphere(tr,ti)}var tv=eL.cross(X,t_,tl),ty=tl.lengthSqr(),tS=2*eL.dot(tp,tv),tA=ta.radius*ta.radius,tT=tS*tS-4*tm*(tv.lengthSqr()-tA*ty);if(tT<0)return 0;var tE=(-tS-Math.sqrt(tT))/(2*tm);if(tE<0){ti.radius=ta.radius;var tC=eL.subtract(Y,tu,tc);return t_.lengthSqr()<tC.lengthSqr()?ti.center.set(ta.ellipseCenter0):ti.center.set(ta.ellipseCenter1),nF.raySphere(tr,ti)}var tx=eL.scaleAndAdd(Y,tr.o,tf,tE),tb=eL.subtract(te,tx,th),tw=eL.dot(tb,tl)/ty;return tw>=0&&tw<=1?tE:tw<0?(ti.radius=ta.radius,ti.center.set(ta.ellipseCenter0),nF.raySphere(tr,ti)):tw>1?(ti.radius=ta.radius,ti.center.set(ta.ellipseCenter1),nF.raySphere(tr,ti)):0}}(),nu=function(){var g=new eL(0,0,0);return function(v,S){eL.subtract(g,v.e,v.s);var O=-Wn(v.s,S)/eL.dot(g,S.n);return O<0||O>1?0:O}}(),nl=function(){var g=new eL(0,0,0),v=new eL(0,0,0),S=new eL(0,0,0),O=new eL(0,0,0),X=new eL(0,0,0),Y=new eL(0,0,0);return function(te,ti,tr){eL.subtract(g,ti.b,ti.a),eL.subtract(v,ti.c,ti.a),eL.subtract(S,te.s,te.e),eL.cross(X,g,v);var ta=eL.dot(S,X);if(ta<=0)return 0;eL.subtract(O,te.s,ti.a);var th=eL.dot(O,X);if(th<0||th>ta)return 0;eL.cross(Y,S,O);var tu=eL.dot(v,Y);if(tu<0||tu>ta)return 0;var tl=-eL.dot(g,Y);if(tl<0||tu+tl>ta)return 0;if(tr){var tc=1/ta,t_=1-(tu*=tc)-(tl*=tc);eL.set(tr,ti.a.x*t_+ti.b.x*tu+ti.c.x*tl,ti.a.y*t_+ti.b.y*tu+ti.c.y*tl,ti.a.z*t_+ti.b.z*tu+ti.c.z*tl)}return 1}}(),nc=new iL;function Nr(g,v){nc.o.set(g.s),eL.subtract(nc.d,g.e,g.s),nc.d.normalize();var S=ns(nc,v);return S<=g.length()?S:0}function Gr(g,v){nc.o.set(g.s),eL.subtract(nc.d,g.e,g.s),nc.d.normalize();var S=na(nc,v);return S<=g.length()?S:0}function kr(g,v){nc.o.set(g.s),eL.subtract(nc.d,g.e,g.s),nc.d.normalize();var S=nr(nc,v);return S<=g.length()?S:0}var n_,nf,nd,np,nm=(n_=new eL,nf=new eL,nd=new eL,np=new eL,function(g,v){return eL.subtract(n_,g.center,g.halfExtents),eL.add(nf,g.center,g.halfExtents),eL.subtract(nd,v.center,v.halfExtents),eL.add(np,v.center,v.halfExtents),n_.x<=np.x&&nf.x>=nd.x&&n_.y<=np.y&&nf.y>=nd.y&&n_.z<=np.z&&nf.z>=nd.z});function Xr(g,v,S,O,X,Y){eL.set(Y[0],g.x+S.x*v.x+O.x*v.y+X.x*v.z,g.y+S.y*v.x+O.y*v.y+X.y*v.z,g.z+S.z*v.x+O.z*v.y+X.z*v.z),eL.set(Y[1],g.x-S.x*v.x+O.x*v.y+X.x*v.z,g.y-S.y*v.x+O.y*v.y+X.y*v.z,g.z-S.z*v.x+O.z*v.y+X.z*v.z),eL.set(Y[2],g.x+S.x*v.x-O.x*v.y+X.x*v.z,g.y+S.y*v.x-O.y*v.y+X.y*v.z,g.z+S.z*v.x-O.z*v.y+X.z*v.z),eL.set(Y[3],g.x+S.x*v.x+O.x*v.y-X.x*v.z,g.y+S.y*v.x+O.y*v.y-X.y*v.z,g.z+S.z*v.x+O.z*v.y-X.z*v.z),eL.set(Y[4],g.x-S.x*v.x-O.x*v.y-X.x*v.z,g.y-S.y*v.x-O.y*v.y-X.y*v.z,g.z-S.z*v.x-O.z*v.y-X.z*v.z),eL.set(Y[5],g.x+S.x*v.x-O.x*v.y-X.x*v.z,g.y+S.y*v.x-O.y*v.y-X.y*v.z,g.z+S.z*v.x-O.z*v.y-X.z*v.z),eL.set(Y[6],g.x-S.x*v.x+O.x*v.y-X.x*v.z,g.y-S.y*v.x+O.y*v.y-X.y*v.z,g.z-S.z*v.x+O.z*v.y-X.z*v.z),eL.set(Y[7],g.x-S.x*v.x-O.x*v.y+X.x*v.z,g.y-S.y*v.x-O.y*v.y+X.y*v.z,g.z-S.z*v.x-O.z*v.y+X.z*v.z)}function jr(g,v){for(var S=eL.dot(v,g[0]),O=S,X=1;X<8;++X){var Y=eL.dot(v,g[X]);S=Y<S?Y:S,O=Y>O?Y:O}return[S,O]}var ng,ny,nS,nT,nE,nC=function(){for(var g=new Array(15),v=0;v<15;v++)g[v]=new eL(0,0,0);for(var S=new Array(8),O=new Array(8),X=0;X<8;X++)S[X]=new eL(0,0,0),O[X]=new eL(0,0,0);var Y=new eL,te=new eL;return function(v,X){eL.set(g[0],1,0,0),eL.set(g[1],0,1,0),eL.set(g[2],0,0,1),eL.set(g[3],X.orientation.m00,X.orientation.m01,X.orientation.m02),eL.set(g[4],X.orientation.m03,X.orientation.m04,X.orientation.m05),eL.set(g[5],X.orientation.m06,X.orientation.m07,X.orientation.m08);for(var ti=0;ti<3;++ti)eL.cross(g[6+3*ti],g[ti],g[3]),eL.cross(g[7+3*ti],g[ti],g[4]),eL.cross(g[7+3*ti],g[ti],g[5]);eL.subtract(Y,v.center,v.halfExtents),eL.add(te,v.center,v.halfExtents),function(g,v,S){eL.set(S[0],g.x,v.y,v.z),eL.set(S[1],g.x,v.y,g.z),eL.set(S[2],g.x,g.y,v.z),eL.set(S[3],g.x,g.y,g.z),eL.set(S[4],v.x,v.y,v.z),eL.set(S[5],v.x,v.y,g.z),eL.set(S[6],v.x,g.y,v.z),eL.set(S[7],v.x,g.y,g.z)}(Y,te,S),Xr(X.center,X.halfExtents,g[3],g[4],g[5],O);for(var tr=0;tr<15;++tr){var ta=jr(S,g[tr]),th=jr(O,g[tr]);if(th[0]>ta[1]||ta[0]>th[1])return 0}return 1}}(),$r=function(g,v){var S=g.halfExtents.x*Math.abs(v.n.x)+g.halfExtents.y*Math.abs(v.n.y)+g.halfExtents.z*Math.abs(v.n.z),O=eL.dot(v.n,g.center);return O+S<v.d?-1:O-S>v.d?0:1},ts=function(g,v){for(var S=0;S<v.planes.length;S++)if(-1===$r(g,v.planes[S]))return 0;return 1},nx=function(){for(var g=new Array(8),v=0,S=0,O=0;O<g.length;O++)g[O]=new eL(0,0,0);return function(O,X){for(var Y=0,te=!1,ti=0;ti<X.planes.length;ti++){if(-1===(Y=$r(O,X.planes[ti])))return 0;1===Y&&(te=!0)}if(!te)return 1;for(var tr=0;tr<X.vertices.length;tr++)eL.subtract(g[tr],X.vertices[tr],O.center);v=0,S=0;for(var ta=0;ta<X.vertices.length;ta++)g[ta].x>O.halfExtents.x?v++:g[ta].x<-O.halfExtents.x&&S++;if(v===X.vertices.length||S===X.vertices.length)return 0;v=0,S=0;for(var th=0;th<X.vertices.length;th++)g[th].y>O.halfExtents.y?v++:g[th].y<-O.halfExtents.y&&S++;if(v===X.vertices.length||S===X.vertices.length)return 0;v=0,S=0;for(var tu=0;tu<X.vertices.length;tu++)g[tu].z>O.halfExtents.z?v++:g[tu].z<-O.halfExtents.z&&S++;return v===X.vertices.length||S===X.vertices.length?0:1}}(),nb=(ng=new eL(0,0,0),ny=new eV,function(g,v){var S,O;return eL.subtract(ng,v,g.center),eL.transformMat3(ng,ng,eV.transpose(ny,g.orientation)),S=ng,O=g.halfExtents,Math.abs(S.x)<O.x&&Math.abs(S.y)<O.y&&Math.abs(S.z)<O.z}),nR=(nS=function(g,v,S,O){return Math.abs(g.x*v+g.y*S+g.z*O)},function(g,v){var S=g.halfExtents.x*nS(v.n,g.orientation.m00,g.orientation.m01,g.orientation.m02)+g.halfExtents.y*nS(v.n,g.orientation.m03,g.orientation.m04,g.orientation.m05)+g.halfExtents.z*nS(v.n,g.orientation.m06,g.orientation.m07,g.orientation.m08),O=eL.dot(v.n,g.center);return O+S<v.d?-1:O-S>v.d?0:1}),rs=function(g,v){for(var S=0;S<v.planes.length;S++)if(-1===nR(g,v.planes[S]))return 0;return 1},nw=function(){for(var g=new Array(8),v=0,S=0,O=0,X=0;X<g.length;X++)g[X]=new eL(0,0,0);var _$s=function(g,v,S,O){return g.x*v+g.y*S+g.z*O};return function(X,Y){for(var te=0,ti=!1,tr=0;tr<Y.planes.length;tr++){if(-1===(te=nR(X,Y.planes[tr])))return 0;1===te&&(ti=!0)}if(!ti)return 1;for(var ta=0;ta<Y.vertices.length;ta++)eL.subtract(g[ta],Y.vertices[ta],X.center);S=0,O=0;for(var th=0;th<Y.vertices.length;th++)(v=_$s(g[th],X.orientation.m00,X.orientation.m01,X.orientation.m02))>X.halfExtents.x?S++:v<-X.halfExtents.x&&O++;if(S===Y.vertices.length||O===Y.vertices.length)return 0;S=0,O=0;for(var tu=0;tu<Y.vertices.length;tu++)(v=_$s(g[tu],X.orientation.m03,X.orientation.m04,X.orientation.m05))>X.halfExtents.y?S++:v<-X.halfExtents.y&&O++;if(S===Y.vertices.length||O===Y.vertices.length)return 0;S=0,O=0;for(var tl=0;tl<Y.vertices.length;tl++)(v=_$s(g[tl],X.orientation.m06,X.orientation.m07,X.orientation.m08))>X.halfExtents.z?S++:v<-X.halfExtents.z&&O++;return S===Y.vertices.length||O===Y.vertices.length?0:1}}(),nI=function(){for(var g=new Array(15),v=0;v<15;v++)g[v]=new eL(0,0,0);for(var S=new Array(8),O=new Array(8),X=0;X<8;X++)S[X]=new eL(0,0,0),O[X]=new eL(0,0,0);return function(v,X){eL.set(g[0],v.orientation.m00,v.orientation.m01,v.orientation.m02),eL.set(g[1],v.orientation.m03,v.orientation.m04,v.orientation.m05),eL.set(g[2],v.orientation.m06,v.orientation.m07,v.orientation.m08),eL.set(g[3],X.orientation.m00,X.orientation.m01,X.orientation.m02),eL.set(g[4],X.orientation.m03,X.orientation.m04,X.orientation.m05),eL.set(g[5],X.orientation.m06,X.orientation.m07,X.orientation.m08);for(var Y=0;Y<3;++Y)eL.cross(g[6+3*Y],g[Y],g[3]),eL.cross(g[7+3*Y],g[Y],g[4]),eL.cross(g[8+3*Y],g[Y],g[5]);Xr(v.center,v.halfExtents,g[0],g[1],g[2],S),Xr(X.center,X.halfExtents,g[3],g[4],g[5],O);for(var te=0;te<15;++te){var ti=jr(S,g[te]),tr=jr(O,g[te]);if(tr[0]>ti[1]||ti[0]>tr[1])return 0}return 1}}(),nB=function(){for(var g=new iH,v=new eL,S=new eL,O=new eL,X=new Array(8),Y=0;Y<8;Y++)X[Y]=new eL;for(var te=new Array(8),ti=0;ti<8;ti++)te[ti]=new eL;return function(Y,ti){if(0===eL.squaredDistance(ti.ellipseCenter0,ti.ellipseCenter1))return g.radius=ti.radius,g.center.set(ti.ellipseCenter0),nF.sphereOBB(g,Y);v.x=Y.orientation.m00,v.y=Y.orientation.m01,v.z=Y.orientation.m02,S.x=Y.orientation.m03,S.y=Y.orientation.m04,S.z=Y.orientation.m05,O.x=Y.orientation.m06,O.y=Y.orientation.m07,O.z=Y.orientation.m08,Xr(Y.center,Y.halfExtents,v,S,O,X);var tr=te,ta=eL.copy(tr[0],v),th=eL.copy(tr[1],S),tu=eL.copy(tr[2],O);eL.subtract(tr[3],ti.center,Y.center).normalize();var tl=eL.subtract(tr[4],ti.ellipseCenter0,ti.ellipseCenter1);tl.normalize(),eL.cross(tr[5],ta,tl),eL.cross(tr[6],th,tl),eL.cross(tr[7],tu,tl);for(var tc=0;tc<8;++tc){var t_=jr(X,tr[tc]),tf=eL.dot(tr[tc],ti.ellipseCenter0),tp=eL.dot(tr[tc],ti.ellipseCenter1),tm=Math.max(tf,tp),tg=Math.min(tf,tp)-ti.radius,tv=tm+ti.radius;if(tg>t_[1]||t_[0]>tv)return 0}return 1}}(),hs=function(g,v){var S=eL.dot(v.n,g.center),O=g.radius*v.n.length();return S+O<v.d?-1:S-O>v.d?0:1},us=function(g,v){for(var S=0;S<v.planes.length;S++)if(-1===hs(g,v.planes[S]))return 0;return 1},nP=(nT=new eL(0,0,0),nE=[1,-1,1,-1,1,-1],function(g,v){for(var S=0;S<6;S++){var O=v.planes[S],X=g.radius,Y=g.center,te=O.n,ti=O.d,tr=eL.dot(te,Y);if(tr+X<ti)return 0;if(!(tr-X>ti)){eL.add(nT,Y,eL.multiplyScalar(nT,te,X));for(var ta=0;ta<6;ta++)if(ta!==S&&ta!==S+nE[S]){var th=v.planes[ta];if(eL.dot(th.n,nT)<th.d)return 0}}}return 1}),cs=function(g,v){var S=g.radius+v.radius;return eL.squaredDistance(g.center,v.center)<S*S},nD=function(){var g=new eL;return function(v,S){return Xn(g,v.center,S),eL.squaredDistance(v.center,g)<v.radius*v.radius}}(),nM=function(){var g=new eL;return function(v,S){return jn(g,v.center,S),eL.squaredDistance(v.center,g)<v.radius*v.radius}}(),nO=function(){var g=new eL,v=new eL;return function(S,O){var X=S.radius+O.radius,Y=X*X,te=eL.squaredDistance(O.ellipseCenter0,O.ellipseCenter1);if(0===te)return eL.squaredDistance(S.center,O.center)<Y;eL.subtract(g,S.center,O.ellipseCenter0),eL.subtract(v,O.ellipseCenter1,O.ellipseCenter0);var ti=eL.dot(g,v)/te;return ti<0?eL.squaredDistance(S.center,O.ellipseCenter0)<Y:ti>1?eL.squaredDistance(S.center,O.ellipseCenter1)<Y:(eL.scaleAndAdd(g,O.ellipseCenter0,v,ti),eL.squaredDistance(S.center,g)<Y)}}(),nL=function(){var g=new eL,v=new eL,S=new eL,O=new eL,X=new eL,Y=new eL;return function(te,ti){var tr,ta,th=eL.subtract(g,te.ellipseCenter1,te.ellipseCenter0),tu=eL.subtract(v,ti.ellipseCenter1,ti.ellipseCenter0),tl=eL.subtract(S,te.ellipseCenter0,ti.ellipseCenter0),tc=eL.dot(th,th),t_=eL.dot(th,tu),tf=eL.dot(tu,tu),tp=eL.dot(th,tl),tm=eL.dot(tu,tl),tg=tc*tf-t_*t_,tv=tg,ty=tg;tg<ex?(tr=0,tv=1,ta=tm,ty=tf):(ta=tc*tm-t_*tp,(tr=t_*tm-tf*tp)<0?(tr=0,ta=tm,ty=tf):tr>tv&&(tr=tv,ta=tm+t_,ty=tf)),ta<0?(ta=0,-tp<0?tr=0:-tp>tc?tr=tv:(tr=-tp,tv=tc)):ta>ty&&(ta=ty,-tp+t_<0?tr=0:-tp+t_>tc?tr=tv:(tr=-tp+t_,tv=tc));var tS=Math.abs(tr)<ex?0:tr/tv,tA=Math.abs(ta)<ex?0:ta/ty,tT=O;tT.set(tl),tT.add(eL.multiplyScalar(X,th,tS)),tT.subtract(eL.multiplyScalar(Y,tu,tA));var tE=te.radius+ti.radius;return tT.lengthSqr()<tE*tE}}(),nF={raySphere:nr,rayAABB:ns,rayOBB:na,rayPlane:wr,rayTriangle:nn,rayCapsule:nh,raySubMesh:null,rayMesh:null,rayModel:null,lineSphere:kr,lineAABB:Nr,lineOBB:Gr,linePlane:nu,lineTriangle:nl,sphereWithSphere:cs,sphereAABB:nD,sphereOBB:nM,spherePlane:hs,sphereFrustum:us,sphereFrustumAccurate:nP,sphereCapsule:nO,aabbWithAABB:nm,aabbWithOBB:nC,aabbPlane:$r,aabbFrustum:ts,aabbFrustumAccurate:nx,obbWithOBB:nI,obbPlane:nR,obbFrustum:rs,obbFrustumAccurate:nw,obbPoint:nb,obbCapsule:nB,aabbFrustumCompletelyInside:function(g,v){for(var S=0;S<v.planes.length;S++)if(0!==$r(g,v.planes[S]))return 0;return 1},capsuleWithCapsule:nL,resolve:function(g,v,S){void 0===S&&(S=null);var O=g._type,X=v._type,Y=this[O|X];return O<X?Y(g,v,S):Y(v,g,S)}};nF[iw.SHAPE_RAY|iw.SHAPE_SPHERE]=nr,nF[iw.SHAPE_RAY|iw.SHAPE_AABB]=ns,nF[iw.SHAPE_RAY|iw.SHAPE_OBB]=na,nF[iw.SHAPE_RAY|iw.SHAPE_PLANE]=wr,nF[iw.SHAPE_RAY|iw.SHAPE_TRIANGLE]=nn,nF[iw.SHAPE_RAY|iw.SHAPE_CAPSULE]=nh,nF[iw.SHAPE_LINE|iw.SHAPE_SPHERE]=kr,nF[iw.SHAPE_LINE|iw.SHAPE_AABB]=Nr,nF[iw.SHAPE_LINE|iw.SHAPE_OBB]=Gr,nF[iw.SHAPE_LINE|iw.SHAPE_PLANE]=nu,nF[iw.SHAPE_LINE|iw.SHAPE_TRIANGLE]=nl,nF[iw.SHAPE_SPHERE]=cs,nF[iw.SHAPE_SPHERE|iw.SHAPE_AABB]=nD,nF[iw.SHAPE_SPHERE|iw.SHAPE_OBB]=nM,nF[iw.SHAPE_SPHERE|iw.SHAPE_PLANE]=hs,nF[iw.SHAPE_SPHERE|iw.SHAPE_FRUSTUM]=us,nF[iw.SHAPE_SPHERE|iw.SHAPE_FRUSTUM_ACCURATE]=nP,nF[iw.SHAPE_SPHERE|iw.SHAPE_CAPSULE]=nO,nF[iw.SHAPE_AABB]=nm,nF[iw.SHAPE_AABB|iw.SHAPE_OBB]=nC,nF[iw.SHAPE_AABB|iw.SHAPE_PLANE]=$r,nF[iw.SHAPE_AABB|iw.SHAPE_FRUSTUM]=ts,nF[iw.SHAPE_AABB|iw.SHAPE_FRUSTUM_ACCURATE]=nx,nF[iw.SHAPE_OBB]=nI,nF[iw.SHAPE_OBB|iw.SHAPE_PLANE]=nR,nF[iw.SHAPE_OBB|iw.SHAPE_FRUSTUM]=rs,nF[iw.SHAPE_OBB|iw.SHAPE_FRUSTUM_ACCURATE]=nw,nF[iw.SHAPE_OBB|iw.SHAPE_CAPSULE]=nB,nF[iw.SHAPE_CAPSULE]=nL;var nk,nG=new eL,nV=new eL,nU=new eV,nH=function(){function t1(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=1),void 0===X&&(X=1),void 0===Y&&(Y=1),void 0===te&&(te=1),void 0===ti&&(ti=0),void 0===tr&&(tr=0),void 0===ta&&(ta=0),void 0===th&&(th=1),void 0===tu&&(tu=0),void 0===tl&&(tl=0),void 0===tc&&(tc=0),void 0===t_&&(t_=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=iw.SHAPE_OBB,this.center=new eL(g,v,S),this.halfExtents=new eL(O,X,Y),this.orientation=new eV(te,ti,tr,ta,th,tu,tl,tc,t_)}t1.create=function(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_){return new t1(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_)},t1.clone=function(g){return new t1(g.center.x,g.center.y,g.center.z,g.halfExtents.x,g.halfExtents.y,g.halfExtents.z,g.orientation.m00,g.orientation.m01,g.orientation.m02,g.orientation.m03,g.orientation.m04,g.orientation.m05,g.orientation.m06,g.orientation.m07,g.orientation.m08)},t1.copy=function(g,v){return eL.copy(g.center,v.center),eL.copy(g.halfExtents,v.halfExtents),eV.copy(g.orientation,v.orientation),g},t1.fromPoints=function(g,v,S){return eL.multiplyScalar(g.center,eL.add(nG,v,S),.5),eL.multiplyScalar(g.halfExtents,eL.subtract(nV,S,v),.5),eV.identity(g.orientation),g},t1.set=function(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf){return eL.set(g.center,v,S,O),eL.set(g.halfExtents,X,Y,te),eV.set(g.orientation,ti,tr,ta,th,tu,tl,tc,t_,tf),g};var g=t1.prototype;return g.getBoundary=function(g,v){(function(g,v,S){nU.m00=Math.abs(S.m00),nU.m01=Math.abs(S.m01),nU.m02=Math.abs(S.m02),nU.m03=Math.abs(S.m03),nU.m04=Math.abs(S.m04),nU.m05=Math.abs(S.m05),nU.m06=Math.abs(S.m06),nU.m07=Math.abs(S.m07),nU.m08=Math.abs(S.m08),eL.transformMat3(g,v,nU)})(nG,this.halfExtents,this.orientation),eL.subtract(g,this.center,nG),eL.add(v,this.center,nG)},g.transform=function(g,v,S,O,X){eL.transformMat4(X.center,this.center,g),eV.fromQuat(X.orientation,S),eL.multiply(X.halfExtents,this.halfExtents,O)},g.translateAndRotate=function(g,v,S){eL.transformMat4(S.center,this.center,g),eV.fromQuat(S.orientation,v)},g.setScale=function(g,v){eL.multiply(v.halfExtents,this.halfExtents,g)},n(t1,[{key:"type",get:function(){return this._type}}]),t1}();function Ts(g,v,S){void 0===S&&(S=1e-6);for(var O=0,X=g.length-1,Y=X>>>1;O<=X;Y=O+X>>>1){var te=g[Y];if(te>v+S)X=Y-1;else{if(!(te<v-S))return Y;O=Y+1}}return~O}nk=Symbol.iterator;var nz,nW,nj,nq=function(){function t1(){this._times=[],this._values=[]}var g=t1.prototype;return g[nk]=function(){var g=this,v=0;return{next:function(){if(v>=g._times.length)return{done:!0,value:void 0};var S=[g._times[v],g._values[v]];return++v,{done:!1,value:S}}}},g.keyframes=function(){return this},g.times=function(){return this._times},g.values=function(){return this._values},g.getKeyframeTime=function(g){return this._times[g]},g.getKeyframeValue=function(g){return this._values[g]},g.addKeyFrame=function(g,v){return this._insertNewKeyframe(g,v)},g.removeKeyframe=function(g){this._times.splice(g,1),this._values.splice(g,1)},g.indexOfKeyframe=function(g){return Ts(this._times,g)},g.updateTime=function(g,v){var S=this._values[g];this.removeKeyframe(g),this._insertNewKeyframe(v,S)},g.assignSorted=function(g,v){if(void 0!==v)this.setKeyframes(g.slice(),v.slice());else{var S=Array.from(g);this.setKeyframes(S.map(function(g){return g[0]}),S.map(function(g){return g[1]}))}},g.clear=function(){this._times.length=0,this._values.length=0},g.searchKeyframe=function(g){return Ts(this._times,g)},g.setKeyframes=function(g,v){g.length,v.length,function(g){g.every(function(g,v,S){return 0===v||g>S[v-1]||pi(g,S[v-1],1e-6)})}(g),this._times=g,this._values=v},g._insertNewKeyframe=function(g,v){var S=this._times,O=this._values,X=S.length,Y=Ts(S,g);if(Y>=0)return Y;var te=~Y;return 0===te?(S.unshift(g),O.unshift(v)):te===X?(S.push(g),O.push(v)):(S.splice(te-1,0,g),O.splice(te-1,0,v)),te},n(t1,[{key:"keyFramesCount",get:function(){return this._times.length}},{key:"rangeMin",get:function(){return this._times[0]}},{key:"rangeMax",get:function(){return this._times[this._values.length-1]}}]),t1}();function Rs(g){return g>-1e-9&&g<1e-9}function ws(g,v,S,O){return S.slice().reverse().reduce(function(S,O){return O(g,v,S)||S},O)}ri.fastDefine("cc.KeyframeCurve",nq,{_times:[],_values:[]}),g("c1",nz),function(g){g[g.LINEAR=0]="LINEAR",g[g.CONSTANT=1]="CONSTANT",g[g.CUBIC=2]="CUBIC"}(nz||g("c1",nz={})),g("c2",nW),function(g){g[g.LINEAR=0]="LINEAR",g[g.CLAMP=1]="CLAMP",g[g.LOOP=2]="LOOP",g[g.PING_PONG=3]="PING_PONG"}(nW||g("c2",nW={})),g("c3",nj),function(g){g[g.NONE=0]="NONE",g[g.LEFT=1]="LEFT",g[g.RIGHT=2]="RIGHT",g[g.BOTH=3]="BOTH"}(nj||g("c3",nj={}));var Is=function(){},Bs=function(){return Is},nY=Ds(function(){});function Ds(g){return function(v){return"function"==typeof v?g(v):function(S){return g(S,v)}}}function Os(g){return function(v){return function(S){!function(g,v,S){var O=Ls(g);if(O){var X=Fs(O,"proto");Fs(X,"editor")[v]=S}}(S,g,v)}}}var nK="__ccclassCache__";function Ls(g){return Fs(g,nK)}function Fs(g,v){return g[v]||(g[v]={})}var nJ=Ds(function(g,v){var S=Bt(g);S===Object&&(S=null);var O={name:v,extends:S,ctor:g},X=g[nK];if(X){var Y=X.proto;Y&&wt(O,Y),g[nK]=void 0}return ri(O)}),nZ=Os("requireComponent"),nQ=Os("executionOrder"),n0=nY;function Us(g,v,S){var O=null;function r(g,v,S){!function(g,v,S,O,X,Y){var te,ti=Y&&"function"!=typeof Y&&(Y.get||Y.set);X&&(te=Xe(X,ti));var tr=wt(v,te||X||{});ti?(Y.get&&(tr.get=Y.get),Y.set&&(tr.set=Y.set)):Ws(g,tr,S,O,Y)}(function(g){return Ls(g.constructor)}(g),function(g,v){var S,O,X=Fs(Ls(g.constructor),"proto"),Y=Fs(X,"properties");return null!==(O=Y[S=v])&&void 0!==O?O:Y[S]={}}(g,v),g.constructor,v,O,S)}return void 0===g?Us({type:void 0}):void 0===v?(O=g,r):void r(g,v,S)}function Hs(g){var v;try{v=g()}catch(v){return g}return"object"!=(void 0===v?"undefined":_type_of(v))||null===v?v:g}function zs(g,v,S){var O,X,Y=Ls(g.constructor),te=Fs(Y,"proto"),ti=Fs(te,"properties"),tr=null!==(X=ti[O=v])&&void 0!==X?X:ti[O]={};return tr.__internalFlags|=eh.STANDALONE,S&&"function"!=typeof S&&(S.get||S.set)?(S.get&&(tr.get=S.get),S.set&&(tr.set=S.set)):Ws(Y,tr,g.constructor,v,S),tr}function Ws(g,v,S,O,X){if(void 0!==X)"function"==typeof X?v.default=Hs(X):null===X||X.initializer&&(v.default=Hs(X.initializer));else{var Y=g.default||(g.default=function(g){var v;try{v=new g}catch(g){return{}}return v}(S));Y.hasOwnProperty(O)&&(v.default=Y[O])}}var n1=Symbol("cc:SerializationMetadata"),n2=g("ct",function(g,v,S){Ks(zs(g,v,S))});function Ys(g){return function(v,S,O){var X=zs(v,S,O);X.formerlySerializedAs=g,Ks(X)}}var qs=function(g,v,S){var O=zs(g,v,S);O.editorOnly=!0,Ks(O)};function Ks(g){g.__internalFlags|=eh.IMPLICIT_SERIALIZABLE}var n3=Is,n4=nY,n8=Bs,n6=nY,n7=Bs,n9=Bs,rr=Bs,ra=g("ci",Is),ru=g("ck",Bs),rl=g("cl",Bs),rc=g("cj",Bs),r_=g("cn",Bs),rf=g("co",Bs),rd=g("cp",Is),rp=g("cm",Bs),rm=g("cq",Is),rg=ma(t9),rS=ma(ee),rA=ma(en),rT=ma(er);function ma(g){return Us({type:g})}var rE=g("cr",function(g,v,S){zs(g,v,S).override=!0}),rC=g("bC","__editorExtras__"),rx=g("bG",function(){}),rb=Object.freeze({__proto__:null,uniquelyReferenced:n3,ccclass:nJ,property:Us,requireComponent:nZ,executionOrder:nQ,disallowMultiple:n0,executeInEditMode:n4,menu:n8,playOnFocus:n6,inspector:n7,icon:n9,help:rr,type:ma,integer:rg,float:rS,boolean:rA,string:rT,editable:ra,tooltip:rc,visible:ru,displayName:rl,displayOrder:rp,range:r_,rangeStep:rf,slide:rd,disallowAnimation:rm,override:rE,formerlySerializedAs:Ys,serializable:n2});g("bt",rb);var rR,rw,rI,rB,rP,rD,rM,rO,rL,rF,rk=[],rG=g("bw",function(){function t1(g){void 0===g&&(g=""),this._objFlags=void 0,this._name=void 0,this._name=g,this._objFlags=0}t1._deferredDestroy=function(){for(var g=rk.length,v=0;v<g;++v){var S=rk[v];1&S._objFlags||S._destroyImmediate()}g===rk.length?rk.length=0:rk.splice(0,g)};var g=t1.prototype;return g.destroy=function(){return 1&this._objFlags?(q(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,rk.push(this),0))},g._destruct=function(){var g,v=this.constructor;Object.prototype.hasOwnProperty.call(v,"__destruct__")?g=v.__destruct__:(g=function(g,v){var S,O=_instanceof(g,X.Node)||_instanceof(g,X.Component),Y=O?"_id":null,te={};for(S in g)if(g.hasOwnProperty(S)){if(S===Y)continue;switch(_type_of(g[S])){case"string":te[S]="";break;case"object":case"function":te[S]=null}}if(ri._isCCClass(v))for(var ti=X.Class.Attr.getClassAttrs(v),tr=v.__props__,ta=0;ta<tr.length;ta++){var th=""+(S=tr[ta]);if(th in ti){if(O&&"_id"===S)continue;switch(_type_of(ti[th])){case"string":te[S]="";break;case"object":case"function":te[S]=null;break;case"undefined":te[S]=void 0}}}var tu="";for(S in te){var tl;tl=ri.IDENTIFIER_RE.test(S)?"o."+S+"=":"o["+ri.escapeForJS(S)+"]=";var tc=te[S];""===tc&&(tc='""'),tu+=tl+tc+";\n"}return Function("o",tu)}(this,v),tw(v,"__destruct__",g,!0)),g(this)},g._destroyImmediate=function(){var g;1&this._objFlags?J(5e3):(null===(g=this._onPreDestroy)||void 0===g||g.call(this),this._destruct(),this._objFlags|=1)},n(t1,[{key:"name",get:function(){return this._name},set:function(g){this._name=g}},{key:"hideFlags",get:function(){return this._objFlags&t1.Flags.AllHideMasks},set:function(g){var v=g&t1.Flags.AllHideMasks;this._objFlags=this._objFlags&~t1.Flags.AllHideMasks|v}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),t1}());function Oa(g){return _instanceof(g,rG)}function Ma(g,v){return"object"==(void 0===g?"undefined":_type_of(g))?!(!g||g._objFlags&(v?5:1)):void 0!==g}function La(g,v){return(v<<3)+g}function Fa(g){return rV[g]}function Na(g){switch(g){case rL.Uint8:return Uint8Array;case rL.Uint16:return Uint16Array;case rL.Uint32:return Uint32Array;case rL.Int8:return Int8Array;case rL.Int16:return Int16Array;case rL.Int32:return Int32Array;case rL.Float32:return Float32Array;case rL.Float64:return Float64Array}}rG.prototype._deserialize=null,ri.fastDefine("cc.Object",rG,{_name:"",_objFlags:0}),tw(rG,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,AllHideMasks:1560,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:2097152,IsRotationLocked:131072,IsScaleLocked:262144,IsAnchorLocked:524288,IsSizeLocked:1048576}),X.isValid=Ma,X.Object=rG,function(g){g[g.Uint8=0]="Uint8",g[g.Uint16=1]="Uint16",g[g.Uint32=2]="Uint32",g[g.Int8=3]="Int8",g[g.Int16=4]="Int16",g[g.Int32=5]="Int32",g[g.Float32=6]="Float32",g[g.Float64=7]="Float64"}(rL||(rL={})),function(g){g[g.Scalar=0]="Scalar",g[g.Vec2=1]="Vec2",g[g.Vec3=2]="Vec3",g[g.Vec4=3]="Vec4",g[g.Quat=4]="Quat",g[g.Mat4=5]="Mat4"}(rF||(rF={})),g("bB",nJ("cc.CompactValueTypeArray")(((rM=function(){function t1(){this._byteOffset=rI&&rI(),this._unitCount=rB&&rB(),this._unitElement=rP&&rP(),this._length=rD&&rD()}return t1.lengthFor=function(g,v,S){return Fa(v).requiredUnits*g.length*Na(S).BYTES_PER_ELEMENT},t1.compress=function(g,v,S,O,X,Y){for(var te=Fa(v),ti=Na(S),tr=te.requiredUnits*g.length,ta=new ti(O,X,tr),th=0;th<g.length;++th)te.compress(ta,th,g[th]);var tu=new t1;return tu._unitElement=La(S,v),tu._byteOffset=Y,tu._unitCount=tr,tu._length=g.length,tu},t1.prototype.decompress=function(g){for(var v,S={storageUnit:7&(v=this._unitElement),elementType:v>>3},O=S.storageUnit,X=Fa(S.elementType),Y=new(Na(O))(g,this._byteOffset,this._unitCount),te=new Array(this._length),ti=0;ti<this._length;++ti)te[ti]=X.decompress(Y,ti);return te},t1}()).StorageUnit=rL,rM.ElementType=rF,rI=ws((rw=rM).prototype,"_byteOffset",[n2],function(){return 0}),rB=ws(rw.prototype,"_unitCount",[n2],function(){return 0}),rP=ws(rw.prototype,"_unitElement",[n2],function(){return La(rL.Uint8,rF.Scalar)}),rD=ws(rw.prototype,"_length",[n2],function(){return 0}),rR=rw))||rR);var rV=((rO={})[rF.Scalar]={requiredUnits:1,compress:function(g,v,S){g[v]=S},decompress:function(g,v){return g[v]}},rO[rF.Vec2]={requiredUnits:2,compress:function(g,v,S){g[2*v]=S.x,g[2*v+1]=S.y},decompress:function(g,v){return new eL(g[2*v],g[2*v+1])}},rO[rF.Vec3]={requiredUnits:3,compress:function(g,v,S){g[3*v]=S.x,g[3*v+1]=S.y,g[3*v+2]=S.z},decompress:function(g,v){return new eL(g[3*v],g[3*v+1],g[3*v+2])}},rO[rF.Vec4]={requiredUnits:4,compress:function(g,v,S){g[4*v]=S.x,g[4*v+1]=S.y,g[4*v+2]=S.z,g[4*v+3]=S.w},decompress:function(g,v){return new e7(g[4*v],g[4*v+1],g[4*v+2],g[4*v+3])}},rO[rF.Quat]={requiredUnits:4,compress:function(g,v,S){g[4*v]=S.x,g[4*v+1]=S.y,g[4*v+2]=S.z,g[4*v+3]=S.w},decompress:function(g,v){return new eW(g[4*v],g[4*v+1],g[4*v+2],g[4*v+3])}},rO[rF.Mat4]={requiredUnits:16,compress:function(g,v,S){e$.toArray(g,S,16*v)},decompress:function(g,v){return e$.fromArray(new e$,g,16*v)}},rO),rU=g("bE",Symbol("[[Serialize]]")),rH=g("bD",Symbol("[[Deserialize]]"));function Ua(){return 0}function Ha(g){return g}function za(g){return g*g}function Wa(g){return g*(2-g)}function Xa(g){return(g*=2)<1?.5*g*g:-.5*(--g*(g-2)-1)}function ja(g){return g*g*g}function Ya(g){return--g*g*g+1}function qa(g){return(g*=2)<1?.5*g*g*g:.5*((g-=2)*g*g+2)}function Ka(g){return g*g*g*g}function Ja(g){return 1- --g*g*g*g}function Qa(g){return(g*=2)<1?.5*g*g*g*g:-.5*((g-=2)*g*g*g-2)}function Za(g){return g*g*g*g*g}function $a(g){return--g*g*g*g*g+1}function to(g){return(g*=2)<1?.5*g*g*g*g*g:.5*((g-=2)*g*g*g*g+2)}function eo(g){return 1===g?1:1-Math.cos(g*Math.PI/2)}function io(g){return Math.sin(g*Math.PI/2)}function no(g){return .5*(1-Math.cos(Math.PI*g))}function ro(g){return 0===g?0:Math.pow(1024,g-1)}function so(g){return 1===g?1:1-Math.pow(2,-10*g)}function ao(g){return 0===g?0:1===g?1:(g*=2)<1?.5*Math.pow(1024,g-1):.5*(2-Math.pow(2,-10*(g-1)))}function oo(g){return 1-Math.sqrt(1-g*g)}function ho(g){return Math.sqrt(1- --g*g)}function uo(g){return(g*=2)<1?-.5*(Math.sqrt(1-g*g)-1):.5*(Math.sqrt(1-(g-=2)*g)+1)}function lo(g){var v,S=.1;return 0===g?0:1===g?1:(!S||S<1?(S=1,v=.1):v=.4*Math.asin(1/S)/(2*Math.PI),-S*Math.pow(2,10*(g-=1))*Math.sin(2*(g-v)*Math.PI/.4))}function co(g){var v,S=.1;return 0===g?0:1===g?1:(!S||S<1?(S=1,v=.1):v=.4*Math.asin(1/S)/(2*Math.PI),S*Math.pow(2,-10*g)*Math.sin(2*(g-v)*Math.PI/.4)+1)}function _o(g){var v,S=.1;return 0===g?0:1===g?1:(!S||S<1?(S=1,v=.1):v=.4*Math.asin(1/S)/(2*Math.PI),(g*=2)<1?S*Math.pow(2,10*(g-=1))*Math.sin(2*(g-v)*Math.PI/.4)*-.5:S*Math.pow(2,-10*(g-=1))*Math.sin(2*(g-v)*Math.PI/.4)*.5+1)}function fo(g){if(1===g)return 1;var v=1.70158;return g*g*((v+1)*g-v)}function po(g){if(0===g)return 0;var v=1.70158;return--g*g*((v+1)*g+v)+1}function mo(g){var v=2.5949095;return(g*=2)<1?g*g*((v+1)*g-v)*.5:.5*((g-=2)*g*((v+1)*g+v)+2)}function go(g){return 1-vo(1-g)}function vo(g){return g<1/2.75?7.5625*g*g:g<2/2.75?7.5625*(g-=1.5/2.75)*g+.75:g<2.5/2.75?7.5625*(g-=2.25/2.75)*g+.9375:7.5625*(g-=2.625/2.75)*g+.984375}function yo(g){return g<.5?.5*go(2*g):.5*vo(2*g-1)+.5}function So(g){return g<=0?0:g>=1?1:g*g*(3-2*g)}function Ao(g){return g<=0?0:g>=1?1:g*g*g*(g*(6*g-15)+10)}X._decorator=rb;var rz=Do(za,Wa),rW=Do(ja,Ya),rX=Do(Ka,Ja),rj=Do(Za,$a),rq=Do(eo,io),rY=Do(ro,so),rK=Do(oo,ho),rJ=Do(lo,co),rZ=Do(fo,po),rQ=Do(go,vo);function Do(g,v){return function(S){return S<.5?v(2*S)/2:g(2*S-1)/2+.5}}var r0,r1,r2=Object.freeze({__proto__:null,constant:Ua,linear:Ha,quadIn:za,quadOut:Wa,quadInOut:Xa,cubicIn:ja,cubicOut:Ya,cubicInOut:qa,quartIn:Ka,quartOut:Ja,quartInOut:Qa,quintIn:Za,quintOut:$a,quintInOut:to,sineIn:eo,sineOut:io,sineInOut:no,expoIn:ro,expoOut:so,expoInOut:ao,circIn:oo,circOut:ho,circInOut:uo,elasticIn:lo,elasticOut:co,elasticInOut:_o,backIn:fo,backOut:po,backInOut:mo,bounceIn:go,bounceOut:vo,bounceInOut:yo,smooth:So,fade:Ao,quadOutIn:rz,cubicOutIn:rW,quartOutIn:rX,quintOutIn:rj,sineOutIn:rq,expoOutIn:rY,circOutIn:rK,elasticOutIn:rJ,backOutIn:rZ,bounceOutIn:rQ});g("cd",r2),g("cD",r1),function(g){g[g.LINEAR=0]="LINEAR",g[g.CONSTANT=1]="CONSTANT",g[g.QUAD_IN=2]="QUAD_IN",g[g.QUAD_OUT=3]="QUAD_OUT",g[g.QUAD_IN_OUT=4]="QUAD_IN_OUT",g[g.QUAD_OUT_IN=5]="QUAD_OUT_IN",g[g.CUBIC_IN=6]="CUBIC_IN",g[g.CUBIC_OUT=7]="CUBIC_OUT",g[g.CUBIC_IN_OUT=8]="CUBIC_IN_OUT",g[g.CUBIC_OUT_IN=9]="CUBIC_OUT_IN",g[g.QUART_IN=10]="QUART_IN",g[g.QUART_OUT=11]="QUART_OUT",g[g.QUART_IN_OUT=12]="QUART_IN_OUT",g[g.QUART_OUT_IN=13]="QUART_OUT_IN",g[g.QUINT_IN=14]="QUINT_IN",g[g.QUINT_OUT=15]="QUINT_OUT",g[g.QUINT_IN_OUT=16]="QUINT_IN_OUT",g[g.QUINT_OUT_IN=17]="QUINT_OUT_IN",g[g.SINE_IN=18]="SINE_IN",g[g.SINE_OUT=19]="SINE_OUT",g[g.SINE_IN_OUT=20]="SINE_IN_OUT",g[g.SINE_OUT_IN=21]="SINE_OUT_IN",g[g.EXPO_IN=22]="EXPO_IN",g[g.EXPO_OUT=23]="EXPO_OUT",g[g.EXPO_IN_OUT=24]="EXPO_IN_OUT",g[g.EXPO_OUT_IN=25]="EXPO_OUT_IN",g[g.CIRC_IN=26]="CIRC_IN",g[g.CIRC_OUT=27]="CIRC_OUT",g[g.CIRC_IN_OUT=28]="CIRC_IN_OUT",g[g.CIRC_OUT_IN=29]="CIRC_OUT_IN",g[g.ELASTIC_IN=30]="ELASTIC_IN",g[g.ELASTIC_OUT=31]="ELASTIC_OUT",g[g.ELASTIC_IN_OUT=32]="ELASTIC_IN_OUT",g[g.ELASTIC_OUT_IN=33]="ELASTIC_OUT_IN",g[g.BACK_IN=34]="BACK_IN",g[g.BACK_OUT=35]="BACK_OUT",g[g.BACK_IN_OUT=36]="BACK_IN_OUT",g[g.BACK_OUT_IN=37]="BACK_OUT_IN",g[g.BOUNCE_IN=38]="BOUNCE_IN",g[g.BOUNCE_OUT=39]="BOUNCE_OUT",g[g.BOUNCE_IN_OUT=40]="BOUNCE_IN_OUT",g[g.BOUNCE_OUT_IN=41]="BOUNCE_OUT_IN",g[g.SMOOTH=42]="SMOOTH",g[g.FADE=43]="FADE"}(r1||g("cD",r1={}));var r3,r4=((r0={})[r1.CONSTANT]=Ua,r0[r1.LINEAR]=Ha,r0[r1.QUAD_IN]=za,r0[r1.QUAD_OUT]=Wa,r0[r1.QUAD_IN_OUT]=Xa,r0[r1.QUAD_OUT_IN]=rz,r0[r1.CUBIC_IN]=ja,r0[r1.CUBIC_OUT]=Ya,r0[r1.CUBIC_IN_OUT]=qa,r0[r1.CUBIC_OUT_IN]=rW,r0[r1.QUART_IN]=Ka,r0[r1.QUART_OUT]=Ja,r0[r1.QUART_IN_OUT]=Qa,r0[r1.QUART_OUT_IN]=rX,r0[r1.QUINT_IN]=Za,r0[r1.QUINT_OUT]=$a,r0[r1.QUINT_IN_OUT]=to,r0[r1.QUINT_OUT_IN]=rj,r0[r1.SINE_IN]=eo,r0[r1.SINE_OUT]=io,r0[r1.SINE_IN_OUT]=no,r0[r1.SINE_OUT_IN]=rq,r0[r1.EXPO_IN]=ro,r0[r1.EXPO_OUT]=so,r0[r1.EXPO_IN_OUT]=ao,r0[r1.EXPO_OUT_IN]=rY,r0[r1.CIRC_IN]=oo,r0[r1.CIRC_OUT]=ho,r0[r1.CIRC_IN_OUT]=uo,r0[r1.CIRC_OUT_IN]=rK,r0[r1.ELASTIC_IN]=lo,r0[r1.ELASTIC_OUT]=co,r0[r1.ELASTIC_IN_OUT]=_o,r0[r1.ELASTIC_OUT_IN]=rJ,r0[r1.BACK_IN]=fo,r0[r1.BACK_OUT]=po,r0[r1.BACK_IN_OUT]=mo,r0[r1.BACK_OUT_IN]=rZ,r0[r1.BOUNCE_IN]=go,r0[r1.BOUNCE_OUT]=vo,r0[r1.BOUNCE_IN_OUT]=yo,r0[r1.BOUNCE_OUT_IN]=rQ,r0[r1.SMOOTH]=So,r0[r1.FADE]=Ao,r0);function Go(g){return r4[g]}E(255),E(65280);var r8,r6,r7,r9=nz.LINEAR<<0|nj.NONE<<8|r1.LINEAR<<16,sn=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).value=0,v.rightTangent=0,v.rightTangentWeight=0,v.leftTangent=0,v.leftTangentWeight=0,v._flags=r9,v}return s(e,g),n(e,[{key:"interpolationMode",get:function(){return(255&this._flags)>>0},set:function(g){this._flags&=-256,this._flags|=g<<0}},{key:"tangentWeightMode",get:function(){return(65280&this._flags)>>8},set:function(g){this._flags&=-65281,this._flags|=g<<8}},{key:"easingMethod",get:function(){return(0xff0000&this._flags)>>16},set:function(g){this._flags&=-0xff0001,this._flags|=g<<16}}]),e}(rx);function Wo(g){var v=new sn;if("number"==typeof g)v.value=g;else{var S=g.interpolationMode,O=g.tangentWeightMode,X=g.value,Y=g.rightTangent,te=g.rightTangentWeight,ti=g.leftTangent,tr=g.leftTangentWeight,ta=g.easingMethod,th=g[rC];v.value=null!=X?X:v.value,v.rightTangent=null!=Y?Y:v.rightTangent,v.rightTangentWeight=null!=te?te:v.rightTangentWeight,v.leftTangent=null!=ti?ti:v.leftTangent,v.leftTangentWeight=null!=tr?tr:v.leftTangentWeight,v.interpolationMode=null!=S?S:v.interpolationMode,v.tangentWeightMode=null!=O?O:v.tangentWeightMode,v.easingMethod=null!=ta?ta:v.easingMethod,th&&(v[rC]=th)}return v}ri.fastDefine("cc.RealKeyframeValue",sn,((r3={interpolationMode:nz.LINEAR,tangentWeightMode:nj.NONE,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:r1.LINEAR})[rC]=void 0,r3)),ri.Attr.setClassAttr(sn,rC,"editorOnly",!0),(r8=sn,null!==(r7=(r6=r8)[n1])&&void 0!==r7?r7:r6[n1]={}).uniquelyReferenced=!0;var sr,ss=g("c0",function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).preExtrapolation=nW.CLAMP,v.postExtrapolation=nW.CLAMP,v}s(e,g);var v=e.prototype;return v.evaluate=function(g){var v=this._times,S=this._values,O=v.length;if(0===O)return 0;var X=v[0],Y=v[O-1];if(g<X){var te=this.preExtrapolation,ti=S[0];if(te===nW.CLAMP||O<2)return ti.value;switch(te){case nW.LINEAR:return hh(X,S[0].value,v[1],S[1].value,g);case nW.LOOP:g=ah(g,X,Y);break;case nW.PING_PONG:g=oh(g,X,Y);break;default:return ti.value}}else if(g>Y){var tr=this.postExtrapolation,ta=S[O-1];if(tr===nW.CLAMP||O<2)return ta.value;switch(tr){case nW.LINEAR:return hh(Y,ta.value,v[O-2],S[O-2].value,g);case nW.LOOP:g=ah(g,X,Y);break;case nW.PING_PONG:g=oh(g,X,Y);break;default:return ta.value}}var th=Ts(v,g);if(th>=0)return S[th].value;var tu=~th,tl=tu-1,tc=v[tl],t_=S[tl],tf=v[tu];return function(g,v,S,O,X){var Y=S-g;switch(v.interpolationMode){default:case nz.CONSTANT:return v.value;case nz.LINEAR:var te=v.easingMethod===r1.LINEAR?X:Go(v.easingMethod)(X);return vi(v.value,O.value,te);case nz.CUBIC:var ti=1/3,tr=v.rightTangent,ta=v.rightTangentWeight,th=0!=(v.tangentWeightMode&nj.RIGHT),tu=O.leftTangent,tl=O.leftTangentWeight,tc=0!=(O.tangentWeightMode&nj.LEFT);if(th||tc){var t_=0;if(th)t_=ta;else{var tf=Y,tp=Y*tr;t_=Math.sqrt(tf*tf+tp*tp)*ti}var tm=Math.atan(tr),tg=Math.cos(tm)*t_+g,tv=Math.sin(tm)*t_+v.value,ty=0;if(tc)ty=tl;else{var tS=Y,tA=Y*tu;ty=Math.sqrt(tS*tS+tA*tA)*ti}var tT=Math.atan(tu),tE=(tg-g)/Y,tC=(-Math.cos(tT)*ty+S-g)/Y,tx=tv,tb=-Math.sin(tT)*ty+O.value,tw=[0,0,0],tI=function(g,v,S,O,X){var Y=S/O,te=v/O,ti=Y*Y,tr=1/3*(-1/3*ti+te),ta=.5*(2/27*Y*ti-1/3*Y*te+g/O),th=tr*tr*tr,tu=ta*ta+th,tl=0;if(Rs(tu)){if(Rs(ta))return X[0]=0,1;var tc=Math.cbrt(-ta);return X[0]=2*tc,X[1]=-tc,2}if(tu<0){var t_=1/3*Math.acos(-ta/Math.sqrt(-th)),tf=2*Math.sqrt(-tr);X[0]=tf*Math.cos(t_),X[1]=-tf*Math.cos(t_+Math.PI/3),X[2]=-tf*Math.cos(t_-Math.PI/3),tl=3}else{var tp=Math.sqrt(tu),tm=Math.cbrt(tp-ta),tg=-Math.cbrt(tp+ta);X[0]=tm+tg,tl=1}for(var tv=1/3*Y,ty=0;ty<tl;++ty)X[ty]-=tv;return tl}(0-X,3*tE,3*tC-6*tE,3*(tE-tC)+1,tw),tB=function(g,v,S){var O=S;if(1===v)O=g[0];else{O=-1/0;for(var X=0;X<v;++X){var Y=g[X];Y>=0&&Y<=1&&Y>O&&(O=Y)}O===-1/0&&(O=0)}return O}(tw,tI,X);return uh(v.value,tx,tb,O.value,tB)}var tP=v.value+ti*tr*Y,tD=O.value-ti*tu*Y;return uh(v.value,tP,tD,O.value,X)}}(tc,t_,tf,S[tu],(g-tc)/(tf-tc))},v.addKeyFrame=function(v,S){return g.prototype.addKeyFrame.call(this,v,Wo(S))},v.assignSorted=function(g,v){if(void 0!==v)this.setKeyframes(g.slice(),v.map(function(g){return Wo(g)}));else{var S=Array.from(g);this.setKeyframes(S.map(function(g){return g[0]}),S.map(function(g){return Wo(g[1])}))}},v.isConstant=function(g){if(this._values.length<=1)return!0;var v=this._values[0].value;return this._values.every(function(S){return pi(S.value,v,g)})},v[rU]=function(g,v){if(v.toCCON){var S=this._times,O=this._values,X=S.length,Y=new DataView(new ArrayBuffer(0+sa+sa+su+sl*X+sA*X)),te=0;Y.setUint8(te,this.preExtrapolation),te+=sa,Y.setUint8(te,this.postExtrapolation),te+=sa,Y.setUint32(te,X,!0),te+=su,S.forEach(function(g,v){return Y.setFloat32(te+sl*v,g,!0)}),te+=sl*X;for(var ti,tr=f(O);!(ti=tr()).done;){var ta=ti.value;te=rh(Y,ta,te)}var th=new Uint8Array(Y.buffer,0,te);g.writeProperty("bytes",th);var tu=O.map(function(g){return g[rC]});tu.some(function(g){return void 0!==g})&&g.writeProperty("keyframeValueEditorExtras",tu)}else g.writeThis()},v[rH]=function(g,v){if(v.fromCCON){var S=g.readProperty("bytes"),O=new DataView(S.buffer,S.byteOffset,S.byteLength),X=0;this.preExtrapolation=O.getUint8(X),X+=sa,this.postExtrapolation=O.getUint8(X),X+=sa;var Y=O.getUint32(X,!0);X+=su;var te=Array.from({length:Y},function(g,v){return O.getFloat32(X+sl*v,!0)});X+=sl*Y;for(var ti=new Array(Y),tr=0;tr<Y;++tr){var ta=Wo({});X=sh(O,ta,X),ti[tr]=ta}S.byteLength;var th=g.readProperty("keyframeValueEditorExtras");th&&(th.length,th.forEach(function(g,v){return ti[v][rC]=g})),this._times=te,this._values=ti}else g.readThis()},e}(nq));ri.fastDefine("cc.RealCurve",ss,{_times:[],_values:[],preExtrapolation:nW.CLAMP,postExtrapolation:nW.CLAMP}),function(g){g[g.VALUE=1]="VALUE",g[g.INTERPOLATION_MODE=2]="INTERPOLATION_MODE",g[g.TANGENT_WEIGHT_MODE=4]="TANGENT_WEIGHT_MODE",g[g.LEFT_TANGENT=8]="LEFT_TANGENT",g[g.LEFT_TANGENT_WEIGHT=16]="LEFT_TANGENT_WEIGHT",g[g.RIGHT_TANGENT=32]="RIGHT_TANGENT",g[g.RIGHT_TANGENT_WEIGHT=64]="RIGHT_TANGENT_WEIGHT"}(sr||(sr={}));var sa=1,su=4,sl=4,sc=Wo({}),s_=sc.interpolationMode,sf=sc.tangentWeightMode,sd=sc.leftTangent,sm=sc.leftTangentWeight,sg=sc.rightTangent,sS=sc.rightTangentWeight,sA=26;function rh(g,v,S){var O=0,X=S,Y=X;X+=4;var te=v.value,ti=v.interpolationMode,tr=v.tangentWeightMode,ta=v.rightTangent,th=v.rightTangentWeight,tu=v.leftTangent,tl=v.leftTangentWeight,tc=v.easingMethod;return g.setFloat32(X,te,!0),X+=4,ti!==s_&&(O|=sr.INTERPOLATION_MODE,g.setUint8(X,ti),X+=1),tr!==sf&&(O|=sr.TANGENT_WEIGHT_MODE,g.setUint8(X,tr),X+=1),tu!==sd&&(O|=sr.LEFT_TANGENT,g.setFloat32(X,tu,!0),X+=4),tl!==sm&&(O|=sr.LEFT_TANGENT_WEIGHT,g.setFloat32(X,tl,!0),X+=4),ta!==sg&&(O|=sr.RIGHT_TANGENT,g.setFloat32(X,ta,!0),X+=4),th!==sS&&(O|=sr.RIGHT_TANGENT_WEIGHT,g.setFloat32(X,th,!0),X+=4),O|=tc<<8,g.setUint32(Y,O,!0),X}function sh(g,v,S){var O=S,X=g.getUint32(O,!0);O+=4,v.value=g.getFloat32(O,!0),O+=4,X&sr.INTERPOLATION_MODE&&(v.interpolationMode=g.getUint8(O),O+=1),X&sr.TANGENT_WEIGHT_MODE&&(v.tangentWeightMode=g.getUint8(O),O+=1),X&sr.LEFT_TANGENT&&(v.leftTangent=g.getFloat32(O,!0),O+=4),X&sr.LEFT_TANGENT_WEIGHT&&(v.leftTangentWeight=g.getFloat32(O,!0),O+=4),X&sr.RIGHT_TANGENT&&(v.rightTangent=g.getFloat32(O,!0),O+=4),X&sr.RIGHT_TANGENT_WEIGHT&&(v.rightTangentWeight=g.getFloat32(O,!0),O+=4);var Y=(65280&X)>>8;return v.easingMethod=Y,O}function ah(g,v,S){return v+Ii(g-v,S-v)}function oh(g,v,S){return v+Bi(g-v,S-v)}function hh(g,v,S,O,X){return v+(O-v)/(S-g)*(X-g)}function uh(g,v,S,O,X){var Y=1-X;return Y*Y*Y*g+3*Y*Y*X*v+3*Y*X*X*S+X*X*X*O}function lh(g,v,S,O,X){var Y=1-X;return Y*(Y*(g+(3*v-g)*X)+3*S*X*X)+O*X*X*X}X.bezier=lh;var sT,sE,sC,sx,sb,sR,sw,sI,sB,sP,sD=Math.cos,sM=Math.acos,sO=Math.max,sL=2*Math.PI,sF=Math.sqrt;function xh(g){return g<0?-Math.pow(-g,1/3):Math.pow(g,1/3)}function Rh(g,v){var S=function(g,v){var S,O,X,Y,te=v-0,ti=v-g[0],tr=3*te,ta=3*ti,th=3*(v-g[2]),tu=1/(-te+ta-th+(v-1)),tl=1/3,tc=(tr-6*ti+th)*tu,t_=tc*tl,tf=(-tr+ta)*tu,tp=(3*tf-tc*tc)*tl,tm=tp*tl,tg=(2*tc*tc*tc-9*tc*tf+te*tu*27)/27,tv=tg/2,ty=tv*tv+tm*tm*tm;if(ty<0){var tS=-tp*tl,tA=sF(tS*tS*tS),tT=-tg/(2*tA),tE=sM(tT<-1?-1:tT>1?1:tT),tC=2*xh(tA);return O=tC*sD(tE*tl)-t_,X=tC*sD((tE+sL)*tl)-t_,Y=tC*sD((tE+2*sL)*tl)-t_,O>=0&&O<=1?X>=0&&X<=1?Y>=0&&Y<=1?sO(O,X,Y):sO(O,X):Y>=0&&Y<=1?sO(O,Y):O:X>=0&&X<=1?Y>=0&&Y<=1?sO(X,Y):X:Y}if(0===ty)return X=-(S=tv<0?xh(-tv):-xh(tv))-t_,(O=2*S-t_)>=0&&O<=1?X>=0&&X<=1?sO(O,X):O:X;var tx=sF(ty);return(S=xh(-tv+tx))-xh(tv+tx)-t_}(g,v),O=g[1];return((1-S)*(O+(g[3]-O)*S)*3+S*S)*S}X.bezierByTime=Rh,g("c5",sP),function(g){g[g.SLERP=0]="SLERP",g[g.CONSTANT=1]="CONSTANT"}(sP||g("c5",sP={}));var sN=nJ("cc.QuatKeyframeValue")(sT=n3((sE=function(g){var v=void 0===g?{}:g,S=v.value,O=v.interpolationMode,X=v.easingMethod;this.interpolationMode=sC&&sC(),this.value=sx&&sx(),this.easingMethod=sb&&sb(),this.value=S?eW.clone(S):this.value,this.interpolationMode=null!=O?O:this.interpolationMode,this.easingMethod=null!=X?X:this.easingMethod},sC=ws(sE.prototype,"interpolationMode",[n2],function(){return sP.SLERP}),sx=ws(sE.prototype,"value",[n2],function(){return eW.clone(eW.IDENTITY)}),sb=ws(sE.prototype,"easingMethod",[n2],function(){return r1.LINEAR}),sT=sE))||sT)||sT;function Ih(g){return new sN(g)}var sk,sG=g("c4",nJ("cc.QuatCurve")((sw=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).preExtrapolation=sI&&sI(),v.postExtrapolation=sB&&sB(),v}s(e,g);var v=e.prototype;return v.evaluate=function(g,v){var S;null!==(S=v)&&void 0!==S||(v=new eW);var O=this._times,X=this._values,Y=this.postExtrapolation,te=this.preExtrapolation,ti=O.length;if(0===ti)return v;var tr=O[0],ta=O[ti-1];if(g<tr){var th=X[0];switch(te){case nW.LOOP:g=tr+Ii(g-tr,ta-tr);break;case nW.PING_PONG:g=tr+Bi(g-tr,ta-tr);break;case nW.CLAMP:default:return eW.copy(v,th.value)}}else if(g>ta){var tu=X[ti-1];switch(Y){case nW.LOOP:g=tr+Ii(g-tr,ta-tr);break;case nW.PING_PONG:g=tr+Bi(g-tr,ta-tr);break;case nW.CLAMP:default:return eW.copy(v,tu.value)}}var tl=Ts(O,g);if(tl>=0)return eW.copy(v,X[tl].value);var tc=~tl,t_=tc-1,tf=O[t_],tp=X[t_],tm=O[tc],tg=X[tc],tv=(g-tf)/(tm-tf);switch(tp.interpolationMode){default:case sP.CONSTANT:return eW.copy(v,tp.value);case sP.SLERP:var ty=tp.easingMethod,tS=ty===r1.LINEAR?tv:Array.isArray(ty)?Rh(ty,tv):Go(ty)(tv);return eW.slerp(v,tp.value,tg.value,tS)}},v.addKeyFrame=function(v,S){var O=new sN(S);return g.prototype.addKeyFrame.call(this,v,O)},v.assignSorted=function(g,v){if(void 0!==v)this.setKeyframes(g.slice(),v.map(function(g){return Ih(g)}));else{var S=Array.from(g);this.setKeyframes(S.map(function(g){return g[0]}),S.map(function(g){return Ih(g[1])}))}},v[rU]=function(g,v){if(v.toCCON){var S=this._times,O=this._values,X=!0;O.forEach(function(g,v,S){var O=S[0];X&&g.interpolationMode!==O.interpolationMode&&(X=!1)});var Y=S.length,te=sX*(X?1:Y),ti=O.reduce(function(g,v){var S=v.easingMethod;return g+(Array.isArray(S)?sj+4*sY:sj)},0),tr=0,ta=new DataView(new ArrayBuffer(tr+=sU+sH+sz*Y+4*sW*Y+ti+te+0)),th=0,tu=0;X&&(tu|=sk.INTERPOLATION_MODE),ta.setUint32(th,tu,!0),th+=sU,ta.setUint32(th,Y,!0),th+=sH,S.forEach(function(g,v){return ta.setFloat32(th+sz*v,g,!0)}),th+=sz*Y,O.forEach(function(g,v){var S=g.value,O=S.x,X=S.y,Y=S.z,te=S.w,ti=th+4*sW*v;ta.setFloat32(ti+0*sW,O,!0),ta.setFloat32(ti+1*sW,X,!0),ta.setFloat32(ti+2*sW,Y,!0),ta.setFloat32(ti+3*sW,te,!0)}),th+=4*sW*Y,O.forEach(function(g){var v=g.easingMethod;Array.isArray(v)?(ta.setUint8(th,sq),++th,ta.setFloat32(th+0*sY,v[0],!0),ta.setFloat32(th+1*sY,v[1],!0),ta.setFloat32(th+2*sY,v[2],!0),ta.setFloat32(th+3*sY,v[3],!0),th+=4*sY):(ta.setUint8(th,v),++th)});var tl=th;th+=te;var tc=tl;O.forEach(function(g){var v=g.interpolationMode;ta.setUint8(tc,v),X||(tc+=sX)});var t_=new Uint8Array(ta.buffer);g.writeProperty("bytes",t_)}else g.writeThis()},v[rH]=function(g,v){if(v.fromCCON){var S=g.readProperty("bytes"),O=new DataView(S.buffer,S.byteOffset,S.byteLength),X=0,Y=O.getUint32(X,!0);X+=sU;var te=Y&sk.INTERPOLATION_MODE,ti=O.getUint32(X,!0);X+=sH;var tr=Array.from({length:ti},function(g,v){return O.getFloat32(X+sz*v,!0)}),ta=X+=sz*ti;X+=4*sW*ti;var th=Array.from({length:ti},function(g,v){var S=ta+4*sW*v,Y=O.getFloat32(S+0*sW,!0),te=O.getFloat32(S+1*sW,!0),ti=O.getFloat32(S+2*sW,!0),tr=O.getFloat32(S+3*sW,!0),th=O.getUint8(X);++X;var tu=Ih({value:{x:Y,y:te,z:ti,w:tr}});return th!==sq?tu.easingMethod=th:(tu.easingMethod=[O.getFloat32(X+0*sY,!0),O.getFloat32(X+1*sY,!0),O.getFloat32(X+2*sY,!0),O.getFloat32(X+3*sY,!0)],X+=4*sY),tu});if(te){var tu=O.getUint8(X);++X;for(var tl=0;tl<ti;++tl)th[tl].interpolationMode=tu}else{for(var tc=0;tc<ti;++tc){var t_=O.getUint8(X+tc);th[tc].interpolationMode=t_}X+=ti}this._times=tr,this._values=th}else g.readThis()},e}(nq),sI=ws(sw.prototype,"preExtrapolation",[n2],function(){return nW.CLAMP}),sB=ws(sw.prototype,"postExtrapolation",[n2],function(){return nW.CLAMP}),sR=sw))||sR);!function(g){g[g.INTERPOLATION_MODE=1]="INTERPOLATION_MODE"}(sk||(sk={}));var sV,sU=1,sH=4,sz=4,sW=4,sX=1,sj=1,sq=255,sY=4,sZ=g("c6",nJ("cc.ObjectCurve")(sV=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.evaluate=function(g){var v=this.searchKeyframe(g);if(v>=0)return this._values[v];var S=mi(~v-1,0,this._values.length-1);return this._values[S]},e}(nq))||sV),sQ=re({Blend:0,Fixed:1}),s0=g("c7",function(){this.color=is.WHITE.clone(),this.time=0});ri.fastDefine("cc.ColorKey",s0,{color:is.WHITE.clone(),time:0}),ri.Attr.setClassAttr(s0,"color","visible",!0),ri.Attr.setClassAttr(s0,"time","visible",!0);var s1=g("c8",function(){this.alpha=1,this.time=0});ri.fastDefine("cc.AlphaKey",s1,{alpha:1,time:0}),ri.Attr.setClassAttr(s1,"alpha","visible",!0),ri.Attr.setClassAttr(s1,"time","visible",!0);var s2=g("c9",function(){function t1(){this.colorKeys=[],this.alphaKeys=[],this.mode=sQ.Blend}var g=t1.prototype;return g.setKeys=function(g,v){this.colorKeys=g,this.alphaKeys=v},g.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort(function(g,v){return g.time-v.time}),this.alphaKeys.length>1&&this.alphaKeys.sort(function(g,v){return g.time-v.time})},g.evaluate=function(g){return this.evaluateFast(new is,g)},g.evaluateFast=function(g,v){return this.getRGB(g,v),g._set_a_unsafe(this.getAlpha(v)),g},g.randomColor=function(){return this.getRandomColor(new is)},g.getRandomColor=function(g){var v=this.colorKeys[Math.trunc(Ai()*this.colorKeys.length)],S=this.alphaKeys[Math.trunc(Ai()*this.alphaKeys.length)];return g.set(v.color),g._set_a_unsafe(S.alpha),g},g.getRGB=function(g,v){var S=this.colorKeys,O=S.length;if(O>1){v=Ii(v,1+ex);for(var X=1;X<O;++X){var Y=S[X-1].time,te=S[X].time;if(v>=Y&&v<te){if(this.mode===sQ.Fixed)return is.copy(g,S[X].color),g;var ti=(v-Y)/(te-Y);return is.lerp(g,S[X-1].color,S[X].color,ti),g}}var tr=O-1;pi(v,S[tr].time,ex)?is.copy(g,S[tr].color):v<S[0].time?is.lerp(g,is.BLACK,S[0].color,v/S[0].time):v>S[tr].time&&is.lerp(g,S[tr].color,is.BLACK,(v-S[tr].time)/(1-S[tr].time))}else 1===O?is.copy(g,S[0].color):is.copy(g,is.WHITE);return g},g.getAlpha=function(g){var v=this.alphaKeys,S=v.length;if(S>1){g=Ii(g,1+ex);for(var O=1;O<S;++O){var X=v[O-1].time,Y=v[O].time;if(g>=X&&g<Y){if(this.mode===sQ.Fixed)return v[O].alpha;var te=(g-X)/(Y-X);return vi(v[O-1].alpha,v[O].alpha,te)}}var ti=S-1;return pi(g,v[ti].time,ex)?v[ti].alpha:g<v[0].time?vi(0,v[0].alpha,g/v[0].time):g>v[ti].time?vi(v[ti].alpha,0,(g-v[ti].time)/(1-v[ti].time)):255}return 1===S?v[0].alpha:255},t1}());s2.Mode=sQ,ri.fastDefine("cc.Gradient",s2,{colorKeys:[],alphaKeys:[],mode:sQ.Blend}),ri.Attr.setClassAttr(s2,"colorKeys","visible",!0),ri.Attr.setClassAttr(s2,"alphaKeys","visible",!0),ri.Attr.setClassAttr(s2,"mode","visible",!0);var jh=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};ri.fastDefine("cc.Keyframe",jh,{time:0,value:0,inTangent:0,outTangent:0});var s3=function(){function t1(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t1.prototype.evaluate=function(g){return qh(g-this.time,this.coefficient)},t1}();function qh(g,v){return g*(g*(g*v[0]+v[1])+v[2])+v[3]}var s4,s8,s6=function(){function t1(g){if(void 0===g&&(g=null),this._curve=void 0,this.cachedKey=void 0,_instanceof(g,ss))this._curve=g;else{var v=new ss;this._curve=v,v.preExtrapolation=nW.LOOP,v.postExtrapolation=nW.CLAMP,g?v.assignSorted(g.map(function(g){return[g.time,{interpolationMode:nz.CUBIC,value:g.value,leftTangent:g.inTangent,rightTangent:g.outTangent}]})):v.assignSorted([[0,{interpolationMode:nz.CUBIC,value:1}],[1,{interpolationMode:nz.CUBIC,value:1}]])}this.cachedKey=new s3}var g=t1.prototype;return g.addKey=function(g){g?this._curve.addKeyFrame(g.time,{interpolationMode:nz.CUBIC,value:g.value,leftTangent:g.inTangent,rightTangent:g.outTangent}):this._curve.clear()},g.evaluate_slow=function(g){return this._curve.evaluate(g)},g.evaluate=function(g){var v=this.cachedKey,S=this._curve,O=S.keyFramesCount-1,X=g,Y=g<0?S.preExtrapolation:S.postExtrapolation,te=S.getKeyframeTime(0),ti=S.getKeyframeTime(O);switch(Y){case nW.LOOP:X=Ii(g-te,ti-te)+te;break;case nW.PING_PONG:X=Bi(g-te,ti-te)+te;break;case nW.CLAMP:default:X=mi(g,te,ti)}if(X>=v.time&&X<v.endTime)return v.evaluate(X);var tr=this.findIndex(v,X),ta=Math.min(tr+1,O);return this.calcOptimizedKey(v,tr,ta),v.evaluate(X)},g.calcOptimizedKey=function(g,v,S){var O=this._curve.getKeyframeTime(v),X=this._curve.getKeyframeTime(S),Y=this._curve.getKeyframeValue(v),te=Y.value,ti=Y.leftTangent,tr=this._curve.getKeyframeValue(S),ta=tr.value,th=tr.rightTangent;g.index=v,g.time=O,g.endTime=X;var tu=X-O,tl=ta-te,tc=1/(tu*tu),t_=ti*tu,tf=th*tu;g.coefficient[0]=(t_+tf-tl-tl)*tc/tu,g.coefficient[1]=(tl+tl+tl-t_-t_-tf)*tc,g.coefficient[2]=ti,g.coefficient[3]=te},g.findIndex=function(g,v){var S=this._curve,O=S.keyFramesCount,X=g.index;if(-1!==X){if(v>S.getKeyframeTime(X))for(var Y=0;Y<3;Y++){var te=X+Y;if(te+1<O&&S.getKeyframeTime(te+1)>v)return te}else for(var ti=0;ti<3;ti++){var tr=X-ti;if(tr>=0&&S.getKeyframeTime(tr-1)<=v)return tr-1}}for(var ta,th=0,tu=O;tu-th>1;)ta=Math.floor((th+tu)/2),S.getKeyframeTime(ta)>=v?tu=ta:th=ta;return th},n(t1,[{key:"_internalCurve",get:function(){return this._curve}},{key:"keyFrames",get:function(){return Array.from(this._curve.keyframes()).map(function(g){var v=g[0],S=g[1],O=new jh;return O.time=v,O.value=S.value,O.inTangent=S.leftTangent,O.outTangent=S.rightTangent,O})},set:function(g){this._curve.assignSorted(g.map(function(g){return[g.time,{interpolationMode:nz.CUBIC,value:g.value,leftTangent:g.inTangent,rightTangent:g.outTangent}]}))}},{key:"preWrapMode",get:function(){return $h(this._curve.preExtrapolation)},set:function(g){this._curve.preExtrapolation=Zh(g)}},{key:"postWrapMode",get:function(){return $h(this._curve.postExtrapolation)},set:function(g){this._curve.postExtrapolation=Zh(g)}}]),t1}();function Zh(g){switch(g){default:case s4.Default:case s4.Normal:case s4.Clamp:return nW.CLAMP;case s4.PingPong:return nW.PING_PONG;case s4.Loop:return nW.LOOP}}function $h(g){switch(g){default:case nW.LINEAR:case nW.CLAMP:return s4.Clamp;case nW.PING_PONG:return s4.PingPong;case nW.LOOP:return s4.Loop}}s6.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],ri.fastDefine("cc.AnimationCurve",s6,{_curve:null}),function(g){g[g.Default=0]="Default",g[g.Normal=1]="Normal",g[g.Loop=2]="Loop",g[g.ShouldWrap=4]="ShouldWrap",g[g.Clamp=8]="Clamp",g[g.PingPong=22]="PingPong",g[g.Reverse=36]="Reverse"}(s4||(s4={})),function(g){g[g.LINEAR=0]="LINEAR",g[g.BEZIER=1]="BEZIER",g[g.CATMULL_ROM=2]="CATMULL_ROM"}(s8||(s8={}));var s7,s9=0xffffffff,ai=new eL,ar=new eL,aa=new eL,au=new eL,al=function(){function t1(g,v){void 0===g&&(g=s8.CATMULL_ROM),void 0===v&&(v=[]),this._type=void 0,this._mode=s8.CATMULL_ROM,this._knots=[],this._type=iw.SHAPE_SPLINE,this._mode=g;for(var S=0;S<v.length;S++)this._knots[S]=new eL(v[S])}t1.create=function(g,v){return void 0===v&&(v=[]),new t1(g,v)},t1.clone=function(g){return new t1(g.mode,g.knots)},t1.copy=function(g,v){g._mode=v.mode,g._knots.length=0;for(var S=v.knots,O=S.length,X=0;X<O;X++)g._knots[X]=new eL(S[X]);return g};var g=t1.prototype;return g.setModeAndKnots=function(g,v){this._mode=g,this._knots.length=0;for(var S=0;S<v.length;S++)this._knots[S]=new eL(v[S])},g.clearKnots=function(){this._knots.length=0},g.getKnotCount=function(){return this._knots.length},g.addKnot=function(g){this._knots.push(new eL(g))},g.insertKnot=function(g,v){var S=new eL(v);g>=this._knots.length?this._knots.push(S):this._knots.splice(g,0,S)},g.removeKnot=function(g){g>=0&&this._knots.length,this._knots.splice(g,1)},g.setKnot=function(g,v){g>=0&&this._knots.length,this._knots[g].set(v)},g.getKnot=function(g){return g>=0&&this._knots.length,this._knots[g]},g.getPoint=function(g,v){void 0===v&&(v=s9),g=mi(g,0,1);var S=this.getSegments();if(0===S)return new eL(0,0,0);if(v===s9){var O=1/S;v=Math.floor(g/O),g=g%O/O}if(v>=S)return new eL(this._knots[this._knots.length-1]);switch(this._mode){case s8.LINEAR:return t1.calcLinear(this._knots[v],this._knots[v+1],g);case s8.BEZIER:return t1.calcBezier(this._knots[4*v],this._knots[4*v+1],this._knots[4*v+2],this._knots[4*v+3],g);case s8.CATMULL_ROM:var X=v>0?this._knots[v-1]:this._knots[v],Y=v+2<this._knots.length?this._knots[v+2]:this._knots[v+1];return t1.calcCatmullRom(X,this._knots[v],this._knots[v+1],Y,g);default:return new eL(0,0,0)}},g.getPoints=function(g,v){if(void 0===v&&(v=s9),0===g)return[];if(1===g)return[this.getPoint(0,v)];for(var S=[],O=1/(g-1),X=0;X<g;X++){var Y=X*O,te=this.getPoint(Y,v);S.push(te)}return S},g.getSegments=function(){var g=this._knots.length;switch(this._mode){case s8.LINEAR:case s8.CATMULL_ROM:return g<2?(q(14300),0):g-1;case s8.BEZIER:return g<4||g%4!=0?(q(14301),0):g/4}},t1.calcLinear=function(g,v,S){var O=new eL;return eL.multiplyScalar(ai,g,1-S),eL.multiplyScalar(ar,v,S),eL.add(O,ai,ar),O},t1.calcBezier=function(g,v,S,O,X){var Y=new eL,te=1-X;return eL.multiplyScalar(ai,g,te*te*te),eL.multiplyScalar(ar,v,3*X*te*te),eL.multiplyScalar(aa,S,3*X*X*te),eL.multiplyScalar(au,O,X*X*X),eL.add(ai,ai,ar),eL.add(aa,aa,au),eL.add(Y,ai,aa),Y},t1.calcCatmullRom=function(g,v,S,O,X){var Y=new eL,te=X*X,ti=te*X;return eL.multiplyScalar(ai,g,-.5*ti+te-.5*X),eL.multiplyScalar(ar,v,1.5*ti-2.5*te+1),eL.multiplyScalar(aa,S,-1.5*ti+2*te+.5*X),eL.multiplyScalar(au,O,.5*ti-.5*te),eL.add(ai,ai,ar),eL.add(aa,aa,au),eL.add(Y,ai,aa),Y},n(t1,[{key:"type",get:function(){return this._type}},{key:"mode",get:function(){return this._mode}},{key:"knots",get:function(){return this._knots}}]),t1}();!function(g){g[g.ALL=0]="ALL",g[g.CLOSEST=1]="CLOSEST",g[g.ANY=2]="ANY"}(s7||(s7={}));var ac=Object.freeze({__proto__:null,distance:iR,enums:iw,intersect:nF,Line:iI,Plane:iO,Ray:iL,Triangle:iF,Sphere:iH,AABB:iK,OBB:nH,Capsule:iJ,Frustum:i9,Keyframe:jh,AnimationCurve:s6,get WrapModeMask(){return s4},get SplineMode(){return s8},Spline:al,constructLegacyCurveAndConvert:function(){var g=new ss;return g.assignSorted([[0,{interpolationMode:nz.CUBIC,value:1}],[1,{interpolationMode:nz.CUBIC,value:1}]]),g},OptimizedKey:s3,evalOptCurve:qh,get ERaycastMode(){return s7}});g("am",ac);var a_=function(){function t1(){this._poolHandle=-1,af.addContainer(this)}return t1.prototype.destroy=function(){af.removeContainer(this)},t1}(),af=new(function(){function t1(){this._pools=[],this._lastShrinkPassed=0,this.shrinkTimeSpan=5}var g=t1.prototype;return g.addContainer=function(g){-1===g._poolHandle&&(g._poolHandle=this._pools.length,this._pools.push(g))},g.removeContainer=function(g){-1!==g._poolHandle&&(this._pools[this._pools.length-1]._poolHandle=g._poolHandle,Kt(this._pools,g._poolHandle),g._poolHandle=-1)},g.tryShrink=function(){for(var g=0;g<this._pools.length;g++)this._pools[g].tryShrink()},g.update=function(g){this._lastShrinkPassed+=g,this._lastShrinkPassed>this.shrinkTimeSpan&&(this.tryShrink(),this._lastShrinkPassed-=this.shrinkTimeSpan)},t1}()),ad=g("b9",function(g){function e(v,S,O){var X;(X=g.call(this)||this)._ctor=void 0,X._elementsPerBatch=void 0,X._nextAvail=void 0,X._freePool=[],X._dtor=void 0,X._ctor=v,X._dtor=O||null,X._elementsPerBatch=Math.max(S,1),X._nextAvail=X._elementsPerBatch-1;for(var Y=0;Y<X._elementsPerBatch;++Y)X._freePool.push(v());return X}s(e,g);var v=e.prototype;return v.alloc=function(){if(this._nextAvail<0){this._freePool.length=this._elementsPerBatch;for(var g=0;g<this._elementsPerBatch;g++)this._freePool[g]=this._ctor();this._nextAvail=this._elementsPerBatch-1}return this._freePool[this._nextAvail--]},v.free=function(g){this._freePool[++this._nextAvail]=g},v.freeArray=function(g){this._freePool.length=this._nextAvail+1,Array.prototype.push.apply(this._freePool,g),this._nextAvail+=g.length},v.tryShrink=function(){if(this._nextAvail>>1>this._elementsPerBatch){if(this._dtor)for(var g=this._nextAvail>>1;g<=this._nextAvail;g++)this._dtor(this._freePool[g]);this._freePool.length=this._nextAvail>>1,this._nextAvail=this._freePool.length-1}},v.destroy=function(v){var S=arguments.length>0?v:null;S&&q(14100);var O=S||this._dtor;if(O)for(var X=0;X<=this._nextAvail;X++)O(this._freePool[X]);this._freePool.length=0,this._nextAvail=-1,g.prototype.destroy.call(this)},e}(a_)),ap=g("ba",function(g){function e(v,S,O){var X;(X=g.call(this)||this)._fn=void 0,X._dtor=null,X._count=0,X._data=void 0,X._initSize=0,X._fn=v,X._dtor=O||null,X._data=new Array(S),X._initSize=S;for(var Y=0;Y<S;++Y)X._data[Y]=v();return X}s(e,g);var v=e.prototype;return v.reset=function(){this._count=0},v.resize=function(g){if(g>this._data.length)for(var v=this._data.length;v<g;++v)this._data[v]=this._fn()},v.add=function(){return this._count>=this._data.length&&this.resize(this._data.length<<1),this._data[this._count++]},v.destroy=function(){if(this._dtor)for(var v=0;v<this._data.length;v++)this._dtor(this._data[v]);this._data.length=0,this._count=0,g.prototype.destroy.call(this)},v.tryShrink=function(){if(this._data.length>>2>this._count){var g=Math.max(this._initSize,this._data.length>>1);if(this._dtor)for(var v=g;v<this._data.length;v++)this._dtor(this._data[v]);this._data.length=g}},v.removeAt=function(g){if(!(g>=this._count)){var v=this._count-1,S=this._data[g];this._data[g]=this._data[v],this._data[v]=S,this._count-=1}},n(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}(a_)),am=g("bb",function(g){function e(v,S){var O;return(O=g.call(this)||this).array=void 0,O.length=0,O._compareFn=void 0,O._initSize=0,O.array=new Array(v),O._initSize=v,O.length=0,O._compareFn=S,O}s(e,g);var v=e.prototype;return v.push=function(g){this.array[this.length++]=g},v.pop=function(){return this.array[--this.length]},v.get=function(g){return this.array[g]},v.clear=function(){this.length=0},v.destroy=function(){this.length=0,this.array.length=0,g.prototype.destroy.call(this)},v.tryShrink=function(){this.array.length>>2>this.length&&(this.array.length=Math.max(this._initSize,this.array.length>>1))},v.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},v.concat=function(g){for(var v=0;v<g.length;++v)this.array[this.length++]=g[v]},v.fastRemove=function(g){if(!(g>=this.length||g<0)){var v=--this.length;this.array[g]=this.array[v]}},v.indexOf=function(g){for(var v=0,S=this.length;v<S;++v)if(this.array[v]===g)return v;return -1},e}(a_));g("al",Object.freeze({__proto__:null,Pool:ad,RecyclePool:ap,CachedArray:am}));var ag=Kt;function du(){}var av=function(){function t1(){this.callback=du,this.target=void 0,this.once=!1}var g=t1.prototype;return g.set=function(g,v,S){this.callback=g||du,this.target=v,this.once=!!S},g.reset=function(){this.target=void 0,this.callback=du,this.once=!1},g.check=function(){return!(Oa(this.target)&&!Ma(this.target,!0))},t1}(),aS=new ad(function(){return new av},32),aA=function(){function t1(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var g=t1.prototype;return g.removeByCallback=function(g){for(var v=0;v<this.callbackInfos.length;++v){var S=this.callbackInfos[v];S&&S.callback===g&&(S.reset(),aS.free(S),ag(this.callbackInfos,v),--v)}},g.removeByTarget=function(g){for(var v=0;v<this.callbackInfos.length;++v){var S=this.callbackInfos[v];S&&S.target===g&&(S.reset(),aS.free(S),ag(this.callbackInfos,v),--v)}},g.cancel=function(g){var v=this.callbackInfos[g];v&&(v.reset(),this.isInvoking?this.callbackInfos[g]=null:ag(this.callbackInfos,g),aS.free(v)),this.containCanceled=!0},g.cancelAll=function(){for(var g=0;g<this.callbackInfos.length;g++){var v=this.callbackInfos[g];v&&(v.reset(),aS.free(v),this.callbackInfos[g]=null)}this.containCanceled=!0},g.purgeCanceled=function(){for(var g=this.callbackInfos.length-1;g>=0;--g)this.callbackInfos[g]||ag(this.callbackInfos,g);this.containCanceled=!1},g.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},t1}(),aT=new ad(function(){return new aA},16),aE=g("cE",function(){function t1(){this._callbackTable=gt(!0),this._offCallback=void 0}var g=t1.prototype;return g.on=function(g,v,S,O){if(!this.hasEventListener(g,v,S)){var X=this._callbackTable[g];X||(X=this._callbackTable[g]=aT.alloc());var Y=aS.alloc();Y.set(v,S,O),X.callbackInfos.push(Y)}return v},g.hasEventListener=function(g,v,S){var O=this._callbackTable&&this._callbackTable[g];if(!O)return!1;var X=O.callbackInfos;if(!v){if(O.isInvoking){for(var Y=0;Y<X.length;++Y)if(X[Y])return!0;return!1}return X.length>0}for(var te=0;te<X.length;++te){var ti=X[te];if(ti&&ti.check()&&ti.callback===v&&ti.target===S)return!0}return!1},g.removeAll=function(g){var v=void 0===g?"undefined":_type_of(g);if("string"===v||"number"===v){var S=this._callbackTable&&this._callbackTable[g];S&&(S.isInvoking?S.cancelAll():(S.clear(),aT.free(S),delete this._callbackTable[g]))}else if(g)for(var O in this._callbackTable){var X=this._callbackTable[O];if(X.isInvoking)for(var Y=X.callbackInfos,te=0;te<Y.length;++te){var ti=Y[te];ti&&ti.target===g&&X.cancel(te)}else X.removeByTarget(g)}},g.off=function(g,v,S){var O,X=this._callbackTable&&this._callbackTable[g];if(X){var Y=X.callbackInfos;if(v)for(var te=0;te<Y.length;++te){var ti=Y[te];if(ti&&ti.callback===v&&ti.target===S){X.cancel(te);break}}else this.removeAll(g)}null===(O=this._offCallback)||void 0===O||O.call(this)},g.emit=function(g,v,S,O,X,Y){var te=this._callbackTable&&this._callbackTable[g];if(te){var ti=!te.isInvoking;te.isInvoking=!0;for(var tr=te.callbackInfos,ta=0,th=tr.length;ta<th;++ta){var tu=tr[ta];if(tu){var tl=tu.callback,tc=tu.target;tu.once&&this.off(g,tl,tc),tu.check()?tc?tl.call(tc,v,S,O,X,Y):tl(v,S,O,X,Y):this.off(g,tl,tc)}}ti&&(te.isInvoking=!1,te.containCanceled&&te.purgeCanceled())}},g.clear=function(){for(var g in this._callbackTable){var v=this._callbackTable[g];v&&(v.clear(),aT.free(v),delete this._callbackTable[g])}},g._registerOffCallback=function(g){this._offCallback=g},t1}());function Su(g){for(var v=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._callbackTable=gt(!0),v}s(e,g);var v=e.prototype;return v.once=function(g,v,S){return this.on(g,v,S,!0)},v.targetOff=function(g){this.removeAll(g)},e}(g),S=aE.prototype,O=Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S)),X=0;X<O.length;++X){var Y=O[X];if(!(Y in v.prototype)){var te=Object.getOwnPropertyDescriptor(S,Y);te&&Object.defineProperty(v.prototype,Y,te)}}return v}var aC=g("bH",Su(function(){}));X.EventTarget=aC;var ax,ab,aR,aw,aI,aB,aP=g("bJ",function(){function t1(){this._delegates=[]}var g=t1.prototype;return g.add=function(g){this._delegates.includes(g)||this._delegates.push(g)},g.hasListener=function(g){return this._delegates.includes(g)},g.remove=function(g){Qt(this._delegates,g)},g.dispatch=function(){for(var g=arguments,v=arguments.length,S=new Array(v),O=0;O<v;O++)S[O]=arguments[O];return Promise.all(this._delegates.map(function(v){return v.apply(void 0,g)}).filter(Boolean))},t1}());!function(g){g.UNKNOWN="unknown",g.WECHAT="wechat",g.ANDROID="androidbrowser",g.IE="ie",g.EDGE="edge",g.QQ="qqbrowser",g.MOBILE_QQ="mqqbrowser",g.UC="ucbrowser",g.UCBS="ucbs",g.BROWSER_360="360browser",g.BAIDU_APP="baiduboxapp",g.BAIDU="baidubrowser",g.MAXTHON="maxthon",g.OPERA="opera",g.OUPENG="oupeng",g.MIUI="miuibrowser",g.FIREFOX="firefox",g.SAFARI="safari",g.CHROME="chrome",g.LIEBAO="liebao",g.QZONE="qzone",g.SOUGOU="sogou",g.HUAWEI="huawei"}(ax||(ax={})),function(g){g.UNKNOWN="unknown",g.ENGLISH="en",g.CHINESE="zh",g.FRENCH="fr",g.ITALIAN="it",g.GERMAN="de",g.SPANISH="es",g.DUTCH="du",g.RUSSIAN="ru",g.KOREAN="ko",g.JAPANESE="ja",g.HUNGARIAN="hu",g.PORTUGUESE="pt",g.ARABIC="ar",g.NORWEGIAN="no",g.POLISH="pl",g.TURKISH="tr",g.UKRAINIAN="uk",g.ROMANIAN="ro",g.BULGARIAN="bg",g.HINDI="hi"}(ab||(ab={})),function(g){g[g.NONE=0]="NONE",g[g.LAN=1]="LAN",g[g.WWAN=2]="WWAN"}(aR||(aR={})),function(g){g.UNKNOWN="Unknown",g.IOS="iOS",g.ANDROID="Android",g.WINDOWS="Windows",g.LINUX="Linux",g.OSX="OS X",g.OHOS="OHOS",g.OPENHARMONY="OpenHarmony"}(aw||(aw={})),function(g){g.UNKNOWN="UNKNOWN",g.EDITOR_PAGE="EDITOR_PAGE",g.EDITOR_CORE="EDITOR_CORE",g.MOBILE_BROWSER="MOBILE_BROWSER",g.DESKTOP_BROWSER="DESKTOP_BROWSER",g.WIN32="WIN32",g.ANDROID="ANDROID",g.IOS="IOS",g.MACOS="MACOS",g.OHOS="OHOS",g.OPENHARMONY="OPENHARMONY",g.WECHAT_GAME="WECHAT_GAME",g.WECHAT_MINI_PROGRAM="WECHAT_MINI_PROGRAM",g.BAIDU_MINI_GAME="BAIDU_MINI_GAME",g.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",g.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",g.TAOBAO_CREATIVE_APP="TAOBAO_CREATIVE_APP",g.TAOBAO_MINI_GAME="TAOBAO_MINI_GAME",g.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",g.OPPO_MINI_GAME="OPPO_MINI_GAME",g.VIVO_MINI_GAME="VIVO_MINI_GAME",g.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",g.COCOSPLAY="COCOSPLAY",g.LINKSURE_MINI_GAME="LINKSURE_MINI_GAME",g.QTT_MINI_GAME="QTT_MINI_GAME"}(aI||(aI={})),function(g){g.WEBP="WEBP",g.IMAGE_BITMAP="IMAGE_BITMAP",g.WEB_VIEW="WEB_VIEW",g.VIDEO_PLAYER="VIDEO_PLAYER",g.SAFE_AREA="SAFE_AREA",g.HPE="HPE",g.INPUT_TOUCH="INPUT_TOUCH",g.EVENT_KEYBOARD="EVENT_KEYBOARD",g.EVENT_MOUSE="EVENT_MOUSE",g.EVENT_TOUCH="EVENT_TOUCH",g.EVENT_ACCELEROMETER="EVENT_ACCELEROMETER",g.EVENT_GAMEPAD="EVENT_GAMEPAD",g.EVENT_HANDLE="EVENT_HANDLE",g.EVENT_HMD="EVENT_HMD",g.EVENT_HANDHELD="EVENT_HANDHELD",g.WASM="WASM"}(aB||(aB={}));var aD=new(function(g){function e(){var v,O,X,Y;(Y=g.call(this)||this).networkType=void 0,Y.isNative=void 0,Y.isBrowser=void 0,Y.isMobile=void 0,Y.isLittleEndian=void 0,Y.platform=void 0,Y.language=void 0,Y.nativeLanguage=void 0,Y.os=void 0,Y.osVersion=void 0,Y.osMainVersion=void 0,Y.browserType=void 0,Y.browserVersion=void 0,Y.isXR=void 0,Y._battery=void 0,Y._featureMap=void 0,Y._initPromise=void 0;var te,ti=window.navigator,tr=ti.userAgent.toLowerCase();null===(v=(O=ti).getBattery)||void 0===v||v.call(O).then(function(g){Y._battery=g}),Y.networkType=aR.LAN,Y.isNative=!1,Y.isBrowser=!0,Y.isMobile=/mobile|android|iphone|ipad/.test(tr),Y.platform=Y.isMobile?aI.MOBILE_BROWSER:aI.DESKTOP_BROWSER,Y.isLittleEndian=(te=new ArrayBuffer(2),new DataView(te).setInt16(0,256,!0),256===new Int16Array(te)[0]);var ta=ti.language;Y.nativeLanguage=ta.toLowerCase(),ta=(ta=ta||ti.browserLanguage)?ta.split("-")[0]:ab.ENGLISH,Y.language=ta;var th=!1,tu=!1,tl="",tc=0,t_=/android\s*(\d+(?:\.\d+)*)/i.exec(tr)||/android\s*(\d+(?:\.\d+)*)/i.exec(ti.platform);t_&&(th=!0,tl=t_[1]||"",tc=parseInt(tl)||0),(t_=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(tr))?(tu=!0,tl=t_[2]||"",tc=parseInt(tl)||0):(/(iPhone|iPad|iPod)/.exec(ti.platform)||"MacIntel"===ti.platform&&ti.maxTouchPoints&&ti.maxTouchPoints>1)&&(tu=!0,tl="",tc=0);var tf=aw.UNKNOWN;-1!==ti.appVersion.indexOf("Win")?tf=aw.WINDOWS:tu?tf=aw.IOS:-1!==ti.appVersion.indexOf("Mac")?tf=aw.OSX:-1!==ti.appVersion.indexOf("X11")&&-1===ti.appVersion.indexOf("Linux")?tf=aw.LINUX:th?tf=aw.ANDROID:-1===ti.appVersion.indexOf("Linux")&&-1===tr.indexOf("ubuntu")||(tf=aw.LINUX),Y.os=tf,Y.osVersion=tl,Y.osMainVersion=tc,Y.browserType=ax.UNKNOWN;var tp=/wechat|weixin|micromessenger/i.exec(tr)||/mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|ucbs|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(tr)||/qq|qqbrowser|ucbrowser|ubrowser|edge|HuaweiBrowser/i.exec(tr)||/chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(tr),tm=tp?tp[0].toLowerCase():aw.UNKNOWN;("safari"===tm&&th||"qq"===tm&&/android.*applewebkit/i.test(tr))&&(tm=ax.ANDROID);var tg={micromessenger:ax.WECHAT,wechat:ax.WECHAT,weixin:ax.WECHAT,trident:ax.IE,edge:ax.EDGE,"360 aphone":ax.BROWSER_360,mxbrowser:ax.MAXTHON,"opr/":ax.OPERA,ubrowser:ax.UC,huaweibrowser:ax.HUAWEI};Y.browserType=tg[tm]||tm,Y.browserVersion="";var tv=/(mqqbrowser|micromessenger|qqbrowser|sogou|qzone|liebao|maxthon|uc|ucbs|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui(?:.hybrid)?)(mobile)?(browser)?\/?([\d.]+)/i.exec(tr);tv||(tv=/(qq|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i.exec(tr)),Y.browserVersion=tv?tv[4]:"",Y.isXR=!1;var ty,tS=document.createElement("canvas");tS.getContext("2d");try{ty=tS.toDataURL("image/webp").startsWith("data:image/webp")}catch(g){ty=!1}if(Y.os===aw.IOS){var tA,tT=null===(tA=/ applewebkit\/(\d+)/.exec(tr))||void 0===tA?void 0:tA[1];"string"==typeof tT&&Number.parseInt(tT)>=604&&(ty=!0)}else if(Y.browserType===ax.SAFARI){var tE,tC=null===(tE=/ version\/(\d+)/.exec(tr))||void 0===tE?void 0:tE[1];"string"==typeof tC&&Number.parseInt(tC)>=14&&(ty=!0)}var tx=void 0!==document.documentElement.ontouchstart||void 0!==document.ontouchstart||S,tb=void 0!==document.documentElement.onmouseup||S,tw=void 0!==navigator.xr,tI=function(){if((Y.os===aw.IOS||Y.os===aw.OSX)&&/(OS 15_4)|(Version\/15.4)/.test(window.navigator.userAgent))return!1;try{if("object"==("undefined"==typeof WebAssembly?"undefined":_type_of(WebAssembly))&&"function"==typeof WebAssembly.instantiate){var g=new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0]));if(_instanceof(g,WebAssembly.Module))return _instanceof(new WebAssembly.Instance(g),WebAssembly.Instance)}}catch(g){}return!1}();return Y._featureMap=((X={})[aB.WEBP]=ty,X[aB.IMAGE_BITMAP]=!1,X[aB.WEB_VIEW]=!0,X[aB.VIDEO_PLAYER]=!0,X[aB.SAFE_AREA]=!1,X[aB.HPE]=!1,X[aB.INPUT_TOUCH]=tx,X[aB.EVENT_KEYBOARD]=void 0!==document.documentElement.onkeyup||S,X[aB.EVENT_MOUSE]=tb,X[aB.EVENT_TOUCH]=tx||tb,X[aB.EVENT_ACCELEROMETER]=void 0!==window.DeviceMotionEvent||void 0!==window.DeviceOrientationEvent,X[aB.EVENT_GAMEPAD]=void 0!==navigator.getGamepads||void 0!==navigator.webkitGetGamepads||tw,X[aB.EVENT_HANDLE]=false,X[aB.EVENT_HMD]=tw,X[aB.EVENT_HANDHELD]=tw,X[aB.WASM]=tI,X),Y._initPromise=[],Y._initPromise.push(Y._supportsImageBitmapPromise()),Y._registerEvent(),Y}s(e,g);var v=e.prototype;return v._supportsImageBitmapPromise=function(){var g=this;if("undefined"!=typeof createImageBitmap&&"undefined"!=typeof Blob){var v=document.createElement("canvas");v.width=v.height=2;var S=createImageBitmap(v,{});if(_instanceof(S,Promise))return S.then(function(v){g._setFeature(aB.IMAGE_BITMAP,!0),null==v||v.close()})}return Promise.resolve()},v._registerEvent=function(){var g,v=this;g=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":"hidden";var S=!1,n=function(){S||(S=!0,v.emit("hide"))},_$r=function(g,O,X,Y,te){S&&(S=!1,v.emit("show",g,O,X,Y,te))};if(g)for(var O=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],X=0;X<O.length;X++)document.addEventListener(O[X],function(v){var S=document[g];(S=S||v.hidden)?n():_$r()});else window.addEventListener("blur",n),window.addEventListener("focus",_$r);window.navigator.userAgent.indexOf("MicroMessenger")>-1&&(window.onfocus=_$r),"onpageshow"in window&&"onpagehide"in window&&(window.addEventListener("pagehide",n),window.addEventListener("pageshow",_$r),document.addEventListener("pagehide",n),document.addEventListener("pageshow",_$r))},v._setFeature=function(g,v){return this._featureMap[g]=v},v.init=function(){return Promise.all(this._initPromise)},v.hasFeature=function(g){return this._featureMap[g]},v.getBatteryLevel=function(){return this._battery?this._battery.level:1},v.triggerGC=function(){},v.openURL=function(g){window.open(g)},v.now=function(){return Date.now?Date.now():+new Date},v.restartJSVM=function(){},v.exit=function(){window.close()},v.close=function(){this.emit("close")},e}(aC)),aM=/(\.[^\.\/\?\\]*)(\?.*)?$/,aO=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,aL=/[^\.\/]+\/\.\.\//;function Ou(){for(var g="",v=arguments.length,S=new Array(v),O=0;O<v;O++)S[O]=arguments[O];for(var X=0,Y=S;X<Y.length;X++){var te=Y[X];g=(g+(""===g?"":"/")+te).replace(/(\/|\\\\)$/,"")}return g}function Mu(g){var v=aM.exec(g);return v?v[1]:""}function Lu(g){if(g){var v=g.lastIndexOf(".");if(-1!==v)return g.substring(0,v)}return g}function Fu(g,v){var S=g.indexOf("?");S>0&&(g=g.substring(0,S));var O=/(\/|\\)([^\/\\]+)$/g.exec(g.replace(/(\/|\\)$/,""));if(!O)return g;var X=O[2];return v&&g.substring(g.length-v.length).toLowerCase()===v.toLowerCase()?X.substring(0,X.length-v.length):X}function Nu(g){var v=aO.exec(g);return v?v[2]:""}function Gu(g,v){v=v||"";var S=g.indexOf("?"),O="";return S>0&&(O=g.substring(S),g=g.substring(0,S)),(S=g.lastIndexOf("."))<0?g+v+O:g.substring(0,S)+v+O}function ku(g,v,S){if(0===v.indexOf("."))return Gu(g,v);var O=g.indexOf("?"),X="",Y=S?Mu(g):"";return O>0&&(X=g.substring(O),g=g.substring(0,O)),O=(O=g.lastIndexOf("/"))<=0?0:O+1,g.substring(0,O)+v+Y+X}function Vu(g){var v=g=String(g);do v=g,g=g.replace(aL,"");while(v.length!==g.length);return g}function Uu(g){return g.replace(/[\/\\]$/,"")}function Hu(){return aD.os===aw.WINDOWS?"\\":"/"}g("bi",Object.freeze({__proto__:null,join:Ou,extname:Mu,mainFileName:Lu,basename:Fu,dirname:Nu,changeExtname:Gu,changeBasename:ku,_normalize:Vu,stripSep:Uu,getSeperator:Hu}));var aF,aN,ak,aG,aV,aU=10;g("bk",aF),g("bl",aN),g("bm",ak);var aH=0,az=new Map;aG=function(g,v,S,O,X,Y,te){var ti=az.get(Y);ti&&ti.logTimes>ti.count&&(X("'%s' is deprecated, please use '%s' instead. "+te,g+"."+v,S+"."+O),ti.count++)},g("bk",aF=function(g,v,S){null!=g&&S.forEach(function(S){var O=aH++;az.set(O,{id:O,count:0,logTimes:void 0!==S.logTimes?S.logTimes:aU});var X=null!=S.target?S.target:g,Y=null!=S.newName?S.newName:S.name,te=null!=S.targetName?S.targetName:v,ti=X===g,tr=S.suggest?"("+S.suggest+")":"";if(null!=S.customFunction)g[S.name]=function(){var g;return aG(v,S.name,te,Y,G,O,tr),(g=S.customFunction).call.apply(g,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=S.customSetter||null!=S.customGetter){var ta=null!=S.customSetter,th=null!=S.customGetter;ta&&th?Object.defineProperty(g,S.name,{get:function(){return aG(v,S.name,te,Y,G,O,tr),S.customGetter.call(this)},set:function(g){aG(v,S.name,te,Y,G,O,tr),S.customSetter.call(this,g)},enumerable:!1}):ta?Object.defineProperty(g,S.name,{set:function(g){aG(v,S.name,te,Y,G,O,tr),S.customSetter.call(this,g)},enumerable:!1}):th&&Object.defineProperty(g,S.name,{get:function(){return aG(v,S.name,te,Y,G,O,tr),S.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(g,S.name,{get:function(){return aG(v,S.name,te,Y,G,O,tr),ti?this[Y]:X[Y]},set:function(g){aG(v,S.name,te,Y,G,O,tr),ti?this[Y]=g:X[Y]=g},enumerable:!1})})}),aV=function(g,v,S,O,X){var Y=az.get(O);Y&&Y.logTimes>Y.count&&(S("'%s' has been removed. "+X,g+"."+v),Y.count++)},g("bl",aN=function(g,v,S){null!=g&&S.forEach(function(S){var O=aH++;az.set(O,{id:O,count:0,logTimes:void 0!==S.logTimes?S.logTimes:aU});var X=S.suggest?"("+S.suggest+")":"";Object.defineProperty(g,S.name,{get:function(){return aV(v,S.name,k,O,X)},set:function(){aV(v,S.name,k,O,X)},enumerable:!1})})}),g("bm",ak=function(){});var aW,aX={};function $u(g){var v=aX[g];if(v){var S=v.newName,O=v.since;v.removed?S?J(16003,g,O,S):J(16002,g,O):S?q(16001,g,O,S):q(16e3,g,O)}}var aq=new eL;function el(g,v,S,O){O||(O=new eL),g.convertToUINode(v,S,O);var X=S.position;return O.add(X),O}function il(g,v,S){return S||(S=new eL),g.worldToScreen(v,S),S.x/=X.view.getScaleX(),S.y/=X.view.getScaleY(),S}var aJ=g("bs",{WorldNode3DToLocalNodeUI:el,WorldNode3DToWorldNodeUI:il});X.pipelineUtils=aJ,aF(X.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];var O=v[0],X=v[3]||aq;return O.convertToUINode(v[1],v[2],X),X.add(v[2].position),v[3]||X.clone()}}]);var aZ,aQ={auto:tZ.AUTO,landscape:tZ.LANDSCAPE,portrait:tZ.PORTRAIT};!function(g){g[g.Unknown=0]="Unknown",g[g.SubFrame=1]="SubFrame",g[g.BrowserWindow=2]="BrowserWindow",g[g.Fullscreen=3]="Fullscreen"}(aZ||(aZ={}));var a$=new(function(g){s(i,g);var v=i.prototype;function i(){var v,S,O,X,Y,te;(v=g.call(this)||this).isFrameRotated=!1,v.handleResizeEvent=!0,v._gameFrame=void 0,v._gameContainer=void 0,v._gameCanvas=void 0,v._isProportionalToFrame=!1,v._cachedFrameStyle={width:"0px",height:"0px"},v._cachedContainerStyle={width:"0px",height:"0px"},v._cbToUpdateFrameBuffer=void 0,v._supportFullScreen=!1,v._touchEventName=void 0,v._onFullscreenChange=void 0,v._onFullscreenError=void 0,v._orientationChangeTimeoutId=-1,v._cachedFrameSize=new iu(0,0),v._exactFitScreen=!1,v._isHeadlessMode=!1,v._fn={},v._fnGroup=[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement","fullscreenerror"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement","fullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement","msfullscreenerror"]],v._resolutionScale=1,v._orientation=tZ.AUTO,v._orientationDevice=tZ.AUTO,v._gameFrame=document.getElementById("GameDiv"),v._gameContainer=document.getElementById("Cocos3dGameContainer"),v._gameCanvas=document.getElementById("GameCanvas"),v._gameFrame||(v._gameFrame=document.createElement("div"),v._gameFrame.setAttribute("id","GameDiv"),null===(S=v._gameCanvas)||void 0===S||null===(O=S.parentNode)||void 0===O||O.insertBefore(v._gameFrame,v._gameCanvas),v._gameFrame.appendChild(v._gameCanvas)),v._gameContainer||(v._gameContainer=document.createElement("div"),v._gameContainer.setAttribute("id","Cocos3dGameContainer"),null===(X=v._gameCanvas)||void 0===X||null===(Y=X.parentNode)||void 0===Y||Y.insertBefore(v._gameContainer,v._gameCanvas),v._gameContainer.appendChild(v._gameCanvas));for(var ti=v._fnGroup,tr=0;tr<ti.length;tr++)if(te=ti[tr],void 0!==document[te[1]]){for(var ta=0;ta<te.length;ta++)v._fn[ti[0][ta]]=te[ta];break}return v._supportFullScreen=void 0!==v._fn.requestFullscreen,v._touchEventName="ontouchstart"in window?"touchend":"mousedown",v._registerEvent(),v}return v._updateFrame=function(){this._updateFrameState(),this._resizeFrame()},v.init=function(g,v){this._cbToUpdateFrameBuffer=v,this.orientation=aQ[g.configOrientation],this._exactFitScreen=g.exactFitScreen,this._isHeadlessMode=g.isHeadlessMode,this._resizeFrame()},v.requestFullScreen=function(){var g=this;return new Promise(function(v,S){g.isFullScreen?v():(g._cachedFrameSize=g.windowSize,g._doRequestFullScreen().then(function(){v()}).catch(function(){var O=g._getFullscreenTarget();O?O.addEventListener(g._touchEventName,function(){g._doRequestFullScreen().then(function(){v()}).catch(S)},{once:!0,capture:!0}):S(new Error("Cannot access fullscreen target"))}))})},v.exitFullScreen=function(){var g=this;return new Promise(function(v,S){var O=document[g._fn.exitFullscreen]();window.Promise&&_instanceof(O,Promise)?O.then(function(){g.windowSize=g._cachedFrameSize,v()}).catch(S):(g.windowSize=g._cachedFrameSize,v())})},v._registerEvent=function(){var g=this;document.addEventListener(this._fn.fullscreenerror,function(){var v;null===(v=g._onFullscreenError)||void 0===v||v.call(g)}),window.addEventListener("resize",function(){g._resizeFrame()});var v,_$i=function(v){v!==g._orientationDevice&&(g._orientationDevice=v,g._updateFrame(),g.emit("orientation-change",v))},_$n=function(){-1!==g._orientationChangeTimeoutId&&clearTimeout(g._orientationChangeTimeoutId),g._orientationChangeTimeoutId=setTimeout(function(){v()},200)};if("function"==typeof window.matchMedia){!function e(){var v,S,O=window.devicePixelRatio;null===(v=window.matchMedia("(resolution: "+O+"dppx)"))||void 0===v||null===(S=v.addEventListener)||void 0===S||S.call(v,"change",function(){g.emit("window-resize",g.windowSize.width,g.windowSize.height),e()},{once:!0})}();var S=window.matchMedia("(orientation: portrait)"),O=window.matchMedia("(orientation: landscape)"),X=screen.orientation;v=function(){var v=g._orientationDevice;S.matches?(v=tZ.PORTRAIT,X&&(v="portrait-primary"===screen.orientation.type?tZ.PORTRAIT:tZ.PORTRAIT_UPSIDE_DOWN)):O.matches&&(v=tZ.LANDSCAPE,X&&(v="landscape-primary"===screen.orientation.type?tZ.LANDSCAPE_LEFT:tZ.LANDSCAPE_RIGHT)),_$i(v)},S.addEventListener("change",_$n),O.addEventListener("change",_$n)}else v=function(){var v=function(){var v=tZ.PORTRAIT;switch(window.orientation){case 0:v=tZ.PORTRAIT;break;case 90:v=tZ.LANDSCAPE_RIGHT;break;case -90:v=tZ.LANDSCAPE_LEFT;break;case 180:v=tZ.PORTRAIT_UPSIDE_DOWN;break;default:v=g._orientationDevice}return v}();_$i(v)},window.addEventListener("orientationchange",_$n);document.addEventListener(this._fn.fullscreenchange,function(){var v;null===(v=g._onFullscreenChange)||void 0===v||v.call(g),g.emit("fullscreen-change",g.windowSize.width,g.windowSize.height)})},v._convertToSizeInCssPixels=function(g){var v=g.clone(),S=this.devicePixelRatio;return v.width/=S,v.height/=S,v},v._resizeFrame=function(g){if(this._gameFrame){if(this._gameFrame.style.display="flex",this._gameFrame.style["justify-content"]="center",this._gameFrame.style["align-items"]="center",this._windowType===aZ.SubFrame){if(!g)return void this._updateContainer();this._gameFrame.style.width=g.width+"px",this._gameFrame.style.height=g.height+"px"}else{var v=window.innerWidth,S=window.innerHeight,O=document.body.scrollHeight-S;aD.os===aw.ANDROID&&S<O&&(S+=O),this.isFrameRotated?(this._gameFrame.style["-webkit-transform"]="rotate(90deg)",this._gameFrame.style.transform="rotate(90deg)",this._gameFrame.style["-webkit-transform-origin"]="0px 0px 0px",this._gameFrame.style.transformOrigin="0px 0px 0px",this._gameFrame.style.margin="0 0 0 "+v+"px",this._gameFrame.style.width=S+"px",this._gameFrame.style.height=v+"px"):(this._gameFrame.style["-webkit-transform"]="rotate(0deg)",this._gameFrame.style.transform="rotate(0deg)",this._gameFrame.style.margin="0px auto",this._gameFrame.style.width=v+"px",this._gameFrame.style.height=S+"px")}this._updateContainer()}},v._getFullscreenTarget=function(){var g=this._windowType;return g===aZ.Fullscreen?document[this._fn.fullscreenElement]:g===aZ.SubFrame?this._gameFrame:document.body},v._doRequestFullScreen=function(){var g=this;return new Promise(function(v,S){if(g._supportFullScreen){var O=g._getFullscreenTarget();if(O){g._onFullscreenChange=void 0,g._onFullscreenError=void 0;var X=O[g._fn.requestFullscreen]();window.Promise&&_instanceof(X,Promise)?X.then(v).catch(S):(g._onFullscreenChange=v,g._onFullscreenError=S)}else S(new Error("Cannot access fullscreen target"))}else S(new Error("fullscreen is not supported"))})},v._updateFrameState=function(){var g=this.orientation,v=window.innerWidth>window.innerHeight;this.isFrameRotated=aD.isMobile&&(v&&g===tZ.PORTRAIT||!v&&g===tZ.LANDSCAPE)},v._updateContainer=function(){if(this._gameContainer){if(this.isProportionalToFrame){if(!this._gameFrame)return void q(9201);var g,v,S=X.view.getDesignResolutionSize(),O=this._gameFrame,Y=O.clientWidth,te=O.clientHeight,ti=S.width,tr=S.height,ta=Y/ti,th=te/tr,tu=this._gameContainer.style;ta<th?(g=Y,v=tr*ta):(g=ti*th,v=te),tu.width=g+"px",tu.height=v+"px"}else{var tl=this._gameContainer.style;tl.width="100%",tl.height="100%"}this._gameFrame&&(this._cachedFrameStyle.width!==this._gameFrame.style.width||this._cachedFrameStyle.height!==this._gameFrame.style.height||this._cachedContainerStyle.width!==this._gameContainer.style.width||this._cachedContainerStyle.height!==this._gameContainer.style.height)&&(this.emit("window-resize",this.windowSize.width,this.windowSize.height),this._cachedFrameStyle.width=this._gameFrame.style.width,this._cachedFrameStyle.height=this._gameFrame.style.height,this._cachedContainerStyle.width=this._gameContainer.style.width,this._cachedContainerStyle.height=this._gameContainer.style.height)}else q(9201)},n(i,[{key:"supportFullScreen",get:function(){return this._supportFullScreen}},{key:"isFullScreen",get:function(){return!!this._supportFullScreen&&!!document[this._fn.fullscreenElement]}},{key:"devicePixelRatio",get:function(){var g;return Math.min(null!==(g=window.devicePixelRatio)&&void 0!==g?g:1,2)}},{key:"windowSize",get:function(){var g=this._windowSizeInCssPixels,v=this.devicePixelRatio;return g.width*=v,g.height*=v,g},set:function(g){this._windowType===aZ.SubFrame?this._resizeFrame(this._convertToSizeInCssPixels(g)):q(9202)}},{key:"resolution",get:function(){var g=this.windowSize,v=this.resolutionScale;return new iu(g.width*v,g.height*v)}},{key:"resolutionScale",get:function(){return this._resolutionScale},set:function(g){var v;g!==this._resolutionScale&&(this._resolutionScale=g,null===(v=this._cbToUpdateFrameBuffer)||void 0===v||v.call(this))}},{key:"orientation",get:function(){return this._orientation},set:function(g){this._orientation!==g&&(this._orientation=g,this._updateFrame())}},{key:"safeAreaEdge",get:function(){var g=this.devicePixelRatio;return{top:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top")||"0")*g,bottom:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-bottom")||"0")*g,left:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-left")||"0")*g,right:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-right")||"0")*g}}},{key:"isProportionalToFrame",get:function(){return this._isProportionalToFrame},set:function(g){this._isProportionalToFrame!==g&&(this._isProportionalToFrame=g,this._updateContainer())}},{key:"_windowSizeInCssPixels",get:function(){if(this.isProportionalToFrame)return this._gameContainer?new iu(this._gameContainer.clientWidth,this._gameContainer.clientHeight):(q(9201),new iu(0,0));var g,v,S;switch(this._windowType){case aZ.SubFrame:return this._gameFrame?new iu(this._gameFrame.clientWidth,this._gameFrame.clientHeight):(q(9201),new iu(0,0));case aZ.Fullscreen:return g=this._getFullscreenTarget(),v=this.isFrameRotated?g.clientHeight:g.clientWidth,S=this.isFrameRotated?g.clientWidth:g.clientHeight,new iu(v,S);case aZ.BrowserWindow:return v=this.isFrameRotated?window.innerHeight:window.innerWidth,S=this.isFrameRotated?window.innerWidth:window.innerHeight,new iu(v,S);case aZ.Unknown:default:return new iu(0,0)}}},{key:"_windowType",get:function(){return this._isHeadlessMode?aZ.Unknown:this.isFullScreen?aZ.Fullscreen:this._gameFrame?this._exactFitScreen?aZ.BrowserWindow:aZ.SubFrame:(q(9201),aZ.Unknown)}}]),i}(aC)),a0=function(){function t1(){}var g=t1.prototype;return g.init=function(){var g,v,S=null===(g=tQ.querySettings(tK.Category.SCREEN,"exactFitScreen"))||void 0===g||g,O=null!==(v=tQ.querySettings(tK.Category.SCREEN,"orientation"))&&void 0!==v?v:"auto",Y=3===tQ.querySettings(tK.Category.RENDERING,"renderMode");a$.init({exactFitScreen:S,configOrientation:O,isHeadlessMode:Y},function(){var g,v=X.director;null!==(g=v.root)&&void 0!==g&&g.pipeline?v.root.pipeline.shadingScale=a$.resolutionScale:q(1220)})},g.fullScreen=function(){return a$.isFullScreen},g.requestFullScreen=function(g,v,S){return arguments.length>0&&q(1400,"screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)","screen.requestFullScreen(): Promise"),a$.requestFullScreen().then(function(){null==v||v.call(document)}).catch(function(g){k(g),null==S||S.call(document)})},g.exitFullScreen=function(){return a$.exitFullScreen()},g.autoFullScreen=function(g,v){var S;null===(S=this.requestFullScreen(g,v))||void 0===S||S.catch(function(g){G(g)})},g.disableAutoFullScreen=function(){},g.on=function(g,v,S){a$.on(g,v,S)},g.once=function(g,v,S){a$.once(g,v,S)},g.off=function(g,v,S){a$.off(g,v,S)},n(t1,[{key:"devicePixelRatio",get:function(){return a$.devicePixelRatio}},{key:"windowSize",get:function(){return a$.windowSize},set:function(g){a$.windowSize=g}},{key:"resolution",get:function(){return a$.resolution}},{key:"supportsFullScreen",get:function(){return a$.supportFullScreen}}]),t1}(),a1=g("bX",new a0);X.screen=a1;var a3=g("bY",{Feature:aB,hasFeature:function(g){return aD.hasFeature(g)},NetworkType:aR,Language:ab,OS:aw,Platform:aI,BrowserType:ax,isNative:aD.isNative,isBrowser:aD.isBrowser,isMobile:aD.isMobile,isLittleEndian:aD.isLittleEndian,platform:aD.platform,language:aD.language,languageCode:aD.nativeLanguage,os:aD.os,osVersion:aD.osVersion,osMainVersion:aD.osMainVersion,browserType:aD.browserType,browserVersion:aD.browserVersion,isXR:aD.isXR,windowPixelResolution:a1.windowSize,capabilities:{canvas:!0,opengl:!0,webp:aD.hasFeature(aB.WEBP),imageBitmap:aD.hasFeature(aB.IMAGE_BITMAP),touches:aD.hasFeature(aB.INPUT_TOUCH),mouse:aD.hasFeature(aB.EVENT_MOUSE),keyboard:aD.hasFeature(aB.EVENT_KEYBOARD),accelerometer:aD.hasFeature(aB.EVENT_ACCELEROMETER)},localStorage:{},getNetworkType:function(){return aD.networkType},getBatteryLevel:function(){return aD.getBatteryLevel()},garbageCollect:function(){aD.triggerGC()},isObjectValid:function(g){return null!=g},__isWebIOS14OrIPadOS14Env:!1,dump:function(){var g="";g+="isMobile : "+this.isMobile+"\r\n",g+="language : "+this.language+"\r\n",g+="browserType : "+this.browserType+"\r\n",g+="browserVersion : "+this.browserVersion+"\r\n",g+="supports webp: "+a3.hasFeature(aB.WEBP)+"\r\n",g+="supports bitmap: "+a3.hasFeature(aB.IMAGE_BITMAP)+"\r\n",g+="supports touches: "+a3.hasFeature(aB.INPUT_TOUCH)+"\r\n",g+="supports mouse: "+a3.hasFeature(aB.EVENT_MOUSE)+"\r\n",g+="supports keyboard: "+a3.hasFeature(aB.EVENT_KEYBOARD)+"\r\n",g+="supports accelerometer: "+a3.hasFeature(aB.EVENT_ACCELEROMETER)+"\r\n",g+="os : "+this.os+"\r\n",g+="osVersion : "+this.osVersion+"\r\n",g+="platform : "+this.platform+"\r\n",N(g+="Using "+(X.game.renderType===X.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(g){aD.openURL(g)},init:function(){var g=this;return Promise.resolve().then(function(){return aD.init()}).then(function(){try{var v=a3.localStorage=window.localStorage;v.setItem("storage",""),v.removeItem("storage"),v=null}catch(v){var i=function(){q(5200)};g.localStorage={getItem:i,setItem:i,clear:i,removeItem:i,key:i,length:0}}g.__isWebIOS14OrIPadOS14Env=(a3.os===aw.IOS||a3.os===aw.OSX)&&aD.isBrowser&&/(OS 14)|(Version\/14)/.test(window.navigator.userAgent)})},now:function(){return aD.now()},restartVM:function(){aD.restartJSVM()},getSafeAreaRect:function(){var g=X.view,v=a$.safeAreaEdge,S=a$.windowSize,O=new e8(v.left,v.bottom),Y=new e8(S.width-v.right,S.height-v.top);g._convertToUISpace(O),g._convertToUISpace(Y);var te=O.x,ti=O.y,tr=Y.x-O.x,ta=Y.y-O.y;return new ic(te,ti,tr,ta)}});X.sys=a3;var a4=g("b_",{topLeft:X.v2(0,0),topRight:X.v2(0,0),top:X.v2(0,0),bottomLeft:X.v2(0,0),bottomRight:X.v2(0,0),bottom:X.v2(0,0),center:X.v2(0,0),left:X.v2(0,0),right:X.v2(0,0),width:0,height:0,init:function(g){var v=this.width=g.width,S=this.height=g.height,O=g.x,X=g.y,Y=X+S,te=O+v;this.topLeft.x=O,this.topLeft.y=Y,this.topRight.x=te,this.topRight.y=Y,this.top.x=O+v/2,this.top.y=Y,this.bottomLeft.x=O,this.bottomLeft.y=X,this.bottomRight.x=te,this.bottomRight.y=X,this.bottom.x=O+v/2,this.bottom.y=X,this.center.x=O+v/2,this.center.y=X+S/2,this.left.x=O,this.left.y=X+S/2,this.right.x=te,this.right.y=X+S/2}});X.visibleRect=a4;var a8=g("cc",function(){function t1(){this._id="",this._priority=0,this._executeInEditMode=!1}t1.sortByPriority=function(g,v){return g._priority<v._priority?1:g._priority>v.priority?-1:0};var g=t1.prototype;return g.init=function(){},g.update=function(){},g.postUpdate=function(){},g.destroy=function(){},n(t1,[{key:"priority",get:function(){return this._priority},set:function(g){this._priority=g}},{key:"id",get:function(){return this._id},set:function(g){this._id=g}}]),t1}());a8.Priority=re({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:0x80000000});var a6=new tT("Scheduler"),a7=function(){function t1(g,v,S,O){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=g,this.priority=v,this.paused=S,this.markedForDeletion=O}return t1.get=function(g,v,S,O){var X=t1._listEntries.pop();return X?(X.target=g,X.priority=v,X.paused=S,X.markedForDeletion=O):X=new t1(g,v,S,O),X},t1.put=function(g){t1._listEntries.length<20&&(g.target=null,t1._listEntries.push(g))},t1}();a7._listEntries=[];var on=function(){function t1(g,v,S,O){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=g,this.entry=v,this.target=S,this.callback=O}return t1.get=function(g,v,S,O){var X=t1._hashUpdateEntries.pop();return X?(X.list=g,X.entry=v,X.target=S,X.callback=O):X=new t1(g,v,S,O),X},t1.put=function(g){t1._hashUpdateEntries.length<20&&(g.list=g.entry=g.target=g.callback=null,t1._hashUpdateEntries.push(g))},t1}();on._hashUpdateEntries=[];var os=function(){function t1(g,v,S,O,X,Y){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=g,this.target=v,this.timerIndex=S,this.currentTimer=O,this.currentTimerSalvaged=X,this.paused=Y}return t1.get=function(g,v,S,O,X,Y){var te=t1._hashTimerEntries.pop();return te?(te.timers=g,te.target=v,te.timerIndex=S,te.currentTimer=O,te.currentTimerSalvaged=X,te.paused=Y):te=new t1(g,v,S,O,X,Y),te},t1.put=function(g){t1._hashTimerEntries.length<20&&(g.timers=g.target=g.currentTimer=null,t1._hashTimerEntries.push(g))},t1}();os._hashTimerEntries=[];var oa=function(){function t1(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null}t1.get=function(){return t1._timers.pop()||new t1},t1.put=function(g){t1._timers.length<20&&!g._lock&&(g._scheduler=g._target=g._callback=null,t1._timers.push(g))};var g=t1.prototype;return g.initWithCallback=function(g,v,S,O,Y,te){return this._lock=!1,this._scheduler=g,this._target=S,this._callback=v,this._timesExecuted=0,this._elapsed=-1,this._interval=O,this._delay=te,this._useDelay=this._delay>0,this._repeat=Y,this._runForever=this._repeat===X.macro.REPEAT_FOREVER,!0},g.getInterval=function(){return this._interval},g.setInterval=function(g){this._interval=g},g.update=function(g){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=g,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},g.getCallback=function(){return this._callback},g.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},g.cancel=function(){this._scheduler&&this._callback&&this._target&&this._scheduler.unscheduleForTimer(this,this._target)},t1}();oa._timers=[];var ou=g("b$",function(g){function e(){var v;return(v=g.call(this)||this)._timeScale=void 0,v._updatesNegList=void 0,v._updates0List=void 0,v._updatesPosList=void 0,v._hashForUpdates=void 0,v._hashForTimers=void 0,v._currentTarget=void 0,v._currentTargetSalvaged=void 0,v._updateHashLocked=void 0,v._arrayForTimers=void 0,v._timeScale=1,v._updatesNegList=[],v._updates0List=[],v._updatesPosList=[],v._hashForUpdates=gt(!0),v._hashForTimers=gt(!0),v._currentTarget=null,v._currentTargetSalvaged=!1,v._updateHashLocked=!1,v._arrayForTimers=[],v}s(e,g),e.enableForTarget=function(g){var v=!1;(g.uuid||g.id)&&(v=!0),v||(g.id=a6.getNewId())};var v=e.prototype;return v.setTimeScale=function(g){this._timeScale=g},v.getTimeScale=function(){return this._timeScale},v.update=function(g){var v,S,O,X,Y;for(this._updateHashLocked=!0,1!==this._timeScale&&(g*=this._timeScale),v=0,O=(S=this._updatesNegList).length;v<O;v++){var te,ti;(X=S[v]).paused||X.markedForDeletion||!X.target||null===(te=(ti=X.target).update)||void 0===te||te.call(ti,g)}for(v=0,O=(S=this._updates0List).length;v<O;v++){var tr,ta;(X=S[v]).paused||X.markedForDeletion||!X.target||null===(tr=(ta=X.target).update)||void 0===tr||tr.call(ta,g)}for(v=0,O=(S=this._updatesPosList).length;v<O;v++){var th,tu;(X=S[v]).paused||X.markedForDeletion||!X.target||null===(th=(tu=X.target).update)||void 0===th||th.call(tu,g)}var tl=this._arrayForTimers;for(v=0;v<tl.length;v++){var tc;if(Y=tl[v],this._currentTarget=Y,this._currentTargetSalvaged=!1,!Y.paused&&Y.timers)for(Y.timerIndex=0;Y.timerIndex<Y.timers.length;++Y.timerIndex)Y.currentTimer=Y.timers[Y.timerIndex],Y.currentTimerSalvaged=!1,Y.currentTimer.update(g),Y.currentTimer=null;this._currentTargetSalvaged&&0===(null===(tc=this._currentTarget.timers)||void 0===tc?void 0:tc.length)&&(this._removeHashElement(this._currentTarget),--v)}for(v=0,S=this._updatesNegList;v<S.length;)(X=S[v]).markedForDeletion?this._removeUpdateFromHash(X):v++;for(v=0,S=this._updates0List;v<S.length;)(X=S[v]).markedForDeletion?this._removeUpdateFromHash(X):v++;for(v=0,S=this._updatesPosList;v<S.length;)(X=S[v]).markedForDeletion?this._removeUpdateFromHash(X):v++;this._updateHashLocked=!1,this._currentTarget=null},v.schedule=function(g,v,S,O,Y,te){var ti,tr,ta,th;"function"!=typeof g?(q(1514),ta=v,th=g):(ta=g,th=v),3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(te=!!O,O=X.macro.REPEAT_FOREVER,Y=0),$(Boolean(th),1502);var tu=th.uuid||th.id;if(tu){var tl,tc,t_=this._hashForTimers[tu];if(t_?t_.paused!==te&&q(1511):(t_=os.get(null,th,0,null,!1,Boolean(te)),this._arrayForTimers.push(t_),this._hashForTimers[tu]=t_),null==t_.timers)t_.timers=[];else for(tc=0;tc<t_.timers.length;++tc)if((tl=t_.timers[tc])&&ta===tl.getCallback())return j(1507,tl.getInterval(),S),void tl.setInterval(S);(tl=oa.get()).initWithCallback(this,ta,th,S,null!==(ti=O)&&void 0!==ti?ti:0,null!==(tr=Y)&&void 0!==tr?tr:0),t_.timers.push(tl),this._currentTarget===t_&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else J(1510)},v.scheduleUpdate=function(g,v,S){var O=g.uuid||g.id;if(O){var X=this._hashForUpdates[O];if(X&&X.entry){if(X.entry.priority===v)return X.entry.markedForDeletion=!1,void(X.entry.paused=S);if(this._updateHashLocked)return j(1506),X.entry.markedForDeletion=!1,void(X.entry.paused=S);this.unscheduleUpdate(g)}var Y,te=a7.get(g,v,S,!1);0===v?(Y=this._updates0List,this._appendIn(Y,te)):(Y=v<0?this._updatesNegList:this._updatesPosList,this._priorityIn(Y,te,v)),this._hashForUpdates[O]=on.get(Y,te,g,null)}else J(1510)},v.unschedule=function(g,v){if(v&&g){var S=v.uuid||v.id;if(S){var O=this._hashForTimers[S];if(O){var X=O.timers;if(!X)return;for(var Y=0,te=X.length;Y<te;Y++){var ti=X[Y];if(g===ti.getCallback())return ti!==O.currentTimer||O.currentTimerSalvaged||(O.currentTimerSalvaged=!0),X.splice(Y,1),oa.put(ti),O.timerIndex>=Y&&O.timerIndex--,void(0===X.length&&(this._currentTarget===O?this._currentTargetSalvaged=!0:this._removeHashElement(O)))}}}else J(1510)}},v.unscheduleForTimer=function(g,v){var S=v.uuid||v.id,O=this._hashForTimers[S].timers;if(O){for(var X=0,Y=O.length;X<Y;X++)if(O[X]===g)return O.splice(X,1),void(0===O.length&&(this._currentTargetSalvaged=!0))}},v.unscheduleUpdate=function(g){if(g){var v=g.uuid||g.id;if(v){var S=this._hashForUpdates[v];null!=S&&S.entry&&(this._updateHashLocked?S.entry.markedForDeletion=!0:this._removeUpdateFromHash(S.entry))}else J(1510)}},v.unscheduleAllForTarget=function(g){if(g){var v=g.uuid||g.id;if(v){var S=this._hashForTimers[v];if(null!=S&&S.timers){var O=S.timers;S.currentTimer&&O.indexOf(S.currentTimer)>-1&&!S.currentTimerSalvaged&&(S.currentTimerSalvaged=!0);for(var X=0,Y=O.length;X<Y;X++)oa.put(O[X]);O.length=0,this._currentTarget===S?this._currentTargetSalvaged=!0:this._removeHashElement(S)}this.unscheduleUpdate(g)}else J(1510)}},v.unscheduleAll=function(){this.unscheduleAllWithMinPriority(a8.Priority.SCHEDULER)},v.unscheduleAllWithMinPriority=function(g){var v,S,O,X=this._arrayForTimers;for(v=X.length-1;v>=0;v--)(S=X[v]).target&&this.unscheduleAllForTarget(S.target);var Y=0;if(g<0)for(v=0;v<this._updatesNegList.length;){var te;Y=this._updatesNegList.length,null!==(te=O=this._updatesNegList[v])&&void 0!==te&&te.target&&O.priority>=g&&this.unscheduleUpdate(O.target),Y===this._updatesNegList.length&&v++}if(g<=0)for(v=0;v<this._updates0List.length;){var ti;Y=this._updates0List.length,null!==(ti=O=this._updates0List[v])&&void 0!==ti&&ti.target&&this.unscheduleUpdate(O.target),Y===this._updates0List.length&&v++}for(v=0;v<this._updatesPosList.length;){var tr;Y=this._updatesPosList.length,null!==(tr=O=this._updatesPosList[v])&&void 0!==tr&&tr.target&&O.priority>=g&&this.unscheduleUpdate(O.target),Y===this._updatesPosList.length&&v++}},v.isScheduled=function(g,v){$(Boolean(g),1508),$(Boolean(v),1509);var S=v.uuid||v.id;if(!S)return J(1510),!1;var O=this._hashForTimers[S];if(!O)return!1;if(null==O.timers)return!1;for(var X=O.timers,Y=0;Y<X.length;++Y)if(g===X[Y].getCallback())return!0;return!1},v.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(a8.Priority.SCHEDULER)},v.pauseAllTargetsWithMinPriority=function(g){var v,S,O,X,Y=[],te=this._arrayForTimers;for(S=0,O=te.length;S<O;S++){var ti;null!==(ti=v=te[S])&&void 0!==ti&&ti.target&&(v.paused=!0,Y.push(v.target))}if(g<0)for(S=0;S<this._updatesNegList.length;S++){var tr;null!==(tr=X=this._updatesNegList[S])&&void 0!==tr&&tr.target&&X.priority>=g&&(X.paused=!0,Y.push(X.target))}if(g<=0)for(S=0;S<this._updates0List.length;S++){var ta;null!==(ta=X=this._updates0List[S])&&void 0!==ta&&ta.target&&(X.paused=!0,Y.push(X.target))}for(S=0;S<this._updatesPosList.length;S++){var th;null!==(th=X=this._updatesPosList[S])&&void 0!==th&&th.target&&X.priority>=g&&(X.paused=!0,Y.push(X.target))}return Y},v.resumeTargets=function(g){if(g)for(var v=0;v<g.length;v++)this.resumeTarget(g[v])},v.pauseTarget=function(g){$(Boolean(g),1503);var v=g.uuid||g.id;if(v){var S=this._hashForTimers[v];S&&(S.paused=!0);var O=this._hashForUpdates[v];null!=O&&O.entry&&(O.entry.paused=!0)}else J(1510)},v.resumeTarget=function(g){$(Boolean(g),1504);var v=g.uuid||g.id;if(v){var S=this._hashForTimers[v];S&&(S.paused=!1);var O=this._hashForUpdates[v];null!=O&&O.entry&&(O.entry.paused=!1)}else J(1510)},v.isTargetPaused=function(g){$(Boolean(g),1505);var v=g.uuid||g.id;if(!v)return J(1510),!1;var S=this._hashForTimers[v];if(S)return S.paused;var O=this._hashForUpdates[v];return!(null==O||!O.entry)&&O.entry.paused},v._removeHashElement=function(g){if(g.target){var v=g.target.uuid||g.target.id;if(void 0!==v){delete this._hashForTimers[v];for(var S=this._arrayForTimers,O=0,X=S.length;O<X;O++)if(S[O]===g){S.splice(O,1);break}os.put(g)}}},v._removeUpdateFromHash=function(g){if(g.target){var v=g.target.uuid||g.target.id;if(void 0!==v){var S=this._hashForUpdates[v];if(S){var O=S.list,X=S.entry;if(O){for(var Y=0,te=O.length;Y<te;Y++)if(O[Y]===X){O.splice(Y,1);break}}delete this._hashForUpdates[v],X&&a7.put(X),on.put(S)}}}},v._priorityIn=function(g,v,S){for(var O=0;O<g.length;O++)if(S<g[O].priority)return void g.splice(O,0,v);g.push(v)},v._appendIn=function(g,v){g.push(v)},e}(a8));ou.ID="scheduler",X.Scheduler=ou;var ol=String.prototype.charCodeAt;function yl(g){return this[g]}function Sl(g,v){for(var S=g.length,O=v^S,X=0,Y="string"==typeof g?ol:yl;S>=4;){var te=255&Y.call(g,X)|(255&Y.call(g,++X))<<8|(255&Y.call(g,++X))<<16|(255&Y.call(g,++X))<<24;te=0x5bd1e995*(65535&te)+((0x5bd1e995*(te>>>16)&65535)<<16),O=0x5bd1e995*(65535&O)+((0x5bd1e995*(O>>>16)&65535)<<16)^(te=0x5bd1e995*(65535&(te^=te>>>24))+((0x5bd1e995*(te>>>16)&65535)<<16)),S-=4,++X}switch(S){case 3:O^=(255&Y.call(g,X+2))<<16;case 2:O^=(255&Y.call(g,X+1))<<8;case 1:O=0x5bd1e995*(65535&(O^=255&Y.call(g,X)))+((0x5bd1e995*(O>>>16)&65535)<<16)}return O=0x5bd1e995*(65535&(O^=O>>>13))+((0x5bd1e995*(O>>>16)&65535)<<16),(O^=O>>>15)>>>0}function Al(){}X.easing=r2,Al.prototype.once=function(g,v,S){return this.on(g,v,S,!0)},Al.prototype.targetOff=function(g){this.removeAll(g)},g("ch",Object.freeze({__proto__:null,syncNodeValues:function(g){var v=g._lpos;g.setPositionForJS(v.x,v.y,v.z);var S=g._lscale;g.setScaleForJS(S.x,S.y,S.z);var O=g._lrot;g.setRotationForJS(O.x,O.y,O.z,O.w);var X=g._euler;g.setRotationFromEulerForJS(X.x,X.y,X.z)},updateChildrenForDeserialize:function t1(g){if(g){var v=g.children;if(v){var S=v.length;if(S){g._setChildren(v);for(var O=0;O<S;++O)t1(v[O])}}}},ExtraEventMethods:Al}));var oc=function(){function t1(){this._finalizationRegistry=null,this._gcObjects=new WeakMap}var g=t1.prototype;return g.registerGCObject=function(g){return g},g.init=function(){},g.finalizationRegistryCallback=function(g){var v=this._gcObjects.get(g);v&&(this._gcObjects.delete(g),v.destroy()),this._finalizationRegistry.unregister(g)},g.destroy=function(){},t1}(),o_=g("cv",new oc),of=g("cw",function(){function t1(){return o_.registerGCObject(this)}return t1.prototype.destroy=function(){},t1}());function bl(g,v){for(var S,O=f(v);!(S=O()).done;){var X=S.value;Array.isArray(X)?bl(g,X):g.push(X)}}function xl(g){var v=[];return bl(v,g),v.join("")}X.math=ip,X.geometry=ac;var od,op,om,og,oS,oA,oT,oE,oC,ox,ob,oR,ow,oI,oB,oP,oD,oM,oO,oL,oF,oN,ok,oG,oV,oU,oH,oz,oW,oX,oq,oY,oJ,oZ,o$,o0,o1,o2,o4,o8,o6,o7,ht,he,gc=function(g,v,S){for(var O=0;O<v.length;++O)g.length<=O&&g.push(new S),g[O].copy(v[O]);g.length=v.length};!function(g){g[g.UNKNOWN=0]="UNKNOWN",g[g.SWAPCHAIN=1]="SWAPCHAIN",g[g.BUFFER=2]="BUFFER",g[g.TEXTURE=3]="TEXTURE",g[g.RENDER_PASS=4]="RENDER_PASS",g[g.FRAMEBUFFER=5]="FRAMEBUFFER",g[g.SAMPLER=6]="SAMPLER",g[g.SHADER=7]="SHADER",g[g.DESCRIPTOR_SET_LAYOUT=8]="DESCRIPTOR_SET_LAYOUT",g[g.PIPELINE_LAYOUT=9]="PIPELINE_LAYOUT",g[g.PIPELINE_STATE=10]="PIPELINE_STATE",g[g.DESCRIPTOR_SET=11]="DESCRIPTOR_SET",g[g.INPUT_ASSEMBLER=12]="INPUT_ASSEMBLER",g[g.COMMAND_BUFFER=13]="COMMAND_BUFFER",g[g.QUEUE=14]="QUEUE",g[g.QUERY_POOL=15]="QUERY_POOL",g[g.GLOBAL_BARRIER=16]="GLOBAL_BARRIER",g[g.TEXTURE_BARRIER=17]="TEXTURE_BARRIER",g[g.BUFFER_BARRIER=18]="BUFFER_BARRIER",g[g.COUNT=19]="COUNT"}(od||(od={})),function(g){g[g.UNREADY=0]="UNREADY",g[g.FAILED=1]="FAILED",g[g.SUCCESS=2]="SUCCESS"}(op||(op={})),function(g){g[g.UNKNOWN=0]="UNKNOWN",g[g.GLES2=1]="GLES2",g[g.GLES3=2]="GLES3",g[g.METAL=3]="METAL",g[g.VULKAN=4]="VULKAN",g[g.NVN=5]="NVN",g[g.WEBGL=6]="WEBGL",g[g.WEBGL2=7]="WEBGL2",g[g.WEBGPU=8]="WEBGPU"}(om||(om={})),function(g){g[g.IDENTITY=0]="IDENTITY",g[g.ROTATE_90=1]="ROTATE_90",g[g.ROTATE_180=2]="ROTATE_180",g[g.ROTATE_270=3]="ROTATE_270"}(og||(og={})),function(g){g[g.ELEMENT_INDEX_UINT=0]="ELEMENT_INDEX_UINT",g[g.INSTANCED_ARRAYS=1]="INSTANCED_ARRAYS",g[g.MULTIPLE_RENDER_TARGETS=2]="MULTIPLE_RENDER_TARGETS",g[g.BLEND_MINMAX=3]="BLEND_MINMAX",g[g.COMPUTE_SHADER=4]="COMPUTE_SHADER",g[g.INPUT_ATTACHMENT_BENEFIT=5]="INPUT_ATTACHMENT_BENEFIT",g[g.SUBPASS_COLOR_INPUT=6]="SUBPASS_COLOR_INPUT",g[g.SUBPASS_DEPTH_STENCIL_INPUT=7]="SUBPASS_DEPTH_STENCIL_INPUT",g[g.RASTERIZATION_ORDER_COHERENT=8]="RASTERIZATION_ORDER_COHERENT",g[g.MULTI_SAMPLE_RESOLVE_DEPTH_STENCIL=9]="MULTI_SAMPLE_RESOLVE_DEPTH_STENCIL",g[g.COUNT=10]="COUNT"}(oS||(oS={})),function(g){g[g.UNKNOWN=0]="UNKNOWN",g[g.A8=1]="A8",g[g.L8=2]="L8",g[g.LA8=3]="LA8",g[g.R8=4]="R8",g[g.R8SN=5]="R8SN",g[g.R8UI=6]="R8UI",g[g.R8I=7]="R8I",g[g.R16F=8]="R16F",g[g.R16UI=9]="R16UI",g[g.R16I=10]="R16I",g[g.R32F=11]="R32F",g[g.R32UI=12]="R32UI",g[g.R32I=13]="R32I",g[g.RG8=14]="RG8",g[g.RG8SN=15]="RG8SN",g[g.RG8UI=16]="RG8UI",g[g.RG8I=17]="RG8I",g[g.RG16F=18]="RG16F",g[g.RG16UI=19]="RG16UI",g[g.RG16I=20]="RG16I",g[g.RG32F=21]="RG32F",g[g.RG32UI=22]="RG32UI",g[g.RG32I=23]="RG32I",g[g.RGB8=24]="RGB8",g[g.SRGB8=25]="SRGB8",g[g.RGB8SN=26]="RGB8SN",g[g.RGB8UI=27]="RGB8UI",g[g.RGB8I=28]="RGB8I",g[g.RGB16F=29]="RGB16F",g[g.RGB16UI=30]="RGB16UI",g[g.RGB16I=31]="RGB16I",g[g.RGB32F=32]="RGB32F",g[g.RGB32UI=33]="RGB32UI",g[g.RGB32I=34]="RGB32I",g[g.RGBA8=35]="RGBA8",g[g.BGRA8=36]="BGRA8",g[g.SRGB8_A8=37]="SRGB8_A8",g[g.RGBA8SN=38]="RGBA8SN",g[g.RGBA8UI=39]="RGBA8UI",g[g.RGBA8I=40]="RGBA8I",g[g.RGBA16F=41]="RGBA16F",g[g.RGBA16UI=42]="RGBA16UI",g[g.RGBA16I=43]="RGBA16I",g[g.RGBA32F=44]="RGBA32F",g[g.RGBA32UI=45]="RGBA32UI",g[g.RGBA32I=46]="RGBA32I",g[g.R5G6B5=47]="R5G6B5",g[g.R11G11B10F=48]="R11G11B10F",g[g.RGB5A1=49]="RGB5A1",g[g.RGBA4=50]="RGBA4",g[g.RGB10A2=51]="RGB10A2",g[g.RGB10A2UI=52]="RGB10A2UI",g[g.RGB9E5=53]="RGB9E5",g[g.DEPTH=54]="DEPTH",g[g.DEPTH_STENCIL=55]="DEPTH_STENCIL",g[g.BC1=56]="BC1",g[g.BC1_ALPHA=57]="BC1_ALPHA",g[g.BC1_SRGB=58]="BC1_SRGB",g[g.BC1_SRGB_ALPHA=59]="BC1_SRGB_ALPHA",g[g.BC2=60]="BC2",g[g.BC2_SRGB=61]="BC2_SRGB",g[g.BC3=62]="BC3",g[g.BC3_SRGB=63]="BC3_SRGB",g[g.BC4=64]="BC4",g[g.BC4_SNORM=65]="BC4_SNORM",g[g.BC5=66]="BC5",g[g.BC5_SNORM=67]="BC5_SNORM",g[g.BC6H_UF16=68]="BC6H_UF16",g[g.BC6H_SF16=69]="BC6H_SF16",g[g.BC7=70]="BC7",g[g.BC7_SRGB=71]="BC7_SRGB",g[g.ETC_RGB8=72]="ETC_RGB8",g[g.ETC2_RGB8=73]="ETC2_RGB8",g[g.ETC2_SRGB8=74]="ETC2_SRGB8",g[g.ETC2_RGB8_A1=75]="ETC2_RGB8_A1",g[g.ETC2_SRGB8_A1=76]="ETC2_SRGB8_A1",g[g.ETC2_RGBA8=77]="ETC2_RGBA8",g[g.ETC2_SRGB8_A8=78]="ETC2_SRGB8_A8",g[g.EAC_R11=79]="EAC_R11",g[g.EAC_R11SN=80]="EAC_R11SN",g[g.EAC_RG11=81]="EAC_RG11",g[g.EAC_RG11SN=82]="EAC_RG11SN",g[g.PVRTC_RGB2=83]="PVRTC_RGB2",g[g.PVRTC_RGBA2=84]="PVRTC_RGBA2",g[g.PVRTC_RGB4=85]="PVRTC_RGB4",g[g.PVRTC_RGBA4=86]="PVRTC_RGBA4",g[g.PVRTC2_2BPP=87]="PVRTC2_2BPP",g[g.PVRTC2_4BPP=88]="PVRTC2_4BPP",g[g.ASTC_RGBA_4X4=89]="ASTC_RGBA_4X4",g[g.ASTC_RGBA_5X4=90]="ASTC_RGBA_5X4",g[g.ASTC_RGBA_5X5=91]="ASTC_RGBA_5X5",g[g.ASTC_RGBA_6X5=92]="ASTC_RGBA_6X5",g[g.ASTC_RGBA_6X6=93]="ASTC_RGBA_6X6",g[g.ASTC_RGBA_8X5=94]="ASTC_RGBA_8X5",g[g.ASTC_RGBA_8X6=95]="ASTC_RGBA_8X6",g[g.ASTC_RGBA_8X8=96]="ASTC_RGBA_8X8",g[g.ASTC_RGBA_10X5=97]="ASTC_RGBA_10X5",g[g.ASTC_RGBA_10X6=98]="ASTC_RGBA_10X6",g[g.ASTC_RGBA_10X8=99]="ASTC_RGBA_10X8",g[g.ASTC_RGBA_10X10=100]="ASTC_RGBA_10X10",g[g.ASTC_RGBA_12X10=101]="ASTC_RGBA_12X10",g[g.ASTC_RGBA_12X12=102]="ASTC_RGBA_12X12",g[g.ASTC_SRGBA_4X4=103]="ASTC_SRGBA_4X4",g[g.ASTC_SRGBA_5X4=104]="ASTC_SRGBA_5X4",g[g.ASTC_SRGBA_5X5=105]="ASTC_SRGBA_5X5",g[g.ASTC_SRGBA_6X5=106]="ASTC_SRGBA_6X5",g[g.ASTC_SRGBA_6X6=107]="ASTC_SRGBA_6X6",g[g.ASTC_SRGBA_8X5=108]="ASTC_SRGBA_8X5",g[g.ASTC_SRGBA_8X6=109]="ASTC_SRGBA_8X6",g[g.ASTC_SRGBA_8X8=110]="ASTC_SRGBA_8X8",g[g.ASTC_SRGBA_10X5=111]="ASTC_SRGBA_10X5",g[g.ASTC_SRGBA_10X6=112]="ASTC_SRGBA_10X6",g[g.ASTC_SRGBA_10X8=113]="ASTC_SRGBA_10X8",g[g.ASTC_SRGBA_10X10=114]="ASTC_SRGBA_10X10",g[g.ASTC_SRGBA_12X10=115]="ASTC_SRGBA_12X10",g[g.ASTC_SRGBA_12X12=116]="ASTC_SRGBA_12X12",g[g.COUNT=117]="COUNT"}(oA||(oA={})),function(g){g[g.NONE=0]="NONE",g[g.UNORM=1]="UNORM",g[g.SNORM=2]="SNORM",g[g.UINT=3]="UINT",g[g.INT=4]="INT",g[g.UFLOAT=5]="UFLOAT",g[g.FLOAT=6]="FLOAT"}(oT||(oT={})),function(g){g[g.UNKNOWN=0]="UNKNOWN",g[g.BOOL=1]="BOOL",g[g.BOOL2=2]="BOOL2",g[g.BOOL3=3]="BOOL3",g[g.BOOL4=4]="BOOL4",g[g.INT=5]="INT",g[g.INT2=6]="INT2",g[g.INT3=7]="INT3",g[g.INT4=8]="INT4",g[g.UINT=9]="UINT",g[g.UINT2=10]="UINT2",g[g.UINT3=11]="UINT3",g[g.UINT4=12]="UINT4",g[g.FLOAT=13]="FLOAT",g[g.FLOAT2=14]="FLOAT2",g[g.FLOAT3=15]="FLOAT3",g[g.FLOAT4=16]="FLOAT4",g[g.MAT2=17]="MAT2",g[g.MAT2X3=18]="MAT2X3",g[g.MAT2X4=19]="MAT2X4",g[g.MAT3X2=20]="MAT3X2",g[g.MAT3=21]="MAT3",g[g.MAT3X4=22]="MAT3X4",g[g.MAT4X2=23]="MAT4X2",g[g.MAT4X3=24]="MAT4X3",g[g.MAT4=25]="MAT4",g[g.SAMPLER1D=26]="SAMPLER1D",g[g.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",g[g.SAMPLER2D=28]="SAMPLER2D",g[g.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",g[g.SAMPLER3D=30]="SAMPLER3D",g[g.SAMPLER_CUBE=31]="SAMPLER_CUBE",g[g.SAMPLER=32]="SAMPLER",g[g.TEXTURE1D=33]="TEXTURE1D",g[g.TEXTURE1D_ARRAY=34]="TEXTURE1D_ARRAY",g[g.TEXTURE2D=35]="TEXTURE2D",g[g.TEXTURE2D_ARRAY=36]="TEXTURE2D_ARRAY",g[g.TEXTURE3D=37]="TEXTURE3D",g[g.TEXTURE_CUBE=38]="TEXTURE_CUBE",g[g.IMAGE1D=39]="IMAGE1D",g[g.IMAGE1D_ARRAY=40]="IMAGE1D_ARRAY",g[g.IMAGE2D=41]="IMAGE2D",g[g.IMAGE2D_ARRAY=42]="IMAGE2D_ARRAY",g[g.IMAGE3D=43]="IMAGE3D",g[g.IMAGE_CUBE=44]="IMAGE_CUBE",g[g.SUBPASS_INPUT=45]="SUBPASS_INPUT",g[g.COUNT=46]="COUNT"}(oE||(oE={})),function(g){g[g.NONE=0]="NONE",g[g.TRANSFER_SRC=1]="TRANSFER_SRC",g[g.TRANSFER_DST=2]="TRANSFER_DST",g[g.INDEX=4]="INDEX",g[g.VERTEX=8]="VERTEX",g[g.UNIFORM=16]="UNIFORM",g[g.STORAGE=32]="STORAGE",g[g.INDIRECT=64]="INDIRECT"}(oC||(oC={})),function(g){g[g.NONE=0]="NONE"}(ox||(ox={})),function(g){g[g.NONE=0]="NONE",g[g.READ_ONLY=1]="READ_ONLY",g[g.WRITE_ONLY=2]="WRITE_ONLY",g[g.READ_WRITE=3]="READ_WRITE"}(ob||(ob={})),function(g){g[g.NONE=0]="NONE",g[g.DEVICE=1]="DEVICE",g[g.HOST=2]="HOST"}(oR||(oR={})),function(g){g[g.TEX1D=0]="TEX1D",g[g.TEX2D=1]="TEX2D",g[g.TEX3D=2]="TEX3D",g[g.CUBE=3]="CUBE",g[g.TEX1D_ARRAY=4]="TEX1D_ARRAY",g[g.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(ow||(ow={})),function(g){g[g.NONE=0]="NONE",g[g.TRANSFER_SRC=1]="TRANSFER_SRC",g[g.TRANSFER_DST=2]="TRANSFER_DST",g[g.SAMPLED=4]="SAMPLED",g[g.STORAGE=8]="STORAGE",g[g.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",g[g.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",g[g.INPUT_ATTACHMENT=64]="INPUT_ATTACHMENT"}(oI||(oI={})),function(g){g[g.NONE=0]="NONE",g[g.GEN_MIPMAP=1]="GEN_MIPMAP",g[g.GENERAL_LAYOUT=2]="GENERAL_LAYOUT",g[g.EXTERNAL_OES=4]="EXTERNAL_OES",g[g.EXTERNAL_NORMAL=8]="EXTERNAL_NORMAL",g[g.LAZILY_ALLOCATED=16]="LAZILY_ALLOCATED",g[g.MUTABLE_VIEW_FORMAT=64]="MUTABLE_VIEW_FORMAT",g[g.MUTABLE_STORAGE=128]="MUTABLE_STORAGE"}(oB||(oB={})),function(g){g[g.NONE=0]="NONE",g[g.RENDER_TARGET=1]="RENDER_TARGET",g[g.SAMPLED_TEXTURE=2]="SAMPLED_TEXTURE",g[g.LINEAR_FILTER=4]="LINEAR_FILTER",g[g.STORAGE_TEXTURE=8]="STORAGE_TEXTURE",g[g.VERTEX_ATTRIBUTE=16]="VERTEX_ATTRIBUTE"}(oP||(oP={})),function(g){g[g.X1=1]="X1",g[g.X2=2]="X2",g[g.X4=4]="X4",g[g.X8=8]="X8",g[g.X16=16]="X16",g[g.X32=32]="X32",g[g.X64=64]="X64"}(oD||(oD={})),function(g){g[g.OFF=0]="OFF",g[g.ON=1]="ON",g[g.RELAXED=2]="RELAXED",g[g.MAILBOX=3]="MAILBOX",g[g.HALF=4]="HALF"}(oM||(oM={})),function(g){g[g.NONE=0]="NONE",g[g.POINT=1]="POINT",g[g.LINEAR=2]="LINEAR",g[g.ANISOTROPIC=3]="ANISOTROPIC"}(oO||(oO={})),function(g){g[g.WRAP=0]="WRAP",g[g.MIRROR=1]="MIRROR",g[g.CLAMP=2]="CLAMP",g[g.BORDER=3]="BORDER"}(oL||(oL={})),function(g){g[g.NEVER=0]="NEVER",g[g.LESS=1]="LESS",g[g.EQUAL=2]="EQUAL",g[g.LESS_EQUAL=3]="LESS_EQUAL",g[g.GREATER=4]="GREATER",g[g.NOT_EQUAL=5]="NOT_EQUAL",g[g.GREATER_EQUAL=6]="GREATER_EQUAL",g[g.ALWAYS=7]="ALWAYS"}(oF||(oF={})),function(g){g[g.ZERO=0]="ZERO",g[g.KEEP=1]="KEEP",g[g.REPLACE=2]="REPLACE",g[g.INCR=3]="INCR",g[g.DECR=4]="DECR",g[g.INVERT=5]="INVERT",g[g.INCR_WRAP=6]="INCR_WRAP",g[g.DECR_WRAP=7]="DECR_WRAP"}(oN||(oN={})),function(g){g[g.ZERO=0]="ZERO",g[g.ONE=1]="ONE",g[g.SRC_ALPHA=2]="SRC_ALPHA",g[g.DST_ALPHA=3]="DST_ALPHA",g[g.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",g[g.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",g[g.SRC_COLOR=6]="SRC_COLOR",g[g.DST_COLOR=7]="DST_COLOR",g[g.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",g[g.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",g[g.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",g[g.CONSTANT_COLOR=11]="CONSTANT_COLOR",g[g.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",g[g.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",g[g.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(ok||(ok={})),function(g){g[g.ADD=0]="ADD",g[g.SUB=1]="SUB",g[g.REV_SUB=2]="REV_SUB",g[g.MIN=3]="MIN",g[g.MAX=4]="MAX"}(oG||(oG={})),function(g){g[g.NONE=0]="NONE",g[g.R=1]="R",g[g.G=2]="G",g[g.B=4]="B",g[g.A=8]="A",g[g.ALL=15]="ALL"}(oV||(oV={})),function(g){g[g.NONE=0]="NONE",g[g.VERTEX=1]="VERTEX",g[g.CONTROL=2]="CONTROL",g[g.EVALUATION=4]="EVALUATION",g[g.GEOMETRY=8]="GEOMETRY",g[g.FRAGMENT=16]="FRAGMENT",g[g.COMPUTE=32]="COMPUTE",g[g.ALL=63]="ALL"}(oU||(oU={})),function(g){g[g.LOAD=0]="LOAD",g[g.CLEAR=1]="CLEAR",g[g.DISCARD=2]="DISCARD"}(oH||(oH={})),function(g){g[g.STORE=0]="STORE",g[g.DISCARD=1]="DISCARD"}(oz||(oz={})),function(g){g[g.NONE=0]="NONE",g[g.INDIRECT_BUFFER=1]="INDIRECT_BUFFER",g[g.INDEX_BUFFER=2]="INDEX_BUFFER",g[g.VERTEX_BUFFER=4]="VERTEX_BUFFER",g[g.VERTEX_SHADER_READ_UNIFORM_BUFFER=8]="VERTEX_SHADER_READ_UNIFORM_BUFFER",g[g.VERTEX_SHADER_READ_TEXTURE=16]="VERTEX_SHADER_READ_TEXTURE",g[g.VERTEX_SHADER_READ_OTHER=32]="VERTEX_SHADER_READ_OTHER",g[g.FRAGMENT_SHADER_READ_UNIFORM_BUFFER=64]="FRAGMENT_SHADER_READ_UNIFORM_BUFFER",g[g.FRAGMENT_SHADER_READ_TEXTURE=128]="FRAGMENT_SHADER_READ_TEXTURE",g[g.FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT=256]="FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT",g[g.FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT=512]="FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT",g[g.FRAGMENT_SHADER_READ_OTHER=1024]="FRAGMENT_SHADER_READ_OTHER",g[g.COLOR_ATTACHMENT_READ=2048]="COLOR_ATTACHMENT_READ",g[g.DEPTH_STENCIL_ATTACHMENT_READ=4096]="DEPTH_STENCIL_ATTACHMENT_READ",g[g.COMPUTE_SHADER_READ_UNIFORM_BUFFER=8192]="COMPUTE_SHADER_READ_UNIFORM_BUFFER",g[g.COMPUTE_SHADER_READ_TEXTURE=16384]="COMPUTE_SHADER_READ_TEXTURE",g[g.COMPUTE_SHADER_READ_OTHER=32768]="COMPUTE_SHADER_READ_OTHER",g[g.TRANSFER_READ=65536]="TRANSFER_READ",g[g.HOST_READ=131072]="HOST_READ",g[g.PRESENT=262144]="PRESENT",g[g.VERTEX_SHADER_WRITE=524288]="VERTEX_SHADER_WRITE",g[g.FRAGMENT_SHADER_WRITE=1048576]="FRAGMENT_SHADER_WRITE",g[g.COLOR_ATTACHMENT_WRITE=2097152]="COLOR_ATTACHMENT_WRITE",g[g.DEPTH_STENCIL_ATTACHMENT_WRITE=4194304]="DEPTH_STENCIL_ATTACHMENT_WRITE",g[g.COMPUTE_SHADER_WRITE=8388608]="COMPUTE_SHADER_WRITE",g[g.TRANSFER_WRITE=0x1000000]="TRANSFER_WRITE",g[g.HOST_PREINITIALIZED=0x2000000]="HOST_PREINITIALIZED",g[g.HOST_WRITE=0x4000000]="HOST_WRITE"}(oW||(oW={})),function(g){g[g.NONE=0]="NONE",g[g.SAMPLE_ZERO=1]="SAMPLE_ZERO",g[g.AVERAGE=2]="AVERAGE",g[g.MIN=3]="MIN",g[g.MAX=4]="MAX"}(oX||(oX={})),function(g){g[g.GRAPHICS=0]="GRAPHICS",g[g.COMPUTE=1]="COMPUTE",g[g.RAY_TRACING=2]="RAY_TRACING"}(oq||(oq={})),function(g){g[g.POINT_LIST=0]="POINT_LIST",g[g.LINE_LIST=1]="LINE_LIST",g[g.LINE_STRIP=2]="LINE_STRIP",g[g.LINE_LOOP=3]="LINE_LOOP",g[g.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",g[g.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",g[g.ISO_LINE_LIST=6]="ISO_LINE_LIST",g[g.TRIANGLE_LIST=7]="TRIANGLE_LIST",g[g.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",g[g.TRIANGLE_FAN=9]="TRIANGLE_FAN",g[g.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",g[g.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",g[g.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",g[g.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(oY||(oY={})),function(g){g[g.FILL=0]="FILL",g[g.POINT=1]="POINT",g[g.LINE=2]="LINE"}(oJ||(oJ={})),function(g){g[g.GOURAND=0]="GOURAND",g[g.FLAT=1]="FLAT"}(oZ||(oZ={})),function(g){g[g.NONE=0]="NONE",g[g.FRONT=1]="FRONT",g[g.BACK=2]="BACK"}(o$||(o$={})),function(g){g[g.NONE=0]="NONE",g[g.LINE_WIDTH=1]="LINE_WIDTH",g[g.DEPTH_BIAS=2]="DEPTH_BIAS",g[g.BLEND_CONSTANTS=4]="BLEND_CONSTANTS",g[g.DEPTH_BOUNDS=8]="DEPTH_BOUNDS",g[g.STENCIL_WRITE_MASK=16]="STENCIL_WRITE_MASK",g[g.STENCIL_COMPARE_MASK=32]="STENCIL_COMPARE_MASK"}(o0||(o0={})),function(g){g[g.FRONT=1]="FRONT",g[g.BACK=2]="BACK",g[g.ALL=3]="ALL"}(o1||(o1={})),function(g){g[g.UNKNOWN=0]="UNKNOWN",g[g.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",g[g.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",g[g.STORAGE_BUFFER=4]="STORAGE_BUFFER",g[g.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",g[g.SAMPLER_TEXTURE=16]="SAMPLER_TEXTURE",g[g.SAMPLER=32]="SAMPLER",g[g.TEXTURE=64]="TEXTURE",g[g.STORAGE_IMAGE=128]="STORAGE_IMAGE",g[g.INPUT_ATTACHMENT=256]="INPUT_ATTACHMENT"}(o2||(o2={})),function(g){g[g.GRAPHICS=0]="GRAPHICS",g[g.COMPUTE=1]="COMPUTE",g[g.TRANSFER=2]="TRANSFER"}(o4||(o4={})),function(g){g[g.OCCLUSION=0]="OCCLUSION",g[g.PIPELINE_STATISTICS=1]="PIPELINE_STATISTICS",g[g.TIMESTAMP=2]="TIMESTAMP"}(o8||(o8={})),function(g){g[g.PRIMARY=0]="PRIMARY",g[g.SECONDARY=1]="SECONDARY"}(o6||(o6={})),function(g){g[g.NONE=0]="NONE",g[g.COLOR=1]="COLOR",g[g.DEPTH=2]="DEPTH",g[g.STENCIL=4]="STENCIL",g[g.DEPTH_STENCIL=6]="DEPTH_STENCIL",g[g.ALL=7]="ALL"}(o7||(o7={})),function(g){g[g.FULL=0]="FULL",g[g.SPLIT_BEGIN=1]="SPLIT_BEGIN",g[g.SPLIT_END=2]="SPLIT_END"}(ht||(ht={})),function(g){g[g.RASTER=0]="RASTER",g[g.COMPUTE=1]="COMPUTE",g[g.COPY=2]="COPY",g[g.MOVE=3]="MOVE",g[g.RAYTRACE=4]="RAYTRACE",g[g.PRESENT=5]="PRESENT"}(he||(he={}));var hi,hn=function(){function t1(g,v,S){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),this.x=g,this.y=v,this.z=S}return t1.prototype.copy=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this},t1}(),hr=function(){function t1(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf,tp,tm,tg,tv,ty,tS,tA,tT){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=0),void 0===te&&(te=0),void 0===ti&&(ti=0),void 0===tr&&(tr=0),void 0===ta&&(ta=0),void 0===th&&(th=0),void 0===tu&&(tu=0),void 0===tl&&(tl=0),void 0===tc&&(tc=0),void 0===t_&&(t_=0),void 0===tf&&(tf=1),void 0===tp&&(tp=0),void 0===tm&&(tm=0),void 0===tg&&(tg=new hn),void 0===tv&&(tv=new hn),void 0===ty&&(ty=!1),void 0===tS&&(tS=-1),void 0===tA&&(tA=1),void 0===tT&&(tT=1),this.maxVertexAttributes=g,this.maxVertexUniformVectors=v,this.maxFragmentUniformVectors=S,this.maxTextureUnits=O,this.maxImageUnits=X,this.maxVertexTextureUnits=Y,this.maxColorRenderTargets=te,this.maxShaderStorageBufferBindings=ti,this.maxShaderStorageBlockSize=tr,this.maxUniformBufferBindings=ta,this.maxUniformBlockSize=th,this.maxTextureSize=tu,this.maxCubeMapTextureSize=tl,this.maxArrayTextureLayers=tc,this.max3DTextureSize=t_,this.uboOffsetAlignment=tf,this.maxComputeSharedMemorySize=tp,this.maxComputeWorkGroupInvocations=tm,this.maxComputeWorkGroupSize=tg,this.maxComputeWorkGroupCount=tv,this.supportQuery=ty,this.clipSpaceMinZ=tS,this.screenSpaceSignY=tA,this.clipSpaceSignY=tT}return t1.prototype.copy=function(g){return this.maxVertexAttributes=g.maxVertexAttributes,this.maxVertexUniformVectors=g.maxVertexUniformVectors,this.maxFragmentUniformVectors=g.maxFragmentUniformVectors,this.maxTextureUnits=g.maxTextureUnits,this.maxImageUnits=g.maxImageUnits,this.maxVertexTextureUnits=g.maxVertexTextureUnits,this.maxColorRenderTargets=g.maxColorRenderTargets,this.maxShaderStorageBufferBindings=g.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=g.maxShaderStorageBlockSize,this.maxUniformBufferBindings=g.maxUniformBufferBindings,this.maxUniformBlockSize=g.maxUniformBlockSize,this.maxTextureSize=g.maxTextureSize,this.maxCubeMapTextureSize=g.maxCubeMapTextureSize,this.maxArrayTextureLayers=g.maxArrayTextureLayers,this.max3DTextureSize=g.max3DTextureSize,this.uboOffsetAlignment=g.uboOffsetAlignment,this.maxComputeSharedMemorySize=g.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=g.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(g.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(g.maxComputeWorkGroupCount),this.supportQuery=g.supportQuery,this.clipSpaceMinZ=g.clipSpaceMinZ,this.screenSpaceSignY=g.screenSpaceSignY,this.clipSpaceSignY=g.clipSpaceSignY,this},t1}(),ha=function(){function t1(g){void 0===g&&(g=!0),this.enableBarrierDeduce=g}return t1.prototype.copy=function(g){return this.enableBarrierDeduce=g.enableBarrierDeduce,this},t1}(),hu=function(){function t1(g,v,S){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),this.x=g,this.y=v,this.z=S}return t1.prototype.copy=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this},t1}(),hl=function(){function t1(g,v,S,O){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),this.x=g,this.y=v,this.width=S,this.height=O}return t1.prototype.copy=function(g){return this.x=g.x,this.y=g.y,this.width=g.width,this.height=g.height,this},t1}(),hc=function(){function t1(g,v,S){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=1),this.width=g,this.height=v,this.depth=S}return t1.prototype.copy=function(g){return this.width=g.width,this.height=g.height,this.depth=g.depth,this},t1}(),h_=function(){function t1(g,v,S){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=1),this.mipLevel=g,this.baseArrayLayer=v,this.layerCount=S}return t1.prototype.copy=function(g){return this.mipLevel=g.mipLevel,this.baseArrayLayer=g.baseArrayLayer,this.layerCount=g.layerCount,this},t1}(),hf=function(){function t1(g,v,S,O){void 0===g&&(g=0),void 0===v&&(v=1),void 0===S&&(S=0),void 0===O&&(O=1),this.baseMipLevel=g,this.levelCount=v,this.baseArrayLayer=S,this.layerCount=O}return t1.prototype.copy=function(g){return this.baseMipLevel=g.baseMipLevel,this.levelCount=g.levelCount,this.baseArrayLayer=g.baseArrayLayer,this.layerCount=g.layerCount,this},t1}(),hd=function(){function t1(g,v,S,O,X){void 0===g&&(g=new h_),void 0===v&&(v=new hu),void 0===S&&(S=new h_),void 0===O&&(O=new hu),void 0===X&&(X=new hc),this.srcSubres=g,this.srcOffset=v,this.dstSubres=S,this.dstOffset=O,this.extent=X}return t1.prototype.copy=function(g){return this.srcSubres.copy(g.srcSubres),this.srcOffset.copy(g.srcOffset),this.dstSubres.copy(g.dstSubres),this.dstOffset.copy(g.dstOffset),this.extent.copy(g.extent),this},t1}(),hm=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=new h_),void 0===v&&(v=new hu),void 0===S&&(S=new hc),void 0===O&&(O=new h_),void 0===X&&(X=new hu),void 0===Y&&(Y=new hc),this.srcSubres=g,this.srcOffset=v,this.srcExtent=S,this.dstSubres=O,this.dstOffset=X,this.dstExtent=Y}return t1.prototype.copy=function(g){return this.srcSubres.copy(g.srcSubres),this.srcOffset.copy(g.srcOffset),this.srcExtent.copy(g.srcExtent),this.dstSubres.copy(g.dstSubres),this.dstOffset.copy(g.dstOffset),this.dstExtent.copy(g.dstExtent),this},t1}(),hg=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=new hu),void 0===X&&(X=new hc),void 0===Y&&(Y=new h_),this.buffOffset=g,this.buffStride=v,this.buffTexHeight=S,this.texOffset=O,this.texExtent=X,this.texSubres=Y}return t1.prototype.copy=function(g){return this.buffOffset=g.buffOffset,this.buffStride=g.buffStride,this.buffTexHeight=g.buffTexHeight,this.texOffset.copy(g.texOffset),this.texExtent.copy(g.texExtent),this.texSubres.copy(g.texSubres),this},t1}(),hS=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=1),this.left=g,this.top=v,this.width=S,this.height=O,this.minDepth=X,this.maxDepth=Y}var g=t1.prototype;return g.copy=function(g){return this.left=g.left,this.top=g.top,this.width=g.width,this.height=g.height,this.minDepth=g.minDepth,this.maxDepth=g.maxDepth,this},g.reset=function(){this.left=0,this.top=0,this.width=0,this.height=0,this.minDepth=0,this.maxDepth=1},t1}(),hA=function(){function t1(g,v,S,O){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),this.x=g,this.y=v,this.z=S,this.w=O}var g=t1.prototype;return g.copy=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this.w=g.w,this},g.set=function(g,v,S,O){return this.x=g,this.y=v,this.z=S,this.w=O,this},g.reset=function(){this.x=0,this.y=0,this.z=0,this.w=0},t1}(),hT=function(){function t1(g,v,S,O,X,Y,te,ti){void 0===g&&(g=[0]),void 0===v&&(v=[0]),void 0===S&&(S=[0]),void 0===O&&(O=[0]),void 0===X&&(X=[0]),void 0===Y&&(Y=[0]),void 0===te&&(te=[0]),void 0===ti&&(ti=[0]),this.maxBlockCounts=g,this.maxSamplerTextureCounts=v,this.maxSamplerCounts=S,this.maxTextureCounts=O,this.maxBufferCounts=X,this.maxImageCounts=Y,this.maxSubpassInputCounts=te,this.setIndices=ti}return t1.prototype.copy=function(g){return this.maxBlockCounts=g.maxBlockCounts.slice(),this.maxSamplerTextureCounts=g.maxSamplerTextureCounts.slice(),this.maxSamplerCounts=g.maxSamplerCounts.slice(),this.maxTextureCounts=g.maxTextureCounts.slice(),this.maxBufferCounts=g.maxBufferCounts.slice(),this.maxImageCounts=g.maxImageCounts.slice(),this.maxSubpassInputCounts=g.maxSubpassInputCounts.slice(),this.setIndices=g.setIndices.slice(),this},t1}(),hE=function(){function t1(g,v,S,O,X){void 0===g&&(g=0),void 0===v&&(v=null),void 0===S&&(S=oM.ON),void 0===O&&(O=0),void 0===X&&(X=0),this.windowId=g,this.windowHandle=v,this.vsyncMode=S,this.width=O,this.height=X}return t1.prototype.copy=function(g){return this.windowId=g.windowId,this.windowHandle=g.windowHandle,this.vsyncMode=g.vsyncMode,this.width=g.width,this.height=g.height,this},t1}(),hC=function(){function t1(g){void 0===g&&(g=new hT),this.bindingMappingInfo=g}return t1.prototype.copy=function(g){return this.bindingMappingInfo.copy(g.bindingMappingInfo),this},t1}(),hx=function(){function t1(g,v,S,O,X){void 0===g&&(g=oC.NONE),void 0===v&&(v=oR.NONE),void 0===S&&(S=0),void 0===O&&(O=1),void 0===X&&(X=ox.NONE),this.usage=g,this.memUsage=v,this.size=S,this.stride=O,this.flags=X}return t1.prototype.copy=function(g){return this.usage=g.usage,this.memUsage=g.memUsage,this.size=g.size,this.stride=g.stride,this.flags=g.flags,this},t1}(),hb=function(){function t1(g,v,S){void 0===g&&(g=null),void 0===v&&(v=0),void 0===S&&(S=0),this.buffer=g,this.offset=v,this.range=S}return t1.prototype.copy=function(g){return this.buffer=g.buffer,this.offset=g.offset,this.range=g.range,this},t1}(),hR=function(){function t1(g,v,S,O,X,Y,te){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=0),void 0===te&&(te=0),this.vertexCount=g,this.firstVertex=v,this.indexCount=S,this.firstIndex=O,this.vertexOffset=X,this.instanceCount=Y,this.firstInstance=te}return t1.prototype.copy=function(g){return this.vertexCount=g.vertexCount,this.firstVertex=g.firstVertex,this.indexCount=g.indexCount,this.firstIndex=g.firstIndex,this.vertexOffset=g.vertexOffset,this.instanceCount=g.instanceCount,this.firstInstance=g.firstInstance,this},t1}(),hw=function(){function t1(g,v,S,O,X){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=null),void 0===X&&(X=0),this.groupCountX=g,this.groupCountY=v,this.groupCountZ=S,this.indirectBuffer=O,this.indirectOffset=X}return t1.prototype.copy=function(g){return this.groupCountX=g.groupCountX,this.groupCountY=g.groupCountY,this.groupCountZ=g.groupCountZ,this.indirectBuffer=g.indirectBuffer,this.indirectOffset=g.indirectOffset,this},t1}(),hI=function(){function t1(g){void 0===g&&(g=[]),this.drawInfos=g}return t1.prototype.copy=function(g){return gc(this.drawInfos,g.drawInfos,hR),this},t1}(),hB=function(){function t1(g,v,S,O,X,Y,te,ti,tr,ta,th){void 0===g&&(g=ow.TEX2D),void 0===v&&(v=oI.NONE),void 0===S&&(S=oA.UNKNOWN),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=oB.NONE),void 0===te&&(te=1),void 0===ti&&(ti=1),void 0===tr&&(tr=oD.X1),void 0===ta&&(ta=1),void 0===th&&(th=0),this.type=g,this.usage=v,this.format=S,this.width=O,this.height=X,this.flags=Y,this.layerCount=te,this.levelCount=ti,this.samples=tr,this.depth=ta,this.externalRes=th}return t1.prototype.copy=function(g){return this.type=g.type,this.usage=g.usage,this.format=g.format,this.width=g.width,this.height=g.height,this.flags=g.flags,this.layerCount=g.layerCount,this.levelCount=g.levelCount,this.samples=g.samples,this.depth=g.depth,this.externalRes=g.externalRes,this},t1}(),hP=function(){function t1(g,v,S,O,X,Y,te){void 0===g&&(g=null),void 0===v&&(v=ow.TEX2D),void 0===S&&(S=oA.UNKNOWN),void 0===O&&(O=0),void 0===X&&(X=1),void 0===Y&&(Y=0),void 0===te&&(te=1),this.texture=g,this.type=v,this.format=S,this.baseLevel=O,this.levelCount=X,this.baseLayer=Y,this.layerCount=te}return t1.prototype.copy=function(g){return this.texture=g.texture,this.type=g.type,this.format=g.format,this.baseLevel=g.baseLevel,this.levelCount=g.levelCount,this.baseLayer=g.baseLayer,this.layerCount=g.layerCount,this},t1}(),hD=function(){function t1(g,v,S,O,X,Y,te,ti){void 0===g&&(g=oO.LINEAR),void 0===v&&(v=oO.LINEAR),void 0===S&&(S=oO.NONE),void 0===O&&(O=oL.WRAP),void 0===X&&(X=oL.WRAP),void 0===Y&&(Y=oL.WRAP),void 0===te&&(te=0),void 0===ti&&(ti=oF.ALWAYS),this.minFilter=g,this.magFilter=v,this.mipFilter=S,this.addressU=O,this.addressV=X,this.addressW=Y,this.maxAnisotropy=te,this.cmpFunc=ti}return t1.prototype.copy=function(g){return this.minFilter=g.minFilter,this.magFilter=g.magFilter,this.mipFilter=g.mipFilter,this.addressU=g.addressU,this.addressV=g.addressV,this.addressW=g.addressW,this.maxAnisotropy=g.maxAnisotropy,this.cmpFunc=g.cmpFunc,this},t1}(),hM=function(){function t1(g,v,S){void 0===g&&(g=""),void 0===v&&(v=oE.UNKNOWN),void 0===S&&(S=0),this.name=g,this.type=v,this.count=S}return t1.prototype.copy=function(g){return this.name=g.name,this.type=g.type,this.count=g.count,this},t1}(),hL=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=""),void 0===O&&(O=[]),void 0===X&&(X=0),void 0===Y&&(Y=0),this.set=g,this.binding=v,this.name=S,this.members=O,this.count=X,this.flattened=Y}return t1.prototype.copy=function(g){return this.set=g.set,this.binding=g.binding,this.name=g.name,gc(this.members,g.members,hM),this.count=g.count,this.flattened=g.flattened,this},t1}(),hF=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=""),void 0===O&&(O=oE.UNKNOWN),void 0===X&&(X=0),void 0===Y&&(Y=0),this.set=g,this.binding=v,this.name=S,this.type=O,this.count=X,this.flattened=Y}return t1.prototype.copy=function(g){return this.set=g.set,this.binding=g.binding,this.name=g.name,this.type=g.type,this.count=g.count,this.flattened=g.flattened,this},t1}(),hN=function(){function t1(g,v,S,O,X){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=""),void 0===O&&(O=0),void 0===X&&(X=0),this.set=g,this.binding=v,this.name=S,this.count=O,this.flattened=X}return t1.prototype.copy=function(g){return this.set=g.set,this.binding=g.binding,this.name=g.name,this.count=g.count,this.flattened=g.flattened,this},t1}(),hk=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=""),void 0===O&&(O=oE.UNKNOWN),void 0===X&&(X=0),void 0===Y&&(Y=0),this.set=g,this.binding=v,this.name=S,this.type=O,this.count=X,this.flattened=Y}return t1.prototype.copy=function(g){return this.set=g.set,this.binding=g.binding,this.name=g.name,this.type=g.type,this.count=g.count,this.flattened=g.flattened,this},t1}(),hG=function(){function t1(g,v,S,O,X,Y,te){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=""),void 0===O&&(O=oE.UNKNOWN),void 0===X&&(X=0),void 0===Y&&(Y=ob.READ_WRITE),void 0===te&&(te=0),this.set=g,this.binding=v,this.name=S,this.type=O,this.count=X,this.memoryAccess=Y,this.flattened=te}return t1.prototype.copy=function(g){return this.set=g.set,this.binding=g.binding,this.name=g.name,this.type=g.type,this.count=g.count,this.memoryAccess=g.memoryAccess,this.flattened=g.flattened,this},t1}(),hV=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=""),void 0===O&&(O=0),void 0===X&&(X=ob.READ_WRITE),void 0===Y&&(Y=0),this.set=g,this.binding=v,this.name=S,this.count=O,this.memoryAccess=X,this.flattened=Y}return t1.prototype.copy=function(g){return this.set=g.set,this.binding=g.binding,this.name=g.name,this.count=g.count,this.memoryAccess=g.memoryAccess,this.flattened=g.flattened,this},t1}(),hU=function(){function t1(g,v,S,O,X){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=""),void 0===O&&(O=0),void 0===X&&(X=0),this.set=g,this.binding=v,this.name=S,this.count=O,this.flattened=X}return t1.prototype.copy=function(g){return this.set=g.set,this.binding=g.binding,this.name=g.name,this.count=g.count,this.flattened=g.flattened,this},t1}(),hH=function(){function t1(g,v){void 0===g&&(g=oU.NONE),void 0===v&&(v=""),this.stage=g,this.source=v}return t1.prototype.copy=function(g){return this.stage=g.stage,this.source=g.source,this},t1}(),hz=function(){function t1(g,v,S,O,X,Y){void 0===g&&(g=""),void 0===v&&(v=oA.UNKNOWN),void 0===S&&(S=!1),void 0===O&&(O=0),void 0===X&&(X=!1),void 0===Y&&(Y=0),this.name=g,this.format=v,this.isNormalized=S,this.stream=O,this.isInstanced=X,this.location=Y}return t1.prototype.copy=function(g){return this.name=g.name,this.format=g.format,this.isNormalized=g.isNormalized,this.stream=g.stream,this.isInstanced=g.isInstanced,this.location=g.location,this},t1}(),hW=function(){function t1(g,v,S,O,X,Y,te,ti,tr,ta){void 0===g&&(g=""),void 0===v&&(v=[]),void 0===S&&(S=[]),void 0===O&&(O=[]),void 0===X&&(X=[]),void 0===Y&&(Y=[]),void 0===te&&(te=[]),void 0===ti&&(ti=[]),void 0===tr&&(tr=[]),void 0===ta&&(ta=[]),this.name=g,this.stages=v,this.attributes=S,this.blocks=O,this.buffers=X,this.samplerTextures=Y,this.samplers=te,this.textures=ti,this.images=tr,this.subpassInputs=ta}return t1.prototype.copy=function(g){return this.name=g.name,gc(this.stages,g.stages,hH),gc(this.attributes,g.attributes,hz),gc(this.blocks,g.blocks,hL),gc(this.buffers,g.buffers,hV),gc(this.samplerTextures,g.samplerTextures,hF),gc(this.samplers,g.samplers,hN),gc(this.textures,g.textures,hk),gc(this.images,g.images,hG),gc(this.subpassInputs,g.subpassInputs,hU),this},t1}(),hX=function(){function t1(g,v,S,O){void 0===g&&(g=[]),void 0===v&&(v=[]),void 0===S&&(S=null),void 0===O&&(O=null),this.attributes=g,this.vertexBuffers=v,this.indexBuffer=S,this.indirectBuffer=O}return t1.prototype.copy=function(g){return gc(this.attributes,g.attributes,hz),this.vertexBuffers=g.vertexBuffers.slice(),this.indexBuffer=g.indexBuffer,this.indirectBuffer=g.indirectBuffer,this},t1}(),hq=function(){function t1(g,v,S,O,X){void 0===g&&(g=oA.UNKNOWN),void 0===v&&(v=oD.X1),void 0===S&&(S=oH.CLEAR),void 0===O&&(O=oz.STORE),void 0===X&&(X=null),this.format=g,this.sampleCount=v,this.loadOp=S,this.storeOp=O,this.barrier=X}return t1.prototype.copy=function(g){return this.format=g.format,this.sampleCount=g.sampleCount,this.loadOp=g.loadOp,this.storeOp=g.storeOp,this.barrier=g.barrier,this},t1}(),hY=function(){function t1(g,v,S,O,X,Y,te){void 0===g&&(g=oA.UNKNOWN),void 0===v&&(v=oD.X1),void 0===S&&(S=oH.CLEAR),void 0===O&&(O=oz.STORE),void 0===X&&(X=oH.CLEAR),void 0===Y&&(Y=oz.STORE),void 0===te&&(te=null),this.format=g,this.sampleCount=v,this.depthLoadOp=S,this.depthStoreOp=O,this.stencilLoadOp=X,this.stencilStoreOp=Y,this.barrier=te}return t1.prototype.copy=function(g){return this.format=g.format,this.sampleCount=g.sampleCount,this.depthLoadOp=g.depthLoadOp,this.depthStoreOp=g.depthStoreOp,this.stencilLoadOp=g.stencilLoadOp,this.stencilStoreOp=g.stencilStoreOp,this.barrier=g.barrier,this},t1}(),hK=function(){function t1(g,v,S,O,X,Y,te,ti){void 0===g&&(g=[]),void 0===v&&(v=[]),void 0===S&&(S=[]),void 0===O&&(O=[]),void 0===X&&(X=-1),void 0===Y&&(Y=-1),void 0===te&&(te=oX.NONE),void 0===ti&&(ti=oX.NONE),this.inputs=g,this.colors=v,this.resolves=S,this.preserves=O,this.depthStencil=X,this.depthStencilResolve=Y,this.depthResolveMode=te,this.stencilResolveMode=ti}return t1.prototype.copy=function(g){return this.inputs=g.inputs.slice(),this.colors=g.colors.slice(),this.resolves=g.resolves.slice(),this.preserves=g.preserves.slice(),this.depthStencil=g.depthStencil,this.depthStencilResolve=g.depthStencilResolve,this.depthResolveMode=g.depthResolveMode,this.stencilResolveMode=g.stencilResolveMode,this},t1}(),hJ=function(){function t1(g,v,S,O,X){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=null),void 0===O&&(O=[oW.NONE]),void 0===X&&(X=[oW.NONE]),this.srcSubpass=g,this.dstSubpass=v,this.generalBarrier=S,this.prevAccesses=O,this.nextAccesses=X}return t1.prototype.copy=function(g){return this.srcSubpass=g.srcSubpass,this.dstSubpass=g.dstSubpass,this.generalBarrier=g.generalBarrier,this.prevAccesses=g.prevAccesses.slice(),this.nextAccesses=g.nextAccesses.slice(),this},t1}(),hZ=function(){function t1(g,v,S,O,X){void 0===g&&(g=[]),void 0===v&&(v=new hY),void 0===S&&(S=new hY),void 0===O&&(O=[]),void 0===X&&(X=[]),this.colorAttachments=g,this.depthStencilAttachment=v,this.depthStencilResolveAttachment=S,this.subpasses=O,this.dependencies=X}return t1.prototype.copy=function(g){return gc(this.colorAttachments,g.colorAttachments,hq),this.depthStencilAttachment.copy(g.depthStencilAttachment),this.depthStencilResolveAttachment.copy(g.depthStencilResolveAttachment),gc(this.subpasses,g.subpasses,hK),gc(this.dependencies,g.dependencies,hJ),this},t1}(),h$=function(){function t1(g,v,S){void 0===g&&(g=oW.NONE),void 0===v&&(v=oW.NONE),void 0===S&&(S=ht.FULL),this.prevAccesses=g,this.nextAccesses=v,this.type=S}return t1.prototype.copy=function(g){return this.prevAccesses=g.prevAccesses,this.nextAccesses=g.nextAccesses,this.type=g.type,this},t1}(),h0=function(){function t1(g,v,S,O,X,Y,te,ti,tr,ta){void 0===g&&(g=oW.NONE),void 0===v&&(v=oW.NONE),void 0===S&&(S=ht.FULL),void 0===O&&(O=0),void 0===X&&(X=1),void 0===Y&&(Y=0),void 0===te&&(te=1),void 0===ti&&(ti=!1),void 0===tr&&(tr=null),void 0===ta&&(ta=null),this.prevAccesses=g,this.nextAccesses=v,this.type=S,this.baseMipLevel=O,this.levelCount=X,this.baseSlice=Y,this.sliceCount=te,this.discardContents=ti,this.srcQueue=tr,this.dstQueue=ta}return t1.prototype.copy=function(g){return this.prevAccesses=g.prevAccesses,this.nextAccesses=g.nextAccesses,this.type=g.type,this.baseMipLevel=g.baseMipLevel,this.levelCount=g.levelCount,this.baseSlice=g.baseSlice,this.sliceCount=g.sliceCount,this.discardContents=g.discardContents,this.srcQueue=g.srcQueue,this.dstQueue=g.dstQueue,this},t1}(),h1=function(){function t1(g,v,S,O,X,Y,te,ti){void 0===g&&(g=oW.NONE),void 0===v&&(v=oW.NONE),void 0===S&&(S=ht.FULL),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=!1),void 0===te&&(te=null),void 0===ti&&(ti=null),this.prevAccesses=g,this.nextAccesses=v,this.type=S,this.offset=O,this.size=X,this.discardContents=Y,this.srcQueue=te,this.dstQueue=ti}return t1.prototype.copy=function(g){return this.prevAccesses=g.prevAccesses,this.nextAccesses=g.nextAccesses,this.type=g.type,this.offset=g.offset,this.size=g.size,this.discardContents=g.discardContents,this.srcQueue=g.srcQueue,this.dstQueue=g.dstQueue,this},t1}(),h2=function(){function t1(g,v,S,O){void 0===g&&(g=null),void 0===v&&(v=[]),void 0===S&&(S=null),void 0===O&&(O=null),this.renderPass=g,this.colorTextures=v,this.depthStencilTexture=S,this.depthStencilResolveTexture=O}return t1.prototype.copy=function(g){return this.renderPass=g.renderPass,this.colorTextures=g.colorTextures.slice(),this.depthStencilTexture=g.depthStencilTexture,this.depthStencilResolveTexture=g.depthStencilResolveTexture,this},t1}(),h3=function(){function t1(g,v,S,O,X){void 0===g&&(g=-1),void 0===v&&(v=o2.UNKNOWN),void 0===S&&(S=0),void 0===O&&(O=oU.NONE),void 0===X&&(X=[]),this.binding=g,this.descriptorType=v,this.count=S,this.stageFlags=O,this.immutableSamplers=X}return t1.prototype.copy=function(g){return this.binding=g.binding,this.descriptorType=g.descriptorType,this.count=g.count,this.stageFlags=g.stageFlags,this.immutableSamplers=g.immutableSamplers.slice(),this},t1}(),h4=function(){function t1(g){void 0===g&&(g=[]),this.bindings=g}var g=t1.prototype;return g.copy=function(g){return gc(this.bindings,g.bindings,h3),this},g.reset=function(){this.bindings.length=0},t1}(),h8=function(){function t1(g){void 0===g&&(g=null),this.layout=g}return t1.prototype.copy=function(g){return this.layout=g.layout,this},t1}(),h6=function(){function t1(g){void 0===g&&(g=[]),this.setLayouts=g}return t1.prototype.copy=function(g){return this.setLayouts=g.setLayouts.slice(),this},t1}(),h7=function(){function t1(g){void 0===g&&(g=[]),this.attributes=g}return t1.prototype.copy=function(g){return gc(this.attributes,g.attributes,hz),this},t1}(),ue=function(){function t1(g,v){void 0===g&&(g=null),void 0===v&&(v=o6.PRIMARY),this.queue=g,this.type=v}return t1.prototype.copy=function(g){return this.queue=g.queue,this.type=g.type,this},t1}(),ur=function(){function t1(g){void 0===g&&(g=o4.GRAPHICS),this.type=g}return t1.prototype.copy=function(g){return this.type=g.type,this},t1}(),ua=function(){function t1(g,v,S){void 0===g&&(g=o8.OCCLUSION),void 0===v&&(v=32767),void 0===S&&(S=!0),this.type=g,this.maxQueryObjects=v,this.forceWait=S}return t1.prototype.copy=function(g){return this.type=g.type,this.maxQueryObjects=g.maxQueryObjects,this.forceWait=g.forceWait,this},t1}(),v_=function(g,v,S,O,X,Y,te,ti){void 0===g&&(g=""),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=oT.NONE),void 0===X&&(X=!1),void 0===Y&&(Y=!1),void 0===te&&(te=!1),void 0===ti&&(ti=!1),this.name=g,this.size=v,this.count=S,this.type=O,this.hasAlpha=X,this.hasDepth=Y,this.hasStencil=te,this.isCompressed=ti},uu=function(){function t1(g,v){void 0===g&&(g=0),void 0===v&&(v=0),this.bufferSize=g,this.textureSize=v}return t1.prototype.copy=function(g){return this.bufferSize=g.bufferSize,this.textureSize=g.textureSize,this},t1}(),ul=function(){function t1(g,v,S){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),this.writeMask=g,this.compareMask=v,this.reference=S}return t1.prototype.copy=function(g){return this.writeMask=g.writeMask,this.compareMask=g.compareMask,this.reference=g.reference,this},t1}(),uc=function(){function t1(g,v,S,O,X,Y,te,ti,tr,ta,th){void 0===g&&(g=new hS),void 0===v&&(v=new hl),void 0===S&&(S=new hA),void 0===O&&(O=1),void 0===X&&(X=0),void 0===Y&&(Y=0),void 0===te&&(te=0),void 0===ti&&(ti=0),void 0===tr&&(tr=0),void 0===ta&&(ta=new ul),void 0===th&&(th=new ul),this.viewport=g,this.scissor=v,this.blendConstant=S,this.lineWidth=O,this.depthBiasConstant=X,this.depthBiasClamp=Y,this.depthBiasSlope=te,this.depthMinBounds=ti,this.depthMaxBounds=tr,this.stencilStatesFront=ta,this.stencilStatesBack=th}return t1.prototype.copy=function(g){return this.viewport.copy(g.viewport),this.scissor.copy(g.scissor),this.blendConstant.copy(g.blendConstant),this.lineWidth=g.lineWidth,this.depthBiasConstant=g.depthBiasConstant,this.depthBiasClamp=g.depthBiasClamp,this.depthBiasSlope=g.depthBiasSlope,this.depthMinBounds=g.depthMinBounds,this.depthMaxBounds=g.depthMaxBounds,this.stencilStatesFront.copy(g.stencilStatesFront),this.stencilStatesBack.copy(g.stencilStatesBack),this},t1}(),u_=function(g){function e(v){var S;return(S=g.call(this)||this)._objectType=od.UNKNOWN,S._objectID=0,S._typedID=0,S._objectType=v,S._objectID=e._idTable[od.UNKNOWN]++,S._typedID=e._idTable[v]++,S}return s(e,g),n(e,[{key:"objectType",get:function(){return this._objectType}},{key:"objectID",get:function(){return this._objectID}},{key:"typedID",get:function(){return this._typedID}}]),e}(of);u_._idTable=Array(od.COUNT).fill(65536),function(g){g.ATTR_POSITION="a_position",g.ATTR_NORMAL="a_normal",g.ATTR_TANGENT="a_tangent",g.ATTR_BITANGENT="a_bitangent",g.ATTR_WEIGHTS="a_weights",g.ATTR_JOINTS="a_joints",g.ATTR_COLOR="a_color",g.ATTR_COLOR1="a_color1",g.ATTR_COLOR2="a_color2",g.ATTR_TEX_COORD="a_texCoord",g.ATTR_TEX_COORD1="a_texCoord1",g.ATTR_TEX_COORD2="a_texCoord2",g.ATTR_TEX_COORD3="a_texCoord3",g.ATTR_TEX_COORD4="a_texCoord4",g.ATTR_TEX_COORD5="a_texCoord5",g.ATTR_TEX_COORD6="a_texCoord6",g.ATTR_TEX_COORD7="a_texCoord7",g.ATTR_TEX_COORD8="a_texCoord8",g.ATTR_BATCH_ID="a_batch_id",g.ATTR_BATCH_UV="a_batch_uv"}(hi||(hi={}));var uf=Object.freeze([new v_("UNKNOWN",0,0,oT.NONE,!1,!1,!1,!1),new v_("A8",1,1,oT.UNORM,!0,!1,!1,!1),new v_("L8",1,1,oT.UNORM,!1,!1,!1,!1),new v_("LA8",1,2,oT.UNORM,!0,!1,!1,!1),new v_("R8",1,1,oT.UNORM,!1,!1,!1,!1),new v_("R8SN",1,1,oT.SNORM,!1,!1,!1,!1),new v_("R8UI",1,1,oT.UINT,!1,!1,!1,!1),new v_("R8I",1,1,oT.INT,!1,!1,!1,!1),new v_("R16F",2,1,oT.FLOAT,!1,!1,!1,!1),new v_("R16UI",2,1,oT.UINT,!1,!1,!1,!1),new v_("R16I",2,1,oT.INT,!1,!1,!1,!1),new v_("R32F",4,1,oT.FLOAT,!1,!1,!1,!1),new v_("R32UI",4,1,oT.UINT,!1,!1,!1,!1),new v_("R32I",4,1,oT.INT,!1,!1,!1,!1),new v_("RG8",2,2,oT.UNORM,!1,!1,!1,!1),new v_("RG8SN",2,2,oT.SNORM,!1,!1,!1,!1),new v_("RG8UI",2,2,oT.UINT,!1,!1,!1,!1),new v_("RG8I",2,2,oT.INT,!1,!1,!1,!1),new v_("RG16F",4,2,oT.FLOAT,!1,!1,!1,!1),new v_("RG16UI",4,2,oT.UINT,!1,!1,!1,!1),new v_("RG16I",4,2,oT.INT,!1,!1,!1,!1),new v_("RG32F",8,2,oT.FLOAT,!1,!1,!1,!1),new v_("RG32UI",8,2,oT.UINT,!1,!1,!1,!1),new v_("RG32I",8,2,oT.INT,!1,!1,!1,!1),new v_("RGB8",3,3,oT.UNORM,!1,!1,!1,!1),new v_("SRGB8",3,3,oT.UNORM,!1,!1,!1,!1),new v_("RGB8SN",3,3,oT.SNORM,!1,!1,!1,!1),new v_("RGB8UI",3,3,oT.UINT,!1,!1,!1,!1),new v_("RGB8I",3,3,oT.INT,!1,!1,!1,!1),new v_("RGB16F",6,3,oT.FLOAT,!1,!1,!1,!1),new v_("RGB16UI",6,3,oT.UINT,!1,!1,!1,!1),new v_("RGB16I",6,3,oT.INT,!1,!1,!1,!1),new v_("RGB32F",12,3,oT.FLOAT,!1,!1,!1,!1),new v_("RGB32UI",12,3,oT.UINT,!1,!1,!1,!1),new v_("RGB32I",12,3,oT.INT,!1,!1,!1,!1),new v_("RGBA8",4,4,oT.UNORM,!0,!1,!1,!1),new v_("BGRA8",4,4,oT.UNORM,!0,!1,!1,!1),new v_("SRGB8_A8",4,4,oT.UNORM,!0,!1,!1,!1),new v_("RGBA8SN",4,4,oT.SNORM,!0,!1,!1,!1),new v_("RGBA8UI",4,4,oT.UINT,!0,!1,!1,!1),new v_("RGBA8I",4,4,oT.INT,!0,!1,!1,!1),new v_("RGBA16F",8,4,oT.FLOAT,!0,!1,!1,!1),new v_("RGBA16UI",8,4,oT.UINT,!0,!1,!1,!1),new v_("RGBA16I",8,4,oT.INT,!0,!1,!1,!1),new v_("RGBA32F",16,4,oT.FLOAT,!0,!1,!1,!1),new v_("RGBA32UI",16,4,oT.UINT,!0,!1,!1,!1),new v_("RGBA32I",16,4,oT.INT,!0,!1,!1,!1),new v_("R5G6B5",2,3,oT.UNORM,!1,!1,!1,!1),new v_("R11G11B10F",4,3,oT.FLOAT,!1,!1,!1,!1),new v_("RGB5A1",2,4,oT.UNORM,!0,!1,!1,!1),new v_("RGBA4",2,4,oT.UNORM,!0,!1,!1,!1),new v_("RGB10A2",2,4,oT.UNORM,!0,!1,!1,!1),new v_("RGB10A2UI",2,4,oT.UINT,!0,!1,!1,!1),new v_("RGB9E5",2,4,oT.FLOAT,!0,!1,!1,!1),new v_("DEPTH",4,1,oT.FLOAT,!1,!0,!1,!1),new v_("DEPTH_STENCIL",5,2,oT.FLOAT,!1,!0,!0,!1),new v_("BC1",1,3,oT.UNORM,!1,!1,!1,!0),new v_("BC1_ALPHA",1,4,oT.UNORM,!0,!1,!1,!0),new v_("BC1_SRGB",1,3,oT.UNORM,!1,!1,!1,!0),new v_("BC1_SRGB_ALPHA",1,4,oT.UNORM,!0,!1,!1,!0),new v_("BC2",1,4,oT.UNORM,!0,!1,!1,!0),new v_("BC2_SRGB",1,4,oT.UNORM,!0,!1,!1,!0),new v_("BC3",1,4,oT.UNORM,!0,!1,!1,!0),new v_("BC3_SRGB",1,4,oT.UNORM,!0,!1,!1,!0),new v_("BC4",1,1,oT.UNORM,!1,!1,!1,!0),new v_("BC4_SNORM",1,1,oT.SNORM,!1,!1,!1,!0),new v_("BC5",1,2,oT.UNORM,!1,!1,!1,!0),new v_("BC5_SNORM",1,2,oT.SNORM,!1,!1,!1,!0),new v_("BC6H_UF16",1,3,oT.UFLOAT,!1,!1,!1,!0),new v_("BC6H_SF16",1,3,oT.FLOAT,!1,!1,!1,!0),new v_("BC7",1,4,oT.UNORM,!0,!1,!1,!0),new v_("BC7_SRGB",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ETC_RGB8",1,3,oT.UNORM,!1,!1,!1,!0),new v_("ETC2_RGB8",1,3,oT.UNORM,!1,!1,!1,!0),new v_("ETC2_SRGB8",1,3,oT.UNORM,!1,!1,!1,!0),new v_("ETC2_RGB8_A1",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ETC2_SRGB8_A1",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ETC2_RGBA8",2,4,oT.UNORM,!0,!1,!1,!0),new v_("ETC2_SRGB8_A8",2,4,oT.UNORM,!0,!1,!1,!0),new v_("EAC_R11",1,1,oT.UNORM,!1,!1,!1,!0),new v_("EAC_R11SN",1,1,oT.SNORM,!1,!1,!1,!0),new v_("EAC_RG11",2,2,oT.UNORM,!1,!1,!1,!0),new v_("EAC_RG11SN",2,2,oT.SNORM,!1,!1,!1,!0),new v_("PVRTC_RGB2",2,3,oT.UNORM,!1,!1,!1,!0),new v_("PVRTC_RGBA2",2,4,oT.UNORM,!0,!1,!1,!0),new v_("PVRTC_RGB4",2,3,oT.UNORM,!1,!1,!1,!0),new v_("PVRTC_RGBA4",2,4,oT.UNORM,!0,!1,!1,!0),new v_("PVRTC2_2BPP",2,4,oT.UNORM,!0,!1,!1,!0),new v_("PVRTC2_4BPP",2,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_4x4",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_5x4",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_5x5",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_6x5",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_6x6",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_8x5",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_8x6",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_8x8",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_10x5",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_10x6",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_10x8",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_10x10",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_12x10",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_RGBA_12x12",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_4x4",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_5x4",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_5x5",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_6x5",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_6x6",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_8x5",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_8x6",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_8x8",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_10x5",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_10x6",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_10x8",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_10x10",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_12x10",1,4,oT.UNORM,!0,!1,!1,!0),new v_("ASTC_SRGBA_12x12",1,4,oT.UNORM,!0,!1,!1,!0)]),ud=o2.UNIFORM_BUFFER|o2.DYNAMIC_UNIFORM_BUFFER|o2.STORAGE_BUFFER|o2.DYNAMIC_STORAGE_BUFFER,um=o2.SAMPLER_TEXTURE|o2.SAMPLER|o2.TEXTURE|o2.STORAGE_IMAGE|o2.INPUT_ATTACHMENT,ug=o2.DYNAMIC_STORAGE_BUFFER|o2.DYNAMIC_UNIFORM_BUFFER;function R_(g){return g>0&&0==(g&g-1)}function w_(g,v,S,O){if(!uf[g].isCompressed)return v*S*O*uf[g].size;switch(g){case oA.BC1:case oA.BC1_ALPHA:case oA.BC1_SRGB:case oA.BC1_SRGB_ALPHA:return Math.ceil(v/4)*Math.ceil(S/4)*8*O;case oA.BC2:case oA.BC2_SRGB:case oA.BC3:case oA.BC3_SRGB:case oA.BC4:case oA.BC4_SNORM:case oA.BC6H_SF16:case oA.BC6H_UF16:case oA.BC7:case oA.BC7_SRGB:return Math.ceil(v/4)*Math.ceil(S/4)*16*O;case oA.BC5:case oA.BC5_SNORM:return Math.ceil(v/4)*Math.ceil(S/4)*32*O;case oA.ETC_RGB8:case oA.ETC2_RGB8:case oA.ETC2_SRGB8:case oA.ETC2_RGB8_A1:case oA.EAC_R11:case oA.EAC_R11SN:return Math.ceil(v/4)*Math.ceil(S/4)*8*O;case oA.ETC2_RGBA8:case oA.ETC2_SRGB8_A1:case oA.EAC_RG11:case oA.EAC_RG11SN:return Math.ceil(v/4)*Math.ceil(S/4)*16*O;case oA.PVRTC_RGB2:case oA.PVRTC_RGBA2:case oA.PVRTC2_2BPP:return Math.ceil(v/8)*Math.ceil(S/4)*8*O;case oA.PVRTC_RGB4:case oA.PVRTC_RGBA4:case oA.PVRTC2_4BPP:return Math.ceil(v/4)*Math.ceil(S/4)*8*O;case oA.ASTC_RGBA_4X4:case oA.ASTC_SRGBA_4X4:return Math.ceil(v/4)*Math.ceil(S/4)*16*O;case oA.ASTC_RGBA_5X4:case oA.ASTC_SRGBA_5X4:return Math.ceil(v/5)*Math.ceil(S/4)*16*O;case oA.ASTC_RGBA_5X5:case oA.ASTC_SRGBA_5X5:return Math.ceil(v/5)*Math.ceil(S/5)*16*O;case oA.ASTC_RGBA_6X5:case oA.ASTC_SRGBA_6X5:return Math.ceil(v/6)*Math.ceil(S/5)*16*O;case oA.ASTC_RGBA_6X6:case oA.ASTC_SRGBA_6X6:return Math.ceil(v/6)*Math.ceil(S/6)*16*O;case oA.ASTC_RGBA_8X5:case oA.ASTC_SRGBA_8X5:return Math.ceil(v/8)*Math.ceil(S/5)*16*O;case oA.ASTC_RGBA_8X6:case oA.ASTC_SRGBA_8X6:return Math.ceil(v/8)*Math.ceil(S/6)*16*O;case oA.ASTC_RGBA_8X8:case oA.ASTC_SRGBA_8X8:return Math.ceil(v/8)*Math.ceil(S/8)*16*O;case oA.ASTC_RGBA_10X5:case oA.ASTC_SRGBA_10X5:return Math.ceil(v/10)*Math.ceil(S/5)*16*O;case oA.ASTC_RGBA_10X6:case oA.ASTC_SRGBA_10X6:return Math.ceil(v/10)*Math.ceil(S/6)*16*O;case oA.ASTC_RGBA_10X8:case oA.ASTC_SRGBA_10X8:return Math.ceil(v/10)*Math.ceil(S/8)*16*O;case oA.ASTC_RGBA_10X10:case oA.ASTC_SRGBA_10X10:return Math.ceil(v/10)*Math.ceil(S/10)*16*O;case oA.ASTC_RGBA_12X10:case oA.ASTC_SRGBA_12X10:return Math.ceil(v/12)*Math.ceil(S/10)*16*O;case oA.ASTC_RGBA_12X12:case oA.ASTC_SRGBA_12X12:return Math.ceil(v/12)*Math.ceil(S/12)*16*O;default:return 0}}function I_(g,v,S,O,X){for(var Y=0,te=0;te<X;++te)Y+=w_(g,v,S,O),v=Math.max(v>>1,1),S=Math.max(S>>1,1);return Y}var uv=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function P_(g){return uv[g]||0}function D_(g){if(g.isCompressed)return Uint8Array;var v=g.size/g.count;switch(g.type){case oT.UNORM:case oT.UINT:switch(v){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}case oT.SNORM:case oT.INT:switch(v){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array;default:return Int8Array}case oT.FLOAT:switch(v){case 2:return Uint16Array;case 4:default:return Float32Array}}return Float32Array}function O_(g){switch(g){case oA.BC1:case oA.BC1_ALPHA:case oA.BC1_SRGB:case oA.BC1_SRGB_ALPHA:case oA.BC2:case oA.BC2_SRGB:case oA.BC3:case oA.BC3_SRGB:case oA.BC4:case oA.BC4_SNORM:case oA.BC6H_SF16:case oA.BC6H_UF16:case oA.BC7:case oA.BC7_SRGB:case oA.BC5:case oA.BC5_SNORM:case oA.ETC_RGB8:case oA.ETC2_RGB8:case oA.ETC2_SRGB8:case oA.ETC2_RGB8_A1:case oA.EAC_R11:case oA.EAC_R11SN:case oA.ETC2_RGBA8:case oA.ETC2_SRGB8_A1:case oA.EAC_RG11:case oA.EAC_RG11SN:return{width:4,height:4};case oA.PVRTC_RGB2:case oA.PVRTC_RGBA2:case oA.PVRTC2_2BPP:return{width:8,height:4};case oA.PVRTC_RGB4:case oA.PVRTC_RGBA4:case oA.PVRTC2_4BPP:return{width:4,height:4};case oA.ASTC_RGBA_4X4:case oA.ASTC_SRGBA_4X4:return{width:4,height:4};case oA.ASTC_RGBA_5X4:case oA.ASTC_SRGBA_5X4:return{width:5,height:4};case oA.ASTC_RGBA_5X5:case oA.ASTC_SRGBA_5X5:return{width:5,height:5};case oA.ASTC_RGBA_6X5:case oA.ASTC_SRGBA_6X5:return{width:6,height:5};case oA.ASTC_RGBA_6X6:case oA.ASTC_SRGBA_6X6:return{width:6,height:6};case oA.ASTC_RGBA_8X5:case oA.ASTC_SRGBA_8X5:return{width:8,height:5};case oA.ASTC_RGBA_8X6:case oA.ASTC_SRGBA_8X6:return{width:8,height:6};case oA.ASTC_RGBA_8X8:case oA.ASTC_SRGBA_8X8:return{width:8,height:8};case oA.ASTC_RGBA_10X5:case oA.ASTC_SRGBA_10X5:return{width:10,height:5};case oA.ASTC_RGBA_10X6:case oA.ASTC_SRGBA_10X6:return{width:10,height:6};case oA.ASTC_RGBA_10X8:case oA.ASTC_SRGBA_10X8:return{width:10,height:8};case oA.ASTC_RGBA_10X10:case oA.ASTC_SRGBA_10X10:return{width:10,height:10};case oA.ASTC_RGBA_12X10:case oA.ASTC_SRGBA_12X10:return{width:12,height:10};case oA.ASTC_RGBA_12X12:case oA.ASTC_SRGBA_12X12:return{width:12,height:12};default:return{width:1,height:1}}}function M_(g,v){return Math.ceil(g/v)*v}var uS=Object.freeze({__proto__:null,get ObjectType(){return od},get Status(){return op},get API(){return om},get SurfaceTransform(){return og},get Feature(){return oS},get Format(){return oA},get FormatType(){return oT},get Type(){return oE},get BufferUsageBit(){return oC},get BufferFlagBit(){return ox},get MemoryAccessBit(){return ob},get MemoryUsageBit(){return oR},get TextureType(){return ow},get TextureUsageBit(){return oI},get TextureFlagBit(){return oB},get FormatFeatureBit(){return oP},get SampleCount(){return oD},get VsyncMode(){return oM},get Filter(){return oO},get Address(){return oL},get ComparisonFunc(){return oF},get StencilOp(){return oN},get BlendFactor(){return ok},get BlendOp(){return oG},get ColorMask(){return oV},get ShaderStageFlagBit(){return oU},get LoadOp(){return oH},get StoreOp(){return oz},get AccessFlagBit(){return oW},get ResolveMode(){return oX},get PipelineBindPoint(){return oq},get PrimitiveMode(){return oY},get PolygonMode(){return oJ},get ShadeModel(){return oZ},get CullMode(){return o$},get DynamicStateFlagBit(){return o0},get StencilFace(){return o1},get DescriptorType(){return o2},get QueueType(){return o4},get QueryType(){return o8},get CommandBufferType(){return o6},get ClearFlagBit(){return o7},get BarrierType(){return ht},get PassType(){return he},Size:hn,DeviceCaps:hr,DeviceOptions:ha,Offset:hu,Rect:hl,Extent:hc,TextureSubresLayers:h_,TextureSubresRange:hf,TextureCopy:hd,TextureBlit:hm,BufferTextureCopy:hg,Viewport:hS,Color:hA,BindingMappingInfo:hT,SwapchainInfo:hE,DeviceInfo:hC,BufferInfo:hx,BufferViewInfo:hb,DrawInfo:hR,DispatchInfo:hw,IndirectBuffer:hI,TextureInfo:hB,TextureViewInfo:hP,SamplerInfo:hD,Uniform:hM,UniformBlock:hL,UniformSamplerTexture:hF,UniformSampler:hN,UniformTexture:hk,UniformStorageImage:hG,UniformStorageBuffer:hV,UniformInputAttachment:hU,ShaderStage:hH,Attribute:hz,ShaderInfo:hW,InputAssemblerInfo:hX,ColorAttachment:hq,DepthStencilAttachment:hY,SubpassInfo:hK,SubpassDependency:hJ,RenderPassInfo:hZ,GeneralBarrierInfo:h$,TextureBarrierInfo:h0,BufferBarrierInfo:h1,FramebufferInfo:h2,DescriptorSetLayoutBinding:h3,DescriptorSetLayoutInfo:h4,DescriptorSetInfo:h8,PipelineLayoutInfo:h6,InputState:h7,CommandBufferInfo:ue,QueueInfo:ur,QueryPoolInfo:ua,FormatInfo:v_,MemoryStatus:uu,DynamicStencilStates:ul,DynamicStates:uc,GFXObject:u_,get AttributeName(){return hi},FormatInfos:uf,DESCRIPTOR_BUFFER_TYPE:ud,DESCRIPTOR_SAMPLER_TYPE:um,DESCRIPTOR_DYNAMIC_TYPE:ug,DRAW_INFO_SIZE:28,IsPowerOf2:R_,FormatSize:w_,FormatSurfaceSize:I_,GetTypeSize:P_,getTypedArrayConstructor:D_,formatAlignment:O_,alignTo:M_}),uA=function(g){function e(){var v;return(v=g.call(this,od.BUFFER)||this)._usage=oC.NONE,v._memUsage=oR.NONE,v._size=0,v._stride=1,v._count=0,v._flags=ox.NONE,v._isBufferView=!1,v}return s(e,g),n(e,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}}]),e}(u_),uT=function(g){function e(){var v;return(v=g.call(this,od.COMMAND_BUFFER)||this)._queue=null,v._type=o6.PRIMARY,v._numDrawCalls=0,v._numInstances=0,v._numTris=0,v}return s(e,g),n(e,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),e}(u_),uE=function(){function t1(){this._gfxAPI=om.UNKNOWN,this._renderer="",this._vendor="",this._features=new Array(oS.COUNT),this._formatFeatures=new Array(oA.COUNT),this._queue=null,this._cmdBuff=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new uu,this._caps=new hr,this._bindingMappingInfo=new hT,this._samplers=new Map,this._generalBarrierss=new Map,this._textureBarriers=new Map,this._bufferBarriers=new Map}var g=t1.prototype;return g.hasFeature=function(g){return this._features[g]},g.getFormatFeatures=function(g){return this._formatFeatures[g]},g.enableAutoBarrier=function(){},g.getMaxSampleCount=function(){return oD.X1},n(t1,[{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"capabilities",get:function(){return this._caps}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}}]),t1}();uE.canvas=void 0;var uC,ux,uR=function(){function t1(g){this._texture2D=null,this._texture3D=null,this._textureCube=null,this._texture2DArray=null;var v=new Uint8Array(64);if(v.fill(255),g.capabilities.maxTextureSize>=2){this._texture2D=g.createTexture(new hB(ow.TEX2D,oI.STORAGE|oI.SAMPLED,oA.RGBA8,2,2,oB.NONE));var S=new hg(0,0,0,new hu(0,0,0),new hc(2,2,1));g.copyBuffersToTexture([v],this._texture2D,[S])}if(g.capabilities.maxTextureSize>=2){this._textureCube=g.createTexture(new hB(ow.CUBE,oI.STORAGE|oI.SAMPLED,oA.RGBA8,2,2,oB.NONE,6));var O=new hg(0,0,0,new hu(0,0,0),new hc(2,2,1));g.copyBuffersToTexture([v],this._textureCube,[O]),O.texSubres.baseArrayLayer=1,g.copyBuffersToTexture([v],this._textureCube,[O]),O.texSubres.baseArrayLayer=2,g.copyBuffersToTexture([v],this._textureCube,[O]),O.texSubres.baseArrayLayer=3,g.copyBuffersToTexture([v],this._textureCube,[O]),O.texSubres.baseArrayLayer=4,g.copyBuffersToTexture([v],this._textureCube,[O]),O.texSubres.baseArrayLayer=5,g.copyBuffersToTexture([v],this._textureCube,[O])}if(g.capabilities.max3DTextureSize>=2){this._texture3D=g.createTexture(new hB(ow.TEX3D,oI.STORAGE|oI.SAMPLED,oA.RGBA8,2,2,oB.NONE,1,1,oD.X1,2));var X=new hg(0,0,0,new hu(0,0,0),new hc(2,2,2),new h_(0,0,1));g.copyBuffersToTexture([v],this._texture3D,[X])}if(g.capabilities.maxArrayTextureLayers>=2){this._texture2DArray=g.createTexture(new hB(ow.TEX2D_ARRAY,oI.STORAGE|oI.SAMPLED,oA.RGBA8,2,2,oB.NONE,2));var Y=new hg(0,0,0,new hu(0,0,0),new hc(2,2,1),new h_(0,0,1));g.copyBuffersToTexture([v],this._texture2DArray,[Y]),Y.texSubres.baseArrayLayer=1,g.copyBuffersToTexture([v],this._texture2DArray,[Y])}}return t1.prototype.getTexture=function(g){switch(g){case ow.TEX2D:return this._texture2D;case ow.TEX3D:return this._texture3D;case ow.CUBE:return this._textureCube;case ow.TEX2D_ARRAY:return this._texture2DArray;default:return null}},t1}(),uw=function(g){function e(){var v;return(v=g.call(this,od.SWAPCHAIN)||this)._transform=og.IDENTITY,v._colorTexture=null,v._depthStencilTexture=null,v}return s(e,g),n(e,[{key:"colorTexture",get:function(){return this._colorTexture}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"surfaceTransform",get:function(){return this._transform}},{key:"width",get:function(){return this._colorTexture.width}},{key:"height",get:function(){return this._colorTexture.height}}]),e}(u_),uI=function(g){function e(){var v;return(v=g.call(this,od.FRAMEBUFFER)||this)._renderPass=null,v._colorTextures=[],v._depthStencilTexture=null,v._width=0,v._height=0,v}return s(e,g),n(e,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this.colorTextures.length>0?this.colorTextures[0].width:this.depthStencilTexture?this.depthStencilTexture.width:this._width}},{key:"height",get:function(){return this.colorTextures.length>0?this.colorTextures[0].height:this.depthStencilTexture?this.depthStencilTexture.height:this._height}}]),e}(u_),uB=function(g){function e(){var v;return(v=g.call(this,od.INPUT_ASSEMBLER)||this)._attributes=[],v._attributesHash=0,v._vertexBuffers=[],v._indexBuffer=null,v._indirectBuffer=null,v._drawInfo=new hR,v}s(e,g);var v=e.prototype;return v.getVertexBuffer=function(g){return void 0===g&&(g=0),g<this._vertexBuffers.length?this._vertexBuffers[g]:null},v.computeAttributesHash=function(){for(var g="attrs",v=0;v<this.attributes.length;++v){var S=this.attributes[v];g+=","+S.name+","+S.format+","+S.isNormalized+","+S.stream+","+S.isInstanced+","+S.location}return Sl(g,666)},n(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._drawInfo.vertexCount},set:function(g){this._drawInfo.vertexCount=g}},{key:"firstVertex",get:function(){return this._drawInfo.firstVertex},set:function(g){this._drawInfo.firstVertex=g}},{key:"indexCount",get:function(){return this._drawInfo.indexCount},set:function(g){this._drawInfo.indexCount=g}},{key:"firstIndex",get:function(){return this._drawInfo.firstIndex},set:function(g){this._drawInfo.firstIndex=g}},{key:"vertexOffset",get:function(){return this._drawInfo.vertexOffset},set:function(g){this._drawInfo.vertexOffset=g}},{key:"instanceCount",get:function(){return this._drawInfo.instanceCount},set:function(g){this._drawInfo.instanceCount=g}},{key:"firstInstance",get:function(){return this._drawInfo.firstInstance},set:function(g){this._drawInfo.firstInstance=g}},{key:"drawInfo",get:function(){return this._drawInfo},set:function(g){this._drawInfo=g}}]),e}(u_),uP=function(g){function e(){var v;return(v=g.call(this,od.DESCRIPTOR_SET)||this)._layout=null,v._buffers=[],v._textures=[],v._samplers=[],v._isDirty=!1,v}s(e,g);var v=e.prototype;return v.bindBuffer=function(g,v,S){void 0===S&&(S=0);var O=this._layout.bindingIndices[g],X=this._layout.bindings[O];if(X&&X.descriptorType&ud){var Y=this._layout.descriptorIndices[g];this._buffers[Y+S]!==v&&(this._buffers[Y+S]=v,this._isDirty=!0)}},v.bindSampler=function(g,v,S){void 0===S&&(S=0);var O=this._layout.bindingIndices[g],X=this._layout.bindings[O];if(X&&X.descriptorType&um){var Y=this._layout.descriptorIndices[g];this._samplers[Y+S]!==v&&(this._samplers[Y+S]=v,this._isDirty=!0)}},v.bindTexture=function(g,v,S){void 0===S&&(S=0);var O=this._layout.bindingIndices[g],X=this._layout.bindings[O];if(X&&X.descriptorType&um){var Y=this._layout.descriptorIndices[g];this._textures[Y+S]!==v&&(this._textures[Y+S]=v,this._isDirty=!0)}},v.getBuffer=function(g,v){void 0===v&&(v=0);var S=this._layout.descriptorIndices[g];return this._buffers[S+v]},v.getSampler=function(g,v){void 0===v&&(v=0);var S=this._layout.descriptorIndices[g];return this._samplers[S+v]},v.getTexture=function(g,v){void 0===v&&(v=0);var S=this._layout.descriptorIndices[g];return this._textures[S+v]},n(e,[{key:"layout",get:function(){return this._layout}}]),e}(u_),uD=function(g){function e(){var v;return(v=g.call(this,od.DESCRIPTOR_SET_LAYOUT)||this)._bindings=[],v._bindingIndices=[],v._descriptorIndices=[],v}return s(e,g),n(e,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),e}(u_),uM=function(g){function e(){var v;return(v=g.call(this,od.PIPELINE_LAYOUT)||this)._setLayouts=[],v}return s(e,g),n(e,[{key:"setLayouts",get:function(){return this._setLayouts}}]),e}(u_),uO=function(){function t1(g,v,S,O,X,Y,te,ti,tr,ta,th,tu){void 0===g&&(g=!1),void 0===v&&(v=oJ.FILL),void 0===S&&(S=oZ.GOURAND),void 0===O&&(O=o$.BACK),void 0===X&&(X=!0),void 0===Y&&(Y=!1),void 0===te&&(te=0),void 0===ti&&(ti=0),void 0===tr&&(tr=0),void 0===ta&&(ta=!0),void 0===th&&(th=!1),void 0===tu&&(tu=1),this.isDiscard=g,this.polygonMode=v,this.shadeModel=S,this.cullMode=O,this.isFrontFaceCCW=X,this.depthBiasEnabled=Y,this.depthBias=te,this.depthBiasClamp=ti,this.depthBiasSlop=tr,this.isDepthClip=ta,this.isMultisample=th,this.lineWidth=tu}var g=t1.prototype;return g.reset=function(){this.isDiscard=!1,this.polygonMode=oJ.FILL,this.shadeModel=oZ.GOURAND,this.cullMode=o$.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},g.assign=function(g){Object.assign(this,g)},g.destroy=function(){},n(t1,[{key:"native",get:function(){return this}}]),t1}(),uL=function(){function t1(g,v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf,tp,tm,tg){void 0===g&&(g=!0),void 0===v&&(v=!0),void 0===S&&(S=oF.LESS),void 0===O&&(O=!1),void 0===X&&(X=oF.ALWAYS),void 0===Y&&(Y=65535),void 0===te&&(te=65535),void 0===ti&&(ti=oN.KEEP),void 0===tr&&(tr=oN.KEEP),void 0===ta&&(ta=oN.KEEP),void 0===th&&(th=1),void 0===tu&&(tu=!1),void 0===tl&&(tl=oF.ALWAYS),void 0===tc&&(tc=65535),void 0===t_&&(t_=65535),void 0===tf&&(tf=oN.KEEP),void 0===tp&&(tp=oN.KEEP),void 0===tm&&(tm=oN.KEEP),void 0===tg&&(tg=1),this.depthTest=g,this.depthWrite=v,this.depthFunc=S,this.stencilTestFront=O,this.stencilFuncFront=X,this.stencilReadMaskFront=Y,this.stencilWriteMaskFront=te,this.stencilFailOpFront=ti,this.stencilZFailOpFront=tr,this.stencilPassOpFront=ta,this.stencilRefFront=th,this.stencilTestBack=tu,this.stencilFuncBack=tl,this.stencilReadMaskBack=tc,this.stencilWriteMaskBack=t_,this.stencilFailOpBack=tf,this.stencilZFailOpBack=tp,this.stencilPassOpBack=tm,this.stencilRefBack=tg}var g=t1.prototype;return g.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=oF.LESS,this.stencilTestFront=!1,this.stencilFuncFront=oF.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=oN.KEEP,this.stencilZFailOpFront=oN.KEEP,this.stencilPassOpFront=oN.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=oF.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=oN.KEEP,this.stencilZFailOpBack=oN.KEEP,this.stencilPassOpBack=oN.KEEP,this.stencilRefBack=1},g.assign=function(g){Object.assign(this,g)},g.destroy=function(){},n(t1,[{key:"native",get:function(){return this}}]),t1}(),uN=function(){function t1(g,v,S,O,X,Y,te,ti){void 0===g&&(g=!1),void 0===v&&(v=ok.ONE),void 0===S&&(S=ok.ZERO),void 0===O&&(O=oG.ADD),void 0===X&&(X=ok.ONE),void 0===Y&&(Y=ok.ZERO),void 0===te&&(te=oG.ADD),void 0===ti&&(ti=oV.ALL),this.blend=g,this.blendSrc=v,this.blendDst=S,this.blendEq=O,this.blendSrcAlpha=X,this.blendDstAlpha=Y,this.blendAlphaEq=te,this.blendColorMask=ti}var g=t1.prototype;return g.reset=function(){this.blend=!1,this.blendSrc=ok.ONE,this.blendDst=ok.ZERO,this.blendEq=oG.ADD,this.blendSrcAlpha=ok.ONE,this.blendDstAlpha=ok.ZERO,this.blendAlphaEq=oG.ADD,this.blendColorMask=oV.ALL},g.assign=function(g){Object.assign(this,g)},g.destroy=function(){},t1}(),uk=function(){function t1(g,v,S,O){void 0===g&&(g=!1),void 0===v&&(v=!1),void 0===S&&(S=new hA),void 0===O&&(O=[new uN]),this.isA2C=g,this.isIndepend=v,this.blendColor=S,this.targets=O}var g=t1.prototype;return g.setTarget=function(g,v){var S=this.targets[g];S||(S=this.targets[g]=new uN),Object.assign(S,v)},g.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},g.destroy=function(){},n(t1,[{key:"native",get:function(){return this}}]),t1}(),Z_=function(g,v,S,O,X,Y,te,ti,tr,ta){void 0===g&&(g=null),void 0===v&&(v=null),void 0===S&&(S=null),void 0===O&&(O=new h7),void 0===X&&(X=new uO),void 0===Y&&(Y=new uL),void 0===te&&(te=new uk),void 0===ti&&(ti=oY.TRIANGLE_LIST),void 0===tr&&(tr=o0.NONE),void 0===ta&&(ta=oq.GRAPHICS),this.shader=g,this.pipelineLayout=v,this.renderPass=S,this.inputState=O,this.rasterizerState=X,this.depthStencilState=Y,this.blendState=te,this.primitive=ti,this.dynamicStates=tr,this.bindPoint=ta},uG=function(g){function e(){var v;return(v=g.call(this,od.PIPELINE_STATE)||this)._shader=null,v._pipelineLayout=null,v._primitive=oY.TRIANGLE_LIST,v._is=null,v._rs=new uO,v._dss=new uL,v._bs=new uk,v._dynamicStates=o0.NONE,v._renderPass=null,v}return s(e,g),n(e,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),e}(u_),uV=function(g){function e(){var v;return(v=g.call(this,od.QUEUE)||this)._type=o4.GRAPHICS,v}return s(e,g),n(e,[{key:"type",get:function(){return this._type}}]),e}(u_),uU=function(g){function e(){var v;return(v=g.call(this,od.RENDER_PASS)||this)._colorInfos=[],v._depthStencilInfo=null,v._subpasses=[],v._hash=0,v}return s(e,g),e.prototype.computeHash=function(){var g="";if(this._subpasses.length)for(var v=0;v<this._subpasses.length;++v){var S=this._subpasses[v];if(S.inputs.length){g+="ia";for(var O=0;O<S.inputs.length;++O){var X=this._colorInfos[S.inputs[O]];g+=","+X.format+","+X.sampleCount}}if(S.colors.length){g+="ca";for(var Y=0;Y<S.inputs.length;++Y){var te=this._colorInfos[S.inputs[Y]];g+=","+te.format+","+te.sampleCount}}if(S.depthStencil>=0){var ti=this._colorInfos[S.depthStencil];g+="ds,"+ti.format+","+ti.sampleCount}}else{g+="ca";for(var tr=0;tr<this._colorInfos.length;++tr){var ta=this._colorInfos[tr];g+=","+ta.format+","+ta.sampleCount}var th=this._depthStencilInfo;th&&(g+="ds,"+th.format+","+th.sampleCount)}return Sl(g,666)},n(e,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subpasses}},{key:"hash",get:function(){return this._hash}}]),e}(u_),uH=function(g){function e(v,S){var O;return(O=g.call(this,od.SAMPLER)||this)._info=new hD,O._hash=0,O._info.copy(v),O._hash=S,O}return s(e,g),e.computeHash=function(g){var v=g.minFilter;return v|=g.magFilter<<2,v|=g.mipFilter<<4,v|=g.addressU<<6,v|=g.addressV<<8,v|=g.addressW<<10,(v|=g.maxAnisotropy<<12)|g.cmpFunc<<16},e.unpackFromHash=function(g){var v=new hD;return v.minFilter=(3&g)>>0,v.magFilter=(3&g)>>2,v.mipFilter=(3&g)>>4,v.addressU=(3&g)>>6,v.addressV=(3&g)>>8,v.addressW=(3&g)>>10,v.maxAnisotropy=(15&g)>>12,v.cmpFunc=(7&g)>>16,v},n(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(u_),uz=function(g){function e(){var v;return(v=g.call(this,od.SHADER)||this)._name="",v._stages=[],v._attributes=[],v._blocks=[],v._samplers=[],v}return s(e,g),n(e,[{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}},{key:"stages",get:function(){return this._stages}}]),e}(u_),uW=function(g){function e(){var v;return(v=g.call(this,od.TEXTURE)||this)._info=new hB,v._viewInfo=new hP,v._isPowerOf2=!1,v._isTextureView=!1,v._size=0,v}return s(e,g),e.getLevelCount=function(g,v){return Math.floor(Math.log2(Math.max(g,v)))},n(e,[{key:"type",get:function(){return this._info.type}},{key:"usage",get:function(){return this._info.usage}},{key:"format",get:function(){return this._info.format}},{key:"width",get:function(){return this._info.width}},{key:"height",get:function(){return this._info.height}},{key:"depth",get:function(){return this._info.depth}},{key:"layerCount",get:function(){return this._info.layerCount}},{key:"levelCount",get:function(){return this._info.levelCount}},{key:"samples",get:function(){return this._info.samples}},{key:"flags",get:function(){return this._info.flags}},{key:"size",get:function(){return this._size}},{key:"info",get:function(){return this._info}},{key:"viewInfo",get:function(){return this._viewInfo}},{key:"isTextureView",get:function(){return this._isTextureView}}]),e}(u_),uX=function(g){function e(v,S){var O;return(O=g.call(this,od.GLOBAL_BARRIER)||this)._info=new h$,O._hash=0,O._info.copy(v),O._hash=S,O}return s(e,g),e.computeHash=function(g){return Sl(g.prevAccesses+" "+g.nextAccesses+" "+g.type,666)},n(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(u_),uq=function(g){function e(v,S){var O;return(O=g.call(this,od.TEXTURE_BARRIER)||this)._info=new h0,O._hash=0,O._info.copy(v),O._hash=S,O}return s(e,g),e.computeHash=function(g){var v=g.prevAccesses+" "+g.nextAccesses;return v+=g.type,v+=g.baseMipLevel,v+=g.levelCount,v+=g.baseSlice,v+=g.sliceCount,v+=g.discardContents,v+=g.srcQueue?g.srcQueue.type:0,Sl(v+=g.dstQueue?g.dstQueue.type:0,666)},n(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(u_),uY=function(g){function e(v,S){var O;return(O=g.call(this,od.BUFFER_BARRIER)||this)._info=new h1,O._hash=0,O._info.copy(v),O._hash=S,O}return s(e,g),e.computeHash=function(g){var v=g.prevAccesses+" "+g.nextAccesses;return v+=g.type,v+=g.offset,v+=g.size,v+=g.discardContents,v+=g.srcQueue?g.srcQueue.type:0,Sl(v+=g.dstQueue?g.dstQueue.type:0,666)},n(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(u_),uK={Device:uE,Swapchain:uw,Buffer:uA,Texture:uW,Sampler:uH,Shader:uz,InputAssembler:uB,RenderPass:uU,Framebuffer:uI,DescriptorSet:uP,DescriptorSetLayout:uD,PipelineLayout:uM,PipelineState:uG,CommandBuffer:uT,Queue:uV,GeneralBarrier:uX,TextureBarrier:uq,BufferBarrier:uY,RasterizerState:uO,BlendState:uk,BlendTarget:uN,DepthStencilState:uL,PipelineStateInfo:Z_};Object.assign(uK,uS),X.gfx=uK,function(g){g[g.AUTO=0]="AUTO",g[g.CANVAS=1]="CANVAS",g[g.WEBGL=2]="WEBGL",g[g.HEADLESS=3]="HEADLESS"}(uC||(uC={})),function(g){g[g.UNKNOWN=-1]="UNKNOWN",g[g.CANVAS=0]="CANVAS",g[g.WEBGL=1]="WEBGL",g[g.OPENGL=2]="OPENGL",g[g.HEADLESS=3]="HEADLESS"}(ux||(ux={}));var uJ=function(){function t1(){this.initialized=!1,this._gfxDevice=void 0,this._canvas=null,this._swapchain=void 0,this._renderType=ux.UNKNOWN}var g=t1.prototype;return g.init=function(g,v){if(!this.initialized){var S=tQ.querySettings(tK.Category.RENDERING,"renderMode");if(this._canvas=g,this._renderType=this._determineRenderType(S),this._renderType===ux.WEBGL){var O=new hC(v),Y=!!globalThis.WebGL2RenderingContext;globalThis.navigator.userAgent.toLowerCase(),a3.browserType===ax.UC&&(Y=!1);var te=[];Y&&X.WebGL2Device&&te.push(X.WebGL2Device),X.WebGLDevice&&te.push(X.WebGLDevice),X.EmptyDevice&&te.push(X.EmptyDevice),uE.canvas=g;for(var ti=0;ti<te.length&&(this._gfxDevice=new te[ti],!this._gfxDevice.initialize(O));ti++);this._initSwapchain()}else this._renderType===ux.HEADLESS&&X.EmptyDevice&&(this._gfxDevice=new X.EmptyDevice,this._gfxDevice.initialize(new hC(v)),this._initSwapchain());if(!this._gfxDevice)return k("can not support canvas rendering in 3D"),void(this._renderType=ux.UNKNOWN);this._canvas&&(this._canvas.oncontextmenu=function(){return!1})}},g._initSwapchain=function(){var g=new hE(1,this._canvas),v=a1.windowSize;g.width=v.width,g.height=v.height,this._swapchain=this._gfxDevice.createSwapchain(g)},g._determineRenderType=function(g){("number"!=typeof g||g>ux.HEADLESS||g<uC.AUTO)&&(g=uC.AUTO);var v=ux.CANVAS,S=!1;if(g===uC.CANVAS?(v=ux.CANVAS,S=!0):g===uC.AUTO||g===uC.WEBGL?(v=ux.WEBGL,S=!0):g===uC.HEADLESS&&(v=ux.HEADLESS,S=!0),!S)throw new Error(tt(3820,g));return v},n(t1,[{key:"gfxDevice",get:function(){return this._gfxDevice}},{key:"swapchain",get:function(){return this._swapchain}}]),t1}(),uZ=new uJ;g("ah",Object.freeze({__proto__:null,DescriptorSet:uP,Buffer:uA,CommandBuffer:uT,get ObjectType(){return od},get Status(){return op},get API(){return om},get SurfaceTransform(){return og},get Feature(){return oS},get Format(){return oA},get FormatType(){return oT},get Type(){return oE},get BufferUsageBit(){return oC},get BufferFlagBit(){return ox},get MemoryAccessBit(){return ob},get MemoryUsageBit(){return oR},get TextureType(){return ow},get TextureUsageBit(){return oI},get TextureFlagBit(){return oB},get FormatFeatureBit(){return oP},get SampleCount(){return oD},get VsyncMode(){return oM},get Filter(){return oO},get Address(){return oL},get ComparisonFunc(){return oF},get StencilOp(){return oN},get BlendFactor(){return ok},get BlendOp(){return oG},get ColorMask(){return oV},get ShaderStageFlagBit(){return oU},get LoadOp(){return oH},get StoreOp(){return oz},get AccessFlagBit(){return oW},get ResolveMode(){return oX},get PipelineBindPoint(){return oq},get PrimitiveMode(){return oY},get PolygonMode(){return oJ},get ShadeModel(){return oZ},get CullMode(){return o$},get DynamicStateFlagBit(){return o0},get StencilFace(){return o1},get DescriptorType(){return o2},get QueueType(){return o4},get QueryType(){return o8},get CommandBufferType(){return o6},get ClearFlagBit(){return o7},get BarrierType(){return ht},get PassType(){return he},Size:hn,DeviceCaps:hr,DeviceOptions:ha,Offset:hu,Rect:hl,Extent:hc,TextureSubresLayers:h_,TextureSubresRange:hf,TextureCopy:hd,TextureBlit:hm,BufferTextureCopy:hg,Viewport:hS,Color:hA,BindingMappingInfo:hT,SwapchainInfo:hE,DeviceInfo:hC,BufferInfo:hx,BufferViewInfo:hb,DrawInfo:hR,DispatchInfo:hw,IndirectBuffer:hI,TextureInfo:hB,TextureViewInfo:hP,SamplerInfo:hD,Uniform:hM,UniformBlock:hL,UniformSamplerTexture:hF,UniformSampler:hN,UniformTexture:hk,UniformStorageImage:hG,UniformStorageBuffer:hV,UniformInputAttachment:hU,ShaderStage:hH,Attribute:hz,ShaderInfo:hW,InputAssemblerInfo:hX,ColorAttachment:hq,DepthStencilAttachment:hY,SubpassInfo:hK,SubpassDependency:hJ,RenderPassInfo:hZ,GeneralBarrierInfo:h$,TextureBarrierInfo:h0,BufferBarrierInfo:h1,FramebufferInfo:h2,DescriptorSetLayoutBinding:h3,DescriptorSetLayoutInfo:h4,DescriptorSetInfo:h8,PipelineLayoutInfo:h6,InputState:h7,CommandBufferInfo:ue,QueueInfo:ur,QueryPoolInfo:ua,FormatInfo:v_,MemoryStatus:uu,DynamicStencilStates:ul,DynamicStates:uc,GFXObject:u_,get AttributeName(){return hi},FormatInfos:uf,DESCRIPTOR_BUFFER_TYPE:ud,DESCRIPTOR_SAMPLER_TYPE:um,DESCRIPTOR_DYNAMIC_TYPE:ug,DRAW_INFO_SIZE:28,IsPowerOf2:R_,FormatSize:w_,FormatSurfaceSize:I_,GetTypeSize:P_,getTypedArrayConstructor:D_,formatAlignment:O_,alignTo:M_,Device:uE,DefaultResource:uR,Swapchain:uw,Framebuffer:uI,InputAssembler:uB,DescriptorSetLayout:uD,PipelineLayout:uM,BlendState:uk,BlendTarget:uN,RasterizerState:uO,DepthStencilState:uL,PipelineStateInfo:Z_,PipelineState:uG,Queue:uV,RenderPass:uU,Sampler:uH,Shader:uz,Texture:uW,GeneralBarrier:uX,TextureBarrier:uq,get LegacyRenderMode(){return uC},get RenderType(){return ux},DeviceManager:uJ,deviceManager:uZ}));var uQ=new e$;function ff(g,v,S,O){var X=S.chunk,Y=S.data,te=X.vb,ti=S.vertexCount;g.getWorldMatrix(uQ);for(var tr=0,ta=0;ta<ti;ta++){var th=Y[ta],tu=th.x,tl=th.y,tc=uQ.m03*tu+uQ.m07*tl+uQ.m15;tc=tc?1/tc:1,te[tr+0]=(uQ.m00*tu+uQ.m04*tl+uQ.m12)*tc,te[tr+1]=(uQ.m01*tu+uQ.m05*tl+uQ.m13)*tc,te[tr+2]=(uQ.m02*tu+uQ.m06*tl+uQ.m14)*tc,is.toArray(te,O,tr+5),tr+=9}X.bufferId;for(var t_=X.vertexOffset,tf=X.meshBuffer,tp=X.meshBuffer.iData,tm=tf.indexOffset,tg=0,tv=ti/4;tg<tv;tg++){var ty=t_+4*tg;tp[tm++]=ty,tp[tm++]=ty+1,tp[tm++]=ty+2,tp[tm++]=ty+1,tp[tm++]=ty+3,tp[tm++]=ty+2}tf.indexOffset+=S.indexCount,tf.setDirty()}var u$={},u0=function(){function t1(g){this._map=null,this._count=0,g?(this._map=g,this._count=Object.keys(g).length):(this._map=gt(!0),this._count=0)}var g=t1.prototype;return g.add=function(g,v){return g in this._map||this._count++,this._map[g]=v},g.get=function(g){return this._map[g]},g.has=function(g){return g in this._map},g.remove=function(g){var v=this._map[g];return g in this._map&&(delete this._map[g],this._count--),v},g.clear=function(){0!==this._count&&(this._map=gt(!0),this._count=0)},g.forEach=function(g){for(var v in this._map)g(this._map[v],v)},g.find=function(g){for(var v in this._map)if(g(this._map[v],v))return this._map[v];return null},g.destroy=function(){this._map=null},n(t1,[{key:"map",get:function(){return this._map}},{key:"count",get:function(){return this._count}}]),t1}(),u1=function(){function t1(g,v){this.id=t1._pipelineId++,this.name="",this.pipes=[],this.name=g;for(var S=0,O=v.length;S<O;S++)this.pipes.push(v[S])}var g=t1.prototype;return g.insert=function(g,v){return v>this.pipes.length?(q(4921),this):(this.pipes.splice(v,0,g),this)},g.append=function(g){return this.pipes.push(g),this},g.remove=function(g){return this.pipes.splice(g,1),this},g.sync=function(g){var v=this.pipes;if(0===v.length)return null;g.isFinished=!1;for(var S=0,O=v.length;S<O;){var X=(0,v[S])(g);if(X)return g.isFinished=!0,X;++S!==O&&(g.input=g.output,g.output=null)}return g.isFinished=!0,g.output},g.async=function(g){0!==this.pipes.length&&(g.isFinished=!1,this._flow(0,g))},g._flow=function(g,v){var S=this;(0,this.pipes[g])(v,function(O){O?(v.isFinished=!0,v.dispatch("complete",O)):++g<S.pipes.length?(v.input=v.output,v.output=null,S._flow(g,v)):(v.isFinished=!0,v.dispatch("complete",O,v.output))})},t1}();u1._pipelineId=0,function(){function t1(g){if(this._weakMap={},void 0===window.WeakRef)throw new Error("this platform does not support WeakRef!");if(g)for(var v in g)this._weakMap[v]=new WeakRef(g[v])}var g=t1.prototype;g.add=function(g,v){return this._weakMap[g]=new WeakRef(v),v},g.has=function(g){return g in this._weakMap&&!!this._weakMap[g].deref()},g.get=function(g){return this._weakMap[g]&&this._weakMap[g].deref()},g.remove=function(g){var v=this._weakMap[g];return delete this._weakMap[g],v&&v.deref()},g.clear=function(){this._weakMap=gt(!0)},g.forEach=function(g){for(var v in this._weakMap){var S=this.get(v);S&&g(S,v)}},g.find=function(g){for(var v in this._weakMap){var S=this.get(v);if(S&&g(S,v))return this._weakMap[v].deref()}return null},g.destroy=function(){this._weakMap={}},n(t1,[{key:"count",get:function(){return Object.values(this._weakMap).filter(function(g){return g.deref()}).length}}])}();var u2,u3=new u0,u4=new u0,u8=new u0,u6=new u0,u7=new u1("normal load",[]),u9=new u1("fetch",[]),le=new u1("transform url",[]),li=new Map;!function(g){g.UUID="uuid",g.PATH="path",g.DIR="dir",g.URL="url",g.SCENE="scene"}(u2||(u2={}));var ln,lr={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(g){g.INTERNAL="internal",g.RESOURCES="resources",g.MAIN="main",g.START_SCENE="start-scene"}(ln||(ln={}));var la=function(){function t1(g){this.id=t1._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinished=!0,this.set(g)}t1.create=function(g){var v;return 0!==t1._deadPool.length?(v=t1._deadPool.pop()).set(g):v=new t1(g),v};var g=t1.prototype;return g.set=function(g){void 0===g&&(g=Object.create(null)),this.onComplete=g.onComplete||null,this.onProgress=g.onProgress||null,this.onError=g.onError||null,this.source=this.input=g.input,this.output=null,this.progress=g.progress,this.options=g.options||Object.create(null)},g.dispatch=function(g,v,S,O,X){switch(g){case"complete":this.onComplete&&this.onComplete(v,S);break;case"progress":this.onProgress&&this.onProgress(v,S,O,X);break;case"error":this.onError&&this.onError(v,S,O,X);break;default:var Y="on"+g[0].toUpperCase()+g.substr(1);"function"==typeof this[Y]&&this[Y](v,S,O,X)}},g.recycle=function(){t1._deadPool.length!==t1.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t1._deadPool.push(this))},n(t1,[{key:"isFinish",get:function(){return this.isFinished},set:function(g){this.isFinished=g}}]),t1}();la.MAX_DEAD_NUM=500,la._taskId=0,la._deadPool=[];var lu="0123456789abcdef".split(""),ll=["","","",""],lc=ll.concat(ll,"-",ll,"-",ll,"-",ll,"-",ll,ll,ll),l_=lc.map(function(g,v){return"-"===g?NaN:v}).filter(Number.isFinite);function Of(g){var v=g.split("@")[0];if(22!==v.length)return g;lc[0]=g[0],lc[1]=g[1];for(var S=2,O=2;S<22;S+=2){var X=t8[g.charCodeAt(S)],Y=t8[g.charCodeAt(S+1)];lc[l_[O++]]=lu[X>>2],lc[l_[O++]]=lu[(3&X)<<2|Y>>4],lc[l_[O++]]=lu[15&Y]}return g.replace(v,lc.join(""))}var lf=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function Lf(g,v){(v=v||Object.create(null)).__isNative__=v.isNative,v.nativeExt&&(v.ext=v.nativeExt);var S=u6.find(function(v){return!!v.getAssetInfo(g)});return S&&(v.bundle=S.name),Gf(g,v)}function Ff(g){return!!g&&(_instanceof(g,X.SceneAsset)||_instanceof(g,X.Scene))}function Nf(g){return g&&(46===g.charCodeAt(0)&&47===g.charCodeAt(1)?g=g.slice(2):47===g.charCodeAt(0)&&(g=g.slice(1))),g}function Gf(g,v){var S=la.create({input:g,options:v}),O=[];try{for(var X,Y=f(le.sync(S));!(X=Y()).done;){var te=X.value,ti=te.url;te.recycle(),O.push(ti)}}catch(g){for(var tr,ta=f(S.output);!(tr=ta()).done;)tr.value.recycle();k(g.message,g.stack)}return S.recycle(),O.length>1?O:O[0]}var ld,lm,lg,lA=Object.freeze({__proto__:null,getUuidFromURL:function(g){var v=lf.exec(g);return v?v[1]:""},getUrlWithUuid:Lf,isScene:Ff,normalize:Nf,transform:Gf,decodeUuid:Of}),lE=n2,lC=Us,lx=g("dO",nJ("cc.Asset")((lm=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).loaded=!0,v._native=lg&&lg(),v._nativeUrl="",v._file=null,v._ref=0,Object.defineProperty(c(v),"_uuid",{value:"",writable:!0}),v}s(e,g),e.deserialize=function(g){return X.deserialize(g)};var v=e.prototype;return v.toString=function(){return this.nativeUrl},v.serialize=function(){},v._setRawAsset=function(g,v){void 0===v&&(v=!0),this._native=!1!==v?g||"":"/"+g},v.addRef=function(){return this._ref++,this},v.decRef=function(g){return void 0===g&&(g=!0),this._ref>0&&this._ref--,g&&X.assetManager._releaseManager.tryRelease(this),this},v.onLoaded=function(){},v.initDefault=function(g){g&&(this._uuid=g),this.isDefault=!0},v.validate=function(){return!0},v.destroy=function(){return U(tt(12101,this._uuid)),g.prototype.destroy.call(this)},n(e,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var g=this._native;if(47===g.charCodeAt(0))return g.slice(1);46===g.charCodeAt(0)?this._nativeUrl=Lf(this._uuid,{nativeExt:g,isNative:!0}):this._nativeUrl=Lf(this._uuid,{__nativeName__:g,nativeExt:Mu(g),isNative:!0})}return this._nativeUrl}},{key:"uuid",get:function(){return this._uuid}},{key:"_nativeAsset",get:function(){return this._file},set:function(g){this._file=g}},{key:"nativeAsset",get:function(){return this._file}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),e}(Su(rG)),lg=ws(lm.prototype,"_native",[lE],function(){return""}),p(lm.prototype,"_nativeAsset",[lC],Object.getOwnPropertyDescriptor(lm.prototype,"_nativeAsset"),lm.prototype),ld=lm))||ld);lx.prototype.createNode=null,X.Asset=lx;var lb,lR,lw,lI,lB,lP;!function(g){g[g.RGB565=oA.R5G6B5]="RGB565",g[g.RGB5A1=oA.RGB5A1]="RGB5A1",g[g.RGBA4444=oA.RGBA4]="RGBA4444",g[g.RGB888=oA.RGB8]="RGB888",g[g.RGB32F=oA.RGB32F]="RGB32F",g[g.RGBA8888=oA.RGBA8]="RGBA8888",g[g.RGBA32F=oA.RGBA32F]="RGBA32F",g[g.A8=oA.A8]="A8",g[g.I8=oA.L8]="I8",g[g.AI8=oA.LA8]="AI8",g[g.RGB_PVRTC_2BPPV1=oA.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",g[g.RGBA_PVRTC_2BPPV1=oA.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",g[g.RGB_A_PVRTC_2BPPV1=1024]="RGB_A_PVRTC_2BPPV1",g[g.RGB_PVRTC_4BPPV1=oA.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",g[g.RGBA_PVRTC_4BPPV1=oA.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",g[g.RGB_A_PVRTC_4BPPV1=1025]="RGB_A_PVRTC_4BPPV1",g[g.RGB_ETC1=oA.ETC_RGB8]="RGB_ETC1",g[g.RGBA_ETC1=1026]="RGBA_ETC1",g[g.RGB_ETC2=oA.ETC2_RGB8]="RGB_ETC2",g[g.RGBA_ETC2=oA.ETC2_RGBA8]="RGBA_ETC2",g[g.RGBA_ASTC_4x4=oA.ASTC_RGBA_4X4]="RGBA_ASTC_4x4",g[g.RGBA_ASTC_5x4=oA.ASTC_RGBA_5X4]="RGBA_ASTC_5x4",g[g.RGBA_ASTC_5x5=oA.ASTC_RGBA_5X5]="RGBA_ASTC_5x5",g[g.RGBA_ASTC_6x5=oA.ASTC_RGBA_6X5]="RGBA_ASTC_6x5",g[g.RGBA_ASTC_6x6=oA.ASTC_RGBA_6X6]="RGBA_ASTC_6x6",g[g.RGBA_ASTC_8x5=oA.ASTC_RGBA_8X5]="RGBA_ASTC_8x5",g[g.RGBA_ASTC_8x6=oA.ASTC_RGBA_8X6]="RGBA_ASTC_8x6",g[g.RGBA_ASTC_8x8=oA.ASTC_RGBA_8X8]="RGBA_ASTC_8x8",g[g.RGBA_ASTC_10x5=oA.ASTC_RGBA_10X5]="RGBA_ASTC_10x5",g[g.RGBA_ASTC_10x6=oA.ASTC_RGBA_10X6]="RGBA_ASTC_10x6",g[g.RGBA_ASTC_10x8=oA.ASTC_RGBA_10X8]="RGBA_ASTC_10x8",g[g.RGBA_ASTC_10x10=oA.ASTC_RGBA_10X10]="RGBA_ASTC_10x10",g[g.RGBA_ASTC_12x10=oA.ASTC_RGBA_12X10]="RGBA_ASTC_12x10",g[g.RGBA_ASTC_12x12=oA.ASTC_RGBA_12X12]="RGBA_ASTC_12x12"}(lb||(lb={})),function(g){g[g.REPEAT=oL.WRAP]="REPEAT",g[g.CLAMP_TO_EDGE=oL.CLAMP]="CLAMP_TO_EDGE",g[g.MIRRORED_REPEAT=oL.MIRROR]="MIRRORED_REPEAT",g[g.CLAMP_TO_BORDER=oL.BORDER]="CLAMP_TO_BORDER"}(lR||(lR={})),function(g){g[g.NONE=oO.NONE]="NONE",g[g.LINEAR=oO.LINEAR]="LINEAR",g[g.NEAREST=oO.POINT]="NEAREST"}(lw||(lw={}));var lD=0x50494d43,lM=re({PVR:0,PKM:1,ASTC:2});function td(g,v){return g[v]<<8|g[v+1]}function ed(g){return!!(a3.hasFeature(a3.Feature.IMAGE_BITMAP)&&_instanceof(g,ImageBitmap))}var lO,lL,lF,lN,lk,lG,lV,lU,lH,lz,lW,lX=g("dU",nJ("cc.ImageAsset")(((lP=function(g){s(i,g),i.mergeCompressedTextureMips=function(g){var v=new Uint8Array(0),S=null;try{for(var O,X=8+4*g.length,Y=0,te=f(g);!(O=te()).done;)Y+=O.value.byteLength;Y+=X,v=new Uint8Array(Y);var ti=new DataView(v.buffer,v.byteOffset,v.byteLength);ti.setUint32(0,lD,!0),ti.setUint32(4,g.length,!0);for(var tr=X,ta=0;ta<g.length;ta++){var th=g[ta];if(ti.setUint32(8+4*ta,th.byteLength,!0),_instanceof(th,ArrayBuffer)){var tu=new Uint8Array(th);v.set(tu,tr)}else{var tl=new Uint8Array(th.buffer,th.byteOffset,th.byteLength);v.set(tl,tr)}tr+=th.byteLength}}catch(g){S=g,console.warn(S)}return v},i.parseCompressedTextures=function(g,v){var S={_data:new Uint8Array(0),_compressed:!0,width:0,height:0,format:0,mipmapLevelDataSize:[]},O=_instanceof(g,ArrayBuffer)?g:g.buffer,X=new DataView(O);if(X.getUint32(0,!0)===lD){var Y=X.getUint32(4,!0),te=X.getUint32(8,!0),ti=8+4*Y;i.parseCompressedTexture(g,0,ti,te,v,S);for(var tr=ti+te,ta=1;ta<Y;ta++){var th=X.getUint32(8+4*ta,!0);i.parseCompressedTexture(g,ta,tr,th,v,S),tr+=th}}else i.parseCompressedTexture(g,0,0,0,v,S);return S},i.parseCompressedTexture=function(g,v,S,O,X,Y){switch(X){case lM.PVR:i.parsePVRTexture(g,v,S,O,Y);break;case lM.PKM:i.parsePKMTexture(g,v,S,O,Y);break;case lM.ASTC:i.parseASTCTexture(g,v,S,O,Y)}},i.parsePVRTexture=function(g,v,S,O,X){var Y=_instanceof(g,ArrayBuffer)?g:g.buffer,te=new Int32Array(Y,S,13);if(0x3525650===te[0]){var ti=S+te[12]+52,tr=O-te.byteLength;if(O>0){var ta=new Uint8Array(Y,ti,tr),th=new Uint8Array(X._data.byteLength+ta.byteLength);th.set(X._data),th.set(ta,X._data.byteLength),X._data=th,X.mipmapLevelDataSize[v]=tr}else X._data=new Uint8Array(Y,ti);X.width=v>0?X.width:te[7],X.height=v>0?X.height:te[6]}else{if(0x21525650!==te[11])throw new Error("Invalid magic number in PVR header");var tu=S+te[0],tl=O-te.byteLength;if(O>0){var tc=new Uint8Array(Y,tu,tl),t_=new Uint8Array(X._data.byteLength+tc.byteLength);t_.set(X._data),t_.set(tc,X._data.byteLength),X._data=t_,X.mipmapLevelDataSize[v]=tl}else X._data=new Uint8Array(Y,tu);X.width=v>0?X.width:te[1],X.height=v>0?X.height:te[2]}},i.parsePKMTexture=function(g,v,S,O,X){var Y=_instanceof(g,ArrayBuffer)?g:g.buffer,te=new Uint8Array(Y,S,16),ti=td(te,6);if(0!==ti&&1!==ti&&3!==ti)throw new Error("Invalid magic number in ETC header");var tr=S+16,ta=O-16;if(O>0){var th=new Uint8Array(Y,tr,ta),tu=new Uint8Array(X._data.byteLength+th.byteLength);tu.set(X._data),tu.set(th,X._data.byteLength),X._data=tu,X.mipmapLevelDataSize[v]=ta}else X._data=new Uint8Array(Y,tr);X.width=v>0?X.width:td(te,12),X.height=v>0?X.height:td(te,14)},i.parseASTCTexture=function(g,v,S,O,X){var Y=_instanceof(g,ArrayBuffer)?g:g.buffer,te=new Uint8Array(Y,S,16);if(0x5ca1ab13!==te[0]+(te[1]<<8)+(te[2]<<16)+(te[3]<<24))throw new Error("Invalid magic number in ASTC header");var ti=te[4],tr=te[5],ta=te[6];if((ti<3||ti>6||tr<3||tr>6||ta<3||ta>6)&&(ti<4||7===ti||9===ti||11===ti||ti>12||tr<4||7===tr||9===tr||11===tr||tr>12||1!==ta))throw new Error("Invalid block number in ASTC header");var th=function(g,v){return 4===g?lb.RGBA_ASTC_4x4:5===g?4===v?lb.RGBA_ASTC_5x4:lb.RGBA_ASTC_5x5:6===g?5===v?lb.RGBA_ASTC_6x5:lb.RGBA_ASTC_6x6:8===g?5===v?lb.RGBA_ASTC_8x5:6===v?lb.RGBA_ASTC_8x6:lb.RGBA_ASTC_8x8:10===g?5===v?lb.RGBA_ASTC_10x5:6===v?lb.RGBA_ASTC_10x6:8===v?lb.RGBA_ASTC_10x8:lb.RGBA_ASTC_10x10:10===v?lb.RGBA_ASTC_12x10:lb.RGBA_ASTC_12x12}(ti,tr),tu=S+16,tl=O-16;if(O>0){var tc=new Uint8Array(Y,tu,tl),t_=new Uint8Array(X._data.byteLength+tc.byteLength);t_.set(X._data),t_.set(tc,X._data.byteLength),X._data=t_,X.mipmapLevelDataSize[v]=tl}else X._data=new Uint8Array(Y,tu);X.width=v>0?X.width:te[7]+(te[8]<<8)+(te[9]<<16),X.height=v>0?X.height:te[10]+(te[11]<<8)+(te[12]<<16),X.format=th};var v=i.prototype;function i(v){var S;return(S=g.call(this)||this)._nativeData=void 0,S._exportedExts=void 0,S._format=lb.RGBA8888,S._width=0,S._height=0,S._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1,mipmapLevelDataSize:[]},void 0!==v&&S.reset(v),S}return v.extractMipmap0=function(){if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0){var g=this.mipmapLevelDataSize[0],v=this.data,S=new i({_data:new Uint8Array(v.buffer,0,g),_compressed:!0,width:this.width,height:this.height,format:this.format,mipmapLevelDataSize:[]});return S._uuid=""+this._uuid,S}return this},v.extractMipmaps=function(){var g=[];if(this.mipmapLevelDataSize&&this.mipmapLevelDataSize.length>0)for(var v,S=this.mipmapLevelDataSize,O=this.data,X=0,Y=this.height,te=this.width,ti=f(S);!(v=ti()).done;){var tr=v.value,ta=new i({_data:new Uint8Array(O.buffer,X,tr),_compressed:!0,width:te,height:Y,format:this.format,mipmapLevelDataSize:[]});X+=tr,ta._uuid=""+this._uuid,te=Math.max(te>>1,1),Y=Math.max(Y>>1,1),g.push(ta)}else g.push(this);return g},v.reset=function(g){ed(g)||_instanceof(g,HTMLElement)?this._nativeData=g:(this._nativeData=g,this._format=g.format)},v.destroy=function(){if(this.data&&_instanceof(this.data,HTMLImageElement))this.data.src="",this._setRawAsset("");else if(ed(this.data)){var v;null===(v=this.data)||void 0===v||v.close()}return g.prototype.destroy.call(this)},v._serialize=function(){},v._deserialize=function(g){var v="";"string"==typeof g?v=g:(this._width=g.w,this._height=g.h,v=g.fmt);for(var S,O=uZ.gfxDevice,X=v.split("_"),Y=Number.MAX_VALUE,te=this._format,ti="",tr=t$.SUPPORT_TEXTURE_FORMATS,ta=f(X);!(S=ta()).done;){var th=S.value.split("@"),tu=parseInt(th[0],void 0),tl=i.extnames[tu]||th[0],tc=tr.indexOf(tl);if(-1!==tc&&tc<Y){var t_=th[1]?parseInt(th[1]):this._format;if(!(".astc"!==tl||O&&O.getFormatFeatures(oA.ASTC_RGBA_4X4)&oP.SAMPLED_TEXTURE))continue;if(!(".pvr"!==tl||O&&O.getFormatFeatures(oA.PVRTC_RGBA4)&oP.SAMPLED_TEXTURE))continue;if(!(t_!==lb.RGB_ETC1&&t_!==lb.RGBA_ETC1||O&&O.getFormatFeatures(oA.ETC_RGB8)&oP.SAMPLED_TEXTURE))continue;if(!(t_!==lb.RGB_ETC2&&t_!==lb.RGBA_ETC2||O&&O.getFormatFeatures(oA.ETC2_RGB8)&oP.SAMPLED_TEXTURE))continue;if(".webp"===tl&&!a3.hasFeature(a3.Feature.WEBP))continue;Y=tc,ti=tl,te=t_}}ti?(this._setRawAsset(ti),this._format=te):q(3121)},v.initDefault=function(v){if(g.prototype.initDefault.call(this,v),i._sharedPlaceHolderCanvas)this.reset(i._sharedPlaceHolderCanvas);else{var S=te.document.createElement("canvas"),O=S.getContext("2d"),X=S.width=S.height=2;O.fillStyle="#ff00ff",O.fillRect(0,0,X,X),this.reset(S),i._sharedPlaceHolderCanvas=S}},v.validate=function(){return!!this.data},n(i,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(g){_instanceof(g,HTMLElement)||ed(g)||(g.format=g.format||this._format),this.reset(g)}},{key:"data",get:function(){var g;return _instanceof(g=this._nativeData,HTMLImageElement)||_instanceof(g,HTMLCanvasElement)||ed(g)?this._nativeData:this._nativeData&&this._nativeData._data}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=lb.RGB_ETC1&&this._format<=lb.RGBA_ASTC_12x12||this._format>=lb.RGB_A_PVRTC_2BPPV1&&this._format<=lb.RGBA_ETC1}},{key:"mipmapLevelDataSize",get:function(){return this._nativeData.mipmapLevelDataSize}},{key:"url",get:function(){return this.nativeUrl}}]),i}(lx)).extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],lP._sharedPlaceHolderCanvas=null,p((lB=lP).prototype,"_nativeAsset",[rE],Object.getOwnPropertyDescriptor(lB.prototype,"_nativeAsset"),lB.prototype),lI=lB))||lI);X.ImageAsset=lX,oe(oA);var lj,lq,lY,lK=new tT("Tex"),lJ=nJ("cc.TextureBase")(((lW=function(g){function e(){var v;return(v=g.call(this)||this)._format=lF&&lF(),v._minFilter=lN&&lN(),v._magFilter=lk&&lk(),v._mipFilter=lG&&lG(),v._wrapS=lV&&lV(),v._wrapT=lU&&lU(),v._wrapR=lH&&lH(),v._anisotropy=lz&&lz(),v._width=1,v._height=1,v._id=void 0,v._samplerInfo=new hD,v._gfxSampler=null,v._gfxDevice=null,v._textureHash=0,v._id=lK.getNewId(),v._gfxDevice=v._getGFXDevice(),v._textureHash=Sl(v._id,666),v}s(e,g);var v=e.prototype;return v.getId=function(){return this._id},v.getPixelFormat=function(){return this._format},v.getAnisotropy=function(){return this._anisotropy},v.setWrapMode=function(g,v,S){void 0===S&&(S=g),this._wrapS=g,this._samplerInfo.addressU=g,this._wrapT=v,this._samplerInfo.addressV=v,this._wrapR=S,this._samplerInfo.addressW=S,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},v.setFilters=function(g,v){this._minFilter=g,this._samplerInfo.minFilter=g,this._magFilter=v,this._samplerInfo.magFilter=v,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},v.setMipFilter=function(g){this._mipFilter=g,this._samplerInfo.mipFilter=g,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},v.setAnisotropy=function(g){this._anisotropy=g,this._samplerInfo.maxAnisotropy=g,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},v.destroy=function(){var v,S=g.prototype.destroy.call(this);return S&&null!==(v=X.director.root)&&void 0!==v&&v.batcher2D&&X.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),S},v.getHash=function(){return this._textureHash},v.getGFXTexture=function(){return null},v.getSamplerInfo=function(){return this._samplerInfo},v.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo):J(9302)),this._gfxSampler},v._serialize=function(){return""},v._deserialize=function(g){var v=g.split(",");v.unshift(""),v.length>=5&&(this.setFilters(parseInt(v[1]),parseInt(v[2])),this.setWrapMode(parseInt(v[3]),parseInt(v[4]))),v.length>=7&&(this.setMipFilter(parseInt(v[5])),this.setAnisotropy(parseInt(v[6])))},v._getGFXDevice=function(){return uZ.gfxDevice},v._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},v._setGFXFormat=function(g){this._format=void 0===g?lb.RGBA8888:g},v._getGFXPixelFormat=function(g){return g===lb.RGBA_ETC1?g=lb.RGB_ETC1:g===lb.RGB_A_PVRTC_4BPPV1?g=lb.RGB_PVRTC_4BPPV1:g===lb.RGB_A_PVRTC_2BPPV1&&(g=lb.RGB_PVRTC_2BPPV1),g},n(e,[{key:"isCompressed",get:function(){return this._format>=lb.RGB_ETC1&&this._format<=lb.RGBA_ASTC_12x12||this._format>=lb.RGB_A_PVRTC_2BPPV1&&this._format<=lb.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),e}(lx)).PixelFormat=lb,lW.WrapMode=lR,lW.Filter=lw,lF=ws((lL=lW).prototype,"_format",[n2],function(){return lb.RGBA8888}),lN=ws(lL.prototype,"_minFilter",[n2],function(){return lw.LINEAR}),lk=ws(lL.prototype,"_magFilter",[n2],function(){return lw.LINEAR}),lG=ws(lL.prototype,"_mipFilter",[n2],function(){return lw.NONE}),lV=ws(lL.prototype,"_wrapS",[n2],function(){return lR.REPEAT}),lU=ws(lL.prototype,"_wrapT",[n2],function(){return lR.REPEAT}),lH=ws(lL.prototype,"_wrapR",[n2],function(){return lR.REPEAT}),lz=ws(lL.prototype,"_anisotropy",[n2],function(){return 0}),lO=lL))||lO;X.TextureBase=lJ;var lZ=g("d_",nJ("cc.Script")(lj=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(lx))||lj);X._Script=lZ;var l$=g("d$",nJ("cc.JavaScript")(lq=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(lZ))||lq);X._JavaScript=l$;var l0,l1,l2,l3,l4,l8,l6,l7=g("e0",nJ("cc.TypeScript")(lY=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(lZ))||lY);X._TypeScript=l7;var l9,ce,ci,cn,ca,ch,cu,cl,cc,c_,cf,cd=g("dh",nJ("cc.ClickEvent")((l1=function(){function t1(){this.target=l2&&l2(),this.component=l3&&l3(),this._componentId=l4&&l4(),this.handler=l8&&l8(),this.customEventData=l6&&l6()}t1.emitEvents=function(g){for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];for(var X=0,Y=g.length;X<Y;X++){var te=g[X];_instanceof(te,t1)&&te.emit(S)}};var g=t1.prototype;return g.emit=function(g){var v=this.target;if(X.isValid(v)){this._genCompIdIfNeeded();var S=X.js.getClassById(this._componentId),O=v.getComponent(S);if(X.isValid(O)){var Y=O[this.handler];"function"==typeof Y&&(null!=this.customEventData&&""!==this.customEventData&&(g=g.slice()).push(this.customEventData),Y.apply(O,g))}}},g._compName2Id=function(g){var v=X.js.getClassByName(g);return X.js.getClassId(v)},g._compId2Name=function(g){var v=X.js.getClassById(g);return X.js.getClassName(v)},g._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},n(t1,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(g){this._componentId=this._compName2Id(g)}}]),t1}(),l2=ws(l1.prototype,"target",[n2],function(){return null}),l3=ws(l1.prototype,"component",[n2],function(){return""}),l4=ws(l1.prototype,"_componentId",[n2],function(){return""}),l8=ws(l1.prototype,"handler",[n2],function(){return""}),l6=ws(l1.prototype,"customEventData",[n2],function(){return""}),l0=l1))||l0),cm=new tT("Comp"),cg=rG.Flags.IsOnLoadCalled,cS=g("di",(l9=nJ("cc.Component"),ce=ma(lZ),l9(((cl=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).node=ca&&ca(),v._enabled=ch&&ch(),v.__prefab=cu&&cu(),v._sceneGetter=null,v._id=cm.getNewId(),v}s(e,g);var v=e.prototype;return v._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene},v.addComponent=function(g){return this.node.addComponent(g)},v.getComponent=function(g){return this.node.getComponent(g)},v.getComponents=function(g){return this.node.getComponents(g)},v.getComponentInChildren=function(g){return this.node.getComponentInChildren(g)},v.getComponentsInChildren=function(g){return this.node.getComponentsInChildren(g)},v.destroy=function(){return!!g.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&X.director._compScheduler.disableComp(this),!0)},v._onPreDestroy=function(){this.unscheduleAllCallbacks(),X.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},v._instantiate=function(g){return g||(g=X.instantiate._clone(this,this)),g&&(g.node=null),g},v.schedule=function(g,v,S,O){void 0===v&&(v=0),void 0===S&&(S=X.macro.REPEAT_FOREVER),void 0===O&&(O=0),$(Boolean(g),1619),$((v=v||0)>=0,1620),S=Number.isNaN(S)?X.macro.REPEAT_FOREVER:S,O=O||0;var Y=X.director.getScheduler(),te=Y.isTargetPaused(this);Y.schedule(g,this,v,S,O,te)},v.scheduleOnce=function(g,v){void 0===v&&(v=0),this.schedule(g,0,0,v)},v.unschedule=function(g){g&&X.director.getScheduler().unschedule(g,this)},v.unscheduleAllCallbacks=function(){X.director.getScheduler().unscheduleAllForTarget(this)},n(e,[{key:"name",get:function(){if(this._name)return this._name;var g=vt(this),v=g.lastIndexOf(".");return v>=0&&(g=g.slice(v+1)),this.node?this.node.name+"<"+g+">":g},set:function(g){this._name=g}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(g){if(this._enabled!==g&&(this._enabled=g,this.node.activeInHierarchy)){var v=X.director._compScheduler;g?v.enableComp(this):v.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&cg}},{key:"internalUpdate",get:function(){return this.update}},{key:"internalLateUpdate",get:function(){return this.lateUpdate}},{key:"internalPreload",get:function(){return this.__preload}},{key:"internalOnLoad",get:function(){return this.onLoad}},{key:"internalStart",get:function(){return this.start}},{key:"internalOnEnable",get:function(){return this.onEnable}},{key:"internalOnDisable",get:function(){return this.onDisable}},{key:"internalOnDestroy",get:function(){return this.onDestroy}}]),e}(rG)).EventHandler=cd,cl._executionOrder=0,cl._requireComponent=null,cl.system=null,p((cn=cl).prototype,"__scriptAsset",[ce],Object.getOwnPropertyDescriptor(cn.prototype,"__scriptAsset"),cn.prototype),ca=ws(cn.prototype,"node",[n2],function(){return null}),ch=ws(cn.prototype,"_enabled",[n2],function(){return!0}),cu=ws(cn.prototype,"__prefab",[n2],function(){return null}),ci=cn))||ci));tw(cS,"_registerEditorProps",function(g,v){var S=v.requireComponent;S&&(Array.isArray(S)&&(S=S.filter(Boolean)),g._requireComponent=S);var O=v.executionOrder;O&&"number"==typeof O&&(g._executionOrder=O)}),X.Component=cS;var cA=g("dF",nJ("cc.MissingScript")((c_=function(g){function e(){var v;return(v=g.call(this)||this)._$erialized=cf&&cf(),v}return s(e,g),e.safeFindClass=function(g){var v=Ht(g);if(v)return v;X.deserialize.reportMissingClass(g)},e.prototype.onLoad=function(){q(4600,this.node.name)},e}(cS),cf=ws(c_.prototype,"_$erialized",[n2,qs],function(){return null}),cc=c_))||cc);X._MissingScript=cA;try{var cT=cA.__values__;0!==cT.length&&"_$erialized"===cT[cT.length-1]||(k("The '_$erialized' prop in MissingScript is missing. Please contact jare."),k("    Error props: ['"+cT+"']"))}catch(g){k("Error when checking MissingScript 5, "+g)}var cE=function(){function t1(g,v){this._document=void 0,this._chunks=void 0,this._document=g,this._chunks=v}return n(t1,[{key:"document",get:function(){return this._document}},{key:"chunks",get:function(){return this._chunks}}]),t1}();function Yd(g){var v=g;return{chunks:v.chunks,document:v.document}}function qd(g){if(g.length<16)throw new cC(tt(13102));var v=new DataView(g.buffer,g.byteOffset,g.byteLength);if(0x4e4f4343!==v.getUint32(0,!0))throw new cC(tt(13100));var S=v.getUint32(4,!0);if(1!==S)throw new cC(tt(13101,S));if(v.getUint32(8,!0)!==v.byteLength)throw new cC(tt(13102));var O=12,X=v.getUint32(O,!0);O+=4;var Y=new Uint8Array(v.buffer,O+v.byteOffset,X);O+=X;var te,ti=function(g){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(g);if("Buffer"in globalThis)return globalThis.Buffer.from(g.buffer,g.byteOffset,g.byteLength).toString();throw new Error(tt(13104))}(Y);try{te=JSON.parse(ti)}catch(g){throw new cC(g)}for(var tr=[];O<v.byteLength;){O%8!=0&&(O+=8-O%8);var ta=v.getUint32(O,!0);O+=4,tr.push(new Uint8Array(v.buffer,O+v.byteOffset,ta)),O+=ta}if(O!==v.byteLength)throw new cC(tt(13102));return new cE(te,tr)}var cC=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(l(Error));function Jd(g,v,S,O,Y){if(_instanceof(v,X.ValueType)){Y||g.push("if(prop){");var te=vt(v);g.push("s._deserializeFastDefinedObject(o"+S+",prop,"+te+");"),Y||g.push("}else o"+S+"=null;")}else g.push("\nif (prop) {\n    s._deserializeAndAssignField(o, prop, "+O+");\n} else {\n    o"+S+"=null;\n}\n")}!function(){function t1(){this._viewOrPaddings=[],this._length=0}var g=t1.prototype;g.alignAs=function(g){if(0!==g){var v=this._length%g;if(0!==v){var S=g-v;return this._viewOrPaddings.push(S),this._length+=S,S}}return 0},g.append=function(g){var v=this._length;return this._viewOrPaddings.push(g),this._length+=g.byteLength,v},g.get=function(){var g=new Uint8Array(this._length),v=0;return this._viewOrPaddings.forEach(function(S){"number"==typeof S?v+=S:(g.set(new Uint8Array(S.buffer,S.byteOffset,S.byteLength),v),v+=S.byteLength)}),g},n(t1,[{key:"byteLength",get:function(){return this._length}}])}(),X.internal.parseCCONJson=Yd,X.internal.decodeCCONBinary=qd,X.internal.CCON=cE;var cx=ri.Attr.DELIMETER,cb=cx+"type",cR=cx+"default",cw=cx+"formerlySerializedAs";function ep(g,v){if(void 0===g)return _instanceof(v,ri.Attr.PrimitiveType)||v===ef||v===em;var S=void 0===g?"undefined":_type_of(g);return"string"===S||"number"===S||"boolean"===S}var cI=function(g){function e(){return g.call(this,function(g){g.clear()},1)||this}return s(e,g),e}(tU);cI.prototype.get=function(g,v,S,O,X){var Y=this._get();return Y?(Y.reset(g,v,S,O,X),Y):new cB(g,v,S,O,X)};var cB=function(){function t1(g,v,S,O){this.deserializedList=void 0,this.deserializedData=void 0,this._ignoreEditorOnly=void 0,this.result=g,this.customEnv=O,this.deserializedList=[],this.deserializedData=null,this._classFinder=v,this._reportMissingClass=S,this._onDereferenced=null==v?void 0:v.onDereferenced}var g=t1.prototype;return g.reset=function(g,v,S,O){this.result=g,this.customEnv=O,this._classFinder=v,this._reportMissingClass=S,this._onDereferenced=null==v?void 0:v.onDereferenced},g.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null},g.deserialize=function(g){var v,S=!1;_instanceof(g,cE)?(S=!0,v=g.document,g.chunks.length>0&&(g.chunks.length,this._mainBinChunk=g.chunks[0])):v=g,this._serializedData=v,this._context={fromCCON:S};var O=Array.isArray(v)?v[0]:v;return this.deserializedData=this._deserializeObject(O,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData},g._deserializeObject=function(g,v,S,O){switch(g.__type__){case"TypedArray":return this._deserializeTypedArrayView(g);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(g);default:return g.__type__?this._deserializeTypeTaggedObject(g,v,S,O):Array.isArray(g)?this._deserializeArray(g):this._deserializePlainObject(g)}},g._deserializeTypedArrayView=function(g){return globalThis[g.ctor].from(g.array)},g._deserializeTypedArrayViewRef=function(g){var v=g.offset,S=g.length,O=g.ctor;return new globalThis[O](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+v,S)},g._deserializeArray=function(g){for(var v,S=new Array(g.length),O=0;O<g.length;O++)"object"==_type_of(v=g[O])&&v?this._deserializeAndAssignField(S,v,""+O)&&(S[O]=null):S[O]=v;return S},g._deserializePlainObject=function(g){var v={};return this._fillPlainObject(v,g),v},g._deserializeTypeTaggedObject=function(g,v,S,O){var X=this,Y=g.__type__,te=this._classFinder(Y,g,S,O);if(!te)return this._classFinder===Ht&&this._reportMissingClass(Y),null;var ti=function(g){var S=new g;return v>=0&&(X.deserializedList[v]=S),S}(te);return this._deserializeInto(g,ti,te),ti},g._deserializeInto=function(g,v,S,O){void 0===O&&(O=!1),O||!v[rH]?v._deserialize?v._deserialize(g.content,this):X.Class._isCCClass(S)?this._deserializeFireClass(v,g,S):this._deserializeFastDefinedObject(v,g,S):this._runCustomizedDeserialize(g,v,S)},g._runCustomizedDeserialize=function(g,v,S){var O=this,X={readProperty:function(v){var S=g[v];return"object"==(void 0===S?"undefined":_type_of(S))&&S?O._deserializeObjectField(S):S},readThis:function(){O._deserializeInto(g,v,S,!0)},readSuper:function(){var X=Bt(S);X&&O._deserializeInto(g,v,X)}};v[rH](X,this._context)},g._deserializeFireClass=function(g,v,S){var O;if(S.hasOwnProperty("__deserialize__"))O=S.__deserialize__;else{O=function(g,v){for(var S=ri.Attr.getClassAttrs(v),O=v.__values__,Y=["var prop;"],te=function(g){return t0.test(Xt(g))}(v),ti=0;ti<O.length;ti++){var tr=O[ti],ta=void 0,th=void 0;ri.IDENTIFIER_RE.test(tr)?(th='"'+tr+'"',ta="."+tr):ta="["+(th=ri.escapeForJS(tr))+"]";var tu=ta;if(S[tr+cw]){var tl=S[tr+cw];tu=ri.IDENTIFIER_RE.test(tl)?"."+tl:"["+ri.escapeForJS(tl)+"]"}Y.push("prop=d"+tu+";"),Y.push('if(typeof prop!=="undefined"){');var tc=ri.getDefault(S[tr+cR]),t_=S[tr+cb];te&&(void 0!==tc||t_)?ep(tc,t_)?Y.push("o"+ta+"=prop;"):Jd(Y,tc,ta,th,!0):(Y.push('if(typeof prop!=="object"){o'+ta+"=prop;}else{"),Jd(Y,tc,ta,th,!1),Y.push("}")),Y.push("}")}return(Pt(v,X.Node)||Pt(v,X.Component))&&Y.push("d._id&&(o._id=d._id);"),"_$erialized"===O[O.length-1]&&(Y.push("o._$erialized=JSON.parse(JSON.stringify(d));"),Y.push("s._fillPlainObject(o._$erialized,d);")),Function("s","o","d","k",Y.join(""))}(0,S);try{if(S===cA){var Y=S.__values__;0!==Y.length&&"_$erialized"===Y[Y.length-1]||(k("The '_$erialized' prop of MissingScript is missing. Will force the raw data to be save."),k("    Error props: ['"+Y+"']. Please contact jare."));var te=O;O=function(g,v,S,O){te(g,v,S,O),v._$erialized||k("Unable to stash previously serialized data. "+JSON.stringify(S))}}}catch(g){k("Error when checking MissingScript 6, "+g)}tw(S,"__deserialize__",O,!0)}O(this,g,v,S)},g._deserializeAndAssignField=function(g,v,S){var O=v.__id__;if("number"==typeof O){var X=this.deserializedList[O];if(X)g[S]=X;else{var Y,te=this._serializedData[O];g[S]=this._deserializeObject(te,O,void 0,S),null===(Y=this._onDereferenced)||void 0===Y||Y.call(this,this.deserializedList,O,g,S)}}else{var ti=v.__uuid__;if(ti){var tr=v.__expectedType__;this.result.push(g,S,ti,tr)}else g[S]=this._deserializeObject(v,-1)}return!1},g._deserializeObjectField=function(g){var v=g.__id__;if("number"==typeof v){var S=this.deserializedList[v];if(S)return S;var O=this._serializedData[v];return this._deserializeObject(O,v,void 0,void 0)}if(g.__uuid__)throw g.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(g,-1)},g._fillPlainObject=function(g,v){for(var S in v)if(v.hasOwnProperty(S)){var O=v[S];"object"!=(void 0===O?"undefined":_type_of(O))?"__type__"!==S&&(g[S]=O):O?this._deserializeAndAssignField(g,O,S)&&(g[S]=null):g[S]=null}},g._deserializeFastDefinedObject=function(g,v,S){if(S===X.Vec2)return g.x=v.x||0,void(g.y=v.y||0);if(S===X.Vec3)return g.x=v.x||0,g.y=v.y||0,void(g.z=v.z||0);if(S!==X.Color){if(S===X.Size)return g.width=v.width||0,void(g.height=v.height||0);for(var O=ri.Attr.getClassAttrs(S),Y=S.__values__,te=0;te<Y.length;te++){var ti=Y[te],tr=v[ti];void 0!==tr||v.hasOwnProperty(ti)||(tr=ri.getDefault(O[ti+cR])),"object"!=(void 0===tr?"undefined":_type_of(tr))?g[ti]=tr:tr?this._deserializeAndAssignField(g,tr,ti):g[ti]=null}}else{g.r=v.r||0,g.g=v.g||0,g.b=v.b||0;var ta=v.a;g.a=void 0===ta?255:ta}},n(t1,[{key:"ignoreEditorOnly",get:function(){return this._ignoreEditorOnly}}]),t1}();cB.pool=new cI;var cP=[e8,eL,e7,eW,is,iu,ic,e$];function sp(g,v){g.x=v[1],g.y=v[2],g.z=v[3],g.w=v[4]}var cD=[function(g,v){g.x=v[1],g.y=v[2]},function(g,v){g.x=v[1],g.y=v[2],g.z=v[3]},sp,sp,function(g,v){g._val=v[1]},function(g,v){g.width=v[1],g.height=v[2]},function(g,v){g.x=v[1],g.y=v[2],g.width=v[3],g.height=v[4]},function(g,v){e$.fromArray(g,v,1)}],cM=g("dM",function(){function t1(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var g=t1.prototype;return g.init=function(g){g?(this.uuidObjList=g[8],this.uuidPropList=g[9],this.uuidList=g[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},g.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},g.push=function(g,v,S,O){this.uuidObjList.push(g),this.uuidPropList.push(v),this.uuidList.push(S),this.uuidTypeList.push(O||"")},t1}());function hp(g,v){for(var S=g[4][v[0]],O=S[0],X=new O[0],Y=O[1],te=O[2],ti=S[S.length-1],tr=1;tr<ti;++tr)X[Y[S[tr]]]=v[tr];for(;tr<v.length;++tr){var ta=Y[S[tr]],th=O[S[tr]+te];(0,cO[th])(g,X,ta,v[tr])}return X}function up(g,v,S){var O=new v;return O._deserialize?O._deserialize(S,g[0]):J(5303,vt(v)),O}function lp(g,v,S,O){O>=0?v[S]=g[5][O]:g[7][3*~O]=v}function cp(g){return function(v,S,O,X){for(var Y=0;Y<X.length;++Y)g(v,X,Y,X[Y]);S[O]=X}}function _p(g,v,S,O){v[S]=null,g[8][O]=v}function fp(g,v,S,O){v[S]=hp(g,O)}cM.pool=new tU(function(g){g.reset()},5),cM.pool.get=function(){return this._get()||new cM};var cO=new Array(13);function pp(g,v,S){return g||S(v),Object}function mp(g,v,S,O,X,Y,te){var ti=g(v);if(!ti){if(X)return void(S[O]=function(v,S,O){return function(){var X=g(O)||pp(Y,O,te);return v[S]=X,new X}}(S,O,v));ti=pp(Y,v,te)}S[O]=ti}function gp(g,v,S,O){for(var X=S||Ht,Y=g[3],te=0;te<Y.length;++te){var ti=Y[te];"string"!=typeof ti?mp(X,ti[0],ti,0,v,S,O):mp(X,ti,Y,te,v,S,O)}}function vp(g){var v=g[4];if(v)for(var S=g[3],O=0;O<v.length;++O){var X=v[O];X[0]=S[X[0]]}}function yp(g,v,S){"string"==typeof g&&(g=JSON.parse(g));var O,Y=!1;if(v||(v=cM.pool.get(),Y=!0),function(g){if(Array.isArray(g)){var v=g[0];return"number"==typeof v||_instanceof(v,Sp)}return!1}(g)){!function(g,v,S){var O;v.init(g),null!==(O=S)&&void 0!==O||(S={});var X=g[0],Y=!1;if("object"==(void 0===X?"undefined":_type_of(X))&&(Y=X.preprocessed,X=X.version),X<1)throw new Error(tt(5304,X));var te,ti=S;ti._version=X,ti.result=v,g[0]=ti,Y||(gp(g,!1,S.classFinder,null!==(te=S.reportMissingClass)&&void 0!==te?te:yp.reportMissingClass),vp(g))}(g,v,S);var te=g;X.game._isCloning=!0;var ti=te[5],tr=function(g){var v=g[5],S=g[6],O=0===S?0:S.length,X=v[v.length-1],Y=v.length-O;"number"!=typeof X?X=0:(X<0&&(X=~X),--Y);for(var te=0;te<Y;++te)v[te]=hp(g,v[te]);for(var ti=g[3],tr=0;tr<O;++tr,++te){var ta=S[tr],th=v[te];if(ta>=0){var tu=ti[ta];v[te]=up(g,tu,th)}else(0,cO[ta=~ta])(g,v,te,th)}return X}(te);X.game._isCloning=!1,te[7]&&function(g,v,S){for(var O=g.length-1,X=0,Y=3*g[O];X<Y;X+=3){var te=g[X],ti=v[g[X+2]],tr=g[X+1];tr>=0?te[S[tr]]=ti:te[~tr]=ti}for(;X<O;X+=3){var ta=v[g[X]],th=v[g[X+2]],tu=g[X+1];tu>=0?ta[S[tu]]=th:ta[~tu]=th}}(te[7],ti,te[2]),function(g){for(var v=g[5],S=g[2],O=g[1],X=g[8],Y=g[9],te=g[10],ti=0;ti<X.length;++ti){var tr=X[ti];"number"==typeof tr&&(X[ti]=v[tr]);var ta=Y[ti];"number"==typeof ta&&(ta=ta>=0?S[ta]:~ta,Y[ti]=ta);var th=te[ti];"number"==typeof th&&(te[ti]=O[th])}}(te),O=ti[tr]}else O=function(g,v,S){var O,Y=(S=S||{}).classFinder||Ht,te=S.createAssetRefs||a3.platform===aI.EDITOR_CORE,ti=S.customEnv,tr=S.ignoreEditorOnly,ta=null!==(O=S.reportMissingClass)&&void 0!==O?O:X.deserialize.reportMissingClass;v.init();var th=cB.pool.get(v,Y,ta,ti,tr);X.game._isCloning=!0;var tu=th.deserialize(g);return X.game._isCloning=!1,cB.pool.put(th),te&&v.assignAssetsBy(function(g,v){return EditorExtends.serialize.asAsset(g,v.type)}),tu}(g,v,S);return Y&&cM.pool.put(v),O}cO[0]=function(g,v,S,O){v[S]=O},cO[1]=lp,cO[2]=cp(lp),cO[3]=cp(_p),cO[4]=fp,cO[5]=function(g,v,S,O){var X=O[0],Y=v[S];(0,cD[X])(Y,O)},cO[6]=_p,cO[7]=function(g,v,S,O){v[S].set(O)},cO[8]=function(g,v,S,O){var X=O[0],Y=new cP[X];(0,cD[X])(Y,O),v[S]=Y},cO[9]=cp(fp),cO[10]=function(g,v,S,O){var X=g[3][O[0]];v[S]=up(g,X,O[1])},cO[11]=function(g,v,S,O){var X=O[0];v[S]=X;for(var Y=1;Y<O.length;Y+=3){var te=O[Y],ti=O[Y+1],tr=O[Y+2];(0,cO[ti])(g,X,te,tr)}},cO[12]=function(g,v,S,O){for(var X=O[0],Y=0;Y<X.length;++Y){var te=X[Y],ti=O[Y+1];0!==ti&&(0,cO[ti])(g,X,Y,te)}v[S]=X},yp.Details=cM,yp.reportMissingClass=function(g){J(5302,g)};var Sp=function(g){this.preprocessed=!0,this.version=g};function Ap(g,v,S){return[1,0,0,[g],0,S?[v,-1]:[v],[0],0,[],[],[]]}X.deserialize=yp;var cF=new WeakMap,cN=new WeakSet,ck=new WeakSet;function bp(g,v){var S;S=cA.safeFindClass;var O,X=cM.pool.get();try{O=yp(g,X,{classFinder:S,customEnv:v})}catch(g){throw k(g),cM.pool.put(X),g}O._uuid=v.__uuid__||"";for(var Y=X.uuidList,te=X.uuidObjList,ti=X.uuidPropList,tr=X.uuidTypeList||[],ta=[],th=0;th<Y.length;th++){var tu=Y[th];ta[th]={uuid:Of(tu),owner:te[th],prop:ti[th],type:Ht(tr[th])}}return cF.set(O,ta),O._native&&cN.add(O),cM.pool.put(X),O}var cG=function(){function t1(){this._depends=new u0}var g=t1.prototype;return g.init=function(){this._depends.clear()},g.getNativeDep=function(g){var v=this._depends.get(g);return v&&v.nativeDep?r({},v.nativeDep):null},g.getDeps=function(g){return this._depends.has(g)?this._depends.get(g).deps:[]},g.getDepsRecursively=function(g){var v=Object.create(null),S=[];return this._descend(g,v,S),S},g.remove=function(g){this._depends.remove(g)},g.parse=function(g,v){var S,O,X=null;if(Array.isArray(v)||v.__type__||_instanceof(v,cE)){if(this._depends.has(g))return this._depends.get(g);if(!Array.isArray(v)||"number"==typeof(O=(S=v[5])[S.length-1])&&O<0)try{var Y=bp(v,{__uuid__:g});(X=this._parseDepsFromAsset(Y)).nativeDep&&(X.nativeDep.uuid=g),u8.add(g+"@import",Y)}catch(v){u4.remove(g+"@import"),X={deps:[]}}else X={deps:this._parseDepsFromJson(v)}}else{if(this._depends.has(g)&&(X=this._depends.get(g)).parsedFromExistAsset)return X;X=this._parseDepsFromAsset(v)}return this._depends.add(g,X),X},g._parseDepsFromAsset=function(g){for(var v={deps:[],parsedFromExistAsset:!0},S=cF.get(g),O=0,X=S.length;O<X;O++)v.deps.push(S[O].uuid);return cN.has(g)&&(v.nativeDep=g._nativeDep),v},g._parseDepsFromJson=function(g){var v=function(g){var v,S;return S=(v=g)[1],v[10].map(function(g){return S[g]})}(g);return v.forEach(function(g,S){return v[S]=Of(g)}),v},g._descend=function(g,v,S){for(var O=this.getDeps(g),X=0;X<O.length;X++){var Y=O[X];v[Y]||(v[Y]=!0,S.push(Y),this._descend(Y,v,S))}},n(t1,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t1),this._instance}}]),t1}();cG._instance=void 0;var cV,cU=cG.instance,cH=[new hg];function Bp(g){return g&&0==(g&g-1)}var cz,cW,cX,cj,cq,cY=nJ("cc.SimpleTexture")(cV=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gfxTexture=null,v._gfxTextureView=null,v._mipmapLevel=1,v._textureWidth=0,v._textureHeight=0,v._baseLevel=0,v._maxLevel=1e3,v}s(e,g);var v=e.prototype;return v.getGFXTexture=function(){return this._gfxTextureView},v.destroy=function(){return this._tryDestroyTextureView(),this._tryDestroyTexture(),g.prototype.destroy.call(this)},v.updateImage=function(){this.updateMipmaps(0)},v.updateMipmaps=function(){},v.uploadData=function(g,v,S){if(void 0===v&&(v=0),void 0===S&&(S=0),this._gfxTexture&&!(this._mipmapLevel<=v)){var O=this._getGFXDevice();if(O){var X=cH[0];X.texExtent.width=this._textureWidth>>v,X.texExtent.height=this._textureHeight>>v,X.texSubres.mipLevel=v,X.texSubres.baseArrayLayer=S,ArrayBuffer.isView(g)?O.copyBuffersToTexture([g],this._gfxTexture,cH):O.copyTexImagesToTexture([g],this._gfxTexture,cH)}}},v._assignImage=function(g,v,S){var O=g.data;if(O&&(this.uploadData(O,v,S),this._checkTextureLoaded(),t$.CLEANUP_IMAGE_CACHE)){var X=cU.getDeps(this._uuid),Y=X.indexOf(g._uuid);-1!==Y&&(Kt(X,Y),g.decRef())}},v._checkTextureLoaded=function(){this._textureReady()},v._textureReady=function(){this.loaded=!0,this.emit("load")},v._setMipmapLevel=function(g){this._mipmapLevel=g<1?1:g},v._setMipRange=function(g,v){this._baseLevel=g<1?0:g,this._maxLevel=v<1?0:v},v.setMipRange=function(g,v){$(g<=v,3124),this._setMipRange(g,v);var S=this._getGFXDevice();if(S){var O=this._createTextureView(S);this._tryDestroyTextureView(),this._gfxTextureView=O}},v._getGfxTextureCreateInfo=function(){return null},v._getGfxTextureViewCreateInfo=function(){return null},v._tryReset=function(){if(this._tryDestroyTextureView(),this._tryDestroyTexture(),0!==this._mipmapLevel){var g=this._getGFXDevice();g&&(this._createTexture(g),this._gfxTextureView=this._createTextureView(g))}},v.isUsingOfflineMipmaps=function(){return!1},v._createTexture=function(g){if(0!==this._width&&0!==this._height){var v=oB.NONE;this._mipFilter!==lw.NONE&&function(g,v,S){return g.gfxAPI!==om.WEBGL||Bp(v)&&Bp(S)}(g,this._width,this._height)&&(this._mipmapLevel=function(g,v){for(var S=Math.max(g,v),O=0;S;)S>>=1,O++;return O}(this._width,this._height),this.isUsingOfflineMipmaps()||this.isCompressed||(v=oB.GEN_MIPMAP));var S=this._getGfxTextureCreateInfo({usage:oI.SAMPLED|oI.TRANSFER_DST|oI.COLOR_ATTACHMENT,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:v});if(S){var O=g.createTexture(S);this._textureWidth=S.width,this._textureHeight=S.height,this._gfxTexture=O}}},v._createTextureView=function(g){if(!this._gfxTexture)return null;var v=this._maxLevel<this._mipmapLevel?this._maxLevel:this._mipmapLevel-1,S=this._getGfxTextureViewCreateInfo({texture:this._gfxTexture,format:this._getGFXFormat(),baseLevel:this._baseLevel,levelCount:v-this._baseLevel+1});return S?g.createTexture(S):null},v._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},v._tryDestroyTextureView=function(){this._gfxTextureView&&(this._gfxTextureView.destroy(),this._gfxTextureView=null)},n(e,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),e}(lJ))||cV;X.SimpleTexture=cY;var cK=g("dV",(cz=nJ("cc.Texture2D"),cW=ma([lX]),cz((cj=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._mipmaps=cq&&cq(),v._generatedMipmaps=[],v}s(e,g);var v=e.prototype;return v._setMipmapParams=function(g){var v=this;if(this._generatedMipmaps=g,this._setMipmapLevel(this._generatedMipmaps.length),this._generatedMipmaps.length>0){var S=this._generatedMipmaps[0];this.reset({width:S.width,height:S.height,format:S.format,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._generatedMipmaps.forEach(function(g,S){v._assignImage(g,S)})}else this.reset({width:0,height:0,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})},v.initialize=function(){this.mipmaps=this._mipmaps},v.onLoaded=function(){this.initialize()},v.reset=function(g){this._width=g.width,this._height=g.height,this._setGFXFormat(g.format);var v=void 0===g.mipmapLevel?1:g.mipmapLevel;this._setMipmapLevel(v);var S=void 0===g.baseLevel?0:g.baseLevel,O=void 0===g.maxLevel?1e3:g.maxLevel;this._setMipRange(S,O),this._tryReset()},v.create=function(g,v,S,O,X,Y){void 0===S&&(S=lb.RGBA8888),void 0===O&&(O=1),void 0===X&&(X=0),void 0===Y&&(Y=1e3),this.reset({width:g,height:v,format:S,mipmapLevel:O,baseLevel:X,maxLevel:Y})},v.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},v.updateMipmaps=function(g,v){if(void 0===g&&(g=0),!(g>=this._generatedMipmaps.length))for(var S=Math.min(void 0===v?this._generatedMipmaps.length:v,this._generatedMipmaps.length-g),O=0;O<S;++O){var X=g+O;this._assignImage(this._generatedMipmaps[X],X)}},v.getHtmlElementObj=function(){return this._mipmaps[0]&&_instanceof(this._mipmaps[0].data,HTMLElement)?this._mipmaps[0].data:null},v.destroy=function(){return this._mipmaps=[],this._generatedMipmaps=[],g.prototype.destroy.call(this)},v.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},v.releaseTexture=function(){this.destroy()},v._serialize=function(){return null},v._deserialize=function(v,S){var O=v;g.prototype._deserialize.call(this,O.base,S),this._mipmaps=new Array(O.mipmaps.length);for(var X=0;X<O.mipmaps.length;++X)if(this._mipmaps[X]=new lX,O.mipmaps[X]){var Y=O.mipmaps[X];S.result.push(this._mipmaps,""+X,Y,Xt(lX))}},v._getGfxTextureCreateInfo=function(g){var v=new hB(ow.TEX2D);return v.width=this._width,v.height=this._height,Object.assign(v,g),v},v._getGfxTextureViewCreateInfo=function(g){var v=new hP;return v.type=ow.TEX2D,Object.assign(v,g),v},v.initDefault=function(v){g.prototype.initDefault.call(this,v);var S=new lX;S.initDefault(),this.image=S},v.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},n(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(g){this._mipmaps=g;var v=[];if(1===g.length){var S=g[0];v.push.apply(v,S.extractMipmaps())}else if(g.length>1)for(var O=0;O<g.length;++O){var X=g[O];v.push(X.extractMipmap0())}this._setMipmapParams(v)}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(g){this.mipmaps=g?[g]:[]}}]),e}(cY),cq=ws(cj.prototype,"_mipmaps",[cW],function(){return[]}),cX=cj))||cX));X.Texture2D=cK;var cJ,cZ,c$,c0,c1,c2,c3,c4,c8,c6,c7,c9,_t,_e,_n=function(){function t1(g,v){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var S=new _r;S.initWithSize(g,v),this._texture=S,this._width=g,this._height=v,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var g=t1.prototype;return g.insertSpriteFrame=function(g){var v=g.rect,S=g.texture,O=this._innerTextureInfos[S.getId()],Y=v.x,te=v.y;if(O)Y+=O.x,te+=O.y;else{var ti=S.width,tr=S.height;if(this._x+ti+2>this._width&&(this._x=2,this._y=this._nexty),this._y+tr+2>this._nexty&&(this._nexty=this._y+tr+2),this._nexty>this._height)return null;X.internal.dynamicAtlasManager.textureBleeding&&((ti<=8||tr<=8)&&(this._texture.drawTextureAt(S.image,this._x-1,this._y-1),this._texture.drawTextureAt(S.image,this._x-1,this._y+1),this._texture.drawTextureAt(S.image,this._x+1,this._y-1),this._texture.drawTextureAt(S.image,this._x+1,this._y+1)),this._texture.drawTextureAt(S.image,this._x-1,this._y),this._texture.drawTextureAt(S.image,this._x+1,this._y),this._texture.drawTextureAt(S.image,this._x,this._y-1),this._texture.drawTextureAt(S.image,this._x,this._y+1)),this._texture.drawTextureAt(S.image,this._x,this._y),this._innerTextureInfos[S.getId()]={x:this._x,y:this._y,texture:S},this._count++,Y+=this._x,te+=this._y,this._x+=ti+2}var ta={x:Y,y:te,texture:this._texture};return this._innerSpriteFrames.push(g),ta},g.deleteInnerTexture=function(g){g&&this._innerTextureInfos[g.getId()]&&(delete this._innerTextureInfos[g.getId()],this._count--)},g.isEmpty=function(){return this._count<=0},g.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var g=this._innerSpriteFrames,v=0,S=g.length;v<S;v++){var O=g[v];O.isValid&&O._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},g.destroy=function(){this.reset(),this._texture.destroy()},t1}(),_r=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.initWithSize=function(g,v,S){void 0===S&&(S=lb.RGBA8888),this.reset({width:g,height:v,format:S})},v.drawTextureAt=function(g,v,S){var O=this.getGFXTexture();if(g&&O){var X=this._getGFXDevice();if(X){var Y=new hg;Y.texOffset.x=v,Y.texOffset.y=S,Y.texExtent.width=g.width,Y.texExtent.height=g.height,X.copyTexImagesToTexture([g.data],O,[Y])}else console.warn("Unable to get device")}},e}(cK),_s={NONE:0,IGNORE_RAYCAST:1048576,GIZMOS:2097152,EDITOR:4194304,UI_3D:8388608,SCENE_GIZMO:0x1000000,UI_2D:0x2000000,PROFILER:0x10000000,DEFAULT:0x40000000,ALL:0xffffffff},_a=g("df",function(){function t1(){}return t1.init=function(){var g=tQ.querySettings(tK.Category.ENGINE,"customLayers");if(g)for(var v=0;v<g.length;v++){var S=g[v];t1.addLayer(S.name,S.bit)}},t1.makeMaskInclude=function(g){for(var v,S=0,O=f(g);!(v=O()).done;)S|=v.value;return S},t1.makeMaskExclude=function(g){return~t1.makeMaskInclude(g)},t1.addLayer=function(g,v){if(void 0!==v){if(v>19||v<0)console.warn("maximum layers reached.");else{var S=1<<v;t1.Enum[g],tt(2104,g),t1.Enum[g]=S,tw(t1.Enum,String(S),g),t1.BitMask[g]=S,tw(t1.BitMask,String(S),g),ie.update(t1.BitMask),re.update(t1.Enum)}}else console.warn("bitNum can't be undefined")},t1.deleteLayer=function(g){if(g>19||g<0)console.warn("do not change buildin layers.");else{var v=1<<g;delete t1.Enum[t1.Enum[v]],delete t1.Enum[v],delete t1.BitMask[t1.BitMask[v]],delete t1.BitMask[v],ie.update(t1.BitMask),re.update(t1.Enum)}},t1.nameToLayer=function(g){return void 0===g?(console.warn("name can't be undefined"),-1):T(t1.Enum[g])},t1.layerToName=function(g){return g>31||g<0?(console.warn("Unable to access unknown layer."),""):t1.Enum[1<<g]},t1}());_a.Enum=re(_s),_a.BitMask=ie(r({},_s)),X.Layers=_a;var _h,_u,_l="MainFlow",_c="ForwardFlow",__="ShadowFlow";!function(g){g[g.DEFAULT=100]="DEFAULT",g[g.UI=200]="UI"}(_h||(_h={})),X.RenderPassStage=_h,function(g){g[g.MIN=0]="MIN",g[g.MAX=255]="MAX",g[g.DEFAULT=128]="DEFAULT"}(_u||(_u={}));var _f,_d={bindings:[],layouts:{}},_m={bindings:[],layouts:{}};!function(g){g[g.UBO_GLOBAL=0]="UBO_GLOBAL",g[g.UBO_CAMERA=1]="UBO_CAMERA",g[g.UBO_SHADOW=2]="UBO_SHADOW",g[g.UBO_CSM=3]="UBO_CSM",g[g.SAMPLER_SHADOWMAP=4]="SAMPLER_SHADOWMAP",g[g.SAMPLER_ENVIRONMENT=5]="SAMPLER_ENVIRONMENT",g[g.SAMPLER_SPOT_SHADOW_MAP=6]="SAMPLER_SPOT_SHADOW_MAP",g[g.SAMPLER_DIFFUSEMAP=7]="SAMPLER_DIFFUSEMAP",g[g.COUNT=8]="COUNT"}(_f||(_f={}));var _g,_v=_f.SAMPLER_SHADOWMAP,_y=_f.COUNT-_v;!function(g){g[g.UBO_LOCAL=0]="UBO_LOCAL",g[g.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",g[g.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",g[g.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",g[g.UBO_MORPH=4]="UBO_MORPH",g[g.UBO_UI_LOCAL=5]="UBO_UI_LOCAL",g[g.UBO_SH=6]="UBO_SH",g[g.SAMPLER_JOINTS=7]="SAMPLER_JOINTS",g[g.SAMPLER_MORPH_POSITION=8]="SAMPLER_MORPH_POSITION",g[g.SAMPLER_MORPH_NORMAL=9]="SAMPLER_MORPH_NORMAL",g[g.SAMPLER_MORPH_TANGENT=10]="SAMPLER_MORPH_TANGENT",g[g.SAMPLER_LIGHTMAP=11]="SAMPLER_LIGHTMAP",g[g.SAMPLER_SPRITE=12]="SAMPLER_SPRITE",g[g.SAMPLER_REFLECTION=13]="SAMPLER_REFLECTION",g[g.STORAGE_REFLECTION=14]="STORAGE_REFLECTION",g[g.SAMPLER_REFLECTION_PROBE_CUBE=15]="SAMPLER_REFLECTION_PROBE_CUBE",g[g.SAMPLER_REFLECTION_PROBE_PLANAR=16]="SAMPLER_REFLECTION_PROBE_PLANAR",g[g.SAMPLER_REFLECTION_PROBE_DATA_MAP=17]="SAMPLER_REFLECTION_PROBE_DATA_MAP",g[g.SAMPLER_REFLECTION_PROBE_BLEND_CUBE=18]="SAMPLER_REFLECTION_PROBE_BLEND_CUBE",g[g.COUNT=19]="COUNT"}(_g||(_g={}));var _S,_A=_g.SAMPLER_JOINTS,_T=_g.STORAGE_REFLECTION-_A,_E=_g.COUNT-_A-_T;!function(g){g[g.GLOBAL=0]="GLOBAL",g[g.MATERIAL=1]="MATERIAL",g[g.LOCAL=2]="LOCAL",g[g.COUNT=3]="COUNT"}(_S||(_S={}));var _C=new hT([_v,0,_A,0],[_y,0,_T,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,_E,0],[0,0,0,0],[0,2,1,3]),vm=function(){};cJ=vm,vm.TIME_OFFSET=0,vm.SCREEN_SIZE_OFFSET=cJ.TIME_OFFSET+4,vm.NATIVE_SIZE_OFFSET=cJ.SCREEN_SIZE_OFFSET+4,vm.PROBE_INFO_OFFSET=cJ.NATIVE_SIZE_OFFSET+4,vm.DEBUG_VIEW_MODE_OFFSET=cJ.PROBE_INFO_OFFSET+4,vm.COUNT=cJ.DEBUG_VIEW_MODE_OFFSET+4,vm.SIZE=4*cJ.COUNT,vm.NAME="CCGlobal",vm.BINDING=_f.UBO_GLOBAL,vm.DESCRIPTOR=new h3(cJ.BINDING,o2.UNIFORM_BUFFER,1,oU.ALL),vm.LAYOUT=new hL(_S.GLOBAL,cJ.BINDING,cJ.NAME,[new hM("cc_time",oE.FLOAT4,1),new hM("cc_screenSize",oE.FLOAT4,1),new hM("cc_nativeSize",oE.FLOAT4,1),new hM("cc_probeInfo",oE.FLOAT4,1),new hM("cc_debug_view_mode",oE.FLOAT4,1)],1),_d.layouts[vm.NAME]=vm.LAYOUT,_d.bindings[vm.BINDING]=vm.DESCRIPTOR;var ym=function(){};cZ=ym,ym.MAT_VIEW_OFFSET=0,ym.MAT_VIEW_INV_OFFSET=cZ.MAT_VIEW_OFFSET+16,ym.MAT_PROJ_OFFSET=cZ.MAT_VIEW_INV_OFFSET+16,ym.MAT_PROJ_INV_OFFSET=cZ.MAT_PROJ_OFFSET+16,ym.MAT_VIEW_PROJ_OFFSET=cZ.MAT_PROJ_INV_OFFSET+16,ym.MAT_VIEW_PROJ_INV_OFFSET=cZ.MAT_VIEW_PROJ_OFFSET+16,ym.CAMERA_POS_OFFSET=cZ.MAT_VIEW_PROJ_INV_OFFSET+16,ym.SURFACE_TRANSFORM_OFFSET=cZ.CAMERA_POS_OFFSET+4,ym.SCREEN_SCALE_OFFSET=cZ.SURFACE_TRANSFORM_OFFSET+4,ym.EXPOSURE_OFFSET=cZ.SCREEN_SCALE_OFFSET+4,ym.MAIN_LIT_DIR_OFFSET=cZ.EXPOSURE_OFFSET+4,ym.MAIN_LIT_COLOR_OFFSET=cZ.MAIN_LIT_DIR_OFFSET+4,ym.AMBIENT_SKY_OFFSET=cZ.MAIN_LIT_COLOR_OFFSET+4,ym.AMBIENT_GROUND_OFFSET=cZ.AMBIENT_SKY_OFFSET+4,ym.GLOBAL_FOG_COLOR_OFFSET=cZ.AMBIENT_GROUND_OFFSET+4,ym.GLOBAL_FOG_BASE_OFFSET=cZ.GLOBAL_FOG_COLOR_OFFSET+4,ym.GLOBAL_FOG_ADD_OFFSET=cZ.GLOBAL_FOG_BASE_OFFSET+4,ym.NEAR_FAR_OFFSET=cZ.GLOBAL_FOG_ADD_OFFSET+4,ym.VIEW_PORT_OFFSET=cZ.NEAR_FAR_OFFSET+4,ym.COUNT=cZ.VIEW_PORT_OFFSET+4,ym.SIZE=4*cZ.COUNT,ym.NAME="CCCamera",ym.BINDING=_f.UBO_CAMERA,ym.DESCRIPTOR=new h3(cZ.BINDING,o2.UNIFORM_BUFFER,1,oU.ALL),ym.LAYOUT=new hL(_S.GLOBAL,cZ.BINDING,cZ.NAME,[new hM("cc_matView",oE.MAT4,1),new hM("cc_matViewInv",oE.MAT4,1),new hM("cc_matProj",oE.MAT4,1),new hM("cc_matProjInv",oE.MAT4,1),new hM("cc_matViewProj",oE.MAT4,1),new hM("cc_matViewProjInv",oE.MAT4,1),new hM("cc_cameraPos",oE.FLOAT4,1),new hM("cc_surfaceTransform",oE.FLOAT4,1),new hM("cc_screenScale",oE.FLOAT4,1),new hM("cc_exposure",oE.FLOAT4,1),new hM("cc_mainLitDir",oE.FLOAT4,1),new hM("cc_mainLitColor",oE.FLOAT4,1),new hM("cc_ambientSky",oE.FLOAT4,1),new hM("cc_ambientGround",oE.FLOAT4,1),new hM("cc_fogColor",oE.FLOAT4,1),new hM("cc_fogBase",oE.FLOAT4,1),new hM("cc_fogAdd",oE.FLOAT4,1),new hM("cc_nearFar",oE.FLOAT4,1),new hM("cc_viewPort",oE.FLOAT4,1)],1),_d.layouts[ym.NAME]=ym.LAYOUT,_d.bindings[ym.BINDING]=ym.DESCRIPTOR;var Sm=function(){};c$=Sm,Sm.MAT_LIGHT_VIEW_OFFSET=0,Sm.MAT_LIGHT_VIEW_PROJ_OFFSET=c$.MAT_LIGHT_VIEW_OFFSET+16,Sm.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET=c$.MAT_LIGHT_VIEW_PROJ_OFFSET+16,Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET=c$.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+4,Sm.SHADOW_PROJ_INFO_OFFSET=c$.SHADOW_PROJ_DEPTH_INFO_OFFSET+4,Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET=c$.SHADOW_PROJ_INFO_OFFSET+4,Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=c$.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+4,Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=c$.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+4,Sm.SHADOW_COLOR_OFFSET=c$.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+4,Sm.PLANAR_NORMAL_DISTANCE_INFO_OFFSET=c$.SHADOW_COLOR_OFFSET+4,Sm.COUNT=c$.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+4,Sm.SIZE=4*c$.COUNT,Sm.NAME="CCShadow",Sm.BINDING=_f.UBO_SHADOW,Sm.DESCRIPTOR=new h3(c$.BINDING,o2.UNIFORM_BUFFER,1,oU.ALL),Sm.LAYOUT=new hL(_S.GLOBAL,c$.BINDING,c$.NAME,[new hM("cc_matLightView",oE.MAT4,1),new hM("cc_matLightViewProj",oE.MAT4,1),new hM("cc_shadowInvProjDepthInfo",oE.FLOAT4,1),new hM("cc_shadowProjDepthInfo",oE.FLOAT4,1),new hM("cc_shadowProjInfo",oE.FLOAT4,1),new hM("cc_shadowNFLSInfo",oE.FLOAT4,1),new hM("cc_shadowWHPBInfo",oE.FLOAT4,1),new hM("cc_shadowLPNNInfo",oE.FLOAT4,1),new hM("cc_shadowColor",oE.FLOAT4,1),new hM("cc_planarNDInfo",oE.FLOAT4,1)],1),_d.layouts[Sm.NAME]=Sm.LAYOUT,_d.bindings[Sm.BINDING]=Sm.DESCRIPTOR;var Am=function(){};c0=Am,Am.CSM_LEVEL_COUNT=4,Am.CSM_VIEW_DIR_0_OFFSET=0,Am.CSM_VIEW_DIR_1_OFFSET=c0.CSM_VIEW_DIR_0_OFFSET+4*c0.CSM_LEVEL_COUNT,Am.CSM_VIEW_DIR_2_OFFSET=c0.CSM_VIEW_DIR_1_OFFSET+4*c0.CSM_LEVEL_COUNT,Am.CSM_ATLAS_OFFSET=c0.CSM_VIEW_DIR_2_OFFSET+4*c0.CSM_LEVEL_COUNT,Am.MAT_CSM_VIEW_PROJ_OFFSET=c0.CSM_ATLAS_OFFSET+4*c0.CSM_LEVEL_COUNT,Am.CSM_PROJ_DEPTH_INFO_OFFSET=c0.MAT_CSM_VIEW_PROJ_OFFSET+16*c0.CSM_LEVEL_COUNT,Am.CSM_PROJ_INFO_OFFSET=c0.CSM_PROJ_DEPTH_INFO_OFFSET+4*c0.CSM_LEVEL_COUNT,Am.CSM_SPLITS_INFO_OFFSET=c0.CSM_PROJ_INFO_OFFSET+4*c0.CSM_LEVEL_COUNT,Am.COUNT=c0.CSM_SPLITS_INFO_OFFSET+4,Am.SIZE=4*c0.COUNT,Am.NAME="CCCSM",Am.BINDING=_f.UBO_CSM,Am.DESCRIPTOR=new h3(c0.BINDING,o2.UNIFORM_BUFFER,1,oU.FRAGMENT),Am.LAYOUT=new hL(_S.GLOBAL,c0.BINDING,c0.NAME,[new hM("cc_csmViewDir0",oE.FLOAT4,c0.CSM_LEVEL_COUNT),new hM("cc_csmViewDir1",oE.FLOAT4,c0.CSM_LEVEL_COUNT),new hM("cc_csmViewDir2",oE.FLOAT4,c0.CSM_LEVEL_COUNT),new hM("cc_csmAtlas",oE.FLOAT4,c0.CSM_LEVEL_COUNT),new hM("cc_matCSMViewProj",oE.MAT4,c0.CSM_LEVEL_COUNT),new hM("cc_csmProjDepthInfo",oE.FLOAT4,c0.CSM_LEVEL_COUNT),new hM("cc_csmProjInfo",oE.FLOAT4,c0.CSM_LEVEL_COUNT),new hM("cc_csmSplitsInfo",oE.FLOAT4,1)],1),_d.layouts[Am.NAME]=Am.LAYOUT,_d.bindings[Am.BINDING]=Am.DESCRIPTOR;var _x=_f.SAMPLER_SHADOWMAP,_b=new h3(_x,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),_R=new hF(_S.GLOBAL,_x,"cc_shadowMap",oE.SAMPLER2D,1);_d.layouts.cc_shadowMap=_R,_d.bindings[_x]=_b;var _w=_f.SAMPLER_ENVIRONMENT,_I=new h3(_w,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),_B=new hF(_S.GLOBAL,_w,"cc_environment",oE.SAMPLER_CUBE,1);_d.layouts.cc_environment=_B,_d.bindings[_w]=_I;var _D=_f.SAMPLER_DIFFUSEMAP,_M=new h3(_D,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),_O=new hF(_S.GLOBAL,_D,"cc_diffuseMap",oE.SAMPLER_CUBE,1);_d.layouts.cc_diffuseMap=_O,_d.bindings[_D]=_M;var _L=_f.SAMPLER_SPOT_SHADOW_MAP,_F=new h3(_L,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),_N=new hF(_S.GLOBAL,_L,"cc_spotShadowMap",oE.SAMPLER2D,1);_d.layouts.cc_spotShadowMap=_N,_d.bindings[_L]=_F;var Mm=function(){};c1=Mm,Mm.MAT_WORLD_OFFSET=0,Mm.MAT_WORLD_IT_OFFSET=c1.MAT_WORLD_OFFSET+16,Mm.LIGHTINGMAP_UVPARAM=c1.MAT_WORLD_IT_OFFSET+16,Mm.LOCAL_SHADOW_BIAS=c1.LIGHTINGMAP_UVPARAM+4,Mm.REFLECTION_PROBE_DATA1=c1.LOCAL_SHADOW_BIAS+4,Mm.REFLECTION_PROBE_DATA2=c1.REFLECTION_PROBE_DATA1+4,Mm.REFLECTION_PROBE_BLEND_DATA1=c1.REFLECTION_PROBE_DATA2+4,Mm.REFLECTION_PROBE_BLEND_DATA2=c1.REFLECTION_PROBE_BLEND_DATA1+4,Mm.COUNT=c1.REFLECTION_PROBE_BLEND_DATA2+4,Mm.SIZE=4*c1.COUNT,Mm.NAME="CCLocal",Mm.BINDING=_g.UBO_LOCAL,Mm.DESCRIPTOR=new h3(c1.BINDING,o2.UNIFORM_BUFFER,1,oU.VERTEX|oU.FRAGMENT|oU.COMPUTE),Mm.LAYOUT=new hL(_S.LOCAL,c1.BINDING,c1.NAME,[new hM("cc_matWorld",oE.MAT4,1),new hM("cc_matWorldIT",oE.MAT4,1),new hM("cc_lightingMapUVParam",oE.FLOAT4,1),new hM("cc_localShadowBias",oE.FLOAT4,1),new hM("cc_reflectionProbeData1",oE.FLOAT4,1),new hM("cc_reflectionProbeData2",oE.FLOAT4,1),new hM("cc_reflectionProbeBlendData1",oE.FLOAT4,1),new hM("cc_reflectionProbeBlendData2",oE.FLOAT4,1)],1),_m.layouts[Mm.NAME]=Mm.LAYOUT,_m.bindings[Mm.BINDING]=Mm.DESCRIPTOR;var Lm=function(){};c2=Lm,Lm.WORLD_BOUND_CENTER=0,Lm.WORLD_BOUND_HALF_EXTENTS=c2.WORLD_BOUND_CENTER+4,Lm.COUNT=c2.WORLD_BOUND_HALF_EXTENTS+4,Lm.SIZE=4*c2.COUNT,Lm.NAME="CCWorldBound",Lm.BINDING=_g.UBO_LOCAL,Lm.DESCRIPTOR=new h3(c2.BINDING,o2.UNIFORM_BUFFER,1,oU.VERTEX|oU.COMPUTE),Lm.LAYOUT=new hL(_S.LOCAL,c2.BINDING,c2.NAME,[new hM("cc_worldBoundCenter",oE.FLOAT4,1),new hM("cc_worldBoundHalfExtents",oE.FLOAT4,1)],1),_m.layouts[Lm.NAME]=Lm.LAYOUT,_m.bindings[Lm.BINDING]=Lm.DESCRIPTOR;var _k="a_matWorld0",_G="a_sh_linear_const_r",Gm=function(){};c3=Gm,Gm.BATCHING_COUNT=10,Gm.MAT_WORLDS_OFFSET=0,Gm.COUNT=16*c3.BATCHING_COUNT,Gm.SIZE=4*c3.COUNT,Gm.NAME="CCLocalBatched",Gm.BINDING=_g.UBO_LOCAL,Gm.DESCRIPTOR=new h3(c3.BINDING,o2.UNIFORM_BUFFER,1,oU.VERTEX|oU.COMPUTE),Gm.LAYOUT=new hL(_S.LOCAL,c3.BINDING,c3.NAME,[new hM("cc_matWorlds",oE.MAT4,c3.BATCHING_COUNT)],1),_m.layouts[Gm.NAME]=Gm.LAYOUT,_m.bindings[Gm.BINDING]=Gm.DESCRIPTOR;var km=function(){};c4=km,km.LIGHTS_PER_PASS=1,km.LIGHT_POS_OFFSET=0,km.LIGHT_COLOR_OFFSET=c4.LIGHT_POS_OFFSET+4*c4.LIGHTS_PER_PASS,km.LIGHT_SIZE_RANGE_ANGLE_OFFSET=c4.LIGHT_COLOR_OFFSET+4*c4.LIGHTS_PER_PASS,km.LIGHT_DIR_OFFSET=c4.LIGHT_SIZE_RANGE_ANGLE_OFFSET+4*c4.LIGHTS_PER_PASS,km.LIGHT_BOUNDING_SIZE_VS_OFFSET=c4.LIGHT_DIR_OFFSET+4*c4.LIGHTS_PER_PASS,km.COUNT=c4.LIGHT_BOUNDING_SIZE_VS_OFFSET+4*c4.LIGHTS_PER_PASS,km.SIZE=4*c4.COUNT,km.NAME="CCForwardLight",km.BINDING=_g.UBO_FORWARD_LIGHTS,km.DESCRIPTOR=new h3(c4.BINDING,o2.DYNAMIC_UNIFORM_BUFFER,1,oU.FRAGMENT),km.LAYOUT=new hL(_S.LOCAL,c4.BINDING,c4.NAME,[new hM("cc_lightPos",oE.FLOAT4,c4.LIGHTS_PER_PASS),new hM("cc_lightColor",oE.FLOAT4,c4.LIGHTS_PER_PASS),new hM("cc_lightSizeRangeAngle",oE.FLOAT4,c4.LIGHTS_PER_PASS),new hM("cc_lightDir",oE.FLOAT4,c4.LIGHTS_PER_PASS),new hM("cc_lightBoundingSizeVS",oE.FLOAT4,c4.LIGHTS_PER_PASS)],1),_m.layouts[km.NAME]=km.LAYOUT,_m.bindings[km.BINDING]=km.DESCRIPTOR;var Vm=function(){};Vm.LIGHTS_PER_PASS=10;var Um=function(){};c8=Um,Um.JOINTS_TEXTURE_INFO_OFFSET=0,Um.COUNT=c8.JOINTS_TEXTURE_INFO_OFFSET+4,Um.SIZE=4*c8.COUNT,Um.NAME="CCSkinningTexture",Um.BINDING=_g.UBO_SKINNING_TEXTURE,Um.DESCRIPTOR=new h3(c8.BINDING,o2.UNIFORM_BUFFER,1,oU.VERTEX),Um.LAYOUT=new hL(_S.LOCAL,c8.BINDING,c8.NAME,[new hM("cc_jointTextureInfo",oE.FLOAT4,1)],1),_m.layouts[Um.NAME]=Um.LAYOUT,_m.bindings[Um.BINDING]=Um.DESCRIPTOR;var Hm=function(){};c6=Hm,Hm.JOINTS_ANIM_INFO_OFFSET=0,Hm.COUNT=c6.JOINTS_ANIM_INFO_OFFSET+4,Hm.SIZE=4*c6.COUNT,Hm.NAME="CCSkinningAnimation",Hm.BINDING=_g.UBO_SKINNING_ANIMATION,Hm.DESCRIPTOR=new h3(c6.BINDING,o2.UNIFORM_BUFFER,1,oU.VERTEX),Hm.LAYOUT=new hL(_S.LOCAL,c6.BINDING,c6.NAME,[new hM("cc_jointAnimInfo",oE.FLOAT4,1)],1),_m.layouts[Hm.NAME]=Hm.LAYOUT,_m.bindings[Hm.BINDING]=Hm.DESCRIPTOR;var _V=function(){function t1(){}return t1.initLayout=function(g){t1._jointUniformCapacity=g,t1._count=12*g,t1._size=4*t1._count,t1.LAYOUT.members[0].count=3*g},n(t1,null,[{key:"JOINT_UNIFORM_CAPACITY",get:function(){return t1._jointUniformCapacity}},{key:"COUNT",get:function(){return t1._count}},{key:"SIZE",get:function(){return t1._size}}]),t1}();function Wm(g){_V.initLayout(g),_m.layouts[_V.NAME]=_V.LAYOUT,_m.bindings[_V.BINDING]=_V.DESCRIPTOR}c7=_V,_V._jointUniformCapacity=0,_V._count=0,_V._size=0,_V.NAME="CCSkinning",_V.BINDING=_g.UBO_SKINNING_TEXTURE,_V.DESCRIPTOR=new h3(c7.BINDING,o2.UNIFORM_BUFFER,1,oU.VERTEX),_V.LAYOUT=new hL(_S.LOCAL,c7.BINDING,c7.NAME,[new hM("cc_joints",oE.FLOAT4,1)],1);var Xm=function(){};c9=Xm,Xm.MAX_MORPH_TARGET_COUNT=60,Xm.OFFSET_OF_WEIGHTS=0,Xm.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*c9.MAX_MORPH_TARGET_COUNT,Xm.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=c9.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH+4,Xm.OFFSET_OF_VERTICES_COUNT=c9.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT+4,Xm.COUNT_BASE_4_BYTES=4*Math.ceil(c9.MAX_MORPH_TARGET_COUNT/4)+4,Xm.SIZE=4*c9.COUNT_BASE_4_BYTES,Xm.NAME="CCMorph",Xm.BINDING=_g.UBO_MORPH,Xm.DESCRIPTOR=new h3(c9.BINDING,o2.UNIFORM_BUFFER,1,oU.VERTEX),Xm.LAYOUT=new hL(_S.LOCAL,c9.BINDING,c9.NAME,[new hM("cc_displacementWeights",oE.FLOAT4,c9.MAX_MORPH_TARGET_COUNT/4),new hM("cc_displacementTextureInfo",oE.FLOAT4,1)],1),_m.layouts[Xm.NAME]=Xm.LAYOUT,_m.bindings[Xm.BINDING]=Xm.DESCRIPTOR;var jm=function(){};_t=jm,jm.NAME="CCUILocal",jm.BINDING=_g.UBO_UI_LOCAL,jm.DESCRIPTOR=new h3(_t.BINDING,o2.DYNAMIC_UNIFORM_BUFFER,1,oU.VERTEX),jm.LAYOUT=new hL(_S.LOCAL,_t.BINDING,_t.NAME,[new hM("cc_local_data",oE.FLOAT4,1)],1),_m.layouts[jm.NAME]=jm.LAYOUT,_m.bindings[jm.BINDING]=jm.DESCRIPTOR;var Ym=function(){};_e=Ym,Ym.SH_LINEAR_CONST_R_OFFSET=0,Ym.SH_LINEAR_CONST_G_OFFSET=_e.SH_LINEAR_CONST_R_OFFSET+4,Ym.SH_LINEAR_CONST_B_OFFSET=_e.SH_LINEAR_CONST_G_OFFSET+4,Ym.SH_QUADRATIC_R_OFFSET=_e.SH_LINEAR_CONST_B_OFFSET+4,Ym.SH_QUADRATIC_G_OFFSET=_e.SH_QUADRATIC_R_OFFSET+4,Ym.SH_QUADRATIC_B_OFFSET=_e.SH_QUADRATIC_G_OFFSET+4,Ym.SH_QUADRATIC_A_OFFSET=_e.SH_QUADRATIC_B_OFFSET+4,Ym.COUNT=_e.SH_QUADRATIC_A_OFFSET+4,Ym.SIZE=4*_e.COUNT,Ym.NAME="CCSH",Ym.BINDING=_g.UBO_SH,Ym.DESCRIPTOR=new h3(_e.BINDING,o2.UNIFORM_BUFFER,1,oU.FRAGMENT),Ym.LAYOUT=new hL(_S.LOCAL,_e.BINDING,_e.NAME,[new hM("cc_sh_linear_const_r",oE.FLOAT4,1),new hM("cc_sh_linear_const_g",oE.FLOAT4,1),new hM("cc_sh_linear_const_b",oE.FLOAT4,1),new hM("cc_sh_quadratic_r",oE.FLOAT4,1),new hM("cc_sh_quadratic_g",oE.FLOAT4,1),new hM("cc_sh_quadratic_b",oE.FLOAT4,1),new hM("cc_sh_quadratic_a",oE.FLOAT4,1)],1),_m.layouts[Ym.NAME]=Ym.LAYOUT,_m.bindings[Ym.BINDING]=Ym.DESCRIPTOR;var _U=_g.SAMPLER_JOINTS,_H=new h3(_U,o2.SAMPLER_TEXTURE,1,oU.VERTEX),_z=new hF(_S.LOCAL,_U,"cc_jointTexture",oE.SAMPLER2D,1);_m.layouts.cc_jointTexture=_z,_m.bindings[_U]=_H;var _W=_g.SAMPLER_JOINTS,_X=new h3(_W,o2.SAMPLER_TEXTURE,1,oU.VERTEX),_j=new hF(_S.LOCAL,_W,"cc_realtimeJoint",oE.SAMPLER2D,1);_m.layouts.cc_realtimeJoint=_j,_m.bindings[_W]=_X;var _q=_g.SAMPLER_MORPH_POSITION,_Y=new h3(_q,o2.SAMPLER_TEXTURE,1,oU.VERTEX),_K=new hF(_S.LOCAL,_q,"cc_PositionDisplacements",oE.SAMPLER2D,1);_m.layouts.cc_PositionDisplacements=_K,_m.bindings[_q]=_Y;var _J=_g.SAMPLER_MORPH_NORMAL,_Z=new h3(_J,o2.SAMPLER_TEXTURE,1,oU.VERTEX),_Q=new hF(_S.LOCAL,_J,"cc_NormalDisplacements",oE.SAMPLER2D,1);_m.layouts.cc_NormalDisplacements=_Q,_m.bindings[_J]=_Z;var _$=_g.SAMPLER_MORPH_TANGENT,_0=new h3(_$,o2.SAMPLER_TEXTURE,1,oU.VERTEX),_1=new hF(_S.LOCAL,_$,"cc_TangentDisplacements",oE.SAMPLER2D,1);_m.layouts.cc_TangentDisplacements=_1,_m.bindings[_$]=_0;var _2=_g.SAMPLER_LIGHTMAP,_3=new h3(_2,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),_5=new hF(_S.LOCAL,_2,"cc_lightingMap",oE.SAMPLER2D,1);_m.layouts.cc_lightingMap=_5,_m.bindings[_2]=_3;var _4=_g.SAMPLER_SPRITE,_8=new h3(_4,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),_6=new hF(_S.LOCAL,_4,"cc_spriteTexture",oE.SAMPLER2D,1);_m.layouts.cc_spriteTexture=_6,_m.bindings[_4]=_8;var _7=_g.SAMPLER_REFLECTION,_9=new h3(_7,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),fi=new hF(_S.LOCAL,_7,"cc_reflectionTexture",oE.SAMPLER2D,1);_m.layouts.cc_reflectionTexture=fi,_m.bindings[_7]=_9;var fr=_g.STORAGE_REFLECTION,fs=new h3(fr,o2.STORAGE_IMAGE,1,oU.COMPUTE),fa=new hG(_S.LOCAL,fr,"cc_reflectionStorage",oE.IMAGE2D,1);_m.layouts.cc_reflectionStorage=fa,_m.bindings[fr]=fs;var fh=_g.SAMPLER_REFLECTION_PROBE_CUBE,fu=new h3(fh,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),fl=new hF(_S.LOCAL,fh,"cc_reflectionProbeCubemap",oE.SAMPLER_CUBE,1);_m.layouts.cc_reflectionProbeCubemap=fl,_m.bindings[fh]=fu;var fc=_g.SAMPLER_REFLECTION_PROBE_PLANAR,f_=new h3(fc,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),fd=new hF(_S.LOCAL,fc,"cc_reflectionProbePlanarMap",oE.SAMPLER2D,1);_m.layouts.cc_reflectionProbePlanarMap=fd,_m.bindings[fc]=f_;var fm=_g.SAMPLER_REFLECTION_PROBE_DATA_MAP,fg=new h3(fm,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),fv=new hF(_S.LOCAL,fm,"cc_reflectionProbeDataMap",oE.SAMPLER2D,1);_m.layouts.cc_reflectionProbeDataMap=fv,_m.bindings[fm]=fg;var fy=_g.SAMPLER_REFLECTION_PROBE_BLEND_CUBE,fS=new h3(fy,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT),fA=new hF(_S.LOCAL,fy,"cc_reflectionProbeBlendCubemap",oE.SAMPLER_CUBE,1);_m.layouts.cc_reflectionProbeBlendCubemap=fA,_m.bindings[fy]=fS;var fT,fE,fC,fx=_a.makeMaskExclude([_a.BitMask.UI_2D,_a.BitMask.GIZMOS,_a.BitMask.EDITOR,_a.BitMask.SCENE_GIZMO,_a.BitMask.PROFILER]),fb=_a.makeMaskExclude([_a.BitMask.UI_2D,_a.BitMask.PROFILER]),fR=_a.Enum.ALL;function kg(g){return(g.getFormatFeatures(oA.R32F)&(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE))==(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE)&&g.gfxAPI!==om.WEBGL}function Vg(g){return(g.getFormatFeatures(oA.RGBA16F)&(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE))==(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE)&&g.gfxAPI!==om.WEBGL}function Ug(){return!(!X.rendering||!X.rendering.enableEffectImport)}g("cO",Object.freeze({__proto__:null,PIPELINE_FLOW_MAIN:_l,PIPELINE_FLOW_FORWARD:_c,PIPELINE_FLOW_SHADOW:__,PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return _h},get RenderPriority(){return _u},globalDescriptorSetLayout:_d,localDescriptorSetLayout:_m,get PipelineGlobalBindings(){return _f},get ModelLocalBindings(){return _g},get SetIndex(){return _S},bindingMappingInfo:_C,UBOGlobal:vm,UBOCamera:ym,UBOShadow:Sm,UBOCSM:Am,UNIFORM_SHADOWMAP_BINDING:_x,UNIFORM_ENVIRONMENT_BINDING:_w,UNIFORM_DIFFUSEMAP_BINDING:_D,UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING:_L,UBOLocal:Mm,UBOWorldBound:Lm,INST_MAT_WORLD:_k,INST_SH:_G,UBOLocalBatched:Gm,UBOForwardLight:km,UBODeferredLight:Vm,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:Um,UBOSkinningAnimation:Hm,INST_JOINT_ANIM_INFO:"a_jointAnimInfo",UBOSkinning:_V,localDescriptorSetLayout_ResizeMaxJoints:Wm,UBOMorph:Xm,UBOUILocal:jm,UBOSH:Ym,UNIFORM_JOINT_TEXTURE_BINDING:_U,UNIFORM_REALTIME_JOINT_TEXTURE_BINDING:_W,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:_q,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:_J,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:_$,UNIFORM_LIGHTMAP_TEXTURE_BINDING:_2,UNIFORM_SPRITE_TEXTURE_BINDING:_4,UNIFORM_REFLECTION_TEXTURE_BINDING:_7,UNIFORM_REFLECTION_STORAGE_BINDING:fr,UNIFORM_REFLECTION_PROBE_CUBEMAP_BINDING:fh,UNIFORM_REFLECTION_PROBE_TEXTURE_BINDING:fc,UNIFORM_REFLECTION_PROBE_DATA_MAP_BINDING:fm,UNIFORM_REFLECTION_PROBE_BLEND_CUBEMAP_BINDING:fy,CAMERA_DEFAULT_MASK:fx,CAMERA_EDITOR_MASK:fb,MODEL_ALWAYS_MASK:fR,supportsR16HalfFloatTexture:function(g){return(g.getFormatFeatures(oA.R16F)&(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE))==(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE)},supportsR32FloatTexture:kg,supportsRGBA16HalfFloatTexture:Vg,supportsRGBA32FloatTexture:function(g){return(g.getFormatFeatures(oA.RGBA32F)&(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE))==(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE)&&g.gfxAPI!==om.WEBGL},isEnableEffect:Ug}));var fw=0xfc000000,fI=0x3f00000,fB=1044480,Xg=function(g,v,S,O){return void 0===O&&(O=0),v<<26&fw|g<<20&fI|S<<12&fB|4095&O},jg=function(g){return(g&fw)>>>26},Yg=function(g){return(g&fI)>>>20},qg=function(g){return(g&fB)>>>12},Kg=function(g){return 4095&g},Jg=function(g,v){return 0x3ffffff&g|v<<26&fw},fP=((fT={})[oE.UNKNOWN]=function(g,v,S){return void 0===S&&(S=0),q(12010,S)},fT[oE.INT]=function(g,v,S){return void 0===S&&(S=0),g[S]},fT[oE.INT2]=function(g,v,S){return void 0===S&&(S=0),e8.fromArray(v,g,S)},fT[oE.INT3]=function(g,v,S){return void 0===S&&(S=0),eL.fromArray(v,g,S)},fT[oE.INT4]=function(g,v,S){return void 0===S&&(S=0),e7.fromArray(v,g,S)},fT[oE.FLOAT]=function(g,v,S){return void 0===S&&(S=0),g[S]},fT[oE.FLOAT2]=function(g,v,S){return void 0===S&&(S=0),e8.fromArray(v,g,S)},fT[oE.FLOAT3]=function(g,v,S){return void 0===S&&(S=0),eL.fromArray(v,g,S)},fT[oE.FLOAT4]=function(g,v,S){return void 0===S&&(S=0),e7.fromArray(v,g,S)},fT[oE.MAT3]=function(g,v,S){return void 0===S&&(S=0),eV.fromArray(v,g,S)},fT[oE.MAT4]=function(g,v,S){return void 0===S&&(S=0),e$.fromArray(v,g,S)},fT),fD=((fE={})[oE.UNKNOWN]=function(g,v,S){return void 0===S&&(S=0),q(12010,S)},fE[oE.INT]=function(g,v,S){return void 0===S&&(S=0),g[S]=v},fE[oE.INT2]=function(g,v,S){return void 0===S&&(S=0),e8.toArray(g,v,S)},fE[oE.INT3]=function(g,v,S){return void 0===S&&(S=0),eL.toArray(g,v,S)},fE[oE.INT4]=function(g,v,S){return void 0===S&&(S=0),e7.toArray(g,v,S)},fE[oE.FLOAT]=function(g,v,S){return void 0===S&&(S=0),g[S]=v},fE[oE.FLOAT2]=function(g,v,S){return void 0===S&&(S=0),e8.toArray(g,v,S)},fE[oE.FLOAT3]=function(g,v,S){return void 0===S&&(S=0),eL.toArray(g,v,S)},fE[oE.FLOAT4]=function(g,v,S){return void 0===S&&(S=0),e7.toArray(g,v,S)},fE[oE.MAT3]=function(g,v,S){return void 0===S&&(S=0),eV.toArray(g,v,S)},fE[oE.MAT4]=function(g,v,S){return void 0===S&&(S=0),e$.toArray(g,v,S)},fE),fM=((fC={})[oE.INT]=function(g){return"number"==typeof g},fC[oE.FLOAT]=function(g){return"number"==typeof g},fC[oE.INT2]=function(g){return!!_instanceof(g,e8)},fC[oE.FLOAT2]=function(g){return!!_instanceof(g,e8)},fC[oE.INT3]=function(g){return!!_instanceof(g,eL)},fC[oE.FLOAT3]=function(g){return!!_instanceof(g,eL)},fC[oE.INT4]=function(g){return!!_instanceof(g,e7)},fC[oE.FLOAT4]=function(g){return!!(_instanceof(g,e7)||_instanceof(g,is)||_instanceof(g,eW))},fC[oE.MAT3]=function(g){return!!_instanceof(g,eV)},fC[oE.MAT4]=function(g){return!!_instanceof(g,e$)},fC),fO=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function ev(g){switch(g){case oE.BOOL:case oE.INT:case oE.UINT:case oE.FLOAT:break;case oE.BOOL2:case oE.INT2:case oE.UINT2:case oE.FLOAT2:return fO[1];case oE.BOOL4:case oE.INT4:case oE.UINT4:case oE.FLOAT4:return fO[2];case oE.MAT4:return fO[3];case oE.SAMPLER2D:return"default-texture";case oE.SAMPLER_CUBE:return"default-cube-texture";case oE.SAMPLER2D_ARRAY:return"default-array-texture";case oE.SAMPLER3D:return"default-3d-texture"}return fO[0]}function iv(g){switch(g){case oE.SAMPLER2D:return"-texture";case oE.SAMPLER_CUBE:return"-cube-texture";case oE.SAMPLER2D_ARRAY:return"-array-texture";case oE.SAMPLER3D:return"-3d-texture";default:return"-unknown"}}function nv(g,v){for(var S=Object.entries(v),O=!1,X=0;X<S.length;X++)g[S[X][0]]!==S[X][1]&&(g[S[X][0]]=S[X][1],O=!0);return O}function rv(g,v){switch(g.type){case"boolean":return"number"==typeof v?v.toString():v?"1":"0";case"string":return void 0!==v?v:g.options[0];case"number":return void 0!==v?v.toString():g.range[0].toString();default:return console.warn("unknown define type '"+g.type+"'"),"-1"}}function sv(g,v){for(var S=0;S<g.length;S++){var O=g[S];if("!"===O[0]){if(v[O.slice(1)])return!1}else if(!v[O])return!1}return!0}var fL=new Map;function ov(g,v){if(v.count)return g+P_(v.type)*v.count;var S=fL.get(v.name);return void 0!==S?g+P_(v.type)*S:(console.error("uniform '"+v.name+"' must have a count"),g)}function hv(g){return Math.ceil(Math.log2(Math.max(g,2)))}fL.set("cc_joints",_V.LAYOUT.members[0].count),fL.set("cc_lightPos",km.LIGHTS_PER_PASS),fL.set("cc_lightColor",km.LIGHTS_PER_PASS),fL.set("cc_lightSizeRangeAngle",km.LIGHTS_PER_PASS),fL.set("cc_lightDir",km.LIGHTS_PER_PASS),fL.set("cc_lightBoundingSizeVS",km.LIGHTS_PER_PASS);var fF=new h4;function lv(g,v,S,O,X){for(var Y=g.builtins[O],te=[],o=function(){var g=Y.blocks[ti],v=S.layouts[g.name],O=v&&S.bindings.find(function(g){return g.binding===v.binding});if(!(v&&O&&O.descriptorType&ud))return console.warn("builtin UBO '"+g.name+"' not available!"),1;te.push(v),X&&!X.includes(O)&&X.push(O)},ti=0;ti<Y.blocks.length;ti++)o();Array.prototype.unshift.apply(v.shaderInfo.blocks,te);for(var tr=[],_$l=function(){var g=Y.samplerTextures[ta],v=S.layouts[g.name],O=v&&S.bindings.find(function(g){return g.binding===v.binding});if(!(v&&O&&O.descriptorType&um))return console.warn("builtin samplerTexture '"+g.name+"' not available!"),1;tr.push(v),X&&!X.includes(O)&&X.push(O)},ta=0;ta<Y.samplerTextures.length;ta++)_$l();Array.prototype.unshift.apply(v.shaderInfo.samplerTextures,tr),X&&X.sort(function(g,v){return g.binding-v.binding})}function cv(g){switch(g.gfxAPI){case om.GLES2:case om.WEBGL:return"glsl1";case om.GLES3:case om.WEBGL2:return"glsl3";default:return"glsl4"}}var fk,fG,fV,fU,fH,fz,fW,fX=new(function(){function t1(){this._templates={},this._cache={},this._templateInfos={}}var g=t1.prototype;return g.register=function(g){for(var v=0;v<g.shaders.length;v++)this.define(g.shaders[v]).effectName=g.name;for(var S=0;S<g.techniques.length;S++)for(var O=g.techniques[S],X=0;X<O.passes.length;X++){var Y=O.passes[X];void 0!==Y.propertyIndex&&void 0===Y.properties&&(Y.properties=O.passes[Y.propertyIndex].properties)}},g.define=function(g){var v=this._templates[g.name];if(v&&v.hash===g.hash)return v;var S=r({},g);if(function(g){for(var v=0,i=function(){var O=g.defines[S],X=1;if("number"===O.type){var Y=O.range;X=hv(Y[1]-Y[0]+1),O._map=function(g){return g-Y[0]}}else"string"===O.type?(X=hv(O.options.length),O._map=function(g){return Math.max(0,O.options.findIndex(function(v){return v===g}))}):"boolean"===O.type&&(O._map=function(g){return g?1:0});O._offset=v,v+=X},S=0;S<g.defines.length;S++)i();for(var O in v>31&&(g.uber=!0),g.constantMacros="",g.builtins.statistics)g.constantMacros+="#define "+O+" "+g.builtins.statistics[O]+"\n"}(S),this._templates[g.name]=S,!this._templateInfos[S.hash]){var O={};O.samplerStartBinding=S.blocks.length,O.shaderInfo=new hW,O.blockSizes=[],O.bindings=[];for(var X=0;X<S.blocks.length;X++){var Y=S.blocks[X];O.blockSizes.push(Y.members.reduce(ov,0)),O.bindings.push(new h3(Y.binding,o2.UNIFORM_BUFFER,1,Y.stageFlags)),O.shaderInfo.blocks.push(new hL(_S.MATERIAL,Y.binding,Y.name,Y.members.map(function(g){return new hM(g.name,g.type,g.count)}),1))}for(var te=0;te<S.samplerTextures.length;te++){var ti=S.samplerTextures[te];O.bindings.push(new h3(ti.binding,o2.SAMPLER_TEXTURE,ti.count,ti.stageFlags)),O.shaderInfo.samplerTextures.push(new hF(_S.MATERIAL,ti.binding,ti.name,ti.type,ti.count))}for(var tr=0;tr<S.samplers.length;tr++){var ta=S.samplers[tr];O.bindings.push(new h3(ta.binding,o2.SAMPLER,ta.count,ta.stageFlags)),O.shaderInfo.samplers.push(new hN(_S.MATERIAL,ta.binding,ta.name,ta.count))}for(var th=0;th<S.textures.length;th++){var tu=S.textures[th];O.bindings.push(new h3(tu.binding,o2.TEXTURE,tu.count,tu.stageFlags)),O.shaderInfo.textures.push(new hk(_S.MATERIAL,tu.binding,tu.name,tu.type,tu.count))}for(var tl=0;tl<S.buffers.length;tl++){var tc=S.buffers[tl];O.bindings.push(new h3(tc.binding,o2.STORAGE_BUFFER,1,tc.stageFlags)),O.shaderInfo.buffers.push(new hV(_S.MATERIAL,tc.binding,tc.name,1,tc.memoryAccess))}for(var t_=0;t_<S.images.length;t_++){var tf=S.images[t_];O.bindings.push(new h3(tf.binding,o2.STORAGE_IMAGE,tf.count,tf.stageFlags)),O.shaderInfo.images.push(new hG(_S.MATERIAL,tf.binding,tf.name,tf.type,tf.count,tf.memoryAccess))}for(var tp=0;tp<S.subpassInputs.length;tp++){var tm=S.subpassInputs[tp];O.bindings.push(new h3(tm.binding,o2.INPUT_ATTACHMENT,tm.count,tm.stageFlags)),O.shaderInfo.subpassInputs.push(new hU(_S.MATERIAL,tm.binding,tm.name,tm.count))}O.gfxAttributes=[];for(var tg=0;tg<S.attributes.length;tg++){var tv=S.attributes[tg];O.gfxAttributes.push(new hz(tv.name,tv.format,tv.isNormalized,0,tv.isInstanced,tv.location))}lv(S,O,_m,"locals"),O.shaderInfo.stages.push(new hH(oU.VERTEX,"")),O.shaderInfo.stages.push(new hH(oU.FRAGMENT,"")),O.handleMap=function(g){for(var v={},S=0;S<g.blocks.length;S++)for(var O=g.blocks[S],X=O.members,Y=0,te=0;te<X.length;te++){var ti=X[te];v[ti.name]=Xg(O.binding,ti.type,ti.count,Y),Y+=(P_(ti.type)>>2)*ti.count}for(var tr=0;tr<g.samplerTextures.length;tr++){var ta=g.samplerTextures[tr];v[ta.name]=Xg(ta.binding,ta.type,ta.count)}return v}(S),O.setLayouts=[],this._templateInfos[S.hash]=O}return S},g.getTemplate=function(g){return this._templates[g]},g.getTemplateInfo=function(g){var v=this._templates[g].hash;return this._templateInfos[v]},g.getDescriptorSetLayout=function(g,v,S){void 0===S&&(S=!1);var O=this._templates[v],X=this._templateInfos[O.hash];return X.setLayouts.length||(fF.bindings=X.bindings,X.setLayouts[_S.MATERIAL]=g.createDescriptorSetLayout(fF),fF.bindings=_m.bindings,X.setLayouts[_S.LOCAL]=g.createDescriptorSetLayout(fF)),X.setLayouts[S?_S.LOCAL:_S.MATERIAL]},g.hasProgram=function(g){return void 0!==this._templates[g]},g.getKey=function(g,v){return function(g,v){var S=g.defines;if(g.uber){for(var O="",X=0;X<S.length;X++){var Y=S[X],te=v[Y.name];if(te&&Y._map){var ti=Y._map(te);O+=""+Y._offset+ti+"|"}}return""+O+g.hash}for(var tr=0,ta=0;ta<S.length;ta++){var th=S[ta],tu=v[th.name];tu&&th._map&&(tr|=th._map(tu)<<th._offset)}return tr.toString(16)+"|"+g.hash}(this._templates[g],v)},g.destroyShaderByDefines=function(g){var v=this,S=Object.keys(g);if(S.length)for(var O=S.map(function(v){var S=g[v];return"boolean"==typeof S&&(S=S?"1":"0"),new RegExp(""+v+S)}),X=Object.keys(this._cache).filter(function(g){return O.every(function(S){return S.test(v._cache[g].name)})}),Y=0;Y<X.length;Y++){var te=X[Y],ti=this._cache[te];U("destroyed shader "+ti.name),ti.destroy(),delete this._cache[te]}},g.getGFXShader=function(g,v,S,O,X){Object.assign(S,O.macros),X||(X=this.getKey(v,S));var Y=this._cache[X];if(Y)return Y;var te=this._templates[v],ti=this._templateInfos[te.hash];ti.pipelineLayout||(this.getDescriptorSetLayout(g,v),lv(te,ti,_d,"globals"),ti.setLayouts[_S.GLOBAL]=O.descriptorSetLayout,ti.pipelineLayout=g.createPipelineLayout(new h6(ti.setLayouts)));var tr=function(g,v){for(var S=[],O=0;O<v.length;O++){var X=v[O],Y=X.name,te=g[Y],ti=rv(X,te),tr=!te||"0"===te;S.push({name:Y,value:ti,isDefault:tr})}return S}(S,te.defines),ta=O.constantMacros+te.constantMacros+tr.reduce(function(g,v){return g+"#define "+v.name+" "+v.value+"\n"},""),th=te.glsl3,tu=cv(g);tu?th=te[tu]:console.error("Invalid GFX API!"),ti.shaderInfo.stages[0].source=ta+th.vert,ti.shaderInfo.stages[1].source=ta+th.frag,ti.shaderInfo.attributes=function(g,v,S){for(var O=[],X=g.attributes,Y=0;Y<X.length;Y++)sv(X[Y].defines,S)&&O.push(v[Y]);return O}(te,ti.gfxAttributes,S),ti.shaderInfo.name=function(g,v){return g+v.reduce(function(g,v){return v.isDefault?g:g+"|"+v.name+v.value},"")}(v,tr);var tl=ti.shaderInfo;return this._cache[X]=g.createShader(tl)},t1}());X.programLib=fX;var fj,fq,fY,fK,fZ,fQ,f0,f1,f2,f3=["planar-shadow","skybox","deferred-lighting","bloom","hbao","copy-pass","post-process","profiler","splash-screen","unlit","sprite","particle","particle-gpu","particle-trail","billboard","terrain","graphics","clear-stencil","spine","occlusion-query","geometry-renderer","debug-renderer","ssss-blur","float-output-process"],f4=g("dX",nJ("cc.EffectAsset")(((fW=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).techniques=fV&&fV(),v.shaders=fU&&fU(),v.combinations=fH&&fH(),v.hideInEditor=fz&&fz(),v}s(e,g),e.register=function(g){e._effects[g.name]=g,e._layoutValid=!1},e.remove=function(g){if("string"!=typeof g)e._effects[g.name]&&e._effects[g.name]===g&&delete e._effects[g.name];else{if(e._effects[g])return void delete e._effects[g];for(var v in e._effects)if(e._effects[v]._uuid===g)return void delete e._effects[v]}},e.get=function(g){if(e._effects[g])return e._effects[g];for(var v in e._effects)if(e._effects[v]._uuid===g)return e._effects[v];return f3.includes(g)&&q(16101,g),null},e.getAll=function(){return e._effects},e.isLayoutValid=function(){return e._layoutValid},e.setLayoutValid=function(){e._layoutValid=!0};var v=e.prototype;return v.onLoaded=function(){if(X.rendering&&X.rendering.enableEffectImport){!function(g){for(var v=0;v<g.techniques.length;v++)for(var S=g.techniques[v],O=0;O<S.passes.length;O++){var X=S.passes[O];void 0!==X.propertyIndex&&void 0===X.properties&&(X.properties=S.passes[X.propertyIndex].properties)}}(this);var g=X.rendering.programLib;g.addEffect(this),g.init(uZ.gfxDevice)}else fX.register(this);e.register(this),X.game.once(X.Game.EVENT_RENDERER_INITED,this._precompile,this)},v._precompile=function(){var g=this;if(X.rendering&&X.rendering.enableEffectImport)X.rendering.programLib.precompileEffect(uZ.gfxDevice,this);else for(var v=X.director.root,i=function(){var O=g.shaders[S],X=g.combinations[S];if(!X)return 1;(function(g){return Object.keys(g).reduce(function(v,S){return v.reduce(function(v,O){for(var X=g[S],Y=0;Y<X.length;++Y){var te=r({},O);te[S]=X[Y],v.push(te)}return v},[])},[{}])})(X).forEach(function(g){return fX.getGFXShader(uZ.gfxDevice,O.name,g,v.pipeline)})},S=0;S<this.shaders.length;S++)i()},v.destroy=function(){return e.remove(this),g.prototype.destroy.call(this)},v.initDefault=function(v){g.prototype.initDefault.call(this,v);var S=e.get("builtin-unlit");this.name="builtin-unlit",this.shaders=S.shaders,this.combinations=S.combinations,this.techniques=S.techniques},v.validate=function(){return this.techniques.length>0&&this.shaders.length>0},e}(lx))._effects={},fW._layoutValid=!0,fV=ws((fG=fW).prototype,"techniques",[n2],function(){return[]}),fU=ws(fG.prototype,"shaders",[n2],function(){return[]}),fH=ws(fG.prototype,"combinations",[n2],function(){return[]}),fz=ws(fG.prototype,"hideInEditor",[n2,qs],function(){return!1}),fk=fG))||fk);X.EffectAsset=f4,function(g){g[g.right=0]="right",g[g.left=1]="left",g[g.top=2]="top",g[g.bottom=3]="bottom",g[g.front=4]="front",g[g.back=5]="back"}(f1||(f1={})),function(g){g[g.NONE=0]="NONE",g[g.AUTO=1]="AUTO",g[g.BAKED_CONVOLUTION_MAP=2]="BAKED_CONVOLUTION_MAP"}(f2||(f2={}));var f8=g("dW",nJ("cc.TextureCube")(((f0=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).isRGBE=fY&&fY(),v._mipmapAtlas=fK&&fK(),v._mipmapMode=fZ&&fZ(),v._mipmaps=fQ&&fQ(),v._generatedMipmaps=[],v}s(e,g);var v=e.prototype;return v._setMipmapParams=function(g){var v=this;if(this._generatedMipmaps=g,this._setMipmapLevel(this._generatedMipmaps.length),this._generatedMipmaps.length>0){var S=this._generatedMipmaps[0].front;this.reset({width:S.width,height:S.height,format:S.format,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._generatedMipmaps.forEach(function(g,S){Dv(g,function(g,O){v._assignImage(g,S,O)})})}else this.reset({width:0,height:0,mipmapLevel:this._generatedMipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})},v.isUsingOfflineMipmaps=function(){return this._mipmapMode===f2.BAKED_CONVOLUTION_MAP},e.fromTexture2DArray=function(g,v){for(var S=[],O=g.length/6,X=0;X<O;X++){var Y=6*X;S.push({front:g[Y+f1.front].image,back:g[Y+f1.back].image,left:g[Y+f1.left].image,right:g[Y+f1.right].image,top:g[Y+f1.top].image,bottom:g[Y+f1.bottom].image})}return(v=v||new e).mipmaps=S,v},v.onLoaded=function(){this._mipmapMode===f2.BAKED_CONVOLUTION_MAP?this.mipmapAtlas=this._mipmapAtlas:this.mipmaps=this._mipmaps},v.reset=function(g){this._width=g.width,this._height=g.height,this._setGFXFormat(g.format);var v=void 0===g.mipmapLevel?1:g.mipmapLevel;this._setMipmapLevel(v);var S=void 0===g.baseLevel?0:g.baseLevel,O=void 0===g.maxLevel?1e3:g.maxLevel;this._setMipRange(S,O),this._tryReset()},v.updateMipmaps=function(g,v){var S=this;if(void 0===g&&(g=0),!(g>=this._generatedMipmaps.length))for(var O=Math.min(void 0===v?this._generatedMipmaps.length:v,this._generatedMipmaps.length-g),_$r=function(){var v=g+X;Dv(S._generatedMipmaps[v],function(g,O){S._assignImage(g,v,O)})},X=0;X<O;++X)_$r()},v.destroy=function(){return this._mipmaps=[],this._generatedMipmaps=[],this._mipmapAtlas=null,g.prototype.destroy.call(this)},v.releaseTexture=function(){this.destroy()},v._serialize=function(){return null},v._deserialize=function(v,S){var O=v;if(g.prototype._deserialize.call(this,O.base,S),this.isRGBE=O.rgbe,this._mipmapMode=O.mipmapMode,this._mipmapMode===f2.BAKED_CONVOLUTION_MAP){var X=O.mipmapAtlas,Y=O.mipmapLayout;this._mipmapAtlas={atlas:{},layout:Y},this._mipmapAtlas.atlas={front:new lX,back:new lX,left:new lX,right:new lX,top:new lX,bottom:new lX};var te=Xt(lX);S.result.push(this._mipmapAtlas.atlas,"front",X.front,te),S.result.push(this._mipmapAtlas.atlas,"back",X.back,te),S.result.push(this._mipmapAtlas.atlas,"left",X.left,te),S.result.push(this._mipmapAtlas.atlas,"right",X.right,te),S.result.push(this._mipmapAtlas.atlas,"top",X.top,te),S.result.push(this._mipmapAtlas.atlas,"bottom",X.bottom,te)}else{this._mipmaps=new Array(O.mipmaps.length);for(var ti=0;ti<O.mipmaps.length;++ti){this._mipmaps[ti]={front:new lX,back:new lX,left:new lX,right:new lX,top:new lX,bottom:new lX};var tr=O.mipmaps[ti],ta=Xt(lX);S.result.push(this._mipmaps[ti],"front",tr.front,ta),S.result.push(this._mipmaps[ti],"back",tr.back,ta),S.result.push(this._mipmaps[ti],"left",tr.left,ta),S.result.push(this._mipmaps[ti],"right",tr.right,ta),S.result.push(this._mipmaps[ti],"top",tr.top,ta),S.result.push(this._mipmaps[ti],"bottom",tr.bottom,ta)}}},v._getGfxTextureCreateInfo=function(g){var v=new hB(ow.CUBE);return v.width=this._width,v.height=this._height,v.layerCount=6,Object.assign(v,g),v},v._getGfxTextureViewCreateInfo=function(g){var v=new hP;return v.type=ow.CUBE,v.baseLayer=0,v.layerCount=6,Object.assign(v,g),v},v._uploadAtlas=function(){var g=this,v=this._mipmapAtlas.layout,S=v[0];this.reset({width:S.width,height:S.height,format:this._mipmapAtlas.atlas.front.format,mipmapLevel:v.length}),Dv(this._mipmapAtlas.atlas,function(S,O){var X=new cK;X.image=S,X.reset({width:S.width,height:S.height,format:S.format}),X.uploadData(S.data);for(var Y=0;Y<v.length;Y++){var te=v[Y],ti=X.getGFXTexture().size,tr=new Uint8Array(ti),ta=new hg;ta.texOffset.x=te.left,ta.texOffset.y=te.top,ta.texExtent.width=te.width,ta.texExtent.height=te.height,g._getGFXDevice().copyTextureToBuffers(X.getGFXTexture(),[tr],[ta]);var th=new lX({_data:tr,_compressed:S.isCompressed,width:te.width,height:te.height,format:S.format});g._assignImage(th,te.level,O)}})},v.initDefault=function(v){g.prototype.initDefault.call(this,v);var S=new lX;S.initDefault(),this.mipmaps=[{front:S,back:S,top:S,bottom:S,left:S,right:S}]},v.validate=function(){if(this._mipmapMode===f2.BAKED_CONVOLUTION_MAP){if(null===this.mipmapAtlas||0===this.mipmapAtlas.layout.length)return!1;var g=this.mipmapAtlas.atlas;return!!(g.top&&g.bottom&&g.front&&g.back&&g.left&&g.right)}return 0!==this._mipmaps.length&&!this._mipmaps.find(function(g){return!(g.top&&g.bottom&&g.front&&g.back&&g.left&&g.right)})},n(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(g){this._mipmaps=g;var v=[];if(1===g.length){var S=g[0],O=S.front.extractMipmaps(),X=S.back.extractMipmaps(),Y=S.left.extractMipmaps(),te=S.right.extractMipmaps(),ti=S.top.extractMipmaps(),tr=S.bottom.extractMipmaps();if(O.length!==X.length||O.length!==Y.length||O.length!==te.length||O.length!==ti.length||O.length!==tr.length)return console.error("The number of mipmaps of each face is different."),void this._setMipmapParams([]);for(var ta=O.length,th=0;th<ta;++th){var tu={front:O[th],back:X[th],left:Y[th],right:te[th],top:ti[th],bottom:tr[th]};v.push(tu)}}else g.length>1&&g.forEach(function(g){var S={front:g.front.extractMipmap0(),back:g.back.extractMipmap0(),left:g.left.extractMipmap0(),right:g.right.extractMipmap0(),top:g.top.extractMipmap0(),bottom:g.bottom.extractMipmap0()};v.push(S)});this._setMipmapParams(v)}},{key:"mipmapAtlas",get:function(){return this._mipmapAtlas},set:function(g){var v=this;if(this._mipmapAtlas=g,this._mipmapAtlas){var S=this._mipmapAtlas.atlas.front;if(S.data){var O=this._mipmapAtlas.atlas,X=this._mipmapAtlas.layout,Y=X[0],ti=Object.assign(te.document.createElement("canvas"),{width:S.width,height:S.height}).getContext("2d");this.reset({width:Y.width,height:Y.height,format:S.format,mipmapLevel:X.length});for(var o=function(){var g=X[tr];Dv(O,function(O,X){ti.clearRect(0,0,S.width,S.height);var Y=O.data;ti.drawImage(Y,0,0);var te=ti.getImageData(g.left,g.top,g.width,g.height),tr=new lX({_data:te.data,_compressed:O.isCompressed,width:te.width,height:te.height,format:O.format});v._assignImage(tr,g.level,X)})},tr=0;tr<X.length;tr++)o()}}else this.reset({width:0,height:0,mipmapLevel:0})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(g){this.mipmaps=g?[g]:[]}}]),e}(cY)).FaceIndex=f1,fY=ws((fq=f0).prototype,"isRGBE",[n2],function(){return!1}),fK=ws(fq.prototype,"_mipmapAtlas",[n2],function(){return null}),fZ=ws(fq.prototype,"_mipmapMode",[n2],function(){return f2.NONE}),fQ=ws(fq.prototype,"_mipmaps",[n2],function(){return[]}),fj=fq))||fj);function Dv(g,v){v(g.front,f1.front),v(g.back,f1.back),v(g.left,f1.left),v(g.right,f1.right),v(g.top,f1.top),v(g.bottom,f1.bottom)}X.TextureCube=f8;var f6=function(){function t1(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new u0,this.scenes=new u0,this.paths=new u0}var g=t1.prototype;return g.init=function(g){var v=this;(function(g){var v=g.uuids,S=g.paths,O=g.types,X=g.deps,Y=g.paths=Object.create(null);if(!1===g.debug){for(var te=0,ti=v.length;te<ti;te++)v[te]=Of(v[te]);for(var tr in S){var ta=S[tr],th=ta[1];ta[1]=O[th]}}else{for(var tu=Object.create(null),tl=0,tc=v.length;tl<tc;tl++){var t_=v[tl];v[tl]=tu[t_]=Of(t_)}v=tu}for(var tf in S){var tp=S[tf];Y[v[tf]]=tp}var tm=g.scenes;for(var tg in tm){var tv=tm[tg];tm[tg]=v[tv]}var ty=g.packs;for(var tS in ty)for(var tA=ty[tS],tT=0;tT<tA.length;++tT)tA[tT]=v[tA[tT]];var tE=g.versions;if(tE)for(var tC in tE)for(var tx=tE[tC],tb=0;tb<tx.length;tb+=2){var tw=tx[tb];tx[tb]=v[tw]||tw}var tI=g.redirect;if(tI)for(var tB=0;tB<tI.length;tB+=2)tI[tB]=v[tI[tB]],tI[tB+1]=X[tI[tB+1]];if(g.extensionMap){var P=function(S){if(!Object.prototype.hasOwnProperty.call(g.extensionMap,S))return 1;g.extensionMap[S].forEach(function(O,X){g.extensionMap[S][X]=v[O]||O})};for(var tP in g.extensionMap)P(tP)}})(g),this.importBase=g.importBase||"",this.nativeBase=g.nativeBase||"",this.base=g.base||"",this.name=g.name||"",this.deps=g.deps||[],this._initUuid(g.uuids),this._initPath(g.paths),this._initScene(g.scenes),this._initPackage(g.packs),this._initVersion(g.versions),this._initRedirect(g.redirect);var i=function(S){if(!Object.prototype.hasOwnProperty.call(g.extensionMap,S))return 1;g.extensionMap[S].forEach(function(g){var O=v.assetInfos.get(g);O&&(O.extension=S)})};for(var S in g.extensionMap)i(S)},g.getInfoWithPath=function(g,v){if(!g)return null;g=Nf(g);var S=this.paths.get(g);if(S){if(!v)return S[0];for(var O=0,X=S.length;O<X;O++){var Y=S[O];if(Pt(Y.ctor,v))return Y}}return null},g.getDirWithPath=function(g,v,S){"/"===(g=Nf(g))[g.length-1]&&(g=g.slice(0,-1));var O=S||[];return this.paths.forEach(function(S,X){if(X.startsWith(g)&&function(g,v){return!(g.length>v.length)||47===g.charCodeAt(v.length)}(X,g)||!g)for(var Y=0,te=S.length;Y<te;Y++){var ti=S[Y];v&&!Pt(ti.ctor,v)||O.push(ti)}}),O},g.getAssetInfo=function(g){return this.assetInfos.get(g)||null},g.getSceneInfo=function(g){return g.endsWith(".scene")||(g+=".scene"),"/"===g[0]||g.startsWith("db://")||(g="/"+g),this.scenes.find(function(v,S){return S.endsWith(g)})},g.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},g._initUuid=function(g){if(g){this.assetInfos.clear();for(var v=0,S=g.length;v<S;v++){var O=g[v];this.assetInfos.add(O,{uuid:O})}}},g._initPath=function(g){if(g){var v=this.paths;for(var S in v.clear(),g){var O=g[S],X=O[0],Y=O[1],te=3===O.length,ti=this.assetInfos.get(S);ti.path=X,ti.ctor=Ht(Y),v.has(X)?te?v.get(X).push(ti):v.get(X).unshift(ti):v.add(X,[ti])}}},g._initScene=function(g){if(g){var v=this.scenes;v.clear();var S=this.assetInfos;for(var O in g){var X=g[O],Y=S.get(X);Y.url=O,v.add(O,Y)}}},g._initPackage=function(g){if(g){var v=this.assetInfos;for(var S in g){var O=g[S],X={uuid:S,packedUuids:O,ext:".json"};v.add(S,X);for(var Y=0,te=O.length;Y<te;Y++){var ti=O[Y],tr=v.get(ti),ta=tr.packs;ta?1===te?ta.unshift(X):ta.push(X):tr.packs=[X]}}}},g._initVersion=function(g){if(g){var v=this.assetInfos,S=g.import;if(S)for(var O=0,X=S.length;O<X;O+=2){var Y=S[O];v.get(Y).ver=S[O+1]}if(S=g.native)for(var te=0,ti=S.length;te<ti;te+=2){var tr=S[te];v.get(tr).nativeVer=S[te+1]}}},g._initRedirect=function(g){if(g)for(var v=this.assetInfos,S=0,O=g.length;S<O;S+=2){var X=g[S];v.get(X).redirect=g[S+1]}},t1}();function Mv(g,v){g._uuid&&v.push(g._uuid)}function Lv(g,v){for(var S=Object.getOwnPropertyNames(g),O=0;O<S.length;O++){var X=S[O];if("node"!==X&&"__eventTargets"!==X){var Y=g[X];if("object"==(void 0===Y?"undefined":_type_of(Y))&&Y){if(Array.isArray(Y))for(var te=0;te<Y.length;te++){var ti=Y[te];_instanceof(ti,lx)&&Mv(ti,v)}else if(Y.constructor&&Y.constructor!==Object)_instanceof(Y,lx)&&Mv(Y,v);else for(var tr=Object.getOwnPropertyNames(Y),ta=0;ta<tr.length;ta++){var th=Y[tr[ta]];_instanceof(th,lx)&&Mv(th,v)}}}}}function Fv(g,v){for(var S=0;S<g._components.length;S++)Lv(g._components[S],v);for(var O=0;O<g._children.length;O++)Fv(g._children[O],v)}function Nv(g,v,S,O){S.push(g._uuid);for(var X=cU.getDeps(g._uuid),Y=0,te=X.length;Y<te;Y++){var ti=u3.get(X[Y]);if(ti){var tr=ti._uuid;tr in v?v[tr]+=O:v[tr]=ti.refCount+O,S.includes(tr)||Nv(ti,v,S,O)}}}var f7=[],f9=new(function(){function t1(){this._persistNodeDeps=new u0,this._toDelete=new u0,this._eventListener=!1,this._dontDestroyAssets=[]}var g=t1.prototype;return g.addIgnoredAsset=function(g){this._dontDestroyAssets.push(g._uuid)},g.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},g._addPersistNodeRef=function(g){var v=[];Fv(g,v);for(var S=0,O=v.length;S<O;S++){var X=u3.get(v[S]);X&&X.addRef()}this._persistNodeDeps.add(g.uuid,v)},g._removePersistNodeRef=function(g){if(this._persistNodeDeps.has(g.uuid)){for(var v=this._persistNodeDeps.get(g.uuid),S=0,O=v.length;S<O;S++){var X=u3.get(v[S]);X&&X.decRef()}this._persistNodeDeps.remove(g.uuid)}},g._autoRelease=function(g,v,S){if(g){for(var O=cU.getDeps(g.uuid),X=0,Y=O.length;X<Y;X++){var te=u3.get(O[X]);te&&te.decRef(g.autoReleaseAssets)}var ti=cU._depends.get(g.uuid);if(ti&&ti.persistDeps)for(var tr=ti.persistDeps,ta=0,th=tr.length;ta<th;ta++){var tu=u3.get(tr[ta]);tu&&tu.decRef(g.autoReleaseAssets)}g.uuid!==v.uuid&&cU.remove(g.uuid)}var tl=cU._depends.get(v.uuid);for(var tc in tl&&(tl.persistDeps=[]),S){for(var t_,tf,tp=S[tc],tm=this._persistNodeDeps.get(tp.uuid),tg=f(tm);!(tf=tg()).done;){var tv=tf.value,ty=u3.get(tv);ty&&ty.addRef()}tl&&(t_=tl.persistDeps).push.apply(t_,tm)}},g.tryRelease=function(g,v){void 0===v&&(v=!1),_instanceof(g,lx)&&(v?this._free(g,v):(this._toDelete.add(g._uuid,g),this._eventListener||(this._eventListener=!0,Ee(this._freeAssets.bind(this)))))},g._freeAssets=function(){var g=this;this._eventListener=!1,this._toDelete.forEach(function(v){g._free(v)}),this._toDelete.clear()},g._free=function(g,v){void 0===v&&(v=!1);var S=g._uuid;if(this._toDelete.remove(S),Ma(g,!0)&&-1===this._dontDestroyAssets.indexOf(S)&&!(!v&&g.refCount>0&&function(g){var v=Object.create(null);if(v[g._uuid]=g.refCount,Nv(g,v,f7,-1),f7.length=0,0!==v[g._uuid])return v[g._uuid];for(var S in v)0!==v[S]&&Nv(u3.get(S),v,f7,1);return f7.length=0,v[g._uuid]}(g)>0)){u3.remove(S);for(var O=cU.getDeps(S),X=0,Y=O.length;X<Y;X++){var te=u3.get(O[X]);te&&(te.decRef(!1),this._free(te,!1))}g.destroy(),cU.remove(S)}},t1}());function Vv(g,v){for(var S=0,O=g.input.length;S<O;S++){var X=g.input[S];v&&!X.isNative&&_instanceof(X.content,lx)&&X.content.decRef(!1),X.recycle()}g.input=null}function Uv(g,v){return v?/\?/.test(g)?g+"&_t="+Date.now():g+"?_t="+Date.now():g}function Hv(g,v,S,O,X){void 0===X&&(X=0),g(X,function(Y,te){X++,!Y||X>v?O&&O(Y,te):setTimeout(function(){Hv(g,v,S,O,X)},S)})}function zv(g,v,S,O,X){try{for(var Y=cU.parse(g,v),te=0,ti=Y.deps.length;te<ti;te++){var tr=Y.deps[te];tr in S||(S[tr]=!0,O.push({uuid:tr,bundle:X&&X.name}))}Y.nativeDep&&(X&&(Y.nativeDep.bundle=X.name),O.push(r({},Y.nativeDep)))}catch(g){k(g.message,g.stack)}}function Wv(g,v,S){v&&(S=void 0!==S?S:X.assetManager.cacheAsset,Ff(v)||!S||v.isDefault||u3.add(g,v))}function Xv(g,v,S){var O=0,X=[],Y=g.length;0===Y&&S&&S(X);for(var a=function(g){g&&X.push(g),++O===Y&&S&&S(X)},te=0;te<Y;te++)v(g[te],a)}function jv(g,v,S){var O=g,X=v,Y=S;if(void 0===S){var te="function"==typeof g;v?(Y=v,te||(X=null)):void 0===v&&te&&(Y=g,O=null,X=null),void 0!==v&&te&&(X=g,O=null)}return{options:O||Object.create(null),onProgress:X,onComplete:Y}}function Yv(g,v,S){var O=g,X=v,Y=S;if(void 0===S){var te=Pt(g,lx);v?(Y=v,te&&(X=null)):void 0!==v||te||(Y=g,X=null,O=null),void 0===v||te||(X=g,O=null)}return{type:O,onProgress:X||null,onComplete:Y}}function qv(g,v,S,O){if(void 0===O&&(O={}),!S[v]||O[v])return!1;O[v]=!0;var X=!1,Y=cU.getDeps(v);if(Y)for(var te=0,ti=Y.length;te<ti;te++){var tr=Y[te];if(tr===g||qv(g,tr,S,O)){X=!0;break}}return X}function Kv(g){return function(v,S){if(g){var O=[];Array.isArray(S)?S.forEach(function(g){return _instanceof(g,lx)&&O.push(g.addRef())}):_instanceof(S,lx)&&O.push(S.addRef()),Ee(function(){O.forEach(function(g){return g.decRef(!1)}),g(v,S)})}}}var de=function(){function t1(){this._config=new f6}var g=t1.prototype;return g.getInfoWithPath=function(g,v){return this._config.getInfoWithPath(g,v)},g.getDirWithPath=function(g,v,S){return this._config.getDirWithPath(g,v,S)},g.getAssetInfo=function(g){return this._config.getAssetInfo(g)},g.getSceneInfo=function(g){return this._config.getSceneInfo(g)},g.init=function(g){this._config.init(g),u6.add(g.name,this)},g.load=function(g,v,S,O){var Y=Yv(v,S,O),te=Y.type,ti=Y.onProgress,tr=Y.onComplete,ta={__requestType__:u2.PATH,type:te,bundle:this.name,__outputAsArray__:Array.isArray(g)};X.assetManager.loadAny(g,ta,ti,tr)},g.preload=function(g,v,S,O){var Y=Yv(v,S,O),te=Y.type,ti=Y.onProgress,tr=Y.onComplete;X.assetManager.preloadAny(g,{__requestType__:u2.PATH,type:te,bundle:this.name},ti,tr)},g.loadDir=function(g,v,S,O){var Y=Yv(v,S,O),te=Y.type,ti=Y.onProgress,tr=Y.onComplete;X.assetManager.loadAny(g,{__requestType__:u2.DIR,type:te,bundle:this.name,__outputAsArray__:!0},ti,tr)},g.preloadDir=function(g,v,S,O){var Y=Yv(v,S,O),te=Y.type,ti=Y.onProgress,tr=Y.onComplete;X.assetManager.preloadAny(g,{__requestType__:u2.DIR,type:te,bundle:this.name},ti,tr)},g.loadScene=function(g,v,S,O){var Y=jv(v,S,O),te=Y.options,ti=Y.onProgress,tr=Y.onComplete;te.preset=te.preset||"scene",te.bundle=this.name,X.assetManager.loadAny({scene:g},te,ti,function(g,v){if(g)k(g.message,g.stack);else if(v.scene){var S=v.scene;S._id=v._uuid,S.name=v.name}else g=new Error("The asset "+v._uuid+" is not a scene");tr&&tr(g,v)})},g.preloadScene=function(g,v,S,O){var Y=jv(v,S,O),te=Y.options,ti=Y.onProgress,tr=Y.onComplete;te.bundle=this.name,X.assetManager.preloadAny({scene:g},te,ti,function(v){v&&J(1210,g,v.message),tr&&tr(v)})},g.get=function(g,v){var S=this.getInfoWithPath(g,v);return S&&u3.get(S.uuid)||null},g.release=function(g,v){var S=this.get(g,v);S&&f9.tryRelease(S,!0)},g.releaseUnusedAssets=function(){var g=this;u3.forEach(function(v){var S=g.getAssetInfo(v._uuid);S&&!S.redirect&&f9.tryRelease(v)})},g.releaseAll=function(){var g=this;u3.forEach(function(v){var S=g.getAssetInfo(v._uuid);S&&!S.redirect&&f9.tryRelease(v,!0)})},g._destroy=function(){this._config.destroy()},n(t1,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t1}(),dn=g("e3",new de);function Zv(g,v,S){var O=new te.Image;function r(){O.removeEventListener("load",r),O.removeEventListener("error",s),S&&S(null,O)}function s(){O.removeEventListener("load",r),O.removeEventListener("error",s),S&&S(new Error(tt(4930,g)))}return"file:"!==te.location.protocol&&(O.crossOrigin="anonymous"),O.addEventListener("load",r),O.addEventListener("error",s),O.src=g,O}function $v(g,v,S,O){var X=new XMLHttpRequest,Y="download failed: "+g+", status: ";if(X.open("GET",g,!0),void 0!==v.xhrResponseType&&(X.responseType=v.xhrResponseType),void 0!==v.xhrWithCredentials&&(X.withCredentials=v.xhrWithCredentials),void 0!==v.xhrMimeType&&X.overrideMimeType&&X.overrideMimeType(v.xhrMimeType),void 0!==v.xhrTimeout&&(X.timeout=v.xhrTimeout),v.xhrHeader)for(var te in v.xhrHeader)X.setRequestHeader(te,v.xhrHeader[te]);return X.onload=function(){200===X.status||0===X.status?O&&O(null,X.response):O&&O(new Error(""+Y+X.status+"(no response)"))},S&&(X.onprogress=function(g){g.lengthComputable&&S(g.loaded,g.total)}),X.onerror=function(){O&&O(new Error(""+Y+X.status+"(error)"))},X.ontimeout=function(){O&&O(new Error(""+Y+X.status+"(time out)"))},X.onabort=function(){O&&O(new Error(""+Y+X.status+"(abort)"))},X.send(null),X}X.resources=dn;var ds=te.document,da={};function iy(g,v,S){if(da[g])return S&&S(null),null;var O=ds.createElement("script");function r(){O.parentNode.removeChild(O),O.removeEventListener("load",r,!1),O.removeEventListener("error",s,!1),da[g]=!0,S&&S(null)}function s(){O.parentNode.removeChild(O),O.removeEventListener("load",r,!1),O.removeEventListener("error",s,!1),S&&S(new Error(tt(4928,g)))}return"file:"!==te.location.protocol&&(O.crossOrigin="anonymous"),O.async=v.scriptAsyncLoading||!1,O.src=g,O.addEventListener("load",r,!1),O.addEventListener("error",s,!1),ds.body.appendChild(O),O}var dh=/^(?:\w+:\/\/|\.+\/).+/,ry=function(g,v,S){(a3.hasFeature(a3.Feature.IMAGE_BITMAP)&&X.assetManager.allowImageBitmap?sy:Zv)(g,v,S)},sy=function(g,v,S){v.xhrResponseType="blob",$v(g,v,v.onFileProgress,S)},ay=function(g,v,S){v.xhrResponseType="json",$v(g,v,v.onFileProgress,S)},oy=function(g,v,S){v.xhrResponseType="arraybuffer",$v(g,v,v.onFileProgress,S)},hy=function(g,v,S){dg._downloadJson(g,v,function(v,O){if(v)S(v);else{var X=Yd(O);Promise.all(X.chunks.map(function(S){return new Promise(function(O,X){dg._downloadArrayBuffer(""+Lu(g)+S,{},function(g,S){v?X(v):O(new Uint8Array(S))})})})).then(function(g){var v=new cE(X.document,g);S(null,v)}).catch(function(g){S(g)})}})},uy=function(g,v,S){dg._downloadArrayBuffer(g,v,function(g,v){if(g)S(g);else try{var O=qd(new Uint8Array(v));S(null,O)}catch(g){S(g)}})},ly=function(g,v,S){v.xhrResponseType="text",$v(g,v,v.onFileProgress,S)},cy=function(g,v,S){var O=Fu(g),X=g;dh.test(X)||(X=-1!==dg.remoteBundles.indexOf(O)?dg.remoteServerAddress+"remote/"+O:"assets/"+O);var Y=v.version||dg.bundleVers[O],te=0,ti=null,tr=null;ay(X+"/config."+(Y?Y+".":"")+"json",v,function(g,v){tr=g||tr,(ti=v)&&(ti.base=X+"/"),2==++te&&S(tr,ti)}),iy(X+"/index."+(Y?Y+".":"")+"js",v,function(g){tr=g||tr,2==++te&&S(tr,ti)})},dl=function(){var g=e.prototype;function e(){this.maxConcurrency=15,this.maxRequestsPerFrame=15,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers={},this.remoteBundles=[],this.downloadDomImage=Zv,this.downloadDomAudio=null,this.downloadFile=$v,this.downloadScript=iy,this._downloadArrayBuffer=oy,this._downloadJson=ay,this._downloaders={".png":ry,".jpg":ry,".bmp":ry,".jpeg":ry,".gif":ry,".ico":ry,".tiff":ry,".webp":ry,".image":ry,".pvr":oy,".pkm":oy,".astc":oy,".txt":ly,".xml":ly,".vsh":ly,".fsh":ly,".atlas":ly,".tmx":ly,".tsx":ly,".json":ay,".ExportJson":ay,".plist":ly,".ccon":hy,".cconb":uy,".fnt":ly,".binary":oy,".bin":oy,".dbbin":oy,".skel":oy,".js":iy,bundle:cy,default:ly},this._downloading=new u0,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}return g.init=function(g,v,S){void 0===g&&(g=""),void 0===v&&(v={}),void 0===S&&(S=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=g,this.bundleVers=v,this.remoteBundles=S},g.register=function(g,v){"object"==(void 0===g?"undefined":_type_of(g))?wt(this._downloaders,g):this._downloaders[g]=v},g.download=function(g,v,S,O,X){var Y=this,te=u4.get(g);if(te)X(null,te);else{var ti=this._downloading.get(g);if(ti){ti.push(X);var tr=this._queue.find(function(v){return v.id===g});if(!tr)return;var ta=O.priority||0;tr.priority<ta&&(tr.priority=ta,this._queueDirty=!0)}else{var th=void 0!==O.maxRetryCount?O.maxRetryCount:this.maxRetryCount,tu=void 0!==O.maxConcurrency?O.maxConcurrency:this.maxConcurrency,tl=void 0!==O.maxRequestsPerFrame?O.maxRequestsPerFrame:this.maxRequestsPerFrame,tc=this._downloaders[S]||this._downloaders.default;Hv(function(S,te){if(0===S&&Y._downloading.add(g,[X]),Y.limited){Y._updateTime();var o=function(g,v){Y._totalNum--,Y._handleQueueInNextFrame(tu,tl),te(g,v)};Y._totalNum<tu&&Y._totalNumThisPeriod<tl?(tc(Uv(v,Y.appendTimeStamp),O,o),Y._totalNum++,Y._totalNumThisPeriod++):(Y._queue.push({id:g,priority:O.priority||0,url:v,options:O,done:o,handler:tc}),Y._queueDirty=!0,Y._totalNum<tu&&Y._handleQueueInNextFrame(tu,tl))}else tc(Uv(v,Y.appendTimeStamp),O,te)},th,this.retryInterval,function(v,S){v||u4.add(g,S);for(var O=Y._downloading.remove(g),X=0,te=O.length;X<te;X++)O[X](v,S)})}}},g.loadSubpackage=function(g,v){X.assetManager.loadBundle(g,null,v)},g._updateTime=function(){var g=performance.now(),v=X.game.deltaTime,S=v>this._maxInterval?this._maxInterval:v;g-this._lastDate>1e3*S&&(this._totalNumThisPeriod=0,this._lastDate=g)},g._handleQueue=function(g,v){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<g&&this._totalNumThisPeriod<v;){this._queueDirty&&(this._queue.sort(function(g,v){return g.priority-v.priority}),this._queueDirty=!1);var S=this._queue.pop();if(!S)break;this._totalNum++,this._totalNumThisPeriod++,S.handler(Uv(S.url,this.appendTimeStamp),S.options,S.done)}this._handleQueueInNextFrame(g,v)},g._handleQueueInNextFrame=function(g,v){!this._checkNextPeriod&&this._queue.length>0&&(Ee(this._handleQueue.bind(this),g,v),this._checkNextPeriod=!0)},n(e,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}],[{key:"instance",get:function(){return e._instance||(e._instance=new e),e._instance}}]),e}();dl._instance=void 0;var dc,d_,df,dd,dp,dm,dg=dl.instance,dv=dl.instance,dy=g("dT",nJ("cc.JsonAsset")((d_=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).json=df&&df(),v}return s(e,g),e}(lx),df=ws(d_.prototype,"json",[n2],function(){return null}),dc=d_))||dc);X.JsonAsset=dy;var dS,dA,dT=g("dS",nJ("cc.TextAsset")((dp=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).text=dm&&dm(),v}return s(e,g),e.prototype.toString=function(){return this.text},e}(lx),dm=ws(dp.prototype,"text",[n2],function(){return""}),dd=dp))||dd);X.TextAsset=dT;var dE=g("dP",nJ("cc.BufferAsset")((p((dA=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._buffer=null,v}s(e,g);var v=e.prototype;return v.buffer=function(){return this._buffer,this._buffer},v.validate=function(){return!!this._buffer},n(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(g){_instanceof(g,ArrayBuffer)?this._buffer=g:this._buffer=g.buffer}}]),e}(lx)).prototype,"_nativeAsset",[rE],Object.getOwnPropertyDescriptor(dA.prototype,"_nativeAsset"),dA.prototype),dS=dA))||dS);function xy(g,v,S,O){var X=null,Y=null;try{(X=new lX)._nativeUrl=g,X._nativeAsset=v}catch(g){Y=g}O(Y,X)}function Ry(g,v,S,O){var X=new dy;X.json=v,O(null,X)}function wy(g,v,S,O){var X=new dT;X.text=v,O(null,X)}function Iy(g,v,S,O){var X=new dE;X._nativeUrl=g,X._nativeAsset=v,O(null,X)}function By(g,v,S,O){var X=new lx;X._nativeUrl=g,X._nativeAsset=v,O(null,X)}function Py(g,S,O,X){var Y=u6.get(S.name);Y||(Y=S.name===ln.RESOURCES?dn:new de,S.base=S.base||g+"/",Y.init(S)),v.import("virtual:///prerequisite-imports/"+Y.name).then(function(){X(null,Y)}).catch(X)}X.BufferAsset=dE;var dC=new(function(){function t1(){this._creating=new u0,this._producers={".png":xy,".jpg":xy,".bmp":xy,".jpeg":xy,".gif":xy,".ico":xy,".tiff":xy,".webp":xy,".image":xy,".pvr":xy,".pkm":xy,".txt":wy,".xml":wy,".vsh":wy,".fsh":wy,".atlas":wy,".tmx":wy,".tsx":wy,".fnt":wy,".json":Ry,".ExportJson":Ry,".binary":Iy,".bin":Iy,".dbbin":Iy,".skel":Iy,bundle:Py,default:By}}var g=t1.prototype;return g.register=function(g,v){"object"==(void 0===g?"undefined":_type_of(g))?wt(this._producers,g):this._producers[g]=v},g.create=function(g,v,S,O,X){var Y=this,te=this._producers[S]||this._producers.default,ti=u3.get(g);if(O.reloadAsset||!ti){var tr=this._creating.get(g);tr?tr.push(X):(this._creating.add(g,[X]),te(g,v,O,function(v,S){!v&&_instanceof(S,lx)&&(S._uuid=g,Wv(g,S,O.cacheAsset));for(var X=Y._creating.remove(g),te=0,ti=X.length;te<ti;te++)X[te](v,S)}))}else X(null,ti)},t1}()),dx=new(function(){function t1(){this._loading=new u0,this._unpackers={".json":this.unpackJson}}var g=t1.prototype;return g.unpackJson=function(g,v,S,O){var X=gt(!0),Y=null;if(Array.isArray(v)){(v=function(g){if(g[0]<1)throw new Error(tt(5304,g[0]));gp(g,!0,void 0,yp.reportMissingClass),vp(g);for(var v=new Sp(g[0]),S=g[1],O=g[2],X=g[3],Y=g[4],te=g[5],ti=0;ti<te.length;++ti)te[ti].unshift(v,S,O,X,Y);return te}(v)).length!==g.length&&J(4915);for(var te=0;te<g.length;te++)X[g[te]+"@import"]=v[te]}else{var ti=Xt(cK),tr=Xt(lX);if(v.type===ti&&v.data){var ta=v.data;ta.length!==g.length&&J(4915);for(var th=0;th<g.length;th++)X[g[th]+"@import"]=Ap(ti,{base:ta[th][0],mipmaps:ta[th][1]})}else{if(v.type!==tr||!v.data)return void O(Y=new Error("unmatched type pack!"),null);var tu=v.data;tu.length!==g.length&&J(4915);for(var tl=0;tl<g.length;tl++)X[g[tl]+"@import"]=tu[tl]}}O(Y,X)},g.init=function(){this._loading.clear()},g.register=function(g,v){"object"==(void 0===g?"undefined":_type_of(g))?wt(this._unpackers,g):this._unpackers[g]=v},g.unpack=function(g,v,S,O,X){v?(0,this._unpackers[S])(g,v,O,X):X(new Error("package data is wrong!"))},g.load=function(g,v,S){var O=this;if(!g.isNative&&g.info&&g.info.packs){if(u4.has(g.id))S(null,u4.get(g.id));else{var X=g.info.packs,Y=X.find(function(g){return O._loading.has(g.uuid)});if(Y)this._loading.get(Y.uuid).push({onComplete:S,id:g.id});else{var te=X[0];this._loading.add(te.uuid,[{onComplete:S,id:g.id}]),g.config;var ti=Gf(te.uuid,{ext:te.ext,bundle:g.config.name});dv.download(te.uuid,ti,te.ext,g.options,function(v,S){u4.remove(te.uuid),v&&k(v.message,v.stack),O.unpack(te.packedUuids,S,te.ext,g.options,function(g,S){if(!g)for(var X in S)u4.add(X,S[X]);for(var Y=O._loading.remove(te.uuid),ti=0,tr=Y.length;ti<tr;ti++){var ta=Y[ti];if(v||g)ta.onComplete(v||g);else{var th=S[ta.id];th?ta.onComplete(null,th):ta.onComplete(new Error("can not retrieve data from package"))}}})})}}}else dv.download(g.id,g.url,g.ext,g.options,S)},t1}());function My(g,v){var S=!1;g.progress||(g.progress={finish:0,total:g.input.length,canInvoke:!0},S=!0);var O=g.options,Y=g.progress,te=[],ti=Y.total,tr=O.__exclude__=O.__exclude__||Object.create(null);g.output=[],Xv(g.input,function(O,ta){if(!O.isNative&&u3.has(O.uuid)){var th=u3.get(O.uuid);return O.content=th.addRef(),g.output.push(O),Y.canInvoke&&g.dispatch("progress",++Y.finish,Y.total,O),void ta()}dx.load(O,g.options,function(th,tu){th?g.isFinished||(!X.assetManager.force||S?(k(th.message,th.stack),Y.canInvoke=!1,v(th)):(g.output.push(O),Y.canInvoke&&g.dispatch("progress",++Y.finish,Y.total,O))):g.isFinished||(O.file=tu,g.output.push(O),O.isNative||(tr[O.uuid]=!0,zv(O.uuid,tu,tr,te,O.config),Y.total=ti+te.length),Y.canInvoke&&g.dispatch("progress",++Y.finish,Y.total,O)),ta()})},function(){if(g.isFinished)return Vv(g,!0),void g.dispatch("error");if(te.length>0){var X=la.create({input:te,progress:Y,options:O,onProgress:g.onProgress,onError:la.prototype.recycle,onComplete:function(O){var Y;O||((Y=g.output).push.apply(Y,X.output),X.recycle()),S&&Ly(g),v(O)}});u9.async(X)}else S&&Ly(g),v()})}function Ly(g){for(var v=g.output,S=0,O=v.length;S<O;S++)v[S].content&&v[S].content.decRef(!1)}var db=new(function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.parse=function(g){var v=this._parseXML(g).documentElement;if("plist"!==v.tagName)return q(5100),{};for(var S=null,O=0,X=v.childNodes.length;O<X&&1!==(S=v.childNodes[O]).nodeType;O++);return this._parseNode(S)},v._parseNode=function(g){var v=null,S=g.tagName;if("dict"===S)v=this._parseDict(g);else if("array"===S)v=this._parseArray(g);else if("string"===S){if(1===g.childNodes.length)v=g.firstChild.nodeValue;else{v="";for(var O=0;O<g.childNodes.length;O++)v+=g.childNodes[O].nodeValue}}else"false"===S?v=!1:"true"===S?v=!0:"real"===S?v=parseFloat(g.firstChild.nodeValue):"integer"===S&&(v=parseInt(g.firstChild.nodeValue,10));return v},v._parseArray=function(g){for(var v=[],S=0,O=g.childNodes.length;S<O;S++){var X=g.childNodes[S];1===X.nodeType&&v.push(this._parseNode(X))}return v},v._parseDict=function(g){for(var v={},S="",O=0,X=g.childNodes.length;O<X;O++){var Y=g.childNodes[O];1===Y.nodeType&&("key"===Y.tagName?S=Y.firstChild.nodeValue:v[S]=this._parseNode(Y))}return v},e}(function(){function t1(){this._parser=null,globalThis.DOMParser&&(this._parser=new DOMParser)}var g=t1.prototype;return g.parse=function(g){return this._parseXML(g)},g._parseXML=function(g){if(this._parser)return this._parser.parseFromString(g,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t1}())),dR=function(){function t1(){this._parsing=new u0,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var g=t1.prototype;return g.parseImage=function(g,v,S){_instanceof(g,HTMLImageElement)?S(null,g):createImageBitmap(g,{premultiplyAlpha:"none"}).then(function(g){S(null,g)},function(g){S(g,null)})},g.parsePVRTex=function(g,v,S){var O=null,X=null;try{X=lX.parseCompressedTextures(g,0)}catch(g){O=g,console.warn(O)}S(O,X)},g.parsePKMTex=function(g,v,S){var O=null,X=null;try{X=lX.parseCompressedTextures(g,1)}catch(g){O=g,console.warn(O)}S(O,X)},g.parseASTCTex=function(g,v,S){var O=null,X=null;try{X=lX.parseCompressedTextures(g,2)}catch(g){O=g,console.warn(O)}S(O,X)},g.parsePlist=function(g,v,S){var O=null,X=db.parse(g);X||(O=new Error("parse failed")),S(O,X)},g.parseImport=function(g,v,S){if(g){var O=null,X=null;try{O=bp(g,v)}catch(g){X=g}S(X,O)}else S(new Error("The json file of asset "+v.__uuid__+" is empty or missing"))},g.init=function(){this._parsing.clear()},g.register=function(g,v){"object"==(void 0===g?"undefined":_type_of(g))?wt(this._parsers,g):this._parsers[g]=v},g.parse=function(g,v,S,O,X){var Y=this,te=u8.get(g);if(te)X(null,te);else{var ti=this._parsing.get(g);if(ti)ti.push(X);else{var tr=this._parsers[S];tr?(this._parsing.add(g,[X]),tr(v,O,function(v,S){v?u4.remove(g):Ff(S)||u8.add(g,S);for(var O=Y._parsing.remove(g),X=0,te=O.length;X<te;X++)O[X](v,S)})):X(null,v)}}},n(t1,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t1),this._instance}}]),t1}();dR._instance=void 0;var dw=dR.instance;function ky(g,v){var S=!1;g.progress||(g.progress={finish:0,total:g.input.length,canInvoke:!0},S=!0);var O=g.options,Y=g.progress;O.__exclude__=O.__exclude__||Object.create(null),g.output=[],Xv(g.input,function(te,ti){var tr=la.create({input:te,onProgress:g.onProgress,options:O,progress:Y,onComplete:function(O,ta){O&&!g.isFinished&&(!X.assetManager.force||S?(k(O.message,O.stack),Y.canInvoke=!1,v(O)):Y.canInvoke&&g.dispatch("progress",++Y.finish,Y.total,te)),g.output.push(ta),tr.recycle(),ti(null)}});dI.async(tr)},function(){if(O.__exclude__=null,g.isFinished)return Vv(g,!0),void g.dispatch("error");(function(g){var v=g.source;if(g.options.__outputAsArray__||1!==v.length)for(var S=g.output=[],O=0,X=v.length;O<X;O++)S.push(v[O].content);else g.output=v[0].content})(g),Vv(g,!0),v()})}var dI=new u1("loadOneAsset",[function(g,v){var S=g.output=g.input,O=S.options,X=S.isNative,Y=S.uuid,te=S.file,ti=O.reloadAsset;te||!ti&&!X&&u3.has(Y)?v():dx.load(S,g.options,function(g,O){S.file=O,v(g)})},function(g,v){var S=g.output=g.input,O=g.progress,Y=g.options.__exclude__,te=S.id,ti=S.file,tr=S.options;if(S.isNative)dw.parse(te,ti,S.ext,tr,function(X,Y){X?v(X):(S.content=Y,O.canInvoke&&g.dispatch("progress",++O.finish,O.total,S),u4.remove(te),u8.remove(te),v())});else{var ta=S.uuid;if(ta in Y){var th=Y[ta],tu=th.finish,tl=th.content,tc=th.err,t_=th.callbacks;O.canInvoke&&g.dispatch("progress",++O.finish,O.total,S),tu||qv(ta,ta,Y)?(tl&&tl.addRef(),S.content=tl,v(tc)):t_.push({done:v,item:S})}else if(!tr.reloadAsset&&u3.has(ta)){var tf=u3.get(ta);S.content=tf.addRef(),O.canInvoke&&g.dispatch("progress",++O.finish,O.total,S),v()}else tr.__uuid__=ta,dw.parse(te,ti,"import",tr,function(S,O){S?v(S):function(g,v,S){var O=g.input,Y=g.progress,te=O,ti=te.uuid,tr=te.id,ta=te.options,th=te.config,tu=ta.cacheAsset,tl=[];v.addRef&&v.addRef(),zv(ti,v,Object.create(null),tl,th),Y.canInvoke&&g.dispatch("progress",++Y.finish,Y.total+=tl.length,O);var tc=g.options.__exclude__[ti]={content:v,finish:!1,callbacks:[{done:S,item:O}]},t_=la.create({input:tl,options:g.options,onProgress:g.onProgress,onError:la.prototype.recycle,progress:Y,onComplete:function(g){if(v.decRef&&v.decRef(!1),tc.finish=!0,tc.err=g,!g){for(var S,O=Array.isArray(t_.output)?t_.output:[t_.output],Y=Object.create(null),te=f(O);!(S=te()).done;){var ta=S.value;ta&&(Y[_instanceof(ta,lx)?ta._uuid+"@import":ti+"@native"]=ta)}!function(g,v,S){var O=cF.get(v);if(O){for(var Y=0,te=O.length;Y<te;Y++){var ti=O[Y],tr=S[ti.uuid+"@import"];if(tr)ti.owner[ti.prop]=tr.addRef();else if(k("The asset "+ti.uuid+" is missing!"),X.assetManager.dispatchAssetMissing(v,ti.owner,ti.prop,ti.uuid),ti.type&&ti.type!==lx){var ta=new ti.type;ta.initDefault(ti.uuid),ti.owner[ti.prop]=ta}}cF.delete(v)}cN.has(v)&&(S[g+"@native"]?v._nativeAsset=S[g+"@native"]:console.error("the native asset of "+g+" is missing!"),cN.delete(v))}(ti,v,Y);try{"function"!=typeof v.onLoaded||ck.has(v)||cN.has(v)||(v.onLoaded(),ck.add(v))}catch(g){k("The asset "+ti+" is invalid for some reason, detail message: "+g.message+", stack: "+g.stack)}u4.remove(tr),u8.remove(tr),Wv(ti,v,tu),t_.recycle()}for(var th=tc.callbacks,tl=0,tf=th.length;tl<tf;tl++){var tp=th[tl];v.addRef&&v.addRef(),tp.item.content=v,tp.done(g)}th.length=0}});u7.async(t_)}(g,O,v)})}}]);function Uy(g,v){var S=g.options,O=Object.create(null),X=Object.create(null);for(var Y in S)switch(Y){case u2.PATH:case u2.UUID:case u2.DIR:case u2.SCENE:case u2.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":O[Y]=S[Y];break;case"__exclude__":case"__outputAsArray__":X[Y]=S[Y];break;default:O[Y]=S[Y],X[Y]=S[Y]}g.options=X;var te=la.create({input:g.input,options:O}),ti=null;try{g.output=g.source=le.sync(te)}catch(g){ti=g;for(var tr=0,ta=te.output.length;tr<ta;tr++)te.output[tr].recycle()}te.recycle(),v(ti)}var dB=function(){function t1(){this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t1.create=function(){return 0!==t1._deadPool.length?t1._deadPool.pop():new t1},t1.prototype.recycle=function(){t1._deadPool.length!==t1.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t1._deadPool.push(this))},n(t1,[{key:"id",get:function(){return this._id||(this._id=(this.overrideUuid||this.uuid)+"@"+(this.isNative?"native":"import")),this._id}}]),t1}();dB.MAX_DEAD_NUM=500,dB._deadPool=[];var dP=[];function Wy(g){var v=g.options,S=Array.isArray(g.input)?g.input:[g.input];g.output=[];for(var n=function(){var X=S[O],Y=dB.create(),te=null,ti=null;if("string"==typeof X&&((X=Object.create(null))[v.__requestType__||u2.UUID]=S[O]),"object"==(void 0===X?"undefined":_type_of(X))){Rt(X,v),X.preset&&Rt(X,lr[X.preset]);var h=function(){var g;switch(tr){case u2.UUID:var v,O=Y.uuid=Of(X.uuid);if(!X.bundle){var ta=u6.find(function(g){return!!g.getAssetInfo(O)});X.bundle=ta&&ta.name}if(u6.has(X.bundle)){if(te=u6.get(X.bundle).config,(ti=te.getAssetInfo(O))&&ti.redirect){if(!u6.has(ti.redirect))throw new Error("Please load bundle "+ti.redirect+" first");te=u6.get(ti.redirect).config,ti=te.getAssetInfo(O)}Y.config=te,Y.info=ti}Y.ext=X.ext||(null===(v=ti)||void 0===v?void 0:v.extension)||".json";break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case u2.DIR:if(u6.has(X.bundle)){u6.get(X.bundle).config.getDirWithPath(X.dir,X.type,dP);for(var th,tu=f(dP);!(th=tu()).done;){var tl=th.value;S.push({uuid:tl.uuid,__isNative__:!1,ext:tl.extension||".json",bundle:X.bundle})}dP.length=0}Y.recycle(),Y=null;break;case u2.PATH:if(u6.has(X.bundle)){if(te=u6.get(X.bundle).config,(ti=te.getInfoWithPath(X.path,X.type))&&ti.redirect){if(!u6.has(ti.redirect))throw new Error("you need to load bundle "+ti.redirect+" first");te=u6.get(ti.redirect).config,ti=te.getAssetInfo(ti.uuid)}if(!ti)throw Y.recycle(),new Error("Bundle "+X.bundle+" doesn't contain "+X.path);Y.config=te,Y.uuid=ti.uuid,Y.info=ti}Y.ext=X.ext||(null===(g=ti)||void 0===g?void 0:g.extension)||".json";break;case u2.SCENE:if(!X.bundle){var tc=u6.find(function(g){return!!g.getSceneInfo(X.scene)});X.bundle=tc&&tc.name}if(u6.has(X.bundle)){if(te=u6.get(X.bundle).config,(ti=te.getSceneInfo(X.scene))&&ti.redirect){if(!u6.has(ti.redirect))throw new Error("you need to load bundle "+ti.redirect+" first");te=u6.get(ti.redirect).config,ti=te.getAssetInfo(ti.uuid)}if(!ti)throw Y.recycle(),new Error("Bundle "+te.name+" doesn't contain scene "+X.scene);Y.config=te,Y.uuid=ti.uuid,Y.info=ti}break;case"__isNative__":Y.isNative=X.__isNative__;break;case u2.URL:Y.url=X.url,Y.uuid=X.uuid||X.url,Y.ext=X.ext||Mu(X.url),Y.isNative=void 0===X.__isNative__||X.__isNative__;break;default:Y.options[tr]=X[tr]}if(!Y)return 1};for(var tr in X)if(h())break}if(!Y)return 1;if(g.output.push(Y),!Y.uuid&&!Y.url)throw new Error("Can not parse this input:"+JSON.stringify(X))},O=0;O<S.length;O++)n();return null}function Xy(g){for(var v=g.output=g.input,i=function(){var g=v[S];if(li.has(g.uuid)){var O=li.get(g.uuid),X=u6.find(function(g){return!!g.getAssetInfo(O)});if(X){var Y;g.overrideUuid=O;var te=X.config,ti=te.getAssetInfo(O);if(ti&&ti.redirect){if(!u6.has(ti.redirect))throw new Error("Please load bundle "+ti.redirect+" first");ti=(te=u6.get(ti.redirect).config).getAssetInfo(O)}g.config=te,g.info=ti,g.ext=g.isNative?g.ext:(null===(Y=ti)||void 0===Y?void 0:Y.extension)||".json"}else q(16201,O,g.uuid)}},S=0;S<v.length;S++)i()}function jy(g){for(var v=g.output=g.input,S=0;S<v.length;S++){var O=v[S];if(!O.url){var Y,te,ti=O.config;te=O.isNative?ti&&ti.nativeBase?ti.base+ti.nativeBase:X.assetManager.generalNativeBase:ti&&ti.importBase?ti.base+ti.importBase:X.assetManager.generalImportBase;var tr=O.overrideUuid||O.uuid,ta="";O.info&&(ta=O.isNative?O.info.nativeVer?"."+O.info.nativeVer:"":O.info.ver?"."+O.info.ver:""),Y=".ttf"===O.ext?te+"/"+tr.slice(0,2)+"/"+tr+ta+"/"+O.options.__nativeName__:te+"/"+tr.slice(0,2)+"/"+tr+ta+O.ext,O.url=Y}}return null}var dD="asset-missing",dM=g("e2",function(){function t1(){this.pipeline=u7.append(Uy).append(ky),this.fetchPipeline=u9.append(Uy).append(My),this.transformPipeline=le.append(Wy).append(Xy).append(jy),this.bundles=u6,this.assets=u3,this.assetsOverrideMap=li,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=cU,this.force=false,this.allowImageBitmap=!1,this.utils=lA,this.downloader=dv,this.parser=dw,this.packManager=dx,this.cacheAsset=!0,this.cacheManager=null,this.presets=lr,this.factory=dC,this.preprocessPipe=Uy,this.fetchPipe=My,this.loadPipe=ky,this.references=null,this._releaseManager=f9,this._files=u4,this._parsed=u8,this._parsePipeline=null,this._projectBundles=[],this._eventTarget=new aC}var g=t1.prototype;return g.onAssetMissing=function(g,v){this._eventTarget.on(dD,g,v)},g.offAssetMissing=function(g,v){this._eventTarget.off(dD,g,v)},g.dispatchAssetMissing=function(g,v,S,O){this._eventTarget.emit(dD,g,v,S,O)},g.init=function(g){void 0===g&&(g={});var v=g.server||tQ.querySettings(tK.Category.ASSETS,"server")||"",S=g.bundleVers||tQ.querySettings(tK.Category.ASSETS,"bundleVers")||{},O=g.remoteBundles||tQ.querySettings(tK.Category.ASSETS,"remoteBundles")||[],X=g.downloadMaxConcurrency||tQ.querySettings(tK.Category.ASSETS,"downloadMaxConcurrency");X&&X>0&&(this.downloader.maxConcurrency=X),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(v,S,O),this.parser.init(),this.dependUtil.init();var Y=g.importBase||tQ.querySettings(tK.Category.ASSETS,"importBase")||"";Y&&Y.endsWith("/")&&(Y=Y.substr(0,Y.length-1));var te=g.nativeBase||tQ.querySettings(tK.Category.ASSETS,"nativeBase")||"";te&&te.endsWith("/")&&(te=te.substr(0,te.length-1)),this.generalImportBase=Y,this.generalNativeBase=te,this._projectBundles=tQ.querySettings(tK.Category.ASSETS,"projectBundles")||[];var ti=tQ.querySettings(tK.Category.ASSETS,"assetsOverrides")||{};for(var tr in ti)this.assetsOverrideMap.set(tr,ti[tr])},g.getBundle=function(g){return u6.get(g)||null},g.removeBundle=function(g){g._destroy(),u6.remove(g.name)},g.loadAny=function(g,v,S,O){var X=jv(v,S,O),Y=X.options,te=X.onProgress,ti=X.onComplete;Y.preset=Y.preset||"default",g=Array.isArray(g)?g.slice():g;var tr=la.create({input:g,onProgress:te,onComplete:Kv(ti),options:Y});u7.async(tr)},g.preloadAny=function(g,v,S,O){var X=jv(v,S,O),Y=X.options,te=X.onProgress,ti=X.onComplete;Y.preset=Y.preset||"preload",g=Array.isArray(g)?g.slice():g;var tr=la.create({input:g,onProgress:te,onComplete:Kv(ti),options:Y});u9.async(tr)},g.loadRemote=function(g,v,S){var O=jv(v,void 0,S),X=O.options,Y=O.onComplete;X.reloadAsset||!this.assets.has(g)?(X.__isNative__=!0,X.preset=X.preset||"remote",this.loadAny({url:g},X,null,function(v,S){v?(k(v.message,v.stack),Y&&Y(v,S)):dC.create(g,S,X.ext||Mu(g),X,function(g,v){Y&&Y(g,v)})})):Kv(Y)(null,this.assets.get(g))},g.loadBundle=function(g,v,S){var O=jv(v,void 0,S),X=O.options,Y=O.onComplete,te=Fu(g);this.bundles.has(te)?Kv(Y)(null,this.getBundle(te)):(X.preset=X.preset||"bundle",X.ext="bundle",X.__isNative__=!0,this.loadAny({url:g},X,null,function(v,S){v?(k(v.message,v.stack),Y&&Y(v,S)):dC.create(g,S,"bundle",X,function(g,v){Y&&Y(g,v)})}))},g.releaseAsset=function(g){f9.tryRelease(g,!0)},g.releaseUnusedAssets=function(){u3.forEach(function(g){f9.tryRelease(g)})},g.releaseAll=function(){u3.forEach(function(g){f9.tryRelease(g,!0)})},g.loadWithJson=function(){throw new Error("Only valid in Editor")},n(t1,[{key:"main",get:function(){return u6.get(ln.MAIN)||null}},{key:"resources",get:function(){return u6.get(ln.RESOURCES)||null}}],[{key:"instance",get:function(){return this._instance||(this._instance=new t1),this._instance}}]),t1}());dM._instance=void 0,dM.Pipeline=u1,dM.Task=la,dM.Cache=u0,dM.RequestItem=dB,dM.Bundle=de,dM.BuiltinBundleName=ln,dM.CacheManager=function(){this.cacheDir=void 0,this.cacheEnabled=void 0,this.autoClear=void 0,this.cacheInterval=void 0,this.deleteInterval=void 0,this.cachedFiles=void 0},dM.Downloader=dl,dM.Parser=dR,dM.DependUtil=cG;var dO=g("e1",X.assetManager=dM.instance);X.AssetManager=dM;var dL,dk,dG,dV=g("e4",function(){function t1(){this._resources={},this._materialsToBeCompiled=[]}var g=t1.prototype;return g.init=function(){for(var g=this._resources,v=new Uint8Array(16),S=new Uint8Array(16),O=new Uint8Array(16),Y=new Uint8Array(16),te=new Uint8Array(16),ti=0,tr=0;tr<4;tr++)v[ti]=0,v[ti+1]=0,v[ti+2]=0,v[ti+3]=255,S[ti]=0,S[ti+1]=0,S[ti+2]=0,S[ti+3]=0,O[ti]=119,O[ti+1]=119,O[ti+2]=119,O[ti+3]=255,Y[ti]=255,Y[ti+1]=255,Y[ti+2]=255,Y[ti+3]=255,te[ti]=127,te[ti+1]=127,te[ti+2]=255,te[ti+3]=255,ti+=4;var ta=new Uint8Array(1024);ti=0;for(var th=0;th<256;th++)ta[ti]=221,ta[ti+1]=221,ta[ti+2]=221,ta[ti+3]=255,ti+=4;ti=0;for(var tu=0;tu<8;tu++){for(var tl=0;tl<8;tl++)ta[ti]=85,ta[ti+1]=85,ta[ti+2]=85,ta[ti+3]=255,ti+=4;ti+=32}ti+=32;for(var tc=0;tc<8;tc++){for(var t_=0;t_<8;t_++)ta[ti]=85,ta[ti+1]=85,ta[ti+2]=85,ta[ti+3]=255,ti+=4;ti+=32}var tf={width:2,height:2,_data:v,_compressed:!1,format:cK.PixelFormat.RGBA8888},tp={width:2,height:2,_data:S,_compressed:!1,format:cK.PixelFormat.RGBA8888},tm={width:2,height:2,_data:O,_compressed:!1,format:cK.PixelFormat.RGBA8888},tg={width:2,height:2,_data:Y,_compressed:!1,format:cK.PixelFormat.RGBA8888},tv={width:2,height:2,_data:te,_compressed:!1,format:cK.PixelFormat.RGBA8888},ty={width:16,height:16,_data:ta,_compressed:!1,format:cK.PixelFormat.RGBA8888},tS=new lX(tf),tA=new cK;tA._uuid="black-texture",tA.image=tS,g[tA._uuid]=tA;var tT=new lX(tp),tE=new cK;tE._uuid="empty-texture",tE.image=tT,g[tE._uuid]=tE;var tC=new f8;tC._uuid="black-cube-texture",tC.setMipFilter(f8.Filter.NEAREST),tC.image={front:new lX(tf),back:new lX(tf),left:new lX(tf),right:new lX(tf),top:new lX(tf),bottom:new lX(tf)},g[tC._uuid]=tC;var tx=new lX(tm),tb=new cK;tb._uuid="grey-texture",tb.image=tx,g[tb._uuid]=tb;var tw=new f8;tw._uuid="grey-cube-texture",tw.setMipFilter(f8.Filter.NEAREST),tw.image={front:new lX(tm),back:new lX(tm),left:new lX(tm),right:new lX(tm),top:new lX(tm),bottom:new lX(tm)},g[tw._uuid]=tw;var tI=new lX(tg),tB=new cK;tB._uuid="white-texture",tB.image=tI,g[tB._uuid]=tB;var tP=new f8;tP._uuid="white-cube-texture",tP.setMipFilter(f8.Filter.NEAREST),tP.image={front:new lX(tg),back:new lX(tg),left:new lX(tg),right:new lX(tg),top:new lX(tg),bottom:new lX(tg)},g[tP._uuid]=tP;var tD=new lX(tv),tM=new cK;tM._uuid="normal-texture",tM.image=tD,g[tM._uuid]=tM;var tO=new lX(ty),tk=new cK;tk._uuid="default-texture",tk.image=tO,g[tk._uuid]=tk;var tG=new f8;if(tG.setMipFilter(f8.Filter.NEAREST),tG._uuid="default-cube-texture",tG.image={front:new lX(ty),back:new lX(ty),left:new lX(ty),right:new lX(ty),top:new lX(ty),bottom:new lX(ty)},g[tG._uuid]=tG,X.SpriteFrame){var tV=new X.SpriteFrame,tU=tS,tH=new cK;tH.image=tU,tV.texture=tH,tV._uuid="default-spriteframe",g[tV._uuid]=tV}},g.addAsset=function(g,v){this._resources[g]=v},g.get=function(g){return this._resources[g]},g.loadBuiltinAssets=function(){var g=this,v=tQ.querySettings(tK.Category.ENGINE,"builtinAssets");if(!v)return Promise.resolve();var S=this._resources;return new Promise(function(O,Y){dO.loadBundle(ln.INTERNAL,function(te){te?Y(te):dO.loadAny(v,function(v,te){v?Y(v):(te.forEach(function(v){S[v.name]=v,f9.addIgnoredAsset(v),_instanceof(v,X.Material)&&g._materialsToBeCompiled.push(v)}),O())})})})},g.compileBuiltinMaterial=function(){for(var g=0;g<this._materialsToBeCompiled.length;++g)for(var v=this._materialsToBeCompiled[g],S=0;S<v.passes.length;++S)v.passes[S].tryCompile();this._materialsToBeCompiled.length=0},t1}()),dU=g("e5",X.builtinResMgr=new dV),dH=g("da",(dL=new Map,dk=0,function(g){return"number"==typeof g?g:(dL.has(g)||(dL.set(g,1<<dk),dk++),dL.get(g))})),dW=g("d3",function(){function t1(g){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=g.device,this.pass=g}var g=t1.prototype;return g.destroy=function(){for(var g=0;g<this.instances.length;++g){var v=this.instances[g];v.vb.destroy(),v.ia.destroy()}this.instances.length=0},g.merge=function(g,v,S){void 0===S&&(S=null);var O=g.instancedAttributeBlock,X=O.buffer.length;if(X){var Y=g.inputAssembler,te=g.descriptorSet.getTexture(_2),ti=g.descriptorSet.getTexture(fh),tr=g.descriptorSet.getTexture(fc),ta=g.descriptorSet.getTexture(fy),th=g.useReflectionProbeType,tu=S;tu||(tu=g.shaders[v]);for(var tl=g.descriptorSet,tc=0;tc<this.instances.length;++tc){var t_,tf,tp=this.instances[tc];if(!((null===(t_=tp.ia.indexBuffer)||void 0===t_?void 0:t_.objectID)!==(null===(tf=Y.indexBuffer)||void 0===tf?void 0:tf.objectID)||tp.count>=1024)&&tp.lightingMap.objectID===te.objectID&&tp.useReflectionProbeType===th&&tp.reflectionProbeCubemap.objectID===ti.objectID&&tp.reflectionProbePlanarMap.objectID===tr.objectID&&tp.reflectionProbeBlendCubemap.objectID===ta.objectID&&tp.stride===X){if(tp.count>=tp.capacity){tp.capacity<<=1;var tm=tp.stride*tp.capacity,tg=tp.data;tp.data=new Uint8Array(tm),tp.data.set(tg),tp.vb.resize(tm)}return tp.shader=tu,tp.descriptorSet=tl,tp.data.set(O.buffer,tp.stride*tp.count++),void(this.hasPendingModels=!0)}}for(var tv=this._device.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,32*X,X)),ty=new Uint8Array(32*X),tS=Y.vertexBuffers.slice(),tA=Y.attributes.slice(),tT=Y.indexBuffer,tE=0;tE<O.attributes.length;tE++){var tC=O.attributes[tE],tx=new hz(tC.name,tC.format,tC.isNormalized,tS.length,!0);tA.push(tx)}ty.set(O.buffer),tS.push(tv);var tb=new hX(tA,tS,tT),tw=this._device.createInputAssembler(tb);this.instances.push({count:1,capacity:32,vb:tv,data:ty,ia:tw,stride:X,shader:tu,descriptorSet:tl,lightingMap:te,reflectionProbeCubemap:ti,reflectionProbePlanarMap:tr,useReflectionProbeType:th,reflectionProbeBlendCubemap:ta}),this.hasPendingModels=!0}},g.uploadBuffers=function(g){for(var v=0;v<this.instances.length;++v){var S=this.instances[v];S.count&&(S.ia.instanceCount=S.count,g.updateBuffer(S.vb,S.data))}},g.clear=function(){for(var g=0;g<this.instances.length;++g)this.instances[g].count=0;this.hasPendingModels=!1},t1}()),dX=new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.DEVICE),dj=new hb(null),dq=new h8(null);!function(g){g[g.NONE=0]="NONE",g[g.INSTANCING=1]="INSTANCING"}(dG||(dG={}));var dY=function(){function t1(g){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new uk,this._dss=new uL,this._rs=new uO,this._priority=_u.DEFAULT,this._stage=_h.DEFAULT,this._phase=dH("default"),this._passID=0xffffffff,this._subpassID=0xffffffff,this._phaseID=0xffffffff,this._primitive=oY.TRIANGLE_LIST,this._batchingScheme=dG.NONE,this._dynamicStates=o0.NONE,this._instancedBuffers={},this._hash=0,this._root=void 0,this._device=void 0,this._rootBufferDirty=!1,this._root=g,this._device=uZ.gfxDevice}t1.fillPipelineInfo=function(g,v){void 0!==v.priority&&(g._priority=v.priority),void 0!==v.primitive&&(g._primitive=v.primitive),void 0!==v.stage&&(g._stage=v.stage),void 0!==v.dynamicStates&&(g._dynamicStates=v.dynamicStates),void 0!==v.phase&&(g._phase=dH(v.phase));var S=g._bs;if(v.blendState){var O=v.blendState,X=O.targets;X&&X.forEach(function(g,v){S.setTarget(v,g)}),void 0!==O.isA2C&&(S.isA2C=O.isA2C),void 0!==O.isIndepend&&(S.isIndepend=O.isIndepend),void 0!==O.blendColor&&(S.blendColor=O.blendColor)}g._rs.assign(v.rasterizerState),g._dss.assign(v.depthStencilState)},t1.getPassHash=function(g){var v="";if(X.rendering&&X.rendering.enableEffectImport){var S=X.rendering.programLib.getKey(g._phaseID,g.program,g.defines);v=g._phaseID.toString()+","+S}else v=fX.getKey(g.program,g.defines);var O,Y=v+","+g._primitive+","+g._dynamicStates;return Y+=function(g){for(var v,S=",bs,"+g.isA2C,O=f(g.targets);!(v=O()).done;){var X=v.value;S+=",bt,"+X.blend+","+X.blendEq+","+X.blendAlphaEq+","+X.blendColorMask,S+=","+X.blendSrc+","+X.blendDst+","+X.blendSrcAlpha+","+X.blendDstAlpha}return S}(g._bs),Y+=function(g){var v=",dss,"+g.depthTest+","+g.depthWrite+","+g.depthFunc;return v+=","+g.stencilTestFront+","+g.stencilFuncFront+","+g.stencilRefFront+","+g.stencilReadMaskFront,v+=","+g.stencilFailOpFront+","+g.stencilZFailOpFront+","+g.stencilPassOpFront+","+g.stencilWriteMaskFront,(v+=","+g.stencilTestBack+","+g.stencilFuncBack+","+g.stencilRefBack+","+g.stencilReadMaskBack)+","+g.stencilFailOpBack+","+g.stencilZFailOpBack+","+g.stencilPassOpBack+","+g.stencilWriteMaskBack}(g._dss),Sl(Y+=",rs,"+(O=g._rs).cullMode+","+O.depthBias+","+O.isFrontFaceCCW,666)};var g=t1.prototype;return g.initialize=function(g){this._doInit(g),this.resetUBOs(),this.resetTextures(),this.tryCompile()},g.getHandle=function(g,v,S){void 0===v&&(v=0),void 0===S&&(S=oE.UNKNOWN);var O=this._propertyHandleMap[g];return O?(S?O=Jg(O,S):v&&(O=Jg(O,jg(O)-v)),O+v):0},g.getBinding=function(g){var v=this.getHandle(g);return v?t1.getBindingFromHandle(v):-1},g.setUniform=function(g,v){var S=t1.getBindingFromHandle(g),O=t1.getTypeFromHandle(g),X=t1.getOffsetFromHandle(g),Y=this._getBlockView(O,S);fD[O](Y,v,X),this._rootBufferDirty=!0},g.getUniform=function(g,v){var S=t1.getBindingFromHandle(g),O=t1.getTypeFromHandle(g),X=t1.getOffsetFromHandle(g),Y=this._getBlockView(O,S);return fP[O](Y,v,X)},g.setUniformArray=function(g,v){for(var S=t1.getBindingFromHandle(g),O=t1.getTypeFromHandle(g),X=P_(O)>>2,Y=this._getBlockView(O,S),te=t1.getOffsetFromHandle(g),ti=0;ti<v.length;ti++,te+=X)null!==v[ti]&&fD[O](Y,v[ti],te);this._rootBufferDirty=!0},g.bindTexture=function(g,v,S){this._descriptorSet.bindTexture(g,v,S||0)},g.bindSampler=function(g,v,S){this._descriptorSet.bindSampler(g,v,S||0)},g.setDynamicState=function(g,v){var S=this._dynamics[g];S&&S.value===v||(S.value=v,S.dirty=!0)},g.overridePipelineStates=function(){q(12102)},g.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._rootBufferDirty=!1),this._descriptorSet.update()):J(12006)},g.getInstancedBuffer=function(g){return void 0===g&&(g=0),this._instancedBuffers[g]||(this._instancedBuffers[g]=new dW(this))},g.destroy=function(){for(var g=0;g<this._shaderInfo.blocks.length;g++){var v=this._shaderInfo.blocks[g];this._buffers[v.binding].destroy()}for(var S in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[S].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy()},g.resetUniform=function(g){var v=this.getHandle(g);if(v){for(var S=t1.getTypeFromHandle(v),O=t1.getBindingFromHandle(v),X=t1.getOffsetFromHandle(v),Y=t1.getCountFromHandle(v),te=this._getBlockView(S,O),ti=this._properties[g],tr=ti&&ti.value||ev(S),ta=(P_(S)>>2)*Y,th=0;th+tr.length<=ta;th+=tr.length)te.set(tr,X+th);this._rootBufferDirty=!0}},g.resetTexture=function(g,v){var S=this.getHandle(g);if(S){var O,X=t1.getTypeFromHandle(S),Y=t1.getBindingFromHandle(S),te=this._properties[g],ti=te&&te.value,tr=(O="string"==typeof ti?dU.get(""+ti+iv(X)):ti||dU.get(ev(X)))&&O.getGFXTexture(),ta=te&&void 0!==te.samplerHash?uH.unpackFromHash(te.samplerHash):O&&O.getSamplerInfo(),th=this._device.getSampler(ta);this._descriptorSet.bindSampler(Y,th,v||0),this._descriptorSet.bindTexture(Y,tr,v||0)}},g.resetUBOs=function(){for(var g=0;g<this._shaderInfo.blocks.length;g++)for(var v=this._shaderInfo.blocks[g],S=0,O=0;O<v.members.length;O++){for(var X=v.members[O],Y=this._getBlockView(X.type,v.binding),te=this._properties[X.name],ti=te&&te.value||ev(X.type),tr=(P_(X.type)>>2)*X.count,ta=0;ta+ti.length<=tr;ta+=ti.length)Y.set(ti,S+ta);S+=tr}this._rootBufferDirty=!0},g.resetTextures=function(){if(X.rendering)for(var g,v=f(this._shaderInfo.descriptors[_S.MATERIAL].samplerTextures);!(g=v()).done;)for(var S=g.value,O=0;O<S.count;++O)this.resetTexture(S.name,O);else for(var Y=0;Y<this._shaderInfo.samplerTextures.length;Y++)for(var te=this._shaderInfo.samplerTextures[Y],ti=0;ti<te.count;ti++)this.resetTexture(te.name,ti)},g.tryCompile=function(){var g=this._root.pipeline;if(!g)return!1;if(this._syncBatchingScheme(),X.rendering&&X.rendering.enableEffectImport){var v=X.rendering.programLib,S=v.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);if(!S)return q(12103,this._programName),!1;this._shader=S.shader,this._pipelineLayout=v.getPipelineLayout(this.device,this._phaseID,this._programName)}else{var O=fX.getGFXShader(this._device,this._programName,this._defines,g);if(!O)return q(12104,this._programName),!1;this._shader=O,this._pipelineLayout=fX.getTemplateInfo(this._programName).pipelineLayout}return this._hash=t1.getPassHash(this),!0},g.getShaderVariant=function(g){if(void 0===g&&(g=null),!this._shader&&!this.tryCompile())return q(12105),null;if(!g)return this._shader;for(var v=this._root.pipeline,S=0;S<g.length;S++){var O=g[S];this._defines[O.name]=O.value}this._isBlend&&(this._defines.CC_IS_TRANSPARENCY_PASS=1);var Y=null;if(X.rendering&&X.rendering.enableEffectImport){var te=X.rendering.programLib.getProgramVariant(this._device,this._phaseID,this._programName,this._defines);te&&(Y=te.shader)}else Y=fX.getGFXShader(this._device,this._programName,this._defines,v);for(var ti=0;ti<g.length;ti++){var tr=g[ti];delete this._defines[tr.name]}return Y},g.beginChangeStatesSilently=function(){},g.endChangeStatesSilently=function(){},g._doInit=function(g,v){if(void 0===v&&(v=!1),this._priority=_u.DEFAULT,this._stage=_h.DEFAULT,X.rendering&&X.rendering.enableEffectImport){var S=X.rendering;if("number"==typeof g.phase?(this._passID=g._passID,this._subpassID=g._subpassID,this._phaseID=g._phaseID):(this._passID=S.getPassID(g.pass),this._passID!==S.INVALID_ID&&(g.subpass?(this._subpassID=S.getSubpassID(this._passID,g.subpass),this._phaseID=S.getPhaseID(this._subpassID,g.phase)):this._phaseID=S.getPhaseID(this._passID,g.phase))),this._passID===S.INVALID_ID)return void J(12107,g.program);if(this._phaseID===S.INVALID_ID)return void J(12108,g.program)}this._phase=dH("default"),this._primitive=oY.TRIANGLE_LIST,this._passIndex=g.passIndex,this._propertyIndex=void 0!==g.propertyIndex?g.propertyIndex:g.passIndex,this._programName=g.program,this._defines=v?r({},g.defines):g.defines,X.rendering&&X.rendering.enableEffectImport?this._shaderInfo=X.rendering.programLib.getProgramInfo(this._phaseID,this._programName):this._shaderInfo=fX.getTemplate(g.program),this._properties=g.properties||this._properties;var O=this._device;t1.fillPipelineInfo(this,g),g.stateOverrides&&t1.fillPipelineInfo(this,g.stateOverrides),X.rendering&&X.rendering.enableEffectImport?dq.layout=X.rendering.programLib.getMaterialDescriptorSetLayout(this._device,this._phaseID,g.program):dq.layout=fX.getDescriptorSetLayout(this._device,g.program),this._descriptorSet=this._device.createDescriptorSet(dq);var Y,te,ti=this._shaderInfo.blocks;if(X.rendering&&X.rendering.enableEffectImport){var tr=X.rendering.programLib;Y=tr.getBlockSizes(this._phaseID,this._programName),te=tr.getHandleMap(this._phaseID,this._programName)}else{var ta=fX.getTemplateInfo(g.program);Y=ta.blockSizes,te=ta.handleMap}if(X.rendering&&X.rendering.enableEffectImport){var th=X.rendering.programLib.getShaderInfo(this._phaseID,this.program);this._buildMaterialUniformBlocks(O,th.blocks,Y)}else this._buildUniformBlocks(O,ti,Y);var tu=this._propertyHandleMap=te,tl={};for(var tc in this._properties){var t_=this._properties[tc];t_.handleInfo&&(tl[tc]=this.getHandle.apply(this,t_.handleInfo))}Object.assign(tu,tl)},g._buildUniformBlocks=function(g,v,S){for(var O=g.capabilities.uboOffsetAlignment,X=[],Y=0,te=0,ti=0;ti<v.length;ti++){var tr=S[ti];X.push(te),te+=Math.ceil(tr/O)*O,Y=tr}var ta=X[X.length-1]+Y;ta&&(dX.size=16*Math.ceil(ta/16),this._rootBuffer=g.createBuffer(dX),this._rootBlock=new ArrayBuffer(ta));for(var th=0,tu=0;th<v.length;th++){var tl=v[th].binding,tc=S[th];dj.buffer=this._rootBuffer,dj.offset=X[tu++],dj.range=16*Math.ceil(tc/16);var t_=this._buffers[tl]=g.createBuffer(dj);this._blocks[tl]=new Float32Array(this._rootBlock,dj.offset,tc/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[tl]=new Int32Array(this._blocks[tl].buffer,this._blocks[tl].byteOffset,this._blocks[tl].length),this._descriptorSet.bindBuffer(tl,t_)}},g._buildMaterialUniformBlocks=function(g,v,S){for(var O=g.capabilities.uboOffsetAlignment,X=[],Y=0,te=0,ti=0;ti<v.length;ti++)if(1===v[ti].set){var tr=S[ti];X.push(te),te+=Math.ceil(tr/O)*O,Y=tr}if(0!==Y){var ta=X[X.length-1]+Y;ta&&(dX.size=16*Math.ceil(ta/16),this._rootBuffer=g.createBuffer(dX),this._rootBlock=new ArrayBuffer(ta))}for(var th=0,tu=0;th<v.length;th++)if(1===v[th].set){var tl=v[th].binding,tc=S[th];dj.buffer=this._rootBuffer,dj.offset=X[tu++],dj.range=16*Math.ceil(tc/16);var t_=this._buffers[tl]=g.createBuffer(dj);this._blocks[tl]=new Float32Array(this._rootBlock,dj.offset,tc/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[tl]=new Int32Array(this._blocks[tl].buffer,this._blocks[tl].byteOffset,this._blocks[tl].length),this._descriptorSet.bindBuffer(tl,t_)}},g._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(oS.INSTANCED_ARRAYS)?this._batchingScheme=dG.INSTANCING:(this._defines.USE_INSTANCING=!1,this._batchingScheme=dG.NONE):this._batchingScheme=dG.NONE},g._getBlockView=function(g,v){return g<oE.FLOAT?this._blocksInt[v]:this._blocks[v]},g._initPassFromTarget=function(g,v,S){this._priority=g.priority,this._stage=g.stage,this._phase=g.phase,this._phaseID=g._phaseID,this._passID=g._passID,this._batchingScheme=g.batchingScheme,this._primitive=g.primitive,this._dynamicStates=g.dynamicStates,this._bs=g.blendState,this._dss=v,this._descriptorSet=g.descriptorSet,this._rs=g.rasterizerState,this._passIndex=g.passIndex,this._propertyIndex=g.propertyIndex,this._programName=g.program,this._defines=g.defines,this._shaderInfo=g._shaderInfo,this._properties=g._properties,this._blocks=g._blocks,this._blocksInt=g._blocksInt,this._dynamics=g._dynamics,this._shader=g._shader,X.rendering&&X.rendering.enableEffectImport?this._pipelineLayout=X.rendering.programLib.getPipelineLayout(this.device,this._phaseID,this._programName):this._pipelineLayout=fX.getTemplateInfo(this._programName).pipelineLayout,this._hash=g._hash^S},g._updatePassHash=function(){this._hash=t1.getPassHash(this)},g.setRootBufferDirty=function(g){this._rootBufferDirty=g},g.setPriority=function(g){this._priority=g},n(t1,[{key:"_isBlend",get:function(){for(var g,v=!1,S=f(this.blendState.targets);!(g=S()).done;)g.value.blend&&(v=!0);return v}},{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return X.rendering&&X.rendering.enableEffectImport?X.rendering.programLib.getLocalDescriptorSetLayout(this._device,this._phaseID,this._programName):fX.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"passID",get:function(){return this._passID}},{key:"phaseID",get:function(){return this._phaseID}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),t1}();dY.getTypeFromHandle=jg,dY.getBindingFromHandle=Yg,dY.getCountFromHandle=qg,dY.getOffsetFromHandle=Kg;var dK=g("d4",function(){function t1(){}return t1.getOrCreatePipelineState=function(g,v,S,O,X){var Y=v.hash^O.hash^X.attributesHash^S.typedID,te=this._PSOHashMap.get(Y);if(!te){var ti=v.pipelineLayout,tr=new h7(X.attributes),ta=new Z_(S,ti,O,tr,v.rasterizerState,v.depthStencilState,v.blendState,v.primitive,v.dynamicStates);te=g.createPipelineState(ta),this._PSOHashMap.set(Y,te)}return te},t1}());dK._PSOHashMap=new Map;var dJ=new hS,dQ=new hl;function lS(g,v){g.x=v.x*v.x,g.y=v.y*v.y,g.z=v.z*v.z}var d0,d1,d2,d3,d4,d8,d6,d7,d9,pt=null;function AS(){return pt}function TS(g,v,S,O,X){if(!Ug()&&O&&O.enabled&&X===pt){var Y=O.subModels[0],te=Y.inputAssembler,ti=Y.passes,tr=Y.shaders,ta=Y.descriptorSet;dJ.width=dQ.width=X.window.width,dJ.height=dQ.height=X.window.height;var th=dK.getOrCreatePipelineState(g,ti[0],tr[0],v,te);S.setViewport(dJ),S.setScissor(dQ),S.bindPipelineState(th),S.bindDescriptorSet(_S.MATERIAL,ti[0].descriptorSet),S.bindDescriptorSet(_S.LOCAL,ta),S.bindInputAssembler(te),S.draw(te)}}var pe,pr,ps,pa,ph,pu,pl,pc,p_=new e7,pf=g("dY",(d0=nJ("cc.Material"),d1=ma(f4),d0((d3=function(g){function e(){var v;return(v=g.call(this)||this)._effectAsset=d4&&d4(),v._techIdx=d8&&d8(),v._defines=d6&&d6(),v._states=d7&&d7(),v._props=d9&&d9(),v._passes=[],v._hash=0,v}s(e,g),e.getHash=function(g){for(var v,S=0,O=f(g.passes);!(v=O()).done;)S^=v.value.hash;return S};var v=e.prototype;return v.initialize=function(g){this._passes.length?q(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this._fillInfo(g),this._update())},v.reset=function(g){this.initialize(g)},v.destroy=function(){return this._doDestroy(),g.prototype.destroy.call(this)},v.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},v.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},v.onLoaded=function(){this._update()},v.resetUniforms=function(g){void 0===g&&(g=!0),this._props.length=this._passes.length;for(var v=0;v<this._props.length;v++)this._props[v]={};if(g)for(var S,O=f(this._passes);!(S=O()).done;){var X=S.value;X.resetUBOs(),X.resetTextures()}},v.setProperty=function(g,v,S){var O=!1;if(void 0===S)for(var X=this._passes,Y=X.length,te=0;te<Y;te++){var ti=X[te];this._uploadProperty(ti,g,v)&&(this._props[ti.propertyIndex][g]=v,O=!0)}else{if(S>=this._passes.length)return void console.warn("illegal pass index: "+S+".");var tr=this._passes[S];this._uploadProperty(tr,g,v)&&(this._props[tr.propertyIndex][g]=v,O=!0)}O||console.warn("illegal property name: "+g+".")},v.getProperty=function(g,v){if(void 0===v)for(var S=this._props,O=S.length,X=0;X<O;X++){var Y=S[X];if(g in Y)return Y[g]}else{if(v>=this._passes.length)return console.warn("illegal pass index: "+v+"."),null;var te=this._props[this._passes[v].propertyIndex];if(g in te)return te[g]}return null},v.copy=function(g,v){this._techIdx=g._techIdx,this._props.length=g._props.length;for(var S=0;S<g._props.length;S++)this._props[S]=r({},g._props[S]);this._defines.length=g._defines.length;for(var O=0;O<g._defines.length;O++)this._defines[O]=r({},g._defines[O]);this._states.length=g._states.length;for(var X=0;X<g._states.length;X++)this._states[X]=r({},g._states[X]);this._effectAsset=g._effectAsset,v&&this._fillInfo(v),this._update()},v._fillInfo=function(g){void 0!==g.technique&&(this._techIdx=g.technique),g.effectAsset?this._effectAsset=g.effectAsset:g.effectName&&(this._effectAsset=f4.get(g.effectName)),g.defines&&this._prepareInfo(g.defines,this._defines),g.states&&this._prepareInfo(g.states,this._states)},v._prepareInfo=function(g,v){var S=g;if(!Array.isArray(S)){var O=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;S=Array(O).fill(S)}for(var X=0;X<S.length;++X)Object.assign(v[X]||(v[X]={}),S[X])},v._createPasses=function(){var g=this._effectAsset.techniques[this._techIdx||0];if(!g)return[];for(var v=g.passes.length,S=[],O=0;O<v;++O){var Y=g.passes[O],te=Y.passIndex=O,ti=Y.defines=this._defines[te]||(this._defines[te]={});if(Y.stateOverrides=this._states[te]||(this._states[te]={}),void 0!==Y.propertyIndex&&Object.assign(ti,this._defines[Y.propertyIndex]),void 0!==Y.embeddedMacros&&Object.assign(ti,Y.embeddedMacros),!Y.switch||ti[Y.switch]){var tr=new dY(X.director.root);tr.initialize(Y),S.push(tr)}}return S},v._update=function(g){var v=this;if(void 0===g&&(g=!0),this._effectAsset){this._passes=this._createPasses();var S=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=S,g)this._passes.forEach(function(g,S){var O=v._props[S];for(var X in O||(O=v._props[S]={}),void 0!==g.propertyIndex&&Object.assign(O,v._props[g.propertyIndex]),O)v._uploadProperty(g,X,O[X])});else for(var O=0;O<this._props.length;O++)this._props[O]={}}this._hash=e.getHash(this)},v._uploadProperty=function(g,v,S){var O=g.getHandle(v);if(!O)return!1;if(dY.getTypeFromHandle(O)<oE.SAMPLER1D){if(Array.isArray(S))g.setUniformArray(O,S);else if(null!==S){var X;if(null!==(X=g.properties[v])&&void 0!==X&&X.linear){var Y=S;lS(p_,Y),p_.w=Y.w,S=p_}g.setUniform(O,S)}else g.resetUniform(v)}else if(Array.isArray(S))for(var te=0;te<S.length;te++)this._bindTexture(g,O,S[te],te);else S?this._bindTexture(g,O,S):g.resetTexture(v);return!0},v._bindTexture=function(g,v,S,O){var X=dY.getBindingFromHandle(v);if(_instanceof(S,uW))g.bindTexture(X,S,O);else if(_instanceof(S,lJ)){var Y=S.getGFXTexture();if(!Y||!Y.width||!Y.height)return;g.bindTexture(X,Y,O),g.bindSampler(X,S.getGFXSampler(),O)}},v._doDestroy=function(){if(this._passes&&this._passes.length)for(var g,v=f(this._passes);!(g=v()).done;)g.value.destroy();this._passes.length=0},v.initDefault=function(v){g.prototype.initDefault.call(this,v),this.initialize({effectName:"builtin-unlit",defines:{USE_COLOR:!0},technique:0}),this.setProperty("mainColor",new is("#ff00ff"))},v.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},n(e,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),e}(lx),d4=ws(d3.prototype,"_effectAsset",[d1],function(){return null}),d8=ws(d3.prototype,"_techIdx",[n2],function(){return 0}),d6=ws(d3.prototype,"_defines",[n2],function(){return[]}),d7=ws(d3.prototype,"_states",[n2],function(){return[]}),d9=ws(d3.prototype,"_props",[n2],function(){return[]}),d2=d3))||d2));X.Material=pf,function(g){g[g.VERTICAL=0]="VERTICAL",g[g.HORIZONTAL=1]="HORIZONTAL"}(pe||(pe={})),function(g){g[g.ORTHO=0]="ORTHO",g[g.PERSPECTIVE=1]="PERSPECTIVE"}(pr||(pr={})),function(g){g[g.F1_8=0]="F1_8",g[g.F2_0=1]="F2_0",g[g.F2_2=2]="F2_2",g[g.F2_5=3]="F2_5",g[g.F2_8=4]="F2_8",g[g.F3_2=5]="F3_2",g[g.F3_5=6]="F3_5",g[g.F4_0=7]="F4_0",g[g.F4_5=8]="F4_5",g[g.F5_0=9]="F5_0",g[g.F5_6=10]="F5_6",g[g.F6_3=11]="F6_3",g[g.F7_1=12]="F7_1",g[g.F8_0=13]="F8_0",g[g.F9_0=14]="F9_0",g[g.F10_0=15]="F10_0",g[g.F11_0=16]="F11_0",g[g.F13_0=17]="F13_0",g[g.F14_0=18]="F14_0",g[g.F16_0=19]="F16_0",g[g.F18_0=20]="F18_0",g[g.F20_0=21]="F20_0",g[g.F22_0=22]="F22_0"}(ps||(ps={})),function(g){g[g.ISO100=0]="ISO100",g[g.ISO200=1]="ISO200",g[g.ISO400=2]="ISO400",g[g.ISO800=3]="ISO800"}(pa||(pa={})),function(g){g[g.D1=0]="D1",g[g.D2=1]="D2",g[g.D4=2]="D4",g[g.D8=3]="D8",g[g.D15=4]="D15",g[g.D30=5]="D30",g[g.D60=6]="D60",g[g.D125=7]="D125",g[g.D250=8]="D250",g[g.D500=9]="D500",g[g.D1000=10]="D1000",g[g.D2000=11]="D2000",g[g.D4000=12]="D4000"}(ph||(ph={})),function(g){g[g.DEFAULT=-1]="DEFAULT",g[g.LEFT_EYE=0]="LEFT_EYE",g[g.RIGHT_EYE=1]="RIGHT_EYE",g[g.MAIN=2]="MAIN"}(pu||(pu={})),function(g){g[g.NO_TRACKING=0]="NO_TRACKING",g[g.POSITION_AND_ROTATION=1]="POSITION_AND_ROTATION",g[g.POSITION=2]="POSITION",g[g.ROTATION=3]="ROTATION"}(pl||(pl={})),function(g){g[g.EDITOR=0]="EDITOR",g[g.GAME_VIEW=1]="GAME_VIEW",g[g.SCENE_VIEW=2]="SCENE_VIEW",g[g.PREVIEW=3]="PREVIEW",g[g.GAME=100]="GAME"}(pc||(pc={}));var pd=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],pm=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],pg=[100,200,400,800],pv=new eL,py=new eL,pS=new e$,pA=o7.STENCIL<<1,pT=[],pE=function(){function t1(g){if(this.isWindowSize=!0,this.screenScale=void 0,this.postProcess=null,this.usePostProcess=!1,this.pipeline="",this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=pe.VERTICAL,this._fov=yi(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new hA(.2,.2,.2,1),this._viewport=new ic(0,0,1,1),this._orientedViewport=new ic(0,0,1,1),this._curTransform=og.IDENTITY,this._isProjDirty=!0,this._matView=new e$,this._matProj=new e$,this._matProjInv=new e$,this._matViewProj=new e$,this._matViewProjInv=new e$,this._frustum=new i9,this._forward=new eL,this._position=new eL,this._priority=0,this._aperture=ps.F16_0,this._apertureValue=void 0,this._shutter=ph.D125,this._shutterValue=0,this._iso=pa.ISO100,this._isoValue=0,this._window=null,this._width=1,this._height=1,this._clearFlag=o7.NONE,this._clearDepth=1,this._visibility=fx,this._exposure=0,this._clearStencil=0,this._geometryRenderer=null,this._windowId=0,this._cameraType=pu.DEFAULT,this._trackingType=pl.NO_TRACKING,this._usage=pc.GAME,this._device=g,this._apertureValue=pd[this._aperture],this._shutterValue=pm[this._shutter],this._isoValue=pg[this._iso],this._aspect=this.screenScale=1,this._frustum.accurate=!0,!pT.length){var v=g.capabilities.clipSpaceSignY;pT[og.IDENTITY]=new e$(1,0,0,0,0,v),pT[og.ROTATE_90]=new e$(0,1,0,0,-v,0),pT[og.ROTATE_180]=new e$(-1,0,0,0,0,-v),pT[og.ROTATE_270]=new e$(0,-1,0,0,v,0)}}var g=t1.prototype;return g._updateAspect=function(g){if(void 0===g&&(g=!0),this._aspect=this.window.width*this._viewport.width/(this.window.height*this._viewport.height),g){var v=this.window.swapchain;(v&&v.surfaceTransform||og.IDENTITY)%2&&(this._aspect=1/this._aspect)}this._isProjDirty=!0},g.initialize=function(g){void 0!==g.usage?this._usage=g.usage:this.setDefaultUsage(),void 0!==g.trackingType&&(this._trackingType=g.trackingType),void 0!==g.cameraType&&(this._cameraType=g.cameraType),this.node=g.node,this._width=1,this._height=1,this.clearFlag=o7.NONE,this.clearDepth=1,this.visibility=fx,this._name=g.name,this._proj=g.projection,this._priority=g.priority||0,this._aspect=this.screenScale=1,this.updateExposure(),this.changeTargetWindow(g.window)},g.destroy=function(){var g;this._node=null,this.detachFromScene(),this._window&&(this._window.detachCamera(this),this.window=null),this._name=null,null===(g=this._geometryRenderer)||void 0===g||g.destroy()},g.attachToScene=function(g){this._enabled=!0,this._scene=g},g.detachFromScene=function(){this._enabled=!1,this._scene=null},g.resize=function(g,v){this._window&&(this._width=g,this._height=v,this._aspect=g*this._viewport.width/(v*this._viewport.height),this._isProjDirty=!0)},g.setFixedSize=function(g,v){this._width=g,this._height=v,this._updateAspect(),this.isWindowSize=!1},g.syncCameraEditor=function(){},g.update=function(g){var v;if(void 0===g&&(g=!1),this._node){var S=!1,O=globalThis.__globalXR;if(O&&O.isWebXR&&O.webXRWindowMap&&O.updateViewport){var X=O.webXRMatProjs?1/O.webXRMatProjs.length:1,Y=O.webXRWindowMap.get(this._window);this.setViewportInOrientedSpace(new ic(X*Y,0,X,1))}(this._node.hasChangedFlags||g)&&(e$.invert(this._matView,this._node.worldMatrix),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,e$.multiply(this._matView,(new e$).scale(this._node.worldScale),this._matView),this._node.getWorldPosition(this._position),S=!0);var te=null===(v=this.window)||void 0===v?void 0:v.swapchain,ti=te&&te.surfaceTransform||og.IDENTITY;if(this._isProjDirty||this._curTransform!==ti){this._curTransform=ti;var tr=this._device.capabilities.clipSpaceSignY;if(this._proj===pr.PERSPECTIVE){if(O&&O.isWebXR&&O.webXRWindowMap&&O.webXRMatProjs){var ta=O.webXRWindowMap.get(this._window);this._matProj.set(O.webXRMatProjs[ta])}else e$.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===pe.VERTICAL,this._device.capabilities.clipSpaceMinZ,tr,ti)}else{var th=this._orthoHeight*this._aspect,tu=this._orthoHeight;e$.ortho(this._matProj,-th,th,-tu,tu,this._nearClip,this._farClip,this._device.capabilities.clipSpaceMinZ,tr,ti)}e$.invert(this._matProjInv,this._matProj),S=!0,this._isProjDirty=!1}S&&(e$.multiply(this._matViewProj,this._matProj,this._matView),e$.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv))}},g.setViewportInOrientedSpace=function(g){var v,S=g.x,O=g.width,X=g.height,Y=this._device.capabilities.screenSpaceSignY<0?1-g.y-X:g.y,te=null===(v=this.window)||void 0===v?void 0:v.swapchain;switch(te&&te.surfaceTransform||og.IDENTITY){case og.ROTATE_90:this._viewport.x=1-Y-X,this._viewport.y=S,this._viewport.width=X,this._viewport.height=O;break;case og.ROTATE_180:this._viewport.x=1-S-O,this._viewport.y=1-Y-X,this._viewport.width=O,this._viewport.height=X;break;case og.ROTATE_270:this._viewport.x=Y,this._viewport.y=1-S-O,this._viewport.width=X,this._viewport.height=O;break;case og.IDENTITY:this._viewport.x=S,this._viewport.y=Y,this._viewport.width=O,this._viewport.height=X}this._orientedViewport.x=S,this._orientedViewport.y=Y,this._orientedViewport.width=O,this._orientedViewport.height=X,this.resize(this.width,this.height)},g.initGeometryRenderer=function(){var g;this._geometryRenderer||(this._geometryRenderer=X.internal.GeometryRenderer?new X.internal.GeometryRenderer:null,null===(g=this._geometryRenderer)||void 0===g||g.activate(this._device))},g.changeTargetWindow=function(g){void 0===g&&(g=null),this._window&&this._window.detachCamera(this);var v=g||X.director.root.mainWindow;if(v){v.attachCamera(this),this.window=v;var S=v.swapchain;(S&&S.surfaceTransform||og.IDENTITY)%2?this.resize(v.height,v.width):this.resize(v.width,v.height)}},g.detachCamera=function(){this._window&&this._window.detachCamera(this)},g.screenPointToRay=function(g,v,S){if(!this._node)return null;var O=this.width,X=this.height,Y=this._orientedViewport.x*O,te=this._orientedViewport.y*X,ti=this._orientedViewport.width*O,tr=this._orientedViewport.height*X,ta=this._proj===pr.PERSPECTIVE,th=this._device.capabilities.clipSpaceSignY,tu=eQ[this._curTransform];eL.set(pv,(v-Y)/ti*2-1,(S-te)/tr*2-1,ta?1:-1);var tl=pv.x,tc=pv.y;return pv.x=tl*tu[0]+tc*tu[2]*th,pv.y=tl*tu[1]+tc*tu[3]*th,eL.transformMat4(ta?pv:g.o,pv,this._matViewProjInv),ta?(this._node.getWorldPosition(py),iL.fromPoints(g,py,pv)):eL.transformQuat(g.d,eL.FORWARD,this._node.worldRotation),g},g.screenToWorld=function(g,v){var S=this.width,O=this.height,X=this._orientedViewport.x*S,Y=this._orientedViewport.y*O,te=this._orientedViewport.width*S,ti=this._orientedViewport.height*O,tr=this._device.capabilities.clipSpaceSignY,ta=eQ[this._curTransform];if(this._proj===pr.PERSPECTIVE){eL.set(g,(v.x-X)/te*2-1,(v.y-Y)/ti*2-1,1);var th=g.x,tu=g.y;g.x=th*ta[0]+tu*ta[2]*tr,g.y=th*ta[1]+tu*ta[3]*tr,eL.transformMat4(g,g,this._matViewProjInv),this._node&&this._node.getWorldPosition(pv),eL.lerp(g,pv,g,vi(this._nearClip/this._farClip,1,v.z))}else{eL.set(g,(v.x-X)/te*2-1,(v.y-Y)/ti*2-1,2*v.z-1);var tl=g.x,tc=g.y;g.x=tl*ta[0]+tc*ta[2]*tr,g.y=tl*ta[1]+tc*ta[3]*tr,eL.transformMat4(g,g,this._matViewProjInv)}return g},g.worldToScreen=function(g,v){var S=this._device.capabilities.clipSpaceSignY,O=eQ[this._curTransform];eL.transformMat4(g,v,this._matViewProj);var X=g.x,Y=g.y;g.x=X*O[0]+Y*O[2]*S,g.y=X*O[1]+Y*O[3]*S;var te=this.width,ti=this.height,tr=this._orientedViewport.x*te,ta=this._orientedViewport.y*ti,th=this._orientedViewport.width*te,tu=this._orientedViewport.height*ti;return g.x=tr+.5*(g.x+1)*th,g.y=ta+.5*(g.y+1)*tu,g.z=.5*g.z+.5,g},g.worldMatrixToScreen=function(g,v,S,O){e$.multiply(g,this._matViewProj,v),e$.multiply(g,pT[this._curTransform],g);var X=S/2,Y=O/2;return e$.identity(pS),e$.transform(pS,pS,eL.set(pv,X,Y,0)),e$.scale(pS,pS,eL.set(pv,X,Y,1)),e$.multiply(g,pS,g),g},g.calculateObliqueMat=function(g){var v=new e7(Math.sign(g.x),Math.sign(g.y),1,1).transformMat4(this._matProjInv),S=new e7(this._matProj.m03,this._matProj.m07,this._matProj.m11,this._matProj.m15),O=2/e7.dot(g,v),X=g.multiplyScalar(O).subtract(S);this._matProj.m02=X.x,this._matProj.m06=X.y,this._matProj.m10=X.z,this._matProj.m14=X.w},g.getClipSpaceMinz=function(){return this._device.capabilities.clipSpaceMinZ},g.setExposure=function(g){this._exposure=.833333/Math.pow(2,g)},g.updateExposure=function(){var g=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);this.setExposure(g)},g.setDefaultUsage=function(){this._usage=pc.GAME},n(t1,[{key:"name",get:function(){return this._name}},{key:"scene",get:function(){return this._scene}},{key:"node",get:function(){return this._node},set:function(g){this._node=g}},{key:"systemWindowId",get:function(){return this._windowId}},{key:"window",get:function(){return this._window},set:function(g){this._window=g}},{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g}},{key:"visibility",get:function(){return this._visibility},set:function(g){this._visibility=g}},{key:"priority",get:function(){return this._priority},set:function(g){this._priority=g}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"position",get:function(){return this._position},set:function(g){this._position=g}},{key:"forward",get:function(){return this._forward},set:function(g){this._forward=g}},{key:"aperture",get:function(){return this._aperture},set:function(g){this._aperture=g,this._apertureValue=pd[this._aperture],this.updateExposure()}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",get:function(){return this._shutter},set:function(g){this._shutter=g,this._shutterValue=pm[this._shutter],this.updateExposure()}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",get:function(){return this._iso},set:function(g){this._iso=g,this._isoValue=pg[this._iso],this.updateExposure()}},{key:"isoValue",get:function(){return this._isoValue}},{key:"exposure",get:function(){return this._exposure}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(g){this._clearFlag=g}},{key:"clearColor",get:function(){return this._clearColor},set:function(g){this._clearColor.x=g.x,this._clearColor.y=g.y,this._clearColor.z=g.z,this._clearColor.w=g.w}},{key:"clearDepth",get:function(){return this._clearDepth},set:function(g){this._clearDepth=g}},{key:"clearStencil",get:function(){return this._clearStencil},set:function(g){this._clearStencil=g}},{key:"projectionType",get:function(){return this._proj},set:function(g){this._proj=g,this._isProjDirty=!0}},{key:"aspect",get:function(){return this._aspect}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(g){this._orthoHeight=g,this._isProjDirty=!0}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(g){this._fovAxis=g,this._isProjDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(g){this._fov=g,this._isProjDirty=!0}},{key:"nearClip",get:function(){return this._nearClip},set:function(g){this._nearClip=g,this._isProjDirty=!0}},{key:"farClip",get:function(){return this._farClip},set:function(g){this._farClip=g,this._isProjDirty=!0}},{key:"viewport",get:function(){return this._viewport},set:function(g){q(8302),this.setViewportInOrientedSpace(g)}},{key:"frustum",get:function(){return this._frustum},set:function(g){this._frustum=g}},{key:"matView",get:function(){return this._matView}},{key:"matProj",get:function(){return this._matProj}},{key:"matProjInv",get:function(){return this._matProjInv}},{key:"matViewProj",get:function(){return this._matViewProj}},{key:"matViewProjInv",get:function(){return this._matViewProjInv}},{key:"surfaceTransform",get:function(){return this._curTransform}},{key:"geometryRenderer",get:function(){return this._geometryRenderer}},{key:"cameraType",get:function(){return this._cameraType},set:function(g){this._cameraType=g}},{key:"trackingType",get:function(){return this._trackingType},set:function(g){this._trackingType=g}},{key:"cameraUsage",get:function(){return this._usage},set:function(g){this._usage=g}}],[{key:"standardExposureValue",get:function(){return 1/38400}},{key:"standardLightMeterScale",get:function(){return 1e4}}]),t1}(),pC=re({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048}),px=re({Planar:0,ShadowMap:1}),pb=re({HARD:0,SOFT:1,SOFT_2X:2,SOFT_4X:3}),pw=re({LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4}),pI=re({NONE:1,RemoveDuplicates:2,DisableRotationFix:3}),pB=px.ShadowMap+1,pP=function(){function t1(){this.fixedSphere=new iH(0,0,0,.01),this.maxReceived=4,this._matLight=new e$,this._material=null,this._instancingMaterial=null,this._enabled=!1,this._type=pB,this._distance=0,this._planeBias=1,this._normal=new eL(0,1,0),this._shadowColor=new is(0,0,0,76),this._size=new e8(1024,1024),this._shadowMapDirty=!1}var g=t1.prototype;return g.getPlanarShader=function(g){this._material||(this._material=new pf,this._material.initialize({effectName:"pipeline/planar-shadow"}));var v=this._material.passes;return v.length>0?v[0].getShaderVariant(g):null},g.initialize=function(g){this._enabled=g.enabled,this._type=this.enabled?g.type:pB,this.normal=g.planeDirection,this.distance=g.planeHeight,this.planeBias=g.planeBias,this.shadowColor=g.shadowColor,this.maxReceived=g.maxReceived,g.shadowMapSize!==this._size.x&&(this.size.set(g.shadowMapSize,g.shadowMapSize),this._shadowMapDirty=!0)},g.activate=function(){if(this._enabled){if(this.type===px.Planar)this._updatePlanarInfo();else{var g=X.director.root;g.pipeline.macros.CC_SHADOW_TYPE=2,g.onGlobalPipelineStateChanged()}}else{var v=X.director.root;v.pipeline.macros.CC_SHADOW_TYPE=0,v.onGlobalPipelineStateChanged()}},g._updatePlanarInfo=function(){this._material||(this._material=new pf,this._material.initialize({effectName:"pipeline/planar-shadow"}));var g=X.director.root;g.pipeline.macros.CC_SHADOW_TYPE=1,g.onGlobalPipelineStateChanged()},g.destroy=function(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g,this.activate()}},{key:"type",get:function(){return this._type},set:function(g){this._type=this.enabled?g:pB,this.activate()}},{key:"normal",get:function(){return this._normal},set:function(g){eL.copy(this._normal,g)}},{key:"distance",get:function(){return this._distance},set:function(g){this._distance=g}},{key:"planeBias",get:function(){return this._planeBias},set:function(g){this._planeBias=g}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(g){this._shadowColor=g}},{key:"size",get:function(){return this._size},set:function(g){this._size.set(g)}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(g){this._shadowMapDirty=g}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}}]),t1}();pP.MAX_FAR=2e3,pP.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),X.Shadows=pP;var pD,pM=new eL,pO=iH.create(0,0,0,1),pL=new iK(0,0,0,.5,.5,.5),pF=new iK,pk=new ad(function(){return{model:null,depth:0}},128);function eA(g,v){var S=0;g.node&&(eL.subtract(pM,g.worldBounds?g.worldBounds.center:g.node.worldPosition,v.position),S=eL.dot(pM,v.forward));var O=pk.alloc();return O.model=g,O.depth=S,O}function iA(g,v){var S=g.pipelineSceneData,O=S.validPunctualLights;O.length=0;for(var X=v.scene.spotLights,Y=0;Y<X.length;Y++){var te=X[Y];te.baked&&!v.node.scene.globals.disableLightmap||(iH.set(pO,te.position.x,te.position.y,te.position.z,te.range),nF.sphereFrustum(pO,v.frustum)&&O.push(te))}for(var ti=v.scene.sphereLights,tr=0;tr<ti.length;tr++){var ta=ti[tr];ta.baked&&!v.node.scene.globals.disableLightmap||(iH.set(pO,ta.position.x,ta.position.y,ta.position.z,ta.range),nF.sphereFrustum(pO,v.frustum)&&O.push(ta))}for(var th=v.scene.pointLights,tu=0;tu<th.length;tu++){var tl=th[tu];tl.baked||(iH.set(pO,tl.position.x,tl.position.y,tl.position.z,tl.range),nF.sphereFrustum(pO,v.frustum)&&O.push(tl))}for(var tc=v.scene.rangedDirLights,t_=0;t_<tc.length;t_++){var tf=tc[t_];iK.transform(pF,pL,tf.node.getWorldMatrix()),nF.aabbFrustum(pF,v.frustum)&&O.push(tf)}S.validPunctualLights=O}function nA(g,v){var S=v.scene,O=S.mainLight,Y=g.pipelineSceneData,te=Y.shadows,ti=Y.skybox,tr=Y.csmLayers,ta=Y.renderObjects;pk.freeArray(ta),ta.length=0;var th=tr.castShadowObjects;th.length=0;var tu=tr.layerObjects;tu.clear(),te.enabled&&(g.pipelineUBO.updateShadowUBORange(Sm.SHADOW_COLOR_OFFSET,te.shadowColor),te.type===px.ShadowMap&&O&&O.node&&tr.update(Y,v)),v.clearFlag&pA&&(ti.enabled&&ti.model?ta.push(eA(ti.model,v)):v.cameraUsage!==pc.EDITOR&&v.cameraUsage!==pc.SCENE_VIEW&&X.warnID(15100,v.name));var tl=S.models,tc=v.visibility;function f(g){if(g.enabled){if(S.isCulledByLod(v,g))return;if(g.castShadow&&(th.push(eA(g,v)),tu.push(eA(g,v))),g.node&&(tc&g.node.layer)===g.node.layer||tc&g.visFlags){if(g.worldBounds&&!nF.aabbFrustum(g.worldBounds,v.frustum))return;ta.push(eA(g,v))}}}for(var t_=0;t_<tl.length;t_++)f(tl[t_])}var pG=new hq;pG.format=oA.RGBA8;var pV=new hY;pV.format=oA.DEPTH_STENCIL;var pU,pH,pz=new hZ([pG],pV),pW={width:1,height:1,renderPassInfo:pz},pX=g("dZ",nJ("cc.RenderTexture")(pD=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._window=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._name=g.name||"",this._width=g.width,this._height=g.height,this._initWindow(g)},v.reset=function(g){this.initialize(g)},v.destroy=function(){if(this._window){var v=X.director.root;null==v||v.destroyWindow(this._window),this._window=null}return g.prototype.destroy.call(this)},v.resize=function(g,v){this._width=Math.floor(mi(g,1,2048)),this._height=Math.floor(mi(v,1,2048)),this._window&&this._window.resize(this._width,this._height),this.emit("resize",this._window)},v._serialize=function(){return{}},v._deserialize=function(v,S){var O=v;this._width=O.w,this._height=O.h,this._name=O.n,g.prototype._deserialize.call(this,O.base,S)},v.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},v.onLoaded=function(){this._initWindow()},v._initWindow=function(g){var v=X.director.root;pW.title=this._name,pW.width=this._width,pW.height=this._height,pW.renderPassInfo=g&&g.passInfo?g.passInfo:pz,pW.externalResLow=g&&g.externalResLow?g.externalResLow:0,pW.externalResHigh=g&&g.externalResHigh?g.externalResHigh:0,pW.externalFlag=g&&g.externalFlag?g.externalFlag:oB.NONE,pG.barrier=uZ.gfxDevice.getGeneralBarrier(new h$(oW.FRAGMENT_SHADER_READ_TEXTURE,oW.FRAGMENT_SHADER_READ_TEXTURE)),this._window?(this._window.destroy(),this._window.initialize(uZ.gfxDevice,pW)):this._window=v.createWindow(pW)},v.initDefault=function(v){g.prototype.initDefault.call(this,v),this._width=this._height=1,this._initWindow()},v.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},v.readPixels=function(g,v,S,O,X){void 0===g&&(g=0),void 0===v&&(v=0),S=S||this.width,O=O||this.height;var Y=this.getGFXTexture();if(!Y)return J(7606),null;var te=4*S*O;if(void 0===X)X=new Uint8Array(te);else if(X.length<te)return J(7607,te),null;var ti=this._getGFXDevice(),tr=[],ta=[],th=new hg;return th.texOffset.x=g,th.texOffset.y=v,th.texExtent.width=S,th.texExtent.height=O,ta.push(th),tr.push(X),null==ti||ti.copyTextureToBuffers(Y,tr,ta),X},n(e,[{key:"window",get:function(){return this._window}}]),e}(lJ))||pD);X.RenderTexture=pX,function(g){g[g.SKYBOX=pA|o7.DEPTH_STENCIL]="SKYBOX",g[g.SOLID_COLOR=o7.ALL]="SOLID_COLOR"}(pU||(pU={})),function(g){g[g.CUBE=0]="CUBE",g[g.PLANAR=1]="PLANAR"}(pH||(pH={}));var pj,pq,pY=[new eL(0,-90,0),new eL(0,90,0),new eL(90,0,0),new eL(-90,0,0),new eL(0,0,0),new eL(0,180,0)],pK=function(){function t1(g){this.bakedCubeTextures=[],this.realtimePlanarTexture=null,this._resolution=256,this._clearFlag=pU.SKYBOX,this._backgroundColor=new is(0,0,0,255),this._visibility=fx,this._probeType=pH.CUBE,this._cubemap=null,this._size=new eL(1,1,1),this._camera=null,this._probeId=0,this._needRefresh=!1,this._needRender=!1,this._node=null,this._cameraNode=null,this._boundingBox=null,this._cameraWorldPos=new eL,this._cameraWorldRotation=new eW,this._forward=new eL,this._up=new eL,this._previewSphere=null,this._previewPlane=null,this._probeId=g}var g=t1.prototype;return g.initialize=function(g,v){this._node=g,this._cameraNode=v;var S=this.node.getWorldPosition();this._boundingBox=iK.create(S.x,S.y,S.z,this._size.x,this._size.y,this._size.z),this._createCamera(v)},g.initBakedTextures=function(){if(0===this.bakedCubeTextures.length)for(var g=0;g<6;g++){var v=this._createTargetTexture(this._resolution,this._resolution);this.bakedCubeTextures.push(v)}},g.captureCubemap=function(){this.initBakedTextures(),this._resetCameraParams(),this._needRender=!0},g.renderPlanarReflection=function(g){if(g){if(!this.realtimePlanarTexture){var v=X.view.getDesignResolutionSize();this.realtimePlanarTexture=this._createTargetTexture(v.width,v.height),X.internal.reflectionProbeManager.updatePlanarMap(this,this.realtimePlanarTexture.getGFXTexture())}this._syncCameraParams(g),this._transformReflectionCamera(g),this._needRender=!0}},g.switchProbeType=function(g,v){g===pH.CUBE?this._needRender=!1:null!==v&&this.renderPlanarReflection(v)},g.getProbeId=function(){return this._probeId},g.updateProbeId=function(g){this._probeId=g},g.renderArea=function(){return this._probeType===pH.PLANAR?new e8(this.realtimePlanarTexture.width,this.realtimePlanarTexture.height):new e8(this.resolution,this.resolution)},g.isFinishedRendering=function(){return!0},g.validate=function(){return null!==this.cubemap},g.destroy=function(){this._camera&&(this._camera.destroy(),this._camera=null);for(var g=0;g<this.bakedCubeTextures.length;g++)this.bakedCubeTextures[g].destroy();this.bakedCubeTextures=[],this.realtimePlanarTexture&&(this.realtimePlanarTexture.destroy(),this.realtimePlanarTexture=null)},g.enable=function(){},g.disable=function(){},g.updateCameraDir=function(g){this.cameraNode.setRotationFromEuler(pY[g]),this.camera.update(!0)},g.updateBoundingBox=function(){if(this.node){var g=this.node.getWorldPosition();iK.set(this._boundingBox,g.x,g.y,g.z,this._size.x,this._size.y,this._size.z)}},g.hasFrameBuffer=function(g){if(this.probeType===pH.PLANAR){var v;if(!this.realtimePlanarTexture)return!1;if((null===(v=this.realtimePlanarTexture.window)||void 0===v?void 0:v.framebuffer)===g)return!0}else{if(0===this.bakedCubeTextures.length)return!1;for(var S=0;S<this.bakedCubeTextures.length;S++){var O;if((null===(O=this.bakedCubeTextures[S].window)||void 0===O?void 0:O.framebuffer)===g)return!0}}return!1},g.isRGBE=function(){return!0},g._syncCameraParams=function(g){this.camera.projectionType=g.projectionType,this.camera.orthoHeight=g.orthoHeight,this.camera.nearClip=g.nearClip,this.camera.farClip=g.farClip,this.camera.fov=g.fov,this.camera.clearFlag=g.clearFlag,this.camera.clearColor=g.clearColor,this.camera.priority=g.priority-1,this.camera.resize(g.width,g.height)},g._createCamera=function(g){var v=X.director.root;if(!this._camera){if(this._camera=v.createCamera(),!this._camera)return null;this._camera.initialize({name:g.name,node:g,projection:pr.PERSPECTIVE,window:v&&v.tempWindow,priority:0,cameraType:pu.DEFAULT,trackingType:pl.NO_TRACKING})}return this._camera.setViewportInOrientedSpace(new ic(0,0,1,1)),this._camera.fovAxis=pe.VERTICAL,this._camera.fov=yi(90),this._camera.orthoHeight=10,this._camera.nearClip=1,this._camera.farClip=1e3,this._camera.clearColor=this._backgroundColor,this._camera.clearDepth=1,this._camera.clearStencil=0,this._camera.clearFlag=this._clearFlag,this._camera.visibility=this._visibility,this._camera.aperture=ps.F16_0,this._camera.shutter=ph.D125,this._camera.iso=pa.ISO100,this._camera},g._resetCameraParams=function(){this.camera.projectionType=pr.PERSPECTIVE,this.camera.orthoHeight=10,this.camera.nearClip=1,this.camera.farClip=1e3,this.camera.fov=yi(90),this.camera.priority=0,this.camera.resize(this.resolution,this.resolution),this.camera.visibility=this._visibility,this.camera.clearFlag=this._clearFlag,this.camera.clearColor=this._backgroundColor,this.cameraNode.worldPosition=this.node.worldPosition,this.cameraNode.worldRotation=this.node.worldRotation,this.camera.update(!0)},g._createTargetTexture=function(g,v){var S=new pX;return S.reset({width:g,height:v}),S},g._transformReflectionCamera=function(g){var v=eL.dot(this.node.worldPosition,this.node.up);this._reflect(this._cameraWorldPos,g.node.worldPosition,this.node.up,v),this.cameraNode.worldPosition=this._cameraWorldPos,eL.transformQuat(this._forward,eL.FORWARD,g.node.worldRotation),this._reflect(this._forward,this._forward,this.node.up,0),this._forward.normalize(),this._forward.negative(),eL.transformQuat(this._up,eL.UP,g.node.worldRotation),this._reflect(this._up,this._up,this.node.up,0),this._up.normalize(),eW.fromViewUp(this._cameraWorldRotation,this._forward,this._up),this.cameraNode.worldRotation=this._cameraWorldRotation,this.camera.update(!0);var S=new e7(this.node.up.x,this.node.up.y,this.node.up.z,-eL.dot(this.node.up,this.node.worldPosition));S.transformMat4(this.camera.matView.clone().invert().transpose()),this.camera.calculateObliqueMat(S)},g._reflect=function(g,v,S,O){var X=eL.clone(S);X.normalize();var Y=eL.dot(X,v)-O;return X.multiplyScalar(2*Y),eL.subtract(g,v,X),g},n(t1,[{key:"probeType",get:function(){return this._probeType},set:function(g){this._probeType=g}},{key:"resolution",get:function(){return this._resolution},set:function(g){g!==this._resolution&&this.bakedCubeTextures.forEach(function(v){v.resize(g,g)}),this._resolution=g}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(g){this._clearFlag=g,this.camera.clearFlag=this._clearFlag}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(g){this._backgroundColor=g,this.camera.clearColor=this._backgroundColor}},{key:"visibility",get:function(){return this._visibility},set:function(g){this._visibility=g,this._camera.visibility=this._visibility}},{key:"size",get:function(){return this._size},set:function(g){this._size.set(g);var v=this.node.getWorldPosition();iK.set(this._boundingBox,v.x,v.y,v.z,this._size.x,this._size.y,this._size.z)}},{key:"cubemap",get:function(){return this._cubemap},set:function(g){this._cubemap=g}},{key:"node",get:function(){return this._node}},{key:"camera",get:function(){return this._camera}},{key:"needRefresh",get:function(){return this._needRefresh},set:function(g){this._needRefresh=g}},{key:"needRender",get:function(){return this._needRender},set:function(g){this._needRender=g}},{key:"boundingBox",get:function(){return this._boundingBox}},{key:"cameraNode",get:function(){return this._cameraNode},set:function(g){this._cameraNode=g}},{key:"previewSphere",get:function(){return this._previewSphere},set:function(g){this._previewSphere=g}},{key:"previewPlane",get:function(){return this._previewPlane},set:function(g){this._previewPlane=g}}]),t1}();g("dl",pj),function(g){g[g.LOCAL=0]="LOCAL",g[g.WORLD=1]="WORLD"}(pj||g("dl",pj={})),g("dm",pq),function(g){g[g.NONE=0]="NONE",g[g.POSITION=1]="POSITION",g[g.ROTATION=2]="ROTATION",g[g.SCALE=4]="SCALE",g[g.RS=g.ROTATION|g.SCALE]="RS",g[g.TRS=g.POSITION|g.ROTATION|g.SCALE]="TRS",g[g.TRS_MASK=~g.TRS]="TRS_MASK"}(pq||g("dm",pq={})),X.internal.TransformBit=pq;var pJ,pQ=g("dn",re({Static:0,Stationary:1,Movable:2}));function gA(g,v){v<1e3?v=1e3:v>15e3&&(v=15e3);var S=v*v,O=(.860117757+154118254e-12*v+128641212e-15*S)/(1+842420235e-12*v+708145163e-15*S),X=(.317398726+422806245e-13*v+420481691e-16*S)/(1-289741816e-13*v+161456053e-15*S),Y=2*O-8*X+4,te=3*O/Y,ti=2*X/Y,tr=1/ti*te,ta=1/ti*(1-te-ti);g.x=3.2404542*tr-1.5371385+-.4985314*ta,g.y=-.969266*tr+1.8760108+.041556*ta,g.z=.0556434*tr-.2040259+1.0572252*ta}!function(g){g[g.DIRECTIONAL=0]="DIRECTIONAL",g[g.SPHERE=1]="SPHERE",g[g.SPOT=2]="SPOT",g[g.POINT=3]="POINT",g[g.RANGED_DIRECTIONAL=4]="RANGED_DIRECTIONAL",g[g.UNKNOWN=5]="UNKNOWN"}(pJ||(pJ={}));var p0,p1,p2,p3,p4,p8,p6,p7,p9,mt,me,mn,BA=function(g){return 4*Math.PI*Math.PI*g*g},mr=function(){function t1(){this._baked=!1,this._color=new eL(1,1,1),this._colorTemp=6550,this._colorTempRGB=new eL(1,1,1),this._finalColor=new eL(1,1,1),this._scene=null,this._node=null,this._name=null,this._useColorTemperature=!1,this._type=pJ.UNKNOWN,this._visibility=fx}var g=t1.prototype;return g.initialize=function(){this.color=new eL(1,1,1),this.colorTemperature=6550},g.attachToScene=function(g){this._scene=g},g.detachFromScene=function(){this._scene=null},g.destroy=function(){this._name=null,this._node=null},g.update=function(){},n(t1,[{key:"baked",get:function(){return this._baked},set:function(g){this._baked=g}},{key:"color",get:function(){return this._color},set:function(g){this._color.set(g),this._useColorTemperature&&eL.multiply(this._finalColor,this._color,this._colorTempRGB)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(g){this._useColorTemperature=g,g&&eL.multiply(this._finalColor,this._color,this._colorTempRGB)}},{key:"colorTemperature",get:function(){return this._colorTemp},set:function(g){this._colorTemp=g,gA(this._colorTempRGB,this._colorTemp),this._useColorTemperature&&eL.multiply(this._finalColor,this._color,this._colorTempRGB)}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"finalColor",get:function(){return this._finalColor}},{key:"visibility",get:function(){return this._visibility},set:function(g){this._visibility=g}},{key:"node",get:function(){return this._node},set:function(g){this._node=g,this._node&&(this._node.hasChangedFlags|=pq.ROTATION)}},{key:"type",get:function(){return this._type}},{key:"name",get:function(){return this._name},set:function(g){this._name=g}},{key:"scene",get:function(){return this._scene}}]),t1}();!function(g){g[g.PER_INSTANCE=0]="PER_INSTANCE",g[g.PER_BATCH=1]="PER_BATCH",g[g.PER_PHASE=2]="PER_PHASE",g[g.PER_PASS=3]="PER_PASS",g[g.COUNT=4]="COUNT"}(p0||(p0={})),function(g){g[g.CONSTANTS=0]="CONSTANTS",g[g.CBV=1]="CBV",g[g.UAV=2]="UAV",g[g.SRV=3]="SRV",g[g.TABLE=4]="TABLE",g[g.SSV=5]="SSV"}(p1||(p1={})),function(g){g[g.MANAGED=0]="MANAGED",g[g.MEMORYLESS=1]="MEMORYLESS",g[g.PERSISTENT=2]="PERSISTENT",g[g.EXTERNAL=3]="EXTERNAL",g[g.BACKBUFFER=4]="BACKBUFFER"}(p2||(p2={})),function(g){g[g.NONE=0]="NONE",g[g.OPAQUE=1]="OPAQUE",g[g.MASK=2]="MASK",g[g.BLEND=3]="BLEND",g[g.RENDER_OPAQUE=1]="RENDER_OPAQUE",g[g.RENDER_CUTOUT=2]="RENDER_CUTOUT",g[g.RENDER_TRANSPARENT=3]="RENDER_TRANSPARENT"}(p3||(p3={})),function(g){g[g.BUFFER=0]="BUFFER",g[g.TEXTURE1D=1]="TEXTURE1D",g[g.TEXTURE2D=2]="TEXTURE2D",g[g.TEXTURE3D=3]="TEXTURE3D"}(p4||(p4={})),function(g){g[g.NONE=0]="NONE",g[g.UNIFORM=1]="UNIFORM",g[g.INDIRECT=2]="INDIRECT",g[g.STORAGE=4]="STORAGE",g[g.SAMPLED=8]="SAMPLED",g[g.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",g[g.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",g[g.INPUT_ATTACHMENT=64]="INPUT_ATTACHMENT",g[g.SHADING_RATE=128]="SHADING_RATE",g[g.TRANSFER_SRC=256]="TRANSFER_SRC",g[g.TRANSFER_DST=512]="TRANSFER_DST"}(p8||(p8={})),function(g){g[g.SYNC=0]="SYNC",g[g.ASYNC=1]="ASYNC"}(p6||(p6={})),function(g){g[g.NONE=0]="NONE",g[g.OPAQUE=1]="OPAQUE",g[g.MASK=2]="MASK",g[g.BLEND=4]="BLEND",g[g.OPAQUE_OBJECT=1]="OPAQUE_OBJECT",g[g.CUTOUT_OBJECT=2]="CUTOUT_OBJECT",g[g.TRANSPARENT_OBJECT=4]="TRANSPARENT_OBJECT",g[g.SHADOW_CASTER=8]="SHADOW_CASTER",g[g.UI=16]="UI",g[g.DEFAULT_LIGHTING=32]="DEFAULT_LIGHTING",g[g.VOLUMETRIC_LIGHTING=64]="VOLUMETRIC_LIGHTING",g[g.CLUSTERED_LIGHTING=128]="CLUSTERED_LIGHTING",g[g.PLANAR_SHADOW=256]="PLANAR_SHADOW",g[g.GEOMETRY=512]="GEOMETRY",g[g.PROFILER=1024]="PROFILER",g[g.DRAW_INSTANCING=2048]="DRAW_INSTANCING",g[g.DRAW_NON_INSTANCING=4096]="DRAW_NON_INSTANCING",g[g.REFLECTION_PROBE=8192]="REFLECTION_PROBE",g[g.GPU_DRIVEN=16384]="GPU_DRIVEN",g[g.NON_BUILTIN=32768]="NON_BUILTIN",g[g.ALL=0xffffffff]="ALL"}(p7||(p7={})),function(g){g[g.NONE=0]="NONE",g[g.DEFAULT=1]="DEFAULT",g[g.CLUSTERED=2]="CLUSTERED"}(p9||(p9={})),function(g){g[g.RENDER_TARGET=0]="RENDER_TARGET",g[g.DEPTH_STENCIL=1]="DEPTH_STENCIL",g[g.SHADING_RATE=2]="SHADING_RATE"}(mt||(mt={})),function(g){g[g.READ=0]="READ",g[g.READ_WRITE=1]="READ_WRITE",g[g.WRITE=2]="WRITE"}(me||(me={})),function(g){g[g.NONE=0]="NONE",g[g.FLOAT_TYPE=1]="FLOAT_TYPE",g[g.INT_TYPE=2]="INT_TYPE"}(mn||(mn={}));var ms,mh,mu=function(){function t1(g,v,S,O){void 0===g&&(g=null),void 0===v&&(v=0),void 0===S&&(S=!1),void 0===O&&(O=null),this.light=void 0,this.probe=void 0,this.level=void 0,this.culledByLight=void 0,this.light=g,this.probe=O,this.level=v,this.culledByLight=S}return t1.prototype.reset=function(g,v,S,O){void 0===g&&(g=null),void 0===v&&(v=0),void 0===S&&(S=!1),void 0===O&&(O=null),this.light=g,this.probe=O,this.level=v,this.culledByLight=S},t1}();!function(g){g[g.UNIFORM_BUFFER=0]="UNIFORM_BUFFER",g[g.DYNAMIC_UNIFORM_BUFFER=1]="DYNAMIC_UNIFORM_BUFFER",g[g.SAMPLER_TEXTURE=2]="SAMPLER_TEXTURE",g[g.SAMPLER=3]="SAMPLER",g[g.TEXTURE=4]="TEXTURE",g[g.STORAGE_BUFFER=5]="STORAGE_BUFFER",g[g.DYNAMIC_STORAGE_BUFFER=6]="DYNAMIC_STORAGE_BUFFER",g[g.STORAGE_IMAGE=7]="STORAGE_IMAGE",g[g.INPUT_ATTACHMENT=8]="INPUT_ATTACHMENT"}(ms||(ms={})),function(g){g[g.NONE=0]="NONE",g[g.COLOR=1]="COLOR",g[g.DEPTH=2]="DEPTH",g[g.STENCIL=4]="STENCIL"}(mh||(mh={}));var ml,mc=function(){function t1(g,v,S,O,X,Y,te){void 0===g&&(g=new Uint8Array(0)),void 0===v&&(v=""),void 0===S&&(S=0xffffffff),void 0===O&&(O=0xffffffff),void 0===X&&(X=0),void 0===Y&&(Y=0),void 0===te&&(te=0),this.source=void 0,this.target=void 0,this.mipLevels=void 0,this.numSlices=void 0,this.targetMostDetailedMip=void 0,this.targetFirstSlice=void 0,this.targetPlaneSlice=void 0,this.source=g,this.target=v,this.mipLevels=S,this.numSlices=O,this.targetMostDetailedMip=X,this.targetFirstSlice=Y,this.targetPlaneSlice=te}return t1.prototype.reset=function(g,v,S,O,X,Y){void 0===g&&(g=""),void 0===v&&(v=0xffffffff),void 0===S&&(S=0xffffffff),void 0===O&&(O=0),void 0===X&&(X=0),void 0===Y&&(Y=0),this.target=g,this.mipLevels=v,this.numSlices=S,this.targetMostDetailedMip=O,this.targetFirstSlice=X,this.targetPlaneSlice=Y},t1}();aN(lJ.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),aF(pX.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this.window}}]);var m_=((ml={})[oT.UNORM]="Uint",ml[oT.SNORM]="Int",ml[oT.UINT]="Uint",ml[oT.INT]="Int",ml[oT.UFLOAT]="Float",ml[oT.FLOAT]="Float",ml.default="Uint",ml);function GA(g){return""+(m_[g.type]||m_.default)+g.size/g.count*8}function kA(g,v,S,O,X){void 0===S&&(S=oA.R32F),void 0===O&&(O=0),void 0===X&&(X=0);var Y=uf[S];X||(X=Y.size);for(var te="set"+GA(Y),ti=Y.size/Y.count,tr=Math.floor(v.length/Y.count),ta=a3.isLittleEndian,th=0;th<tr;++th)for(var tu=O+X*th,tl=0;tl<Y.count;++tl){var tc=tu+ti*tl;g[te](tc,v[Y.count*th+tl],ta)}}var mf=g("dQ",function(){function t1(g,v,S,O,X,Y){void 0===O&&(O=null),void 0===X&&(X=null),void 0===Y&&(Y=!0),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._isOwnerOfIndexBuffer=!0,this._drawInfo=null,this._attributes=v,this._vertexBuffers=g,this._indexBuffer=O,this._indirectBuffer=X,this._primitiveMode=S,this._iaInfo=new hX(v,g,O,X),this._isOwnerOfIndexBuffer=Y}var g=t1.prototype;return g.invalidateGeometricInfo=function(){this._geometricInfo=void 0},g.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var g=this.mesh,v=0,S=g.struct.primitives[this.subMeshIdx];S.indexView&&(v=S.indexView.count);for(var O=0;O<S.vertexBundelIndices.length;O++){var X=S.vertexBundelIndices[O],Y=g.struct.vertexBundles[X],te=S.indexView?S.indexView.count:Y.view.count,ti=Y.view.stride,tr=ti*te,ta=new Uint8Array(g.data.buffer,Y.view.offset,Y.view.length),th=new Uint8Array(S.indexView?tr:Y.view.length);if(S.indexView){for(var tu=g.readIndices(this.subMeshIdx),tl=0;tl<v;++tl)for(var tc=tl*ti,t_=tu[tl]*ti,tf=0;tf<ti;++tf)th[tc+tf]=ta[t_+tf];this._flatBuffers.push({stride:ti,count:te,buffer:th})}else th.set(g.data.subarray(Y.view.offset,Y.view.offset+Y.view.length)),this._flatBuffers.push({stride:ti,count:te,buffer:th})}}},g.destroy=function(){for(var g=0;g<this.vertexBuffers.length;g++)this.vertexBuffers[g].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._isOwnerOfIndexBuffer&&this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var v=0;v<this._jointMappedBufferIndices.length;v++)this._jointMappedBuffers[this._jointMappedBufferIndices[v]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null)},g.enableVertexIdChannel=function(g){if(!this._vertexIdChannel){var v=this.vertexBuffers.length,S=this.attributes.length,O=this._allocVertexIdBuffer(g);this._vertexBuffers.push(O),this._attributes.push(new hz("a_vertexId",oA.R32F,!1,v)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:v,index:S}}},g._allocVertexIdBuffer=function(g){for(var v=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,S=new Float32Array(v),O=0;O<v;++O)S[O]=O+.5;var X=g.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,S.byteLength,S.BYTES_PER_ELEMENT));return X.update(S),X},n(t1,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return t1.EMPTY_GEOMETRIC_INFO;if(void 0===this.subMeshIdx)return t1.EMPTY_GEOMETRIC_INFO;var g,v=this.mesh,S=this.subMeshIdx,O=this.attributes.find(function(g){return g.name===hi.ATTR_POSITION});if(!O)return t1.EMPTY_GEOMETRIC_INFO;switch(O.format){case oA.RG32F:case oA.RGB32F:if(!(g=v.readAttribute(S,hi.ATTR_POSITION)))return t1.EMPTY_GEOMETRIC_INFO;break;case oA.RGBA32F:var X=v.readAttribute(S,hi.ATTR_POSITION);if(!X)return t1.EMPTY_GEOMETRIC_INFO;var Y=X.length/4;g=new Float32Array(3*Y);for(var te=0;te<Y;++te){var ti=3*te,tr=4*te;g[ti]=X[tr],g[ti+1]=X[tr+1],g[ti+2]=X[tr+2]}break;case oA.RG16F:case oA.RGB16F:var ta=v.readAttribute(S,hi.ATTR_POSITION);if(!ta)return t1.EMPTY_GEOMETRIC_INFO;g=new Float32Array(ta.length);for(var th=0;th<ta.length;++th)g[th]=Ui(ta[th]);break;case oA.RGBA16F:var tu=v.readAttribute(S,hi.ATTR_POSITION);if(!tu)return t1.EMPTY_GEOMETRIC_INFO;var tl=tu.length/4;g=new Float32Array(3*tl);for(var tc=0;tc<tl;++tc){var t_=3*tc,tf=4*tc;g[t_]=Ui(tu[tf]),g[t_+1]=Ui(tu[tf+1]),g[t_+2]=Ui(tu[tf+2])}break;default:return t1.EMPTY_GEOMETRIC_INFO}var tp=v.readIndices(S)||void 0,tm=new eL,tg=new eL,tv=uf[O.format].count;2===tv?(tm.set(g[0],g[1],0),tg.set(g[0],g[1],0)):(tm.set(g[0],g[1],g[2]),tg.set(g[0],g[1],g[2]));for(var ty=0;ty<g.length;ty+=tv)2===tv?(tm.x=g[ty]>tm.x?g[ty]:tm.x,tm.y=g[ty+1]>tm.y?g[ty+1]:tm.y,tg.x=g[ty]<tg.x?g[ty]:tg.x,tg.y=g[ty+1]<tg.y?g[ty+1]:tg.y):(tm.x=g[ty]>tm.x?g[ty]:tm.x,tm.y=g[ty+1]>tm.y?g[ty+1]:tm.y,tm.z=g[ty+2]>tm.z?g[ty+2]:tm.z,tg.x=g[ty]<tg.x?g[ty]:tg.x,tg.y=g[ty+1]<tg.y?g[ty+1]:tg.y,tg.z=g[ty+2]<tg.z?g[ty+2]:tg.z);return this._geometricInfo={positions:g,indices:tp,boundingBox:{max:tm,min:tg}},this._geometricInfo}},{key:"drawInfo",get:function(){return this._drawInfo},set:function(g){this._drawInfo=g}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var g=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var v=this._jointMappedBuffers=[],S=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var O,Y,te=this.mesh.struct,ti=te.primitives[this.subMeshIdx];if(!te.jointMaps||void 0===ti.jointMapIndex||!te.jointMaps[ti.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var tr=X.director.root.device,h=function(){var X=te.vertexBundles[ti.vertexBundelIndices[ta]];Y=0,O=oA.UNKNOWN;for(var th=0;th<X.attributes.length;th++){var tu=X.attributes[th];if(tu.name===hi.ATTR_JOINTS){O=tu.format;break}Y+=uf[tu.format].size}if(O){var tl=new Uint8Array(g.mesh.data.buffer,X.view.offset,X.view.length),tc=new DataView(tl.slice().buffer),t_=te.jointMaps[ti.jointMapIndex];!function(g,v,S,O,X,Y,te){void 0===S&&(S=oA.R32F),void 0===O&&(O=0),void 0===X&&(X=g.byteLength-O),void 0===Y&&(Y=0),te||(te=new DataView(g.buffer.slice(g.byteOffset,g.byteOffset+g.byteLength)));var ti,tr=uf[S];Y||(Y=tr.size);for(var ta="set"+GA(tr),th="get"+GA(tr),tu=tr.size/tr.count,tl=Math.floor(X/Y),tc=a3.isLittleEndian,tf=0;tf<tl;++tf)for(var tp=O+Y*tf,tm=0;tm<tr.count;++tm){var tg=tp+tu*tm,tv=g[th](tg,tc);te[ta](tg,(ti=tv,t_.indexOf(ti)),tc)}}(tc,0,O,Y,X.view.length,X.view.stride,tc);var tf=tr.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,X.view.length,X.view.stride));tf.update(tc.buffer),v.push(tf),S.push(ta)}else v.push(g.vertexBuffers[ti.vertexBundelIndices[ta]])},ta=0;ta<ti.vertexBundelIndices.length;ta++)h();return this._vertexIdChannel&&v.push(this._allocVertexIdBuffer(tr)),v}},{key:"iaInfo",get:function(){return this._iaInfo}}]),t1}());mf.EMPTY_GEOMETRIC_INFO={positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:eL.ZERO,max:eL.ZERO}};var md,mm,mg,mv,my,mS,mA,mT,mE,mC,mx,mb,mR,mw,mI,mB,mP,mD,mM=function(){var g=e.prototype;function e(g){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._node=void 0,this._node=g}return g.setOpacity=function(g){this._opacity=g},g.applyOpacity=function(g){this._opacity=this._localOpacity*g},e.markOpacityTree=function(){},n(e,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(g){this._uiTransformComp=g}},{key:"uiComp",get:function(){return this._uiComp},set:function(g){this._uiComp&&g?q(12002):this._uiComp=g}},{key:"opacity",get:function(){return this._opacity}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(g){this._localOpacity=g,this.colorDirty=!0}}]),e}();rG.Flags.Destroying,X.GAME_VIEW,g("dp",md),function(g){g.TOUCH_START="touch-start",g.TOUCH_MOVE="touch-move",g.TOUCH_END="touch-end",g.TOUCH_CANCEL="touch-cancel",g.MOUSE_DOWN="mouse-down",g.MOUSE_MOVE="mouse-move",g.MOUSE_UP="mouse-up",g.MOUSE_WHEEL="mouse-wheel",g.MOUSE_ENTER="mouse-enter",g.MOUSE_LEAVE="mouse-leave",g.KEY_DOWN="keydown",g.KEY_UP="keyup",g.DEVICEMOTION="devicemotion",g.TRANSFORM_CHANGED="transform-changed",g.MOBILITY_CHANGED="mobility-changed",g.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",g.SIZE_CHANGED="size-changed",g.ANCHOR_CHANGED="anchor-changed",g.COLOR_CHANGED="color-changed",g.CHILD_ADDED="child-added",g.CHILD_REMOVED="child-removed",g.PARENT_CHANGED="parent-changed",g.NODE_DESTROYED="node-destroyed",g.LAYER_CHANGED="layer-changed",g.SIBLING_ORDER_CHANGED="sibling-order-changed",g.CHILDREN_ORDER_CHANGED="sibling-order-changed",g.ACTIVE_IN_HIERARCHY_CHANGED="active-in-hierarchy-changed",g.COMPONENT_ADDED="component-added",g.COMPONENT_REMOVED="component-removed",g.LIGHT_PROBE_CHANGED="light-probe-changed",g.LIGHT_PROBE_BAKING_CHANGED="light-probe-baking-changed"}(md||g("dp",md={}));var mO=rG.Flags.Destroying,mL=rG.Flags.DontDestroy,mN=rG.Flags.Deactivating,mk=new tT("Node");function lT(g){return g?"string"==typeof g?zt(g):g:(J(3804),null)}var mG=new eL,mV=new eL,mU=new eW,mH=new eW,mz=new eW,mW=new eV;new eV;var mX=new e$,mj=new e$,mq=[],mY=Symbol("ReserveContentsForAllSyncablePrefab"),mK=0,mJ=g("dd",(mm=nJ("cc.Node"),mg=ma(eL),mv=ma(pQ),mm(((mD=function(g){s(i,g);var v=i.prototype;function i(v){var S;return(S=g.call(this,v)||this)._parent=mA&&mA(),S._children=mT&&mT(),S._active=mE&&mE(),S._components=mC&&mC(),S._prefab=mx&&mx(),S._scene=null,S._activeInHierarchy=!1,S._id=mk.getNewId(),S._name=void 0,S._eventProcessor=new X.NodeEventProcessor(c(S)),S._eventMask=0,S._siblingIndex=0,S._originalSceneId="",S._uiProps=new mM(c(S)),S._static=!1,S._lpos=mb&&mb(),S._lrot=mR&&mR(),S._lscale=mw&&mw(),S._mobility=mI&&mI(),S._layer=mB&&mB(),S._euler=mP&&mP(),S._transformFlags=pq.TRS,S._eulerDirty=!1,S._flagChangeVersion=0,S._hasChangedFlags=0,S._name=void 0!==v?v:"New Node",S._pos=new eL,S._rot=new eW,S._scale=new eL(1,1,1),S._mat=new e$,S}return v._setActiveInHierarchy=function(g){this._activeInHierarchy=g},i._setScene=function(g){g._updateScene()},i._findComponent=function(g,v){var S=v,O=g._components;if(S._sealed)for(var X=0;X<O.length;++X){var Y=O[X];if(Y.constructor===v)return Y}else for(var te=0;te<O.length;++te){var ti=O[te];if(_instanceof(ti,v))return ti}return null},i._findComponents=function(g,v,S){var O=v,X=g._components;if(O._sealed)for(var Y=0;Y<X.length;++Y){var te=X[Y];te.constructor===v&&S.push(te)}else for(var ti=0;ti<X.length;++ti){var tr=X[ti];_instanceof(tr,v)&&S.push(tr)}},i._findChildComponent=function(g,v){for(var S=0;S<g.length;++S){var O=g[S],X=i._findComponent(O,v);if(X)return X;if(O._children.length>0&&(X=i._findChildComponent(O._children,v)))return X}return null},i._findChildComponents=function(g,v,S){for(var O=0;O<g.length;++O){var X=g[O];i._findComponents(X,v,S),X._children.length>0&&i._findChildComponents(X._children,v,S)}},v.getWritableComponents=function(){return this._components},v._updateScene=function(){null==this._parent?k("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},v.attr=function(g){wt(this,g)},v.getParent=function(){return this._parent},v.modifyParent=function(g){this._parent=g},v.setParent=function(g,v){if(void 0===v&&(v=!1),v&&this.updateWorldTransform(),this._parent!==g){var S=this._parent,O=g;if(this._parent=O,this._siblingIndex=0,this._onSetParent(S,v),this.emit&&this.emit(md.PARENT_CHANGED,S),S&&!(S._objFlags&mO)){var X=S._children.indexOf(this);S._children.splice(X,1),S._updateSiblingIndex(),S.emit&&S.emit(md.CHILD_REMOVED,this)}O&&(O._children.push(this),this._siblingIndex=O._children.length-1,O.emit&&O.emit(md.CHILD_ADDED,this)),this._onHierarchyChanged(S)}},v.getChildByUuid=function(g){if(!g)return N("Invalid uuid"),null;for(var v=this._children,S=0,O=v.length;S<O;S++)if(v[S]._id===g)return v[S];return null},v.getChildByName=function(g){if(!g)return N("Invalid name"),null;for(var v=this._children,S=0,O=v.length;S<O;S++)if(v[S]._name===g)return v[S];return null},v.getChildByPath=function(g){for(var v,S=g.split("/"),O=this,_$r=function(){var g=S[X];if(0===g.length)return 0;var v=O.children.find(function(v){return v.name===g});if(!v)return{v:null};O=v},X=0;X<S.length;++X)if(0!==(v=_$r())&&v)return v.v;return O},v.addChild=function(g){g.setParent(this)},v.insertChild=function(g,v){g.setParent(this),g.setSiblingIndex(v)},v.getSiblingIndex=function(){return this._siblingIndex},v.setSiblingIndex=function(g){if(this._parent){if(this._parent._objFlags&mN)J(3821);else{var v=this._parent._children;g=-1!==g?g:v.length-1;var S=v.indexOf(this);g!==S&&(v.splice(S,1),g<v.length?v.splice(g,0,this):v.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(g),this._eventProcessor.onUpdatingSiblingIndex())}}},v.walk=function(g,v){var S=1,O=null,X=null,Y=0,te=i._stacks[i._stackId];te||(te=[],i._stacks.push(te)),i._stackId++,te.length=0,te[0]=this;for(var ti=null,tr=!1;S;)if(X=te[--S]){if(!tr&&g?g(X):tr&&v&&v(X),te[S]=null,tr){if(ti===this._parent)break;if(tr=!1,O){if(O[++Y])te[S]=O[Y],S++;else if(ti&&(te[S]=ti,S++,tr=!0,ti._parent?(Y=(O=ti._parent._children).indexOf(ti),ti=ti._parent):(ti=null,O=null),Y<0))break}}else X._children.length>0?(ti=X,O=X._children,Y=0,te[S]=O[Y],S++):(te[S]=X,S++,tr=!0)}te.length=0,i._stackId--},v.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},v.removeChild=function(g){this._children.indexOf(g)>-1&&(g.parent=null)},v.removeAllChildren=function(){for(var g=this._children,v=g.length-1;v>=0;v--){var S=g[v];S&&(S.parent=null)}this._children.length=0},v.isChildOf=function(g){var v=this;do{if(v===g)return!0;v=v._parent}while(v);return!1},v.getComponent=function(g){var v=lT(g);return v?i._findComponent(this,v):null},v.getComponents=function(g){var v=lT(g),S=[];return v&&i._findComponents(this,v,S),S},v.getComponentInChildren=function(g){var v=lT(g);return v?i._findChildComponent(this._children,v):null},v.getComponentsInChildren=function(g){var v=lT(g),S=[];return v&&(i._findComponents(this,v,S),i._findChildComponents(this._children,v,S)),S},v.addComponent=function(g){var v;if("string"==typeof g){if(!(v=zt(g)))throw X._RF.peek()&&J(3808,g),TypeError(tt(3807,g))}else{if(!g)throw TypeError(tt(3804));v=g}if("function"!=typeof v)throw TypeError(tt(3809));if(!Pt(v,X.Component))throw TypeError(tt(3810));var S=v._requireComponent;if(S){if(Array.isArray(S))for(var O=0;O<S.length;O++){var Y=S[O];this.getComponent(Y)||this.addComponent(Y)}else{var te=S;this.getComponent(te)||this.addComponent(te)}}var ti=new v;return ti.node=this,this._components.push(ti),this.emit(md.COMPONENT_ADDED,ti),this._activeInHierarchy&&X.director._nodeActivator.activateComp(ti),ti},v.removeComponent=function(g){if(g){var v=null;(v=_instanceof(g,cS)?g:this.getComponent(g))&&v.destroy()}else J(3813)},v.on=function(g,v,S,O){switch(void 0===O&&(O=!1),g){case md.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(g,v,S,O)},v.off=function(g,v,S,O){if(void 0===O&&(O=!1),this._eventProcessor.off(g,v,S,O),!this._eventProcessor.hasEventListener(g))switch(g){case md.TRANSFORM_CHANGED:this._eventMask&=-2}},v.once=function(g,v,S,O){this._eventProcessor.once(g,v,S,O)},v.emit=function(g,v,S,O,X,Y){this._eventProcessor.emit(g,v,S,O,X,Y)},v.dispatchEvent=function(g){this._eventProcessor.dispatchEvent(g)},v.hasEventListener=function(g,v,S){return this._eventProcessor.hasEventListener(g,v,S)},v.targetOff=function(g){this._eventProcessor.targetOff(g),1&this._eventMask&&!this._eventProcessor.hasEventListener(md.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},v.destroy=function(){return!!g.prototype.destroy.call(this)&&(this.active=!1,!0)},v.destroyAllChildren=function(){for(var g=this._children,v=0;v<g.length;++v)g[v].destroy()},v._removeComponent=function(g){if(g){if(!(this._objFlags&mO)){var v=this._components.indexOf(g);-1!==v?(this._components.splice(v,1),this.emit(md.COMPONENT_REMOVED,g)):g.node!==this&&J(3815)}}else J(3814)},v._updateSiblingIndex=function(){for(var g=0;g<this._children.length;++g)this._children[g]._siblingIndex=g;this.emit(md.CHILDREN_ORDER_CHANGED)},v._instantiate=function(g,v){return g||(g=X.instantiate._clone(this,this)),g._prefab,g._parent=null,g._onBatchCreated(v),g},v._onHierarchyChangedBase=function(){var g=this._parent;!this._persistNode||_instanceof(g,X.Scene)||X.game.removePersistRootNode(this);var v=this._active&&!(!g||!g._activeInHierarchy);this._activeInHierarchy!==v&&X.director._nodeActivator.activateNode(this,v)},v._onPreDestroyBase=function(){this._objFlags|=mO;var g=this._parent,v=!!g&&0!=(g._objFlags&mO);if(this._persistNode&&X.game.removePersistRootNode(this),!v&&g){this.emit(md.PARENT_CHANGED,this);var S=g._children.indexOf(this);g._children.splice(S,1),this._siblingIndex=0,g._updateSiblingIndex(),g.emit&&g.emit(md.CHILD_REMOVED,this)}this.emit(md.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var O=this._children,Y=0;Y<O.length;++Y)O[Y]._destroyImmediate();for(var te=this._components,ti=0;ti<te.length;++ti)te[ti]._destroyImmediate();return v},i.isNode=function(g){return _instanceof(g,i)&&(g.constructor===i||!_instanceof(g,X.Scene))},v._onPreDestroy=function(){return this._onPreDestroyBase()},v[rU]=function(g){g.writeThis()},v._onSetParent=function(g,v){if(void 0===v&&(v=!1),this._parent&&(null!=g&&g._scene===this._parent._scene||null==this._parent._scene||this.walk(i._setScene)),v){var S=this._parent;S?(S.updateWorldTransform(),pi(e$.determinant(S._mat),0,ex)?(q(14300),this._transformFlags|=pq.TRS,this.updateWorldTransform()):(e$.multiply(mX,e$.invert(mX,S._mat),this._mat),e$.toRTS(mX,this._lrot,this._lpos,this._lscale))):(eL.copy(this._lpos,this._pos),eW.copy(this._lrot,this._rot),eL.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(pq.TRS)},v._onHierarchyChanged=function(g){this.eventProcessor.reattach(),this._onHierarchyChangedBase(g)},v._onBatchCreated=function(g){this.hasChangedFlags=pq.TRS;for(var v=this._children.length,S=0;S<v;++S)this._children[S]._siblingIndex=S,this._children[S]._onBatchCreated(g)},v._onBeforeSerialize=function(){this.eulerAngles},v._onPostActivated=function(g){g?(this._eventProcessor.setEnabled(!0),this.invalidateChildren(pq.TRS),this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.setTextureDirty(),this._uiProps.uiComp.markForUpdateRenderData())):this._eventProcessor.setEnabled(!1)},v.translate=function(g,v){var S=v||pj.LOCAL;if(S===pj.LOCAL)eL.transformQuat(mG,g,this._lrot),this._lpos.x+=mG.x,this._lpos.y+=mG.y,this._lpos.z+=mG.z;else if(S===pj.WORLD){if(this._parent){eW.invert(mU,this._parent.worldRotation),eL.transformQuat(mG,g,mU);var O=this.worldScale;this._lpos.x+=mG.x/O.x,this._lpos.y+=mG.y/O.y,this._lpos.z+=mG.z/O.z}else this._lpos.x+=g.x,this._lpos.y+=g.y,this._lpos.z+=g.z}this.invalidateChildren(pq.POSITION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.POSITION)},v.rotate=function(g,v){var S=v||pj.LOCAL;if(eW.normalize(mU,g),S===pj.LOCAL)eW.multiply(this._lrot,this._lrot,mU);else if(S===pj.WORLD){var O=this.worldRotation;eW.multiply(mH,mU,O),eW.invert(mU,O),eW.multiply(mH,mU,mH),eW.multiply(this._lrot,this._lrot,mH)}this._eulerDirty=!0,this.invalidateChildren(pq.ROTATION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.ROTATION)},v.lookAt=function(g,v){this.getWorldPosition(mG),eL.subtract(mG,mG,g),eL.normalize(mG,mG),eW.fromViewUp(mU,mG,v),this.setWorldRotation(mU)},v.invalidateChildren=function(g){var v,S,O=0,X=0,Y=0,te=0,ti=g|pq.POSITION;for(mq[0]=this;O>=0;){if(te=(v=mq[O--]).hasChangedFlags,v.isValid&&(v._transformFlags&te&g)!==g)for(v._transformFlags|=g,v.hasChangedFlags=te|g,Y=(S=v._children).length,X=0;X<Y;X++)mq[++O]=S[X];g=ti}},v.updateWorldTransform=function(){if(this._transformFlags){for(var g,v=this,S=0;v&&v._transformFlags;)mq[S++]=v,v=v._parent;for(var O=0;S;){if(O|=(g=mq[--S])._transformFlags,v){if(O&pq.POSITION&&(eL.transformMat4(g._pos,g._lpos,v._mat),g._mat.m12=g._pos.x,g._mat.m13=g._pos.y,g._mat.m14=g._pos.z),O&pq.RS){e$.fromRTS(g._mat,g._lrot,g._lpos,g._lscale),e$.multiply(g._mat,v._mat,g._mat);var X=O&pq.ROTATION?g._rot:null;e$.toRTS(g._mat,X,null,g._scale)}}else O&pq.POSITION&&(eL.copy(g._pos,g._lpos),g._mat.m12=g._pos.x,g._mat.m13=g._pos.y,g._mat.m14=g._pos.z),O&pq.RS&&(O&pq.ROTATION&&eW.copy(g._rot,g._lrot),O&pq.SCALE&&eL.copy(g._scale,g._lscale),e$.fromRTS(g._mat,g._rot,g._pos,g._scale));g._transformFlags=pq.NONE,v=g}}},v.setPosition=function(g,v,S){void 0===v&&void 0===S?eL.copy(this._lpos,g):void 0===S?eL.set(this._lpos,g,v,this._lpos.z):eL.set(this._lpos,g,v,S),this.invalidateChildren(pq.POSITION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.POSITION)},v.getPosition=function(g){return g?eL.set(g,this._lpos.x,this._lpos.y,this._lpos.z):eL.copy(new eL,this._lpos)},v.setRotation=function(g,v,S,O){void 0===v||void 0===S||void 0===O?eW.copy(this._lrot,g):eW.set(this._lrot,g,v,S,O),this._eulerDirty=!0,this.invalidateChildren(pq.ROTATION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.ROTATION)},v.setRotationFromEuler=function(g,v,S){var O=void 0===S?this._euler.z:S;void 0===v?(eL.copy(this._euler,g),eW.fromEuler(this._lrot,g.x,g.y,g.z)):(eL.set(this._euler,g,v,O),eW.fromEuler(this._lrot,g,v,O)),this._eulerDirty=!1,this.invalidateChildren(pq.ROTATION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.ROTATION)},v.getRotation=function(g){return g?eW.set(g,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):eW.copy(new eW,this._lrot)},v.setScale=function(g,v,S){void 0===v&&void 0===S?eL.copy(this._lscale,g):void 0===S?eL.set(this._lscale,g,v,this._lscale.z):eL.set(this._lscale,g,v,S),this.invalidateChildren(pq.SCALE),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.SCALE)},v.getScale=function(g){return g?eL.set(g,this._lscale.x,this._lscale.y,this._lscale.z):eL.copy(new eL,this._lscale)},v.inverseTransformPoint=function(g,v){eL.copy(g,v);for(var S=this,O=0;S._parent;)mq[O++]=S,S=S._parent;for(;O>=0;)eL.transformInverseRTS(g,g,S._lrot,S._lpos,S._lscale),S=mq[--O];return g},v.setWorldPosition=function(g,v,S){void 0===v||void 0===S?eL.copy(this._pos,g):eL.set(this._pos,g,v,S);var O=this._parent,X=this._lpos;O?(O.updateWorldTransform(),eL.transformMat4(X,this._pos,e$.invert(mX,O._mat))):eL.copy(X,this._pos),this.invalidateChildren(pq.POSITION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.POSITION)},v.getWorldPosition=function(g){return this.updateWorldTransform(),g?eL.copy(g,this._pos):eL.copy(new eL,this._pos)},v.setWorldRotation=function(g,v,S,O){void 0===v||void 0===S||void 0===O?eW.copy(this._rot,g):eW.set(this._rot,g,v,S,O),this._parent?(this._parent.updateWorldTransform(),eW.multiply(this._lrot,eW.conjugate(this._lrot,this._parent._rot),this._rot)):eW.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(pq.ROTATION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.ROTATION)},v.setWorldRotationFromEuler=function(g,v,S){eW.fromEuler(this._rot,g,v,S),this._parent?(this._parent.updateWorldTransform(),eW.multiply(this._lrot,eW.conjugate(this._lrot,this._parent._rot),this._rot)):eW.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(pq.ROTATION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.ROTATION)},v.getWorldRotation=function(g){return this.updateWorldTransform(),g?eW.copy(g,this._rot):eW.copy(new eW,this._rot)},v.setWorldScale=function(g,v,S){var O=this._parent;O&&this.updateWorldTransform(),void 0===v||void 0===S?eL.copy(this._scale,g):eL.set(this._scale,g,v,S),O?(mG.x=this._scale.x/eL.set(mV,this._mat.m00,this._mat.m01,this._mat.m02).length(),mG.y=this._scale.y/eL.set(mV,this._mat.m04,this._mat.m05,this._mat.m06).length(),mG.z=this._scale.z/eL.set(mV,this._mat.m08,this._mat.m09,this._mat.m10).length(),e$.scale(mX,this._mat,mG),e$.multiply(mj,e$.invert(mj,O._mat),mX),eV.fromQuat(mW,eW.conjugate(mz,this._lrot)),eV.multiplyMat4(mW,mW,mj),this._lscale.x=eL.set(mG,mW.m00,mW.m01,mW.m02).length(),this._lscale.y=eL.set(mG,mW.m03,mW.m04,mW.m05).length(),this._lscale.z=eL.set(mG,mW.m06,mW.m07,mW.m08).length()):eL.copy(this._lscale,this._scale),this.invalidateChildren(pq.SCALE),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.SCALE)},v.getWorldScale=function(g){return this.updateWorldTransform(),g?eL.copy(g,this._scale):eL.copy(new eL,this._scale)},v.getWorldMatrix=function(g){this.updateWorldTransform();var v=g||new e$;return e$.copy(v,this._mat)},v.getWorldRS=function(g){this.updateWorldTransform();var v=g||new e$;return e$.copy(v,this._mat),v.m12=0,v.m13=0,v.m14=0,v},v.getWorldRT=function(g){this.updateWorldTransform();var v=g||new e$;return e$.fromRT(v,this._rot,this._pos)},v.setRTS=function(g,v,S){var O=0;g&&(O|=pq.ROTATION,void 0!==g.w?(eW.copy(this._lrot,g),this._eulerDirty=!0):(eL.copy(this._euler,g),eW.fromEuler(this._lrot,g.x,g.y,g.z),this._eulerDirty=!1)),v&&(eL.copy(this._lpos,v),O|=pq.POSITION),S&&(eL.copy(this._lscale,S),O|=pq.SCALE),O&&(this.invalidateChildren(O),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,O))},v.isTransformDirty=function(){return this._transformFlags!==pq.NONE},v.pauseSystemEvents=function(g){this._eventProcessor.setEnabled(!1,g)},v.resumeSystemEvents=function(g){this._eventProcessor.setEnabled(!0,g)},i.resetHasChangedFlags=function(){mK+=1},i.clearNodeArray=function(){i.ClearFrame<i.ClearRound?i.ClearFrame++:(i.ClearFrame=0,mq.length=0)},v.getPathInHierarchy=function(){for(var g=this.name,v=this.parent;v&&!_instanceof(v,X.Scene);)g=v.name+"/"+g,v=v.parent;return g},n(i,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&mL)>0},set:function(g){g?this._objFlags|=mL:this._objFlags&=~mL}},{key:"name",get:function(){return this._name},set:function(g){this._name=g}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(g){if(g=!!g,this._active!==g){this._active=g;var v=this._parent;v&&v._activeInHierarchy&&X.director._nodeActivator.activateNode(this,g)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(g){this.setParent(g)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}},{key:"prefab",get:function(){return this._prefab}},{key:"id",set:function(g){this._id=g}},{key:"siblingIndex",get:function(){return this._siblingIndex},set:function(g){this._siblingIndex=g}},{key:"position",get:function(){return this._lpos},set:function(g){this.setPosition(g)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(g){this.setWorldPosition(g)}},{key:"rotation",get:function(){return this._lrot},set:function(g){this.setRotation(g)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(eW.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(g){this.setRotationFromEuler(g.x,g.y,g.z)}},{key:"angle",get:function(){return this._euler.z},set:function(g){eL.set(this._euler,0,0,g),eW.fromAngleZ(this._lrot,g),this._eulerDirty=!1,this.invalidateChildren(pq.ROTATION),1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(g){this.setWorldRotation(g)}},{key:"scale",get:function(){return this._lscale},set:function(g){this.setScale(g)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(g){this.setWorldScale(g)}},{key:"matrix",set:function(g){e$.toRTS(g,this._lrot,this._lpos,this._lscale),this.invalidateChildren(pq.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(md.TRANSFORM_CHANGED,pq.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return eL.transformQuat(new eL,eL.FORWARD,this.worldRotation)},set:function(g){var v=g.length();eL.multiplyScalar(mG,g,-1/v),eW.fromViewUp(mU,mG),this.setWorldRotation(mU)}},{key:"up",get:function(){return eL.transformQuat(new eL,eL.UP,this.worldRotation)}},{key:"right",get:function(){return eL.transformQuat(new eL,eL.RIGHT,this.worldRotation)}},{key:"mobility",get:function(){return this._mobility},set:function(g){this._mobility=g,this.emit(md.MOBILITY_CHANGED)}},{key:"layer",get:function(){return this._layer},set:function(g){this._layer=g,this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.markForUpdateRenderData()),this.emit(md.LAYER_CHANGED,this._layer)}},{key:"flagChangedVersion",get:function(){return this._flagChangeVersion}},{key:"hasChangedFlags",get:function(){return this._flagChangeVersion===mK?this._hasChangedFlags:0},set:function(g){this._flagChangeVersion=mK,this._hasChangedFlags=g}}]),i}(rG)).idGenerator=mk,mD._stacks=[[]],mD._stackId=0,mD.EventType=md,mD.NodeSpace=pj,mD.TransformDirtyBit=pq,mD.TransformBit=pq,mD.reserveContentsForAllSyncablePrefabTag=mY,mD.ClearFrame=0,mD.ClearRound=1e3,p((mS=mD).prototype,"_persistNode",[Us],Object.getOwnPropertyDescriptor(mS.prototype,"_persistNode"),mS.prototype),mA=ws(mS.prototype,"_parent",[n2],function(){return null}),mT=ws(mS.prototype,"_children",[n2],function(){return[]}),mE=ws(mS.prototype,"_active",[n2],function(){return!0}),mC=ws(mS.prototype,"_components",[n2],function(){return[]}),mx=ws(mS.prototype,"_prefab",[n2],function(){return null}),mb=ws(mS.prototype,"_lpos",[n2],function(){return new eL}),mR=ws(mS.prototype,"_lrot",[n2],function(){return new eW}),mw=ws(mS.prototype,"_lscale",[n2],function(){return new eL(1,1,1)}),mI=ws(mS.prototype,"_mobility",[n2],function(){return pQ.Static}),mB=ws(mS.prototype,"_layer",[n2],function(){return _a.Enum.DEFAULT}),mP=ws(mS.prototype,"_euler",[n2],function(){return new eL}),p(mS.prototype,"eulerAngles",[mg],Object.getOwnPropertyDescriptor(mS.prototype,"eulerAngles"),mS.prototype),p(mS.prototype,"mobility",[mv],Object.getOwnPropertyDescriptor(mS.prototype,"mobility"),mS.prototype),my=mS))||my));X.Node=mJ;var mZ=function(){function t1(){this._groundAlbedoHDR=new e7(.2,.2,.2,1),this._skyColorHDR=new e7(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new e7(.2,.2,.2,1),this._skyColorLDR=new e7(.2,.5,.8,1),this._skyIllumLDR=0,this._mipmapCount=1,this._enabled=!1}return t1.prototype.initialize=function(g){this._skyColorHDR=g.skyColorHDR,this._groundAlbedoHDR.set(g.groundAlbedoHDR),this._skyIllumHDR=g.skyIllumHDR,this._skyColorLDR=g.skyColorLDR,this._groundAlbedoLDR.set(g.groundAlbedoLDR),this._skyIllumLDR=g.skyIllumLDR},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g}},{key:"skyColor",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR:this._skyColorLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(g):this._skyColorLDR.set(g)}},{key:"skyIllum",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=g:this._skyIllumLDR=g}},{key:"groundAlbedo",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(g):this._groundAlbedoLDR.set(g)}}]),t1}();mZ.SUN_ILLUM=65e3,mZ.SKY_ILLUM=2e4,X.Ambient=mZ;var mQ=function(g){function e(v,S){var O;(O=g.call(this,v.root)||this)._parent=void 0,O._owner=void 0,O._dontNotify=!1,O._parent=v,O._owner=S,O._doInit(O._parent,!0);for(var X=0;X<O._shaderInfo.blocks.length;X++){var Y=O._shaderInfo.blocks[X],te=O._blocks[Y.binding],ti=O._parent.blocks[Y.binding];te.set(ti)}O._rootBufferDirty=!0;for(var tr=O._parent,ta=0;ta<O._shaderInfo.samplerTextures.length;ta++)for(var th=O._shaderInfo.samplerTextures[ta],tu=0;tu<th.count;tu++){var tl=tr._descriptorSet.getSampler(th.binding,tu),tc=tr._descriptorSet.getTexture(th.binding,tu);O._descriptorSet.bindSampler(th.binding,tl,tu),O._descriptorSet.bindTexture(th.binding,tc,tu)}return g.prototype.tryCompile.call(c(O)),O}s(e,g);var v=e.prototype;return v.overridePipelineStates=function(g,v){this._bs.reset(),this._rs.reset(),this._dss.reset(),dY.fillPipelineInfo(this,g),dY.fillPipelineInfo(this,v),this._onStateChange()},v.tryCompile=function(v){if(v&&!nv(this._defines,v))return!1;var S=g.prototype.tryCompile.call(this);return this._onStateChange(),S},v.beginChangeStatesSilently=function(){this._dontNotify=!0},v.endChangeStatesSilently=function(){this._dontNotify=!1},v._syncBatchingScheme=function(){this._defines.USE_INSTANCING=!1,this._batchingScheme=dG.NONE},v._onStateChange=function(){this._hash=dY.getPassHash(this),this._owner.onPassStateChange(this._dontNotify)},n(e,[{key:"parent",get:function(){return this._parent}}]),e}(dY),m0=function(g){function e(v){var S;return(S=g.call(this)||this)._passes=[],S._parent=void 0,S._owner=void 0,S._subModelIdx=0,S._parent=v.parent,S._owner=v.owner||null,S._subModelIdx=v.subModelIdx||0,S.copy(S._parent),S}s(e,g);var v=e.prototype;return v.recompileShaders=function(g,v){if(this._passes&&this.effectAsset){if(void 0===v)for(var S,O=f(this._passes);!(S=O()).done;)S.value.tryCompile(g);else this._passes[v].tryCompile(g)}},v.overridePipelineStates=function(g,v){if(this._passes&&this.effectAsset){var S=this.effectAsset.techniques[this.technique].passes;if(void 0===v)for(var O=0;O<this._passes.length;O++){var X=this._passes[O],Y=this._states[O]||(this._states[O]={});for(var te in g)Y[te]=g[te];X.overridePipelineStates(S[X.passIndex],Y)}else{var ti=this._states[v]||(this._states[v]={});for(var tr in g)ti[tr]=g[tr];this._passes[v].overridePipelineStates(S[v],ti)}}},v.destroy=function(){return this._doDestroy(),!0},v.onPassStateChange=function(g){this._hash=pf.getHash(this),!g&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},v._createPasses=function(){var g=[],v=this._parent.passes;if(!v)return g;for(var S=0;S<v.length;++S)g.push(new mQ(v[S],this));return g},n(e,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),e}(pf),m1=null,m2=null,m3=re({HEMISPHERE_DIFFUSE:0,AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION:1,DIFFUSEMAP_WITH_REFLECTION:2}),m4=function(){function t1(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1,this._editableMaterial=null,this._activated=!1,this._reflectionHDR=null,this._reflectionLDR=null,this._rotationAngle=0}var g=t1.prototype;return g.initialize=function(g){this._activated=!1,this._enabled=g.enabled,this._useIBL=g.useIBL,this._useDiffuseMap=g.applyDiffuseMap,this._useHDR=g.useHDR},g.setEnvMaps=function(g,v){this._envmapHDR=g,this._envmapLDR=v,this._updateGlobalBinding(),this._updatePipeline()},g.setDiffuseMaps=function(g,v){this._diffuseMapHDR=g,this._diffuseMapLDR=v,this._updateGlobalBinding(),this._updatePipeline()},g.setSkyboxMaterial=function(g){g?(this._editableMaterial=new m0({parent:g}),this._editableMaterial.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})):this._editableMaterial=null,this._updatePipeline()},g.setReflectionMaps=function(g,v){this._reflectionHDR=g,this._reflectionLDR=v,this._updateGlobalBinding(),this._updatePipeline()},g.setRotationAngle=function(g){this._rotationAngle=g},g.getRotationAngle=function(){return this._rotationAngle},g.updateMaterialRenderInfo=function(){this._updateGlobalBinding(),this._updatePipeline()},g.activate=function(){var g=X.director.root.pipeline;this._globalDSManager=g.globalDSManager,this._default=dU.get("default-cube-texture"),this._model||(this._model=X.director.root.createModel(X.renderer.scene.Model));var v=this._default.isRGBE;if(this._default.isUsingOfflineMipmaps(),this.envmap&&(v=this.envmap.isRGBE,this.envmap.isUsingOfflineMipmaps()),!m2){var S=new pf;S.initialize({effectName:"pipeline/skybox",defines:{USE_RGBE_CUBEMAP:v}}),m2=new m0({parent:S})}this.enabled&&(m1||(m1=X.utils.createMesh(X.primitives.box({width:2,height:2,length:2}))),this._editableMaterial?this._model.initSubModel(0,m1.renderingSubMeshes[0],this._editableMaterial):this._model.initSubModel(0,m1.renderingSubMeshes[0],m2)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline(),this._activated=!0},g._updatePipeline=function(){var g=X.director.root,v=g.pipeline,S=this.useIBL?this.isRGBE?2:1:0,O=this.useIBL&&this.useDiffuseMap&&this.diffuseMap&&this.diffuseMap!==this._default?this.isRGBE?2:1:0,Y=this.useHDR,te=this.useConvolutionMap;if(v.macros.CC_USE_IBL===S&&v.macros.CC_USE_DIFFUSEMAP===O&&v.macros.CC_USE_HDR===Y&&v.macros.CC_IBL_CONVOLUTED===te||(v.macros.CC_USE_IBL=S,v.macros.CC_USE_DIFFUSEMAP=O,v.macros.CC_USE_HDR=Y,v.macros.CC_IBL_CONVOLUTED=te,this._activated&&g.onGlobalPipelineStateChanged()),this.enabled){var ti=this.envmap?this.envmap:this._default,tr=this._editableMaterial?this._editableMaterial:m2;tr&&(tr.setProperty("environmentMap",ti),tr.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE})),this._model&&(this._model.setSubModelMaterial(0,tr),this._updateSubModes())}},g._updateGlobalBinding=function(){if(this._globalDSManager){var g=uZ.gfxDevice;if(this.reflectionMap){var v=this.reflectionMap.getGFXTexture(),S=g.getSampler(this.reflectionMap.getSamplerInfo());this._globalDSManager.bindSampler(_w,S),this._globalDSManager.bindTexture(_w,v)}else{var O=this.envmap?this.envmap:this._default;if(O){var X=O.getGFXTexture(),Y=g.getSampler(O.getSamplerInfo());this._globalDSManager.bindSampler(_w,Y),this._globalDSManager.bindTexture(_w,X)}}var te=this.diffuseMap?this.diffuseMap:this._default;if(te){var ti=te.getGFXTexture(),tr=g.getSampler(te.getSamplerInfo());this._globalDSManager.bindSampler(_D,tr),this._globalDSManager.bindTexture(_D,ti)}this._globalDSManager.update()}},g._updateSubModes=function(){if(this._model)for(var g=this._model.subModels,v=0;v<g.length;v++)g[v].update()},n(t1,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g,g?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(g){this._useHDR=g,this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(g){this._useIBL=g,this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(g){this._useDiffuseMap=g,this._updatePipeline()}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"useConvolutionMap",get:function(){return this.reflectionMap?this.reflectionMap.isUsingOfflineMipmaps():!!this.envmap&&this.envmap.isUsingOfflineMipmaps()}},{key:"envmap",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this.setEnvMaps(g,this._envmapLDR):this.setEnvMaps(this._envmapHDR,g)}},{key:"diffuseMap",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this.setDiffuseMaps(g,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,g)}},{key:"reflectionMap",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR:this._reflectionLDR}},{key:"editableMaterial",get:function(){return this._editableMaterial}}]),t1}();X.Skybox=m4;var m8=new e7,m6=re({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),m7=m6.LAYERED+1,m9=function(){function t1(){this._fogColor=new is("#C8C8C8"),this._colorArray=new e7(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2,this._activated=!1}var g=t1.prototype;return g.initialize=function(g){this._activated=!1,this.fogColor=g.fogColor,this._enabled=g.enabled,this._type=this.enabled?g.type:m7,this._accurate=g.accurate,this.fogDensity=g.fogDensity,this.fogStart=g.fogStart,this.fogEnd=g.fogEnd,this.fogAtten=g.fogAtten,this.fogTop=g.fogTop,this.fogRange=g.fogRange},g.activate=function(){this._updatePipeline(),this._activated=!0},g._updatePipeline=function(){var g=X.director.root,v=this.enabled?this.type:m7,S=this.accurate?1:0,O=g.pipeline;O.macros.CC_USE_FOG===v&&O.macros.CC_USE_ACCURATE_FOG===S||(O.macros.CC_USE_FOG=v,O.macros.CC_USE_ACCURATE_FOG=S,this._activated&&g.onGlobalPipelineStateChanged())},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g,g?this.activate():(this._type=m7,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(g){this._accurate=g,this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(g){this._fogColor.set(g),m8.set(g.x,g.y,g.z,g.w),lS(this._colorArray,m8)}},{key:"type",get:function(){return this._type},set:function(g){this._type=this.enabled?g:m7,this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(g){this._fogDensity=g}},{key:"fogStart",get:function(){return this._fogStart},set:function(g){this._fogStart=g}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(g){this._fogEnd=g}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(g){this._fogAtten=g}},{key:"fogTop",get:function(){return this._fogTop},set:function(g){this._fogTop=g}},{key:"fogRange",get:function(){return this._fogRange},set:function(g){this._fogRange=g}},{key:"colorArray",get:function(){return this._colorArray}}]),t1}();X.Fog=m9;var ge,gn,gr,gs,ga,gh,gu,gl,g_,gf,gd,gm,gg,gv,gy,gS,gT,gE,gC,gx,gb,gI,gB,gP,gD,gM,gO,gL,gN,gk,gG,gV,gU,gH,gz,gW,gj,gq,gY,gK,gJ,gZ,gQ,g1,g2,g3,g4,g8,g6,g7,g9,ve,vr,vs,va,vh,vu,vl,vc,vf,vd,vg,vv,vy,vS,vA,vT,vE,vC,vx,vb,vI,vB,vP,vD,vM,vO,vL,vN,vk,vG,vV,vU,vH,vz,vW,vX,vj,vq,vY,vK,vJ,vZ,vQ,v1,v2,v3,v4,v8,v6,v7,v9,yr,ys,ya,yh,yu,yc,y_,yf,yd,yg,yv,yy,yS,yA,yT,yE,yC,yx,yb,yw,yI,yB,yP,yD,yM,yO,yL,yF,yN=re({DEFAULT:0,LINEAR:1}),yk=function(){function t1(){this._toneMappingType=yN.DEFAULT,this._activated=!1}var g=t1.prototype;return g.initialize=function(g){this._toneMappingType=g.toneMappingType},g.activate=function(){this._updatePipeline(),this._activated=!0},g._updatePipeline=function(){var g=X.director.root;g.pipeline.macros.CC_TONE_MAPPING_TYPE=this._toneMappingType,this._activated&&g.onGlobalPipelineStateChanged()},n(t1,[{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(g){this._toneMappingType=g,this._updatePipeline()}}]),t1}(),yG=new eL(0,1,0),yV=new eL,yU=new e7,yH=new is,yz=new eW,ub=function(g){var v=1/Math.max(Math.max(Math.max(g.x,g.y),g.z),1e-4);v<1&&(g.x*=v,g.y*=v,g.z*=v)},yW=g("dq",(ge=nJ("cc.AmbientInfo"),gn=ma(ee),gr=Ys("_skyColor"),gs=Ys("_skyIllum"),ga=Ys("_groundAlbedo"),ge((p((gu=function(){function t1(){this._skyColorHDR=gl&&gl(),this._skyIllumHDR=g_&&g_(),this._groundAlbedoHDR=gf&&gf(),this._skyColorLDR=gd&&gd(),this._skyIllumLDR=gm&&gm(),this._groundAlbedoLDR=gg&&gg(),this._resource=null}return t1.prototype.activate=function(g){this._resource=g,this._resource.initialize(this)},n(t1,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var g=X.director.root.pipeline.pipelineSceneData.isHDR;return yU.set(g?this._skyColorHDR:this._skyColorLDR),ub(yU),yH.set(255*yU.x,255*yU.y,255*yU.z,255)},set:function(g){yU.set(g.x,g.y,g.z,g.w),X.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(yU):this._skyColorLDR.set(yU),this._resource&&this._resource.skyColor.set(yU)}},{key:"skyColor",set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(g):this._skyColorLDR.set(g),this._resource&&this._resource.skyColor.set(g)}},{key:"skyIllum",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=g:this._skyIllumLDR=g,this._resource&&(this._resource.skyIllum=g)}},{key:"groundLightingColor",get:function(){var g=X.director.root.pipeline.pipelineSceneData.isHDR;return yU.set(g?this._groundAlbedoHDR:this._groundAlbedoLDR),ub(yU),yH.set(255*yU.x,255*yU.y,255*yU.z,255)},set:function(g){yU.set(g.x,g.y,g.z,g.w),X.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(yU):this._groundAlbedoLDR.set(yU),this._resource&&this._resource.groundAlbedo.set(yU)}},{key:"groundAlbedo",set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(g):this._groundAlbedoLDR.set(g),this._resource&&this._resource.groundAlbedo.set(g)}}]),t1}()).prototype,"skyIllum",[gn],Object.getOwnPropertyDescriptor(gu.prototype,"skyIllum"),gu.prototype),gl=ws(gu.prototype,"_skyColorHDR",[n2,gr],function(){return new e7(.2,.5,.8,1)}),g_=ws(gu.prototype,"_skyIllumHDR",[n2,gs],function(){return mZ.SKY_ILLUM}),gf=ws(gu.prototype,"_groundAlbedoHDR",[n2,ga],function(){return new e7(.2,.2,.2,1)}),gd=ws(gu.prototype,"_skyColorLDR",[n2],function(){return new e7(.2,.5,.8,1)}),gm=ws(gu.prototype,"_skyIllumLDR",[n2],function(){return mZ.SKY_ILLUM}),gg=ws(gu.prototype,"_groundAlbedoLDR",[n2],function(){return new e7(.2,.2,.2,1)}),gh=gu))||gh));X.AmbientInfo=yW;var yX=g("dr",(gv=nJ("cc.SkyboxInfo"),gy=ma(m3),gS=ma(f8),gT=ma(ee),gE=ma(f8),gC=ma(f8),gx=ma(pf),gb=ma(f8),gI=Ys("_envmap"),gB=ma(f8),gP=ma(f8),gD=ma(f8),gM=ma(pf),gO=ma(f8),gL=ma(f8),gv((p((gk=function(){function t1(){this._envLightingType=gG&&gG(),this._envmapHDR=gV&&gV(),this._envmapLDR=gU&&gU(),this._diffuseMapHDR=gH&&gH(),this._diffuseMapLDR=gz&&gz(),this._enabled=gW&&gW(),this._useHDR=gj&&gj(),this._editableMaterial=gq&&gq(),this._reflectionHDR=gY&&gY(),this._reflectionLDR=gK&&gK(),this._rotationAngle=gJ&&gJ(),this._resource=null}var g=t1.prototype;return g.activate=function(g){this.envLightingType=this._envLightingType,this._resource=g,this._resource.initialize(this),this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.setSkyboxMaterial(this._editableMaterial),this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),this._resource.setRotationAngle(this._rotationAngle),this._resource.activate()},g.updateEnvMap=function(g){g||(this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=m3.HEMISPHERE_DIFFUSE,q(15001)),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),this._resource.useDiffuseMap=this.applyDiffuseMap,this._resource.envmap=g)},g.setMaterialProperty=function(g,v,S){this._resource&&this._resource.enabled&&this._resource.editableMaterial&&(this._resource.editableMaterial.setProperty(g,v,S),this._resource.editableMaterial.passes.forEach(function(g){g.update()}))},n(t1,[{key:"applyDiffuseMap",get:function(){return m3.DIFFUSEMAP_WITH_REFLECTION===this._envLightingType},set:function(g){this._resource&&(this._resource.useDiffuseMap=g)}},{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled!==g&&(this._enabled=g,this._resource&&(this._resource.enabled=this._enabled))}},{key:"envLightingType",get:function(){return this._envLightingType},set:function(g){this.envmap||m3.HEMISPHERE_DIFFUSE===g?(m3.HEMISPHERE_DIFFUSE===g?(this.useIBL=!1,this.applyDiffuseMap=!1):m3.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION===g?(this.useIBL=!0,this.applyDiffuseMap=!1):m3.DIFFUSEMAP_WITH_REFLECTION===g&&(this.useIBL=!0,this.applyDiffuseMap=!0),this._envLightingType=g):(this.useIBL=!1,this.applyDiffuseMap=!1,this._envLightingType=m3.HEMISPHERE_DIFFUSE,q(15001))}},{key:"useIBL",get:function(){return m3.HEMISPHERE_DIFFUSE!==this._envLightingType},set:function(g){this._resource&&(this._resource.useIBL=g)}},{key:"useHDR",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR=this._useHDR,this._useHDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR=g,this._useHDR=g,this._resource&&this.envLightingType===m3.DIFFUSEMAP_WITH_REFLECTION&&(null===this.diffuseMap?(this.envLightingType=m3.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION,q(15e3)):this.diffuseMap.isDefault&&q(15002)),this._resource&&(this._resource.useHDR=this._useHDR,this._resource.updateMaterialRenderInfo())}},{key:"envmap",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(g){var v=X.director.root.pipeline.pipelineSceneData.isHDR;v?(this._envmapHDR=g,this._reflectionHDR=null):(this._envmapLDR=g,this._reflectionLDR=null),g||(v?this._diffuseMapHDR=null:this._diffuseMapLDR=null,this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=m3.HEMISPHERE_DIFFUSE,q(15001)),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR),this._resource.useDiffuseMap=this.applyDiffuseMap,this._resource.envmap=g)}},{key:"rotationAngle",get:function(){return this._rotationAngle},set:function(g){this._rotationAngle=g,this._resource&&this._resource.setRotationAngle(this._rotationAngle)}},{key:"diffuseMap",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR=g:this._diffuseMapLDR=g,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}},{key:"reflectionMap",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR:this._reflectionLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this._reflectionHDR=g:this._reflectionLDR=g,this._resource&&this._resource.setReflectionMaps(this._reflectionHDR,this._reflectionLDR)}},{key:"skyboxMaterial",get:function(){return this._editableMaterial},set:function(g){this._editableMaterial=g,this._resource&&this._resource.setSkyboxMaterial(this._editableMaterial)}}]),t1}()).prototype,"envLightingType",[gy],Object.getOwnPropertyDescriptor(gk.prototype,"envLightingType"),gk.prototype),p(gk.prototype,"envmap",[gS],Object.getOwnPropertyDescriptor(gk.prototype,"envmap"),gk.prototype),p(gk.prototype,"rotationAngle",[gT],Object.getOwnPropertyDescriptor(gk.prototype,"rotationAngle"),gk.prototype),p(gk.prototype,"diffuseMap",[gE],Object.getOwnPropertyDescriptor(gk.prototype,"diffuseMap"),gk.prototype),p(gk.prototype,"reflectionMap",[gC],Object.getOwnPropertyDescriptor(gk.prototype,"reflectionMap"),gk.prototype),p(gk.prototype,"skyboxMaterial",[gx],Object.getOwnPropertyDescriptor(gk.prototype,"skyboxMaterial"),gk.prototype),gG=ws(gk.prototype,"_envLightingType",[n2],function(){return m3.HEMISPHERE_DIFFUSE}),gV=ws(gk.prototype,"_envmapHDR",[n2,gb,gI],function(){return null}),gU=ws(gk.prototype,"_envmapLDR",[n2,gB],function(){return null}),gH=ws(gk.prototype,"_diffuseMapHDR",[n2,gP],function(){return null}),gz=ws(gk.prototype,"_diffuseMapLDR",[n2,gD],function(){return null}),gW=ws(gk.prototype,"_enabled",[n2],function(){return!1}),gj=ws(gk.prototype,"_useHDR",[n2],function(){return!0}),gq=ws(gk.prototype,"_editableMaterial",[n2,gM],function(){return null}),gY=ws(gk.prototype,"_reflectionHDR",[n2,gO],function(){return null}),gK=ws(gk.prototype,"_reflectionLDR",[n2,gL],function(){return null}),gJ=ws(gk.prototype,"_rotationAngle",[n2],function(){return 0}),gN=gk))||gN));X.SkyboxInfo=yX;var yj=g("ds",(gZ=nJ("cc.FogInfo"),gQ=ma(m6),g1=ma(ee),g2=ma(ee),g3=ma(ee),g4=ma(ee),g8=ma(ee),g6=ma(ee),gZ(((vg=function(){function t1(){this._type=ve&&ve(),this._fogColor=vr&&vr(),this._enabled=vs&&vs(),this._fogDensity=va&&va(),this._fogStart=vh&&vh(),this._fogEnd=vu&&vu(),this._fogAtten=vl&&vl(),this._fogTop=vc&&vc(),this._fogRange=vf&&vf(),this._accurate=vd&&vd(),this._resource=null}return t1.prototype.activate=function(g){this._resource=g,this._resource.initialize(this),this._resource.activate()},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled!==g&&(this._enabled=g,this._resource&&(this._resource.enabled=g,g&&(this._resource.type=this._type)))}},{key:"accurate",get:function(){return this._accurate},set:function(g){this._accurate!==g&&(this._accurate=g,this._resource&&(this._resource.accurate=g,g&&(this._resource.type=this._type)))}},{key:"fogColor",get:function(){return this._fogColor},set:function(g){this._fogColor.set(g),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(g){this._type=g,this._resource&&(this._resource.type=g)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(g){this._fogDensity=g,this._resource&&(this._resource.fogDensity=g)}},{key:"fogStart",get:function(){return this._fogStart},set:function(g){this._fogStart=g,this._resource&&(this._resource.fogStart=g)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(g){this._fogEnd=g,this._resource&&(this._resource.fogEnd=g)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(g){this._fogAtten=g,this._resource&&(this._resource.fogAtten=g)}},{key:"fogTop",get:function(){return this._fogTop},set:function(g){this._fogTop=g,this._resource&&(this._resource.fogTop=g)}},{key:"fogRange",get:function(){return this._fogRange},set:function(g){this._fogRange=g,this._resource&&(this._resource.fogRange=g)}}]),t1}()).FogType=m6,p((g9=vg).prototype,"type",[gQ],Object.getOwnPropertyDescriptor(g9.prototype,"type"),g9.prototype),p(g9.prototype,"fogDensity",[g1],Object.getOwnPropertyDescriptor(g9.prototype,"fogDensity"),g9.prototype),p(g9.prototype,"fogStart",[g2],Object.getOwnPropertyDescriptor(g9.prototype,"fogStart"),g9.prototype),p(g9.prototype,"fogEnd",[g3],Object.getOwnPropertyDescriptor(g9.prototype,"fogEnd"),g9.prototype),p(g9.prototype,"fogAtten",[g4],Object.getOwnPropertyDescriptor(g9.prototype,"fogAtten"),g9.prototype),p(g9.prototype,"fogTop",[g8],Object.getOwnPropertyDescriptor(g9.prototype,"fogTop"),g9.prototype),p(g9.prototype,"fogRange",[g6],Object.getOwnPropertyDescriptor(g9.prototype,"fogRange"),g9.prototype),ve=ws(g9.prototype,"_type",[n2],function(){return m6.LINEAR}),vr=ws(g9.prototype,"_fogColor",[n2],function(){return new is("#C8C8C8")}),vs=ws(g9.prototype,"_enabled",[n2],function(){return!1}),va=ws(g9.prototype,"_fogDensity",[n2],function(){return .3}),vh=ws(g9.prototype,"_fogStart",[n2],function(){return .5}),vu=ws(g9.prototype,"_fogEnd",[n2],function(){return 300}),vl=ws(g9.prototype,"_fogAtten",[n2],function(){return 5}),vc=ws(g9.prototype,"_fogTop",[n2],function(){return 1.5}),vf=ws(g9.prototype,"_fogRange",[n2],function(){return 1.2}),vd=ws(g9.prototype,"_accurate",[n2],function(){return!1}),g7=g9))||g7)),yq=g("dt",(vv=nJ("cc.ShadowsInfo"),vy=ma(px),vS=ma(ee),vA=ma(ee),vT=ma(t9),vE=ma(pC),vv((p((vx=function(){function t1(){this._enabled=vb&&vb(),this._type=vI&&vI(),this._normal=vB&&vB(),this._distance=vP&&vP(),this._planeBias=vD&&vD(),this._shadowColor=vM&&vM(),this._maxReceived=vO&&vO(),this._size=vL&&vL(),this._resource=null}var g=t1.prototype;return g.setPlaneFromNode=function(g){g.getWorldRotation(yz),this.planeDirection=eL.transformQuat(yV,yG,yz),g.getWorldPosition(yV),this.planeHeight=eL.dot(this._normal,yV)},g.activate=function(g){this._resource=g,this._resource.initialize(this),this._resource.activate()},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled!==g&&(this._enabled=g,this._resource&&(this._resource.enabled=g,g&&(this._resource.type=this._type)))}},{key:"type",get:function(){return this._type},set:function(g){this._type=g,this._resource&&(this._resource.type=g)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(g){this._shadowColor.set(g),this._resource&&(this._resource.shadowColor=g)}},{key:"planeDirection",get:function(){return this._normal},set:function(g){eL.copy(this._normal,g),this._resource&&(this._resource.normal=g)}},{key:"planeHeight",get:function(){return this._distance},set:function(g){this._distance=g,this._resource&&(this._resource.distance=g)}},{key:"planeBias",get:function(){return this._planeBias},set:function(g){this._planeBias=g,this._resource&&(this._resource.planeBias=g)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(g){this._maxReceived=g,this._resource&&(this._resource.maxReceived=g)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(g){this._size.set(g,g),this._resource&&(this._resource.size.set(g,g),this._resource.shadowMapDirty=!0)}}]),t1}()).prototype,"type",[vy],Object.getOwnPropertyDescriptor(vx.prototype,"type"),vx.prototype),p(vx.prototype,"planeHeight",[vS],Object.getOwnPropertyDescriptor(vx.prototype,"planeHeight"),vx.prototype),p(vx.prototype,"planeBias",[vA],Object.getOwnPropertyDescriptor(vx.prototype,"planeBias"),vx.prototype),p(vx.prototype,"maxReceived",[vT],Object.getOwnPropertyDescriptor(vx.prototype,"maxReceived"),vx.prototype),p(vx.prototype,"shadowMapSize",[vE],Object.getOwnPropertyDescriptor(vx.prototype,"shadowMapSize"),vx.prototype),vb=ws(vx.prototype,"_enabled",[n2],function(){return!1}),vI=ws(vx.prototype,"_type",[n2],function(){return px.Planar}),vB=ws(vx.prototype,"_normal",[n2],function(){return new eL(0,1,0)}),vP=ws(vx.prototype,"_distance",[n2],function(){return 0}),vD=ws(vx.prototype,"_planeBias",[n2],function(){return 1}),vM=ws(vx.prototype,"_shadowColor",[n2],function(){return new is(0,0,0,76)}),vO=ws(vx.prototype,"_maxReceived",[n2],function(){return 4}),vL=ws(vx.prototype,"_size",[n2],function(){return new e8(1024,1024)}),vC=vx))||vC));X.ShadowsInfo=yq;var yY=g("du",new eL(-1024,-1024,-1024)),yK=g("dv",new eL(1024,1024,1024)),yZ=g("dw",8),yQ=g("dx",(vN=nJ("cc.OctreeInfo"),vk=ma(t9),vN((p((vV=function(){function t1(){this._enabled=vU&&vU(),this._minPos=vH&&vH(),this._maxPos=vz&&vz(),this._depth=vW&&vW(),this._resource=null}return t1.prototype.activate=function(g){this._resource=g,this._resource.initialize(this)},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled!==g&&(this._enabled=g,this._resource&&(this._resource.enabled=g))}},{key:"minPos",get:function(){return this._minPos},set:function(g){this._minPos=g,this._resource&&(this._resource.minPos=g)}},{key:"maxPos",get:function(){return this._maxPos},set:function(g){this._maxPos=g,this._resource&&(this._resource.maxPos=g)}},{key:"depth",get:function(){return this._depth},set:function(g){this._depth=g,this._resource&&(this._resource.depth=g)}}]),t1}()).prototype,"depth",[vk],Object.getOwnPropertyDescriptor(vV.prototype,"depth"),vV.prototype),vU=ws(vV.prototype,"_enabled",[n2],function(){return!1}),vH=ws(vV.prototype,"_minPos",[n2],function(){return new eL(yY)}),vz=ws(vV.prototype,"_maxPos",[n2],function(){return new eL(yK)}),vW=ws(vV.prototype,"_depth",[n2],function(){return yZ}),vG=vV))||vG));X.OctreeInfo=yQ;var y$=g("dy",(vX=nJ("cc.SkinInfo"),vj=ma(ee),vq=ma(ee),vX((p((vK=function(){function t1(){this._enabled=vJ&&vJ(),this._blurRadius=vZ&&vZ(),this._sssIntensity=vQ&&vQ(),this._resource=null}return t1.prototype.activate=function(g){this._resource=g,this._resource.initialize(this)},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled!==g&&(this._enabled=g,this._resource&&(this._resource.enabled=g))}},{key:"blurRadius",get:function(){return this._blurRadius},set:function(g){this._blurRadius=g,this._resource&&(this._resource.blurRadius=g)}},{key:"sssIntensity",get:function(){return this._sssIntensity},set:function(g){this._sssIntensity=g,this._resource&&(this._resource.sssIntensity=g)}}]),t1}()).prototype,"blurRadius",[vj],Object.getOwnPropertyDescriptor(vK.prototype,"blurRadius"),vK.prototype),p(vK.prototype,"sssIntensity",[vq],Object.getOwnPropertyDescriptor(vK.prototype,"sssIntensity"),vK.prototype),vJ=ws(vK.prototype,"_enabled",[n2],function(){return!0}),vZ=ws(vK.prototype,"_blurRadius",[n2],function(){return .01}),vQ=ws(vK.prototype,"_sssIntensity",[n2],function(){return 3}),vY=vK))||vY));X.SkinInfo=y$;var y0=g("dz",(v1=nJ("cc.PostSettingsInfo"),v2=ma(yN),v1((p((v4=function(){function t1(){this._toneMappingType=v8&&v8(),this._resource=null}return t1.prototype.activate=function(g){this._resource=g,this._resource.initialize(this),this._resource.activate()},n(t1,[{key:"toneMappingType",get:function(){return this._toneMappingType},set:function(g){this._toneMappingType=g,this._resource&&(this._resource.toneMappingType=g)}}]),t1}()).prototype,"toneMappingType",[v2],Object.getOwnPropertyDescriptor(v4.prototype,"toneMappingType"),v4.prototype),v8=ws(v4.prototype,"_toneMappingType",[n2],function(){return yN.DEFAULT}),v3=v4))||v3));X.PostSettingsInfo=y0;var y1,y2,y3,y4,y8,y6,y7,y9,Sn,Sa,Sh,Sc,S_,Sf,Sd,Sg,Sv,Sy,SS,SA,ST,SE,SC,Sx,Sb,SR,Sw,SI,SB,SP,SD,SM,SO,SL,SF,SN,Sk,SG,SV,SU,SH,Sz,SW,SX,Sj,Sq,SY,SZ,SQ,S$,S0,S1,S2,S3,S4,S8,S6,S7,S9,Ar,As,Aa,Ah,Au,Ac,A_,Af,Ad,Ag,Av=g("dA",(v6=nJ("cc.LightProbeInfo"),v7=ma(ee),v9=ma(t9),yr=ma(t9),ys=ma(ee),ya=ma(ee),v6((p((yu=function(){function t1(){this._giScale=yc&&yc(),this._giSamples=y_&&y_(),this._bounces=yf&&yf(),this._reduceRinging=yd&&yd(),this._showProbe=yg&&yg(),this._showWireframe=yv&&yv(),this._showConvex=yy&&yy(),this._data=yS&&yS(),this._lightProbeSphereVolume=yA&&yA(),this._nodes=[],this._scene=null,this._resource=null}var g=t1.prototype;return g.activate=function(g,v){this._scene=g,this._resource=v,this._resource.initialize(this)},g.onProbeBakeFinished=function(){this.onProbeBakingChanged(this._scene)},g.onProbeBakeCleared=function(){this.clearSHCoefficients(),this.onProbeBakingChanged(this._scene)},g.onProbeBakingChanged=function(g){if(g){g.emit(md.LIGHT_PROBE_BAKING_CHANGED);for(var v=0;v<g.children.length;v++){var S=g.children[v];this.onProbeBakingChanged(S)}}},g.clearSHCoefficients=function(){if(this._data){for(var g=this._data.probes,v=0;v<g.length;v++)g[v].coefficients.length=0;this.clearAllSHUBOs()}},g.isUniqueNode=function(){return 1===this._nodes.length},g.addNode=function(g){if(!g)return!1;for(var v=0;v<this._nodes.length;v++)if(this._nodes[v].node===g)return!1;return this._nodes.push({node:g,probes:null}),!0},g.removeNode=function(g){if(!g)return!1;var v=this._nodes.findIndex(function(v){return v.node===g});return -1!==v&&(this._nodes.splice(v,1),!0)},g.syncData=function(g,v){for(var S=0;S<this._nodes.length;S++)if(this._nodes[S].node===g)return void(this._nodes[S].probes=v)},g.update=function(g){if(void 0===g&&(g=!0),X.internal.LightProbesData){this._data||(this._data=new X.internal.LightProbesData,this._resource&&(this._resource.data=this._data));for(var v=[],S=0;S<this._nodes.length;S++){var O=this._nodes[S].node,Y=this._nodes[S].probes,te=O.worldPosition;if(Y)for(var ti=0;ti<Y.length;ti++){var tr=new eL(0,0,0);eL.add(tr,Y[ti],te),v.push(tr)}}if(v.length<4)return this.resetAllTetraIndices(),void this._data.reset();this._data.updateProbes(v),g&&(this.resetAllTetraIndices(),this._data.updateTetrahedrons())}},g.clearAllSHUBOs=function(){if(this._scene){var g=this._scene.renderScene;if(g)for(var v=g.models,S=0;S<v.length;S++)v[S].clearSHUBOs()}},g.resetAllTetraIndices=function(){if(this._scene){var g=this._scene.renderScene;if(g)for(var v=g.models,S=0;S<v.length;S++)v[S].tetrahedronIndex=-1}},n(t1,[{key:"giScale",get:function(){return this._giScale},set:function(g){this._giScale!==g&&(this._giScale=g,this._resource&&(this._resource.giScale=g))}},{key:"giSamples",get:function(){return this._giSamples},set:function(g){this._giSamples!==g&&(this._giSamples=g,this._resource&&(this._resource.giSamples=g))}},{key:"bounces",get:function(){return this._bounces},set:function(g){this._bounces!==g&&(this._bounces=g,this._resource&&(this._resource.bounces=g))}},{key:"reduceRinging",get:function(){return this._reduceRinging},set:function(g){this._reduceRinging!==g&&(this._reduceRinging=g,this._resource&&(this._resource.reduceRinging=g))}},{key:"showProbe",get:function(){return this._showProbe},set:function(g){this._showProbe!==g&&(this._showProbe=g,this._resource&&(this._resource.showProbe=g))}},{key:"showWireframe",get:function(){return this._showWireframe},set:function(g){this._showWireframe!==g&&(this._showWireframe=g,this._resource&&(this._resource.showWireframe=g))}},{key:"showConvex",get:function(){return this._showConvex},set:function(g){this._showConvex!==g&&(this._showConvex=g,this._resource&&(this._resource.showConvex=g))}},{key:"data",get:function(){return this._data},set:function(g){this._data!==g&&(this._data=g,this._resource&&(this._resource.data=g))}},{key:"lightProbeSphereVolume",get:function(){return this._lightProbeSphereVolume},set:function(g){this._lightProbeSphereVolume!==g&&(this._lightProbeSphereVolume=g,this._resource&&(this._resource.lightProbeSphereVolume=g))}}]),t1}()).prototype,"giScale",[v7],Object.getOwnPropertyDescriptor(yu.prototype,"giScale"),yu.prototype),p(yu.prototype,"giSamples",[v9],Object.getOwnPropertyDescriptor(yu.prototype,"giSamples"),yu.prototype),p(yu.prototype,"bounces",[yr],Object.getOwnPropertyDescriptor(yu.prototype,"bounces"),yu.prototype),p(yu.prototype,"reduceRinging",[ys],Object.getOwnPropertyDescriptor(yu.prototype,"reduceRinging"),yu.prototype),p(yu.prototype,"lightProbeSphereVolume",[ya],Object.getOwnPropertyDescriptor(yu.prototype,"lightProbeSphereVolume"),yu.prototype),yc=ws(yu.prototype,"_giScale",[n2],function(){return 1}),y_=ws(yu.prototype,"_giSamples",[n2],function(){return 1024}),yf=ws(yu.prototype,"_bounces",[n2],function(){return 2}),yd=ws(yu.prototype,"_reduceRinging",[n2],function(){return 0}),yg=ws(yu.prototype,"_showProbe",[n2],function(){return!0}),yv=ws(yu.prototype,"_showWireframe",[n2],function(){return!0}),yy=ws(yu.prototype,"_showConvex",[n2],function(){return!1}),yS=ws(yu.prototype,"_data",[n2],function(){return null}),yA=ws(yu.prototype,"_lightProbeSphereVolume",[n2],function(){return 1}),yh=yu))||yh)),Ay=g("dB",(yT=nJ("cc.SceneGlobals"),yE=ma(yX),yT((yx=function(){function t1(){this.ambient=yb&&yb(),this.shadows=yw&&yw(),this._skybox=yI&&yI(),this.fog=yB&&yB(),this.octree=yP&&yP(),this.skin=yD&&yD(),this.lightProbeInfo=yM&&yM(),this.postSettings=yO&&yO(),this.bakedWithStationaryMainLight=yL&&yL(),this.bakedWithHighpLightmap=yF&&yF(),this.disableLightmap=!1}return t1.prototype.activate=function(g){var v=X.director.root.pipeline.pipelineSceneData;this.skybox.activate(v.skybox),this.ambient.activate(v.ambient),this.shadows.activate(v.shadows),this.fog.activate(v.fog),this.octree.activate(v.octree),this.skin.activate(v.skin),this.postSettings.activate(v.postSettings),this.lightProbeInfo&&v.lightProbes&&this.lightProbeInfo.activate(g,v.lightProbes),X.director.root.onGlobalPipelineStateChanged()},n(t1,[{key:"skybox",get:function(){return this._skybox},set:function(g){this._skybox=g}}]),t1}(),yb=ws(yx.prototype,"ambient",[n2],function(){return new yW}),yw=ws(yx.prototype,"shadows",[n2],function(){return new yq}),yI=ws(yx.prototype,"_skybox",[n2],function(){return new yX}),yB=ws(yx.prototype,"fog",[n2],function(){return new yj}),p(yx.prototype,"skybox",[yE],Object.getOwnPropertyDescriptor(yx.prototype,"skybox"),yx.prototype),yP=ws(yx.prototype,"octree",[n2],function(){return new yQ}),yD=ws(yx.prototype,"skin",[n2],function(){return new y$}),yM=ws(yx.prototype,"lightProbeInfo",[n2],function(){return new Av}),yO=ws(yx.prototype,"postSettings",[n2],function(){return new y0}),yL=ws(yx.prototype,"bakedWithStationaryMainLight",[n2],function(){return!1}),yF=ws(yx.prototype,"bakedWithHighpLightmap",[n2],function(){return!1}),yC=yx))||yC));X.SceneGlobals=Ay;var AA=(y1=nJ("cc.TargetInfo"),y2=ma([er]),y1((y4=function(){this.localID=y8&&y8()},y8=ws(y4.prototype,"localID",[n2,y2],function(){return[]}),y3=y4))||y3),AT=(y6=nJ("cc.TargetOverrideInfo"),y7=ma(rG),y9=ma(AA),Sn=ma([er]),Sa=ma(mJ),Sh=ma(AA),y6((S_=function(){this.source=Sf&&Sf(),this.sourceInfo=Sd&&Sd(),this.propertyPath=Sg&&Sg(),this.target=Sv&&Sv(),this.targetInfo=Sy&&Sy()},Sf=ws(S_.prototype,"source",[n2,y7],function(){return null}),Sd=ws(S_.prototype,"sourceInfo",[n2,y9],function(){return null}),Sg=ws(S_.prototype,"propertyPath",[n2,Sn],function(){return[]}),Sv=ws(S_.prototype,"target",[n2,Sa],function(){return null}),Sy=ws(S_.prototype,"targetInfo",[n2,Sh],function(){return null}),Sc=S_))||Sc),AE=nJ("cc.CompPrefabInfo")((SA=function(){this.fileId=ST&&ST()},ST=ws(SA.prototype,"fileId",[n2],function(){return""}),SS=SA))||SS,AC=(SE=nJ("CCPropertyOverrideInfo"),SC=ma(AA),Sx=ma([er]),SE((SR=function(){function t1(){this.targetInfo=Sw&&Sw(),this.propertyPath=SI&&SI(),this.value=SB&&SB()}return t1.prototype.isTarget=function(){},t1}(),Sw=ws(SR.prototype,"targetInfo",[n2,SC],function(){return null}),SI=ws(SR.prototype,"propertyPath",[n2,Sx],function(){return[]}),SB=ws(SR.prototype,"value",[n2],null),Sb=SR))||Sb),Ax=(SP=nJ("cc.MountedChildrenInfo"),SD=ma(AA),SM=ma([mJ]),SP((SL=function(){function t1(){this.targetInfo=SF&&SF(),this.nodes=SN&&SN()}return t1.prototype.isTarget=function(){},t1}(),SF=ws(SL.prototype,"targetInfo",[n2,SD],function(){return null}),SN=ws(SL.prototype,"nodes",[n2,SM],function(){return[]}),SO=SL))||SO),Ab=(Sk=nJ("cc.MountedComponentsInfo"),SG=ma(AA),SV=ma([cS]),Sk((SH=function(){function t1(){this.targetInfo=Sz&&Sz(),this.components=SW&&SW()}return t1.prototype.isTarget=function(){},t1}(),Sz=ws(SH.prototype,"targetInfo",[n2,SG],function(){return null}),SW=ws(SH.prototype,"components",[n2,SV],function(){return[]}),SU=SH))||SU),AR=(SX=nJ("cc.PrefabInstance"),Sj=ma(mJ),Sq=ma([Ax]),SY=ma([Ab]),SZ=ma([AC]),SQ=ma([AA]),SX((S0=function(){function t1(){this.fileId=S1&&S1(),this.prefabRootNode=S2&&S2(),this.mountedChildren=S3&&S3(),this.mountedComponents=S4&&S4(),this.propertyOverrides=S8&&S8(),this.removedComponents=S6&&S6(),this.targetMap={},this.expanded=!1}var g=t1.prototype;return g.findPropertyOverride=function(){},g.removePropertyOverride=function(){},t1}(),S1=ws(S0.prototype,"fileId",[n2],function(){return""}),S2=ws(S0.prototype,"prefabRootNode",[n2,Sj],null),S3=ws(S0.prototype,"mountedChildren",[n2,Sq],function(){return[]}),S4=ws(S0.prototype,"mountedComponents",[n2,SY],function(){return[]}),S8=ws(S0.prototype,"propertyOverrides",[n2,SZ],function(){return[]}),S6=ws(S0.prototype,"removedComponents",[n2,SQ],function(){return[]}),S$=S0))||S$),Aw=(S7=nJ("cc.PrefabInfo"),S9=ma(mJ),Ar=ma(AR),As=ma([AT]),S7((Ah=function(){this.root=Au&&Au(),this.asset=Ac&&Ac(),this.fileId=A_&&A_(),this.instance=Af&&Af(),this.targetOverrides=Ad&&Ad(),this.nestedPrefabInstanceRoots=Ag&&Ag()},Au=ws(Ah.prototype,"root",[n2,S9],null),Ac=ws(Ah.prototype,"asset",[n2],null),A_=ws(Ah.prototype,"fileId",[n2],function(){return""}),Af=ws(Ah.prototype,"instance",[n2,Ar],null),Ad=ws(Ah.prototype,"targetOverrides",[n2,As],null),Ag=ws(Ah.prototype,"nestedPrefabInstanceRoots",[n2],null),Aa=Ah))||Aa);function Xx(g){var v=null==g?void 0:g.prefab;if(v&&v.instance){if(!v.asset)return J(3701,g.name),void(v.instance=void 0);var S=g._objFlags,O=g.getParent(),Y=g.uuid;g[rC],X.game._isCloning=!0,v.asset._doInstantiate(g),X.game._isCloning=!1,g._objFlags=S,g.modifyParent(O),g.id=Y,g.prefab&&(g.prefab.instance=v.instance)}}function jx(g,v,S){var O;if(v&&g){var X=v,Y=null===(O=g.prefab)||void 0===O?void 0:O.instance;!S&&Y&&(v[Y.fileId]={},X=v[Y.fileId]);var te=g.prefab;te&&(X[te.fileId]=g);for(var ti=g.components,tr=0;tr<ti.length;tr++){var ta=ti[tr];ta.__prefab&&(X[ta.__prefab.fileId]=ta)}for(var th=0;th<g.children.length;th++)jx(g.children[th],X,!1)}}function Yx(g,v){if(!g)return null;for(var S=v,O=0;O<g.length;O++){if(!S)return null;S=S[g[O]]}return S}function qx(g,v,S){if(v)for(var O=0;O<v.length;O++){var X=v[O];if(X&&X.targetInfo){var Y=Yx(X.targetInfo.localID,S);if(!Y)continue;var te=S,ti=X.targetInfo.localID;if(ti.length>0)for(var tr=0;tr<ti.length-1;tr++)te=te[ti[tr]];if(X.nodes)for(var ta=0;ta<X.nodes.length;ta++){var th=X.nodes[ta];th&&!Y.children.includes(th)&&(Y.children.push(th),th.modifyParent(Y),jx(th,te,!1),th.siblingIndex=Y.children.length-1,$x(th,!0))}}}}function Kx(g,v,S){if(v)for(var O=0;O<v.length;O++){var X=v[O];if(X&&X.targetInfo){var Y=Yx(X.targetInfo.localID,S);if(!Y)continue;if(X.components)for(var te=0;te<X.components.length;te++){var ti=X.components[te];ti&&(ti.node=Y,Y.getWritableComponents().push(ti))}}}}function Jx(g,v,S){if(v)for(var O=0;O<v.length;O++){var X=v[O];if(X){var Y=Yx(X.localID,S);if(!Y||!Y.node)continue;var te=Y.node.components.indexOf(Y);te>=0&&Y.node.getWritableComponents().splice(te,1)}}}function Qx(g,v,S){if(!(v.length<=0))for(var O=null,X=0;X<v.length;X++){var Y=v[X];if(Y&&Y.targetInfo){if(!(O=Yx(Y.targetInfo.localID,S)))continue;var te=O,ti=Y.propertyPath.slice();if(ti.length>0){var tr=ti.pop();if(!tr)continue;for(var ta=0;ta<ti.length&&(te=te[ti[ta]]);ta++);if(!te)continue;if(Array.isArray(te)){if("length"===tr)te[tr]=Y.value;else{var th=Number.parseInt(tr);Number.isInteger(th)&&th<te.length&&(te[tr]=Y.value)}}else _instanceof(te[tr],tq)?te[tr].set(Y.value):te[tr]=Y.value}}}}function Zx(g){var v,S=null===(v=g.prefab)||void 0===v?void 0:v.targetOverrides;if(S)for(var O=0;O<S.length;O++){var X,Y=S[O],te=Y.source,ti=Y.sourceInfo;if(ti){var tr,ta=Y.source,th=null==ta||null===(tr=ta.prefab)||void 0===tr?void 0:tr.instance;th&&th.targetMap&&(te=Yx(ti.localID,th.targetMap))}if(te){var tu,tl=Y.targetInfo;if(tl){var tc=Y.target,t_=null==tc||null===(X=tc.prefab)||void 0===X?void 0:X.instance;if(t_&&t_.targetMap&&(tu=Yx(tl.localID,t_.targetMap))){var tf=Y.propertyPath.slice(),tp=te;if(tf.length>0){var tm=tf.pop();if(!tm)return;for(var tg=0;tg<tf.length&&(tp=tp[tf[tg]]);tg++);if(!tp)continue;tp[tm]=tu}}}}}}function $x(g,v){var S;void 0===v&&(v=!1);var O=null==g||null===(S=g.prefab)||void 0===S?void 0:S.instance;if(O&&!O.expanded){Xx(g),v&&g&&g.children&&g.children.forEach(function(g){$x(g,!0)});var X={};O.targetMap=X,jx(g,X,!0),qx(0,O.mountedChildren,X),Jx(0,O.removedComponents,X),Kx(0,O.mountedComponents,X),Qx(0,O.propertyOverrides,X),O.expanded=!0}else v&&g&&g.children&&g.children.forEach(function(g){$x(g,!0)})}function tR(g){var v=g.prefab;v&&v.nestedPrefabInstanceRoots&&v.nestedPrefabInstanceRoots.forEach(function(g){$x(g)})}X._PrefabInfo=Aw;var AI,AB,AP,AD,AM,AO,AL,AF=Object.freeze({__proto__:null,createNodeWithPrefab:Xx,generateTargetMap:jx,getTarget:Yx,applyMountedChildren:qx,applyMountedComponents:Kx,applyRemovedComponents:Jx,applyPropertyOverrides:Qx,applyTargetOverrides:Zx,expandPrefabInstanceNode:$x,expandNestedPrefabInstanceNode:tR,applyNodeAndComponentId:function t1(g,v){for(var S=g.components,O=g.children,X=0;X<S.length;X++){var Y,te,ti=S[X],tr=null!==(Y=null===(te=ti.__prefab)||void 0===te?void 0:te.fileId)&&void 0!==Y?Y:"";ti._id=""+v+tr}for(var ta=0;ta<O.length;ta++){var th=O[ta],tu=th.prefab,tl=null!=tu&&tu.instance?tu.instance.fileId:null==tu?void 0:tu.fileId;tl&&(th.id=""+v+tl,null!=tu&&tu.instance||t1(th,v))}},TargetInfo:AA,TargetOverrideInfo:AT,CompPrefabInfo:AE,PropertyOverrideInfo:AC,MountedChildrenInfo:Ax,MountedComponentsInfo:Ab,PrefabInstance:AR,PrefabInfo:Aw}),AN=g("de",nJ("cc.Scene")((AB=function(g){s(i,g);var v=i.prototype;function i(v){var S;return(S=g.call(this,v)||this).autoReleaseAssets=AP&&AP(),S._globals=AD&&AD(),S.dependAssets=null,S._renderScene=null,S._inited=void 0,S._prefabSyncedInLiveReload=!1,S._activeInHierarchy=!1,X.director&&X.director.root&&(S._renderScene=X.director.root.createScene({})),S._inited=!X.game||!X.game._isCloning,S}return v._updateScene=function(){this._scene=this},v.destroy=function(){var g=rG.prototype.destroy.call(this);if(g)for(var v=this._children,S=0;S<v.length;++S)v[S].active=!1;return this._renderScene&&X.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,g},v.addComponent=function(){throw new Error(tt(3822))},v._onHierarchyChanged=function(){},v._onPostActivated=function(){},v._onBatchCreated=function(g){for(var v=this._children.length,S=0;S<v;++S)this._children[S]._siblingIndex=S,this._children[S]._onBatchCreated(g)},v.updateWorldTransform=function(){},v._instantiate=function(){},v._load=function(){this._inited||(tR(this),Zx(this),this._onBatchCreated(S),this._inited=!0),this.walk(mJ._setScene)},v._activate=function(g){void 0===g&&(g=!0),X.director._nodeActivator.activateNode(this,g),this._globals.activate(this)},n(i,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}}]),i}(mJ),AP=ws(AB.prototype,"autoReleaseAssets",[n2],function(){return!1}),AD=ws(AB.prototype,"_globals",[n2],function(){return new Ay}),AI=AB))||AI);X.Scene=AN;var Ak=g("dR",nJ("cc.SceneAsset")((AO=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).scene=AL&&AL(),v}s(e,g);var v=e.prototype;return v.initDefault=function(v){g.prototype.initDefault.call(this,v),this.scene=new AN("New Scene")},v.validate=function(){return!!this.scene},e}(lx),AL=ws(AO.prototype,"scene",[n2],function(){return null}),AM=AO))||AM);X.SceneAsset=Ak;var AG,AV=g("d7",function(){function t1(){this._singleMode=0,this._compositeModeValue=0,this._lightingWithAlbedo=!0,this._csmLayerColoration=!1,this._activate()}var g=t1.prototype;return g.isCompositeModeEnabled=function(g){return 0!=(this._compositeModeValue&1<<g)},g.enableCompositeMode=function(g,v){this._enableCompositeMode(g,v),this._updatePipeline()},g.enableAllCompositeMode=function(g){this._enableAllCompositeMode(g),this._updatePipeline()},g.isEnabled=function(){return 0!==this._getType()},g.reset=function(){this._activate(),this._updatePipeline()},g._activate=function(){this._singleMode=0,this._enableAllCompositeMode(!0),this._lightingWithAlbedo=!0,this._csmLayerColoration=!1},g._updatePipeline=function(){var g=X.director.root,v=g.pipeline,S=this._getType();v.macros.CC_USE_DEBUG_VIEW!==S&&(v.macros.CC_USE_DEBUG_VIEW=S,g.onGlobalPipelineStateChanged())},g._enableCompositeMode=function(g,v){v?this._compositeModeValue|=1<<g:this._compositeModeValue&=~(1<<g)},g._enableAllCompositeMode=function(g){for(var v=0;v<17;v++)g?this._compositeModeValue|=1<<v:this._compositeModeValue&=~(1<<v)},g._getType=function(){if(0!==this._singleMode)return 1;if(!0!==this._lightingWithAlbedo||!1!==this._csmLayerColoration)return 2;for(var g=0;g<17;g++)if(!this.isCompositeModeEnabled(g))return 2;return 0},n(t1,[{key:"singleMode",get:function(){return this._singleMode},set:function(g){this._singleMode=g,this._updatePipeline()}},{key:"lightingWithAlbedo",get:function(){return this._lightingWithAlbedo},set:function(g){this._lightingWithAlbedo=g,this._updatePipeline()}},{key:"csmLayerColoration",get:function(){return this._csmLayerColoration},set:function(g){this._csmLayerColoration=g,this._updatePipeline()}},{key:"debugViewType",get:function(){return this._getType()}}]),t1}()),AU=new iK(0,0,0,.5,.5,.5),AH=new iK;function pR(g,v){var S=g.pipelineSceneData,O=S.validPunctualLights;O.length=0;for(var X=iH.create(0,0,0,1),Y=v.scene.spotLights,te=0;te<Y.length;te++){var ti=Y[te];ti.baked&&!v.node.scene.globals.disableLightmap||(iH.set(X,ti.position.x,ti.position.y,ti.position.z,ti.range),nF.sphereFrustum(X,v.frustum)&&O.push(ti))}for(var tr=v.scene.sphereLights,ta=0;ta<tr.length;ta++){var th=tr[ta];th.baked&&!v.node.scene.globals.disableLightmap||(iH.set(X,th.position.x,th.position.y,th.position.z,th.range),nF.sphereFrustum(X,v.frustum)&&O.push(th))}for(var tu=v.scene.pointLights,tl=0;tl<tu.length;tl++){var tc=tu[tl];tc.baked||(iH.set(X,tc.position.x,tc.position.y,tc.position.z,tc.range),nF.sphereFrustum(X,v.frustum)&&O.push(tc))}for(var t_=v.scene.rangedDirLights,tf=0;tf<t_.length;tf++){var tp=t_[tf];iK.transform(AH,AU,tp.node.getWorldMatrix()),nF.aabbFrustum(AH,v.frustum)&&O.push(tp)}S.validPunctualLights=O}!function(g){g[g.NONE=0]="NONE",g[g.FXAA=1]="FXAA",g[g.FXAAHQ=2]="FXAAHQ"}(AG||(AG={}));var Az=[];function gR(g){return Az.includes(g)||Az.push(g),Az.indexOf(g)}function vR(g,v){var S=oH.CLEAR;return g&o7.COLOR||v!==mt.RENDER_TARGET||(S=g&pA?oH.CLEAR:oH.LOAD),(g&o7.DEPTH_STENCIL)!==o7.DEPTH_STENCIL&&v===mt.DEPTH_STENCIL&&(g&o7.DEPTH||(S=oH.LOAD),g&o7.STENCIL||(S=oH.LOAD)),S}function yR(g,v,S,O,Y,te){void 0===O&&(O=null),void 0===Y&&(Y=0),void 0===te&&(te=void 0),te=te||new hl;var ti=g?g.viewport:new hl(0,0,1,1),tr=v,ta=S;if(te.x=ti.x*tr,te.y=ti.y*ta,te.width=ti.width*tr,te.height=ti.height*ta,O)switch(O.type){case pJ.DIRECTIONAL:var th=O;if(th.shadowFixedArea||th.csmLevel===pw.LEVEL_1)te.x=0,te.y=0,te.width=tr,te.height=ta;else{var tu=X.director.root.device.capabilities.screenSpaceSignY;te.x=Y%2*.5*tr,te.y=tu>0?.5*(1-Math.floor(Y/2))*ta:.5*Math.floor(Y/2)*ta,te.width=.5*tr,te.height=.5*ta}break;case pJ.SPOT:te.x=0,te.y=0,te.width=tr,te.height=ta}return te}var AW=function(){function t1(g){void 0===g&&(g=AG.NONE),this.antiAliasing=AG.NONE,this.antiAliasing=g,this._init()}return t1.prototype._init=function(){this.postMaterial=new pf,this.postMaterial.name="builtin-post-process-material",this.postMaterial.initialize({effectName:"pipeline/post-process",defines:{ANTIALIAS_TYPE:this.antiAliasing}});for(var g=0;g<this.postMaterial.passes.length;++g)this.postMaterial.passes[g].tryCompile()},t1}(),AX=function(){function t1(){this.shadowEnabled=!1,this.mainLightShadowNames=new Array,this.spotLightShadowNames=new Array,this.validLights=[]}return t1.prototype.reset=function(){this.shadowEnabled=!1,this.mainLightShadowNames.length=0,this.spotLightShadowNames.length=0,this.validLights.length=0},t1}();new AX;var Aj=function(){function t1(g){this.enableCluster=void 0,this.enableCluster=g?1:0,this._init()}return t1.prototype._init=function(){this.deferredLightingMaterial=new pf,this.deferredLightingMaterial.name="builtin-deferred-material",this.deferredLightingMaterial.initialize({effectName:"pipeline/deferred-lighting",defines:{CC_ENABLE_CLUSTERED_LIGHT_CULLING:this.enableCluster,CC_RECEIVE_SHADOW:1}});for(var g=0;g<this.deferredLightingMaterial.passes.length;++g)this.deferredLightingMaterial.passes[g].tryCompile()},t1}();function ER(g,v){for(var S,O=f(v.descriptorSetLayoutData.descriptorBlocks);!(S=O()).done;)for(var X=S.value,Y=0;Y!==X.descriptors.length;++Y)if(g===X.descriptors[Y].descriptorID)return X.offset+Y;return -1}function CR(g){for(var v,S=X.director.root.pipeline.layoutGraph,O=S.vertices(),Y=S.attributeIndex.get(g),te=f(O);!(v=te()).done;)for(var ti,tr=v.value,ta=f(S.getLayout(tr).descriptorSets);!(ti=ta()).done;){var th=ti.value;th[0];for(var tu,tl=th[1],tc=f(tl.descriptorSetLayoutData.descriptorBlocks);!(tu=tc()).done;)for(var t_,tf=f(tu.value.descriptors);!(t_=tf()).done;)if(t_.value.descriptorID===Y)return ER(Y,tl)}return -1}var Aq=new Map;function xR(g){var v=Aq.get(g);if(v)return v;var S=X.director.root.pipeline,O=S.layoutGraph.locateChild(S.layoutGraph.nullVertex(),g);V(0xffffffff!==O);var Y=S.layoutGraph.getLayout(O).descriptorSets.get(p0.PER_PASS);return Aq.set(g,Y),Y}var AK=[.0484,.187,.567,1.99,7.41],AZ=[.1,.118,.113,.358,.078],AQ=new eL,A$=new eL,A0=new e7,A1=new e7;!function(){var g=e.prototype;function e(){this.ssssFov=45/57.3,this.ssssWidth=.01,this.boundingBox=.4,this.ssssScale=3,this._v3SSSSStrength=new eL(.48,.41,.28),this._v3SSSSFallOff=new eL(1,.37,.3),this._kernel=[],this._init()}g._gaussian=function(g,v,S){var O=S/(.001+this._v3SSSSFallOff.x);g.x=Math.exp(-O*O/(2*v))/(6.28*v);var X=S/(.001+this._v3SSSSFallOff.y);g.y=Math.exp(-X*X/(2*v))/(6.28*v);var Y=S/(.001+this._v3SSSSFallOff.z);g.z=Math.exp(-Y*Y/(2*v))/(6.28*v)},g._profile=function(g,v){for(var S=0;S<5;S++)this._gaussian(A$,AK[S],v),A$.multiplyScalar(AZ[S]),g.add(A$)},g._updateSampleCount=function(){for(var g=this._v3SSSSStrength,v=0;v<25;v++){var S=.25*v-3,O=S<0?-1:1;this._kernel[v].w=3*O*Math.abs(Math.pow(S,2))/Math.pow(3,2)}for(var X=0;X<25;X++){var Y=((X>0?Math.abs(this._kernel[X].w-this._kernel[X-1].w):0)+(X<24?Math.abs(this._kernel[X].w-this._kernel[X+1].w):0))/2;AQ.set(0),this._profile(AQ,this._kernel[X].w),AQ.multiplyScalar(Y),this._kernel[X].x=AQ.x,this._kernel[X].y=AQ.y,this._kernel[X].z=AQ.z}A0.set(this._kernel[12]);for(var te=12;te>0;te--)A1.set(this._kernel[te-1]),this._kernel[te].set(A1);this._kernel[0].set(A0),AQ.set(0);for(var ti=0;ti<25;ti++)AQ.add3f(this._kernel[ti].x,this._kernel[ti].y,this._kernel[ti].z);for(var tr=0;tr<25;tr++)this._kernel[tr].x/=AQ.x,this._kernel[tr].y/=AQ.y,this._kernel[tr].z/=AQ.z;this._kernel[0].x=1*(1-g.x)+g.x*this._kernel[0].x,this._kernel[0].y=1*(1-g.y)+g.y*this._kernel[0].y,this._kernel[0].z=1*(1-g.z)+g.z*this._kernel[0].z;for(var ta=1;ta<25;ta++)this._kernel[ta].x*=g.x,this._kernel[ta].y*=g.y,this._kernel[ta].z*=g.z},g._updateBlurPass=function(){if(this.ssssBlurMaterial){var g=this.ssssBlurMaterial.passes[0];g.beginChangeStatesSilently(),g.tryCompile(),g.endChangeStatesSilently();var v=this.ssssBlurMaterial.passes[1];v.beginChangeStatesSilently(),v.tryCompile(),v.endChangeStatesSilently();var S=this.ssssBlurMaterial.passes[2];S.beginChangeStatesSilently(),S.tryCompile(),S.endChangeStatesSilently()}},g._init=function(){if(!this.ssssBlurMaterial){this.ssssBlurMaterial=new pf,this.ssssBlurMaterial._uuid="builtin-ssssBlur-material",this.ssssBlurMaterial.initialize({effectName:"pipeline/ssss-blur"});for(var g=0;g<this.ssssBlurMaterial.passes.length;++g)this.ssssBlurMaterial.passes[g].tryCompile();this._updateBlurPass();for(var v=0;v<25;v++)this._kernel[v]=new e7;this._updateSampleCount()}},n(e,[{key:"ssssStrength",get:function(){return this._v3SSSSStrength},set:function(g){this._v3SSSSStrength=g,this._updateSampleCount()}},{key:"ssssFallOff",get:function(){return this._v3SSSSFallOff},set:function(g){this._v3SSSSFallOff=g,this._updateSampleCount()}},{key:"kernel",get:function(){return this._kernel}}])}(),function(){var g=e.prototype;function e(){this._uvDepthToEyePosParams=new e7,this._radiusParam=new e7,this._miscParam=new e7,this._blurParam=new e7,this._depthTexFullResolution=new e8(1024),this._depthTexResolution=new e8(1024),this._sceneScale=1,this._cameraFov=yi(45),this._radiusScale=1,this._angleBiasDegree=10,this._aoStrength=1,this._blurSharpness=8,this._aoSaturation=1,this._randomDirAndJitter=[238,91,87,255,251,44,119,255,247,64,250,255,232,5,225,255,253,177,140,255,250,51,84,255,243,76,97,255,252,36,232,255,235,100,24,255,252,36,158,255,254,20,142,255,245,135,124,255,251,43,121,255,253,31,145,255,235,98,160,255,240,146,198,255],this._init(),this.update()}g._init=function(){if(!this.hbaoMaterial){this.hbaoMaterial=new pf,this.hbaoMaterial.name="builtin-hbao-material",this.hbaoMaterial.initialize({effectName:"pipeline/post-process/hbao"});for(var g=0;g<this.hbaoMaterial.passes.length;++g)this.hbaoMaterial.passes[g].tryCompile();for(var v=cK.PixelFormat.RGBA8888,S=new Uint8Array(64),O=0;O<this._randomDirAndJitter.length;O++)S[O]=this._randomDirAndJitter[O];var X=new lX({width:4,height:4,_data:S,_compressed:!1,format:v});this.randomTexture=new cK,this.randomTexture.setFilters(cK.Filter.NEAREST,cK.Filter.NEAREST),this.randomTexture.setMipFilter(cK.Filter.NONE),this.randomTexture.setWrapMode(cK.WrapMode.REPEAT,cK.WrapMode.REPEAT,cK.WrapMode.REPEAT),this.randomTexture.image=X,this.hbaoMaterial.setProperty("RandomTex",this.randomTexture,0)}},g.update=function(){var g=this._radiusScale*this._sceneScale,v=g*g,S=-1/v,O=.1*Math.min(this._depthTexFullResolution.x,this._depthTexFullResolution.y);this._radiusParam.set(g,v,S,O);var X=new e8(this._depthTexResolution.y/this._depthTexResolution.x,1),Y=new e8(X.x/Math.tan(.5*this._cameraFov),X.y/Math.tan(.5*this._cameraFov)),te=Math.tan(yi(this._angleBiasDegree)),ti=this._aoStrength;this._miscParam.set(Y.x,Y.y,te,ti);var tr=new e8(2/Y.x,-2/Y.y),ta=new e8(-1/Y.x,1/Y.y);this._uvDepthToEyePosParams.set(tr.x,tr.y,ta.x,ta.y);var th=this._sceneScale/this._blurSharpness*1.6651092;this._blurParam.set(.11541560320000001,th,this._blurSharpness/8,this._aoSaturation)},n(e,[{key:"uvDepthToEyePosParams",get:function(){return this._uvDepthToEyePosParams}},{key:"radiusParam",get:function(){return this._radiusParam}},{key:"miscParam",get:function(){return this._miscParam}},{key:"blurParam",get:function(){return this._blurParam}},{key:"depthTexFullResolution",set:function(g){this._depthTexFullResolution.set(g)}},{key:"depthTexResolution",set:function(g){this._depthTexResolution.set(g)}},{key:"sceneScale",set:function(g){this._sceneScale=g}},{key:"cameraFov",set:function(g){this._cameraFov=g}},{key:"radiusScale",set:function(g){this._radiusScale=g}},{key:"angleBiasDegree",set:function(g){this._angleBiasDegree=g}},{key:"aoStrength",set:function(g){this._aoStrength=g}},{key:"blurSharpness",set:function(g){this._blurSharpness=g}},{key:"aoSaturation",set:function(g){this._aoSaturation=g}}])}(),new e8;var A2=function(){var g=e.prototype;function e(){this.clusters_x_threads=16,this.clusters_y_threads=8,this.clusters_z_threads=1,this.dispatchX=1,this.dispatchY=1,this.dispatchZ=1,this._init()}return g._initMaterial=function(g,v){var S=new pf;S.name=g,S.initialize({effectName:v});for(var O=0;O<S.passes.length;++O)S.passes[O].tryCompile();return S},g._init=function(){this.clusterBuildCS=this._initMaterial("builtin-cluster-build-cs-material","pipeline/cluster-build"),this.clusterLightCullingCS=this._initMaterial("builtin-cluster-culling-cs-material","pipeline/cluster-culling"),this.dispatchX=16/this.clusters_x_threads,this.dispatchY=8/this.clusters_y_threads,this.dispatchZ=24/this.clusters_z_threads},e}(),A3=null;function LR(g,v){!function(g,v){pR(v,g);var S=v.pipelineSceneData,O=80*wi(Math.max(S.validPunctualLights.length,1)),X=gR(g),Y="clusterLightBuffer"+X,te="globalIndexBuffer"+X,ti=v;ti.containsResource(te)||ti.addStorageBuffer(te,oA.UNKNOWN,4,p2.PERSISTENT),ti.containsResource(Y)||ti.addStorageBuffer(Y,oA.UNKNOWN,O,p2.PERSISTENT),ti.updateStorageBuffer(Y,O);var tr=function(g,v,S,O){for(var X,Y=new ArrayBuffer(g),te=new Float32Array(Y),ti=O.pipelineSceneData,tr=S.exposure,ta=0,th=f(ti.validPunctualLights);!(X=th()).done;){var tu=X.value,tl=20*ta,tc=tl+0,t_=tl+4,tf=tl+8,tp=tl+12,tm=tl+16,tg=0,tv=0,ty=void 0;if(tu.type===pJ.POINT){var tS=tu;ty=tS.position,tv=tS.luminanceLDR,tg=tS.luminanceHDR,te[tf]=0,te[tf+1]=tS.range,te[tf+2]=0,te[tf+3]=0}else if(tu.type===pJ.SPHERE){var tA=tu;ty=tA.position,tv=tA.luminanceLDR,tg=tA.luminanceHDR,te[tf]=tA.size,te[tf+1]=tA.range,te[tf+2]=0,te[tf+3]=0}else if(tu.type===pJ.SPOT){var tT=tu;ty=tT.position,tv=tT.luminanceLDR,tg=tT.luminanceHDR,te[tf]=tT.size,te[tf+1]=tT.range,te[tf+2]=tT.spotAngle,te[tf+3]=0;var tE=tT.direction;te[tp]=tE.x,te[tp+1]=tE.y,te[tp+2]=tE.z,te[tp+3]=0}else if(tu.type===pJ.RANGED_DIRECTIONAL){var tC=tu;ty=tC.position,tv=tC.illuminanceLDR,tg=tC.illuminanceHDR;var tx=tC.right;te[tf]=tx.x,te[tf+1]=tx.y,te[tf+2]=tx.z,te[tf+3]=0;var tb=tC.direction;te[tp]=tb.x,te[tp+1]=tb.y,te[tp+2]=tb.z,te[tp+3]=0;var tw=tC.scale;te[tm]=.5*tw.x,te[tm+1]=.5*tw.y,te[tm+2]=.5*tw.z,te[tm+3]=0}te[tc]=ty.x,te[tc+1]=ty.y,te[tc+2]=ty.z,te[tc+3]=tu.type;var tI=tu.color;if(tu.useColorTemperature){var tB=tu.colorTemperatureRGB;te[t_]=tI.x*tB.x,te[t_+1]=tI.y*tB.y,te[t_+2]=tI.z*tB.z}else te[t_]=tI.x,te[t_+1]=tI.y,te[t_+2]=tI.z;te[t_+3]=ti.isHDR?tg*tr*1e4:tv,ta++}return te[15]=ti.validPunctualLights.length,Y}(O,0,g,v),ta=new ArrayBuffer(4);new Uint32Array(ta)[0]=0;var th=new mc(new Uint8Array(tr),Y),tu=new mc(new Uint8Array(ta),te);ti.addUploadPass([th,tu])}(g,v);var S=v;A3||(A3=new A2),function(g,v,S){var O="clusterBuffer"+gR(g);S.containsResource(O)||S.addStorageBuffer(O,oA.UNKNOWN,98304,p2.MANAGED),S.updateStorageBuffer(O,98304);var X=S.addComputePass("cluster-build-cs");X.addStorageBuffer(O,me.WRITE,"b_clustersBuffer"),X.addQueue().addDispatch(v.dispatchX,v.dispatchY,v.dispatchZ,v.clusterBuildCS,0);var Y=g.width*S.pipelineSceneData.shadingScale,te=g.height*S.pipelineSceneData.shadingScale;"setCurrConstant"in X&&X.addConstant("CCConst","cluster-build-cs"),X.setVec4("cc_nearFar",new e7(g.nearClip,g.farClip,g.getClipSpaceMinz(),0)),X.setVec4("cc_viewPort",new e7(0,0,Y,te)),X.setVec4("cc_workGroup",new e7(16,8,24,0)),X.setMat4("cc_matView",g.matView),X.setMat4("cc_matProjInv",g.matProjInv)}(g,A3,S),function(g,v,S){var O=gR(g),X="clusterBuffer"+O,Y="clusterLightBuffer"+O,te="globalIndexBuffer"+O,ti="clusterLightIndicesBuffer"+O,tr="clusterLightGridBuffer"+O;S.containsResource(ti)||S.addStorageBuffer(ti,oA.UNKNOWN,2457600,p2.MANAGED),S.containsResource(tr)||S.addStorageBuffer(tr,oA.UNKNOWN,49152,p2.MANAGED);var ta=S.addComputePass("cluster-culling-cs");ta.addStorageBuffer(Y,me.READ,"b_ccLightsBuffer"),ta.addStorageBuffer(X,me.READ,"b_clustersBuffer"),ta.addStorageBuffer(ti,me.WRITE,"b_clusterLightIndicesBuffer"),ta.addStorageBuffer(tr,me.WRITE,"b_clusterLightGridBuffer"),ta.addStorageBuffer(te,me.WRITE,"b_globalIndexBuffer"),ta.addQueue().addDispatch(v.dispatchX,v.dispatchY,v.dispatchZ,v.clusterLightCullingCS,0);var th=g.width*S.pipelineSceneData.shadingScale,tu=g.height*S.pipelineSceneData.shadingScale;"setCurrConstant"in ta&&ta.addConstant("CCConst","cluster-build-cs"),ta.setVec4("cc_nearFar",new e7(g.nearClip,g.farClip,g.getClipSpaceMinz(),0)),ta.setVec4("cc_viewPort",new e7(th,tu,th,tu)),ta.setVec4("cc_workGroup",new e7(16,8,24,0)),ta.setMat4("cc_matView",g.matView),ta.setMat4("cc_matProjInv",g.matProjInv)}(g,A3,S)}var A5,A4,A8,A6,A7,A9=new hD(oO.LINEAR,oO.LINEAR,oO.NONE,oL.CLAMP,oL.CLAMP,oL.CLAMP),Tn=new hD(oO.POINT,oO.POINT,oO.NONE,oL.CLAMP,oL.CLAMP,oL.CLAMP),Tr=function(){function t1(g){this._device=void 0,this._descriptorSetMap=new Map,this._globalDescriptorSet=void 0,this._descriptorSetLayout=void 0,this._linearSampler=void 0,this._pointSampler=void 0,this._device=g,this._linearSampler=this._device.getSampler(A9),this._pointSampler=this._device.getSampler(Tn);var v=new h4(_d.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(v),this._globalDescriptorSet=this._device.createDescriptorSet(new h8(this._descriptorSetLayout))}var g=t1.prototype;return g.regenLayout=function(){var g=new h4(_d.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(g),this._globalDescriptorSet=this._device.createDescriptorSet(new h8(this._descriptorSetLayout))},g.bindBuffer=function(g,v){this._globalDescriptorSet.bindBuffer(g,v);for(var S=this._descriptorSetMap.values(),O=S.next();!O.done;)O.value.bindBuffer(g,v),O=S.next()},g.bindSampler=function(g,v){this._globalDescriptorSet.bindSampler(g,v);for(var S=this._descriptorSetMap.values(),O=S.next();!O.done;)O.value.bindSampler(g,v),O=S.next()},g.bindTexture=function(g,v){this._globalDescriptorSet.bindTexture(g,v);for(var S=this._descriptorSetMap.values(),O=S.next();!O.done;)O.value.bindTexture(g,v),O=S.next()},g.update=function(){this._globalDescriptorSet.update();for(var g=this._descriptorSetMap.values(),v=g.next();!v.done;)v.value.update(),v=g.next()},g.getOrCreateDescriptorSet=function(g){var v=this._device;if(!this._descriptorSetMap.has(g)){var S=Ug()?xR("default").descriptorSet:this._globalDescriptorSet,O=v.createDescriptorSet(new h8(Ug()?xR("default").descriptorSetLayout:this._descriptorSetLayout));this._descriptorSetMap.set(g,O);for(var X=_f.UBO_GLOBAL;X<_f.COUNT;X++)O.bindBuffer(X,S.getBuffer(X)),O.bindSampler(X,S.getSampler(X)),O.bindTexture(X,S.getTexture(X));var Y=v.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,Sm.SIZE,Sm.SIZE)),te=Ug()?CR("CCShadow"):Sm.BINDING;O.bindBuffer(te,Y),O.update()}return this._descriptorSetMap.get(g)},g.destroy=function(){this._descriptorSetLayout.destroy()},n(t1,[{key:"descriptorSetMap",get:function(){return this._descriptorSetMap}},{key:"linearSampler",get:function(){return this._linearSampler}},{key:"pointSampler",get:function(){return this._pointSampler}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"globalDescriptorSet",get:function(){return this._globalDescriptorSet},set:function(g){this._globalDescriptorSet=g}}]),t1}(),Ta=new e$,To=new e$,Th=new e$,Tu=new e7,Tl=new e7(0,0,1,0),Tc=new eL,T_=function(){function t1(){this._globalUBO=new Float32Array(vm.COUNT),this._cameraUBO=new Float32Array(ym.COUNT),this._shadowUBO=new Float32Array(Sm.COUNT),this._csmUBO=new Float32Array(Am.COUNT)}t1.updateGlobalUBOView=function(g,v){var S=X.director,O=S.root,Y=v,te=Math.floor(g.width),ti=Math.floor(g.height);Y[vm.TIME_OFFSET]=O.cumulativeTime,Y[vm.TIME_OFFSET+1]=O.frameTime,Y[vm.TIME_OFFSET+2]=S.getTotalFrames(),Y[vm.TIME_OFFSET+3]=O.cumulativeTime-Math.floor(O.frameTime),Y[vm.SCREEN_SIZE_OFFSET]=te,Y[vm.SCREEN_SIZE_OFFSET+1]=ti,Y[vm.SCREEN_SIZE_OFFSET+2]=1/te,Y[vm.SCREEN_SIZE_OFFSET+3]=1/ti,Y[vm.NATIVE_SIZE_OFFSET]=te,Y[vm.NATIVE_SIZE_OFFSET+1]=ti,Y[vm.NATIVE_SIZE_OFFSET+2]=1/Y[vm.NATIVE_SIZE_OFFSET],Y[vm.NATIVE_SIZE_OFFSET+3]=1/Y[vm.NATIVE_SIZE_OFFSET+1],X.internal.reflectionProbeManager&&(Y[vm.PROBE_INFO_OFFSET]=X.internal.reflectionProbeManager.getMaxProbeId()+1);for(var tr=O.debugView,ta=0;ta<=3;ta++)Y[vm.DEBUG_VIEW_MODE_OFFSET+ta]=0;if(tr.isEnabled()){Y[vm.DEBUG_VIEW_MODE_OFFSET]=tr.singleMode;for(var th=0;th<17;th++){var tu=th%8;Y[vm.DEBUG_VIEW_MODE_OFFSET+1+(th>>3)]+=(tr.isCompositeModeEnabled(th)?1:0)*Math.pow(10,tu)}Y[vm.DEBUG_VIEW_MODE_OFFSET+3]+=(tr.lightingWithAlbedo?1:0)*Math.pow(10,6),Y[vm.DEBUG_VIEW_MODE_OFFSET+3]+=(tr.csmLayerColoration?1:0)*Math.pow(10,7)}},t1.updateCameraUBOView=function(g,v,S){var O,Y=(S.scene?S.scene:X.director.getScene().renderScene).mainLight,te=g.pipelineSceneData,ti=te.ambient,tr=te.skybox,ta=te.fog,th=te.shadows,tu=v,tl=S.exposure,tc=te.isHDR;if(tu[ym.SCREEN_SCALE_OFFSET]=te.shadingScale,tu[ym.SCREEN_SCALE_OFFSET+1]=te.shadingScale,tu[ym.SCREEN_SCALE_OFFSET+2]=1/tu[ym.SCREEN_SCALE_OFFSET],tu[ym.SCREEN_SCALE_OFFSET+3]=1/tu[ym.SCREEN_SCALE_OFFSET+1],tu[ym.EXPOSURE_OFFSET]=tl,tu[ym.EXPOSURE_OFFSET+1]=1/tl,tu[ym.EXPOSURE_OFFSET+2]=tc?1:0,tu[ym.EXPOSURE_OFFSET+3]=1/pE.standardExposureValue,Y){var t_=Y.shadowEnabled&&th.type===px.ShadowMap?1:0,tf=Y.direction;if(Tl.set(tf.x,tf.y,tf.z,t_),e7.toArray(tu,Tl,ym.MAIN_LIT_DIR_OFFSET),eL.toArray(tu,Y.color,ym.MAIN_LIT_COLOR_OFFSET),Y.useColorTemperature){var tp=Y.colorTemperatureRGB;tu[ym.MAIN_LIT_COLOR_OFFSET]*=tp.x,tu[ym.MAIN_LIT_COLOR_OFFSET+1]*=tp.y,tu[ym.MAIN_LIT_COLOR_OFFSET+2]*=tp.z}tu[ym.MAIN_LIT_COLOR_OFFSET+3]=tc?Y.illuminance*tl:Y.illuminance}else Tl.set(0,0,1,0),e7.toArray(tu,Tl,ym.MAIN_LIT_DIR_OFFSET),e7.toArray(tu,e7.ZERO,ym.MAIN_LIT_COLOR_OFFSET);var tm=ti.skyColor;tm.w=tc?ti.skyIllum*tl:ti.skyIllum,tu[ym.AMBIENT_SKY_OFFSET+0]=tm.x,tu[ym.AMBIENT_SKY_OFFSET+1]=tm.y,tu[ym.AMBIENT_SKY_OFFSET+2]=tm.z,tu[ym.AMBIENT_SKY_OFFSET+3]=tm.w,tu[ym.AMBIENT_GROUND_OFFSET+0]=ti.groundAlbedo.x,tu[ym.AMBIENT_GROUND_OFFSET+1]=ti.groundAlbedo.y,tu[ym.AMBIENT_GROUND_OFFSET+2]=ti.groundAlbedo.z,tu[ym.AMBIENT_GROUND_OFFSET+3]=tr.envmap?null===(O=tr.envmap)||void 0===O?void 0:O.mipmapLevel:1,e$.toArray(tu,S.matView,ym.MAT_VIEW_OFFSET),e$.toArray(tu,S.node.worldMatrix,ym.MAT_VIEW_INV_OFFSET),eL.toArray(tu,S.position,ym.CAMERA_POS_OFFSET),e$.toArray(tu,S.matProj,ym.MAT_PROJ_OFFSET),e$.toArray(tu,S.matProjInv,ym.MAT_PROJ_INV_OFFSET),e$.toArray(tu,S.matViewProj,ym.MAT_VIEW_PROJ_OFFSET),e$.toArray(tu,S.matViewProjInv,ym.MAT_VIEW_PROJ_INV_OFFSET),tu[ym.CAMERA_POS_OFFSET+3]=this.getCombineSignY(),tu[ym.SURFACE_TRANSFORM_OFFSET]=S.surfaceTransform,tu[ym.SURFACE_TRANSFORM_OFFSET+1]=S.cameraUsage,tu[ym.SURFACE_TRANSFORM_OFFSET+2]=Math.cos(yi(te.skybox.getRotationAngle())),tu[ym.SURFACE_TRANSFORM_OFFSET+3]=Math.sin(yi(te.skybox.getRotationAngle()));var tg=ta.colorArray;tu[ym.GLOBAL_FOG_COLOR_OFFSET]=tg.x,tu[ym.GLOBAL_FOG_COLOR_OFFSET+1]=tg.y,tu[ym.GLOBAL_FOG_COLOR_OFFSET+2]=tg.z,tu[ym.GLOBAL_FOG_COLOR_OFFSET+3]=tg.z,tu[ym.GLOBAL_FOG_BASE_OFFSET]=ta.fogStart,tu[ym.GLOBAL_FOG_BASE_OFFSET+1]=ta.fogEnd,tu[ym.GLOBAL_FOG_BASE_OFFSET+2]=ta.fogDensity,tu[ym.GLOBAL_FOG_ADD_OFFSET]=ta.fogTop,tu[ym.GLOBAL_FOG_ADD_OFFSET+1]=ta.fogRange,tu[ym.GLOBAL_FOG_ADD_OFFSET+2]=ta.fogAtten,tu[ym.NEAR_FAR_OFFSET]=S.nearClip,tu[ym.NEAR_FAR_OFFSET+1]=S.farClip,tu[ym.NEAR_FAR_OFFSET+2]=S.getClipSpaceMinz(),tu[ym.VIEW_PORT_OFFSET]=te.shadingScale*S.window.width*S.viewport.x,tu[ym.VIEW_PORT_OFFSET+1]=te.shadingScale*S.window.height*S.viewport.y,tu[ym.VIEW_PORT_OFFSET+2]=te.shadingScale*S.window.width*S.viewport.z,tu[ym.VIEW_PORT_OFFSET+3]=te.shadingScale*S.window.height*S.viewport.w},t1.getPCFRadius=function(g,v){var S=g.size.x;switch(v.shadowPcf){case pb.HARD:break;case pb.SOFT:return 1/(.5*S);case pb.SOFT_2X:return 2/(.5*S);case pb.SOFT_4X:return 3/(.5*S)}return 0},t1.updatePlanarNormalAndDistance=function(g,v){eL.normalize(Tc,g.normal),v[Sm.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+0]=Tc.x,v[Sm.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+1]=Tc.y,v[Sm.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+2]=Tc.z,v[Sm.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+3]=-g.distance},t1.updateShadowUBOView=function(g,v,S,O){var X=g.device,Y=O.scene.mainLight,te=g.pipelineSceneData,ti=te.shadows,tr=te.csmLayers,ta=v,th=S,tu=te.csmSupported,tl=kg(X)?0:1;if(Y&&ti.enabled){if(ti.type===px.ShadowMap){if(Y.shadowEnabled){if(Y.shadowFixedArea||Y.csmLevel===pw.LEVEL_1||!tu){var tc=tr.specialLayer.matShadowView,t_=tr.specialLayer.matShadowProj,tf=tr.specialLayer.matShadowViewProj,tp=.1,tm=0,tg=0;Y.shadowFixedArea?(tp=Y.shadowNear,tm=Y.shadowFar,tg=0):(tm=tr.specialLayer.shadowCameraFar,tg=1),e$.toArray(ta,tc,Sm.MAT_LIGHT_VIEW_OFFSET),ta[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=t_.m10,ta[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=t_.m14,ta[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=t_.m11,ta[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=t_.m15,ta[Sm.SHADOW_PROJ_INFO_OFFSET+0]=t_.m00,ta[Sm.SHADOW_PROJ_INFO_OFFSET+1]=t_.m05,ta[Sm.SHADOW_PROJ_INFO_OFFSET+2]=1/t_.m00,ta[Sm.SHADOW_PROJ_INFO_OFFSET+3]=1/t_.m05,e$.toArray(ta,tf,Sm.MAT_LIGHT_VIEW_PROJ_OFFSET),Tu.set(tp,tm,0,1-Y.shadowSaturation),e7.toArray(ta,Tu,Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),Tu.set(pJ.DIRECTIONAL,tl,Y.shadowNormalBias,tg),e7.toArray(ta,Tu,Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET)}else{for(var tv=this.getPCFRadius(ti,Y),ty=0;ty<Y.csmLevel;ty++){var tS=tr.layers[ty],tA=tS.matShadowView;Tu.set(tA.m00,tA.m04,tA.m08,tv),e7.toArray(th,Tu,Am.CSM_VIEW_DIR_0_OFFSET+4*ty),Tu.set(tA.m01,tA.m05,tA.m09,tS.splitCameraNear),e7.toArray(th,Tu,Am.CSM_VIEW_DIR_1_OFFSET+4*ty),Tu.set(tA.m02,tA.m06,tA.m10,tS.splitCameraFar),e7.toArray(th,Tu,Am.CSM_VIEW_DIR_2_OFFSET+4*ty);var tT=tS.csmAtlas;e7.toArray(th,tT,Am.CSM_ATLAS_OFFSET+4*ty);var tE=tS.matShadowViewProj;e$.toArray(th,tE,Am.MAT_CSM_VIEW_PROJ_OFFSET+16*ty);var tC=tS.matShadowProj;th[Am.CSM_PROJ_DEPTH_INFO_OFFSET+0+4*ty]=tC.m10,th[Am.CSM_PROJ_DEPTH_INFO_OFFSET+1+4*ty]=tC.m14,th[Am.CSM_PROJ_DEPTH_INFO_OFFSET+2+4*ty]=tC.m11,th[Am.CSM_PROJ_DEPTH_INFO_OFFSET+3+4*ty]=tC.m15,th[Am.CSM_PROJ_INFO_OFFSET+0+4*ty]=tC.m00,th[Am.CSM_PROJ_INFO_OFFSET+1+4*ty]=tC.m05,th[Am.CSM_PROJ_INFO_OFFSET+2+4*ty]=1/tC.m00,th[Am.CSM_PROJ_INFO_OFFSET+3+4*ty]=1/tC.m05}Tu.set(Y.csmTransitionRange,0,0,0),e7.toArray(th,Tu,Am.CSM_SPLITS_INFO_OFFSET),Tu.set(.1,Y.shadowDistance,0,1-Y.shadowSaturation),e7.toArray(ta,Tu,Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),Tu.set(pJ.DIRECTIONAL,tl,Y.shadowNormalBias,Y.csmLevel),e7.toArray(ta,Tu,Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET)}Tu.set(ti.size.x,ti.size.y,Y.shadowPcf,Y.shadowBias),e7.toArray(ta,Tu,Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET)}}else t1.updatePlanarNormalAndDistance(ti,ta),Tu.set(0,0,0,ti.planeBias),e7.toArray(ta,Tu,Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET);is.toArray(ta,ti.shadowColor,Sm.SHADOW_COLOR_OFFSET)}},t1.updateShadowUBOLightView=function(g,v,S,O){var X=g.device,Y=g.pipelineSceneData,te=Y.shadows,ti=Y.csmLayers,tr=v,ta=kg(X)?0:1,th=g.device.capabilities,tu=Y.csmSupported;switch(S.type){case pJ.DIRECTIONAL:var tl=S;if(te.enabled&&tl&&tl.shadowEnabled&&te.type===px.ShadowMap){var tc,t_,tf,tp=.1,tm=0,tg=0;if(tl.shadowFixedArea||tl.csmLevel===pw.LEVEL_1||!tu)tc=ti.specialLayer.matShadowView,t_=ti.specialLayer.matShadowProj,tf=ti.specialLayer.matShadowViewProj,tl.shadowFixedArea?(tp=tl.shadowNear,tm=tl.shadowFar,tg=0):(tp=.1,tm=ti.specialLayer.shadowCameraFar,tg=1),Tu.set(pJ.DIRECTIONAL,ta,tl.shadowNormalBias,0),e7.toArray(tr,Tu,Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET);else{var tv=ti.layers[O];tc=tv.matShadowView,t_=tv.matShadowProj,tf=tv.matShadowViewProj,tp=tv.splitCameraNear,tm=tv.splitCameraFar,tg=tl.csmLevel}e$.toArray(tr,tc,Sm.MAT_LIGHT_VIEW_OFFSET),tr[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=t_.m10,tr[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=t_.m14,tr[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=t_.m11,tr[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=t_.m15,tr[Sm.SHADOW_PROJ_INFO_OFFSET+0]=t_.m00,tr[Sm.SHADOW_PROJ_INFO_OFFSET+1]=t_.m05,tr[Sm.SHADOW_PROJ_INFO_OFFSET+2]=1/t_.m00,tr[Sm.SHADOW_PROJ_INFO_OFFSET+3]=1/t_.m05,e$.toArray(tr,tf,Sm.MAT_LIGHT_VIEW_PROJ_OFFSET),Tu.set(tp,tm,0,1-tl.shadowSaturation),e7.toArray(tr,Tu,Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),Tu.set(pJ.DIRECTIONAL,ta,tl.shadowNormalBias,tg),e7.toArray(tr,Tu,Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),Tu.set(te.size.x,te.size.y,tl.shadowPcf,tl.shadowBias),e7.toArray(tr,Tu,Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET)}break;case pJ.SPOT:var ty=S;te.enabled&&ty&&ty.shadowEnabled&&(e$.invert(Ta,S.node.getWorldMatrix()),e$.toArray(tr,Ta,Sm.MAT_LIGHT_VIEW_OFFSET),e$.perspective(To,ty.angle,1,.001,ty.range,!0,th.clipSpaceMinZ,th.clipSpaceSignY,0),e$.multiply(Th,To,Ta),e$.toArray(tr,Th,Sm.MAT_LIGHT_VIEW_PROJ_OFFSET),Tu.set(.01,S.range,0,0),e7.toArray(tr,Tu,Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),Tu.set(te.size.x,te.size.y,ty.shadowPcf,ty.shadowBias),e7.toArray(tr,Tu,Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET),Tu.set(pJ.SPOT,ta,ty.shadowNormalBias,0),e7.toArray(tr,Tu,Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET))}is.toArray(tr,te.shadowColor,Sm.SHADOW_COLOR_OFFSET)},t1.getCombineSignY=function(){return t1._combineSignY};var g=t1.prototype;return g._initCombineSignY=function(){var g=this._device;t1._combineSignY=.5*g.capabilities.screenSpaceSignY+.5<<1|.5*g.capabilities.clipSpaceSignY+.5},g.activate=function(g,v){this._device=g,this._pipeline=v;var S=this._pipeline.descriptorSet;if(!Ug()){this._initCombineSignY();var O=g.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,vm.SIZE,vm.SIZE));S.bindBuffer(vm.BINDING,O);var X=g.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,ym.SIZE,ym.SIZE));S.bindBuffer(ym.BINDING,X);var Y=g.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,Sm.SIZE,Sm.SIZE)),te=Ug()?CR("CCShadow"):Sm.BINDING;S.bindBuffer(te,Y);var ti=g.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,Am.SIZE,Am.SIZE)),tr=Ug()?CR("CCCSM"):Am.BINDING;S.bindBuffer(tr,ti)}},g.updateGlobalUBO=function(g){var v=this._pipeline.globalDSManager,S=this._pipeline.descriptorSet,O=this._pipeline.commandBuffers;S.update(),t1.updateGlobalUBOView(g,this._globalUBO),O[0].updateBuffer(S.getBuffer(vm.BINDING),this._globalUBO),v.bindBuffer(vm.BINDING,S.getBuffer(vm.BINDING)),v.update()},g.updateCameraUBO=function(g){var v=this._pipeline.globalDSManager,S=this._pipeline.descriptorSet,O=this._pipeline.commandBuffers;t1.updateCameraUBOView(this._pipeline,this._cameraUBO,g),O[0].updateBuffer(S.getBuffer(ym.BINDING),this._cameraUBO),v.bindBuffer(ym.BINDING,S.getBuffer(ym.BINDING)),v.update()},g.updateShadowUBO=function(g){var v=this._pipeline.pipelineSceneData;if(v.shadows.enabled){var S=this._pipeline.descriptorSet,O=this._pipeline.commandBuffers,X=v.shadowFrameBufferMap,Y=g.scene.mainLight;Y&&X.has(Y)&&S.bindTexture(_x,X.get(Y).colorTextures[0]),t1.updateShadowUBOView(this._pipeline,this._shadowUBO,this._csmUBO,g),S.update();var te=Ug()?CR("CCShadow"):Sm.BINDING;O[0].updateBuffer(S.getBuffer(te),this._shadowUBO);var ti=Ug()?CR("CCCSM"):Am.BINDING;O[0].updateBuffer(S.getBuffer(ti),this._csmUBO)}},g.updateShadowUBOLight=function(g,v,S){void 0===S&&(S=0),t1.updateShadowUBOLightView(this._pipeline,this._shadowUBO,v,S),g.bindTexture(_x,dU.get("default-texture").getGFXTexture()),g.bindTexture(_L,dU.get("default-texture").getGFXTexture()),g.update();var O=Ug()?CR("CCShadow"):Sm.BINDING;this._pipeline.commandBuffers[0].updateBuffer(g.getBuffer(O),this._shadowUBO)},g.updateShadowUBORange=function(g,v){_instanceof(v,e$)?e$.toArray(this._shadowUBO,v,g):_instanceof(v,is)&&is.toArray(this._shadowUBO,v,g)},g.destroy=function(){},t1}();T_._combineSignY=0;var Tf,Td,Tp,Tm,Tg,Tv,Ty,TA,TT=g("cR",nJ("RenderStage")((A4=function(){function t1(){this._name=A8&&A8(),this._priority=A6&&A6(),this._enabled=!0,this._tag=A7&&A7(),this._pipeline=void 0,this._flow=void 0}var g=t1.prototype;return g.initialize=function(g){return this._name=g.name,this._priority=g.priority,g.tag&&(this._tag=g.tag),!0},g.activate=function(g,v){this._pipeline=g,this._flow=v},n(t1,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g}}]),t1}(),A8=ws(A4.prototype,"_name",[n2],function(){return""}),A6=ws(A4.prototype,"_priority",[n2],function(){return 0}),A7=ws(A4.prototype,"_tag",[n2],function(){return 0}),A5=A4))||A5);X.RenderStage=TT;var TE,TC=g("cQ",(Tf=nJ("RenderFlow"),Td=ma([TT]),Tf((Tm=function(){function t1(){this._name=Tg&&Tg(),this._priority=Tv&&Tv(),this._tag=Ty&&Ty(),this._stages=TA&&TA(),this._pipeline=void 0}var g=t1.prototype;return g.initialize=function(g){return this._name=g.name,this._priority=g.priority,this._stages=g.stages,g.tag&&(this._tag=g.tag),!0},g.activate=function(g){this._pipeline=g,this._stages.sort(function(g,v){return g.priority-v.priority});for(var v=0,S=this._stages.length;v<S;v++)this._stages[v].activate(g,this)},g.render=function(g){for(var v=0,S=this._stages.length;v<S;v++)this._stages[v].enabled&&this._stages[v].render(g)},g.destroy=function(){for(var g=0,v=this._stages.length;g<v;g++)this._stages[g].destroy();this._stages.length=0},n(t1,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}},{key:"pipeline",get:function(){return this._pipeline}}]),t1}(),Tg=ws(Tm.prototype,"_name",[n2],function(){return""}),Tv=ws(Tm.prototype,"_priority",[n2],function(){return 0}),Ty=ws(Tm.prototype,"_tag",[n2],function(){return 0}),TA=ws(Tm.prototype,"_stages",[Td,n2],function(){return[]}),Tp=Tm))||Tp));X.RenderFlow=TC,g("d6",TE),function(g){g.RENDER_FRAME_BEGIN="render-frame-begin",g.RENDER_FRAME_END="render-frame-end",g.RENDER_CAMERA_BEGIN="render-camera-begin",g.RENDER_CAMERA_END="render-camera-end",g.ATTACHMENT_SCALE_CAHNGED="attachment-scale-changed"}(TE||g("d6",TE={}));var Tx,Tb,TR,Tw,TI,TB,TP=g("d5",function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).eventTargetOn=g.prototype.on,v.eventTargetOnce=g.prototype.once,v}s(e,g);var v=e.prototype;return v.on=function(g,v,S,O){return this.eventTargetOn(g,v,S,O)},v.once=function(g,v,S){return this.eventTargetOnce(g,v,S)},e}(aC)),TD=new hl,TM=new hS,gw=function(){this.renderPass=null,this.sampler=null,this.prefiterTex=null,this.downsampleTexs=[],this.upsampleTexs=[],this.combineTex=null,this.prefilterFramebuffer=null,this.downsampleFramebuffers=[],this.upsampleFramebuffers=[],this.combineFramebuffer=null},vw=function(){this.quadIB=null,this.quadVB=null,this.quadIA=null},TO=g("cP",(Tx=nJ("cc.RenderPipeline"),Tb=ma([TC]),Tx((Tw=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._tag=TI&&TI(),v._flows=TB&&TB(),v._quadIB=null,v._quadVBOnscreen=null,v._quadVBOffscreen=null,v._quadIAOnscreen=null,v._quadIAOffscreen=null,v._eventProcessor=new TP,v._device=void 0,v._globalDSManager=void 0,v._descriptorSet=void 0,v._commandBuffers=[],v._pipelineUBO=new T_,v._macros={},v._constantMacros="",v._profiler=null,v._geometryRenderer=null,v._pipelineRenderData=null,v._renderPasses=new Map,v._width=0,v._height=0,v._lastUsedRenderArea=new hl,v._clusterEnabled=!1,v._bloomEnabled=!1,v}s(e,g);var v=e.prototype;return v.getPipelineRenderData=function(){return this._pipelineRenderData},v.initialize=function(g){return this._flows=g.flows,g.tag&&(this._tag=g.tag),!0},v.createRenderPass=function(g,v,S){var O=this._device,X=new hq,Y=new hY;X.format=v,Y.format=S,Y.stencilStoreOp=oz.DISCARD,Y.depthStoreOp=oz.DISCARD,g&o7.COLOR||(g&pA?X.loadOp=oH.CLEAR:(X.loadOp=oH.LOAD,X.barrier=O.getGeneralBarrier(new h$(oW.COLOR_ATTACHMENT_WRITE,oW.COLOR_ATTACHMENT_WRITE)))),(g&o7.DEPTH_STENCIL)!==o7.DEPTH_STENCIL&&(g&o7.DEPTH||(Y.depthLoadOp=oH.LOAD),g&o7.STENCIL||(Y.stencilLoadOp=oH.LOAD)),Y.barrier=O.getGeneralBarrier(new h$(oW.DEPTH_STENCIL_ATTACHMENT_WRITE,oW.DEPTH_STENCIL_ATTACHMENT_WRITE));var te=new hZ([X],Y);return O.createRenderPass(te)},v.getRenderPass=function(g,v){var S=function(g){for(var v,S=666,O=f(g.colorTextures);!(v=O()).done;){var X=v.value,Y=null==X?void 0:X.info;S=Sl(Y.type+"_"+Y.usage+"_"+Y.format+"_"+Y.width+"_"+Y.height+"_"+Y.flags+"_\n            "+Y.layerCount+"_"+Y.levelCount+"_"+Y.samples+"_"+Y.depth+"_"+Y.externalRes,S)}if(g.depthStencilTexture){var te=g.depthStencilTexture.info;S=Sl(te.type+"_"+te.usage+"_"+te.format+"_"+te.width+"_"+te.height+"_"+te.flags+"_\n            "+te.layerCount+"_"+te.levelCount+"_"+te.samples+"_"+te.depth+"_"+te.externalRes,S)}return S}(v),O=Sl(S+"_"+g,666),X=this._renderPasses.get(O);return X||(X=this.createRenderPass(g,v.colorTextures[0].format,v.depthStencilTexture.format),this._renderPasses.set(O,X),X)},v.newFramebufferByRatio=function(g){for(var v=this.pipelineSceneData,S=this._width*v.shadingScale,O=this._height*v.shadingScale,X=g.colorTextures,Y=0;Y<X.length;Y++)X[Y].resize(S,O);g.depthStencilTexture&&g.depthStencilTexture.resize(S,O);var te=this._device.createFramebuffer(new h2(g.renderPass,X,g.depthStencilTexture));return g.destroy(),te},v.generateRenderArea=function(g,v){var S=g.viewport,O=g.window.width,X=g.window.height;v.x=S.x*O,v.y=S.y*X,v.width=S.width*O,v.height=S.height*X},v.generateViewport=function(g,v){this.generateRenderArea(g,TD),v||(v=TM);var S=this.pipelineSceneData.shadingScale;return v.left=TD.x*S,v.top=TD.y*S,v.width=TD.width*S,v.height=TD.height*S,v},v.generateScissor=function(g,v){v||(v=TD),this.generateRenderArea(g,v);var S=this.pipelineSceneData.shadingScale;return v.x*=S,v.y*=S,v.width*=S,v.height*=S,v},v.getMacroString=function(g){var v=this._macros[g];return void 0===v?"":v},v.getMacroInt=function(g){var v=this._macros[g];return void 0===v?0:v},v.getMacroBool=function(g){var v=this._macros[g];return void 0!==v&&v},v.setMacroString=function(g,v){this._macros[g]=v},v.setMacroInt=function(g,v){this._macros[g]=v},v.setMacroBool=function(g,v){this._macros[g]=v},v.activate=function(){this._device=uZ.gfxDevice,this._generateConstantMacros(),this._globalDSManager=new Tr(this._device),this._descriptorSet=this._globalDSManager.globalDescriptorSet,this._pipelineUBO.activate(this._device,this),this._macros.CC_USE_HDR=this._pipelineSceneData.isHDR,this._macros.CC_USE_DEBUG_VIEW=0,this._generateConstantMacros(),this._pipelineSceneData.activate(this._device);for(var g=0;g<this._flows.length;g++)this._flows[g].activate(this);return!0},v._ensureEnoughSize=function(){},v.render=function(g){if(0!==g.length){this.updateGeometryRenderer(g),this._commandBuffers[0].begin(),this.emit(TE.RENDER_FRAME_BEGIN,g),this._ensureEnoughSize(g),function(g){for(var v=g.length-1;v>=0;--v){var S=g[v];if(S.window.swapchain)return void(pt=S)}pt=null}(g);for(var v=0;v<g.length;v++){var S=g[v];if(S.scene){this.emit(TE.RENDER_CAMERA_BEGIN,S),iA(this,S),nA(this,S),this._pipelineUBO.updateGlobalUBO(S.window),this._pipelineUBO.updateCameraUBO(S);for(var O=0;O<this._flows.length;O++)this._flows[O].render(S);this.emit(TE.RENDER_CAMERA_END,S)}}this.emit(TE.RENDER_FRAME_END,g),this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)}},v._destroyQuadInputAssembler=function(){this._quadIB&&(this._quadIB.destroy(),this._quadIB=null),this._quadVBOnscreen&&(this._quadVBOnscreen.destroy(),this._quadVBOnscreen=null),this._quadVBOffscreen&&(this._quadVBOffscreen.destroy(),this._quadVBOffscreen=null),this._quadIAOnscreen&&(this._quadIAOnscreen.destroy(),this._quadIAOnscreen=null),this._quadIAOffscreen&&(this._quadIAOffscreen.destroy(),this._quadIAOffscreen=null)},v._destroyBloomData=function(){var g,v=this._pipelineRenderData.bloom;if(null!==v){v.prefiterTex&&v.prefiterTex.destroy(),v.prefilterFramebuffer&&v.prefilterFramebuffer.destroy();for(var S=0;S<v.downsampleTexs.length;++S)v.downsampleTexs[S].destroy(),v.downsampleFramebuffers[S].destroy();v.downsampleTexs.length=0,v.downsampleFramebuffers.length=0;for(var O=0;O<v.upsampleTexs.length;++O)v.upsampleTexs[O].destroy(),v.upsampleFramebuffers[O].destroy();v.upsampleTexs.length=0,v.upsampleFramebuffers.length=0,v.combineTex&&v.combineTex.destroy(),v.combineFramebuffer&&v.combineFramebuffer.destroy(),null===(g=v.renderPass)||void 0===g||g.destroy(),this._pipelineRenderData.bloom=null}},v._genQuadVertexData=function(g,v){var S=new Float32Array(16),O=v.x/this._width,X=(v.x+v.width)/this._width,Y=v.y/this._height,te=(v.y+v.height)/this._height;if(this.device.capabilities.screenSpaceSignY>0){var ti=te;te=Y,Y=ti}var tr=0;switch(g){case og.IDENTITY:tr=0,S[tr++]=-1,S[tr++]=-1,S[tr++]=O,S[tr++]=te,S[tr++]=1,S[tr++]=-1,S[tr++]=X,S[tr++]=te,S[tr++]=-1,S[tr++]=1,S[tr++]=O,S[tr++]=Y,S[tr++]=1,S[tr++]=1,S[tr++]=X,S[tr++]=Y;break;case og.ROTATE_90:tr=0,S[tr++]=-1,S[tr++]=-1,S[tr++]=X,S[tr++]=te,S[tr++]=1,S[tr++]=-1,S[tr++]=X,S[tr++]=Y,S[tr++]=-1,S[tr++]=1,S[tr++]=O,S[tr++]=te,S[tr++]=1,S[tr++]=1,S[tr++]=O,S[tr++]=Y;break;case og.ROTATE_180:tr=0,S[tr++]=-1,S[tr++]=-1,S[tr++]=O,S[tr++]=Y,S[tr++]=1,S[tr++]=-1,S[tr++]=X,S[tr++]=Y,S[tr++]=-1,S[tr++]=1,S[tr++]=O,S[tr++]=te,S[tr++]=1,S[tr++]=1,S[tr++]=X,S[tr++]=te;break;case og.ROTATE_270:tr=0,S[tr++]=-1,S[tr++]=-1,S[tr++]=O,S[tr++]=Y,S[tr++]=1,S[tr++]=-1,S[tr++]=O,S[tr++]=te,S[tr++]=-1,S[tr++]=1,S[tr++]=X,S[tr++]=Y,S[tr++]=1,S[tr++]=1,S[tr++]=X,S[tr++]=te}return S},v._createQuadInputAssembler=function(){var g=new vw,v=4*Float32Array.BYTES_PER_ELEMENT,S=4*v,O=this._device.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE|oR.HOST,S,v));if(!O)return g;var X=Uint8Array.BYTES_PER_ELEMENT,Y=6*X,te=this._device.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.DEVICE,Y,X));if(!te)return g;var ti=new Uint8Array(6);ti[0]=0,ti[1]=1,ti[2]=2,ti[3]=1,ti[4]=3,ti[5]=2,te.update(ti);var tr=new Array(2);tr[0]=new hz("a_position",oA.RG32F),tr[1]=new hz("a_texCoord",oA.RG32F);var ta=this._device.createInputAssembler(new hX(tr,[O],te));return g.quadIB=te,g.quadVB=O,g.quadIA=ta,g},v.updateQuadVertexData=function(g,v){var S=this._lastUsedRenderArea;if(S.x!==g.x||S.y!==g.y||S.width!==g.width||S.height!==g.height){var O=this._genQuadVertexData(og.IDENTITY,g);this._quadVBOffscreen.update(O);var X=this._genQuadVertexData(v.swapchain&&v.swapchain.surfaceTransform||og.IDENTITY,g);this._quadVBOnscreen.update(X),S.copy(g)}},v.destroy=function(){for(var v,S,O=0;O<this._flows.length;O++)this._flows[O].destroy();this._flows.length=0,this._descriptorSet&&this._descriptorSet.destroy(),null===(v=this._globalDSManager)||void 0===v||v.destroy();for(var X=0;X<this._commandBuffers.length;X++)this._commandBuffers[X].destroy();return this._commandBuffers.length=0,this._pipelineUBO.destroy(),null===(S=this._pipelineSceneData)||void 0===S||S.destroy(),g.prototype.destroy.call(this)},v.onGlobalPipelineStateChanged=function(){},v._generateConstantMacros=function(){var g="";g+="#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE "+(this.device.getFormatFeatures(oA.RGBA32F)&(oP.RENDER_TARGET|oP.SAMPLED_TEXTURE)?1:0)+"\n",g+="#define CC_ENABLE_CLUSTERED_LIGHT_CULLING "+(this._clusterEnabled?1:0)+"\n",g+="#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS "+this.device.capabilities.maxVertexUniformVectors+"\n",g+="#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS "+this.device.capabilities.maxFragmentUniformVectors+"\n",g+="#define CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT "+(this.device.hasFeature(oS.INPUT_ATTACHMENT_BENEFIT)?1:0)+"\n",g+="#define CC_PLATFORM_ANDROID_AND_WEBGL "+(aD.os===aw.ANDROID&&aD.isBrowser?1:0)+"\n",g+="#define CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES "+(t$.ENABLE_WEBGL_HIGHP_STRUCT_VALUES?1:0)+"\n",g+="#define CC_JOINT_UNIFORM_CAPACITY "+_V.JOINT_UNIFORM_CAPACITY+"\n",this._constantMacros=g},v.updateGeometryRenderer=function(g){if(!this._geometryRenderer)for(var v=0;v<g.length;v++){var S=g[v];if(S&&S.window&&S.window.swapchain)return S.initGeometryRenderer(),void(this._geometryRenderer=S.geometryRenderer)}},v.generateBloomRenderData=function(){if(null==this._pipelineRenderData.bloom){var g=this._pipelineRenderData.bloom=new gw,v=this.device,S=new hq;S.format=oA.RGBA8,S.loadOp=oH.CLEAR,S.storeOp=oz.STORE,S.barrier=v.getGeneralBarrier(new h$(oW.NONE,oW.COLOR_ATTACHMENT_WRITE)),g.renderPass=v.createRenderPass(new hZ([S]));var O=this._width,X=this._height;g.prefiterTex=v.createTexture(new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED,oA.RGBA8,O>>1,X>>1)),g.prefilterFramebuffer=v.createFramebuffer(new h2(g.renderPass,[g.prefiterTex])),O>>=1,X>>=1;for(var Y=0;Y<6;++Y)g.downsampleTexs.push(v.createTexture(new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED,oA.RGBA8,O>>1,X>>1))),g.downsampleFramebuffers[Y]=v.createFramebuffer(new h2(g.renderPass,[g.downsampleTexs[Y]])),g.upsampleTexs.push(v.createTexture(new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED,oA.RGBA8,O,X))),g.upsampleFramebuffers[Y]=v.createFramebuffer(new h2(g.renderPass,[g.upsampleTexs[Y]])),O>>=1,X>>=1;g.combineTex=v.createTexture(new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED,oA.RGBA8,this._width,this._height)),g.combineFramebuffer=v.createFramebuffer(new h2(g.renderPass,[g.combineTex])),g.sampler=this.globalDSManager.linearSampler}},v.on=function(g,v,S,O){return this._eventProcessor.on(g,v,S,O)},v.once=function(g,v,S){return this._eventProcessor.once(g,v,S)},v.off=function(g,v,S){this._eventProcessor.off(g,v,S)},v.emit=function(g,v,S,O,X,Y){this._eventProcessor.emit(g,v,S,O,X,Y)},v.targetOff=function(g){this._eventProcessor.targetOff(g)},v.removeAll=function(g){this._eventProcessor.removeAll(g)},v.hasEventListener=function(g,v,S){return this._eventProcessor.hasEventListener(g,v,S)},n(e,[{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"quadIAOnscreen",get:function(){return this._quadIAOnscreen}},{key:"quadIAOffscreen",get:function(){return this._quadIAOffscreen}},{key:"constantMacros",get:function(){return this._constantMacros}},{key:"macros",get:function(){return this._macros}},{key:"device",get:function(){return this._device}},{key:"globalDSManager",get:function(){return this._globalDSManager}},{key:"descriptorSetLayout",get:function(){return this._globalDSManager.descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}},{key:"pipelineUBO",get:function(){return this._pipelineUBO}},{key:"pipelineSceneData",get:function(){return this._pipelineSceneData}},{key:"profiler",get:function(){return this._profiler},set:function(g){this._profiler=g}},{key:"geometryRenderer",get:function(){return this._geometryRenderer}},{key:"clusterEnabled",get:function(){return this._clusterEnabled},set:function(g){this._clusterEnabled=g}},{key:"bloomEnabled",get:function(){return this._bloomEnabled},set:function(g){this._bloomEnabled=g}},{key:"shadingScale",get:function(){return this._pipelineSceneData.shadingScale},set:function(g){this._pipelineSceneData.shadingScale!==g&&(this._pipelineSceneData.shadingScale=g,this.emit(TE.ATTACHMENT_SCALE_CAHNGED,g))}}]),e}(lx),TI=ws(Tw.prototype,"_tag",[n2],function(){return 0}),TB=ws(Tw.prototype,"_flows",[Tb,n2],function(){return[]}),TR=Tw))||TR));X.RenderPipeline=TO;var TF,TN,Tk,TG,TV,TU,TH,Tz,TW,TX,Tj,TY,TZ,TQ,T$,T0,T1,T2,T3,T5,T4,T8,T6,T9,Er,Es,Ea,Eo,Eh,Eu,El,Ec,E_,Ef,Ed,Ep,Em,Eg,Ev,Ey,ES,EA,ET,EE,EC,Ex,Eb,Ew,EI,EB,EP,ED,EM,EO,EF,EN,Ek,EG,EV,EU,EH,Ez,Ej,Eq,EY,EJ,EZ,E$,E0,E2,E3,E5,E4,E8,E6,E7,E9,Cn,Cr,Cs,Ca,Co,Ch,Cu,Cl=function(){function t1(){this._enabled=!1,this._minPos=new eL(0,0,0),this._maxPos=new eL(0,0,0),this._depth=0}return t1.prototype.initialize=function(g){this._enabled=g.enabled,this._minPos=g.minPos,this._maxPos=g.maxPos,this._depth=g.depth},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g}},{key:"minPos",get:function(){return this._minPos},set:function(g){this._minPos=g}},{key:"maxPos",get:function(){return this._maxPos},set:function(g){this._maxPos=g}},{key:"depth",get:function(){return this._depth},set:function(g){this._depth=g}}]),t1}(),Cc=new e$,C_=new e$,Cf=new e$,Cd=new e$,Cp=new e$,Cm=new e$,Cg=new e$,Cv=new eL(0,0,0),Cy=new eL,CS=new e8,CA=new eL,CT=new eL,CE=new eL(1e7,1e7,1e7),CC=new eL(-1e7,-1e7,-1e7),Cx=new eL,Cb=0,Cw=0,CI=function(){function t1(g){this._shadowObjects=[],this._shadowCameraFar=0,this._level=void 0,this._matShadowView=new e$,this._matShadowProj=new e$,this._matShadowViewProj=new e$,this._validFrustum=new i9,this._splitFrustum=new i9,this._lightViewFrustum=new i9,this._castLightViewBoundingBox=new iK,this._level=g,this._validFrustum.accurate=!0,this._splitFrustum.accurate=!0,this._lightViewFrustum.accurate=!0}var g=t1.prototype;return g.copyToValidFrustum=function(g){i9.copy(this._validFrustum,g)},g.calculateValidFrustumOrtho=function(g,v,S,O,X){i9.createOrtho(this._validFrustum,g,v,S,O,X)},g.calculateSplitFrustum=function(g,v,S,O){this._splitFrustum.split(S,O,g.aspect,g.fov,v)},g.destroy=function(){this._shadowObjects.length=0},g.createMatrix=function(g,v,S){var O=X.director.root.device,Y=g.shadowInvisibleOcclusionRange;i9.copy(this._lightViewFrustum,this._splitFrustum),e$.fromRT(C_,g.node.rotation,Cv),e$.invert(Cf,C_);var te,ti,tr=Cf.clone();this._lightViewFrustum.transform(Cf),iK.fromPoints(this._castLightViewBoundingBox,CE,CC),this._castLightViewBoundingBox.mergeFrustum(this._lightViewFrustum),g.csmOptimizationMode===pI.DisableRotationFix?(te=2*this._castLightViewBoundingBox.halfExtents.x,ti=2*this._castLightViewBoundingBox.halfExtents.y):te=ti=eL.distance(this._lightViewFrustum.vertices[0],this._lightViewFrustum.vertices[6]);var ta=X.director.root.pipeline.pipelineSceneData.csmSupported?g.csmLevel:1;if(ta>1&&g.csmOptimizationMode===pI.RemoveDuplicates){if(this._level>=ta-1)Cw=this._castLightViewBoundingBox.halfExtents.z,Cb=this._castLightViewBoundingBox.center.z;else{var th=Math.abs(this._castLightViewBoundingBox.center.z-Cb)+Cw;this._castLightViewBoundingBox.halfExtents.z=Math.max(this._castLightViewBoundingBox.center.z,th)}}var tu=this._castLightViewBoundingBox.halfExtents.z;this._shadowCameraFar=2*tu+Y;var tl=this._castLightViewBoundingBox.center;if(Cx.set(tl.x,tl.y,tl.z+tu+Y),eL.transformMat4(Cx,Cx,C_),e$.fromRT(C_,g.node.rotation,Cx),e$.invert(Cf,C_),!S){var tc=.5*te,t_=.5*ti;e$.ortho(Cd,-tc,tc,-t_,t_,.1,this._shadowCameraFar,O.capabilities.clipSpaceMinZ,O.capabilities.clipSpaceSignY),e$.multiply(Cm,Cd,tr),eL.transformMat4(Cy,Cx,Cm);var tf=2/v;CS.set(tf,tf);var tp=Cy.x%CS.x,tm=Cy.y%CS.y;CA.set(Cy.x-tp,Cy.y-tm,Cy.z),e$.invert(Cg,Cm),eL.transformMat4(CT,CA,Cg),e$.fromRT(C_,g.node.rotation,CT),e$.invert(Cf,C_),e$.multiply(Cp,Cd,Cf),e$.copy(this._matShadowView,Cf),e$.copy(this._matShadowProj,Cd),e$.copy(this._matShadowViewProj,Cp)}i9.createOrtho(this._validFrustum,te,ti,.1,this._shadowCameraFar,C_)},n(t1,[{key:"level",get:function(){return this._level}},{key:"shadowObjects",get:function(){return this._shadowObjects}},{key:"shadowCameraFar",get:function(){return this._shadowCameraFar},set:function(g){this._shadowCameraFar=g}},{key:"matShadowView",get:function(){return this._matShadowView},set:function(g){this._matShadowView=g}},{key:"matShadowProj",get:function(){return this._matShadowProj},set:function(g){this._matShadowProj=g}},{key:"matShadowViewProj",get:function(){return this._matShadowViewProj},set:function(g){this._matShadowViewProj=g}},{key:"validFrustum",get:function(){return this._validFrustum}},{key:"splitFrustum",get:function(){return this._splitFrustum}},{key:"lightViewFrustum",get:function(){return this._lightViewFrustum}},{key:"castLightViewBoundingBox",get:function(){return this._castLightViewBoundingBox}}]),t1}(),CP=function(g){function e(v){var S;return(S=g.call(this,v)||this)._splitCameraNear=0,S._splitCameraFar=0,S._csmAtlas=new e7,S._calculateAtlas(v),S}s(e,g);var v=e.prototype;return v.destroy=function(){g.prototype.destroy.call(this)},v._calculateAtlas=function(g){var v=X.director.root.device.capabilities.clipSpaceSignY,S=g%2-.5,O=(.5-Math.floor(g/2))*v;this._csmAtlas.set(.5,.5,S,O)},n(e,[{key:"splitCameraNear",get:function(){return this._splitCameraNear},set:function(g){this._splitCameraNear=g}},{key:"splitCameraFar",get:function(){return this._splitCameraFar},set:function(g){this._splitCameraFar=g}},{key:"csmAtlas",get:function(){return this._csmAtlas},set:function(g){this._csmAtlas=g}}]),e}(CI),CD=function(){function t1(){this._castShadowObjects=[],this._layerObjects=new am(64),this._layers=[],this._levelCount=0,this._specialLayer=new CI(1),this._shadowDistance=0;for(var g=0;g<pw.LEVEL_4;g++)this._layers[g]=new CP(g)}var g=t1.prototype;return g.update=function(g,v){var S=v.scene.mainLight;if(null!==S){var O=g.shadows,Y=X.director.root.pipeline.pipelineSceneData.csmSupported?S.csmLevel:1,te=S.shadowDistance;O.enabled&&S.shadowEnabled&&(S.shadowFixedArea?this._updateFixedArea(S):((S.csmNeedUpdate||this._levelCount!==Y||this._shadowDistance!==te)&&(this._splitFrustumLevels(S),this._levelCount=Y,this._shadowDistance=te),this._calculateCSM(v,S,O)))}},g.destroy=function(){this._castShadowObjects.length=0;for(var g=0;g<this._layers.length;g++)this._layers[g].destroy();this._layers.length=0},g._updateFixedArea=function(g){var v=X.director.root.device,S=g.shadowOrthoSize,O=g.shadowOrthoSize,Y=g.shadowNear,te=g.shadowFar;e$.fromRT(C_,g.node.getWorldRotation(),g.node.getWorldPosition()),e$.invert(Cf,C_),e$.ortho(Cd,-S,S,-O,O,Y,te,v.capabilities.clipSpaceMinZ,v.capabilities.clipSpaceSignY),e$.multiply(Cp,Cd,Cf),this._specialLayer.matShadowView=Cf,this._specialLayer.matShadowProj=Cd,this._specialLayer.matShadowViewProj=Cp,this._specialLayer.calculateValidFrustumOrtho(2*S,2*O,Y,te,C_)},g._splitFrustumLevels=function(g){var v=.1,S=g.shadowDistance,O=S/v,Y=X.director.root.pipeline.pipelineSceneData.csmSupported?g.csmLevel:1,te=g.csmLayerLambda;this._layers[0].splitCameraNear=v;for(var ti=1;ti<Y;ti++){var tr=ti/Y,ta=te*v*Math.pow(O,tr)+(1-te)*(v+(S-v)*tr),th=1.005*ta;this._layers[ti].splitCameraNear=ta,this._layers[ti-1].splitCameraFar=th}this._layers[Y-1].splitCameraFar=S,g.csmNeedUpdate=!1},g._calculateCSM=function(g,v,S){var O=X.director.root.pipeline.pipelineSceneData.csmSupported?v.csmLevel:1,Y=O>1?.5*S.size.x:S.size.x;if(!(Y<0)){this._getCameraWorldMatrix(Cc,g);for(var te=O-1;te>=0;te--){var ti=this._layers[te],tr=ti.splitCameraNear,ta=ti.splitCameraFar;ti.calculateSplitFrustum(g,Cc,tr,ta),ti.createMatrix(v,Y,!1)}O===pw.LEVEL_1?(this._specialLayer.shadowCameraFar=this._layers[0].shadowCameraFar,e$.copy(this._specialLayer.matShadowView,this._layers[0].matShadowView),e$.copy(this._specialLayer.matShadowProj,this._layers[0].matShadowProj),e$.copy(this._specialLayer.matShadowViewProj,this._layers[0].matShadowViewProj),this._specialLayer.copyToValidFrustum(this._layers[0].validFrustum)):(this._specialLayer.calculateSplitFrustum(g,Cc,.1,v.shadowDistance),this._specialLayer.createMatrix(v,Y,!0))}},g._getCameraWorldMatrix=function(g,v){if(v.node){var S=v.node,O=S.getWorldPosition(),X=S.getWorldRotation();e$.fromRT(g,X,O)}},n(t1,[{key:"castShadowObjects",get:function(){return this._castShadowObjects}},{key:"layerObjects",get:function(){return this._layerObjects}},{key:"layers",get:function(){return this._layers}},{key:"specialLayer",get:function(){return this._specialLayer}}]),t1}(),CM=function(){function t1(){this._enabled=!0,this._blurRadius=.01,this._sssIntensity=3}return t1.prototype.initialize=function(g){this._enabled=g.enabled,this._blurRadius=g.blurRadius,this._sssIntensity=g.sssIntensity},n(t1,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g}},{key:"blurRadius",get:function(){return this._blurRadius},set:function(g){this._blurRadius=g}},{key:"sssIntensity",get:function(){return this._sssIntensity},set:function(g){this._sssIntensity=g}}]),t1}(),CO=g("cS",function(){function t1(){this.fog=new m9,this.ambient=new mZ,this.skybox=new m4,this.shadows=new pP,this.csmLayers=new CD,this.octree=new Cl,this.skin=new CM,this.postSettings=new yk,this.lightProbes=X.internal.LightProbes?new X.internal.LightProbes:null,this.validPunctualLights=[],this.renderObjects=[],this.shadowFrameBufferMap=new Map,this._geometryRendererMaterials=[],this._geometryRendererPasses=[],this._geometryRendererShaders=[],this._occlusionQueryVertexBuffer=null,this._occlusionQueryIndicesBuffer=null,this._occlusionQueryInputAssembler=null,this._occlusionQueryMaterial=null,this._occlusionQueryShader=null,this._isHDR=!0,this._shadingScale=1,this._csmSupported=!0,this._standardSkinMeshRenderer=null,this._standardSkinModel=null,this._skinMaterialModel=null,this._shadingScale=1}var g=t1.prototype;return g.activate=function(g){return this._device=g,this.initGeometryRendererMaterials(),this.initOcclusionQuery(),!0},g.initGeometryRendererMaterials=function(){for(var g=0,v=0;v<6;v++){this._geometryRendererMaterials[v]=new pf,this._geometryRendererMaterials[v]._uuid="geometry-renderer-material-"+v,this._geometryRendererMaterials[v].initialize({effectName:"internal/builtin-geometry-renderer",technique:v});for(var S=0;S<this._geometryRendererMaterials[v].passes.length;++S)this._geometryRendererPasses[g]=this._geometryRendererMaterials[v].passes[S],this._geometryRendererShaders[g]=this._geometryRendererMaterials[v].passes[S].getShaderVariant(),g++}},g.initOcclusionQuery=function(){if(this._occlusionQueryInputAssembler||(this._occlusionQueryInputAssembler=this._createOcclusionQueryIA()),!this._occlusionQueryMaterial){var g=new pf;g._uuid="default-occlusion-query-material",g.initialize({effectName:"internal/builtin-occlusion-query"}),this._occlusionQueryMaterial=g,g.passes.length>0&&(this._occlusionQueryShader=g.passes[0].getShaderVariant())}},g.getOcclusionQueryPass=function(){return this._occlusionQueryMaterial&&this._occlusionQueryMaterial.passes.length>0?this._occlusionQueryMaterial.passes[0]:null},g.updatePipelineSceneData=function(){},g.destroy=function(){var g,v,S;this.shadows.destroy(),this.csmLayers.destroy(),this.validPunctualLights.length=0,null===(g=this._occlusionQueryInputAssembler)||void 0===g||g.destroy(),this._occlusionQueryInputAssembler=null,null===(v=this._occlusionQueryVertexBuffer)||void 0===v||v.destroy(),this._occlusionQueryVertexBuffer=null,null===(S=this._occlusionQueryIndicesBuffer)||void 0===S||S.destroy(),this._occlusionQueryIndicesBuffer=null,this._standardSkinMeshRenderer=null,this._standardSkinModel=null,this._skinMaterialModel=null},g._createOcclusionQueryIA=function(){var g=this._device,v=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),S=3*Float32Array.BYTES_PER_ELEMENT,O=8*S;this._occlusionQueryVertexBuffer=g.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,O,S)),this._occlusionQueryVertexBuffer.update(v);var X=new Uint16Array([0,2,1,1,2,3,4,5,6,5,7,6,1,3,7,1,7,5,0,4,6,0,6,2,0,1,5,0,5,4,2,6,7,2,7,3]),Y=Uint16Array.BYTES_PER_ELEMENT,te=36*Y;this._occlusionQueryIndicesBuffer=g.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.DEVICE,te,Y)),this._occlusionQueryIndicesBuffer.update(X);var ti=[new hz("a_position",oA.RGB32F)],tr=new hX(ti,[this._occlusionQueryVertexBuffer],this._occlusionQueryIndicesBuffer);return g.createInputAssembler(tr)},n(t1,[{key:"isHDR",get:function(){return this._isHDR},set:function(g){this._isHDR=g}},{key:"shadingScale",get:function(){return this._shadingScale},set:function(g){this._shadingScale=g}},{key:"csmSupported",get:function(){return this._csmSupported},set:function(g){this._csmSupported=g}},{key:"standardSkinModel",get:function(){return this._standardSkinModel},set:function(g){this._standardSkinModel=g}},{key:"standardSkinMeshRenderer",get:function(){return this._standardSkinMeshRenderer},set:function(g){this._standardSkinMeshRenderer&&this._standardSkinMeshRenderer!==g&&this._standardSkinMeshRenderer.clearGlobalStandardSkinObjectFlag(),this._standardSkinMeshRenderer=g,this.standardSkinModel=g?g.model:null}},{key:"skinMaterialModel",get:function(){return this._skinMaterialModel},set:function(g){this._skinMaterialModel=g}},{key:"geometryRendererPasses",get:function(){return this._geometryRendererPasses}},{key:"geometryRendererShaders",get:function(){return this._geometryRendererShaders}}]),t1}());!function(g){g[g.BLOOM=18]="BLOOM",g[g.POST_PROCESS=19]="POST_PROCESS",g[g.UI=20]="UI"}(TF||(TF={})),function(g){g[g.AR=5]="AR",g[g.FORWARD=10]="FORWARD"}(TN||(TN={})),function(g){g[g.SHADOW=0]="SHADOW",g[g.FORWARD=1]="FORWARD",g[g.UI=10]="UI"}(Tk||(Tk={})),function(g){g[g.GBUFFER=10]="GBUFFER",g[g.LIGHTING=15]="LIGHTING",g[g.TRANSPARENT=18]="TRANSPARENT"}(TG||(TG={})),function(g){g[g.SHADOW=0]="SHADOW",g[g.MAIN=1]="MAIN",g[g.UI=10]="UI"}(TV||(TV={})),oe(ow),oe(oI),oe(oz),oe(oH),oe(oW),oe(oA),function(g){g[g.SCENE=0]="SCENE",g[g.POSTPROCESS=1]="POSTPROCESS",g[g.UI=2]="UI"}(Cu||(Cu={})),oe(Cu),TU=nJ("RenderTextureDesc"),TH=ma(ow),Tz=ma(oI),TW=ma(oA),TU((TX=function(){this.name=Tj&&Tj(),this.type=TY&&TY(),this.usage=TZ&&TZ(),this.format=TQ&&TQ(),this.width=T$&&T$(),this.height=T0&&T0()},Tj=ws(TX.prototype,"name",[n2],function(){return""}),TY=ws(TX.prototype,"type",[TH],function(){return ow.TEX2D}),TZ=ws(TX.prototype,"usage",[Tz],function(){return oI.COLOR_ATTACHMENT}),TQ=ws(TX.prototype,"format",[TW],function(){return oA.UNKNOWN}),T$=ws(TX.prototype,"width",[n2],function(){return -1}),T0=ws(TX.prototype,"height",[n2],function(){return -1}),TX));var CL=(T1=nJ("RenderTextureConfig"),T2=ma(pX),T1((T5=function(){this.name=T4&&T4(),this.texture=T8&&T8()},T4=ws(T5.prototype,"name",[n2],function(){return""}),T8=ws(T5.prototype,"texture",[T2],function(){return null}),T3=T5))||T3);T6=nJ("MaterialConfig"),T9=ma(pf),T6((Er=function(){this.name=Es&&Es(),this.material=Ea&&Ea()},Es=ws(Er.prototype,"name",[n2],function(){return""}),Ea=ws(Er.prototype,"material",[T9],function(){return null}),Er)),Eo=nJ("FrameBufferDesc"),Eh=ma([er]),Eu=ma(pX),Eo((El=function(){this.name=Ec&&Ec(),this.renderPass=E_&&E_(),this.colorTextures=Ef&&Ef(),this.depthStencilTexture=Ed&&Ed(),this.texture=Ep&&Ep()},Ec=ws(El.prototype,"name",[n2],function(){return""}),E_=ws(El.prototype,"renderPass",[n2],function(){return 0}),Ef=ws(El.prototype,"colorTextures",[Eh],function(){return[]}),Ed=ws(El.prototype,"depthStencilTexture",[n2],function(){return""}),Ep=ws(El.prototype,"texture",[Eu],function(){return null}),El));var CF,CN=(Em=nJ("ColorDesc"),Eg=ma(oA),Ev=ma(oH),Ey=ma(oz),ES=ma(oW),EA=ma(oW),Em((EE=function(){this.format=EC&&EC(),this.loadOp=Ex&&Ex(),this.storeOp=Eb&&Eb(),this.sampleCount=Ew&&Ew(),this.beginAccesses=EI&&EI(),this.endAccesses=EB&&EB()},EC=ws(EE.prototype,"format",[Eg],function(){return oA.UNKNOWN}),Ex=ws(EE.prototype,"loadOp",[Ev],function(){return oH.CLEAR}),Eb=ws(EE.prototype,"storeOp",[Ey],function(){return oz.STORE}),Ew=ws(EE.prototype,"sampleCount",[n2],function(){return 1}),EI=ws(EE.prototype,"beginAccesses",[ES],function(){return oW.NONE}),EB=ws(EE.prototype,"endAccesses",[EA],function(){return oW.COLOR_ATTACHMENT_WRITE}),ET=EE))||ET),Ck=(EP=nJ("DepthStencilDesc"),ED=ma(oA),EM=ma(oH),EO=ma(oz),EF=ma(oH),EN=ma(oz),Ek=ma(oW),EG=ma(oW),EP((EU=function(){this.format=EH&&EH(),this.depthLoadOp=Ez&&Ez(),this.depthStoreOp=Ej&&Ej(),this.stencilLoadOp=Eq&&Eq(),this.stencilStoreOp=EY&&EY(),this.sampleCount=EJ&&EJ(),this.beginAccesses=EZ&&EZ(),this.endAccesses=E$&&E$()},EH=ws(EU.prototype,"format",[ED],function(){return oA.UNKNOWN}),Ez=ws(EU.prototype,"depthLoadOp",[EM],function(){return oH.CLEAR}),Ej=ws(EU.prototype,"depthStoreOp",[EO],function(){return oz.STORE}),Eq=ws(EU.prototype,"stencilLoadOp",[EF],function(){return oH.CLEAR}),EY=ws(EU.prototype,"stencilStoreOp",[EN],function(){return oz.STORE}),EJ=ws(EU.prototype,"sampleCount",[n2],function(){return 1}),EZ=ws(EU.prototype,"beginAccesses",[Ek],function(){return oW.NONE}),E$=ws(EU.prototype,"endAccesses",[EG],function(){return oW.DEPTH_STENCIL_ATTACHMENT_WRITE}),EV=EU))||EV);E0=nJ("RenderPassDesc"),E2=ma([CN]),E3=ma(Ck),E0((E5=function(){this.index=E4&&E4(),this.colorAttachments=E8&&E8(),this.depthStencilAttachment=E6&&E6()},E4=ws(E5.prototype,"index",[n2],function(){return -1}),E8=ws(E5.prototype,"colorAttachments",[E2],function(){return[]}),E6=ws(E5.prototype,"depthStencilAttachment",[E3],function(){return new Ck}),E5)),function(g){g[g.FRONT_TO_BACK=0]="FRONT_TO_BACK",g[g.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(CF||(CF={})),oe(CF);var CG=(E7=nJ("RenderQueueDesc"),E9=ma(CF),Cn=ma([er]),E7((Cs=function(){this.isTransparent=Ca&&Ca(),this.sortMode=Co&&Co(),this.stages=Ch&&Ch()},Ca=ws(Cs.prototype,"isTransparent",[n2],function(){return!1}),Co=ws(Cs.prototype,"sortMode",[E9],function(){return CF.FRONT_TO_BACK}),Ch=ws(Cs.prototype,"stages",[Cn],function(){return[]}),Cr=Cs))||Cr);function CB(g,v){return g.hash-v.hash||g.depth-v.depth||g.shaderId-v.shaderId}function bB(g,v){return g.priority-v.priority||g.hash-v.hash||v.depth-g.depth||g.shaderId-v.shaderId}var CV=function(){function t1(g){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=g,this._passPool=new ap(function(){return{priority:0,hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}},64),this.queue=new am(64,this._passDesc.sortFunc)}var g=t1.prototype;return g.clear=function(){this.queue.clear(),this._passPool.reset()},g.insertRenderPass=function(g,v,S){var O=g.model.subModels[v],X=O.passes[S],Y=O.shaders[S];if(X.blendState.targets[0].blend!==this._passDesc.isTransparent||!(X.phase&this._passDesc.phases))return!1;var te=0|X.priority<<16|O.priority<<8|S,ti=this._passPool.add();return ti.priority=g.model.priority,ti.hash=te,ti.depth=g.depth||0,ti.shaderId=Y.typedID,ti.subModel=O,ti.passIdx=S,this.queue.push(ti),!0},g.sort=function(){this.queue.sort()},g.recordCommandBuffer=function(g,v,S){for(var O=0;O<this.queue.length;++O){var X=this.queue.array[O],Y=X.subModel,te=X.passIdx,ti=Y.inputAssembler,tr=Y.passes[te],ta=Y.shaders[te],th=dK.getOrCreatePipelineState(g,tr,ta,v,ti);S.bindPipelineState(th),S.bindDescriptorSet(_S.MATERIAL,tr.descriptorSet),S.bindDescriptorSet(_S.LOCAL,Y.descriptorSet),S.bindInputAssembler(ti),S.draw(ti)}},t1}();function RB(g){for(var v=0,S=0;S<g.stages.length;S++)v|=dH(g.stages[S]);var O=CB;switch(g.sortMode){case CF.BACK_TO_FRONT:O=bB;break;case CF.FRONT_TO_BACK:O=CB}return new CV({isTransparent:g.isTransparent,phases:v,sortFunc:O})}function wB(g){g.clear()}function IB(g){g.sort()}var CU=function(){function t1(){this.queue=new Set,this._renderQueue=[]}var g=t1.prototype;return g.clear=function(){for(var g=this.queue.values(),v=g.next();!v.done;)v.value.clear(),v=g.next();this._renderQueue.length=0,this.queue.clear()},g.sort=function(){for(var g=this.queue.values(),v=g.next();!v.done;)v.value.pass.blendState.targets[0].blend||this._renderQueue.push(v.value),v=g.next();for(v=(g=this.queue.values()).next();!v.done;)v.value.pass.blendState.targets[0].blend&&this._renderQueue.push(v.value),v=g.next()},g.uploadBuffers=function(g){for(var v=this.queue.values(),S=v.next();!S.done;)S.value.hasPendingModels&&S.value.uploadBuffers(g),S=v.next()},g.recordCommandBuffer=function(g,v,S,O,X){void 0===O&&(O=null);for(var Y=0===this._renderQueue.length?this.queue.values():this._renderQueue[Symbol.iterator](),te=Y.next();!te.done;){var ti=te.value,tr=ti.instances,ta=ti.pass;if(ti.hasPendingModels){S.bindDescriptorSet(_S.MATERIAL,ta.descriptorSet);for(var th=null,tu=0;tu<tr.length;++tu){var tl=tr[tu];if(tl.count){var tc=tl.shader,t_=dK.getOrCreatePipelineState(g,ta,tc,v,tl.ia);th!==t_&&(S.bindPipelineState(t_),th=t_),O&&S.bindDescriptorSet(_S.GLOBAL,O),X?S.bindDescriptorSet(_S.LOCAL,tl.descriptorSet,X):S.bindDescriptorSet(_S.LOCAL,tl.descriptorSet,te.value.dynamicOffsets),S.bindInputAssembler(tl.ia),S.draw(tl.ia)}}}te=Y.next()}},t1}(),CH=new ad(function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}},16),Cz=new eL,CX=new Float32Array(4),Cj=[],Cq=[],CY=new e$,CK=new e$,CJ=new iK(0,0,0,.5,.5,.5),CZ=new iK;function VB(g,v){return!(!v.worldBounds||nF.aabbWithAABB(v.worldBounds,g.aabb))}function UB(g,v){return!(!v.worldBounds||nF.aabbWithAABB(v.worldBounds,g.aabb)&&nF.aabbFrustum(v.worldBounds,g.frustum))}function HB(g,v){return!(!v.worldBounds||nF.aabbWithAABB(v.worldBounds,g.aabb))}function zB(g,v){return iK.transform(CZ,CJ,g.node.getWorldMatrix()),!(!v.worldBounds||nF.aabbWithAABB(v.worldBounds,CZ))}var C0="forward-add",C2=dH(C0),C3=[];function YB(g,v,S){void 0===S&&(S="default");var O=X.rendering;Ug()&&(C2=O.getPhaseID(O.getPassID(S),C0)),v.length=0;for(var Y=!1,te=0;te<g.length;te++){for(var ti=g[te].passes,tr=-1,ta=0;ta<ti.length;ta++)if((!O||!O.enableEffectImport)&&ti[ta].phase===C2||Ug()&&ti[ta].phaseID===C2){tr=ta,Y=!0;break}v.push(tr)}return Y}var C5=function(){function t1(g){this._pipeline=void 0,this._device=void 0,this._lightPasses=[],this._instancedLightPassPool=CH.alloc(),this._shadowUBO=new Float32Array(Sm.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._instancedQueues=[],this._lightMeterScale=1e4,this._pipeline=g,this._device=g.device;var v=this._device.capabilities.uboOffsetAlignment;this._lightBufferStride=Math.ceil(km.SIZE/v)*v,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new hb(this._lightBuffer,0,km.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount)}var g=t1.prototype;return g.clear=function(){this._instancedQueues.forEach(function(g){g.clear()}),this._instancedQueues.length=0;for(var g=0;g<this._lightPasses.length;g++){var v=this._lightPasses[g];v.dynamicOffsets.length=0,v.lights.length=0}CH.freeArray(this._lightPasses),this._lightPasses.length=0,this._instancedLightPassPool.dynamicOffsets.length=0,this._instancedLightPassPool.lights.length=0},g.destroy=function(){for(var g=this._pipeline.globalDSManager.descriptorSetMap,v=g.keys,S=0;S<v.length;S++){var O=v[S],X=g.get(O);if(X){var Y=Ug()?CR("CCShadow"):Sm.BINDING;X.getBuffer(Y).destroy(),X.getTexture(_x).destroy(),X.getTexture(_L).destroy(),X.destroy()}g.delete(O)}},g._bindForwardAddLight=function(g,v){void 0===v&&(v="default");for(var S=this._pipeline.pipelineSceneData.renderObjects,O=0;O<S.length;O++){var X=S[O].model,Y=X.subModels;if(YB(Y,C3,v)&&(Cq.length=0,this._lightCulling(X,g),Cq.length||!(g.length>0)))for(var te=0;te<Y.length;te++){var ti=C3[te];if(!(ti<0)){var tr=Y[te],ta=tr.passes[ti];tr.passes[0].blendState.targets[0].blend||(Ug()&&CR("CCForwardLight"),tr.descriptorSet.bindBuffer(km.BINDING,this._firstLightBufferView),tr.descriptorSet.update(),this._addRenderQueue(ta,tr,X,ti))}}}},g.gatherLightPasses=function(g,v,S){void 0===S&&(S="default"),this.clear();var O=this._pipeline.pipelineSceneData.validPunctualLights;if(O.length){this._updateUBOs(g,v),this._updateLightDescriptorSet(g,v),this._bindForwardAddLight(O,S);for(var X=0;X<O.length;X++){var Y=O[X];this._instancedLightPassPool.lights.push(Y),this._instancedLightPassPool.dynamicOffsets.push(this._lightBufferStride*X)}this._instancedQueues.forEach(function(g){g.uploadBuffers(v)})}else this._bindForwardAddLight(O,S)},g.recordCommandBuffer=function(g,v,S){for(var O=this._pipeline.globalDSManager,X=0;X<this._instancedQueues.length;++X){var Y=this._instancedLightPassPool.lights[X];Cj[0]=this._instancedLightPassPool.dynamicOffsets[X];var te=O.getOrCreateDescriptorSet(Y);this._instancedQueues[X].recordCommandBuffer(g,v,S,te,Cj)}for(var ti=0;ti<this._lightPasses.length;ti++){var tr=this._lightPasses[ti],ta=tr.subModel,th=tr.passIdx,tu=tr.dynamicOffsets,tl=tr.lights,tc=ta.passes[th],t_=ta.shaders[th],tf=ta.inputAssembler,tp=dK.getOrCreatePipelineState(g,tc,t_,v,tf),tm=tc.descriptorSet,tg=ta.descriptorSet;S.bindPipelineState(tp),S.bindDescriptorSet(_S.MATERIAL,tm),S.bindInputAssembler(tf);for(var tv=0;tv<tu.length;++tv){var ty=tl[tv],tS=O.getOrCreateDescriptorSet(ty);Cj[0]=tu[tv],S.bindDescriptorSet(_S.GLOBAL,tS),S.bindDescriptorSet(_S.LOCAL,tg,Cj),S.draw(tf)}}},g._lightCulling=function(g,v){for(var S=!1,O=0;O<v.length;O++){var X=v[O];switch(X.type){case pJ.SPHERE:S=VB(X,g);break;case pJ.SPOT:S=UB(X,g);break;case pJ.POINT:S=HB(X,g);break;case pJ.RANGED_DIRECTIONAL:S=zB(X,g)}S||Cq.push(O)}},g._addRenderQueue=function(g,v,S,O){var X=this._pipeline.pipelineSceneData.validPunctualLights,Y=g.batchingScheme,te=null;Y===dG.NONE&&((te=CH.alloc()).subModel=v,te.passIdx=O);for(var ti=0;ti<Cq.length;ti++){var tr=Cq[ti],ta=X[tr];if((ta.visibility&S.node.layer)===S.node.layer)switch(Y){case dG.INSTANCING:var th=g.getInstancedBuffer(ti);th.merge(v,O),th.dynamicOffsets[0]=this._lightBufferStride,this._instancedQueues[ti]||(this._instancedQueues[ti]=new CU),this._instancedQueues[ti].queue.add(th);break;default:te.lights.push(ta),te.dynamicOffsets.push(this._lightBufferStride*tr)}}Y===dG.NONE&&this._lightPasses.push(te)},g._updateLightDescriptorSet=function(g,v){for(var S=this._pipeline.device,O=this._pipeline.pipelineSceneData,X=O.shadows,Y=O.shadowFrameBufferMap,te=g.scene.mainLight,ti=kg(S)?0:1,tr=this._pipeline.globalDSManager,ta=O.validPunctualLights,th=this._pipeline.device.capabilities,tu=0;tu<ta.length;tu++){var tl=ta[tu],tc=tr.getOrCreateDescriptorSet(tl);if(tc){var t_=void 0,tf=void 0;switch(tl.type){case pJ.SPHERE:te&&T_.updatePlanarNormalAndDistance(X,this._shadowUBO),this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=X.size.x,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=X.size.y,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=1,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=0,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=pJ.SPHERE,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=ti,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=0,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,is.toArray(this._shadowUBO,X.shadowColor,Sm.SHADOW_COLOR_OFFSET);break;case pJ.SPOT:var tp=tl;if(te&&T_.updatePlanarNormalAndDistance(X,this._shadowUBO),e$.invert(CY,tl.node.getWorldMatrix()),e$.perspective(CK,tl.angle,1,.001,tl.range,!0,th.clipSpaceMinZ,th.clipSpaceSignY,0),t_=CK.clone(),tf=CK.clone().invert(),e$.multiply(CK,CK,CY),e$.toArray(this._shadowUBO,CY,Sm.MAT_LIGHT_VIEW_OFFSET),e$.toArray(this._shadowUBO,CK,Sm.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+0]=.01,this._shadowUBO[Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+1]=tl.range,this._shadowUBO[Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+2]=0,this._shadowUBO[Sm.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+3]=0,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=X.size.x,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=X.size.y,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=tp.shadowPcf,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=tp.shadowBias,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=pJ.SPOT,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=ti,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=tp.shadowNormalBias,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,this._shadowUBO[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=t_.m10,this._shadowUBO[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=t_.m14,this._shadowUBO[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=t_.m11,this._shadowUBO[Sm.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=t_.m15,this._shadowUBO[Sm.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+0]=tf.m10,this._shadowUBO[Sm.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+1]=tf.m14,this._shadowUBO[Sm.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+2]=tf.m11,this._shadowUBO[Sm.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+3]=tf.m15,this._shadowUBO[Sm.SHADOW_PROJ_INFO_OFFSET+0]=t_.m00,this._shadowUBO[Sm.SHADOW_PROJ_INFO_OFFSET+1]=t_.m05,this._shadowUBO[Sm.SHADOW_PROJ_INFO_OFFSET+2]=1/t_.m00,this._shadowUBO[Sm.SHADOW_PROJ_INFO_OFFSET+3]=1/t_.m05,is.toArray(this._shadowUBO,X.shadowColor,Sm.SHADOW_COLOR_OFFSET),Y.has(tl)){var tm,tg=null===(tm=Y.get(tl))||void 0===tm?void 0:tm.colorTextures[0];tg&&tc.bindTexture(_L,tg)}break;case pJ.POINT:te&&T_.updatePlanarNormalAndDistance(X,this._shadowUBO),this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=X.size.x,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=X.size.y,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=1,this._shadowUBO[Sm.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=0,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=pJ.POINT,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=ti,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=0,this._shadowUBO[Sm.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,is.toArray(this._shadowUBO,X.shadowColor,Sm.SHADOW_COLOR_OFFSET)}tc.update();var tv=Ug()?CR("CCShadow"):Sm.BINDING;v.updateBuffer(tc.getBuffer(tv),this._shadowUBO)}}},g._updateUBOs=function(g,v){var S=g.exposure,O=this._pipeline.pipelineSceneData,X=O.isHDR,Y=O.shadows,te=O.validPunctualLights;te.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=wi(te.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView=uZ.gfxDevice.createBuffer(new hb(this._lightBuffer,0,km.SIZE)));for(var ti=0,tr=0;ti<te.length;ti++,tr+=this._lightBufferElementCount){var ta=te[ti];switch(ta.type){case pJ.SPHERE:if(eL.toArray(CX,ta.position),CX[3]=pJ.SPHERE,this._lightBufferData.set(CX,tr+km.LIGHT_POS_OFFSET),CX[0]=ta.size,CX[1]=ta.range,CX[2]=0,CX[3]=0,this._lightBufferData.set(CX,tr+km.LIGHT_SIZE_RANGE_ANGLE_OFFSET),eL.toArray(CX,ta.color),ta.useColorTemperature){var th=ta.finalColor;CX[0]=th.x,CX[1]=th.y,CX[2]=th.z}CX[3]=X?ta.luminance*S*this._lightMeterScale:ta.luminance,this._lightBufferData.set(CX,tr+km.LIGHT_COLOR_OFFSET);break;case pJ.SPOT:if(eL.toArray(CX,ta.position),CX[3]=pJ.SPOT,this._lightBufferData.set(CX,tr+km.LIGHT_POS_OFFSET),CX[0]=ta.size,CX[1]=ta.range,CX[2]=ta.spotAngle,CX[3]=Y.enabled&&ta.shadowEnabled&&Y.type===px.ShadowMap?1:0,this._lightBufferData.set(CX,tr+km.LIGHT_SIZE_RANGE_ANGLE_OFFSET),eL.toArray(CX,ta.direction),this._lightBufferData.set(CX,tr+km.LIGHT_DIR_OFFSET),eL.toArray(CX,ta.color),ta.useColorTemperature){var tu=ta.finalColor;CX[0]=tu.x,CX[1]=tu.y,CX[2]=tu.z}CX[3]=X?ta.luminance*S*this._lightMeterScale:ta.luminance,this._lightBufferData.set(CX,tr+km.LIGHT_COLOR_OFFSET),CX[0]=0,CX[1]=0,CX[2]=0,CX[3]=ta.angleAttenuationStrength,this._lightBufferData.set(CX,tr+km.LIGHT_BOUNDING_SIZE_VS_OFFSET);break;case pJ.POINT:if(eL.toArray(CX,ta.position),CX[3]=pJ.POINT,this._lightBufferData.set(CX,tr+km.LIGHT_POS_OFFSET),CX[0]=0,CX[1]=ta.range,CX[2]=0,CX[3]=0,this._lightBufferData.set(CX,tr+km.LIGHT_SIZE_RANGE_ANGLE_OFFSET),eL.toArray(CX,ta.color),ta.useColorTemperature){var tl=ta.finalColor;CX[0]=tl.x,CX[1]=tl.y,CX[2]=tl.z}CX[3]=X?ta.luminance*S*this._lightMeterScale:ta.luminance,this._lightBufferData.set(CX,tr+km.LIGHT_COLOR_OFFSET);break;case pJ.RANGED_DIRECTIONAL:eL.toArray(CX,ta.position),CX[3]=pJ.RANGED_DIRECTIONAL,this._lightBufferData.set(CX,tr+km.LIGHT_POS_OFFSET),eL.toArray(CX,ta.right),CX[3]=0,this._lightBufferData.set(CX,tr+km.LIGHT_SIZE_RANGE_ANGLE_OFFSET),eL.toArray(CX,ta.direction),CX[3]=0,this._lightBufferData.set(CX,tr+km.LIGHT_DIR_OFFSET);var tc=ta.scale;if(Cz.set(.5*tc.x,.5*tc.y,.5*tc.z),eL.toArray(CX,Cz),CX[3]=0,this._lightBufferData.set(CX,tr+km.LIGHT_BOUNDING_SIZE_VS_OFFSET),eL.toArray(CX,ta.color),ta.useColorTemperature){var t_=ta.finalColor;CX[0]=t_.x,CX[1]=t_.y,CX[2]=t_.z}CX[3]=X?ta.illuminance*S:ta.illuminance,this._lightBufferData.set(CX,tr+km.LIGHT_COLOR_OFFSET)}}v.updateBuffer(this._lightBuffer,this._lightBufferData)},t1}(),C4=new iK,C8=dH("planar-shadow");function QB(g){var v=g.passes,S=X.rendering;Ug()&&(C8=S.getPhaseID(S.getPassID("default"),"planar-shadow"));for(var O=0;O<v.length;O++)if((!S||!S.enableEffectImport)&&v[O].phase===C8||Ug()&&v[O].phaseID===C8)return O;return -1}var C6,C7,C9,xs,xa,xo,xu,xc,x_=function(){function t1(g){this._subModelArray=[],this._shaderArray=[],this._passArray=[],this._castModels=[],this._instancedQueue=new CU,this._pipeline=void 0,this._pipeline=g}var g=t1.prototype;return g.clear=function(){this._subModelArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._castModels.length=0},g.gatherShadowPasses=function(g,v){this.clear();var S=this._pipeline.pipelineSceneData.shadows;if(S.enabled&&S.type===px.Planar&&!(S.normal.length()<1e-6)){var O=g.scene,X=g.frustum,Y=0!=(g.visibility&_a.BitMask.DEFAULT);if(O.mainLight&&Y){for(var te=O.models,ti=g.visibility,tr=0;tr<te.length;tr++){var ta=te[tr];O.isCulledByLod(g,ta)||ta.enabled&&ta.node&&ta.castShadow&&ta.node&&(ti&ta.node.layer)===ta.node.layer&&this._castModels.push(ta)}for(var th=0;th<this._castModels.length;th++){var tu=this._castModels[th];if(!tu.worldBounds||(iK.transform(C4,tu.worldBounds,S.matLight),nF.aabbFrustum(C4,X)))for(var tl=tu.subModels,tc=0;tc<tl.length;tc++){var t_=tl[tc],tf=QB(t_);if(tf<0){this._subModelArray.push(t_);var tp=S.getPlanarShader(t_.patches);if(!tp)continue;this._shaderArray.push(tp),this._passArray.push(S.material.passes[0])}else{var tm=t_.passes[tf];if(tm.batchingScheme===dG.INSTANCING){var tg=tm.getInstancedBuffer();tg.merge(t_,tf),this._instancedQueue.queue.add(tg)}else{var tv=t_.shaders[tf];this._subModelArray.push(t_),tv&&this._shaderArray.push(tv),this._passArray.push(tm)}}}}this._instancedQueue.uploadBuffers(v)}}},g.recordCommandBuffer=function(g,v,S){var O=this._pipeline.pipelineSceneData.shadows;if(O.enabled&&O.type===px.Planar){this._instancedQueue.recordCommandBuffer(g,v,S);for(var X=0;X<this._subModelArray.length;++X){var Y=this._subModelArray[X],te=this._shaderArray[X],ti=this._passArray[X],tr=Y.inputAssembler,ta=dK.getOrCreatePipelineState(g,ti,te,v,tr),th=ti.descriptorSet;S.bindPipelineState(ta),S.bindDescriptorSet(_S.MATERIAL,th),S.bindDescriptorSet(_S.LOCAL,Y.descriptorSet),S.bindInputAssembler(tr),S.draw(tr)}}},t1}(),xf=function(){function t1(){this._phaseID=dH("default");var g=X.rendering;Ug()&&(this._phaseID=g.getPhaseID(g.getPassID("default"),"default"))}var g=t1.prototype;return g.activate=function(g){this._pipeline=g},g.render=function(g,v){for(var S=this._pipeline,O=S.device,X=S.commandBuffers[0],Y=g.scene.batches,te=0;te<Y.length;te++){var ti=Y[te],tr=!1;if(g.visibility&ti.visFlags&&(tr=!0),tr)for(var ta=ti.shaders.length,th=0;th<ta;th++){var tu=ti.passes[th];if(tu.phase===this._phaseID){var tl=ti.shaders[th],tc=ti.inputAssembler,t_=dK.getOrCreatePipelineState(O,tu,tl,v,tc);X.bindPipelineState(t_),X.bindDescriptorSet(_S.MATERIAL,tu.descriptorSet);var tf=ti.descriptorSet;X.bindDescriptorSet(_S.LOCAL,tf),X.bindInputAssembler(tc),X.draw(tc)}}}},t1}(),xd=[new hA(0,0,0,1)],xp=g("cW",(C6=nJ("ForwardStage"),C7=ma([CG]),C6(((xo=function(g){function e(){var v;return(v=g.call(this)||this).renderQueues=xa&&xa(),v._renderQueues=[],v._renderArea=new hl,v._instancedQueue=void 0,v._phaseID=dH("default"),v._clearFlag=0xffffffff,v.additiveInstanceQueues=[],v._instancedQueue=new CU,v._uiPhase=new xf,v}s(e,g);var v=e.prototype;return v.addRenderInstancedQueue=function(g){this.additiveInstanceQueues.includes(g)||this.additiveInstanceQueues.push(g)},v.removeRenderInstancedQueue=function(g){var v=this.additiveInstanceQueues.indexOf(g);v>-1&&this.additiveInstanceQueues.splice(v,1)},v.initialize=function(v){return g.prototype.initialize.call(this,v),v.renderQueues&&(this.renderQueues=v.renderQueues),!0},v.activate=function(v,S){g.prototype.activate.call(this,v,S);for(var O=0;O<this.renderQueues.length;O++)this._renderQueues[O]=RB(this.renderQueues[O]);this._additiveLightQueue=new C5(this._pipeline),this._planarQueue=new x_(this._pipeline),this._uiPhase.activate(v)},v.destroy=function(){},v.render=function(g){var v;this._instancedQueue.clear();var S=this._pipeline,O=S.device;this._renderQueues.forEach(wB);for(var X=S.pipelineSceneData.renderObjects,Y=0,te=0,ti=0,tr=0;tr<X.length;++tr){var ta=X[tr],th=ta.model.subModels;for(Y=0;Y<th.length;++Y){var tu=th[Y],tl=tu.passes;for(te=0;te<tl.length;++te){var tc=tl[te];if(tc.phase===this._phaseID){if(tc.batchingScheme===dG.INSTANCING){var t_=tc.getInstancedBuffer();t_.merge(tu,te),this._instancedQueue.queue.add(t_)}else for(ti=0;ti<this._renderQueues.length;ti++)this._renderQueues[ti].insertRenderPass(ta,Y,te)}}}}this._instancedQueue.sort(),this._renderQueues.forEach(IB);var tf=S.commandBuffers[0];S.pipelineUBO.updateShadowUBO(g);for(var tp=0;tp<this.additiveInstanceQueues.length;tp++)this.additiveInstanceQueues[tp].uploadBuffers(tf);this._instancedQueue.uploadBuffers(tf),this._additiveLightQueue.gatherLightPasses(g,tf),this._planarQueue.gatherShadowPasses(g,tf),g.clearFlag&o7.COLOR&&(xd[0].x=g.clearColor.x,xd[0].y=g.clearColor.y,xd[0].z=g.clearColor.z,xd[0].w=g.clearColor.w),S.generateRenderArea(g,this._renderArea);var tm=g.window.framebuffer,tg=S.getRenderPass(g.clearFlag&this._clearFlag,tm);tf.beginRenderPass(tg,tm,this._renderArea,xd,g.clearDepth,g.clearStencil),tf.bindDescriptorSet(_S.GLOBAL,S.descriptorSet),this._renderQueues[0].recordCommandBuffer(O,tg,tf);for(var tv=0;tv<this.additiveInstanceQueues.length;tv++)this.additiveInstanceQueues[tv].recordCommandBuffer(O,tg,tf);this._instancedQueue.recordCommandBuffer(O,tg,tf),this._additiveLightQueue.recordCommandBuffer(O,tg,tf),tf.bindDescriptorSet(_S.GLOBAL,S.descriptorSet),this._planarQueue.recordCommandBuffer(O,tg,tf),this._renderQueues[1].recordCommandBuffer(O,tg,tf),null===(v=g.geometryRenderer)||void 0===v||v.render(tg,tf,S.pipelineSceneData),this._uiPhase.render(g,tg),TS(O,tg,tf,S.profiler,g),tf.endRenderPass()},e}(TT)).initInfo={name:"ForwardStage",priority:TN.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:CF.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:CF.BACK_TO_FRONT,stages:["default","planarShadow"]}]},xa=ws((xs=xo).prototype,"renderQueues",[C7,n2],function(){return[]}),C9=xs))||C9)),xm=g("cV",nJ("ForwardFlow")(((xc=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.initialize=function(v){if(g.prototype.initialize.call(this,v),0===this._stages.length){var S=new xp;S.initialize(xp.initInfo),this._stages.push(S)}return!0},v.activate=function(v){g.prototype.activate.call(this,v)},v.render=function(v){g.prototype.render.call(this,v)},v.destroy=function(){g.prototype.destroy.call(this)},e}(TC)).initInfo={name:_c,priority:Tk.FORWARD,stages:[]},xu=xc))||xu),xg=dH("shadow-caster");function _P(g){var v=g.passes,S=X.rendering;Ug()&&(xg=S.getPhaseID(S.getPassID("default"),"shadow-caster"));for(var O=0;O<v.length;O++)if((!S||!S.enableEffectImport)&&v[O].phase===xg||Ug()&&v[O].phaseID===xg)return O;return -1}var xv,xS,xA,xT,xE=function(){function t1(g){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._instancedQueue=void 0,this._pipeline=g,this._instancedQueue=new CU}var g=t1.prototype;return g.gatherLightPasses=function(g,v,S,O){void 0===O&&(O=0),this.clear();var X=this._pipeline.pipelineSceneData,Y=X.shadows;if(v&&Y.enabled&&Y.type===px.ShadowMap){switch(v.type){case pJ.DIRECTIONAL:var te=v;if(te.shadowEnabled){var ti,tr=X.csmLayers;!function(g,v,S){var O=g.scene.mainLight,X=v.csmLayers.layerObjects,Y=S.validFrustum,te=S.shadowObjects;te.length=0;for(var ti=g.visibility,tr=X.length-1;tr>=0;tr--){var ta=X.array[tr];if(ta){var th=ta.model;th&&th.enabled&&th.node&&((ti&th.node.layer)===th.node.layer||ti&th.visFlags)&&th.worldBounds&&th.castShadow?nF.aabbFrustum(th.worldBounds,Y)&&(te.push(ta),S.level<O.csmLevel&&O.csmOptimizationMode===pI.RemoveDuplicates&&nF.aabbFrustumCompletelyInside(th.worldBounds,Y)&&X.fastRemove(tr)):X.fastRemove(tr)}else X.fastRemove(tr)}}(g,X,ti=te.shadowFixedArea?tr.specialLayer:tr.layers[O]);for(var ta=ti.shadowObjects,th=0;th<ta.length;th++){var tu=ta[th].model;this.add(tu,O)}}break;case pJ.SPOT:var tl=v;if(tl.shadowEnabled)for(var tc=tl.visibility,t_=X.csmLayers.castShadowObjects,tf=0;tf<t_.length;tf++){var tp=t_[tf].model;(!tp.worldBounds||(tc&tp.node.layer)===tp.node.layer&&nF.aabbFrustum(tp.worldBounds,tl.frustum))&&this.add(tp,O)}}this._instancedQueue.uploadBuffers(S)}},g.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear()},g.add=function(g,v){for(var S=g.subModels,O=0;O<S.length;O++){var X=S[O],Y=_P(X);if(!(Y<0)){var te=X.passes[Y];if(te.batchingScheme===dG.INSTANCING){var ti=te.getInstancedBuffer(v);ti.merge(X,Y),this._instancedQueue.queue.add(ti)}else{var tr=X.shaders[Y];this._subModelsArray.push(X),tr&&this._shaderArray.push(tr),this._passArray.push(te)}}}},g.recordCommandBuffer=function(g,v,S){this._instancedQueue.recordCommandBuffer(g,v,S);for(var O=0;O<this._subModelsArray.length;++O){var X=this._subModelsArray[O],Y=this._shaderArray[O],te=this._passArray[O],ti=X.inputAssembler,tr=dK.getOrCreatePipelineState(g,te,Y,v,ti),ta=te.descriptorSet;S.bindPipelineState(tr),S.bindDescriptorSet(_S.MATERIAL,ta),S.bindDescriptorSet(_S.LOCAL,X.descriptorSet),S.bindInputAssembler(ti),S.draw(ti)}},t1}(),xC=[new hA(1,1,1,1)],xx=g("d2",nJ("ShadowStage")(((xS=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._additiveShadowQueue=void 0,v._shadowFrameBuffer=null,v._renderArea=new hl,v._light=null,v._globalDS=null,v._level=0,v._isShadowMapCleared=!1,v}s(e,g);var v=e.prototype;return v.setUsage=function(g,v,S,O){void 0===O&&(O=0),this._globalDS=g,this._light=v,this._shadowFrameBuffer=S,this._level=O},v.destroy=function(){var g;this._shadowFrameBuffer=null,this._globalDS=null,this._light=null,null===(g=this._additiveShadowQueue)||void 0===g||g.clear()},v.clearFramebuffer=function(g){if(this._light&&this._shadowFrameBuffer&&!this._isShadowMapCleared){xC[0].w=g.clearColor.w;var v=this._pipeline,S=v.pipelineSceneData,O=S.shadingScale,X=S.shadows,Y=g.viewport,te=X.size;this._renderArea.x=Y.x*te.x,this._renderArea.y=Y.y*te.y,this._renderArea.width=Y.width*te.x*O,this._renderArea.height=Y.height*te.y*O;var ti=v.commandBuffers[0],tr=this._shadowFrameBuffer.renderPass;ti.beginRenderPass(tr,this._shadowFrameBuffer,this._renderArea,xC,g.clearDepth,g.clearStencil),ti.endRenderPass(),this._isShadowMapCleared=!0}},v.render=function(g){var v=this._pipeline,S=v.pipelineSceneData,O=S.shadows,X=this._globalDS,Y=v.commandBuffers[0],te=this._level,ti=v.device;if(this._light&&this._shadowFrameBuffer){this._pipeline.pipelineUBO.updateShadowUBOLight(X,this._light,te),this._additiveShadowQueue.gatherLightPasses(g,this._light,Y,te);var tr=O.size;switch(this._light.type){case pJ.DIRECTIONAL:var ta=this._light;if(ta.shadowFixedArea||ta.csmLevel===pw.LEVEL_1||!S.csmSupported)this._renderArea.x=0,this._renderArea.y=0,this._renderArea.width=tr.x,this._renderArea.height=tr.y;else{var th=ti.capabilities.screenSpaceSignY;this._renderArea.x=te%2*.5*tr.x,this._renderArea.y=th>0?.5*(1-Math.floor(te/2))*tr.y:.5*Math.floor(te/2)*tr.y,this._renderArea.width=.5*tr.x,this._renderArea.height=.5*tr.y}break;case pJ.SPOT:this._renderArea.x=0,this._renderArea.y=0,this._renderArea.width=tr.x,this._renderArea.height=tr.y}var tu=this._shadowFrameBuffer.renderPass;Y.beginRenderPass(tu,this._shadowFrameBuffer,this._renderArea,xC,g.clearDepth,g.clearStencil),Y.bindDescriptorSet(_S.GLOBAL,X),this._additiveShadowQueue.recordCommandBuffer(ti,tu,Y),Y.endRenderPass(),this._isShadowMapCleared=!1}},v.activate=function(v,S){g.prototype.activate.call(this,v,S),this._additiveShadowQueue=new xE(v),this._isShadowMapCleared=!1},e}(TT)).initInfo={name:"ShadowStage",priority:TN.FORWARD,tag:0},xv=xS))||xv),xb=[],xw=g("d1",nJ("ShadowFlow")(((xT=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._shadowRenderPass=null,v}s(e,g);var v=e.prototype;return v.initialize=function(v){if(g.prototype.initialize.call(this,v),0===this._stages.length){var S=new xx;S.initialize(xx.initInfo),this._stages.push(S)}return!0},v.activate=function(v){g.prototype.activate.call(this,v);var S=kg(v.device)?0:1;v.macros.CC_SHADOWMAP_FORMAT=S;var O=v.device.gfxAPI===om.WEBGL?1:0;v.macros.CC_SHADOWMAP_USE_LINEAR_DEPTH=O,v.pipelineSceneData.csmSupported=v.device.capabilities.maxFragmentUniformVectors>=(vm.COUNT+ym.COUNT+Sm.COUNT+Am.COUNT)/4,v.macros.CC_SUPPORT_CASCADED_SHADOW_MAP=v.pipelineSceneData.csmSupported,v.macros.CC_SHADOW_TYPE=0,v.macros.CC_DIR_SHADOW_PCF_TYPE=pb.HARD,v.macros.CC_DIR_LIGHT_SHADOW_TYPE=0,v.macros.CC_CASCADED_LAYERS_TRANSITION=0,v.onGlobalPipelineStateChanged()},v.render=function(g){var v=this._pipeline,S=v.pipelineSceneData.shadows,O=v.pipelineSceneData.csmLayers,X=v.pipelineSceneData.shadowFrameBufferMap,Y=O.castShadowObjects,te=this._pipeline.pipelineSceneData.validPunctualLights;if(S.enabled&&S.type===px.ShadowMap){for(var ti=0,tr=0;ti<S.maxReceived&&tr<te.length;){var ta=te[tr];ta.type===pJ.SPOT&&ta.shadowEnabled&&(xb.push(ta),ti++),tr++}if(0!==Y.length){S.shadowMapDirty&&this.resizeShadowMap();var th=g.scene.mainLight;if(th&&th.shadowEnabled){var tu=v.descriptorSet;X.has(th)||this._initShadowFrameBuffer(v,th,g.window.swapchain);var tl=X.get(th);if(th.shadowFixedArea)this._renderStage(g,th,tl,tu);else for(var tc=v.pipelineSceneData.csmSupported?th.csmLevel:1,t_=0;t_<tc;t_++)this._renderStage(g,th,tl,tu,t_)}for(var tf=0;tf<xb.length;tf++){var tp=xb[tf],tm=v.globalDSManager.getOrCreateDescriptorSet(tp);X.has(tp)||this._initShadowFrameBuffer(v,tp,g.window.swapchain);var tg=X.get(tp);this._renderStage(g,tp,tg,tm)}xb.length=0}else this.clearShadowMap(xb,g)}},v.destroy=function(){if(g.prototype.destroy.call(this),this._pipeline){for(var v=this._pipeline.pipelineSceneData.shadowFrameBufferMap,S=Array.from(v.values()),O=0;O<S.length;O++){var X=S[O];if(X){for(var Y=X.colorTextures,te=0;te<Y.length;te++){var ti=Y[te];ti&&ti.destroy()}Y.length=0;var tr=X.depthStencilTexture;tr&&tr.destroy(),X.destroy()}}v.clear()}this._shadowRenderPass&&this._shadowRenderPass.destroy()},v._initShadowFrameBuffer=function(g,v){var S=g.device,O=g.pipelineSceneData.shadows.size,X=g.pipelineSceneData.shadowFrameBufferMap,Y=kg(S)?oA.R32F:oA.RGBA8;if(!this._shadowRenderPass){var te=new hq;te.format=Y,te.loadOp=oH.CLEAR,te.storeOp=oz.STORE,te.sampleCount=1;var ti=new hY;ti.format=oA.DEPTH_STENCIL,ti.depthLoadOp=oH.CLEAR,ti.depthStoreOp=oz.DISCARD,ti.stencilLoadOp=oH.CLEAR,ti.stencilStoreOp=oz.DISCARD,ti.sampleCount=1;var tr=new hZ([te],ti);this._shadowRenderPass=S.createRenderPass(tr)}var ta=[];ta.push(S.createTexture(new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED,Y,O.x,O.y)));var th=S.createTexture(new hB(ow.TEX2D,oI.DEPTH_STENCIL_ATTACHMENT,oA.DEPTH_STENCIL,O.x,O.y)),tu=S.createFramebuffer(new h2(this._shadowRenderPass,ta,th));X.set(v,tu)},v._renderStage=function(g,v,S,O,X){void 0===X&&(X=0);for(var Y=0;Y<this._stages.length;Y++){var te=this._stages[Y];te.setUsage(O,v,S,X),te.render(g)}},v.clearShadowMap=function(g,v){var S=this._pipeline,O=S.pipelineSceneData,X=v.scene.mainLight;if(X){var Y=this._pipeline.descriptorSet;O.shadowFrameBufferMap.has(X)||this._initShadowFrameBuffer(this._pipeline,X,v.window.swapchain);for(var te=O.shadowFrameBufferMap.get(X),ti=0;ti<this._stages.length;ti++){var tr=this._stages[ti];tr.setUsage(Y,X,te),tr.clearFramebuffer(v)}}for(var ta=0;ta<g.length;ta++){var th=g[ta],tu=S.globalDSManager.getOrCreateDescriptorSet(th);O.shadowFrameBufferMap.has(th)||this._initShadowFrameBuffer(this._pipeline,th,v.window.swapchain);for(var tl=O.shadowFrameBufferMap.get(th),tc=0;tc<this._stages.length;tc++){var t_=this._stages[tc];t_.setUsage(tu,th,tl),t_.clearFramebuffer(v)}}},v.resizeShadowMap=function(){for(var g,v=this._pipeline.pipelineSceneData.shadows,S=v.size,O=this._pipeline,X=O.device,Y=O.pipelineSceneData.shadowFrameBufferMap,te=kg(X)?oA.R32F:oA.RGBA8,ti=f(Y.keys());!(g=ti()).done;){var tr=g.value,ta=Y.get(tr);if(ta){var th=[];th.push(O.device.createTexture(new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED,te,S.x,S.y)));var tu=ta.depthStencilTexture;tu&&tu.resize(S.x,S.y);var tl=ta.renderPass;ta.destroy();var tc=X.createFramebuffer(new h2(tl,th,tu));Y.set(tr,tc)}}v.shadowMapDirty=!1},e}(TC)).initInfo={name:__,priority:Tk.SHADOW,tag:Cu.SCENE,stages:[]},xA=xT))||xA),xI="CC_USE_RGBE_OUTPUT",xB=dH("default"),xD=dH("reflect-map");function bP(g){var v=g.passes,S=X.rendering;Ug()&&(xB=S.getPhaseID(S.getPassID("default"),"default"));for(var O=0;O<v.length;O++)if((!S||!S.enableEffectImport)&&v[O].phase===xB||Ug()&&v[O].phaseID===xB)return O;return -1}function xP(g){var v=g.passes,S=X.rendering;Ug()&&(xD=S.getPhaseID(S.getPassID("default"),"reflect-map"));for(var O=0;O<v.length;O++)if((!S||!S.enableEffectImport)&&v[O].phase===xD||Ug()&&v[O].phaseID===xD)return O;return -1}var xM,xO,xL,xF,xN,xk,xG,xV,xU,xH=function(){function t1(g){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._rgbeSubModelsArray=[],this._instancedQueue=void 0,this._patches=[],this._pipeline=g,this._instancedQueue=new CU}var g=t1.prototype;return g.gatherRenderObjects=function(g,v,S){this.clear();var O=v.scene,X=this._pipeline.pipelineSceneData.skybox;X.enabled&&X.model&&g.camera.clearFlag&pA&&this.add(X.model);for(var Y=O.models,te=g.visibility,ti=0;ti<Y.length;ti++){var tr=Y[ti];tr.node&&!O.isCulledByLod(v,tr)&&((te&tr.node.layer)===tr.node.layer||te&tr.visFlags)&&tr.enabled&&tr.worldBounds&&tr.bakeToReflectionProbe&&(g.probeType===pH.CUBE?nF.aabbWithAABB(tr.worldBounds,g.boundingBox)&&this.add(tr):nF.aabbFrustum(tr.worldBounds,g.camera.frustum)&&this.add(tr))}this._instancedQueue.uploadBuffers(S)},g.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._rgbeSubModelsArray.length=0},g.add=function(g){for(var v=g.subModels,S=0;S<v.length;S++){var O=v[S];if(!O.passes[0].blendState.targets[0].blend){var X=xP(O),Y=!0;if(X<0&&(X=bP(O),Y=!1),!(X<0)){var te=O.passes[X],ti=te.batchingScheme;if(!Y){this._patches=[],this._patches=this._patches.concat(O.patches);var tr=[{name:xI,value:!0}];this._patches=this._patches.concat(tr),O.onMacroPatchesStateChanged(this._patches),this._rgbeSubModelsArray.push(O)}if(ti===dG.INSTANCING){var ta=te.getInstancedBuffer();ta.merge(O,X),this._instancedQueue.queue.add(ta)}else{var th=O.shaders[X];this._subModelsArray.push(O),th&&this._shaderArray.push(th),this._passArray.push(te)}}}}},g.recordCommandBuffer=function(g,v,S){this._instancedQueue.recordCommandBuffer(g,v,S);for(var O=0;O<this._subModelsArray.length;++O){var X=this._subModelsArray[O],Y=this._shaderArray[O],te=this._passArray[O],ti=X.inputAssembler,tr=dK.getOrCreatePipelineState(g,te,Y,v,ti),ta=te.descriptorSet;S.bindPipelineState(tr),S.bindDescriptorSet(_S.MATERIAL,ta),S.bindDescriptorSet(_S.LOCAL,X.descriptorSet),S.bindInputAssembler(ti),S.draw(ti)}this.resetRGBEMacro(),this._instancedQueue.clear()},g.resetRGBEMacro=function(){for(var g=0;g<this._rgbeSubModelsArray.length;g++){this._patches=[];var v=this._rgbeSubModelsArray[g];if(this._patches=this._patches.concat(v.patches),this._patches){for(var S=0;S<this._patches.length;S++)if(this._patches[S].name===xI){this._patches.splice(S,1);break}v.onMacroPatchesStateChanged(this._patches)}}},t1}(),xz=[new hA(1,1,1,1)],xW=g("d9",nJ("ReflectionProbeStage")(((xO=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._frameBuffer=null,v._renderArea=new hl,v._probe=null,v._probeRenderQueue=void 0,v._rgbeColor=new eL,v}s(e,g);var v=e.prototype;return v.setUsageInfo=function(g,v){this._probe=g,this._frameBuffer=v},v.destroy=function(){var g;this._frameBuffer=null,null===(g=this._probeRenderQueue)||void 0===g||g.clear()},v.clearFramebuffer=function(g){if(this._frameBuffer){xz[0].w=g.clearColor.w;var v=this._pipeline,S=v.pipelineSceneData.shadingScale,O=g.viewport,X=this._probe.resolution;this._renderArea.x=O.x*X,this._renderArea.y=O.y*X,this._renderArea.width=O.width*X*S,this._renderArea.height=O.height*X*S;var Y=v.commandBuffers[0],te=this._frameBuffer.renderPass;Y.beginRenderPass(te,this._frameBuffer,this._renderArea,xz,g.clearDepth,g.clearStencil),Y.endRenderPass()}},v.render=function(g){var v=this._pipeline,S=v.commandBuffers[0];this._probeRenderQueue.gatherRenderObjects(this._probe,g,S),v.pipelineUBO.updateCameraUBO(this._probe.camera),this._renderArea.x=0,this._renderArea.y=0,this._renderArea.width=this._probe.renderArea().x,this._renderArea.height=this._probe.renderArea().y;var O=this._frameBuffer.renderPass;if(this._probe.camera.clearFlag&o7.COLOR){this._rgbeColor.x=this._probe.camera.clearColor.x,this._rgbeColor.y=this._probe.camera.clearColor.y,this._rgbeColor.z=this._probe.camera.clearColor.z;var X=function(g){var v=Math.max(Math.max(g.x,g.y),g.z),S=128;v>1e-4&&(S=Math.log(v)/Math.log(1.1),S=mi((S=Math.ceil(S))+128,0,255));var O=1/Math.pow(1.1,S-128),X=function(g,v,S){if(v>S){var O=v;v=S,S=O}return g<v?v:g>S?S:g}(g.multiplyScalar(O),new eL(0,0,0),new eL(1,1,1));X.multiplyScalar(255);var Y,te,ti=xn(X).add((Y=X.subtract(xn(X)))<(te=new eL(.5,.5,.5))?te:Y);return new e7(ti.x/255,ti.y/255,ti.z/255,S/255)}(this._rgbeColor);xz[0].x=X.x,xz[0].y=X.y,xz[0].z=X.z,xz[0].w=X.w}var Y=v.device;S.beginRenderPass(O,this._frameBuffer,this._renderArea,xz,this._probe.camera.clearDepth,this._probe.camera.clearStencil),S.bindDescriptorSet(_S.GLOBAL,v.descriptorSet),this._probeRenderQueue.recordCommandBuffer(Y,O,S),S.endRenderPass(),v.pipelineUBO.updateCameraUBO(g)},v.activate=function(v,S){g.prototype.activate.call(this,v,S),this._probeRenderQueue=new xH(v)},e}(TT)).initInfo={name:"ReflectionProbeStage",priority:TN.FORWARD,tag:0},xM=xO))||xM),xX=g("d8",nJ("ReflectionProbeFlow")(((xF=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.initialize=function(v){if(g.prototype.initialize.call(this,v),0===this._stages.length){var S=new xW;S.initialize(xW.initInfo),this._stages.push(S)}return!0},v.activate=function(v){g.prototype.activate.call(this,v)},v.render=function(g){if(X.internal.reflectionProbeManager)for(var v=X.internal.reflectionProbeManager.getProbes(),S=0;S<v.length;S++)v[S].needRender&&v[S].probeType===pH.PLANAR&&this._renderStage(g,v[S])},v.destroy=function(){g.prototype.destroy.call(this)},v._renderStage=function(g,v){for(var S=0;S<this._stages.length;S++){var O=this._stages[S];if(v.probeType===pH.PLANAR)X.internal.reflectionProbeManager.updatePlanarMap(v,null),O.setUsageInfo(v,v.realtimePlanarTexture.window.framebuffer),O.render(g),X.internal.reflectionProbeManager.updatePlanarMap(v,v.realtimePlanarTexture.getGFXTexture());else{for(var Y=0;Y<6;Y++){var te=v.bakedCubeTextures[Y];if(!te)return;v.updateCameraDir(Y),O.setUsageInfo(v,te.window.framebuffer),O.render(g)}v.needRender=!1}}},e}(TC)).initInfo={name:"PIPELINE_FLOW_RELECTION_PROBE",priority:0,tag:Cu.SCENE,stages:[]},xL=xF))||xL);function VP(){var g=new b_;return g.initialize({flows:[]}),g}var xj,xq,xY,xK,xJ,xZ,xQ,x$,x1,x2,x3,x5,x4,x8,x6,x7,x9,bs,ba,bo,bh,bu,bc,b_=g("cT",(xN=nJ("ForwardPipeline"),xk=ma([CL]),xN((xV=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).renderTextures=xU&&xU(),v._postRenderPass=null,v}s(e,g);var v=e.prototype;return v.initialize=function(v){if(g.prototype.initialize.call(this,v),0===this._flows.length){var S=new xw;S.initialize(xw.initInfo),this._flows.push(S);var O=new xX;O.initialize(xX.initInfo),this._flows.push(O);var X=new xm;X.initialize(xm.initInfo),this._flows.push(X)}return!0},v.activate=function(v){return this._macros={CC_PIPELINE_TYPE:0},this._pipelineSceneData=new CO,!(!g.prototype.activate.call(this,v)||!this._activeRenderer(v)&&(J(2402),1))},v._ensureEnoughSize=function(g){for(var v=this._width,S=this._height,O=0;O<g.length;++O){var X=g[O].window;v=Math.max(X.width,v),S=Math.max(X.height,S)}v===this._width&&S===this._height||(this._width=v,this._height=S)},v.destroy=function(){this._destroyUBOs(),this._destroyQuadInputAssembler();for(var v=this._renderPasses.values(),S=v.next();!S.done;)S.value.destroy(),S=v.next();return this._commandBuffers.length=0,g.prototype.destroy.call(this)},v._activeRenderer=function(){var g=this.device;this._commandBuffers.push(g.commandBuffer);var v=this.globalDSManager.pointSampler;return this._descriptorSet.bindSampler(_x,v),this._descriptorSet.bindTexture(_x,dU.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(_L,v),this._descriptorSet.bindTexture(_L,dU.get("default-texture").getGFXTexture()),this._descriptorSet.update(),!0},v._destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(vm.BINDING).destroy(),this._descriptorSet.getBuffer(Sm.BINDING).destroy(),this._descriptorSet.getBuffer(ym.BINDING).destroy(),this._descriptorSet.getTexture(_x).destroy(),this._descriptorSet.getTexture(_L).destroy())},n(e,[{key:"postRenderPass",get:function(){return this._postRenderPass}}]),e}(TO),xU=ws(xV.prototype,"renderTextures",[xk,n2],function(){return[]}),xG=xV))||xG)),bf=[new hA(0,0,0,0),new hA(0,0,0,0),new hA(0,0,0,0)],bd=g("cZ",(xj=nJ("GbufferStage"),xq=ma([CG]),xj(((xZ=function(g){function e(){var v;return(v=g.call(this)||this).renderQueues=xJ&&xJ(),v._renderQueues=[],v._renderArea=new hl,v._instancedQueue=void 0,v._phaseID=dH("default"),v._instancedQueue=new CU,v}s(e,g);var v=e.prototype;return v.initialize=function(v){return g.prototype.initialize.call(this,v),v.renderQueues&&(this.renderQueues=v.renderQueues),!0},v.activate=function(v,S){g.prototype.activate.call(this,v,S);for(var O=0;O<this.renderQueues.length;O++)this._renderQueues[O]=RB(this.renderQueues[O])},v.destroy=function(){},v.render=function(g){this._instancedQueue.clear();var v=this._pipeline,S=v.device;this._renderQueues.forEach(wB),v.generateRenderArea(g,this._renderArea),v.updateQuadVertexData(this._renderArea,g.window);for(var O=v.pipelineSceneData.renderObjects,X=0,Y=0,te=0,ti=0;ti<O.length;++ti){var tr=O[ti],ta=tr.model.subModels;for(X=0;X<ta.length;++X){var th=ta[X],tu=th.passes;for(Y=0;Y<tu.length;++Y){var tl=tu[Y];if(tl.phase===this._phaseID){if(tl.batchingScheme===dG.INSTANCING){var tc=tl.getInstancedBuffer();tc.merge(th,Y),this._instancedQueue.queue.add(tc)}else for(te=0;te<this._renderQueues.length;te++)this._renderQueues[te].insertRenderPass(tr,X,Y)}}}}this._renderQueues.forEach(IB);var t_=v.commandBuffers[0];this._instancedQueue.uploadBuffers(t_),g.clearFlag&o7.COLOR&&(v.pipelineSceneData.isHDR?lS(bf[0],g.clearColor):(bf[0].x=g.clearColor.x,bf[0].y=g.clearColor.y,bf[0].z=g.clearColor.z)),bf[0].w=g.clearColor.w;var tf=v.getPipelineRenderData().gbufferFrameBuffer,tp=tf.renderPass;t_.beginRenderPass(tp,tf,this._renderArea,bf,g.clearDepth,g.clearStencil),t_.setScissor(v.generateScissor(g)),t_.setViewport(v.generateViewport(g)),t_.bindDescriptorSet(_S.GLOBAL,v.descriptorSet);for(var tm=0;tm<this.renderQueues.length;tm++)this._renderQueues[tm].recordCommandBuffer(S,tp,t_);this._instancedQueue.recordCommandBuffer(S,tp,t_),t_.endRenderPass()},e}(TT)).initInfo={name:"GbufferStage",priority:TG.GBUFFER,tag:0,renderQueues:[{isTransparent:!1,sortMode:CF.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:CF.BACK_TO_FRONT,stages:["default"]}]},xJ=ws((xK=xZ).prototype,"renderQueues",[xq,n2],function(){return[]}),xY=xK))||xY)),bm=new eL,bg=new iK(0,0,0,.5,.5,.5),bv=new iK,by=[new hA(0,0,0,1)],bS=g("c_",(xQ=nJ("LightingStage"),x$=ma(pf),x1=ma([CG]),xQ(((x8=function(g){function e(){var v;return(v=g.call(this)||this)._deferredLitsBufs=null,v._maxDeferredLights=Vm.LIGHTS_PER_PASS,v._lightBufferData=void 0,v._lightMeterScale=1e4,v._descriptorSet=null,v._descriptorSetLayout=void 0,v._renderArea=new hl,v._uiPhase=void 0,v._deferredMaterial=x5&&x5(),v.renderQueues=x4&&x4(),v._phaseID=dH("default"),v._renderQueues=[],v._uiPhase=new xf,v}s(e,g);var v=e.prototype;return v.initialize=function(v){return g.prototype.initialize.call(this,v),!0},v.gatherLights=function(g){for(var v=this._pipeline,S=v.commandBuffers[0],O=g.scene.sphereLights,X=g.scene.spotLights,Y=g.scene.pointLights,te=g.scene.rangedDirLights,ti=iH.create(0,0,0,1),tr=new Float32Array(4),ta=g.exposure,th=0,tu=e7.length,tl=tu*this._maxDeferredLights,tc=0;tc<O.length&&th<this._maxDeferredLights;tc++,++th){var t_=O[tc];if(iH.set(ti,t_.position.x,t_.position.y,t_.position.z,t_.range),nF.sphereFrustum(ti,g.frustum)){if(eL.toArray(tr,t_.position),tr[3]=pJ.SPHERE,this._lightBufferData.set(tr,th*tu),eL.toArray(tr,t_.color),t_.useColorTemperature){var tf=t_.finalColor;tr[0]=tf.x,tr[1]=tf.y,tr[2]=tf.z}v.pipelineSceneData.isHDR?tr[3]=t_.luminance*ta*this._lightMeterScale:tr[3]=t_.luminance,this._lightBufferData.set(tr,th*tu+1*tl),tr[0]=t_.size,tr[1]=t_.range,tr[2]=0,this._lightBufferData.set(tr,th*tu+2*tl)}}for(var tp=0;tp<X.length&&th<this._maxDeferredLights;tp++,++th){var tm=X[tp];if(iH.set(ti,tm.position.x,tm.position.y,tm.position.z,tm.range),nF.sphereFrustum(ti,g.frustum)){if(eL.toArray(tr,tm.position),tr[3]=pJ.SPOT,this._lightBufferData.set(tr,th*tu+0*tl),eL.toArray(tr,tm.color),tm.useColorTemperature){var tg=tm.finalColor;tr[0]=tg.x,tr[1]=tg.y,tr[2]=tg.z}v.pipelineSceneData.isHDR?tr[3]=tm.luminance*ta*this._lightMeterScale:tr[3]=tm.luminance,this._lightBufferData.set(tr,th*tu+1*tl),tr[0]=tm.size,tr[1]=tm.range,tr[2]=tm.spotAngle,this._lightBufferData.set(tr,th*tu+2*tl),eL.toArray(tr,tm.direction),this._lightBufferData.set(tr,th*tu+3*tl)}}for(var tv=0;tv<Y.length&&th<this._maxDeferredLights;tv++,++th){var ty=Y[tv];if(iH.set(ti,ty.position.x,ty.position.y,ty.position.z,ty.range),nF.sphereFrustum(ti,g.frustum)){if(eL.toArray(tr,ty.position),tr[3]=pJ.POINT,this._lightBufferData.set(tr,th*tu),eL.toArray(tr,ty.color),ty.useColorTemperature){var tS=ty.finalColor;tr[0]=tS.x,tr[1]=tS.y,tr[2]=tS.z}v.pipelineSceneData.isHDR?tr[3]=ty.luminance*ta*this._lightMeterScale:tr[3]=ty.luminance,this._lightBufferData.set(tr,th*tu+1*tl),tr[0]=0,tr[1]=ty.range,tr[2]=0,this._lightBufferData.set(tr,th*tu+2*tl)}}for(var tA=0;tA<te.length&&th<this._maxDeferredLights;tA++,++th){var tT=te[tA];if(iK.transform(bv,bg,tT.node.getWorldMatrix()),nF.aabbFrustum(bv,g.frustum)){if(eL.toArray(tr,tT.position),tr[3]=pJ.RANGED_DIRECTIONAL,this._lightBufferData.set(tr,th*tu),eL.toArray(tr,tT.color),tT.useColorTemperature){var tE=tT.finalColor;tr[0]=tE.x,tr[1]=tE.y,tr[2]=tE.z}v.pipelineSceneData.isHDR?tr[3]=tT.illuminance*ta:tr[3]=tT.illuminance,this._lightBufferData.set(tr,th*tu+1*tl),eL.toArray(tr,tT.right),tr[3]=0,this._lightBufferData.set(tr,th*tu+2*tl),eL.toArray(tr,tT.direction),tr[3]=0,this._lightBufferData.set(tr,th*tu+3*tl);var tC=tT.scale;bm.set(.5*tC.x,.5*tC.y,.5*tC.z),eL.toArray(tr,bm),tr[3]=0,this._lightBufferData.set(tr,th*tu+4*tl)}}var tx=3*tl+3;this._lightBufferData.set([th],tx),S.updateBuffer(this._deferredLitsBufs,this._lightBufferData)},v._createStageDescriptor=function(g){var v=this._pipeline.device,S=16*Float32Array.BYTES_PER_ELEMENT*this._maxDeferredLights;S=Math.ceil(S/v.capabilities.uboOffsetAlignment)*v.capabilities.uboOffsetAlignment,this._deferredLitsBufs=v.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,S,v.capabilities.uboOffsetAlignment));var O=v.createBuffer(new hb(this._deferredLitsBufs,0,S));this._lightBufferData=new Float32Array(S/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet=v.createDescriptorSet(new h8(g.localSetLayout)),this._descriptorSet.bindBuffer(km.BINDING,O);var X=v.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.DEVICE,Mm.SIZE,Mm.SIZE));this._descriptorSet.bindBuffer(Mm.BINDING,X)},v.activate=function(v,S){g.prototype.activate.call(this,v,S),this._uiPhase.activate(v);for(var O=0;O<this.renderQueues.length;O++)this._renderQueues[O]=RB(this.renderQueues[O]);this._planarQueue=new x_(this._pipeline),this._deferredMaterial&&(v.pipelineSceneData.deferredLightingMaterial=this._deferredMaterial)},v.destroy=function(){var g;null===(g=this._deferredLitsBufs)||void 0===g||g.destroy(),this._deferredLitsBufs=null,this._descriptorSet=null},v.render=function(g){var v,S=this._pipeline,O=S.device,X=S.commandBuffers[0],Y=S.pipelineSceneData,te=Y.renderObjects;this._planarQueue.gatherShadowPasses(g,X),S.generateRenderArea(g,this._renderArea);for(var ti=S.getPipelineRenderData(),tr=Y.deferredLightingMaterial.passes[0],ta=tr.getShaderVariant(),th=0;th<3;++th)tr.descriptorSet.bindTexture(th,ti.gbufferRenderTargets[th]),tr.descriptorSet.bindSampler(th,ti.sampler);tr.descriptorSet.bindTexture(3,ti.outputDepth),tr.descriptorSet.bindSampler(3,ti.sampler),tr.descriptorSet.update(),this._descriptorSet||this._createStageDescriptor(tr),this.gatherLights(g),g.clearFlag&o7.COLOR&&(by[0].x=g.clearColor.x,by[0].y=g.clearColor.y,by[0].z=g.clearColor.z),by[0].w=0;var tu=ti.outputFrameBuffer,tl=tu.renderPass;S.pipelineUBO.updateShadowUBO(g),X.beginRenderPass(tl,tu,this._renderArea,by,g.clearDepth,g.clearStencil),X.setScissor(S.generateScissor(g)),X.setViewport(S.generateViewport(g)),X.bindDescriptorSet(_S.GLOBAL,S.descriptorSet);var tc=S.quadIAOffscreen,t_=null;null!=tr&&null!=ta&&null!=tc&&(t_=dK.getOrCreatePipelineState(O,tr,ta,tl,tc)),null!=t_&&(this._descriptorSet.update(),X.bindPipelineState(t_),X.bindDescriptorSet(_S.MATERIAL,tr.descriptorSet),X.bindDescriptorSet(_S.LOCAL,this._descriptorSet),X.bindInputAssembler(tc),X.draw(tc)),this._renderQueues.forEach(wB);for(var tf=0,tp=0,tm=0,tg=0;tg<te.length;++tg){var tv=te[tg],ty=tv.model.subModels;for(tf=0;tf<ty.length;++tf){var tS=ty[tf].passes;for(tp=0;tp<tS.length;++tp)if(tS[tp].phase===this._phaseID)for(tm=0;tm<this._renderQueues.length;tm++)this._renderQueues[tm].insertRenderPass(tv,tf,tp)}}if(te.length>0){this._renderQueues.forEach(IB);for(var tA=0;tA<this._renderQueues.length;tA++)this._renderQueues[tA].recordCommandBuffer(O,tl,X);this._planarQueue.recordCommandBuffer(O,tl,X)}null===(v=g.geometryRenderer)||void 0===v||v.render(tl,X,S.pipelineSceneData),this._uiPhase.render(g,tl),X.endRenderPass()},e}(TT)).initInfo={name:"LightingStage",priority:TG.LIGHTING,tag:0},x5=ws((x3=x8).prototype,"_deferredMaterial",[x$,n2],function(){return null}),x4=ws(x3.prototype,"renderQueues",[x1,n2],function(){return[]}),x2=x3))||x2)),bA=[new hA(0,0,0,1)],bT=g("d0",(x6=nJ("PostProcessStage"),x7=ma(pf),x9=ma([CG]),x6(((bu=function(g){function e(){var v;return(v=g.call(this)||this)._postProcessMaterial=bo&&bo(),v.renderQueues=bh&&bh(),v._renderArea=new hl,v._stageDesc=void 0,v._localUBO=void 0,v._uiPhase=new xf,v}s(e,g);var v=e.prototype;return v.initialize=function(v){return g.prototype.initialize.call(this,v),!0},v.activate=function(v,S){g.prototype.activate.call(this,v,S),this._postProcessMaterial&&(v.pipelineSceneData.postprocessMaterial=this._postProcessMaterial),this._uiPhase.activate(v)},v.destroy=function(){},v.render=function(g){var v=this._pipeline,S=v.device,O=v.pipelineSceneData,X=v.commandBuffers[0];v.pipelineUBO.updateCameraUBO(g);var Y=g.viewport;this._renderArea.x=Y.x*g.window.width,this._renderArea.y=Y.y*g.window.height,this._renderArea.width=Y.width*g.window.width,this._renderArea.height=Y.height*g.window.height;var te=v.getPipelineRenderData(),ti=g.window.framebuffer,tr=v.getRenderPass(g.clearFlag,ti);g.clearFlag&o7.COLOR&&(bA[0].x=g.clearColor.x,bA[0].y=g.clearColor.y,bA[0].z=g.clearColor.z),bA[0].w=g.clearColor.w,X.beginRenderPass(tr,ti,this._renderArea,bA,g.clearDepth,g.clearStencil),X.bindDescriptorSet(_S.GLOBAL,v.descriptorSet);var ta=O.postprocessMaterial.passes[0],th=ta.getShaderVariant();v.bloomEnabled?ta.descriptorSet.bindTexture(0,te.bloom.combineTex):ta.descriptorSet.bindTexture(0,te.outputRenderTargets[0]),ta.descriptorSet.bindSampler(0,te.sampler),ta.descriptorSet.update();var tu=g.window.swapchain?v.quadIAOnscreen:v.quadIAOffscreen,tl=null;null!=ta&&null!=th&&null!=tu&&(tl=dK.getOrCreatePipelineState(S,ta,th,tr,tu));var tc=v.pipelineSceneData.renderObjects;null!=tl&&tc.length>0&&(this._stageDesc||(this._stageDesc=S.createDescriptorSet(new h8(ta.localSetLayout)),this._localUBO=S.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.DEVICE,Mm.SIZE,Mm.SIZE)),this._stageDesc.bindBuffer(Mm.BINDING,this._localUBO)),this._stageDesc.update(),X.bindPipelineState(tl),X.bindDescriptorSet(_S.MATERIAL,ta.descriptorSet),X.bindDescriptorSet(_S.LOCAL,this._stageDesc),X.bindInputAssembler(tu),X.draw(tu)),this._uiPhase.render(g,tr),TS(S,tr,X,v.profiler,g),X.endRenderPass()},e}(TT)).initInfo={name:"PostProcessStage",priority:TF.POST_PROCESS,tag:0},bo=ws((ba=bu).prototype,"_postProcessMaterial",[x7,n2],function(){return null}),bh=ws(ba.prototype,"renderQueues",[x9,n2],function(){return[]}),bs=ba))||bs));!function(g){g[g.NONE=0]="NONE",g[g.FXAA=1]="FXAA"}(bc||(bc={}));var bE,bC,bx,bb,bR,bw,bI,bD=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._antiAliasing=bc.NONE,v}s(e,g);var v=e.prototype;return v.updatePipelineSceneData=function(){this.updatePipelinePassInfo()},v.updateBloomPass=function(){if(this._bloomMaterial){var g=this._bloomMaterial.passes[0];g.beginChangeStatesSilently(),g.tryCompile(),g.endChangeStatesSilently();for(var v=0;v<6;++v){var S=this._bloomMaterial.passes[1+v];S.beginChangeStatesSilently(),S.tryCompile(),S.endChangeStatesSilently();var O=this._bloomMaterial.passes[7+v];O.beginChangeStatesSilently(),O.tryCompile(),O.endChangeStatesSilently()}var X=this._bloomMaterial.passes[13];X.beginChangeStatesSilently(),X.tryCompile(),X.endChangeStatesSilently()}},v.updatePostProcessPass=function(){if(this.postprocessMaterial){var g=this.postprocessMaterial.passes[0];g.beginChangeStatesSilently(),g.tryCompile(),g.endChangeStatesSilently()}},v.initPipelinePassInfo=function(){var g=new pf;g._uuid="builtin-deferred-material",g.initialize({effectName:"pipeline/deferred-lighting"});for(var v=0;v<g.passes.length;++v)g.passes[v].tryCompile();this._deferredLightingMaterial=g;var S=new pf;S._uuid="builtin-bloom-material",S.initialize({effectName:"pipeline/bloom"});for(var O=0;O<S.passes.length;++O)S.passes[O].tryCompile();this._bloomMaterial=S;var X=new pf;X._uuid="builtin-post-process-material",X.initialize({effectName:"pipeline/post-process",defines:{ANTIALIAS_TYPE:this._antiAliasing}});for(var Y=0;Y<X.passes.length;++Y)X.passes[Y].tryCompile();this._postprocessMaterial=X,this.updatePipelinePassInfo()},v.updatePipelinePassInfo=function(){this.updateBloomPass(),this.updatePostProcessPass(),this.updateDeferredPassInfo()},v.activate=function(v){return g.prototype.activate.call(this,v),this.initPipelinePassInfo(),!0},v.updateDeferredPassInfo=function(){this.updateDeferredLightPass()},v.updateDeferredLightPass=function(){if(this._deferredLightingMaterial){X.director.root.pipeline.macros.CC_RECEIVE_SHADOW=1;var g=this._deferredLightingMaterial.passes[0];g.beginChangeStatesSilently(),g.tryCompile(),g.endChangeStatesSilently()}},n(e,[{key:"antiAliasing",get:function(){return this._antiAliasing},set:function(g){if(this._antiAliasing=g,this._postprocessMaterial){var v=this._postprocessMaterial.passes[0].defines;Object.assign(v,{ANTIALIAS_TYPE:g});var S=new pf;S.initialize({effectAsset:this._postprocessMaterial.effectAsset,defines:v});for(var O=0;O<S.passes.length;++O)S.passes[O].tryCompile();this._postprocessMaterial=S}}},{key:"bloomMaterial",get:function(){return this._bloomMaterial},set:function(g){this._bloomMaterial!==g&&g&&(this._bloomMaterial=g,this.updatePipelinePassInfo())}},{key:"postprocessMaterial",get:function(){return this._postprocessMaterial},set:function(g){this._postprocessMaterial!==g&&g&&(this._postprocessMaterial=g,this.updatePipelinePassInfo())}},{key:"deferredLightingMaterial",get:function(){return this._deferredLightingMaterial},set:function(g){this._deferredLightingMaterial!==g&&g&&(this._deferredLightingMaterial=g,this.updatePipelinePassInfo())}}]),e}(CO),bM=[new hA(0,0,0,1)],ID=function(){};bE=ID,ID.TEXTURE_SIZE_OFFSET=0,ID.COUNT=bE.TEXTURE_SIZE_OFFSET+4,ID.SIZE=4*bE.COUNT;var bO,bF,bN,bk,bG,bV,bU,bH,bz,bW,bX=g("c$",(bC=nJ("BloomStage"),bx=ma(pf),bC(((bI=function(g){function e(){var v;return(v=g.call(this)||this).threshold=1,v.intensity=.8,v.iterations=2,v._bloomMaterial=bw&&bw(),v._renderArea=new hl,v._bloomUBO=[],v}s(e,g);var v=e.prototype;return v.initialize=function(v){return g.prototype.initialize.call(this,v),!0},v.activate=function(v,S){g.prototype.activate.call(this,v,S),this._bloomMaterial&&(v.pipelineSceneData.bloomMaterial=this._bloomMaterial)},v.destroy=function(){},v.render=function(g){var v,S=this._pipeline;if(S.generateBloomRenderData(),(null!==(v=g.window)&&void 0!==v&&v.swapchain||S.macros.CC_PIPELINE_TYPE)&&S.bloomEnabled&&0!==S.pipelineSceneData.renderObjects.length){if(0===this._bloomUBO.length)for(var O=0;O<14;++O)this._bloomUBO[O]=S.device.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,ID.SIZE,ID.SIZE));g.clearFlag&o7.COLOR&&(bM[0].x=g.clearColor.x,bM[0].y=g.clearColor.y,bM[0].z=g.clearColor.z),bM[0].w=g.clearColor.w,this._prefilterPass(g,S),this._downsamplePass(g,S),this._upsamplePass(g,S),this._combinePass(g,S)}},v._prefilterPass=function(g,v){v.generateRenderArea(g,this._renderArea),this._renderArea.width>>=1,this._renderArea.height>>=1;var S=v.commandBuffers[0],O=v.pipelineSceneData.bloomMaterial.passes[0],X=v.getPipelineRenderData(),Y=X.bloom,te=new Float32Array(ID.COUNT);te[ID.TEXTURE_SIZE_OFFSET+2]=this.threshold,S.updateBuffer(this._bloomUBO[0],te),S.beginRenderPass(Y.renderPass,Y.prefilterFramebuffer,this._renderArea,bM,0,0),S.bindDescriptorSet(_S.GLOBAL,v.descriptorSet),O.descriptorSet.bindBuffer(0,this._bloomUBO[0]),O.descriptorSet.bindTexture(1,X.outputRenderTargets[0]),O.descriptorSet.bindSampler(1,Y.sampler),O.descriptorSet.update(),S.bindDescriptorSet(_S.MATERIAL,O.descriptorSet);var ti=g.window.swapchain?v.quadIAOffscreen:v.quadIAOnscreen,tr=null,ta=O.getShaderVariant();null!=O&&null!=ta&&null!=ti&&(tr=dK.getOrCreatePipelineState(v.device,O,ta,Y.renderPass,ti)),null!=tr&&(S.bindPipelineState(tr),S.bindInputAssembler(ti),S.draw(ti)),S.endRenderPass()},v._downsamplePass=function(g,v){v.generateRenderArea(g,this._renderArea),this._renderArea.width>>=1,this._renderArea.height>>=1;for(var S=v.commandBuffers[0],O=v.pipelineSceneData.bloomMaterial,X=v.getPipelineRenderData().bloom,Y=new Float32Array(ID.COUNT),te=0;te<this.iterations;++te){Y[ID.TEXTURE_SIZE_OFFSET+0]=this._renderArea.width,Y[ID.TEXTURE_SIZE_OFFSET+1]=this._renderArea.height,S.updateBuffer(this._bloomUBO[te+1],Y),this._renderArea.width>>=1,this._renderArea.height>>=1,S.beginRenderPass(X.renderPass,X.downsampleFramebuffers[te],this._renderArea,bM,0,0);var ti=O.passes[1+te],tr=ti.getShaderVariant();ti.descriptorSet.bindBuffer(0,this._bloomUBO[te+1]),0===te?ti.descriptorSet.bindTexture(1,X.prefiterTex):ti.descriptorSet.bindTexture(1,X.downsampleTexs[te-1]),ti.descriptorSet.bindSampler(1,X.sampler),ti.descriptorSet.update(),S.bindDescriptorSet(_S.MATERIAL,ti.descriptorSet);var ta=g.window.swapchain?v.quadIAOffscreen:v.quadIAOnscreen,th=null;null!=ti&&null!=tr&&null!=ta&&(th=dK.getOrCreatePipelineState(v.device,ti,tr,X.renderPass,ta)),null!=th&&(S.bindPipelineState(th),S.bindInputAssembler(ta),S.draw(ta)),S.endRenderPass()}},v._upsamplePass=function(g,v){var S=v.getPipelineRenderData().bloom;v.generateRenderArea(g,this._renderArea),this._renderArea.width>>=this.iterations+1,this._renderArea.height>>=this.iterations+1;for(var O=v.commandBuffers[0],X=v.pipelineSceneData.bloomMaterial,Y=new Float32Array(ID.COUNT),te=0;te<this.iterations;++te){var ti=te+6+1;Y[ID.TEXTURE_SIZE_OFFSET+0]=this._renderArea.width,Y[ID.TEXTURE_SIZE_OFFSET+1]=this._renderArea.height,O.updateBuffer(this._bloomUBO[ti],Y),this._renderArea.width<<=1,this._renderArea.height<<=1,O.beginRenderPass(S.renderPass,S.upsampleFramebuffers[this.iterations-1-te],this._renderArea,bM,0,0);var tr=X.passes[7+te],ta=tr.getShaderVariant();tr.descriptorSet.bindBuffer(0,this._bloomUBO[ti]),0===te?tr.descriptorSet.bindTexture(1,S.downsampleTexs[this.iterations-1]):tr.descriptorSet.bindTexture(1,S.upsampleTexs[this.iterations-te]),tr.descriptorSet.bindSampler(1,S.sampler),tr.descriptorSet.update(),O.bindDescriptorSet(_S.MATERIAL,tr.descriptorSet);var th=g.window.swapchain?v.quadIAOffscreen:v.quadIAOnscreen,tu=null;null!=tr&&null!=ta&&null!=th&&(tu=dK.getOrCreatePipelineState(v.device,tr,ta,S.renderPass,th)),null!=tu&&(O.bindPipelineState(tu),O.bindInputAssembler(th),O.draw(th)),O.endRenderPass()}},v._combinePass=function(g,v){v.generateRenderArea(g,this._renderArea);var S=v.commandBuffers[0],O=v.pipelineSceneData.bloomMaterial,X=v.getPipelineRenderData(),Y=X.bloom,te=new Float32Array(ID.COUNT);te[ID.TEXTURE_SIZE_OFFSET+3]=this.intensity,S.updateBuffer(this._bloomUBO[13],te),S.beginRenderPass(Y.renderPass,Y.combineFramebuffer,this._renderArea,bM,0,0),S.bindDescriptorSet(_S.GLOBAL,v.descriptorSet);var ti=O.passes[13];ti.descriptorSet.bindBuffer(0,this._bloomUBO[13]),ti.descriptorSet.bindTexture(1,X.outputRenderTargets[0]),ti.descriptorSet.bindTexture(2,Y.upsampleTexs[0]),ti.descriptorSet.bindSampler(1,Y.sampler),ti.descriptorSet.bindSampler(2,Y.sampler),ti.descriptorSet.update(),S.bindDescriptorSet(_S.MATERIAL,ti.descriptorSet);var tr=g.window.swapchain?v.quadIAOffscreen:v.quadIAOnscreen,ta=null,th=ti.getShaderVariant();null!=ti&&null!=th&&null!=tr&&(ta=dK.getOrCreatePipelineState(v.device,ti,th,Y.renderPass,tr)),null!=ta&&(S.bindPipelineState(ta),S.bindInputAssembler(tr),S.draw(tr)),S.endRenderPass()},e}(TT)).initInfo={name:"BloomStage",priority:TF.BLOOM,tag:0},bw=ws((bR=bI).prototype,"_bloomMaterial",[bx,n2],function(){return null}),bb=bR))||bb)),bj=g("cY",nJ("MainFlow")(((bF=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.initialize=function(v){if(g.prototype.initialize.call(this,v),0===this._stages.length){var S=new bd;S.initialize(bd.initInfo),this._stages.push(S);var O=new bS;O.initialize(bS.initInfo),this._stages.push(O);var X=new bX;X.initialize(bX.initInfo),this._stages.push(X);var Y=new bT;Y.initialize(bT.initInfo),this._stages.push(Y)}return!0},v.activate=function(v){g.prototype.activate.call(this,v)},v.render=function(v){g.prototype.render.call(this,v)},v.destroy=function(){g.prototype.destroy.call(this)},e}(TC)).initInfo={name:_l,priority:TV.MAIN,stages:[]},bO=bF))||bO),bq=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).gbufferFrameBuffer=null,v.gbufferRenderTargets=[],v}return s(e,g),e}(function(){this.outputFrameBuffer=null,this.outputRenderTargets=[],this.outputDepth=null,this.sampler=null,this.bloom=null}),bY=g("cX",(bN=nJ("DeferredPipeline"),bk=ma([CL]),bN((bV=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gbufferRenderPass=null,v._lightingRenderPass=null,v.renderTextures=bU&&bU(),v}s(e,g);var v=e.prototype;return v.initialize=function(v){if(g.prototype.initialize.call(this,v),0===this._flows.length){var S=new xw;S.initialize(xw.initInfo),this._flows.push(S);var O=new bj;O.initialize(bj.initInfo),this._flows.push(O)}return!0},v.activate=function(v){return this._macros={CC_PIPELINE_TYPE:1},this._pipelineSceneData=new bD,!(!g.prototype.activate.call(this,v)||!this._activeRenderer(v)&&(J(2402),1))},v.destroy=function(){this._destroyUBOs(),this._destroyQuadInputAssembler(),this._destroyDeferredData();for(var v=this._renderPasses.values(),S=v.next();!S.done;)S.value.destroy(),S=v.next();return this._commandBuffers.length=0,g.prototype.destroy.call(this)},v.onGlobalPipelineStateChanged=function(){this.pipelineSceneData.updatePipelineSceneData()},v.getPipelineRenderData=function(){return this._pipelineRenderData||this._generateDeferredRenderData(),this._pipelineRenderData},v._activeRenderer=function(g){var v=this.device;this._commandBuffers.push(v.commandBuffer);var S=this.globalDSManager.pointSampler;this._descriptorSet.bindSampler(_x,S),this._descriptorSet.bindTexture(_x,dU.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(_L,S),this._descriptorSet.bindTexture(_L,dU.get("default-texture").getGFXTexture()),this._descriptorSet.update();var O=new vw;if(!(O=this._createQuadInputAssembler()).quadIB||!O.quadVB||!O.quadIA)return!1;this._quadIB=O.quadIB,this._quadVBOffscreen=O.quadVB,this._quadIAOffscreen=O.quadIA;var X=this._createQuadInputAssembler();if(!X.quadIB||!X.quadVB||!X.quadIA)return!1;if(this._quadVBOnscreen=X.quadVB,this._quadIAOnscreen=X.quadIA,!this._gbufferRenderPass){var Y=new hq;Y.format=oA.RGBA16F,Y.loadOp=oH.CLEAR,Y.storeOp=oz.STORE;var te=new hq;te.format=oA.RGBA16F,te.loadOp=oH.CLEAR,te.storeOp=oz.STORE;var ti=new hq;ti.format=oA.RGBA16F,ti.loadOp=oH.CLEAR,ti.storeOp=oz.STORE;var tr=new hY;tr.format=oA.DEPTH_STENCIL,tr.depthLoadOp=oH.CLEAR,tr.depthStoreOp=oz.STORE,tr.stencilLoadOp=oH.CLEAR,tr.stencilStoreOp=oz.STORE;var ta=new hZ([Y,te,ti],tr);this._gbufferRenderPass=v.createRenderPass(ta)}if(!this._lightingRenderPass){var th=new hq;th.format=oA.RGBA8,th.loadOp=oH.CLEAR,th.storeOp=oz.STORE,th.barrier=v.getGeneralBarrier(new h$(oW.NONE,oW.COLOR_ATTACHMENT_WRITE));var tu=new hY;tu.format=oA.DEPTH_STENCIL,tu.depthLoadOp=oH.LOAD,tu.depthStoreOp=oz.DISCARD,tu.stencilLoadOp=oH.LOAD,tu.stencilStoreOp=oz.DISCARD,th.barrier=v.getGeneralBarrier(new h$(oW.DEPTH_STENCIL_ATTACHMENT_WRITE,oW.DEPTH_STENCIL_ATTACHMENT_WRITE));var tl=new hZ([th],tu);this._lightingRenderPass=v.createRenderPass(tl)}return this._width=g.width,this._height=g.height,this._generateDeferredRenderData(),!0},v._destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(vm.BINDING).destroy(),this._descriptorSet.getBuffer(Sm.BINDING).destroy(),this._descriptorSet.getBuffer(ym.BINDING).destroy(),this._descriptorSet.getTexture(_x).destroy(),this._descriptorSet.getTexture(_L).destroy())},v._destroyDeferredData=function(){var g=this._pipelineRenderData;if(g){g.gbufferFrameBuffer&&g.gbufferFrameBuffer.destroy(),g.outputFrameBuffer&&g.outputFrameBuffer.destroy(),g.outputDepth&&g.outputDepth.destroy();for(var v=0;v<g.gbufferRenderTargets.length;v++)g.gbufferRenderTargets[v].destroy();g.gbufferRenderTargets.length=0;for(var S=0;S<g.outputRenderTargets.length;S++)g.outputRenderTargets[S].destroy();g.outputRenderTargets.length=0,this._destroyBloomData()}this._pipelineRenderData=null},v._ensureEnoughSize=function(g){for(var v=this._width,S=this._height,O=0;O<g.length;++O){var X=g[O].window;v=Math.max(X.width,v),S=Math.max(X.height,S)}v===this._width&&S===this._height||(this._width=v,this._height=S,this._destroyDeferredData(),this._generateDeferredRenderData())},v._generateDeferredRenderData=function(){for(var g=this,v=this.device,S=this._pipelineRenderData=new bq,O=this.pipelineSceneData,X=0;X<3;++X)S.gbufferRenderTargets.push(v.createTexture(new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED,oA.RGBA16F,this._width*O.shadingScale,this._height*O.shadingScale)));S.outputDepth=v.createTexture(new hB(ow.TEX2D,oI.DEPTH_STENCIL_ATTACHMENT|oI.SAMPLED,oA.DEPTH_STENCIL,this._width*O.shadingScale,this._height*O.shadingScale)),S.gbufferFrameBuffer=v.createFramebuffer(new h2(this._gbufferRenderPass,S.gbufferRenderTargets,S.outputDepth)),S.outputRenderTargets.push(v.createTexture(new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED,oA.RGBA16F,this._width*O.shadingScale,this._height*O.shadingScale))),S.outputFrameBuffer=v.createFramebuffer(new h2(this._lightingRenderPass,S.outputRenderTargets,null)),S.sampler=this.globalDSManager.pointSampler,this.on(TE.ATTACHMENT_SCALE_CAHNGED,function(v){S.sampler=v<1?g.globalDSManager.pointSampler:g.globalDSManager.linearSampler,S.gbufferFrameBuffer=g.newFramebufferByRatio(S.gbufferFrameBuffer),S.gbufferFrameBuffer=g.newFramebufferByRatio(S.outputFrameBuffer)})},e}(TO),bU=ws(bV.prototype,"renderTextures",[bk,n2],function(){return[]}),bG=bV))||bG));!function(g){g[g.NONE=-1]="NONE",g[g.LEFT=0]="LEFT",g[g.RIGHT=1]="RIGHT"}(bH||(bH={})),function(g){g[g.SESSION_RUNNING=2]="SESSION_RUNNING",g[g.VIEW_COUNT=6]="VIEW_COUNT",g[g.SWAPCHAIN_WIDTH=7]="SWAPCHAIN_WIDTH",g[g.SWAPCHAIN_HEIGHT=8]="SWAPCHAIN_HEIGHT",g[g.DEVICE_IPD=37]="DEVICE_IPD",g[g.SPLIT_AR_GLASSES=42]="SPLIT_AR_GLASSES"}(bz||(bz={})),function(g){g[g.VIEW_LEFT=0]="VIEW_LEFT",g[g.HAND_LEFT=1]="HAND_LEFT",g[g.AIM_LEFT=2]="AIM_LEFT",g[g.VIEW_RIGHT=3]="VIEW_RIGHT",g[g.HAND_RIGHT=4]="HAND_RIGHT",g[g.AIM_RIGHT=5]="AIM_RIGHT",g[g.HEAD_MIDDLE=6]="HEAD_MIDDLE"}(bW||(bW={}));var bK=new e8,bJ=function(){var g=e.prototype;function e(){this.settings=void 0,this._curTime=0,this.device=void 0,this.swapchain=void 0,this.shader=void 0,this.sampler=void 0,this.cmdBuff=void 0,this.quadAssmebler=void 0,this.vertexBuffers=void 0,this.indicesBuffers=void 0,this.renderArea=void 0,this.clearColors=void 0,this.projection=void 0,this.isMobile=!1,this.bgMat=void 0,this.bgImage=void 0,this.bgTexture=void 0,this.logoMat=void 0,this.logoImage=void 0,this.logoTexture=void 0,this.watermarkMat=void 0,this.watermarkTexture=void 0,this.bgWidth=1920,this.bgHeight=1080,this.bgRatio=16/9,this.logoWidthTemp=140,this.logoHeightTemp=200,this.logoWidth=0,this.logoHeight=0,this.logoXTrans=.5,this.logoYTrans=1/6+2.5/6,this.textSize=24,this.textHeight=24,this.textXTrans=.5,this.textYExtraTrans=32,this.textExpandSize=4,this.scaleSize=1}return g.init=function(){var g,v,S,O,Y,ti,tr=this;if(this.settings={displayRatio:null!==(g=tQ.querySettings(tK.Category.SPLASH_SCREEN,"displayRatio"))&&void 0!==g?g:.4,totalTime:null!==(v=tQ.querySettings(tK.Category.SPLASH_SCREEN,"totalTime"))&&void 0!==v?v:3e3,watermarkLocation:null!==(S=tQ.querySettings(tK.Category.SPLASH_SCREEN,"watermarkLocation"))&&void 0!==S?S:"default",autoFit:null===(O=tQ.querySettings(tK.Category.SPLASH_SCREEN,"autoFit"))||void 0===O||O,logo:null!==(Y=tQ.querySettings(tK.Category.SPLASH_SCREEN,"logo"))&&void 0!==Y?Y:void 0,background:null!==(ti=tQ.querySettings(tK.Category.SPLASH_SCREEN,"background"))&&void 0!==ti?ti:void 0},this._curTime=0,!(this.settings.totalTime<=0||void 0===this.settings.logo||void 0===this.settings.background)){this.device=X.director.root.device,this.swapchain=X.director.root.mainWindow.swapchain,this.preInit(),this.initLayout(),"default"===this.settings.logo.type&&this.initWaterMark();var ta=Promise.resolve(),th=Promise.resolve();return"custom"===this.settings.background.type&&(ta=new Promise(function(g,v){tr.bgImage=new te.Image,tr.bgImage.onload=function(){tr.initBG(),g()},tr.bgImage.onerror=function(){v()},tr.bgImage.src=tr.settings.background.base64})),"none"!==this.settings.logo.type&&(th=new Promise(function(g,v){tr.logoImage=new te.Image,tr.logoImage.onload=function(){tr.initLogo(),g()},tr.logoImage.onerror=function(){v()},tr.logoImage.src=tr.settings.logo.base64})),Promise.all([ta,th])}return this.settings.totalTime=0,Promise.resolve([])},g.preInit=function(){var g,v=null===(g=this.settings.background)||void 0===g?void 0:g.color;this.clearColors=v?[new hA(v.x,v.y,v.z,v.w)]:[new hA(0,0,0,1)];var S=this.device,O=this.swapchain;this.renderArea=new hl(0,0,O.width,O.height),this.cmdBuff=S.commandBuffer;var X=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),Y=4*Float32Array.BYTES_PER_ELEMENT,te=4*Y;this.vertexBuffers=S.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,te,Y)),this.vertexBuffers.update(X);var ti=new Uint16Array([0,1,2,1,3,2]),tr=Uint16Array.BYTES_PER_ELEMENT,ta=6*tr;this.indicesBuffers=S.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.DEVICE,ta,tr)),this.indicesBuffers.update(ti);var th=[new hz("a_position",oA.RG32F),new hz("a_texCoord",oA.RG32F)],tu=new hX(th,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=S.createInputAssembler(tu),this.projection=new e$,e$.ortho(this.projection,-1,1,-1,1,-1,1,S.capabilities.clipSpaceMinZ,S.capabilities.clipSpaceSignY,O.surfaceTransform),this.isMobile=a3.isMobile},g.initLayout=function(){this.isMobile?(this.bgWidth=812,this.bgHeight=375,this.logoWidthTemp=70,this.logoHeightTemp=100,this.textSize=12,this.textHeight=this.textSize+this.textExpandSize,this.textXTrans=.5,this.textYExtraTrans=16):(this.bgWidth=1920,this.bgHeight=1080,this.logoWidthTemp=140,this.logoHeightTemp=200,this.textSize=24,this.textHeight=this.textSize+this.textExpandSize,this.textXTrans=.5,this.textYExtraTrans=32),this.logoXTrans=.5,this.logoYTrans=1/6+2.5/6,this.initScale()},g.initScale=function(){var g=this.swapchain.width,v=this.swapchain.height,S=this.isMobile?375:1080,O=this.isMobile?812:1920;if(g>v){var X=O;O=S,S=X}this.scaleSize=g/v>16/9?v/O:g/S},g.update=function(g){var v=this.settings,S=this.device,O=this.swapchain;e$.ortho(this.projection,-1,1,-1,1,-1,1,S.capabilities.clipSpaceMinZ,S.capabilities.clipSpaceSignY,O.surfaceTransform);var X=O.width,Y=O.height;this.initScale(),this._curTime+=1e3*g;var te=Ya(gi(this._curTime/v.totalTime)),ti=1,tr=1;"custom"===this.settings.background.type&&(X<Y?(ti=Y*this.bgRatio,tr=Y):(ti=X,tr=X*this.bgRatio),this.bgMat.setProperty("resolution",bK.set(X,Y),0),this.bgMat.setProperty("scale",bK.set(ti,tr),0),this.bgMat.setProperty("translate",bK.set(.5*X,.5*Y),0),this.bgMat.setProperty("percent",1),this.bgMat.setProperty("u_projection",this.projection),this.bgMat.passes[0].update());var ta=Y*this.logoYTrans;if("none"!==this.settings.logo.type&&(ti=this.logoWidth*this.scaleSize*v.displayRatio,tr=this.logoHeight*this.scaleSize*v.displayRatio,this.logoMat.setProperty("resolution",bK.set(X,Y),0),this.logoMat.setProperty("scale",bK.set(ti,tr),0),this.logoMat.setProperty("translate",bK.set(X*this.logoXTrans,ta),0),this.logoMat.setProperty("percent",te),this.logoMat.setProperty("u_projection",this.projection),this.logoMat.passes[0].update()),"default"===this.settings.logo.type&&this.watermarkMat){var th=this.watermarkTexture.width,tu=this.watermarkTexture.height;ti=th,tr=tu;var tl=ta-(.5*this.logoHeight*v.displayRatio+this.textYExtraTrans)*this.scaleSize-.5*tu;this.watermarkMat.setProperty("resolution",bK.set(X,Y),0),this.watermarkMat.setProperty("scale",bK.set(ti,tr),0),this.watermarkMat.setProperty("translate",bK.set(X*this.textXTrans,tl),0),this.watermarkMat.setProperty("percent",te),this.watermarkMat.setProperty("u_projection",this.projection),this.watermarkMat.passes[0].update()}this.frame()},g.initBG=function(){var g=this.device;this.bgMat=new pf,this.bgMat.initialize({effectName:"util/splash-screen"});var v=new hD;v.addressU=oL.CLAMP,v.addressV=oL.CLAMP,v.addressW=oL.CLAMP,this.sampler=g.getSampler(v),this.bgTexture=g.createTexture(new hB(ow.TEX2D,oI.SAMPLED|oI.TRANSFER_DST,oA.RGBA8,this.bgImage.width,this.bgImage.height));var S=this.bgMat.passes[0],O=S.getBinding("mainTexture");S.bindTexture(O,this.bgTexture),this.shader=S.getShaderVariant();var X=S.descriptorSet;X.bindSampler(O,this.sampler),X.update();var Y=new hg;Y.texExtent.width=this.bgImage.width,Y.texExtent.height=this.bgImage.height,Y.texExtent.depth=1,g.copyTexImagesToTexture([this.bgImage],this.bgTexture,[Y])},g.initLogo=function(){var g=this.device;this.logoMat=new pf,this.logoMat.initialize({effectName:"util/splash-screen"});var v=new hD;v.addressU=oL.CLAMP,v.addressV=oL.CLAMP,v.addressW=oL.CLAMP,this.sampler=g.getSampler(v),this.logoTexture=g.createTexture(new hB(ow.TEX2D,oI.SAMPLED|oI.TRANSFER_DST,oA.RGBA8,this.logoImage.width,this.logoImage.height));var S=this.logoMat.passes[0],O=S.getBinding("mainTexture");S.bindTexture(O,this.logoTexture),this.shader=S.getShaderVariant();var X=S.descriptorSet;X.bindSampler(O,this.sampler),X.update();var Y=new hg;Y.texExtent.width=this.logoImage.width,Y.texExtent.height=this.logoImage.height,Y.texExtent.depth=1,g.copyTexImagesToTexture([this.logoImage],this.logoTexture,[Y]);var te=this.logoImage.width/this.logoImage.height;te<1?(this.logoWidth=this.logoWidthTemp,this.logoHeight=this.logoWidthTemp/te):(this.logoWidth=this.logoHeightTemp*te,this.logoHeight=this.logoHeightTemp)},g.initWaterMark=function(){var g=te.document.createElement("canvas");g.height=this.textHeight*this.scaleSize,g.style.width=""+g.width,g.style.height=""+g.height;var v="Created with Cocos",S=g.getContext("2d");S.font=this.textSize*this.scaleSize+"px Arial",S.textBaseline="top",S.textAlign="center",S.fillStyle="#707070";var O=S.measureText(v).width+10;g.width=O,S.font=this.textSize*this.scaleSize+"px Arial",S.textBaseline="top",S.textAlign="center",S.fillStyle="#707070",S.fillText(v,g.width/2,0);var X=new hg;X.texExtent.width=g.width,X.texExtent.height=g.height,X.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new hB(ow.TEX2D,oI.SAMPLED|oI.TRANSFER_DST,oA.RGBA8,g.width,g.height)),this.device.copyTexImagesToTexture([g],this.watermarkTexture,[X]),this.watermarkMat=new pf,this.watermarkMat.initialize({effectName:"util/splash-screen"});var Y=this.watermarkMat.passes[0],ti=Y.getBinding("mainTexture");Y.bindTexture(ti,this.watermarkTexture),Y.descriptorSet.update()},g.frame=function(){var g=this.device,v=this.swapchain;if(!a3.isXR||xr.entry.isRenderAllowable())for(var S=a3.isXR?2:1,O=0;O<S;O++){if(a3.isXR){xr.entry.renderLoopStart(O);var Y=xr.entry.getEyeFov(O),te=1,ti=1;O===bH.LEFT?te=Math.abs(Math.tan(Y[0]))/Math.abs(Math.tan(Y[1])):O===bH.RIGHT&&(ti=Math.abs(Math.tan(Y[1]))/Math.abs(Math.tan(Y[0]))),e$.ortho(this.projection,-te,ti,-1,1,-1,1,g.capabilities.clipSpaceMinZ,g.capabilities.clipSpaceSignY,v.surfaceTransform),this.projection.m00=eQ[v.surfaceTransform][0],this.projection.m05=eQ[v.surfaceTransform][3]*g.capabilities.clipSpaceSignY,"custom"===this.settings.background.type&&(this.bgMat.setProperty("u_projection",this.projection),this.bgMat.passes[0].update()),"none"!==this.settings.logo.type&&(this.logoMat.setProperty("u_projection",this.projection),this.logoMat.passes[0].update()),"default"===this.settings.logo.type&&this.watermarkMat&&(this.watermarkMat.setProperty("u_projection",this.projection),this.watermarkMat.passes[0].update())}g.enableAutoBarrier(!0),g.acquire([v]);var tr=this.cmdBuff,ta=X.director.root.mainWindow.framebuffer,th=this.renderArea;if(th.width=v.width,th.height=v.height,tr.begin(),tr.beginRenderPass(ta.renderPass,ta,th,this.clearColors,1,0),"custom"===this.settings.background.type){var tu=this.bgMat.passes[0],tl=dK.getOrCreatePipelineState(g,tu,this.shader,ta.renderPass,this.quadAssmebler);tr.bindPipelineState(tl),tr.bindDescriptorSet(_S.MATERIAL,tu.descriptorSet),tr.bindInputAssembler(this.quadAssmebler),tr.draw(this.quadAssmebler)}if("none"!==this.settings.logo.type){var tc=this.logoMat.passes[0],t_=dK.getOrCreatePipelineState(g,tc,this.shader,ta.renderPass,this.quadAssmebler);tr.bindPipelineState(t_),tr.bindDescriptorSet(_S.MATERIAL,tc.descriptorSet),tr.bindInputAssembler(this.quadAssmebler),tr.draw(this.quadAssmebler)}if("default"===this.settings.logo.type&&this.watermarkMat){var tf=this.watermarkMat.passes[0],tp=dK.getOrCreatePipelineState(g,tf,this.shader,ta.renderPass,this.quadAssmebler);tr.bindPipelineState(tp),tr.bindDescriptorSet(_S.MATERIAL,tf.descriptorSet),tr.bindInputAssembler(this.quadAssmebler),tr.draw(this.quadAssmebler)}tr.endRenderPass(),tr.end(),g.flushCommands([tr]),g.queue.submit([tr]),g.present(),g.enableAutoBarrier(!X.rendering),a3.isXR&&xr.entry.renderLoopEnd(O)}},g.destroy=function(){this.device=null,this.swapchain=null,this.clearColors=null,"custom"===this.settings.background.type&&(this.bgImage.destroy&&this.bgImage.destroy(),this.bgImage=null,this.bgMat.destroy(),this.bgMat=null,this.bgTexture.destroy(),this.bgTexture=null),"none"!==this.settings.logo.type&&(this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null),this.renderArea=null,this.cmdBuff=null,this.shader=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler=null,"default"===this.settings.logo.type&&this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null},n(e,[{key:"isFinished",get:function(){return this._curTime>=this.settings.totalTime}},{key:"curTime",get:function(){return this._curTime},set:function(g){this._curTime=g}}],[{key:"instance",get:function(){return e._ins||(e._ins=new e),e._ins}}]),e}();bJ._ins=void 0,X.internal.SplashScreen=bJ;var bZ,bQ,b$=g("e8",function(){function t1(g,v){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=g,this.bubbles=!!v}var g=t1.prototype;return g.unuse=function(){this.type=t1.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=t1.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},g.reuse=function(g,v){this.type=g,this.bubbles=v||!1},g.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},g.getCurrentTarget=function(){return this.currentTarget},g.getType=function(){return this.type},t1}());b$.NO_TYPE="no_type",b$.TOUCH="touch",b$.MOUSE="mouse",b$.KEYBOARD="keyboard",b$.ACCELERATION="acceleration",b$.NONE=0,b$.CAPTURING_PHASE=1,b$.AT_TARGET=2,b$.BUBBLING_PHASE=3,X.Event=b$,g("e7",bZ),function(g){g.TOUCH_START="touch-start",g.TOUCH_MOVE="touch-move",g.TOUCH_END="touch-end",g.TOUCH_CANCEL="touch-cancel",g.MOUSE_DOWN="mouse-down",g.MOUSE_MOVE="mouse-move",g.MOUSE_UP="mouse-up",g.MOUSE_WHEEL="mouse-wheel",g.MOUSE_ENTER="mouse-enter",g.MOUSE_LEAVE="mouse-leave",g.KEY_DOWN="keydown",g.KEY_UP="keyup",g.DEVICEMOTION="devicemotion",g.TRANSFORM_CHANGED="transform-changed",g.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",g.SIZE_CHANGED="size-changed",g.ANCHOR_CHANGED="anchor-changed",g.COLOR_CHANGED="color-changed",g.CHILD_ADDED="child-added",g.CHILD_REMOVED="child-removed",g.PARENT_CHANGED="parent-changed",g.NODE_DESTROYED="node-destroyed",g.LAYER_CHANGED="layer-changed",g.SIBLING_ORDER_CHANGED="sibling-order-changed"}(bZ||g("e7",bZ={})),function(g){g.TOUCH_START="touch-start",g.TOUCH_MOVE="touch-move",g.TOUCH_END="touch-end",g.TOUCH_CANCEL="touch-cancel",g.MOUSE_DOWN="mouse-down",g.MOUSE_MOVE="mouse-move",g.MOUSE_UP="mouse-up",g.MOUSE_WHEEL="mouse-wheel",g.KEY_DOWN="keydown",g.KEY_PRESSING="key-pressing",g.KEY_UP="keyup",g.DEVICEMOTION="devicemotion",g.GAMEPAD_INPUT="gamepad-input",g.GAMEPAD_CHANGE="gamepad-change",g.HANDLE_INPUT="handle-input",g.HANDLE_POSE_INPUT="handle-pose-input",g.HMD_POSE_INPUT="hmd-pose-input",g.HANDHELD_POSE_INPUT="handheld-pose-input"}(bQ||(bQ={})),X.SystemEventType=bZ;var b0=g("e9",function(g){function e(v,S){var O;return(O=g.call(this,bZ.DEVICEMOTION,S)||this).acc=void 0,O.acc=v,O}return s(e,g),e}(b$));b$.EventAcceleration=b0;var b1=g("ea",function(g){function e(v,S,O){var X;return"boolean"==typeof S&&(S=S?bZ.KEY_DOWN:bZ.KEY_UP),(X=g.call(this,S,O)||this).windowId=void 0,X.keyCode=void 0,X.rawEvent=void 0,X._isPressed=void 0,X._isPressed=S!==bZ.KEY_UP,"number"==typeof v?X.keyCode=v:(X.keyCode=v.keyCode,X.rawEvent=v),X.windowId=0,X}return s(e,g),n(e,[{key:"isPressed",get:function(){return this._isPressed}}]),e}(b$));b$.EventKeyboard=b1;var b2=g("eb",function(g){function e(v,S,O,X){var Y;return(Y=g.call(this,v,S)||this).movementX=0,Y.movementY=0,Y.windowId=0,Y.preventSwallow=!1,Y._eventType=void 0,Y._button=e.BUTTON_MISSING,Y._x=0,Y._y=0,Y._prevX=0,Y._prevY=0,Y._scrollX=0,Y._scrollY=0,Y._eventType=v,O&&(Y._prevX=O.x,Y._prevY=O.y),Y.windowId=null!=X?X:Y.windowId,Y}s(e,g);var v=e.prototype;return v.setScrollData=function(g,v){this._scrollX=g,this._scrollY=v},v.getScrollX=function(){return this._scrollX},v.getScrollY=function(){return this._scrollY},v.setLocation=function(g,v){this._x=g,this._y=v},v.getLocation=function(g){return g||(g=new e8),e8.set(g,this._x,this._y),g},v.getLocationInView=function(g){return g||(g=new e8),e8.set(g,this._x,X.view._designResolutionSize.height-this._y),g},v.getUILocation=function(g){return g||(g=new e8),e8.set(g,this._x,this._y),X.view._convertToUISpace(g),g},v.getPreviousLocation=function(g){return g||(g=new e8),e8.set(g,this._prevX,this._prevY),g},v.getUIPreviousLocation=function(g){return g||(g=new e8),e8.set(g,this._prevX,this._prevY),X.view._convertToUISpace(g),g},v.getDelta=function(g){return g||(g=new e8),e8.set(g,this._x-this._prevX,this._y-this._prevY),g},v.getDeltaX=function(){return this._x-this._prevX},v.getDeltaY=function(){return this._y-this._prevY},v.getUIDelta=function(g){return g||(g=new e8),e8.set(g,(this._x-this._prevX)/X.view.getScaleX(),(this._y-this._prevY)/X.view.getScaleY()),g},v.getUIDeltaX=function(){return(this._x-this._prevX)/X.view.getScaleX()},v.getUIDeltaY=function(){return(this._y-this._prevY)/X.view.getScaleY()},v.setButton=function(g){this._button=g},v.getButton=function(){return this._button},v.getLocationX=function(){return this._x},v.getLocationY=function(){return this._y},v.getUILocationX=function(){var g=X.view.getViewportRect();return(this._x-g.x)/X.view.getScaleX()},v.getUILocationY=function(){var g=X.view.getViewportRect();return(this._y-g.y)/X.view.getScaleY()},n(e,[{key:"eventType",get:function(){return this._eventType}}]),e}(b$));b2.BUTTON_MISSING=-1,b2.BUTTON_LEFT=0,b2.BUTTON_RIGHT=2,b2.BUTTON_MIDDLE=1,b2.BUTTON_4=3,b2.BUTTON_5=4,b2.BUTTON_6=5,b2.BUTTON_7=6,b2.BUTTON_8=7,b$.EventMouse=b2;var b5=new e8,b4=g("ec",function(g){function e(v,S,O,X){var Y;return void 0===X&&(X=[]),(Y=g.call(this,O,S)||this).touch=null,Y.simulate=!1,Y.windowId=0,Y.preventSwallow=!1,Y._eventCode=void 0,Y._touches=void 0,Y._allTouches=void 0,Y._eventCode=O,Y._touches=v||[],Y._allTouches=X,Y}s(e,g);var v=e.prototype;return v.getEventCode=function(){return this._eventCode},v.getTouches=function(){return this._touches},v.getAllTouches=function(){return this._allTouches},v.setLocation=function(g,v){this.touch&&this.touch.setTouchInfo(this.touch.getID(),g,v)},v.getLocation=function(g){return this.touch?this.touch.getLocation(g):new e8},v.getUILocation=function(g){return this.touch?this.touch.getUILocation(g):new e8},v.getLocationInView=function(g){return this.touch?this.touch.getLocationInView(g):new e8},v.getPreviousLocation=function(g){return this.touch?this.touch.getPreviousLocation(g):new e8},v.getStartLocation=function(g){return this.touch?this.touch.getStartLocation(g):new e8},v.getUIStartLocation=function(g){return this.touch?this.touch.getUIStartLocation(g):new e8},v.getID=function(){return this.touch?this.touch.getID():null},v.getDelta=function(g){return this.touch?this.touch.getDelta(g):new e8},v.getUIDelta=function(g){return this.touch?this.touch.getUIDelta(g):new e8},v.getDeltaX=function(){return this.touch?this.touch.getDelta(b5).x:0},v.getDeltaY=function(){return this.touch?this.touch.getDelta(b5).y:0},v.getLocationX=function(){return this.touch?this.touch.getLocationX():0},v.getLocationY=function(){return this.touch?this.touch.getLocationY():0},e}(b$));b4.MAX_TOUCHES=5,b$.EventTouch=b4;var b8,b6=g("ed",function(g){function e(v,S){var O;return(O=g.call(this,v,!1)||this).gamepad=void 0,O.gamepad=S,O}return s(e,g),e}(b$)),b7=g("ee",function(g){function e(v,S){var O;return(O=g.call(this,v,!1)||this).handleInputDevice=void 0,O.handleInputDevice=S,O}return s(e,g),e}(b$)),b9=g("ef",function(g){function e(v,S){var O;return(O=g.call(this,v,!1)||this).hmdInputDevice=void 0,O.hmdInputDevice=S,O}return s(e,g),e}(b$)),Rn=(g("eg",function(g){function e(v,S){var O;return(O=g.call(this,v,!1)||this).handheldInputDevice=void 0,O.handheldInputDevice=S,O}return s(e,g),e}(b$)),g("eh",function(g,v,S,O){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),void 0===O&&(O=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=g,this.y=v,this.z=S,this.timestamp=O}));g("ei",b8),function(g){g[g.NONE=0]="NONE",g[g.MOBILE_BACK=6]="MOBILE_BACK",g[g.BACKSPACE=8]="BACKSPACE",g[g.TAB=9]="TAB",g[g.ENTER=13]="ENTER",g[g.SHIFT_LEFT=16]="SHIFT_LEFT",g[g.CTRL_LEFT=17]="CTRL_LEFT",g[g.ALT_LEFT=18]="ALT_LEFT",g[g.PAUSE=19]="PAUSE",g[g.CAPS_LOCK=20]="CAPS_LOCK",g[g.ESCAPE=27]="ESCAPE",g[g.SPACE=32]="SPACE",g[g.PAGE_UP=33]="PAGE_UP",g[g.PAGE_DOWN=34]="PAGE_DOWN",g[g.END=35]="END",g[g.HOME=36]="HOME",g[g.ARROW_LEFT=37]="ARROW_LEFT",g[g.ARROW_UP=38]="ARROW_UP",g[g.ARROW_RIGHT=39]="ARROW_RIGHT",g[g.ARROW_DOWN=40]="ARROW_DOWN",g[g.INSERT=45]="INSERT",g[g.DELETE=46]="DELETE",g[g.DIGIT_0=48]="DIGIT_0",g[g.DIGIT_1=49]="DIGIT_1",g[g.DIGIT_2=50]="DIGIT_2",g[g.DIGIT_3=51]="DIGIT_3",g[g.DIGIT_4=52]="DIGIT_4",g[g.DIGIT_5=53]="DIGIT_5",g[g.DIGIT_6=54]="DIGIT_6",g[g.DIGIT_7=55]="DIGIT_7",g[g.DIGIT_8=56]="DIGIT_8",g[g.DIGIT_9=57]="DIGIT_9",g[g.KEY_A=65]="KEY_A",g[g.KEY_B=66]="KEY_B",g[g.KEY_C=67]="KEY_C",g[g.KEY_D=68]="KEY_D",g[g.KEY_E=69]="KEY_E",g[g.KEY_F=70]="KEY_F",g[g.KEY_G=71]="KEY_G",g[g.KEY_H=72]="KEY_H",g[g.KEY_I=73]="KEY_I",g[g.KEY_J=74]="KEY_J",g[g.KEY_K=75]="KEY_K",g[g.KEY_L=76]="KEY_L",g[g.KEY_M=77]="KEY_M",g[g.KEY_N=78]="KEY_N",g[g.KEY_O=79]="KEY_O",g[g.KEY_P=80]="KEY_P",g[g.KEY_Q=81]="KEY_Q",g[g.KEY_R=82]="KEY_R",g[g.KEY_S=83]="KEY_S",g[g.KEY_T=84]="KEY_T",g[g.KEY_U=85]="KEY_U",g[g.KEY_V=86]="KEY_V",g[g.KEY_W=87]="KEY_W",g[g.KEY_X=88]="KEY_X",g[g.KEY_Y=89]="KEY_Y",g[g.KEY_Z=90]="KEY_Z",g[g.NUM_0=96]="NUM_0",g[g.NUM_1=97]="NUM_1",g[g.NUM_2=98]="NUM_2",g[g.NUM_3=99]="NUM_3",g[g.NUM_4=100]="NUM_4",g[g.NUM_5=101]="NUM_5",g[g.NUM_6=102]="NUM_6",g[g.NUM_7=103]="NUM_7",g[g.NUM_8=104]="NUM_8",g[g.NUM_9=105]="NUM_9",g[g.NUM_MULTIPLY=106]="NUM_MULTIPLY",g[g.NUM_PLUS=107]="NUM_PLUS",g[g.NUM_SUBTRACT=109]="NUM_SUBTRACT",g[g.NUM_DECIMAL=110]="NUM_DECIMAL",g[g.NUM_DIVIDE=111]="NUM_DIVIDE",g[g.F1=112]="F1",g[g.F2=113]="F2",g[g.F3=114]="F3",g[g.F4=115]="F4",g[g.F5=116]="F5",g[g.F6=117]="F6",g[g.F7=118]="F7",g[g.F8=119]="F8",g[g.F9=120]="F9",g[g.F10=121]="F10",g[g.F11=122]="F11",g[g.F12=123]="F12",g[g.NUM_LOCK=144]="NUM_LOCK",g[g.SCROLL_LOCK=145]="SCROLL_LOCK",g[g.SEMICOLON=186]="SEMICOLON",g[g.EQUAL=187]="EQUAL",g[g.COMMA=188]="COMMA",g[g.DASH=189]="DASH",g[g.PERIOD=190]="PERIOD",g[g.SLASH=191]="SLASH",g[g.BACK_QUOTE=192]="BACK_QUOTE",g[g.BRACKET_LEFT=219]="BRACKET_LEFT",g[g.BACKSLASH=220]="BACKSLASH",g[g.BRACKET_RIGHT=221]="BRACKET_RIGHT",g[g.QUOTE=222]="QUOTE",g[g.SHIFT_RIGHT=2e3]="SHIFT_RIGHT",g[g.CTRL_RIGHT=2001]="CTRL_RIGHT",g[g.ALT_RIGHT=2002]="ALT_RIGHT",g[g.NUM_ENTER=2003]="NUM_ENTER"}(b8||g("ei",b8={}));var Rr=new e8,Ra=g("ej",function(){function t1(g,v,S){void 0===S&&(S=0),this._point=new e8,this._prevPoint=new e8,this._lastModified=0,this._id=0,this._startPoint=new e8,this._startPointCaptured=!1,this.setTouchInfo(S,g,v)}var g=t1.prototype;return g.getLocation=function(g){return g||(g=new e8),g.set(this._point.x,this._point.y),g},g.getLocationX=function(){return this._point.x},g.getLocationY=function(){return this._point.y},g.getUILocation=function(g){return g||(g=new e8),g.set(this._point.x,this._point.y),X.view._convertToUISpace(g),g},g.getUILocationX=function(){var g=X.view.getViewportRect();return(this._point.x-g.x)/X.view.getScaleX()},g.getUILocationY=function(){var g=X.view.getViewportRect();return(this._point.y-g.y)/X.view.getScaleY()},g.getPreviousLocation=function(g){return g||(g=new e8),g.set(this._prevPoint.x,this._prevPoint.y),g},g.getUIPreviousLocation=function(g){return g||(g=new e8),g.set(this._prevPoint.x,this._prevPoint.y),X.view._convertToUISpace(g),g},g.getStartLocation=function(g){return g||(g=new e8),g.set(this._startPoint.x,this._startPoint.y),g},g.getUIStartLocation=function(g){return g||(g=new e8),g.set(this._startPoint.x,this._startPoint.y),X.view._convertToUISpace(g),g},g.getDelta=function(g){return g||(g=new e8),g.set(this._point),g.subtract(this._prevPoint),g},g.getUIDelta=function(g){return g||(g=new e8),Rr.set(this._point),Rr.subtract(this._prevPoint),g.set(X.view.getScaleX(),X.view.getScaleY()),e8.divide(g,Rr,g),g},g.getLocationInView=function(g){return g||(g=new e8),g.set(this._point.x,X.view._designResolutionSize.height-this._point.y),g},g.getPreviousLocationInView=function(g){return g||(g=new e8),g.set(this._prevPoint.x,X.view._designResolutionSize.height-this._prevPoint.y),g},g.getStartLocationInView=function(g){return g||(g=new e8),g.set(this._startPoint.x,X.view._designResolutionSize.height-this._startPoint.y),g},g.getID=function(){return this._id},g.setTouchInfo=function(g,v,S){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),this._prevPoint=this._point,this._point=new e8(v||0,S||0),this._id=g,this._startPointCaptured||(this._startPoint=new e8(this._point),this._startPointCaptured=!0)},g.setPoint=function(g,v){"object"==(void 0===g?"undefined":_type_of(g))?(this._point.x=g.x,this._point.y=g.y):(this._point.x=g||0,this._point.y=v||0),this._lastModified=X.game.frameStartTime},g.setPrevPoint=function(g,v){this._prevPoint="object"==(void 0===g?"undefined":_type_of(g))?new e8(g.x,g.y):new e8(g||0,v||0),this._lastModified=X.game.frameStartTime},g.clone=function(){var g=this.getID();this.getStartLocation(Rr);var v=new t1(Rr.x,Rr.y,g);return this.getLocation(Rr),v.setPoint(Rr.x,Rr.y),this.getPreviousLocation(Rr),v.setPrevPoint(Rr),v},n(t1,[{key:"lastModified",get:function(){return this._lastModified}}]),t1}());X.Touch=Ra;var Ro=function(){function t1(){this._intervalInMileSeconds=200,this._accelTimer=0,this._eventTarget=new aC,this._deviceEventName=void 0,this._globalEventClass=void 0,this._didAccelerateFunc=void 0,this._globalEventClass=window.DeviceMotionEvent||window.DeviceOrientationEvent,aD.browserType===ax.MOBILE_QQ&&(this._globalEventClass=window.DeviceOrientationEvent),this._deviceEventName=this._globalEventClass===window.DeviceMotionEvent?"devicemotion":"deviceorientation",this._didAccelerateFunc=this._didAccelerate.bind(this)}var g=t1.prototype;return g._registerEvent=function(){this._accelTimer=performance.now(),window.addEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},g._unregisterEvent=function(){this._accelTimer=0,window.removeEventListener(this._deviceEventName,this._didAccelerateFunc,!1)},g._didAccelerate=function(g){var v=performance.now();if(!(v-this._accelTimer<this._intervalInMileSeconds)){this._accelTimer=v;var S=0,O=0,X=0;if(this._globalEventClass===window.DeviceMotionEvent){var Y=g.accelerationIncludingGravity;S=.1*((null==Y?void 0:Y.x)||0),O=.1*((null==Y?void 0:Y.y)||0),X=.1*((null==Y?void 0:Y.z)||0)}else{var te=g;S=(te.gamma||0)/90*.981,O=-(te.beta||0)/90*.981,X=(te.alpha||0)/90*.981}if(a$.isFrameRotated){var ti=S;S=-O,O=ti}var tr=S;90===window.orientation?(S=-O,O=tr):-90===window.orientation?(S=O,O=-tr):180===window.orientation&&(S=-S,O=-O),aD.os===aw.ANDROID&&aD.browserType!==ax.MOBILE_QQ&&(S=-S,O=-O);var ta=performance.now(),th=new Rn(S,O,X,ta),tu=new b0(th);this._eventTarget.emit(bQ.DEVICEMOTION,tu)}},g.start=function(){var g=this;window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(function(v){"granted"===v&&g._registerEvent()}).catch(function(g){G(g)}):this._registerEvent()},g.stop=function(){this._unregisterEvent()},g.setInterval=function(g){this._intervalInMileSeconds=g},g.on=function(g,v,S){this._eventTarget.on(g,v,S)},t1}(),hO=function(){},Ru=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.getValue=function(){throw new Error("Method not implemented.")},e}(hO),Rl=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.getValue=function(){throw new Error("Method not implemented.")},e}(hO),Rc=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.getValue=function(){throw new Error("Method not implemented.")},e}(hO),Rf=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.getValue=function(){throw new Error("Method not implemented.")},e}(hO),Rd=function(g){function e(v){var S;return(S=g.call(this)||this).positive=void 0,S.negative=void 0,S.positive=v.positive,S.negative=v.negative,S}return s(e,g),e.prototype.getValue=function(){var g=this.positive.getValue(),v=this.negative.getValue();return Math.abs(g)>Math.abs(v)?g:-v},e}(Ru),Rp=function(g){function e(v){var S;return(S=g.call(this)||this).up=void 0,S.down=void 0,S.left=void 0,S.right=void 0,S.xAxis=void 0,S.yAxis=void 0,S.up=v.up,S.down=v.down,S.left=v.left,S.right=v.right,S.xAxis=new Rd({positive:S.right,negative:S.left}),S.yAxis=new Rd({positive:S.up,negative:S.down}),S}return s(e,g),e.prototype.getValue=function(){return new e8(this.xAxis.getValue(),this.yAxis.getValue())},e}(Rl);!function(g){function e(v){var S;return(S=g.call(this)||this).up=void 0,S.down=void 0,S.left=void 0,S.right=void 0,S.forward=void 0,S.backward=void 0,S.xAxis=void 0,S.yAxis=void 0,S.zAxis=void 0,S.up=v.up,S.down=v.down,S.left=v.left,S.right=v.right,S.forward=v.forward,S.backward=v.backward,S.xAxis=new Rd({positive:S.right,negative:S.left}),S.yAxis=new Rd({positive:S.up,negative:S.down}),S.zAxis=new Rd({positive:S.forward,negative:S.backward}),S}s(e,g),e.prototype.getValue=function(){return new eL(this.xAxis.getValue(),this.yAxis.getValue(),this.zAxis.getValue())}}(Rc);var Rm,Rg=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.getValue=function(){return g.prototype.getValue.call(this)},e}(Ru),Rv=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(Rp),RS=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(Rp),RA=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.getValue=function(){return g.prototype.getValue.call(this)},e}(Rf),RT=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.getValue=function(){return g.prototype.getValue.call(this)},e}(Rc),RE=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.getValue=function(){return g.prototype.getValue.call(this)},e}(Ru),RC="left",Rx="right",Rb=[];!function(g){g[g.HAND_LEFT=1]="HAND_LEFT",g[g.HAND_RIGHT=4]="HAND_RIGHT",g[g.AIM_LEFT=2]="AIM_LEFT",g[g.AIM_RIGHT=5]="AIM_RIGHT"}(Rm||(Rm={}));var RR,Rw,RI,RP,RD,RM=function(){function t1(g){var v;this._buttonNorth=void 0,this._buttonEast=void 0,this._buttonWest=void 0,this._buttonSouth=void 0,this._buttonL1=void 0,this._buttonL2=void 0,this._buttonL3=void 0,this._buttonR1=void 0,this._buttonR2=void 0,this._buttonR3=void 0,this._buttonShare=void 0,this._buttonOptions=void 0,this._dpad=void 0,this._leftStick=void 0,this._rightStick=void 0,this._buttonStart=void 0,this._gripLeft=void 0,this._gripRight=void 0,this._handLeftPosition=void 0,this._handLeftOrientation=void 0,this._handRightPosition=void 0,this._handRightOrientation=void 0,this._aimLeftPosition=void 0,this._aimLeftOrientation=void 0,this._aimRightPosition=void 0,this._aimRightOrientation=void 0,this._deviceId=-1,this._connected=!1,this._webPoseState=((v={})[Rm.HAND_LEFT]={position:eL.ZERO,orientation:eW.IDENTITY},v[Rm.HAND_RIGHT]={position:eL.ZERO,orientation:eW.IDENTITY},v[Rm.AIM_LEFT]={position:eL.ZERO,orientation:eW.IDENTITY},v[Rm.AIM_RIGHT]={position:eL.ZERO,orientation:eW.IDENTITY},v),this._deviceId=g,this._initInputSource()}t1._init=function(){aD.hasFeature(aB.EVENT_GAMEPAD)&&t1._registerEvent()},t1._on=function(g,v,S){t1._eventTarget.on(g,v,S)},t1._removeInputDevice=function(g){var v=t1.all.findIndex(function(v){return v.deviceId===g});-1!==v&&Kt(t1.all,v)},t1._getOrCreateInputDevice=function(g,v){var S=t1.all.find(function(v){return v.deviceId===g});return S||(S=new t1(g),t1.all.push(S)),S._connected=v,S},t1._ensureDirectorDefined=function(g){t1._intervalId=setInterval(function(){X.director&&X.Director&&(clearInterval(t1._intervalId),t1._intervalId=-1,g())},50)},t1._updateGamepadCnt=function(){for(var g=0,v=0,S=t1._cachedWebGamepads.length;v<S;v++)t1._cachedWebGamepads[v]&&g++;t1._totalGamepadCnt=g},t1._registerEvent=function(){t1._ensureDirectorDefined(function(){t1._cachedWebGamepads=t1._getWebGamePads(),t1._updateGamepadCnt(),X.director.on(X.Director.EVENT_BEGIN_FRAME,t1._scanGamepads)}),window.addEventListener("gamepadconnected",function(g){t1._cachedWebGamepads[g.gamepad.index]=g.gamepad,t1._updateGamepadCnt();var v=t1._getOrCreateInputDevice(g.gamepad.index,!0);t1._eventTarget.emit(bQ.GAMEPAD_CHANGE,new b6(bQ.GAMEPAD_CHANGE,v))}),window.addEventListener("gamepaddisconnected",function(g){t1._cachedWebGamepads[g.gamepad.index]=null,t1._updateGamepadCnt();var v=t1._getOrCreateInputDevice(g.gamepad.index,!1);t1._removeInputDevice(g.gamepad.index),t1._eventTarget.emit(bQ.GAMEPAD_CHANGE,new b6(bQ.GAMEPAD_CHANGE,v))})},t1._scanWebGamepads=function(g){if(0!==t1._totalGamepadCnt){var v=t1._getWebGamePads();if(v){for(var S=0;S<v.length;++S){var O=v[S];if(O){var X=t1._cachedWebGamepads[O.index];if(X){for(var Y=void 0,te=X.buttons,ti=0;ti<te.length;++ti){var tr=te[ti],ta=O.buttons[ti];if(Math.abs(tr.value-ta.value)>.01){Y=t1._getOrCreateInputDevice(O.index,!0);break}}if(Y){g.push(Y);continue}for(var th=X.axes,tu=0;tu<th.length;++tu){var tl=th[tu],tc=O.axes[tu];if(Math.abs(tl-tc)>.01){Y=t1._getOrCreateInputDevice(O.index,!0);break}}if(Y){g.push(Y);continue}}}}t1._cachedWebGamepads=v}}},t1._scanGamepads=function(){Rb.length=0,t1._scanWebGamepads(Rb),t1._scanWebXRGamepads(Rb);for(var g=0;g<Rb.length;++g){var v=Rb[g];t1._eventTarget.emit(bQ.GAMEPAD_INPUT,new b6(bQ.GAMEPAD_INPUT,v))}t1._scanWebXRGamepadsPose()},t1._scanWebXRGamepads=function(g){var v,S,O=t1._getWebXRGamepadMap();if(!O)return t1._cachedWebXRGamepadMap=null,void(t1.xr&&t1.xr._connected&&(t1.xr._connected=!1,t1._eventTarget.emit(bQ.GAMEPAD_CHANGE,new b6(bQ.GAMEPAD_CHANGE,t1.xr)),g.push(t1.xr)));t1.xr||(t1.xr=new t1(-1));var X=O.get(RC),Y=O.get(Rx);X||Y?t1.xr._connected||(t1.xr._connected=!0,t1._eventTarget.emit(bQ.GAMEPAD_CHANGE,new b6(bQ.GAMEPAD_CHANGE,t1.xr))):t1.xr._connected&&(t1.xr._connected=!1,t1._eventTarget.emit(bQ.GAMEPAD_CHANGE,new b6(bQ.GAMEPAD_CHANGE,t1.xr))),(t1.checkGamepadChanged(X,null===(v=t1._cachedWebXRGamepadMap)||void 0===v?void 0:v.get(RC))||t1.checkGamepadChanged(Y,null===(S=t1._cachedWebXRGamepadMap)||void 0===S?void 0:S.get(Rx)))&&g.push(t1.xr),t1._cachedWebXRGamepadMap||(t1._cachedWebXRGamepadMap=new Map),t1._cachedWebXRGamepadMap.set(RC,t1._copyCacheGamepadValue(X)),t1._cachedWebXRGamepadMap.set(Rx,t1._copyCacheGamepadValue(Y))},t1.checkGamepadChanged=function(g,v){if(!g&&!v)return!1;if(!g||!v)return!0;for(var S=v.buttons,O=0;O<S.length;++O){var X=S[O];if(0!==g.buttons[O].value||0!==X)return!0}for(var Y=v.axes,te=0;te<Y.length;++te){var ti=Y[te];if(0!==g.axes[te]||0!==ti)return!0}return!1},t1._copyCacheGamepadValue=function(g){if(g){for(var v={buttons:new Array(g.buttons.length),axes:new Array(g.axes.length)},S=0;S<g.buttons.length;++S)v.buttons[S]=g.buttons[S].value;for(var O=0;O<g.axes.length;++O)v.axes[O]=g.axes[O];return v}},t1._scanWebXRGamepadsPose=function(){var g,v=null===(g=globalThis.__globalXR)||void 0===g?void 0:g.webxrHandlePoseInfos;if(v&&t1.xr){for(var S=0;S<v.length;++S){var O=v[S];t1.xr._updateWebPoseState(O)}t1._eventTarget.emit(bQ.HANDLE_POSE_INPUT,new b6(bQ.HANDLE_POSE_INPUT,t1.xr))}},t1._getWebXRGamepadMap=function(){var g;return null===(g=globalThis.__globalXR)||void 0===g?void 0:g.webxrGamepadMap},t1._getWebGamePads=function(){return"function"==typeof navigator.getGamepads?navigator.getGamepads():"function"==typeof navigator.webkitGetGamepads?navigator.webkitGetGamepads():[]},t1._getWebGamepad=function(g){for(var v=t1._getWebGamePads(),S=0;S<v.length;++S){var O=v[S];if(O&&O.index===g)return O}};var g=t1.prototype;return g._axisToButtons=function(g){var v=Math.abs(g);return g>0?{negative:0,positive:v}:g<0?{negative:v,positive:0}:{negative:0,positive:0}},g._updateWebPoseState=function(g){g.code!==Rm.HAND_LEFT&&g.code!==Rm.AIM_LEFT&&g.code!==Rm.HAND_RIGHT&&g.code!==Rm.AIM_RIGHT||(this._webPoseState[g.code]={position:new eL(g.position.x,g.position.y,g.position.z),orientation:new eW(g.orientation.x,g.orientation.y,g.orientation.z,g.orientation.w)})},g._initInputSource=function(){var g=this;this._buttonNorth=new Rg,this._buttonNorth.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);return S&&S.buttons.length>5?S.buttons[5].value:0}var O=t1._getWebGamepad(g.deviceId);return O?O.buttons[3].value:0},this._buttonEast=new Rg,this._buttonEast.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);return S&&S.buttons.length>5?S.buttons[5].value:0}var O=t1._getWebGamepad(g.deviceId);return O?O.buttons[1].value:0},this._buttonWest=new Rg,this._buttonWest.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);return S&&S.buttons.length>4?S.buttons[4].value:0}var O=t1._getWebGamepad(g.deviceId);return O?O.buttons[2].value:0},this._buttonSouth=new Rg,this._buttonSouth.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);return S&&S.buttons.length>4?S.buttons[4].value:0}var O=t1._getWebGamepad(g.deviceId);return O?O.buttons[0].value:0},this._buttonL1=new Rg,this._buttonL1.getValue=function(){var v=t1._getWebGamepad(g.deviceId);return v?v.buttons[4].value:0},this._buttonL2=new Rg,this._buttonL2.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);return S&&S.buttons.length>0?S.buttons[0].value:0}var O=t1._getWebGamepad(g.deviceId);return O?O.buttons[6].value:0},this._buttonL3=new Rg,this._buttonL3.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);if(S){if(S.buttons.length>3&&0!==S.buttons[3].value)return S.buttons[3].value;if(S.buttons.length>2&&0!==S.buttons[2].value)return S.buttons[2].value}return 0}var O=t1._getWebGamepad(g.deviceId);return O?O.buttons[10].value:0},this._buttonR1=new Rg,this._buttonR1.getValue=function(){var v=t1._getWebGamepad(g.deviceId);return v?v.buttons[5].value:0},this._buttonR2=new Rg,this._buttonR2.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);return S&&S.buttons.length>0?S.buttons[0].value:0}var O=t1._getWebGamepad(g.deviceId);return O?O.buttons[7].value:0},this._buttonR3=new Rg,this._buttonR3.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);if(S){if(S.buttons.length>3&&0!==S.buttons[3].value)return S.buttons[3].value;if(S.buttons.length>2&&0!==S.buttons[2].value)return S.buttons[2].value}return 0}var O=t1._getWebGamepad(g.deviceId);return O?O.buttons[11].value:0},this._buttonShare=new Rg,this._buttonShare.getValue=function(){var v=t1._getWebGamepad(g.deviceId);return v?v.buttons[8].value:0},this._buttonOptions=new Rg,this._buttonOptions.getValue=function(){var v=t1._getWebGamepad(g.deviceId);return v?v.buttons[9].value:0};var v=new Rg;v.getValue=function(){var v=t1._getWebGamepad(g.deviceId);return v?v.buttons[12].value:0};var S=new Rg;S.getValue=function(){var v=t1._getWebGamepad(g.deviceId);return v?v.buttons[13].value:0};var O=new Rg;O.getValue=function(){var v=t1._getWebGamepad(g.deviceId);return v?v.buttons[14].value:0};var X=new Rg;X.getValue=function(){var v=t1._getWebGamepad(g.deviceId);return v?v.buttons[15].value:0},this._dpad=new Rv({up:v,down:S,left:O,right:X});var Y=new Rg;Y.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);if(S){if(S.axes.length>3&&0!==S.axes[3])return g._axisToButtons(S.axes[3]).negative;if(S.axes.length>1&&0!==S.axes[1])return g._axisToButtons(S.axes[1]).negative}return 0}var O=t1._getWebGamepad(g.deviceId);return O?g._axisToButtons(O.axes[1]).negative:0};var te=new Rg;te.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);if(S){if(S.axes.length>3&&0!==S.axes[3])return g._axisToButtons(S.axes[3]).positive;if(S.axes.length>1&&0!==S.axes[1])return g._axisToButtons(S.axes[1]).positive}return 0}var O=t1._getWebGamepad(g.deviceId);return O?g._axisToButtons(O.axes[1]).positive:0};var ti=new Rg;ti.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);if(S){if(S.axes.length>2&&0!==S.axes[2])return g._axisToButtons(S.axes[2]).negative;if(S.axes.length>0&&0!==S.axes[0])return g._axisToButtons(S.axes[0]).negative}return 0}var O=t1._getWebGamepad(g.deviceId);return O?g._axisToButtons(O.axes[0]).negative:0};var tr=new Rg;tr.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);if(S){if(S.axes.length>2&&0!==S.axes[2])return g._axisToButtons(S.axes[2]).positive;if(S.axes.length>0&&0!==S.axes[0])return g._axisToButtons(S.axes[0]).positive}return 0}var O=t1._getWebGamepad(g.deviceId);return O?g._axisToButtons(O.axes[0]).positive:0},this._leftStick=new RS({up:Y,down:te,left:ti,right:tr});var ta=new Rg;ta.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);if(S){if(S.axes.length>3&&0!==S.axes[3])return g._axisToButtons(S.axes[3]).negative;if(S.axes.length>1&&0!==S.axes[1])return g._axisToButtons(S.axes[1]).negative}return 0}var O=t1._getWebGamepad(g.deviceId);return O?g._axisToButtons(O.axes[3]).negative:0};var th=new Rg;th.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);if(S){if(S.axes.length>3&&0!==S.axes[3])return g._axisToButtons(S.axes[3]).positive;if(S.axes.length>1&&0!==S.axes[1])return g._axisToButtons(S.axes[1]).positive}return 0}var O=t1._getWebGamepad(g.deviceId);return O?g._axisToButtons(O.axes[3]).positive:0};var tu=new Rg;tu.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);if(S){if(S.axes.length>2&&0!==S.axes[2])return g._axisToButtons(S.axes[2]).negative;if(S.axes.length>0&&0!==S.axes[0])return g._axisToButtons(S.axes[0]).negative}return 0}var O=t1._getWebGamepad(g.deviceId);return O?g._axisToButtons(O.axes[2]).negative:0};var tl=new Rg;tl.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);if(S){if(S.axes.length>2&&0!==S.axes[2])return g._axisToButtons(S.axes[2]).positive;if(S.axes.length>0&&0!==S.axes[0])return g._axisToButtons(S.axes[0]).positive}return 0}var O=t1._getWebGamepad(g.deviceId);return O?g._axisToButtons(O.axes[2]).positive:0},this._rightStick=new RS({up:ta,down:th,left:tu,right:tl}),this._buttonStart=new Rg,this._buttonStart.getValue=function(){return 0},this._gripLeft=new Rg,this._gripLeft.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(RC);if(S&&S.buttons.length>1)return S.buttons[1].value}return 0},this._gripRight=new Rg,this._gripRight.getValue=function(){if(-1===g.deviceId){var v,S=null===(v=t1._getWebXRGamepadMap())||void 0===v?void 0:v.get(Rx);if(S&&S.buttons.length>1)return S.buttons[1].value}return 0},this._handLeftPosition=new RT,this._handLeftPosition.getValue=function(){return g._webPoseState[Rm.HAND_LEFT].position},this._handLeftOrientation=new RA,this._handLeftOrientation.getValue=function(){return g._webPoseState[Rm.HAND_LEFT].orientation},this._handRightPosition=new RT,this._handRightPosition.getValue=function(){return g._webPoseState[Rm.HAND_RIGHT].position},this._handRightOrientation=new RA,this._handRightOrientation.getValue=function(){return g._webPoseState[Rm.HAND_RIGHT].orientation},this._aimLeftPosition=new RT,this._aimLeftPosition.getValue=function(){return g._webPoseState[Rm.AIM_LEFT].position},this._aimLeftOrientation=new RA,this._aimLeftOrientation.getValue=function(){return g._webPoseState[Rm.AIM_LEFT].orientation},this._aimRightPosition=new RT,this._aimRightPosition.getValue=function(){return g._webPoseState[Rm.AIM_RIGHT].position},this._aimRightOrientation=new RA,this._aimRightOrientation.getValue=function(){return g._webPoseState[Rm.AIM_RIGHT].orientation}},n(t1,[{key:"buttonNorth",get:function(){return this._buttonNorth}},{key:"buttonEast",get:function(){return this._buttonEast}},{key:"buttonWest",get:function(){return this._buttonWest}},{key:"buttonSouth",get:function(){return this._buttonSouth}},{key:"buttonL1",get:function(){return this._buttonL1}},{key:"buttonL2",get:function(){return this._buttonL2}},{key:"buttonL3",get:function(){return this._buttonL3}},{key:"buttonR1",get:function(){return this._buttonR1}},{key:"buttonR2",get:function(){return this._buttonR2}},{key:"buttonR3",get:function(){return this._buttonR3}},{key:"buttonShare",get:function(){return this._buttonShare}},{key:"buttonOptions",get:function(){return this._buttonOptions}},{key:"dpad",get:function(){return this._dpad}},{key:"leftStick",get:function(){return this._leftStick}},{key:"rightStick",get:function(){return this._rightStick}},{key:"buttonStart",get:function(){return this._buttonStart}},{key:"gripLeft",get:function(){return this._gripLeft}},{key:"gripRight",get:function(){return this._gripRight}},{key:"handLeftPosition",get:function(){return this._handLeftPosition}},{key:"handLeftOrientation",get:function(){return this._handLeftOrientation}},{key:"handRightPosition",get:function(){return this._handRightPosition}},{key:"handRightOrientation",get:function(){return this._handRightOrientation}},{key:"aimLeftPosition",get:function(){return this._aimLeftPosition}},{key:"aimLeftOrientation",get:function(){return this._aimLeftOrientation}},{key:"aimRightPosition",get:function(){return this._aimRightPosition}},{key:"aimRightOrientation",get:function(){return this._aimRightOrientation}},{key:"deviceId",get:function(){return this._deviceId}},{key:"connected",get:function(){return this._connected}}]),t1}();RM.all=[],RM.xr=null,RM._eventTarget=new aC,RM._cachedWebGamepads=[],RM._cachedWebXRGamepadMap=null,RM._intervalId=-1,RM._totalGamepadCnt=0,function(g){g[g.BUTTON_EAST=0]="BUTTON_EAST",g[g.BUTTON_SOUTH=1]="BUTTON_SOUTH",g[g.BUTTON_WEST=2]="BUTTON_WEST",g[g.BUTTON_NORTH=3]="BUTTON_NORTH",g[g.BUTTON_TRIGGER_LEFT=4]="BUTTON_TRIGGER_LEFT",g[g.BUTTON_TRIGGER_RIGHT=5]="BUTTON_TRIGGER_RIGHT",g[g.TRIGGER_LEFT=6]="TRIGGER_LEFT",g[g.TRIGGER_RIGHT=7]="TRIGGER_RIGHT",g[g.GRIP_LEFT=8]="GRIP_LEFT",g[g.GRIP_RIGHT=9]="GRIP_RIGHT",g[g.BUTTON_LEFT_STICK=10]="BUTTON_LEFT_STICK",g[g.LEFT_STICK_UP=11]="LEFT_STICK_UP",g[g.LEFT_STICK_DOWN=12]="LEFT_STICK_DOWN",g[g.LEFT_STICK_LEFT=13]="LEFT_STICK_LEFT",g[g.LEFT_STICK_RIGHT=14]="LEFT_STICK_RIGHT",g[g.BUTTON_RIGHT_STICK=15]="BUTTON_RIGHT_STICK",g[g.RIGHT_STICK_UP=16]="RIGHT_STICK_UP",g[g.RIGHT_STICK_DOWN=17]="RIGHT_STICK_DOWN",g[g.RIGHT_STICK_LEFT=18]="RIGHT_STICK_LEFT",g[g.RIGHT_STICK_RIGHT=19]="RIGHT_STICK_RIGHT",g[g.ROKID_MENU=20]="ROKID_MENU",g[g.ROKID_START=21]="ROKID_START"}(RR||(RR={})),function(g){g[g.KET_CLICK=0]="KET_CLICK",g[g.KET_STICK=1]="KET_STICK",g[g.KET_GRAB=2]="KET_GRAB",g[g.KET_TOUCH=3]="KET_TOUCH"}(Rw||(Rw={})),function(g){g[g.UNDEFINE=0]="UNDEFINE",g[g.A=1]="A",g[g.B=2]="B",g[g.X=3]="X",g[g.Y=4]="Y",g[g.L1=5]="L1",g[g.R1=6]="R1",g[g.MINUS=7]="MINUS",g[g.PLUS=8]="PLUS",g[g.L3=9]="L3",g[g.R3=10]="R3",g[g.MENU=11]="MENU",g[g.START=12]="START",g[g.TRIGGER_LEFT=13]="TRIGGER_LEFT",g[g.TRIGGER_RIGHT=14]="TRIGGER_RIGHT"}(RI||(RI={})),function(g){g[g.UNDEFINE=0]="UNDEFINE",g[g.X=1]="X",g[g.Y=2]="Y",g[g.LEFT_STICK_X=3]="LEFT_STICK_X",g[g.LEFT_STICK_Y=4]="LEFT_STICK_Y",g[g.RIGHT_STICK_X=5]="RIGHT_STICK_X",g[g.RIGHT_STICK_Y=6]="RIGHT_STICK_Y",g[g.L2=7]="L2",g[g.R2=8]="R2",g[g.LEFT_GRIP=9]="LEFT_GRIP",g[g.RIGHT_GRIP=10]="RIGHT_GRIP"}(RP||(RP={})),function(g){g[g.UNDEFINE=0]="UNDEFINE",g[g.A=1]="A",g[g.B=2]="B",g[g.X=3]="X",g[g.Y=4]="Y",g[g.LEFT_TRIGGER=5]="LEFT_TRIGGER",g[g.RIGHT_TRIGGER=6]="RIGHT_TRIGGER",g[g.LEFT_THUMBSTICK=7]="LEFT_THUMBSTICK",g[g.RIGHT_THUMBSTICK=8]="RIGHT_THUMBSTICK"}(RD||(RD={}));var RO,RL={1:RR.BUTTON_EAST,2:RR.BUTTON_SOUTH,3:RR.BUTTON_NORTH,4:RR.BUTTON_WEST,9:RR.BUTTON_LEFT_STICK,10:RR.BUTTON_RIGHT_STICK,11:RR.ROKID_MENU,12:RR.ROKID_START,13:RR.BUTTON_TRIGGER_LEFT,14:RR.BUTTON_TRIGGER_RIGHT},RF=function(){function t1(){var g,v,S=this;this._eventTarget=new aC,this._buttonNorth=void 0,this._buttonEast=void 0,this._buttonWest=void 0,this._buttonSouth=void 0,this._buttonTriggerLeft=void 0,this._buttonTriggerRight=void 0,this._triggerLeft=void 0,this._triggerRight=void 0,this._gripLeft=void 0,this._gripRight=void 0,this._leftStick=void 0,this._rightStick=void 0,this._buttonLeftStick=void 0,this._buttonRightStick=void 0,this._buttonOptions=void 0,this._buttonStart=void 0,this._handLeftPosition=void 0,this._handLeftOrientation=void 0,this._handRightPosition=void 0,this._handRightOrientation=void 0,this._aimLeftPosition=void 0,this._aimLeftOrientation=void 0,this._aimRightPosition=void 0,this._aimRightOrientation=void 0,this._touchButtonA=void 0,this._touchButtonB=void 0,this._touchButtonX=void 0,this._touchButtonY=void 0,this._touchButtonTriggerLeft=void 0,this._touchButtonTriggerRight=void 0,this._touchButtonThumbStickLeft=void 0,this._touchButtonThumbStickRight=void 0,this._nativeButtonState=((g={})[RR.BUTTON_SOUTH]=0,g[RR.BUTTON_EAST]=0,g[RR.BUTTON_WEST]=0,g[RR.BUTTON_NORTH]=0,g[RR.BUTTON_TRIGGER_LEFT]=0,g[RR.BUTTON_TRIGGER_RIGHT]=0,g[RR.TRIGGER_LEFT]=0,g[RR.TRIGGER_RIGHT]=0,g[RR.GRIP_LEFT]=0,g[RR.GRIP_RIGHT]=0,g[RR.LEFT_STICK_UP]=0,g[RR.LEFT_STICK_DOWN]=0,g[RR.LEFT_STICK_LEFT]=0,g[RR.LEFT_STICK_RIGHT]=0,g[RR.RIGHT_STICK_UP]=0,g[RR.RIGHT_STICK_DOWN]=0,g[RR.RIGHT_STICK_LEFT]=0,g[RR.RIGHT_STICK_RIGHT]=0,g[RR.BUTTON_LEFT_STICK]=0,g[RR.BUTTON_RIGHT_STICK]=0,g[RR.ROKID_MENU]=0,g[RR.ROKID_START]=0,g),this._nativeTouchState=((v={})[RD.UNDEFINE]=0,v[RD.A]=0,v[RD.B]=0,v[RD.X]=0,v[RD.Y]=0,v[RD.LEFT_TRIGGER]=0,v[RD.RIGHT_TRIGGER]=0,v[RD.LEFT_THUMBSTICK]=0,v[RD.RIGHT_THUMBSTICK]=0,v),this._initInputSource(),window.addEventListener("xr-remote-input",function(g){var v=g,O=v.detail.keyEventType,X=v.detail.stickAxisCode,Y=v.detail.stickAxisValue,te=v.detail.stickKeyCode,ti=v.detail.isButtonPressed,tr=v.detail.touchCode,ta=v.detail.touchValue;if(O===Rw.KET_CLICK){var th=RL[te];S._nativeButtonState[th]=ti?1:0}else if(O===Rw.KET_STICK||O===Rw.KET_GRAB){var tu,tl,tc;switch(X){case RP.LEFT_STICK_X:tu=RR.LEFT_STICK_LEFT,tl=RR.LEFT_STICK_RIGHT,tc=S._axisToButtons(Y);break;case RP.LEFT_STICK_Y:tu=RR.LEFT_STICK_DOWN,tl=RR.LEFT_STICK_UP,tc=S._axisToButtons(Y);break;case RP.RIGHT_STICK_X:tu=RR.RIGHT_STICK_LEFT,tl=RR.RIGHT_STICK_RIGHT,tc=S._axisToButtons(Y);break;case RP.RIGHT_STICK_Y:tu=RR.RIGHT_STICK_DOWN,tl=RR.RIGHT_STICK_UP,tc=S._axisToButtons(Y);break;case RP.L2:S._nativeButtonState[RR.TRIGGER_LEFT]=Y;break;case RP.R2:S._nativeButtonState[RR.TRIGGER_RIGHT]=Y;break;case RP.LEFT_GRIP:S._nativeButtonState[RR.GRIP_LEFT]=Y;break;case RP.RIGHT_GRIP:S._nativeButtonState[RR.GRIP_RIGHT]=Y}tu&&tl&&tc&&(S._nativeButtonState[tu]=tc.negative,S._nativeButtonState[tl]=tc.positive)}else if(O===Rw.KET_TOUCH)switch(tr){case RD.A:case RD.B:case RD.X:case RD.Y:case RD.LEFT_TRIGGER:case RD.RIGHT_TRIGGER:case RD.LEFT_THUMBSTICK:case RD.RIGHT_THUMBSTICK:S._nativeTouchState[tr]=ta}S._eventTarget.emit(bQ.HANDLE_INPUT,new b7(bQ.HANDLE_INPUT,S))})}var g=t1.prototype;return g._axisToButtons=function(g){var v=Math.abs(g);return g>0?{negative:0,positive:v}:g<0?{negative:v,positive:0}:{negative:0,positive:0}},g._on=function(g,v,S){this._eventTarget.on(g,v,S)},g._initInputSource=function(){var g=this;this._buttonNorth=new Rg,this._buttonNorth.getValue=function(){return g._nativeButtonState[RR.BUTTON_NORTH]},this._buttonEast=new Rg,this._buttonEast.getValue=function(){return g._nativeButtonState[RR.BUTTON_EAST]},this._buttonWest=new Rg,this._buttonWest.getValue=function(){return g._nativeButtonState[RR.BUTTON_WEST]},this._buttonSouth=new Rg,this._buttonSouth.getValue=function(){return g._nativeButtonState[RR.BUTTON_SOUTH]},this._buttonTriggerLeft=new Rg,this._buttonTriggerLeft.getValue=function(){return g._nativeButtonState[RR.BUTTON_TRIGGER_LEFT]},this._buttonTriggerRight=new Rg,this._buttonTriggerRight.getValue=function(){return g._nativeButtonState[RR.BUTTON_TRIGGER_RIGHT]},this._triggerLeft=new Rg,this._triggerLeft.getValue=function(){return g._nativeButtonState[RR.TRIGGER_LEFT]},this._triggerRight=new Rg,this._triggerRight.getValue=function(){return g._nativeButtonState[RR.TRIGGER_RIGHT]},this._gripLeft=new Rg,this._gripLeft.getValue=function(){return g._nativeButtonState[RR.GRIP_LEFT]},this._gripRight=new Rg,this._gripRight.getValue=function(){return g._nativeButtonState[RR.GRIP_RIGHT]},this._buttonLeftStick=new Rg,this._buttonLeftStick.getValue=function(){return g._nativeButtonState[RR.BUTTON_LEFT_STICK]};var v=new Rg;v.getValue=function(){return g._nativeButtonState[RR.LEFT_STICK_UP]};var S=new Rg;S.getValue=function(){return g._nativeButtonState[RR.LEFT_STICK_DOWN]};var O=new Rg;O.getValue=function(){return g._nativeButtonState[RR.LEFT_STICK_LEFT]};var X=new Rg;X.getValue=function(){return g._nativeButtonState[RR.LEFT_STICK_RIGHT]},this._leftStick=new RS({up:v,down:S,left:O,right:X}),this._buttonRightStick=new Rg,this._buttonRightStick.getValue=function(){return g._nativeButtonState[RR.BUTTON_RIGHT_STICK]};var Y=new Rg;Y.getValue=function(){return g._nativeButtonState[RR.RIGHT_STICK_UP]};var te=new Rg;te.getValue=function(){return g._nativeButtonState[RR.RIGHT_STICK_DOWN]};var ti=new Rg;ti.getValue=function(){return g._nativeButtonState[RR.RIGHT_STICK_LEFT]};var tr=new Rg;tr.getValue=function(){return g._nativeButtonState[RR.RIGHT_STICK_RIGHT]},this._rightStick=new RS({up:Y,down:te,left:ti,right:tr}),this._buttonOptions=new Rg,this._buttonOptions.getValue=function(){return g._nativeButtonState[RR.ROKID_MENU]},this._buttonStart=new Rg,this._buttonStart.getValue=function(){return g._nativeButtonState[RR.ROKID_START]},this._handLeftPosition=new RT,this._handLeftPosition.getValue=function(){return eL.ZERO},this._handLeftOrientation=new RA,this._handLeftOrientation.getValue=function(){return eW.IDENTITY},this._handRightPosition=new RT,this._handRightPosition.getValue=function(){return eL.ZERO},this._handRightOrientation=new RA,this._handRightOrientation.getValue=function(){return eW.IDENTITY},this._aimLeftPosition=new RT,this._aimLeftPosition.getValue=function(){return eL.ZERO},this._aimLeftOrientation=new RA,this._aimLeftOrientation.getValue=function(){return eW.IDENTITY},this._aimRightPosition=new RT,this._aimRightPosition.getValue=function(){return eL.ZERO},this._aimRightOrientation=new RA,this._aimRightOrientation.getValue=function(){return eW.IDENTITY},this._touchButtonA=new RE,this._touchButtonA.getValue=function(){return g._nativeTouchState[RD.A]},this._touchButtonB=new RE,this._touchButtonB.getValue=function(){return g._nativeTouchState[RD.B]},this._touchButtonX=new RE,this._touchButtonX.getValue=function(){return g._nativeTouchState[RD.X]},this._touchButtonY=new RE,this._touchButtonY.getValue=function(){return g._nativeTouchState[RD.Y]},this._touchButtonTriggerLeft=new RE,this._touchButtonTriggerLeft.getValue=function(){return g._nativeTouchState[RD.LEFT_TRIGGER]},this._touchButtonTriggerRight=new RE,this._touchButtonTriggerRight.getValue=function(){return g._nativeTouchState[RD.RIGHT_TRIGGER]},this._touchButtonThumbStickLeft=new RE,this._touchButtonThumbStickLeft.getValue=function(){return g._nativeTouchState[RD.LEFT_THUMBSTICK]},this._touchButtonThumbStickRight=new RE,this._touchButtonThumbStickRight.getValue=function(){return g._nativeTouchState[RD.RIGHT_THUMBSTICK]}},n(t1,[{key:"buttonNorth",get:function(){return this._buttonNorth}},{key:"buttonEast",get:function(){return this._buttonEast}},{key:"buttonWest",get:function(){return this._buttonWest}},{key:"buttonSouth",get:function(){return this._buttonSouth}},{key:"buttonTriggerLeft",get:function(){return this._buttonTriggerLeft}},{key:"buttonTriggerRight",get:function(){return this._buttonTriggerRight}},{key:"triggerLeft",get:function(){return this._triggerLeft}},{key:"triggerRight",get:function(){return this._triggerRight}},{key:"gripLeft",get:function(){return this._gripLeft}},{key:"gripRight",get:function(){return this._gripRight}},{key:"leftStick",get:function(){return this._leftStick}},{key:"rightStick",get:function(){return this._rightStick}},{key:"buttonLeftStick",get:function(){return this._buttonLeftStick}},{key:"buttonRightStick",get:function(){return this._buttonRightStick}},{key:"buttonOptions",get:function(){return this._buttonOptions}},{key:"buttonStart",get:function(){return this._buttonStart}},{key:"handLeftPosition",get:function(){return this._handLeftPosition}},{key:"handLeftOrientation",get:function(){return this._handLeftOrientation}},{key:"handRightPosition",get:function(){return this._handRightPosition}},{key:"handRightOrientation",get:function(){return this._handRightOrientation}},{key:"aimLeftPosition",get:function(){return this._aimLeftPosition}},{key:"aimLeftOrientation",get:function(){return this._aimLeftOrientation}},{key:"aimRightPosition",get:function(){return this._aimRightPosition}},{key:"aimRightOrientation",get:function(){return this._aimRightOrientation}},{key:"touchButtonA",get:function(){return this._touchButtonA}},{key:"touchButtonB",get:function(){return this._touchButtonB}},{key:"touchButtonX",get:function(){return this._touchButtonX}},{key:"touchButtonY",get:function(){return this._touchButtonY}},{key:"touchButtonTriggerLeft",get:function(){return this._touchButtonTriggerLeft}},{key:"touchButtonTriggerRight",get:function(){return this._touchButtonTriggerRight}},{key:"touchButtonThumbStickLeft",get:function(){return this._touchButtonThumbStickLeft}},{key:"touchButtonThumbStickRight",get:function(){return this._touchButtonThumbStickRight}}]),t1}();!function(g){g[g.VIEW_LEFT=0]="VIEW_LEFT",g[g.VIEW_RIGHT=3]="VIEW_RIGHT",g[g.HEAD_MIDDLE=6]="HEAD_MIDDLE"}(RO||(RO={}));var RN,Rk,RG=function(){function t1(){var g;this._eventTarget=new aC,this._intervalId=-1,this._viewLeftPosition=void 0,this._viewLeftOrientation=void 0,this._viewRightPosition=void 0,this._viewRightOrientation=void 0,this._headMiddlePosition=void 0,this._headMiddleOrientation=void 0,this._webPoseState=((g={})[RO.VIEW_LEFT]={position:eL.ZERO,orientation:eW.IDENTITY},g[RO.VIEW_RIGHT]={position:eL.ZERO,orientation:eW.IDENTITY},g[RO.HEAD_MIDDLE]={position:eL.ZERO,orientation:eW.IDENTITY},g),this._initInputSource(),this._registerEvent()}var g=t1.prototype;return g._ensureDirectorDefined=function(){var g=this;return new Promise(function(v){g._intervalId=setInterval(function(){X.director&&X.Director&&(clearInterval(g._intervalId),g._intervalId=-1,v())},50)})},g._registerEvent=function(){var g=this;this._ensureDirectorDefined().then(function(){X.director.on(X.Director.EVENT_BEGIN_FRAME,g._scanHmd,g)}).catch(function(){})},g._scanHmd=function(){var g,v=null===(g=globalThis.__globalXR)||void 0===g?void 0:g.webxrHmdPoseInfos;if(v){for(var S=0;S<v.length;++S){var O=v[S];this._updateWebPoseState(O)}this._eventTarget.emit(bQ.HMD_POSE_INPUT,new b9(bQ.HMD_POSE_INPUT,this))}},g._on=function(g,v,S){this._eventTarget.on(g,v,S)},g._updateWebPoseState=function(g){g.code!==RO.VIEW_LEFT&&g.code!==RO.VIEW_RIGHT&&g.code!==RO.HEAD_MIDDLE||(this._webPoseState[g.code]={position:new eL(g.position.x,g.position.y,g.position.z),orientation:new eW(g.orientation.x,g.orientation.y,g.orientation.z,g.orientation.w)})},g._initInputSource=function(){var g=this;this._viewLeftPosition=new RT,this._viewLeftPosition.getValue=function(){return g._webPoseState[RO.VIEW_LEFT].position},this._viewLeftOrientation=new RA,this._viewLeftOrientation.getValue=function(){return g._webPoseState[RO.VIEW_LEFT].orientation},this._viewRightPosition=new RT,this._viewRightPosition.getValue=function(){return g._webPoseState[RO.VIEW_RIGHT].position},this._viewRightOrientation=new RA,this._viewRightOrientation.getValue=function(){return g._webPoseState[RO.VIEW_RIGHT].orientation},this._headMiddlePosition=new RT,this._headMiddlePosition.getValue=function(){return g._webPoseState[RO.HEAD_MIDDLE].position},this._headMiddleOrientation=new RA,this._headMiddleOrientation.getValue=function(){return g._webPoseState[RO.HEAD_MIDDLE].orientation}},n(t1,[{key:"viewLeftPosition",get:function(){return this._viewLeftPosition}},{key:"viewLeftOrientation",get:function(){return this._viewLeftOrientation}},{key:"viewRightPosition",get:function(){return this._viewRightPosition}},{key:"viewRightOrientation",get:function(){return this._viewRightOrientation}},{key:"headMiddlePosition",get:function(){return this._headMiddlePosition}},{key:"headMiddleOrientation",get:function(){return this._headMiddleOrientation}}]),t1}(),RV=function(){function t1(){this._eventTarget=new aC,this._handheldPosition=void 0,this._handheldOrientation=void 0,this._initInputSource()}var g=t1.prototype;return g._on=function(g,v,S){this._eventTarget.on(g,v,S)},g._initInputSource=function(){this._handheldPosition=new RT,this._handheldPosition.getValue=function(){return eL.ZERO},this._handheldOrientation=new RA,this._handheldOrientation.getValue=function(){return eW.IDENTITY}},n(t1,[{key:"handheldPosition",get:function(){return this._handheldPosition}},{key:"handheldOrientation",get:function(){return this._handheldOrientation}}]),t1}(),RU={Backspace:b8.BACKSPACE,Tab:b8.TAB,Enter:b8.ENTER,ShiftLeft:b8.SHIFT_LEFT,ControlLeft:b8.CTRL_LEFT,AltLeft:b8.ALT_LEFT,ShiftRight:b8.SHIFT_RIGHT,ControlRight:b8.CTRL_RIGHT,AltRight:b8.ALT_RIGHT,Pause:b8.PAUSE,CapsLock:b8.CAPS_LOCK,Escape:b8.ESCAPE,Space:b8.SPACE,PageUp:b8.PAGE_UP,PageDown:b8.PAGE_DOWN,End:b8.END,Home:b8.HOME,ArrowLeft:b8.ARROW_LEFT,ArrowUp:b8.ARROW_UP,ArrowRight:b8.ARROW_RIGHT,ArrowDown:b8.ARROW_DOWN,Insert:b8.INSERT,Delete:b8.DELETE,Digit0:b8.DIGIT_0,Digit1:b8.DIGIT_1,Digit2:b8.DIGIT_2,Digit3:b8.DIGIT_3,Digit4:b8.DIGIT_4,Digit5:b8.DIGIT_5,Digit6:b8.DIGIT_6,Digit7:b8.DIGIT_7,Digit8:b8.DIGIT_8,Digit9:b8.DIGIT_9,KeyA:b8.KEY_A,KeyB:b8.KEY_B,KeyC:b8.KEY_C,KeyD:b8.KEY_D,KeyE:b8.KEY_E,KeyF:b8.KEY_F,KeyG:b8.KEY_G,KeyH:b8.KEY_H,KeyI:b8.KEY_I,KeyJ:b8.KEY_J,KeyK:b8.KEY_K,KeyL:b8.KEY_L,KeyM:b8.KEY_M,KeyN:b8.KEY_N,KeyO:b8.KEY_O,KeyP:b8.KEY_P,KeyQ:b8.KEY_Q,KeyR:b8.KEY_R,KeyS:b8.KEY_S,KeyT:b8.KEY_T,KeyU:b8.KEY_U,KeyV:b8.KEY_V,KeyW:b8.KEY_W,KeyX:b8.KEY_X,KeyY:b8.KEY_Y,KeyZ:b8.KEY_Z,Numpad0:b8.NUM_0,Numpad1:b8.NUM_1,Numpad2:b8.NUM_2,Numpad3:b8.NUM_3,Numpad4:b8.NUM_4,Numpad5:b8.NUM_5,Numpad6:b8.NUM_6,Numpad7:b8.NUM_7,Numpad8:b8.NUM_8,Numpad9:b8.NUM_9,NumpadMultiply:b8.NUM_MULTIPLY,NumpadAdd:b8.NUM_PLUS,NumpadSubtract:b8.NUM_SUBTRACT,NumpadDecimal:b8.NUM_DECIMAL,NumpadDivide:b8.NUM_DIVIDE,NumpadEnter:b8.NUM_ENTER,F1:b8.F1,F2:b8.F2,F3:b8.F3,F4:b8.F4,F5:b8.F5,F6:b8.F6,F7:b8.F7,F8:b8.F8,F9:b8.F9,F10:b8.F10,F11:b8.F11,F12:b8.F12,NumLock:b8.NUM_LOCK,ScrollLock:b8.SCROLL_LOCK,Semicolon:b8.SEMICOLON,Equal:b8.EQUAL,Comma:b8.COMMA,Minus:b8.DASH,Period:b8.PERIOD,Slash:b8.SLASH,Backquote:b8.BACK_QUOTE,BracketLeft:b8.BRACKET_LEFT,Backslash:b8.BACKSLASH,BracketRight:b8.BRACKET_RIGHT,Quote:b8.QUOTE},RH=function(){function t1(){this._eventTarget=new aC,this._registerEvent()}var g=t1.prototype;return g.dispatchKeyboardDownEvent=function(g){this._handleKeyboardDown(g)},g.dispatchKeyboardUpEvent=function(g){this._handleKeyboardUp(g)},g.on=function(g,v,S){this._eventTarget.on(g,v,S)},g._registerEvent=function(){var g=document.getElementById("GameCanvas");null==g||g.addEventListener("keydown",this._handleKeyboardDown.bind(this)),null==g||g.addEventListener("keyup",this._handleKeyboardUp.bind(this))},g._getInputEvent=function(g,v){var S,O=(S=g.code,RU[S]||b8.NONE);return new b1(O,v)},g._handleKeyboardDown=function(g){if(g.stopPropagation(),g.preventDefault(),g.repeat){var v=this._getInputEvent(g,bQ.KEY_PRESSING);this._eventTarget.emit(bQ.KEY_PRESSING,v)}else{var S=this._getInputEvent(g,bQ.KEY_DOWN);this._eventTarget.emit(bQ.KEY_DOWN,S)}},g._handleKeyboardUp=function(g){var v=this._getInputEvent(g,bQ.KEY_UP);g.stopPropagation(),g.preventDefault(),this._eventTarget.emit(bQ.KEY_UP,v)},t1}(),Rz=function(){function t1(){this._canvas=void 0,this._eventTarget=new aC,this._pointLocked=!1,this._isPressed=!1,this._preMousePos=new e8,this._handleMouseDown=void 0,this._handleMouseMove=void 0,this._handleMouseUp=void 0,aD.hasFeature(aB.EVENT_MOUSE)&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||console.warn("failed to access canvas"),this._handleMouseDown=this._createCallback(bQ.MOUSE_DOWN),this._handleMouseMove=this._createCallback(bQ.MOUSE_MOVE),this._handleMouseUp=this._createCallback(bQ.MOUSE_UP),this._registerEvent())}var g=t1.prototype;return g.dispatchMouseDownEvent=function(g){this._handleMouseDown(g)},g.dispatchMouseMoveEvent=function(g){this._handleMouseMove(g)},g.dispatchMouseUpEvent=function(g){this._handleMouseUp(g)},g.dispatchScrollEvent=function(g){this._handleMouseWheel(g)},g.on=function(g,v,S){this._eventTarget.on(g,v,S)},g._getCanvasRect=function(){var g=this._canvas,v=null==g?void 0:g.getBoundingClientRect();return v?new ic(v.x,v.y,v.width,v.height):new ic(0,0,0,0)},g._getLocation=function(g){var v=this._getCanvasRect(),S=a$.devicePixelRatio,O=this._pointLocked?this._preMousePos.x/S+g.movementX:g.clientX-v.x,X=this._pointLocked?this._preMousePos.y/S-g.movementY:v.y+v.height-g.clientY;return new e8(O*=S,X*=S)},g._registerEvent=function(){var g,v,S,O,X=this;window.addEventListener("mousedown",function(){X._isPressed=!0}),null===(g=this._canvas)||void 0===g||g.addEventListener("mousedown",this._handleMouseDown),null===(v=this._canvas)||void 0===v||v.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp),null===(S=this._canvas)||void 0===S||S.addEventListener("mouseup",this._handleMouseUp),null===(O=this._canvas)||void 0===O||O.addEventListener("wheel",this._handleMouseWheel.bind(this)),this._registerPointerLockEvent()},g._registerPointerLockEvent=function(){var g=this,e=function(){var v=g._canvas;document.pointerLockElement===v||document.mozPointerLockElement===v?g._pointLocked=!0:g._pointLocked=!1};"onpointerlockchange"in document?document.addEventListener("pointerlockchange",e,!1):"onmozpointerlockchange"in document&&document.addEventListener("mozpointerlockchange",e,!1)},g._createCallback=function(g){var v=this;return function(S){var O,X=v._getLocation(S),Y=S.button,te=S.buttons,ti=Y;switch(g){case bQ.MOUSE_DOWN:null===(O=v._canvas)||void 0===O||O.focus(),v._isPressed=!0;break;case bQ.MOUSE_UP:v._isPressed=!1;break;case bQ.MOUSE_MOVE:ti=1&te?b2.BUTTON_LEFT:2&te?b2.BUTTON_RIGHT:4&te?b2.BUTTON_MIDDLE:b2.BUTTON_MISSING}var tr=new b2(g,!1,v._preMousePos);tr.setLocation(X.x,X.y),tr.setButton(ti),tr.movementX=S.movementX,tr.movementY=S.movementY,v._preMousePos.set(X.x,X.y),S.stopPropagation(),S.target===v._canvas&&S.preventDefault(),v._eventTarget.emit(g,tr)}},g._handleMouseWheel=function(g){var v=bQ.MOUSE_WHEEL,S=this._getLocation(g),O=g.button,X=new b2(v,!1,this._preMousePos);X.setLocation(S.x,S.y),X.setButton(O),X.movementX=g.movementX,X.movementY=g.movementY,X.setScrollData(5*g.deltaX,5*-g.deltaY),this._preMousePos.set(S.x,S.y),g.stopPropagation(),g.target===this._canvas&&g.preventDefault(),this._eventTarget.emit(v,X)},t1}(),RW=new e8,RX=new(function(){function t1(){this._touchMap=void 0,this._maxTouches=8,this._touchMap=new Map}var g=t1.prototype;return g._createTouch=function(g,v,S){if(this._touchMap.has(g))N("Cannot create the same touch object.");else{if(!this._checkTouchMapSizeMoreThanMax(g)){var O=new Ra(v,S,g);return this._touchMap.set(g,O),this._updateTouch(O,v,S),O}N("The touches is more than MAX_TOUCHES.")}},g.releaseTouch=function(g){this._touchMap.has(g)&&this._touchMap.delete(g)},g.getTouch=function(g){return this._touchMap.get(g)},g.getOrCreateTouch=function(g,v,S){var O=this.getTouch(g);return O?this._updateTouch(O,v,S):O=this._createTouch(g,v,S),O},g.getAllTouches=function(){var g=[];return this._touchMap.forEach(function(v){v&&g.push(v)}),g},g.getTouchCount=function(){return RX._touchMap.size},g._updateTouch=function(g,v,S){g.getLocation(RW),g.setPrevPoint(RW),g.setPoint(v,S)},g._checkTouchMapSizeMoreThanMax=function(g){var v=this;if(this._touchMap.has(g))return!1;var S=t$.ENABLE_MULTI_TOUCH?this._maxTouches:1;if(this._touchMap.size<S)return!1;var O=performance.now();return this._touchMap.forEach(function(g){O-g.lastModified>t$.TOUCH_TIMEOUT&&(N("The touches is more than MAX_TOUCHES, release touch id "+g.getID()+"."),v.releaseTouch(g.getID()))}),S>=this._touchMap.size},t1}()),Rj=function(){function t1(){this._canvas=void 0,this._eventTarget=new aC,aD.hasFeature(aB.INPUT_TOUCH)&&(this._canvas=document.getElementById("GameCanvas"),this._canvas||G("failed to access canvas"),this._registerEvent())}var g=t1.prototype;return g._registerEvent=function(){var g,v,S,O;null===(g=this._canvas)||void 0===g||g.addEventListener("touchstart",this._createCallback(bQ.TOUCH_START)),null===(v=this._canvas)||void 0===v||v.addEventListener("touchmove",this._createCallback(bQ.TOUCH_MOVE)),null===(S=this._canvas)||void 0===S||S.addEventListener("touchend",this._createCallback(bQ.TOUCH_END)),null===(O=this._canvas)||void 0===O||O.addEventListener("touchcancel",this._createCallback(bQ.TOUCH_CANCEL))},g._createCallback=function(g){var v=this;return function(S){for(var O,X=v._getCanvasRect(),Y=[],te=S.changedTouches.length,ti=0;ti<te;++ti){var tr=S.changedTouches[ti],ta=tr.identifier;if(null!==ta){var th=v._getLocation(tr,X),tu=RX.getOrCreateTouch(ta,th.x,th.y);tu&&(g!==bQ.TOUCH_END&&g!==bQ.TOUCH_CANCEL||RX.releaseTouch(ta),Y.push(tu))}}if(S.stopPropagation(),S.target===v._canvas&&S.preventDefault(),g===bQ.TOUCH_START&&(null===(O=v._canvas)||void 0===O||O.focus()),Y.length>0){var tl=new b4(Y,!1,g,t$.ENABLE_MULTI_TOUCH?RX.getAllTouches():Y);v._eventTarget.emit(g,tl)}}},g._getCanvasRect=function(){var g=this._canvas,v=null==g?void 0:g.getBoundingClientRect();return v?new ic(v.x,v.y,v.width,v.height):new ic(0,0,0,0)},g._getLocation=function(g,v){if(globalThis.__globalXR&&globalThis.__globalXR.ar&&globalThis.__globalXR.ar.isWebXR())return new e8(g.clientX,g.clientY);var S=g.clientX-v.x,O=v.y+v.height-g.clientY;if(a$.isFrameRotated){var X=S;S=v.height-O,O=X}var Y=a$.devicePixelRatio;return new e8(S*=Y,O*=Y)},g.on=function(g,v,S){this._eventTarget.on(g,v,S)},t1}();!function(g){g[g.GLOBAL=0]="GLOBAL",g[g.UI=1]="UI"}(Rk||(Rk={}));var Rq=function(){function t1(g){this.priority=Rk.GLOBAL,this._inputEventTarget=void 0,this._inputEventTarget=g}return t1.prototype.dispatchEvent=function(g){return this._inputEventTarget.emit(g.type,g),!0},t1}(),RY=((RN={})[bQ.MOUSE_DOWN]=bQ.TOUCH_START,RN[bQ.MOUSE_MOVE]=bQ.TOUCH_MOVE,RN[bQ.MOUSE_UP]=bQ.TOUCH_END,RN),RK=g("el",function(){function t1(){this._dispatchImmediately=!0,this._eventTarget=new aC,this._touchInput=new Rj,this._mouseInput=new Rz,this._keyboardInput=new RH,this._accelerometerInput=new Ro,this._handleInput=new RF,this._hmdInput=new RG,this._handheldInput=new RV,this._eventTouchList=[],this._eventMouseList=[],this._eventKeyboardList=[],this._eventAccelerationList=[],this._eventGamepadList=[],this._eventHandleList=[],this._eventHMDList=[],this._eventHandheldList=[],this._needSimulateTouchMoveEvent=!1,this._inputEventDispatcher=void 0,this._eventDispatcherList=[],this._registerEvent(),this._inputEventDispatcher=new Rq(this._eventTarget),this._registerEventDispatcher(this._inputEventDispatcher),RM._init()}var g=t1.prototype;return g._dispatchMouseDownEvent=function(g){var v,S;null===(v=(S=this._mouseInput).dispatchMouseDownEvent)||void 0===v||v.call(S,g)},g._dispatchMouseMoveEvent=function(g){var v,S;null===(v=(S=this._mouseInput).dispatchMouseMoveEvent)||void 0===v||v.call(S,g)},g._dispatchMouseUpEvent=function(g){var v,S;null===(v=(S=this._mouseInput).dispatchMouseUpEvent)||void 0===v||v.call(S,g)},g._dispatchMouseScrollEvent=function(g){var v,S;null===(v=(S=this._mouseInput).dispatchScrollEvent)||void 0===v||v.call(S,g)},g._dispatchKeyboardDownEvent=function(g){var v,S;null===(v=(S=this._keyboardInput).dispatchKeyboardDownEvent)||void 0===v||v.call(S,g)},g._dispatchKeyboardUpEvent=function(g){var v,S;null===(v=(S=this._keyboardInput).dispatchKeyboardUpEvent)||void 0===v||v.call(S,g)},g.on=function(g,v,S){return this._eventTarget.on(g,v,S),v},g.once=function(g,v,S){return this._eventTarget.once(g,v,S),v},g.off=function(g,v,S){this._eventTarget.off(g,v,S)},g.getTouch=function(g){return RX.getTouch(g)},g.getAllTouches=function(){return RX.getAllTouches()},g.getTouchCount=function(){return RX.getTouchCount()},g.setAccelerometerEnabled=function(g){g?this._accelerometerInput.start():this._accelerometerInput.stop()},g.setAccelerometerInterval=function(g){this._accelerometerInput.setInterval(g)},g._simulateEventTouch=function(g){var v=RY[g.type],S=RX.getOrCreateTouch(0,g.getLocationX(),g.getLocationY());if(S){var O=[S],X=new b4(O,!1,v,v===bQ.TOUCH_END?[]:O);X.windowId=g.windowId,v===bQ.TOUCH_END&&RX.releaseTouch(0),this._dispatchOrPushEventTouch(X,this._eventTouchList)}},g._registerEventDispatcher=function(g){this._eventDispatcherList.push(g),this._eventDispatcherList.sort(function(g,v){return v.priority-g.priority})},g._emitEvent=function(g){for(var v=this._eventDispatcherList.length,S=0;S<v;++S){var O=this._eventDispatcherList[S];try{if(!O.dispatchEvent(g))break}catch(g){throw this._clearEvents(),g}}},g._registerEvent=function(){var g=this;if(a3.hasFeature(a3.Feature.INPUT_TOUCH)){var v=this._eventTouchList;this._touchInput.on(bQ.TOUCH_START,function(S){g._dispatchOrPushEventTouch(S,v)}),this._touchInput.on(bQ.TOUCH_MOVE,function(S){g._dispatchOrPushEventTouch(S,v)}),this._touchInput.on(bQ.TOUCH_END,function(S){g._dispatchOrPushEventTouch(S,v)}),this._touchInput.on(bQ.TOUCH_CANCEL,function(S){g._dispatchOrPushEventTouch(S,v)})}if(a3.hasFeature(a3.Feature.EVENT_MOUSE)){var S=this._eventMouseList;this._mouseInput.on(bQ.MOUSE_DOWN,function(v){g._needSimulateTouchMoveEvent=!0,g._simulateEventTouch(v),g._dispatchOrPushEvent(v,S)}),this._mouseInput.on(bQ.MOUSE_MOVE,function(v){g._needSimulateTouchMoveEvent&&g._simulateEventTouch(v),g._dispatchOrPushEvent(v,S)}),this._mouseInput.on(bQ.MOUSE_UP,function(v){g._needSimulateTouchMoveEvent=!1,g._simulateEventTouch(v),g._dispatchOrPushEvent(v,S)}),this._mouseInput.on(bQ.MOUSE_WHEEL,function(v){g._dispatchOrPushEvent(v,S)})}if(a3.hasFeature(a3.Feature.EVENT_KEYBOARD)){var O=this._eventKeyboardList;this._keyboardInput.on(bQ.KEY_DOWN,function(v){g._dispatchOrPushEvent(v,O)}),this._keyboardInput.on(bQ.KEY_PRESSING,function(v){g._dispatchOrPushEvent(v,O)}),this._keyboardInput.on(bQ.KEY_UP,function(v){g._dispatchOrPushEvent(v,O)})}if(a3.hasFeature(a3.Feature.EVENT_ACCELEROMETER)){var X=this._eventAccelerationList;this._accelerometerInput.on(bQ.DEVICEMOTION,function(v){g._dispatchOrPushEvent(v,X)})}if(a3.hasFeature(a3.Feature.EVENT_GAMEPAD)){var Y=this._eventGamepadList;RM._on(bQ.GAMEPAD_CHANGE,function(v){g._dispatchOrPushEvent(v,Y)}),RM._on(bQ.GAMEPAD_INPUT,function(v){g._dispatchOrPushEvent(v,Y)}),RM._on(bQ.HANDLE_POSE_INPUT,function(v){g._dispatchOrPushEvent(v,Y)})}if(a3.hasFeature(a3.Feature.EVENT_HANDLE)){var te=this._eventHandleList;this._handleInput._on(bQ.HANDLE_INPUT,function(v){g._dispatchOrPushEvent(v,te)}),this._handleInput._on(bQ.HANDLE_POSE_INPUT,function(v){g._dispatchOrPushEvent(v,te)})}if(a3.hasFeature(a3.Feature.EVENT_HMD)){var ti=this._eventHMDList;this._hmdInput._on(bQ.HMD_POSE_INPUT,function(v){g._dispatchOrPushEvent(v,ti)})}if(a3.hasFeature(a3.Feature.EVENT_HANDHELD)){var tr=this._eventHandheldList;this._handheldInput._on(bQ.HANDHELD_POSE_INPUT,function(v){g._dispatchOrPushEvent(v,tr)})}},g._clearEvents=function(){this._eventMouseList.length=0,this._eventTouchList.length=0,this._eventKeyboardList.length=0,this._eventAccelerationList.length=0,this._eventGamepadList.length=0,this._eventHandleList.length=0,this._eventHMDList.length=0},g._dispatchOrPushEvent=function(g,v){this._dispatchImmediately?this._emitEvent(g):v.push(g)},g._dispatchOrPushEventTouch=function(g,v){if(this._dispatchImmediately)for(var S=g.getTouches(),O=S.length,X=0;X<O;++X)g.touch=S[X],g.propagationStopped=g.propagationImmediateStopped=!1,this._emitEvent(g);else v.push(g)},g._frameDispatchEvents=function(){for(var g=this._eventHMDList,v=0,S=g.length;v<S;++v){var O=g[v];this._emitEvent(O)}for(var X=this._eventHandheldList,Y=0,te=X.length;Y<te;++Y){var ti=X[Y];this._emitEvent(ti)}for(var tr=this._eventMouseList,ta=0,th=tr.length;ta<th;++ta){var tu=tr[ta];this._emitEvent(tu)}for(var tl=this._eventTouchList,tc=0,t_=tl.length;tc<t_;++tc)for(var tf=tl[tc],tp=tf.getTouches(),tm=tp.length,tg=0;tg<tm;++tg)tf.touch=tp[tg],tf.propagationStopped=tf.propagationImmediateStopped=!1,this._emitEvent(tf);for(var tv=this._eventKeyboardList,ty=0,tS=tv.length;ty<tS;++ty){var tA=tv[ty];this._emitEvent(tA)}for(var tT=this._eventAccelerationList,tE=0,tC=tT.length;tE<tC;++tE){var tx=tT[tE];this._emitEvent(tx)}for(var tb=this._eventGamepadList,tw=0,tI=tb.length;tw<tI;++tw){var tB=tb[tw];this._emitEvent(tB)}for(var tP=this._eventHandleList,tD=0,tM=tP.length;tD<tM;++tD){var tO=tP[tD];this._emitEvent(tO)}this._clearEvents()},t1}());RK.EventType=bQ;var RJ=g("ek",new RK),RZ=g("en",function(g){function e(){var v;return v=g.call(this)||this,RJ.on(bQ.MOUSE_DOWN,function(g){v.emit(bZ.MOUSE_DOWN,g)}),RJ.on(bQ.MOUSE_MOVE,function(g){v.emit(bZ.MOUSE_MOVE,g)}),RJ.on(bQ.MOUSE_UP,function(g){v.emit(bZ.MOUSE_UP,g)}),RJ.on(bQ.MOUSE_WHEEL,function(g){v.emit(bZ.MOUSE_WHEEL,g)}),RJ.on(bQ.TOUCH_START,function(g){v.emit(bZ.TOUCH_START,g.touch,g)}),RJ.on(bQ.TOUCH_MOVE,function(g){v.emit(bZ.TOUCH_MOVE,g.touch,g)}),RJ.on(bQ.TOUCH_END,function(g){v.emit(bZ.TOUCH_END,g.touch,g)}),RJ.on(bQ.TOUCH_CANCEL,function(g){v.emit(bZ.TOUCH_CANCEL,g.touch,g)}),RJ.on(bQ.KEY_DOWN,function(g){v.emit(bZ.KEY_DOWN,g)}),RJ.on(bQ.KEY_PRESSING,function(g){v.emit(bZ.KEY_DOWN,g)}),RJ.on(bQ.KEY_UP,function(g){v.emit(bZ.KEY_UP,g)}),RJ.on(bQ.DEVICEMOTION,function(g){v.emit(bZ.DEVICEMOTION,g)}),v}s(e,g);var v=e.prototype;return v.setAccelerometerEnabled=function(g){RJ.setAccelerometerEnabled(g)},v.setAccelerometerInterval=function(g){RJ.setAccelerometerInterval(g)},v.on=function(v,S,O,X){return g.prototype.on.call(this,v,S,O,X),S},v.off=function(v,S,O){g.prototype.off.call(this,v,S,O)},e}(aC));RZ.EventType=bZ,X.SystemEvent=RZ;var RQ=g("em",new RZ);X.systemEvent=RQ;var R$,R2=new h8(null),R3=function(){function t1(){this._device=null,this._passes=null,this._shaders=null,this._subMesh=null,this._patches=null,this._priority=_u.DEFAULT,this._inputAssembler=null,this._descriptorSet=null,this._worldBoundDescriptorSet=null,this._reflectionTex=null,this._reflectionSampler=null,this._instancedAttributeBlock={buffer:null,views:[],attributes:[]},this._instancedWorldMatrixIndex=-1,this._instancedSHIndex=-1,this._useReflectionProbeType=0}var g=t1.prototype;return g.initialize=function(g,v,S){void 0===S&&(S=null);var O=X.director.root;this._device=uZ.gfxDevice,R2.layout=v[0].localSetLayout,this._inputAssembler=this._device.createInputAssembler(g.iaInfo),this._descriptorSet=this._device.createDescriptorSet(R2);var Y=X.director.root.pipeline.pipelineSceneData.getOcclusionQueryPass();if(Y){var te=new h8(null);te.layout=Y.localSetLayout,this._worldBoundDescriptorSet=this._device.createDescriptorSet(te)}this._subMesh=g,this._patches=S?S.sort():null,this._passes=v,this._flushPassInfo(),this.priority=_u.DEFAULT;var ti=X.rendering;if((!ti||!ti.enableEffectImport)&&v[0].phase===dH("reflection")||Ug()&&v[0].phaseID===ti.getPhaseID(ti.getPassID("default"),"reflection")){var tr=O.mainWindow.width,ta=O.mainWindow.height,th=512;ta<tr?(tr=th*tr/ta,ta=th):ta=th*ta/(tr=th),this._reflectionTex=this._device.createTexture(new hB(ow.TEX2D,oI.STORAGE|oI.TRANSFER_SRC|oI.SAMPLED,oA.RGBA8,tr,ta)),this.descriptorSet.bindTexture(_7,this._reflectionTex),this._reflectionSampler=this._device.getSampler(new hD(oO.LINEAR,oO.LINEAR,oO.NONE,oL.CLAMP,oL.CLAMP,oL.CLAMP)),this.descriptorSet.bindSampler(_7,this._reflectionSampler),this.descriptorSet.bindTexture(fr,this._reflectionTex)}},g.destroy=function(){var g;this._descriptorSet.destroy(),this._descriptorSet=null,this._inputAssembler.destroy(),this._inputAssembler=null,null===(g=this._worldBoundDescriptorSet)||void 0===g||g.destroy(),this._worldBoundDescriptorSet=null,this.priority=_u.DEFAULT,this._patches=null,this._subMesh=null,this._passes=null,this._shaders=null,this._reflectionTex&&this._reflectionTex.destroy(),this._reflectionTex=null,this._reflectionSampler=null},g.update=function(){for(var g,v=0;v<this._passes.length;++v)this._passes[v].update();this._descriptorSet.update(),null===(g=this._worldBoundDescriptorSet)||void 0===g||g.update()},g.onPipelineStateChanged=function(){var g=this._passes;if(g){for(var v=0;v<g.length;v++){var S=g[v];S.beginChangeStatesSilently(),S.tryCompile(),S.endChangeStatesSilently()}this._flushPassInfo()}},g.onMacroPatchesStateChanged=function(g){if((g||this._patches)&&(!g||(g=g.sort(),!this._patches||g.length!==this._patches.length||JSON.stringify(g)!==JSON.stringify(this._patches)))){this._patches=g;var v=this._passes;if(v){for(var S=0;S<v.length;S++){var O=v[S];O.beginChangeStatesSilently(),O.tryCompile(),O.endChangeStatesSilently()}this._flushPassInfo()}}},g.onGeometryChanged=function(){if(this._subMesh){var g=this._subMesh.drawInfo;if(this._inputAssembler&&g){var v=this._inputAssembler.drawInfo;Object.keys(g).forEach(function(S){v[S]=g[S]}),this._inputAssembler.drawInfo=v}}},g.getInstancedAttributeIndex=function(g){for(var v=this.instancedAttributeBlock.attributes,S=0;S<v.length;S++)if(v[S].name===g)return S;return -1},g.updateInstancedWorldMatrix=function(g,v){var S=this.instancedAttributeBlock.views,O=S[v],X=S[v+1],Y=S[v+2];O[0]=g.m00,O[1]=g.m01,O[2]=g.m02,O[3]=g.m12,X[0]=g.m04,X[1]=g.m05,X[2]=g.m06,X[3]=g.m13,Y[0]=g.m08,Y[1]=g.m09,Y[2]=g.m10,Y[3]=g.m14},g.updateInstancedSH=function(g,v){for(var S=this.instancedAttributeBlock.views,O=(Ym.SH_QUADRATIC_R_OFFSET-Ym.SH_LINEAR_CONST_R_OFFSET)/4,X=0,Y=v;Y<v+O;Y++)for(var te=0;te<4;te++)S[Y][te]=g[X++]},g.UpdateInstancedAttributes=function(g){this.instancedWorldMatrixIndex=-1,this.instancedSHIndex=-1;var v=this.passes[0];if(v.device.hasFeature(oS.INSTANCED_ARRAYS)){for(var S=0,O=0;O<g.length;O++){var X=g[O];X.isInstanced&&(S+=uf[X.format].size)}var Y=this.instancedAttributeBlock;Y.buffer=new Uint8Array(S),Y.views.length=Y.attributes.length=0;for(var te=0,ti=0;ti<g.length;ti++){var tr=g[ti];if(tr.isInstanced){var ta=new hz;ta.format=tr.format,ta.name=tr.name,ta.isNormalized=tr.isNormalized,ta.location=tr.location,Y.attributes.push(ta);var th=uf[tr.format],tu=new(D_(th))(Y.buffer.buffer,te,th.count);Y.views.push(tu),te+=th.size}}v.batchingScheme===dG.INSTANCING&&v.getInstancedBuffer().destroy(),this.instancedWorldMatrixIndex=this.getInstancedAttributeIndex(_k),this.instancedSHIndex=this.getInstancedAttributeIndex(_G)}},g._flushPassInfo=function(){var g=this._passes;if(g){this._shaders||(this._shaders=[]),this._shaders.length=g.length;for(var v=0,S=g.length;v<S;v++)this._shaders[v]=g[v].getShaderVariant(this.patches)}},n(t1,[{key:"passes",get:function(){return this._passes},set:function(g){g.length>8?J(12004,8):(this._passes=g,this._flushPassInfo(),this._descriptorSet&&(this._descriptorSet.destroy(),R2.layout=g[0].localSetLayout,this._descriptorSet=this._device.createDescriptorSet(R2)))}},{key:"shaders",get:function(){return this._shaders}},{key:"subMesh",get:function(){return this._subMesh},set:function(g){this._inputAssembler.destroy(),this._inputAssembler=this._device.createInputAssembler(g.iaInfo),this._subMesh=g}},{key:"priority",get:function(){return this._priority},set:function(g){this._priority=g}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"worldBoundDescriptorSet",get:function(){return this._worldBoundDescriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"instancedAttributeBlock",get:function(){return this._instancedAttributeBlock}},{key:"instancedWorldMatrixIndex",get:function(){return this._instancedWorldMatrixIndex},set:function(g){this._instancedWorldMatrixIndex=g}},{key:"instancedSHIndex",get:function(){return this._instancedSHIndex},set:function(g){this._instancedSHIndex=g}},{key:"useReflectionProbeType",get:function(){return this._useReflectionProbeType},set:function(g){this._useReflectionProbeType=g}}]),t1}();!function(g){g[g.NONE=0]="NONE",g[g.BAKED_CUBEMAP=1]="BAKED_CUBEMAP",g[g.PLANAR_REFLECTION=2]="PLANAR_REFLECTION",g[g.BLEND_PROBES=3]="BLEND_PROBES",g[g.BLEND_PROBES_AND_SKYBOX=4]="BLEND_PROBES_AND_SKYBOX"}(R$||(R$={}));var R5,R4=new e$,R8=[{name:"CC_RECEIVE_SHADOW",value:!0}],R6=[{name:"CC_USE_LIGHTMAP",value:1}],R7=[{name:"CC_USE_LIGHTMAP",value:2}],R9=[{name:"CC_LIGHT_MAP_VERSION",value:2}],we=[{name:"CC_USE_LIGHT_PROBE",value:!0}];!function(g){g[g.DEFAULT=0]="DEFAULT",g[g.SKINNING=1]="SKINNING",g[g.BAKED_SKINNING=2]="BAKED_SKINNING",g[g.BATCH_2D=3]="BATCH_2D",g[g.PARTICLE_BATCH=4]="PARTICLE_BATCH",g[g.LINE=5]="LINE"}(R5||(R5={}));var wn,wa=new hD(oO.LINEAR,oO.LINEAR,oO.NONE,oL.CLAMP,oL.CLAMP,oL.CLAMP),wo=new hD(oO.LINEAR,oO.LINEAR,oO.LINEAR,oL.CLAMP,oL.CLAMP,oL.CLAMP),wh=function(){function t1(){this.type=R5.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._localDataUpdated=!0,this._localData=new Float32Array(Mm.COUNT),this._localBuffer=null,this._localSHData=null,this._localSHBuffer=null,this._lightmap=null,this._lightmapUVParam=new e7,this._tetrahedronIndex=-1,this._lastWorldBoundCenter=new eL(1/0,1/0,1/0),this._useLightProbe=!1,this._worldBoundBuffer=null,this._receiveShadow=!1,this._castShadow=!1,this._receiveDirLight=!0,this._shadowBias=0,this._shadowNormalBias=0,this._reflectionProbeId=-1,this._reflectionProbeBlendId=-1,this._reflectionProbeBlendWeight=0,this._enabled=!0,this._visFlags=_a.Enum.NONE,this._priority=0,this._bakeToReflectionProbe=!0,this._reflectionProbeType=R$.NONE,this._device=uZ.gfxDevice}var g=t1.prototype;return g.initialize=function(){this._inited||(this._receiveShadow=!0,this.castShadow=!1,this.enabled=!0,this.visFlags=_a.Enum.NONE,this._inited=!0,this._bakeToReflectionProbe=!0,this._reflectionProbeType=R$.NONE)},g.destroy=function(){for(var g=this._subModels,v=0;v<g.length;v++)this._subModels[v].destroy();this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._localSHBuffer&&(this._localSHBuffer.destroy(),this._localSHBuffer=null),this._worldBoundBuffer&&(this._worldBoundBuffer.destroy(),this._worldBoundBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._localDataUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1},g.attachToScene=function(g){this.scene=g,this._localDataUpdated=!0},g.detachFromScene=function(){this.scene=null},g.updateTransform=function(){var g=this.transform;if(g.hasChangedFlags||g.isTransformDirty()){g.updateWorldTransform(),this._localDataUpdated=!0;var v=this._worldBounds;this._modelBounds&&v&&this._modelBounds.transform(g._mat,g._pos,g._rot,g._scale,v)}},g.updateWorldBound=function(){var g=this.transform;if(null!==g){g.updateWorldTransform(),this._localDataUpdated=!0;var v=this._worldBounds;this._modelBounds&&v&&this._modelBounds.transform(g._mat,g._pos,g._rot,g._scale,v)}},g.updateUBOs=function(g){for(var v=this._subModels,S=0;S<v.length;S++)v[S].update();this._updateStamp=g,this.updateSHUBOs();var O=this.node.scene.globals.shadows.enabled&&this.node.scene.globals.shadows.type===px.Planar;if(this._localDataUpdated){this._localDataUpdated=!1;for(var X=this.transform._mat,Y=!1,te=0;te<v.length;te++){var ti=v[te],tr=ti.instancedWorldMatrixIndex;tr>=0?ti.updateInstancedWorldMatrix(X,tr):Y=!0}(Y||O)&&this._localBuffer&&(e$.toArray(this._localData,X,Mm.MAT_WORLD_OFFSET),e$.invert(R4,X),e$.transpose(R4,R4),e$.toArray(this._localData,R4,Mm.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData))}},g.invalidateLocalData=function(){this._localDataUpdated=!0},g.showTetrahedron=function(){return this.isLightProbeAvailable()},g.isLightProbeAvailable=function(){if(!this._useLightProbe)return!1;var g=X.director.root.pipeline.pipelineSceneData.lightProbes;return!(!g||g.empty()||!this._worldBounds)},g.updateSHBuffer=function(){if(this._localSHData){for(var g=this._subModels,v=!1,S=0;S<g.length;S++){var O=g[S],X=O.instancedSHIndex;X>=0?O.updateInstancedSH(this._localSHData,X):v=!0}v&&this._localSHBuffer&&this._localSHBuffer.update(this._localSHData)}},g.clearSHUBOs=function(){if(this._localSHData){for(var g=0;g<Ym.COUNT;g++)this._localSHData[g]=0;this.updateSHBuffer()}},g.updateSHUBOs=function(){if(this.isLightProbeAvailable()){var g=this._worldBounds.center;if(!g.equals(this._lastWorldBoundCenter,ex)){var v=[],S=new e7(0,0,0,0),O=X.director.root.pipeline.pipelineSceneData.lightProbes;this._lastWorldBoundCenter.set(g),this._tetrahedronIndex=O.data.getInterpolationWeights(g,this._tetrahedronIndex,S),O.data.getInterpolationSHCoefficients(this._tetrahedronIndex,S,v)&&this._localSHData&&(X.internal.SH.reduceRinging(v,O.reduceRinging),X.internal.SH.updateUBOData(this._localSHData,Ym.SH_LINEAR_CONST_R_OFFSET,v),this.updateSHBuffer())}}},g.createBoundingShape=function(g,v){g&&v&&(this._modelBounds||(this._modelBounds=iK.create()),this._worldBounds||(this._worldBounds=iK.create()),iK.fromPoints(this._modelBounds,g,v),iK.copy(this._worldBounds,this._modelBounds))},g._createSubModel=function(){return new R3},g.initSubModel=function(g,v,S){this.initialize(),null==this._subModels[g]?this._subModels[g]=this._createSubModel():this._subModels[g].destroy(),this._subModels[g].initialize(v,S.passes,this.getMacroPatches(g)),this._updateAttributesAndBinding(g)},g.setSubModelMesh=function(g,v){this._subModels[g]&&(this._subModels[g].subMesh=v)},g.setSubModelMaterial=function(g,v){this._subModels[g]&&(this._subModels[g].passes=v.passes,this._updateAttributesAndBinding(g))},g.onGlobalPipelineStateChanged=function(){for(var g=this._subModels,v=0;v<g.length;v++)g[v].onPipelineStateChanged()},g.onMacroPatchesStateChanged=function(){for(var g=this._subModels,v=0;v<g.length;v++)g[v].onMacroPatchesStateChanged(this.getMacroPatches(v))},g.onGeometryChanged=function(){for(var g=this._subModels,v=0;v<g.length;v++)g[v].onGeometryChanged()},g.initLightingmap=function(g,v){this._lightmap=g,this._lightmapUVParam=v},g.updateLightingmap=function(g,v){e7.toArray(this._localData,v,Mm.LIGHTINGMAP_UVPARAM),this._localDataUpdated=!0,this._lightmap=g,this._lightmapUVParam=v,this.onMacroPatchesStateChanged(),g||(g=dU.get("empty-texture"));var S=g.getGFXTexture();if(S)for(var O=this._device.getSampler(g.mipmaps.length>1?wo:wa),X=this._subModels,Y=0;Y<X.length;Y++){var te=X[Y].descriptorSet;te.bindTexture(_2,S),te.bindSampler(_2,O),te.update()}},g.updateReflectionProbeCubemap=function(g){this._localDataUpdated=!0,this.onMacroPatchesStateChanged(),g||(g=dU.get("default-cube-texture"));var v=g.getGFXTexture();if(v)for(var S=this._device.getSampler(g.getSamplerInfo()),O=this._subModels,X=0;X<O.length;X++){var Y=O[X].descriptorSet;Y&&(Y.bindSampler(fh,S),Y.bindTexture(fh,v),Y.update())}},g.updateReflectionProbeBlendCubemap=function(g){this._localDataUpdated=!0,this.onMacroPatchesStateChanged(),g||(g=dU.get("default-cube-texture"));var v=g.getGFXTexture();if(v)for(var S=this._device.getSampler(g.getSamplerInfo()),O=this._subModels,X=0;X<O.length;X++){var Y=O[X].descriptorSet;Y&&(Y.bindSampler(fy,S),Y.bindTexture(fy,v),Y.update())}},g.updateReflectionProbePlanarMap=function(g){this._localDataUpdated=!0,this.onMacroPatchesStateChanged();var v=this._device.getSampler(new hD(oO.LINEAR,oO.LINEAR,oO.NONE,oL.CLAMP,oL.CLAMP,oL.CLAMP));if(g||(g=dU.get("empty-texture").getGFXTexture()),g)for(var S=this._subModels,O=0;O<S.length;O++){var X=S[O].descriptorSet;X&&(X.bindTexture(fc,g),X.bindSampler(fc,v),X.update())}},g.updateReflectionProbeDataMap=function(g){this._localDataUpdated=!0,this.onMacroPatchesStateChanged(),g||(g=dU.get("empty-texture"));var v=g.getGFXTexture();if(v)for(var S=this._subModels,O=0;O<S.length;O++){var X=S[O].descriptorSet;X&&(X.bindTexture(fm,v),X.bindSampler(fm,g.getGFXSampler()),X.update())}},g.updateLocalShadowBias=function(){var g=this._localData;g[Mm.LOCAL_SHADOW_BIAS+0]=this._shadowBias,g[Mm.LOCAL_SHADOW_BIAS+1]=this._shadowNormalBias,this._localDataUpdated=!0},g.updateReflectionProbeId=function(){var g=this._localData;g[Mm.LOCAL_SHADOW_BIAS+2]=this._reflectionProbeId,g[Mm.LOCAL_SHADOW_BIAS+3]=this._reflectionProbeBlendId;var v=null,S=null;if(X.internal.reflectionProbeManager&&(v=X.internal.reflectionProbeManager.getProbeById(this._reflectionProbeId),S=X.internal.reflectionProbeManager.getProbeById(this._reflectionProbeBlendId)),v){if(v.probeType===pH.PLANAR)g[Mm.REFLECTION_PROBE_DATA1]=v.node.up.x,g[Mm.REFLECTION_PROBE_DATA1+1]=v.node.up.y,g[Mm.REFLECTION_PROBE_DATA1+2]=v.node.up.z,g[Mm.REFLECTION_PROBE_DATA1+3]=1,g[Mm.REFLECTION_PROBE_DATA2]=1,g[Mm.REFLECTION_PROBE_DATA2+1]=0,g[Mm.REFLECTION_PROBE_DATA2+2]=0,g[Mm.REFLECTION_PROBE_DATA2+3]=1;else{g[Mm.REFLECTION_PROBE_DATA1]=v.node.worldPosition.x,g[Mm.REFLECTION_PROBE_DATA1+1]=v.node.worldPosition.y,g[Mm.REFLECTION_PROBE_DATA1+2]=v.node.worldPosition.z,g[Mm.REFLECTION_PROBE_DATA1+3]=0,g[Mm.REFLECTION_PROBE_DATA2]=v.size.x,g[Mm.REFLECTION_PROBE_DATA2+1]=v.size.y,g[Mm.REFLECTION_PROBE_DATA2+2]=v.size.z;var O=v.isRGBE()?1e3:0;g[Mm.REFLECTION_PROBE_DATA2+3]=v.cubemap?v.cubemap.mipmapLevel+O:1+O}if(this._reflectionProbeType===R$.BLEND_PROBES||this._reflectionProbeType===R$.BLEND_PROBES_AND_SKYBOX){if(S){g[Mm.REFLECTION_PROBE_BLEND_DATA1]=S.node.worldPosition.x,g[Mm.REFLECTION_PROBE_BLEND_DATA1+1]=S.node.worldPosition.y,g[Mm.REFLECTION_PROBE_BLEND_DATA1+2]=S.node.worldPosition.z,g[Mm.REFLECTION_PROBE_BLEND_DATA1+3]=this.reflectionProbeBlendWeight,g[Mm.REFLECTION_PROBE_BLEND_DATA2]=S.size.x,g[Mm.REFLECTION_PROBE_BLEND_DATA2+1]=S.size.y,g[Mm.REFLECTION_PROBE_BLEND_DATA2+2]=S.size.z;var Y=S.isRGBE()?1e3:0;g[Mm.REFLECTION_PROBE_BLEND_DATA2+3]=S.cubemap?S.cubemap.mipmapLevel+Y:1+Y}else this._reflectionProbeType===R$.BLEND_PROBES_AND_SKYBOX&&(g[Mm.REFLECTION_PROBE_BLEND_DATA1+3]=this.reflectionProbeBlendWeight)}}this._localDataUpdated=!0},g.getMacroPatches=function(){var g=this.receiveShadow?R8:null;if(null!=this._lightmap&&this.node&&this.node.scene&&!this.node.scene.globals.disableLightmap){var v=this.node.scene.globals.bakedWithStationaryMainLight?R7:R6;g=g?g.concat(v):v,this.node.scene.globals.bakedWithHighpLightmap&&(g=g.concat(R9))}this._useLightProbe&&(g=g?g.concat(we):we);var S=[{name:"CC_USE_REFLECTION_PROBE",value:this._reflectionProbeType}];g=g?g.concat(S):S;var O=[{name:"CC_DISABLE_DIRECTIONAL_LIGHT",value:!this._receiveDirLight}];return g?g.concat(O):O},g._updateAttributesAndBinding=function(g){var v=this._subModels[g];if(v){this._initLocalDescriptors(g),this._updateLocalDescriptors(g,v.descriptorSet),this._initLocalSHDescriptors(g),this._updateLocalSHDescriptors(g,v.descriptorSet),this._initWorldBoundDescriptors(g),v.worldBoundDescriptorSet&&this._updateWorldBoundDescriptors(g,v.worldBoundDescriptorSet);for(var S,O=[],X=new Set,Y=f(v.passes);!(S=Y()).done;)for(var te,ti=f(S.value.getShaderVariant(v.patches).attributes);!(te=ti()).done;){var tr=te.value;X.has(tr.name)||(O.push(tr),X.add(tr.name))}this._updateInstancedAttributes(O,v)}},g._updateInstancedAttributes=function(g,v){v.UpdateInstancedAttributes(g),this._localDataUpdated=!0},g._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.DEVICE,Mm.SIZE,Mm.SIZE)))},g._initLocalSHDescriptors=function(){this._useLightProbe&&(this._localSHData||(this._localSHData=new Float32Array(Ym.COUNT)),this._localSHBuffer||(this._localSHBuffer=this._device.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.DEVICE,Ym.SIZE,Ym.SIZE))))},g._initWorldBoundDescriptors=function(){this._worldBoundBuffer||(this._worldBoundBuffer=this._device.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.DEVICE,Lm.SIZE,Lm.SIZE)))},g._updateLocalDescriptors=function(g,v){this._localBuffer&&v.bindBuffer(Mm.BINDING,this._localBuffer)},g._updateLocalSHDescriptors=function(g,v){this._localSHBuffer&&v.bindBuffer(Ym.BINDING,this._localSHBuffer)},g._updateWorldBoundDescriptors=function(g,v){this._worldBoundBuffer&&v.bindBuffer(Lm.BINDING,this._worldBoundBuffer)},n(t1,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"localSHBuffer",get:function(){return this._localSHBuffer}},{key:"worldBoundBuffer",get:function(){return this._worldBoundBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"useLightProbe",get:function(){return this._useLightProbe},set:function(g){this._useLightProbe=g,this.onMacroPatchesStateChanged()}},{key:"tetrahedronIndex",get:function(){return this._tetrahedronIndex},set:function(g){this._tetrahedronIndex=g}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(g){this._shadowBias=g}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(g){this._shadowNormalBias=g}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(g){this._receiveShadow=g,this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return this._castShadow},set:function(g){this._castShadow=g}},{key:"receiveDirLight",get:function(){return this._receiveDirLight},set:function(g){this._receiveDirLight=g,this.onMacroPatchesStateChanged()}},{key:"node",get:function(){return this._node},set:function(g){this._node=g}},{key:"transform",get:function(){return this._transform},set:function(g){this._transform=g}},{key:"visFlags",get:function(){return this._visFlags},set:function(g){this._visFlags=g}},{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g}},{key:"priority",get:function(){return this._priority},set:function(g){this._priority=g}},{key:"bakeToReflectionProbe",get:function(){return this._bakeToReflectionProbe},set:function(g){this._bakeToReflectionProbe=g}},{key:"reflectionProbeType",get:function(){return this._reflectionProbeType},set:function(g){this._reflectionProbeType=g;for(var v=this._subModels,S=0;S<v.length;S++)v[S].useReflectionProbeType=g;this.onMacroPatchesStateChanged()}},{key:"reflectionProbeId",get:function(){return this._reflectionProbeId},set:function(g){this._reflectionProbeId=g}},{key:"reflectionProbeBlendId",get:function(){return this._reflectionProbeBlendId},set:function(g){this._reflectionProbeBlendId=g}},{key:"reflectionProbeBlendWeight",get:function(){return this._reflectionProbeBlendWeight},set:function(g){this._reflectionProbeBlendWeight=g}}]),t1}(),wu=new eL(0,0,-1),wl=new eL,wc=function(g){function e(){var v;return(v=g.call(this)||this)._dir=new eL(1,-1,-1),v._illuminanceHDR=mZ.SUN_ILLUM,v._illuminanceLDR=1,v._shadowEnabled=!1,v._shadowPcf=pb.HARD,v._shadowBias=1e-5,v._shadowNormalBias=0,v._shadowSaturation=1,v._shadowDistance=50,v._shadowInvisibleOcclusionRange=200,v._csmLevel=pw.LEVEL_4,v._csmNeedUpdate=!1,v._csmLayerLambda=.75,v._csmOptimizationMode=pI.DisableRotationFix,v._csmLayersTransition=!1,v._csmTransitionRange=.05,v._shadowFixedArea=!1,v._shadowNear=.1,v._shadowFar=10,v._shadowOrthoSize=5,v._type=pJ.DIRECTIONAL,v}s(e,g);var v=e.prototype;return v.initialize=function(){g.prototype.initialize.call(this),this.illuminance=mZ.SUN_ILLUM,this.direction=new eL(1,-1,-1)},v.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=eL.transformQuat(wl,wu,this._node.worldRotation))},v.activate=function(){var g=X.director.root,v=g.pipeline;this._shadowEnabled?(this._shadowFixedArea||!v.pipelineSceneData.csmSupported?v.macros.CC_DIR_LIGHT_SHADOW_TYPE=1:this.csmLevel>1&&v.pipelineSceneData.csmSupported?(v.macros.CC_DIR_LIGHT_SHADOW_TYPE=2,v.macros.CC_CASCADED_LAYERS_TRANSITION=this._csmLayersTransition):v.macros.CC_DIR_LIGHT_SHADOW_TYPE=1,v.macros.CC_DIR_SHADOW_PCF_TYPE=this._shadowPcf):v.macros.CC_DIR_LIGHT_SHADOW_TYPE=0,g.onGlobalPipelineStateChanged()},n(e,[{key:"direction",get:function(){return this._dir},set:function(g){eL.normalize(this._dir,g)}},{key:"illuminance",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this.illuminanceHDR=g:this.illuminanceLDR=g}},{key:"illuminanceHDR",get:function(){return this._illuminanceHDR},set:function(g){this._illuminanceHDR=g}},{key:"illuminanceLDR",get:function(){return this._illuminanceLDR},set:function(g){this._illuminanceLDR=g}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(g){this._shadowEnabled=g,this.activate()}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(g){this._shadowPcf=g,this.activate()}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(g){this._shadowBias=g}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(g){this._shadowNormalBias=g}},{key:"shadowSaturation",get:function(){return this._shadowSaturation},set:function(g){this._shadowSaturation=g}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(g){this._shadowDistance=Math.min(g,pP.MAX_FAR)}},{key:"shadowInvisibleOcclusionRange",get:function(){return this._shadowInvisibleOcclusionRange},set:function(g){this._shadowInvisibleOcclusionRange=Math.min(g,pP.MAX_FAR)}},{key:"csmLevel",get:function(){return this._csmLevel},set:function(g){this._csmLevel=g,this.activate()}},{key:"csmNeedUpdate",get:function(){return this._csmNeedUpdate},set:function(g){this._csmNeedUpdate=g}},{key:"csmLayerLambda",get:function(){return this._csmLayerLambda},set:function(g){this._csmLayerLambda=g}},{key:"csmOptimizationMode",get:function(){return this._csmOptimizationMode},set:function(g){this._csmOptimizationMode=g}},{key:"shadowFixedArea",get:function(){return this._shadowFixedArea},set:function(g){this._shadowFixedArea=g,this.activate()}},{key:"shadowNear",get:function(){return this._shadowNear},set:function(g){this._shadowNear=g}},{key:"shadowFar",get:function(){return this._shadowFar},set:function(g){this._shadowFar=Math.min(g,pP.MAX_FAR)}},{key:"shadowOrthoSize",get:function(){return this._shadowOrthoSize},set:function(g){this._shadowOrthoSize=g}},{key:"csmLayersTransition",get:function(){return this._csmLayersTransition},set:function(g){this._csmLayersTransition=g,this.activate()}},{key:"csmTransitionRange",get:function(){return this._csmTransitionRange},set:function(g){this._csmTransitionRange=g}}]),e}(mr),wf=function(g){function e(){var v;return(v=g.call(this)||this)._needUpdate=!1,v._size=.15,v._range=1,v._luminanceHDR=0,v._luminanceLDR=0,v._pos=void 0,v._aabb=void 0,v._aabb=iK.create(),v._pos=new eL,v._type=pJ.SPHERE,v}s(e,g);var v=e.prototype;return v.initialize=function(){g.prototype.initialize.call(this),this.size=.15,this.range=1,this.luminanceHDR=1700/BA(.15),this.luminanceLDR=1},v.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var g=this._range;iK.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,g,g,g),this._needUpdate=!1}},n(e,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(g){this._size=g}},{key:"range",get:function(){return this._range},set:function(g){this._range=g,this._needUpdate=!0}},{key:"luminance",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=g:this.luminanceLDR=g}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(g){this._luminanceHDR=g}},{key:"luminanceLDR",set:function(g){this._luminanceLDR=g}},{key:"aabb",get:function(){return this._aabb}}]),e}(mr),wd=new eL(0,0,-1),wp=new eW,wm=new e$,wg=new e$,wv=new e$,wS=new e$,wA=function(g){function e(){var v;return(v=g.call(this)||this)._dir=new eL(1,-1,-1),v._range=5,v._spotAngle=Math.cos(Math.PI/6),v._angleAttenuationStrength=0,v._pos=void 0,v._aabb=void 0,v._frustum=void 0,v._angle=0,v._needUpdate=!1,v._size=.15,v._luminanceHDR=0,v._luminanceLDR=0,v._shadowEnabled=!1,v._shadowPcf=pb.HARD,v._shadowBias=1e-5,v._shadowNormalBias=0,v._aabb=iK.create(),v._frustum=i9.create(),v._pos=new eL,v._type=pJ.SPOT,v}s(e,g);var v=e.prototype;return v.initialize=function(){g.prototype.initialize.call(this),this.size=.15,this.luminanceHDR=1700/BA(.15),this.luminanceLDR=1,this.range=Math.cos(Math.PI/6),this._dir.set(new eL(1,-1,-1))},v.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),eL.transformQuat(this._dir,wd,this._node.getWorldRotation(wp)),eL.normalize(this._dir,this._dir),iK.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(wm),e$.invert(wm,wm),e$.perspective(wg,this._angle,1,.001,this._range),e$.multiply(wv,wg,wm),this._frustum.update(wv,wS),this._needUpdate=!1)},n(e,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(g){this._size=g}},{key:"range",get:function(){return this._range},set:function(g){this._range=g,this._needUpdate=!0}},{key:"luminance",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=g:this.luminanceLDR=g}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(g){this._luminanceHDR=g}},{key:"luminanceLDR",get:function(){return this._luminanceLDR},set:function(g){this._luminanceLDR=g}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(g){this._angle=g,this._spotAngle=Math.cos(.5*g),this._needUpdate=!0}},{key:"angleAttenuationStrength",get:function(){return this._angleAttenuationStrength},set:function(g){this._angleAttenuationStrength=g,this._needUpdate=!0}},{key:"angle",get:function(){return this._angle}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(g){this._shadowEnabled=g}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(g){this._shadowPcf=g}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(g){this._shadowBias=g}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(g){this._shadowNormalBias=g}}]),e}(mr),wT=function(g){function e(){var v;return(v=g.call(this)||this)._needUpdate=!1,v._range=1,v._luminanceHDR=0,v._luminanceLDR=0,v._pos=void 0,v._aabb=void 0,v._aabb=iK.create(),v._pos=new eL,v._type=pJ.POINT,v}s(e,g);var v=e.prototype;return v.initialize=function(){g.prototype.initialize.call(this),this.range=1,this.luminanceHDR=1700/BA(1),this.luminanceLDR=1},v.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var g=this._range;iK.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,g,g,g),this._needUpdate=!1}},n(e,[{key:"position",get:function(){return this._pos}},{key:"range",get:function(){return this._range},set:function(g){this._range=g,this._needUpdate=!0}},{key:"luminance",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=g:this.luminanceLDR=g}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(g){this._luminanceHDR=g}},{key:"luminanceLDR",set:function(g){this._luminanceLDR=g}},{key:"aabb",get:function(){return this._aabb}}]),e}(mr),wE=new eL(0,0,-1),wC=function(g){function e(){var v;return(v=g.call(this)||this)._dir=new eL(0,0,-1),v._pos=new eL(0,0,0),v._scale=new eL(1,1,1),v._right=new eL(1,0,0),v._illuminanceHDR=mZ.SUN_ILLUM,v._illuminanceLDR=1,v._type=pJ.RANGED_DIRECTIONAL,v}s(e,g);var v=e.prototype;return v.initialize=function(){g.prototype.initialize.call(this),this.illuminance=mZ.SUN_ILLUM},v.update=function(){this._node&&this._node.hasChangedFlags&&(this._node.getWorldPosition(this._pos),this._node.getWorldScale(this._scale),eL.transformQuat(this._dir,wE,this._node.worldRotation),eL.transformQuat(this._right,eL.RIGHT,this._node.worldRotation))},n(e,[{key:"direction",get:function(){return this._dir}},{key:"right",get:function(){return this._right}},{key:"position",get:function(){return this._pos}},{key:"scale",get:function(){return this._scale}},{key:"illuminance",get:function(){return X.director.root.pipeline.pipelineSceneData.isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(g){X.director.root.pipeline.pipelineSceneData.isHDR?this.illuminanceHDR=g:this.illuminanceLDR=g}},{key:"illuminanceHDR",get:function(){return this._illuminanceHDR},set:function(g){this._illuminanceHDR=g}},{key:"illuminanceLDR",get:function(){return this._illuminanceLDR},set:function(g){this._illuminanceLDR=g}}]),e}(mr),wx=function(){function t1(){this.screenUsagePercentage=1,this._models=[]}var g=t1.prototype;return g.addModel=function(g){this._models.splice(0,0,g)},g.eraseModel=function(g){var v=this._models.indexOf(g);v>=0&&this._models.splice(v,1)},g.clearModels=function(){this._models.length=0},n(t1,[{key:"models",get:function(){return this._models}}]),t1}(),wb=function(){function t1(){this.scene=void 0,this.node=null,this._device=void 0,this.enabled=!0,this._localBoundaryCenter=new eL(0,0,0),this._objectSize=1,this._lodDataArray=[],this._lockedLODLevelVec=[],this._isLockLevelChanged=!1,this._device=uZ.gfxDevice}var g=t1.prototype;return g.attachToScene=function(g){this.scene=g},g.detachFromScene=function(){this.scene=null},g.lockLODLevels=function(g){if(g.length!==this._lockedLODLevelVec.length)this._isLockLevelChanged=!0;else for(var v=g.length,S=0;S<v;S++)if(g[S]!==this._lockedLODLevelVec[S]){this._isLockLevelChanged=!0;break}this._lockedLODLevelVec=g.slice()},g.isLockLevelChanged=function(){return this._isLockLevelChanged},g.resetLockChangeFlag=function(){this._isLockLevelChanged=!1},g.getLockedLODLevels=function(){return this._lockedLODLevelVec},g.clearLODs=function(){this._lodDataArray.length=0},g.insertLOD=function(g,v){this._lodDataArray.splice(g,0,v)},g.updateLOD=function(g,v){this._lodDataArray[g]=v},g.eraseLOD=function(g){this._lodDataArray.splice(g,1)},g.getVisibleLODLevel=function(g){for(var v=this.getScreenUsagePercentage(g),S=-1,O=0;O<this.lodCount;++O)if(v>=this.lodDataArray[O].screenUsagePercentage){S=O;break}return S},g.getScreenUsagePercentage=function(g){var v;return this.node?(g.projectionType===pr.PERSPECTIVE&&(v=eL.len(this.localBoundaryCenter.transformMat4(this.node.worldMatrix).subtract(g.node.worldPosition))),this.distanceToScreenUsagePercentage(g,v,this.getWorldSpaceSize())):0},g.distanceToScreenUsagePercentage=function(g,v,S){return g.projectionType===pr.PERSPECTIVE?S*g.matProj.m05/(2*v):S*g.matProj.m05*.5},g.getWorldSpaceSize=function(){var g=this.node.scale;return Math.max(Math.abs(g.x),Math.abs(g.y),Math.abs(g.z))*this.objectSize},n(t1,[{key:"localBoundaryCenter",get:function(){return this._localBoundaryCenter.clone()},set:function(g){this._localBoundaryCenter.set(g)}},{key:"lodCount",get:function(){return this._lodDataArray.length}},{key:"objectSize",get:function(){return this._objectSize},set:function(g){this._objectSize=g}},{key:"lodDataArray",get:function(){return this._lodDataArray}}]),t1}(),wR=Object.freeze({__proto__:null,get CameraFOVAxis(){return pe},get CameraProjection(){return pr},get CameraAperture(){return ps},get CameraISO(){return pa},get CameraShutter(){return ph},get CameraType(){return pu},get TrackingType(){return pl},get CameraUsage(){return pc},SKYBOX_FLAG:pA,Camera:pE,get ModelType(){return R5},Model:wh,SubModel:R3,Ambient:mZ,EnvironmentLightingType:m3,Skybox:m4,ShadowSize:pC,ShadowType:px,PCFType:pb,CSMLevel:pw,CSMOptimizationMode:pI,Shadows:pP,FogType:m6,FOG_TYPE_NONE:m7,Fog:m9,Octree:Cl,Skin:CM,ColorTemperatureToRGB:gA,get LightType(){return pJ},nt2lm:BA,Light:mr,DirectionalLight:wc,SphereLight:wf,SpotLight:wA,PointLight:wT,RangedDirectionalLight:wC,get ProbeClearFlag(){return pU},get ProbeType(){return pH},ReflectionProbe:pK,LODData:wx,LODGroup:wb,ToneMappingType:yN,PostSettings:yk}),ww=function(){function t1(g){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._lodGroups=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._pointLights=[],this._rangedDirLights=[],this._mainLight=null,this._modelId=0,this._lodStateCache=null,this._root=g}t1.registerCreateFunc=function(g){g._createSceneFun=function(g){return new t1(g)}};var g=t1.prototype;return g.initialize=function(g){return this._name=g.name,this._lodStateCache=new wI(this),!0},g.update=function(g){var v=this._mainLight;v&&v.update();for(var S=this._sphereLights,O=0;O<S.length;O++)S[O].update();for(var X=this._spotLights,Y=0;Y<X.length;Y++)X[Y].update();for(var te=this._pointLights,ti=0;ti<te.length;ti++)te[ti].update();for(var tr=this._rangedDirLights,ta=0;ta<tr.length;ta++)tr[ta].update();for(var th=this._models,tu=0;tu<th.length;tu++){var tl=th[tu];tl.enabled&&(tl.updateTransform(g),tl.updateUBOs(g))}this._lodStateCache.updateLodState()},g.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeRangedDirLights(),this.removeModels(),this.removeLODGroups(),this._lodStateCache.clearCache()},g.isCulledByLod=function(g,v){return this._lodStateCache.isLodModelCulled(g,v)},g.addCamera=function(g){g.attachToScene(this),this._cameras.push(g),this._lodStateCache.addCamera(g)},g.removeCamera=function(g){for(var v=0;v<this._cameras.length;++v)if(this._cameras[v]===g)return this._cameras.splice(v,1),g.detachFromScene(),void this._lodStateCache.removeCamera(g)},g.removeCameras=function(){for(var g,v=f(this._cameras);!(g=v()).done;){var S=g.value;S.detachFromScene(),this._lodStateCache.removeCamera(S)}this._cameras.splice(0)},g.setMainLight=function(g){this._mainLight=g,this._mainLight&&this._mainLight.activate()},g.unsetMainLight=function(g){if(this._mainLight===g){var v=this._directionalLights;if(v.length)return this.setMainLight(v[v.length-1]),void(this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=pq.ROTATION));this.setMainLight(null)}},g.addDirectionalLight=function(g){g.attachToScene(this),this._directionalLights.push(g)},g.removeDirectionalLight=function(g){for(var v=0;v<this._directionalLights.length;++v)if(this._directionalLights[v]===g)return g.detachFromScene(),void this._directionalLights.splice(v,1)},g.addSphereLight=function(g){g.attachToScene(this),this._sphereLights.push(g)},g.removeSphereLight=function(g){for(var v=0;v<this._sphereLights.length;++v)if(this._sphereLights[v]===g)return g.detachFromScene(),void this._sphereLights.splice(v,1)},g.addSpotLight=function(g){g.attachToScene(this),this._spotLights.push(g)},g.removeSpotLight=function(g){for(var v=0;v<this._spotLights.length;++v)if(this._spotLights[v]===g)return g.detachFromScene(),void this._spotLights.splice(v,1)},g.removeSphereLights=function(){for(var g=0;g<this._sphereLights.length;++g)this._sphereLights[g].detachFromScene();this._sphereLights.length=0},g.removeSpotLights=function(){for(var g=0;g<this._spotLights.length;++g)this._spotLights[g].detachFromScene();this._spotLights.length=0},g.addPointLight=function(g){g.attachToScene(this),this._pointLights.push(g)},g.removePointLight=function(g){for(var v=0;v<this._pointLights.length;++v)if(this._pointLights[v]===g)return g.detachFromScene(),void this._pointLights.splice(v,1)},g.removePointLights=function(){for(var g=0;g<this._pointLights.length;++g)this._pointLights[g].detachFromScene();this._pointLights.length=0},g.addRangedDirLight=function(g){g.attachToScene(this),this._rangedDirLights.push(g)},g.removeRangedDirLight=function(g){for(var v=0;v<this._rangedDirLights.length;++v)if(this._rangedDirLights[v]===g)return g.detachFromScene(),void this._rangedDirLights.splice(v,1)},g.removeRangedDirLights=function(){for(var g=0;g<this._rangedDirLights.length;++g)this._rangedDirLights[g].detachFromScene();this._rangedDirLights.length=0},g.addModel=function(g){g.attachToScene(this),this._models.push(g)},g.removeModel=function(g){for(var v=0;v<this._models.length;++v)if(this._models[v]===g)return this._lodStateCache.removeModel(g),g.detachFromScene(),void this._models.splice(v,1)},g.removeModels=function(){for(var g,v=f(this._models);!(g=v()).done;){var S=g.value;this._lodStateCache.removeModel(S),S.detachFromScene(),S.destroy()}this._models.length=0},g.addBatch=function(g){this._batches.push(g)},g.removeBatch=function(g){for(var v=0;v<this._batches.length;++v)if(this._batches[v]===g)return void this._batches.splice(v,1)},g.removeBatches=function(){this._batches.length=0},g.addLODGroup=function(g){this._lodGroups.push(g),g.attachToScene(this),this._lodStateCache.addLodGroup(g)},g.removeLODGroup=function(g){var v=this._lodGroups.indexOf(g);v>=0&&(this._lodGroups.splice(v,1),g.detachFromScene(),this._lodStateCache.removeLodGroup(g))},g.removeLODGroups=function(){for(var g,v=f(this._lodGroups);!(g=v()).done;){var S=g.value;this._lodStateCache.removeLodGroup(S)}this._lodGroups.length=0},g.onGlobalPipelineStateChanged=function(){for(var g,v=f(this._models);!(g=v()).done;)g.value.onGlobalPipelineStateChanged()},g.generateModelId=function(){return this._modelId++},n(t1,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"pointLights",get:function(){return this._pointLights}},{key:"rangedDirLights",get:function(){return this._rangedDirLights}},{key:"models",get:function(){return this._models}},{key:"batches",get:function(){return this._batches}},{key:"lodGroups",get:function(){return this._lodGroups}}]),t1}(),wM=function(){this.usedLevel=-1,this.lastUsedLevel=-1,this.transformDirty=!0},wI=function(){function t1(g){this._renderScene=null,this._modelsInLODGroup=new Map,this._lodStateInCamera=new Map,this._newAddedLodGroupVec=new Array,this._levelModels=new Map,this._renderScene=g}var g=t1.prototype;return g.addCamera=function(g){for(var v,S=f(this._renderScene.lodGroups);!(v=S()).done;){var O=v.value.node.layer;if((g.visibility&O)===O){this._lodStateInCamera.has(g)||this._lodStateInCamera.set(g,new Map);break}}},g.removeCamera=function(g){this._lodStateInCamera.has(g)&&this._lodStateInCamera.delete(g)},g.addLodGroup=function(g){this._newAddedLodGroupVec.push(g);for(var v,S=f(this._renderScene.cameras);!(v=S()).done;){var O=v.value;if(!this._lodStateInCamera.has(O)){var X=g.node.layer;(O.visibility&X)===X&&this._lodStateInCamera.set(O,new Map)}}},g.removeLodGroup=function(g){for(var v=0;v<g.lodCount;v++)for(var S,O=f(g.lodDataArray[v].models);!(S=O()).done;){var X=S.value;this._modelsInLODGroup.delete(X)}for(var Y,te=f(this._lodStateInCamera);!(Y=te()).done;)Y.value[1].delete(g);this._levelModels.delete(g)},g.removeModel=function(g){this._modelsInLODGroup.has(g)&&this._modelsInLODGroup.delete(g)},g.updateLodState=function(){for(var g,v=this,S=f(this._newAddedLodGroupVec);!(g=S()).done;){var O=g.value,X=this._levelModels.get(O);X||(X=new Map,this._levelModels.set(O,X));for(var Y=0;Y<O.lodCount;Y++){var te=X.get(Y);te||(te=new Array);for(var ti,tr=f(O.lodDataArray[Y].models);!(ti=tr()).done;){var ta=ti.value,th=this._modelsInLODGroup.get(ta);th||(th=new Map),this._modelsInLODGroup.set(ta,th),te.push(ta)}X.set(Y,te)}}this._newAddedLodGroupVec.length=0;for(var tu,_=function(){var g=tu.value;if(g.enabled){var S=g.getLockedLODLevels();if(S.length>0){if(g.node.hasChangedFlags>0)for(var O,X=f(v._lodStateInCamera);!(O=X()).done;){var Y=O.value,te=Y[1].get(g);te||(te=new wM,Y[1].set(g,te)),te.transformDirty=!0}if(g.isLockLevelChanged()){g.resetLockChangeFlag();var ti=v._levelModels.get(g);if(ti){ti.forEach(function(g){g.forEach(function(g){var S=v._modelsInLODGroup.get(g);S&&S.clear()})});for(var tr,ta=f(S);!(tr=ta()).done;){var th=tr.value,tl=ti.get(th);tl&&tl.forEach(function(g){var S=v._modelsInLODGroup.get(g);if(S&&g.node&&g.node.active)for(var O,X=f(v._lodStateInCamera);!(O=X()).done;){var Y=O.value;S.set(Y[0],!0)}})}}}return 0}for(var tc,t_=!1,tf=f(v._lodStateInCamera);!(tc=tf()).done;){var tp=tc.value,tm=tp[1].get(g);tm||(tm=new wM,tp[1].set(g,tm));var tg=tp[0].node.hasChangedFlags,tv=g.node.hasChangedFlags;if(tg>0||tv>0||tm.transformDirty){tm.transformDirty&&(tm.transformDirty=!1);var ty=g.getVisibleLODLevel(tp[0]);ty!==tm.usedLevel&&(tm.lastUsedLevel=tm.usedLevel,tm.usedLevel=ty,t_=!0)}}var tS=v._levelModels.get(g);if(!tS)return 0;g.isLockLevelChanged()?(g.resetLockChangeFlag(),tS.forEach(function(g){g.forEach(function(g){var S=v._modelsInLODGroup.get(g);S&&S.clear()})}),t_=!0):t_&&v._lodStateInCamera.forEach(function(S){var O=S.get(g);if(O&&O.usedLevel!==O.lastUsedLevel){var X=tS.get(O.lastUsedLevel);X&&X.forEach(function(g){var S=v._modelsInLODGroup.get(g);S&&S.clear()})}}),t_&&v._lodStateInCamera.forEach(function(S,O){var X=S.get(g);if(X){var Y=X.usedLevel,te=tS.get(Y);te&&te.forEach(function(g){var S=v._modelsInLODGroup.get(g);S&&g.node&&g.node.active&&S.set(O,!0)})}})}},tl=f(this._renderScene.lodGroups);!(tu=tl()).done;)_()},g.isLodModelCulled=function(g,v){var S=this._modelsInLODGroup.get(v);return!!S&&!S.has(g)},g.clearCache=function(){this._levelModels.clear(),this._modelsInLODGroup.clear(),this._lodStateInCamera.clear(),this._newAddedLodGroupVec.length=0},g.isLodGroupVisibleByCamera=function(g,v){var S=g.node.layer;return(v.visibility&S)===S},t1}(),wP=((wn={})[tZ.PORTRAIT]=og.IDENTITY,wn[tZ.LANDSCAPE_RIGHT]=og.ROTATE_90,wn[tZ.PORTRAIT_UPSIDE_DOWN]=og.ROTATE_180,wn[tZ.LANDSCAPE_LEFT]=og.ROTATE_270,wn),wD=function(){function t1(){this._title="",this._width=1,this._height=1,this._swapchain=null,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null,this._device=null}t1.registerCreateFunc=function(g){g._createWindowFun=function(){return new t1}};var g=t1.prototype;return g.initialize=function(g,v){if(void 0!==v.title&&(this._title=v.title),void 0!==v.swapchain&&(this._swapchain=v.swapchain),this._width=v.width,this._height=v.height,this._device=g,this._renderPass=g.createRenderPass(v.renderPassInfo),v.swapchain)this._swapchain=v.swapchain,this._colorTextures.push(v.swapchain.colorTexture),this._depthStencilTexture=v.swapchain.depthStencilTexture;else{for(var S=0;S<v.renderPassInfo.colorAttachments.length;S++){var O=new hB(ow.TEX2D,oI.COLOR_ATTACHMENT|oI.SAMPLED|oI.TRANSFER_SRC,v.renderPassInfo.colorAttachments[S].format,this._width,this._height);v.externalFlag&&(v.externalFlag&oB.EXTERNAL_NORMAL||v.externalFlag&oB.EXTERNAL_OES)&&(O.flags|=v.externalFlag,O.externalRes=v.externalResLow?v.externalResLow:0),this._colorTextures.push(g.createTexture(O))}v.renderPassInfo.depthStencilAttachment.format!==oA.UNKNOWN&&(this._depthStencilTexture=g.createTexture(new hB(ow.TEX2D,oI.DEPTH_STENCIL_ATTACHMENT|oI.SAMPLED,v.renderPassInfo.depthStencilAttachment.format,this._width,this._height)),this._hasOffScreenAttachments=!0)}return this._framebuffer=g.createFramebuffer(new h2(this._renderPass,this._colorTextures,this._depthStencilTexture)),!0},g.destroy=function(){this.clearCameras(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var g=0;g<this._colorTextures.length;g++){var v=this._colorTextures[g];v&&v.destroy()}this._colorTextures.length=0,this._device=null},g.resize=function(g,v){if(this._swapchain)this._swapchain.resize(g,v,wP[a$.orientation]),this._width=this._swapchain.width,this._height=this._swapchain.height;else{for(var S=0;S<this._colorTextures.length;S++)this._colorTextures[S].resize(g,v);this._depthStencilTexture&&this._depthStencilTexture.resize(g,v),this._width=g,this._height=v}this.framebuffer&&(this.framebuffer.destroy(),this._framebuffer=this._device.createFramebuffer(new h2(this._renderPass,this._colorTextures,this._depthStencilTexture)));for(var O,X=f(this._cameras);!(O=X()).done;)O.value.resize(g,v)},g.extractRenderCameras=function(g){for(var v=0;v<this._cameras.length;v++){var S=this._cameras[v];S.enabled&&(S.update(),g.push(S))}},g.attachCamera=function(g){for(var v=0;v<this._cameras.length;v++)if(this._cameras[v]===g)return;this._cameras.push(g),this.sortCameras()},g.detachCamera=function(g){for(var v=0;v<this._cameras.length;++v)if(this._cameras[v]===g)return void this._cameras.splice(v,1)},g.clearCameras=function(){this._cameras.length=0},g.sortCameras=function(){this._cameras.sort(function(g,v){return g.priority-v.priority})},n(t1,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"swapchain",get:function(){return this._swapchain}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"cameras",get:function(){return this._cameras}}]),t1}(),wO=g("aj",function(){function t1(g){var v=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._usesCustomPipeline=!0,this._pipeline=null,this._pipelineEvent=null,this._classicPipeline=null,this._customPipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._debugView=new AV,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._useDeferredPipeline=!1,this._fixedFPSFrameTime=0,this._cumulativeTime=0,this._frameTime=0,this._cameraList=[],this._device=g,this._dataPoolMgr=X.internal.DataPoolManager&&new X.internal.DataPoolManager(g),ww.registerCreateFunc(this),wD.registerCreateFunc(this),this._cameraPool=new ad(function(){return new pE(v._device)},4,function(g){return g.destroy()})}var g=t1.prototype;return g.initialize=function(){var g,v=uZ.swapchain,S=new hq;S.format=v.colorTexture.format;var O=new hY;O.format=v.depthStencilTexture.format,O.depthStoreOp=oz.DISCARD,O.stencilStoreOp=oz.DISCARD;var X=new hZ([S],O);this._mainWindow=this.createWindow({title:"rootMainWindow",width:v.width,height:v.height,renderPassInfo:X,swapchain:v}),this._curWindow=this._mainWindow;var Y=tQ.querySettings(tK.Category.ANIMATION,"customJointTextureLayouts")||[];null===(g=this._dataPoolMgr)||void 0===g||g.jointTexturePool.registerCustomTextureLayouts(Y),this._resizeMaxJointForDS()},g.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null,this._pipelineEvent=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),X.rendering&&X.rendering.destroy()},g.resize=function(g,v){for(var S,O=f(this._windows);!(S=O()).done;){var X=S.value;X.swapchain&&X.resize(g,v)}},g.setRenderPipeline=function(g){var v=X.internal,S=X.director,O=X.rendering;_instanceof(g,bY)&&(this._useDeferredPipeline=!0);var Y=!1;if(g||(g=VP(),Y=!0),this._useDeferredPipeline&&this.device.hasFeature(oS.COMPUTE_SHADER)||(g.clusterEnabled=!1),g.bloomEnabled=!1,""!==t$.CUSTOM_PIPELINE_NAME&&O&&this.usesCustomPipeline?(this._customPipeline=O.createCustomPipeline(),Y=!0,this._pipeline=this._customPipeline,this._pipelineEvent=g,N("Using custom pipeline")):(this._classicPipeline=g,this._pipeline=this._classicPipeline,this._pipelineEvent=this._classicPipeline,this._usesCustomPipeline=!1),(tQ.querySettings(tK.Category.RENDERING,"renderMode")!==uC.HEADLESS||this._classicPipeline)&&!this._pipeline.activate(this._mainWindow.swapchain))return Y&&this._pipeline.destroy(),this._classicPipeline=null,this._customPipeline=null,this._pipeline=null,this._pipelineEvent=null,!1;var te=S.getScene();return te&&te.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&v.Batcher2D&&(this._batcher=new v.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},g.onGlobalPipelineStateChanged=function(){for(var g=0;g<this._scenes.length;g++)this._scenes[g].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.skybox.enabled&&this._pipeline.pipelineSceneData.skybox.model.onGlobalPipelineStateChanged(),this._pipeline.onGlobalPipelineStateChanged()},g.activeWindow=function(g){this._curWindow=g},g.resetCumulativeTime=function(){this._cumulativeTime=0},g.frameMove=function(g){var v;this._frameTime=g,++this._frameCount,this._cumulativeTime+=g,this._fpsTime+=g,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0),null!==(v=globalThis.__globalXR)&&void 0!==v&&v.isWebXR?this._doWebXRFrameMove():(this._frameMoveBegin(),this._frameMoveProcess(),this._frameMoveEnd())},g.createWindow=function(g){var v=this._createWindowFun(this);return v.initialize(this.device,g),this._windows.push(v),v},g.destroyWindow=function(g){for(var v=0;v<this._windows.length;++v)if(this._windows[v]===g)return g.destroy(),void this._windows.splice(v,1)},g.destroyWindows=function(){for(var g,v=f(this._windows);!(g=v()).done;)g.value.destroy();this._windows.length=0},g.createScene=function(g){var v=this._createSceneFun(this);return v.initialize(g),this._scenes.push(v),v},g.destroyScene=function(g){for(var v=0;v<this._scenes.length;++v)if(this._scenes[v]===g)return g.destroy(),void this._scenes.splice(v,1)},g.destroyScenes=function(){for(var g,v=f(this._scenes);!(g=v()).done;)g.value.destroy();this._scenes.length=0},g.createModel=function(g){var v=this._modelPools.get(g);v||(this._modelPools.set(g,new ad(function(){return new g},10,function(g){return g.destroy()})),v=this._modelPools.get(g));var S=v.alloc();return S.initialize(),S},g.destroyModel=function(g){var v=this._modelPools.get(g.constructor);v?(v.free(g),g.scene&&g.scene.removeModel(g)):q(1300,g.constructor.name),g.destroy()},g.createCamera=function(){return this._cameraPool.alloc()},g.createLight=function(g){var v=this._lightPools.get(g);v||(this._lightPools.set(g,new ad(function(){return new g},4,function(g){return g.destroy()})),v=this._lightPools.get(g));var S=v.alloc();return S.initialize(),S},g.destroyLight=function(g){if(g.scene)switch(g.type){case pJ.DIRECTIONAL:g.scene.removeDirectionalLight(g);break;case pJ.SPHERE:g.scene.removeSphereLight(g);break;case pJ.SPOT:g.scene.removeSpotLight(g);break;case pJ.POINT:g.scene.removePointLight(g);break;case pJ.RANGED_DIRECTIONAL:g.scene.removeRangedDirLight(g)}g.destroy()},g.recycleLight=function(g){var v=this._lightPools.get(g.constructor);if(v&&(v.free(g),g.scene))switch(g.type){case pJ.DIRECTIONAL:g.scene.removeDirectionalLight(g);break;case pJ.SPHERE:g.scene.removeSphereLight(g);break;case pJ.SPOT:g.scene.removeSpotLight(g);break;case pJ.POINT:g.scene.removePointLight(g);break;case pJ.RANGED_DIRECTIONAL:g.scene.removeRangedDirLight(g)}},g._doWebXRFrameMove=function(){var g=globalThis.__globalXR;if(g){var v=this._windows,S=this._cameraList,O=g.webXRMatProjs?g.webXRMatProjs.length:1;g.webXRWindowMap||(g.webXRWindowMap=new Map);for(var X=[],Y=g.webxrHmdPoseInfos,te=0;te<O;te++){for(var ti,tr=f(v);!(ti=tr()).done;){var ta=ti.value;X=X.concat(ta.cameras),ta.swapchain&&g.webXRWindowMap.set(ta,te)}if(Y){for(var th=[0,0,0],tu=0;tu<Y.length;tu++){var tl=Y[tu];if(tl.code===bW.VIEW_LEFT&&te===bH.LEFT||tl.code===bW.VIEW_RIGHT&&te===bH.RIGHT){th[0]=tl.position.x,th[1]=tl.position.y,th[2]=tl.position.z;break}}for(var tc,t_=f(X);!(tc=t_()).done;){var tf=tc.value;tf.trackingType!==pl.NO_TRACKING&&tf.node&&(tf.trackingType===pl.ROTATION&&(th=[0,0,0]),tf.node.setPosition(th[0],th[1],th[2]))}}X.length=0,this._frameMoveBegin(),this._frameMoveProcess();for(var tp=S.length-1;tp>=0;tp--){var tm=S[tp];(te===bH.LEFT&&tm.cameraType===pu.RIGHT_EYE||te===bH.RIGHT&&tm.cameraType===pu.LEFT_EYE)&&S.splice(tp,1)}this._frameMoveEnd()}}},g._frameMoveBegin=function(){for(var g=0;g<this._scenes.length;++g)this._scenes[g].removeBatches();this._cameraList.length=0},g._frameMoveProcess=function(){for(var g=X.director,v=this._windows,S=this._cameraList,O=0;O<v.length;O++)v[O].extractRenderCameras(S);if(this._pipeline&&S.length>0){this._device.acquire([uZ.swapchain]);var Y=this._scenes,te=g.getTotalFrames();this._batcher&&(this._batcher.update(),this._batcher.uploadBuffers());for(var ti=0;ti<Y.length;ti++)Y[ti].update(te)}},g._frameMoveEnd=function(){var g=X.director,v=X.Director,S=this._cameraList;if(this._pipeline&&S.length>0){g.emit(v.EVENT_BEFORE_COMMIT),S.sort(function(g,v){return g.priority-v.priority});for(var O=0;O<S.length;++O){var Y;null===(Y=S[O].geometryRenderer)||void 0===Y||Y.update()}g.emit(v.EVENT_BEFORE_RENDER),this._pipeline.render(S),g.emit(v.EVENT_AFTER_RENDER),this._device.present()}this._batcher&&this._batcher.reset()},g._resizeMaxJointForDS=function(){var g=Math.max((vm.COUNT+ym.COUNT+Sm.COUNT+Mm.COUNT+Lm.COUNT)/4,100),v=Math.floor((uZ.gfxDevice.capabilities.maxVertexUniformVectors-g)/3);Wm(v=v<256?v:256)},n(t1,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(g){this._curWindow=g}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(g){this._tempWindow=g}},{key:"windows",get:function(){return this._windows}},{key:"usesCustomPipeline",get:function(){return this._usesCustomPipeline}},{key:"pipeline",get:function(){return this._pipeline}},{key:"customPipeline",get:function(){return this._customPipeline}},{key:"pipelineEvent",get:function(){return this._pipelineEvent}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"debugView",get:function(){return this._debugView}},{key:"cumulativeTime",get:function(){return this._cumulativeTime}},{key:"frameTime",get:function(){return this._frameTime}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(g){g>0?(this._fixedFPS=g,this._fixedFPSFrameTime=1e3/g):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}},{key:"cameraList",get:function(){return this._cameraList}}]),t1}());X.Root=wO,ri.Attr.setClassAttr(cd,"target","type","Object"),ri.Attr.setClassAttr(cd,"target","ctor",mJ);var wL,wF=new Array(16),wk=null,wG=new e8,wV=[md.TOUCH_START,md.TOUCH_MOVE,md.TOUCH_END,md.TOUCH_CANCEL],wU=[md.MOUSE_DOWN,md.MOUSE_ENTER,md.MOUSE_MOVE,md.MOUSE_LEAVE,md.MOUSE_UP,md.MOUSE_WHEEL];!function(g){g[g.ADD_POINTER_EVENT_PROCESSOR=0]="ADD_POINTER_EVENT_PROCESSOR",g[g.REMOVE_POINTER_EVENT_PROCESSOR=1]="REMOVE_POINTER_EVENT_PROCESSOR",g[g.MARK_LIST_DIRTY=2]="MARK_LIST_DIRTY"}(wL||(wL={}));var wH=function(){function t1(g){this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this._dispatchingTouch=null,this._isEnabled=!1,this._node=void 0,this._node=g}var g=t1.prototype;return g.setEnabled=function(g,v){if(void 0===v&&(v=!1),this._isEnabled!==g){this._isEnabled=g;var S=this.node.children;if(g&&this._attachMask(),t1.callbacksInvoker.emit(wL.MARK_LIST_DIRTY),v&&S.length>0)for(var O=0;O<S.length;++O)S[O].eventProcessor.setEnabled(g,!0)}},g.reattach=function(){var g,v=this;this.node.walk(function(S){g||(g=v._searchComponentsInParent(t1._maskComp)),S.eventProcessor.maskList=g})},g.destroy=function(){if(wk===this._node&&(wk=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),t1.callbacksInvoker.emit(wL.REMOVE_POINTER_EVENT_PROCESSOR,this),this._dispatchingTouch){var g=new b4([this._dispatchingTouch],!0,bQ.TOUCH_CANCEL);g.touch=this._dispatchingTouch,this.dispatchEvent(g),this._dispatchingTouch=null}},g.on=function(g,v,S,O){var X,Y;return this._tryEmittingAddEvent(g),((O=!!O)?null!==(X=this.capturingTarget)&&void 0!==X?X:this.capturingTarget=this._newCallbacksInvoker():null!==(Y=this.bubblingTarget)&&void 0!==Y?Y:this.bubblingTarget=this._newCallbacksInvoker()).on(g,v,S),v},g.once=function(g,v,S,O){var X,Y;return this._tryEmittingAddEvent(g),((O=!!O)?null!==(X=this.capturingTarget)&&void 0!==X?X:this.capturingTarget=this._newCallbacksInvoker():null!==(Y=this.bubblingTarget)&&void 0!==Y?Y:this.bubblingTarget=this._newCallbacksInvoker()).on(g,v,S,!0),v},g.off=function(g,v,S,O){var X;null===(X=(O=!!O)?this.capturingTarget:this.bubblingTarget)||void 0===X||X.off(g,v,S)},g.targetOff=function(g){var v,S;null===(v=this.capturingTarget)||void 0===v||v.removeAll(g),null===(S=this.bubblingTarget)||void 0===S||S.removeAll(g),this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||t1.callbacksInvoker.emit(wL.REMOVE_POINTER_EVENT_PROCESSOR,this)},g.emit=function(g,v,S,O,X,Y){var te;null===(te=this.bubblingTarget)||void 0===te||te.emit(g,v,S,O,X,Y)},g.dispatchEvent=function(g){var v,S=this.node,O=0;for(g.target=S,wF.length=0,this.getCapturingTargets(g.type,wF),g.eventPhase=1,O=wF.length-1;O>=0;--O)if((v=wF[O]).eventProcessor.capturingTarget&&(g.currentTarget=v,v.eventProcessor.capturingTarget.emit(g.type,g,wF),g.propagationStopped))return void(wF.length=0);if(wF.length=0,g.eventPhase=2,g.currentTarget=S,this.capturingTarget&&this.capturingTarget.emit(g.type,g),!g.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(g.type,g),!g.propagationStopped&&g.bubbles){for(this.getBubblingTargets(g.type,wF),g.eventPhase=3,O=0;O<wF.length;++O)if((v=wF[O]).eventProcessor.bubblingTarget&&(g.currentTarget=v,v.eventProcessor.bubblingTarget.emit(g.type,g),g.propagationStopped))return void(wF.length=0)}wF.length=0},g.hasEventListener=function(g,v,S){var O=!1;return this.bubblingTarget&&(O=this.bubblingTarget.hasEventListener(g,v,S)),!O&&this.capturingTarget&&(O=this.capturingTarget.hasEventListener(g,v,S)),O},g.getCapturingTargets=function(g,v){for(var S=this._node.parent;S;){var O;null!==(O=S.eventProcessor.capturingTarget)&&void 0!==O&&O.hasEventListener(g)&&v.push(S),S=S.parent}},g.getBubblingTargets=function(g,v){for(var S=this._node.parent;S;){var O;null!==(O=S.eventProcessor.bubblingTarget)&&void 0!==O&&O.hasEventListener(g)&&v.push(S),S=S.parent}},g.onUpdatingSiblingIndex=function(){t1.callbacksInvoker.emit(wL.MARK_LIST_DIRTY)},g._searchComponentsInParent=function(g){var v=this.node;if(g){for(var S=0,O=[],X=v;X&&mJ.isNode(X);X=X.parent,++S){var Y=X.getComponent(g);if(Y){var te={index:S,comp:Y};O?O.push(te):O=[te]}}return O.length>0?O:null}return null},g._attachMask=function(){this.maskList=this._searchComponentsInParent(t1._maskComp)},g._isTouchEvent=function(g){return -1!==wV.indexOf(g)},g._isMouseEvent=function(g){return -1!==wU.indexOf(g)},g._hasTouchListeners=function(){for(var g=0;g<wV.length;++g){var v=wV[g];if(this.hasEventListener(v))return!0}return!1},g._hasMouseListeners=function(){for(var g=0;g<wU.length;++g){var v=wU[g];if(this.hasEventListener(v))return!0}return!1},g._hasPointerListeners=function(){return!!this._hasTouchListeners()||this._hasMouseListeners()},g._tryEmittingAddEvent=function(g){var v=this._isTouchEvent(g),S=this._isMouseEvent(g);v?this.shouldHandleEventTouch=!0:S&&(this.shouldHandleEventMouse=!0),!v&&!S||this._hasPointerListeners()||t1.callbacksInvoker.emit(wL.ADD_POINTER_EVENT_PROCESSOR,this)},g._newCallbacksInvoker=function(){var g=this,v=new aE;return v._registerOffCallback(function(){g.shouldHandleEventTouch&&!g._hasTouchListeners()&&(g.shouldHandleEventTouch=!1),g.shouldHandleEventMouse&&!g._hasMouseListeners()&&(g.shouldHandleEventMouse=!1),g._hasPointerListeners()||t1.callbacksInvoker.emit(wL.REMOVE_POINTER_EVENT_PROCESSOR,g)}),v},g._handleEventMouse=function(g){switch(g.type){case bQ.MOUSE_DOWN:return this._handleMouseDown(g);case bQ.MOUSE_MOVE:return this._handleMouseMove(g);case bQ.MOUSE_UP:return this._handleMouseUp(g);case bQ.MOUSE_WHEEL:return this._handleMouseWheel(g);default:return!1}},g._handleMouseDown=function(g){var v=this._node;return!(!v||!v._uiProps.uiTransformComp||(g.getLocation(wG),!v._uiProps.uiTransformComp.hitTest(wG,g.windowId)||(g.type=md.MOUSE_DOWN,g.bubbles=!0,v.dispatchEvent(g),g.propagationStopped=!0,0)))},g._handleMouseMove=function(g){var v=this._node;return!(!v||!v._uiProps.uiTransformComp||(g.getLocation(wG),v._uiProps.uiTransformComp.hitTest(wG,g.windowId)?(this.previousMouseIn||(wk&&wk!==v&&(g.type=md.MOUSE_LEAVE,wk.dispatchEvent(g),wk.eventProcessor.previousMouseIn=!1),wk=v,g.type=md.MOUSE_ENTER,v.dispatchEvent(g),this.previousMouseIn=!0),g.type=md.MOUSE_MOVE,g.bubbles=!0,v.dispatchEvent(g),g.propagationStopped=!0,0):(this.previousMouseIn&&(g.type=md.MOUSE_LEAVE,v.dispatchEvent(g),this.previousMouseIn=!1,wk=null),1)))},g._handleMouseUp=function(g){var v=this._node;return!(!v||!v._uiProps.uiTransformComp||(g.getLocation(wG),!v._uiProps.uiTransformComp.hitTest(wG,g.windowId)||(g.type=md.MOUSE_UP,g.bubbles=!0,v.dispatchEvent(g),g.propagationStopped=!0,0)))},g._handleMouseWheel=function(g){var v=this._node;return!(!v||!v._uiProps.uiTransformComp||(g.getLocation(wG),!v._uiProps.uiTransformComp.hitTest(wG,g.windowId)||(g.type=md.MOUSE_WHEEL,g.bubbles=!0,v.dispatchEvent(g),g.propagationStopped=!0,0)))},g._handleEventTouch=function(g){switch(g.type){case bQ.TOUCH_START:return this._handleTouchStart(g);case bQ.TOUCH_MOVE:return this._handleTouchMove(g);case bQ.TOUCH_END:return this._handleTouchEnd(g);case bQ.TOUCH_CANCEL:return this._handleTouchCancel(g);default:return!1}},g._handleTouchStart=function(g){var v=this.node;return!(!v||!v._uiProps.uiTransformComp||(g.getLocation(wG),!v._uiProps.uiTransformComp.hitTest(wG,g.windowId)||(g.type=md.TOUCH_START,g.bubbles=!0,this._dispatchingTouch=g.touch,v.dispatchEvent(g),0)))},g._handleTouchMove=function(g){var v=this.node;return!(!v||!v._uiProps.uiTransformComp||(g.type=md.TOUCH_MOVE,g.bubbles=!0,this._dispatchingTouch=g.touch,v.dispatchEvent(g),0))},g._handleTouchEnd=function(g){var v=this.node;v&&v._uiProps.uiTransformComp&&(g.getLocation(wG),v._uiProps.uiTransformComp.hitTest(wG,g.windowId)?g.type=md.TOUCH_END:g.type=md.TOUCH_CANCEL,g.bubbles=!0,v.dispatchEvent(g),this._dispatchingTouch=null)},g._handleTouchCancel=function(g){var v=this.node;v&&v._uiProps.uiTransformComp&&(g.type=md.TOUCH_CANCEL,g.bubbles=!0,v.dispatchEvent(g),this._dispatchingTouch=null)},n(t1,[{key:"isEnabled",get:function(){return this._isEnabled}},{key:"node",get:function(){return this._node}}]),t1}();function VM(g,v){if(!v){var S=X.director.getScene();if(!S)return null;v=S}return v.getChildByPath(g)}wH._maskComp=null,wH.callbacksInvoker=new aE,X.NodeEventProcessor=wH,X.find=VM;var wz=Kt,wW=rG.Flags.IsStartCalled,wX=rG.Flags.IsOnEnableCalled;function WM(g,v){for(var S=v.constructor._executionOrder,O=v._id,X=0,Y=g.length-1,te=Y>>>1;X<=Y;te=X+Y>>>1){var ti=g[te],tr=ti.constructor._executionOrder;if(tr>S)Y=te-1;else if(tr<S)X=te+1;else{var ta=ti._id;if(ta>O)Y=te-1;else{if(!(ta<O))return te;X=te+1}}}return~X}function XM(g,v){for(var S=g.array,O=g.i+1;O<S.length;){var X=S[O];X.node._activeInHierarchy?++O:(g.removeAt(O),v&&(X._objFlags&=~v))}}rG.Flags.IsEditorOnEnableCalled;var wq=function(){function t1(g){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var v=tH;this._zero=new v([]),this._neg=new v([]),this._pos=new v([]),this._invoke=g}return n(t1,[{key:"zero",get:function(){return this._zero}},{key:"neg",get:function(){return this._neg}},{key:"pos",get:function(){return this._pos}}]),t1}();function YM(g,v){return g.constructor._executionOrder-v.constructor._executionOrder}wq.stableRemoveInactive=XM;var wY=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.add=function(g){var v=g.constructor._executionOrder;(0===v?this._zero:v<0?this._neg:this._pos).array.push(g)},v.remove=function(g){var v=g.constructor._executionOrder;(0===v?this._zero:v<0?this._neg:this._pos).fastRemove(g)},v.cancelInactive=function(g){XM(this._zero,g),XM(this._neg,g),XM(this._pos,g)},v.invoke=function(){var g=this._neg;g.array.length>0&&(g.array.sort(YM),this._invoke(g),g.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var v=this._pos;v.array.length>0&&(v.array.sort(YM),this._invoke(v),v.array.length=0)},e}(wq),wK=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.add=function(g){var v=g.constructor._executionOrder;if(0===v)this._zero.array.push(g);else{var S=v<0?this._neg.array:this._pos.array,O=WM(S,g);O<0&&S.splice(~O,0,g)}},v.remove=function(g){var v=g.constructor._executionOrder;if(0===v)this._zero.fastRemove(g);else{var S=v<0?this._neg:this._pos,O=WM(S.array,g);O>=0&&S.removeAt(O)}},v.invoke=function(g){this._neg.array.length>0&&this._invoke(this._neg,g),this._invoke(this._zero,g),this._pos.array.length>0&&this._invoke(this._pos,g)},e}(wq);function JM(g,v,S){var O="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+g+"}",Y=v?Function("it","dt",O):Function("it",O);return function(g,v,S){return function(O,Y){try{v(O,Y)}catch(v){X._throw(v);var te=O.array;for(S&&(te[O.i]._objFlags|=S),++O.i;O.i<te.length;++O.i)try{g(te[O.i],Y)}catch(g){X._throw(g),S&&(te[O.i]._objFlags|=S)}}}}(Function("c","dt",g),Y,S)}var wJ=JM("c.start();c._objFlags|="+wW,!1,wW),wZ=JM("c.update(dt)",!0),wQ=JM("c.lateUpdate(dt)",!0),tL=function(g){var v=X.director._compScheduler,S=g.array;for(g.i=0;g.i<S.length;++g.i){var O=S[g.i];O._enabled&&(O.onEnable(),O.node._activeInHierarchy&&v._onEnabled(O))}},w$=function(){function t1(){this.startInvoker=void 0,this.updateInvoker=void 0,this.lateUpdateInvoker=void 0,this._deferredComps=[],this._updating=void 0,this.unscheduleAll()}var g=t1.prototype;return g.unscheduleAll=function(){this.startInvoker=new wY(wJ),this.updateInvoker=new wK(wZ),this.lateUpdateInvoker=new wK(wQ),this._updating=!1},g._onEnabled=function(g){X.director.getScheduler().resumeTarget(g),g._objFlags|=wX,this._updating?this._deferredComps.push(g):this._scheduleImmediate(g)},g._onDisabled=function(g){X.director.getScheduler().pauseTarget(g),g._objFlags&=~wX;var v=this._deferredComps.indexOf(g);v>=0?wz(this._deferredComps,v):(!g.internalStart||g._objFlags&wW||this.startInvoker.remove(g),g.internalUpdate&&this.updateInvoker.remove(g),g.internalLateUpdate&&this.lateUpdateInvoker.remove(g))},g.enableComp=function(g,v){if(!(g._objFlags&wX)){if(g.internalOnEnable){if(v)return void v.add(g);if(g.internalOnEnable(),!g.node.activeInHierarchy)return}this._onEnabled(g)}},g.disableComp=function(g){g._objFlags&wX&&(g.internalOnDisable&&g.internalOnDisable(),this._onDisabled(g))},g.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},g.updatePhase=function(g){this.updateInvoker.invoke(g)},g.lateUpdatePhase=function(g){this.lateUpdateInvoker.invoke(g),this._updating=!1,this._startForNewComps()},g._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},g._scheduleImmediate=function(g){"function"!=typeof g.internalStart||g._objFlags&wW||this.startInvoker.add(g),"function"==typeof g.internalUpdate&&this.updateInvoker.add(g),"function"==typeof g.internalLateUpdate&&this.lateUpdateInvoker.add(g)},g._deferredSchedule=function(){for(var g=this._deferredComps,v=0,S=g.length;v<S;v++)this._scheduleImmediate(g[v]);g.length=0},t1}(),w1=rG.Flags.IsPreloadStarted,w2=rG.Flags.IsOnLoadStarted,w3=rG.Flags.IsOnLoadCalled,w5=rG.Flags.IsOnEnableCalled,w4=rG.Flags.Deactivating,w8=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.add=function(g){this._zero.array.push(g)},v.remove=function(g){this._zero.fastRemove(g)},v.cancelInactive=function(g){wq.stableRemoveInactive(this._zero,g)},v.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},e}(wq),w6=JM("c.__preload();"),w7=JM("c.onLoad();c._objFlags|="+w3,!1,w3),w9=new tU(4);function cL(g,v,S){J(3817,g.name,S),console.log("Corrupted component value:",v),v?g._removeComponent(v):qt(g.getWritableComponents(),S)}w9.get=function(){var g=this._get()||{preload:new w8(w6),onLoad:new wY(w7),onEnable:new wY(tL)};g.preload.zero.i=-1;var v=g.onLoad;return v.zero.i=-1,v.neg.i=-1,v.pos.i=-1,(v=g.onEnable).zero.i=-1,v.neg.i=-1,v.pos.i=-1,g};var In=g("dj",function(){function t1(){this._activatingStack=void 0,this.reset()}var g=t1.prototype;return g.reset=function(){this._activatingStack=[]},g.activateNode=function(g,v){if(v){var S=w9.get();S&&(this._activatingStack.push(S),this._activateNodeRecursively(g,S.preload,S.onLoad,S.onEnable),S.preload.invoke(),S.onLoad.invoke(),S.onEnable.invoke(),this._activatingStack.pop(),w9.put(S))}else{this._deactivateNodeRecursively(g);for(var O,X=f(this._activatingStack);!(O=X()).done;){var Y=O.value;Y.preload.cancelInactive(w1),Y.onLoad.cancelInactive(w2),Y.onEnable.cancelInactive(w5)}}g.emit(md.ACTIVE_IN_HIERARCHY_CHANGED,g)},g.activateComp=function(g,v,S,O){if(Ma(g,!0)&&(g._objFlags&w1||(g._objFlags|=w1,g.internalPreload&&(v?v.add(g):g.internalPreload())),g._objFlags&w2||(g._objFlags|=w2,g.internalOnLoad?S?S.add(g):(g.internalOnLoad(),g._objFlags|=w3):g._objFlags|=w3),g._enabled)){if(!g.node.activeInHierarchy)return;X.director._compScheduler.enableComp(g,O)}},g.destroyComp=function(g){X.director._compScheduler.disableComp(g),g.internalOnDestroy&&g._objFlags&w3&&g.internalOnDestroy()},g._activateNodeRecursively=function(g,v,S,O){if(g._objFlags&w4)J(3816,g.name);else{g._setActiveInHierarchy(!0);for(var Y=g.components.length,te=0;te<Y;++te){var ti=g.components[te];_instanceof(ti,X.Component)?this.activateComp(ti,v,S,O):(cL(g,ti,te),--te,--Y)}for(var tr=0,ta=g.children.length;tr<ta;++tr){var th=g.children[tr];th.active&&this._activateNodeRecursively(th,v,S,O)}g._onPostActivated(!0)}},g._deactivateNodeRecursively=function(g){g._objFlags|=w4,g._setActiveInHierarchy(!1);for(var v=g.components.length,S=0;S<v;++S){var O=g.components[S];if(O._enabled&&(X.director._compScheduler.disableComp(O),g.activeInHierarchy))return void(g._objFlags&=~w4)}for(var Y=0,te=g.children.length;Y<te;++Y){var ti=g.children[Y];if(ti.activeInHierarchy&&(this._deactivateNodeRecursively(ti),g.activeInHierarchy))return void(g._objFlags&=~w4)}g._onPostActivated(!1),g._objFlags&=~w4},t1}()),Ir=rG.Flags.Destroyed,Ia=rG.Flags.PersistentMask,Io=ri.Attr.DELIMETER+"default",Iu=ri.IDENTIFIER_RE,Il="var ",Ic="o",If={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},Id=ri.escapeForJS,Ip=function(){function t1(g,v){this.varName=void 0,this.expression=void 0,this.varName=g,this.expression=v}return t1.prototype.toString=function(){return Il+this.varName+"="+this.expression+";"},t1}();function TL(g,v){return _instanceof(v,Ip)?new Ip(v.varName,g+v.expression):g+v}function EL(g,v,S){Array.isArray(S)?(S[0]=TL(v,S[0]),g.push(S)):g.push(TL(v,S)+";")}var Im=function(){function t1(g){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=g}var g=t1.prototype;return g.append=function(g,v){this._exps.push([g,v])},g.writeCode=function(g){var v;if(this._exps.length>1)g.push("t="+this._targetExp+";"),v="t";else{if(1!==this._exps.length)return;v=this._targetExp}for(var S=0;S<this._exps.length;S++){var O=this._exps[S];EL(g,v+bL(O[0])+"=",O[1])}},t1}();function bL(g){return Iu.test(g)?"."+g:"["+Id(g)+"]"}Im.pool=void 0,Im.pool=new tU(function(g){g._exps.length=0,g._targetExp=null},1),Im.pool.get=function(g){var v=this._get()||new Im;return v._targetExp=g,v};var Ig,Iv,IS,IA,IT,IE,IC=function(){function t1(g,v){var S;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=v,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=gt(),wt(this.funcModuleCache,If),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(g.constructor,!0)+"();","}"),g._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(g),this.enumerateObject(this.codeArray,g),this.globalVariables.length>0&&(S=Il+this.globalVariables.join(",")+";");var O=xl(["return (function(R){",S||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",O)(this.objs,this.funcs);for(var X=0,Y=this.objsToClear_iN$t.length;X<Y;++X)this.objsToClear_iN$t[X]._iN$t=null;this.objsToClear_iN$t.length=0}var g=t1.prototype;return g.getFuncModule=function(g,v){var S=vt(g);if(S){var O=this.funcModuleCache[S];if(O)return O;if(void 0===O){var X=-1!==S.indexOf(".");if(X)try{if(X=g===Function("return "+S)())return this.funcModuleCache[S]=S,S}catch(g){}}}var Y=this.funcs.indexOf(g);Y<0&&(Y=this.funcs.length,this.funcs.push(g));var te="F["+Y+"]";return v&&(te="("+te+")"),this.funcModuleCache[S]=te,te},g.getObjRef=function(g){var v=this.objs.indexOf(g);return v<0&&(v=this.objs.length,this.objs.push(g)),"O["+v+"]"},g.setValueType=function(g,v,S,O){var X=Im.pool.get(O),Y=v.constructor.__props__;Y||(Y=Object.keys(v));for(var te=0;te<Y.length;te++){var ti=Y[te],tr=S[ti];if(v[ti]!==tr){var ta=this.enumerateField(S,ti,tr);X.append(ti,ta)}}X.writeCode(g),Im.pool.put(X)},g.enumerateCCClass=function(g,v,S){for(var O=S.__values__,Y=ri.Attr.getClassAttrs(S),te=0;te<O.length;te++){var ti=O[te],tr=v[ti],ta=Y[ti+Io];if(!OL(ta,tr)){if("object"==(void 0===tr?"undefined":_type_of(tr))&&_instanceof(tr,X.ValueType)&&(ta=ri.getDefault(ta))&&ta.constructor===tr.constructor){var th=Ic+bL(ti);this.setValueType(g,ta,tr,th)}else this.setObjProp(g,v,ti,tr)}}},g.instantiateArray=function(g){if(0===g.length)return"[]";var v="a"+ ++this.localVariableId,S=[new Ip(v,"new Array("+g.length+")")];g._iN$t={globalVar:"",source:S},this.objsToClear_iN$t.push(g);for(var O=0;O<g.length;++O)EL(S,v+"["+O+"]=",this.enumerateField(g,O,g[O]));return S},g.instantiateTypedArray=function(g){var v=g.constructor.name;if(0===g.length)return"new "+v;var S="a"+ ++this.localVariableId,O=[new Ip(S,"new "+v+"("+g.length+")")];g._iN$t={globalVar:"",source:O},this.objsToClear_iN$t.push(g);for(var X=0;X<g.length;++X)0!==g[X]&&EL(O,S+"["+X+"]=",g[X]);return O},g.enumerateField=function(g,v,S){if("object"==(void 0===S?"undefined":_type_of(S))&&S){var O=S._iN$t;if(O){var X=O.globalVar;if(!X){X=O.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(X);var Y=O.source[0];O.source[0]=TL(X+"=",Y)}return X}return ArrayBuffer.isView(S)?this.instantiateTypedArray(S):Array.isArray(S)?this.instantiateArray(S):this.instantiateObj(S)}return"function"==typeof S?this.getFuncModule(S):"string"==typeof S?Id(S):("_objFlags"===v&&Oa(g)&&(S&=Ia),S)},g.setObjProp=function(g,v,S,O){EL(g,Ic+bL(S)+"=",this.enumerateField(v,S,O))},g.enumerateObject=function(g,v){var S=v.constructor;if(si(S))this.enumerateCCClass(g,v,S);else for(var O in v)if(v.hasOwnProperty(O)&&(95!==O.charCodeAt(0)||95!==O.charCodeAt(1)||"__type__"===O)){var X=v[O];"object"==(void 0===X?"undefined":_type_of(X))&&X&&X===v._iN$t||this.setObjProp(g,v,O,X)}},g.instantiateObj=function(g){if(_instanceof(g,X.ValueType))return ri.getNewValueTypeCode(g);if(_instanceof(g,X.Asset))return this.getObjRef(g);if(g._objFlags&Ir)return null;var v,S=g.constructor;if(si(S)){if(this.parent){if(_instanceof(this.parent,X.Component)){if(_instanceof(g,X.Node)||_instanceof(g,X.Component))return this.getObjRef(g)}else if(_instanceof(this.parent,X.Node)){if(_instanceof(g,X.Node)){if(!g.isChildOf(this.parent))return this.getObjRef(g)}else if(_instanceof(g,X.Component)){var O;if(null===(O=g.node)||void 0===O||!O.isChildOf(this.parent))return this.getObjRef(g)}}}v=new Ip(Ic,"new "+this.getFuncModule(S,!0)+"()")}else if(S===Object)v=new Ip(Ic,"{}");else{if(S)return this.getObjRef(g);v=new Ip(Ic,"Object.create(null)")}var Y=[v];return g._iN$t={globalVar:"",source:Y},this.objsToClear_iN$t.push(g),this.enumerateObject(Y,g),["(function(){",Y,"return o;})();"]},t1}();function OL(g,v){if("function"==typeof g)try{g=g()}catch(g){return!1}if(g===v)return!0;if(g&&v&&"object"==(void 0===g?"undefined":_type_of(g))&&"object"==(void 0===v?"undefined":_type_of(v))&&g.constructor===v.constructor){if(_instanceof(g,X.ValueType)){if(g.equals(v))return!0}else{if(Array.isArray(g))return 0===g.length&&0===v.length;if(g.constructor===Object)return ct(g)&&ct(v)}}return!1}var Ix=re({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),Ib=g("dk",nJ("cc.Prefab")(((IE=function(g){function e(){var v;return(v=g.call(this)||this).data=IS&&IS(),v.optimizationPolicy=IA&&IA(),v.persistent=IT&&IT(),v._createFunction=void 0,v._instantiatedTimes=void 0,v._createFunction=null,v._instantiatedTimes=0,v}s(e,g);var v=e.prototype;return v.createNode=function(g){var v=X.instantiate(this);v.name=this.name,g(null,v)},v.compileCreateFunction=function(){var g,v;this._createFunction=(v=_instanceof(g=this.data,X.Node)&&g,new IC(g,v).result)},v._doInstantiate=function(g){return this.data._prefab||q(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(g)},v._instantiate=function(){var g;return this.optimizationPolicy!==Ix.SINGLE_INSTANCE&&(this.optimizationPolicy===Ix.MULTI_INSTANCE||this._instantiatedTimes+1>=e.OptimizationPolicyThreshold)?(g=this._doInstantiate(),this.data._instantiate(g)):g=this.data._instantiate(),++this._instantiatedTimes,g},v.initDefault=function(v){g.prototype.initDefault.call(this,v),this.data=new mJ,this.data.name="(Missing Node)";var S=new X._PrefabInfo;S.asset=this,S.root=this.data,this.data._prefab=S},v.validate=function(){return!!this.data},v.onLoaded=function(){var g=this.data;tR(g),Zx(g)},e}(lx)).OptimizationPolicy=Ix,IE.OptimizationPolicyThreshold=3,IS=ws((Iv=IE).prototype,"data",[n2],function(){return null}),IA=ws(Iv.prototype,"optimizationPolicy",[n2],function(){return Ix.AUTO}),IT=ws(Iv.prototype,"persistent",[n2],function(){return!1}),Ig=Iv))||Ig);tw(Ib,"_utils",AF),X.Prefab=Ib,yt(X,"cc._Prefab","Prefab");var IR=new(function(){function t1(){this._allRenderers=[],this._dirtyRenderers=[],this._dirtyVersion=0}var g=t1.prototype;return g.addRenderer=function(g){-1===g._internalId&&(g._internalId=this._allRenderers.length,this._allRenderers.push(g))},g.removeRenderer=function(g){if(-1!==g._internalId){var v=g._internalId;this._allRenderers[this._allRenderers.length-1]._internalId=v,Kt(this._allRenderers,v),g._internalId=-1,g._dirtyVersion===this._dirtyVersion&&(Qt(this._dirtyRenderers,g),g._dirtyVersion=-1)}},g.markDirtyRenderer=function(g){g._dirtyVersion!==this._dirtyVersion&&-1!==g._internalId&&(this._dirtyRenderers.push(g),g._dirtyVersion=this._dirtyVersion)},g.updateAllDirtyRenderers=function(){for(var g=this._dirtyRenderers.length,v=this._dirtyRenderers,S=0;S<g;S++)v[S].updateRenderer();this._dirtyRenderers.length=0,this._dirtyVersion++},t1}()),Iw=g("dH",function(g){function e(){var v;return(v=g.call(this)||this)._compScheduler=void 0,v._nodeActivator=void 0,v._invalid=void 0,v._paused=void 0,v._root=void 0,v._loadingScene=void 0,v._scene=void 0,v._totalFrames=void 0,v._scheduler=void 0,v._systems=void 0,v._persistRootNodes={},v._invalid=!1,v._paused=!1,v._root=null,v._loadingScene="",v._scene=null,v._totalFrames=0,v._scheduler=new ou,v._compScheduler=new w$,v._nodeActivator=new In,v._systems=[],v}s(e,g);var v=e.prototype;return v.calculateDeltaTime=function(){},v.end=function(){var g=this;this.once(e.EVENT_END_FRAME,function(){g.purgeDirector()})},v.pause=function(){this._paused||(this._paused=!0)},v.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),Ma(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),dO.releaseAll()},v.reset=function(){var g;for(var v in this.purgeDirector(),this._persistRootNodes)this.removePersistRootNode(this._persistRootNodes[v]);null===(g=this.getScene())||void 0===g||g.destroy(),this.emit(e.EVENT_RESET),this.startAnimation()},v.runSceneImmediate=function(g,v,S){var O=this;_instanceof(g,Ak)&&(g=g.scene),$(_instanceof(g,AN),1216),g._load();for(var X=Object.keys(this._persistRootNodes).map(function(g){return O._persistRootNodes[g]}),Y=0;Y<X.length;Y++){var te=X[Y];te.emit(mJ.EventType.SCENE_CHANGED_FOR_PERSISTS,g.renderScene);var ti=g.uuid===te._originalSceneId&&g.getChildByUuid(te.uuid);if(ti){var tr=ti.getSiblingIndex();te.hideFlags&=~rG.Flags.DontSave,te.hideFlags|=rG.Flags.DontSave&ti.hideFlags,ti._destroyImmediate(),g.insertChild(te,tr)}else te.hideFlags|=rG.Flags.DontSave,te.parent=g}var ta=this._scene;Ma(ta)&&ta.destroy(),f9._autoRelease(ta,g,this._persistRootNodes),this._scene=null,rG._deferredDestroy(),v&&v(),this.emit(e.EVENT_BEFORE_SCENE_LAUNCH,g),this._scene=g,g._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),S&&S(null,g),this.emit(e.EVENT_AFTER_SCENE_LAUNCH,g)},v.runScene=function(g,v,S){var O=this;_instanceof(g,Ak)&&(g=g.scene),$(Boolean(g),1205),$(_instanceof(g,AN),1216),this.once(e.EVENT_END_FRAME,function(){O.runSceneImmediate(g,v,S)})},v.loadScene=function(g,v,S){var O=this;if(this._loadingScene)return q(1208,g,this._loadingScene),!1;var X=dO.bundles.find(function(v){return!!v.getSceneInfo(g)});return X?(this.emit(e.EVENT_BEFORE_SCENE_LOADING,g),this._loadingScene=g,console.time("LoadScene "+g),X.loadScene(g,function(X,Y){console.timeEnd("LoadScene "+g),O._loadingScene="",X?(k(X),v&&v(X)):O.runSceneImmediate(Y,S,v)}),!0):(J(1209,g),!1)},v.preloadScene=function(g,v,S){var O=dO.bundles.find(function(v){return!!v.getSceneInfo(g)});if(O)O.preloadScene(g,null,v,S);else{var X='Can not preload the scene "'+g+'" because it is not in the build settings.';S&&S(new Error(X)),k("preloadScene: "+X)}},v.resume=function(){this._paused&&(this._paused=!1)},v.getScene=function(){return this._scene},v.getDeltaTime=function(){return X.game.deltaTime},v.getTotalTime=function(){return X.game.totalTime},v.getCurrentTime=function(){return X.game.frameStartTime},v.getTotalFrames=function(){return this._totalFrames},v.isPaused=function(){return this._paused},v.getScheduler=function(){return this._scheduler},v.setScheduler=function(g){this._scheduler!==g&&(this.unregisterSystem(this._scheduler),this._scheduler=g,this.registerSystem(ou.ID,g,200))},v.registerSystem=function(g,v,S){v.id=g,v.priority=S,this._systems.push(v),this._systems.sort(a8.sortByPriority)},v.unregisterSystem=function(g){Qt(this._systems,g),this._systems.sort(a8.sortByPriority)},v.getSystem=function(g){return this._systems.find(function(v){return v.id===g})},v.getAnimationManager=function(){return this.getSystem(X.AnimationManager.ID)},v.startAnimation=function(){this._invalid=!1},v.stopAnimation=function(){this._invalid=!0},v.mainLoop=function(g){var v;v=X.game._calculateDT(g),this.tick(v)},v.tick=function(g){if(!this._invalid){if(this.emit(e.EVENT_BEGIN_FRAME),RJ._frameDispatchEvents(),!this._paused){this.emit(e.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(g);for(var v=0;v<this._systems.length;++v)this._systems[v].update(g);this._compScheduler.lateUpdatePhase(g),this.emit(e.EVENT_AFTER_UPDATE),rG._deferredDestroy();for(var S=0;S<this._systems.length;++S)this._systems[S].postUpdate(g)}this.emit(e.EVENT_BEFORE_DRAW),IR.updateAllDirtyRenderers(),this._root.frameMove(g),this.emit(e.EVENT_AFTER_DRAW),mJ.resetHasChangedFlags(),mJ.clearNodeArray(),af.update(g),this.emit(e.EVENT_END_FRAME),this._totalFrames++}},v.buildRenderPipeline=function(){this._root&&(this._root.customPipeline.beginSetup(),X.rendering.getCustomPipeline(t$.CUSTOM_PIPELINE_NAME).setup(this._root.cameraList,this._root.customPipeline),this._root.customPipeline.endSetup())},v.setupRenderPipelineBuilder=function(){""!==t$.CUSTOM_PIPELINE_NAME&&X.rendering&&this._root&&this._root.usesCustomPipeline&&this.on(e.EVENT_BEFORE_RENDER,this.buildRenderPipeline,this)},v.init=function(){this._totalFrames=0,this._paused=!1,this.registerSystem(ou.ID,this._scheduler,200),this._root=new wO(uZ.gfxDevice),this._root.initialize({}),this.setupRenderPipelineBuilder();for(var g=0;g<this._systems.length;g++)this._systems[g].init();this.emit(e.EVENT_INIT)},v.addPersistRootNode=function(g){if(mJ.isNode(g)&&g.uuid){var v=g.uuid;if(!this._persistRootNodes[v]){var S=this._scene;if(Ma(S)){if(g.parent){if(!_instanceof(g.parent,AN))return void q(3801);if(g.parent!==S)return void q(3802);g._originalSceneId=S.uuid}else g.parent=S,g._originalSceneId=S.uuid}this._persistRootNodes[v]=g,g._persistNode=!0,f9._addPersistNodeRef(g)}}else q(3800)},v.removePersistRootNode=function(g){var v=g.uuid||"";g===this._persistRootNodes[v]&&(delete this._persistRootNodes[v],g._persistNode=!1,g._originalSceneId="",f9._removePersistNodeRef(g))},v.isPersistRootNode=function(g){return!!g._persistNode},n(e,[{key:"root",get:function(){return this._root}}]),e}(aC));Iw.EVENT_INIT="director_init",Iw.EVENT_RESET="director_reset",Iw.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",Iw.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",Iw.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",Iw.EVENT_BEFORE_UPDATE="director_before_update",Iw.EVENT_AFTER_UPDATE="director_after_update",Iw.EVENT_BEFORE_DRAW="director_before_draw",Iw.EVENT_AFTER_DRAW="director_after_draw",Iw.EVENT_BEFORE_COMMIT="director_before_commit",Iw.EVENT_BEFORE_RENDER="director_before_render",Iw.EVENT_AFTER_RENDER="director_after_render",Iw.EVENT_BEFORE_PHYSICS="director_before_physics",Iw.EVENT_AFTER_PHYSICS="director_after_physics",Iw.EVENT_BEGIN_FRAME="director_begin_frame",Iw.EVENT_END_FRAME="director_end_frame",Iw.instance=void 0,X.Director=Iw;var II=g("dI",Iw.instance=X.director=new Iw),IP=function(){function t1(){var g=this;this._stHandle=0,this._onTick=null,this._targetFrameRate=60,this._frameTime=0,this._startTime=0,this._isPlaying=!1,this._frameCount=0,this._callback=null,this._rAF=void 0,this._cAF=void 0,this._handleRAF=function(){var v=performance.now(),S=v-g._startTime,O=Math.floor(S/g._frameTime);O<0&&(g._startTime=v,g._frameCount=0),O<g._frameCount?g._stHandle=g._rAF.call(window,g._handleRAF):(g._frameCount=O+1,g._callback&&g._callback())},this._frameTime=1e3/this._targetFrameRate,this._rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,this._cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame}var g=t1.prototype;return g.start=function(){var g,v=this;if(!this._isPlaying){var S=void 0===this._rAF||(null===(g=globalThis.__globalXR)||void 0===g?void 0:g.isWebXR);this._startTime=performance.now(),this._stHandle=this._stTime(function t1(){S&&(v._startTime=performance.now()),v._isPlaying&&(v._stHandle=v._stTime(t1)),v._onTick&&v._onTick()}),this._isPlaying=!0,this._frameCount=0}},g.stop=function(){this._isPlaying&&(this._ctTime(this._stHandle),this._stHandle=0,this._isPlaying=!1,this._frameCount=0)},g._stTime=function(g){var v;if(void 0===this._rAF||null!==(v=globalThis.__globalXR)&&void 0!==v&&v.isWebXR){var S=performance.now(),O=Math.max(0,S-this._startTime),X=Math.max(0,this._frameTime-O);return setTimeout(g,X)}return this._callback=g,this._rAF.call(window,this._handleRAF)},g._ctTime=function(g){var v;void 0===this._cAF||null!==(v=globalThis.__globalXR)&&void 0!==v&&v.isWebXR?clearTimeout(g):g&&this._cAF.call(window,g)},n(t1,[{key:"targetFrameRate",get:function(){return this._targetFrameRate},set:function(g){this._targetFrameRate!==g&&(this._targetFrameRate=g,this._frameTime=1e3/this._targetFrameRate,this._isPlaying&&(this.stop(),this.start()))}},{key:"onTick",get:function(){return this._onTick},set:function(g){this._onTick=g}}]),t1}(),IM=new(function(){function t1(){this._data=null}return t1.prototype.init=function(g){var v=this;return void 0===g&&(g=""),X.rendering&&X.rendering.enableEffectImport&&g?new Promise(function(S,O){var X=new XMLHttpRequest;X.open("GET",g),X.responseType="arraybuffer",X.onload=function(){v._data=X.response,S()},X.onerror=function(){O(new Error("request effect settings failed!"))},X.send(null)}):Promise.resolve()},n(t1,[{key:"data",get:function(){return this._data}}]),t1}());X.effectSettings=IM;var IO=g("dJ",function(g){function i(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).frame=null,v.container=null,v.canvas=null,v.renderType=-1,v.eventTargetOn=g.prototype.on,v.eventTargetOnce=g.prototype.once,v.config={},v.onStart=null,v.frameTime=1e3/60,v._isCloning=!1,v._inited=!1,v._engineInited=!1,v._rendererInitialized=!1,v._paused=!0,v._pausedByEngine=!1,v._frameRate=60,v._pacer=null,v._initTime=0,v._startTime=0,v._deltaTime=0,v._useFixedDeltaTime=!1,v._shouldLoadLaunchScene=!0,v.onPreBaseInitDelegate=new aP,v.onPostBaseInitDelegate=new aP,v.onPreInfrastructureInitDelegate=new aP,v.onPostInfrastructureInitDelegate=new aP,v.onPreSubsystemInitDelegate=new aP,v.onPostSubsystemInitDelegate=new aP,v.onPreProjectInitDelegate=new aP,v.onPostProjectInitDelegate=new aP,v}s(i,g);var S=i.prototype;return S.setFrameRate=function(g){this.frameRate=g},S.getFrameRate=function(){return this.frameRate},S.step=function(){II.tick(this._calculateDT(!0))},S.pauseByEngine=function(){this._paused||(this._pausedByEngine=!0,this.pause())},S.resumeByEngine=function(){this._pausedByEngine&&(this.resume(),this._pausedByEngine=!1)},S.pause=function(){var g;this._paused||(this._paused=!0,null===(g=this._pacer)||void 0===g||g.stop(),this.emit(i.EVENT_PAUSE))},S.resume=function(){var g;this._paused&&(RJ._clearEvents(),this._paused=!1,null===(g=this._pacer)||void 0===g||g.start(),this.emit(i.EVENT_RESUME))},S.isPaused=function(){return this._paused},S.restart=function(){var g=this;return new Promise(function(g){II.once(Iw.EVENT_END_FRAME,function(){return g()})}).then(function(){II.reset(),X.Object._deferredDestroy(),g.pause(),g.resume(),g._shouldLoadLaunchScene=!0,bJ.instance.curTime=0,g._safeEmit(i.EVENT_RESTART)})},S.end=function(){aD.close()},S.on=function(g,v,S,O){return this.canRegisterEvent(g)&&v.call(S),this.eventTargetOn(g,v,S,O)},S.once=function(g,v,S){return this.canRegisterEvent(g)?v.call(S):this.eventTargetOnce(g,v,S)},S.canRegisterEvent=function(g){return this._engineInited&&g===i.EVENT_ENGINE_INITED||this._inited&&g===i.EVENT_GAME_INITED||this._rendererInitialized&&g===i.EVENT_RENDERER_INITED},S.init=function(g){var S=this;return this._compatibleWithOldParams(g),Promise.resolve().then(function(){return S.emit(i.EVENT_PRE_BASE_INIT),S.onPreBaseInitDelegate.dispatch()}).then(function(){H(g.debugMode||tv.NONE)}).then(function(){return a3.init()}).then(function(){S._initEvents()}).then(function(){return tQ.init(g.settingsPath,g.overrideSettings)}).then(function(){return S.emit(i.EVENT_POST_BASE_INIT),S.onPostBaseInitDelegate.dispatch()}).then(function(){return S.emit(i.EVENT_PRE_INFRASTRUCTURE_INIT),S.onPreInfrastructureInitDelegate.dispatch()}).then(function(){t$.init(),S._initXR();var g={frame:document.querySelector("#GameDiv"),container:document.querySelector("#Cocos3dGameContainer"),canvas:document.querySelector("#GameCanvas")};g&&(S.canvas=g.canvas,S.frame=g.frame,S.container=g.container),a1.init(),o_.init(),uZ.init(S.canvas,_C),"ca127c79-69d6-4afd-8183-d712d7b80e14"===tQ.querySettings(tK.Category.RENDERING,"renderPipeline")&&(t$.CUSTOM_PIPELINE_NAME||(t$.CUSTOM_PIPELINE_NAME="Forward")),""===t$.CUSTOM_PIPELINE_NAME&&(X.rendering=void 0),dO.init(),dU.init(),_a.init(),S.initPacer()}).then(function(){return S.emit(i.EVENT_POST_INFRASTRUCTURE_INIT),S.onPostInfrastructureInitDelegate.dispatch()}).then(function(){return S.emit(i.EVENT_PRE_SUBSYSTEM_INIT),S.onPreSubsystemInitDelegate.dispatch()}).then(function(){return IM.init(tQ.querySettings(tK.Category.RENDERING,"effectSettingsPath"))}).then(function(){if(X.rendering&&X.rendering.enableEffectImport){if(tQ.querySettings(tK.Category.RENDERING,"renderMode")!==uC.HEADLESS){var g=IM.data;null!==g?X.rendering.init(uZ.gfxDevice,g):J(1102)}else X.rendering.init(uZ.gfxDevice,null)}}).then(function(){var g=tQ.querySettings(tK.Category.SCRIPTING,"scriptPackages");return g?Promise.all(g.map(function(g){return v.import(g)})):Promise.resolve([])}).then(function(){return II.init(),dU.loadBuiltinAssets()}).then(function(){return S.emit(i.EVENT_POST_SUBSYSTEM_INIT),S.onPostSubsystemInitDelegate.dispatch()}).then(function(){N("Cocos Creator v"+Y),S.emit(i.EVENT_ENGINE_INITED),S._engineInited=!0}).then(function(){return S.emit(i.EVENT_PRE_PROJECT_INIT),S.onPreProjectInitDelegate.dispatch()}).then(function(){var g=tQ.querySettings(tK.Category.PLUGINS,"jsList"),v=Promise.resolve();return g&&g.forEach(function(g){v=v.then(function(){var v;return v="src/"+g,new Promise(function(g,S){var O;function r(g){g.filename===v&&(O=g.error)}window.addEventListener("error",r);var X=document.createElement("script");X.charset="utf-8",X.async=!0,X.crossOrigin="anonymous",X.addEventListener("error",function(){window.removeEventListener("error",r),S(Error("Error loading "+v))}),X.addEventListener("load",function(){window.removeEventListener("error",r),document.head.removeChild(X),O?S(O):g()}),X.src=v.replace("#","%23"),document.head.appendChild(X)})})}),v}).then(function(){return S._loadProjectBundles()}).then(function(){return S._loadCCEScripts()}).then(function(){return S._setupRenderPipeline()}).then(function(){return S._loadPreloadAssets()}).then(function(){return dU.compileBuiltinMaterial(),bJ.instance.init()}).then(function(){return S.emit(i.EVENT_POST_PROJECT_INIT),S.onPostProjectInitDelegate.dispatch()}).then(function(){S._inited=!0,S._safeEmit(i.EVENT_GAME_INITED)})},S._initXR=function(){var g;if(void 0===globalThis.__globalXR&&(globalThis.__globalXR={}),globalThis.__globalXR.webxrCompatible=null!==(g=tQ.querySettings(tK.Category.XR,"webxrCompatible"))&&void 0!==g&&g,a3.isXR){var v,S;xr.entry=xr.XrEntry.getInstance();var O=null!==(v=tQ.querySettings(tK.Category.RENDERING,"msaa"))&&void 0!==v?v:1,X=null!==(S=tQ.querySettings(tK.Category.RENDERING,"renderingScale"))&&void 0!==S?S:1;xr.entry.setMultisamplesRTT(O),xr.entry.setRenderingScale(X)}},S._compatibleWithOldParams=function(g){var v=g.overrideSettings=g.overrideSettings||{};"showFPS"in g&&(v.profiling=v.profiling||{},v.profiling.showFPS=g.showFPS),"frameRate"in g&&(v.screen=v.screen||{},v.screen.frameRate=g.frameRate),"renderMode"in g&&(v.rendering=v.rendering||{},v.rendering.renderMode=g.renderMode),"renderPipeline"in g&&(v.rendering=v.rendering||{},v.rendering.renderPipeline=g.renderPipeline),"assetOptions"in g&&(v.assets=v.assets||{},Object.assign(v.assets,g.assetOptions)),"customJointTextureLayouts"in g&&(v.animation=v.animation||{},v.animation.customJointTextureLayouts=g.customJointTextureLayouts),"physics"in g&&(v.physics=v.physics||{},Object.assign(v.physics,g.physics)),"orientation"in g&&(v.screen=v.screen||{},v.screen.orientation=g.orientation),"exactFitScreen"in g&&(v.screen=v.screen||{},v.screen.exactFitScreen=g.exactFitScreen)},S._loadPreloadAssets=function(){var g=tQ.querySettings(tK.Category.ASSETS,"preloadAssets");return g?Promise.all(g.map(function(g){return new Promise(function(v,S){dO.loadAny(g,function(g){g?S(g):v()})})})):Promise.resolve([])},S._loadCCEScripts=function(){return new Promise(function(g){g()})},S._loadProjectBundles=function(){var g=tQ.querySettings(tK.Category.ASSETS,"preloadBundles");return g?Promise.all(g.map(function(g){var v=g.bundle,S=g.version;return new Promise(function(g,O){var X={};S&&(X.version=S),dO.loadBundle(v,X,function(v){v?O(v):g()})})})):Promise.resolve([])},S.run=function(g){g&&(this.onStart=g),this._inited&&this.resume()},S._calculateDT=function(g){if(this._useFixedDeltaTime=g,g)return this._startTime=performance.now(),this.frameTime/1e3;var v=performance.now();return this._deltaTime=v>this._startTime?(v-this._startTime)/1e3:0,this._deltaTime>i.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=v,this._deltaTime},S._updateCallback=function(){var g=this;if(this._inited){if(bJ.instance.isFinished){if(this._shouldLoadLaunchScene){this._shouldLoadLaunchScene=!1;var v,S=tQ.querySettings(tK.Category.LAUNCH,"launchScene");S?II.loadScene(S,function(){var v;j(1103,S),g._initTime=performance.now(),II.startAnimation(),null===(v=g.onStart)||void 0===v||v.call(g)}):(this._initTime=performance.now(),II.startAnimation(),null===(v=this.onStart)||void 0===v||v.call(this))}else II.tick(this._calculateDT(!1))}else bJ.instance.update(this._calculateDT(!1))}},S.initPacer=function(){var g,v=null!==(g=tQ.querySettings(tK.Category.SCREEN,"frameRate"))&&void 0!==g?g:60;V("number"==typeof v),this._pacer=new IP,this._pacer.onTick=this._updateCallback.bind(this),this.frameRate=v},S._initEvents=function(){aD.on("show",this._onShow,this),aD.on("hide",this._onHide,this),aD.on("close",this._onClose,this)},S._onHide=function(){this.emit(i.EVENT_HIDE),this.pauseByEngine()},S._onShow=function(){this.emit(i.EVENT_SHOW),this.resumeByEngine()},S._onClose=function(){this.emit(i.EVENT_CLOSE),aD.exit()},S.addPersistRootNode=function(g){II.addPersistRootNode(g)},S.removePersistRootNode=function(g){II.removePersistRootNode(g)},S.isPersistRootNode=function(g){return II.isPersistRootNode(g)},S._setupRenderPipeline=function(){var g=this,v=tQ.querySettings(tK.Category.RENDERING,"renderPipeline");return v&&"ca127c79-69d6-4afd-8183-d712d7b80e14"!==v?new Promise(function(g,S){dO.loadAny(v,function(v,O){return!v&&_instanceof(O,TO)?g(O):S(v)})}).then(function(v){g._setRenderPipeline(v)}).catch(function(S){G(S),G("Failed load render pipeline: "+v+", engine failed to initialize, will fallback to default pipeline"),g._setRenderPipeline()}):this._setRenderPipeline()},S._setRenderPipeline=function(g){II.root.setRenderPipeline(g)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(i.EVENT_RENDERER_INITED)},S._safeEmit=function(g){this.emit(g)},n(i,[{key:"inited",get:function(){return this._inited}},{key:"frameRate",get:function(){return this._frameRate},set:function(g){"number"!=typeof g&&(g=parseInt(g,10),Number.isNaN(g)&&(g=60)),this._frameRate=g,this.frameTime=1e3/g,this._pacer&&(this._pacer.targetFrameRate=this._frameRate)}},{key:"deltaTime",get:function(){return this._useFixedDeltaTime?this.frameTime/1e3:this._deltaTime}},{key:"totalTime",get:function(){return performance.now()-this._initTime}},{key:"frameStartTime",get:function(){return this._startTime}}]),i}(aC));IO.EVENT_HIDE="game_on_hide",IO.EVENT_SHOW="game_on_show",IO.EVENT_LOW_MEMORY="game_on_low_memory",IO.EVENT_GAME_INITED="game_inited",IO.EVENT_ENGINE_INITED="engine_inited",IO.EVENT_RENDERER_INITED="renderer_inited",IO.EVENT_PRE_BASE_INIT="pre_base_init",IO.EVENT_POST_BASE_INIT="post_base_init",IO.EVENT_PRE_INFRASTRUCTURE_INIT="pre_infrastructure_init",IO.EVENT_POST_INFRASTRUCTURE_INIT="post_infrastructure_init",IO.EVENT_PRE_SUBSYSTEM_INIT="pre_subsystem_init",IO.EVENT_POST_SUBSYSTEM_INIT="post_subsystem_init",IO.EVENT_PRE_PROJECT_INIT="pre_project_init",IO.EVENT_POST_PROJECT_INIT="post_project_init",IO.EVENT_RESTART="game_on_restart",IO.EVENT_PAUSE="game_on_pause",IO.EVENT_RESUME="game_on_resume",IO.EVENT_CLOSE="game_on_close",IO.RENDER_TYPE_CANVAS=0,IO.RENDER_TYPE_WEBGL=1,IO.RENDER_TYPE_OPENGL=2,IO.RENDER_TYPE_HEADLESS=3,IO.DEBUG_DT_THRESHOLD=1,X.Game=IO;var IL=g("dK",X.game=new IO),IF=g("Z",function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._atlases=[],v._atlasIndex=-1,v._maxAtlasCount=5,v._textureSize=2048,v._maxFrameSize=512,v._textureBleeding=!0,v._enabled=!1,v}s(e,g);var v=e.prototype;return v.newAtlas=function(){var g=this._atlases[++this._atlasIndex];return g||(g=new _n(this._textureSize,this._textureSize),this._atlases.push(g)),g},v.beforeSceneLoad=function(){this.reset()},v.init=function(){this.enabled=!t$.CLEANUP_IMAGE_CACHE},v.insertSpriteFrame=function(g){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!g||g._original)return null;if(!g.packable)return null;var v=g.texture.getSamplerInfo();if(v.minFilter!==lw.LINEAR||v.magFilter!==lw.LINEAR||v.mipFilter!==lw.NONE)return null;var S=this._atlases[this._atlasIndex];S||(S=this.newAtlas());var O=S.insertSpriteFrame(g);return O||this._atlasIndex===this._maxAtlasCount?O:(S=this.newAtlas()).insertSpriteFrame(g)},v.reset=function(){for(var g=0,v=this._atlases.length;g<v;g++)this._atlases[g].destroy();this._atlases.length=0,this._atlasIndex=-1},v.deleteAtlasSpriteFrame=function(g){if(g._original){for(var v=this._atlases.length-1;v>=0;v--)Qt(this._atlases[v]._innerSpriteFrames,g);var S=g._original._texture;this.deleteAtlasTexture(S)}},v.deleteAtlasTexture=function(g){if(g)for(var v=this._atlases.length-1;v>=0;v--)this._atlases[v].deleteInnerTexture(g),this._atlases[v].isEmpty()&&(this._atlases[v].destroy(),this._atlases.splice(v,1),this._atlasIndex--)},v.packToDynamicAtlas=function(g,v){if(this._enabled&&v&&!v._original&&v.packable&&v.texture&&v.texture.width>0&&v.texture.height>0){var S=this.insertSpriteFrame(v);S&&v._setDynamicAtlasFrame(S)}},n(e,[{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled!==g&&(g?(this.reset(),X.director.on(X.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),X.director.off(X.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=g)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(g){this._maxAtlasCount=g}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(g){this._textureBleeding=g}},{key:"textureSize",get:function(){return this._textureSize},set:function(g){this._textureSize=g}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(g){this._maxFrameSize=g}}]),e}(a8));IF.instance=void 0;var IN,Ik=g("$",IF.instance=new IF);II.registerSystem("dynamicAtlasManager",Ik,0),X.internal.dynamicAtlasManager=Ik,function(g){g[g.positions=hi.ATTR_POSITION]="positions",g[g.normals=hi.ATTR_NORMAL]="normals",g[g.uvs=hi.ATTR_TEX_COORD]="uvs",g[g.colors=hi.ATTR_COLOR]="colors"}(IN||(IN={}));var IG=function(){function t1(){this._arrayBufferOrPaddings=[],this._length=0}var g=t1.prototype;return g.setNextAlignment=function(g){if(0!==g){var v=this._length%g;if(0!==v){var S=g-v;this._arrayBufferOrPaddings.push(S),this._length+=S}}},g.addBuffer=function(g){var v=this._length;return this._arrayBufferOrPaddings.push(g),this._length+=g.byteLength,v},g.getLength=function(){return this._length},g.getCombined=function(){var g=new Uint8Array(this._length),v=0;return this._arrayBufferOrPaddings.forEach(function(S){"number"==typeof S?v+=S:(g.set(new Uint8Array(S),v),v+=S.byteLength)}),g.buffer},t1}(),IU=function(){function t1(g,v){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=g,this._mesh.struct.morph){var S=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(S).fill(null);for(var O=0;O<S;++O){var X=this._mesh.struct.morph.subMeshMorphs[O];X&&(X.targets.length>Xm.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[O]=new Iz(this._mesh,O,this._mesh.struct.morph,v):this._subMeshRenderings[O]=new IH(this._mesh,O,this._mesh.struct.morph,v))}}}return t1.prototype.createInstance=function(){for(var g=this,v=this._mesh.struct.primitives.length,S=new Array(v),O=0;O<v;++O){var X,Y;S[O]=null!==(X=null===(Y=this._subMeshRenderings[O])||void 0===Y?void 0:Y.createInstance())&&void 0!==X?X:null}return{setWeights:function(g,v){var O;null===(O=S[g])||void 0===O||O.setWeights(v)},requiredPatches:function(v){g._mesh.struct.morph;var O=g._mesh.struct.morph.subMeshMorphs[v],X=S[v];if(null===X)return null;var Y=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:O.targets.length}];return O.attributes.includes(hi.ATTR_POSITION)&&Y.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),O.attributes.includes(hi.ATTR_NORMAL)&&Y.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),O.attributes.includes(hi.ATTR_TANGENT)&&Y.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),Y.push.apply(Y,X.requiredPatches()),Y},adaptPipelineState:function(g,v){var O;null===(O=S[g])||void 0===O||O.adaptPipelineState(v)},destroy:function(){for(var g=0,v=S;g<v.length;g++){var O=v[g];null==O||O.destroy()}}}},t1}(),IH=function(){function t1(g,v,S,O){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=O;var X=S.subMeshMorphs[v];this._subMeshMorph=X,$L(g,v,O);var Y=g.struct.vertexBundles[g.struct.primitives[v].vertexBundelIndices[0]].view.count;this._verticesCount=Y;var te=X.targets.length,ti=ZL(O,Y*te);this._textureInfo={width:ti.width,height:ti.height},this._attributes=X.attributes.map(function(v,S){var O=ti.create(),te=O.valueView;return X.targets.forEach(function(v,O){for(var X=v.displacements[S],ti=new Float32Array(g.data.buffer,g.data.byteOffset+X.offset,X.count),tr=Y*O*4,ta=0;ta<Y;++ta)te[tr+4*ta+0]=ti[3*ta+0],te[tr+4*ta+1]=ti[3*ta+1],te[tr+4*ta+2]=ti[3*ta+2]}),O.updatePixels(),{name:v,morphTexture:O}})}var g=t1.prototype;return g.destroy=function(){for(var g,v=f(this._attributes);!(g=v()).done;)g.value.morphTexture.destroy()},g.createInstance=function(){var g=this,v=new IX(this._gfxDevice,this._subMeshMorph.targets.length);return v.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),v.setVerticesCount(this._verticesCount),v.commit(),{setWeights:function(g){v.setWeights(g),v.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(S){for(var O,X=f(g._attributes);!(O=X()).done;){var Y=O.value,te=void 0;switch(Y.name){case hi.ATTR_POSITION:te=_q;break;case hi.ATTR_NORMAL:te=_J;break;case hi.ATTR_TANGENT:te=_$;break;default:G("Unexpected attribute!")}void 0!==te&&(S.bindSampler(te,Y.morphTexture.sampler),S.bindTexture(te,Y.morphTexture.texture))}S.bindBuffer(Xm.BINDING,v.buffer),S.update()},destroy:function(){}}},t1}(),Iz=function(){function t1(g,v,S,O){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=O;var X=S.subMeshMorphs[v];$L(g,v,O),this._attributes=X.attributes.map(function(v,S){return{name:v,targets:X.targets.map(function(v){return{displacements:new Float32Array(g.data.buffer,g.data.byteOffset+v.displacements[S].offset,v.displacements[S].count)}})}})}return t1.prototype.createInstance=function(){return new IW(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},n(t1,[{key:"data",get:function(){return this._attributes}}]),t1}(),IW=function(){function t1(g,v,S){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=g,this._morphUniforms=new IX(S,0);var O=ZL(S,v);this._morphUniforms.setMorphTextureInfo(O.width,O.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map(function(g){var v=O.create();return{attributeName:g.name,morphTexture:v}})}var g=t1.prototype;return g.setWeights=function(g){for(var v=0;v<this._attributes.length;++v){var S=this._attributes[v],O=S.morphTexture.valueView,X=this._owner.data[v];g.length,X.targets.length;for(var Y=0;Y<X.targets.length;++Y){var te=X.targets[Y].displacements,ti=g[Y],tr=te.length/3;if(0===Y)for(var ta=0;ta<tr;++ta)O[4*ta+0]=te[3*ta+0]*ti,O[4*ta+1]=te[3*ta+1]*ti,O[4*ta+2]=te[3*ta+2]*ti;else if(0!==ti)for(var th=0;th<tr;++th)O[4*th+0]+=te[3*th+0]*ti,O[4*th+1]+=te[3*th+1]*ti,O[4*th+2]+=te[3*th+2]*ti}S.morphTexture.updatePixels()}},g.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},g.adaptPipelineState=function(g){for(var v,S=f(this._attributes);!(v=S()).done;){var O=v.value,X=void 0;switch(O.attributeName){case hi.ATTR_POSITION:X=_q;break;case hi.ATTR_NORMAL:X=_J;break;case hi.ATTR_TANGENT:X=_$;break;default:G("Unexpected attribute!")}void 0!==X&&(g.bindSampler(X,O.morphTexture.sampler),g.bindTexture(X,O.morphTexture.texture))}g.bindBuffer(Xm.BINDING,this._morphUniforms.buffer),g.update()},g.destroy=function(){this._morphUniforms.destroy();for(var g=0;g<this._attributes.length;++g)this._attributes[g].morphTexture.destroy()},t1}(),IX=function(){function t1(g,v){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=v,this._localBuffer=new DataView(new ArrayBuffer(Xm.SIZE)),this._remoteBuffer=g.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,Xm.SIZE,Xm.SIZE))}var g=t1.prototype;return g.destroy=function(){this._remoteBuffer.destroy()},g.setWeights=function(g){g.length,this._targetCount;for(var v=0;v<g.length;++v)this._localBuffer.setFloat32(Xm.OFFSET_OF_WEIGHTS+4*v,g[v],X.sys.isLittleEndian)},g.setMorphTextureInfo=function(g,v){this._localBuffer.setFloat32(Xm.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,g,X.sys.isLittleEndian),this._localBuffer.setFloat32(Xm.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,v,X.sys.isLittleEndian)},g.setVerticesCount=function(g){this._localBuffer.setFloat32(Xm.OFFSET_OF_VERTICES_COUNT,g,X.sys.isLittleEndian)},g.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},n(t1,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t1}();function ZL(g,v){var S,O,X,Y;g.getFormatFeatures(oA.RGBA32F)&oP.SAMPLED_TEXTURE?(S=v,X=16,O=cK.PixelFormat.RGBA32F,Y=Float32Array):(S=4*v,X=4,O=cK.PixelFormat.RGBA8888,Y=Uint8Array);var te=function(g){g<5&&(g=5);var v=T(wi(g)),S=v>>1;return{width:1<<(1&v?S+1:S),height:1<<S}}(S),ti=te.width,tr=te.height;return{width:ti,height:tr,create:function(){var v=new ArrayBuffer(ti*tr*X),S=new Float32Array(v),te=Y===Float32Array?S:new Y(v),ta=new lX({width:ti,height:tr,_data:te,_compressed:!1,format:O}),th=new cK;th.setFilters(cK.Filter.NEAREST,cK.Filter.NEAREST),th.setMipFilter(cK.Filter.NONE),th.setWrapMode(cK.WrapMode.CLAMP_TO_EDGE,cK.WrapMode.CLAMP_TO_EDGE,cK.WrapMode.CLAMP_TO_EDGE),th.image=ta,th.getGFXTexture()||G("Unexpected: failed to create morph texture?");var tu=g.getSampler(th.getSamplerInfo());return{get texture(){return th.getGFXTexture()},get sampler(){return tu},get valueView(){return S},destroy:function(){th.destroy()},updatePixels:function(){th.uploadData(te)}}}}}function $L(g,v,S){g.renderingSubMeshes[v].enableVertexIdChannel(S)}function tF(g){return new Promise(function(S,O){try{g=new URL(g,v.meta.url).href,fetch(g).then(function(g){return g.arrayBuffer().then(S)}).catch(function(){})}catch(g){O(g)}})}var Ij={},Iq={};/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){function t1(g){throw g}var g=void 0,v=!0,S=this;function r(v,O){var X,Y=v.split("."),te=S;Y[0]in te||!te.execScript||te.execScript("var "+Y[0]);for(;Y.length&&(X=Y.shift());)Y.length||O===g?te=te[X]?te[X]:te[X]={}:te[X]=O}var O="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function a(g){if("string"==typeof g){var v,S,O=g.split("");for(v=0,S=O.length;v<S;v++)O[v]=(255&O[v].charCodeAt(0))>>>0;g=O}for(var X,Y=1,te=0,ti=g.length,tr=0;0<ti;){ti-=X=1024<ti?1024:ti;do te+=Y+=g[tr++];while(--X);Y%=65521,te%=65521}return(te<<16|Y)>>>0}function o(g,v){this.index="number"==typeof v?v:0,this.i=0,this.buffer=_instanceof(g,O?Uint8Array:Array)?g:new(O?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t1(Error("invalid index")),this.buffer.length<=this.index&&this.f()}o.prototype.f=function(){var g,v=this.buffer,S=v.length,X=new(O?Uint8Array:Array)(S<<1);if(O)X.set(v);else for(g=0;g<S;++g)X[g]=v[g];return this.buffer=X},o.prototype.d=function(g,v,S){var O,X=this.buffer,Y=this.index,te=this.i,ti=X[Y];if(S&&1<v&&(g=8<v?(ta[255&g]<<24|ta[g>>>8&255]<<16|ta[g>>>16&255]<<8|ta[g>>>24&255])>>32-v:ta[g]>>8-v),8>v+te)ti=ti<<v|g,te+=v;else for(O=0;O<v;++O)ti=ti<<1|g>>v-O-1&1,8==++te&&(te=0,X[Y++]=ta[ti],ti=0,Y===X.length&&(X=this.f()));X[Y]=ti,this.buffer=X,this.i=te,this.index=Y},o.prototype.finish=function(){var g,v=this.buffer,S=this.index;return 0<this.i&&(v[S]<<=8-this.i,v[S]=ta[v[S]],S++),O?g=v.subarray(0,S):(v.length=S,g=v),g};var X,Y=new(O?Uint8Array:Array)(256);for(X=0;256>X;++X){for(var te=tr=X,ti=7,tr=tr>>>1;tr;tr>>>=1)te<<=1,te|=1&tr,--ti;Y[X]=(te<<ti&255)>>>0}var ta=Y;function d(g){this.buffer=new(O?Uint16Array:Array)(2*g),this.length=0}function p(g){var v,S,X,Y,te,ti,tr,ta,th,tu=g.length,tl=0,tc=Number.POSITIVE_INFINITY;for(ta=0;ta<tu;++ta)g[ta]>tl&&(tl=g[ta]),g[ta]<tc&&(tc=g[ta]);for(v=1<<tl,S=new(O?Uint32Array:Array)(v),X=1,Y=0,te=2;X<=tl;){for(ta=0;ta<tu;++ta)if(g[ta]===X){for(ti=0,tr=Y,th=0;th<X;++th)ti=ti<<1|1&tr,tr>>=1;for(th=ti;th<v;th+=te)S[th]=X<<16|ta;++Y}++X,Y<<=1,te<<=1}return[S,tl,tc]}function m(g,v){this.h=tu,this.w=0,this.input=g,this.b=0,v&&(v.lazy&&(this.w=v.lazy),"number"==typeof v.compressionType&&(this.h=v.compressionType),v.outputBuffer&&(this.a=O&&_instanceof(v.outputBuffer,Array)?new Uint8Array(v.outputBuffer):v.outputBuffer),"number"==typeof v.outputIndex&&(this.b=v.outputIndex)),this.a||(this.a=new(O?Uint8Array:Array)(32768))}d.prototype.getParent=function(g){return 2*((g-2)/4|0)},d.prototype.push=function(g,v){var S,O,X,Y=this.buffer;for(S=this.length,Y[this.length++]=v,Y[this.length++]=g;0<S&&(O=this.getParent(S),Y[S]>Y[O]);)X=Y[S],Y[S]=Y[O],Y[O]=X,X=Y[S+1],Y[S+1]=Y[O+1],Y[O+1]=X,S=O;return this.length},d.prototype.pop=function(){var g,v,S,O,X,Y=this.buffer;for(v=Y[0],g=Y[1],this.length-=2,Y[0]=Y[this.length],Y[1]=Y[this.length+1],X=0;!((O=2*X+2)>=this.length)&&(O+2<this.length&&Y[O+2]>Y[O]&&(O+=2),Y[O]>Y[X]);)S=Y[X],Y[X]=Y[O],Y[O]=S,S=Y[X+1],Y[X+1]=Y[O+1],Y[O+1]=S,X=O;return{index:g,value:v,length:this.length}};var th,tu=2,tl={NONE:0,r:1,j:tu,N:3},tc=[];for(th=0;288>th;th++)switch(v){case 143>=th:tc.push([th+48,8]);break;case 255>=th:tc.push([th-144+400,9]);break;case 279>=th:tc.push([th-256+0,7]);break;case 287>=th:tc.push([th-280+192,8]);break;default:t1("invalid literal: "+th)}function A(g,v){this.length=g,this.G=v}function T(){var g=t_;switch(v){case 3===g:return[257,g-3,0];case 4===g:return[258,g-4,0];case 5===g:return[259,g-5,0];case 6===g:return[260,g-6,0];case 7===g:return[261,g-7,0];case 8===g:return[262,g-8,0];case 9===g:return[263,g-9,0];case 10===g:return[264,g-10,0];case 12>=g:return[265,g-11,1];case 14>=g:return[266,g-13,1];case 16>=g:return[267,g-15,1];case 18>=g:return[268,g-17,1];case 22>=g:return[269,g-19,2];case 26>=g:return[270,g-23,2];case 30>=g:return[271,g-27,2];case 34>=g:return[272,g-31,2];case 42>=g:return[273,g-35,3];case 50>=g:return[274,g-43,3];case 58>=g:return[275,g-51,3];case 66>=g:return[276,g-59,3];case 82>=g:return[277,g-67,4];case 98>=g:return[278,g-83,4];case 114>=g:return[279,g-99,4];case 130>=g:return[280,g-115,4];case 162>=g:return[281,g-131,5];case 194>=g:return[282,g-163,5];case 226>=g:return[283,g-195,5];case 257>=g:return[284,g-227,5];case 258===g:return[285,g-258,0];default:t1("invalid length: "+g)}}m.prototype.n=function(){var S,X,Y,te,ti=this.input;switch(this.h){case 0:for(Y=0,te=ti.length;Y<te;){var tr,ta,th,tl=X=O?ti.subarray(Y,Y+65535):ti.slice(Y,Y+65535),t_=(Y+=X.length)===te,tf=g,tp=g,tm=this.a,tg=this.b;if(O){for(tm=new Uint8Array(this.a.buffer);tm.length<=tg+tl.length+5;)tm=new Uint8Array(tm.length<<1);tm.set(this.a)}if(tr=t_?1:0,tm[tg++]=0|tr,th=65536+~(ta=tl.length)&65535,tm[tg++]=255&ta,tm[tg++]=ta>>>8&255,tm[tg++]=255&th,tm[tg++]=th>>>8&255,O)tm.set(tl,tg),tg+=tl.length,tm=tm.subarray(0,tg);else{for(tf=0,tp=tl.length;tf<tp;++tf)tm[tg++]=tl[tf];tm.length=tg}this.b=tg,this.a=tm}break;case 1:var tv=new o(new Uint8Array(this.a.buffer),this.b);tv.d(1,1,v),tv.d(1,2,v);var ty,tS,tA,tT=R(this,ti);for(ty=0,tS=tT.length;ty<tS;ty++)if(tA=tT[ty],o.prototype.d.apply(tv,tc[tA]),256<tA)tv.d(tT[++ty],tT[++ty],v),tv.d(tT[++ty],5),tv.d(tT[++ty],tT[++ty],v);else if(256===tA)break;this.a=tv.finish(),this.b=this.a.length;break;case tu:var tE,tC,tx,tb,tw,tI,tB,tP,tD,tM,tO,tk,tG,tV,tU,tH=new o(new Uint8Array(this.a),this.b),tz=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],tW=Array(19);for(tE=tu,tH.d(1,1,v),tH.d(tE,2,v),tC=R(this,ti),tB=I(tI=w(this.L,15)),tD=I(tP=w(this.K,7)),tx=286;257<tx&&0===tI[tx-1];tx--);for(tb=30;1<tb&&0===tP[tb-1];tb--);var tj,tq,tK,tZ,tQ,t$,t0=tx,t2=tb,t3=new(O?Uint32Array:Array)(t0+t2),t4=new(O?Uint32Array:Array)(316),t8=new(O?Uint8Array:Array)(19);for(tj=tq=0;tj<t0;tj++)t3[tq++]=tI[tj];for(tj=0;tj<t2;tj++)t3[tq++]=tP[tj];if(!O)for(tj=0,tZ=t8.length;tj<tZ;++tj)t8[tj]=0;for(tj=tQ=0,tZ=t3.length;tj<tZ;tj+=tq){for(tq=1;tj+tq<tZ&&t3[tj+tq]===t3[tj];++tq);if(tK=tq,0===t3[tj]){if(3>tK)for(;0<tK--;)t4[tQ++]=0,t8[0]++;else for(;0<tK;)(t$=138>tK?tK:138)>tK-3&&t$<tK&&(t$=tK-3),10>=t$?(t4[tQ++]=17,t4[tQ++]=t$-3,t8[17]++):(t4[tQ++]=18,t4[tQ++]=t$-11,t8[18]++),tK-=t$}else if(t4[tQ++]=t3[tj],t8[t3[tj]]++,3>--tK)for(;0<tK--;)t4[tQ++]=t3[tj],t8[t3[tj]]++;else for(;0<tK;)(t$=6>tK?tK:6)>tK-3&&t$<tK&&(t$=tK-3),t4[tQ++]=16,t4[tQ++]=t$-3,t8[16]++,tK-=t$}for(S=O?t4.subarray(0,tQ):t4.slice(0,tQ),tM=w(t8,7),tV=0;19>tV;tV++)tW[tV]=tM[tz[tV]];for(tw=19;4<tw&&0===tW[tw-1];tw--);for(tO=I(tM),tH.d(tx-257,5,v),tH.d(tb-1,5,v),tH.d(tw-4,4,v),tV=0;tV<tw;tV++)tH.d(tW[tV],3,v);for(tV=0,tU=S.length;tV<tU;tV++)if(tk=S[tV],tH.d(tO[tk],tM[tk],v),16<=tk){switch(tV++,tk){case 16:tG=2;break;case 17:tG=3;break;case 18:tG=7;break;default:t1("invalid code: "+tk)}tH.d(S[tV],tG,v)}var t6,t7,t9,ee,en,er,es,ea,eh=[tB,tI],eu=[tD,tP];for(en=eh[0],er=eh[1],es=eu[0],ea=eu[1],t6=0,t7=tC.length;t6<t7;++t6)if(t9=tC[t6],tH.d(en[t9],er[t9],v),256<t9)tH.d(tC[++t6],tC[++t6],v),ee=tC[++t6],tH.d(es[ee],ea[ee],v),tH.d(tC[++t6],tC[++t6],v);else if(256===t9)break;this.a=tH.finish(),this.b=this.a.length;break;default:t1("invalid compression type")}return this.a};var t_,tf,tp=[];for(t_=3;258>=t_;t_++)tf=T(),tp[t_]=tf[2]<<24|tf[1]<<16|tf[0];var tm=O?new Uint32Array(tp):tp;function R(S,X){function a(g,S){var O,X,Y,te,ti=g.G,tr=[],ta=0;switch(O=tm[g.length],tr[ta++]=65535&O,tr[ta++]=O>>16&255,tr[ta++]=O>>24,v){case 1===ti:X=[0,ti-1,0];break;case 2===ti:X=[1,ti-2,0];break;case 3===ti:X=[2,ti-3,0];break;case 4===ti:X=[3,ti-4,0];break;case 6>=ti:X=[4,ti-5,1];break;case 8>=ti:X=[5,ti-7,1];break;case 12>=ti:X=[6,ti-9,2];break;case 16>=ti:X=[7,ti-13,2];break;case 24>=ti:X=[8,ti-17,3];break;case 32>=ti:X=[9,ti-25,3];break;case 48>=ti:X=[10,ti-33,4];break;case 64>=ti:X=[11,ti-49,4];break;case 96>=ti:X=[12,ti-65,5];break;case 128>=ti:X=[13,ti-97,5];break;case 192>=ti:X=[14,ti-129,6];break;case 256>=ti:X=[15,ti-193,6];break;case 384>=ti:X=[16,ti-257,7];break;case 512>=ti:X=[17,ti-385,7];break;case 768>=ti:X=[18,ti-513,8];break;case 1024>=ti:X=[19,ti-769,8];break;case 1536>=ti:X=[20,ti-1025,9];break;case 2048>=ti:X=[21,ti-1537,9];break;case 3072>=ti:X=[22,ti-2049,10];break;case 4096>=ti:X=[23,ti-3073,10];break;case 6144>=ti:X=[24,ti-4097,11];break;case 8192>=ti:X=[25,ti-6145,11];break;case 12288>=ti:X=[26,ti-8193,12];break;case 16384>=ti:X=[27,ti-12289,12];break;case 24576>=ti:X=[28,ti-16385,13];break;case 32768>=ti:X=[29,ti-24577,13];break;default:t1("invalid distance")}for(O=X,tr[ta++]=O[0],tr[ta++]=O[1],tr[ta++]=O[2],Y=0,te=tr.length;Y<te;++Y)tf[tp++]=tr[Y];tv[tr[0]]++,ty[tr[3]]++,tg=g.length+S-1,tl=null}var Y,te,ti,tr,ta,th,tu,tl,tc,t_={},tf=O?new Uint16Array(2*X.length):[],tp=0,tg=0,tv=new(O?Uint32Array:Array)(286),ty=new(O?Uint32Array:Array)(30),tS=S.w;if(!O){for(ti=0;285>=ti;)tv[ti++]=0;for(ti=0;29>=ti;)ty[ti++]=0}for(tv[256]=1,Y=0,te=X.length;Y<te;++Y){for(ti=ta=0,tr=3;ti<tr&&Y+ti!==te;++ti)ta=ta<<8|X[Y+ti];if(t_[ta]===g&&(t_[ta]=[]),th=t_[ta],!(0<tg--)){for(;0<th.length&&32768<Y-th[0];)th.shift();if(Y+3>=te){for(tl&&a(tl,-1),ti=0,tr=te-Y;ti<tr;++ti)tc=X[Y+ti],tf[tp++]=tc,++tv[tc];break}if(0<th.length){var tA=g,tT=g,tE=0,tC=g,tx=g,tb=g,tw=X.length,tI=(tx=0,th.length);t:for(;tx<tI;tx++){if(tA=th[tI-tx-1],tC=3,3<tE){for(tb=tE;3<tb;tb--)if(X[tA+tb-1]!==X[Y+tb-1])continue t;tC=tE}for(;258>tC&&Y+tC<tw&&X[tA+tC]===X[Y+tC];)++tC;if(tC>tE&&(tT=tA,tE=tC),258===tC)break}tu=new A(tE,Y-tT),tl?tl.length<tu.length?(tc=X[Y-1],tf[tp++]=tc,++tv[tc],a(tu,0)):a(tl,-1):tu.length<tS?tl=tu:a(tu,0)}else tl?a(tl,-1):(tc=X[Y],tf[tp++]=tc,++tv[tc])}th.push(Y)}return tf[tp++]=256,tv[256]++,S.L=tv,S.K=ty,O?tf.subarray(0,tp):tf}function w(g,v){function i(g){var v=tS[g][tA[g]];v===tp?(i(g+1),i(g+1)):--tv[v],++tA[g]}var S,X,Y,te,ti,tr=g.length,ta=new d(572),th=new(O?Uint8Array:Array)(tr);if(!O)for(te=0;te<tr;te++)th[te]=0;for(te=0;te<tr;++te)0<g[te]&&ta.push(te,g[te]);if(S=Array(ta.length/2),X=new(O?Uint32Array:Array)(ta.length/2),1===S.length)return th[ta.pop().index]=1,th;for(te=0,ti=ta.length/2;te<ti;++te)S[te]=ta.pop(),X[te]=S[te].value;var tu,tl,tc,t_,tf,tp=X.length,tm=new(O?Uint16Array:Array)(v),tg=new(O?Uint8Array:Array)(v),tv=new(O?Uint8Array:Array)(tp),ty=Array(v),tS=Array(v),tA=Array(v),tT=(1<<v)-tp,tE=1<<v-1;for(tm[v-1]=tp,tl=0;tl<v;++tl)tT<tE?tg[tl]=0:(tg[tl]=1,tT-=tE),tT<<=1,tm[v-2-tl]=(tm[v-1-tl]/2|0)+tp;for(tm[0]=tg[0],ty[0]=Array(tm[0]),tS[0]=Array(tm[0]),tl=1;tl<v;++tl)tm[tl]>2*tm[tl-1]+tg[tl]&&(tm[tl]=2*tm[tl-1]+tg[tl]),ty[tl]=Array(tm[tl]),tS[tl]=Array(tm[tl]);for(tu=0;tu<tp;++tu)tv[tu]=v;for(tc=0;tc<tm[v-1];++tc)ty[v-1][tc]=X[tc],tS[v-1][tc]=tc;for(tu=0;tu<v;++tu)tA[tu]=0;for(1===tg[v-1]&&(--tv[0],++tA[v-1]),tl=v-2;0<=tl;--tl){for(t_=tu=0,tf=tA[tl+1],tc=0;tc<tm[tl];tc++)(t_=ty[tl+1][tf]+ty[tl+1][tf+1])>X[tu]?(ty[tl][tc]=t_,tS[tl][tc]=tp,tf+=2):(ty[tl][tc]=X[tu],tS[tl][tc]=tu,++tu);tA[tl]=0,1===tg[tl]&&i(tl)}for(Y=tv,te=0,ti=S.length;te<ti;++te)th[S[te].index]=Y[te];return th}function I(g){var v,S,X,Y,te=new(O?Uint16Array:Array)(g.length),ti=[],tr=[],ta=0;for(v=0,S=g.length;v<S;v++)ti[g[v]]=1+(0|ti[g[v]]);for(v=1,S=16;v<=S;v++)tr[v]=ta,(ta+=0|ti[v])>1<<v&&t1("overcommitted"),ta<<=1;for(65536>ta&&t1("undercommitted"),v=0,S=g.length;v<S;v++)for(ta=tr[g[v]],tr[g[v]]+=1,X=te[v]=0,Y=g[v];X<Y;X++)te[v]=te[v]<<1|1&ta,ta>>>=1;return te}function B(g,v){this.input=g,this.a=new(O?Uint8Array:Array)(32768),this.h=tg.j;var S,X={};for(S in!v&&(v={})||"number"!=typeof v.compressionType||(this.h=v.compressionType),v)X[S]=v[S];X.outputBuffer=this.a,this.z=new m(this.input,X)}var tg=tl;function D(g,v){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=O?new Uint8Array(g):g,this.s=!1,this.m=ty,this.B=!1,!v&&(v={})||(v.index&&(this.c=v.index),v.bufferSize&&(this.l=v.bufferSize),v.bufferType&&(this.m=v.bufferType),v.resize&&(this.B=v.resize)),this.m){case tv:this.b=32768,this.a=new(O?Uint8Array:Array)(32768+this.l+258);break;case ty:this.b=0,this.a=new(O?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t1(Error("invalid inflate mode"))}}B.prototype.n=function(){var g,v,S,X,Y,te,ti,tr=0;switch(ti=this.a,g=tQ){case tQ:v=Math.LOG2E*Math.log(32768)-8;break;default:t1(Error("invalid compression method"))}switch(S=v<<4|g,ti[tr++]=S,g){case tQ:switch(this.h){case tg.NONE:Y=0;break;case tg.r:Y=1;break;case tg.j:Y=2;break;default:t1(Error("unsupported compression type"))}break;default:t1(Error("invalid compression method"))}return X=Y<<6|0,ti[tr++]=X|31-(256*S+X)%31,te=a(this.input),this.z.b=tr,tr=(ti=this.z.n()).length,O&&((ti=new Uint8Array(ti.buffer)).length<=tr+4&&(this.a=new Uint8Array(ti.length+4),this.a.set(ti),ti=this.a),ti=ti.subarray(0,tr+4)),ti[tr++]=te>>24&255,ti[tr++]=te>>16&255,ti[tr++]=te>>8&255,ti[tr++]=255&te,ti},r("Zlib.Deflate",B),r("Zlib.Deflate.compress",function(g,v){return new B(g,v).n()}),r("Zlib.Deflate.CompressionType",tg),r("Zlib.Deflate.CompressionType.NONE",tg.NONE),r("Zlib.Deflate.CompressionType.FIXED",tg.r),r("Zlib.Deflate.CompressionType.DYNAMIC",tg.j);var tv=0,ty=1,tS={D:tv,C:ty};D.prototype.p=function(){for(;!this.s;){var S=tt(this,3);switch(1&S&&(this.s=v),S>>>=1){case 0:var X=this.input,Y=this.c,te=this.a,ti=this.b,tr=g,ta=g,th=g,tu=te.length,tl=g;switch(this.e=this.g=0,(tr=X[Y++])===g&&t1(Error("invalid uncompressed block header: LEN (first byte)")),ta=tr,(tr=X[Y++])===g&&t1(Error("invalid uncompressed block header: LEN (second byte)")),ta|=tr<<8,(tr=X[Y++])===g&&t1(Error("invalid uncompressed block header: NLEN (first byte)")),th=tr,(tr=X[Y++])===g&&t1(Error("invalid uncompressed block header: NLEN (second byte)")),ta===~(th|=tr<<8)&&t1(Error("invalid uncompressed block header: length verify")),Y+ta>X.length&&t1(Error("input buffer is broken")),this.m){case tv:for(;ti+ta>te.length;){if(ta-=tl=tu-ti,O)te.set(X.subarray(Y,Y+tl),ti),ti+=tl,Y+=tl;else for(;tl--;)te[ti++]=X[Y++];this.b=ti,te=this.f(),ti=this.b}break;case ty:for(;ti+ta>te.length;)te=this.f({v:2});break;default:t1(Error("invalid inflate mode"))}if(O)te.set(X.subarray(Y,Y+ta),ti),ti+=ta,Y+=ta;else for(;ta--;)te[ti++]=X[Y++];this.c=Y,this.b=ti,this.a=te;break;case 1:this.o(tV,tH);break;case 2:it(this);break;default:t1(Error("unknown BTYPE: "+S))}}return this.t()};var tA,tT,tE=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],tC=O?new Uint16Array(tE):tE,tx=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],tb=O?new Uint16Array(tx):tx,tw=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],tI=O?new Uint8Array(tw):tw,tB=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],tP=O?new Uint16Array(tB):tB,tD=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],tM=O?new Uint8Array(tD):tD,tO=new(O?Uint8Array:Array)(288);for(tA=0,tT=tO.length;tA<tT;++tA)tO[tA]=143>=tA?8:255>=tA?9:279>=tA?7:8;var tk,tG,tV=p(tO),tU=new(O?Uint8Array:Array)(30);for(tk=0,tG=tU.length;tk<tG;++tk)tU[tk]=5;var tH=p(tU);function tt(v,S){for(var O,X=v.g,Y=v.e,te=v.input,ti=v.c;Y<S;)(O=te[ti++])===g&&t1(Error("input buffer is broken")),X|=O<<Y,Y+=8;return O=X&(1<<S)-1,v.g=X>>>S,v.e=Y-S,v.c=ti,O}function et(v,S){for(var O,X,Y,te=v.g,ti=v.e,tr=v.input,ta=v.c,th=S[0],tu=S[1];ti<tu;)(O=tr[ta++])===g&&t1(Error("input buffer is broken")),te|=O<<ti,ti+=8;return Y=(X=th[te&(1<<tu)-1])>>>16,v.g=te>>Y,v.e=ti-Y,v.c=ta,65535&X}function it(g){function e(g,v,S){var O,X,Y,te;for(te=0;te<g;)switch(O=et(this,v)){case 16:for(Y=3+tt(this,2);Y--;)S[te++]=X;break;case 17:for(Y=3+tt(this,3);Y--;)S[te++]=0;X=0;break;case 18:for(Y=11+tt(this,7);Y--;)S[te++]=0;X=0;break;default:X=S[te++]=O}return S}var v,S,X,Y,te=tt(g,5)+257,ti=tt(g,5)+1,tr=tt(g,4)+4,ta=new(O?Uint8Array:Array)(tC.length);for(Y=0;Y<tr;++Y)ta[tC[Y]]=tt(g,3);v=p(ta),S=new(O?Uint8Array:Array)(te),X=new(O?Uint8Array:Array)(ti),g.o(p(e.call(g,te,v,S)),p(e.call(g,ti,v,X)))}function nt(g,v){var S,O;switch(this.input=g,this.c=0,!v&&(v={})||(v.index&&(this.c=v.index),v.verify&&(this.M=v.verify)),S=g[this.c++],O=g[this.c++],15&S){case tQ:this.method=tQ;break;default:t1(Error("unsupported compression method"))}0!=((S<<8)+O)%31&&t1(Error("invalid fcheck flag:"+((S<<8)+O)%31)),32&O&&t1(Error("fdict flag is not supported")),this.A=new D(g,{index:this.c,bufferSize:v.bufferSize,bufferType:v.bufferType,resize:v.resize})}D.prototype.o=function(g,v){var S=this.a,O=this.b;this.u=g;for(var X,Y,te,ti,tr=S.length-258;256!==(X=et(this,g));)if(256>X)O>=tr&&(this.b=O,S=this.f(),O=this.b),S[O++]=X;else for(ti=tb[Y=X-257],0<tI[Y]&&(ti+=tt(this,tI[Y])),X=et(this,v),te=tP[X],0<tM[X]&&(te+=tt(this,tM[X])),O>=tr&&(this.b=O,S=this.f(),O=this.b);ti--;)S[O]=S[O++-te];for(;8<=this.e;)this.e-=8,this.c--;this.b=O},D.prototype.I=function(g,v){var S=this.a,O=this.b;this.u=g;for(var X,Y,te,ti,tr=S.length;256!==(X=et(this,g));)if(256>X)O>=tr&&(tr=(S=this.f()).length),S[O++]=X;else for(ti=tb[Y=X-257],0<tI[Y]&&(ti+=tt(this,tI[Y])),X=et(this,v),te=tP[X],0<tM[X]&&(te+=tt(this,tM[X])),O+ti>tr&&(tr=(S=this.f()).length);ti--;)S[O]=S[O++-te];for(;8<=this.e;)this.e-=8,this.c--;this.b=O},D.prototype.f=function(){var g,v,S=new(O?Uint8Array:Array)(this.b-32768),X=this.b-32768,Y=this.a;if(O)S.set(Y.subarray(32768,S.length));else for(g=0,v=S.length;g<v;++g)S[g]=Y[g+32768];if(this.k.push(S),this.q+=S.length,O)Y.set(Y.subarray(X,X+32768));else for(g=0;32768>g;++g)Y[g]=Y[X+g];return this.b=32768,Y},D.prototype.J=function(g){var v,S,X,Y=this.input.length/this.c+1|0,te=this.input,ti=this.a;return g&&("number"==typeof g.v&&(Y=g.v),"number"==typeof g.F&&(Y+=g.F)),S=2>Y?(X=(te.length-this.c)/this.u[2]/2*258|0)<ti.length?ti.length+X:ti.length<<1:ti.length*Y,O?(v=new Uint8Array(S)).set(ti):v=ti,this.a=v},D.prototype.t=function(){var g,v,S,X,Y,te=0,ti=this.a,tr=this.k,ta=new(O?Uint8Array:Array)(this.q+(this.b-32768));if(0===tr.length)return O?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(v=0,S=tr.length;v<S;++v)for(X=0,Y=(g=tr[v]).length;X<Y;++X)ta[te++]=g[X];for(v=32768,S=this.b;v<S;++v)ta[te++]=ti[v];return this.k=[],this.buffer=ta},D.prototype.H=function(){var g,v=this.b;return O?this.B?(g=new Uint8Array(v)).set(this.a.subarray(0,v)):g=this.a.subarray(0,v):(this.a.length>v&&(this.a.length=v),g=this.a),this.buffer=g},nt.prototype.p=function(){var g,v=this.input;return g=this.A.p(),this.c=this.A.c,this.M&&(v[this.c++]<<24|v[this.c++]<<16|v[this.c++]<<8|v[this.c++])>>>0!==a(g)&&t1(Error("invalid adler-32 checksum")),g},r("Zlib.Inflate",nt),r("Zlib.Inflate.BufferType",tS),tS.ADAPTIVE=tS.C,tS.BLOCK=tS.D,r("Zlib.Inflate.prototype.decompress",nt.prototype.p);var tz,tW,tj=new(O?Uint8Array:Array)(288);for(tz=0,tW=tj.length;tz<tW;++tz)tj[tz]=143>=tz?8:255>=tz?9:279>=tz?7:8;p(tj);var tq,tK,tZ=new(O?Uint8Array:Array)(30);for(tq=0,tK=tZ.length;tq<tK;++tq)tZ[tq]=5;p(tZ);var tQ=8}).call(Iq);var IY,IK,IJ,IZ,IQ,I$=Iq.Zlib;function uF(g){switch(g){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}I$.Deflate=I$.Deflate,I$.Deflate.compress=I$.Deflate.compress,I$.Inflate=I$.Inflate,I$.Inflate.BufferType=I$.Inflate.BufferType,I$.Inflate.prototype.decompress=I$.Inflate.prototype.decompress;var I1=new eL,I2=new eL,I3=new Uint8Array,I5=nJ("cc.Mesh")((IK=function(g){function e(){var v;return(v=g.call(this)||this).morphRendering=null,v._struct=IJ&&IJ(),v._hash=IZ&&IZ(),v._data=I3,v._initialized=!1,v._allowDataAccess=IQ&&IQ(),v._isMeshDataUploaded=!1,v._renderingSubMeshes=null,v._boneSpaceBounds=new Map,v._jointBufferIndices=null,v}s(e,g);var v=e.prototype;return v.onLoaded=function(){this.initialize()},v.initialize=function(){if(!this._initialized){this._initialized=!0;var g,v,S={struct:this.struct,data:this.data};if(S.struct.compressed&&(g=S,v=new I$.Inflate(g.data).decompress(),g.data=v,g.struct.compressed=!1,S=g),this.struct.encoded&&(S=function(g){if(!g.struct.encoded)return g;var _$e=function(g){g<0&&J(14204,g)},v=JSON.parse(JSON.stringify(g.struct)),S=new IG;S.setNextAlignment(0);for(var O,X=f(v.vertexBundles);!(O=X()).done;){var Y=O.value,te=Y.view,ti=te.count*te.stride,tr=new Uint8Array(ti),ta=new Uint8Array(g.data.buffer,te.offset,te.length);_$e(Ij.decodeVertexBuffer(tr,te.count,te.stride,ta)),S.setNextAlignment(te.stride);var th={offset:S.getLength(),length:tr.byteLength,count:te.count,stride:te.stride};Y.view=th,S.addBuffer(tr)}for(var tu,tl=f(v.primitives);!(tu=tl()).done;){var tc=tu.value;if(void 0!==tc.indexView){var t_=tc.indexView,tf=t_.count*t_.stride,tp=new Uint8Array(tf),tm=new Uint8Array(g.data.buffer,t_.offset,t_.length);_$e(Ij.decodeIndexBuffer(tp,t_.count,t_.stride,tm)),S.setNextAlignment(t_.stride);var tg={offset:S.getLength(),length:tp.byteLength,count:t_.count,stride:t_.stride};tc.indexView=tg,S.addBuffer(tp)}}return{struct:v,data:new Uint8Array(S.getCombined())}}(S)),!this.struct.quantized||uZ.gfxDevice.getFormatFeatures(oA.RGB16F)&oP.VERTEX_ATTRIBUTE||(S=function(g){var v=JSON.parse(JSON.stringify(g.struct)),S=new IG;function n(g,v,S,O,X,Y,te){for(var ti=0;ti<S;ti++)for(var tr=0;tr<O;tr++)v(te*ti+X*tr,g(Y*ti+X*tr))}function r(g,v,S,O,X,Y){for(var te=0;te<S;te++)for(var ti=0;ti<O;ti++)v(Y*te+4*ti,Ui(g(X*te+2*ti)))}S.setNextAlignment(0);for(var O=0;O<v.vertexBundles.length;++O){for(var X=v.vertexBundles[O],Y=X.view,te=X.attributes,ti=g.struct.vertexBundles[O].attributes,tr=[],ta=[],th=[],tu=0;tu<te.length;++tu){var tl=te[tu],tc=gF(new DataView(g.data.buffer,Y.offset+dF(ti,tu)),tl.format),t_=!0;switch(tl.format){case oA.R16F:tl.format=oA.R32F;break;case oA.RG16F:tl.format=oA.RG32F;break;case oA.RGB16F:tl.format=oA.RGB32F;break;case oA.RGBA16F:tl.format=oA.RGBA32F;break;default:t_=!1}tr.push(uf[tl.format].size),ta.push(t_),th.push(tc)}for(var tf=tr.reduce(function(g,v){return g+v},0),tp=new Uint8Array(tf*Y.count),tm=0;tm<te.length;++tm){var tg=te[tm],tv=th[tm],ty=vF(new DataView(tp.buffer,dF(te,tm)),tg.format),tS=ta[tm],tA=uf[tg.format];tS?r(tv,ty,Y.count,tA.count,Y.stride,tf):n(tv,ty,Y.count,tA.count,tA.size/tA.count,Y.stride,tf)}S.setNextAlignment(tf);var tT={offset:S.getLength(),length:tp.byteLength,count:Y.count,stride:tf};X.view=tT,S.addBuffer(tp)}for(var tE,tC=f(v.primitives);!(tE=tC()).done;){var tx=tE.value;if(void 0!==tx.indexView){var tb=tx.indexView,tw=new Uint8Array(g.data.buffer,tb.offset,tb.length);S.setNextAlignment(tb.stride);var tI={offset:S.getLength(),length:tw.byteLength,count:tb.count,stride:tb.stride};tx.indexView=tI,S.addBuffer(tw)}}var tB=new Uint8Array(S.getCombined());return v.quantized=!1,{struct:v,data:tB}}(S)),this._struct=S.struct,this._data=S.data,this._struct.dynamic){for(var O=uZ.gfxDevice,X=[],Y=[],te=0;te<this._struct.vertexBundles.length;te++){var ti=this._struct.vertexBundles[te],tr=O.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,ti.view.length,ti.view.stride));X.push(tr)}for(var ta=0;ta<this._struct.primitives.length;ta++){var th=this._struct.primitives[ta],tu=th.indexView,tl=null;tu&&(tl=O.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.DEVICE,tu.length,tu.stride)));for(var tc=[],t_=0;t_<th.vertexBundelIndices.length;t_++){var tf=th.vertexBundelIndices[t_];tc.push(X[tf])}for(var tp=[],tm=0;tm<th.vertexBundelIndices.length;tm++)for(var tg,tv=th.vertexBundelIndices[tm],ty=f(this._struct.vertexBundles[tv].attributes);!(tg=ty()).done;){var tS=tg.value,tA=new hz;tA.copy(tS),tp.push(tA)}var tT=new mf(tc,tp,th.primitiveMode,tl);tT.drawInfo=new hR,tT.mesh=this,tT.subMeshIdx=ta,Y.push(tT)}this._renderingSubMeshes=Y}else{for(var tE=this._data.buffer,tC=uZ.gfxDevice,tx=this._createVertexBuffers(tC,tE),tb=[],tw=[],tI=0;tI<this._struct.primitives.length;tI++){var tB=this._struct.primitives[tI];if(0!==tB.vertexBundelIndices.length){var tP=null,tD=void 0;if(tB.indexView){var tM=tB.indexView,tO=tM.stride,tk=tM.length;if(4===tO&&!tC.hasFeature(oS.ELEMENT_INDEX_UINT)){var tG=this._struct.vertexBundles[tB.vertexBundelIndices[0]].view.count;if(tG>=65536){q(10001,tG,65536);continue}tO>>=1,tk>>=1}tP=tC.createBuffer(new hx(oC.INDEX,oR.DEVICE,tk,tO)),tb.push(tP),tD=new(uF(tM.stride))(tE,tM.offset,tM.count),tM.stride!==tO&&(tD=uF(tO).from(tD)),tP.update(tD)}var tV=tB.vertexBundelIndices.map(function(g){return tx[g]}),tU=[];if(tB.vertexBundelIndices.length>0)for(var tH=tB.vertexBundelIndices[0],tz=this._struct.vertexBundles[tH].attributes,tW=0;tW<tz.length;++tW){var tj=tz[tW];tU[tW]=new hz(tj.name,tj.format,tj.isNormalized,tj.stream,tj.isInstanced,tj.location)}var tq=new mf(tV,tU,tB.primitiveMode,tP);tq.mesh=this,tq.subMeshIdx=tI,tw.push(tq)}}this._renderingSubMeshes=tw,this._struct.morph&&(this.morphRendering=function(g,v){return new IU(g,v)}(this,tC)),this._isMeshDataUploaded=!0,this._allowDataAccess||this.releaseData()}}},v.updateSubMesh=function(g,v){if(this._struct.dynamic){if(g>=this._struct.primitives.length)q(14201);else{var S=[];if(v.positions.length>0&&S.push(v.positions),v.normals&&v.normals.length>0&&S.push(v.normals),v.uvs&&v.uvs.length>0&&S.push(v.uvs),v.tangents&&v.tangents.length>0&&S.push(v.tangents),v.colors&&v.colors.length>0&&S.push(v.colors),v.customAttributes)for(var O=0;O<v.customAttributes.length;O++)S.push(v.customAttributes[O].values);for(var X=this._struct.dynamic,Y=X.info,te=this._struct.primitives[g],ti=this._renderingSubMeshes[g],tr=ti.drawInfo,ta=0;ta<S.length;ta++){var th=S[ta],tu=this._struct.vertexBundles[te.vertexBundelIndices[ta]],tl=tu.view.stride,tc=th.byteLength/tl,t_=th.byteLength,tf=new Uint8Array(this._data.buffer,tu.view.offset,t_),tp=new Uint8Array(th.buffer,th.byteOffset,t_),tm=ti.vertexBuffers[ta];Y.maxSubMeshVertices,t_>0&&(tf.set(tp),tm.update(tp,t_)),tu.view.count=tc,tr.vertexCount=tc}if(te.indexView){var tg=te.indexView,tv=tg.stride,ty=2===tv?v.indices16.length:v.indices32.length,tS=ty*tv,tA=new Uint8Array(this._data.buffer,tg.offset,tS),tT=2===tv?new Uint8Array(v.indices16.buffer,v.indices16.byteOffset,tS):new Uint8Array(v.indices32.buffer,v.indices32.byteOffset,tS),tE=ti.indexBuffer;Y.maxSubMeshIndices,tS>0&&(tA.set(tT),tE.update(tT,tS)),tg.count=ty,tr.indexCount=ty}if(v.minPos&&v.maxPos){var tC=new eL(v.minPos.x,v.minPos.y,v.minPos.z),tx=new eL(v.maxPos.x,v.maxPos.y,v.maxPos.z);X.bounds[g]||(X.bounds[g]=new iK),iK.fromPoints(X.bounds[g],tC,tx);for(var tb,tw=new eL,tI=new eL,tB=f(X.bounds);!(tb=tB()).done;){var tP=tb.value;tP&&(tP.getBoundary(tw,tI),eL.min(tC,tw,tC),eL.max(tx,tI,tx))}this._struct.minPosition=new eL(tC.x,tC.y,tC.z),this._struct.maxPosition=new eL(tx.x,tx.y,tx.z)}ti.invalidateGeometricInfo()}}else q(14200)},v.destroy=function(){return this.destroyRenderingMesh(),g.prototype.destroy.call(this)},v.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var g=0;g<this._renderingSubMeshes.length;g++)this._renderingSubMeshes[g].destroy();this._renderingSubMeshes=null,this._initialized=!1,this._isMeshDataUploaded=!1}},v.assign=function(g,v){this.reset({struct:g,data:v})},v.reset=function(g){this.destroyRenderingMesh(),this._struct=g.struct,this._data=g.data,this._hash=0},v.getBoneSpaceBounds=function(g){if(this._boneSpaceBounds.has(g.hash))return this._boneSpaceBounds.get(g.hash);var v=[];this._boneSpaceBounds.set(g.hash,v);for(var S=[],O=g.bindposes,X=0;X<O.length;X++)v.push(new iK(1/0,1/0,1/0,-1/0,-1/0,-1/0)),S.push(!1);for(var Y=this._struct.primitives,te=0;te<Y.length;te++){var ti=this.readAttribute(te,hi.ATTR_JOINTS),tr=this.readAttribute(te,hi.ATTR_WEIGHTS),ta=this.readAttribute(te,hi.ATTR_POSITION);if(ti&&tr&&ta)for(var th=Math.min(ti.length/4,tr.length/4,ta.length/3),tu=0;tu<th;tu++){eL.set(I1,ta[3*tu+0],ta[3*tu+1],ta[3*tu+2]);for(var tl=0;tl<4;++tl){var tc=4*tu+tl,t_=ti[tc];if(!(0===tr[tc]||t_>=O.length)){eL.transformMat4(I2,I1,O[t_]),S[t_]=!0;var tf=v[t_];eL.min(tf.center,tf.center,I2),eL.max(tf.halfExtents,tf.halfExtents,I2)}}}}for(var tp=0;tp<O.length;tp++){var tm=v[tp];S[tp]?iK.fromPoints(tm,tm.center,tm.halfExtents):v[tp]=null}return v},v.merge=function(g,v,S){if(S&&!this.validateMergingMesh(g))return!1;var O=new eL,X=v&&new eW,Y=v&&new iK;if(X&&v.getRotation(X),!this._initialized){var te=JSON.parse(JSON.stringify(g._struct)),ti=g._data.slice();if(v){te.maxPosition&&te.minPosition&&(eL.add(Y.center,te.maxPosition,te.minPosition),eL.multiplyScalar(Y.center,Y.center,.5),eL.subtract(Y.halfExtents,te.maxPosition,te.minPosition),eL.multiplyScalar(Y.halfExtents,Y.halfExtents,.5),iK.transform(Y,Y,v),eL.add(te.maxPosition,Y.center,Y.halfExtents),eL.subtract(te.minPosition,Y.center,Y.halfExtents));for(var tr=0;tr<te.vertexBundles.length;tr++)for(var ta=te.vertexBundles[tr],th=0;th<ta.attributes.length;th++)if(ta.attributes[th].name===hi.ATTR_POSITION||ta.attributes[th].name===hi.ATTR_NORMAL){var tu=ta.attributes[th].format,tl=new DataView(ti.buffer,ta.view.offset+dF(ta.attributes,th)),tc=gF(tl,tu),t_=vF(tl,tu);if(!tc||!t_)continue;for(var tf=ta.view.count,tp=ta.view.stride,tm=mF(tu),tg=0;tg<tf;tg++){var tv=tg*tp,ty=tv+tm,tS=ty+tm;switch(O.set(tc(tv),tc(ty),tc(tS)),ta.attributes[th].name){case hi.ATTR_POSITION:O.transformMat4(v);break;case hi.ATTR_NORMAL:eL.transformQuat(O,O,X)}t_(tv,O.x),t_(ty,O.y),t_(tS,O.z)}}}return this.reset({struct:te,data:ti}),this.initialize(),!0}for(var tA,tT,tE,tC,tx,tb=new IG,tw=0,tI=0,tB=0,tP=0,tD=0,tM=0,tO=0,tk=0,tG=!1,tV=new Array(this._struct.vertexBundles.length),tU=0;tU<this._struct.vertexBundles.length;++tU){var tH=this._struct.vertexBundles[tU],tz=g._struct.vertexBundles[tU];tB=tH.view.offset,tP=tz.view.offset,tI=tH.view.stride,tw=tH.view.count+tz.view.count,tA=new ArrayBuffer(tw*tI),tT=new Uint8Array(tA),tB+=(tE=this._data.subarray(tB,tB+tH.view.length)).length,tP+=(tC=g._data.subarray(tP,tP+tz.view.length)).length,tT.set(tE),tD=0;for(var tW,tj=f(tH.attributes);!(tW=tj()).done;){var tq=tW.value;tO=0,tG=!1;for(var tK,tZ=f(tz.attributes);!(tK=tZ()).done;){var tQ=tK.value;if(tq.name===tQ.name&&tq.format===tQ.format){tG=!0;break}tO+=uf[tQ.format].size}if(tG){tk=uf[tq.format].size,tM=tH.view.length+tD;for(var t$=0;t$<tz.view.count;++t$){if(tx=tC.subarray(tO,tO+tk),tT.set(tx,tM),(tq.name===hi.ATTR_POSITION||tq.name===hi.ATTR_NORMAL)&&v){var t0=new Float32Array(tT.buffer,tM,3);switch(O.set(t0[0],t0[1],t0[2]),tq.name){case hi.ATTR_POSITION:O.transformMat4(v);break;case hi.ATTR_NORMAL:eL.transformQuat(O,O,X)}t0[0]=O.x,t0[1]=O.y,t0[2]=O.z}tM+=tH.view.stride,tO+=tz.view.stride}}tD+=uf[tq.format].size}tV[tU]={attributes:tH.attributes,view:{offset:tb.getLength(),length:tA.byteLength,count:tw,stride:tI}},tb.addBuffer(tA)}for(var t2,t3,t4,t8=0,t6=2,t7=new Array(this._struct.primitives.length),t9=0;t9<this._struct.primitives.length;++t9){var ee=this._struct.primitives[t9],en=g._struct.primitives[t9];t7[t9]={primitiveMode:ee.primitiveMode,vertexBundelIndices:ee.vertexBundelIndices};for(var er,es=0,ea=f(ee.vertexBundelIndices);!(er=ea()).done;){var eh=er.value;es=Math.max(es,this._struct.vertexBundles[eh].view.count)}if(ee.indexView&&en.indexView){t8=ee.indexView.count,t8+=en.indexView.count,tB=ee.indexView.offset,tP=en.indexView.offset,t6=t8<256?1:t8<65536?2:4;var eu=new ArrayBuffer(t8*t6);if(t2=2===t6?new Uint16Array(eu):1===t6?new Uint8Array(eu):new Uint32Array(eu),t3=2===ee.indexView.stride?new Uint16Array(this._data.buffer,tB,ee.indexView.count):1===ee.indexView.stride?new Uint8Array(this._data.buffer,tB,ee.indexView.count):new Uint32Array(this._data.buffer,tB,ee.indexView.count),t6===ee.indexView.stride)t2.set(t3);else for(var ec=0;ec<ee.indexView.count;++ec)t2[ec]=t3[ec];tB+=ee.indexView.length,t4=2===en.indexView.stride?new Uint16Array(g._data.buffer,tP,en.indexView.count):1===en.indexView.stride?new Uint8Array(g._data.buffer,tP,en.indexView.count):new Uint32Array(g._data.buffer,tP,en.indexView.count);for(var e_=0;e_<en.indexView.count;++e_)t2[ee.indexView.count+e_]=es+t4[e_];tP+=en.indexView.length,t7[t9].indexView={offset:tb.getLength(),length:eu.byteLength,count:t8,stride:t6},tb.setNextAlignment(t6),tb.addBuffer(eu)}}var ef={vertexBundles:tV,primitives:t7,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return ef.minPosition&&g._struct.minPosition&&ef.maxPosition&&g._struct.maxPosition&&(v?(eL.add(Y.center,g._struct.maxPosition,g._struct.minPosition),eL.multiplyScalar(Y.center,Y.center,.5),eL.subtract(Y.halfExtents,g._struct.maxPosition,g._struct.minPosition),eL.multiplyScalar(Y.halfExtents,Y.halfExtents,.5),iK.transform(Y,Y,v),eL.add(O,Y.center,Y.halfExtents),eL.max(ef.maxPosition,ef.maxPosition,O),eL.subtract(O,Y.center,Y.halfExtents),eL.min(ef.minPosition,ef.minPosition,O)):(eL.min(ef.minPosition,ef.minPosition,g._struct.minPosition),eL.max(ef.maxPosition,ef.maxPosition,g._struct.maxPosition))),this.reset({struct:ef,data:new Uint8Array(tb.getCombined())}),this.initialize(),!0},v.validateMergingMesh=function(g){if(this._struct.dynamic||g._struct.dynamic)return!1;if(this._struct.vertexBundles.length!==g._struct.vertexBundles.length)return!1;for(var v=0;v<this._struct.vertexBundles.length;++v){var S=this._struct.vertexBundles[v],O=g._struct.vertexBundles[v];if(S.attributes.length!==O.attributes.length)return!1;for(var X=0;X<S.attributes.length;++X)if(S.attributes[X].format!==O.attributes[X].format)return!1}if(this._struct.primitives.length!==g._struct.primitives.length)return!1;for(var Y=0;Y<this._struct.primitives.length;++Y){var te=this._struct.primitives[Y],ti=g._struct.primitives[Y];if(te.vertexBundelIndices.length!==ti.vertexBundelIndices.length)return!1;for(var tr=0;tr<te.vertexBundelIndices.length;++tr)if(te.vertexBundelIndices[tr]!==ti.vertexBundelIndices[tr])return!1;if(te.primitiveMode!==ti.primitiveMode)return!1;if(te.indexView){if(void 0===ti.indexView)return!1}else if(ti.indexView)return!1}return!0},v.readAttribute=function(g,v){var S=this,O=null;return this._accessAttribute(g,v,function(g,v){var X=g.view.count,Y=g.attributes[v].format,te=D_(uf[Y]);if(0!==X){var ti=new DataView(S._data.buffer,g.view.offset+dF(g.attributes,v)),tr=uf[Y],ta=gF(ti,Y);if(te&&ta){for(var th=tr.count,tu=new te(X*th),tl=g.view.stride,tc=0;tc<X;++tc)for(var t_=0;t_<th;++t_)tu[th*tc+t_]=ta(tl*tc+tu.BYTES_PER_ELEMENT*t_);O=tu}}}),O},v.copyAttribute=function(g,v,S,O,X){var Y=this,te=!1;return this._accessAttribute(g,v,function(g,v){var ti=g.view.count;if(0!==ti){var tr=g.attributes[v].format,ta=new DataView(Y._data.buffer,g.view.offset+dF(g.attributes,v)),th=new DataView(S,X),tu=uf[tr],tl=gF(ta,tr),tc=vF(th,tr);if(tl&&tc){for(var t_=tu.count,tf=g.view.stride,tp=mF(tr),tm=O,tg=tp,tv=0;tv<ti;++tv)for(var ty=0;ty<t_;++ty)tc(tm*tv+tg*ty,tl(tf*tv+tp*ty));te=!0}}else te=!0}),te},v.readIndices=function(g){if(g>=this._struct.primitives.length)return null;var v=this._struct.primitives[g];if(!v.indexView)return null;var S=v.indexView.stride;return new(1===S?Uint8Array:2===S?Uint16Array:Uint32Array)(this._data.buffer,v.indexView.offset,v.indexView.count)},v.copyIndices=function(g,v){if(g>=this._struct.primitives.length)return!1;var S=this._struct.primitives[g];if(!S.indexView)return!1;for(var O=S.indexView.count,X=1===S.indexView.stride?oA.R8UI:2===S.indexView.stride?oA.R16UI:oA.R32UI,Y=gF(new DataView(this._data.buffer),X),te=0;te<O;++te)v[te]=Y(S.indexView.offset+uf[X].size*te);return!0},v.readAttributeFormat=function(g,v){var S=null;return this._accessAttribute(g,v,function(g,v){var O=g.attributes[v].format;S=uf[O]}),S},v._accessAttribute=function(g,v,S){if(!(g>=this._struct.primitives.length))for(var O,X=f(this._struct.primitives[g].vertexBundelIndices);!(O=X()).done;){var Y=O.value,te=this._struct.vertexBundles[Y],ti=te.attributes.findIndex(function(g){return g.name===v});if(!(ti<0)){S(te,ti);break}}},v._createVertexBuffers=function(g,v){return this._struct.vertexBundles.map(function(S){var O=g.createBuffer(new hx(oC.VERTEX,oR.DEVICE,S.view.length,S.view.stride)),X=new Uint8Array(v,S.view.offset,S.view.length);return O.update(X),O})},v.initDefault=function(v){g.prototype.initDefault.call(this,v),this.reset({struct:{vertexBundles:[],primitives:[]},data:I3})},v.releaseData=function(){this._data=I3},n(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(g){this._data=new Uint8Array(g)}},{key:"subMeshCount",get:function(){var g=this.renderingSubMeshes;return g?g.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=Sl(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map(function(g){return g.jointMapIndex||0})}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}},{key:"allowDataAccess",get:function(){return this._allowDataAccess},set:function(g){this._allowDataAccess=g,this._isMeshDataUploaded&&!this._allowDataAccess&&this.releaseData()}}]),e}(lx),IJ=ws(IK.prototype,"_struct",[n2],function(){return{vertexBundles:[],primitives:[]}}),IZ=ws(IK.prototype,"_hash",[n2],function(){return 0}),IQ=ws(IK.prototype,"_allowDataAccess",[n2],function(){return!0}),IY=IK))||IY;function dF(g,v){for(var S=0,O=0;O<v;++O){var X=g[O];S+=uf[X.format].size}return S}X.Mesh=I5;var I4=a3.isLittleEndian;function mF(g){var v=uf[g];return v.size/v.count}function gF(g,v){var S=uf[v],O=S.size/S.count;switch(S.type){case oT.UNORM:switch(O){case 1:return function(v){return g.getUint8(v)};case 2:return function(v){return g.getUint16(v,I4)};case 4:return function(v){return g.getUint32(v,I4)}}break;case oT.SNORM:case oT.INT:switch(O){case 1:return function(v){return g.getInt8(v)};case 2:return function(v){return g.getInt16(v,I4)};case 4:return function(v){return g.getInt32(v,I4)}}break;case oT.UINT:switch(O){case 1:return function(v){return g.getUint8(v)};case 2:return function(v){return g.getUint16(v,I4)};case 4:return function(v){return g.getUint32(v,I4)}}break;case oT.FLOAT:switch(O){case 2:return function(v){return g.getUint16(v,I4)};case 4:return function(v){return g.getFloat32(v,I4)}}}return null}function vF(g,v){var S=uf[v],O=S.size/S.count;switch(S.type){case oT.UNORM:switch(O){case 1:return function(v,S){return g.setUint8(v,S)};case 2:return function(v,S){return g.setUint16(v,S,I4)};case 4:return function(v,S){return g.setUint32(v,S,I4)}}break;case oT.SNORM:case oT.INT:switch(O){case 1:return function(v,S){return g.setInt8(v,S)};case 2:return function(v,S){return g.setInt16(v,S,I4)};case 4:return function(v,S){return g.setInt32(v,S,I4)}}break;case oT.UINT:switch(O){case 1:return function(v,S){return g.setUint8(v,S)};case 2:return function(v,S){return g.setUint16(v,S,I4)};case 4:return function(v,S){return g.setUint32(v,S,I4)}}break;case oT.FLOAT:switch(O){case 2:return function(v,S){return g.setUint16(v,S,I4)};case 4:return function(v,S){return g.setFloat32(v,S,I4)}}}return null}var I8,I6,I7,I9=[new hz(hi.ATTR_POSITION,oA.RGB32F),new hz(hi.ATTR_NORMAL,oA.RGB32F),new hz(hi.ATTR_TEX_COORD,oA.RG32F),new hz(hi.ATTR_TANGENT,oA.RGBA32F),new hz(hi.ATTR_COLOR,oA.RGBA32F)],Ba=new eL,Bo=new eL,Bh=new e$;!function(g){g[g.RECT=0]="RECT",g[g.POLYGON=1]="POLYGON"}(I7||(I7={}));var Bu,Bl,Bc,B_=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],Bf=g("b",nJ("cc.SpriteFrame")(((I6=function(g){function e(){var v;return(v=g.call(this)||this).vertices=null,v.uv=[],v.unbiasUV=[],v.uvSliced=[],v._rect=new ic,v._trimmedBorder=new e7,v._offset=new e8,v._originalSize=new iu,v._rotated=!1,v._capInsets=[0,0,0,0],v._atlasUuid="",v._texture=void 0,v._isFlipUVY=!1,v._isFlipUVX=!1,v._original=null,v._packable=!0,v._pixelsToUnit=100,v._pivot=new e8(.5,.5),v._meshType=I7.RECT,v._extrude=0,v._customOutLine=[],v._minPos=new eL,v._maxPos=new eL,v}s(e,g),e.createWithImage=function(g){var v=_instanceof(g,lX)?g:new lX(g),S=new cK;S.image=v;var O=new e;return O.texture=S,O};var v=e.prototype;return v.textureLoaded=function(){return!!this.texture},v.isRotated=function(){return this._rotated},v.setRotated=function(g){this.rotated=g},v.getRect=function(g){return g?(g.set(this._rect),g):this._rect.clone()},v.setRect=function(g){this.rect=g},v.getOriginalSize=function(g){return g?(g.set(this._originalSize),g):this._originalSize.clone()},v.setOriginalSize=function(g){this.originalSize=g},v.getOffset=function(g){return g?(g.set(this._offset),g):this._offset.clone()},v.setOffset=function(g){this.offset=g},v.getGFXTexture=function(){return this._texture.getGFXTexture()},v.getGFXSampler=function(){return this._texture.getGFXSampler()},v.getHash=function(){return this._texture.getHash()},v.getSamplerInfo=function(){return this._texture.getSamplerInfo()},v.reset=function(g,v){void 0===v&&(v=!1);var S=!1;v&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,S=!0),g&&(g.texture&&(this._rect.x=this._rect.y=0,this._rect.width=g.texture.width,this._rect.height=g.texture.height,this._refreshTexture(g.texture),this.checkRect(this._texture)),g.originalSize&&this._originalSize.set(g.originalSize),g.rect&&this._rect.set(g.rect),g.offset&&this._offset.set(g.offset),void 0!==g.borderTop&&(this._capInsets[1]=g.borderTop),void 0!==g.borderBottom&&(this._capInsets[3]=g.borderBottom),void 0!==g.borderLeft&&(this._capInsets[0]=g.borderLeft),void 0!==g.borderRight&&(this._capInsets[2]=g.borderRight),void 0!==g.isRotate&&(this._rotated=!!g.isRotate),void 0!==g.isFlipUv&&(this._isFlipUVY=!!g.isFlipUv),S=!0),S&&this.texture&&this._calculateUV(),this._calcTrimmedBorder()},v.checkRect=function(g){var v=this._rect,S=v.x,O=v.y;return this._rotated?(S+=v.height,O+=v.width):(S+=v.width,O+=v.height),S>g.width?(J(3300,this.name+"/"+g.name,S,g.width),!1):!(O>g.height&&(J(3301,this.name+"/"+g.name,O,g.height),1))},v._calcTrimmedBorder=function(){var g=this._originalSize.width,v=this._originalSize.height,S=.5*(g-this._rect.width),O=.5*(v-this._rect.height);this._trimmedBorder.x=this._offset.x+S,this._trimmedBorder.y=this._offset.x-S,this._trimmedBorder.z=this._offset.y+O,this._trimmedBorder.w=this._offset.y-O},v.ensureMeshData=function(){this._mesh||(this._initVertices(),this._createMesh())},v.destroy=function(){return this._packable&&Ik&&Ik.deleteAtlasSpriteFrame(this),g.prototype.destroy.call(this)},v._calculateSlicedUV=function(){var g=this._rect,v=this.texture,S=v.width,O=v.height,X=this._capInsets[0],Y=this._capInsets[2],te=g.width-X-Y,ti=this._capInsets[1],tr=this._capInsets[3],ta=g.height-ti-tr,th=this.uvSliced;if(th.length=0,this._rotated){B_[0].u=g.x/S,B_[1].u=(g.x+tr)/S,B_[2].u=(g.x+tr+ta)/S,B_[3].u=(g.x+g.height)/S,B_[3].v=g.y/O,B_[2].v=(g.y+X)/O,B_[1].v=(g.y+X+te)/O,B_[0].v=(g.y+g.width)/O;for(var tu=0;tu<4;++tu)for(var tl=B_[tu],tc=0;tc<4;++tc){var t_=B_[3-tc];th.push({u:tl.u,v:t_.v})}}else{B_[0].u=g.x/S,B_[1].u=(g.x+X)/S,B_[2].u=(g.x+X+te)/S,B_[3].u=(g.x+g.width)/S,B_[3].v=g.y/O,B_[2].v=(g.y+ti)/O,B_[1].v=(g.y+ti+ta)/O,B_[0].v=(g.y+g.height)/O;for(var tf=0;tf<4;++tf)for(var tp=B_[tf],tm=0;tm<4;++tm){var tg=B_[tm];th.push({u:tg.u,v:tp.v})}}this.emit(e.EVENT_UV_UPDATED,this)},v._calculateUV=function(){var g=this._rect,v=this.uv,S=this.unbiasUV,O=this.texture,X=O.width,Y=O.height;if(this._rotated){var te=0===X?0:g.x/X,ti=0===X?1:(g.x+g.height)/X,tr=0===Y?0:g.y/Y,ta=0===Y?1:(g.y+g.width)/Y;this._isFlipUVX&&this._isFlipUVY?(v[0]=ti,v[1]=ta,v[2]=ti,v[3]=tr,v[4]=te,v[5]=ta,v[6]=te,v[7]=tr):this._isFlipUVX?(v[0]=ti,v[1]=tr,v[2]=ti,v[3]=ta,v[4]=te,v[5]=tr,v[6]=te,v[7]=ta):this._isFlipUVY?(v[0]=te,v[1]=ta,v[2]=te,v[3]=tr,v[4]=ti,v[5]=ta,v[6]=ti,v[7]=tr):(v[0]=te,v[1]=tr,v[2]=te,v[3]=ta,v[4]=ti,v[5]=tr,v[6]=ti,v[7]=ta);var th=0===X?0:g.x/X,tu=0===X?1:(g.x+g.height)/X,tl=0===Y?0:g.y/Y,tc=0===Y?1:(g.y+g.width)/Y;this._isFlipUVX&&this._isFlipUVY?(S[0]=tu,S[1]=tc,S[2]=tu,S[3]=tl,S[4]=th,S[5]=tc,S[6]=th,S[7]=tl):this._isFlipUVX?(S[0]=tu,S[1]=tl,S[2]=tu,S[3]=tc,S[4]=th,S[5]=tl,S[6]=th,S[7]=tc):this._isFlipUVY?(S[0]=th,S[1]=tc,S[2]=th,S[3]=tl,S[4]=tu,S[5]=tc,S[6]=tu,S[7]=tl):(S[0]=th,S[1]=tl,S[2]=th,S[3]=tc,S[4]=tu,S[5]=tl,S[6]=tu,S[7]=tc)}else{var t_=0===X?0:g.x/X,tf=0===X?1:(g.x+g.width)/X,tp=0===Y?1:(g.y+g.height)/Y,tm=0===Y?0:g.y/Y;this._isFlipUVX&&this._isFlipUVY?(v[0]=tf,v[1]=tm,v[2]=t_,v[3]=tm,v[4]=tf,v[5]=tp,v[6]=t_,v[7]=tp):this._isFlipUVX?(v[0]=tf,v[1]=tp,v[2]=t_,v[3]=tp,v[4]=tf,v[5]=tm,v[6]=t_,v[7]=tm):this._isFlipUVY?(v[0]=t_,v[1]=tm,v[2]=tf,v[3]=tm,v[4]=t_,v[5]=tp,v[6]=tf,v[7]=tp):(v[0]=t_,v[1]=tp,v[2]=tf,v[3]=tp,v[4]=t_,v[5]=tm,v[6]=tf,v[7]=tm);var tg=0===X?0:g.x/X,tv=0===X?1:(g.x+g.width)/X,ty=0===Y?1:(g.y+g.height)/Y,tS=0===Y?0:g.y/Y;this._isFlipUVX&&this._isFlipUVY?(S[0]=tv,S[1]=tS,S[2]=tg,S[3]=tS,S[4]=tv,S[5]=ty,S[6]=tg,S[7]=ty):this._isFlipUVX?(S[0]=tv,S[1]=ty,S[2]=tg,S[3]=ty,S[4]=tv,S[5]=tS,S[6]=tg,S[7]=tS):this._isFlipUVY?(S[0]=tg,S[1]=tS,S[2]=tv,S[3]=tS,S[4]=tg,S[5]=ty,S[6]=tv,S[7]=ty):(S[0]=tg,S[1]=ty,S[2]=tv,S[3]=ty,S[4]=tg,S[5]=tS,S[6]=tv,S[7]=tS)}this._calculateSlicedUV()},v._setDynamicAtlasFrame=function(g){g&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=g.texture,this._rect.x=g.x,this._rect.y=g.y,this._calculateUV())},v._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},v._checkPackable=function(){var g=Ik;if(g){var v=this._texture;if(_instanceof(v,cK)&&!v.isCompressed){var S=this.width,O=this.height;if(!v.image||S>g.maxFrameSize||O>g.maxFrameSize)this._packable=!1;else{var X=te.HTMLCanvasElement;v.image&&_instanceof(v.image,X)&&(this._packable=!0)}}else this._packable=!1}},v._serialize=function(){return null},v._deserialize=function(g){var v=g,S=v.rect;S&&(this._rect=new ic(S.x,S.y,S.width,S.height));var O=v.offset;v.offset&&(this._offset=new e8(O.x,O.y));var X=v.originalSize;v.originalSize&&(this._originalSize=new iu(X.width,X.height)),this._rotated=!!v.rotated,this._name=v.name,this._packable=!!v.packable,this._pixelsToUnit=v.pixelsToUnit;var Y=v.pivot;Y&&(this._pivot=new e8(Y.x,Y.y)),this._meshType=v.meshType;var te=v.capInsets;te&&(this._capInsets[0]=te[0],this._capInsets[1]=te[1],this._capInsets[2]=te[2],this._capInsets[3]=te[3]);var ti=v.vertices;if(ti){this.vertices||(this.vertices={rawPosition:[],positions:[],indexes:ti.indexes,uv:ti.uv,nuv:ti.nuv,minPos:new eL(ti.minPos.x,ti.minPos.y,ti.minPos.z),maxPos:new eL(ti.maxPos.x,ti.maxPos.y,ti.maxPos.z)}),this.vertices.rawPosition.length=0;for(var tr=ti.rawPosition,ta=0;ta<tr.length;ta+=3)this.vertices.rawPosition.push(new eL(tr[ta],tr[ta+1],tr[ta+2]));this._updateMeshVertices()}},v.clone=function(){var g,v,S,O,X,Y=new e,te=this.vertices;return Y.vertices=te?{rawPosition:te.rawPosition.slice(0),positions:te.positions.slice(0),indexes:te.indexes.slice(0),uv:te.uv.slice(0),nuv:te.nuv.slice(0),minPos:te.minPos.clone(),maxPos:te.maxPos.clone()}:null,(g=Y.uv).splice.apply(g,[0,Y.uv.length].concat(this.uv)),(v=Y.unbiasUV).splice.apply(v,[0,Y.unbiasUV.length].concat(this.unbiasUV)),(S=Y.uvSliced).splice.apply(S,[0,Y.uvSliced.length].concat(this.uvSliced)),Y._rect.set(this._rect),Y._trimmedBorder.set(this._trimmedBorder),Y._offset.set(this._offset),Y._originalSize.set(this._originalSize),Y._rotated=this._rotated,(O=Y._capInsets).splice.apply(O,[0,Y._capInsets.length].concat(this._capInsets)),Y._atlasUuid=this._atlasUuid,Y._texture=this._texture,Y._isFlipUVX=this._isFlipUVX,Y._isFlipUVY=this._isFlipUVY,this._original?Y._original={_texture:this._original._texture,_x:this._original._x,_y:this._original._y}:Y._original=null,Y._packable=this._packable,Y._pixelsToUnit=this._pixelsToUnit,Y._pivot.set(this._pivot),Y._meshType=this._meshType,Y._extrude=this._extrude,(X=Y._customOutLine).splice.apply(X,[0,Y._customOutLine.length].concat(this._customOutLine)),Y._minPos=this._minPos,Y._maxPos=this._maxPos,this._mesh&&Y._createMesh(),Y},v._refreshTexture=function(g){this._texture=g;var v=this._texture,S={},O=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(v)||(S.rect=new ic(0,0,v.width,v.height),O=!0),(0===this._originalSize.width||0===this._originalSize.height||O)&&(S.originalSize=new iu(v.width,v.height),O=!0),O&&this.reset(S),this._checkPackable(),this._mesh&&this._updateMesh()},v.onLoaded=function(){this._calcTrimmedBorder()},v.initDefault=function(v){g.prototype.initDefault.call(this,v);var S=new cK;S.initDefault(),this._refreshTexture(S),this._calculateUV()},v.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},v._initVertices=function(){if(this.vertices?(this.vertices.rawPosition.length=0,this.vertices.positions.length=0,this.vertices.indexes.length=0,this.vertices.uv.length=0,this.vertices.nuv.length=0,this.vertices.minPos.set(0,0,0),this.vertices.maxPos.set(0,0,0)):this.vertices={rawPosition:[],positions:[],indexes:[],uv:[],nuv:[],minPos:new eL,maxPos:new eL},this._meshType===I7.POLYGON);else{var g=this.texture,v=g.width,S=g.height,O=this.rect,X=O.width,Y=O.height,te=O.x,ti=S-O.y-Y,tr=X/2,ta=Y/2,th=0===v?0:te/v,tu=0===v?1:(te+X)/v,tl=0===S?1:(ti+Y)/S,tc=0===S?0:O.y/S;Bo.set(-tr,-ta,0),this.vertices.rawPosition.push(Bo.clone()),this.vertices.uv.push(te),this.vertices.uv.push(ti+Y),this.vertices.nuv.push(th),this.vertices.nuv.push(tc),this.vertices.minPos.set(Bo),Bo.set(tr,-ta,0),this.vertices.rawPosition.push(Bo.clone()),this.vertices.uv.push(te+X),this.vertices.uv.push(ti+Y),this.vertices.nuv.push(tu),this.vertices.nuv.push(tc),Bo.set(-tr,ta,0),this.vertices.rawPosition.push(Bo.clone()),this.vertices.uv.push(te),this.vertices.uv.push(ti),this.vertices.nuv.push(th),this.vertices.nuv.push(tl),Bo.set(tr,ta,0),this.vertices.rawPosition.push(Bo.clone()),this.vertices.uv.push(te+X),this.vertices.uv.push(ti),this.vertices.nuv.push(tu),this.vertices.nuv.push(tl),this.vertices.maxPos.set(Bo),this.vertices.indexes.push(0),this.vertices.indexes.push(1),this.vertices.indexes.push(2),this.vertices.indexes.push(2),this.vertices.indexes.push(1),this.vertices.indexes.push(3)}this._updateMeshVertices()},v._updateMeshVertices=function(){Bh.identity();var g=1/this._pixelsToUnit,v=-(this._pivot.x-.5)*this.rect.width*g,S=-(this._pivot.y-.5)*this.rect.height*g,O=new eL(v,S,0);Bh.transform(O),O.set(g,g,1),Bh.scale(O);for(var X=this.vertices,Y=0;Y<X.rawPosition.length;Y++){var te=X.rawPosition[Y];eL.transformMat4(O,te,Bh),eL.toArray(X.positions,O,3*Y)}eL.transformMat4(this._minPos,X.minPos,Bh),eL.transformMat4(this._maxPos,X.maxPos,Bh)},v._createMesh=function(){this._mesh=function(g,v,S){S=S||{};var O,X=[],Y=0,te=[],ti=0,tr=g.positions.slice();if(tr.length>0){if(O=null,g.attributes)for(var ta,th=f(g.attributes);!(ta=th()).done;){var tu=ta.value;if(tu.name===hi.ATTR_POSITION){O=tu;break}}O||(O=I9[0]),X.push(O);var tl=uf[O.format];ti=Math.max(ti,Math.floor(tr.length/tl.count)),te.push({offset:Y,data:tr,attribute:O}),Y+=tl.size}if(g.normals&&g.normals.length>0){if(O=null,g.attributes)for(var tc,t_=f(g.attributes);!(tc=t_()).done;){var tf=tc.value;if(tf.name===hi.ATTR_NORMAL){O=tf;break}}O||(O=I9[1]);var tp=uf[O.format];X.push(O),ti=Math.max(ti,Math.floor(g.normals.length/tp.count)),te.push({offset:Y,data:g.normals,attribute:O}),Y+=tp.size}if(g.uvs&&g.uvs.length>0){if(O=null,g.attributes)for(var tm,tg=f(g.attributes);!(tm=tg()).done;){var tv=tm.value;if(tv.name===hi.ATTR_TEX_COORD){O=tv;break}}O||(O=I9[2]);var ty=uf[O.format];X.push(O),ti=Math.max(ti,Math.floor(g.uvs.length/ty.count)),te.push({offset:Y,data:g.uvs,attribute:O}),Y+=ty.size}if(g.tangents&&g.tangents.length>0){if(O=null,g.attributes)for(var tS,tA=f(g.attributes);!(tS=tA()).done;){var tT=tS.value;if(tT.name===hi.ATTR_TANGENT){O=tT;break}}O||(O=I9[3]);var tE=uf[O.format];X.push(O),ti=Math.max(ti,Math.floor(g.tangents.length/tE.count)),te.push({offset:Y,data:g.tangents,attribute:O}),Y+=tE.size}if(g.colors&&g.colors.length>0){if(O=null,g.attributes)for(var tC,tx=f(g.attributes);!(tC=tx()).done;){var tb=tC.value;if(tb.name===hi.ATTR_COLOR){O=tb;break}}O||(O=I9[4]);var tw=uf[O.format];X.push(O),ti=Math.max(ti,Math.floor(g.colors.length/tw.count)),te.push({offset:Y,data:g.colors,attribute:O}),Y+=tw.size}if(g.customAttributes)for(var tI=0;tI<g.customAttributes.length;tI++){var tB=g.customAttributes[tI],tP=uf[tB.attr.format];X.push(tB.attr),ti=Math.max(ti,Math.floor(tB.values.length/tP.count)),te.push({offset:Y,data:tB.values,attribute:tB.attr}),Y+=tP.size}for(var tD=new IG,tM=new ArrayBuffer(ti*Y),tO=new DataView(tM),tk=0,tG=te;tk<tG.length;tk++){var tV=tG[tk];kA(tO,tV.data,tV.attribute.format,tV.offset,Y)}tD.setNextAlignment(0);var tU={attributes:X,view:{offset:tD.getLength(),length:tM.byteLength,count:ti,stride:Y}};tD.addBuffer(tM);var tH=null,tz=0;if(g.indices){var tW=g.indices;tz=tW.length,tH=new ArrayBuffer(2*tz),kA(new DataView(tH),tW,oA.R16UI)}var tj={primitiveMode:g.primitiveMode||oY.TRIANGLE_LIST,vertexBundelIndices:[0]};tH&&(tD.setNextAlignment(2),tj.indexView={offset:tD.getLength(),length:tH.byteLength,count:tz,stride:2},tD.addBuffer(tH));var tq=g.minPos;if(!tq&&S.calculateBounds){tq=eL.set(new eL,1/0,1/0,1/0);for(var tK=0;tK<ti;++tK)eL.set(Ba,tr[3*tK+0],tr[3*tK+1],tr[3*tK+2]),eL.min(tq,tq,Ba)}var tZ=g.maxPos;if(!tZ&&S.calculateBounds){tZ=eL.set(new eL,-1/0,-1/0,-1/0);for(var tQ=0;tQ<ti;++tQ)eL.set(Ba,tr[3*tQ+0],tr[3*tQ+1],tr[3*tQ+2]),eL.max(tZ,tZ,Ba)}var t$={vertexBundles:[tU],primitives:[tj]};return tq&&(t$.minPosition=new eL(tq.x,tq.y,tq.z)),tZ&&(t$.maxPosition=new eL(tZ.x,tZ.y,tZ.z)),v||(v=new I5),v.reset({struct:t$,data:new Uint8Array(tD.getCombined())}),v}({primitiveMode:oY.TRIANGLE_LIST,positions:this.vertices.positions,uvs:this.vertices.nuv,indices:this.vertices.indexes,minPos:this._minPos,maxPos:this._maxPos,attributes:[new hz(hi.ATTR_POSITION,oA.RGB32F),new hz(hi.ATTR_TEX_COORD,oA.RG32F)]})},v._updateMesh=function(){this._mesh&&this._mesh.destroy(),this._initVertices(),this._createMesh()},n(e,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(g){this._capInsets[1]!==g&&(this._capInsets[1]=g,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(g){this._capInsets[3]!==g&&(this._capInsets[3]=g,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(g){this._capInsets[0]!==g&&(this._capInsets[0]=g,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(g){this._capInsets[2]!==g&&(this._capInsets[2]=g,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(g){this._rect.equals(g)||(this._rect.set(g),this._texture&&this._calculateUV(),this._calcTrimmedBorder())}},{key:"originalSize",get:function(){return this._originalSize},set:function(g){this._originalSize.equals(g)||(this._originalSize.set(g),this._texture&&this._calculateUV(),this._calcTrimmedBorder())}},{key:"offset",get:function(){return this._offset},set:function(g){this._offset.set(g),this._calcTrimmedBorder()}},{key:"rotated",get:function(){return this._rotated},set:function(g){this._rotated!==g&&(this._rotated=g,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(g){g?g!==this._texture&&this.reset({texture:g},!0):q(3122,this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(g){this._atlasUuid=g}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(g){globalThis.Build?this._texture=g:g&&(this._refreshTexture(g),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(g){this._isFlipUVX=g,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(g){this._isFlipUVY=g,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(g){this._packable=g}},{key:"original",get:function(){return this._original}},{key:"pixelsToUnit",get:function(){return this._pixelsToUnit}},{key:"pivot",get:function(){return this._pivot}},{key:"mesh",get:function(){return this._mesh}},{key:"trimmedBorder",get:function(){return this._trimmedBorder}}]),e}(lx)).EVENT_UV_UPDATED="uv_updated",I6.MeshType=I7,I8=I6))||I8);X.SpriteFrame=Bf;var Bd,Bm=g("a",nJ("cc.SpriteAtlas")((Bl=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).spriteFrames=Bc&&Bc(),v}s(e,g);var v=e.prototype;return v.getTexture=function(){var g=Object.keys(this.spriteFrames);if(g.length>0){var v=this.spriteFrames[g[0]];return v&&v.texture}return null},v.getSpriteFrame=function(g){var v=this.spriteFrames[g];return v?(v.name||(v.name=g),v):null},v.getSpriteFrames=function(){for(var g=[],v=this.spriteFrames,S=0,O=Object.keys(v);S<O.length;S++){var X=O[S];g.push(v[X])}return g},v._serialize=function(){},v._deserialize=function(g,v){var S=g;this._name=S.name;var O=S.spriteFrames;this.spriteFrames=gt();for(var X=0;X<O.length;X+=2)v.result.push(this.spriteFrames,O[X],O[X+1],Xt(Bf))},e}(lx),Bc=ws(Bl.prototype,"spriteFrames",[n2],function(){return gt()}),Bu=Bl))||Bu);X.SpriteAtlas=Bm;var Bg,Bv,BS,BT=g("F",nJ("cc.Font")(Bd=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(lx))||Bd);X.Font=BT;var BE=g("T",nJ("cc.TTFFont")((Bv=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._fontFamily=BS&&BS(),v}return s(e,g),e.prototype.initDefault=function(v){this._fontFamily="Arial",g.prototype.initDefault.call(this,v)},n(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(g){this._fontFamily=g||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:Mu(this._native),__isNative__:!0}}}]),e}(BT),BS=ws(Bv.prototype,"_fontFamily",[n2],function(){return null}),p(Bv.prototype,"_nativeAsset",[rE,rT],Object.getOwnPropertyDescriptor(Bv.prototype,"_nativeAsset"),Bv.prototype),p(Bv.prototype,"_nativeDep",[rE],Object.getOwnPropertyDescriptor(Bv.prototype,"_nativeDep"),Bv.prototype),Bg=Bv))||Bg);X.TTFFont=BE;var BC=g("w",.26),Bx=g("x",(BC+1)/2-BC);var Bb=new tU(2);Bb.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var BR=new(g("z",function(){function t1(g){this.count=0,this.limit=0,this.datas={},this.limit=g}var g=t1.prototype;return g.moveToHead=function(g){g.next=this.head,g.prev=null,this.head&&(this.head.prev=g),this.head=g,this.tail||(this.tail=g),this.count++,this.datas[g.key]=g},g.put=function(g,v){var S=Bb.get();if(S.key=g,S.value=v,this.count>=this.limit){var O=this.tail;delete this.datas[O.key],this.count--,this.tail=O.prev,this.tail.next=null,O.prev=null,O.next=null,Bb.put(O)}this.moveToHead(S)},g.remove=function(g){g.prev?g.prev.next=g.next:this.head=g.next,g.next?g.next.prev=g.prev:this.tail=g.prev,delete this.datas[g.key],this.count--},g.get=function(g){var v=this.datas[g];return v?(this.remove(v),this.moveToHead(v),v.value):null},g.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},g.has=function(g){return!!this.datas[g]},g.delete=function(g){var v=this.datas[g];this.remove(v)},t1}()))(100),Bw=/([a-zA-Z0-9--]+|\S)/,BI=/^[!,.:;'}\]%\?>]/,BB=/([a-zA-Z0-9--iI]+|\S)$/,BP=/[a-zA-Z0-9--iI]+$/,BD=/^[a-zA-Z0-9--iI]/;function YF(g){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(g)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(g)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(g)}function qF(g){var v=g.charCodeAt(0);return v>=9&&v<=13||32===v||133===v||160===v||5760===v||v>=8192&&v<=8202||8232===v||8233===v||8239===v||8287===v||12288===v}function KF(g,v,S){var O=(S||g.font)+"\uD83C\uDFAE"+v,X=BR.get(O);if(null!==X)return X;var Y=g.measureText(v),te=Y&&Y.width||0;return BR.put(O,te),te}function JF(g){for(var v=g.length,S=0,O=0,X=0;X<v;X++)8205!==(O=g.charCodeAt(X))&&(O>=55296&&O<=56319&&(O=g.charCodeAt(X+1))>=56320&&O<=57343?((X+2>=v||8205!==g.charCodeAt(X+2))&&S++,X++):S++);return S}function QF(g,v){for(var S=g.length,O=0,X=0,Y=0,te=0,ti=0;ti<S;ti++)if(8205!==(te=g.charCodeAt(ti))){if(te>=55296&&te<=56319&&(O++,(te=g.charCodeAt(ti+1))>=56320&&te<=57343)){if(O++,ti+2>=S||8205!==g.charCodeAt(ti+2)){if(v===X)return g.slice(Y,Y+O);Y+=O,X++,O=0}ti++}else{if(v===X)return g.charAt(ti);Y=ti+1,X++,O=0}}else O++;return""}function ZF(g,v){var S=QF(g,v);if(1===S.length)return""+S.charCodeAt(0);for(var O="",X=0;X<S.length;X++)O+=""+S.charCodeAt(X);return""+O}function $F(g,v){if(v>=g.length)return g.length;for(var S=v,O=g[S];S>=0&&(""===O&&(O=g[--S]),O>="\udc00"&&O<="\udfff"&&S-1>=0&&(O=g[--S]),O>="\ud800"&&O<="\udbff")&&S-1>=0&&""===g[S-1];)O=g[--S];return S}function tN(g,v){for(var S=v,O=v,X=g[O];O<g.length;)if(""===X&&(S++,(X=g[++O])>="\ud800"&&X<="\udbff"&&(S++,X=g[++O])),X>="\ud800"&&X<="\udbff")S++,X=g[++O];else{if(!(X>="\udc00"&&X<="\udfff"))break;if(X=g[++O],!(O<g.length&&""===g[O]))break;S++,X=g[O]}return S}function eN(g,v,S){var O=$F(g,v);O<v&&(O=tN(g,v)+1);var X=S;if(void 0!==S){X=tN(g,S=Math.max(0,S-1));var Y=$F(g,S);Y<O||Y===O&&v>O?X=O:X+=1}return g.substring(O,X)}function iN(g){return BD.exec(g)}function nN(g){return BP.exec(g)}function rN(g,v,S,O){var X=[];if(0===g.length||S<0)return X.push(""),X;for(var Y=g;v>S&&Y.length>1;){for(var te=Y.length*(S/v)|0,ti=eN(Y,te),tr=v-O(ti),ta=ti,th=0,tu=0;tr>S&&tu++<100;)te*=S/tr,tr=v-O(ti=eN(Y,te|=0));for(tu=0;ti&&tr<=S&&tu++<100;){var tl=Bw.exec(ti);ta=ti,tr=v-O(ti=eN(Y,te+=th=tl?tl[0].length:1))}0==(te-=th)?(te=1,ta=eN(Y,1)):1===te&&Y[0]>="\ud800"&&Y[0]<="\udbff"&&(te=2,ta=eN(Y,2));var tc=eN(Y,0,te),t_=void 0;BI.test(ta||ti)&&(0==(te-=(t_=BB.exec(tc))?t_[0].length:0)&&(te=1),ta=eN(Y,te),tc=eN(Y,0,te)),BD.test(ta)&&(t_=BP.exec(tc))&&tc!==t_[0]&&(ta=eN(Y,te-=t_[0].length),tc=eN(Y,0,te)),(0===X.length||(tc=tc.trim()).length>0)&&X.push(tc),v=O(Y=ta||ti)}return(0===X.length||(Y=Y.trim()).length>0)&&X.push(Y),X}var BM,BO=te.document,BL=null,BF=-1,BN="BES bswy:->@123",Bk=Object.create(null),BG=[],BV=3e3;function fN(){for(var g=!0,v=Date.now(),S=BG.length-1;S>=0;S--){var O=BG[S],X=O.fontFamilyName;if(v-O.startTime>BV)q(4933,X),O.onComplete(null,X),BG.splice(S,1);else{var Y=O.refWidth,te="40px "+X;BL.font=te,Y!==KF(BL,BN,te)?(BG.splice(S,1),O.onComplete(null,X)):g=!1}}g&&(clearInterval(BF),BF=-1)}function dN(g,v,S){var O=function(g){var v=g.lastIndexOf(".ttf");if(-1===v)return g;var S,O=g.lastIndexOf("/");return -1!==(S=-1===O?g.substring(0,v)+"_LABEL":g.substring(O+1,v)+"_LABEL").indexOf(" ")&&(S='"'+S+'"'),S}(g);if(Bk[O])S(null,O);else{if(!BL){var X=BO.createElement("canvas");X.width=100,X.height=100,BL=X.getContext("2d")}var Y="40px "+O,ti=BO.createElement("style");ti.type="text/css";var tr="";Number.isNaN(O)?tr+="@font-face { font-family:"+O+"; src:":tr+='@font-face { font-family:"'+O+'"; src:',tr+='url("'+g+'");',ti.textContent=tr+"}",BO.body.appendChild(ti);var ta,th,tu,tl,tc,t_,tf=BO.createElement("div"),tp=tf.style;if(tp.fontFamily=O,tf.innerHTML=".",tp.position="absolute",tp.left="-100px",tp.top="-100px",BO.body.appendChild(tf),function(){if(void 0===BM){if("FontFace"in te){var g=/Gecko.*Firefox\/(\d+)/.exec(te.navigator.userAgent),v=/OS X.*Version\/10\..*Safari/.exec(te.navigator.userAgent)&&/Apple/.exec(te.navigator.vendor);BM=g?parseInt(g[1],10)>42:!v}else BM=!1}return BM}())ta=Date.now(),th=O,tu=S,tl=new Promise(function(g,v){!function i(){Date.now()-ta>=BV?v():BO.fonts.load("40px "+th).then(function(v){v.length>=1?g():setTimeout(i,100)},function(){v()})}()}),tc=null,t_=new Promise(function(g,v){tc=setTimeout(v,BV)}),Promise.race([t_,tl]).then(function(){tc&&(clearTimeout(tc),tc=null),tu(null,th)},function(){q(4933,th),tu(null,th)});else{var tm={fontFamilyName:O,refWidth:KF(BL,BN,Y),onComplete:S,startTime:Date.now()};BG.push(tm),-1===BF&&(BF=setInterval(fN,100))}Bk[O]=ti}}function pN(g,v,S,O){var X=new BE;X._nativeUrl=g,X._nativeAsset=v,O(null,X)}dv.register({".font":dN,".eot":dN,".ttf":dN,".woff":dN,".svg":dN,".ttc":dN}),dC.register({".font":pN,".eot":pN,".ttf":pN,".woff":pN,".svg":pN,".ttc":pN});var BU,BH,Bz,BW,BX,Bj,Bq,BY,BK,BJ=/^(click)(\s)*=|(param)(\s)*=/,BZ=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,BQ=g("v",function(){function t1(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var g=t1.prototype;return g.parse=function(g){this._resultObjectArray.length=0,this._stack.length=0;for(var v=0,S=g.length;v<S;){var O=g.indexOf(">",v),X=-1;if(O>=0&&(X=g.lastIndexOf("<",O))<v-1&&(X=g.indexOf("<",O+1),O=g.indexOf(">",X+1)),X<0)this._stack.pop(),this._processResult(g.substring(v)),v=S;else{var Y=g.substring(v,X),te=g.substring(X+1,O);""===te&&(Y=g.substring(v,O+1)),this._processResult(Y),-1===O?O=X:"/"===g.charAt(X+1)?this._stack.pop():this._addToStack(te),v=O+1}}return this._resultObjectArray},g._attributeToObject=function(g){g=g.trim();var v={},S=/^(color|size)(\s)*=/.exec(g),O="",X=0,Y="";if(S){if(O=S[0],""===(g=g.substring(O.length).trim()))return v;switch(X=g.indexOf(" "),O[0]){case"c":v.color=X>-1?g.substring(0,X).trim():g;break;case"s":v.size=parseInt(g)}return X>-1&&(Y=g.substring(X+1).trim(),v.event=this._processEventHandler(Y)),v}if((S=/^(br(\s)*\/)/.exec(g))&&S[0].length>0&&(O=S[0].trim()).startsWith("br")&&"/"===O[O.length-1])return v.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),v;var te="",ti=-1;if((S=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(g))&&S[0].length>0&&(O=S[0].trim()).startsWith("img")&&"/"===O[O.length-1]){var tr;S=BZ.exec(g);for(var ta=!1;S;){var th=(O=(g=g.substring(g.indexOf(S[0]))).substr(0,S[0].length)).length;if(O=(O=O.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),te=g.substring(th).trim(),ti="src"===O?this.getRightQuotationIndex(te):-1,tr=(X=te.indexOf(" ",ti+1>=te.length?-1:ti+1))>-1?te.substr(0,X):te,g=te.substring(X).trim(),tr.endsWith("/")&&(tr=tr.slice(0,-1)),"src"===O){switch(tr.charCodeAt(0)){case 34:case 39:ta=!0,tr=tr.slice(1,-1)}v.isImage=!0,v.src=tr}else if("height"===O)v.imageHeight=parseInt(tr);else if("width"===O)v.imageWidth=parseInt(tr);else if("align"===O){switch(tr.charCodeAt(0)){case 34:case 39:tr=tr.slice(1,-1)}v.imageAlign=tr.toLowerCase()}else"offset"===O?v.imageOffset=tr:"click"===O&&(v.event=this._processEventHandler(O+"="+tr));v.event&&"param"===O&&(v.event[O]=tr.replace(/^"|"$/g,"")),S=BZ.exec(g)}return ta&&v.isImage&&this._resultObjectArray.push({text:"",style:v}),{}}if(S=/^(outline(\s)*[^>]*)/.exec(g)){var tu={color:"#ffffff",width:1};if(g=S[0].substring(7).trim()){var tl,tc=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(S=tc.exec(g);S;)O=(g=g.substring(g.indexOf(S[0]))).substr(0,S[0].length),tl=(X=(te=g.substring(O.length).trim()).indexOf(" "))>-1?te.substr(0,X):te,O=(O=O.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),g=te.substring(X).trim(),"click"===O?v.event=this._processEventHandler(O+"="+tl):"color"===O?tu.color=tl:"width"===O&&(tu.width=parseInt(tl)),v.event&&"param"===O&&(v.event[O]=tl.replace(/^"|"$/g,"")),S=tc.exec(g)}v.outline=tu}if((S=/^(on|u|b|i)(\s)*/.exec(g))&&S[0].length>0){switch(O=S[0],g=g.substring(O.length).trim(),O[0]){case"u":v.underline=!0;break;case"i":v.italic=!0;break;case"b":v.bold=!0}if(""===g)return v;v.event=this._processEventHandler(g)}return v},g.getRightQuotationIndex=function(g){var v=-1,S=-1,O=g.indexOf("'"),X=g.indexOf('"'),Y=X>-1&&(X<O||-1===O);return O>-1&&(O<X||-1===X)?(v=O,S=g.indexOf("'",v+1>=g.length?-1:v+1)):Y&&(v=X,S=g.indexOf('"',v+1>=g.length?-1:v+1)),S},g._processEventHandler=function(g){for(var v={},S=0,O=!1,X=BJ.exec(g);X;){var Y=X[0],te="";if(O=!1,'"'===(g=g.substring(Y.length).trim()).charAt(0))(S=g.indexOf('"',1))>-1&&(te=g.substring(1,S).trim(),O=!0),S++;else if("'"===g.charAt(0))(S=g.indexOf("'",1))>-1&&(te=g.substring(1,S).trim(),O=!0),S++;else{var ti=/(\S)+/.exec(g);S=(te=ti?ti[0]:"").length}O&&(v[Y=Y.substring(0,Y.length-1).trim()]=te),g=g.substring(S).trim(),X=BJ.exec(g)}return v},g._addToStack=function(g){var v=this._attributeToObject(g);if(0===this._stack.length)this._stack.push(v);else{if(v.isNewLine||v.isImage)return;var S=this._stack[this._stack.length-1];for(var O in S)v[O]||(v[O]=S[O]);this._stack.push(v)}},g._processResult=function(g){0!==g.length&&(g=this._escapeSpecialSymbol(g),this._stack.length>0?this._resultObjectArray.push({text:g,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:g}))},g._escapeSpecialSymbol=function(g){for(var v,S=f(this._specialSymbolArray);!(v=S()).done;){var O=v.value,X=O[0],Y=O[1];g=g.replace(X,Y)}return g},t1}()),wN=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},B$=function(){function t1(g){this.letterDefinitions={},this.texture=g}var g=t1.prototype;return g.addLetterDefinitions=function(g,v){this.letterDefinitions[g]=v},g.cloneLetterDefinition=function(){for(var g={},v=0,S=Object.keys(this.letterDefinitions);v<S.length;v++){var O=S[v],X=new wN;wt(X,this.letterDefinitions[O]),g[O]=X}return g},g.getTexture=function(){return this.texture},g.getLetter=function(g){return this.letterDefinitions[g]},g.getLetterDefinitionForChar=function(g){var v=ZF(g,0);return this.letterDefinitions.hasOwnProperty(v)?this.letterDefinitions[v]:null},g.clear=function(){this.letterDefinitions={}},t1}(),B1=g("B",(BU=nJ("cc.BitmapFont"),BH=ma(Bf),BU((BW=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).fntDataStr=BX&&BX(),v.spriteFrame=Bj&&Bj(),v.fontSize=Bq&&Bq(),v.fntConfig=BY&&BY(),v}return s(e,g),e.prototype.onLoaded=function(){var g=this.spriteFrame;!this.fontDefDictionary&&g&&(this.fontDefDictionary=new B$(g.texture));var v=this.fntConfig;if(v){var S=v.fontDefDictionary;for(var O in S){var X=new wN,Y=S[O].rect;X.offsetX=S[O].xOffset,X.offsetY=S[O].yOffset,X.w=Y.width,X.h=Y.height,X.u=Y.x,X.v=Y.y,X.textureID=0,X.valid=!0,X.xAdvance=S[O].xAdvance,this.fontDefDictionary.addLetterDefinitions(O,X)}}else G("The fnt config is not exists!")},e}(BT),BX=ws(BW.prototype,"fntDataStr",[n2],function(){return""}),Bj=ws(BW.prototype,"spriteFrame",[BH],function(){return null}),Bq=ws(BW.prototype,"fontSize",[n2],function(){return -1}),BY=ws(BW.prototype,"fntConfig",[n2],function(){return null}),Bz=BW))||Bz));X.BitmapFont=B1;var B2,B3=g("L",nJ("cc.LabelAtlas")(BK=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(B1))||BK);X.LabelAtlas=B3;var B5,B4=function(){function t1(){this.pool=[]}t1.getInstance=function(){return B2||(B2=new t1),B2};var g=t1.prototype;return g.get=function(){var g=this.pool.pop();if(!g){var v=te.document.createElement("canvas"),S=v.getContext("2d");g={canvas:v,context:S}}return g},g.put=function(g){this.pool.length>=t$.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(g)},t1}(),B8=is.WHITE.clone(),FN=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},B6="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",B7=function(){function t1(g,v){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=g,this.labelInfo=v,this.hash=""+ZF(g,0)+v.hash}var g=t1.prototype;return g.updateRenderData=function(){this._updateProperties(),this._updateTexture()},g.destroy=function(){this.image=null,B4.getInstance().put(this.data)},g._updateProperties=function(){if(this.data=B4.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){var g=this.labelInfo.fontScale;this.context.font=this.labelInfo.fontDesc;var v=KF(this.context,this.char,this.labelInfo.fontDesc),S=2*this.labelInfo.margin+2;this.width=parseFloat(v.toFixed(2))*g+S,this.height=(1+BC)*this.labelInfo.fontSize*g+S,this.offsetY=-this.labelInfo.fontSize*BC*g/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new lX),this.image.reset(this.canvas)},g._updateTexture=function(){if(this.context&&this.canvas){var g=this.context,v=this.labelInfo,S=this.canvas.width,O=this.canvas.height,X=v.fontScale;g.textAlign="center",g.textBaseline="alphabetic",g.clearRect(0,0,S,O),g.fillStyle=B6,g.fillRect(0,0,S,O),g.font=v.fontDesc.replace(/(\d+)(\.\d+)?(px|em|rem|pt)/g,function(g,v,S,O){return(+v*X+(+S||0)*X).toString()+O});var Y=v.fontSize*X,te=S/2,ti=O/2+Y*Bx+0*Y,tr=v.color;if(g.lineJoin="round",g.fillStyle="rgba("+tr.r+", "+tr.g+", "+tr.b+", 1)",v.isOutlined){var ta=v.out||B8;g.strokeStyle="rgba("+ta.r+", "+ta.g+", "+ta.b+", "+ta.a/255+")",g.lineWidth=2*v.margin*X,g.strokeText(this.char,te,ti)}g.fillText(this.char,te,ti)}},t1}(),B9=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.initWithSize=function(g,v,S){void 0===S&&(S=lb.RGBA8888),this.reset({width:g,height:v,format:S})},v.drawTextureAt=function(g,v,S){var O=this.getGFXTexture();if(g&&O){var X=this._getGFXDevice();if(X){var Y=new hg;Y.texOffset.x=v,Y.texOffset.y=S,Y.texExtent.width=g.width,Y.texExtent.height=g.height,X.copyTexImagesToTexture([g.data],O,[Y])}else N("Unable to get device")}},e}(cK),Pn=function(){function t1(g,v){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var S=new B9;S.initWithSize(g,v),this.fontDefDictionary=new B$(S),this._halfBleed=1,this._width=g,this._height=v,II.on(Iw.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var g=t1.prototype;return g.insertLetterTexture=function(g){var v=g.image,S=II.root.device;if(!v||!this.fontDefDictionary||!S)return null;var O=v.width,X=v.height;if(this._x+O+0>this._width&&(this._x=0,this._y=this._nextY),this._y+X>this._nextY&&(this._nextY=this._y+X+0),this._nextY>this._height)return q(12100),null;this.fontDefDictionary.texture.drawTextureAt(v,this._x,this._y),this._dirty=!0;var Y=new FN;return Y.u=this._x+this._halfBleed,Y.v=this._y+this._halfBleed,Y.texture=this.fontDefDictionary.texture,Y.valid=!0,Y.w=g.width-2,Y.h=g.height-2,Y.xAdvance=Y.w,Y.offsetY=g.offsetY,this._x+=O+0,this.fontDefDictionary.addLetterDefinitions(g.hash,Y),Y},g.update=function(){this._dirty&&(this._dirty=!1)},g.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},g.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},g.getTexture=function(){return this.fontDefDictionary.getTexture()},g.beforeSceneLoad=function(){this.clearAllCache()},g.clearAllCache=function(){this.destroy();var g=new B9;g.initWithSize(this._width,this._height),this.fontDefDictionary.texture=g},g.getLetter=function(g){return this.fontDefDictionary.letterDefinitions[g]},g.getLetterDefinitionForChar=function(g,v){var S=ZF(g,0)+v.hash,O=this.fontDefDictionary.letterDefinitions[S];if(!O){var X=new B7(g,v);X.updateRenderData(),O=this.insertLetterTexture(X),X.destroy()}return O},n(t1,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t1}(),Ps={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:is.WHITE.clone(),isOutlined:!1,out:is.WHITE.clone(),margin:0,fontScale:1},Pa=[new hz(hi.ATTR_POSITION,oA.RGB32F)],Po=[new hz(hi.ATTR_POSITION,oA.RGB32F),new hz(hi.ATTR_COLOR,oA.RGBA32F)],Ph=[new hz(hi.ATTR_POSITION,oA.RGB32F),new hz(hi.ATTR_TEX_COORD,oA.RG32F),new hz(hi.ATTR_COLOR,oA.RGBA32F)],Pu=[new hz(hi.ATTR_POSITION,oA.RGB32F),new hz(hi.ATTR_TEX_COORD,oA.RG32F),new hz(hi.ATTR_COLOR,oA.RGBA8,!0)],Pl=[new hz(hi.ATTR_POSITION,oA.RGB32F),new hz(hi.ATTR_TEX_COORD,oA.RG32F),new hz(hi.ATTR_COLOR,oA.RGBA32F),new hz(hi.ATTR_COLOR2,oA.RGBA32F)],Pc=[new hz(hi.ATTR_POSITION,oA.RGB32F),new hz(hi.ATTR_TEX_COORD,oA.RG32F),new hz(hi.ATTR_COLOR,oA.RGBA8,!0),new hz(hi.ATTR_COLOR2,oA.RGBA8,!0)];function qN(g){for(var v=0,S=0;S<g.length;S++){var O=g[S];v+=uf[O.format].count}return v}function KN(g){for(var v=0,S=0;S<g.length;S++){var O=g[S];v+=uf[O.format].size}return v}X.internal.vfmtPosUvColor=Ph,X.internal.vfmtPosUvTwoColor=Pl,X.internal.vfmtPosUvColor4B=Pu,X.internal.vfmtPosUvTwoColor4B=Pc,function(g){g[g.byteOffset=0]="byteOffset",g[g.vertexOffset=1]="vertexOffset",g[g.indexOffset=2]="indexOffset",g[g.dirty=3]="dirty",g[g.count=4]="count"}(B5||(B5={}));var Pf,Pd,Pp,Pm,Pg,Pv,PS=g("M",function(){var g=e.prototype;function e(){this._byteOffset=0,this._vertexOffset=0,this._indexOffset=0,this._dirty=!1,this._floatsPerVertex=0,this._vData=null,this._iData=null,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=0,this._attributes=null,this._iaPool=[],this._iaInfo=null,this._nextFreeIAHandle=0,this.initSharedBuffer(),this.syncSharedBufferToNative()}return g.initSharedBuffer=function(){},g.syncSharedBufferToNative=function(){},g.initialize=function(g,v,S,O){this._initVDataCount=S,this._initIDataCount=O,this._attributes=v,this.floatsPerVertex=KN(v)>>2,this._initVDataCount,this._floatsPerVertex,tt(9005),this.vData&&this.iData||(this.vData=new Float32Array(this._initVDataCount),this.iData=new Uint16Array(this._initIDataCount)),this._iaPool.push(this.createNewIA(g))},g.reset=function(){this._nextFreeIAHandle=0,this.dirty=!1},g.destroy=function(){this.reset(),this._attributes=null,this._iaInfo=null,this.vData=null,this.iData=null;for(var g=0;g<this._iaPool.length;++g){var v=this._iaPool[g];v.vertexBuffers[0]&&v.vertexBuffers[0].destroy(),v.indexBuffer&&v.indexBuffer.destroy(),v.ia.destroy()}this._iaPool.length=0},g.setDirty=function(){this.dirty=!0},g.request=function(){return q(9002),!1},g.requireFreeIA=function(g){return this._iaPool.length<=this._nextFreeIAHandle&&this._iaPool.push(this.createNewIA(g)),this._iaPool[this._nextFreeIAHandle++].ia},g.recycleIA=function(g){for(var v=this._iaPool,S=0;S<this._nextFreeIAHandle;++S)if(g===v[S].ia){var O=v[S];return v[S]=v[--this._nextFreeIAHandle],void(v[this._nextFreeIAHandle]=O)}},g.checkCapacity=function(g,v){var S=(this.vertexOffset+g)*this._floatsPerVertex,O=this.indexOffset+v;return!(S>this._initVDataCount||O>this._initIDataCount)},g.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var g=a3.__isWebIOS14OrIPadOS14Env,v=g?this._nextFreeIAHandle:1;if(g&&v/this._iaPool.length<.5){for(var S=v/.5,O=this._iaPool.length-1;O>=S;O--){var X=this._iaPool[O];X.vertexBuffers[0]&&X.vertexBuffers[0].destroy(),X.indexBuffer&&X.indexBuffer.destroy(),X.ia.destroy()}this._iaPool.length=S}for(var Y=this.byteOffset,te=this.indexOffset,ti=0;ti<v;++ti){var tr=this._iaPool[ti],ta=new Float32Array(this.vData.buffer,0,Y>>2),th=new Uint16Array(this.iData.buffer,0,te),tu=tr.vertexBuffers[0];Y>tu.size&&tu.resize(Y),tu.update(ta),2*te>tr.indexBuffer.size&&tr.indexBuffer.resize(2*te),tr.indexBuffer.update(th)}this.dirty=!1}},g.createNewIA=function(g){var v,S,O;if(a3.__isWebIOS14OrIPadOS14Env||!this._iaPool[0]){var X=this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT,Y=Uint16Array.BYTES_PER_ELEMENT,te=g.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,X,X));O=g.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,Y,Y)),S=[te],this._iaInfo=new hX(this._attributes,S,O),v=g.createInputAssembler(this._iaInfo)}else v=g.createInputAssembler(this._iaInfo),S=this._iaInfo.vertexBuffers,O=this._iaInfo.indexBuffer;return{ia:v,vertexBuffers:S,indexBuffer:O}},n(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"byteOffset",get:function(){return this._byteOffset},set:function(g){this._byteOffset=g}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(g){this._vertexOffset=g}},{key:"indexOffset",get:function(){return this._indexOffset},set:function(g){this._indexOffset=g}},{key:"dirty",get:function(){return this._dirty},set:function(g){this._dirty=g}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex},set:function(g){this._floatsPerVertex=g}},{key:"vData",get:function(){return this._vData},set:function(g){this._vData=g}},{key:"iData",get:function(){return this._iData},set:function(g){this._iData=g}},{key:"nativeObj",get:function(){return this._nativeObj}},{key:"sharedBuffer",get:function(){return this._sharedBuffer}}]),e}()),PA=function(){function t1(g,v){this._device=null,this._attributes=null,this._vertexFormatBytes=void 0,this._floatsPerVertex=void 0,this._buffers=[],this._device=g,this._attributes=v,this._floatsPerVertex=KN(v)>>2,this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT}var g=t1.prototype;return g.initialize=function(){},g.reset=function(){},g.request=function(){},g.appendBuffers=function(){},g.uploadBuffers=function(){},g.destroy=function(){this._attributes.length=0},n(t1,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t1}(),PT=new ad(function(){return{offset:0,length:0}},32),PE=function(){function t1(g,v,S,O,X,Y){this._ib=void 0,this.vertexAccessor=g,this.bufferId=v,this.meshBuffer=S,this.vertexOffset=O,this.vb=X,this.indexCount=Y,this._ib=new Uint16Array(Y),g.getMeshBuffer(v)}return t1.prototype.setIndexBuffer=function(){},n(t1,[{key:"ib",get:function(){return this._ib}}]),t1}(),PC=function(g){function e(v,S,O,X){var Y;return(Y=g.call(this,v,S)||this)._freeLists=[],Y._vCount=0,Y._iCount=0,Y._id=0,Y._vCount=O||Math.floor(1024*t$.BATCHER2D_MEM_INCREMENT/Y._vertexFormatBytes),Y._iCount=X||Y._vCount*e.IB_SCALE,Y._id=e.generateID(),Y._allocateBuffer(),Y}s(e,g);var v=e.prototype;return v.destroy=function(){for(var v=0;v<this._buffers.length;++v){this._buffers[v].destroy();for(var S=this._freeLists[v],O=0;O<S.length;++O)PT.free(S[O])}this._buffers.length=0,this._freeLists.length=0,g.prototype.destroy.call(this)},v.reset=function(){for(var g=0;g<this._buffers.length;++g){var v=this._buffers[g];v.indexOffset=0,v.reset()}},v.getVertexBuffer=function(g){return this._buffers[g].vData},v.getIndexBuffer=function(g){return this._buffers[g].iData},v.getMeshBuffer=function(g){return this._buffers[g]},v.uploadBuffers=function(){for(var g=0;g<this._buffers.length;++g){var v=this._freeLists[g][0],S=this._buffers[g];(!v||v.length<S.vData.byteLength)&&S.uploadBuffers()}},v.appendIndices=function(g,v){var S=this._buffers[g];if(v.length){var O=S.indexOffset+v.length;if(S.iData.length<O){var X=Math.floor(1.25*O),Y=new Uint16Array(X);Y.set(S.iData),S.iData=Y}S.iData.set(v,S.indexOffset),S.indexOffset+=v.length}},v.allocateChunk=function(g,v){var S=g*this.vertexFormatBytes;if(g>this._vCount||v>this._iCount)return J(9004,S),null;for(var O,X=null,Y=0,te=-1,ti=null,tr=0;tr<this._buffers.length;++tr){X=this._buffers[tr],O=this._freeLists[tr];for(var ta=0;ta<O.length;++ta)if(O[ta].length>=S){ti=O[ta],Y=tr,te=ta;break}if(ti)break}if(ti||(Y=this._allocateBuffer(),(X=this._buffers[Y])&&(te=0,ti=this._freeLists[Y][te])),ti){var th=ti.offset/this.vertexFormatBytes,tu=new Float32Array(X.vData.buffer,ti.offset,S>>2).fill(0);return this._allocateChunkFromEntry(Y,te,ti,S),new PE(this,Y,X,th,tu,v)}return null},v.recycleChunk=function(g){var v=this._freeLists[g.bufferId],S=this._buffers[g.bufferId],O=g.vertexOffset*this.vertexFormatBytes,X=g.vb.byteLength;if(0!==X){for(var Y=!1,te=0,ti=null,tr=v[te];tr&&tr.offset<O;)ti=tr,tr=v[++te];if(ti&&0==O-(ti.offset+ti.length)&&(ti.length+=X,O=ti.offset,X=ti.length,tr&&tr.offset-(O+X)==0&&(ti.length+=tr.length,v.splice(te,1),PT.free(tr),tr=null),Y=!0),!Y&&tr){if(0==tr.offset-(O+X))tr.offset=O,tr.length+=X;else{var ta=PT.alloc();ta.offset=O,ta.length=X,v.splice(te,0,ta)}Y=!0}if(Y)O+X===S.byteOffset&&(S.byteOffset=O);else{var th=PT.alloc();th.offset=O,th.length=X,v.push(th)}}},v._allocateChunkFromEntry=function(g,v,S,O){var X=S.length-O,Y=S.offset+O,te=this._buffers[g];te.byteOffset<Y&&(te.byteOffset=Y),$(X>=0,9004,g,S.offset,S.length),0===X?(this._freeLists[g].splice(v,1),PT.free(S)):(S.offset+=O,S.length=X)},v._allocateBuffer=function(){$(this._buffers.length===this._freeLists.length,9003);var g=new PS,v=this._vCount*this._floatsPerVertex;g.initialize(this._device,this._attributes,v,this._iCount),this._buffers.push(g);var S=PT.alloc();S.offset=0,S.length=g.vData.byteLength;var O=[S];return this._freeLists.push(O),II.root.batcher2D.syncMeshBuffersToNative(this.id,this._buffers),this._buffers.length-1},e.generateID=function(){return e.ID_COUNT++},n(e,[{key:"id",get:function(){return this._id}}]),e}(PA);PC.IB_SCALE=4,PC.ID_COUNT=0,function(g){g[g.DrawInfoType=0]="DrawInfoType",g[g.VertDirty=1]="VertDirty",g[g.IsMeshBuffer=2]="IsMeshBuffer",g[g.Stride=3]="Stride",g[g.Count=4]="Count"}(Pf||(Pf={})),function(g){g[g.BufferID=0]="BufferID",g[g.AccessorID=1]="AccessorID",g[g.Count=2]="Count"}(Pd||(Pd={})),function(g){g[g.VertexOffset=0]="VertexOffset",g[g.IndexOffset=1]="IndexOffset",g[g.VBCount=2]="VBCount",g[g.IBCount=3]="IBCount",g[g.DataHash=4]="DataHash",g[g.Count=5]="Count"}(Pp||(Pp={})),function(g){g[g.COMP=0]="COMP",g[g.MODEL=1]="MODEL",g[g.MIDDLEWARE=2]="MIDDLEWARE",g[g.SUB_NODE=3]="SUB_NODE"}(Pm||(Pm={})),function(){function t1(g){this._accId=-1,this._bufferId=-1,this._vertexOffset=0,this._indexOffset=0,this._vb=null,this._ib=null,this._vData=null,this._iData=null,this._vertDirty=!1,this._vbCount=0,this._ibCount=0,this._dataHash=0,this._isMeshBuffer=!1,this._material=null,this._texture=null,this._sampler=null,this._stride=0,this._useLocal=!1,this._model=null,this._drawInfoType=Pm.COMP,this._subNode=null,this._uint8SharedBuffer=void 0,this._uint16SharedBuffer=void 0,this._uint32SharedBuffer=void 0,this.init(g);var v=this._nativeObj.getAttrSharedBufferForJS(),S=0;this._uint8SharedBuffer=new Uint8Array(v,S,Pf.Count),S+=Pf.Count*Uint8Array.BYTES_PER_ELEMENT,this._uint16SharedBuffer=new Uint16Array(v,S,Pd.Count),S+=Pd.Count*Uint16Array.BYTES_PER_ELEMENT,this._uint32SharedBuffer=new Uint32Array(v,S,Pp.Count)}var g=t1.prototype;g.init=function(){},g.clear=function(){this._bufferId=0,this._vertexOffset=0,this._indexOffset=0,this._vertDirty=!1},g.setAccId=function(g){this._accId=g},g.setBufferId=function(g){this._bufferId=g},g.setAccAndBuffer=function(g,v){this._bufferId=v,this._accId=g},g.setVertexOffset=function(g){this._vertexOffset=g},g.setIndexOffset=function(g){this._indexOffset=g},g.setVB=function(){},g.setIB=function(){},g.setVData=function(){},g.setIData=function(){},g.setVBCount=function(g){this._vbCount=g},g.setIBCount=function(){},g.setVertDirty=function(g){this._vertDirty=g},g.setDataHash=function(g){this._dataHash=g},g.setIsMeshBuffer=function(g){this._isMeshBuffer=g},g.setMaterial=function(g){this._material=g},g.setTexture=function(g){this._texture=g},g.setSampler=function(g){this._sampler=g},g.setModel=function(){},g.setDrawInfoType=function(g){this._drawInfoType=g},g.setSubNode=function(g){this._subNode=g},g.setStride=function(g){this._stride=g},g.initRender2dBuffer=function(){},g.fillRender2dBuffer=function(){},n(t1,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"render2dBuffer",get:function(){return this._render2dBuffer}}])}(),function(g){g[g.DISABLED=0]="DISABLED",g[g.CLEAR=1]="CLEAR",g[g.ENTER_LEVEL=2]="ENTER_LEVEL",g[g.ENABLED=3]="ENABLED",g[g.EXIT_LEVEL=4]="EXIT_LEVEL",g[g.CLEAR_INVERTED=5]="CLEAR_INVERTED",g[g.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(Pg||(Pg={})),function(g){g[g.stencilTest=0]="stencilTest",g[g.func=1]="func",g[g.stencilMask=2]="stencilMask",g[g.writeMask=3]="writeMask",g[g.failOp=4]="failOp",g[g.zFailOp=5]="zFailOp",g[g.passOp=6]="passOp",g[g.ref=7]="ref",g[g.count=8]="count"}(Pv||(Pv={}));var Px,Pb,PR,Pw,PI,PB=g("S",function(){function t1(){this._maskStack=[],this._stencilPattern={stencilTest:!0,func:oF.ALWAYS,stencilMask:65535,writeMask:65535,failOp:oN.KEEP,zFailOp:oN.KEEP,passOp:oN.KEEP,ref:1},this._stage=Pg.DISABLED,this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var g=t1.prototype;return g.pushMask=function(g){this._maskStack.push(g)},g.clear=function(g){return g.stencilStage!==Pg.ENTER_LEVEL?Pg.CLEAR_INVERTED:Pg.CLEAR},g.enableMask=function(){this.stage=Pg.ENABLED},g.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=Pg.DISABLED:this.stage=Pg.ENABLED)},g.getWriteMask=function(){return 1<<this._maskStack.length-1},g.getExitWriteMask=function(){return 1<<this._maskStack.length},g.getStencilRef=function(){for(var g=0,v=0;v<this._maskStack.length;++v)g+=1<<v;return g},g.getMaskStackSize=function(){return this._maskStack.length},g.reset=function(){this._maskStack.length=0,this.stage=Pg.DISABLED},g.destroy=function(){this.stencilStateMap.forEach(function(g){g.destroy()}),this.stencilStateMap.clear()},g.getStencilStage=function(g,v){var S=0,O=!1,X=!1,Y=oF.LESS,te=this.stencilStateMap;if(v&&v.passes[0]){var ti=v.passes[0].depthStencilState,tr=0,ta=0;ti.depthTest&&(tr=1),ti.depthWrite&&(ta=1),S=tr|ta<<1|ti.depthFunc<<2|g<<6|this._maskStack.length<<9,O=ti.depthTest,X=ti.depthWrite,Y=ti.depthFunc,te=this.stencilStateMapWithDepth}else S=g<<16|this._maskStack.length;if(te&&te.has(S))return te.get(S);this.setStateFromStage(g);var th=new uL(O,X,Y,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return te.set(S,th),th},g.getStencilHash=function(g){return g<<8|this._maskStack.length},g.setStateFromStage=function(g){var v=this._stencilPattern;g===Pg.DISABLED?(v.stencilTest=!1,v.func=oF.ALWAYS,v.failOp=oN.KEEP,v.stencilMask=v.writeMask=65535,v.ref=1):(v.stencilTest=!0,g===Pg.ENABLED?(v.func=oF.EQUAL,v.failOp=oN.KEEP,v.stencilMask=v.ref=this.getStencilRef(),v.writeMask=this.getWriteMask()):g===Pg.CLEAR?(v.func=oF.NEVER,v.failOp=oN.ZERO,v.writeMask=v.stencilMask=v.ref=this.getWriteMask()):g===Pg.CLEAR_INVERTED||g===Pg.ENTER_LEVEL?(v.func=oF.NEVER,v.failOp=oN.REPLACE,v.writeMask=v.stencilMask=v.ref=this.getWriteMask()):g===Pg.ENTER_LEVEL_INVERTED&&(v.func=oF.NEVER,v.failOp=oN.ZERO,v.writeMask=v.stencilMask=v.ref=this.getWriteMask()))},n(t1,[{key:"stage",get:function(){return this._stage},set:function(g){this._stage=g}},{key:"pattern",get:function(){return this._stencilPattern}}]),t1}());PB.sharedManager=null,PB.sharedManager=new PB,function(g){g[g.STATIC=0]="STATIC",g[g.DYNAMIC=1]="DYNAMIC",g[g.CROSSED=2]="CROSSED"}(Px||(Px={})),function(g){g[g.localOpacity=0]="localOpacity",g[g.count=1]="count"}(Pb||(Pb={})),function(g){g[g.colorR=0]="colorR",g[g.colorG=1]="colorG",g[g.colorB=2]="colorB",g[g.colorA=3]="colorA",g[g.maskMode=4]="maskMode",g[g.count=5]="count"}(PR||(PR={})),function(g){g[g.colorDirty=0]="colorDirty",g[g.enabled=1]="enabled",g[g.useLocal=2]="useLocal",g[g.count=3]="count"}(Pw||(Pw={})),function(g){g[g.NONE=0]="NONE",g[g.MASK=1]="MASK",g[g.MASK_INVERTED=2]="MASK_INVERTED",g[g.MASK_NODE=3]="MASK_NODE",g[g.MASK_NODE_INVERTED=4]="MASK_NODE_INVERTED"}(PI||(PI={}));var PP,PD,PM,PO,PL,PF,PN,Pk,PG,PV,PU,PH=function(){function t1(){this._renderEntityType=Px.STATIC,this._dynamicDrawInfoArr=[],this._node=null,this._renderTransform=null,this._stencilStage=Pg.DISABLED,this._useLocal=!1,this._maskMode=PI.NONE,this._color=is.WHITE,this._localOpacity=255,this._colorDirty=!0,this._enabled=!1}var g=t1.prototype;return g.addDynamicRenderDrawInfo=function(){},g.removeDynamicRenderDrawInfo=function(){},g.clearDynamicRenderDrawInfos=function(){},g.clearStaticRenderDrawInfos=function(){},g.setDynamicRenderDrawInfo=function(){},g.setMaskMode=function(g){this._maskMode=g},g.getStaticRenderDrawInfo=function(){return null},g.setNode=function(g){this._node=g},g.setRenderTransform=function(g){this._renderTransform=g},g.setStencilStage=function(g){this._stencilStage=g},g.setUseLocal=function(g){this._useLocal=g},g.initSharedBuffer=function(){},n(t1,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"renderDrawInfoArr",get:function(){return this._dynamicDrawInfoArr}},{key:"renderEntityType",get:function(){return this._renderEntityType}},{key:"color",get:function(){return this._color},set:function(g){this._color=g}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(g){this._localOpacity=g}},{key:"colorDirty",get:function(){return this._colorDirty},set:function(g){this._colorDirty=g}},{key:"enabled",get:function(){return this._enabled},set:function(g){this._enabled=g}}]),t1}(),Pz=KN(Ph)>>2,PW=g("r",function(){function t1(g){void 0===g&&(g=Ph),this.chunk=null,this._renderDrawInfo=null,this._material=null,this._dataHash=0,this._isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=Ph,this._drawInfoType=Pm.COMP,this._multiOwner=!1,this._batcher=null,this._floatStride=g===Ph?Pz:KN(g)>>2,this._vertexFormat=g}var g=t1.prototype;return g.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},g.initRenderDrawInfo=function(g,v){void 0===v&&(v=Pm.COMP)},g.removeRenderDrawInfo=function(){},g.setRenderDrawInfoAttributes=function(){},n(t1,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}},{key:"drawInfoType",get:function(){return this._drawInfoType},set:function(g){this._drawInfoType=g,this._renderDrawInfo&&this._renderDrawInfo.setDrawInfoType(g)}},{key:"renderDrawInfo",get:function(){return this._renderDrawInfo}},{key:"material",get:function(){return this._material},set:function(g){this._material=g,this._renderDrawInfo&&this._renderDrawInfo.setMaterial(g)}},{key:"dataHash",get:function(){return this._dataHash},set:function(g){this._dataHash=g,this._renderDrawInfo&&this._renderDrawInfo.setDataHash(g)}},{key:"multiOwner",get:function(){return this._multiOwner},set:function(g){this._multiOwner=g}},{key:"batcher",get:function(){return this._batcher||(this._batcher=II.root.batcher2D),this._batcher}}]),t1}()),PX=g("t",function(g){function e(v,S){var O;return void 0===v&&(v=Ph),(O=g.call(this,v)||this)._vertDirty=!0,O._textureHash=0,O.indices=null,O.layer=0,O.nodeDirty=!0,O.passDirty=!0,O.textureDirty=!0,O.hashDirty=!0,O._data=[],O._frame=null,O._accessor=null,O.vertexRow=1,O.vertexCol=1,S||(S=O.batcher.switchBufferAccessor(O._vertexFormat)),O._accessor=S,O}s(e,g),e.add=function(g,v){void 0===g&&(g=Ph);var S=new e(g,v);return v||(v=II.root.batcher2D.switchBufferAccessor(S._vertexFormat)),S._accessor=v,S},e.remove=function(g){g.clear(),g._accessor=null};var v=e.prototype;return v.resize=function(g,v){g===this._vc&&v===this._ic&&this.chunk||(this._vc=g,this._ic=v,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(g,v),this.updateHash())},v.setRenderDrawInfoAttributes=function(){},v.fillDrawInfoAttributes=function(){},v.syncRender2dBuffer=function(){},v.resizeAndCopy=function(g,v){if(g!==this._vc||v!==this._ic||!this.chunk){this._vc=g,this._ic=v;var S=this.chunk;this.chunk=this._accessor.allocateChunk(g,v),S&&(this.chunk.vb.set(S.vb),this._accessor.recycleChunk(S)),this.updateHash()}},v.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},v.updateNode=function(g){this.layer=g.node.layer,this.nodeDirty=!1,this.hashDirty=!0},v.updatePass=function(g){this.material=g.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0},v.updateTexture=function(g){this.frame=g,this.textureHash=g.getHash(),this.textureDirty=!1,this.hashDirty=!0},v.updateHash=function(){var g=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.textureHash;this.dataHash=Sl(g,666),this.hashDirty=!1},v.updateRenderData=function(g,v){if(this.passDirty&&(this.material=g.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0,this._renderDrawInfo&&this._renderDrawInfo.setMaterial(this.material)),this.nodeDirty){var S=g.node.scene?g._getRenderScene():null;this.layer=g.node.layer,null!==S&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=v,this.textureHash=v.getHash(),this.textureDirty=!1,this.hashDirty=!0,this._renderDrawInfo&&(this._renderDrawInfo.setTexture(this.frame?this.frame.getGFXTexture():null),this._renderDrawInfo.setSampler(this.frame?this.frame.getGFXSampler():null))),this.hashDirty&&(this.updateHash(),this._renderDrawInfo&&this._renderDrawInfo.setDataHash(this.dataHash))},v.clear=function(){this.resize(0,0),this._data.length=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.frame=null,this.textureHash=0,this.dataHash=0},e.createStaticVBAccessor=function(g,v,S){var O=II.root.device;return new PC(O,g,v,S)},n(e,[{key:"dataLength",get:function(){return this._data.length},set:function(g){var v=this._data;if(v.length!==g){for(var S=v.length;S<g;S++)v.push({x:0,y:0,z:0,u:0,v:0,color:is.WHITE.clone()});v.length=g}this.syncRender2dBuffer()}},{key:"data",get:function(){return this._data}},{key:"vertDirty",get:function(){return this._vertDirty},set:function(g){this._vertDirty=g,this._renderDrawInfo&&g&&this._renderDrawInfo.setVertDirty(g)}},{key:"textureHash",get:function(){return this._textureHash},set:function(g){this._textureHash=g}},{key:"frame",get:function(){return this._frame},set:function(g){this._frame=g,this._renderDrawInfo&&(this._frame?(this._renderDrawInfo.setTexture(this._frame.getGFXTexture()),this._renderDrawInfo.setSampler(this._frame.getGFXSampler())):(this._renderDrawInfo.setTexture(null),this._renderDrawInfo.setSampler(null)))}},{key:"accessor",get:function(){return this._accessor}}]),e}(PW)),Pj=g("u",function(g){function e(v){var S;return void 0===v&&(v=Ph),(S=g.call(this,v)||this)._isMeshBuffer=!0,S.vData=void 0,S.iData=void 0,S.vertexStart=0,S.vertexRange=0,S.indexStart=0,S.indexRange=0,S.lastFilledIndex=0,S.lastFilledVertex=0,S.frame=void 0,S._byteLength=0,S._vertexBuffers=[],S._indexBuffer=null,S._iaPool=null,S._iaInfo=null,S.vData=new Float32Array(256*S.stride),S.iData=new Uint16Array(1536),S}s(e,g),e.add=function(g){void 0===g&&(g=Ph);var v=new e;return v._floatStride=g===Ph?Pz:KN(g)>>2,v._vertexFormat=g,v},e.remove=function(g){g.clear()};var v=e.prototype;return v.request=function(g,v){var S=this._byteLength+g*this.stride;return!!this.reserve(g,v)&&(this._vc+=g,this._ic+=v,this._byteLength=S,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},v.reserve=function(g,v){var S=this._byteLength+g*this.stride,O=this.indexCount+v;if(g+this.vertexCount>65535)return!1;var X=this.vData.byteLength,Y=this.iData.length,te=this.vData.length,ti=this.iData.length;if(S>X||O>Y){for(;X<S||Y<O;)X=4*(te*=2),Y=ti*=2;this._reallocBuffer(te,ti)}return!0},v.resize=function(g,v){var S=g*this.stride;g>=0&&v>=0&&S<=this.vData.byteLength&&this.iData.length,this._vc=g,this._ic=v,this._byteLength=S,this.updateRange(0,g,0,v)},v.updateRange=function(g,v,S,O){v>=0&&O>=0&&v<=this._vc&&this._ic,this.vertexStart=g,this.indexStart=S,this.vertexRange=v,this.indexRange=O},v.requestIA=function(g){this._initIAInfo(g);var v=this._iaPool.add();return v.firstIndex=this.indexStart,v.indexCount=this.indexRange,v},v.uploadBuffers=function(){if(0!==this._byteLength&&this._vertexBuffers[0]&&this._indexBuffer){var g=this._ic,v=new Float32Array(this.vData.buffer,0,this._byteLength>>2),S=new Uint16Array(this.iData.buffer,0,g),O=this._vertexBuffers[0];this._byteLength>O.size&&O.resize(this._byteLength),O.update(v);var X=g<<1;X>this._indexBuffer.size&&this._indexBuffer.resize(X),this._indexBuffer.update(S)}},v.freeIAPool=function(){this._iaPool&&this._iaPool.reset()},v.reset=function(){this._vc=0,this._ic=0,this._byteLength=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},v.clear=function(){this.reset(),this._iaPool&&this._iaPool.destroy(),this._vertexBuffers[0]&&(this._vertexBuffers[0].destroy(),this._vertexBuffers=[]),this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},v._initIAInfo=function(g){var v=this;if(!this._iaInfo){var S=this.stride,O=this._vertexBuffers;O.length||O.push(g.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,S,S)));var X=Uint16Array.BYTES_PER_ELEMENT;this._indexBuffer||(this._indexBuffer=g.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.DEVICE,X,X))),this._iaInfo=new hX(this._vertexFormat,O,this._indexBuffer),this._iaPool=new ap(function(){return g.createInputAssembler(v._iaInfo)},1,function(g){g.destroy()})}},v._reallocBuffer=function(g,v){var S=this.vData;this.vData=new Float32Array(g),S&&this.vData.set(S,0);var O=this.iData;this.iData=new Uint16Array(v),O&&this.iData.set(O,0)},v.setRenderDrawInfoAttributes=function(){},v.particleInitRenderDrawInfo=function(){},n(e,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this._byteLength>>>2}}]),e}(PW)),Pq=new e8,PY=new e8,PK=new eL,PJ=new e$,PQ=new e$,P$=new e$,P0=new e$(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),P1=new ic,P2=g("d",nJ("cc.UITransform")(PP=nQ(110)(PP=n0(((PL=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._priority=0,v._contentSize=PM&&PM(),v._anchorPoint=PO&&PO(),v}s(e,g);var v=e.prototype;return v.__preload=function(){this.node._uiProps.uiTransformComp=this},v.onLoad=function(){this.node.parent&&e.insertChangeMap(this.node.parent)},v.onEnable=function(){this.node.on(md.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},v.onDisable=function(){this.node.off(md.PARENT_CHANGED,this._parentChanged,this)},v.onDestroy=function(){this.node._uiProps.uiTransformComp=null},v.setContentSize=function(g,v){var S,O,X=this._contentSize;if(void 0===v){if(pi(g.width,X.width,ex)&&pi(g.height,X.height,ex))return;S=g.width,O=g.height}else{if(pi(g,X.width,ex)&&pi(v,X.height,ex))return;S=g,O=v}X.width=S,X.height=O,this.node.emit(md.SIZE_CHANGED),this._markRenderDataDirty()},v.setAnchorPoint=function(g,v){var S=this._anchorPoint;if(void 0===v){if(g.x===S.x&&g.y===S.y)return;S.x=g.x,S.y=g.y}else{if(g===S.x&&v===S.y)return;S.x=g,S.y=v}this.node.emit(md.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},v.isHit=function(g){for(var v=this._contentSize.width,S=this._contentSize.height,O=Pq,X=PY,Y=this._getRenderScene().cameras,te=0;te<Y.length;te++){var ti=Y[te];if(ti.visibility&this.node.layer){ti.node.getWorldRT(PJ);var tr=PJ.m12,ta=PJ.m13,th=a4.center;if(PJ.m12=th.x-(PJ.m00*tr+PJ.m04*ta),PJ.m13=th.y-(PJ.m01*tr+PJ.m05*ta),e$.invert(PJ,PJ),e8.transformMat4(O,g,PJ),this.node.getWorldMatrix(P$),e$.invert(PJ,P$),!e$.strictEquals(PJ,P0)){e8.transformMat4(X,O,PJ),X.x+=this._anchorPoint.x*v,X.y+=this._anchorPoint.y*S;var tu=!1;if(X.x>=0&&X.y>=0&&X.x<=v&&X.y<=S&&(tu=this._maskTest(O)),tu)return!0}}}return!1},v.hitTest=function(g,v){void 0===v&&(v=0);for(var S=this._contentSize.width,O=this._contentSize.height,X=PK,Y=Pq,te=PY,ti=this._getRenderScene().cameras,tr=0;tr<ti.length;tr++){var ta=ti[tr];if(ta.visibility&this.node.layer&&(!ta.window||ta.window.swapchain)&&ta.systemWindowId===v&&(eL.set(X,g.x,g.y,0),ta.screenToWorld(X,X),e8.set(Y,X.x,X.y),this.node.getWorldMatrix(P$),e$.invert(PJ,P$),!e$.strictEquals(PJ,P0))){e8.transformMat4(te,Y,PJ),te.x+=this._anchorPoint.x*S,te.y+=this._anchorPoint.y*O;var th=!1;if(te.x>=0&&te.y>=0&&te.x<=S&&te.y<=O&&(th=this._maskTest(Y)),th)return!0}}return!1},v._maskTest=function(g){var v,S,O=null===(v=this.node)||void 0===v||null===(S=v.eventProcessor)||void 0===S?void 0:S.maskList;if(O)for(var X=this.node,Y=O.length,te=0,ti=0;X&&ti<Y;++te,X=X.parent){var tr=O[ti];if(te===tr.index){if(X!==tr.comp.node){O.length=ti;break}var ta=tr.comp;if(ta&&ta._enabled&&!ta.isHit(g))return!1;ti++}else if(te>tr.index){O.length=ti;break}}return!0},v.convertToNodeSpaceAR=function(g,v){return this.node.getWorldMatrix(P$),e$.invert(PJ,P$),v||(v=new eL),eL.transformMat4(v,g,PJ)},v.convertToWorldSpaceAR=function(g,v){return this.node.getWorldMatrix(P$),v||(v=new eL),eL.transformMat4(v,g,P$)},v.getBoundingBox=function(){var g=new ic;return this._selfBoundingBox(g),e$.fromSRT(PQ,this.node.rotation,this.node.position,this.node.scale),g.transformMat4(PQ),g},v.getBoundingBoxToWorld=function(){for(var g=new ic,v=this.node.children,S=0;S<v.length;++S){var O=v[S];if(O&&O.active){var X=O.getComponent(e);X&&X.contentSize.width&&X.contentSize.height&&(X._selfBoundingBox(P1),P1.transformMat4(O.worldMatrix),0===g.width?g.set(P1):ic.union(g,g,P1))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(P1),P1.transformMat4(this.node.worldMatrix),0===g.width?g.set(P1):ic.union(g,g,P1)),g},v.getBoundingBoxTo=function(g){var v=new ic,S=this.node.children;e$.invert(PJ,g);for(var O=0;O<S.length;++O){var X=S[O];if(X&&X.active){var Y=X.getComponent(e);Y&&Y.contentSize.width&&Y.contentSize.height&&(Y._selfBoundingBox(P1),e$.multiply(PQ,X.worldMatrix,PJ),P1.transformMat4(PQ),0===v.width?v.set(P1):ic.union(v,v,P1))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(P1),e$.multiply(PQ,this.node.worldMatrix,PJ),P1.transformMat4(PQ),0===v.width?v.set(P1):ic.union(v,v,P1)),v},v.getComputeAABB=function(g){var v=this._contentSize.width,S=this._contentSize.height;P1.set(-this._anchorPoint.x*v,-this._anchorPoint.y*S,v,S),P1.transformMat4(this.node.worldMatrix);var O=P1.x+.5*P1.width,X=P1.y+.5*P1.height,Y=this.node.worldPosition.z,te=P1.width/2,ti=P1.height/2;return null!=g?(iK.set(g,O,X,Y,te,ti,.001),g):new iK(O,X,Y,te,ti,.001)},v._selfBoundingBox=function(g){var v=this._contentSize.width,S=this._contentSize.height;return g.set(-this._anchorPoint.x*v,-this._anchorPoint.y*S,v,S),g},v._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&e.insertChangeMap(this.node.parent)},v._markRenderDataDirty=function(){var g=this.node._uiProps.uiComp;g&&g.markForUpdateRenderData()},e.insertChangeMap=function(g){var v=g.uuid;e.priorityChangeNodeMap.has(v)||e.priorityChangeNodeMap.set(v,g)},e._sortChildrenSibling=function(g){var v=g.children;v&&v.sort(function(g,v){var S=g._uiProps.uiTransformComp,O=v._uiProps.uiTransformComp,X=(S?S._priority:0)-(O?O._priority:0);return 0===X?g.getSiblingIndex()-v.getSiblingIndex():X})},e._sortSiblings=function(){e.priorityChangeNodeMap.forEach(function(g){e._sortChildrenSibling(g),g._updateSiblingIndex(),g.emit("childrenSiblingOrderChanged")}),e.priorityChangeNodeMap.clear()},e._cleanChangeMap=function(){e.priorityChangeNodeMap.clear()},n(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(g){this._contentSize.equals(g)||(this._contentSize.set(g),this.node.emit(md.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(g){this._contentSize.width!==g&&(this._contentSize.width=g,this.node.emit(md.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(g){this.contentSize.height!==g&&(this._contentSize.height=g,this.node.emit(md.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(g){this._anchorPoint.equals(g)||(this._anchorPoint.set(g),this.node.emit(md.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(g){this._anchorPoint.x!==g&&(this._anchorPoint.x=g,this.node.emit(md.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(g){this._anchorPoint.y!==g&&(this._anchorPoint.y=g,this.node.emit(md.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(g){this._priority!==g&&(this.node.getComponent("cc.RenderRoot2D")?q(6706):(this._priority=g,this.node.parent&&e.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var g=II.root.batcher2D.getFirstRenderCamera(this.node);return g?g.visibility:0}},{key:"cameraPriority",get:function(){var g=II.root.batcher2D.getFirstRenderCamera(this.node);return g?g.priority:0}}]),e}(cS)).EventType=md,PL.priorityChangeNodeMap=new Map,PM=ws((PD=PL).prototype,"_contentSize",[n2],function(){return new iu(100,100)}),PO=ws(PD.prototype,"_anchorPoint",[n2],function(){return new e8(.5,.5)}),PP=PD))||PP)||PP)||PP);II.on(Iw.EVENT_AFTER_UPDATE,P2._sortSiblings),II.on(Iw.EVENT_BEFORE_SCENE_LAUNCH,P2._cleanChangeMap);var P3,P5,P4,P8,P6,P7,P9,Dr,Da,Dh,Du,Dl,Dc,Df={parent:null,owner:null,subModelIdx:0},Dd=n0,Dp=ma,Dm=g("dE",(PF=nJ("cc.Renderer"),PN=Dp(pf),Pk=Dp([pf]),PF(PG=Dd((p((PV=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._materials=PU&&PU(),v._materialInstances=[],v}s(e,g);var v=e.prototype;return v.getMaterial=function(g){return this.getSharedMaterial(g)},v.setMaterial=function(g,v){this.setSharedMaterial(g,v)},v.getSharedMaterial=function(g){return g<0||g>=this._materials.length?null:this._materials[g]},v.setSharedMaterial=function(g,v){g&&_instanceof(g,m0)&&J(12012),this._materials[v]=g;var S=this._materialInstances[v];S&&(S.destroy(),this._materialInstances[v]=null),this._onMaterialModified(v,this._materials[v])},v.getMaterialInstance=function(g){if(!this._materials[g])return null;if(!this._materialInstances[g]){Df.parent=this._materials[g],Df.owner=this,Df.subModelIdx=g;var v=new m0(Df);Df.parent=null,Df.owner=null,Df.subModelIdx=0,this.setMaterialInstance(v,g)}return this._materialInstances[g]},v.setMaterialInstance=function(g,v){if("number"==typeof g){q(12007);var S=g;g=v,v=S}var O=this._materialInstances[v];g&&g.parent?g!==O&&(this._materialInstances[v]=g,this._onMaterialModified(v,g)):(g!==this._materials[v]||O)&&this.setSharedMaterial(g,v)},v.getRenderMaterial=function(g){return this._materialInstances[g]||this._materials[g]},v._onMaterialModified=function(){},v._onRebuildPSO=function(){},v._clearMaterials=function(){},n(e,[{key:"sharedMaterial",get:function(){return this.getSharedMaterial(0)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(g){for(var v=0;v<g.length;v++)g[v]!==this._materials[v]&&this.setSharedMaterial(g[v],v);if(g.length<this._materials.length){for(var S=g.length;S<this._materials.length;S++)this.setSharedMaterial(null,S);this._materials.splice(g.length)}}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(g){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==g)&&this.setMaterialInstance(g,0)}},{key:"materials",get:function(){for(var g=0;g<this._materials.length;g++)this._materialInstances[g]=this.getMaterialInstance(g);return this._materialInstances},set:function(g){for(var v=g.length,S=this._materials.length,O=v;O<S;O++)this.setMaterialInstance(null,O);this._materials.length=v,this._materialInstances.length=v;for(var X=0;X<v;X++)this._materialInstances[X]!=g[X]&&this.setMaterialInstance(g[X],X)}}]),e}(cS)).prototype,"sharedMaterials",[PN],Object.getOwnPropertyDescriptor(PV.prototype,"sharedMaterials"),PV.prototype),PU=ws(PV.prototype,"_materials",[Pk],function(){return[]}),PG=PV))||PG)||PG));oe(ok),oe(oG),oe(oV),g("I",Dc),function(g){g[g.ADD_COLOR=0]="ADD_COLOR",g[g.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",g[g.GRAYSCALE=2]="GRAYSCALE",g[g.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",g[g.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(Dc||g("I",Dc={}));var Dg=g("c",(P3=nJ("cc.UIRenderer"),P5=nZ(P2),P4=ma(pf),P8=ma(pf),P3(P6=P5(((Dl=function(g){function e(){var v;return(v=g.call(this)||this)._renderData=null,v._materials=P9&&P9(),v._customMaterial=Dr&&Dr(),v._srcBlendFactor=Da&&Da(),v._dstBlendFactor=Dh&&Dh(),v._color=Du&&Du(),v._stencilStage=Pg.DISABLED,v._assembler=null,v._postAssembler=null,v._renderDataFlag=!0,v._renderFlag=!0,v._renderEntity=void 0,v._instanceMaterialType=-1,v._srcBlendFactorCache=ok.SRC_ALPHA,v._dstBlendFactorCache=ok.ONE_MINUS_SRC_ALPHA,v._dirtyVersion=-1,v._internalId=-1,v._flagChangedVersion=-1,v._useVertexOpacity=!1,v._lastParent=null,v._renderEntity=v.createRenderEntity(),v}s(e,g);var v=e.prototype;return v.setRenderData=function(g){this._renderData=g},v.onLoad=function(){this._renderEntity.setNode(this.node)},v.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},v.onEnable=function(){this.node.on(md.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(md.SIZE_CHANGED,this._nodeStateChange,this),this.node.on(md.PARENT_CHANGED,this._colorDirty,this),this.updateMaterial(),this._colorDirty(),IR.addRenderer(this),this.markForUpdateRenderData()},v.onRestore=function(){this.updateMaterial(),this.markForUpdateRenderData()},v.onDisable=function(){this.node.off(md.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(md.SIZE_CHANGED,this._nodeStateChange,this),this.node.off(md.PARENT_CHANGED,this._colorDirty,this),IR.removeRenderer(this),this._renderFlag=!1,this._renderEntity.enabled=!1},v.onDestroy=function(){if(this._renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var g=0;g<this._materialInstances.length;g++){var v=this._materialInstances[g];v&&v.destroy()}},v.markForUpdateRenderData=function(g){if(void 0===g&&(g=!0),g){var v=this._renderData;v&&(v.vertDirty=!0),IR.markDirtyRenderer(this)}},v.requestRenderData=function(g){void 0===g&&(g=Pm.COMP);var v=PX.add();return v.initRenderDrawInfo(this,g),this._renderData=v,v},v.destroyRenderData=function(){this._renderData&&(this._renderData.removeRenderDrawInfo(this),PX.remove(this._renderData),this._renderData=null)},v.updateRenderer=function(){this._assembler&&this._assembler.updateRenderData(this),this._renderFlag=this._canRender(),this._renderEntity.enabled=this._renderFlag},v.fillBuffers=function(g){this._renderFlag&&this._render(g)},v.postUpdateAssembler=function(g){this._postAssembler&&this._renderFlag&&this._postRender(g)},v._render=function(){},v._postRender=function(){},v._canRender=function(){return null!==this.getSharedMaterial(0)&&this._enabled&&this._color.a>0},v._postCanRender=function(){},v.updateMaterial=function(){if(this._customMaterial)this.getSharedMaterial(0)!==this._customMaterial&&this.setSharedMaterial(this._customMaterial,0);else{var g=this._updateBuiltinMaterial();this.setSharedMaterial(g,0),this.stencilStage!==Pg.ENTER_LEVEL&&this.stencilStage!==Pg.ENTER_LEVEL_INVERTED||this.getMaterialInstance(0).recompileShaders({USE_ALPHA_TEST:!0}),this._updateBlendFunc()}},v._updateColor=function(){if(this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0),this.setEntityColor(this._color),this.setEntityOpacity(this.node._uiProps.localOpacity),this._assembler){this._assembler.updateColor(this);var g=this._renderFlag;if(this._renderFlag=this._canRender(),this.setEntityEnabled(this._renderFlag),g!==this._renderFlag){var v=this.renderData;v&&(v.vertDirty=!0)}}},e.setEntityColorDirtyRecursively=function(g,v){var S=g._uiProps.uiComp;S&&S.color&&(S._renderEntity.colorDirty=v);for(var O=0;O<g.children.length;O++)e.setEntityColorDirtyRecursively(g.children[O],v)},v.setEntityColorDirty=function(){},v.setEntityColor=function(){},v.setEntityOpacity=function(){},v.setEntityEnabled=function(){},v._updateBlendFunc=function(){var g=this.getRenderMaterial(0).passes[0].blendState.targets[0];if(this._dstBlendFactorCache=g.blendDst,this._srcBlendFactorCache=g.blendSrc,this._dstBlendFactorCache!==this._dstBlendFactor||this._srcBlendFactorCache!==this._srcBlendFactor){(g=this.getMaterialInstance(0).passes[0].blendState.targets[0]).blend=!0,g.blendDstAlpha=ok.ONE_MINUS_SRC_ALPHA,g.blendDst=this._dstBlendFactor,g.blendSrc=this._srcBlendFactor;var v=this.getMaterialInstance(0).passes[0];v.blendState.setTarget(0,g),v._updatePassHash(),this._dstBlendFactorCache=this._dstBlendFactor,this._srcBlendFactorCache=this._srcBlendFactor}},v._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var g=0;g<this.node.children.length;++g){var v=this.node.children[g].getComponent(e);v&&v.markForUpdateRenderData()}},v._colorDirty=function(){this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0)},v._onMaterialModified=function(v,S){this._renderData&&(this.markForUpdateRenderData(),this._renderData.passDirty=!0),g.prototype._onMaterialModified.call(this,v,S)},v._updateBuiltinMaterial=function(){var g;switch(this._instanceMaterialType){case Dc.ADD_COLOR:g=dU.get("ui-base-material");break;case Dc.GRAYSCALE:g=dU.get("ui-sprite-gray-material");break;case Dc.USE_ALPHA_SEPARATED:g=dU.get("ui-sprite-alpha-sep-material");break;case Dc.USE_ALPHA_SEPARATED_AND_GRAY:g=dU.get("ui-sprite-gray-alpha-sep-material");break;default:g=dU.get("ui-sprite-material")}return g},v.setNodeDirty=function(){this._renderData&&(this._renderData.nodeDirty=!0)},v.setTextureDirty=function(){this._renderData&&(this._renderData.textureDirty=!0)},v.createRenderEntity=function(){return new PH(Px.STATIC)},n(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(g){for(var v=0;v<g.length;v++)g[v]!==this._materials[v]&&this.setSharedMaterial(g[v],v);if(g.length<this._materials.length){for(var S=g.length;S<this._materials.length;S++)this.setSharedMaterial(null,S);this._materials.splice(g.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(g){this._customMaterial=g,this.updateMaterial()}},{key:"color",get:function(){return this._color},set:function(g){this._color.equals(g)||(this._color.set(g),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"useVertexOpacity",get:function(){return this._useVertexOpacity}},{key:"stencilStage",get:function(){return this._stencilStage},set:function(g){this._stencilStage=g,this._renderEntity.setStencilStage(g)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(g){this._srcBlendFactor=g}},{key:"batcher",get:function(){return II.root.batcher2D}},{key:"renderEntity",get:function(){return this._renderEntity}}]),e}(Dm)).BlendState=ok,Dl.Assembler=null,Dl.PostAssembler=null,p((P7=Dl).prototype,"sharedMaterials",[rE],Object.getOwnPropertyDescriptor(P7.prototype,"sharedMaterials"),P7.prototype),p(P7.prototype,"customMaterial",[P4],Object.getOwnPropertyDescriptor(P7.prototype,"customMaterial"),P7.prototype),P9=ws(P7.prototype,"_materials",[rE],function(){return[]}),Dr=ws(P7.prototype,"_customMaterial",[P8],function(){return null}),Da=ws(P7.prototype,"_srcBlendFactor",[n2],function(){return ok.SRC_ALPHA}),Dh=ws(P7.prototype,"_dstBlendFactor",[n2],function(){return ok.ONE_MINUS_SRC_ALPHA}),Du=ws(P7.prototype,"_color",[n2],function(){return is.WHITE.clone()}),P6=P7))||P6)||P6));X.internal.UIRenderer=Dg;var Dy,DS,DA,DT,DE,DC,Dx,Db,DR,Dw,DI,DB,DP,DD,DM,DO,DL,DF,DN,Dk,DG,DV,DU,DH,Dz,DW,DX,Dj,Dq,DY,DK,DJ,DQ,D0,D2,D3,D5,D4,D8=function(){function t1(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor=is.WHITE.clone(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor=is.BLACK.clone(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0,this.color=is.WHITE.clone(),this.fontSize=40,this.actualFontSize=0,this.isSystemFontUsed=!1,this.originFontSize=0,this.bmfontScale=1,this.fontFamily="Arial",this.fontDesc="",this.fntConfig=null,this.spriteFrame=null,this.fontScale=1}return t1.prototype.reset=function(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor.set(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor.set(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0},t1}(),D6=function(){function t1(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions=new iu,this.horizontalKerning=[],this.numberOfLines=1,this.linesOffsetX=[],this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth=[]}return t1.prototype.reset=function(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions.set(),this.horizontalKerning.length=0,this.numberOfLines=1,this.linesOffsetX.length=0,this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth.length=0},t1}(),D7=function(){function t1(){this.parsedString=[],this.nodeContentSize=iu.ZERO.clone(),this.canvasSize=new iu,this.canvasPadding=new ic,this.contentSizeExtend=iu.ZERO.clone(),this.startPosition=e8.ZERO.clone()}return t1.prototype.reset=function(){this.parsedString.length=0,this.nodeContentSize.set(0,0),this.canvasSize.set(),this.canvasPadding.set(),this.contentSizeExtend.set(),this.startPosition.set()},t1}(),D9=function(){function t1(){this.quadCount=0,this.vertexBuffer=[],this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5}return t1.prototype.reset=function(){this.quadCount=0,this.vertexBuffer.length=0,this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5},t1}();is.WHITE.clone(),g("H",D2),function(g){g[g.LEFT=0]="LEFT",g[g.CENTER=1]="CENTER",g[g.RIGHT=2]="RIGHT"}(D2||g("H",D2={})),oe(D2),g("V",D3),function(g){g[g.TOP=0]="TOP",g[g.CENTER=1]="CENTER",g[g.BOTTOM=2]="BOTTOM"}(D3||g("V",D3={})),oe(D3),g("O",D5),function(g){g[g.NONE=0]="NONE",g[g.CLAMP=1]="CLAMP",g[g.SHRINK=2]="SHRINK",g[g.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(D5||g("O",D5={})),oe(D5),g("p",D4),function(g){g[g.NONE=0]="NONE",g[g.BITMAP=1]="BITMAP",g[g.CHAR=2]="CHAR"}(D4||g("p",D4={})),oe(D4);var Mt=g("q",(Dy=nJ("cc.Label"),DS=nQ(110),DA=ma(D2),DT=ma(D3),DE=ma(D5),DC=ma(BT),Dx=ma(D4),Dy(Db=DS(((D0=function(g){function e(){var v;return(v=g.call(this)||this)._string=Dw&&Dw(),v._horizontalAlign=DI&&DI(),v._verticalAlign=DB&&DB(),v._actualFontSize=DP&&DP(),v._fontSize=DD&&DD(),v._fontFamily=DM&&DM(),v._lineHeight=DO&&DO(),v._overflow=DL&&DL(),v._enableWrapText=DF&&DF(),v._font=DN&&DN(),v._isSystemFontUsed=Dk&&Dk(),v._spacingX=DG&&DG(),v._isItalic=DV&&DV(),v._isBold=DU&&DU(),v._isUnderline=DH&&DH(),v._underlineHeight=Dz&&Dz(),v._cacheMode=DW&&DW(),v._enableOutline=DX&&DX(),v._outlineColor=Dj&&Dj(),v._outlineWidth=Dq&&Dq(),v._enableShadow=DY&&DY(),v._shadowColor=DK&&DK(),v._shadowOffset=DJ&&DJ(),v._shadowBlur=DQ&&DQ(),v._N$file=null,v._texture=null,v._ttfSpriteFrame=null,v._userDefinedFont=null,v._assemblerData=null,v._fontAtlas=null,v._letterTexture=null,v._contentWidth=0,v._textStyle=null,v._textLayout=null,v._textRenderData=null,v._textLayoutData=null,v._ttfSpriteFrame=null,v._textStyle=new D8,v._textLayout=new D6,v._textLayoutData=new D7,v._textRenderData=new D9,v}s(e,g);var v=e.prototype;return v.onEnable=function(){g.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()},v.destroyTtfSpriteFrame=function(){if(this._ttfSpriteFrame){this._ttfSpriteFrame._resetDynamicAtlasFrame();var g=this._ttfSpriteFrame.texture;if(this._ttfSpriteFrame.destroy(),g){var v=g;v.image&&v.image.destroy(),g.destroy()}this._ttfSpriteFrame=null}},v._onPreDestroy=function(){g.prototype._onPreDestroy.call(this),this._isOnLoadCalled||this.destroyTtfSpriteFrame()},v.onDestroy=function(){this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this.destroyTtfSpriteFrame(),this._letterTexture=null,g.prototype.onDestroy.call(this)},v.updateRenderData=function(g){void 0===g&&(g=!1),g&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture()),this._assembler&&this._assembler.updateRenderData(this)},v._render=function(g){g.commitComp(this,this.renderData,this._texture,this._assembler,null)},v._updateColor=function(){g.prototype._updateColor.call(this),this.markForUpdateRenderData()},v.setEntityColor=function(){},v._canRender=function(){if(!g.prototype._canRender.call(this)||!this._string)return!1;var v=this._font;if(v&&_instanceof(v,B1)){var S=v.spriteFrame;if(!S||!S.texture)return!1}return!0},v._flushAssembler=function(){var g=e.Assembler.getAssembler(this);this._assembler!==g&&(this.destroyRenderData(),this._assembler=g,this.textStyle.reset(),this.textLayout.reset(),this.textLayoutData.reset(),this.textRenderData.reset()),this.renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.renderData.material=this.material,this._updateColor())},v._applyFontTexture=function(){this.markForUpdateRenderData();var g=this._font;if(_instanceof(g,B1)){var v=g.spriteFrame;v&&v.texture&&(this._texture=v,this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(this.cacheMode===D4.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new Bf,this._assemblerData=this._assembler.getAssemblerData();var S=new lX(this._assemblerData.canvas),O=new cK;O.image=S,this._ttfSpriteFrame.texture=O}this.cacheMode!==D4.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}},v.changeMaterialForDefine=function(){if(this._texture){var g=!1;if(this.cacheMode!==D4.CHAR){var v=this._texture.texture;if(_instanceof(v,lJ)){var S=v.getPixelFormat();g=S===lb.RGBA_ETC1||S===lb.RGB_A_PVRTC_4BPPV1||S===lb.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=g?Dc.USE_ALPHA_SEPARATED:Dc.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},v._updateBlendFunc=function(){g.prototype._updateBlendFunc.call(this)},n(e,[{key:"string",get:function(){return this._string},set:function(g){g=null==g?"":g.toString(),this._string!==g&&(this._string=g,this.markForUpdateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(g){this._horizontalAlign!==g&&(this._horizontalAlign=g,this.markForUpdateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(g){this._verticalAlign!==g&&(this._verticalAlign=g,this.markForUpdateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(g){this._actualFontSize=g}},{key:"fontSize",get:function(){return this._fontSize},set:function(g){this._fontSize!==g&&(this._fontSize=g,this.markForUpdateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(g){this._lineHeight!==g&&(this._lineHeight=g,this.markForUpdateRenderData())}},{key:"spacingX",get:function(){return this._spacingX},set:function(g){this._spacingX!==g&&(this._spacingX=g,this.markForUpdateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(g){this._overflow!==g&&(this._overflow=g,this.markForUpdateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(g){this._enableWrapText!==g&&(this._enableWrapText=g,this.markForUpdateRenderData())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(g){this._isSystemFontUsed!==g&&(this.destroyRenderData(),this._isSystemFontUsed=!!g,g&&(this.font=null),this._flushAssembler(),this.markForUpdateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(g){this._fontFamily!==g&&(this._fontFamily=g,this.markForUpdateRenderData())}},{key:"font",get:function(){return this._font},set:function(g){this._font!==g&&(this._isSystemFontUsed=!g,this._font=g,this.destroyRenderData(),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(g){this._cacheMode!==g&&(this._cacheMode!==D4.BITMAP||_instanceof(this._font,B1)||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),this._cacheMode===D4.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=g,this.updateRenderData(!0))}},{key:"isBold",get:function(){return this._isBold},set:function(g){this._isBold!==g&&(this._isBold=g,this.markForUpdateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(g){this._isItalic!==g&&(this._isItalic=g,this.markForUpdateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(g){this._isUnderline!==g&&(this._isUnderline=g,this.markForUpdateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(g){this._underlineHeight!==g&&(this._underlineHeight=g,this.markForUpdateRenderData())}},{key:"enableOutline",get:function(){return this._enableOutline},set:function(g){this._enableOutline!==g&&(this._enableOutline=g,this.markForUpdateRenderData())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(g){this._outlineColor!==g&&(this._outlineColor.set(g),this.markForUpdateRenderData())}},{key:"outlineWidth",get:function(){return this._outlineWidth},set:function(g){this._outlineWidth!==g&&(this._outlineWidth=g,this.markForUpdateRenderData())}},{key:"enableShadow",get:function(){return this._enableShadow},set:function(g){this._enableShadow!==g&&(this._enableShadow=g,this.markForUpdateRenderData())}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(g){this._shadowColor!==g&&(this._shadowColor.set(g),this.markForUpdateRenderData())}},{key:"shadowOffset",get:function(){return this._shadowOffset},set:function(g){this._shadowOffset!==g&&(this._shadowOffset.set(g),this.markForUpdateRenderData())}},{key:"shadowBlur",get:function(){return this._shadowBlur},set:function(g){this._shadowBlur!==g&&(this._shadowBlur=g,this.markForUpdateRenderData())}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(g){this._fontAtlas=g}},{key:"_bmFontOriginalSize",get:function(){return _instanceof(this._font,B1)?this._font.fontSize:-1}},{key:"textStyle",get:function(){return this._textStyle}},{key:"textLayout",get:function(){return this._textLayout}},{key:"textRenderData",get:function(){return this._textRenderData}},{key:"textLayoutData",get:function(){return this._textLayoutData}},{key:"contentWidth",get:function(){return this._contentWidth},set:function(g){this._contentWidth=g}}]),e}(Dg)).HorizontalAlign=D2,D0.VerticalAlign=D3,D0.Overflow=D5,D0.CacheMode=D4,D0._canvasPool=B4.getInstance(),p((DR=D0).prototype,"horizontalAlign",[DA],Object.getOwnPropertyDescriptor(DR.prototype,"horizontalAlign"),DR.prototype),p(DR.prototype,"verticalAlign",[DT],Object.getOwnPropertyDescriptor(DR.prototype,"verticalAlign"),DR.prototype),p(DR.prototype,"overflow",[DE],Object.getOwnPropertyDescriptor(DR.prototype,"overflow"),DR.prototype),p(DR.prototype,"font",[DC],Object.getOwnPropertyDescriptor(DR.prototype,"font"),DR.prototype),p(DR.prototype,"cacheMode",[Dx],Object.getOwnPropertyDescriptor(DR.prototype,"cacheMode"),DR.prototype),Dw=ws(DR.prototype,"_string",[n2],function(){return"label"}),DI=ws(DR.prototype,"_horizontalAlign",[n2],function(){return D2.CENTER}),DB=ws(DR.prototype,"_verticalAlign",[n2],function(){return D3.CENTER}),DP=ws(DR.prototype,"_actualFontSize",[n2],function(){return 0}),DD=ws(DR.prototype,"_fontSize",[n2],function(){return 40}),DM=ws(DR.prototype,"_fontFamily",[n2],function(){return"Arial"}),DO=ws(DR.prototype,"_lineHeight",[n2],function(){return 40}),DL=ws(DR.prototype,"_overflow",[n2],function(){return D5.NONE}),DF=ws(DR.prototype,"_enableWrapText",[n2],function(){return!0}),DN=ws(DR.prototype,"_font",[n2],function(){return null}),Dk=ws(DR.prototype,"_isSystemFontUsed",[n2],function(){return!0}),DG=ws(DR.prototype,"_spacingX",[n2],function(){return 0}),DV=ws(DR.prototype,"_isItalic",[n2],function(){return!1}),DU=ws(DR.prototype,"_isBold",[n2],function(){return!1}),DH=ws(DR.prototype,"_isUnderline",[n2],function(){return!1}),Dz=ws(DR.prototype,"_underlineHeight",[n2],function(){return 2}),DW=ws(DR.prototype,"_cacheMode",[n2],function(){return D4.NONE}),DX=ws(DR.prototype,"_enableOutline",[n2],function(){return!1}),Dj=ws(DR.prototype,"_outlineColor",[n2],function(){return new is(0,0,0,255)}),Dq=ws(DR.prototype,"_outlineWidth",[n2],function(){return 2}),DY=ws(DR.prototype,"_enableShadow",[n2],function(){return!1}),DK=ws(DR.prototype,"_shadowColor",[n2],function(){return new is(0,0,0,255)}),DJ=ws(DR.prototype,"_shadowOffset",[n2],function(){return new e8(2,2)}),DQ=ws(DR.prototype,"_shadowBlur",[n2],function(){return 2}),Db=DR))||Db)||Db));X.Label=Mt;var Me,Mn,Ms=0,Mo={};function Kk(g){return--g,g|=g>>16,g|=g>>8,g|=g>>4,g|=g>>2,g|=g>>1,++g}function Jk(g,v){return Math.ceil(g/v)*v}!function(g){g[g.OPAQUE=0]="OPAQUE",g[g.TRANSPARENT=1]="TRANSPARENT",g[g.OVERLAY=2]="OVERLAY"}(Me||(Me={})),function(g){g[g.DEFAULT=1]="DEFAULT",g[g.FORWARD=2]="FORWARD",g[g.SHADOWCAST=4]="SHADOWCAST"}(Mn||(Mn={}));var Mh,Ml,Mc,Mf,Md,Mp,Mg,MS,MA,MT=function(){function t1(g){this._device=void 0,this._format=oA.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new hg,this._region1=new hg,this._region2=new hg,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=g}var g=t1.prototype;return g.initialize=function(g){var v=uf[g.format];this._format=g.format,this._formatSize=v.size,this._channels=v.count,this._bufferViewCtor=D_(v),this._roundUpFn=g.roundUpFn||null,this._alignment=g.alignment||1,g.inOrderFree&&(this.alloc=this._McDonaldAlloc)},g.destroy=function(){for(var g=0;g<this._chunkCount;++g)this._chunks[g].texture.destroy();this._chunks.length=0,this._handles.length=0},g.alloc=function(g,v){g=Jk(g,this._alignment);var S=-1,O=-1;if(void 0!==v&&(S=v,O=this._findAvailableSpace(g,S)),O<0)for(var X=0;X<this._chunkCount&&(S=X,!((O=this._findAvailableSpace(g,S))>=0));++X);if(O>=0){var Y=this._chunks[S];Y.start+=g;var te={chunkIdx:S,start:O,end:O+g,texture:Y.texture};return this._handles.push(te),te}var ti=Math.sqrt(g/this._formatSize),tr=this._roundUpFn&&this._roundUpFn(ti,this._formatSize)||Math.max(1024,Kk(ti)),ta=this._chunks[this.createChunk(tr)];ta.start+=g;var th={chunkIdx:this._chunkCount-1,start:0,end:g,texture:ta.texture};return this._handles.push(th),th},g.free=function(g){for(var v=0;v<this._handles.length;++v)if(this._handles[v]===g)return this._chunks[g.chunkIdx].end=g.end,void this._handles.splice(v,1)},g.createChunk=function(g){var v=g*g*this._formatSize;U("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+v+", format: "+this._format);var S={texture:this._device.createTexture(new hB(ow.TEX2D,oI.SAMPLED|oI.TRANSFER_DST,this._format,g,g)),size:v,start:0,end:v};return this._chunks[this._chunkCount]=S,this._chunkCount++},g.update=function(g,v){var S=[],O=[],X=g.start/this._formatSize,Y=v.byteLength/this._formatSize,te=X%g.texture.width,ti=Math.floor(X/g.texture.width),tr=Math.min(g.texture.width-te,Y),ta=0;te>0&&(this._region0.texOffset.x=te,this._region0.texOffset.y=ti,this._region0.texExtent.width=tr,this._region0.texExtent.height=1,S.push(new this._bufferViewCtor(v,ta*this._formatSize,tr*this._channels)),O.push(this._region0),te=0,ti+=1,Y-=tr,ta+=tr),Y>0&&(this._region1.texOffset.x=te,this._region1.texOffset.y=ti,Y>g.texture.width?(this._region1.texExtent.width=g.texture.width,this._region1.texExtent.height=Math.floor(Y/g.texture.width),tr=this._region1.texExtent.width*this._region1.texExtent.height):(tr=Y,this._region1.texExtent.width=tr,this._region1.texExtent.height=1),S.push(new this._bufferViewCtor(v,ta*this._formatSize,tr*this._channels)),O.push(this._region1),te=0,ti+=this._region1.texExtent.height,Y-=tr,ta+=tr),Y>0&&(this._region2.texOffset.x=te,this._region2.texOffset.y=ti,this._region2.texExtent.width=Y,this._region2.texExtent.height=1,S.push(new this._bufferViewCtor(v,ta*this._formatSize,Y*this._channels)),O.push(this._region2)),this._device.copyBuffersToTexture(S,g.texture,O)},g._findAvailableSpace=function(g,v){var S=this._chunks[v],O=!1,X=S.start;if(X+g<=S.size)O=!0;else{X=0;for(var Y=this._handles.filter(function(g){return g.chunkIdx===v}).sort(function(g,v){return g.start-v.start}),te=0;te<Y.length;te++){var ti=Y[te];if(X+g<=ti.start){O=!0;break}X=ti.end}!O&&X+g<=S.size&&(O=!0)}return O?X:-1},g._McDonaldAlloc=function(g){g=Jk(g,this._alignment);for(var v=0;v<this._chunkCount;++v){var S=this._chunks[v],O=!1,X=S.start;if(X+g<=S.end?O=!0:X>S.end?X+g<=S.size?O=!0:g<=S.end&&(S.start=X=0,O=!0):X===S.end&&(S.start=X=0,S.end=S.size,g<=S.end&&(O=!0)),O){S.start+=g;var Y={chunkIdx:v,start:X,end:X+g,texture:S.texture};return this._handles.push(Y),Y}}var te=Math.sqrt(g/this._formatSize),ti=this._roundUpFn&&this._roundUpFn(te,this._formatSize)||Math.max(1024,Kk(te)),tr=this._chunks[this.createChunk(ti)];tr.start+=g;var ta={chunkIdx:this._chunkCount,start:0,end:g,texture:tr.texture};return this._handles.push(ta),ta},t1}(),ME=function(){function t1(g,v,S){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=S*(1<<v)}return t1.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},t1}();!function(g){g[g.UINT32=0]="UINT32",g[g.FLOAT32=1]="FLOAT32",g[g.NEVER=2]="NEVER"}(MA||(MA={}));var MC,Mx,Mb=function(){function t1(g,v,S,O,X){void 0===X&&(X=8),this._dataType=void 0,this._dataMembers=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freeLists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=O.COUNT,this._entryBits=X,this._dataType=v,this._dataMembers=S,this._stride=4*this._elementCount,this._entriesPerChunk=1<<X,this._entryMask=this._entriesPerChunk-1,this._poolFlag=0x40000000,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new ME(g,X,this._stride);var Y=MA.NEVER,te=!1,ti=!1;for(var tr in v){if(te=this._hasFloat32,(ti=this._hasUint32)&&te)break;Y=v[tr],te||Y!==MA.FLOAT32?ti||Y!==MA.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var g=t1.prototype;return g.alloc=function(){for(var g=0;g<this._freeLists.length;g++){var v=this._freeLists[g];if(v.length){var S=v[v.length-1];return v.length--,(g<<this._entryBits)+S+this._poolFlag}}for(var O=this._nativePool.allocateNewChunk(),X=[],Y=[],te=[],ti=this._hasFloat32,tr=this._hasUint32,ta=0;ta<this._entriesPerChunk;ta++)ti&&X.push(new Float32Array(O,this._stride*ta,this._elementCount)),tr&&Y.push(new Uint32Array(O,this._stride*ta,this._elementCount)),ta&&te.push(ta);return tr&&this._uint32BufferViews.push(Y),ti&&this._float32BufferViews.push(X),this._freeLists.push(te),this._arrayBuffers.push(O),(g<<this._entryBits)+this._poolFlag},g.getBuffer=function(g){var v=(this._chunkMask&g)>>this._entryBits,S=this._entryMask&g;return(this._hasFloat32?this._float32BufferViews:this._uint32BufferViews)[v][S]},g.getTypedArray=function(g,v){var S=(this._chunkMask&g)>>this._entryBits,O=this._entryMask&g,X=v,Y=(this._dataType[v]===MA.UINT32?this._uint32BufferViews:this._float32BufferViews)[S][O],te=this._dataMembers[v];return Y.subarray(X,X+te)},g.free=function(g){var v=(this._chunkMask&g)>>this._entryBits,S=this._entryMask&g;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[v][S].fill(0),this._freeLists[v].push(S)},t1}();!function(g){g[g.NODE=0]="NODE",g[g.PASS=1]="PASS",g[g.AABB=2]="AABB",g[g.RENDER2D=3]="RENDER2D"}(MC||(MC={})),function(g){g[g.POSITION=0]="POSITION",g[g.UV=3]="UV",g[g.COLOR=5]="COLOR",g[g.COUNT=9]="COUNT"}(Mx||(Mx={}));var MR,Mw=((Mh={})[Mx.POSITION]=MA.FLOAT32,Mh[Mx.UV]=MA.FLOAT32,Mh[Mx.COLOR]=MA.UINT32,Mh[Mx.COUNT]=MA.NEVER,Mh),MI=((Ml={})[Mx.POSITION]=Mx.UV-Mx.POSITION,Ml[Mx.UV]=Mx.COLOR-Mx.UV,Ml[Mx.COLOR]=Mx.COUNT-Mx.COLOR,Ml[Mx.COUNT]=1,Ml),MB=new Mb(MC.RENDER2D,Mw,MI,Mx);!function(g){g[g.DIRTY_FLAG=0]="DIRTY_FLAG",g[g.LAYER=1]="LAYER",g[g.WORLD_SCALE=2]="WORLD_SCALE",g[g.WORLD_POSITION=5]="WORLD_POSITION",g[g.WORLD_ROTATION=8]="WORLD_ROTATION",g[g.WORLD_MATRIX=12]="WORLD_MATRIX",g[g.LOCAL_SCALE=28]="LOCAL_SCALE",g[g.LOCAL_POSITION=31]="LOCAL_POSITION",g[g.LOCAL_ROTATION=34]="LOCAL_ROTATION",g[g.COUNT=38]="COUNT"}(MR||(MR={}));var MP,MD=((Mc={})[MR.DIRTY_FLAG]=MA.UINT32,Mc[MR.LAYER]=MA.UINT32,Mc[MR.WORLD_SCALE]=MA.FLOAT32,Mc[MR.WORLD_POSITION]=MA.FLOAT32,Mc[MR.WORLD_ROTATION]=MA.FLOAT32,Mc[MR.WORLD_MATRIX]=MA.FLOAT32,Mc[MR.LOCAL_SCALE]=MA.FLOAT32,Mc[MR.LOCAL_POSITION]=MA.FLOAT32,Mc[MR.LOCAL_ROTATION]=MA.FLOAT32,Mc[MR.COUNT]=MA.NEVER,Mc),MM=((Mf={})[MR.DIRTY_FLAG]=MR.LAYER-MR.DIRTY_FLAG,Mf[MR.LAYER]=MR.WORLD_SCALE-MR.LAYER,Mf[MR.WORLD_SCALE]=MR.WORLD_POSITION-MR.WORLD_SCALE,Mf[MR.WORLD_POSITION]=MR.WORLD_ROTATION-MR.WORLD_POSITION,Mf[MR.WORLD_ROTATION]=MR.WORLD_MATRIX-MR.WORLD_ROTATION,Mf[MR.WORLD_MATRIX]=MR.LOCAL_SCALE-MR.WORLD_MATRIX,Mf[MR.LOCAL_SCALE]=MR.LOCAL_POSITION-MR.LOCAL_SCALE,Mf[MR.LOCAL_POSITION]=MR.LOCAL_ROTATION-MR.LOCAL_POSITION,Mf[MR.LOCAL_ROTATION]=MR.COUNT-MR.LOCAL_ROTATION,Mf[MR.COUNT]=1,Mf),MO=new Mb(MC.NODE,MD,MM,MR);!function(g){g[g.PRIORITY=0]="PRIORITY",g[g.STAGE=1]="STAGE",g[g.PHASE=2]="PHASE",g[g.PRIMITIVE=3]="PRIMITIVE",g[g.BATCHING_SCHEME=4]="BATCHING_SCHEME",g[g.DYNAMIC_STATE=5]="DYNAMIC_STATE",g[g.HASH=6]="HASH",g[g.COUNT=7]="COUNT"}(MP||(MP={}));var ML,MF=((Md={})[MP.PRIORITY]=MA.UINT32,Md[MP.STAGE]=MA.UINT32,Md[MP.PHASE]=MA.UINT32,Md[MP.PRIMITIVE]=MA.UINT32,Md[MP.BATCHING_SCHEME]=MA.UINT32,Md[MP.DYNAMIC_STATE]=MA.UINT32,Md[MP.HASH]=MA.UINT32,Md[MP.COUNT]=MA.NEVER,Md),MN=((Mp={})[MP.PRIORITY]=MP.STAGE-MP.PRIORITY,Mp[MP.STAGE]=MP.PHASE-MP.STAGE,Mp[MP.PHASE]=MP.PRIMITIVE-MP.PHASE,Mp[MP.PRIMITIVE]=MP.BATCHING_SCHEME-MP.PRIMITIVE,Mp[MP.BATCHING_SCHEME]=MP.DYNAMIC_STATE-MP.BATCHING_SCHEME,Mp[MP.DYNAMIC_STATE]=MP.HASH-MP.DYNAMIC_STATE,Mp[MP.HASH]=MP.COUNT-MP.HASH,Mp[MP.COUNT]=1,Mp),Mk=new Mb(MC.PASS,MF,MN,MP);!function(g){g[g.CENTER=0]="CENTER",g[g.HALFEXTENTS=3]="HALFEXTENTS",g[g.COUNT=6]="COUNT"}(ML||(ML={}));var MG,MV,MU,MH=((Mg={})[ML.CENTER]=MA.FLOAT32,Mg[ML.HALFEXTENTS]=MA.FLOAT32,Mg[ML.COUNT]=MA.NEVER,Mg),Mz=((MS={})[ML.CENTER]=ML.HALFEXTENTS-ML.CENTER,MS[ML.HALFEXTENTS]=ML.COUNT-ML.HALFEXTENTS,MS[ML.COUNT]=1,MS),MW=new Mb(MC.AABB,MH,Mz,ML),IV=function(g){if(void 0===Mo[g]){var v=1<<Ms;Mo[g]=v,Ms+=1}},MX=Object.freeze({__proto__:null,addStage:IV,scene:wR,createIA:function(g,v){if(!v.positions)return console.error("The data must have positions field"),null;for(var S=[],O=v.positions.length/3,X=0;X<O;++X)S.push(v.positions[3*X],v.positions[3*X+1],v.positions[3*X+2]),v.normals&&S.push(v.normals[3*X],v.normals[3*X+1],v.normals[3*X+2]),v.uvs&&S.push(v.uvs[2*X],v.uvs[2*X+1]),v.colors&&S.push(v.colors[3*X],v.colors[3*X+1],v.colors[3*X+2]);var Y=[];Y.push(new hz(hi.ATTR_POSITION,oA.RGB32F)),v.normals&&Y.push(new hz(hi.ATTR_NORMAL,oA.RGB32F)),v.uvs&&Y.push(new hz(hi.ATTR_TEX_COORD,oA.RG32F)),v.colors&&Y.push(new hz(hi.ATTR_COLOR,oA.RGB32F));var te=g.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,4*S.length,4*S.length/O));te.update(new Float32Array(S));var ti=null;return v.indices&&(ti=g.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.DEVICE,2*v.indices.length,2))).update(new Uint16Array(v.indices)),g.createInputAssembler(new hX(Y,[te],ti))},programLib:fX,getDeviceShaderVersion:cv,get RenderQueue(){return Me},get PassStage(){return Mn},genHandle:Xg,getTypeFromHandle:jg,getBindingFromHandle:Yg,getCountFromHandle:qg,getOffsetFromHandle:Kg,customizeType:Jg,type2reader:fP,type2writer:fD,type2validator:fM,getDefaultFromType:ev,getStringFromType:iv,overrideMacros:nv,get BatchingSchemes(){return dG},Pass:dY,nearestPOT:Kk,TextureBufferPool:MT,MaterialInstance:m0,PassInstance:mQ,get PoolType(){return MC},NULL_HANDLE:0,get Render2dView(){return Mx},Render2dPool:MB,get NodeView(){return MR},NodePool:MO,get PassView(){return MP},PassPool:Mk,get AABBView(){return ML},AABBPool:MW,RenderScene:ww});g("ai",MX),function(g){g[g.BUTT=0]="BUTT",g[g.ROUND=1]="ROUND",g[g.SQUARE=2]="SQUARE"}(MG||(MG={})),oe(MG),function(g){g[g.BEVEL=0]="BEVEL",g[g.ROUND=1]="ROUND",g[g.MITER=2]="MITER"}(MV||(MV={})),oe(MV),function(g){g[g.PT_CORNER=1]="PT_CORNER",g[g.PT_LEFT=2]="PT_LEFT",g[g.PT_BEVEL=4]="PT_BEVEL",g[g.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(MU||(MU={})),oe(MU);var Mj=Math.PI,MY=Math.min,MK=Math.max,MJ=Math.cos,MZ=Math.sin,MQ=Math.abs,M0=Math.sign,M2=.5522847493;function kV(g,v,S,O,X){g.moveTo(v-O,S),g.bezierCurveTo(v-O,S+X*M2,v-O*M2,S+X,v,S+X),g.bezierCurveTo(v+O*M2,S+X,v+O,S+X*M2,v+O,S),g.bezierCurveTo(v+O,S-X*M2,v+O*M2,S-X,v,S-X),g.bezierCurveTo(v-O*M2,S-X,v-O,S-X*M2,v-O,S),g.close()}function VV(g,v,S,O,X,Y,te,ti,tr,ta,th){var tu,tl,tc,t_,tf,tp,tm,tg,tv,ty,tS,tA,tT,tE,tC,tx;ta>10||(tf=.5*(Y+ti),tp=.5*(te+tr),tm=.5*((tu=.5*(v+O))+(tc=.5*(O+Y))),tg=.5*((tl=.5*(S+X))+(t_=.5*(X+te))),((tC=MQ((O-ti)*(tE=tr-S)-(X-tr)*(tT=ti-v)))+(tx=MQ((Y-ti)*tE-(te-tr)*tT)))*(tC+tx)<g.tessTol*(tT*tT+tE*tE)?g.addPoint(ti,tr,0===th?th|MU.PT_BEVEL:th):(VV(g,v,S,tu,tl,tm,tg,tS=.5*(tm+(tv=.5*(tc+tf))),tA=.5*(tg+(ty=.5*(t_+tp))),ta+1,0),VV(g,tS,tA,tv,ty,tf,tp,ti,tr,ta+1,th)))}var M3,M5,M4,M8,M6,M7,M9,Ot,On,Or,Oo,Oh,Ol,Oc,Od,Op,Om,Og,Ov,Oy,OS,OA,OT,OE,OC,Ox,Ob,OR,Ow,OI,OB,OP,OD,OM,OO,OF,ON,Ok=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).dx=0,v.dy=0,v.dmx=0,v.dmy=0,v.flags=0,v.len=0,v}return s(e,g),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(e8),OG=function(){function t1(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[]}return t1.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points.length=0},t1}(),OV=function(){function t1(g){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=is.WHITE.clone(),this.lineCap=MG.BUTT,this.strokeColor=is.BLACK.clone(),this.lineJoin=MV.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null,this._comp=void 0,this._comp=g}var g=t1.prototype;return g.moveTo=function(g,v){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(g,v,MU.PT_CORNER),this._commandX=g,this._commandY=v},g.lineTo=function(g,v){this.addPoint(g,v,MU.PT_CORNER),this._commandX=g,this._commandY=v},g.bezierCurveTo=function(g,v,S,O,X,Y){var te=this._curPath,ti=te.points[te.points.length-1];ti&&(ti.x!==g||ti.y!==v||S!==X||O!==Y?(VV(this,ti.x,ti.y,g,v,S,O,X,Y,0,MU.PT_CORNER),this._commandX=X,this._commandY=Y):this.lineTo(X,Y))},g.quadraticCurveTo=function(g,v,S,O){var X=this._commandX,Y=this._commandY;this.bezierCurveTo(X+2/3*(g-X),Y+2/3*(v-Y),S+2/3*(g-S),O+2/3*(v-O),S,O)},g.arc=function(g,v,S,O,X,Y){!function(g,v,S,O,X,Y,te){var ti,tr,ta=0,th=0,tu=0,tl=0,tc=0,t_=0,tf=0,tp=0,tm=0,tg=0,tv=0,ty=0,tS=0,tA=0;if(th=Y-X,te=te||!1){if(MQ(th)>=2*Mj)th=2*Mj;else for(;th<0;)th+=2*Mj}else if(MQ(th)>=2*Mj)th=2*-Mj;else for(;th>0;)th-=2*Mj;for(tr=0|MK(1,MY(MQ(th)/(.5*Mj)+.5,5)),tu=MQ(4/3*(1-MJ(ti=th/tr/2))/MZ(ti)),te||(tu=-tu),tA=0;tA<=tr;tA++)t_=v+(tl=MJ(ta=X+tA/tr*th))*O,tf=S+(tc=MZ(ta))*O,tp=-tc*O*tu,tm=tl*O*tu,0===tA?g.moveTo(t_,tf):g.bezierCurveTo(tg+ty,tv+tS,t_-tp,tf-tm,t_,tf),tg=t_,tv=tf,ty=tp,tS=tm}(this,g,v,S,O,X,Y)},g.ellipse=function(g,v,S,O){kV(this,g,v,S,O),this._curPath.complex=!1},g.circle=function(g,v,S){kV(this,g,v,S,S),this._curPath.complex=!1},g.rect=function(g,v,S,O){this.moveTo(g,v),this.lineTo(g+S,v),this.lineTo(g+S,v+O),this.lineTo(g,v+O),this.close(),this._curPath.complex=!1},g.roundRect=function(g,v,S,O,X){(function(g,v,S,O,X,Y){if(Y<.1)g.rect(v,S,O,X);else{var te=MY(Y,.5*MQ(O))*M0(O),ti=MY(Y,.5*MQ(X))*M0(X);g.moveTo(v,S+ti),g.lineTo(v,S+X-ti),g.bezierCurveTo(v,S+X-ti*(1-M2),v+te*(1-M2),S+X,v+te,S+X),g.lineTo(v+O-te,S+X),g.bezierCurveTo(v+O-te*(1-M2),S+X,v+O,S+X-ti*(1-M2),v+O,S+X-ti),g.lineTo(v+O,S+ti),g.bezierCurveTo(v+O,S+ti*(1-M2),v+O-te*(1-M2),S,v+O-te,S),g.lineTo(v+te,S),g.bezierCurveTo(v+te*(1-M2),S,v,S+ti*(1-M2),v,S+ti),g.close()}})(this,g,v,S,O,X),this._curPath.complex=!1},g.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var g=this._renderDataList,v=0,S=g.length;v<S;v++){var O=g[v];O&&(Pj.remove(O),O.removeRenderDrawInfo(this._comp))}this._renderDataList.length=0},g.close=function(){this._curPath.closed=!0},g.requestRenderData=function(){var g=Pj.add();return this._renderDataList.push(g),g},g.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},g.addPoint=function(g,v,S){var O=this._curPath;if(O){var X=this._points,Y=O.points,te=X[this.pointsOffset++];te?(te.x=g,te.y=v):(te=new Ok(g,v),X.push(te)),te.flags=S,Y.push(te)}},g._addPath=function(){var g=this.pathLength,v=this.paths[g];return v?v.reset():(v=new OG,this.paths.push(v)),this.pathLength++,this._curPath=v,v},t1}(),OU=Po.concat([new hz("a_dist",oA.R32F)]),OH=qN(OU),Oz=KN(OU),OW=g("G",(M3=nJ("cc.Graphics"),M5=nQ(110),M4=ma(MV),M8=ma(MG),M3(M6=M5(((Ol=function(g){function e(){var v;return(v=g.call(this)||this).impl=null,v.model=null,v._lineWidth=M9&&M9(),v._strokeColor=Ot&&Ot(),v._lineJoin=On&&On(),v._lineCap=Or&&Or(),v._fillColor=Oo&&Oo(),v._miterLimit=Oh&&Oh(),v._isDrawing=!1,v._isNeedUploadData=!0,v._graphicsUseSubMeshes=[],v._instanceMaterialType=Dc.ADD_COLOR,v.impl=new OV(c(v)),v}s(e,g);var v=e.prototype;return v.onRestore=function(){this.impl||this._flushAssembler()},v.onLoad=function(){g.prototype.onLoad.call(this),this.model=II.root.createModel(wh),this.model.node=this.model.transform=this.node,this._flushAssembler()},v.onEnable=function(){g.prototype.onEnable.call(this),this._updateMtlForGraphics()},v.onDestroy=function(){this._sceneGetter=null,this.model&&(II.root.destroyModel(this.model),this.model=null);var v=this._graphicsUseSubMeshes.length;if(v>0){for(var S=0;S<v;++S)this._graphicsUseSubMeshes[S].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),g.prototype.onDestroy.call(this)},v.moveTo=function(g,v){this.impl&&this.impl.moveTo(g,v)},v.lineTo=function(g,v){this.impl&&this.impl.lineTo(g,v)},v.bezierCurveTo=function(g,v,S,O,X,Y){this.impl&&this.impl.bezierCurveTo(g,v,S,O,X,Y)},v.quadraticCurveTo=function(g,v,S,O){this.impl&&this.impl.quadraticCurveTo(g,v,S,O)},v.arc=function(g,v,S,O,X,Y){this.impl&&this.impl.arc(g,v,S,O,X,Y)},v.ellipse=function(g,v,S,O){this.impl&&this.impl.ellipse(g,v,S,O)},v.circle=function(g,v,S){this.impl&&this.impl.circle(g,v,S)},v.rect=function(g,v,S,O){this.impl&&this.impl.rect(g,v,S,O)},v.roundRect=function(g,v,S,O,X){this.impl&&this.impl.roundRect(g,v,S,O,X)},v.fillRect=function(g,v,S,O){this.rect(g,v,S,O),this.fill()},v.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var g=0;g<this.model.subModels.length;g++)this.model.subModels[g].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},v.close=function(){this.impl&&this.impl.close()},v.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},v.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},v._updateMtlForGraphics=function(){var g;this._customMaterial?g=this.getMaterialInstance(0):(g=dU.get("ui-graphics-material"),this.setSharedMaterial(g,0),(g=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},v.activeSubModel=function(g){if(this.model){if(this.model.subModels.length<=g){var v=uZ.gfxDevice,S=v.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,65535*Oz,Oz)),O=v.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),X=new mf([S],OU,oY.TRIANGLE_LIST,O);X.subMeshIdx=0,this.model.initSubModel(g,X,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(X)}}else q(4500,this.node.name)},v._uploadData=function(){var g=this.impl;if(g){var v=g&&g.getRenderDataList();if(!(v.length<=0)&&this.model){for(var S=this.model.subModels,O=0;O<v.length;O++){var X=v[O],Y=S[O].inputAssembler;if(X.lastFilledVertex!==X.vertexStart){var te=new Float32Array(X.vData.buffer,0,X.vertexStart*OH);Y.vertexBuffers[0].update(te),Y.vertexCount=X.vertexStart;var ti=new Uint16Array(X.iData.buffer,0,X.indexStart);Y.indexBuffer.update(ti),Y.indexCount=X.indexStart,X.lastFilledVertex=X.vertexStart,X.lastFilledIndex=X.indexStart}}this._isNeedUploadData=!1}}},v._render=function(g){if(this._isNeedUploadData){if(this.impl){var v=this.impl.getRenderDataList(),S=this.model.subModels.length;if(v.length>S)for(var O=S;O<v.length;O++)this.activeSubModel(O)}this._uploadData()}g.commitModel(this,this.model,this.getMaterialInstance(0))},v._flushAssembler=function(){var g=e.Assembler.getAssembler(this);this._assembler!==g&&(this._assembler=g)},v._canRender=function(){return!!g.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},v.updateRenderer=function(){g.prototype.updateRenderer.call(this)},v.createRenderEntity=function(){return new PH(Px.DYNAMIC)},n(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(g){this._lineWidth=g,this.impl&&(this.impl.lineWidth=g)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(g){this._lineJoin=g,this.impl&&(this.impl.lineJoin=g)}},{key:"lineCap",get:function(){return this._lineCap},set:function(g){this._lineCap=g,this.impl&&(this.impl.lineCap=g)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(g){this.impl&&(this._strokeColor.set(g),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(g){this.impl&&(this._fillColor.set(g),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(g){this._miterLimit=g}},{key:"color",get:function(){return this._color},set:function(g){this._color!==g&&this._color.set(g)}},{key:"graphicsNativeProxy",get:function(){return this._graphicsNativeProxy}}]),e}(Dg)).LineJoin=MV,Ol.LineCap=MG,p((M7=Ol).prototype,"lineJoin",[M4],Object.getOwnPropertyDescriptor(M7.prototype,"lineJoin"),M7.prototype),p(M7.prototype,"lineCap",[M8],Object.getOwnPropertyDescriptor(M7.prototype,"lineCap"),M7.prototype),p(M7.prototype,"color",[rE],Object.getOwnPropertyDescriptor(M7.prototype,"color"),M7.prototype),M9=ws(M7.prototype,"_lineWidth",[n2],function(){return 1}),Ot=ws(M7.prototype,"_strokeColor",[n2],function(){return is.BLACK.clone()}),On=ws(M7.prototype,"_lineJoin",[n2],function(){return MV.MITER}),Or=ws(M7.prototype,"_lineCap",[n2],function(){return MG.BUTT}),Oo=ws(M7.prototype,"_fillColor",[n2],function(){return is.WHITE.clone()}),Oh=ws(M7.prototype,"_miterLimit",[n2],function(){return 10}),M6=M7))||M6)||M6));X.Graphics=OW,function(g){g[g.SIMPLE=0]="SIMPLE",g[g.SLICED=1]="SLICED",g[g.TILED=2]="TILED",g[g.FILLED=3]="FILLED"}(OM||(OM={})),oe(OM),function(g){g[g.HORIZONTAL=0]="HORIZONTAL",g[g.VERTICAL=1]="VERTICAL",g[g.RADIAL=2]="RADIAL"}(OO||(OO={})),oe(OO),function(g){g[g.CUSTOM=0]="CUSTOM",g[g.TRIMMED=1]="TRIMMED",g[g.RAW=2]="RAW"}(OF||(OF={})),oe(OF),function(g){g.SPRITE_FRAME_CHANGED="spriteframe-changed"}(ON||(ON={}));var OX,Oj,Oq,OY,OK,OJ,OZ,OQ,O0,O2,O3=g("i",(Oc=nJ("cc.Sprite"),Od=nQ(110),Op=ma(Bm),Om=ma(Bf),Og=ma(OM),Ov=ma(OO),Oy=ma(OF),Oc(OS=Od(((OD=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._spriteFrame=OT&&OT(),v._type=OE&&OE(),v._fillType=OC&&OC(),v._sizeMode=Ox&&Ox(),v._fillCenter=Ob&&Ob(),v._fillStart=OR&&OR(),v._fillRange=Ow&&Ow(),v._isTrimmedMode=OI&&OI(),v._useGrayscale=OB&&OB(),v._atlas=OP&&OP(),v}s(e,g);var v=e.prototype;return v.__preload=function(){this.changeMaterialForDefine(),g.prototype.__preload.call(this)},v.onEnable=function(){g.prototype.onEnable.call(this),this._activateMaterial();var v=this._spriteFrame;v&&(this._updateUVs(),this._type===OM.SLICED&&v.on(Bf.EVENT_UV_UPDATED,this._updateUVs,this))},v.onDisable=function(){g.prototype.onDisable.call(this),this._spriteFrame&&this._type===OM.SLICED&&this._spriteFrame.off(Bf.EVENT_UV_UPDATED,this._updateUVs,this)},v.onDestroy=function(){g.prototype.onDestroy.call(this)},v.changeSpriteFrameFromAtlas=function(g){if(this._atlas){var v=this._atlas.getSpriteFrame(g);this.spriteFrame=v}else console.warn("SpriteAtlas is null.")},v.changeMaterialForDefine=function(){var g,v=this._instanceMaterialType;this._spriteFrame&&(g=this._spriteFrame.texture);var S=!1;if(_instanceof(g,lJ)){var O=g.getPixelFormat();S=O===lb.RGBA_ETC1||O===lb.RGB_A_PVRTC_4BPPV1||O===lb.RGB_A_PVRTC_2BPPV1}S&&this.grayscale?this._instanceMaterialType=Dc.USE_ALPHA_SEPARATED_AND_GRAY:S?this._instanceMaterialType=Dc.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=Dc.GRAYSCALE:this._instanceMaterialType=Dc.ADD_COLOR_AND_TEXTURE,v!==this._instanceMaterialType&&this.updateMaterial()},v._updateBuiltinMaterial=function(){var v=g.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&_instanceof(this.spriteFrame.texture,pX)){var S=r({SAMPLE_FROM_RT:!0},v.passes[0].defines),O=new pf;O.initialize({effectAsset:v.effectAsset,defines:S}),v=O}return v},v._render=function(g){g.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)},v._canRender=function(){if(!g.prototype._canRender.call(this))return!1;var v=this._spriteFrame;return!(!v||!v.texture)},v._flushAssembler=function(){var g=e.Assembler.getAssembler(this);this._assembler!==g&&(this.destroyRenderData(),this._assembler=g),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this.spriteFrame&&this._assembler.updateUVs(this),this._updateColor()),this._spriteFrame&&(this._type===OM.SLICED?this._spriteFrame.on(Bf.EVENT_UV_UPDATED,this._updateUVs,this):this._spriteFrame.off(Bf.EVENT_UV_UPDATED,this._updateUVs,this))},v._applySpriteSize=function(){if(this._spriteFrame){if(OF.RAW===this._sizeMode){var g=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(g)}else if(OF.TRIMMED===this._sizeMode){var v=this._spriteFrame.rect;this.node._uiProps.uiTransformComp.setContentSize(v.width,v.height)}}},v._resized=function(){},v._activateMaterial=function(){var g=this._spriteFrame,v=this.getRenderMaterial(0);g&&v&&this.markForUpdateRenderData(),this.renderData&&(this.renderData.material=v)},v._updateUVs=function(){this._assembler&&this._assembler.updateUVs(this)},v._applySpriteFrame=function(g){var v=this._spriteFrame;g&&this._type===OM.SLICED&&g.off(Bf.EVENT_UV_UPDATED,this._updateUVs,this);var S=!1;v&&(g&&g.texture===v.texture||(S=!0),S&&(this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine()),this._applySpriteSize(),this._type===OM.SLICED&&v.on(Bf.EVENT_UV_UPDATED,this._updateUVs,this))},n(e,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(g){this._atlas!==g&&(this._atlas=g)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(g){if(this._spriteFrame!==g){var v=this._spriteFrame;this._spriteFrame=g,this.markForUpdateRenderData(),this._applySpriteFrame(v)}}},{key:"type",get:function(){return this._type},set:function(g){this._type!==g&&(this._type=g,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(g){this._fillType!==g&&(g===OO.RADIAL||this._fillType===OO.RADIAL?this.destroyRenderData():this.renderData&&this.markForUpdateRenderData(!0)),this._fillType=g,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(g){this._fillCenter.x=g.x,this._fillCenter.y=g.y,this._type===OM.FILLED&&this.renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(g){this._fillStart=mi(g,0,1),this._type===OM.FILLED&&this.renderData&&(this.markForUpdateRenderData(),this._updateUVs())}},{key:"fillRange",get:function(){return this._fillRange},set:function(g){this._fillRange=mi(g,-1,1),this._type===OM.FILLED&&this.renderData&&(this.markForUpdateRenderData(),this._updateUVs())}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(g){this._isTrimmedMode!==g&&(this._isTrimmedMode=g,this._type===OM.SIMPLE&&this.renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(g){this._useGrayscale!==g&&(this._useGrayscale=g,this.changeMaterialForDefine(),this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(g){this._sizeMode!==g&&(this._sizeMode=g,g!==OF.CUSTOM&&this._applySpriteSize())}}]),e}(Dg)).FillType=OO,OD.Type=OM,OD.SizeMode=OF,OD.EventType=ON,p((OA=OD).prototype,"spriteAtlas",[Op],Object.getOwnPropertyDescriptor(OA.prototype,"spriteAtlas"),OA.prototype),p(OA.prototype,"spriteFrame",[Om],Object.getOwnPropertyDescriptor(OA.prototype,"spriteFrame"),OA.prototype),p(OA.prototype,"type",[Og],Object.getOwnPropertyDescriptor(OA.prototype,"type"),OA.prototype),p(OA.prototype,"fillType",[Ov],Object.getOwnPropertyDescriptor(OA.prototype,"fillType"),OA.prototype),p(OA.prototype,"sizeMode",[Oy],Object.getOwnPropertyDescriptor(OA.prototype,"sizeMode"),OA.prototype),OT=ws(OA.prototype,"_spriteFrame",[n2],function(){return null}),OE=ws(OA.prototype,"_type",[n2],function(){return OM.SIMPLE}),OC=ws(OA.prototype,"_fillType",[n2],function(){return OO.HORIZONTAL}),Ox=ws(OA.prototype,"_sizeMode",[n2],function(){return OF.TRIMMED}),Ob=ws(OA.prototype,"_fillCenter",[n2],function(){return new e8(0,0)}),OR=ws(OA.prototype,"_fillStart",[n2],function(){return 0}),Ow=ws(OA.prototype,"_fillRange",[n2],function(){return 0}),OI=ws(OA.prototype,"_isTrimmedMode",[n2],function(){return!0}),OB=ws(OA.prototype,"_useGrayscale",[n2],function(){return!1}),OP=ws(OA.prototype,"_atlas",[n2],function(){return null}),OS=OA))||OS)||OS));X.Sprite=O3;var O4,O8=new e$,O6=new e8,O7=new e$,O9=[];!function(g){g[g.GRAPHICS_RECT=0]="GRAPHICS_RECT",g[g.GRAPHICS_ELLIPSE=1]="GRAPHICS_ELLIPSE",g[g.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",g[g.SPRITE_STENCIL=3]="SPRITE_STENCIL"}(O4||(O4={})),oe(O4);var Li,Ln=g("f",(OX=nJ("cc.Mask"),Oj=nQ(110),Oq=ma(O4),OX(OY=Oj(((O2=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._type=OJ&&OJ(),v._inverted=OZ&&OZ(),v._segments=OQ&&OQ(),v._alphaThreshold=O0&&O0(),v._sprite=null,v._graphics=null,v._stencilStage=Pg.DISABLED,v}s(e,g);var v=e.prototype;return v.onLoad=function(){this._changeRenderType()},v.onEnable=function(){this._changeRenderType(),this._updateGraphics(),this._enableRender(),this.node.on(md.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(md.SIZE_CHANGED,this._nodeStateChange,this)},v.onRestore=function(){this._changeRenderType(),this._updateGraphics()},v.onDisable=function(){this._disableRender(),this.node.off(md.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(md.SIZE_CHANGED,this._nodeStateChange,this)},v.onDestroy=function(){this._removeMaskNode()},v.isHit=function(g){var v=this.node._uiProps.uiTransformComp,S=v.contentSize,O=S.width,X=S.height,Y=O6;this.node.getWorldMatrix(O8),e$.invert(O7,O8),e8.transformMat4(Y,g,O7);var te=v.anchorPoint;Y.x+=te.x*O,Y.y+=te.y*X;var ti=!1;if(this.type===O4.GRAPHICS_RECT||this.type===O4.GRAPHICS_STENCIL||this.type===O4.SPRITE_STENCIL)ti=Y.x>=0&&Y.y>=0&&Y.x<=O&&Y.y<=X;else if(this.type===O4.GRAPHICS_ELLIPSE){var tr=O/2,ta=X/2,th=Y.x-.5*O,tu=Y.y-.5*X;ti=th*th/(tr*tr)+tu*tu/(ta*ta)<1}return this._inverted&&(ti=!ti),ti},v._nodeStateChange=function(){this._updateGraphics()},v._changeRenderType=function(){this._type!==O4.SPRITE_STENCIL?this._createGraphics():this._createSprite()},v._createSprite=function(){if(!this._sprite){var g=this._sprite=this.node.getComponent(O3);if(!g){var v=this.node;g=this._sprite=v.addComponent(O3)}}this._sprite.stencilStage=this.inverted?Pg.ENTER_LEVEL_INVERTED:Pg.ENTER_LEVEL,this._sprite.updateMaterial()},v._createGraphics=function(){if(!this._graphics){var g=this._graphics=this.node.getComponent(OW);if(!g){var v=this.node;g=this._graphics=v.addComponent(OW)}g.lineWidth=1;var S=is.WHITE.clone();S.a=0,g.fillColor=S}this._graphics.stencilStage=this.inverted?Pg.ENTER_LEVEL_INVERTED:Pg.ENTER_LEVEL},v._updateGraphics=function(){if(this._graphics&&(this._type===O4.GRAPHICS_RECT||this._type===O4.GRAPHICS_ELLIPSE)){var g=this.node._uiProps.uiTransformComp,v=this._graphics;v.clear();var S=g.contentSize,O=S.width,X=S.height,Y=g.anchorPoint,te=-O*Y.x,ti=-X*Y.y;if(this._type===O4.GRAPHICS_RECT)v.rect(te,ti,O,X);else if(this._type===O4.GRAPHICS_ELLIPSE){for(var tr=function(g,v,S){O9.length=0;for(var O=2*Math.PI/S,X=0;X<S;++X)O9.push(new eL(v.x*Math.cos(O*X)+g.x,v.y*Math.sin(O*X)+g.y,0));return O9}(new eL(te+O/2,ti+X/2,0),new eL(O/2,X/2,0),this._segments),ta=0;ta<tr.length;++ta){var th=tr[ta];0===ta?v.moveTo(th.x,th.y):v.lineTo(th.x,th.y)}v.close()}v.fill()}},v._enableRender=function(){this.subComp&&(this.subComp.enabled=!0)},v._disableRender=function(){this.subComp&&(this.subComp.stencilStage=Pg.DISABLED,this.subComp.updateMaterial(),this.node.activeInHierarchy&&(this.subComp.enabled=!1))},v._removeMaskNode=function(){this._sprite&&(this._sprite=null),this._graphics&&(this._graphics=null)},v.markForUpdateRenderData=function(g){void 0===g&&(g=!0),q(9007),this.subComp&&this.subComp.markForUpdateRenderData(g)},v.requestRenderData=function(){q(9007)},v.destroyRenderData=function(){q(9007)},v.updateRenderer=function(){q(9007),this.subComp&&this.subComp.updateRenderer()},v.fillBuffers=function(){q(9007)},v.postUpdateAssembler=function(){q(9007)},v.setNodeDirty=function(){q(9007),this.subComp&&this.subComp.setNodeDirty()},v.setTextureDirty=function(){q(9007),this.subComp&&this.subComp.setTextureDirty()},v.getMaterial=function(g){return q(9007),this.subComp?this.subComp.getSharedMaterial(g):null},v.setMaterial=function(g,v){q(9007),this.subComp&&this.subComp.setMaterial(g,v)},v.getMaterialInstance=function(g){return q(9007),this.subComp?this.subComp.getMaterialInstance(g):null},v.setMaterialInstance=function(g,v){q(9007),this.subComp&&this.subComp.setMaterialInstance(g,v)},v.getRenderMaterial=function(g){return q(9007),this.subComp?this.subComp.getRenderMaterial(g):null},n(e,[{key:"type",get:function(){return this._type},set:function(g){this._type!==g&&(this._type=g,this._type!==O4.SPRITE_STENCIL?(this._sprite&&(this.node.removeComponent(O3),this._sprite._destroyImmediate(),this._sprite=null),this._changeRenderType(),this._updateGraphics()):(this._graphics&&(this._graphics.clear(),this.node.removeComponent(OW),this._graphics._destroyImmediate(),this._graphics=null),this._changeRenderType()))}},{key:"inverted",get:function(){return this._inverted},set:function(g){this._inverted=g,this.subComp.stencilStage=this.inverted?Pg.ENTER_LEVEL_INVERTED:Pg.ENTER_LEVEL}},{key:"segments",get:function(){return this._segments},set:function(g){this._segments!==g&&(this._segments=mi(g,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._sprite?this._sprite.spriteFrame:null},set:function(g){this._sprite?this._sprite.spriteFrame=g:k("please change type to sprite_stencil first")}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(g){this._alphaThreshold!==g&&(this._alphaThreshold=g,this.type===O4.SPRITE_STENCIL&&this._sprite&&this._sprite.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"subComp",get:function(){return this._graphics||this._sprite}},{key:"customMaterial",get:function(){return q(9007),this.subComp?this.subComp.customMaterial:null},set:function(g){q(9007),this.subComp&&(this.subComp.customMaterial=g)}},{key:"color",get:function(){return q(9007),this.subComp?this.subComp.color:null},set:function(g){q(9007),this.subComp&&g&&(this.subComp.color=g)}},{key:"sharedMaterial",get:function(){return q(9007),this.subComp?this.subComp.sharedMaterial:null}},{key:"sharedMaterials",get:function(){return q(9007),this.subComp?this.subComp.sharedMaterials:null},set:function(g){q(9007),this.subComp&&g&&(this.subComp.sharedMaterials=g)}},{key:"material",get:function(){return q(9007),this.subComp?this.subComp.material:null},set:function(g){q(9007),this.subComp&&(this.subComp.material=g)}},{key:"materials",get:function(){return q(9007),this.subComp?this.subComp.materials:[null]},set:function(g){q(9007),this.subComp&&(this.subComp.materials=g)}}]),e}(cS)).Type=O4,p((OK=O2).prototype,"type",[Oq],Object.getOwnPropertyDescriptor(OK.prototype,"type"),OK.prototype),OJ=ws(OK.prototype,"_type",[n2],function(){return O4.GRAPHICS_RECT}),OZ=ws(OK.prototype,"_inverted",[n2],function(){return!1}),OQ=ws(OK.prototype,"_segments",[n2],function(){return 64}),O0=ws(OK.prototype,"_alphaThreshold",[n2],function(){return .1}),OY=OK))||OY)||OY));wH._maskComp=Ln,X.Mask=Ln;var Lr,Lo,Lh,Ll,Lc,L_,Ld=g("k",nJ("cc.LabelOutline")(Li=nQ(110)(Li=nZ(Mt)(Li=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.onEnable=function(){this.node.getComponent(Mt).enableOutline=!0},v.onDisable=function(){this.node.getComponent(Mt).enableOutline=!1},n(e,[{key:"color",get:function(){return this.node.getComponent(Mt).outlineColor},set:function(g){this.node.getComponent(Mt).outlineColor=g}},{key:"width",get:function(){return this.node.getComponent(Mt).outlineWidth},set:function(g){this.node.getComponent(Mt).outlineWidth=g}}]),e}(cS))||Li)||Li)||Li);X.LabelOutline=Ld;var Lp,Lg,LS,LA,LT,LE,LC,Lx,Lb,Lw,LI,LB,LP,LD,LM,LO,LL,LF,LN,Lk,LG,LV,LU,LH,Lz,LW,LX,Lj,Lq,LY,LK,LJ,LQ,L0,L1,L2,L3=nJ("cc.PostProcess")(Lr=n0(((L_=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).global=Lh&&Lh(),v._shadingScale=Ll&&Ll(),v.enableShadingScaleInEditor=Lc&&Lc(),v.settings=new Map,v}s(e,g);var v=e.prototype;return v.addSetting=function(g){this.settings.set(g.constructor,g)},v.removeSetting=function(g){this.settings.delete(g.constructor)},v.getSetting=function(g){return this.settings.get(g)},v.onEnable=function(){e.all.push(this)},v.onDisable=function(){var g=e.all.indexOf(this);-1!==g&&e.all.splice(g,1)},n(e,[{key:"shadingScale",get:function(){return this._shadingScale},set:function(g){this._shadingScale=g}}]),e}(cS)).all=[],Lh=ws((Lo=L_).prototype,"global",[Us,n2],function(){return!0}),Ll=ws(Lo.prototype,"_shadingScale",[n2],function(){return 1}),p(Lo.prototype,"shadingScale",[Us],Object.getOwnPropertyDescriptor(Lo.prototype,"shadingScale"),Lo.prototype),Lc=ws(Lo.prototype,"enableShadingScaleInEditor",[Us,n2],function(){return!1}),Lr=Lo))||Lr)||Lr,L5=new eL,L4=re(pr),L8=re(pe),L6=re(ps),L7=re(ph),L9=re(pa),Ft=re({SKYBOX:pA|o7.DEPTH_STENCIL,SOLID_COLOR:o7.ALL,DEPTH_ONLY:o7.DEPTH_STENCIL,DONT_CLEAR:o7.NONE}),Fi=g("dC",(Lp=nJ("cc.Camera"),Lg=ma(_a.BitMask),LS=ma(Ft),LA=ma(L4),LT=ma(L8),LE=ma(L6),LC=ma(L7),Lx=ma(L9),Lb=ma(pX),Lw=ma(L3),Lp(((L1=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._projection=LP&&LP(),v._priority=LD&&LD(),v._fov=LM&&LM(),v._fovAxis=LO&&LO(),v._orthoHeight=LL&&LL(),v._near=LF&&LF(),v._far=LN&&LN(),v._color=Lk&&Lk(),v._depth=LG&&LG(),v._stencil=LV&&LV(),v._clearFlags=LU&&LU(),v._rect=LH&&LH(),v._aperture=Lz&&Lz(),v._shutter=LW&&LW(),v._iso=LX&&LX(),v._screenScale=Lj&&Lj(),v._visibility=Lq&&Lq(),v._targetTexture=LY&&LY(),v._postProcess=LK&&LK(),v._usePostProcess=LJ&&LJ(),v._camera=null,v._inEditorMode=!1,v._flows=void 0,v._cameraType=LQ&&LQ(),v._trackingType=L0&&L0(),v}s(e,g);var v=e.prototype;return v.onLoad=function(){this._createCamera()},v.onEnable=function(){this.node.hasChangedFlags|=pq.POSITION,this._camera&&this._attachToScene()},v.onDisable=function(){this._camera&&this._detachFromScene()},v.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},v.screenPointToRay=function(g,v,S){return S||(S=iL.create()),this._camera&&this._camera.screenPointToRay(S,g,v),S},v.worldToScreen=function(g,v){return v||(v=new eL),this._camera&&this._camera.worldToScreen(v,g),v},v.screenToWorld=function(g,v){return v||(v=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(v,g),v},v.convertToUINode=function(g,v,S){if(S||(S=new eL),!this._camera)return S;this.worldToScreen(g,L5);var O=v.getComponent("cc.UITransform"),Y=X.view.getVisibleSize(),te=L5.x-.5*this._camera.width,ti=L5.y-.5*this._camera.height;return L5.x=te/X.view.getScaleX()+.5*Y.width,L5.y=ti/X.view.getScaleY()+.5*Y.height,O&&O.convertToNodeSpaceAR(L5,S),S},v._createCamera=function(){this._camera||(this._camera=X.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?X.director.root&&X.director.root.mainWindow:X.director.root&&X.director.root.tempWindow,priority:this._priority,cameraType:this.cameraType,trackingType:this.trackingType}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=yi(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso,this._camera.postProcess=this._postProcess,this._camera.usePostProcess=this._usePostProcess),this._updateTargetTexture()},v._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},v._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},v._checkTargetTextureEvent=function(g){var v=this;g&&g.off("resize"),this._targetTexture&&this._targetTexture.on("resize",function(g){v._camera&&v._camera.setFixedSize(g.width,g.height)},this)},v._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var g=this._targetTexture.window;this._camera.changeTargetWindow(g),this._camera.setFixedSize(g.width,g.height)}},n(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(g){this._priority=g,this._camera&&(this._camera.priority=g)}},{key:"visibility",get:function(){return this._visibility},set:function(g){this._visibility=g,this._camera&&(this._camera.visibility=g)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(g){this._clearFlags=g,this._camera&&(this._camera.clearFlag=g)}},{key:"clearColor",get:function(){return this._color},set:function(g){this._color.set(g),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(g){this._depth=g,this._camera&&(this._camera.clearDepth=g)}},{key:"clearStencil",get:function(){return this._stencil},set:function(g){this._stencil=g,this._camera&&(this._camera.clearStencil=g)}},{key:"projection",get:function(){return this._projection},set:function(g){this._projection=g,this._camera&&(this._camera.projectionType=g)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(g){g!==this._fovAxis&&(this._fovAxis=g,this._camera&&(this._camera.fovAxis=g,g===pe.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(g){this._fov=g,this._camera&&(this._camera.fov=yi(g))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(g){this._orthoHeight=g,this._camera&&(this._camera.orthoHeight=g)}},{key:"near",get:function(){return this._near},set:function(g){this._near=g,this._camera&&(this._camera.nearClip=g)}},{key:"far",get:function(){return this._far},set:function(g){this._far=g,this._camera&&(this._camera.farClip=g)}},{key:"aperture",get:function(){return this._aperture},set:function(g){this._aperture=g,this._camera&&(this._camera.aperture=g)}},{key:"shutter",get:function(){return this._shutter},set:function(g){this._shutter=g,this._camera&&(this._camera.shutter=g)}},{key:"iso",get:function(){return this._iso},set:function(g){this._iso=g,this._camera&&(this._camera.iso=g)}},{key:"rect",get:function(){return this._rect},set:function(g){this._rect=g,this._camera&&this._camera.setViewportInOrientedSpace(g)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(g){if(this._targetTexture!==g){var v=this._targetTexture;this._targetTexture=g,this._checkTargetTextureEvent(v),this._updateTargetTexture(),!g&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit(e.TARGET_TEXTURE_CHANGE,this)}}},{key:"usePostProcess",get:function(){return this._usePostProcess},set:function(g){this._usePostProcess=g,this._camera&&(this._camera.usePostProcess=g)}},{key:"postProcess",get:function(){return this._postProcess},set:function(g){this._postProcess=g,this._camera&&(this._camera.postProcess=g)}},{key:"screenScale",get:function(){return this._screenScale},set:function(g){this._screenScale=g,this._camera&&(this._camera.screenScale=g)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(g){this._inEditorMode=g,this._camera&&this._camera.changeTargetWindow(g?X.director.root&&X.director.root.mainWindow:X.director.root&&X.director.root.tempWindow)}},{key:"cameraType",get:function(){return this._cameraType},set:function(g){this._cameraType!==g&&(this._cameraType=g,this.camera&&(this.camera.cameraType=g))}},{key:"trackingType",get:function(){return this._trackingType},set:function(g){this._trackingType!==g&&(this._trackingType=g,this.camera&&(this.camera.trackingType=g))}}]),e}(cS)).ProjectionType=L4,L1.FOVAxis=L8,L1.ClearFlag=Ft,L1.Aperture=L6,L1.Shutter=L7,L1.ISO=L9,L1.TARGET_TEXTURE_CHANGE="tex-change",LP=ws((LB=L1).prototype,"_projection",[n2],function(){return L4.PERSPECTIVE}),LD=ws(LB.prototype,"_priority",[n2],function(){return 0}),LM=ws(LB.prototype,"_fov",[n2],function(){return 45}),LO=ws(LB.prototype,"_fovAxis",[n2],function(){return L8.VERTICAL}),LL=ws(LB.prototype,"_orthoHeight",[n2],function(){return 10}),LF=ws(LB.prototype,"_near",[n2],function(){return 1}),LN=ws(LB.prototype,"_far",[n2],function(){return 1e3}),Lk=ws(LB.prototype,"_color",[n2],function(){return new is("#333333")}),LG=ws(LB.prototype,"_depth",[n2],function(){return 1}),LV=ws(LB.prototype,"_stencil",[n2],function(){return 0}),LU=ws(LB.prototype,"_clearFlags",[n2],function(){return Ft.SOLID_COLOR}),LH=ws(LB.prototype,"_rect",[n2],function(){return new ic(0,0,1,1)}),Lz=ws(LB.prototype,"_aperture",[n2],function(){return L6.F16_0}),LW=ws(LB.prototype,"_shutter",[n2],function(){return L7.D125}),LX=ws(LB.prototype,"_iso",[n2],function(){return L9.ISO100}),Lj=ws(LB.prototype,"_screenScale",[n2],function(){return 1}),Lq=ws(LB.prototype,"_visibility",[n2],function(){return fx}),LY=ws(LB.prototype,"_targetTexture",[n2],function(){return null}),LK=ws(LB.prototype,"_postProcess",[n2],function(){return null}),LJ=ws(LB.prototype,"_usePostProcess",[n2],function(){return!1}),LQ=ws(LB.prototype,"_cameraType",[n2],function(){return pu.DEFAULT}),L0=ws(LB.prototype,"_trackingType",[n2],function(){return pl.NO_TRACKING}),p(LB.prototype,"visibility",[Lg],Object.getOwnPropertyDescriptor(LB.prototype,"visibility"),LB.prototype),p(LB.prototype,"clearFlags",[LS],Object.getOwnPropertyDescriptor(LB.prototype,"clearFlags"),LB.prototype),p(LB.prototype,"projection",[LA],Object.getOwnPropertyDescriptor(LB.prototype,"projection"),LB.prototype),p(LB.prototype,"fovAxis",[LT],Object.getOwnPropertyDescriptor(LB.prototype,"fovAxis"),LB.prototype),p(LB.prototype,"aperture",[LE],Object.getOwnPropertyDescriptor(LB.prototype,"aperture"),LB.prototype),p(LB.prototype,"shutter",[LC],Object.getOwnPropertyDescriptor(LB.prototype,"shutter"),LB.prototype),p(LB.prototype,"iso",[Lx],Object.getOwnPropertyDescriptor(LB.prototype,"iso"),LB.prototype),p(LB.prototype,"targetTexture",[Lb],Object.getOwnPropertyDescriptor(LB.prototype,"targetTexture"),LB.prototype),p(LB.prototype,"usePostProcess",[Us],Object.getOwnPropertyDescriptor(LB.prototype,"usePostProcess"),LB.prototype),p(LB.prototype,"postProcess",[Lw],Object.getOwnPropertyDescriptor(LB.prototype,"postProcess"),LB.prototype),LI=LB))||LI));X.Camera=Fi;var Fn=new iu,Fr=((L2={})[t$.ORIENTATION_AUTO]=tZ.AUTO,L2[t$.ORIENTATION_LANDSCAPE]=tZ.LANDSCAPE,L2[t$.ORIENTATION_PORTRAIT]=tZ.PORTRAIT,L2),Fo=g("fj",function(g){function e(){var v;(v=g.call(this)||this)._designResolutionSize=void 0,v._scaleX=void 0,v._scaleY=void 0,v._viewportRect=void 0,v._visibleRect=void 0,v._autoFullScreen=void 0,v._retinaEnabled=void 0,v._resizeCallback=void 0,v._resolutionPolicy=void 0,v._rpExactFit=void 0,v._rpShowAll=void 0,v._rpNoBorder=void 0,v._rpFixedHeight=void 0,v._rpFixedWidth=void 0;var S=Fh,O=Fl;return v._designResolutionSize=new iu(0,0),v._scaleX=1,v._scaleY=1,v._viewportRect=new ic(0,0,0,0),v._visibleRect=new ic(0,0,0,0),v._autoFullScreen=!1,v._retinaEnabled=!1,v._resizeCallback=null,v._rpExactFit=new Fc(S.EQUAL_TO_FRAME,O.EXACT_FIT),v._rpShowAll=new Fc(S.EQUAL_TO_FRAME,O.SHOW_ALL),v._rpNoBorder=new Fc(S.EQUAL_TO_FRAME,O.NO_BORDER),v._rpFixedHeight=new Fc(S.EQUAL_TO_FRAME,O.FIXED_HEIGHT),v._rpFixedWidth=new Fc(S.EQUAL_TO_FRAME,O.FIXED_WIDTH),v._resolutionPolicy=v._rpShowAll,v}s(e,g);var v=e.prototype;return v.init=function(){var g=a1.windowSize,v=g.width,S=g.height;this._designResolutionSize.width=v,this._designResolutionSize.height=S,this._viewportRect.width=v,this._viewportRect.height=S,this._visibleRect.width=v,this._visibleRect.height=S,Fn.width=this._visibleRect.width,Fn.height=this._visibleRect.height,a4&&a4.init(this._visibleRect),this.resizeWithBrowserSize(!0);var O=tQ.querySettings(tK.Category.SCREEN,"designResolution");O&&this.setDesignResolutionSize(Number(O.width),Number(O.height),O.policy||Fc.FIXED_HEIGHT),a1.on("window-resize",this._updateAdaptResult,this),a1.on("fullscreen-change",this._updateAdaptResult,this)},v.resizeWithBrowserSize=function(g){a$.handleResizeEvent=g},v.setResizeCallback=function(g){"function"!=typeof g&&null!=g||(this._resizeCallback=g)},v.setOrientation=function(g){a$.orientation=Fr[g]},v.adjustViewportMeta=function(){},v.enableRetina=function(g){this._retinaEnabled=!!g},v.isRetinaEnabled=function(){return this._retinaEnabled},v.enableAutoFullScreen=function(g){g!==this._autoFullScreen&&(this._autoFullScreen=g,g&&a1.requestFullScreen().catch(function(){}))},v.isAutoFullScreenEnabled=function(){return this._autoFullScreen},v.setCanvasSize=function(g,v){a$.resolutionScale=1;var S=a$.devicePixelRatio,O=new iu(g*S,v*S);a1.windowSize=O},v.getCanvasSize=function(){return a1.windowSize},v.getFrameSize=function(){var g=a$.devicePixelRatio,v=a1.windowSize;return v.width/=g,v.height/=g,v},v.setFrameSize=function(g,v){var S=a$.devicePixelRatio;a1.windowSize=new iu(g*S,v*S)},v.getVisibleSize=function(){return new iu(this._visibleRect.width,this._visibleRect.height)},v.getVisibleSizeInPixel=function(){return new iu(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},v.getVisibleOrigin=function(){return new e8(this._visibleRect.x,this._visibleRect.y)},v.getVisibleOriginInPixel=function(){return new e8(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},v.getResolutionPolicy=function(){return this._resolutionPolicy},v._updateResolutionPolicy=function(g){if(_instanceof(g,Fc))this._resolutionPolicy=g;else{var v=Fc;g===v.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),g===v.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),g===v.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),g===v.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),g===v.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},v.setResolutionPolicy=function(g){this._updateResolutionPolicy(g);var v=Fd.getDesignResolutionSize();Fd.setDesignResolutionSize(v.width,v.height,g)},v.setDesignResolutionSize=function(g,v,S){if(g>0&&v>0){this._updateResolutionPolicy(S);var O=this._resolutionPolicy;O&&O.preApply(this),this._designResolutionSize.width=g,this._designResolutionSize.height=v;var X=O.apply(this,this._designResolutionSize);if(X.scale&&2===X.scale.length&&(this._scaleX=X.scale[0],this._scaleY=X.scale[1]),X.viewport){var Y=this._viewportRect,te=this._visibleRect,ti=X.viewport;Y.x=ti.x,Y.y=ti.y,Y.width=ti.width,Y.height=ti.height,te.x=0,te.y=0,te.width=ti.width/this._scaleX,te.height=ti.height/this._scaleY}O.postApply(this),Fn.width=this._visibleRect.width,Fn.height=this._visibleRect.height,a4&&a4.init(this._visibleRect),this.emit("design-resolution-changed")}else J(2200)},v.getDesignResolutionSize=function(){return new iu(this._designResolutionSize.width,this._designResolutionSize.height)},v.setRealPixelResolution=function(g,v,S){document.documentElement.style.width=g+"px",document.body.style.width=g+"px",document.body.style.left="0px",document.body.style.top="0px",this.setDesignResolutionSize(g,v,S)},v.getViewportRect=function(){return this._viewportRect},v.getScaleX=function(){return this._scaleX},v.getScaleY=function(){return this._scaleY},v.getDevicePixelRatio=function(){return a$.devicePixelRatio},v.convertToLocationInView=function(g,v,S,O){void 0===O&&(O=new e8);var X=a$.devicePixelRatio*(g-S.left),Y=a$.devicePixelRatio*(S.top+S.height-v);return a$.isFrameRotated?(O.x=a1.windowSize.width-Y,O.y=X):(O.x=X,O.y=Y),O},v._convertToUISpace=function(g){var v=this._viewportRect;g.x=(g.x-v.x)/this._scaleX,g.y=(g.y-v.y)/this._scaleY},v._updateAdaptResult=function(g,v,S){var O;X.director.root.resize(g,v,void 0===S||0===S?1:S);var Y=this._designResolutionSize.width,te=this._designResolutionSize.height;g>0&&v>0?this.setDesignResolutionSize(Y,te,this._resolutionPolicy):V(!1,"_updateAdaptResult Invalid size."),this.emit("canvas-resize"),null===(O=this._resizeCallback)||void 0===O||O.call(this)},e}(Su(a8)));Fo.instance=void 0;var Fh=function(){function t1(){this.name="ContainerStrategy"}var g=t1.prototype;return g.preApply=function(){},g.apply=function(){},g.postApply=function(){},g._setupCanvas=function(){var g=X.game.canvas;if(g){var v=a1.windowSize;g.width!==v.width&&(g.width=v.width),g.height!==v.height&&(g.height=v.height)}},t1}();Fh.EQUAL_TO_FRAME=void 0,Fh.PROPORTION_TO_FRAME=void 0;var Fl=function(){function t1(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var g=t1.prototype;return g.preApply=function(){},g.apply=function(){return{scale:[1,1]}},g.postApply=function(){},g._buildResult=function(g,v,S,O,X,Y){Math.abs(g-S)<2&&(S=g),Math.abs(v-O)<2&&(O=v);var te=new ic(Math.round((g-S)/2),Math.round((v-O)/2),S,O);return this._result.scale=[X,Y],this._result.viewport=te,this._result},t1}();Fl.EXACT_FIT=void 0,Fl.SHOW_ALL=void 0,Fl.NO_BORDER=void 0,Fl.FIXED_HEIGHT=void 0,Fl.FIXED_WIDTH=void 0,function(){var g=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).name="EqualToFrame",v}return s(e,g),e.prototype.apply=function(){a$.isProportionalToFrame=!1,this._setupCanvas()},e}(Fh),v=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).name="ProportionalToFrame",v}return s(e,g),e.prototype.apply=function(){a$.isProportionalToFrame=!0,this._setupCanvas()},e}(Fh);Fh.EQUAL_TO_FRAME=new g,Fh.PROPORTION_TO_FRAME=new v;var S=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).name="ExactFit",v}return s(e,g),e.prototype.apply=function(g,v){var S=a1.windowSize,O=S.width,X=S.height,Y=O/v.width,te=X/v.height;return this._buildResult(O,X,O,X,Y,te)},e}(Fl),O=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).name="ShowAll",v}return s(e,g),e.prototype.apply=function(g,v){var S,O,X=a1.windowSize,Y=X.width,te=X.height,ti=v.width,tr=v.height,ta=Y/ti,th=te/tr,tu=0;return ta<th?(S=Y,O=tr*(tu=ta)):(S=ti*(tu=th),O=te),this._buildResult(Y,te,S,O,tu,tu)},e}(Fl),X=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).name="NoBorder",v}return s(e,g),e.prototype.apply=function(g,v){var S,O,X,Y=a1.windowSize,te=Y.width,ti=Y.height,tr=v.width,ta=v.height,th=te/tr,tu=ti/ta;return th<tu?(O=tr*(S=tu),X=ti):(O=te,X=ta*(S=th)),this._buildResult(te,ti,O,X,S,S)},e}(Fl),Y=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).name="FixedHeight",v}return s(e,g),e.prototype.apply=function(g,v){var S=a1.windowSize,O=S.width,X=S.height,Y=X/v.height,te=O,ti=X;return this._buildResult(O,X,te,ti,Y,Y)},e}(Fl),te=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).name="FixedWidth",v}return s(e,g),e.prototype.apply=function(g,v){var S=a1.windowSize,O=S.width,X=S.height,Y=O/v.width,te=O,ti=X;return this._buildResult(O,X,te,ti,Y,Y)},e}(Fl);Fl.EXACT_FIT=new S,Fl.SHOW_ALL=new O,Fl.NO_BORDER=new X,Fl.FIXED_HEIGHT=new Y,Fl.FIXED_WIDTH=new te}();var Fc=g("fk",function(){function t1(g,v){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(g),this.setContentStrategy(v)}var g=t1.prototype;return g.preApply=function(g){this._contentStrategy.preApply(g)},g.apply=function(g,v){return this._containerStrategy.apply(g,v),this._contentStrategy.apply(g,v)},g.postApply=function(g){this._contentStrategy.postApply(g)},g.setContainerStrategy=function(g){_instanceof(g,Fh)&&(this._containerStrategy=g)},g.setContentStrategy=function(g){_instanceof(g,Fl)&&(this._contentStrategy=g)},n(t1,[{key:"canvasSize",get:function(){return a1.windowSize}}]),t1}());Fc.EXACT_FIT=0,Fc.NO_BORDER=1,Fc.SHOW_ALL=2,Fc.FIXED_HEIGHT=3,Fc.FIXED_WIDTH=4,Fc.UNKNOWN=5,Fc.ContainerStrategy=Fh,Fc.ContentStrategy=Fl,X.ResolutionPolicy=Fc;var F_,Fd=g("fl",Fo.instance=X.view=new Fo);II.registerSystem("view",Fd,0),X.winSize=Fn;var Fp,Fm,Fg,Fy,FS,FA,FT,FE,FC,Fx=g("R",nJ("cc.RenderRoot2D")(F_=nQ(100)(F_=nZ(P2)(F_=n0(F_=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.onEnable=function(){X.director.root.batcher2D.addScreen(this)},v.onDisable=function(){X.director.root.batcher2D.removeScreen(this)},v.onDestroy=function(){X.director.root.batcher2D.removeScreen(this)},e}(cS))||F_)||F_)||F_)||F_),Fb=new eL,FR=re({OVERLAY:0,INTERSPERSE:1}),Fw=g("C",(Fp=nJ("cc.Canvas"),Fm=nQ(100),Fg=ma(Fi),Fy=ma(Fi),Fp(FS=Fm(FS=n0((p((FA=function(g){function e(){var v;return(v=g.call(this)||this)._cameraComponent=FT&&FT(),v._alignCanvasWithScreen=FE&&FE(),v._thisOnCameraResized=void 0,v.fitDesignResolution_EDITOR=void 0,v._pos=new eL,v._renderMode=FR.OVERLAY,v._thisOnCameraResized=v._onResizeCamera.bind(c(v)),v}s(e,g);var v=e.prototype;return v.__preload=function(){var g=this.getComponent("cc.Widget");g&&g.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on(Fi.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)),this._onResizeCamera(),this.node.on(md.TRANSFORM_CHANGED,this._thisOnCameraResized)},v.onEnable=function(){g.prototype.onEnable.call(this),this._cameraComponent&&this._cameraComponent.node.on(Fi.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},v.onDisable=function(){g.prototype.onDisable.call(this),this._cameraComponent&&this._cameraComponent.node.off(Fi.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},v.onDestroy=function(){g.prototype.onDestroy.call(this),this.node.off(md.TRANSFORM_CHANGED,this._thisOnCameraResized)},v._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture)this._cameraComponent.orthoHeight=a4.height/2;else{var g=a1.windowSize;this._cameraComponent.orthoHeight=g.height/Fd.getScaleY()/2}this.node.getWorldPosition(Fb),this._cameraComponent.node.setWorldPosition(Fb.x,Fb.y,1e3)}},v._getViewPriority=function(){if(this._cameraComponent){var g,v=null===(g=this.cameraComponent)||void 0===g?void 0:g.priority;return this._renderMode===FR.OVERLAY?0x40000000|v:-0x40000001&v}return 0},n(e,[{key:"renderMode",get:function(){return this._renderMode},set:function(g){this._renderMode=g,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(g){this._cameraComponent!==g&&(this._cameraComponent=g,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(g){this._alignCanvasWithScreen=g,this._onResizeCamera()}}]),e}(Fx)).prototype,"cameraComponent",[Fg],Object.getOwnPropertyDescriptor(FA.prototype,"cameraComponent"),FA.prototype),FT=ws(FA.prototype,"_cameraComponent",[Fy],function(){return null}),FE=ws(FA.prototype,"_alignCanvasWithScreen",[n2],function(){return!0}),FS=FA))||FS)||FS)||FS));function dz(g,v,S){var O=g.o,X=g.d,Y=1/X.x,te=1/X.y,ti=1/X.z,tr=(v.x-O.x)*Y,ta=(S.x-O.x)*Y,th=(v.y-O.y)*te,tu=(S.y-O.y)*te,tl=(v.z-O.z)*ti,tc=(S.z-O.z)*ti,t_=Math.max(Math.max(Math.min(tr,ta),Math.min(th,tu)),Math.min(tl,tc)),tf=Math.min(Math.min(Math.max(tr,ta),Math.max(th,tu)),Math.max(tl,tc));return tf<0||t_>tf?0:t_>0?t_:tf}X.Canvas=Fw,g("U",nJ("cc.UIComponent")(FC=nZ(P2)(FC=nQ(110)(FC=n0(FC=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._lastParent=null,v.stencilStage=Pg.DISABLED,v}s(e,g);var v=e.prototype;return v.__preload=function(){this.node._uiProps.uiComp=this},v.onEnable=function(){},v.onDisable=function(){},v.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},v.postUpdateAssembler=function(){},v.markForUpdateRenderData=function(){},v.setNodeDirty=function(){},v.setTextureDirty=function(){},e}(cS))||FC)||FC)||FC)||FC);var FI,FB,FP,FD,FM,FO,FL,FF=(FI=iF.create(),FB={distance:1/0,doubleSided:!1,mode:s7.ANY},FP=0,FD=function(g,v,S,O,X,Y){g===s7.CLOSEST?(FP>v||0===FP)&&(FP=v,Y&&(0===Y.length?Y.push({distance:v,vertexIndex0:S/3,vertexIndex1:O/3,vertexIndex2:X/3}):(Y[0].distance=v,Y[0].vertexIndex0=S/3,Y[0].vertexIndex1=O/3,Y[0].vertexIndex2=X/3))):(FP=v,Y&&Y.push({distance:v,vertexIndex0:S/3,vertexIndex1:O/3,vertexIndex2:X/3}))},function(g,v,S){if(FP=0,0===v.geometricInfo.positions.length)return FP;var O=void 0===S?FB:S;if(dz(g,v.geometricInfo.boundingBox.min,v.geometricInfo.boundingBox.max)){var X=v.primitiveMode,Y=v.geometricInfo;!function(g,v,S,O,X){if(S===oY.TRIANGLE_LIST)for(var Y=v.length,te=0;te<Y;te+=3){var ti=3*v[te],tr=3*v[te+1],ta=3*v[te+2];eL.set(FI.a,g[ti],g[ti+1],g[ti+2]),eL.set(FI.b,g[tr],g[tr+1],g[tr+2]),eL.set(FI.c,g[ta],g[ta+1],g[ta+2]);var th=nF.rayTriangle(O,FI,X.doubleSided);if(!(0===th||th>X.distance)&&(FD(X.mode,th,ti,tr,ta,X.result),X.mode===s7.ANY))return th}else if(S===oY.TRIANGLE_STRIP)for(var tu=v.length-2,tl=0,tc=0;tc<tu;tc+=1){var t_=3*v[tc-tl],tf=3*v[tc+tl+1],tp=3*v[tc+2];eL.set(FI.a,g[t_],g[t_+1],g[t_+2]),eL.set(FI.b,g[tf],g[tf+1],g[tf+2]),eL.set(FI.c,g[tp],g[tp+1],g[tp+2]),tl=~tl;var tm=nF.rayTriangle(O,FI,X.doubleSided);if(!(0===tm||tm>X.distance)&&(FD(X.mode,tm,t_,tf,tp,X.result),X.mode===s7.ANY))return tm}else if(S===oY.TRIANGLE_FAN){var tg=v.length-1,tv=3*v[0];eL.set(FI.a,g[tv],g[tv+1],g[tv+2]);for(var ty=1;ty<tg;ty+=1){var tS=3*v[ty],tA=3*v[ty+1];eL.set(FI.b,g[tS],g[tS+1],g[tS+2]),eL.set(FI.c,g[tA],g[tA+1],g[tA+2]);var tT=nF.rayTriangle(O,FI,X.doubleSided);if(!(0===tT||tT>X.distance)&&(FD(X.mode,tT,tv,tS,tA,X.result),X.mode===s7.ANY))return tT}}}(Y.positions,Y.indices,X,g,O)}return FP}),Fk=function(){var g=0,v={distance:1/0,doubleSided:!1,mode:s7.ANY};return function(S,O,X){g=0;var Y=void 0===X?v:X,te=O.renderingSubMeshes.length,ti=O.struct.minPosition,tr=O.struct.maxPosition;if(ti&&tr&&!dz(S,ti,tr))return g;for(var ta=0;ta<te;ta++){var th=O.renderingSubMeshes[ta],tu=FF(S,th,Y);if(tu){if(Y.mode===s7.CLOSEST)(0===g||g>tu)&&(g=tu,Y.subIndices&&(Y.subIndices[0]=ta));else if(g=tu,Y.subIndices&&Y.subIndices.push(ta),Y.mode===s7.ANY)return tu}}return g&&Y.mode===s7.CLOSEST&&(Y.result&&(Y.result[0].distance=g,Y.result.length=1),Y.subIndices&&(Y.subIndices.length=1)),g}}(),FG=function(){var g=0,v={distance:1/0,doubleSided:!1,mode:s7.ANY},S=new iL,O=new e$;return function(X,Y,te){g=0;var ti=void 0===te?v:te,tr=Y.worldBounds;if(tr&&!nF.rayAABB(X,tr))return g;iL.copy(S,X),Y.node&&(e$.invert(O,Y.node.getWorldMatrix(O)),eL.transformMat4(S.o,X.o,O),eL.transformMat4Normal(S.d,X.d,O));for(var ta=Y.subModels,th=0;th<ta.length;th++){var tu=ta[th].subMesh,tl=FF(S,tu,ti);if(tl){if(ti.mode===s7.CLOSEST)(0===g||g>tl)&&(g=tl,ti.subIndices&&(ti.subIndices[0]=th));else if(g=tl,ti.subIndices&&ti.subIndices.push(th),ti.mode===s7.ANY)return tl}}return g&&ti.mode===s7.CLOSEST&&(ti.result&&(ti.result[0].distance=g,ti.result.length=1),ti.subIndices&&(ti.subIndices.length=1)),g}}();nF.rayModel=FG,nF.raySubMesh=FF,nF.rayMesh=Fk,dH("specular-pass");var FV,FU,FH,Fz,FW,FX,Fj,Fq,FY,FK,FJ,FQ,F1,F2,F3,F5,F4,F8=g("dD",nJ("cc.ModelRenderer")((FO=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._visFlags=FL&&FL(),v._models=[],v._priority=0,v}s(e,g);var v=e.prototype;return v._collectModels=function(){return this._models},v.onEnable=function(){this._updatePriority()},v._attachToScene=function(){},v._detachFromScene=function(){},v._onVisibilityChange=function(){},v._updatePriority=function(){if(this._models.length>0)for(var g=0;g<this._models.length;g++)this._models[g].priority=this._priority},n(e,[{key:"visibility",get:function(){return this._visFlags},set:function(g){this._visFlags=g,this._onVisibilityChange(g)}},{key:"priority",get:function(){return this._priority},set:function(g){g!==this._priority&&(this._priority=g,this._updatePriority())}}]),e}(Dm),FL=ws(FO.prototype,"_visFlags",[n2],function(){return _a.Enum.NONE}),FM=FO))||FM),F6=n2,F7=ma;g("dG",(FV=nJ("cc.PrefabLink"),FU=F7(Ib),FV((Fz=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).prefab=FW&&FW(),v}return s(e,g),e}(cS),FW=ws(Fz.prototype,"prefab",[FU,F6],function(){return null}),FH=Fz))||FH)),function(g){g[g.SIMPLE=0]="SIMPLE",g[g.SLICED=1]="SLICED",g[g.TILED=2]="TILED"}(F4||(F4={})),g("e",(FX=nJ("cc.SpriteRenderer"),Fj=nQ(100),Fq=ma(Bf),FX(FY=Fj((p((FK=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._spriteFrame=FJ&&FJ(),v._mode=FQ&&FQ(),v._color=F1&&F1(),v._flipX=F2&&F2(),v._flipY=F3&&F3(),v._size=F5&&F5(),v._model=null,v}s(e,g);var v=e.prototype;return v.onLoad=function(){this._spriteFrame&&(this._spriteFrame.mesh||this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels()},v.onRestore=function(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene()},v.onEnable=function(){g.prototype.onEnable.call(this),this._model||this._updateModels(),this._attachToScene()},v.onDisable=function(){this._model&&this._detachFromScene()},v.onDestroy=function(){this._model&&(X.director.root.destroyModel(this._model),this._model=null,this._models.length=0)},v._updateModels=function(){if(this._spriteFrame){var g=this._model;if(g?(g.destroy(),g.initialize(),g.node=g.transform=this.node):this._createModel(),this._model){var v=this._spriteFrame.mesh;this._model.createBoundingShape(v.struct.minPosition,v.struct.maxPosition),this._updateModelParams(),this._onUpdateLocalDescriptorSet()}}},v._createModel=function(){var g=this._model=X.director.root.createModel(wh);g.visFlags=this.visibility,g.node=g.transform=this.node,this._models.length=0,this._models.push(this._model)},v._updateModelParams=function(){if(this._spriteFrame&&this._model){this._spriteFrame.ensureMeshData();var g=this._spriteFrame.mesh;this.node.hasChangedFlags|=pq.POSITION,this._model.transform.hasChangedFlags|=pq.POSITION;var v=g?g.renderingSubMeshes:null;if(v)for(var S=v.length,O=0;O<S;++O){var X=this.getRenderMaterial(O);X&&!X.isValid&&(X=null);var Y=v[O];Y&&this._model.initSubModel(O,Y,X||this._getBuiltinMaterial())}this._model.enabled=!0}},v._getBuiltinMaterial=function(){return dU.get("missing-material")},v._onMaterialModified=function(v,S){g.prototype._onMaterialModified.call(this,v,S),this._spriteFrame&&this._model&&this._model.inited&&this._onRebuildPSO(v,S||this._getBuiltinMaterial())},v._onRebuildPSO=function(g,v){this._model&&this._model.inited&&(this._model.setSubModelMaterial(g,v),this._onUpdateLocalDescriptorSet())},v._onUpdateLocalDescriptorSet=function(){if(this._spriteFrame&&this._model&&this._model.inited)for(var g=this._spriteFrame.getGFXTexture(),v=this._spriteFrame.getGFXSampler(),S=this._model.subModels,O=_g.SAMPLER_SPRITE,X=0;X<S.length;X++){var Y=S[X].descriptorSet;Y.bindTexture(O,g),Y.bindSampler(O,v),Y.update()}},v._attachToScene=function(){if(this.node.scene&&this._model){var g=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),g.addModel(this._model)}},v._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},n(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(g){this._spriteFrame!==g&&(this._spriteFrame,this._spriteFrame=g,this._spriteFrame&&(this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels(),this.enabledInHierarchy&&this._attachToScene())}},{key:"model",get:function(){return this._model}}]),e}(F8)).prototype,"spriteFrame",[Fq],Object.getOwnPropertyDescriptor(FK.prototype,"spriteFrame"),FK.prototype),FJ=ws(FK.prototype,"_spriteFrame",[n2],function(){return null}),FQ=ws(FK.prototype,"_mode",[n2],function(){return F4.SIMPLE}),F1=ws(FK.prototype,"_color",[n2],function(){return is.WHITE.clone()}),F2=ws(FK.prototype,"_flipX",[n2],function(){return!1}),F3=ws(FK.prototype,"_flipY",[n2],function(){return!1}),F5=ws(FK.prototype,"_size",[n2],function(){return new e8}),FY=FK))||FY)||FY));var F9,Nt,Ni,Nn,Ns,No,Nh,Nl,Nc,N_,Nd,Np,Nm,Ng,Ny,NS,NA,NT,NE,NC,Nx,Nb,NR,Nw,NI,NB=new BQ,NP="RICHTEXT_CHILD",ND="RICHTEXT_Image_CHILD",NM=new e8,NO=new e8,NL=new tU(function(g){if(!X.isValid(g.node))return!1;var v=g.node.getComponent(Ld);return v&&(v.width=0),!0},20),NF=new tU(function(g){return X.isValid(g.node)},10);function EW(g){return{node:new mJ(g),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:g}}function CW(g,v){var S;g===NP?S=NL._get():g===ND&&(S=NF._get());var O=(S=S||EW(g)).node;return O||(O=new mJ(g)),O.hideFlags|=rG.Flags.DontSave|rG.Flags.HideInHierarchy,O.active=!0,g===ND?(S.comp=O.getComponent(O3)||O.addComponent(O3),S.comp.spriteFrame=v,S.comp.type=O3.Type.SLICED,S.comp.sizeMode=O3.SizeMode.CUSTOM):(S.comp=O.getComponent(Mt)||O.addComponent(Mt),S.comp.string=v,S.comp.horizontalAlign=D2.LEFT,S.comp.verticalAlign=D3.TOP,S.comp.underlineHeight=2),O.setPosition(0,0,0),O._uiProps.uiTransformComp.setAnchorPoint(.5,.5),S.node=O,S.lineCount=0,S.styleIndex=0,S.imageOffset="",S.clickParam="",S.clickHandler="",S}var NN,Nk=g("h",(F9=nJ("cc.RichText"),Nt=nQ(110),Ni=ma(D2),Nn=ma(D3),Ns=ma(is),No=ma(BT),Nh=ma(D4),Nl=ma(Bm),F9(Nc=Nt(((NI=function(g){function e(){var v;return(v=g.call(this)||this)._lineHeight=Nd&&Nd(),v._string=Np&&Np(),v._horizontalAlign=Nm&&Nm(),v._verticalAlign=Ng&&Ng(),v._fontSize=Ny&&Ny(),v._fontColor=NS&&NS(),v._maxWidth=NA&&NA(),v._fontFamily=NT&&NT(),v._font=NE&&NE(),v._isSystemFontUsed=NC&&NC(),v._userDefinedFont=Nx&&Nx(),v._cacheMode=Nb&&Nb(),v._imageAtlas=NR&&NR(),v._handleTouchEvent=Nw&&Nw(),v._textArray=[],v._segments=[],v._labelSegmentsCache=[],v._linesWidth=[],v._lineCount=1,v._labelWidth=0,v._labelHeight=0,v._layoutDirty=!0,v._lineOffsetX=0,v._updateRichTextStatus=void 0,v._labelChildrenNum=0,v._updateRichTextStatus=v._updateRichText,v}s(e,g);var v=e.prototype;return v.onLoad=function(){this.node.on(md.LAYER_CHANGED,this._applyLayer,this),this.node.on(md.ANCHOR_CHANGED,this._updateRichTextPosition,this)},v.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},v.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},v.onRestore=function(){},v.onDestroy=function(){for(var g,v=f(this._segments);!(g=v()).done;){var S=g.value;S.node.removeFromParent(),S.type===NP?NL.put(S):S.type===ND&&NF.put(S)}this.node.off(md.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(md.LAYER_CHANGED,this._applyLayer,this)},v._addEventListeners=function(){this.node.on(md.TOUCH_END,this._onTouchEnded,this)},v._removeEventListeners=function(){this.node.off(md.TOUCH_END,this._onTouchEnded,this)},v._updateLabelSegmentTextAttributes=function(){var g=this;this._segments.forEach(function(v){g._applyTextAttribute(v)})},v._createFontLabel=function(g){return CW(NP,g)},v._createImage=function(g){return CW(ND,g)},v._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},v.splitLongStringApproximatelyIn2048=function(g,v){var S=[];if(g.length*this.fontSize<=1638.4)return S.push(g),S;if(this._calculateSize(NM,v,g),NM.x<2048)S.push(g);else for(var O=g.split("\n"),X=0;X<O.length;X++)if(this._calculateSize(NM,v,O[X]),NM.x<2048)S.push(O[X]);else{var Y=this.splitLongStringOver2048(O[X],v);S.push.apply(S,Y)}return S},v.splitLongStringOver2048=function(g,v){var S=[],O=g,X=0,Y=O.length/2,te=O.substring(X,Y),ti=O.substring(Y),tr=this._calculateSize(NM,v,te),ta=this._calculateSize(NO,v,ti),th=this._maxWidth;0===this._maxWidth&&(th=2047.9);for(var tu=1*th;tr.x>tu;){if((Y/=2)<1){Y*=2;break}te=te.substring(X,Y),ti=O.substring(Y),this._calculateSize(tr,v,te)}for(var tl=1e3,tc=1;tl&&X<g.length;){for(;tl&&tr.x<tu;){var t_=iN(ti);t_&&t_.length>0&&(tc=t_[0].length),Y+=tc,te=O.substring(X,Y),ti=O.substring(Y),this._calculateSize(tr,v,te),tl--}for(;tl&&te.length>=2&&tr.x>tu;)Y-=tc,te=O.substring(X,Y),this._calculateSize(tr,v,te),tc=1,tl--;if(te.length>=2){var tf=nN(te);tf&&tf.length>0&&te!==tf[0]&&(Y-=tf[0].length,te=O.substring(X,Y))}if(S.push(te),X=Y,Y+=te.length,te=O.substring(X,Y),ti=O.substring(Y),this._calculateSize(ta,v,ti),this._calculateSize(tr,v,te),tl--,ta.x<2048&&tr.x<tu){S.push(te),X=g.length,Y=g.length,te=ti,""!==ti&&S.push(te);break}}return S},v._measureText=function(g,v){var S=this,_$n=function(v){return S._calculateSize(NM,g,v).x};return v?_$n(v):_$n},v._calculateSize=function(g,v,S){var O;0===this._labelSegmentsCache.length?(O=this._createFontLabel(S),this._labelSegmentsCache.push(O)):(O=this._labelSegmentsCache[0]).node.getComponent(Mt).string=S,O.styleIndex=v,this._applyTextAttribute(O);var X=O.node._uiProps.uiTransformComp.contentSize;return e8.set(g,X.x,X.y),g},v._onTouchEnded=function(g){for(var v,S=this,O=this.node.getComponents(cS),_$r=function(){var X=v.value,Y=X.clickHandler,te=X.clickParam;Y&&S._containsTouchLocation(X,g.touch.getUILocation())&&(O.forEach(function(v){var S=v[Y];v.enabledInHierarchy&&S&&S.call(v,g,te)}),g.propagationStopped=!0)},X=f(this._segments);!(v=X()).done;)_$r()},v._containsTouchLocation=function(g,v){var S=g.node.getComponent(P2);return!!S&&S.getBoundingBoxToWorld().contains(v)},v._resetState=function(){for(var g=this.node.children,v=g.length-1;v>=0;v--){var S=g[v];if(S.name===NP||S.name===ND){S.parent=null;var O=EW(S.name);O.node=S,S.name===NP?(O.comp=S.getComponent(Mt),NL.put(O)):(O.comp=S.getComponent(O3),NF.put(O)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},v._activateChildren=function(g){for(var v=this.node.children.length-1;v>=0;v--){var S=this.node.children[v];S.name!==NP&&S.name!==ND||(S.active=g)}},v._addLabelSegment=function(g,v){var S;if(0===this._labelSegmentsCache.length)S=this._createFontLabel(g);else{var O=(S=this._labelSegmentsCache.pop()).node.getComponent(Mt);O&&(O.string=g)}var X=S.comp;return X.verticalAlign!==this._verticalAlign&&(X.verticalAlign=this._verticalAlign),S.styleIndex=v,S.lineCount=this._lineCount,S.node._uiProps.uiTransformComp.setAnchorPoint(0,0),S.node.layer=this.node.layer,this.node.insertChild(S.node,this._labelChildrenNum++),this._applyTextAttribute(S),this._segments.push(S),S},v._updateRichTextWithMaxWidth=function(g,v,S){var O=v;if(this._lineOffsetX>0&&O+this._lineOffsetX>this._maxWidth)for(var X=0;this._lineOffsetX<=this._maxWidth;){var Y=this._getFirstWordLen(g,X,g.length),te=g.substr(X,Y),ti=this._measureText(S,te);if(!(this._lineOffsetX+ti<=this._maxWidth)){if(X>0){var tr=g.substr(0,X);this._addLabelSegment(tr,S),g=g.substr(X,g.length),O=this._measureText(S,g)}this._updateLineInfo();break}this._lineOffsetX+=ti,X+=Y}if(O>this._maxWidth)for(var ta=rN(g,O,this._maxWidth,this._measureText(S)),th=0;th<ta.length;++th){var tu=ta[th],tl=this._addLabelSegment(tu,S).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=tl.width,ta.length>1&&th<ta.length-1&&this._updateLineInfo()}else this._lineOffsetX+=O,this._addLabelSegment(g,S)},v._isLastComponentCR=function(g){return g.length-1===g.lastIndexOf("\n")},v._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},v._needsUpdateTextLayout=function(g){if(this._layoutDirty||!this._textArray||!g)return!0;if(this._textArray.length!==g.length)return!0;for(var v=0;v<this._textArray.length;v++){var S=this._textArray[v],O=g[v];if(S.text!==O.text)return!0;var X=S.style,Y=O.style;if(X){if(Y){if(!!Y.outline!=!!X.outline)return!0;if(X.size!==Y.size||X.italic!==Y.italic||X.isImage!==Y.isImage)return!0;if(X.src!==Y.src||X.imageAlign!==Y.imageAlign||X.imageHeight!==Y.imageHeight||X.imageWidth!==Y.imageWidth||X.imageOffset!==Y.imageOffset)return!0}else if(X.size||X.italic||X.isImage||X.outline)return!0}else if(Y&&(Y.size||Y.italic||Y.isImage||Y.outline))return!0}return!1},v._addRichTextImageElement=function(g){if(g.style){var v=g.style,S=v.src,O=this._imageAtlas&&S&&this._imageAtlas.getSpriteFrame(S);if(O){var X=this._createImage(O);switch(X.comp,v.imageAlign){case"top":X.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":X.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:X.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}v.imageOffset&&(X.imageOffset=v.imageOffset),X.node.layer=this.node.layer,this.node.insertChild(X.node,this._labelChildrenNum++),this._segments.push(X);var Y=O.rect.clone(),te=1,ti=Y.width,tr=Y.height,ta=v.imageWidth||0,th=v.imageHeight||0;th>0?(ti*=te=th/tr,tr*=te):(ti*=te=this._lineHeight/tr,tr*=te),ta>0&&(ti=ta),this._maxWidth>0?(this._lineOffsetX+ti>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=ti):(this._lineOffsetX+=ti,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),X.node._uiProps.uiTransformComp.setContentSize(ti,tr),X.lineCount=this._lineCount,X.clickHandler="",X.clickParam="";var tu=v.event;tu&&(X.clickHandler=tu.click,X.clickParam=tu.param)}else q(4400)}},v._updateTextDefaultColor=function(){for(var g=0;g<this._segments.length;++g){var v,S,O=this._segments[g],X=O.node.getComponent(Mt);X&&(null!==(v=this._textArray[O.styleIndex])&&void 0!==v&&null!==(S=v.style)&&void 0!==S&&S.color||(X.color=this._fontColor))}},v._updateRichText=function(){if(this.enabledInHierarchy){var g=NB.parse(this._string);if(!this._needsUpdateTextLayout(g))return this._textArray=g.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=g.slice(),this._resetState();for(var v,S=!1,O=0;O<this._textArray.length;++O){var X=this._textArray[O],Y=X.text;if(void 0!==Y){if(""===Y){if(X.style&&X.style.isNewLine){this._updateLineInfo();continue}if(X.style&&X.style.isImage&&this._imageAtlas){this._addRichTextImageElement(X);continue}}for(var te=(Y=this.splitLongStringApproximatelyIn2048(Y,O).join("\n")).split("\n"),ti=0;ti<te.length;++ti){var tr=te[ti];if(""!==tr){if(S=!1,this._maxWidth>0){var ta=this._measureText(O,tr);this._updateRichTextWithMaxWidth(tr,ta,O),te.length>1&&ti<te.length-1&&this._updateLineInfo()}else v=this._addLabelSegment(tr,O),this._lineOffsetX+=v.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),te.length>1&&ti<te.length-1&&this._updateLineInfo()}else{if(this._isLastComponentCR(Y)&&ti===te.length-1)continue;this._updateLineInfo(),S=!0}}}}S||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+BC)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},v._getFirstWordLen=function(g,v,S){var O=QF(g,v);if(YF(O)||qF(O))return 1;for(var X=1,Y=v+1;Y<S&&!qF(O=QF(g,Y))&&!YF(O);++Y)X++;return X},v._updateRichTextPosition=function(){for(var g=0,v=1,S=this._lineCount,O=this.node._uiProps.uiTransformComp,X=O.anchorX,Y=O.anchorY,te=0;te<this._segments.length;++te){var ti=this._segments[te],tr=ti.lineCount;tr>v&&(g=0,v=tr);var ta=this._labelWidth*(.5*this._horizontalAlign-X);switch(this._horizontalAlign){case D2.LEFT:break;case D2.CENTER:ta-=this._linesWidth[tr-1]/2;break;case D2.RIGHT:ta-=this._linesWidth[tr-1]}var th=ti.node.position;if(ti.node.setPosition(g+ta,this._lineHeight*(S-tr)-this._labelHeight*Y,th.z),tr===v&&(g+=ti.node._uiProps.uiTransformComp.width),ti.node.getComponent(O3)){var tu=ti.node.position.clone(),tl=this._lineHeight,tc=this._lineHeight*(1+BC);switch(ti.node._uiProps.uiTransformComp.anchorY){case 1:tu.y+=tl+(tc-tl)/2;break;case .5:tu.y+=tc/2;break;default:tu.y+=(tc-tl)/2}if(ti.imageOffset){var t_=ti.imageOffset.split(",");if(1===t_.length&&t_[0]){var tf=parseFloat(t_[0]);Number.isInteger(tf)&&(tu.y+=tf)}else if(2===t_.length){var tp=parseFloat(t_[0]),tm=parseFloat(t_[1]);Number.isInteger(tp)&&(tu.x+=tp),Number.isInteger(tm)&&(tu.y+=tm)}}ti.node.position=tu}var tg=ti.node.getComponent(Ld);if(tg){var tv=ti.node.position.clone();tv.y-=tg.width,ti.node.position=tv}}},v._convertLiteralColorValue=function(g){var v=g.toUpperCase();return is[v]?is[v]:(new is).fromHEX(g)},v._applyTextAttribute=function(g){var v=g.node.getComponent(Mt);if(v){this._resetLabelState(v);var S,O=g.styleIndex;if(this._textArray[O]&&(S=this._textArray[O].style),S){if(S.color?v.color=this._convertLiteralColorValue(S.color):v.color=this._fontColor,v.isBold=!!S.bold,v.isItalic=!!S.italic,v.isUnderline=!!S.underline,S.outline){var X=g.node.getComponent(Ld);X||(X=g.node.addComponent(Ld)),X.color=this._convertLiteralColorValue(S.outline.color),X.width=S.outline.width}v.fontSize=S.size||this._fontSize,g.clickHandler="",g.clickParam="";var Y=S.event;Y&&(g.clickHandler=Y.click||"",g.clickParam=Y.param||"")}v.cacheMode=this._cacheMode,_instanceof(this._font,BT)&&!this._isSystemFontUsed?v.font=this._font:v.fontFamily=this._fontFamily,v.useSystemFont=this._isSystemFontUsed,v.lineHeight=this._lineHeight,v.updateRenderData(!0)}},v._applyLayer=function(){for(var g,v=f(this._segments);!(g=v()).done;)g.value.node.layer=this.node.layer},v._resetLabelState=function(g){g.fontSize=this._fontSize,g.color=this._fontColor,g.isBold=!1,g.isItalic=!1,g.isUnderline=!1},n(e,[{key:"string",get:function(){return this._string},set:function(g){this._string!==g&&(this._string=g,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(g){this.horizontalAlign!==g&&(this._horizontalAlign=g,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(g){this._verticalAlign!==g&&(this._verticalAlign=g,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(g){this._fontSize!==g&&(this._fontSize=g,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontColor",get:function(){return this._fontColor},set:function(g){this._fontColor!==g&&(this._fontColor=g,this._updateTextDefaultColor())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(g){this._fontFamily!==g&&(this._fontFamily=g,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(g){this._font!==g&&(this._font=g,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(g){this._isSystemFontUsed!==g&&(this._isSystemFontUsed=g,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(g){this._cacheMode!==g&&(this._cacheMode=g,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(g){this._maxWidth!==g&&(this._maxWidth=g,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(g){this._lineHeight!==g&&(this._lineHeight=g,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(g){this._imageAtlas!==g&&(this._imageAtlas=g,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(g){this._handleTouchEvent!==g&&(this._handleTouchEvent=g,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(cS)).HorizontalAlign=D2,NI.VerticalAlign=D3,p((N_=NI).prototype,"horizontalAlign",[Ni],Object.getOwnPropertyDescriptor(N_.prototype,"horizontalAlign"),N_.prototype),p(N_.prototype,"verticalAlign",[Nn],Object.getOwnPropertyDescriptor(N_.prototype,"verticalAlign"),N_.prototype),p(N_.prototype,"fontColor",[Ns],Object.getOwnPropertyDescriptor(N_.prototype,"fontColor"),N_.prototype),p(N_.prototype,"font",[No],Object.getOwnPropertyDescriptor(N_.prototype,"font"),N_.prototype),p(N_.prototype,"cacheMode",[Nh],Object.getOwnPropertyDescriptor(N_.prototype,"cacheMode"),N_.prototype),p(N_.prototype,"imageAtlas",[Nl],Object.getOwnPropertyDescriptor(N_.prototype,"imageAtlas"),N_.prototype),Nd=ws(N_.prototype,"_lineHeight",[n2],function(){return 40}),Np=ws(N_.prototype,"_string",[n2],function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}),Nm=ws(N_.prototype,"_horizontalAlign",[n2],function(){return D2.LEFT}),Ng=ws(N_.prototype,"_verticalAlign",[n2],function(){return D3.TOP}),Ny=ws(N_.prototype,"_fontSize",[n2],function(){return 40}),NS=ws(N_.prototype,"_fontColor",[n2],function(){return is.WHITE.clone()}),NA=ws(N_.prototype,"_maxWidth",[n2],function(){return 0}),NT=ws(N_.prototype,"_fontFamily",[n2],function(){return"Arial"}),NE=ws(N_.prototype,"_font",[n2],function(){return null}),NC=ws(N_.prototype,"_isSystemFontUsed",[n2],function(){return!0}),Nx=ws(N_.prototype,"_userDefinedFont",[n2],function(){return null}),Nb=ws(N_.prototype,"_cacheMode",[n2],function(){return D4.NONE}),NR=ws(N_.prototype,"_imageAtlas",[n2],function(){return null}),Nw=ws(N_.prototype,"_handleTouchEvent",[n2],function(){return!0}),Nc=N_))||Nc)||Nc));X.RichText=Nk;var NG=g("j",nJ("cc.UIMeshRenderer")(NN=nQ(110)(NN=function(g){function e(){var v;return(v=g.call(this)||this)._modelComponent=null,v._dirtyVersion=-1,v._internalId=-1,v.stencilStage=Pg.DISABLED,v._renderData=null,v._renderEntity=new PH(Px.DYNAMIC),v}s(e,g);var v=e.prototype;return v.__preload=function(){this.node._uiProps.uiComp=this},v.onEnable=function(){IR.addRenderer(this),this.markForUpdateRenderData()},v.onDisable=function(){IR.removeRenderer(this),this.renderEntity.enabled=this._canRender()},v.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent?this.renderEntity.setNode(this.node):G("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},v.onDestroy=function(){this.renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent&&(this._modelComponent._sceneGetter=null)},v._render=function(g){if(this._modelComponent){var v=this._modelComponent._collectModels();this._modelComponent._detachFromScene();for(var S=0;S<v.length;S++)v[S].enabled&&g.commitModel(this,v[S],this._modelComponent.material);return!0}return!1},v.fillBuffers=function(g){this.enabled&&this._render(g)},v.updateRenderer=function(){},v._uploadRenderData=function(){},v.postUpdateAssembler=function(){},v.update=function(){this._fitUIRenderQueue()},v._fitUIRenderQueue=function(){if(this._modelComponent)for(var g=this._modelComponent.sharedMaterials.length,v=0;v<g;v++){var S=this._modelComponent.getMaterialInstance(v);if(null!=S)for(var O=S.passes,X=O.length,Y=0;Y<X;Y++)O[Y].setPriority(_u.MAX-11),S.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},Y)}},v.markForUpdateRenderData=function(){IR.markDirtyRenderer(this)},v.setNodeDirty=function(){},v.setTextureDirty=function(){},v._canRender=function(){return this.enabled&&null!==this._modelComponent},n(e,[{key:"modelComponent",get:function(){return this._modelComponent}},{key:"renderEntity",get:function(){return this._renderEntity}},{key:"renderData",get:function(){return this._renderData}}]),e}(cS))||NN)||NN);X.UIMeshRenderer=NG;var NV,NU,NH,Nz,NX,Nj,Nq=_a.Enum.NONE|_a.Enum.UI_3D,NY=function(){function t1(){this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=Nq,this._inputAssembler=null,this._descriptorSet=null}var g=t1.prototype;return g.destroy=function(){this._passes=[]},g.clear=function(){this._inputAssembler=null,this._descriptorSet=null,this.texture=null,this.sampler=null,this.textureHash=0,this.samplerHash=0,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=Nq},g.fillPasses=function(g,v,S,O){if(g){var Y=g.passes;if(!Y)return;this._shaders.length=Y.length;for(var te=0;te<Y.length;te++){this._passes[te]||(this._passes[te]=new dY(X.director.root));var ti=Y[te],tr=this._passes[te];ti.update(),v||(v=ti.depthStencilState,S=0),tr._initPassFromTarget(ti,v,S),this._shaders[te]=tr.getShaderVariant(O)}}},n(t1,[{key:"inputAssembler",get:function(){return this._inputAssembler},set:function(g){this._inputAssembler=g}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(g){this._descriptorSet=g}},{key:"visFlags",get:function(){return this._visFlags},set:function(g){this._visFlags=g}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t1}(),NK=(g("m",nJ("cc.UIStaticBatch")(NV=nQ(110)((p((NU=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._init=!1,v._bufferAccessor=null,v._dirty=!0,v._uiDrawBatchList=[],v}s(e,g);var v=e.prototype;return v.postUpdateAssembler=function(){},v.markAsDirty=function(){},v._requireDrawBatch=function(){var g=new NY;return g.isStatic=!0,this._uiDrawBatchList.push(g),g},v._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var g=this._getBatcher(),v=0;v<this._uiDrawBatchList.length;v++)this._uiDrawBatchList[v].destroy(g)}this._uiDrawBatchList.length=0,this._init=!1},v._getBatcher=function(){return II.root&&II.root.batcher2D?II.root.batcher2D:(q(9301),null)},n(e,[{key:"color",get:function(){return this._color},set:function(g){this._color!==g&&this._color.set(g)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(Dg)).prototype,"color",[rE],Object.getOwnPropertyDescriptor(NU.prototype,"color"),NU.prototype),NV=NU))||NV)||NV),g("n",nJ("cc.LabelShadow")(NH=nQ(110)(NH=nZ(Mt)(NH=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.onEnable=function(){this.node.getComponent(Mt).enableShadow=!0},v.onDisable=function(){this.node.getComponent(Mt).enableShadow=!1},n(e,[{key:"color",get:function(){return this.node.getComponent(Mt).shadowColor},set:function(g){this.node.getComponent(Mt).shadowColor=g}},{key:"offset",get:function(){return this.node.getComponent(Mt).shadowOffset},set:function(g){this.node.getComponent(Mt).shadowOffset=g}},{key:"blur",get:function(){return this.node.getComponent(Mt).shadowBlur},set:function(g){this.node.getComponent(Mt).shadowBlur=g}}]),e}(cS))||NH)||NH)||NH),g("o",nJ("cc.UIOpacity")(Nz=nQ(110)(Nz=n0((NX=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._setByParent=!1,v._opacity=Nj&&Nj(),v}s(e,g);var v=e.prototype;return v.setEntityLocalOpacityDirtyRecursively=function(){},e.setEntityLocalOpacityDirtyRecursively=function(g,v,S,O){if(g.isValid){var X=g._uiProps.uiComp,Y=g.getComponent(e),te=S;X&&X.color?(X.renderEntity.colorDirty=v,Y?(X.renderEntity.localOpacity=te*Y.opacity/255,Y._setByParent=O):X.renderEntity.localOpacity=te,X.node._uiProps.localOpacity=X.renderEntity.localOpacity,te=1):Y&&(te=te*Y.opacity/255,Y._setByParent=O);for(var ti=0;ti<g.children.length;ti++)e.setEntityLocalOpacityDirtyRecursively(g.children[ti],v||te<1,te,!0)}},v.onEnable=function(){this._setByParent||(this.node._uiProps.localOpacity=this._opacity/255,this.setEntityLocalOpacityDirtyRecursively(!0))},v.onDisable=function(){this._setByParent||(this.node._uiProps.localOpacity=1,this.setEntityLocalOpacityDirtyRecursively(!0))},n(e,[{key:"opacity",get:function(){return this._opacity},set:function(g){this._opacity!==g&&(g=be(g,0,255),this._opacity=g,this.node._uiProps.localOpacity=g/255,this.setEntityLocalOpacityDirtyRecursively(!0))}}]),e}(cS),Nj=ws(NX.prototype,"_opacity",[n2],function(){return 255}),Nz=NX))||Nz)||Nz)||Nz),function(g,v,S){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=g,this.x=v,this.y=S});function NW(g,v,S,O,X){var Y=0,te=null;if(X===function(g,v,S,O){for(var X=0,Y=v,te=S-O;Y<S;Y+=O)X+=(g[te]-g[Y])*(g[Y+1]+g[te+1]),te=Y;return X}(g,v,S,O)>0)for(Y=v;Y<S;Y+=O)te=eX(Y,g[Y],g[Y+1],te);else for(Y=S-O;Y>=v;Y-=O)te=eX(Y,g[Y],g[Y+1],te);return te&&QW(te,te.next)&&(iX(te),te=te.next),te}function GW(g,v){if(void 0===v&&(v=null),!g)return g;v||(v=g);var S=g,O=!1;do if(O=!1,S.steiner||!QW(S,S.next)&&0!==JW(S.prev,S,S.next))S=S.next;else{if(iX(S),(S=v=S.prev)===S.next)return null;O=!0}while(O||S!==v);return v}function kW(g,v,S,O,X,Y,te){if(void 0===te&&(te=0),g){!te&&Y&&function(g,v,S,O){var X=g;do null===X.z&&(X.z=jW(X.x,X.y,v,S,O)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==g);X.prevZ.nextZ=null,X.prevZ=null,function(g){var v=0,S=null,O=null,X=null,Y=null,te=0,ti=0,tr=0,ta=1;do{for(S=g,g=null,Y=null,te=0;S;){for(te++,O=S,ti=0,v=0;v<ta&&(ti++,O=O.nextZ);v++);for(tr=ta;ti>0||tr>0&&O;)0===ti?(X=O,O=O.nextZ,tr--):0!==tr&&O?S.z<=O.z?(X=S,S=S.nextZ,ti--):(X=O,O=O.nextZ,tr--):(X=S,S=S.nextZ,ti--),Y?Y.nextZ=X:g=X,X.prevZ=Y,Y=X;S=O}Y.nextZ=null,ta*=2}while(te>1)}(X)}(g,O,X,Y);for(var ti=g,tr=null,ta=null;g.prev!==g.next;)if(tr=g.prev,ta=g.next,Y?UW(g,O,X,Y):VW(g))v.push(tr.i/S),v.push(g.i/S),v.push(ta.i/S),iX(g),g=ta.next,ti=ta.next;else if((g=ta)===ti){te?1===te?kW(g=HW(g,v,S),v,S,O,X,Y,2):2===te&&zW(g,v,S,O,X,Y):kW(GW(g),v,S,O,X,Y,1);break}}}function VW(g){var v=g.prev,S=g,O=g.next;if(JW(v,S,O)>=0)return!1;for(var X=g.next.next;X!==g.prev;){if(qW(v.x,v.y,S.x,S.y,O.x,O.y,X.x,X.y)&&JW(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function UW(g,v,S,O){var X=g.prev,Y=g,te=g.next;if(JW(X,Y,te)>=0)return!1;for(var ti=X.x<Y.x?X.x<te.x?X.x:te.x:Y.x<te.x?Y.x:te.x,tr=X.y<Y.y?X.y<te.y?X.y:te.y:Y.y<te.y?Y.y:te.y,ta=X.x>Y.x?X.x>te.x?X.x:te.x:Y.x>te.x?Y.x:te.x,th=X.y>Y.y?X.y>te.y?X.y:te.y:Y.y>te.y?Y.y:te.y,tu=jW(ti,tr,v,S,O),tl=jW(ta,th,v,S,O),tc=g.nextZ;tc&&tc.z<=tl;){if(tc!==g.prev&&tc!==g.next&&qW(X.x,X.y,Y.x,Y.y,te.x,te.y,tc.x,tc.y)&&JW(tc.prev,tc,tc.next)>=0)return!1;tc=tc.nextZ}for(tc=g.prevZ;tc&&tc.z>=tu;){if(tc!==g.prev&&tc!==g.next&&qW(X.x,X.y,Y.x,Y.y,te.x,te.y,tc.x,tc.y)&&JW(tc.prev,tc,tc.next)>=0)return!1;tc=tc.prevZ}return!0}function HW(g,v,S){var O=g;do{var X=O.prev,Y=O.next.next;!QW(X,Y)&&ZW(X,O,O.next,Y)&&$W(X,Y)&&$W(Y,X)&&(v.push(X.i/S),v.push(O.i/S),v.push(Y.i/S),iX(O),iX(O.next),O=g=Y),O=O.next}while(O!==g);return O}function zW(g,v,S,O,X,Y){var te=g;do{for(var ti=te.next.next;ti!==te.prev;){if(te.i!==ti.i&&KW(te,ti)){var tr=tX(te,ti);return te=GW(te,te.next),tr=GW(tr,tr.next),kW(te,v,S,O,X,Y),void kW(tr,v,S,O,X,Y)}ti=ti.next}te=te.next}while(te!==g)}function WW(g,v){return g.x-v.x}function XW(g,v){if(v=function(g,v){var S=v,O=g.x,X=g.y,Y=-1/0,te=null;do{if(X<=S.y&&X>=S.next.y){var ti=S.x+(X-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(ti<=O&&ti>Y){if(Y=ti,ti===O){if(X===S.y)return S;if(X===S.next.y)return S.next}te=S.x<S.next.x?S:S.next}}S=S.next}while(S!==v);if(!te)return null;if(O===Y)return te.prev;var tr,ta=te,th=te.x,tu=te.y,tl=1/0;for(S=te.next;S!==ta;)O>=S.x&&S.x>=th&&qW(X<tu?O:Y,X,th,tu,X<tu?Y:O,X,S.x,S.y)&&((tr=Math.abs(X-S.y)/(O-S.x))<tl||tr===tl&&S.x>te.x)&&$W(S,g)&&(te=S,tl=tr),S=S.next;return te}(g,v)){var S=tX(v,g);GW(S,S.next)}}function jW(g,v,S,O,X){return(g=0x55555555&((g=0x33333333&((g=0xf0f0f0f&((g=0xff00ff&((g=32767*(g-S)/X)|g<<8))|g<<4))|g<<2))|g<<1))|(v=0x55555555&((v=0x33333333&((v=0xf0f0f0f&((v=0xff00ff&((v=32767*(v-O)/X)|v<<8))|v<<4))|v<<2))|v<<1))<<1}function YW(g){var v=g,S=g;do v.x<S.x&&(S=v),v=v.next;while(v!==g);return S}function qW(g,v,S,O,X,Y,te,ti){return(X-te)*(v-ti)-(g-te)*(Y-ti)>=0&&(g-te)*(O-ti)-(S-te)*(v-ti)>=0&&(S-te)*(Y-ti)-(X-te)*(O-ti)>=0}function KW(g,v){return g.next.i!==v.i&&g.prev.i!==v.i&&!function(g,v){var S=g;do{if(S.i!==g.i&&S.next.i!==g.i&&S.i!==v.i&&S.next.i!==v.i&&ZW(S,S.next,g,v))return!0;S=S.next}while(S!==g);return!1}(g,v)&&$W(g,v)&&$W(v,g)&&function(g,v){var S=g,O=!1,X=(g.x+v.x)/2,Y=(g.y+v.y)/2;do S.y>Y!=S.next.y>Y&&X<(S.next.x-S.x)*(Y-S.y)/(S.next.y-S.y)+S.x&&(O=!O),S=S.next;while(S!==g);return O}(g,v)}function JW(g,v,S){return(v.y-g.y)*(S.x-v.x)-(v.x-g.x)*(S.y-v.y)}function QW(g,v){return g.x===v.x&&g.y===v.y}function ZW(g,v,S,O){return!!(QW(g,v)&&QW(S,O)||QW(g,O)&&QW(S,v))||JW(g,v,S)>0!=JW(g,v,O)>0&&JW(S,O,g)>0!=JW(S,O,v)>0}function $W(g,v){return JW(g.prev,g,g.next)<0?JW(g,v,g.next)>=0&&JW(g,g.prev,v)>=0:JW(g,v,g.prev)<0||JW(g,g.next,v)<0}function tX(g,v){var S=new NK(g.i,g.x,g.y),O=new NK(v.i,v.x,v.y),X=g.next,Y=v.prev;return g.next=v,v.prev=g,S.next=X,X.prev=S,O.next=S,S.prev=O,Y.next=O,O.prev=Y,O}function eX(g,v,S,O){var X=new NK(g,v,S);return O?(X.next=O.next,X.prev=O,O.next.prev=X,O.next=X):(X.prev=X,X.next=X),X}function iX(g){g.next.prev=g.prev,g.prev.next=g.next,g.prevZ&&(g.prevZ.nextZ=g.nextZ),g.nextZ&&(g.nextZ.prevZ=g.prevZ)}function nX(g,v,S){S=S||3;var O=v?v.length:0,X=O?v[0]*S:g.length,Y=NW(g,0,X,S,!0),te=[];if(!Y)return te;var ti=0,tr=0,ta=0,th=0,tu=0,tl=0,tc=0;if(O&&(Y=function(g,v,S,O){var X,Y=[],te=0,ti=null;for(te=0,X=v.length;te<X;te++)(ti=NW(g,v[te]*O,te<X-1?v[te+1]*O:g.length,O,!1))&&(ti===ti.next&&(ti.steiner=!0),Y.push(YW(ti)));if(Y.sort(WW),!S)return S;for(te=0;te<Y.length;te++)XW(Y[te],S),S=GW(S,S.next);return S}(g,v,Y,S)),g.length>80*S){ti=ta=g[0],tr=th=g[1];for(var t_=S;t_<X;t_+=S)(tu=g[t_])<ti&&(ti=tu),(tl=g[t_+1])<tr&&(tr=tl),tu>ta&&(ta=tu),tl>th&&(th=tl);tc=Math.max(ta-ti,th-tr)}return kW(Y,te,S,ti,tr,tc),te}for(var NJ=Math.PI,NQ=Math.min,N0=Math.max,N1=Math.ceil,N2=Math.acos,N3=Math.cos,N5=Math.sin,N4=Math.atan2,N8=null,N6=null,N7=new is,N9=[],ki=0;ki<4;ki++)N9.push(new eL);function gX(g,v,S){return g<v?v:g>S?S:g}var kn={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(g,v){if(!N6)return null;var S=N6.getRenderDataList(),O=S[N6.dataOffset];if(!O)return null;var X=O,Y=X?X.vertexStart+v:0;return(Y>65535||3*Y>131070)&&(++N6.dataOffset,N6.dataOffset<S.length?O=S[N6.dataOffset]:(O=N6.requestRenderData(),S[N6.dataOffset]=O),X=O),X&&X.vertexCount<Y&&X.request(v,3*v),O},stroke:function(g){is.copy(N7,g.strokeColor),g.impl&&(this._flattenPaths(g.impl),this._expandStroke(g),g.impl.updatePathOffset=!0,this.end(g))},fill:function(g){is.copy(N7,g.fillColor),this._expandFill(g),g.impl&&(g.impl.updatePathOffset=!0),this.end(g)},end:function(g){g.markForUpdateRenderData()},_expandStroke:function(g){var v,S,O,X,Y=.5*g.lineWidth,te=g.lineCap,ti=g.lineJoin,tr=g.miterLimit;if(N6=g.impl){var ta=(v=Y,S=NJ,O=N6.tessTol,X=2*N2(v/(v+O)),N0(2,N1(S/X)));this._calculateJoins(N6,Y,ti,tr);for(var th=N6.paths,tu=0,tl=N6.pathOffset,tc=N6.pathLength;tl<tc;tl++){var t_=th[tl],tf=t_.points.length;ti===MV.ROUND?tu+=2*(tf+t_.bevel*(ta+2)+1):tu+=2*(tf+5*t_.bevel+1),t_.closed||(te===MG.ROUND?tu+=2*(2*ta+2):tu+=12)}var tp=N8=this.getRenderData(g,tu);if(tp){for(var tm=tp.vData,tg=tp.iData,tv=N6.pathOffset,ty=N6.pathLength;tv<ty;tv++){var tS=th[tv],tA=tS.points,tT=tA.length,tE=tp.vertexStart,tC=void 0,tx=void 0,tb=0,tw=0,tI=tS.closed;if(tI?(tC=tA[tT-1],tx=tA[0],tb=0,tw=tT):(tC=tA[0],tx=tA[1],tb=1,tw=tT-1),tx=tx||tC,!tI){var tB=new Ok(tx.x,tx.y);tB.subtract(tC),tB.normalize();var tP=tB.x,tD=tB.y;te===MG.BUTT?this._buttCapStart(tC,tP,tD,Y,0):te===MG.SQUARE?this._buttCapStart(tC,tP,tD,Y,Y):te===MG.ROUND&&this._roundCapStart(tC,tP,tD,Y,ta)}for(var tM=tb;tM<tw;++tM)ti===MV.ROUND?this._roundJoin(tC,tx,Y,Y,ta):0!=(tx.flags&(MU.PT_BEVEL|MU.PT_INNERBEVEL))?this._bevelJoin(tC,tx,Y,Y):(this._vSet(tx.x+tx.dmx*Y,tx.y+tx.dmy*Y,1),this._vSet(tx.x-tx.dmx*Y,tx.y-tx.dmy*Y,-1)),tC=tx,tx=tA[tM+1];if(tI){var tO=8*tE;this._vSet(tm[tO],tm[tO+1],1),this._vSet(tm[tO+8],tm[tO+8+1],-1)}else{var tk=new Ok(tx.x,tx.y);tk.subtract(tC),tk.normalize();var tG=tk.x,tV=tk.y;te===MG.BUTT?this._buttCapEnd(tx,tG,tV,Y,0):te===MG.SQUARE?this._buttCapEnd(tx,tG,tV,Y,Y):te===MG.ROUND&&this._roundCapEnd(tx,tG,tV,Y,ta)}for(var tU=tp.indexStart,tH=tE+2,tz=tp.vertexStart;tH<tz;tH++)tg[tU++]=tH-2,tg[tU++]=tH-1,tg[tU++]=tH;tp.indexStart=tU}N8=null,N6=null}}},_expandFill:function(g){if(N6=g.impl){for(var v=N6.paths,S=0,O=N6.pathOffset,X=N6.pathLength;O<X;O++)S+=v[O].points.length;var Y=N8=this.getRenderData(g,S);if(Y){for(var te=Y,ti=te.vData,tr=te.iData,ta=N6.pathOffset,th=N6.pathLength;ta<th;ta++){var tu=v[ta],tl=tu.points,tc=tl.length;if(0!==tc){for(var t_=Y.vertexStart,tf=0;tf<tc;++tf)this._vSet(tl[tf].x,tl[tf].y);var tp=Y.indexStart;if(tu.complex){for(var tm=[],tg=t_,tv=Y.vertexStart;tg<tv;tg++){var ty=8*tg;tm.push(ti[ty++]),tm.push(ti[ty++]),tm.push(ti[ty++])}var tS=nX(tm,null,3);if(!tS||0===tS.length)continue;for(var tA=0,tT=tS.length;tA<tT;tA++)tr[tp++]=tS[tA]+t_}else for(var tE=t_,tC=t_+2,tx=te.vertexStart;tC<tx;tC++)tr[tp++]=tE,tr[tp++]=tC-1,tr[tp++]=tC;te.indexStart=tp}}N8=null,N6=null}}},_calculateJoins:function(g,v,S,O){var X=0;v>0&&(X=1/v);for(var Y=g.paths,te=g.pathOffset,ti=g.pathLength;te<ti;te++){var tr=Y[te],ta=tr.points,th=ta.length,tu=ta[th-1],tl=ta[0];tr.bevel=0;for(var tc=0;tc<th;tc++){var t_,tf,tp=tu.dy,tm=-tu.dx,tg=tl.dy,tv=-tl.dx;if(tl.dmx=.5*(tp+tg),tl.dmy=.5*(tm+tv),(t_=tl.dmx*tl.dmx+tl.dmy*tl.dmy)>1e-6){var ty=1/t_;ty>600&&(ty=600),tl.dmx*=ty,tl.dmy*=ty}tl.dx*tu.dy-tu.dx*tl.dy>0&&(tl.flags|=MU.PT_LEFT),t_*(tf=N0(11,NQ(tu.len,tl.len)*X))*tf<1&&(tl.flags|=MU.PT_INNERBEVEL),tl.flags&MU.PT_CORNER&&(t_*O*O<1||S===MV.BEVEL||S===MV.ROUND)&&(tl.flags|=MU.PT_BEVEL),0!=(tl.flags&(MU.PT_BEVEL|MU.PT_INNERBEVEL))&&tr.bevel++,tu=tl,tl=ta[tc+1]}}},_flattenPaths:function(g){for(var v=g.paths,S=g.pathOffset,O=g.pathLength;S<O;S++){var X=v[S],Y=X.points,te=Y[Y.length-1],ti=Y[0];Y.length>2&&te.equals(ti)&&(X.closed=!0,Y.pop(),te=Y[Y.length-1]);for(var tr=0,ta=Y.length;tr<ta;tr++){var th=new Ok(ti.x,ti.y);th.subtract(te),te.len=th.length(),(th.x||th.y)&&th.normalize(),te.dx=th.x,te.dy=th.y,te=ti,ti=Y[tr+1]}}},_chooseBevel:function(g,v,S,O){var X=S.x,Y=S.y,te=0,ti=0,tr=0,ta=0;return 0!==g?(te=X+v.dy*O,ti=Y-v.dx*O,tr=X+S.dy*O,ta=Y-S.dx*O):(te=tr=X+S.dmx*O,ti=ta=Y+S.dmy*O),[te,ti,tr,ta]},_buttCapStart:function(g,v,S,O,X){var Y=g.x-v*X,te=g.y-S*X,ti=S,tr=-v;this._vSet(Y+ti*O,te+tr*O,1),this._vSet(Y-ti*O,te-tr*O,-1)},_buttCapEnd:function(g,v,S,O,X){var Y=g.x+v*X,te=g.y+S*X,ti=S,tr=-v;this._vSet(Y+ti*O,te+tr*O,1),this._vSet(Y-ti*O,te-tr*O,-1)},_roundCapStart:function(g,v,S,O,X){for(var Y=g.x,te=g.y,ti=S,tr=-v,ta=0;ta<X;ta++){var th=ta/(X-1)*NJ,tu=N3(th)*O,tl=N5(th)*O;this._vSet(Y-ti*tu-v*tl,te-tr*tu-S*tl,1),this._vSet(Y,te,0)}this._vSet(Y+ti*O,te+tr*O,1),this._vSet(Y-ti*O,te-tr*O,-1)},_roundCapEnd:function(g,v,S,O,X){var Y=g.x,te=g.y,ti=S,tr=-v;this._vSet(Y+ti*O,te+tr*O,1),this._vSet(Y-ti*O,te-tr*O,-1);for(var ta=0;ta<X;ta++){var th=ta/(X-1)*NJ,tu=N3(th)*O,tl=N5(th)*O;this._vSet(Y,te,0),this._vSet(Y-ti*tu+v*tl,te-tr*tu+S*tl,1)}},_roundJoin:function(g,v,S,O,X){var Y=g.dy,te=-g.dx,ti=v.dy,tr=-v.dx,ta=v.x,th=v.y;if(0!=(v.flags&MU.PT_LEFT)){var tu=this._chooseBevel(v.flags&MU.PT_INNERBEVEL,g,v,S),tl=tu[0],tc=tu[1],t_=tu[2],tf=tu[3],tp=N4(-te,-Y),tm=N4(-tr,-ti);tm>tp&&(tm-=2*NJ),this._vSet(tl,tc,1),this._vSet(ta-Y*O,v.y-te*O,-1);for(var tg=gX(N1((tp-tm)/NJ)*X,2,X),tv=0;tv<tg;tv++){var ty=tp+tv/(tg-1)*(tm-tp),tS=ta+N3(ty)*O,tA=th+N5(ty)*O;this._vSet(ta,th,0),this._vSet(tS,tA,-1)}this._vSet(t_,tf,1),this._vSet(ta-ti*O,th-tr*O,-1)}else{var tT=this._chooseBevel(v.flags&MU.PT_INNERBEVEL,g,v,-O),tE=tT[0],tC=tT[1],tx=tT[2],tb=tT[3],tw=N4(te,Y),tI=N4(tr,ti);tI<tw&&(tI+=2*NJ),this._vSet(ta+Y*O,th+te*O,1),this._vSet(tE,tC,-1);for(var tB=gX(N1((tI-tw)/NJ)*X,2,X),tP=0;tP<tB;tP++){var tD=tw+tP/(tB-1)*(tI-tw),tM=ta+N3(tD)*S,tO=th+N5(tD)*S;this._vSet(tM,tO,1),this._vSet(ta,th,0)}this._vSet(ta+ti*O,th+tr*O,1),this._vSet(tx,tb,-1)}},_bevelJoin:function(g,v,S,O){var X=0,Y=0,te=0,ti=0,tr=0,ta=0,th=0,tu=0,tl=g.dy,tc=-g.dx,t_=v.dy,tf=-v.dx;if(v.flags&MU.PT_LEFT){var tp=this._chooseBevel(v.flags&MU.PT_INNERBEVEL,g,v,S);tr=tp[0],ta=tp[1],th=tp[2],tu=tp[3],this._vSet(tr,ta,1),this._vSet(v.x-tl*O,v.y-tc*O,-1),this._vSet(th,tu,1),this._vSet(v.x-t_*O,v.y-tf*O,-1)}else{var tm=this._chooseBevel(v.flags&MU.PT_INNERBEVEL,g,v,-O);X=tm[0],Y=tm[1],te=tm[2],ti=tm[3],this._vSet(v.x+tl*S,v.y+tc*S,1),this._vSet(X,Y,-1),this._vSet(v.x+t_*S,v.y+tf*S,1),this._vSet(te,ti,-1)}},_vSet:function(g,v,S){if(void 0===S&&(S=0),N8){var O=N8,X=8*O.vertexStart,Y=O.vData;Y[X++]=g,Y[X++]=v,Y[X++]=0,is.toArray(Y,N7,X),X+=4,Y[X++]=S,O.vertexStart++}}},ks=g("g",{getAssembler:function(){return kn}});OW.Assembler=ks;var ka=["left","center","right"],ko=2048,kh=(1/255).toFixed(3),EX=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},kl=function(){function t1(){this._context=null,this._canvas=null,this._canvasData=null,this._lettersInfo=[],this._tmpRect=new ic,this._maxFontSize=100,this._fontScale=1,this._canvasData=B4.getInstance().get(),this._canvas=this._canvasData.canvas,this._context=this._canvasData.context}var g=t1.prototype;return g.destroy=function(){B4.getInstance().put(this._canvasData),this._lettersInfo.length=0},g.processingString=function(g,v,S,O,X,Y){if(g)v.fntConfig?this._fontScale=1:this._fontScale=this._getStyleFontScale(v.originFontSize,v.fontScale),Ps.fontScale=this._fontScale,this._setupBMFontOverflowMetrics(S,O),this._updateFontScale(v),this._computeHorizontalKerningForText(v,S,X),this._alignText(v,S,O,X);else{var te=0;for(this._fontScale=this._getStyleFontScale(v.fontSize,v.fontScale),this._updatePaddingRect(v,O),this._calculateLabelFont(v,S,O,X);(O.canvasSize.width>ko||O.canvasSize.height>ko)&&te<=3;){if(++te>3)this._fontScale=1;else{var ti=Math.max(O.canvasSize.width,O.canvasSize.height),tr=ko/ti;this._fontScale*=tr,this._fontScale=Math.max(1,this._fontScale)}this._updatePaddingRect(v,O),this._calculateLabelFont(v,S,O,X)}}Y&&(Y=O.parsedString)},g.generateRenderInfo=function(g,v,S,O,X,Y,te){g?(this._computeAlignmentOffset(v,S,O),this.generateVertexData(g,v,S,O,X,Y,te)):(this._updateLabelDimensions(v,S,O),this._updateTexture(v,S,O,X),this.generateVertexData(g,v,S,O,X,Y,te))},g.setCanvasUsed=function(g,v){this._canvas=g,this._context=v},g._getStyleFontScale=function(g,v){var S=v;return S*g>this._maxFontSize&&g<this._maxFontSize&&(S=this._maxFontSize/g),S<1&&(S=1),S},g._calculateLabelFont=function(g,v,S,O){if(this._context){g.actualFontSize=g.fontSize*this._fontScale;var X=O.split("\n"),Y=S.parsedString=X,te=this._getFontDesc(g.actualFontSize,g.fontFamily,g.isBold,g.isItalic);switch(this._context.font=g.fontDesc=te,v.overFlow){case D5.NONE:for(var ti=0,tr=0;tr<X.length;++tr){var ta=KF(this._context,X[tr],te);ti=ti>ta?ti:ta}var th=ti,tu=(Y.length+BC)*this._getLineHeight(v.lineHeight,g.actualFontSize,g.fontSize);S.canvasSize.width=th+S.canvasPadding.width*this._fontScale,S.canvasSize.height=tu+S.canvasPadding.height*this._fontScale,S.nodeContentSize.width=(th+S.contentSizeExtend.width*this._fontScale)/this._fontScale,S.nodeContentSize.height=(tu+S.contentSizeExtend.height*this._fontScale)/this._fontScale;break;case D5.SHRINK:this._calculateShrinkFont(X,g,v,S),this._calculateWrapText(X,g,v,S),S.canvasSize.width=S.nodeContentSize.width*this._fontScale,S.canvasSize.height=S.nodeContentSize.height*this._fontScale;break;case D5.CLAMP:this._calculateWrapText(X,g,v,S),S.canvasSize.width=S.nodeContentSize.width*this._fontScale,S.canvasSize.height=S.nodeContentSize.height*this._fontScale;break;case D5.RESIZE_HEIGHT:this._calculateWrapText(X,g,v,S);var tl=(S.parsedString.length+BC)*this._getLineHeight(v.lineHeight,g.actualFontSize,g.fontSize);S.canvasSize.width=S.nodeContentSize.width*this._fontScale,S.canvasSize.height=tl+S.canvasPadding.height*this._fontScale,S.nodeContentSize.height=(tl+S.contentSizeExtend.height*this._fontScale)/this._fontScale}}},g._getFontDesc=function(g,v,S,O){var X=g.toString()+"px ";return X+=v,S&&(X="bold "+X),O&&(X="italic "+X),X},g._getLineHeight=function(g,v,S){return 0===g?v:g*v/S},g._calculateShrinkFont=function(g,v,S,O){if(this._context){var X=this._getFontDesc(v.actualFontSize,v.fontFamily,v.isBold,v.isItalic);this._context.font=X;var Y=this._calculateParagraphLength(g,this._context,X),te=0,ti=0,tr=0,ta=v.actualFontSize;if(S.wrapping){var th=O.nodeContentSize.width*this._fontScale,tu=O.nodeContentSize.height*this._fontScale;if(th<0||tu<0)return;ti=tu+1;for(var tl=0,tc=0|v.actualFontSize+1,t_=0;tl<tc;){if((t_=tl+tc+1>>1)<=0){j(4003);break}ta=t_,X=this._getFontDesc(ta,v.fontFamily,v.isBold,v.isItalic),this._context.font=X;var tf=this._getLineHeight(S.lineHeight,ta,v.fontSize);for(ti=0,te=0;te<g.length;++te){var tp=KF(this._context,g[te],X);ti+=rN(g[te],tp,th,this._measureText(this._context,X)).length*tf}ti>tu?tc=t_-1:tl=t_}0===tl?j(4003):(ta=tl,X=this._getFontDesc(ta,v.fontFamily,v.isBold,v.isItalic),this._context.font=X)}else{for(ti=g.length*this._getLineHeight(S.lineHeight,ta,v.fontSize),te=0;te<g.length;++te)tr<Y[te]&&(tr=Y[te]);var tm=(O.canvasSize.width-O.canvasPadding.width)*this._fontScale/tr,tg=O.canvasSize.height*this._fontScale/ti;ta=v.actualFontSize*Math.min(1,tm,tg)|0,X=this._getFontDesc(ta,v.fontFamily,v.isBold,v.isItalic),this._context.font=X}v.actualFontSize=ta,v.fontDesc=X}},g._calculateWrapText=function(g,v,S,O){if(S.wrapping&&this._context){var X=[],Y=O.nodeContentSize.width*this._fontScale,te=this._getFontDesc(v.actualFontSize,v.fontFamily,v.isBold,v.isItalic);this._context.font=te;for(var ti=0;ti<g.length;++ti){var tr=KF(this._context,g[ti],te),ta=rN(g[ti],tr,Y,this._measureText(this._context,te));X=X.concat(ta)}O.parsedString=X,v.fontDesc=te}},g._measureText=function(g,v){return function(S){return KF(g,S,v)}},g._calculateParagraphLength=function(g,v,S){for(var O,X=[],Y=f(g);!(O=Y()).done;){var te=KF(v,O.value,S);X.push(te)}return X},g._updatePaddingRect=function(g,v){var S=0,O=0,X=0,Y=0,te=0;if(v.contentSizeExtend.width=v.contentSizeExtend.height=0,g.isOutlined&&(S=O=X=Y=te=g.outlineWidth,v.contentSizeExtend.width=v.contentSizeExtend.height=2*te),g.hasShadow){var ti=g.shadowBlur+te,tr=g.shadowOffsetX,ta=g.shadowOffsetY;X=Math.max(X,-tr+ti),Y=Math.max(Y,tr+ti),S=Math.max(S,ta+ti),O=Math.max(O,-ta+ti)}if(g.isItalic){var th=g.fontSize*Math.tan(.20943951);Y+=th,v.contentSizeExtend.width+=th}v.canvasPadding.x=X,v.canvasPadding.y=S,v.canvasPadding.width=X+Y,v.canvasPadding.height=S+O},g._updateLabelDimensions=function(g,v,S){S.canvasSize.width=Math.min(S.canvasSize.width,ko),S.canvasSize.height=Math.min(S.canvasSize.height,ko),this._canvas.width=S.canvasSize.width,this._canvas.height=S.canvasSize.height,this._context.font=g.fontDesc,this._context.textAlign=ka[v.horizontalAlign],this._context.textBaseline="alphabetic"},g._calculateFillTextStartPosition=function(g,v,S){var O=0;v.horizontalAlign===D2.RIGHT?O=S.canvasSize.width-S.canvasPadding.width:v.horizontalAlign===D2.CENTER&&(O=(S.canvasSize.width-S.canvasPadding.width)/2);var X=this._getLineHeight(v.lineHeight,g.actualFontSize,g.fontSize)*(S.parsedString.length-1),Y=g.actualFontSize*(1-BC/2);if(v.verticalAlign!==D3.TOP){var te=X+S.canvasPadding.height+g.actualFontSize-S.canvasSize.height;v.verticalAlign===D3.BOTTOM?Y-=te+=BC/2*g.actualFontSize:Y-=te/2}Y+=0*g.actualFontSize,S.startPosition.set(O+S.canvasPadding.x,Y+S.canvasPadding.y)},g._updateTexture=function(g,v,S,O){if(this._context&&this._canvas){this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.font=g.fontDesc,this._calculateFillTextStartPosition(g,v,S);var X=this._getLineHeight(v.lineHeight,g.actualFontSize,g.fontSize);this._context.lineJoin="round",g.isOutlined?(this._context.fillStyle="rgba("+g.outlineColor.r+", "+g.outlineColor.g+", "+g.outlineColor.b+", "+kh+")",this._context.fillRect(0,0,this._canvas.width,this._canvas.height)):(this._context.fillStyle="rgba("+g.color.r+", "+g.color.g+", "+g.color.b+", "+kh+")",this._context.fillRect(0,0,this._canvas.width,this._canvas.height)),this._context.fillStyle="rgb("+g.color.r+", "+g.color.g+", "+g.color.b+")";var Y=new e8(S.startPosition.x,S.startPosition.y),te=Y.x,ti=0;this._drawTextEffect(Y,X,g,v,S);for(var tr=0;tr<S.parsedString.length;++tr)ti=Y.y+tr*X,g.hasShadow&&(this._setupShadow(g),this._context.fillText(S.parsedString[tr],te,ti)),g.isOutlined&&(this._setupOutline(g),this._context.strokeText(S.parsedString[tr],te,ti)),g.hasShadow&&!g.isOutlined||this._context.fillText(S.parsedString[tr],te,ti);g.hasShadow&&(this._context.shadowColor="transparent"),this._uploadTexture(O)}},g._uploadTexture=function(g){var v;g.texture&&this._canvas&&(v=_instanceof(g.texture,Bf)?g.texture.texture:g.texture,0!==this._canvas.width&&0!==this._canvas.height&&(v.reset({width:this._canvas.width,height:this._canvas.height,mipmapLevel:1}),v.uploadData(this._canvas),v.setWrapMode(lR.CLAMP_TO_EDGE,lR.CLAMP_TO_EDGE),_instanceof(g.texture,Bf)&&(g.texture.rect=new ic(0,0,this._canvas.width,this._canvas.height),g.texture._calculateUV()),X.director.root&&X.director.root.batcher2D&&X.director.root.batcher2D._releaseDescriptorSetCache(v.getHash())))},g._drawTextEffect=function(g,v,S,O,X){if(S.hasShadow||S.isOutlined||S.isUnderline){for(var Y=X.parsedString.length>1&&S.hasShadow,te=this._measureText(this._context,S.fontDesc),ti=0,tr=0,ta=0;ta<X.parsedString.length;++ta)if(ti=g.x,tr=g.y+ta*v,Y&&(S.hasShadow&&(this._setupShadow(S),this._context.fillText(X.parsedString[ta],ti,tr)),S.isOutlined&&(this._setupOutline(S),this._context.strokeText(X.parsedString[ta],ti,tr)),S.hasShadow&&!S.isOutlined||this._context.fillText(X.parsedString[ta],ti,tr)),S.isUnderline){var th=te(X.parsedString[ta]),tu=new e8;O.horizontalAlign===D2.RIGHT?tu.x=g.x-th:O.horizontalAlign===D2.CENTER?tu.x=g.x-th/2:tu.x=g.x,tu.y=tr+S.actualFontSize/8,this._context.fillRect(tu.x,tu.y,th,S.underlineHeight*this._fontScale)}Y&&(this._context.shadowColor="transparent")}},g._setupOutline=function(g){this._context.shadowBlur=0,this._context.shadowOffsetX=0,this._context.shadowOffsetY=0,this._context.strokeStyle="rgba("+g.outlineColor.r+", "+g.outlineColor.g+", "+g.outlineColor.b+", "+g.outlineColor.a/255+")",this._context.lineWidth=2*g.outlineWidth*this._fontScale},g._setupShadow=function(g){var v=this._fontScale;this._context.shadowColor="rgba("+g.shadowColor.r+", "+g.shadowColor.g+", "+g.shadowColor.b+", "+g.shadowColor.a/255+")",this._context.shadowBlur=g.shadowBlur*v,this._context.shadowOffsetX=g.shadowOffsetX*v,this._context.shadowOffsetY=-g.shadowOffsetY*v},g.generateVertexData=function(g,v,S,O,X,Y,te){g?this._updateQuads(v,S,O,X,Y,te):(this.updateQuatCount(X),te(v,O,X))},g.updateQuatCount=function(g){var v=g.vertexBuffer,S=g.quadCount;if(v.length!==S){for(var O=v.length;O<S;O++)v.push({x:0,y:0,z:0,u:0,v:0,color:is.WHITE.clone()});v.length=S}},g._setupBMFontOverflowMetrics=function(g,v){var S=v.nodeContentSize.width,O=v.nodeContentSize.height;g.overFlow===D5.RESIZE_HEIGHT&&(O=0),g.overFlow===D5.NONE&&(S=0,O=0),g.textWidthTemp=S,g.textHeightTemp=O,g.textDimensions.width=S,g.textDimensions.height=O,g.maxLineWidth=S},g._updateFontScale=function(g){g.bmfontScale=g.actualFontSize/(g.originFontSize*this._fontScale)},g._computeHorizontalKerningForText=function(g,v,S){var O=S,X=O.length;if(g.fntConfig){var Y=g.fntConfig.kerningDict,te=v.horizontalKerning;if(Y&&0!==Y.length)for(var ti=-1,tr=0;tr<X;++tr){var ta=O.charCodeAt(tr),th=Y[ti<<16|65535&ta]||0;te[tr]=tr<X-1?th:0,ti=ta}}},g._alignText=function(g,v,S,O){this._multilineTextWrap(g,v,S,O,this._getFirstWordLen),v.overFlow===D5.SHRINK&&(g.fontSize>0&&this._isVerticalClamp(g,v,S,O,this)&&this._shrinkLabelToContentSize(g,v,S,O,this._isVerticalClamp),g.fontSize>0&&this._isHorizontalNeedShrink(v,S)&&this._shrinkLabelToContentSize(g,v,S,O,this._isHorizontalClamp)),this._parsedString(S,O)},g._parsedString=function(g,v){for(var S=[],O="",X=0,Y=0,te=JF(v);X<te;++X){var ti=this._lettersInfo[X];ti.valid&&(Y===ti.line?O+=ti.char:(S=S.concat(O),Y=ti.line,O=""))}S=S.concat(O),g.parsedString=S},g._multilineTextWrap=function(g,v,S,O,X){v.linesWidth.length=0;for(var Y=O,te=Y.length,ti=0,tr=0,ta=0,th=0,tu=0,tl=0,tc=0,t_=null,tf=0;tf<te;){var tp=QF(Y,tf);if("\n"!==tp){for(var tm=X(g,v,Y,tf,te),tg=tl,tv=tc,ty=tu,tS=tr,tA=!1,tT=new e8,tE=0;tE<tm;++tE){var tC=tf+tE;if("\r"!==(tp=QF(Y,tC))){if(t_=Ps.fontAtlas.getLetterDefinitionForChar(tp,Ps)){var tx=tS+t_.offsetX*g.bmfontScale-Ps.margin;if(v.wrapping&&v.maxLineWidth>0&&tr>0&&tx+t_.w*g.bmfontScale>v.maxLineWidth&&!qF(tp)){v.linesWidth.push(tu),tu=0,ti++,tr=0,ta-=v.lineHeight*this._getFontScale(g,v)+0,tA=!0;break}tT.x=tx,tT.y=ta-t_.offsetY*g.bmfontScale,this._recordLetterInfo(tT,tp,tC,ti),tC+1<v.horizontalKerning.length&&tC<te-1&&(tS+=v.horizontalKerning[tC+1]*g.bmfontScale),tS+=t_.xAdvance*g.bmfontScale+v.spacingX,ty=tT.x+t_.w*g.bmfontScale,tg<tT.y&&(tg=tT.y),tv>tT.y-t_.h*g.bmfontScale&&(tv=tT.y-t_.h*g.bmfontScale)}else this._recordPlaceholderInfo(tC,tp),null!=g.fntConfig?N("Can't find letter definition in texture atlas "+g.fntConfig.atlasName+" for letter:"+tp):N("Can't find letter definition in font family "+g.fontFamily+" for letter:"+tp)}else this._recordPlaceholderInfo(tC,tp)}tA||(tr=tS,tl<tg&&(tl=tg),tc>tv&&(tc=tv),th<(tu=ty)&&(th=tu),tf+=tm)}else v.linesWidth.push(tu),tu=0,ti++,tr=0,ta-=v.lineHeight*this._getFontScale(g,v)+0,this._recordPlaceholderInfo(tf,tp),tf++}return v.linesWidth.push(tu),v.numberOfLines=ti+1,v.textDesiredHeight=v.numberOfLines*v.lineHeight*this._getFontScale(g,v),v.numberOfLines>1&&(v.textDesiredHeight+=0*(v.numberOfLines-1)),S.nodeContentSize.width=v.textWidthTemp,S.nodeContentSize.height=v.textHeightTemp,v.textWidthTemp<=0&&(S.nodeContentSize.width=parseFloat(th.toFixed(2))+2*Ps.margin),v.textHeightTemp<=0&&(S.nodeContentSize.height=parseFloat(v.textDesiredHeight.toFixed(2))+2*Ps.margin),v.tailoredTopY=S.nodeContentSize.height,v.tailoredBottomY=0,tl>0&&(v.tailoredTopY=S.nodeContentSize.height+tl),tc<-v.textDesiredHeight&&(v.tailoredBottomY=v.textDesiredHeight+tc),!0},g._recordPlaceholderInfo=function(g,v){if(g>=this._lettersInfo.length){var S=new EX;this._lettersInfo.push(S)}this._lettersInfo[g].char=v,this._lettersInfo[g].hash=""+ZF(v,0)+Ps.hash,this._lettersInfo[g].valid=!1},g._recordLetterInfo=function(g,v,S,O){if(S>=this._lettersInfo.length){var X=new EX;this._lettersInfo.push(X)}var Y=""+ZF(v,0)+Ps.hash;this._lettersInfo[S].line=O,this._lettersInfo[S].char=v,this._lettersInfo[S].hash=Y,this._lettersInfo[S].valid=Ps.fontAtlas.getLetter(Y).valid,this._lettersInfo[S].x=g.x,this._lettersInfo[S].y=g.y},g._getFirstWordLen=function(g,v,S,O,X){var Y=QF(S,O);if(YF(Y)||"\n"===Y||qF(Y))return 1;var te=1,ti=Ps.fontAtlas.getLetterDefinitionForChar(Y,Ps);if(!ti)return te;for(var tr=ti.xAdvance*g.bmfontScale+v.spacingX,ta=O+1;ta<X&&(Y=QF(S,ta),ti=Ps.fontAtlas.getLetterDefinitionForChar(Y,Ps));++ta){if(tr+ti.offsetX*g.bmfontScale+ti.w*g.bmfontScale>v.maxLineWidth&&!qF(Y)&&v.maxLineWidth>0)break;if(tr+=ti.xAdvance*g.bmfontScale+v.spacingX,"\n"===Y||qF(Y)||YF(Y))break;te++}return te},g._computeAlignmentOffset=function(g,v,S){switch(v.linesOffsetX.length=0,v.letterOffsetY=0,v.horizontalAlign){case D2.LEFT:for(var O=0;O<v.numberOfLines;++O)v.linesOffsetX.push(0);break;case D2.CENTER:for(var X=0,Y=v.linesWidth.length;X<Y;X++)v.linesOffsetX.push((S.nodeContentSize.width-v.linesWidth[X])/2);break;case D2.RIGHT:for(var te=0,ti=v.linesWidth.length;te<ti;te++)v.linesOffsetX.push(S.nodeContentSize.width-v.linesWidth[te])}if(v.letterOffsetY=S.nodeContentSize.height,v.verticalAlign!==D3.TOP){var tr=S.nodeContentSize.height-v.textDesiredHeight+v.lineHeight*this._getFontScale(g,v)-g.originFontSize*this._fontScale*g.bmfontScale;v.verticalAlign===D3.BOTTOM?v.letterOffsetY-=tr:v.letterOffsetY-=tr/2}},g._getFontScale=function(g,v){return v.overFlow===D5.SHRINK?g.bmfontScale:1},g._isVerticalClamp=function(g,v,S){return v.textDesiredHeight>S.nodeContentSize.height},g._isHorizontalClamp=function(g,v,S,O,X){for(var Y=!1,te=0,ti=JF(O);te<ti;++te){var tr=X._lettersInfo[te];if(tr.valid){var ta=Ps.fontAtlas.getLetterDefinitionForChar(tr.char,Ps);if(!ta)continue;var th=tr.x+ta.w*g.bmfontScale,tu=tr.line;if(v.textWidthTemp>0){if(v.wrapping){if(v.linesWidth[tu]>S.nodeContentSize.width&&(th>S.nodeContentSize.width||th<0)){Y=!0;break}}else if(th>S.nodeContentSize.width){Y=!0;break}}}}return Y},g._isHorizontalNeedShrink=function(g,v){for(var S=0,O=g.linesWidth.length;S<O;++S)if(g.linesWidth[S]>v.nodeContentSize.width)return!0;return!1},g._shrinkLabelToContentSize=function(g,v,S,O,X){for(var Y=0,te=0|g.actualFontSize,ti=0;Y<te;){var tr=ti=Y+te+1>>1;if(tr<=0)break;g.bmfontScale=tr/(g.originFontSize*this._fontScale),this._multilineTextWrap(g,v,S,O,this._getFirstWordLen),this._computeAlignmentOffset(g,v,S),X(g,v,S,O,this)?te=ti-1:Y=ti}Y>=0&&this._scaleFontSizeDown(g,v,S,O,Y)},g._scaleFontSizeDown=function(g,v,S,O,X){var Y=!0;X||(X=.1,Y=!1),g.actualFontSize=X,Y&&(this._updateFontScale(g),this._multilineTextWrap(g,v,S,O,this._getFirstWordLen))},g._updateQuads=function(g,v,S,O,X,Y){for(var te=g.spriteFrame?g.spriteFrame.texture:Ps.fontAtlas.getTexture(),ti=O.uiTransAnchorX*S.nodeContentSize.width,tr=O.uiTransAnchorY*S.nodeContentSize.height,ta=0,th=JF(X);ta<th;++ta){var tu=this._lettersInfo[ta];if(tu.valid){var tl=Ps.fontAtlas.getLetter(tu.hash);if(tl){this._tmpRect.height=tl.h,this._tmpRect.width=tl.w,this._tmpRect.x=tl.u,this._tmpRect.y=tl.v;var tc=tu.y+v.letterOffsetY;if(v.textHeightTemp>0){if(tc>v.tailoredTopY){var t_=tc-v.tailoredTopY;this._tmpRect.y+=t_,this._tmpRect.height-=t_,tc-=t_}tc-this._tmpRect.height*g.bmfontScale<v.tailoredBottomY&&v.overFlow===D5.CLAMP&&(this._tmpRect.height=tc<v.tailoredBottomY?0:(tc-v.tailoredBottomY)/g.bmfontScale)}var tf=tu.line,tp=tu.x+tl.w/2*g.bmfontScale+v.linesOffsetX[tf];if(v.textWidthTemp>0&&this._isHorizontalClamped(v,S,tp,tf)&&v.overFlow===D5.CLAMP&&(this._tmpRect.width=0),this._tmpRect.height>0&&this._tmpRect.width>0){var tm=this._determineRect(g),tg=tu.x+v.linesOffsetX[tu.line],tv=O.quadCount;O.quadCount+=4,this.updateQuatCount(O),Y(g,S,O,tv,te,this._tmpRect,tm,tg-ti,tc-tr)}}else G("Can't find letter in this bitmap-font")}}return!0},g._isHorizontalClamped=function(g,v,S,O){var X=g.linesWidth[O],Y=S>v.nodeContentSize.width||S<0;return g.wrapping?X>v.nodeContentSize.width&&Y:Y},g._determineRect=function(g){var v=g.spriteFrame;if(!v)return!1;var S=v.isRotated(),O=v.getOriginalSize(),X=v.getRect(),Y=v.getOffset(),te=Y.x+(O.width-X.width)/2,ti=Y.y-(O.height-X.height)/2;if(S){var tr=this._tmpRect.x;this._tmpRect.x=X.x+X.height-this._tmpRect.y-this._tmpRect.height-ti,this._tmpRect.y=tr+X.y-te,this._tmpRect.y<0&&(this._tmpRect.height+=ti)}else this._tmpRect.x+=X.x-te,this._tmpRect.y+=X.y+ti;return S},t1}();kl.instance=void 0,kl.instance=new kl;var kc,k_=new Pn(64,64),kf=new B$(null),kd=null,kp=null,kv=null,kS=null,kT={updateProcessingData:function(g,v,S,O,X,Y){g.fontSize=X.fontSize,g.actualFontSize=X.fontSize,g.originFontSize=kv?kv.fontSize:X.fontSize,v.horizontalAlign=X.horizontalAlign,v.verticalAlign=X.verticalAlign,v.spacingX=X.spacingX;var te=X.overflow;v.overFlow=te,v.lineHeight=X.lineHeight,S.nodeContentSize.width=Y.width,S.nodeContentSize.height=Y.height,te===D5.NONE?(v.wrapping=!1,S.nodeContentSize.width+=2*Ps.margin,S.nodeContentSize.height+=2*Ps.margin):te===D5.RESIZE_HEIGHT?(v.wrapping=!0,S.nodeContentSize.height+=2*Ps.margin):v.wrapping=X.enableWrapText,O.uiTransAnchorX=Y.anchorX,O.uiTransAnchorY=Y.anchorY,Ps.lineHeight=X.lineHeight,Ps.fontSize=X.fontSize,g.spriteFrame=kS,g.fntConfig=kv,g.fontFamily=Ps.fontFamily,g.color.set(X.color)},updateRenderData:function(g){if(g.renderData&&kd!==g){if(g.renderData.vertDirty){kp=(kd=g).node._uiProps.uiTransformComp;var v=g.renderData,S=kl.instance,O=g.textStyle,X=g.textLayout,Y=g.textLayoutData,te=g.textRenderData;O.fontScale=Fd.getScaleX(),this._updateFontFamily(g),this.updateProcessingData(O,X,Y,te,g,kp),this._updateLabelInfo(g),O.fontDesc=Ps.fontDesc,S.processingString(!0,O,X,Y,g.string),te.quadCount=0,S.generateRenderInfo(!0,O,X,Y,te,g.string,this.generateVertexData);var ti=!1;v.dataLength!==te.quadCount&&(this.resetRenderData(g),v.dataLength=te.quadCount,v.resize(v.dataLength,v.dataLength/2*3),ti=!0);for(var tr=v.data,ta=0,th=te.quadCount;ta<th;ta++)tr[ta]=te.vertexBuffer[ta];var tu=v.indexCount;this.createQuadIndices(tu),v.chunk.setIndexBuffer(kc),kd.actualFontSize=O.actualFontSize,kp.setContentSize(Y.nodeContentSize),this.updateUVs(g),(kd.renderEntity.colorDirty||ti)&&(this.updateColor(g),kd.node._uiProps.colorDirty=!1),v.vertDirty=!1,kd=null,this._resetProperties()}g.spriteFrame&&g.renderData.updateRenderData(g,g.spriteFrame)}},updateUVs:function(g){for(var v=g.renderData,S=v.chunk.vb,O=v.vertexCount,X=v.data,Y=3,te=0;te<O;te++){var ti=X[te];S[Y]=ti.u,S[Y+1]=ti.v,Y+=9}},updateColor:function(){},resetRenderData:function(g){var v=g.renderData;v.dataLength=0,v.resize(0,0)},generateVertexData:function(g,v,S,O,X,Y,te,ti,tr){var ta=O,th=g.bmfontScale,tu=S.vertexBuffer,tl=X.width,tc=X.height,t_=Y.width,tf=Y.height,tp=0,tm=0,tg=0,tv=0;te?(tp=Y.x/tl,tv=(Y.x+tf)/tl,tm=(Y.y+t_)/tc,tg=Y.y/tc,tu[ta].u=tp,tu[ta].v=tg,tu[ta+1].u=tp,tu[ta+1].v=tm,tu[ta+2].u=tv,tu[ta+2].v=tg,tu[ta+3].u=tv,tu[ta+3].v=tm):(tp=Y.x/tl,tv=(Y.x+t_)/tl,tm=(Y.y+tf)/tc,tg=Y.y/tc,tu[ta].u=tp,tu[ta].v=tm,tu[ta+1].u=tv,tu[ta+1].v=tm,tu[ta+2].u=tp,tu[ta+2].v=tg,tu[ta+3].u=tv,tu[ta+3].v=tg),tu[ta].x=ti,tu[ta].y=tr-tf*th,tu[ta+1].x=ti+t_*th,tu[ta+1].y=tr-tf*th,tu[ta+2].x=ti,tu[ta+2].y=tr,tu[ta+3].x=ti+t_*th,tu[ta+3].y=tr},_updateFontFamily:function(g){var v=g.font;kS=v.spriteFrame,kv=v.fntConfig,Ps.fontAtlas=v.fontDefDictionary,Ps.fontAtlas||(g.cacheMode===D4.CHAR?Ps.fontAtlas=k_:Ps.fontAtlas=kf),Ik.packToDynamicAtlas(g,kS)},_updateLabelInfo:function(){Ps.hash="",Ps.margin=0},_resetProperties:function(){kv=null,kS=null,Ps.hash="",Ps.margin=0},createQuadIndices:function(g){if(g%6==0){var v=g/6;kc=null,kc=new Uint16Array(g);for(var S=0,O=0;O<v;O++)kc[S++]=0+4*O,kc[S++]=1+4*O,kc[S++]=2+4*O,kc[S++]=1+4*O,kc[S++]=3+4*O,kc[S++]=2+4*O}else console.error("illegal index count!")}},kE=new is(255,255,255,255),kC={createData:function(g){var v=g.requestRenderData();return v.resize(0,0),v},fillBuffers:function(g){var v=g.node;kE.set(g.color),kE.a=255*v._uiProps.opacity,ff(v,0,g.renderData,kE)},appendQuad:function(g,v,S,O,X,Y,te){var ti=g.renderData;if(ti){var tr=ti.dataLength;ti.dataLength+=4,ti.resize(ti.dataLength,ti.dataLength/2*3);var ta=ti.data,th=v.width,tu=v.height,tl=S.width,tc=S.height,t_=0,tf=0,tp=0,tm=0;O?(t_=S.x/th,tm=(S.x+tc)/th,tf=(S.y+tl)/tu,tp=S.y/tu,ta[tr].u=t_,ta[tr].v=tp,ta[tr+1].u=t_,ta[tr+1].v=tf,ta[tr+2].u=tm,ta[tr+2].v=tp,ta[tr+3].u=tm,ta[tr+3].v=tf):(t_=S.x/th,tm=(S.x+tl)/th,tf=(S.y+tc)/tu,tp=S.y/tu,ta[tr].u=t_,ta[tr].v=tf,ta[tr+1].u=tm,ta[tr+1].v=tf,ta[tr+2].u=t_,ta[tr+2].v=tp,ta[tr+3].u=tm,ta[tr+3].v=tp),ta[tr].x=X,ta[tr].y=Y-tc*te,ta[tr+1].x=X+tl*te,ta[tr+1].y=Y-tc*te,ta[tr+2].x=X,ta[tr+2].y=Y,ta[tr+3].x=X+tl*te,ta[tr+3].y=Y}}};Rt(kC,kT);var kx=null,kb=wt(kT,{getAssemblerData:function(){return kx||(kx=new Pn(1024,1024)),kx.getTexture()},_updateFontFamily:function(g){Ps.fontAtlas=kx,Ps.fontFamily=this._getFontFamily(g),g.enableOutline&&g.outlineWidth>0?(Ps.isOutlined=!0,Ps.margin=g.outlineWidth,Ps.out=g.outlineColor.clone(),Ps.out.a=g.outlineColor.a*g.color.a/255):(Ps.isOutlined=!1,Ps.margin=0)},_getFontFamily:function(g){var v="Arial";return g.useSystemFont?v=g.fontFamily||"Arial":g.font&&(v=g.font._nativeAsset||"Arial"),v},_updateLabelInfo:function(g){Ps.fontDesc=this._getFontDesc(),Ps.color=g.color,Ps.hash=function(g){var v=g.color.toHEX(),S="";return g.isOutlined&&g.margin>0&&(S=S+g.margin+g.out.toHEX()),""+g.fontSize+g.fontFamily+v+S}(Ps)},_getFontDesc:function(){return Ps.fontSize.toString()+"px "+Ps.fontFamily}}),kR=new is(255,255,255,255),kw={createData:function(g){var v=g.requestRenderData();return v.resize(0,0),v},fillBuffers:function(g){if(g.renderData){var v=g.node;kR.a=255*v._uiProps.opacity,ff(v,0,g.renderData,kR)}},updateColor:function(){}};Rt(kw,kb);var kI=Mt.Overflow,kB={updateProcessingData:function(g,v,S,O,X,Y){g.isSystemFontUsed=X.useSystemFont,g.fontSize=X.fontSize,S.nodeContentSize.width=S.canvasSize.width=Y.width,S.nodeContentSize.height=S.canvasSize.height=Y.height,v.lineHeight=X.lineHeight,v.overFlow=X.overflow,X.overflow===kI.NONE?v.wrapping=!1:X.overflow===kI.RESIZE_HEIGHT?v.wrapping=!0:v.wrapping=X.enableWrapText,g.isBold=X.isBold,g.isItalic=X.isItalic,g.isUnderline=X.isUnderline,g.underlineHeight=X.underlineHeight,X.enableOutline&&X.outlineWidth>0?(g.isOutlined=!0,g.outlineColor.set(X.outlineColor),g.outlineWidth=X.outlineWidth):g.isOutlined=!1,X.enableShadow&&(X.shadowBlur>0||!pi(X.shadowOffset.x,0)||!pi(X.shadowOffset.y,0))?(g.hasShadow=!0,g.shadowColor.set(X.shadowColor),g.shadowBlur=X.shadowBlur,g.shadowOffsetX=X.shadowOffset.x,g.shadowOffsetY=X.shadowOffset.y):g.hasShadow=!1,g.color.set(X.color),O.texture=X.spriteFrame,O.uiTransAnchorX=Y.anchorX,O.uiTransAnchorY=Y.anchorY,v.horizontalAlign=X.horizontalAlign,v.verticalAlign=X.verticalAlign},getAssemblerData:function(){var g=Mt._canvasPool.get();return g.canvas.width=g.canvas.height=1,g},resetAssemblerData:function(g){g&&Mt._canvasPool.put(g)},updateRenderData:function(g){if(g.renderData){if(g.renderData.vertDirty){var v=g.node._uiProps.uiTransformComp,S=kl.instance,O=g.textStyle,X=g.textLayout,Y=g.textLayoutData,te=g.textRenderData;O.fontScale=Fd.getScaleX(),this.updateProcessingData(O,X,Y,te,g,v),S.setCanvasUsed(g.assemblerData.canvas,g.assemblerData.context),O.fontFamily=this._updateFontFamily(g),this._resetDynamicAtlas(g),S.processingString(!1,O,X,Y,g.string),S.generateRenderInfo(!1,O,X,Y,te,g.string,this.generateVertexData);var ti=g.renderData;ti.textureDirty=!0,this._calDynamicAtlas(g,Y),g.actualFontSize=O.actualFontSize,v.setContentSize(Y.nodeContentSize);var tr=ti.data;tr[0]=te.vertexBuffer[0],tr[1]=te.vertexBuffer[1],tr[2]=te.vertexBuffer[2],tr[3]=te.vertexBuffer[3],this.updateUVs(g),g.renderData.vertDirty=!1,g.contentWidth=Y.nodeContentSize.width}g.spriteFrame&&g.renderData.updateRenderData(g,g.spriteFrame)}},generateVertexData:function(g,v,S){var O=S.vertexBuffer,X=v.nodeContentSize.width,Y=v.nodeContentSize.height,te=S.uiTransAnchorX*X,ti=S.uiTransAnchorY*Y;O[0].x=-te,O[0].y=-ti,O[1].x=X-te,O[1].y=-ti,O[2].x=-te,O[2].y=Y-ti,O[3].x=X-te,O[3].y=Y-ti},updateVertexData:function(){},updateUVs:function(){},_updateFontFamily:function(g){return g.useSystemFont?g.fontFamily||"Arial":g.font&&g.font._nativeAsset||"Arial"},_calDynamicAtlas:function(g,v){if(!(g.cacheMode!==Mt.CacheMode.BITMAP||v.canvasSize.width<=0||v.canvasSize.height<=0)){var S=g.ttfSpriteFrame;Ik.packToDynamicAtlas(g,S)}},_resetDynamicAtlas:function(g){if(g.cacheMode===Mt.CacheMode.BITMAP){var v=g.ttfSpriteFrame;Ik.deleteAtlasSpriteFrame(v),v._resetDynamicAtlasFrame()}}},kP=is.WHITE.clone(),kD=Uint16Array.from([0,1,2,1,3,2]),kM={createData:function(g){var v=g.requestRenderData();v.dataLength=4,v.resize(4,6),g.textRenderData.quadCount=4;var S=v.chunk.vb;S[3]=S[21]=S[22]=S[31]=0,S[4]=S[12]=S[13]=S[30]=1;for(var O=5,X=0;X<4;X++)is.toArray(S,kP,O),O+=9;return v.chunk.setIndexBuffer(kD),v},fillBuffers:function(g){for(var v=g.renderData,S=v.chunk,O=v.data,X=g.node,Y=S.vb,te=X.worldMatrix,ti=v.floatStride,tr=0,ta=O.length,th=0;th<ta;th++){var tu=O[th],tl=tu.x,tc=tu.y,t_=te.m03*tl+te.m07*tc+te.m15;t_=t_?1/t_:1,Y[0+(tr=th*ti)]=(te.m00*tl+te.m04*tc+te.m12)*t_,Y[tr+1]=(te.m01*tl+te.m05*tc+te.m13)*t_,Y[tr+2]=(te.m02*tl+te.m06*tc+te.m14)*t_}var tf=S.vertexOffset,tp=S.meshBuffer,tm=S.meshBuffer.iData,tg=tp.indexOffset;tm[tg++]=tf,tm[tg++]=tf+1,tm[tg++]=tf+2,tm[tg++]=tf+2,tm[tg++]=tf+1,tm[tg++]=tf+3,tp.indexOffset+=6},updateVertexData:function(g){var v=g.renderData;if(v){var S=g.node._uiProps.uiTransformComp,O=S.width,X=S.height,Y=S.anchorX*O,te=S.anchorY*X,ti=v.data;ti[0].x=-Y,ti[0].y=-te,ti[1].x=O-Y,ti[1].y=-te,ti[2].x=-Y,ti[2].y=X-te,ti[3].x=O-Y,ti[3].y=X-te}},updateUVs:function(g){var v=g.renderData;if(v&&g.ttfSpriteFrame){var S=v.chunk.vb,O=g.ttfSpriteFrame.uv;S[3]=O[0],S[4]=O[1],S[12]=O[2],S[13]=O[3],S[21]=O[4],S[22]=O[5],S[30]=O[6],S[31]=O[7]}},updateColor:function(){}};Rt(kM,kB);var kO=g("l",{getAssembler:function(g){var v=kM;return _instanceof(g.font,B1)?v=kC:g.cacheMode===Mt.CacheMode.CHAR&&(v=kw),v}});Mt.Assembler=kO;var kL=O3.FillType,kF=new e$,kN=Uint16Array.from([0,1,2,1,3,2]),kk={updateRenderData:function(g){var v=g.spriteFrame;Ik.packToDynamicAtlas(g,v);var S=g.renderData;if(S&&v){if(!S.vertDirty)return;var O=g.fillStart,X=g.fillRange;X<0&&(O+=X,X=-X),X=(X=(X=O+X)>1?1:X)<0?0:X;var Y=(O=(O=O>1?1:O)<0?0:O)+(X=(X-=O)<0?0:X);Y=Y>1?1:Y,this.updateUVs(g,O,Y),this.updateVertexData(g,O,Y),S.updateRenderData(g,v)}},updateUVs:function(g,v,S){var O=g.spriteFrame,X=g.renderData.chunk.vb,Y=O.width,te=O.height,ti=O.rect,tr=0,ta=0,th=0,tu=0,tl=0,tc=0,t_=0,tf=0,tp=0,tm=0;switch(O.isRotated()?(tr=ti.x/Y,ta=(ti.y+ti.width)/te,th=tl=tr,t_=tp=(ti.x+ti.height)/Y,tc=tm=ta,tu=tf=ti.y/te):(tr=ti.x/Y,ta=(ti.y+ti.height)/te,th=t_=tr,tl=tp=(ti.x+ti.width)/Y,tu=tc=ta,tf=tm=ti.y/te),g.fillType){case kL.HORIZONTAL:X[3]=th+(tl-th)*v,X[4]=tu+(tc-tu)*v,X[12]=th+(tl-th)*S,X[13]=tu+(tc-tu)*S,X[21]=t_+(tp-t_)*v,X[22]=tf+(tm-tf)*v,X[30]=t_+(tp-t_)*S,X[31]=tf+(tm-tf)*S;break;case kL.VERTICAL:X[3]=th+(t_-th)*v,X[4]=tu+(tf-tu)*v,X[12]=tl+(tp-tl)*v,X[13]=tc+(tm-tc)*v,X[21]=th+(t_-th)*S,X[22]=tu+(tf-tu)*S,X[30]=tl+(tp-tl)*S,X[31]=tc+(tm-tc)*S;break;default:J(2626)}},updateVertexData:function(g,v,S){var O=g.renderData.data,X=g.node._uiProps.uiTransformComp,Y=X.width,te=X.height,ti=X.anchorX*Y,tr=X.anchorY*te,ta=-ti,th=-tr,tu=Y-ti,tl=te-tr,tc=0;switch(g.fillType){case kL.HORIZONTAL:tc=ta+(tu-ta)*S,ta+=(tu-ta)*v,tu=tc;break;case kL.VERTICAL:tc=th+(tl-th)*S,th+=(tl-th)*v,tl=tc;break;default:J(2626)}O[0].x=ta,O[0].y=th,O[1].x=tu,O[1].y=th,O[2].x=ta,O[2].y=tl,O[3].x=tu,O[3].y=tl},createData:function(g){var v=g.requestRenderData();v.dataLength=4,v.resize(4,6),v.chunk.setIndexBuffer(kN);for(var S,O=f(v.data);!(S=O()).done;)S.value.z=0;return v},updateWorldVertexData:function(g,v){g.node.getWorldMatrix(kF);for(var S=g.renderData.floatStride,O=g.renderData.data,X=v.vb,Y=0,te=0;te<4;te++){var ti=O[te],tr=ti.x,ta=ti.y,th=kF.m03*tr+kF.m07*ta+kF.m15;th=th?1/th:1,X[Y=te*S]=(kF.m00*tr+kF.m04*ta+kF.m12)*th,X[Y+1]=(kF.m01*tr+kF.m05*ta+kF.m13)*th,X[Y+2]=(kF.m02*tr+kF.m06*ta+kF.m14)*th}},fillBuffers:function(g){var v=g.renderData,S=v.chunk;(g._flagChangedVersion!==g.node.flagChangedVersion||v.vertDirty)&&(this.updateWorldVertexData(g,S),v.vertDirty=!1,g._flagChangedVersion=g.node.flagChangedVersion),S.bufferId;var O=S.vertexOffset,X=S.meshBuffer,Y=S.meshBuffer.iData,te=X.indexOffset;Y[te++]=O,Y[te++]=O+1,Y[te++]=O+2,Y[te++]=O+2,Y[te++]=O+1,Y[te++]=O+3,X.indexOffset+=6},updateColor:function(g){for(var v=g.renderData,S=v.chunk.vb,O=v.floatStride,X=5,Y=g.color,te=Y.r/255,ti=Y.g/255,tr=Y.b/255,ta=g.node._uiProps.opacity,th=0;th<4;th++)S[X]=te,S[X+1]=ti,S[X+2]=tr,S[X+3]=ta,X+=O}},kG=2*Math.PI,kU=1e-6,kH=new e$,kz=[new e8,new e8,new e8,new e8],kX=new Array(4),kj=new Array(8),kq=[new e8,new e8,new e8,new e8],kY=[new e8,new e8,new e8,new e8],kK=new e8,kJ=[new e8,new e8,new e8,new e8],k$=null;function aj(g,v,S,O,X,Y,te){var ti=Math.sin(Y);ti=Math.abs(ti)>kU?ti:0;var tr=Math.cos(Y),ta=0,th=0;if(0!==(tr=Math.abs(tr)>kU?tr:0)){if(ta=ti/tr,(g-X.x)*tr>0){var tu=X.y+ta*(g-X.x);te[0].x=g,te[0].y=tu}if((v-X.x)*tr>0){var tl=X.y+ta*(v-X.x);te[2].x=v,te[2].y=tl}}if(0!==ti){if(th=tr/ti,(O-X.y)*ti>0){var tc=X.x+th*(O-X.y);te[3].x=tc,te[3].y=O}if((S-X.y)*ti>0){var t_=X.x+th*(S-X.y);te[1].x=t_,te[1].y=S}}}function oj(g,v){var S=v.x-g.x,O=v.y-g.y;if(0===S&&0===O)return 0;if(0===S)return O>0?.5*Math.PI:1.5*Math.PI;var X=Math.atan(O/S);return S<0&&(X+=Math.PI),X}function hj(g,v,S,O,X){var Y=kX,te=Y[0],ti=Y[1],tr=Y[2],ta=Y[3];g[v].x=S.x,g[v].y=S.y,g[v+1].x=O.x,g[v+1].y=O.y,g[v+2].x=X.x,g[v+2].y=X.y,uj((S.x-te)/(tr-te),(S.y-ti)/(ta-ti),g,v),uj((O.x-te)/(tr-te),(O.y-ti)/(ta-ti),g,v+1),uj((X.x-te)/(tr-te),(X.y-ti)/(ta-ti),g,v+2)}function uj(g,v,S,O){var X=kj,Y=X[0]+(X[2]-X[0])*g,te=X[4]+(X[6]-X[4])*g,ti=X[1]+(X[3]-X[1])*g,tr=X[5]+(X[7]-X[5])*g,ta=S[O];ta.u=Y+(te-Y)*v,ta.v=ti+(tr-ti)*v}for(var k0={useModel:!1,createData:function(g){return g.requestRenderData()},updateRenderData:function(g){var v=g.spriteFrame;Ik.packToDynamicAtlas(g,v),this.updateUVs(g);var S=g.renderData;if(S&&v){if(!S.vertDirty)return;var O=S.data,X=g.fillStart,Y=g.fillRange;for(Y<0&&(X+=Y,Y=-Y);X>=1;)X-=1;for(;X<0;)X+=1;var te=(X*=kG)+(Y*=kG);!function(g){var v=g.node._uiProps.uiTransformComp,S=v.width,O=v.height,X=v.anchorX*S,Y=v.anchorY*O,te=-X,ti=-Y,tr=S-X,ta=O-Y,th=kX;th[0]=te,th[1]=ti,th[2]=tr,th[3]=ta;var tu=g.fillCenter,tl=kK.x=Math.min(Math.max(0,tu.x),1)*(tr-te)+te,tc=kK.y=Math.min(Math.max(0,tu.y),1)*(ta-ti)+ti;kz[0].x=kz[3].x=te,kz[1].x=kz[2].x=tr,kz[0].y=kz[1].y=ti,kz[2].y=kz[3].y=ta;for(var t_=0,tf=kJ;t_<tf.length;t_++){var tp=tf[t_];e8.set(tp,0,0)}tl!==th[0]&&e8.set(kJ[0],3,0),tl!==th[2]&&e8.set(kJ[2],1,2),tc!==th[1]&&e8.set(kJ[1],0,1),tc!==th[3]&&e8.set(kJ[3],2,3)}(g),function(g){var v=g.width,S=g.height,O=g.getRect(),X=0,Y=0,te=0,ti=0,tr=kj;g.isRotated()?(X=O.x/v,Y=(O.x+O.height)/v,te=O.y/S,ti=(O.y+O.width)/S,tr[0]=tr[2]=X,tr[4]=tr[6]=Y,tr[3]=tr[7]=ti,tr[1]=tr[5]=te):(X=O.x/v,Y=(O.x+O.width)/v,te=O.y/S,ti=(O.y+O.height)/S,tr[0]=tr[4]=X,tr[2]=tr[6]=Y,tr[1]=tr[3]=ti,tr[5]=tr[7]=te)}(v),aj(kX[0],kX[2],kX[1],kX[3],kK,X,kq),aj(kX[0],kX[2],kX[1],kX[3],kK,X+Y,kY);for(var ti=0,tr=0;tr<4;++tr){var ta=kJ[tr];if(ta){if(Y>=kG)S.dataLength=ti+3,hj(O,ti,kK,kz[ta.x],kz[ta.y]),ti+=3;else{var th=oj(kK,kz[ta.x]),tu=oj(kK,kz[ta.y]);tu<th&&(tu+=kG),th-=kG,tu-=kG;for(var tl=0;tl<3;++tl)th>=te||(th>=X?(S.dataLength=ti+3,hj(O,ti,kK,kz[ta.x],tu>=te?kY[tr]:kz[ta.y]),ti+=3):tu>X&&(tu<=te?(S.dataLength=ti+3,hj(O,ti,kK,kq[tr],kz[ta.y]),ti+=3):(S.dataLength=ti+3,hj(O,ti,kK,kq[tr],kY[tr]),ti+=3))),th+=kG,tu+=kG}}}0===ti&&(S.dataLength=0),S.resize(ti,ti),S.updateRenderData(g,v)}},createQuadIndices:function(g){k$=null,k$=new Uint16Array(g);for(var v=0,S=0;S<g;S++)k$[v++]=S},fillBuffers:function(g){var v=g.node,S=g.renderData,O=S.chunk;(g._flagChangedVersion!==v.flagChangedVersion||S.vertDirty)&&(this.updateWorldVertexAndUVData(g,O),S.vertDirty=!1,g._flagChangedVersion=v.flagChangedVersion),this.updateColorLate(g),O.bufferId;for(var X=O.vertexOffset,Y=O.meshBuffer,te=O.meshBuffer.iData,ti=Y.indexOffset,tr=0;tr<S.indexCount;tr++)te[ti+tr]=X+tr;Y.indexOffset+=S.indexCount,Y.setDirty()},updateWorldUVData:function(g){for(var v=g.renderData,S=v.floatStride,O=v.data,X=v.chunk.vb,Y=0;Y<O.length;Y++){var te=Y*S;X[te+3]=O[Y].u,X[te+4]=O[Y].v}},updateWorldVertexAndUVData:function(g,v){g.node.getWorldMatrix(kH);for(var S=g.renderData,O=S.floatStride,X=g.renderData.data,Y=v.vb,te=S.vertexCount,ti=0,tr=0;tr<te;tr++){var ta=X[tr],th=ta.x,tu=ta.y,tl=kH.m03*th+kH.m07*tu+kH.m15;tl=tl?1/tl:1,Y[ti+0]=(kH.m00*th+kH.m04*tu+kH.m12)*tl,Y[ti+1]=(kH.m01*th+kH.m05*tu+kH.m13)*tl,Y[ti+2]=(kH.m02*th+kH.m06*tu+kH.m14)*tl,Y[ti+3]=ta.u,Y[ti+4]=ta.v,ti+=O}},updateUVs:function(g){g.renderData.vertDirty=!0,g.markForUpdateRenderData()},updateColorLate:function(g){for(var v=g.renderData,S=v.chunk.vb,O=v.floatStride,X=v.vertexCount,Y=5,te=g.color,ti=te.r/255,tr=te.g/255,ta=te.b/255,th=g.node._uiProps.opacity,tu=0;tu<X;tu++)S[Y]=ti,S[Y+1]=tr,S[Y+2]=ta,S[Y+3]=th,Y+=O},updateColor:function(){}},k1=Uint16Array.from([0,1,2,1,3,2]),k2={createData:function(g){var v=g.requestRenderData();return v.dataLength=4,v.resize(4,6),v.chunk.setIndexBuffer(k1),v},updateRenderData:function(g){var v=g.spriteFrame;Ik.packToDynamicAtlas(g,v),this.updateUVs(g);var S=g.renderData;S&&v&&(S.vertDirty&&this.updateVertexData(g),S.updateRenderData(g,v))},updateWorldVerts:function(g,v){for(var S=g.renderData,O=v.vb,X=S.data,Y=g.node.worldMatrix,te=S.floatStride,ti=0,tr=X.length,ta=0;ta<tr;ta++){var th=X[ta],tu=th.x,tl=th.y,tc=Y.m03*tu+Y.m07*tl+Y.m15;tc=tc?1/tc:1,O[0+(ti=ta*te)]=(Y.m00*tu+Y.m04*tl+Y.m12)*tc,O[ti+1]=(Y.m01*tu+Y.m05*tl+Y.m13)*tc,O[ti+2]=(Y.m02*tu+Y.m06*tl+Y.m14)*tc}},fillBuffers:function(g){if(null!==g){var v=g.renderData,S=v.chunk;(g._flagChangedVersion!==g.node.flagChangedVersion||v.vertDirty)&&(this.updateWorldVerts(g,S),v.vertDirty=!1,g._flagChangedVersion=g.node.flagChangedVersion);var O=S.vertexOffset,X=S.meshBuffer,Y=S.meshBuffer.iData,te=X.indexOffset,ti=O;Y[te++]=ti,Y[te++]=ti+1,Y[te++]=ti+2,Y[te++]=ti+1,Y[te++]=ti+3,Y[te++]=ti+2,X.indexOffset+=6}},updateVertexData:function(g){var v=g.renderData;if(v){var S=g.node._uiProps.uiTransformComp,O=v.data,X=S.width,Y=S.height,te=S.anchorX*X,ti=S.anchorY*Y,tr=0,ta=0,th=0,tu=0;if(g.trim)tr=-te,ta=-ti,th=X-te,tu=Y-ti;else{var tl=g.spriteFrame,tc=tl.originalSize,t_=X/tc.width,tf=Y/tc.height,tp=tl.trimmedBorder;tr=tp.x*t_-te,ta=tp.z*tf-ti,th=X+tp.y*t_-te,tu=Y+tp.w*tf-ti}O[0].x=tr,O[0].y=ta,O[1].x=th,O[1].y=ta,O[2].x=tr,O[2].y=tu,O[3].x=th,O[3].y=tu,v.vertDirty=!0}},updateUVs:function(g){if(g.spriteFrame){var v=g.renderData.chunk.vb,S=g.spriteFrame.uv;v[3]=S[0],v[4]=S[1],v[12]=S[2],v[13]=S[3],v[21]=S[4],v[22]=S[5],v[30]=S[6],v[31]=S[7]}},updateColor:function(g){for(var v=g.renderData,S=v.chunk.vb,O=5,X=g.color,Y=X.r/255,te=X.g/255,ti=X.b/255,tr=X.a/255,ta=0;ta<4;ta++,O+=v.floatStride)S[O]=Y,S[O+1]=te,S[O+2]=ti,S[O+3]=tr}},k5=new e$,k4=[],k8=0;k8<4;k8++)k4.push({x:0,y:0,z:0,u:0,v:0,color:new is});var k6,k7,k9,Gi,Gn,Gs,Ga,Gh={createData:function(g){var v=g.requestRenderData();return v.dataLength=16,v.resize(16,54),this.QUAD_INDICES=new Uint16Array(54),this.createQuadIndices(4,4),v.chunk.setIndexBuffer(this.QUAD_INDICES),v},createQuadIndices:function(g,v){for(var S=0,O=0;O<g-1;O++)for(var X=0;X<v-1;X++){var Y=O*v+X;this.QUAD_INDICES[S++]=Y,this.QUAD_INDICES[S++]=Y+1,this.QUAD_INDICES[S++]=Y+v,this.QUAD_INDICES[S++]=Y+1,this.QUAD_INDICES[S++]=Y+1+v,this.QUAD_INDICES[S++]=Y+v}},updateRenderData:function(g){var v=g.spriteFrame;Ik.packToDynamicAtlas(g,v),this.updateUVs(g);var S=g.renderData;S&&v&&(S.vertDirty&&this.updateVertexData(g),S.updateRenderData(g,v))},updateVertexData:function(g){var v=g.renderData,S=v.data,O=g.node._uiProps.uiTransformComp,X=O.width,Y=O.height,te=O.anchorX*X,ti=O.anchorY*Y,tr=g.spriteFrame,ta=tr.insetLeft,th=tr.insetRight,tu=tr.insetTop,tl=tr.insetBottom,tc=X-ta-th,t_=Y-tu-tl,tf=X/(ta+th),tp=Y/(tu+tl);tf=Number.isNaN(tf)||tf>1?1:tf,tp=Number.isNaN(tp)||tp>1?1:tp,tc=tc<0?0:tc,t_=t_<0?0:t_,k4[0].x=-te,k4[0].y=-ti,k4[1].x=ta*tf-te,k4[1].y=tl*tp-ti,k4[2].x=k4[1].x+tc,k4[2].y=k4[1].y+t_,k4[3].x=X-te,k4[3].y=Y-ti;for(var tm=0;tm<4;tm++)for(var tg=0;tg<4;tg++){var tv=4*tm+tg;tv<v.dataLength&&tm<k4.length&&tg<k4.length&&(S[tv].x=k4[tg].x,S[tv].y=k4[tm].y)}},fillBuffers:function(g){var v=g.renderData,S=v.chunk;(g._flagChangedVersion!==g.node.flagChangedVersion||v.vertDirty)&&(this.updateWorldVertexData(g,S),v.vertDirty=!1,g._flagChangedVersion=g.node.flagChangedVersion),S.bufferId;for(var O=S.vertexOffset,X=S.meshBuffer,Y=S.meshBuffer.iData,te=X.indexOffset,ti=0;ti<3;++ti)for(var tr=0;tr<3;++tr){var ta=O+4*ti+tr;Y[te++]=ta,Y[te++]=ta+1,Y[te++]=ta+4,Y[te++]=ta+1,Y[te++]=ta+5,Y[te++]=ta+4}X.indexOffset=te},updateWorldVertexData:function(g,v){g.node.getWorldMatrix(k5);for(var S=g.renderData,O=S.floatStride,X=S.data,Y=v.vb,te=0,ti=0;ti<4;++ti)for(var tr=X[4*ti],ta=0;ta<4;++ta){var th=X[ta].x,tu=tr.y,tl=k5.m03*th+k5.m07*tu+k5.m15;tl=tl?1/tl:1,Y[0+(te=(4*ti+ta)*O)]=(k5.m00*th+k5.m04*tu+k5.m12)*tl,Y[te+1]=(k5.m01*th+k5.m05*tu+k5.m13)*tl,Y[te+2]=(k5.m02*th+k5.m06*tu+k5.m14)*tl}},updateUVs:function(g){if(g.spriteFrame)for(var v=g.renderData,S=v.chunk.vb,O=v.floatStride,X=g.spriteFrame.uvSliced,Y=3,te=0;te<16;te++)S[Y]=X[te].u,S[Y+1]=X[te].v,Y+=O},updateColor:function(g){for(var v=g.renderData,S=v.chunk.vb,O=v.floatStride,X=5,Y=g.color,te=Y.r/255,ti=Y.g/255,tr=Y.b/255,ta=g.node._uiProps.opacity,th=0;th<16;th++)S[X]=te,S[X+1]=ti,S[X+2]=tr,S[X+3]=ta,X+=O}},Gl=new e$,Gc=0,G_=[],Gd=null;function wj(g){return g&&(g.insetTop>0||g.insetBottom>0||g.insetLeft>0||g.insetRight>0)?2:0}var Gp={createData:function(g){return g.requestRenderData()},updateRenderData:function(g){var v=g.renderData,S=g.spriteFrame;if(S&&v&&v.vertDirty){var O=g.node._uiProps.uiTransformComp,X=Math.abs(O.width),Y=Math.abs(O.height),te=S.getRect(),ti=S.insetLeft,tr=S.insetRight,ta=te.width-ti-tr,th=S.insetTop,tu=S.insetBottom,tl=te.height-th-tu,tc=X-ti-tr,t_=Y-th-tu;tc=tc>0?tc:0,t_=t_>0?t_:0;var tf=0===ta?tc:tc/ta,tp=0===tl?t_:t_/tl,tm=wj(S),tg=Math.ceil(tp+tm),tv=Math.ceil(tf+tm);v.dataLength=4*tg*tv,this.updateVerts(g,tc,t_,tg,tv),v.vertexCount!==tg*tv*4&&(g.renderEntity.colorDirty=!0),v.resize(tg*tv*4,tg*tv*6),v.updateRenderData(g,S)}},createQuadIndices:function(g){if(g%6==0){var v=g/6;Gd=null,Gd=new Uint16Array(g);for(var S=0,O=0;O<v;O++)Gd[S++]=0+4*O,Gd[S++]=1+4*O,Gd[S++]=2+4*O,Gd[S++]=1+4*O,Gd[S++]=3+4*O,Gd[S++]=2+4*O}else k("illegal index count!")},updateUVs:function(g){g.renderData.vertDirty=!0,g.markForUpdateRenderData()},fillBuffers:function(g){var v=g.node,S=g.renderData,O=S.chunk;if(null!==O){(g._flagChangedVersion!==v.flagChangedVersion||S.vertDirty)&&(this.updateWorldVertexAndUVData(g,O),S.vertDirty=!1,g._flagChangedVersion=v.flagChangedVersion),this.updateColorLate(g),O.bufferId;for(var X=O.vertexOffset,Y=O.meshBuffer,te=O.meshBuffer.iData,ti=Y.indexOffset,tr=0;tr<S.indexCount;tr+=6)te[ti++]=X,te[ti++]=X+1,te[ti++]=X+2,te[ti++]=X+1,te[ti++]=X+3,te[ti++]=X+2,X+=4,Y.indexOffset+=6;Y.setDirty()}},updateWorldUVData:function(g){for(var v=g.renderData,S=v.floatStride,O=v.data,X=v.chunk.vb,Y=0;Y<O.length;Y++){var te=Y*S;X[te+3]=O[Y].u,X[te+4]=O[Y].v}},updateWorldVertexAndUVData:function(g,v){g.node.getWorldMatrix(Gl);for(var S=g.renderData,O=S.floatStride,X=S.data,Y=v.vb,te=X.length,ti=0;ti<te;ti++){var tr=X[ti].x,ta=X[ti].y,th=X[ti].z,tu=Gl.m03*tr+Gl.m07*ta+Gl.m11*th+Gl.m15;tu=tu?1/tu:1;var tl=ti*O;Y[tl]=(Gl.m00*tr+Gl.m04*ta+Gl.m08*th+Gl.m12)*tu,Y[tl+1]=(Gl.m01*tr+Gl.m05*ta+Gl.m09*th+Gl.m13)*tu,Y[tl+2]=(Gl.m02*tr+Gl.m06*ta+Gl.m10*th+Gl.m14)*tu}this.updateWorldUVData(g)},updateVerts:function(g,v,S,O,X){var Y,te,ti=g.node._uiProps.uiTransformComp,tr=g.renderData.data,ta=g.spriteFrame,th=ta.rect,tu=Math.abs(ti.width),tl=Math.abs(ti.height),tc=ti.anchorX*tu,t_=ti.anchorY*tl,tf=ta.insetLeft,tp=ta.insetRight,tm=th.width-tf-tp,tg=ta.insetTop,tv=ta.insetBottom,ty=th.height-tg-tv,tS=ti.width/(tf+tp)>1?1:ti.width/(tf+tp),tA=ti.height/(tg+tv)>1?1:ti.height/(tg+tv);Y=tm>0?Math.floor(1e3*v)/1e3%tm==0?tm:v%tm:v,te=ty>0?Math.floor(1e3*S)/1e3%ty==0?ty:S%ty:S,G_.length=0,Gc=Math.max(O+1,X+1);for(var tT=0;tT<Gc;tT++)G_.push({x:0,y:0,z:0,u:0,v:0,color:new is});var tE=wj(ta);if(0===tE)for(var tC=0;tC<Gc;tC++)G_[tC].x=tC>=X?tu-tc:tC*tm-tc,G_[tC].y=tC>=O?tl-t_:tC*ty-t_;else for(var tx=0;tx<Gc;tx++)0===tx?G_[tx].x=-tc:1===tx?G_[tx].x=tf*tS-tc:tx>1&&tx<X-1?G_[tx].x=tm>0?tf*tS-tc+tm*(tx-1):tf+v-tc:tx===X-1?G_[tx].x=tf*tS-tc+Y+tm*(tx-2):tx>=X&&(G_[tx].x=Math.min(tf+v+tp,tu)-tc),0===tx?G_[tx].y=-t_:1===tx?G_[tx].y=tv*tA-t_:tx>1&&tx<O-1?G_[tx].y=ty>0?tv*tA-t_+ty*(tx-1):tv+S-t_:tx===O-1?G_[tx].y=tv*tA-t_+te+ty*(tx-2):tx>=O&&(G_[tx].y=Math.min(tv+S+tg,tl)-t_);for(var tb=0,tw=0,tI=0,tB=0,tP=0;tP<O;++tP){tI=G_[tP].y,tB=G_[tP+1].y;for(var tD=0;tD<X;++tD){tb=G_[tD].x,tw=G_[tD+1].x;var tM=4*(tP*X+tD);tr[tM].x=tb,tr[tM].y=tI,tr[tM+1].x=tw,tr[tM+1].y=tI,tr[tM+2].x=tb,tr[tM+2].y=tB,tr[tM+3].x=tw,tr[tM+3].y=tB}}var tO=ta.rotated;ta.uv;var tk=ta.uvSliced;k6=tk[0],k7=tk[1],k9=tk[2],Gi=tk[3],Gn=tk[4],Gs=tk[8],Ga=tk[12];for(var tG=0,tV=0,tU=0===tm?v:v/tm,tH=0===ty?S:S/ty,tz=[],tW=[],tj=0;tj<O;++tj){tV=S>ty?S>=(tE>0?tj:tj+1)*ty?1:tH%1:tH;for(var tq=0;tq<X;++tq){tG=v>tm?v>=(tE>0?tq:tq+1)*tm?1:tU%1:tU,tO?(0===tE?(tz[0]=Gn.u,tz[1]=Gn.u,tz[2]=Gn.u+(Gs.u-Gn.u)*tV,tW[0]=k7.v,tW[1]=k7.v+(k9.v-k7.v)*tG,tW[2]=k7.v):(0===tj?(tz[0]=k6.u,tz[1]=k6.u,tz[2]=Gn.u):tj<O-1?(tz[0]=Gn.u,tz[1]=Gn.u,tz[2]=Gn.u+(Gs.u-Gn.u)*tV):tj===O-1&&(tz[0]=Gs.u,tz[1]=Gs.u,tz[2]=Ga.u),0===tq?(tW[0]=k6.v,tW[1]=k7.v,tW[2]=k6.v):tq<X-1?(tW[0]=k7.v,tW[1]=k7.v+(k9.v-k7.v)*tG,tW[2]=k7.v):tq===X-1&&(tW[0]=k9.v,tW[1]=Gi.v,tW[2]=k9.v)),tz[3]=tz[2],tW[3]=tW[1]):(0===tE?(tz[0]=k7.u,tz[1]=k7.u+(k9.u-k7.u)*tG,tz[2]=k7.u,tW[0]=Gn.v,tW[1]=Gn.v,tW[2]=Gn.v+(Gs.v-Gn.v)*tV):(0===tq?(tz[0]=k6.u,tz[1]=k7.u,tz[2]=k6.u):tq<X-1?(tz[0]=k7.u,tz[1]=k7.u+(k9.u-k7.u)*tG,tz[2]=k7.u):tq===X-1&&(tz[0]=k9.u,tz[1]=Gi.u,tz[2]=k9.u),0===tj?(tW[0]=k6.v,tW[1]=k6.v,tW[2]=Gn.v):tj<O-1?(tW[0]=Gn.v,tW[1]=Gn.v,tW[2]=Gn.v+(Gs.v-Gn.v)*tV):tj===O-1&&(tW[0]=Gs.v,tW[1]=Gs.v,tW[2]=Ga.v)),tz[3]=tz[1],tW[3]=tW[2]);var tK=4*(tj*X+tq);tr[tK].u=tz[0],tr[tK].v=tW[0],tr[tK+1].u=tz[1],tr[tK+1].v=tW[1],tr[tK+2].u=tz[2],tr[tK+2].v=tW[2],tr[tK+3].u=tz[3],tr[tK+3].v=tW[3]}}},updateColorLate:function(g){for(var v=g.renderData,S=v.chunk.vb,O=v.floatStride,X=v.vertexCount,Y=5,te=g.color,ti=te.r/255,tr=te.g/255,ta=te.b/255,th=g.node._uiProps.opacity,tu=0;tu<X;tu++)S[Y]=ti,S[Y+1]=tr,S[Y+2]=ta,S[Y+3]=th,Y+=O},updateColor:function(){}},Gg=O3.Type,Gv=O3.FillType,Gy=g("s",{getAssembler:function(g){var v=k2,S=g;switch(S.type){case Gg.SLICED:v=Gh;break;case Gg.TILED:v=Gp;break;case Gg.FILLED:v=S.fillType===Gv.RADIAL?k0:kk}return v}});O3.Assembler=Gy;var GS=[RK.EventType.MOUSE_DOWN,RK.EventType.MOUSE_MOVE,RK.EventType.MOUSE_UP,RK.EventType.MOUSE_WHEEL],GT=[RK.EventType.TOUCH_START,RK.EventType.TOUCH_MOVE,RK.EventType.TOUCH_END,RK.EventType.TOUCH_CANCEL];new(function(){function t1(){this.priority=Rk.UI,this._isListDirty=!1,this._inDispatchCount=0,this._pointerEventProcessorList=[],this._processorListToAdd=[],this._processorListToRemove=[],RJ._registerEventDispatcher(this),wH.callbacksInvoker.on(wL.ADD_POINTER_EVENT_PROCESSOR,this.addPointerEventProcessor,this),wH.callbacksInvoker.on(wL.REMOVE_POINTER_EVENT_PROCESSOR,this.removePointerEventProcessor,this),wH.callbacksInvoker.on(wL.MARK_LIST_DIRTY,this._markListDirty,this)}var g=t1.prototype;return g.dispatchEvent=function(g){var v=g.type;return GT.includes(v)?this.dispatchEventTouch(g):!GS.includes(v)||this.dispatchEventMouse(g)},g.addPointerEventProcessor=function(g){0===this._inDispatchCount?this._pointerEventProcessorList.includes(g)||(this._pointerEventProcessorList.push(g),this._isListDirty=!0):this._processorListToAdd.includes(g)||this._processorListToAdd.push(g),Jt(this._processorListToRemove,g)},g.removePointerEventProcessor=function(g){0===this._inDispatchCount?(Jt(this._pointerEventProcessorList,g),this._isListDirty=!0):this._processorListToRemove.includes(g)||this._processorListToRemove.push(g),Jt(this._processorListToAdd,g)},g.dispatchEventMouse=function(g){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var v=this._pointerEventProcessorList,S=v.length,O=!0,X=0;X<S;++X){var Y=v[X];if(Y.isEnabled&&Y.shouldHandleEventMouse&&Y._handleEventMouse(g)){if(O=!1,!g.preventSwallow)break;g.preventSwallow=!1}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),O},g.dispatchEventTouch=function(g){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var v=this._pointerEventProcessorList,S=v.length,O=g.touch,X=!0,Y=0;Y<S;++Y){var te=v[Y];if(te.isEnabled&&te.shouldHandleEventTouch){if(g.type===bQ.TOUCH_START){if(te._handleEventTouch(g)){if(te.isEnabled)te.claimedTouchIdList.push(O.getID());else{var ti=new b4([g.touch],!0,bQ.TOUCH_CANCEL);ti.touch=g.touch,te.dispatchEvent(ti),te.claimedTouchIdList.length=0}if(X=!1,!g.preventSwallow)break;g.preventSwallow=!1}}else if(te.claimedTouchIdList.length>0){var tr=te.claimedTouchIdList.indexOf(O.getID());if(-1!==tr){if(te._handleEventTouch(g),g.type!==bQ.TOUCH_END&&g.type!==bQ.TOUCH_CANCEL||qt(te.claimedTouchIdList,tr),X=!1,!g.preventSwallow)break;g.preventSwallow=!1}}}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),X},g._updatePointerEventProcessorList=function(){for(var g=this._processorListToAdd,v=g.length,S=0;S<v;++S)this.addPointerEventProcessor(g[S]);g.length=0;for(var O=this._processorListToRemove,X=O.length,Y=0;Y<X;++Y)this.removePointerEventProcessor(O[Y]);O.length=0},g._sortPointerEventProcessorList=function(){if(this._isListDirty){for(var g=this._pointerEventProcessorList,v=g.length,S=0;S<v;++S){var O=g[S],X=O.node;if(X._uiProps){var Y=X._uiProps.uiTransformComp;O.cachedCameraPriority=Y.cameraPriority}}g.sort(this._sortByPriority),this._isListDirty=!1}},g._sortByPriority=function(g,v){var S=g.node,O=v.node;if(!(v&&O&&O.activeInHierarchy&&O._uiProps.uiTransformComp))return -1;if(!(g&&S&&S.activeInHierarchy&&S._uiProps.uiTransformComp))return 1;if(g.cachedCameraPriority!==v.cachedCameraPriority)return v.cachedCameraPriority-g.cachedCameraPriority;for(var X=S,Y=O,te=!1;(null===(ti=X.parent)||void 0===ti?void 0:ti.uuid)!==(null===(tr=Y.parent)||void 0===tr?void 0:tr.uuid);){var ti,tr,ta,th,tu,tl;X=null===(null===(ta=X)||void 0===ta||null===(th=ta.parent)||void 0===th?void 0:th.parent)?(te=!0,O):X&&X.parent,Y=null===(null===(tu=Y)||void 0===tu||null===(tl=tu.parent)||void 0===tl?void 0:tl.parent)?(te=!0,S):Y&&Y.parent}if(X.uuid===Y.uuid){if(X.uuid===O.uuid)return -1;if(X.uuid===S.uuid)return 1}var tc=X?X.getSiblingIndex():0,t_=Y?Y.getSiblingIndex():0;return te?tc-t_:t_-tc},g._markListDirty=function(){this._isListDirty=!0},t1}());var GE=new h8(null),GC=new e$,Gx=function(){function t1(g){var v=this;this.device=void 0,this._screens=[],this._staticVBBuffer=null,this._bufferAccessors=new Map,this._drawBatchPool=void 0,this._batches=void 0,this._currBID=-1,this._indexStart=0,this._emptyMaterial=new pf,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._currHash=0,this._currIsMiddleware=!1,this._middlewareEnableBatch=!1,this._middlewareBuffer=null,this._middlewareIndexStart=0,this._middlewareIndexCount=0,this._pOpacity=1,this._opacityDirty=0,this._descriptorSetCache=new GR,this._meshDataArray=[],this._maskClearModel=null,this._maskClearMtl=null,this._maskModelMesh=null,this._root=g,this.device=g.device,this._batches=new am(64),this._drawBatchPool=new ad(function(){return new NY},128,function(g){return g.destroy(v)})}var g=t1.prototype;return g.initialize=function(){return!0},g.destroy=function(){for(var g=0;g<this._batches.length;g++)this._batches.array[g]&&this._batches.array[g].destroy(this);this._batches.destroy();for(var v,S=f(this._bufferAccessors.values());!(v=S()).done;)v.value.destroy();this._bufferAccessors.clear(),this._drawBatchPool&&this._drawBatchPool.destroy(),this._descriptorSetCache.destroy(),PB.sharedManager.destroy(),this._maskClearModel&&this._maskModelMesh&&(X.director.root.destroyModel(this._maskClearModel),this._maskModelMesh.destroy()),this._maskClearMtl&&this._maskClearMtl.destroy()},g.syncRootNodesToNative=function(){},g.addScreen=function(g){this._screens.push(g),this._screens.sort(this._screenSort)},g.removeScreen=function(g){var v=this._screens.indexOf(g);-1!==v&&this._screens.splice(v,1)},g.sortScreens=function(){this._screens.sort(this._screenSort)},g.getFirstRenderCamera=function(g){if(g.scene&&g.scene.renderScene)for(var v=g.scene.renderScene.cameras,S=0;S<v.length;S++){var O=v[S];if(O.visibility&g.layer)return O}return null},g.update=function(){for(var g=this._screens,v=0,S=0;S<g.length;++S){var O=g[S],X=O._getRenderScene();if(O.enabledInHierarchy&&X){this._opacityDirty=0,this._pOpacity=1,this.walk(O.node),this.autoMergeBatches(this._currComponent),this.resetRenderStates();var Y=0;if(this._batches.length>v)for(;v<this._batches.length;++v){var te=this._batches.array[v];if(te.model)for(var ti=te.model.subModels,tr=0;tr<ti.length;tr++)ti[tr].priority=Y++;else te.descriptorSet=this._descriptorSetCache.getDescriptorSet(te);X.addBatch(te)}}}},g.uploadBuffers=function(){if(this._batches.length>0){for(var g=this._meshDataArray.length,v=0;v<g;v++)this._meshDataArray[v].uploadBuffers();for(var S,O=f(this._bufferAccessors.values());!(S=O()).done;){var X=S.value;X.uploadBuffers(),X.reset()}this._descriptorSetCache.update()}},g.reset=function(){for(var g=0;g<this._batches.length;++g){var v=this._batches.array[g];v.isStatic||(v.clear(),this._drawBatchPool.free(v))}for(var S,O=f(this._bufferAccessors.values());!(S=O()).done;)S.value.reset();for(var X=this._meshDataArray.length,Y=0;Y<X;Y++)this._meshDataArray[Y].freeIAPool();this._meshDataArray.length=0,this._staticVBBuffer=null,this._currBID=-1,this._indexStart=0,this._currHash=0,this._currLayer=0,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._batches.clear(),PB.sharedManager.reset()},g.switchBufferAccessor=function(g){void 0===g&&(g=Ph);var v=g===Ph?36:KN(g);if(!this._staticVBBuffer||this._staticVBBuffer.vertexFormatBytes!==v){var S=this._bufferAccessors.get(v);S||(S=new PC(this.device,g),this._bufferAccessors.set(v,S)),this._staticVBBuffer=S,this._currBID=-1}return this._staticVBBuffer},g.registerBufferAccessor=function(g,v){this._bufferAccessors.set(g,v)},g.updateBuffer=function(g,v){var S=this.switchBufferAccessor(g);this._currBID!==v&&(this._currBID=v,this._indexStart=S.getMeshBuffer(v).indexOffset)},g.commitComp=function(g,v,S,O,X){var Y,te=0,ti=-1;if(v&&v.chunk){if(!v.isValid())return;te=v.dataHash,Y=v.material,ti=v.chunk.bufferId}g.stencilStage===Pg.ENTER_LEVEL||g.stencilStage===Pg.ENTER_LEVEL_INVERTED?this._insertMaskBatch(g):g.stencilStage=PB.sharedManager.stage;var tr=g.stencilStage;this._currHash===te&&0!==te&&this._currMaterial===Y&&this._currDepthStencilStateStage===tr||(this.autoMergeBatches(this._currComponent),v&&!v._isMeshBuffer&&this.updateBuffer(v.vertexFormat,ti),this._currRenderData=v,this._currHash=v?v.dataHash:0,this._currComponent=g,this._currTransform=X,this._currMaterial=g.getRenderMaterial(0),this._currDepthStencilStateStage=tr,this._currLayer=g.node.layer,S?(this._currTexture=S.getGFXTexture(),this._currSampler=S.getGFXSampler(),this._currTextureHash=S.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0)),O.fillBuffers(g,this)},g.commitIA=function(g,v,S,O,X){var Y;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var te=0;g&&(g.stencilStage=PB.sharedManager.stage,Y=null!==g.customMaterial?PB.sharedManager.getStencilStage(g.stencilStage,O):PB.sharedManager.getStencilStage(g.stencilStage),te=PB.sharedManager.getStencilHash(g.stencilStage));var ti=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();ti.visFlags=g.node.layer,ti.inputAssembler=v,ti.useLocalData=X||null,S&&(ti.texture=S.getGFXTexture(),ti.sampler=S.getGFXSampler(),ti.textureHash=S.getHash(),ti.samplerHash=ti.sampler.hash),ti.fillPasses(O||null,Y,te,null),this._batches.push(ti)},g.commitMiddleware=function(g,v,S,O,X,Y,te){var ti=X.getGFXTexture();te&&this._middlewareEnableBatch&&this._middlewareBuffer===v&&this._currTexture===ti&&this._currMaterial.hash===Y.hash&&this._middlewareIndexStart+this._middlewareIndexCount===S&&this._currLayer===g.node.layer?this._middlewareIndexCount+=O:(this.autoMergeBatches(this._currComponent),this.resetRenderStates(),this._currComponent=g,this._currTexture=ti,this._currSampler=X.getGFXSampler(),this._currTextureHash=X.getHash(),this._currLayer=g.node.layer,this._currSamplerHash=this._currSampler.hash,this._currHash=0,this._currTransform=te?null:g.node,this._middlewareEnableBatch=te,this._middlewareBuffer=v,this._currMaterial=Y,this._middlewareIndexStart=S,this._middlewareIndexCount=O),this._currIsMiddleware=!0},g.commitModel=function(g,v,S){var O;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var Y=0;S&&(g.stencilStage===Pg.ENTER_LEVEL||g.stencilStage===Pg.ENTER_LEVEL_INVERTED?this._insertMaskBatch(g):g.stencilStage=PB.sharedManager.stage,O=PB.sharedManager.getStencilStage(g.stencilStage,S),Y=PB.sharedManager.getStencilHash(g.stencilStage));var te=X.director.getTotalFrames();v&&(v.updateTransform(te),v.updateUBOs(te));for(var ti=0;ti<v.subModels.length;ti++){var tr=this._drawBatchPool.alloc(),ta=v.subModels[ti];tr.visFlags=g.node.layer,tr.model=v,tr.texture=null,tr.sampler=null,tr.useLocalData=null,O||(O=null),tr.fillPasses(S,O,Y,ta.patches),tr.inputAssembler=ta.inputAssembler,tr.model.visFlags=tr.visFlags,tr.descriptorSet=ta.descriptorSet,this._batches.push(tr)}},g.setupStaticBatch=function(g,v){this.finishMergeBatches(),this._staticVBBuffer=v,this.currStaticRoot=g},g.endStaticBatch=function(){this.finishMergeBatches(),this.currStaticRoot=null,this._staticVBBuffer=null,this.switchBufferAccessor()},g.commitStaticBatch=function(g){this._batches.concat(g.drawBatchList),this.finishMergeBatches()},g.autoMergeBatches=function(g){if(this._currIsMiddleware)this.mergeBatchesForMiddleware(g);else{var v=this._currMaterial;if(v){var S,O=this._currRenderData,X=this._staticVBBuffer;if(O&&O._isMeshBuffer)S=O.requestIA(this.device),-1===this._meshDataArray.indexOf(O)&&this._meshDataArray.push(O);else if(X){var Y=this._currBID,te=X.getMeshBuffer(Y);if(!te)return;var ti=te.indexOffset-this._indexStart;if(ti<=0)return;this._indexStart,te.indexOffset,te.setDirty(),(S=te.requireFreeIA(this.device)).firstIndex=this._indexStart,S.indexCount=ti,this._indexStart=te.indexOffset}if(this._currBID=-1,S&&this._currTexture){var tr,ta=0;g&&(tr=null!==g.customMaterial?PB.sharedManager.getStencilStage(g.stencilStage,v):PB.sharedManager.getStencilStage(g.stencilStage),ta=PB.sharedManager.getStencilHash(g.stencilStage));var th=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();th.visFlags=this._currLayer,th.texture=this._currTexture,th.sampler=this._currSampler,th.inputAssembler=S,th.useLocalData=this._currTransform,th.textureHash=this._currTextureHash,th.samplerHash=this._currSamplerHash,th.fillPasses(v,tr,ta,null),this._batches.push(th)}}}},g.mergeBatchesForMiddleware=function(g){var v,S;g.stencilStage=PB.sharedManager.stage,v=null!==g.customMaterial?PB.sharedManager.getStencilStage(g.stencilStage,this._currMaterial):PB.sharedManager.getStencilStage(g.stencilStage),S=PB.sharedManager.getStencilHash(g.stencilStage);var O=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();O.visFlags=g.node.layer;var X=this._middlewareBuffer.requireFreeIA(this.device);X.firstIndex=this._middlewareIndexStart,X.indexCount=this._middlewareIndexCount,O.inputAssembler=X,O.useLocalData=this._currTransform,O.texture=this._currTexture,O.sampler=this._currSampler,O.textureHash=this._currTextureHash,O.samplerHash=this._currSamplerHash,O.fillPasses(this._currMaterial||null,v,S,null),this._batches.push(O),this._currIsMiddleware=!1,this._middlewareBuffer=null},g.forceMergeBatches=function(g,v,S){this._currMaterial=g,v?(this._currTexture=v.getGFXTexture(),this._currSampler=v.getGFXSampler(),this._currTextureHash=v.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=S.node.layer,this.autoMergeBatches(S)},g.resetRenderStates=function(){this._currMaterial=this._emptyMaterial,this._currRenderData=null,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},g.finishMergeBatches=function(){this.autoMergeBatches(),this.resetRenderStates()},g.flushMaterial=function(g){this._currMaterial=g},g.walk=function(g,v){if(void 0===v&&(v=0),g.activeInHierarchy){var S=g.children,O=g._uiProps,X=O.uiComp,Y=this._pOpacity,te=Y,ti=X&&X.color?X.color.a/255:1;if(this._pOpacity=te*=ti*O.localOpacity,O.setOpacity(te),!pi(te,0,ex)){if(O.colorDirty&&this._opacityDirty++,X&&X.enabledInHierarchy&&X.fillBuffers(this),this._opacityDirty&&X&&!X.useVertexOpacity&&X.renderData&&X.renderData.vertexCount>0){!function(g,v){for(var S,O,X,Y=g.vertexFormat,te=g.chunk.vb,ti=0,tr=0;tr<Y.length;++tr){if(S=Y[tr],(O=uf[S.format]).hasAlpha){if(X=g.floatStride,O.size/O.count==1)for(var ta=~~mi(Math.round(255*v),0,255),th=ti;th<te.length;th+=X)te[th]=(0xffffff00&te[th]|ta)>>>0;else if(O.size/O.count==4)for(var tu=ti+3;tu<te.length;tu+=X)te[tu]=v}ti+=O.size>>2}}(X.renderData,te);var tr=X.renderData.getMeshBuffer();tr&&tr.setDirty()}if(S.length>0&&!g._static)for(var ta=0;ta<S.length;++ta){var th=S[ta];this.walk(th,v)}O.colorDirty&&(this._opacityDirty--,O.colorDirty=!1)}this._pOpacity=Y,X&&X.enabledInHierarchy&&(X.postUpdateAssembler(this),(X.stencilStage===Pg.ENTER_LEVEL||X.stencilStage===Pg.ENTER_LEVEL_INVERTED)&&PB.sharedManager.getMaskStackSize()>0&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates(),PB.sharedManager.exitMask())),v+=1}},g._screenSort=function(g,v){return g.node.getSiblingIndex()-v.node.getSiblingIndex()},g._releaseDescriptorSetCache=function(g){this._descriptorSetCache.releaseDescriptorSetCache(g)},g._createClearModel=function(){if(!this._maskClearModel){this._maskClearMtl=dU.get("default-clear-stencil"),this._maskClearModel=X.director.root.createModel(wh);var g=KN(Pa),v=uZ.gfxDevice,S=v.createBuffer(new hx(oC.VERTEX|oC.TRANSFER_DST,oR.DEVICE,4*g,g)),O=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);S.update(O);var Y=v.createBuffer(new hx(oC.INDEX|oC.TRANSFER_DST,oR.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),te=new Uint16Array([0,1,2,2,1,3]);Y.update(te),this._maskModelMesh=new mf([S],Pa,oY.TRIANGLE_LIST,Y),this._maskModelMesh.subMeshIdx=0,this._maskClearModel.initSubModel(0,this._maskModelMesh,this._maskClearMtl)}},g._insertMaskBatch=function(g){this.autoMergeBatches(this._currComponent),this.resetRenderStates(),this._createClearModel(),this._maskClearModel.node=this._maskClearModel.transform=g.node;var v=PB.sharedManager;v.pushMask(1);var S,O=v.clear(g),Y=0,te=this._maskClearMtl;te&&(S=v.getStencilStage(O,te),Y=v.getStencilHash(O));var ti=this._maskClearModel,tr=X.director.getTotalFrames();ti&&(ti.updateTransform(tr),ti.updateUBOs(tr));for(var ta=0;ta<ti.subModels.length;ta++){var th=this._drawBatchPool.alloc(),tu=ti.subModels[ta];th.visFlags=g.node.layer,th.model=ti,th.texture=null,th.sampler=null,th.useLocalData=null,S||(S=null),th.fillPasses(te,S,Y,tu.patches),th.inputAssembler=tu.inputAssembler,th.model.visFlags=th.visFlags,th.descriptorSet=tu.descriptorSet,this._batches.push(th)}v.enableMask()},g.syncMeshBuffersToNative=function(){},n(t1,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"currBufferAccessor",get:function(){return this._staticVBBuffer||(this._staticVBBuffer=this.switchBufferAccessor()),this._staticVBBuffer}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(g){this._currStaticRoot=g}},{key:"currIsStatic",set:function(g){this._currIsStatic=g}}]),t1}(),Gb=function(){function t1(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var g=uZ.gfxDevice;this._localData=new Float32Array(Mm.COUNT),this._localBuffer=g.createBuffer(new hx(oC.UNIFORM|oC.TRANSFER_DST,oR.HOST|oR.DEVICE,Mm.SIZE,Mm.SIZE))}var g=t1.prototype;return g.initialize=function(g){var v=uZ.gfxDevice;this._transform=g.useLocalData,this._textureHash=g.textureHash,this._samplerHash=g.samplerHash,GE.layout=g.passes[0].localSetLayout,this._descriptorSet=v.createDescriptorSet(GE),this._descriptorSet.bindBuffer(Mm.BINDING,this._localBuffer);var S=_g.SAMPLER_SPRITE;this._descriptorSet.bindTexture(S,g.texture),this._descriptorSet.bindSampler(S,g.sampler),this._descriptorSet.update(),this._transformUpdate=!0},g.updateTransform=function(g){g!==this._transform&&(this._transform=g,this._transformUpdate=!0,this.uploadLocalData())},g.equals=function(g,v,S){return this._transform===g&&this._textureHash===v&&this._samplerHash===S},g.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},g.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null},g.isValid=function(){return this._transform&&this._transform.isValid},g.uploadLocalData=function(){var g=this._transform;if((g.hasChangedFlags||g.isTransformDirty())&&(g.updateWorldTransform(),this._transformUpdate=!0),this._transformUpdate){var v=g.worldMatrix;e$.toArray(this._localData,v,Mm.MAT_WORLD_OFFSET),e$.invert(GC,v),e$.transpose(GC,GC);var S=e$.determinant(GC),O=1/Math.sqrt(S);e$.multiplyScalar(GC,GC,O),e$.toArray(this._localData,GC,Mm.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},n(t1,[{key:"descriptorSet",get:function(){return this._descriptorSet}}]),t1}(),GR=function(){function t1(){this._descriptorSetCache=new Map,this._dsCacheHashByTexture=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new ad(function(){return new Gb},16,function(g){return g.destroy()})}var g=t1.prototype;return g.getDescriptorSet=function(g){var v;if(X.director.root,g.useLocalData){for(var S=this._localDescriptorSetCache,O=0,Y=S.length;O<Y;O++){var te=S[O];if(te.equals(g.useLocalData,g.textureHash,g.samplerHash))return te.descriptorSet}var ti=this._localCachePool.alloc();return ti.initialize(g),this._localDescriptorSetCache.push(ti),ti.descriptorSet}if(v=g.textureHash^g.samplerHash,this._descriptorSetCache.has(v))return this._descriptorSetCache.get(v);GE.layout=g.passes[0].localSetLayout;var tr=uZ.gfxDevice.createDescriptorSet(GE),ta=_g.SAMPLER_SPRITE;return tr.bindTexture(ta,g.texture),tr.bindSampler(ta,g.sampler),tr.update(),this._descriptorSetCache.set(v,tr),this._dsCacheHashByTexture.set(g.textureHash,v),tr},g.update=function(){var g=this._localDescriptorSetCache,v=g.length;if(0!==v){for(var S=[],O=0;O<v;O++){var X=g[O];if(X.isValid())X.uploadLocalData();else{X.reset();var Y=g.indexOf(X);S.push(Y)}}for(var te=S.length-1;te>=0;te--){var ti=S[te],tr=g[ti];g.splice(ti,1),this._localCachePool.free(tr)}}},g.reset=function(){for(var g=this._localDescriptorSetCache,v=g.length,S=0;S<v;S++){var O=g[S];this._localCachePool.free(O)}this._localDescriptorSetCache.length=0},g.releaseDescriptorSetCache=function(g){var v=this._dsCacheHashByTexture.get(g);v&&this._descriptorSetCache.has(v)&&(this._descriptorSetCache.get(v).destroy(),this._descriptorSetCache.delete(v),this._dsCacheHashByTexture.delete(g))},g.destroy=function(){for(var g,v=f(this._descriptorSetCache.values());!(g=v()).done;)g.value.destroy();this._descriptorSetCache.clear(),this._dsCacheHashByTexture.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy()},t1}();X.internal.Batcher2D=Gx,X.UI={MeshBuffer:PS,spriteAssembler:Gy,graphicsAssembler:ks,labelAssembler:kO,RenderData:PX,MeshRenderData:Pj},IL.on(IO.EVENT_POST_SUBSYSTEM_INIT,function(){GO.init()});var Gw,GI,GB,GP,GD,GM,GO=g("a0",function(){function t1(){}return t1.getSortingPriority=function(g,v){return void 0===g&&(g=0),void 0===v&&(v=0),(g+32768<<16|v+32768)>>>0},t1.getLayerIndex=function(g){void 0===g&&(g=0);var v=0;return this.indexMap.has(g)?v=this.indexMap.get(g):J(2105),v},t1.getLayerIndexByName=function(g){var v=this.getLayerByName(g);return this.getLayerIndex(v)},t1.getLayerName=function(g){void 0===g&&(g=0);var v="";return this.nameMap.has(g)?v=this.nameMap.get(g):J(2105),v},t1.getLayerByName=function(g){for(var v=this.nameMap.size,S=this.nameMap.keys(),O=0,X=0;X<v;X++)if(O=S.next().value,this.nameMap.get(O)===g)return O;return J(2106),0},t1.isLayerValid=function(g){return!!this.indexMap.has(g)||(J(2105),!1)},t1.getBuiltinLayers=function(){return[{id:0,name:"default",value:0}]},t1.init=function(){var g=tQ.querySettings(tK.Category.ENGINE,"sortingLayers");g&&0!==g.length||(g=this.getBuiltinLayers()),t1.resetState();for(var v=0;v<g.length;v++){var S=g[v];t1.setLayer(S.id,S.name,S.value),t1.Enum[S.name]=S.id}re.update(t1.Enum),re.sortList(t1.Enum,function(g,v){return t1.getLayerIndex(g.value)-t1.getLayerIndex(v.value)})},t1.setLayer=function(g,v,S){this.nameMap.set(g,v),this.indexMap.set(g,S)},t1.resetState=function(){for(var g=Object.keys(t1.Enum),v=0;v<g.length;v++)delete t1.Enum[t1.Enum[g[v]]],delete t1.Enum[g[v]];t1.indexMap.clear(),t1.nameMap.clear()},t1}());GO.nameMap=new Map,GO.indexMap=new Map,GO.Enum=re({default:0}),g("a1",(Gw=nJ("cc.Sorting"),GI=ma(GO.Enum),Gw(GB=n0((p((GP=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._sortingLayer=GD&&GD(),v._sortingOrder=GM&&GM(),v._modelRenderer=null,v}s(e,g);var v=e.prototype;return v.__preload=function(){this._modelRenderer=this.getComponent("cc.ModelRenderer"),this._modelRenderer||q(16301,this.node.name),this._updateSortingPriority()},v._updateSortingPriority=function(){var g=GO.getLayerIndex(this._sortingLayer),v=GO.getSortingPriority(g,this._sortingOrder);this._modelRenderer&&this._modelRenderer.isValid&&(this._modelRenderer.priority=v)},n(e,[{key:"sortingLayer",get:function(){return this._sortingLayer},set:function(g){g!==this._sortingLayer&&GO.isLayerValid(g)&&(this._sortingLayer=g,this._updateSortingPriority())}},{key:"sortingOrder",get:function(){return this._sortingOrder},set:function(g){g!==this._sortingOrder&&(this._sortingOrder=mi(g,-32768,32767),this._updateSortingPriority())}}]),e}(cS)).prototype,"sortingLayer",[GI],Object.getOwnPropertyDescriptor(GP.prototype,"sortingLayer"),GP.prototype),GD=ws(GP.prototype,"_sortingLayer",[n2],function(){return GO.Enum.default}),GM=ws(GP.prototype,"_sortingOrder",[n2],function(){return 0}),GB=GP))||GB)||GB));var GL,GF,GN,Gk,GG,GV=Symbol("CreateEval");nJ("cc.animation.EmbeddedPlayer")((GL=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).begin=GF&&GF(),v.end=GN&&GN(),v.reconciledSpeed=Gk&&Gk(),v.playable=GG&&GG(),v}return s(e,g),e}(rx),GF=ws(GL.prototype,"begin",[n2],function(){return 0}),GN=ws(GL.prototype,"end",[n2],function(){return 0}),Gk=ws(GL.prototype,"reconciledSpeed",[n2],function(){return!1}),GG=ws(GL.prototype,"playable",[n2],function(){return null}),GL));var GU,tY=function(){},GH=function(){function t1(g){this._randomAccess=g}return t1.prototype.setTime=function(){},n(t1,[{key:"randomAccess",get:function(){return this._randomAccess}}]),t1}(),Gz=function(){function t1(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var g=t1.prototype;return g.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(tt(3912)):(this._isPlaying=!0,this.onPlay())},g.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},g.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},g.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},g.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},g.update=function(){},g.onPlay=function(){},g.onPause=function(){},g.onResume=function(){},g.onStop=function(){},g.onError=function(){},n(t1,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t1}();!function(g){g[g.Default=s4.Default]="Default",g[g.Normal=s4.Normal]="Normal",g[g.Reverse=s4.Reverse]="Reverse",g[g.Loop=s4.Loop]="Loop",g[g.LoopReverse=s4.Loop|s4.Reverse]="LoopReverse",g[g.PingPong=s4.PingPong]="PingPong",g[g.PingPongReverse=s4.PingPong|s4.Reverse]="PingPongReverse"}(GU||(GU={})),oe(GU);var GX,Gj=function(){function t1(g){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,g&&this.set(g)}return t1.prototype.set=function(g){this.ratio=g.ratio,this.time=g.time,this.direction=g.direction,this.stopped=g.stopped,this.iterations=g.iterations,this.frameIndex=g.frameIndex},t1}(),Gq=function(){function t1(g){this.weight=0,this._pose=void 0,this._blendStateWriters=[],this._pose=g}var g=t1.prototype;return g.destroy=function(){for(var g=0;g<this._blendStateWriters.length;++g)this._pose.destroyWriter(this._blendStateWriters[g]);this._blendStateWriters.length=0},g.createPoseWriter=function(g,v,S){var O=this._pose.createWriter(g,v,this,S);return this._blendStateWriters.push(O),O},t1}();function aY(){return X.director.getAnimationManager()}!function(g){g.PLAY="play",g.STOP="stop",g.PAUSE="pause",g.RESUME="resume",g.LASTFRAME="lastframe",g.FINISHED="finished"}(GX||(GX={})),oe(GX);var GY,GK,GJ,GZ=g("a4",function(g){function e(v,S){var O;return void 0===S&&(S=""),(O=g.call(this)||this).duration=1,O.time=0,O.frameRate=0,O._targetNode=null,O._curveLoaded=!1,O._clip=void 0,O._speed=1,O._useSimpleProcess=!1,O._target=null,O._wrapMode=GU.Normal,O._repeatCount=1,O._delay=0,O._delayTime=0,O._currentFramePlayed=!1,O._name=void 0,O._lastIterations=NaN,O._lastWrapInfo=null,O._wrappedInfo=new Gj,O._allowLastFrame=!1,O._blendStateWriterHost={weight:0},O._playbackDuration=0,O._invDuration=1,O._poseOutput=null,O._weight=1,O._clipEval=void 0,O._clipEventEval=void 0,O._clipEmbeddedPlayerEval=void 0,O._doNotCreateEval=!1,O._clip=v,O._name=S||v&&v.name,O._playbackRange={min:0,max:v.duration},O._playbackDuration=v.duration,v.duration||U("Clip "+v.name+" has zero duration."),O}s(e,g);var v=e.prototype;return v.initialize=function(g,v,S){if(!this._curveLoaded){this._curveLoaded=!0,this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval&&(this._clipEval=void 0),this._clipEventEval&&(this._clipEventEval=void 0),this._clipEmbeddedPlayerEval&&(this._clipEmbeddedPlayerEval.destroy(),this._clipEmbeddedPlayerEval=void 0),this._targetNode=g;var O=this._clip;if(this.duration=O.duration,this._invDuration=1/this.duration,this._speed=O.speed,this.wrapMode=O.wrapMode,this.frameRate=O.sample,this._playbackRange.min=0,this._playbackRange.max=O.duration,this._playbackDuration=O.duration,(this.wrapMode&s4.Loop)===s4.Loop?this.repeatCount=1/0:this.repeatCount=1,!this._doNotCreateEval){var X,Y,te,ti=null!==(X=null!=v?v:null===(Y=aY())||void 0===Y?void 0:Y.blendState)&&void 0!==X?X:null;ti&&(this._poseOutput=new Gq(ti)),this._clipEval=O.createEvaluator({target:g,pose:null!==(te=this._poseOutput)&&void 0!==te?te:void 0,mask:S})}O.containsAnyEvent()&&(this._clipEventEval=O.createEventEvaluator(this._targetNode)),O.containsAnyEmbeddedPlayer()&&(this._clipEmbeddedPlayerEval=O.createEmbeddedPlayerEvaluator(this._targetNode),this._clipEmbeddedPlayerEval.notifyHostSpeedChanged(this._speed))}},v.destroy=function(){this.isMotionless||aY().removeAnimation(this),this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval=void 0},v.emit=function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];aY().pushDelayEvent(this._emit,this,v)},v.on=function(g,v,S){return this._target&&this._target.isValid?this._target.on(g,v,S):null},v.once=function(g,v,S){return this._target&&this._target.isValid?this._target.once(g,v,S):null},v.off=function(g,v,S){this._target&&this._target.isValid&&this._target.off(g,v,S)},v.allowLastFrameEvent=function(g){this._allowLastFrame=g},v._setEventTarget=function(g){this._target=g},v.setTime=function(g){this._currentFramePlayed=!1,this.time=g||0;var v,S=this.getWrappedInfo(g,this._wrappedInfo);null===(v=this._clipEventEval)||void 0===v||v.ignore(S.ratio,S.direction)},v.update=function(g){this._delayTime>0&&(this._delayTime-=g,this._delayTime>0)||(this._currentFramePlayed?this.time+=g*this._speed:this._currentFramePlayed=!0,this._process())},v.sample=function(){var g=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(g.time),this._sampleEvents(g),this._sampleEmbeddedPlayers(g),g},v.onPlay=function(){var g;this.setTime(this._getPlaybackStart()),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(GX.PLAY,this),null===(g=this._clipEmbeddedPlayerEval)||void 0===g||g.notifyHostPlay(this.current)},v.onStop=function(){var g;this.isPaused||this._onPauseOrStop(),this.emit(GX.STOP,this),null===(g=this._clipEmbeddedPlayerEval)||void 0===g||g.notifyHostStop()},v.onResume=function(){var g;this._onReplayOrResume(),this.emit(GX.RESUME,this),null===(g=this._clipEmbeddedPlayerEval)||void 0===g||g.notifyHostPlay(this.current)},v.onPause=function(){var g;this._onPauseOrStop(),this.emit(GX.PAUSE,this),null===(g=this._clipEmbeddedPlayerEval)||void 0===g||g.notifyHostPause(this.current)},v._sampleCurves=function(g){var v=this._poseOutput,S=this._clipEval;v&&(v.weight=this.weight),S&&S.evaluate(g)},v._process=function(){this._useSimpleProcess?this.simpleProcess():this.process()},v.process=function(){var g,v=this.sample();this._allowLastFrame&&(g=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new Gj(v),this.repeatCount>1&&(0|v.iterations)>(0|g.iterations)&&this.emit(GX.LASTFRAME,this),g.set(v)),v.stopped&&(this.stop(),this.emit(GX.FINISHED,this))},v.simpleProcess=function(){var g=this._playbackRange.min,v=this._playbackDuration,S=0,O=0;if(0!==v&&((S=this.time%v)<0&&(S+=v),O=(g+S)*this._invDuration),this._sampleCurves(g+S),this._clipEventEval||this._clipEmbeddedPlayerEval){var X=this.getWrappedInfo(this.time,this._wrappedInfo);this._sampleEvents(X),this._sampleEmbeddedPlayers(X)}this._allowLastFrame&&(Number.isNaN(this._lastIterations)&&(this._lastIterations=O),(this.time>0&&this._lastIterations>O||this.time<0&&this._lastIterations<O)&&this.emit(GX.LASTFRAME,this),this._lastIterations=O)},v._needReverse=function(g){var v=this.wrapMode,S=!1;return(v&s4.PingPong)===s4.PingPong&&(g-(0|g)==0&&g>0&&(g-=1),1&g&&(S=!S)),(v&s4.Reverse)===s4.Reverse&&(S=!S),S},v.getWrappedInfo=function(g,v){v=v||new Gj;var S=this._playbackRange.min,O=this._playbackDuration,X=this.repeatCount;if(0===O)return v.time=0,v.ratio=0,v.direction=1,v.stopped=!!Number.isFinite(X),v.iterations=0,v;var Y=!1,te=(g-=S)>0?g/O:-g/O;if(te>=X){te=X,Y=!0;var ti=X-(0|X);0===ti&&(ti=1),g=ti*O*(g>0?1:-1)}if(g>O){var tr=g%O;g=0===tr?O:tr}else g<0&&0!=(g%=O)&&(g+=O);var ta=!1,th=this._wrapMode&s4.ShouldWrap;th&&(ta=this._needReverse(te));var tu=ta?-1:1;return this.speed<0&&(tu*=-1),th&&ta&&(g=O-g),v.time=S+g,v.ratio=v.time/this.duration,v.direction=tu,v.stopped=Y,v.iterations=te,v},v._getPlaybackStart=function(){return this._playbackRange.min},v._sampleEvents=function(g){var v;null===(v=this._clipEventEval)||void 0===v||v.sample(g.ratio,g.direction,g.iterations)},v._sampleEmbeddedPlayers=function(g){var v;null===(v=this._clipEmbeddedPlayerEval)||void 0===v||v.evaluate(g.time,Math.trunc(g.iterations))},v._emit=function(g,v){this._target&&this._target.isValid&&this._target.emit(g,g,v)},v._onReplayOrResume=function(){aY().addAnimation(this)},v._onPauseOrStop=function(){aY().removeAnimation(this)},n(e,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(g){var v;this._wrapMode=g,this.time=0,g&s4.Loop?this.repeatCount=1/0:this.repeatCount=1,null===(v=this._clipEventEval)||void 0===v||v.setWrapMode(g)}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(g){this._repeatCount=g;var v=this._wrapMode&s4.ShouldWrap,S=(this.wrapMode&s4.Reverse)===s4.Reverse;this._useSimpleProcess=g===1/0&&!v&&!S}},{key:"delay",get:function(){return this._delay},set:function(g){this._delayTime=this._delay=g}},{key:"playbackRange",get:function(){return this._playbackRange},set:function(g){g.max,g.min,this._playbackRange.min=Math.max(g.min,0),this._playbackRange.max=Math.min(g.max,this.duration),this._playbackDuration=this._playbackRange.max-this._playbackRange.min,this.setTime(0)}},{key:"speed",get:function(){return this._speed},set:function(g){var v;this._speed=g,null===(v=this._clipEmbeddedPlayerEval)||void 0===v||v.notifyHostSpeedChanged(g)}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return 0===this.duration?0:this.current/this.duration}},{key:"weight",get:function(){return this._weight},set:function(g){this._weight=g,this._poseOutput&&(this._poseOutput.weight=g)}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),e}(Gz));X.AnimationState=GZ,nJ("cc.animation.EmbeddedAnimationClipPlayable")((GY=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).path=GK&&GK(),v.clip=GJ&&GJ(),v}return s(e,g),e.prototype.instantiate=function(g){var v=this.clip,S=this.path;if(!v)return null;var O=g.getChildByPath(S);if(!O)return J(3938,S,g.getPathInHierarchy(),v.name),null;var X=new GZ(v);return X.initialize(O),new G1(X)},e}(tY),GK=ws(GY.prototype,"path",[n2],function(){return""}),GJ=ws(GY.prototype,"clip",[n2],function(){return null}),GY));var GQ,G0,G1=function(g){function e(v){var S;return(S=g.call(this,!0)||this)._animationState=void 0,S._animationState=v,S}s(e,g);var v=e.prototype;return v.destroy=function(){this._animationState.destroy()},v.play=function(){this._animationState.play()},v.pause=function(){this._animationState.pause()},v.stop=function(){this._animationState.stop()},v.setSpeed=function(g){this._animationState.speed=g},v.setTime=function(g){this._animationState.time=g},e}(GH);nJ("cc.animation.EmbeddedParticleSystemPlayable")((GQ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).path=G0&&G0(),v}return s(e,g),e.prototype.instantiate=function(g){var v=g.getChildByPath(this.path);if(!v)return G("Hierarchy path "+this.path+" does not exists."),null;var S=zt("cc.ParticleSystem");if(!S)return G("Particle system is required for embedded particle system player."),null;var O=v.getComponent(S);return O?new G7(O):(G(this.path+" does not includes a particle system component."),null)},e}(tY),G0=ws(GQ.prototype,"path",[n2],function(){return""}),GQ));var G2,G3,G5,G4,G8,G6,G7=function(g){function e(v){var S;return(S=g.call(this,!1)||this)._particleSystem=void 0,S._particleSystem=v,S}s(e,g);var v=e.prototype;return v.destroy=function(){},v.play=function(){this._particleSystem.play()},v.pause=function(){this._particleSystem.stopEmitting()},v.stop=function(){this._particleSystem.stopEmitting()},v.setSpeed=function(g){this._particleSystem.simulationSpeed=g},e}(GH);function AY(g){return"string"==typeof g||"number"==typeof g}var G9,Vn,Vs,Va,Vo,Vh,Vl,Vc,V_,Vf,Vd,Vp,Vy,VS,VA,VT,VE,VC,Vx,Vb=nJ("cc.animation.HierarchyPath")((G3=function(){function t1(g){this.path=G5&&G5(),this.path=g||""}return t1.prototype.get=function(g){return _instanceof(g,mJ)?g.getChildByPath(this.path)||(q(3926,g.name,this.path),null):(q(3925),null)},t1}(),G5=ws(G3.prototype,"path",[n2],function(){return""}),G2=G3))||G2,VR=nJ("cc.animation.ComponentPath")((G8=function(){function t1(g){this.component=G6&&G6(),this.component=g||""}return t1.prototype.get=function(g){return _instanceof(g,mJ)?g.getComponent(this.component)||(q(3928,g.name,this.component),null):(q(3927),null)},t1}(),G6=ws(G8.prototype,"component",[n2],function(){return""}),G4=G8))||G4,Vw=Symbol("NormalizedFollow"),VI=Symbol("ConvertAsTrsPath"),VD=Symbol("TrackBinding"),VO=nJ("cc.animation.TrackPath")((Vn=function(){function t1(){this._paths=Vs&&Vs()}var g=t1.prototype;return g.toProperty=function(g){return this._paths.push(g),this},g.toElement=function(g){return this._paths.push(g),this},g.toHierarchy=function(g){return this._paths.push(new Vb(g)),this},g.toComponent=function(g){var v=new VR("string"==typeof g?g:vt(g));return this._paths.push(v),this},g.toCustomized=function(g){return this._paths.push(g),this},g.append=function(){for(var g,v=arguments.length,S=new Array(v),O=0;O<v;O++)S[O]=arguments[O];var X=(g=this._paths).concat.apply(g,S.map(function(g){return g._paths}));return this._paths=X,this},g.isPropertyAt=function(g){return"string"==typeof this._paths[g]},g.parsePropertyAt=function(g){return this._paths[g]},g.isElementAt=function(g){return"number"==typeof this._paths[g]},g.parseElementAt=function(g){return this._paths[g]},g.isHierarchyAt=function(g){return _instanceof(this._paths[g],Vb)},g.parseHierarchyAt=function(g){return this.isHierarchyAt(g),this._paths[g].path},g.isComponentAt=function(g){return _instanceof(this._paths[g],VR)},g.parseComponentAt=function(g){return this.isComponentAt(g),this._paths[g].component},g.slice=function(g,v){var S=new t1;return S._paths=this._paths.slice(g,v),S},g.trace=function(g,v,S){var O,X;return null!==(O=v)&&void 0!==O||(v=0),null!==(X=S)&&void 0!==X||(S=this._paths.length),this[Vw](g,v,S)},g[VI]=function(){for(var g,v=this._paths,S=v.length,O=0,X="";O<S;++O){var Y=v[O];if(!_instanceof(Y,Vb))break;Y.path&&(X?X+="/"+Y.path:X=Y.path)}if(O===S)return null;if(O!==S-1)return null;switch(v[O]){case"position":case"scale":case"rotation":case"eulerAngles":g=v[O];break;default:return null}return{node:X,property:g}},g[Vw]=function(g,v,S){for(var O=this._paths,X=g,Y=v;Y<S;++Y){var te=O[Y];if(AY(te)){if(!(te in X))return q(3929,te),null;X=X[te]}else X=te.get(X);if(null===X)break}return X},n(t1,[{key:"length",get:function(){return this._paths.length}}]),t1}(),Vs=ws(Vn.prototype,"_paths",[n2],function(){return[]}),G9=Vn))||G9,VL=nJ("cc.animation.TrackBinding")(Va=n3(((Vc=function(){function t1(){this.path=Vh&&Vh(),this.proxy=Vl&&Vl()}var g=t1.prototype;return g.parseTrsPath=function(){return this.proxy?null:this.path[VI]()},g.createRuntimeBinding=function(g,v,S){var O=this.path,X=this.proxy,Y=O.length,te=Y-1;if(0===Y||!O.isPropertyAt(te)&&!O.isElementAt(te)||X){if(X){var ti=O[Vw](g,0,Y);if(null===ti)return null;var tr=X.forTarget(ti);if(!tr)return null;var ta={setValue:function(g){tr.set(g)}},th=tr.get;return th&&(ta.getValue=function(){return th.call(tr)}),ta}return J(3921),null}var tu=O.isPropertyAt(te)?O.parsePropertyAt(te):O.parseElementAt(te),tl=O[Vw](g,0,Y-1);if(null===tl)return null;if(v&&_instanceof(tl,mJ)&&("position"===(t_=tu)||"rotation"===t_||"scale"===t_||"eulerAngles"===t_))return v.createPoseWriter(tl,tu,S);var tc=t1._animationFunctions.get(tl.constructor);tc||(tc=new Map,t1._animationFunctions.set(tl.constructor,tc));var t_,tf=tc.get(tu);return tf||(tf={setValue:Function("value","this.target."+tu+" = value;"),getValue:Function("return this.target."+tu+";")},tc.set(tu,tf)),{target:tl,setValue:tf.setValue,getValue:tf.getValue}},g.isMaskedOff=function(g){var v=this.parseTrsPath();if(!v)return!1;for(var S=g.joints[Symbol.iterator](),O=S.next();!O.done;O=S.next()){var X=O.value;if(X.path===v.node)return!X.enabled}return!1},t1}())._animationFunctions=new WeakMap,Vh=ws((Vo=Vc).prototype,"path",[n2],function(){return new VO}),Vl=ws(Vo.prototype,"proxy",[n2],null),Va=Vo))||Va)||Va,VF=nJ("cc.animation.Track")((Vf=function(){function t1(){this._binding=Vd&&Vd()}var g=t1.prototype;return g.channels=function(){return[]},g.range=function(){for(var g,v={min:1/0,max:-1/0},S=f(this.channels());!(g=S()).done;){var O=g.value;v.min=Math.min(v.min,O.curve.rangeMin),v.max=Math.max(v.max,O.curve.rangeMax)}return v},n(t1,[{key:"path",get:function(){return this._binding.path},set:function(g){this._binding.path=g}},{key:"proxy",get:function(){return this._binding.proxy},set:function(g){this._binding.proxy=g}},{key:VD,get:function(){return this._binding}}]),t1}(),Vd=ws(Vf.prototype,"_binding",[n2],function(){return new VL}),V_=Vf))||V_,VN=nJ("cc.animation.Channel")((Vy=function(){function t1(g){this.name="",this._curve=VS&&VS(),this._curve=g}return n(t1,[{key:"curve",get:function(){return this._curve}}]),t1}(),VS=ws(Vy.prototype,"_curve",[n2],null),Vp=Vy))||Vp,Vk=nJ("cc.animation.SingleChannelTrack")((VT=function(g){function e(){var v;return(v=g.call(this)||this)._channel=VE&&VE(),v._channel=new VN(v.createCurve()),v}s(e,g);var v=e.prototype;return v.channels=function(){return[this._channel]},v.createCurve=function(){throw new Error("Not impl")},v[GV]=function(){var g=this._channel.curve;return new VG(g)},n(e,[{key:"channel",get:function(){return this._channel}}]),e}(VF),VE=ws(VT.prototype,"_channel",[n2],null),VA=VT))||VA,VG=function(){function t1(g){this._curve=g}return t1.prototype.evaluate=function(g){return this._curve.evaluate(g)},n(t1,[{key:"requiresDefault",get:function(){return!1}}]),t1}(),VU=n2;nJ("cc.animation.RealArrayTrack")((VC=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._channels=Vx&&Vx(),v}s(e,g);var v=e.prototype;return v.channels=function(){return this._channels},v[GV]=function(){return new V7(this._channels.map(function(g){return g.curve}))},n(e,[{key:"elementCount",get:function(){return this._channels.length},set:function(g){var v=this._channels.length;if(g<v)this._channels.splice(g);else if(g>v){var S;(S=this._channels).push.apply(S,Array.from({length:g-v},function(){return new VN(new ss)}))}}}]),e}(VF),Vx=ws(VC.prototype,"_channels",[VU],function(){return[]}),VC));var VH,Vz,VX,Vj,Vq,VY,VK,VJ,VZ,VQ,V$,V0,V1,V2,V5,V4,V8,V6,V7=function(){function t1(g){this._curves=g,this._result=new Array(g.length).fill(0)}return t1.prototype.evaluate=function(g){for(var v=this._result,S=v.length,O=0;O<S;++O)v[O]=this._curves[O].evaluate(g);return this._result},n(t1,[{key:"requiresDefault",get:function(){return!1}}]),t1}(),V9=nJ("cc.animation.UniformProxyFactory")((Vz=function(){function t1(g,v){this.passIndex=VX&&VX(),this.uniformName=Vj&&Vj(),function(g,v,S,O){S&&Object.defineProperty(g,"channelIndex",{enumerable:S.enumerable,configurable:S.configurable,writable:S.writable,value:S.initializer?S.initializer.call(O):void 0})}(this,0,Vq,this),this.passIndex=v||0,this.uniformName=g||""}return t1.prototype.forTarget=function(g){if(_instanceof(g,pf)){var v=this.passIndex,S=this.uniformName,O=this.channelIndex;if(v<0||v>=g.passes.length)q(3941,g.name,v);else{var X=g.passes[v],Y=X.getHandle(S);if(Y){if(dY.getTypeFromHandle(Y)<oE.SAMPLER1D){var te=void 0===O?Y:X.getHandle(S,O,oE.FLOAT);return te?function(g,v){for(var S,O=f(g.shaderInfo.blocks);!(S=O()).done;)for(var X,Y=f(S.value.members);!(X=Y()).done;){var te=X.value;if(te.name===v)return te.count>1}return!1}(X,S)?{set:function(g){X.setUniformArray(te,g)}}:{set:function(g){X.setUniform(te,g)}}:void q(3943,g.name,v,S,O)}var ti=dY.getBindingFromHandle(Y),tr=X.properties[S],ta=tr&&tr.value?""+tr.value+iv(tr.type):ev(tr.type),th=dU.get(ta);return th||(G("Illegal texture default value: "+ta+"."),th=dU.get("default-texture")),{set:function(g){g||(g=th);var v=g.getGFXTexture();v&&v.width&&v.height&&(X.bindTexture(ti,v),_instanceof(g,lJ)&&X.bindSampler(ti,uZ.gfxDevice.getSampler(g.getSamplerInfo())))}}}q(3942,g.name,v,S)}}else q(3940,g)},t1}(),VX=ws(Vz.prototype,"passIndex",[n2],function(){return 0}),Vj=ws(Vz.prototype,"uniformName",[n2],function(){return""}),Vq=p(Vz.prototype,"channelIndex",[rS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),VH=Vz))||VH,Un=nJ("cc.animation.MorphWeightValueProxy")((VK=function(){function t1(){this.subMeshIndex=VJ&&VJ(),this.shapeIndex=VZ&&VZ()}return t1.prototype.forTarget=function(g){var v=this;return{set:function(S){g.setWeight(S,v.subMeshIndex,v.shapeIndex)}}},t1}(),VJ=ws(VK.prototype,"subMeshIndex",[n2],function(){return 0}),VZ=ws(VK.prototype,"shapeIndex",[n2],function(){return 0}),VY=VK))||VY,Uo=nJ("cc.animation.MorphWeightsValueProxy")((V$=function(){function t1(){this.subMeshIndex=V0&&V0()}return t1.prototype.forTarget=function(g){var v=this;return{set:function(S){g.setWeights(S,v.subMeshIndex)}}},t1}(),V0=ws(V$.prototype,"subMeshIndex",[n2],function(){return 0}),VQ=V$))||VQ,Uh=nJ("cc.animation.MorphWeightsAllValueProxy")(V1=function(){function t1(){}return t1.prototype.forTarget=function(g){return{set:function(v){for(var S,O,X=null!==(S=null===(O=g.mesh)||void 0===O?void 0:O.struct.primitives.length)&&void 0!==S?S:0,Y=0;Y<X;++Y)g.setWeights(v,Y)}}},t1}())||V1;function Tq(g,v,S,O){var X,Y,te,ti,tr,ta=new v,th=new v,tu=new v,tl=nJ(g)((Y=function(){function t1(g,S,O){this.dataPoint=te&&te(),this.inTangent=ti&&ti(),this.outTangent=tr&&tr(),this.dataPoint=g||new v,this.inTangent=S||new v,this.outTangent=O||new v}var g=t1.prototype;return g.lerp=function(g,v,X){var Y=this.dataPoint,te=g.dataPoint;th=S(th,this.inTangent,X),tu=S(tu,g.outTangent,X);var ti=v*v*v,tr=v*v,tl=ti-2*tr+v,tc=-2*ti+3*tr,t_=ti-tr;return ta=S(ta,Y,2*ti-3*tr+1),ta=O(ta,ta,th,tl),ta=O(ta,ta,te,tc),ta=O(ta,ta,tu,t_)},g.getNoLerp=function(){return this.dataPoint},t1}(),te=ws(Y.prototype,"dataPoint",[n2],function(){return new v}),ti=ws(Y.prototype,"inTangent",[n2],function(){return new v}),tr=ws(Y.prototype,"outTangent",[n2],function(){return new v}),X=Y))||X;if(v===eW){var tc=tl.prototype.lerp;tl.prototype.lerp=function(g,v,S){var O=tc.call(this,g,v,S);return eW.normalize(O,O),O}}return tl}var Ul,Uc,U_,Uf,Ud,Up=Tq("cc.CubicSplineVec2Value",e8,e8.multiplyScalar,e8.scaleAndAdd),US=Tq("cc.CubicSplineVec3Value",eL,eL.multiplyScalar,eL.scaleAndAdd),UA=Tq("cc.CubicSplineVec4Value",e7,e7.multiplyScalar,e7.scaleAndAdd),UT=Tq("cc.CubicSplineQuatValue",eW,eW.multiplyScalar,eW.scaleAndAdd),UE=nJ("cc.CubicSplineNumberValue")((V5=function(){function t1(g,v,S){this.dataPoint=V4&&V4(),this.inTangent=V8&&V8(),this.outTangent=V6&&V6(),this.dataPoint=g,this.inTangent=v,this.outTangent=S}var g=t1.prototype;return g.lerp=function(g,v,S){var O=this.dataPoint,X=g.dataPoint,Y=v*v*v,te=v*v;return O*(2*Y-3*te+1)+this.outTangent*S*(Y-2*te+v)+X*(-2*Y+3*te)+g.inTangent*S*(Y-te)},g.getNoLerp=function(){return this.dataPoint},t1}(),V4=ws(V5.prototype,"dataPoint",[n2],function(){return 0}),V8=ws(V5.prototype,"inTangent",[n2],function(){return 0}),V6=ws(V5.prototype,"outTangent",[n2],function(){return 0}),V2=V5))||V2,UC=nJ("cc.animation.RealTrack")(Ul=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.createCurve=function(){return new ss},e}(Vk))||Ul;function Mq(g){return 0===g.keyFramesCount?void 0:g}var Ux,Ub,UR,Uw,UI,UP,UD,UM,UO=["X","Y","Z","W"],UL=nJ("cc.animation.VectorTrack")((U_=function(g){function e(){var v;(v=g.call(this)||this)._channels=Uf&&Uf(),v._nComponents=Ud&&Ud(),v._channels=new Array(4);for(var S=0;S<v._channels.length;++S){var O=new VN(new ss);O.name=UO[S],v._channels[S]=O}return v}s(e,g);var v=e.prototype;return v.channels=function(){return this._channels},v[GV]=function(){switch(this._nComponents){default:case 2:return new UF(Mq(this._channels[0].curve),Mq(this._channels[1].curve));case 3:return new UN(Mq(this._channels[0].curve),Mq(this._channels[1].curve),Mq(this._channels[2].curve));case 4:return new Uk(Mq(this._channels[0].curve),Mq(this._channels[1].curve),Mq(this._channels[2].curve),Mq(this._channels[3].curve))}},n(e,[{key:"componentsCount",get:function(){return this._nComponents},set:function(g){this._nComponents=g}}]),e}(VF),Uf=ws(U_.prototype,"_channels",[n2],null),Ud=ws(U_.prototype,"_nComponents",[n2],function(){return 4}),Uc=U_))||Uc,UF=function(){function t1(g,v){this._result=new e8,this._x=g,this._y=v}return t1.prototype.evaluate=function(g,v){return v&&e8.copy(this._result,v),this._x&&(this._result.x=this._x.evaluate(g)),this._y&&(this._result.y=this._y.evaluate(g)),this._result},n(t1,[{key:"requiresDefault",get:function(){return!this._x||!this._y}}]),t1}(),UN=function(){function t1(g,v,S){this._result=new eL,this._x=g,this._y=v,this._z=S}return t1.prototype.evaluate=function(g,v){var S=this._x,O=this._y,X=this._z,Y=this._result;return v&&eL.copy(Y,v),S&&(Y.x=S.evaluate(g)),O&&(Y.y=O.evaluate(g)),X&&(Y.z=X.evaluate(g)),Y},n(t1,[{key:"requiresDefault",get:function(){return!this._x||!this._y||!this._z}}]),t1}(),Uk=function(){function t1(g,v,S,O){this._result=new e7,this._x=g,this._y=v,this._z=S,this._w=O}return t1.prototype.evaluate=function(g,v){return v&&e7.copy(this._result,v),this._x&&(this._result.x=this._x.evaluate(g)),this._y&&(this._result.y=this._y.evaluate(g)),this._z&&(this._result.z=this._z.evaluate(g)),this._w&&(this._result.w=this._w.evaluate(g)),this._result},n(t1,[{key:"requiresDefault",get:function(){return!(this._x&&this._y&&this._z&&this._w)}}]),t1}(),UG=nJ("cc.animation.QuatTrack")(Ux=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.createCurve=function(){return new sG},v[GV]=function(){return new UV(this.channels()[0].curve)},e}(Vk))||Ux,UV=function(){function t1(g){this._result=new eW,this._curve=g}return t1.prototype.evaluate=function(g){return this._curve.evaluate(g,this._result),this._result},n(t1,[{key:"requiresDefault",get:function(){return!1}}]),t1}(),UU=["Red","Green","Blue","Alpha"],UH=nJ("cc.animation.ColorTrack")((UR=function(g){function e(){var v;(v=g.call(this)||this)._channels=Uw&&Uw(),v._channels=new Array(4);for(var S=0;S<v._channels.length;++S){var O=new VN(new ss);O.name=UU[S],v._channels[S]=O}return v}s(e,g);var v=e.prototype;return v.channels=function(){return this._channels},v[GV]=function(){return new Uz(Mq(this._channels[0].curve),Mq(this._channels[1].curve),Mq(this._channels[2].curve),Mq(this._channels[3].curve))},e}(VF),Uw=ws(UR.prototype,"_channels",[n2],null),Ub=UR))||Ub,Uz=function(){function t1(g,v,S,O){this._result=new is,this._x=g,this._y=v,this._z=S,this._w=O}return t1.prototype.evaluate=function(g,v){return v&&is.copy(this._result,v),this._x&&(this._result.r=this._x.evaluate(g)),this._y&&(this._result.g=this._y.evaluate(g)),this._z&&(this._result.b=this._z.evaluate(g)),this._w&&(this._result.a=this._w.evaluate(g)),this._result},n(t1,[{key:"requiresDefault",get:function(){return!(this._x&&this._y&&this._z&&this._w)}}]),t1}(),UX=["Width","Height"],Uj=nJ("cc.animation.SizeTrack")((UP=function(g){function e(){var v;(v=g.call(this)||this)._channels=UD&&UD(),v._channels=new Array(2);for(var S=0;S<v._channels.length;++S){var O=new VN(new ss);O.name=UX[S],v._channels[S]=O}return v}s(e,g);var v=e.prototype;return v.channels=function(){return this._channels},v[GV]=function(){return new Uq(Mq(this._channels[0].curve),Mq(this._channels[1].curve))},e}(VF),UD=ws(UP.prototype,"_channels",[n2],null),UI=UP))||UI,Uq=function(){function t1(g,v){this._result=new iu,this._width=g,this._height=v}return t1.prototype.evaluate=function(g,v){return v&&(this._result.x=v.x,this._result.y=v.y),this._width&&(this._result.width=this._width.evaluate(g)),this._height&&(this._result.height=this._height.evaluate(g)),this._result},n(t1,[{key:"requiresDefault",get:function(){return!this._width||!this._height}}]),t1}(),UY=nJ("cc.animation.ObjectTrack")(UM=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.createCurve=function(){return new sZ},e}(Vk))||UM;g("a2",Object.freeze({__proto__:null,UniformProxyFactory:V9,MorphWeightValueProxy:Un,MorphWeightsValueProxy:Uo,MorphWeightsAllValueProxy:Uh,Track:VF,TrackPath:VO,RealTrack:UC,VectorTrack:UL,QuatTrack:UG,ColorTrack:UH,SizeTrack:Uj,ObjectTrack:UY,isPropertyPath:AY,isCustomPath:function(g,v){return _instanceof(g,v)},HierarchyPath:Vb,ComponentPath:VR,CubicSplineVec2Value:Up,CubicSplineVec3Value:US,CubicSplineVec4Value:UA,CubicSplineQuatValue:UT,CubicSplineNumberValue:UE}));var UK=g("a6",function(){function t1(g){var v,S;this.ratios=void 0,this._findRatio=void 0,this.ratios=g;for(var O=!0,X=1,Y=g.length;X<Y;X++)if(v=g[X]-g[X-1],1===X)S=v;else if(Math.abs(v-S)>1e-6){O=!1;break}this._findRatio=O?oK:Ts}return t1.prototype.sample=function(g){return this._findRatio(this.ratios,g)},t1}());X.RatioSampler=UK;var UJ=g("a7",function(){function t1(g,v){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=v,this._values=g.values;var n=function(g){return"string"==typeof g?g:Array.isArray(g)?g[0]===g[1]&&g[2]===g[3]?t1.Linear:t1.Bezier(g):t1.Linear};if(void 0!==g.easingMethod)this.type=n(g.easingMethod);else if(Array.isArray(g.easingMethods))this.types=g.easingMethods.map(n);else if(void 0!==g.easingMethods){this.types=new Array(this._values.length).fill(null);for(var S=0,O=Object.keys(g.easingMethods);S<O.length;S++){var X=O[S];this.types[X]=n(g.easingMethods[X])}}else this.type=null;var Y=g.values[0];(void 0===g.interpolate||g.interpolate)&&(this._lerp=U5(Y)),void 0!==g._arrayLength&&(this._array=new Array(g._arrayLength))}t1.Bezier=function(g){return g};var g=t1.prototype;return g.hasLerp=function(){return!!this._lerp},g.valueAt=function(g){if(void 0===this._array){var v=this._values[g];return v&&v.getNoLerp?v.getNoLerp():v}for(var S=0;S<this._array.length;++S)this._array[S]=this._values[this._array.length*g+S];return this._array},g.valueBetween=function(g,v,S,O,X){if(this._lerp){var Y=this.types?this.types[v]:this.type,te=X-S,ti=(g-S)/te;if(Y&&(ti=aK(ti,Y)),void 0===this._array){var tr=this._values[v],ta=this._values[O];return this._lerp(tr,ta,ti,te*this._duration)}for(var th=0;th<this._array.length;++th){var tu=this._values[this._array.length*v+th],tl=this._values[this._array.length*O+th];this._array[th]=this._lerp(tu,tl,ti,te*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(v);for(var tc=0;tc<this._array.length;++tc)this._array[tc]=this._values[this._array.length*v+tc];return this._array},g.empty=function(){return 0===this._values.length},g.constant=function(){return 1===this._values.length},t1}());function sK(g,v,S){var O=v.sample(S);if(O<0){if((O=~O)<=0)O=0;else{if(!(O>=v.ratios.length))return g.valueBetween(S,O-1,v.ratios[O-1],O,v.ratios[O]);O=v.ratios.length-1}}return g.valueAt(O)}function aK(g,v){if("string"==typeof v){var S=r2[v];S?g=S(g):J(3906,v)}else Array.isArray(v)&&(g=Rh(v,g));return g}function oK(g,v){var S=g.length-1;if(0===S)return 0;var O=g[0];if(v<O)return 0;var X=g[S];if(v>X)return S;var Y=(v=(v-O)/(X-O))/(1/S),te=0|Y,ti=1e-6;return Y-te<ti?te:te+1-Y<ti?te+1:~(te+1)}UJ.Linear=null,X.AnimCurve=UJ,g("a8",function(){function t1(){this.events=[]}return t1.prototype.add=function(g,v){this.events.push({func:g||"",params:v||[]})},t1}()),X.sampleAnimationCurve=sK;var UZ,UQ,U0,U1,U2,U3,U5=function(){function t1(g,v,S,O){return g.lerp(v,S,O)}return function(g){if(null!==g){if("number"==typeof g)return vi;if("object"==(void 0===g?"undefined":_type_of(g))&&g.constructor){if(_instanceof(g,eW))return v=new eW,function(g,S,O){return eW.slerp(v,g,S,O)};if(_instanceof(g,tq))return function(g){var v=new g;return function(S,O,X){return g.lerp(v,S,O,X),v}}(g.constructor);if(g.constructor===Number)return vi;if("function"==typeof g.lerp)return t1}var v}}}(),U4=Symbol("BakeNodeCurves"),U8=function(){function t1(){}return t1.getOrExtract=function(g){var v=t1.pool.get(g);if(!v||v.samples!==g.sample){v&&X.director.root.dataPoolManager.releaseAnimationClip(g);var S=Math.ceil(g.sample*g.duration)+1,O=g.sample;v=g[U4](0,O,S),t1.pool.set(g,v)}return v},t1.destroy=function(g){t1.pool.delete(g)},t1}();U8.pool=new Map;var U6=nJ("cc.animation.UntypedTrackChannel")((UQ=function(g){function e(){var v;return(v=g.call(this,new ss)||this).property=U0&&U0(),v}return s(e,g),e}(VN),U0=ws(UQ.prototype,"property",[n2],function(){return""}),UZ=UQ))||UZ,U7=nJ("cc.animation.UntypedTrack")((U2=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._channels=U3&&U3(),v}s(e,g);var v=e.prototype;return v.channels=function(){return this._channels},v[GV]=function(){throw new Error("UntypedTrack should be handled specially. Please file an issue.")},v.createLegacyEval=function(g){var v=this,i=function(g){var S;return null===(S=v._channels.find(function(v){return v.property===g}))||void 0===S?void 0:S.curve};switch(!0){default:throw new Error(tt(3931));case _instanceof(g,e8):return new UF(i("x"),i("y"));case _instanceof(g,eL):return new UN(i("x"),i("y"),i("z"));case _instanceof(g,e7):return new Uk(i("x"),i("y"),i("z"),i("w"));case _instanceof(g,is):return new Uz(i("r"),i("g"),i("b"),i("a"));case _instanceof(g,iu):return new Uq(i("width"),i("height"))}},v.addChannel=function(g){var v=new U6;return v.property=g,this._channels.push(v),v},v.upgrade=function(g){var v=this,i=function(g,S){var O=v.channels().find(function(v){return v.property===g});O&&(S.name=O.name,S.curve.assignSorted(Array.from(O.curve.times()),Array.from(O.curve.values())))},S=g(this.path,this.proxy);switch(S){default:break;case"vec2":case"vec3":case"vec4":var O=new UL;O.path=this.path,O.proxy=this.proxy,O.componentsCount="vec2"===S?2:"vec3"===S?3:4;var X=O.channels(),Y=X[0],te=X[1],ti=X[2],tr=X[3];switch(S){case"vec4":i("w",tr);case"vec3":i("z",ti);default:case"vec2":i("x",Y),i("y",te)}return O;case"color":var ta=new UH,th=ta.channels(),tu=th[0],tl=th[1],tc=th[2],t_=th[3];return i("r",tu),i("g",tl),i("b",tc),i("a",t_),i("x",tu),i("y",tl),i("z",tc),i("w",t_),ta;case"size":}return null},e}(VF),U3=ws(U2.prototype,"_channels",[n2],function(){return[]}),U1=U2))||U1,U9=function(){function t1(g){this._keys=[],this._curves=[],this._commonTargets=[],this._ratioSamplers=[],this._runtimeCurves=void 0,this._data=null,this._duration=void 0,this._duration=g}var g=t1.prototype;return g.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},g.toTracks=function(){for(var g,v=[],S=this.keys,O=this.curves,X=this.commonTargets,_$s=function(g,v,S){for(var O,X=new VO,Y=f(v);!(O=Y()).done;){var te=O.value;"string"==typeof te?X.toProperty(te):"number"==typeof te?X.toElement(te):_instanceof(te,Vb)?X.toHierarchy(te.path):_instanceof(te,VR)?X.toComponent(te.component):X.toCustomized(te)}g.path=X,g.proxy=S},Y=X.map(function(g){var S=new U7;return _$s(S,g.modifiers,g.valueAdapter),v.push(S),S}),o=function(){var O,X=g.value,te=X.data,ti=te.values;if(0===ti.length)return 0;var tr=te.keys<0?[0]:S[te.keys],ta=ti[0],th=null===(O=te.interpolate)||void 0===O||O;te._arrayLength;var tu,tl=new Hi(te,tr.length),d=function(g){_$s(g,X.modifiers,X.valueAdapter)};if("number"==typeof X.commonTarget){if(!ti.every(function(g){return"number"==typeof g}))return q(3932),0;if(X.valueAdapter||1!==X.modifiers.length||"string"!=typeof X.modifiers[0])return q(3933),0;var tc=X.modifiers[0],t_=Y[X.commonTarget].addChannel(tc).curve;tu=t_}!function(){if("number"==typeof ta){if(!ti.every(function(g){return"number"==typeof g}))return void q(3934);var g;if(tu)g=tu;else{var S=new UC;d(S),v.push(S),g=S.channel.curve}var O=th?nz.LINEAR:nz.CONSTANT;return g.assignSorted(tr,ti.map(function(g){return{value:g,interpolationMode:O}})),void tl.convert(g)}if("object"==(void 0===ta?"undefined":_type_of(ta)))switch(!0){default:break;case SK(ti,e8):case SK(ti,eL):case SK(ti,e7):var X=_instanceof(ta,e8)?2:_instanceof(ta,eL)?3:4,Y=new UL;d(Y),Y.componentsCount=X;var te=Y.channels(),tc=te[0].curve,t_=te[1].curve,tf=te[2].curve,tp=te[3].curve,tm=th?nz.LINEAR:nz.CONSTANT,y=function(g){return{value:g,interpolationMode:tm}};switch(X){case 4:tp.assignSorted(tr,ti.map(function(g){return y(g.w)})),tl.convert(tp);case 3:tf.assignSorted(tr,ti.map(function(g){return y(g.z)})),tl.convert(tf);default:tc.assignSorted(tr,ti.map(function(g){return y(g.x)})),tl.convert(tc),t_.assignSorted(tr,ti.map(function(g){return y(g.y)})),tl.convert(t_)}return void v.push(Y);case SK(ti,eW):var tg=new UG;d(tg);var tv=th?sP.SLERP:sP.CONSTANT;return tg.channel.curve.assignSorted(tr,ti.map(function(g){return{value:eW.clone(g),interpolationMode:tv}})),tl.convertQuatCurve(tg.channel.curve),void v.push(tg);case SK(ti,is):var ty=new UH;d(ty);var tS=ty.channels(),tA=tS[0].curve,tT=tS[1].curve,tE=tS[2].curve,tC=tS[3].curve,tx=th?nz.LINEAR:nz.CONSTANT,I=function(g){return{value:g,interpolationMode:tx}};return tA.assignSorted(tr,ti.map(function(g){return I(g.r)})),tl.convert(tA),tT.assignSorted(tr,ti.map(function(g){return I(g.g)})),tl.convert(tT),tE.assignSorted(tr,ti.map(function(g){return I(g.b)})),tl.convert(tE),tC.assignSorted(tr,ti.map(function(g){return I(g.a)})),tl.convert(tC),void v.push(ty);case SK(ti,iu):var tb=new Uj;d(tb);var tw=tb.channels(),tI=tw[0].curve,tB=tw[1].curve,tP=th?nz.LINEAR:nz.CONSTANT,L=function(g){return{value:g,interpolationMode:tP}};return tI.assignSorted(tr,ti.map(function(g){return L(g.width)})),tl.convert(tI),tB.assignSorted(tr,ti.map(function(g){return L(g.height)})),tl.convert(tB),void v.push(tb);case SK(ti,UE):tl.nil;var tD=new UC;d(tD);var tM=th?nz.CUBIC:nz.CONSTANT;return tD.channel.curve.assignSorted(tr,ti.map(function(g){return{value:g.dataPoint,leftTangent:g.inTangent,rightTangent:g.outTangent,interpolationMode:tM}})),void v.push(tD);case SK(ti,Up):case SK(ti,US):case SK(ti,UA):tl.nil;var tO=_instanceof(ta,Up)?2:_instanceof(ta,US)?3:4,tk=new UL;d(tk),tk.componentsCount=tO;var tG=tk.channels(),tV=tG[0],tU=tG[1],tH=tG[2],tz=tG[3],tW=th?nz.LINEAR:nz.CONSTANT,_$j=function(g,v,S){return{value:g,leftTangent:v,rightTangent:S,interpolationMode:tW}};switch(tO){case 4:tz.curve.assignSorted(tr,ti.map(function(g){return _$j(g.dataPoint.w,g.inTangent.w,g.outTangent.w)}));case 3:tH.curve.assignSorted(tr,ti.map(function(g){return _$j(g.dataPoint.z,g.inTangent.z,g.outTangent.z)}));default:tV.curve.assignSorted(tr,ti.map(function(g){return _$j(g.dataPoint.y,g.inTangent.y,g.outTangent.y)})),tU.curve.assignSorted(tr,ti.map(function(g){return _$j(g.dataPoint.x,g.inTangent.x,g.outTangent.x)}))}return void v.push(tk);case ti.every(function(g){return _instanceof(g,UT)}):q(3935)}var tj=new UY;d(tj),tj.channel.curve.assignSorted(tr,ti),v.push(tj)}()},te=f(O);!(g=te()).done;)o();return v},g._createPropertyCurves=function(){var g=this;this._ratioSamplers=this._keys.map(function(v){return new UK(v.map(function(v){return v/g._duration}))}),this._runtimeCurves=this._curves.map(function(v){return{curve:new UJ(v.data,g._duration),modifiers:v.modifiers,valueAdapter:v.valueAdapter,sampler:g._ratioSamplers[v.data.keys],commonTarget:v.commonTarget}})},n(t1,[{key:"keys",get:function(){return this._keys},set:function(g){this._keys=g}},{key:"curves",get:function(){return this._curves},set:function(g){this._curves=g,delete this._runtimeCurves}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(g){this._commonTargets=g}},{key:"data",get:function(){return this._data}}]),t1}();function SK(g,v){return g.every(function(g){return _instanceof(g,v)})}var Hi=function(){function t1(g,v){this._easingMethods=void 0;var S=g.easingMethods;Array.isArray(S)?0===S.length&&0!==v?this._easingMethods=new Array(v).fill(null):this._easingMethods=S:this._easingMethods=void 0===S?new Array(v).fill(g.easingMethod):Array.from({length:v},function(g,v){var O;return null!==(O=S[v])&&void 0!==O?O:null})}var g=t1.prototype;return g.convert=function(g){var v,S,O,X,Y,te,ti,tr,ta,th,tu,tl,tc,t_,tf,tp,tm,tg,tv,ty,tS,tA,tT=this._easingMethods;if(tT){var tE=g.keyFramesCount;if(!(g.keyFramesCount<2)){Array.isArray(tT)&&tT.length;for(var tC=tE-1,tx=0;tx<tC;++tx){var tb=tT[tx];tb&&(Array.isArray(tb)?(v=tb,S=g.getKeyframeTime(tx),O=g.getKeyframeValue(tx),X=g.getKeyframeTime(tx+1),Y=g.getKeyframeValue(tx+1),te=void 0,ti=void 0,tr=void 0,ta=void 0,th=void 0,tu=void 0,tl=void 0,tc=void 0,t_=void 0,tf=void 0,tp=void 0,tm=void 0,tg=void 0,tv=void 0,ty=void 0,tS=void 0,tA=void 0,ti=v[0],tr=v[1],ta=v[2],th=v[3],tu=O.value,tl=3*(X-S),tc=3*(Y.value-tu),tp=(1-ta)*tl,tm=(1-th)*tc,tg=1/3,tv=(tf=tr*tc)/(t_=ti*tl),ty=Math.sqrt(t_*t_+tf*tf)*tg,tS=tm/tp,tA=Math.sqrt(tp*tp+tm*tm)*tg,O.interpolationMode=nz.CUBIC,O.tangentWeightMode=(te=O.tangentWeightMode)===nj.NONE?nj.RIGHT:te===nj.LEFT?nj.BOTH:te,O.rightTangent=tv,O.rightTangentWeight=ty,Y.tangentWeightMode=function(g){return g===nj.NONE?nj.LEFT:g===nj.RIGHT?nj.BOTH:g}(Y.tangentWeightMode),Y.leftTangent=tS,Y.leftTangentWeight=tA):TK(tb,g,tx))}}}},g.convertQuatCurve=function(g){var v=this._easingMethods;if(v){var S=g.keyFramesCount;if(!(g.keyFramesCount<2)){Array.isArray(v)&&v.length;for(var O=S-1,X=0;X<O;++X){var Y=v[X];Y&&(Array.isArray(Y)?g.getKeyframeValue(X).easingMethod=Y.slice():EK(Y,g,X))}}}},n(t1,[{key:"nil",get:function(){return!this._easingMethods||this._easingMethods.every(function(g){return null==g})}}]),t1}();function TK(g,v,S){v.keyFramesCount;var O=v.getKeyframeValue(S),X=HO[g];X===r1.CONSTANT?O.interpolationMode=nz.CONSTANT:(O.interpolationMode=nz.LINEAR,O.easingMethod=X)}function EK(g,v,S){v.keyFramesCount;var O=v.getKeyframeValue(S),X=HO[g];O.easingMethod=X}var Hn,Ho,Hh,Hl,Hc,H_,Hf,Hd,Hp,Hg,Hy,HS,HA,HT,HE,HC,Hx,Hb,HR,Hw,HI,HP,HD,HM,HO={constant:r1.CONSTANT,linear:r1.LINEAR,quadIn:r1.QUAD_IN,quadOut:r1.QUAD_OUT,quadInOut:r1.QUAD_IN_OUT,quadOutIn:r1.QUAD_OUT_IN,cubicIn:r1.CUBIC_IN,cubicOut:r1.CUBIC_OUT,cubicInOut:r1.CUBIC_IN_OUT,cubicOutIn:r1.CUBIC_OUT_IN,quartIn:r1.QUART_IN,quartOut:r1.QUART_OUT,quartInOut:r1.QUART_IN_OUT,quartOutIn:r1.QUART_OUT_IN,quintIn:r1.QUINT_IN,quintOut:r1.QUINT_OUT,quintInOut:r1.QUINT_IN_OUT,quintOutIn:r1.QUINT_OUT_IN,sineIn:r1.SINE_IN,sineOut:r1.SINE_OUT,sineInOut:r1.SINE_IN_OUT,sineOutIn:r1.SINE_OUT_IN,expoIn:r1.EXPO_IN,expoOut:r1.EXPO_OUT,expoInOut:r1.EXPO_IN_OUT,expoOutIn:r1.EXPO_OUT_IN,circIn:r1.CIRC_IN,circOut:r1.CIRC_OUT,circInOut:r1.CIRC_IN_OUT,circOutIn:r1.CIRC_OUT_IN,elasticIn:r1.ELASTIC_IN,elasticOut:r1.ELASTIC_OUT,elasticInOut:r1.ELASTIC_IN_OUT,elasticOutIn:r1.ELASTIC_OUT_IN,backIn:r1.BACK_IN,backOut:r1.BACK_OUT,backInOut:r1.BACK_IN_OUT,backOutIn:r1.BACK_OUT_IN,bounceIn:r1.BOUNCE_IN,bounceOut:r1.BOUNCE_OUT,bounceInOut:r1.BOUNCE_IN_OUT,bounceOutIn:r1.BOUNCE_OUT_IN,smooth:r1.SMOOTH,fade:r1.FADE};var HL=nJ,HF=n2;function QK(){throw new Error("split() only valid in Editor.")}HL("cc.animation.ExoticAnimation")((Hn=function(){function t1(){this._nodeAnimations=Ho&&Ho()}var g=t1.prototype;return g.createEvaluator=function(g){return new Hz(this._nodeAnimations,g)},g.createEvaluatorForAnimationGraph=function(g){return new Hq(this._nodeAnimations,g)},g.addNodeAnimation=function(g){var v=new HN(g);return this._nodeAnimations.push(v),v},g.collectAnimatedJoints=function(){return Array.from(new Set(this._nodeAnimations.map(function(g){return g.path})))},g.split=function(){return QK()},g.toHashString=function(){return this._nodeAnimations.map(function(g){return g.toHashString()}).join("\n")},t1}(),Ho=ws(Hn.prototype,"_nodeAnimations",[HF],function(){return[]}),Hn));var HN=HL("cc.animation.ExoticNodeAnimation")((Hl=function(){function t1(g){this._path=Hc&&Hc(),this._position=H_&&H_(),this._rotation=Hf&&Hf(),this._scale=Hd&&Hd(),this._path=g}var g=t1.prototype;return g.createPosition=function(g,v){this._position=new HU(g,new HG(v))},g.createRotation=function(g,v){this._rotation=new HU(g,new HV(v))},g.createScale=function(g,v){this._scale=new HU(g,new HG(v))},g.createEvaluator=function(g){return new HX(this._path,this._position,this._rotation,this._scale,g)},g.createEvaluatorForAnimationGraph=function(g){var v=g.bindTransform(this._path);return v?new HY(v,this._position,this._rotation,this._scale):null},g.split=function(){return QK()},g.toHashString=function(){var g,v,S,O,X,Y;return this._path+"\n"+(null!==(g=null===(v=this._position)||void 0===v?void 0:v.toHashString())&&void 0!==g?g:"")+(null!==(S=null===(O=this._scale)||void 0===O?void 0:O.toHashString())&&void 0!==S?S:"")+(null!==(X=null===(Y=this._rotation)||void 0===Y?void 0:Y.toHashString())&&void 0!==X?X:"")},n(t1,[{key:"path",get:function(){return this._path}}]),t1}(),Hc=ws(Hl.prototype,"_path",[HF],function(){return""}),H_=ws(Hl.prototype,"_position",[HF],function(){return null}),Hf=ws(Hl.prototype,"_rotation",[HF],function(){return null}),Hd=ws(Hl.prototype,"_scale",[HF],function(){return null}),Hh=Hl))||Hh;function $K(g){return g.toPrecision(2)}function tJ(g){return g.map(function(g){return Number.parseFloat($K(g))}).join(" ")}var Hk=HL("cc.animation.ExoticVectorLikeTrackValues")((Hg=function(){function t1(g){this._values=Hy&&Hy(),this._isQuantized=HS&&HS(),this._values=g}var g=t1.prototype;return g.quantize=function(g){this._isQuantized,this._values=function(g,v){var S=HK[v],O=1<<S.BYTES_PER_ELEMENT,X=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;g.forEach(function(g){X=Math.min(g,X),Y=Math.max(g,Y)});var te=Y-X,ti=S.from(g,function(g){return(g-X)/te*O});return new H2(fJ(g),ti,te,X)}(this._values,g),this._isQuantized=!0},g.toHashString=function(){var g=this._isQuantized,v=this._values;return g+" "+(g?v.toHashString():tJ(v))},n(t1,[{key:"precision",get:function(){return this._isQuantized?this._values.originalPrecision:fJ(this._values)}}]),t1}(),Hy=ws(Hg.prototype,"_values",[HF],null),HS=ws(Hg.prototype,"_isQuantized",[HF],function(){return!1}),Hp=Hg))||Hp,HG=HL("cc.animation.ExoticVec3TrackValues")(HA=function(g){function e(){return g.apply(this,arguments)||this}s(e,g),e.imitate=function(g,v){var S=new e(g);return v._isQuantized&&S.quantize(v._values.quantizationType),S};var v=e.prototype;return v.get=function(g,v){var S=this._values;this._isQuantized?AJ(S,g,v):eL.fromArray(v,S,3*g)},v.lerp=function(g,v,S,O,X,Y){var te=this._values;this._isQuantized?(AJ(te,g,O),AJ(te,v,X)):(eL.fromArray(O,te,3*g),eL.fromArray(X,te,3*v)),eL.lerp(Y,O,X,S)},e}(Hk))||HA,HV=HL("cc.animation.ExoticQuatTrackValues")(HT=function(g){function e(){return g.apply(this,arguments)||this}s(e,g),e.imitate=function(g,v){var S=new e(g);return v._isQuantized&&S.quantize(v._values.quantizationType),S};var v=e.prototype;return v.get=function(g,v){var S=this._values;this._isQuantized?TJ(S,g,v):eW.fromArray(v,S,4*g)},v.lerp=function(g,v,S,O,X,Y){var te=this._values;this._isQuantized?(TJ(te,g,O),TJ(te,v,X)):(eW.fromArray(O,te,4*g),eW.fromArray(X,te,4*v)),eW.slerp(Y,O,X,S)},e}(Hk))||HT,HU=HL("cc.animation.ExoticTrack")((HC=function(){function t1(g,v){this.times=Hx&&Hx(),this.values=Hb&&Hb(),this.times=g,this.values=v}return t1.prototype.toHashString=function(){var g=this.times,v=this.values;return"times: "+tJ(g)+"; values: "+v.toHashString()},t1}(),Hx=ws(HC.prototype,"times",[HF],null),Hb=ws(HC.prototype,"values",[HF],null),HE=HC))||HE;function sJ(g,v){g.length,g.length;var S=0,O=0,X=Ts(g,v);if(X>=0)S=X;else{var Y=~X,te=Y-1;S=te;var ti=g[Y],tr=g[te];O=(v-tr)/(ti-tr)}return{index:S,ratio:O}}!function(){function t1(){this._reset()}var g=t1.prototype;g.calculate=function(g,v,S){if(this._reset(),!(v>S)){var O=g.length;if(O){var X=g[0],Y=g[O-1],te=0,ti=0;if(v<X);else if(v>=Y)te=O-1,ti=0;else{var tr=sJ(g,v);te=tr.index,ti=tr.ratio}var ta=0,th=0;if(S<X);else if(S>=Y)ta=O-1,th=0;else{var tu=sJ(g,S);ta=tu.index,th=tu.ratio}var tl=!ti,tc=!th;te!==ta||ti!==th?(tl||(this.preLerpIndex=te,this.preLerpRatio=ti),this.directKeyframesBegin=tl?te:te+1,this.directKeyframesEnd=ta+1,tc||(this.postLerpIndex=ta,this.postLerpRatio=th)):tl?(this.directKeyframesBegin=te,this.directKeyframesEnd=te+1):(this.preLerpIndex=te,this.preLerpRatio=ti)}}},g._reset=function(){this.preLerpIndex=-1,this.preLerpRatio=0,this.directKeyframesBegin=0,this.directKeyframesEnd=0,this.postLerpIndex=-1,this.postLerpRatio=0},n(t1,[{key:"keyframesCount",get:function(){var g=this.preLerpIndex,v=this.directKeyframesBegin;return 0+(g<0?0:1)+(this.directKeyframesEnd-v)+(this.postLerpIndex<0?0:1)}}])}();var HH,Hz=function(){function t1(g,v){this._nodeEvaluations=void 0,this._nodeEvaluations=g.map(function(g){return g.createEvaluator(v)})}return t1.prototype.evaluate=function(g){this._nodeEvaluations.forEach(function(v){v.evaluate(g)})},t1}(),HX=function(){function t1(g,v,S,O,X){this._position=null,this._rotation=null,this._scale=null,v&&(this._position=SJ(v.times,v.values,eL,g,"position",X)),S&&(this._rotation=SJ(S.times,S.values,eW,g,"rotation",X)),O&&(this._scale=SJ(O.times,O.values,eL,g,"scale",X))}return t1.prototype.evaluate=function(g){if(this._position){var v=this._position.evaluator.evaluate(g);this._position.runtimeBinding.setValue(v)}if(this._rotation){var S=this._rotation.evaluator.evaluate(g);this._rotation.runtimeBinding.setValue(S)}if(this._scale){var O=this._scale.evaluator.evaluate(g);this._scale.runtimeBinding.setValue(O)}},t1}(),Hj=function(){function t1(g,v,S){this._times=void 0,this._inputSampleResultCache={just:!1,index:-1,nextIndex:-1,ratio:0},this._values=void 0,this._prevValue=void 0,this._nextValue=void 0,this._resultValue=void 0,this._times=g,this._values=v,this._prevValue=new S,this._nextValue=new S,this._resultValue=new S}return t1.prototype.evaluate=function(g){var v=this._times,S=this._values,O=this._resultValue;if(0===v.length)return O;var X=function(g,v,S){var O=g.length,X=g[0],Y=g[O-1];if(v<X)S.just=!0,S.index=0;else if(v>Y)S.just=!0,S.index=O-1;else{var te=Ts(g,v);if(te>=0)S.just=!0,S.index=te;else{var ti=~te,tr=ti-1,ta=g[tr],th=g[ti],tu=(v-g[tr])/(th-ta);S.just=!1,S.index=tr,S.nextIndex=ti,S.ratio=tu}}return S}(v,g,this._inputSampleResultCache);return X.just?S.get(X.index,O):S.lerp(X.index,X.nextIndex,X.ratio,this._prevValue,this._nextValue,O),O},t1}(),Hq=function(){function t1(g,v){this._nodeEvaluations=void 0,this._nodeEvaluations=g.map(function(g){return g.createEvaluatorForAnimationGraph(v)}).filter(function(g){return!!g})}var g=t1.prototype;return g.destroy=function(){for(var g=this._nodeEvaluations,v=g.length,S=0;S<v;++S)g[S].destroy()},g.evaluate=function(g,v){for(var S=this._nodeEvaluations,O=S.length,X=0;X<O;++X)S[X].evaluate(g,v)},t1}(),HY=function(){function t1(g,v,S,O){this._position=null,this._rotation=null,this._scale=null,this._transformHandle=void 0,this._transformHandle=g,v&&(this._position=new Hj(v.times,v.values,eL)),S&&(this._rotation=new Hj(S.times,S.values,eW)),O&&(this._scale=new Hj(O.times,O.values,eL))}var g=t1.prototype;return g.destroy=function(){this._transformHandle.destroy()},g.evaluate=function(g,v){var S=this._transformHandle.index,O=this._position,X=this._rotation,Y=this._scale,te=v.transforms;if(O){var ti=O.evaluate(g);te.setPosition(S,ti)}if(X){var tr=X.evaluate(g);te.setRotation(S,tr)}if(Y){var ta=Y.evaluate(g);te.setScale(S,ta)}},t1}(),HK={uint8:Uint8Array,uint16:Uint16Array};function fJ(g){switch(g.BYTES_PER_ELEMENT){default:case 4:return HH.FLOAT_32;case 8:return HH.FLOAT_64}}!function(g){g[g.FLOAT_32=0]="FLOAT_32",g[g.FLOAT_64=1]="FLOAT_64"}(HH||(HH={}));var HJ,HQ,H0,H1,H2=HL("cc.animation.QuantizedFloatArray")((Hw=function(){function t1(g,v,S,O){void 0===O&&(O=0),this.originalPrecision=HI&&HI(),this.min=HP&&HP(),this.extent=HD&&HD(),this.values=HM&&HM(),this.originalPrecision=g,this.values=v,this.extent=S,this.min=O}return t1.prototype.toHashString=function(){var g=this.originalPrecision,v=this.min,S=this.extent,O=this.values;return g+" "+$K(v)+" "+$K(S)+" "+O.join(" ")},n(t1,[{key:"quantizationType",get:function(){switch(this.values.BYTES_PER_ELEMENT){default:case 1:return"uint8";case 2:return"uint16"}}}]),t1}(),HI=ws(Hw.prototype,"originalPrecision",[HF],null),HP=ws(Hw.prototype,"min",[HF],null),HD=ws(Hw.prototype,"extent",[HF],null),HM=ws(Hw.prototype,"values",[HF],null),HR=Hw))||HR;function yJ(g,v){return g.values[v]/(1<<g.values.BYTES_PER_ELEMENT)*g.extent+g.min}function SJ(g,v,S,O,X,Y){var te=new VL;te.path=(new VO).toHierarchy(O).toProperty(X);var ti=Y(te);return ti?{runtimeBinding:ti,evaluator:new Hj(g,v,S)}:null}function AJ(g,v,S){eL.set(S,yJ(g,3*v+0),yJ(g,3*v+1),yJ(g,3*v+2))}function TJ(g,v,S){eW.set(S,yJ(g,4*v+0),yJ(g,4*v+1),yJ(g,4*v+2),yJ(g,4*v+3))}var H3,H5,H4,H8,H6,H7,H9,zi,zn,zo,zh,zu,zl,zc,z_,zf,zd,zp,zm,zg=nJ("cc.animation.AuxiliaryCurveEntry")((HQ=function(){this.name=H0&&H0(),this.curve=H1&&H1()},H0=ws(HQ.prototype,"name",[n2],function(){return""}),H1=ws(HQ.prototype,"curve",[n2],function(){return new ss}),HJ=HQ))||HJ;function zJ(g,v,S){for(var O=g.components,X=O.length,Y=0;Y<X;++Y){var te=O[Y],ti=te[v];"function"==typeof ti&&ti.apply(te,S)}}var zy=Symbol("SearchForRootBonePath"),zS=Symbol("ExoticAnimation"),zA=Symbol("[[EmbeddedPlayerCount]]"),zT=Symbol("[[GetEmbeddedPlayers]]"),zE=Symbol("[[AddEmbeddedPlayer]]"),zC=Symbol("[[RemoveEmbeddedPlayer]]"),zx=Symbol("[[ClearEmbeddedPlayers]]"),zb=Symbol("[[Additive Settings]]"),zR=g("a3",nJ("cc.AnimationClip")(((z_=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).sample=H4&&H4(),v.speed=H8&&H8(),v.wrapMode=H6&&H6(),v.enableTrsBlending=H7&&H7(),v._duration=H9&&H9(),v._hash=zi&&zi(),v.frameRate=0,v._tracks=zn&&zn(),v._exoticAnimation=zo&&zo(),v._legacyData=void 0,v._legacyDataDirty=!1,v._events=zh&&zh(),v._embeddedPlayers=zu&&zu(),v._additiveSettings=zl&&zl(),v._auxiliaryCurveEntries=zc&&zc(),v._runtimeEvents={ratios:[],eventGroups:[]},v}s(e,g),e.createWithSpriteFrames=function(g,v){var S=new e;S.sample=v||S.sample,S.duration=g.length/S.sample;var O=1/S.sample,X=new UY;return X.path=(new VO).toComponent("cc.Sprite").toProperty("spriteFrame"),X.channels()[0].curve.assignSorted(g.map(function(g,v){return[O*v,g]})),S.addTrack(X),S};var v=e.prototype;return v.onLoaded=function(){this.frameRate=this.sample,this.events=this._events},v.range=function(){for(var g={min:1/0,max:-1/0},v=this._tracks,S=v.length,O=0;O<S;++O){var X=v[O].range();g.min=Math.min(g.min,X.min),g.max=Math.max(g.max,X.max)}return g},v.getTrack=function(g){return this._tracks[g]},v.addTrack=function(g){var v=this._tracks.length;return this._tracks.push(g),v},v.removeTrack=function(g){this._tracks.splice(g,1)},v.clearTracks=function(){this._tracks.length=0},v.containsAnyEvent=function(){return 0!==this._events.length},v.createEventEvaluator=function(g){return new zN(g,this._runtimeEvents.ratios,this._runtimeEvents.eventGroups,this.wrapMode)},v.containsAnyEmbeddedPlayer=function(){return 0!==this._embeddedPlayers.length},v.createEmbeddedPlayerEvaluator=function(g){return new zP(this._embeddedPlayers,g)},v.createEvaluator=function(g){var v=this,S=g.target;return this._createEvalWithBinder(S,function(O){if(!g.mask||!O.isMaskedOff(g.mask)){var X=O.createRuntimeBinding(S,v.enableTrsBlending?g.pose:void 0,!1);return null!=X?X:void 0}},g.rootMotion)},v.destroy=function(){var v;return null!==(v=X.director.root)&&void 0!==v&&v.dataPoolManager&&X.director.root.dataPoolManager.releaseAnimationClip(this),U8.destroy(this),g.prototype.destroy.call(this)},v[U4]=function(g,v,S){for(var O=1/v,X=this._collectAnimatedJoints(),Y=X.length,te={},ti=0;ti<Y;++ti)te[X[ti]]={transforms:Array.from({length:S},function(){return new e$})};var tr=X.reduce(function(g,v){return g[v]=new zO,g},{});for(var ta in tr){var th=tr[ta],tu=ta.lastIndexOf("/");if(tu>=0){var tl=ta.substring(0,tu),tc=tr[tl];tc&&(th.parent=tc)}}for(var t_=this._createEvalWithBinder(void 0,function(g){var v=g.parseTrsPath();if(v){var S=tr[v.node];if(S)return hQ(S,v.property)}},void 0),tf=0;tf<S;++tf){var tp=g+O*tf;t_.evaluate(tp);for(var tm=0;tm<Y;++tm){var tg=X[tm];e$.copy(te[tg].transforms[tf],tr[tg].globalTransform)}for(var tv=0;tv<Y;++tv){var ty=X[tv];tr[ty].invalidate()}}return{samples:v,frames:S,joints:te}},v.upgradeUntypedTracks=function(g){for(var v=[],S=[],O=this._tracks,X=O.length,Y=0;Y<X;++Y){var te=O[Y];if(_instanceof(te,U7)){var ti=te.upgrade(g);ti&&(v.push(ti),S.push(te))}}for(var tr=S.length,ta=0;ta<tr;++ta)Jt(O,S[ta]);O.push.apply(O,v)},v[zy]=function(){return this._searchForRootBonePath()},v.getPropertyCurves=function(){return this._getLegacyData().getPropertyCurves()},v.updateEventDatas=function(){this.events=this._events},v.hasEvents=function(){return 0!==this.events.length},v.syncLegacyData=function(){this._legacyData&&(this._fromLegacy(this._legacyData),this._legacyData=void 0)},v[zT]=function(){return this._embeddedPlayers},v[zE]=function(g){this._embeddedPlayers.push(g)},v[zC]=function(g){var v=this._embeddedPlayers.indexOf(g);v>=0&&this._embeddedPlayers.splice(v,1)},v[zx]=function(){this._embeddedPlayers.length=0},v.getAuxiliaryCurveNames_experimental=function(){return this._auxiliaryCurveEntries.map(function(g){return g.name})},v.hasAuxiliaryCurve_experimental=function(g){return!!this._findAuxiliaryCurveEntry(g)},v.addAuxiliaryCurve_experimental=function(g){var v=this._findAuxiliaryCurveEntry(g);return v||((v=new zg).name=g,this._auxiliaryCurveEntries.push(v)),v.curve},v.getAuxiliaryCurve_experimental=function(g){return this._findAuxiliaryCurveEntry(g).curve},v.renameAuxiliaryCurve_experimental=function(g,v){var S=this._findAuxiliaryCurveEntry(g);S&&(S.name=v)},v.removeAuxiliaryCurve_experimental=function(g){Zt(this._auxiliaryCurveEntries,function(v){return v.name===g})},v._trySyncLegacyData=function(){this._legacyDataDirty&&(this._legacyDataDirty=!1,this.syncLegacyData())},v._createEvalWithBinder=function(g,v,S){this._legacyDataDirty&&(this._legacyDataDirty=!1,this.syncLegacyData());var O,X=[];S&&(O=this._createRootMotionEvaluation(g,S,X));for(var Y,te=[],ti=this._tracks,tr=ti.length,ta=0;ta<tr;++ta){var th=ti[ta];if(!X.includes(th)&&!Array.from(th.channels()).every(function(g){return 0===g.curve.keyFramesCount})){var tu=v(th[VD]);if(tu){var tl=void 0;if(_instanceof(th,U7)){if(!tu.getValue){J(3930);continue}var tc=tu.getValue();tl=th.createLegacyEval(tc)}else tl=th[GV]();te.push(new zI(tu,tl))}}}return this._exoticAnimation&&(Y=this._exoticAnimation.createEvaluator(v)),new zD(te,Y,O)},v._createRootMotionEvaluation=function(g,v,S){if(_instanceof(g,mJ)){var O=this._searchForRootBonePath();if(O){var X=g.getChildByPath(O);if(X){for(var Y=new zM,te=[],ti=this._tracks,tr=ti.length,ta=0;ta<tr;++ta){var th=ti[ta],tu=th[VD].parseTrsPath();if(tu&&tu.node===O){S.push(th);var tl=hQ(Y,tu.property);if(tl){var tc=th[GV]();te.push(new zI(tl,tc))}}}return new zF(X,this._duration,Y,te)}q(3924)}else q(3923)}else J(3920)},v._searchForRootBonePath=function(){var g=this._tracks.map(function(g){var v=g[VD].parseTrsPath();if(v){var S=v.node;return{path:S,rank:S.split("/").length}}return{path:"",rank:0}});g.sort(function(g,v){return g.rank-v.rank});var v=g.findIndex(function(g){return 0!==g.rank});if(v<0)return"";for(var S=g.length,O=g[v],X=!0,Y=v+1;Y<S;++Y){var te=g[Y];if(te.rank!==O.rank)break;if(te.path!==O.path){X=!1;break}}return X?O.path:""},v._getLegacyData=function(){return this._legacyData||(this._legacyData=this._toLegacy()),this._legacyData},v._toLegacy=function(){var g=new U9(this._duration);return g.keys=[],g.curves=[],g.commonTargets=[],g},v._fromLegacy=function(g){for(var v=g.toTracks(),S=v.length,O=0;O<S;++O)this.addTrack(v[O])},v._collectAnimatedJoints=function(){for(var g=new Set,v=this._tracks,S=v.length,O=0;O<S;++O){var X=v[O][VD].parseTrsPath();X&&g.add(X.node)}if(this._exoticAnimation)for(var Y=this._exoticAnimation.collectAnimatedJoints(),te=Y.length,ti=0;ti<te;++ti)g.add(Y[ti]);return Array.from(g)},v._findAuxiliaryCurveEntry=function(g){return this._auxiliaryCurveEntries.find(function(v){return v.name===g})},n(e,[{key:"duration",get:function(){return this._duration},set:function(g){this._duration=g}},{key:"tracksCount",get:function(){return this._tracks.length}},{key:"tracks",get:function(){return this._tracks}},{key:"hash",get:function(){var g,v;if(this._hash)return this._hash;var S="Exotic:"+(null!==(g=null===(v=this._exoticAnimation)||void 0===v?void 0:v.toHashString())&&void 0!==g?g:"");return this._hash=Sl(S,666)}},{key:"events",get:function(){return this._events},set:function(g){var v=this;this._events=g;for(var S=[],O=[],X=this.events.sort(function(g,v){return g.frame-v.frame}),Y=X.length,a=function(){var g=X[te],Y=g.frame/v._duration,ti=S.findIndex(function(g){return g===Y});ti<0&&(ti=S.length,S.push(Y),O.push({events:[]})),O[ti].events.push({functionName:g.func,parameters:g.params})},te=0;te<Y;++te)a();this._runtimeEvents={ratios:S,eventGroups:O}}},{key:zS,get:function(){return this._exoticAnimation}},{key:zS,set:function(g){this._exoticAnimation=g}},{key:"isAdditive_experimental",get:function(){return this._additiveSettings.enabled}},{key:zb,get:function(){return this._additiveSettings}},{key:"keys",get:function(){return this._getLegacyData().keys}},{key:"keys",set:function(g){this._legacyDataDirty=!0,this._getLegacyData().keys=g}},{key:"curves",get:function(){return this._legacyDataDirty=!0,this._getLegacyData().curves}},{key:"curves",set:function(g){this._getLegacyData().curves=g}},{key:"commonTargets",get:function(){return this._getLegacyData().commonTargets}},{key:"commonTargets",set:function(g){this._legacyDataDirty=!0,this._getLegacyData().commonTargets=g}},{key:"data",get:function(){return this._getLegacyData().data}},{key:"eventGroups",get:function(){return this._runtimeEvents.eventGroups}},{key:zA,get:function(){return this._embeddedPlayers.length}},{key:"auxiliaryCurveCount_experimental",get:function(){return this._auxiliaryCurveEntries.length}}]),e}(lx)).WrapMode=GU,H4=ws((H5=z_).prototype,"sample",[n2],function(){return 60}),H8=ws(H5.prototype,"speed",[n2],function(){return 1}),H6=ws(H5.prototype,"wrapMode",[n2],function(){return GU.Normal}),H7=ws(H5.prototype,"enableTrsBlending",[n2],function(){return!1}),H9=ws(H5.prototype,"_duration",[n2],function(){return 0}),zi=ws(H5.prototype,"_hash",[n2],function(){return 0}),zn=ws(H5.prototype,"_tracks",[n2],function(){return[]}),zo=ws(H5.prototype,"_exoticAnimation",[n2],function(){return null}),zh=ws(H5.prototype,"_events",[n2],function(){return[]}),zu=ws(H5.prototype,"_embeddedPlayers",[n2],function(){return[]}),zl=ws(H5.prototype,"_additiveSettings",[n2],function(){return new zw}),zc=ws(H5.prototype,"_auxiliaryCurveEntries",[n2],function(){return[]}),H3=H5))||H3),zw=nJ("cc.AnimationClipAdditiveSettings")((zd=function(){this.enabled=zp&&zp(),this.refClip=zm&&zm()},zp=ws(zd.prototype,"enabled",[n2],function(){return!1}),zm=ws(zd.prototype,"refClip",[n2],function(){return null}),zf=zd))||zf;X.AnimationClip=zR;var zI=function(){function t1(g,v){this._binding=void 0,this._trackEval=void 0,this._shouldEvaluateDefault=!0,this._binding=g,this._trackEval=v,this._shouldEvaluateDefault=!!g.getValue&&v.requiresDefault}return t1.prototype.evaluate=function(g){var v=this._binding,S=this._trackEval,O=this._shouldEvaluateDefault?v.getValue():void 0,X=S.evaluate(g,O);v.setValue(X)},t1}(),zP=function(){function t1(g,v){this._embeddedPlayers=g,this._embeddedPlayerEvaluationInfos=g.map(function(g){var S=g.playable;if(!S)return null;var O=S.instantiate(v);return O?{instantiatedPlayer:O,entered:!1,hostPauseTime:0,lastIterations:0}:null})}var g=t1.prototype;return g.destroy=function(){for(var g=this._embeddedPlayerEvaluationInfos,v=g.length,S=0;S<v;++S){var O;null===(O=g[S])||void 0===O||O.instantiatedPlayer.destroy()}this._embeddedPlayerEvaluationInfos.length=0},g.evaluate=function(g,v){for(var S=this._embeddedPlayers,O=this._embeddedPlayerEvaluationInfos,X=S.length,Y=0;Y<X;++Y){var te=O[Y];if(te){var ti=te.entered,tr=te.instantiatedPlayer,ta=te.lastIterations,th=S[Y],tu=th.begin,tl=th.end;if(g>=tu&&g<=tl?ti?v!==ta&&(tr.stop(),tr.play(),te.entered=!0):(tr.play(),te.entered=!0):ti&&(tr.stop(),te.entered=!1),te.lastIterations=v,te.entered){var tc=g-tu;te.instantiatedPlayer.setTime(tc)}}}},g.notifyHostSpeedChanged=function(g){for(var v=this._embeddedPlayers,S=this._embeddedPlayerEvaluationInfos,O=v.length,X=0;X<O;++X){var Y=S[X];if(Y){var te=Y.instantiatedPlayer;v[X].reconciledSpeed&&te.setSpeed(g)}}},g.notifyHostPlay=function(g){for(var v=this._embeddedPlayers,S=this._embeddedPlayerEvaluationInfos,O=v.length,X=0;X<O;++X){var Y=S[X];if(Y){var te=v[X],ti=te.begin,tr=te.end,ta=Y.instantiatedPlayer;if(Y.entered){var th=Y.hostPauseTime;if(ta.randomAccess||pi(th,g,1e-5)){var tu=mi(g,ti,tr);ta.play(),ta.setTime(tu-ti)}else ta.stop()}}}},g.notifyHostPause=function(g){for(var v=this._embeddedPlayers,S=this._embeddedPlayerEvaluationInfos,O=v.length,X=0;X<O;++X){var Y=S[X];if(Y){var te=Y.instantiatedPlayer;Y.entered&&(te.pause(),Y.hostPauseTime=g)}}},g.notifyHostStop=function(){for(var g=this._embeddedPlayers,v=this._embeddedPlayerEvaluationInfos,S=g.length,O=0;O<S;++O){var X=v[O];if(X){var Y=X.instantiatedPlayer;X.entered&&(X.entered=!1,Y.stop())}}},t1}(),zD=function(){function t1(g,v,S){this._exoticAnimationEvaluator=void 0,this._trackEvalStatues=[],this._rootMotionEvaluation=void 0,this._trackEvalStatues=g,this._exoticAnimationEvaluator=v,this._rootMotionEvaluation=S}var g=t1.prototype;return g.evaluate=function(g){for(var v=this._trackEvalStatues,S=this._exoticAnimationEvaluator,O=v.length,X=0;X<O;++X)v[X].evaluate(g);S&&S.evaluate(g)},g.evaluateRootMotion=function(g,v){var S=this._rootMotionEvaluation;S&&S.evaluate(g,v)},t1}(),zM=function(){function t1(){this.position=new eL,this.scale=new eL(1,1,1),this.rotation=new eW,this.eulerAngles=new eL}return t1.prototype.getTransform=function(g){e$.fromRTS(g,this.rotation,this.position,this.scale)},t1}(),zO=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).parent=null,v._dirty=!0,v._transform=new e$,v}return s(e,g),e.prototype.invalidate=function(){this._dirty=!0},n(e,[{key:"globalTransform",get:function(){var g=this._transform;return this._dirty&&(this._dirty=!1,e$.fromRTS(g,this.rotation,this.position,this.scale),this.parent&&e$.multiply(g,this.parent.globalTransform,g)),this._transform}}]),e}(zM),zL=new e$,zF=function(){function t1(g,v,S,O){this._initialTransformCache=new e$,this._clipEndTransformCache=new e$,this._startTransformCache=new e$,this._endTransformCache=new e$,this._motionTransformCache=new e$,this._translationMotionCache=new eL,this._rotationMotionCache=new eW,this._scaleMotionCache=new eL,this._rootBone=g,this._duration=v,this._boneTransform=S,this._trackEvalStatuses=O}var g=t1.prototype;return g.evaluate=function(g,v){var S=this._calcMotionTransform(g,v,this._motionTransformCache),O=this._translationMotionCache,X=this._rotationMotionCache,Y=this._scaleMotionCache,te=this._rootBone;e$.toRTS(S,X,O,Y),eL.add(O,O,te.position),te.setPosition(O),eW.multiply(X,X,te.rotation),te.setRotation(X),eL.multiply(Y,Y,te.scale),te.setScale(Y)},g._calcMotionTransform=function(g,v,S){var O=this._duration,X=O-g,Y=this._evaluateAt(g,this._startTransformCache);if(v<X){var te=this._evaluateAt(g+v,this._endTransformCache);oQ(S,Y,te)}else{e$.identity(S);var o=function(g,v){oQ(zL,g,v),e$.multiply(S,S,zL)},ti=v-X,tr=Math.floor(ti/O),ta=ti-tr*O,th=this._evaluateAt(0,this._initialTransformCache),tu=this._evaluateAt(O,this._clipEndTransformCache),tl=this._evaluateAt(ta,this._endTransformCache);o(Y,tu),oQ(zL,th,tu);for(var tc=0;tc<tr;++tc)e$.multiply(S,S,zL);o(th,tl)}return S},g._evaluateAt=function(g,v){for(var S=this._trackEvalStatuses,O=S.length,X=0;X<O;++X)S[X].evaluate(g);return this._boneTransform.getTransform(v),v},t1}();function oQ(g,v,S){e$.invert(g,v),e$.multiply(g,S,g)}function hQ(g,v){switch(v){default:return;case"position":return{setValue:function(v){eL.copy(g.position,v)}};case"rotation":return{setValue:function(v){eW.copy(g.rotation,v)}};case"scale":return{setValue:function(v){eL.copy(g.scale,v)}};case"eulerAngles":return{setValue:function(v){eL.copy(g.eulerAngles,v)}}}}var zN=function(){function t1(g,v,S,O){this._lastFrameIndex=-1,this._lastIterations=0,this._lastDirection=0,this._ignoreIndex=-1,this._sampled=!1,this._targetNode=g,this._ratios=v,this._eventGroups=S,this._wrapMode=O}var g=t1.prototype;return g.setWrapMode=function(g){this._wrapMode=g},g.ignore=function(g,v){this._ignoreIndex=-1,this._sampled=!1;var S=cQ(g,this._ratios);S<0&&(S=~S-1,v<0&&(S+=1),this._ignoreIndex=S)},g.reset=function(){this._lastFrameIndex=-1,this._lastIterations=0,this._lastDirection=0,this._ignoreIndex=-1,this._sampled=!1},g.sample=function(g,v,S){if(0!==this._eventGroups.length){var O=this._eventGroups.length,X=cQ(g,this._ratios);if(X<0&&(X=~X-1,v<0&&(X+=1)),this._ignoreIndex!==X&&(this._ignoreIndex=-1),!this._sampled)return this._sampled=!0,this._doFire(X,!1),this._lastFrameIndex=X,this._lastIterations=S,void(this._lastDirection=v);var Y=this._wrapMode,te=lQ(S),ti=lQ(this._lastIterations),tr=this._lastFrameIndex,ta=this._lastDirection,th=-1!==ti&&te!==ti;if(tr===X&&th&&1===O)this._doFire(0,!1);else if(tr!==X||th){v=ta;do{if(tr!==X){if(-1===v&&0===tr&&X>0?((Y&s4.PingPong)===s4.PingPong?v*=-1:tr=O,ti++):1===v&&tr===O-1&&X<O-1&&((Y&s4.PingPong)===s4.PingPong?v*=-1:tr=-1,ti++),tr===X)break;if(ti>te)break}tr+=v,this._doFire(tr,!0)}while(tr!==X&&tr>-1&&tr<O)}this._lastFrameIndex=X,this._lastIterations=S,this._lastDirection=v}},g._doFire=function(g,v){v?aY().pushDelayEvent(this._checkAndFire,this,[g]):this._checkAndFire(g)},g._checkAndFire=function(g){if(this._targetNode&&this._targetNode.isValid){var v=this._eventGroups;if(!(g<0||g>=v.length||this._ignoreIndex===g))for(var S=v[g],O=S.events.length,X=0;X<O;++X){var Y=S.events[X];zJ(this._targetNode,Y.functionName,Y.parameters)}}},t1}();function lQ(g){return g-(0|g)==0&&(g-=1),0|g}function cQ(g,v){return Ts(v,g)}var zk,zG=function(){function t1(){this._nodeBlendStates=new Map}var g=t1.prototype;return g.createWriter=function(g,v,S,O){var X=this.ref(g,v);return new zV(g,v,X,S,O)},g.destroyWriter=function(g){var v=g;this.deRef(v.node,v.property)},g.ref=function(g,v){var S=this._nodeBlendStates.get(g);return S||(S=this.createNodeBlendState(),this._nodeBlendStates.set(g,S)),S.refProperty(g,v)},g.deRef=function(g,v){var S=this._nodeBlendStates.get(g);S&&(S.deRefProperty(v),S.empty&&this._nodeBlendStates.delete(g))},g.apply=function(){this._nodeBlendStates.forEach(function(g,v){g.apply(v)})},t1}(),zV=function(){function t1(g,v,S,O,X){this._node=g,this._property=v,this._propertyBlendState=S,this._host=O,this._constants=X}var g=t1.prototype;return g.getValue=function(){return this._node[this._property]},g.setValue=function(g){var v=this._propertyBlendState,S=this._host.weight;v.blend(g,S)},n(t1,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t1}();!function(g){g[g.POSITION=1]="POSITION",g[g.ROTATION=2]="ROTATION",g[g.SCALE=4]="SCALE",g[g.EULER_ANGLES=8]="EULER_ANGLES"}(zk||(zk={})),zk.POSITION,zk.ROTATION,zk.SCALE,zk.EULER_ANGLES;var zU,zH,zz=function(){function t1(){this.refCount=0,this.accumulatedWeight=0,this.result=new eL}var g=t1.prototype;return g.blend=function(g,v){this.accumulatedWeight=function(g,v,S,O,X){var Y=S+X;if(1!==X||S){if(Y){var te=X/Y;eL.lerp(g,g,O,te)}}else eL.copy(g,O);return Y}(this.result,this.result,this.accumulatedWeight,g,v)},g.reset=function(){this.accumulatedWeight=0,eL.zero(this.result)},t1}(),zX=function(){function t1(){this.refCount=0,this.accumulatedWeight=0,this.result=new eW}var g=t1.prototype;return g.blend=function(g,v){this.accumulatedWeight=function(g,v,S,O,X){var Y=S+X;if(1!==X||S){if(Y){var te=X/Y;eW.slerp(g,v,O,te)}}else eW.copy(g,O);return Y}(this.result,this.result,this.accumulatedWeight,g,v)},g.reset=function(){this.accumulatedWeight=0,eW.identity(this.result)},t1}(),zj=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.apply=function(v){var S=this._properties,O=S.position,X=S.scale,Y=S.rotation,te=S.eulerAngles;O&&O.accumulatedWeight&&(this._transformApplyFlags|=zk.POSITION,O.accumulatedWeight<1&&O.blend(v.position,1-O.accumulatedWeight)),X&&X.accumulatedWeight&&(this._transformApplyFlags|=zk.SCALE,X.accumulatedWeight<1&&X.blend(v.scale,1-X.accumulatedWeight)),te&&te.accumulatedWeight&&(this._transformApplyFlags|=zk.EULER_ANGLES,te.accumulatedWeight<1&&te.blend(v.eulerAngles,1-te.accumulatedWeight)),Y&&Y.accumulatedWeight&&(this._transformApplyFlags|=zk.ROTATION,Y.accumulatedWeight<1&&Y.blend(v.rotation,1-Y.accumulatedWeight)),g.prototype.apply.call(this,v),null==O||O.reset(),null==X||X.reset(),null==Y||Y.reset(),null==te||te.reset()},v._createVec3BlendState=function(){return new zz},v._createQuatBlendState=function(){return new zX},e}(function(){function t1(){this._transformApplyFlags=0,this._properties={}}var g=t1.prototype;return g.refProperty=function(g,v){var S,O,X,Y=this._properties;switch(v){default:case"position":case"scale":case"eulerAngles":X=null!==(S=Y[v])&&void 0!==S?S:Y[v]=this._createVec3BlendState(g[v]);break;case"rotation":X=null!==(O=Y[v])&&void 0!==O?O:Y[v]=this._createQuatBlendState(g.rotation)}return++X.refCount,X},g.deRefProperty=function(g){var v=this._properties,S=v[g];S&&(--S.refCount,S.refCount>0||delete v[g])},g.apply=function(g){var v,S,O,X=this._transformApplyFlags,Y=this._properties,te=Y.position,ti=Y.scale,tr=Y.rotation,ta=Y.eulerAngles;X&&(te&&X&zk.POSITION&&(v=te.result),ti&&X&zk.SCALE&&(S=ti.result),ta&&X&zk.EULER_ANGLES&&(O=ta.result),tr&&X&zk.ROTATION&&(O=tr.result),(O||v||S)&&g.setRTS(O,v,S),this._transformApplyFlags=0)},n(t1,[{key:"empty",get:function(){var g=this._properties;return!(g.position||g.rotation||g.eulerAngles||g.scale)}}]),t1}()),zq=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.createNodeBlendState=function(){return new zj},e}(zG),zY=[],zK=new Map;function EQ(g,v){for(var S=0,O=e$.IDENTITY;g;){if(g.stamp===v||g.stamp+1===v&&!g.node.hasChangedFlags){O=g.world,g.stamp=v;break}g.stamp=v,zY[S++]=g,g=g.parent}for(;S>0;){g=zY[--S],zY[S]=null;var X=g.node;e$.fromRTS(g.local,X.rotation,X.position,X.scale),O=e$.multiply(g.world,O,g.local)}return O}function CQ(g){for(var v=zK.get(g.uuid)||null;v;)zK.delete(v.node.uuid),v=v.parent}var zQ=g("ab",nJ(((zH=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._anims=new tH([]),v._crossFades=new tH([]),v._delayEvents=[],v._blendStateBuffer=new zq,v._sockets=[],v}s(e,g);var v=e.prototype;return v.addCrossFade=function(g){-1===this._crossFades.array.indexOf(g)&&this._crossFades.push(g)},v.removeCrossFade=function(g){var v=this._crossFades.array.indexOf(g);v>=0?this._crossFades.fastRemoveAt(v):J(3907)},v.update=function(g){var v=this._delayEvents,S=this._crossFades,O=this._sockets,X=S.array;for(S.i=0;S.i<X.length;++S.i)X[S.i].update(g);var Y=this._anims,te=Y.array;for(Y.i=0;Y.i<te.length;++Y.i){var ti=te[Y.i];ti.isMotionless||ti.update(g)}this._blendStateBuffer.apply();for(var tr=II.getTotalFrames(),ta=0,th=O.length;ta<th;ta++){var tu=O[ta],tl=tu.target,tc=tu.transform;tl.matrix=EQ(tc,tr)}for(var t_=0,tf=v.length;t_<tf;t_++){var tp=v[t_];tp.fn.apply(tp.thisArg,tp.args)}v.length=0},v.destruct=function(){},v.addAnimation=function(g){-1===this._anims.array.indexOf(g)&&this._anims.push(g)},v.removeAnimation=function(g){var v=this._anims.array.indexOf(g);v>=0?this._anims.fastRemoveAt(v):J(3907)},v.pushDelayEvent=function(g,v,S){this._delayEvents.push({fn:g,thisArg:v,args:S})},v.addSockets=function(g,v){for(var S=this,_$n=function(){var X=v[O];if(S._sockets.find(function(g){return g.target===X.target}))return 1;var Y=g.getChildByPath(X.path),te=X.target&&Y&&function(g,v){for(var S,O=null,X=0;g!==v;){var Y=g.uuid;if(zK.has(Y)){O=zK.get(Y);break}O={node:g,local:new e$,world:new e$,stamp:-1,parent:null},zK.set(Y,O),zY[X++]=O,g=g.parent,O=null}for(;X>0;)S=zY[--X],zY[X]=null,S.parent=O,O=S;return O}(Y,g);te&&S._sockets.push({target:X.target,transform:te})},O=0;O<v.length;++O)_$n()},v.removeSockets=function(g,v){for(var S=0;S<v.length;++S)for(var O=v[S],X=0;X<this._sockets.length;++X){var Y=this._sockets[X];if(Y.target===O.target){CQ(Y.transform.node),this._sockets[X]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},n(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(a8)).ID="animation",zU=zH))||zU);II.on(Iw.EVENT_INIT,function(){var g=new zQ;II.registerSystem(zQ.ID,g,a8.Priority.HIGH)}),X.AnimationManager=zQ;var z0,z1,z2,z3,z5,z4,z8,z6,z9,Wi,Wh,Wu=function(g){function e(v){var S;return(S=g.call(this)||this)._managedStates=[],S._fadings=[],S._scheduled=!1,S._scheduler=null!=v?v:aY(),S}s(e,g);var v=e.prototype;return v.update=function(g){if(!this.isMotionless){var v=this._managedStates,S=this._fadings;if(1===v.length&&1===S.length){var O=v[0].state;O&&(O.weight=1)}else this._calculateWeights(g);1===v.length&&1===S.length&&this._unscheduleThis()}},v.crossFade=function(g,v){var S;0===this._managedStates.length&&(v=0),0===v&&this.clear();var O=this._managedStates.find(function(v){return v.state===g});O?null!==(S=O.state)&&void 0!==S&&S.isMotionless&&O.state.play():(O={state:g,reference:0},g&&g.play(),this._managedStates.push(O)),++O.reference,this._fadings.unshift({easeDuration:v,easeTime:0,target:O}),this.isMotionless||this._scheduleThis()},v.clear=function(){for(var g=0;g<this._managedStates.length;++g){var v=this._managedStates[g].state;v&&v.stop()}this._managedStates.length=0,this._fadings.length=0},v.onPlay=function(){g.prototype.onPlay.call(this),this._scheduleThis()},v.onPause=function(){g.prototype.onPause.call(this);for(var v=0;v<this._managedStates.length;++v){var S=this._managedStates[v].state;S&&S.pause()}this._unscheduleThis()},v.onResume=function(){g.prototype.onResume.call(this);for(var v=0;v<this._managedStates.length;++v){var S=this._managedStates[v].state;S&&S.resume()}this._scheduleThis()},v.onStop=function(){g.prototype.onStop.call(this),this.clear()},v._calculateWeights=function(g){for(var v=this._managedStates,S=this._fadings,O=0;O<v.length;++O){var X=v[O].state;X&&(X.weight=0)}for(var Y=1,te=S.length,ti=0;ti<S.length;++ti){var tr=S[ti];tr.easeTime+=g;var ta=0===tr.easeDuration?1:gi(tr.easeTime/tr.easeDuration),th=ta*Y;if(Y*=1-ta,tr.target.state&&(tr.target.state.weight+=th),tr.easeTime>=tr.easeDuration){te=ti+1,tr.easeTime=tr.easeDuration;break}}if(te!==S.length){for(var tu=te;tu<S.length;++tu){var tl=S[tu];--tl.target.reference,tl.target.reference<=0&&(tl.target.state&&tl.target.state.stop(),Jt(this._managedStates,tl.target))}S.splice(te)}},v._scheduleThis=function(){this._scheduled||(this._scheduler.addCrossFade(this),this._scheduled=!0)},v._unscheduleThis=function(){this._scheduled&&(this._scheduler.removeCrossFade(this),this._scheduled=!1)},e}(Gz),Wl=g("a5",(z0=nJ("cc.Animation"),z1=nQ(99),z2=ma([zR]),z3=ma(zR),z5=ma([zR]),z0(z4=z1(((Wh=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).playOnLoad=z6&&z6(),v._crossFade=new Wu,v._nameToState=gt(!0),v._clips=z9&&z9(),v._defaultClip=Wi&&Wi(),v._hasBeenPlayed=!1,v}s(e,g);var v=e.prototype;return v.onLoad=function(){for(var g in this.clips=this._clips,this._nameToState)this._nameToState[g].initialize(this.node)},v.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},v.onEnable=function(){this._crossFade.resume()},v.onDisable=function(){this._crossFade.pause()},v.onDestroy=function(){for(var g in this._crossFade.stop(),this._nameToState)this._nameToState[g].destroy();this._nameToState=gt(!0)},v.play=function(g){if(this._hasBeenPlayed=!0,!g){if(!this._defaultClip)return;g=this._defaultClip.name}this.crossFade(g,0)},v.crossFade=function(g,v){void 0===v&&(v=.3),this._hasBeenPlayed=!0;var S=this._nameToState[g];S&&this.doPlayOrCrossFade(S,v)},v.pause=function(){this._crossFade.pause()},v.resume=function(){this._crossFade.resume()},v.stop=function(){this._crossFade.stop()},v.getState=function(g){var v=this._nameToState[g];return v&&!v.curveLoaded&&v.initialize(this.node),v||null},v.createState=function(g,v){return v=v||g.name,this.removeState(v),this._doCreateState(g,v)},v.removeState=function(g){var v=this._nameToState[g];v&&(v.allowLastFrameEvent(!1),v.stop(),delete this._nameToState[g])},v.addClip=function(g,v){return $t(this._clips,g)||this._clips.push(g),this.createState(g,v)},v.removeClip=function(g,v){var S;for(var O in this._nameToState){var X=this._nameToState[O];if(X.clip===g){S=X;break}}if(g===this._defaultClip){if(!v)return void q(3902);this._defaultClip=null}if(S&&S.isPlaying){if(!v)return void q(3903);S.stop()}this._clips=this._clips.filter(function(v){return v!==g}),S&&delete this._nameToState[S.name]},v.on=function(v,S,O,X){var Y=g.prototype.on.call(this,v,S,O,X);return v===GX.LASTFRAME&&this._syncAllowLastFrameEvent(),Y},v.once=function(v,S,O){var X=g.prototype.once.call(this,v,S,O);return v===GX.LASTFRAME&&this._syncAllowLastFrameEvent(),X},v.off=function(v,S,O){g.prototype.off.call(this,v,S,O),v===GX.LASTFRAME&&this._syncDisallowLastFrameEvent()},v._createState=function(g,v){return new GZ(g,v)},v._doCreateState=function(g,v){var S=this._createState(g,v);return S._setEventTarget(this),S.allowLastFrameEvent(this.hasEventListener(GX.LASTFRAME)),this.node&&S.initialize(this.node),this._nameToState[S.name]=S,S},v.doPlayOrCrossFade=function(g,v){this._crossFade.play(),this._crossFade.crossFade(g,v)},v._removeStateOfAutomaticClip=function(g){for(var v in this._nameToState){var S=this._nameToState[v];kQ(g,S.clip)&&(S.stop(),delete this._nameToState[v])}},v._syncAllowLastFrameEvent=function(){if(this.hasEventListener(GX.LASTFRAME))for(var g in this._nameToState)this._nameToState[g].allowLastFrameEvent(!0)},v._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(GX.LASTFRAME))for(var g in this._nameToState)this._nameToState[g].allowLastFrameEvent(!1)},n(e,[{key:"clips",get:function(){return this._clips},set:function(g){var v=this;this._crossFade&&this._crossFade.clear();for(var S,O=f(this._clips);!(S=O()).done;){var X=S.value;X&&this._removeStateOfAutomaticClip(X)}for(var Y,te=f(g);!(Y=te()).done;){var ti=Y.value;ti&&this.createState(ti)}var tr=g.find(function(g){return kQ(g,v._defaultClip)});this._defaultClip=tr||null,this._clips=g}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(g){this._defaultClip=g,g&&(this._clips.findIndex(function(v){return kQ(v,g)})>=0||(this._clips.push(g),this.createState(g)))}}]),e}(Su(cS))).EventType=GX,p((z8=Wh).prototype,"clips",[z2],Object.getOwnPropertyDescriptor(z8.prototype,"clips"),z8.prototype),p(z8.prototype,"defaultClip",[z3],Object.getOwnPropertyDescriptor(z8.prototype,"defaultClip"),z8.prototype),z6=ws(z8.prototype,"playOnLoad",[n2],function(){return!1}),z9=ws(z8.prototype,"_clips",[z5],function(){return[]}),Wi=ws(z8.prototype,"_defaultClip",[n2],function(){return null}),z4=z8))||z4)||z4));function kQ(g,v){return g===v||!!g&&!!v&&g._uuid===v._uuid&&g._uuid}X.Animation=Wl,X.AnimationComponent=Wl,kt(Wl,"cc.AnimationComponent");var Wc,W_,Wf,Wd=new e$;!function(g){g.PLAYED="play",g.PAUSED="pause",g.STOPPED="stop",g.SEEKED="seeked",g.ENDED="ended",g.INTERRUPTION_BEGIN="interruptionBegin",g.INTERRUPTION_END="interruptionEnd",g.USER_GESTURE="on_gesture"}(Wc||(Wc={})),function(g){g[g.DOM_AUDIO=0]="DOM_AUDIO",g[g.WEB_AUDIO=1]="WEB_AUDIO",g[g.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",g[g.NATIVE_AUDIO=3]="NATIVE_AUDIO",g[g.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(W_||(W_={})),function(g){g[g.INIT=0]="INIT",g[g.PLAYING=1]="PLAYING",g[g.PAUSED=2]="PAUSED",g[g.STOPPED=3]="STOPPED",g[g.INTERRUPTED=4]="INTERRUPTED"}(Wf||(Wf={}));var Wp,Wg=g("ag",function(){function t1(){this._bufferView=void 0,this._normalizeFactor=1;for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];if(2===v.length)this._bufferView=v[0],this._normalizeFactor=v[1];else{var O=v[0],X=v[1],Y=v[2];this._bufferView=new X(O),this._normalizeFactor=Y}}return t1.prototype.getData=function(g){return this._bufferView[g]*this._normalizeFactor},n(t1,[{key:"length",get:function(){return this._bufferView.length}}]),t1}()),WS=0;function YQ(g,v){var S;v.invoking||(v.invoking=!0,(S=v.func).call.apply(S,[g].concat(v.args)).then(function(){v.invoking=!1,g._operationQueue.shift(),g._eventTarget.emit(v.id.toString()),function(g){for(var v=g._operationQueue.length,S=g._operationQueue.slice(),O=[],X=!1,Y=v-1;Y>=0;Y--){var te=S[Y];if("stop"===te.op){O.push(te);break}if("seek"===te.op)X||(O.push(te),X=!0);else{if(X){O.push(te);break}0===O.length&&O.push(te)}}g._operationQueue=O.reverse()}(g);var S=g._operationQueue[0];S&&YQ(g,S)}).catch(function(){}))}function qQ(g,v,S){var O=S.value;S.value=function(){for(var g=this,S=arguments.length,X=new Array(S),Y=0;Y<S;Y++)X[Y]=arguments[Y];return new Promise(function(S){var Y=WS++,te=g;te._operationQueue.push({op:v,id:Y,func:O,args:X,invoking:!1}),te._eventTarget.once(Y.toString(),S),YQ(te,te._operationQueue[0])})}}function KQ(g){return new Promise(function(v){var S=g.play();return void 0===S?v():(S.then(v).catch(function(){var i=function i(){g.play().then(function(){null==S||S.removeEventListener("touchend",i,{capture:!0}),null==S||S.removeEventListener("mouseup",i,{capture:!0})}).catch(function(){}),v()},S=document.getElementById("GameCanvas");null==S||S.addEventListener("touchend",i,{capture:!0}),null==S||S.addEventListener("mouseup",i,{capture:!0})}),null)})}var WA,WT,WE=function(){function t1(g,v){this._domAudio=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._domAudio=g,g.volume=v}var g=t1.prototype;return g.play=function(){var g=this;KQ(this._domAudio).then(function(){var v;null===(v=g.onPlay)||void 0===v||v.call(g)}).catch(function(){})},g.stop=function(){this._domAudio.pause()},n(t1,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(g){this._onPlayCb=g}},{key:"onEnd",get:function(){return this._onEndCb},set:function(g){this._onEndCb&&this._domAudio.removeEventListener("ended",this._onEndCb),this._onEndCb=g,g&&this._domAudio.addEventListener("ended",g)}}]),t1}(),WC=(p((Wp=function(){function t1(g){var v=this;this._domAudio=void 0,this._state=Wf.INIT,this._onEnded=void 0,this._eventTarget=new aC,this._operationQueue=[],this._domAudio=g,IL.on(IO.EVENT_PAUSE,this._onInterruptedBegin,this),IL.on(IO.EVENT_RESUME,this._onInterruptedEnd,this),this._onEnded=function(){v.seek(0).catch(function(){}),v._state=Wf.INIT,v._eventTarget.emit(Wc.ENDED)},this._domAudio.addEventListener("ended",this._onEnded)}var g=t1.prototype;return g.destroy=function(){IL.off(IO.EVENT_PAUSE,this._onInterruptedBegin,this),IL.off(IO.EVENT_RESUME,this._onInterruptedEnd,this),this._domAudio.removeEventListener("ended",this._onEnded),this._domAudio=null},t1.load=function(g){return new Promise(function(v,S){t1.loadNative(g).then(function(g){v(new t1(g))}).catch(S)})},t1.loadNative=function(g){return new Promise(function(v,S){var O=document.createElement("audio"),X="canplaythrough";aD.os===aw.IOS?X="loadedmetadata":aD.browserType===ax.FIREFOX&&(X="canplay");var Y=setTimeout(function(){0===O.readyState?h():o()},8e3),a=function(){clearTimeout(Y),O.removeEventListener(X,o,!1),O.removeEventListener("error",h,!1)},o=function(){a(),v(O)},h=function(){a(),S(new Error("load audio failure - "+g))};O.addEventListener(X,o,!1),O.addEventListener("error",h,!1),O.src=g})},t1.loadOneShotAudio=function(g,v){return new Promise(function(S,O){t1.loadNative(g).then(function(g){var O=new WE(g,v);S(O)}).catch(O)})},g._onInterruptedBegin=function(){var g=this;this._state===Wf.PLAYING&&this.pause().then(function(){g._state=Wf.INTERRUPTED,g._eventTarget.emit(Wc.INTERRUPTION_BEGIN)}).catch(function(){})},g._onInterruptedEnd=function(){var g=this;this._state===Wf.INTERRUPTED&&this.play().then(function(){g._eventTarget.emit(Wc.INTERRUPTION_END)}).catch(function(){})},g.getPCMData=function(){},g.seek=function(g){return g=mi(g,0,this.duration),this._domAudio.currentTime=g,Promise.resolve()},g.play=function(){var g=this;return new Promise(function(v){KQ(g._domAudio).then(function(){g._state=Wf.PLAYING,v()}).catch(function(){})})},g.pause=function(){return this._domAudio.pause(),this._state=Wf.PAUSED,Promise.resolve()},g.stop=function(){var g=this;return new Promise(function(v){g._domAudio.pause(),g._domAudio.currentTime=0,g._state=Wf.STOPPED,v()})},g.onInterruptionBegin=function(g){this._eventTarget.on(Wc.INTERRUPTION_BEGIN,g)},g.offInterruptionBegin=function(g){this._eventTarget.off(Wc.INTERRUPTION_BEGIN,g)},g.onInterruptionEnd=function(g){this._eventTarget.on(Wc.INTERRUPTION_END,g)},g.offInterruptionEnd=function(g){this._eventTarget.off(Wc.INTERRUPTION_END,g)},g.onEnded=function(g){this._eventTarget.on(Wc.ENDED,g)},g.offEnded=function(g){this._eventTarget.off(Wc.ENDED,g)},n(t1,[{key:"src",get:function(){return this._domAudio?this._domAudio.src:""}},{key:"type",get:function(){return W_.DOM_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._domAudio.loop},set:function(g){this._domAudio.loop=g}},{key:"volume",get:function(){return this._domAudio.volume},set:function(g){g=gi(g),this._domAudio.volume=g}},{key:"duration",get:function(){return this._domAudio.duration}},{key:"currentTime",get:function(){return this._domAudio.currentTime}},{key:"sampleRate",get:function(){return 0}}]),t1}()).prototype,"seek",[qQ],Object.getOwnPropertyDescriptor(Wp.prototype,"seek"),Wp.prototype),p(Wp.prototype,"play",[qQ],Object.getOwnPropertyDescriptor(Wp.prototype,"play"),Wp.prototype),p(Wp.prototype,"pause",[qQ],Object.getOwnPropertyDescriptor(Wp.prototype,"pause"),Wp.prototype),p(Wp.prototype,"stop",[qQ],Object.getOwnPropertyDescriptor(Wp.prototype,"stop"),Wp.prototype),Wp),Wx=function(){function t1(g){this._nativeAudio=void 0,this._startTime=0,this._startOffset=0,this._isPaused=!0,this._nativeAudio=g}var g=t1.prototype;return g.destroy=function(){this._nativeAudio=void 0},g._now=function(){return performance.now()/1e3},g._calculateCurrentTime=function(){var g=this._now()-this._startTime,v=this._startOffset+g;return v>=this.duration&&(this._startTime=this._now(),this._startOffset=0),v%this.duration},g.start=function(){this._isPaused=!1,this._startTime=this._now()},g.pause=function(){this._isPaused||(this._isPaused=!0,this._startOffset=this._calculateCurrentTime())},g.stop=function(){this._isPaused=!0,this._startOffset=0},g.seek=function(g){this._startTime=this._now(),this._startOffset=mi(g,0,this.duration)},n(t1,[{key:"duration",get:function(){return this._nativeAudio.duration}},{key:"currentTime",get:function(){return this._isPaused?this._startOffset:this._calculateCurrentTime()}}]),t1}(),Wb=new(function(){function t1(){this._audioBufferDataMap={}}var g=t1.prototype;return g.addCache=function(g,v){this._audioBufferDataMap[g]?console.warn("Audio buffer "+g+" has been cached"):this._audioBufferDataMap[g]={usedCount:1,audioBuffer:v}},g.retainCache=function(g){var v=this._audioBufferDataMap[g];v?v.usedCount++:console.warn("Audio buffer cache "+g+" has not been added.")},g.getCache=function(g){var v=this._audioBufferDataMap[g];return null==v?void 0:v.audioBuffer},g.tryReleasingCache=function(g){var v=this._audioBufferDataMap[g];v?--v.usedCount<=0&&delete this._audioBufferDataMap[g]:console.warn("Audio buffer cache "+g+" has not been added.")},t1}()),WR=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,Ww="on-context-running",WI=function(){function t1(){var g=this;this._eventTarget=void 0,this._context=void 0,this._isRunning=!1,this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),this._eventTarget=new aC,this._context.onstatechange=function(){"running"===g._context.state?(g._isRunning=!0,g._eventTarget.emit(Ww)):g._isRunning=!1}}var g=t1.prototype;return g.onceRunning=function(g,v){this._eventTarget.once(Ww,g,v)},g.offRunning=function(g,v){this._eventTarget.off(Ww,g,v)},g.decodeAudioData=function(g){var v=this;return new Promise(function(S,O){var X=v._context.decodeAudioData(g,function(g){S(g)},function(g){console.error("failed to load Web Audio",g)});null==X||X.catch(O)})},g.runContext=function(){var g=this;return new Promise(function(v){if(g.isRunning)v();else{var S=g._context;if(S.resume){if(S.resume().catch(function(g){G("runContext error",g)}),"running"!==S.state){var O=document.getElementById("GameCanvas"),_$r=function t1(){S.resume().then(function(){null==O||O.removeEventListener("touchend",t1,{capture:!0}),null==O||O.removeEventListener("mouseup",t1,{capture:!0}),v()}).catch(function(g){G("onGesture resume error",g)})};null==O||O.addEventListener("touchend",_$r,{capture:!0}),null==O||O.addEventListener("mouseup",_$r,{capture:!0})}else v()}else v()}})},g.createBufferSource=function(g,v){var S=this._context.createBufferSource();return void 0!==g&&(S.buffer=g),void 0!==v&&(S.loop=v),S},g.createGain=function(g){void 0===g&&(g=1);var v=this._context.createGain();return this.setGainValue(v,g),v},g.setGainValue=function(g,v){if(g.gain.setTargetAtTime)try{g.gain.setTargetAtTime(v,this._context.currentTime,0)}catch(S){g.gain.setTargetAtTime(v,this._context.currentTime,.01)}else g.gain.value=v},g.connectContext=function(g){this._context&&g.connect(this._context.destination)},n(t1,[{key:"isRunning",get:function(){return this._isRunning}},{key:"currentTime",get:function(){return this._context.currentTime}}]),t1}();WI.support=!!WR,WI.support&&(WT=new WI);var WB,WP,WD,WO,WL=function(){function t1(g,v,S){this._duration=void 0,this._bufferSourceNode=void 0,this._onPlayCb=void 0,this._currentTimer=0,this._url=void 0,this._onEndCb=void 0,this._duration=g.duration,this._url=S,this._bufferSourceNode=WT.createBufferSource(g,!1);var O=WT.createGain(v);this._bufferSourceNode.connect(O),WT.connectContext(O)}var g=t1.prototype;return g.play=function(){var g=this;this._bufferSourceNode.start(),WT.runContext().then(function(){var v;null===(v=g.onPlay)||void 0===v||v.call(g),g._currentTimer=window.setTimeout(function(){var v;Wb.tryReleasingCache(g._url),null===(v=g.onEnd)||void 0===v||v.call(g)},1e3*g._duration)}).catch(function(g){G("play error",g)})},g.stop=function(){clearTimeout(this._currentTimer),Wb.tryReleasingCache(this._url),this._bufferSourceNode.stop(),this._bufferSourceNode.disconnect(),this._bufferSourceNode.buffer=null},n(t1,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(g){this._onPlayCb=g}},{key:"onEnd",get:function(){return this._onEndCb},set:function(g){this._onEndCb=g}}]),t1}(),WF=(p((WA=function(){function t1(g,v){this._src=void 0,this._audioBuffer=void 0,this._sourceNode=void 0,this._gainNode=void 0,this._currentTimer=0,this._volume=1,this._loop=!1,this._state=Wf.INIT,this._audioTimer=void 0,this._runningCallback=void 0,this._eventTarget=new aC,this._operationQueue=[],this._audioBuffer=g,this._audioTimer=new Wx(g),this._gainNode=WT.createGain(),WT.connectContext(this._gainNode),this._src=v,IL.on(IO.EVENT_PAUSE,this._onInterruptedBegin,this),IL.on(IO.EVENT_RESUME,this._onInterruptedEnd,this)}var g=t1.prototype;return g.destroy=function(){window.clearTimeout(this._currentTimer),this._audioTimer.destroy(),this._audioBuffer&&(this._audioBuffer=null),Wb.tryReleasingCache(this._src),IL.off(IO.EVENT_PAUSE,this._onInterruptedBegin,this),IL.off(IO.EVENT_RESUME,this._onInterruptedEnd,this),this.offRunning()},t1.load=function(g){return new Promise(function(v,S){t1.loadNative(g).then(function(S){v(new t1(S,g))}).catch(S)})},t1.loadNative=function(g){return new Promise(function(v,S){var O=Wb.getCache(g);if(O)return Wb.retainCache(g),void v(O);var X=new XMLHttpRequest,Y="load audio failed: "+g+", status: ";X.open("GET",g,!0),X.responseType="arraybuffer",X.onload=function(){200===X.status||0===X.status?WT.decodeAudioData(X.response).then(function(S){Wb.addCache(g,S),v(S)}).catch(function(v){G("loadNative error",g,v)}):S(new Error(""+Y+X.status+"(no response)"))},X.onerror=function(){S(new Error(""+Y+X.status+"(error)"))},X.ontimeout=function(){S(new Error(""+Y+X.status+"(time out)"))},X.onabort=function(){S(new Error(""+Y+X.status+"(abort)"))},X.send(null)})},t1.loadOneShotAudio=function(g,v){return new Promise(function(S,O){t1.loadNative(g).then(function(O){var X=new WL(O,v,g);S(X)}).catch(O)})},g.getPCMData=function(g){return new Wg(this._audioBuffer.getChannelData(g),1)},g._onInterruptedBegin=function(){var g=this;this._state===Wf.PLAYING&&this.pause().then(function(){g._state=Wf.INTERRUPTED,g._eventTarget.emit(Wc.INTERRUPTION_BEGIN)}).catch(function(g){G("_onInterruptedBegin error",g)})},g._onInterruptedEnd=function(){var g=this;this._state===Wf.INTERRUPTED&&this.play().then(function(){g._eventTarget.emit(Wc.INTERRUPTION_END)}).catch(function(g){G("_onInterruptedEnd error",g)})},g.offRunning=function(){this._runningCallback&&(WT.offRunning(this._runningCallback),this._runningCallback=void 0)},g.seek=function(g){var v=this;return new Promise(function(S){v.offRunning(),v._audioTimer.seek(g),v._state===Wf.PLAYING?v._doPlay().then(S).catch(function(g){G("seek error",g)}):S()})},g.play=function(){return this.offRunning(),this._doPlay()},g._doPlay=function(){var g=this;return new Promise(function(v){WT.isRunning?(g._startSourceNode(),v()):(g.offRunning(),g._runningCallback=function(){g._startSourceNode(),v()},WT.onceRunning(g._runningCallback),WT.runContext().catch(function(g){G("doPlay error",g)}))})},g._startSourceNode=function(){var g=this;this._stopSourceNode(),this._sourceNode=WT.createBufferSource(this._audioBuffer,this.loop),this._sourceNode.connect(this._gainNode),this._sourceNode.loop=this._loop,this._sourceNode.start(0,this._audioTimer.currentTime),this._state=Wf.PLAYING,this._audioTimer.start(),window.clearTimeout(this._currentTimer),this._currentTimer=window.setTimeout(function e(){g.loop?g._currentTimer=window.setTimeout(e,1e3*g._audioBuffer.duration):(g._audioTimer.stop(),g._eventTarget.emit(Wc.ENDED),g._state=Wf.INIT)},1e3*(this._audioBuffer.duration-this._audioTimer.currentTime))},g._stopSourceNode=function(){try{this._sourceNode&&(this._sourceNode.stop(),this._sourceNode.disconnect(),this._sourceNode.buffer=null,this._sourceNode=void 0)}catch(g){}},g.pause=function(){return this.offRunning(),this._state===Wf.PLAYING&&this._sourceNode?(this._audioTimer.pause(),this._state=Wf.PAUSED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},g.stop=function(){return this.offRunning(),this._sourceNode?(this._audioTimer.stop(),this._state=Wf.STOPPED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):(this._audioTimer.stop(),this._state=Wf.STOPPED,Promise.resolve())},g.onInterruptionBegin=function(g){this._eventTarget.on(Wc.INTERRUPTION_BEGIN,g)},g.offInterruptionBegin=function(g){this._eventTarget.off(Wc.INTERRUPTION_BEGIN,g)},g.onInterruptionEnd=function(g){this._eventTarget.on(Wc.INTERRUPTION_END,g)},g.offInterruptionEnd=function(g){this._eventTarget.off(Wc.INTERRUPTION_END,g)},g.onEnded=function(g){this._eventTarget.on(Wc.ENDED,g)},g.offEnded=function(g){this._eventTarget.off(Wc.ENDED,g)},n(t1,[{key:"sampleRate",get:function(){return this._audioBuffer.sampleRate}},{key:"src",get:function(){return this._src}},{key:"type",get:function(){return W_.WEB_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._loop},set:function(g){this._loop=g,this._sourceNode&&(this._sourceNode.loop=g)}},{key:"volume",get:function(){return this._volume},set:function(g){g=gi(g),this._volume=g,WT.setGainValue(this._gainNode,g)}},{key:"duration",get:function(){return this._audioBuffer.duration}},{key:"currentTime",get:function(){return this._audioTimer.currentTime}}]),t1}()).prototype,"seek",[qQ],Object.getOwnPropertyDescriptor(WA.prototype,"seek"),WA.prototype),p(WA.prototype,"play",[qQ],Object.getOwnPropertyDescriptor(WA.prototype,"play"),WA.prototype),p(WA.prototype,"pause",[qQ],Object.getOwnPropertyDescriptor(WA.prototype,"pause"),WA.prototype),p(WA.prototype,"stop",[qQ],Object.getOwnPropertyDescriptor(WA.prototype,"stop"),WA.prototype),WA),WN=function(){function t1(g){this._audio=void 0,this._audio=g}var g=t1.prototype;return g.play=function(){this._audio.play()},g.stop=function(){this._audio.stop()},n(t1,[{key:"onPlay",get:function(){return this._audio.onPlay},set:function(g){this._audio.onPlay=g}},{key:"onEnd",get:function(){return this._audio.onEnd},set:function(g){this._audio.onEnd=g}}]),t1}(),Wk=function(){function t1(g){this._player=void 0,this._player=g}t1.load=function(g,v){return new Promise(function(S,O){(null==v?void 0:v.audioLoadMode)!==W_.DOM_AUDIO&&WI.support?WF.load(g).then(function(g){S(new t1(g))}).catch(O):(WI.support||q(5201),WC.load(g).then(function(g){S(new t1(g))}).catch(O))})};var g=t1.prototype;return g.destroy=function(){this._player.destroy()},t1.loadNative=function(g,v){return(null==v?void 0:v.audioLoadMode)!==W_.DOM_AUDIO&&WI.support?WF.loadNative(g):(WI.support||q(5201),WC.loadNative(g))},t1.loadOneShotAudio=function(g,v,S){return new Promise(function(O,X){(null==S?void 0:S.audioLoadMode)!==W_.DOM_AUDIO&&WI.support?WF.loadOneShotAudio(g,v).then(function(g){O(new WN(g))}).catch(X):(WI.support||q(5201),WC.loadOneShotAudio(g,v).then(function(g){O(new WN(g))}).catch(X))})},g.getPCMData=function(g){return this._player.getPCMData(g)},g.seek=function(g){return this._player.seek(g)},g.play=function(){return this._player.play()},g.pause=function(){return this._player.pause()},g.stop=function(){return this._player.stop()},g.onInterruptionBegin=function(g){this._player.onInterruptionBegin(g)},g.offInterruptionBegin=function(g){this._player.offInterruptionBegin(g)},g.onInterruptionEnd=function(g){this._player.onInterruptionEnd(g)},g.offInterruptionEnd=function(g){this._player.offInterruptionEnd(g)},g.onEnded=function(g){this._player.onEnded(g)},g.offEnded=function(g){this._player.offEnded(g)},n(t1,[{key:"src",get:function(){return this._player.src}},{key:"type",get:function(){return this._player.type}},{key:"state",get:function(){return this._player.state}},{key:"loop",get:function(){return this._player.loop},set:function(g){this._player.loop=g}},{key:"volume",get:function(){return this._player.volume},set:function(g){this._player.volume=g}},{key:"duration",get:function(){return this._player.duration}},{key:"currentTime",get:function(){return this._player.currentTime}},{key:"sampleRate",get:function(){return this._player.sampleRate}}]),t1}();Wk.maxAudioChannel=24;var WG=g("af",nJ("cc.AudioClip")(((WO=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._duration=WD&&WD(),v._loadMode=W_.UNKNOWN_AUDIO,v._meta=null,v._player=null,v}s(e,g);var v=e.prototype;return v.destroy=function(){var v,S=g.prototype.destroy.call(this);return null===(v=this._player)||void 0===v||v.destroy(),this._player=null,this._meta&&(this._meta.player=null),S},v.validate=function(){return!!this._meta},v.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},v.getCurrentTime=function(){return this._player?this._player.currentTime:0},v.getVolume=function(){return this._player?this._player.volume:0},v.getLoop=function(){return!!this._player&&this._player.loop},v.setCurrentTime=function(g){var v;null===(v=this._player)||void 0===v||v.seek(g).catch(function(){})},v.setVolume=function(g){this._player&&(this._player.volume=g)},v.setLoop=function(g){this._player&&(this._player.loop=g)},v.play=function(){var g;null===(g=this._player)||void 0===g||g.play().catch(function(){})},v.pause=function(){var g;null===(g=this._player)||void 0===g||g.pause().catch(function(){})},v.stop=function(){var g;null===(g=this._player)||void 0===g||g.stop().catch(function(){})},v.playOneShot=function(g){void 0===g&&(g=1),this._nativeAsset&&Wk.loadOneShotAudio(this._nativeAsset.url,g).then(function(g){g.play()}).catch(function(){})},n(e,[{key:"duration",set:function(g){this._duration=g}},{key:"_nativeAsset",get:function(){return this._meta},set:function(g){this._meta=g,g?(this._loadMode=g.type,this._player=g.player):(this._meta=null,this._loadMode=W_.UNKNOWN_AUDIO,this._duration=0)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.state:Wf.INIT}}]),e}(lx)).AudioType=W_,WD=ws((WP=WO).prototype,"_duration",[n2],function(){return 0}),p(WP.prototype,"_nativeDep",[rE],Object.getOwnPropertyDescriptor(WP.prototype,"_nativeDep"),WP.prototype),WB=WP))||WB);function dZ(g,v,S){Wk.load(g,{audioLoadMode:v.audioLoadMode}).then(function(v){var O={player:v,url:g,duration:v.duration,type:v.type};S(null,O)}).catch(function(g){S(g)})}function pZ(g,v,S,O){var X=new WG;X._nativeUrl=g,X._nativeAsset=v,X.duration=v.duration,O(null,X)}X.AudioClip=WG,dv.register({".mp3":dZ,".ogg":dZ,".wav":dZ,".m4a":dZ}),dC.register({".mp3":pZ,".ogg":pZ,".wav":pZ,".m4a":pZ});var WV,WU,WH,Wz,WX,Wj,Wq,WY,WK,WJ,WQ,W$,W1=new(function(){function t1(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}var g=t1.prototype;return g._findIndex=function(g,v){return g.findIndex(function(g){return g.audio===v})},g._tryAddPlaying=function(g,v){var S=this._findIndex(g,v);return S>-1?(g[S].playTime=performance.now(),!1):(g.push({audio:v,playTime:performance.now()}),!0)},g.addPlaying=function(g){_instanceof(g,Wk)?this._tryAddPlaying(this._audioPlayerInfoList,g):this._tryAddPlaying(this._oneShotAudioInfoList,g)},g._tryRemovePlaying=function(g,v){var S=this._findIndex(g,v);return -1!==S&&(Kt(g,S),!0)},g.removePlaying=function(g){_instanceof(g,Wk)?this._tryRemovePlaying(this._audioPlayerInfoList,g):this._tryRemovePlaying(this._oneShotAudioInfoList,g)},g.discardOnePlayingIfNeeded=function(){var g;this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<Wk.maxAudioChannel||(this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach(function(v){(!g||v.playTime<g.playTime)&&(g=v)}):this._audioPlayerInfoList.forEach(function(v){(!g||v.playTime<g.playTime)&&(g=v)}),g&&(g.audio.stop(),this.removePlaying(g.audio)))},g.pause=function(){this._oneShotAudioInfoList.forEach(function(g){g.audio.stop()}),this._audioPlayerInfoList.forEach(function(g){g.audio.pause().catch(function(){})})},g.resume=function(){this._audioPlayerInfoList.forEach(function(g){g.audio.play().catch(function(){})})},t1}()),W2="audiosource-loaded";!function(g){g.STARTED="started",g.ENDED="ended"}(WQ||(WQ={})),function(g){g.PLAY="play",g.STOP="stop",g.PAUSE="pause",g.SEEK="seek"}(W$||(W$={}));var W3=g("ae",(WV=nJ("cc.AudioSource"),WU=ma(WG),WH=ma(WG),WV(((WJ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._clip=Wj&&Wj(),v._player=null,v._hasRegisterListener=!1,v._loop=Wq&&Wq(),v._playOnAwake=WY&&WY(),v._volume=WK&&WK(),v._cachedCurrentTime=-1,v._operationsBeforeLoading=[],v._isLoaded=!1,v._lastSetClip=null,v}s(e,g);var v=e.prototype;return v._resetPlayer=function(){this._player&&(W1.removePlaying(this._player),this._unregisterListener(),this._player.destroy(),this._player=null)},v._syncPlayer=function(){var g=this,v=this._clip;if(this._lastSetClip!==v)return v?void(v._nativeAsset?(this._isLoaded=!1,this._lastSetClip=v,this._operationsBeforeLoading.length=0,Wk.load(v._nativeAsset.url,{audioLoadMode:v.loadMode}).then(function(S){var O;g._lastSetClip===v?(g._isLoaded=!0,g._resetPlayer(),g._player=S,g._syncStates(),null===(O=g.node)||void 0===O||O.emit(W2)):S.destroy()}).catch(function(){})):console.error("Invalid audio clip")):(this._lastSetClip=null,void this._resetPlayer())},v._registerListener=function(){var g=this;if(!this._hasRegisterListener&&this._player){var v=this._player;v.onEnded(function(){var S;W1.removePlaying(v),null===(S=g.node)||void 0===S||S.emit(WQ.ENDED,g)}),v.onInterruptionBegin(function(){W1.removePlaying(v)}),v.onInterruptionEnd(function(){g._player===v&&W1.addPlaying(v)}),this._hasRegisterListener=!0}},v._unregisterListener=function(){this._player&&this._hasRegisterListener&&(this._player.offEnded(),this._player.offInterruptionBegin(),this._player.offInterruptionEnd(),this._hasRegisterListener=!1)},v.onLoad=function(){this._syncPlayer()},v.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},v.onDisable=function(){var g=this._getRootNode();null!=g&&g._persistNode||this.pause()},v.onDestroy=function(){this.stop(),this.clip=null},v.getPCMData=function(g){var v=this;return new Promise(function(S){if(0!==g&&1!==g)return console.warn("Only support channel index 0 or 1 to get buffer"),void S(void 0);var O;v._player?S(v._player.getPCMData(g)):null===(O=v.node)||void 0===O||O.once(W2,function(){var O;S(null===(O=v._player)||void 0===O?void 0:O.getPCMData(g))})})},v.getSampleRate=function(){var g=this;return new Promise(function(v){var S;g._player?v(g._player.sampleRate):null===(S=g.node)||void 0===S||S.once(W2,function(){v(g._player.sampleRate)})})},v._getRootNode=function(){for(var g,v,S=this.node,O=null===(g=S)||void 0===g||null===(v=g.parent)||void 0===v?void 0:v.parent;O;){var X,Y,te;O=null===(Y=S=null===(X=S)||void 0===X?void 0:X.parent)||void 0===Y||null===(te=Y.parent)||void 0===te?void 0:te.parent}return S},v.play=function(){var g=this;if(this._isLoaded||!this.clip){var v;this._registerListener(),W1.discardOnePlayingIfNeeded(),this.state===Wf.PLAYING&&(null===(v=this._player)||void 0===v||v.stop().catch(function(){}));var S=this._player;S&&(S.play().then(function(){var v;null===(v=g.node)||void 0===v||v.emit(WQ.STARTED,g)}).catch(function(){W1.removePlaying(S)}),W1.addPlaying(S))}else this._operationsBeforeLoading.push({op:W$.PLAY,params:null})},v.pause=function(){var g;this._isLoaded||!this.clip?null===(g=this._player)||void 0===g||g.pause().catch(function(){}):this._operationsBeforeLoading.push({op:W$.PAUSE,params:null})},v.stop=function(){this._isLoaded||!this.clip?this._player&&(this._player.stop().catch(function(){}),W1.removePlaying(this._player)):this._operationsBeforeLoading.push({op:W$.STOP,params:null})},v.playOneShot=function(g,v){var S;void 0===v&&(v=1),g._nativeAsset?Wk.loadOneShotAudio(g._nativeAsset.url,this._volume*v,{audioLoadMode:g.loadMode}).then(function(g){S=g,W1.discardOnePlayingIfNeeded(),g.onEnd=function(){W1.removePlaying(g)},g.play(),W1.addPlaying(g)}).catch(function(){S&&W1.removePlaying(S)}):console.error("Invalid audio clip")},v._syncStates=function(){var g=this;this._player&&(this._player.loop=this._loop,this._player.volume=this._volume,this._operationsBeforeLoading.forEach(function(v){var S;v.op===W$.SEEK?(g._cachedCurrentTime=v.params&&v.params[0],g._player&&g._player.seek(g._cachedCurrentTime).catch(function(){})):null===(S=g[v.op])||void 0===S||S.call(g)}),this._operationsBeforeLoading.length=0)},n(e,[{key:"clip",get:function(){return this._clip},set:function(g){g!==this._clip&&(this._clip=g,this._syncPlayer())}},{key:"loop",get:function(){return this._loop},set:function(g){this._loop=g,this._player&&(this._player.loop=g)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(g){this._playOnAwake=g}},{key:"volume",get:function(){return this._volume},set:function(g){Number.isNaN(g)?console.warn("illegal audio volume!"):(g=mi(g,0,1),this._player?(this._player.volume=g,this._volume=this._player.volume):this._volume=g)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this._cachedCurrentTime<0?0:this._cachedCurrentTime},set:function(g){var v;Number.isNaN(g)?console.warn("illegal audio time!"):(g=mi(g,0,this.duration),this._isLoaded||!this.clip?(this._cachedCurrentTime=g,null===(v=this._player)||void 0===v||v.seek(this._cachedCurrentTime).catch(function(){})):this._operationsBeforeLoading.push({op:W$.SEEK,params:[g]}))}},{key:"duration",get:function(){var g,v;return null!==(g=null===(v=this._clip)||void 0===v?void 0:v.getDuration())&&void 0!==g?g:this._player?this._player.duration:0}},{key:"state",get:function(){return this._player?this._player.state:Wf.INIT}},{key:"playing",get:function(){return this.state===e.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return Wk.maxAudioChannel}}]),e}(cS)).AudioState=Wf,WJ.EventType=WQ,Wj=ws((WX=WJ).prototype,"_clip",[WU],function(){return null}),Wq=ws(WX.prototype,"_loop",[n2],function(){return!1}),WY=ws(WX.prototype,"_playOnAwake",[n2],function(){return!0}),WK=ws(WX.prototype,"_volume",[n2],function(){return 1}),p(WX.prototype,"clip",[WH],Object.getOwnPropertyDescriptor(WX.prototype,"clip"),WX.prototype),Wz=WX))||Wz));function PZ(g){for(var v=g.scene.batches,S=0;v&&S<v.length;S++){var O=v[S];if(g.visibility&O.visFlags)return!0}return!1}X.AudioSourceComponent=W3,kt(W3,"cc.AudioSourceComponent"),X.log=N,X.warn=G,X.error=k,X.assert=V,X._throw=z,X.logID=j,X.warnID=q,X.errorID=J,X.assertID=$,X.debug=tA,X.path={join:Ou,extname:Mu,mainFileName:Lu,basename:Fu,dirname:Nu,changeExtname:Gu,changeBasename:ku,_normalize:Vu,stripSep:Uu,get sep(){return Hu()}};var DZ=function(g,v,S,O,X){this.camera=void 0,this.id=0xffffffff,this.windowID=0xffffffff,this.width=0,this.height=0,this.camera=g,this.id=v,this.windowID=S,this.width=O,this.height=X},W5=new Map,W4=new Map;function LZ(g){var v=W4.get(g.window);return void 0===v&&(v=W4.size,W4.set(g.window,v)),v}function FZ(g,v,S,O){var X=W5.get(v);if(void 0!==X){var Y=v.window.width,te=v.window.height;0===Y&&(Y=1),0===te&&(te=1);var ti=LZ(v);return X.width=Y,X.height=te,X.windowID=ti,O(g,X),X}var tr=LZ(v);return S(g,X=new DZ(v,W5.size,tr,v.window.width?v.window.width:1,v.window.height?v.window.height:1)),W5.set(v,X),X}function NZ(g,v,S,O){var X=S,Y=O,te=v,ti=g.device;if(!g.containsResource(te)){var tr=kg(ti)?oA.R32F:oA.RGBA8;g.addRenderTarget(te,tr,X,Y,p2.MANAGED),g.addDepthStencil(te+"Depth",oA.DEPTH_STENCIL,X,Y,p2.MANAGED)}g.updateRenderTarget(te,X,Y),g.updateDepthStencil(te+"Depth",X,Y)}var W8=new AX;function kZ(g,v){var S=v.camera;pR(g,S);var O=g,X=O.pipelineSceneData.shadows,Y=g.pipelineSceneData.validPunctualLights,te=g.pipelineSceneData.shadows;if(W8.reset(),!X.enabled||X.type!==px.ShadowMap)return W8;W8.shadowEnabled=!0;for(var ti=W8.validLights,tr=0,ta=0;tr<X.maxReceived&&ta<Y.length;){var th=Y[ta];th.type===pJ.SPOT&&th.shadowEnabled&&(ti.push(th),tr++),ta++}var tu=S.scene.mainLight,tl=te.size.x,tc=te.size.y;if(tu&&tu.shadowEnabled){if(W8.mainLightShadowNames[0]="MainLightShadow"+v.id,tu.shadowFixedArea)NZ(g,W8.mainLightShadowNames[0],tl,tc);else{var t_=O.pipelineSceneData.csmSupported?tu.csmLevel:1;W8.mainLightShadowNames[0]="MainLightShadow"+v.id;for(var tf=0;tf<t_;tf++)NZ(g,W8.mainLightShadowNames[0],tl,tc)}}for(var tp=0;tp<ti.length;tp++){ti[tp];var tm="SpotLightShadow"+tp.toString()+v.id;W8.spotLightShadowNames[tp]=tm,NZ(g,W8.spotLightShadowNames[tp],tl,tc)}return W8}var W6,W9=kZ;function HZ(g,v,S,O,X,Y,te){var ti=Y,tr=te,ta=yR(S,Y,te,O,X);Y=ta.width,te=ta.height;var th=g;X||((W6=v.addRenderPass(Y,te,"default")).name=g,W6.setViewport(new hS(0,0,ti,tr)),W6.addRenderTarget(th,oH.CLEAR,oz.STORE,new hA(1,1,1,S.clearColor.w)),W6.addDepthStencil(th+"Depth",oH.CLEAR,oz.DISCARD,S.clearDepth,S.clearStencil,o7.DEPTH_STENCIL));var tu=W6.addQueue(p3.RENDER_OPAQUE,"shadow-caster");tu.addSceneOfCamera(S,new mu(O,X),p7.SHADOW_CASTER),tu.setViewport(new hS(ta.x,ta.y,ta.width,ta.height))}function zZ(g,v){if(W8.shadowEnabled){var S=v.camera,O=g.pipelineSceneData.shadows,X=O.size.x,Y=O.size.y,te=S.scene.mainLight;if(te&&te.shadowEnabled){if(W8.mainLightShadowNames[0]="MainLightShadow"+v.id,te.shadowFixedArea)HZ(W8.mainLightShadowNames[0],g,S,te,0,X,Y);else{var ti=g.pipelineSceneData.csmSupported?te.csmLevel:1;W8.mainLightShadowNames[0]="MainLightShadow"+v.id;for(var tr=0;tr<ti;tr++)HZ(W8.mainLightShadowNames[0],g,S,te,tr,X,Y)}}for(var ta=0;ta<W8.validLights.length;ta++){var th=W8.validLights[ta],tu="SpotLightShadow"+ta.toString()+v.id;W8.spotLightShadowNames[ta]=tu,HZ(tu,g,S,th,0,X,Y)}}}function WZ(g,v,S,O){var X=yR(v.camera,v.camera.window.width,v.camera.window.height),Y=X.width,te=X.height,ti=g.addRenderPass(Y,te,"default"),tr=v.camera;ti.addRenderTarget(S,oH.LOAD,oz.STORE),ti.addDepthStencil(Xo.ds,oH.LOAD,oz.DISCARD);for(var ta,th=f(W8.mainLightShadowNames);!(ta=th()).done;){var tu=ta.value;g.containsResource(tu)&&ti.addTexture(tu,"cc_shadowMap")}for(var tl,tc=f(W8.spotLightShadowNames);!(tl=tc()).done;){var t_=tl.value;g.containsResource(t_)&&ti.addTexture(t_,"cc_spotShadowMap")}var tf=p7.OPAQUE_OBJECT|p7.PLANAR_SHADOW|p7.CUTOUT_OBJECT|p7.DRAW_INSTANCING;tf|=O?p7.CLUSTERED_LIGHTING:p7.DEFAULT_LIGHTING,ti.addQueue(p3.RENDER_OPAQUE,"deferred-forward").addSceneOfCamera(tr,new mu,tf),ti.addQueue(p3.RENDER_TRANSPARENT,"deferred-forward").addSceneOfCamera(tr,new mu,p7.TRANSPARENT_OBJECT|p7.GEOMETRY)}function XZ(g,v,S,O){void 0===S&&(S=!1),void 0===O&&(O=!0),zZ(g,v);var X=v.id,Y=yR(v.camera,v.camera.window.width,v.camera.window.height),te=Y.width,ti=Y.height,tr=g.addRenderPass(te,ti,"default");tr.name="ForwardPass"+X,tr.setViewport(new hS(Y.x,Y.y,te,ti));for(var ta,th=f(W8.mainLightShadowNames);!(ta=th()).done;){var tu=ta.value;g.containsResource(tu)&&tr.addTexture(tu,"cc_shadowMap")}for(var tl,tc=f(W8.spotLightShadowNames);!(tl=tc()).done;){var t_=tl.value;g.containsResource(t_)&&tr.addTexture(t_,"cc_spotShadowMap")}var tf=v.camera;tr.addRenderTarget("ForwardColor"+v.id,S?oH.CLEAR:vR(tf.clearFlag,mt.RENDER_TARGET),oz.STORE,new hA(tf.clearColor.x,tf.clearColor.y,tf.clearColor.z,tf.clearColor.w)),tr.addDepthStencil("ForwardDepthStencil"+v.id,S?oH.CLEAR:vR(tf.clearFlag,mt.DEPTH_STENCIL),S?oz.DISCARD:oz.STORE,tf.clearDepth,tf.clearStencil,tf.clearFlag),tr.addQueue(p3.RENDER_OPAQUE).addSceneOfCamera(tf,new mu,p7.OPAQUE_OBJECT|p7.PLANAR_SHADOW|p7.CUTOUT_OBJECT|p7.DEFAULT_LIGHTING|p7.DRAW_INSTANCING);var tp=p7.TRANSPARENT_OBJECT|p7.GEOMETRY;return S||(tp|=p7.UI,tr.showStatistics=!0),O&&tr.addQueue(p3.RENDER_TRANSPARENT).addSceneOfCamera(tf,new mu,tp),{rtName:"ForwardColor"+v.id,dsName:"ForwardDepthStencil"+v.id}}var Xi,Xs,Xo=new function(){this.color=void 0,this.normal=void 0,this.emissive=void 0,this.ds=void 0};function KZ(g,v){var S=v.camera,O=yR(S,S.window.width,S.window.height),X=O.width,Y=O.height,te=Xo.color,ti=Xo.normal,tr=Xo.emissive,ta=Xo.ds,th=g.addRenderPass(X,Y,"gbuffer");th.name="CameraGBufferPass"+v.id,th.setViewport(new hS(O.x,O.y,X,Y));var tu=new hA(0,0,0,0);return S.clearFlag&o7.COLOR&&(g.pipelineSceneData.isHDR?lS(tu,S.clearColor):(tu.x=S.clearColor.x,tu.y=S.clearColor.y,tu.z=S.clearColor.z)),th.addRenderTarget(te,oH.CLEAR,oz.STORE,tu),th.addRenderTarget(tr,oH.CLEAR,oz.STORE,new hA(0,0,0,0)),th.addRenderTarget(ti,oH.CLEAR,oz.STORE,new hA(0,0,0,0)),th.addDepthStencil(ta,oH.CLEAR,oz.STORE,S.clearDepth,S.clearStencil,S.clearFlag),th.addQueue(p3.RENDER_OPAQUE,"gbuffer").addSceneOfCamera(S,new mu,p7.OPAQUE_OBJECT|p7.CUTOUT_OBJECT),th}function JZ(g,v,S){zZ(g,v),Xi||(Xi=new Aj(S));var O=g,X=v.camera,Y=yR(X,X.window.width,X.window.height),te=Y.width,ti=Y.height,tr=gR(X),ta="deferredLightingPassRTName"+v.id,th=O.addRenderPass(te,ti,"deferred-lighting");th.name="CameraLightingPass"+v.id,th.setViewport(new hS(Y.x,Y.y,te,ti));for(var tu,tl=f(W8.mainLightShadowNames);!(tu=tl()).done;){var tc=tu.value;O.containsResource(tc)&&th.addTexture(tc,"cc_shadowMap")}for(var t_,tf=f(W8.spotLightShadowNames);!(t_=tf()).done;){var tp=t_.value;O.containsResource(tp)&&th.addTexture(tp,"cc_spotShadowMap")}O.containsResource(Xo.color)&&(th.addTexture(Xo.color,"albedoMap"),th.addTexture(Xo.normal,"normalMap"),th.addTexture(Xo.emissive,"emissiveMap"),th.addTexture(Xo.ds,"depthStencil"));var tm="clusterLightBuffer"+tr,tg="clusterLightIndicesBuffer"+tr,tv="clusterLightGridBuffer"+tr;O.containsResource(tm)&&(th.addStorageBuffer(tm,me.READ,"b_ccLightsBuffer"),th.addStorageBuffer(tg,me.READ,"b_clusterLightIndicesBuffer"),th.addStorageBuffer(tv,me.READ,"b_clusterLightGridBuffer"));var ty=new hA(0,0,0,0);return X.clearFlag&o7.COLOR&&(ty.x=X.clearColor.x,ty.y=X.clearColor.y,ty.z=X.clearColor.z),ty.w=0,th.addRenderTarget(ta,oH.CLEAR,oz.STORE,ty),th.addQueue(p3.RENDER_TRANSPARENT).addCameraQuad(X,Xi.deferredLightingMaterial,0,p7.VOLUMETRIC_LIGHTING),{rtName:ta}}function QZ(g,v,S){Xs||(Xs=new AW);var O=v.id,X=v.camera,Y=yR(X,X.window.width,X.window.height),te=Y.width,ti=Y.height,tr="postprocessPassRTName"+O,ta="postprocessPassDS"+O,th=g.addRenderPass(te,ti,"post-process");th.name="CameraPostprocessPass"+O,th.setViewport(new hS(Y.x,Y.y,Y.width,Y.height)),g.containsResource(S)&&th.addTexture(S,"outputResultMap");var tu=new hA(0,0,0,X.clearColor.w);return X.clearFlag&o7.COLOR&&(tu.x=X.clearColor.x,tu.y=X.clearColor.y,tu.z=X.clearColor.z),th.addRenderTarget(tr,vR(X.clearFlag,mt.RENDER_TARGET),oz.STORE,tu),th.addDepthStencil(ta,vR(X.clearFlag,mt.DEPTH_STENCIL),oz.STORE,X.clearDepth,X.clearStencil,X.clearFlag),th.addQueue(p3.NONE).addCameraQuad(X,Xs.postMaterial,0,p7.NONE),AS()===X&&(th.showStatistics=!0),{rtName:tr,dsName:ta}}function ZZ(g,v){var S=v.camera,O=yR(S,S.window.width,S.window.height),X=O.width,Y=O.height,te="dsUIAndProfilerPassColor"+v.id,ti="dsUIAndProfilerPassDS"+v.id,tr=g.addRenderPass(X,Y,"default");tr.name="CameraUIAndProfilerPass"+v.id,tr.setViewport(new hS(O.x,O.y,X,Y)),tr.addRenderTarget(te,vR(S.clearFlag,mt.RENDER_TARGET),oz.STORE,new hA(S.clearColor.x,S.clearColor.y,S.clearColor.z,S.clearColor.w)),tr.addDepthStencil(ti,vR(S.clearFlag,mt.DEPTH_STENCIL),oz.STORE,S.clearDepth,S.clearStencil,S.clearFlag);var ta=p7.UI;tr.addQueue(p3.RENDER_TRANSPARENT).addSceneOfCamera(S,new mu,ta),AS()===S&&(tr.showStatistics=!0)}new hA(0,0,0,0),g("db",function(){function t1(){}var g=t1.prototype;return g.setup=function(g,v){for(var S=0;S<g.length;S++){var O=g[S];null!==O.scene&&(v.update(O),XZ(v,FZ(v,O,this.initResource,this.updateResource)))}},g.initResource=function(g,v){!function(g,v,S){void 0===S&&(S=!1);var O=v.camera,X=yR(O,O.window.width,O.window.height),Y=X.width,te=X.height;kZ(g,v),S?g.addRenderTarget("ForwardColor"+v.id,function(g){var v=g.getMacroBool("CC_USE_FLOAT_OUTPUT");return g.pipelineSceneData.isHDR&&v&&Vg(g.device)?oA.RGBA16F:oA.RGBA8}(g),Y,te,p2.PERSISTENT):g.addRenderWindow("ForwardColor"+v.id,oA.BGRA8,Y,te,v.camera.window),g.addDepthStencil("ForwardDepthStencil"+v.id,oA.DEPTH_STENCIL,Y,te)}(g,v)},g.updateResource=function(g,v){!function(g,v,S){void 0===S&&(S=!1);var O=v.camera,X=yR(O,O.window.width,O.window.height),Y=X.width,te=X.height;W9(g,v),S?g.updateRenderTarget("ForwardColor"+v.id,Y,te):g.updateRenderWindow("ForwardColor"+v.id,v.camera.window),g.updateDepthStencil("ForwardDepthStencil"+v.id,Y,te)}(g,v)},t1}()),g("dc",function(){function t1(){}var g=t1.prototype;return g.setup=function(g,v){for(var S=0;S<g.length;++S){var O=g[S];if(O.scene){v.update(O);var X=v.device.hasFeature(oS.COMPUTE_SHADER),Y=O.cameraUsage===pc.GAME||O.cameraUsage===pc.GAME_VIEW,te=FZ(v,O,this.initResource,this.updateResource);if(Y){if(PZ(O))ZZ(v,te);else{X&&LR(O,v),KZ(v,te);var ti=JZ(v,te,X);WZ(v,te,ti.rtName,X),QZ(v,te,ti.rtName)}}else XZ(v,te)}}},g.initResource=function(g,v){PZ(v.camera)?function(g,v){var S=v.camera,O=yR(S,S.window.width,S.window.height),X=O.width,Y=O.height,te="dsUIAndProfilerPassColor"+v.id,ti="dsUIAndProfilerPassDS"+v.id;g.addRenderWindow(te,oA.BGRA8,X,Y,S.window),g.addDepthStencil(ti,oA.DEPTH_STENCIL,X,Y,p2.MANAGED)}(g,v):(function(g,v){var S=v.camera,O=yR(S,S.window.width,S.window.height),X=O.width,Y=O.height,te="gBufferPassColorCamera"+v.id,ti="gBufferPassNormal"+v.id,tr="gBufferPassEmissive"+v.id,ta="gBufferPassDSCamera"+v.id,th=oA.RGBA16F;g.addRenderTarget(te,th,X,Y,p2.MANAGED),g.addRenderTarget(tr,th,X,Y,p2.MANAGED),g.addRenderTarget(ti,th,X,Y,p2.MANAGED),g.addDepthStencil(ta,oA.DEPTH_STENCIL,X,Y,p2.MANAGED),Xo.color=te,Xo.normal=ti,Xo.emissive=tr,Xo.ds=ta}(g,v),function(g,v){kZ(g,v);var S=v.camera,O=yR(S,S.window.width,S.window.height),X=O.width,Y=O.height,te="deferredLightingPassRTName"+v.id;g.addRenderTarget(te,oA.RGBA8,X,Y,p2.MANAGED)}(g,v),function(g,v){var S=v.id,O=v.camera,X=yR(O,O.window.width,O.window.height),Y=X.width,te=X.height,ti="postprocessPassRTName"+S,tr="postprocessPassDS"+S;g.addRenderWindow(ti,oA.BGRA8,Y,te,O.window),g.addDepthStencil(tr,oA.DEPTH_STENCIL,Y,te,p2.MANAGED)}(g,v))},g.updateResource=function(g,v){PZ(v.camera)?function(g,v){var S=v.camera,O=yR(S,S.window.width,S.window.height),X=O.width,Y=O.height,te="dsUIAndProfilerPassColor"+v.id,ti="dsUIAndProfilerPassDS"+v.id;g.updateRenderWindow(te,S.window),g.updateDepthStencil(ti,X,Y)}(g,v):(function(g,v){var S=v.camera,O=yR(S,S.window.width,S.window.height),X=O.width,Y=O.height,te="gBufferPassColorCamera"+v.id,ti="gBufferPassNormal"+v.id,tr="gBufferPassEmissive"+v.id,ta="gBufferPassDSCamera"+v.id;g.updateRenderTarget(te,X,Y),g.updateRenderTarget(tr,X,Y),g.updateRenderTarget(ti,X,Y),g.updateDepthStencil(ta,X,Y)}(g,v),function(g,v){W9(g,v);var S=v.camera,O=yR(S,S.window.width,S.window.height),X=O.width,Y=O.height,te="deferredLightingPassRTName"+v.id;g.updateRenderTarget(te,X,Y)}(g,v),function(g,v){var S=v.id,O=v.camera,X=yR(O,O.window.width,O.window.height),Y=X.width,te=X.height,ti="postprocessPassRTName"+S,tr="postprocessPassDS"+S;g.updateRenderWindow(ti,O.window),g.updateDepthStencil(tr,Y,te)}(g,v))},t1}());var Xh=rG.Flags.Destroyed,Xu=rG.Flags.PersistentMask,Xl=[];function i$(g){var v;if(Oa(g)){if(function(g){return"function"==typeof g._instantiate}(g))return X.game._isCloning=!0,v=g._instantiate(null,!0),X.game._isCloning=!1,v;if(_instanceof(g,X.Asset))throw new TypeError(tt(6903))}return X.game._isCloning=!0,v=n$(g),X.game._isCloning=!1,v}function n$(g,v){var S;r$(g,S=g._iN$t?g._iN$t:g.constructor?new g.constructor:Object.create(null),v);for(var O=0,X=Xl.length;O<X;++O)Xl[O]._iN$t=null;return Xl.length=0,S}function r$(g,v,S){tw(g,"_iN$t",v,!0),Xl.push(g);var O=g.constructor;if(si(O))!function(g,v,S,O){for(var X=g.__values__,Y=0;Y<X.length;Y++){var te=X[Y],ti=v[te];if("object"==(void 0===ti?"undefined":_type_of(ti))&&ti){var tr=S[te];_instanceof(tr,tq)&&tr.constructor===ti.constructor?tr.set(ti):S[te]=ti._iN$t||s$(ti,O)}else S[te]=ti}}(O,g,v,S);else for(var X in g)if(g.hasOwnProperty(X)&&(95!==X.charCodeAt(0)||95!==X.charCodeAt(1)||"__type__"===X||"__prefab"===X)){var Y=g[X];if("object"==(void 0===Y?"undefined":_type_of(Y))&&Y){if(Y===v)continue;v[X]=Y._iN$t||s$(Y,S)}else v[X]=Y}Oa(g)&&(v._objFlags&=Xu)}function s$(g,v){if(_instanceof(g,tq))return g.clone();if(_instanceof(g,X.Asset))return g;var S;if(ArrayBuffer.isView(g)){var O=g.length;S=new g.constructor(O),g._iN$t=S,Xl.push(g);for(var Y=0;Y<O;++Y)S[Y]=g[Y];return S}if(Array.isArray(g)){var te=g.length;S=new Array(te),g._iN$t=S,Xl.push(g);for(var ti=0;ti<te;++ti){var tr=g[ti];S[ti]="object"==(void 0===tr?"undefined":_type_of(tr))&&tr?tr._iN$t||s$(tr,v):tr}return S}if(g._objFlags&Xh)return null;var ta=g.constructor;if(si(ta)){if(v){if(_instanceof(v,cS)){if(_instanceof(g,mJ)||_instanceof(g,cS))return g}else if(_instanceof(v,mJ)){if(_instanceof(g,mJ)){if(!g.isChildOf(v))return g}else if(_instanceof(g,cS)&&g.node&&!g.node.isChildOf(v))return g}}S=new ta}else if(ta===Object)S={};else{if(ta)return g;S=Object.create(null)}return r$(g,S,v),S}i$._clone=n$,X.instantiate=i$;var Xc,X_,Xf=g("e6",function(){function t1(g){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=g,this._pool=[]}var g=t1.prototype;return g.size=function(){return this._pool.length},g.clear=function(){for(var g=this._pool.length,v=0;v<g;++v)this._pool[v].destroy();this._pool.length=0},g.put=function(g){if(g&&-1===this._pool.indexOf(g)){g.removeFromParent();var v=this.poolHandlerComp?g.getComponent(this.poolHandlerComp):null;v&&v.unuse&&v.unuse(),this._pool.push(g)}},g.get=function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];var O=this._pool.length-1;if(O<0)return null;var X=this._pool[O];this._pool.length=O;var Y=this.poolHandlerComp?X.getComponent(this.poolHandlerComp):null;return Y&&Y.reuse&&Y.reuse(arguments),X},t1}());X.NodePool=Xf;var Xd=null!==(Xc=globalThis.jsb)&&void 0!==Xc?Xc:{};g("eo",{DownloaderHints:Xd.DownloaderHints,Downloader:Xd.Downloader,zipUtils:Xd.zipUtils,fileUtils:Xd.fileUtils,DebugRenderer:Xd.DebugRenderer,copyTextToClipboard:null===(X_=Xd.copyTextToClipboard)||void 0===X_?void 0:X_.bind(Xd),garbageCollect:Xd.garbageCollect,reflection:Xd.reflection,bridge:Xd.bridge,jsbBridgeWrapper:Xd.jsbBridgeWrapper,AssetsManager:Xd.AssetsManager,EventAssetsManager:Xd.EventAssetsManager,Manifest:Xd.Manifest,saveImageData:Xd.saveImageData,process:Xd.process,adpf:Xd.adpf}),X.renderer=MX;var Xp,XS=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuDescriptorSet=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._layout=g.layout;var v=g.layout.gpuDescriptorSetLayout,S=v.bindings,O=v.descriptorIndices,X=v.descriptorCount;this._buffers=Array(X).fill(null),this._textures=Array(X).fill(null),this._samplers=Array(X).fill(null);var Y=[];this._gpuDescriptorSet={gpuDescriptors:Y,descriptorIndices:O};for(var te=0;te<S.length;++te)for(var ti=S[te],tr=0;tr<ti.count;tr++)Y.push({type:ti.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null})},v.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},v.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var g=this._gpuDescriptorSet.gpuDescriptors,v=0;v<g.length;++v)if(g[v].type&ud){var S=this._buffers[v];S&&(g[v].gpuBuffer=S.gpuBuffer||S.gpuBufferView)}else g[v].type&um&&(this._textures[v]&&(g[v].gpuTexture=this._textures[v].gpuTexture),this._samplers[v]&&(g[v].gpuSampler=this._samplers[v].gpuSampler));this._isDirty=!1}},n(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(uP);!function(g){g[g.RGBA16F_EXT=34842]="RGBA16F_EXT",g[g.RGB16F_EXT=34843]="RGB16F_EXT",g[g.RGBA32F_EXT=34836]="RGBA32F_EXT",g[g.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",g[g.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",g[g.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",g[g.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",g[g.SRGB_EXT=35904]="SRGB_EXT",g[g.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",g[g.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",g[g.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",g[g.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",g[g.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",g[g.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",g[g.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",g[g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",g[g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",g[g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",g[g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",g[g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",g[g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",g[g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",g[g.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",g[g.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",g[g.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",g[g.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",g[g.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",g[g.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",g[g.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",g[g.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",g[g.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",g[g.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",g[g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",g[g.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",g[g.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",g[g.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",g[g.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",g[g.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",g[g.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",g[g.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",g[g.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",g[g.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",g[g.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",g[g.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",g[g.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",g[g.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",g[g.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(Xp||(Xp={}));var XA=function(){function t1(){}return t1.setInstance=function(g){t1._instance=g},n(t1,null,[{key:"instance",get:function(){return t1._instance}}]),t1}();function f$(g,v){switch(g){case oA.R8:return v.UNSIGNED_BYTE;case oA.R8SN:return v.BYTE;case oA.R8UI:return v.UNSIGNED_BYTE;case oA.R8I:return v.BYTE;case oA.R16F:return Xp.HALF_FLOAT_OES;case oA.R16UI:return v.UNSIGNED_SHORT;case oA.R16I:return v.SHORT;case oA.R32F:return v.FLOAT;case oA.R32UI:return v.UNSIGNED_INT;case oA.R32I:return v.INT;case oA.RG8:return v.UNSIGNED_BYTE;case oA.RG8SN:return v.BYTE;case oA.RG8UI:return v.UNSIGNED_BYTE;case oA.RG8I:return v.BYTE;case oA.RG16F:return Xp.HALF_FLOAT_OES;case oA.RG16UI:return v.UNSIGNED_SHORT;case oA.RG16I:return v.SHORT;case oA.RG32F:return v.FLOAT;case oA.RG32UI:return v.UNSIGNED_INT;case oA.RG32I:return v.INT;case oA.RGB8:case oA.SRGB8:return v.UNSIGNED_BYTE;case oA.RGB8SN:return v.BYTE;case oA.RGB8UI:return v.UNSIGNED_BYTE;case oA.RGB8I:return v.BYTE;case oA.RGB16F:return Xp.HALF_FLOAT_OES;case oA.RGB16UI:return v.UNSIGNED_SHORT;case oA.RGB16I:return v.SHORT;case oA.RGB32F:return v.FLOAT;case oA.RGB32UI:return v.UNSIGNED_INT;case oA.RGB32I:return v.INT;case oA.BGRA8:case oA.RGBA8:case oA.SRGB8_A8:return v.UNSIGNED_BYTE;case oA.RGBA8SN:return v.BYTE;case oA.RGBA8UI:return v.UNSIGNED_BYTE;case oA.RGBA8I:return v.BYTE;case oA.RGBA16F:return Xp.HALF_FLOAT_OES;case oA.RGBA16UI:return v.UNSIGNED_SHORT;case oA.RGBA16I:return v.SHORT;case oA.RGBA32F:return v.FLOAT;case oA.RGBA32UI:return v.UNSIGNED_INT;case oA.RGBA32I:return v.INT;case oA.R5G6B5:return v.UNSIGNED_SHORT_5_6_5;case oA.R11G11B10F:return v.FLOAT;case oA.RGB5A1:return v.UNSIGNED_SHORT_5_5_5_1;case oA.RGBA4:return v.UNSIGNED_SHORT_4_4_4_4;case oA.RGB10A2:return v.UNSIGNED_BYTE;case oA.RGB10A2UI:return v.UNSIGNED_INT;case oA.RGB9E5:return v.UNSIGNED_BYTE;case oA.DEPTH:return v.UNSIGNED_INT;case oA.DEPTH_STENCIL:return Xp.UNSIGNED_INT_24_8_WEBGL;case oA.BC1:case oA.BC1_SRGB:case oA.BC2:case oA.BC2_SRGB:case oA.BC3:case oA.BC3_SRGB:case oA.BC4:return v.UNSIGNED_BYTE;case oA.BC4_SNORM:return v.BYTE;case oA.BC5:return v.UNSIGNED_BYTE;case oA.BC5_SNORM:return v.BYTE;case oA.BC6H_SF16:case oA.BC6H_UF16:return v.FLOAT;case oA.BC7:case oA.BC7_SRGB:case oA.ETC_RGB8:case oA.ETC2_RGB8:case oA.ETC2_SRGB8:case oA.ETC2_RGB8_A1:case oA.ETC2_SRGB8_A1:case oA.EAC_R11:return v.UNSIGNED_BYTE;case oA.EAC_R11SN:return v.BYTE;case oA.EAC_RG11:return v.UNSIGNED_BYTE;case oA.EAC_RG11SN:return v.BYTE;case oA.PVRTC_RGB2:case oA.PVRTC_RGBA2:case oA.PVRTC_RGB4:case oA.PVRTC_RGBA4:case oA.PVRTC2_2BPP:case oA.PVRTC2_4BPP:return v.UNSIGNED_BYTE;case oA.ASTC_RGBA_4X4:case oA.ASTC_RGBA_5X4:case oA.ASTC_RGBA_5X5:case oA.ASTC_RGBA_6X5:case oA.ASTC_RGBA_6X6:case oA.ASTC_RGBA_8X5:case oA.ASTC_RGBA_8X6:case oA.ASTC_RGBA_8X8:case oA.ASTC_RGBA_10X5:case oA.ASTC_RGBA_10X6:case oA.ASTC_RGBA_10X8:case oA.ASTC_RGBA_10X10:case oA.ASTC_RGBA_12X10:case oA.ASTC_RGBA_12X12:case oA.ASTC_SRGBA_4X4:case oA.ASTC_SRGBA_5X4:case oA.ASTC_SRGBA_5X5:case oA.ASTC_SRGBA_6X5:case oA.ASTC_SRGBA_6X6:case oA.ASTC_SRGBA_8X5:case oA.ASTC_SRGBA_8X6:case oA.ASTC_SRGBA_8X8:case oA.ASTC_SRGBA_10X5:case oA.ASTC_SRGBA_10X6:case oA.ASTC_SRGBA_10X8:case oA.ASTC_SRGBA_10X10:case oA.ASTC_SRGBA_12X10:case oA.ASTC_SRGBA_12X12:default:return v.UNSIGNED_BYTE}}function d$(g,v){switch(g){case oE.BOOL:return v.BOOL;case oE.BOOL2:return v.BOOL_VEC2;case oE.BOOL3:return v.BOOL_VEC3;case oE.BOOL4:return v.BOOL_VEC4;case oE.INT:return v.INT;case oE.INT2:return v.INT_VEC2;case oE.INT3:return v.INT_VEC3;case oE.INT4:return v.INT_VEC4;case oE.UINT:return v.UNSIGNED_INT;case oE.FLOAT:return v.FLOAT;case oE.FLOAT2:return v.FLOAT_VEC2;case oE.FLOAT3:return v.FLOAT_VEC3;case oE.FLOAT4:return v.FLOAT_VEC4;case oE.MAT2:return v.FLOAT_MAT2;case oE.MAT3:return v.FLOAT_MAT3;case oE.MAT4:return v.FLOAT_MAT4;case oE.SAMPLER2D:return v.SAMPLER_2D;case oE.SAMPLER_CUBE:return v.SAMPLER_CUBE;default:return k("Unsupported GLType, convert to GL type failed."),oE.UNKNOWN}}function p$(g){switch(g){case oE.BOOL:case oE.BOOL2:case oE.BOOL3:case oE.BOOL4:case oE.INT:case oE.INT2:case oE.INT3:case oE.INT4:case oE.UINT:return Int32Array;case oE.FLOAT:case oE.FLOAT2:case oE.FLOAT3:case oE.FLOAT4:case oE.MAT2:case oE.MAT3:case oE.MAT4:return Float32Array;default:return k("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function m$(g,v){switch(g){case v.BOOL:return oE.BOOL;case v.BOOL_VEC2:return oE.BOOL2;case v.BOOL_VEC3:return oE.BOOL3;case v.BOOL_VEC4:return oE.BOOL4;case v.INT:return oE.INT;case v.INT_VEC2:return oE.INT2;case v.INT_VEC3:return oE.INT3;case v.INT_VEC4:return oE.INT4;case v.UNSIGNED_INT:return oE.UINT;case v.FLOAT:return oE.FLOAT;case v.FLOAT_VEC2:return oE.FLOAT2;case v.FLOAT_VEC3:return oE.FLOAT3;case v.FLOAT_VEC4:return oE.FLOAT4;case v.FLOAT_MAT2:return oE.MAT2;case v.FLOAT_MAT3:return oE.MAT3;case v.FLOAT_MAT4:return oE.MAT4;case v.SAMPLER_2D:return oE.SAMPLER2D;case v.SAMPLER_CUBE:return oE.SAMPLER_CUBE;default:return k("Unsupported GLType, convert to Type failed."),oE.UNKNOWN}}function g$(g,v){switch(g){case v.BOOL:return 4;case v.BOOL_VEC2:return 8;case v.BOOL_VEC3:return 12;case v.BOOL_VEC4:return 16;case v.INT:return 4;case v.INT_VEC2:return 8;case v.INT_VEC3:return 12;case v.INT_VEC4:return 16;case v.UNSIGNED_INT:case v.FLOAT:return 4;case v.FLOAT_VEC2:return 8;case v.FLOAT_VEC3:return 12;case v.FLOAT_VEC4:case v.FLOAT_MAT2:return 16;case v.FLOAT_MAT3:return 36;case v.FLOAT_MAT4:return 64;case v.SAMPLER_2D:case v.SAMPLER_CUBE:return 4;default:return k("Unsupported GLType, get type failed."),0}}function v$(g,v){switch(g){case v.FLOAT_MAT2:return 2;case v.FLOAT_MAT3:return 3;case v.FLOAT_MAT4:return 4;default:return 1}}XA._instance=null;var XT,XE=[512,513,514,515,516,517,518,519],XC=[0,7680,7681,7682,7683,5386,34055,34056],Xb=[32774,32778,32779,32775,32776],XR=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(g){g[g.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",g[g.END_RENDER_PASS=1]="END_RENDER_PASS",g[g.BIND_STATES=2]="BIND_STATES",g[g.DRAW=3]="DRAW",g[g.UPDATE_BUFFER=4]="UPDATE_BUFFER",g[g.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",g[g.BLIT_TEXTURE=6]="BLIT_TEXTURE",g[g.COUNT=7]="COUNT"}(XT||(XT={}));var C$=function(g){this.cmdType=void 0,this.refCount=0,this.cmdType=g},Xw=function(g){function e(){var v;return(v=g.call(this,XT.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,v.gpuFramebuffer=null,v.renderArea=new hl,v.clearFlag=o7.NONE,v.clearColors=[],v.clearDepth=1,v.clearStencil=0,v}return s(e,g),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(C$),XI=function(g){function e(){var v;return(v=g.call(this,XT.BIND_STATES)||this).gpuPipelineState=null,v.gpuInputAssembler=null,v.gpuDescriptorSets=[],v.dynamicOffsets=[],v.dynamicStates=new uc,v}return s(e,g),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0},e}(C$),XB=function(g){function e(){var v;return(v=g.call(this,XT.DRAW)||this).drawInfo=new hR,v}return s(e,g),e.prototype.clear=function(){},e}(C$),XP=function(g){function e(){var v;return(v=g.call(this,XT.UPDATE_BUFFER)||this).gpuBuffer=null,v.buffer=null,v.offset=0,v.size=0,v}return s(e,g),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(C$),XD=function(g){function e(){var v;return(v=g.call(this,XT.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,v.buffers=[],v.regions=[],v}return s(e,g),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(C$),XO=function(g){function e(){var v;return(v=g.call(this,XT.BLIT_TEXTURE)||this).srcTexture=null,v.dstTexture=null,v.regions=[],v.filter=oO.LINEAR,v}return s(e,g),e.prototype.clear=function(){this.srcTexture=null,this.dstTexture=null,this.regions.length=0},e}(C$),XL=function(){function t1(){this.cmds=new am(1),this.beginRenderPassCmds=new am(1),this.bindStatesCmds=new am(1),this.drawCmds=new am(1),this.updateBufferCmds=new am(1),this.copyBufferToTextureCmds=new am(1),this.blitTextureCmds=new am(1)}return t1.prototype.clearCmds=function(g){this.beginRenderPassCmds.length&&(g.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(g.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(g.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(g.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(g.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.blitTextureCmds.length&&(g.blitTextureCmdPool.freeCmds(this.blitTextureCmds),this.blitTextureCmds.clear()),this.cmds.clear()},t1}();function D$(g,v){var S=g.gl,O=g.stateCache,X=v.memUsage&oR.HOST?S.DYNAMIC_DRAW:S.STATIC_DRAW;if(v.usage&oC.VERTEX){v.glTarget=S.ARRAY_BUFFER;var Y=S.createBuffer();Y&&(v.glBuffer=Y,v.size>0&&(g.extensions.useVAO&&O.glVAO&&(g.extensions.OES_vertex_array_object.bindVertexArrayOES(null),O.glVAO=null),XF.gpuInputAssembler=null,g.stateCache.glArrayBuffer!==v.glBuffer&&(S.bindBuffer(S.ARRAY_BUFFER,v.glBuffer),g.stateCache.glArrayBuffer=v.glBuffer),S.bufferData(S.ARRAY_BUFFER,v.size,X),S.bindBuffer(S.ARRAY_BUFFER,null),g.stateCache.glArrayBuffer=null))}else if(v.usage&oC.INDEX){v.glTarget=S.ELEMENT_ARRAY_BUFFER;var te=S.createBuffer();te&&(v.glBuffer=te,v.size>0&&(g.extensions.useVAO&&O.glVAO&&(g.extensions.OES_vertex_array_object.bindVertexArrayOES(null),O.glVAO=null),XF.gpuInputAssembler=null,g.stateCache.glElementArrayBuffer!==v.glBuffer&&(S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,v.glBuffer),g.stateCache.glElementArrayBuffer=v.glBuffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,v.size,X),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,null),g.stateCache.glElementArrayBuffer=null))}else v.usage&oC.UNIFORM?(v.glTarget=S.NONE,v.buffer&&(v.vf32=new Float32Array(v.buffer.buffer))):(v.usage&oC.INDIRECT||v.usage&oC.TRANSFER_DST||v.usage&oC.TRANSFER_SRC||k("Unsupported BufferType, create buffer failed."),v.glTarget=S.NONE)}function O$(g,v){var S=g.gl,O=g.stateCache;if(v.glBuffer){switch(v.glTarget){case S.ARRAY_BUFFER:g.extensions.useVAO&&O.glVAO&&(g.extensions.OES_vertex_array_object.bindVertexArrayOES(null),g.stateCache.glVAO=null),XF.gpuInputAssembler=null,S.bindBuffer(S.ARRAY_BUFFER,null),g.stateCache.glArrayBuffer=null;break;case S.ELEMENT_ARRAY_BUFFER:g.extensions.useVAO&&O.glVAO&&(g.extensions.OES_vertex_array_object.bindVertexArrayOES(null),g.stateCache.glVAO=null),XF.gpuInputAssembler=null,S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,null),g.stateCache.glElementArrayBuffer=null}S.deleteBuffer(v.glBuffer),v.glBuffer=null}}function M$(g,v,S,O,X){if(v.usage&oC.UNIFORM)ArrayBuffer.isView(S)?v.vf32.set(S,O/Float32Array.BYTES_PER_ELEMENT):v.vf32.set(new Float32Array(S),O/Float32Array.BYTES_PER_ELEMENT);else if(v.usage&oC.INDIRECT){v.indirects.clearDraws();for(var Y=S.drawInfos,te=0;te<Y.length;++te)v.indirects.setDrawInfo(O+te,Y[te])}else{var ti=S,tr=g.gl,ta=g.stateCache;switch(v.glTarget){case tr.ARRAY_BUFFER:g.extensions.useVAO&&ta.glVAO&&(g.extensions.OES_vertex_array_object.bindVertexArrayOES(null),ta.glVAO=null),XF.gpuInputAssembler=null,g.stateCache.glArrayBuffer!==v.glBuffer&&(tr.bindBuffer(tr.ARRAY_BUFFER,v.glBuffer),g.stateCache.glArrayBuffer=v.glBuffer);break;case tr.ELEMENT_ARRAY_BUFFER:g.extensions.useVAO&&ta.glVAO&&(g.extensions.OES_vertex_array_object.bindVertexArrayOES(null),ta.glVAO=null),XF.gpuInputAssembler=null,g.stateCache.glElementArrayBuffer!==v.glBuffer&&(tr.bindBuffer(tr.ELEMENT_ARRAY_BUFFER,v.glBuffer),g.stateCache.glElementArrayBuffer=v.glBuffer);break;default:return void k("Unsupported BufferType, update buffer failed.")}X===ti.byteLength?tr.bufferSubData(v.glTarget,O,ti):tr.bufferSubData(v.glTarget,O,ti.slice(0,X))}}function L$(g,v){for(var S,O=g.gl,_$r=function(){var g=v.gpuStages[Y],S=0,X="",te=1;switch(g.type){case oU.VERTEX:X="VertexShader",S=O.VERTEX_SHADER;break;case oU.FRAGMENT:X="FragmentShader",S=O.FRAGMENT_SHADER;break;default:return k("Unsupported ShaderType."),{v:void 0}}var ti=O.createShader(S);if(ti&&(g.glShader=ti,O.shaderSource(g.glShader,g.source),O.compileShader(g.glShader),!O.getShaderParameter(g.glShader,O.COMPILE_STATUS))){k(X+" in '"+v.name+"' compilation failed."),k("Shader source dump:",g.source.replace(/^|\n/g,function(){return"\n"+te+++" "})),k(O.getShaderInfoLog(g.glShader));for(var tr=0;tr<v.gpuStages.length;tr++){var ta=v.gpuStages[Y];ta.glShader&&(O.deleteShader(ta.glShader),ta.glShader=null)}return{v:void 0}}},Y=0;Y<v.gpuStages.length;Y++)if(S=_$r())return S.v;var te=O.createProgram();if(te){v.glProgram=te;for(var ti=0;ti<v.gpuStages.length;ti++){var tr=v.gpuStages[ti];O.attachShader(v.glProgram,tr.glShader)}if(O.linkProgram(v.glProgram),g.extensions.destroyShadersImmediately)for(var ta=0;ta<v.gpuStages.length;ta++){var th=v.gpuStages[ta];th.glShader&&(O.detachShader(v.glProgram,th.glShader),O.deleteShader(th.glShader),th.glShader=null)}if(!O.getProgramParameter(v.glProgram,O.LINK_STATUS))return k("Failed to link shader '"+v.name+"'."),void k(O.getProgramInfoLog(v.glProgram));U("Shader '"+v.name+"' compilation succeeded.");var tu=O.getProgramParameter(v.glProgram,O.ACTIVE_ATTRIBUTES);v.glInputs=new Array(tu);for(var tl=0;tl<tu;++tl){var tc=O.getActiveAttrib(v.glProgram,tl);if(tc){var t_,tf=tc.name.indexOf("[");t_=-1!==tf?tc.name.substr(0,tf):tc.name;var tp=O.getAttribLocation(v.glProgram,t_),tm=m$(tc.type,O),tg=g$(tc.type,O);v.glInputs[tl]={binding:tp,name:t_,type:tm,stride:tg,count:tc.size,size:tg*tc.size,glType:tc.type,glLoc:tp}}}if(v.blocks.length>0){v.glBlocks=new Array(v.blocks.length);for(var tv=0;tv<v.blocks.length;++tv){var ty=v.blocks[tv],tS={set:ty.set,binding:ty.binding,name:ty.name,size:0,glUniforms:new Array(ty.members.length),glActiveUniforms:[]};v.glBlocks[tv]=tS;for(var tA=0;tA<ty.members.length;++tA){var tT=ty.members[tA],tE=d$(tT.type,O),tC=g$(tE,O),tx=tC*tT.count;tS.glUniforms[tA]={binding:-1,name:tT.name,type:tT.type,stride:tC,count:tT.count,size:tx,offset:0,glType:tE,glLoc:null,array:null}}}}for(var tb=0;tb<v.subpassInputs.length;++tb){var tw=v.subpassInputs[tb];v.samplerTextures.push(new hF(tw.set,tw.binding,tw.name,oE.SAMPLER2D,tw.count))}if(v.samplerTextures.length>0){v.glSamplerTextures=new Array(v.samplerTextures.length);for(var tI=0;tI<v.samplerTextures.length;++tI){var tB=v.samplerTextures[tI];v.glSamplerTextures[tI]={set:tB.set,binding:tB.binding,name:tB.name,type:tB.type,count:tB.count,units:[],glUnits:null,glType:d$(tB.type,O),glLoc:null}}}for(var tP=O.getProgramParameter(v.glProgram,O.ACTIVE_UNIFORMS),tD=0;tD<tP;++tD){var tM=O.getActiveUniform(v.glProgram,tD);if(tM&&tM.type!==O.SAMPLER_2D&&tM.type!==O.SAMPLER_CUBE){var tO=O.getUniformLocation(v.glProgram,tM.name);if(g.extensions.isLocationActive(tO)){var tk,tG=tM.name.indexOf("[");tk=-1!==tG?tM.name.substr(0,tG):tM.name;for(var tV=0;tV<v.glBlocks.length;tV++)for(var tU=v.glBlocks[tV],tH=0;tH<tU.glUniforms.length;tH++){var tz=tU.glUniforms[tH];if(tz.name===tk){tz.glLoc=tO,tz.count=tM.size,tz.size=tz.stride*tz.count,tz.array=new(p$(tz.type))(tz.size/4),tU.glActiveUniforms.push(tz);break}}}}}for(var tW=0;tW<v.glBlocks.length;tW++)for(var tj=v.glBlocks[tW],tq=0;tq<tj.glUniforms.length;tq++){var tK=tj.glUniforms[tq];tK.offset=tj.size/4,tj.size+=tK.size}var tZ=[],tQ=[],t$=g.bindingMappings,t0=g.stateCache.texUnitCacheMap;if(X.rendering&&X.rendering.enableEffectImport)for(var t2=0;t2<v.samplerTextures.length;++t2){var t3=v.samplerTextures[t2],t4=O.getUniformLocation(v.glProgram,t3.name);g.extensions.isLocationActive(t4)&&(tZ.push(v.glSamplerTextures[t2]),tQ.push(t4)),void 0===t0[t3.name]&&(t0[t3.name]=t3.flattened%g.capabilities.maxTextureUnits)}else{for(var t8=0,t6=0;t6<v.blocks.length;++t6)v.blocks[t6].set===t$.flexibleSet&&t8++;for(var t7=0,t9=0;t9<v.samplerTextures.length;++t9){var ee=v.samplerTextures[t9],en=O.getUniformLocation(v.glProgram,ee.name);if(g.extensions.isLocationActive(en)&&(tZ.push(v.glSamplerTextures[t9]),tQ.push(en)),void 0===t0[ee.name]){var er=ee.binding+t$.samplerTextureOffsets[ee.set]+t7;ee.set===t$.flexibleSet&&(er-=t8),t0[ee.name]=er%g.capabilities.maxTextureUnits,t7+=ee.count-1}}}if(tZ.length){for(var es=[],ea=0;ea<tZ.length;++ea){var eh=tZ[ea],eu=t0[eh.name];if(void 0!==eu){eh.glLoc=tQ[ea];for(var ec=0;ec<eh.count;++ec){for(;es[eu];)eu=(eu+1)%g.capabilities.maxTextureUnits;eh.units.push(eu),es[eu]=!0}}}for(var e_=0,ef=0;ef<tZ.length;++ef){var em=tZ[ef];if(!g.extensions.isLocationActive(em.glLoc)){em.glLoc=tQ[ef];for(var eg=0;eg<em.count;++eg){for(;es[e_];)e_=(e_+1)%g.capabilities.maxTextureUnits;void 0===t0[em.name]&&(t0[em.name]=e_),em.units.push(e_),es[e_]=!0}}}g.stateCache.glProgram!==v.glProgram&&O.useProgram(v.glProgram);for(var ey=0;ey<tZ.length;ey++){var eS=tZ[ey];eS.glUnits=new Int32Array(eS.units),O.uniform1iv(eS.glLoc,eS.glUnits)}g.stateCache.glProgram!==v.glProgram&&O.useProgram(g.stateCache.glProgram)}for(var eT=0;eT<v.glBlocks.length;)v.glBlocks[eT].glActiveUniforms.length?eT++:(v.glBlocks[eT]=v.glBlocks[v.glBlocks.length-1],v.glBlocks.length--);v.glSamplerTextures=tZ}}function F$(g,v){if(v.glProgram){var S=g.gl;if(!g.extensions.destroyShadersImmediately)for(var O=0;O<v.gpuStages.length;O++){var X=v.gpuStages[O];X.glShader&&(S.detachShader(v.glProgram,X.glShader),S.deleteShader(X.glShader),X.glShader=null)}S.deleteProgram(v.glProgram),g.stateCache.glProgram===v.glProgram&&(g.gl.useProgram(null),g.stateCache.glProgram=null),v.glProgram=null}}function N$(g,v){var S=g.gl;v.glAttribs=new Array(v.attributes.length);for(var O=[0,0,0,0,0,0,0,0],X=0;X<v.attributes.length;++X){var Y=v.attributes[X],te=void 0!==Y.stream?Y.stream:0,ti=v.gpuVertexBuffers[te],tr=f$(Y.format,S),ta=uf[Y.format].size;v.glAttribs[X]={name:Y.name,glBuffer:ti.glBuffer,glType:tr,size:ta,count:uf[Y.format].count,stride:ti.stride,componentCount:v$(tr,S),isNormalized:void 0!==Y.isNormalized&&Y.isNormalized,isInstanced:void 0!==Y.isInstanced&&Y.isInstanced,offset:O[te]},O[te]+=ta}}function G$(g,v){for(var S=v.glVAOs.values(),O=S.next(),X=g.extensions.OES_vertex_array_object,Y=g.stateCache.glVAO;!O.done;)X.deleteVertexArrayOES(O.value),Y===O.value&&(X.bindVertexArrayOES(null),Y=null),O=S.next();g.stateCache.glVAO=Y,v.glVAOs.clear()}var XF={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0},XN=new hl;function U$(g,v,S,O,X,Y,te){var ti=g.gl,tr=g.stateCache,ta=0;if(S&&(XN.x=O.x<<S.lodLevel,XN.y=O.y<<S.lodLevel,XN.width=O.width<<S.lodLevel,XN.height=O.height<<S.lodLevel),S&&v){tr.glFramebuffer!==S.glFramebuffer&&(ti.bindFramebuffer(ti.FRAMEBUFFER,S.glFramebuffer),tr.glFramebuffer=S.glFramebuffer),tr.viewport.left===XN.x&&tr.viewport.top===XN.y&&tr.viewport.width===XN.width&&tr.viewport.height===XN.height||(ti.viewport(XN.x,XN.y,XN.width,XN.height),tr.viewport.left=XN.x,tr.viewport.top=XN.y,tr.viewport.width=XN.width,tr.viewport.height=XN.height),tr.scissorRect.x===XN.x&&tr.scissorRect.y===XN.y&&tr.scissorRect.width===XN.width&&tr.scissorRect.height===XN.height||(ti.scissor(XN.x,XN.y,XN.width,XN.height),tr.scissorRect.x=XN.x,tr.scissorRect.y=XN.y,tr.scissorRect.width=XN.width,tr.scissorRect.height=XN.height);var th=X.length;g.extensions.WEBGL_draw_buffers||(th=1);for(var tu=0;tu<th;++tu){var tl=v.colorAttachments[tu];if(tl.format!==oA.UNKNOWN)switch(tl.loadOp){case oH.LOAD:break;case oH.CLEAR:tr.bs.targets[0].blendColorMask!==oV.ALL&&ti.colorMask(!0,!0,!0,!0);var tc=X[0];ti.clearColor(tc.x,tc.y,tc.z,tc.w),ta|=ti.COLOR_BUFFER_BIT;break;case oH.DISCARD:}}if(v.depthStencilAttachment&&v.depthStencilAttachment.format!==oA.UNKNOWN){switch(v.depthStencilAttachment.depthLoadOp){case oH.LOAD:break;case oH.CLEAR:tr.dss.depthWrite||ti.depthMask(!0),ti.clearDepth(Y),ta|=ti.DEPTH_BUFFER_BIT;break;case oH.DISCARD:}if(uf[v.depthStencilAttachment.format].hasStencil)switch(v.depthStencilAttachment.stencilLoadOp){case oH.LOAD:break;case oH.CLEAR:tr.dss.stencilWriteMaskFront||ti.stencilMaskSeparate(ti.FRONT,65535),tr.dss.stencilWriteMaskBack||ti.stencilMaskSeparate(ti.BACK,65535),ti.clearStencil(te),ta|=ti.STENCIL_BUFFER_BIT;break;case oH.DISCARD:}}if(ta&&ti.clear(ta),ta&ti.COLOR_BUFFER_BIT){var t_=tr.bs.targets[0].blendColorMask;if(t_!==oV.ALL){var tf=(t_&oV.R)!==oV.NONE,tp=(t_&oV.G)!==oV.NONE,tm=(t_&oV.B)!==oV.NONE,tg=(t_&oV.A)!==oV.NONE;ti.colorMask(tf,tp,tm,tg)}}ta&ti.DEPTH_BUFFER_BIT&&!tr.dss.depthWrite&&ti.depthMask(!1),ta&ti.STENCIL_BUFFER_BIT&&(tr.dss.stencilWriteMaskFront||ti.stencilMaskSeparate(ti.FRONT,0),tr.dss.stencilWriteMaskBack||ti.stencilMaskSeparate(ti.BACK,0))}}function H$(g,v,S,O,X,Y){var te,ti,tr,ta=g.gl,th=g.stateCache,tu=v&&v.gpuShader,tl=!1;if(v&&XF.gpuPipelineState!==v){if(XF.gpuPipelineState=v,XF.glPrimitive=v.glPrimitive,v.gpuShader){var tc=v.gpuShader.glProgram;th.glProgram!==tc&&(ta.useProgram(tc),th.glProgram=tc,tl=!0)}var t_=v.rs;if(t_){if(th.rs.cullMode!==t_.cullMode){switch(t_.cullMode){case o$.NONE:ta.disable(ta.CULL_FACE);break;case o$.FRONT:ta.enable(ta.CULL_FACE),ta.cullFace(ta.FRONT);break;case o$.BACK:ta.enable(ta.CULL_FACE),ta.cullFace(ta.BACK)}th.rs.cullMode=t_.cullMode}var tf=t_.isFrontFaceCCW;th.rs.isFrontFaceCCW!==tf&&(ta.frontFace(tf?ta.CCW:ta.CW),th.rs.isFrontFaceCCW=tf),th.rs.depthBias===t_.depthBias&&th.rs.depthBiasSlop===t_.depthBiasSlop||(ta.polygonOffset(t_.depthBias,t_.depthBiasSlop),th.rs.depthBias=t_.depthBias,th.rs.depthBiasSlop=t_.depthBiasSlop),th.rs.lineWidth!==t_.lineWidth&&(ta.lineWidth(t_.lineWidth),th.rs.lineWidth=t_.lineWidth)}var tp=v.dss;tp&&(th.dss.depthTest!==tp.depthTest&&(tp.depthTest?ta.enable(ta.DEPTH_TEST):ta.disable(ta.DEPTH_TEST),th.dss.depthTest=tp.depthTest),th.dss.depthWrite!==tp.depthWrite&&(ta.depthMask(tp.depthWrite),th.dss.depthWrite=tp.depthWrite),th.dss.depthFunc!==tp.depthFunc&&(ta.depthFunc(XE[tp.depthFunc]),th.dss.depthFunc=tp.depthFunc),th.dss.stencilTestFront===tp.stencilTestFront&&th.dss.stencilTestBack===tp.stencilTestBack||(tp.stencilTestFront||tp.stencilTestBack?ta.enable(ta.STENCIL_TEST):ta.disable(ta.STENCIL_TEST),th.dss.stencilTestFront=tp.stencilTestFront,th.dss.stencilTestBack=tp.stencilTestBack),th.dss.stencilFuncFront===tp.stencilFuncFront&&th.dss.stencilRefFront===tp.stencilRefFront&&th.dss.stencilReadMaskFront===tp.stencilReadMaskFront||(ta.stencilFuncSeparate(ta.FRONT,XE[tp.stencilFuncFront],tp.stencilRefFront,tp.stencilReadMaskFront),th.dss.stencilFuncFront=tp.stencilFuncFront,th.dss.stencilRefFront=tp.stencilRefFront,th.dss.stencilReadMaskFront=tp.stencilReadMaskFront),th.dss.stencilFailOpFront===tp.stencilFailOpFront&&th.dss.stencilZFailOpFront===tp.stencilZFailOpFront&&th.dss.stencilPassOpFront===tp.stencilPassOpFront||(ta.stencilOpSeparate(ta.FRONT,XC[tp.stencilFailOpFront],XC[tp.stencilZFailOpFront],XC[tp.stencilPassOpFront]),th.dss.stencilFailOpFront=tp.stencilFailOpFront,th.dss.stencilZFailOpFront=tp.stencilZFailOpFront,th.dss.stencilPassOpFront=tp.stencilPassOpFront),th.dss.stencilWriteMaskFront!==tp.stencilWriteMaskFront&&(ta.stencilMaskSeparate(ta.FRONT,tp.stencilWriteMaskFront),th.dss.stencilWriteMaskFront=tp.stencilWriteMaskFront),th.dss.stencilFuncBack===tp.stencilFuncBack&&th.dss.stencilRefBack===tp.stencilRefBack&&th.dss.stencilReadMaskBack===tp.stencilReadMaskBack||(ta.stencilFuncSeparate(ta.BACK,XE[tp.stencilFuncBack],tp.stencilRefBack,tp.stencilReadMaskBack),th.dss.stencilFuncBack=tp.stencilFuncBack,th.dss.stencilRefBack=tp.stencilRefBack,th.dss.stencilReadMaskBack=tp.stencilReadMaskBack),th.dss.stencilFailOpBack===tp.stencilFailOpBack&&th.dss.stencilZFailOpBack===tp.stencilZFailOpBack&&th.dss.stencilPassOpBack===tp.stencilPassOpBack||(ta.stencilOpSeparate(ta.BACK,XC[tp.stencilFailOpBack],XC[tp.stencilZFailOpBack],XC[tp.stencilPassOpBack]),th.dss.stencilFailOpBack=tp.stencilFailOpBack,th.dss.stencilZFailOpBack=tp.stencilZFailOpBack,th.dss.stencilPassOpBack=tp.stencilPassOpBack),th.dss.stencilWriteMaskBack!==tp.stencilWriteMaskBack&&(ta.stencilMaskSeparate(ta.BACK,tp.stencilWriteMaskBack),th.dss.stencilWriteMaskBack=tp.stencilWriteMaskBack));var tm=v.bs;if(tm){th.bs.isA2C!==tm.isA2C&&(tm.isA2C?ta.enable(ta.SAMPLE_ALPHA_TO_COVERAGE):ta.disable(ta.SAMPLE_ALPHA_TO_COVERAGE),th.bs.isA2C=tm.isA2C),th.bs.blendColor.x===tm.blendColor.x&&th.bs.blendColor.y===tm.blendColor.y&&th.bs.blendColor.z===tm.blendColor.z&&th.bs.blendColor.w===tm.blendColor.w||(ta.blendColor(tm.blendColor.x,tm.blendColor.y,tm.blendColor.z,tm.blendColor.w),th.bs.blendColor.x=tm.blendColor.x,th.bs.blendColor.y=tm.blendColor.y,th.bs.blendColor.z=tm.blendColor.z,th.bs.blendColor.w=tm.blendColor.w);var tg=tm.targets[0],tv=th.bs.targets[0];tv.blend!==tg.blend&&(tg.blend?ta.enable(ta.BLEND):ta.disable(ta.BLEND),tv.blend=tg.blend),tv.blendEq===tg.blendEq&&tv.blendAlphaEq===tg.blendAlphaEq||(ta.blendEquationSeparate(Xb[tg.blendEq],Xb[tg.blendAlphaEq]),tv.blendEq=tg.blendEq,tv.blendAlphaEq=tg.blendAlphaEq),tv.blendSrc===tg.blendSrc&&tv.blendDst===tg.blendDst&&tv.blendSrcAlpha===tg.blendSrcAlpha&&tv.blendDstAlpha===tg.blendDstAlpha||(ta.blendFuncSeparate(XR[tg.blendSrc],XR[tg.blendDst],XR[tg.blendSrcAlpha],XR[tg.blendDstAlpha]),tv.blendSrc=tg.blendSrc,tv.blendDst=tg.blendDst,tv.blendSrcAlpha=tg.blendSrcAlpha,tv.blendDstAlpha=tg.blendDstAlpha),tv.blendColorMask!==tg.blendColorMask&&(ta.colorMask((tg.blendColorMask&oV.R)!==oV.NONE,(tg.blendColorMask&oV.G)!==oV.NONE,(tg.blendColorMask&oV.B)!==oV.NONE,(tg.blendColorMask&oV.A)!==oV.NONE),tv.blendColorMask=tg.blendColorMask)}}if(v&&v.gpuPipelineLayout&&tu){for(var ty=tu.glBlocks.length,tS=v.gpuPipelineLayout.dynamicOffsetIndices,tA=0;tA<ty;tA++){var tT=tu.glBlocks[tA],tE=O[tT.set],tC=tE&&tE.descriptorIndices[tT.binding],tx=tC>=0&&tE.gpuDescriptors[tC],tb=null,tw=0;if(tx&&tx.gpuBuffer){var tI=tx.gpuBuffer,tB=tS[tT.set],tP=tB&&tB[tT.binding];tP>=0&&(tw=X[tP]),"vf32"in tI?tb=tI.vf32:(tw+=tI.offset,tb=tI.gpuBuffer.vf32),tw>>=2}if(tb)for(var tD=tT.glActiveUniforms.length,tM=0;tM<tD;tM++){var tO=tT.glActiveUniforms[tM];switch(tO.glType){case ta.BOOL:case ta.INT:for(var tk=0;tk<tO.array.length;++tk){var tG=tO.offset+tw+tk;if(tb[tG]!==tO.array[tk]){for(var tV=tk,tU=tG;tV<tO.array.length;++tV,++tU)tO.array[tV]=tb[tU];ta.uniform1iv(tO.glLoc,tO.array);break}}break;case ta.BOOL_VEC2:case ta.INT_VEC2:for(var tH=0;tH<tO.array.length;++tH){var tz=tO.offset+tw+tH;if(tb[tz]!==tO.array[tH]){for(var tW=tH,tj=tz;tW<tO.array.length;++tW,++tj)tO.array[tW]=tb[tj];ta.uniform2iv(tO.glLoc,tO.array);break}}break;case ta.BOOL_VEC3:case ta.INT_VEC3:for(var tq=0;tq<tO.array.length;++tq){var tK=tO.offset+tw+tq;if(tb[tK]!==tO.array[tq]){for(var tZ=tq,tQ=tK;tZ<tO.array.length;++tZ,++tQ)tO.array[tZ]=tb[tQ];ta.uniform3iv(tO.glLoc,tO.array);break}}break;case ta.BOOL_VEC4:case ta.INT_VEC4:for(var t$=0;t$<tO.array.length;++t$){var t0=tO.offset+tw+t$;if(tb[t0]!==tO.array[t$]){for(var t2=t$,t3=t0;t2<tO.array.length;++t2,++t3)tO.array[t2]=tb[t3];ta.uniform4iv(tO.glLoc,tO.array);break}}break;case ta.FLOAT:for(var t4=0;t4<tO.array.length;++t4){var t8=tO.offset+tw+t4;if(tb[t8]!==tO.array[t4]){for(var t6=t4,t7=t8;t6<tO.array.length;++t6,++t7)tO.array[t6]=tb[t7];ta.uniform1fv(tO.glLoc,tO.array);break}}break;case ta.FLOAT_VEC2:for(var t9=0;t9<tO.array.length;++t9){var ee=tO.offset+tw+t9;if(tb[ee]!==tO.array[t9]){for(var en=t9,er=ee;en<tO.array.length;++en,++er)tO.array[en]=tb[er];ta.uniform2fv(tO.glLoc,tO.array);break}}break;case ta.FLOAT_VEC3:for(var es=0;es<tO.array.length;++es){var ea=tO.offset+tw+es;if(tb[ea]!==tO.array[es]){for(var eh=es,eu=ea;eh<tO.array.length;++eh,++eu)tO.array[eh]=tb[eu];ta.uniform3fv(tO.glLoc,tO.array);break}}break;case ta.FLOAT_VEC4:for(var ec=0;ec<tO.array.length;++ec){var e_=tO.offset+tw+ec;if(tb[e_]!==tO.array[ec]){for(var ef=ec,em=e_;ef<tO.array.length;++ef,++em)tO.array[ef]=tb[em];ta.uniform4fv(tO.glLoc,tO.array);break}}break;case ta.FLOAT_MAT2:for(var eg=0;eg<tO.array.length;++eg){var ey=tO.offset+tw+eg;if(tb[ey]!==tO.array[eg]){for(var eS=eg,eT=ey;eS<tO.array.length;++eS,++eT)tO.array[eS]=tb[eT];ta.uniformMatrix2fv(tO.glLoc,!1,tO.array);break}}break;case ta.FLOAT_MAT3:for(var eE=0;eE<tO.array.length;++eE){var eC=tO.offset+tw+eE;if(tb[eC]!==tO.array[eE]){for(var ex=eE,eb=eC;ex<tO.array.length;++ex,++eb)tO.array[ex]=tb[eb];ta.uniformMatrix3fv(tO.glLoc,!1,tO.array);break}}break;case ta.FLOAT_MAT4:for(var eR=0;eR<tO.array.length;++eR){var ew=tO.offset+tw+eR;if(tb[ew]!==tO.array[eR]){for(var eI=eR,eB=ew;eI<tO.array.length;++eI,++eB)tO.array[eI]=tb[eB];ta.uniformMatrix4fv(tO.glLoc,!1,tO.array);break}}}}}for(var eP=tu.glSamplerTextures.length,eD=0;eD<eP;eD++)for(var eM=tu.glSamplerTextures[eD],eO=O[eM.set],eL=eO&&eO.descriptorIndices[eM.binding],eF=eL>=0&&eO.gpuDescriptors[eL],ek=eM.units.length,eG=0;eG<ek;eG++){var eV=eM.units[eG];if(eF&&eF.gpuSampler){if(eF.gpuTexture&&eF.gpuTexture.size>0){var eU=eF.gpuTexture,eH=th.glTexUnits[eV];eH.glTexture!==eU.glTexture&&(th.texUnit!==eV&&(ta.activeTexture(ta.TEXTURE0+eV),th.texUnit=eV),eU.glTexture?ta.bindTexture(eU.glTarget,eU.glTexture):ta.bindTexture(eU.glTarget,g.nullTex2D.gpuTexture.glTexture),eH.glTexture=eU.glTexture);var ez=eF.gpuSampler;eU.isPowerOf2?(te=ez.glWrapS,ti=ez.glWrapT):(te=ta.CLAMP_TO_EDGE,ti=ta.CLAMP_TO_EDGE),tr=eU.isPowerOf2?eU.mipLevel<=1&&(ez.glMinFilter===ta.LINEAR_MIPMAP_NEAREST||ez.glMinFilter===ta.LINEAR_MIPMAP_LINEAR)?ta.LINEAR:ez.glMinFilter:ez.glMinFilter===ta.LINEAR||ez.glMinFilter===ta.LINEAR_MIPMAP_NEAREST||ez.glMinFilter===ta.LINEAR_MIPMAP_LINEAR?ta.LINEAR:ta.NEAREST,eU.glWrapS!==te&&(th.texUnit!==eV&&(ta.activeTexture(ta.TEXTURE0+eV),th.texUnit=eV),ta.texParameteri(eU.glTarget,ta.TEXTURE_WRAP_S,te),eU.glWrapS=te),eU.glWrapT!==ti&&(th.texUnit!==eV&&(ta.activeTexture(ta.TEXTURE0+eV),th.texUnit=eV),ta.texParameteri(eU.glTarget,ta.TEXTURE_WRAP_T,ti),eU.glWrapT=ti),eU.glMinFilter!==tr&&(th.texUnit!==eV&&(ta.activeTexture(ta.TEXTURE0+eV),th.texUnit=eV),ta.texParameteri(eU.glTarget,ta.TEXTURE_MIN_FILTER,tr),eU.glMinFilter=tr),eU.glMagFilter!==ez.glMagFilter&&(th.texUnit!==eV&&(ta.activeTexture(ta.TEXTURE0+eV),th.texUnit=eV),ta.texParameteri(eU.glTarget,ta.TEXTURE_MAG_FILTER,ez.glMagFilter),eU.glMagFilter=ez.glMagFilter)}eF=eO.gpuDescriptors[++eL]}}}if(S&&tu&&(tl||XF.gpuInputAssembler!==S)){XF.gpuInputAssembler=S;var eW=g.extensions.ANGLE_instanced_arrays;if(g.extensions.useVAO){var ej=g.extensions.OES_vertex_array_object,eq=S.glVAOs.get(tu.glProgram);if(!eq){var eY;eq=ej.createVertexArrayOES(),S.glVAOs.set(tu.glProgram,eq),ej.bindVertexArrayOES(eq),ta.bindBuffer(ta.ARRAY_BUFFER,null),ta.bindBuffer(ta.ELEMENT_ARRAY_BUFFER,null),th.glArrayBuffer=null,th.glElementArrayBuffer=null;for(var eK=tu.glInputs.length,eJ=0;eJ<eK;eJ++){var eZ=tu.glInputs[eJ];eY=null;for(var eQ=S.glAttribs.length,e$=0;e$<eQ;e$++){var e0=S.glAttribs[e$];if(e0.name===eZ.name){eY=e0;break}}if(eY){th.glArrayBuffer!==eY.glBuffer&&(ta.bindBuffer(ta.ARRAY_BUFFER,eY.glBuffer),th.glArrayBuffer=eY.glBuffer);for(var e2=0;e2<eY.componentCount;++e2){var e3=eZ.glLoc+e2,e4=eY.offset+eY.size*e2;ta.enableVertexAttribArray(e3),th.glCurrentAttribLocs[e3]=!0,ta.vertexAttribPointer(e3,eY.count,eY.glType,eY.isNormalized,eY.stride,e4),eW&&eW.vertexAttribDivisorANGLE(e3,eY.isInstanced?1:0)}}}var e8=S.gpuIndexBuffer;e8&&ta.bindBuffer(ta.ELEMENT_ARRAY_BUFFER,e8.glBuffer),ej.bindVertexArrayOES(null),ta.bindBuffer(ta.ARRAY_BUFFER,null),ta.bindBuffer(ta.ELEMENT_ARRAY_BUFFER,null),th.glArrayBuffer=null,th.glElementArrayBuffer=null}th.glVAO!==eq&&(ej.bindVertexArrayOES(eq),th.glVAO=eq)}else{for(var e6=0;e6<g.capabilities.maxVertexAttributes;++e6)th.glCurrentAttribLocs[e6]=!1;for(var e7=tu.glInputs.length,e9=0;e9<e7;e9++){for(var ir=tu.glInputs[e9],is=null,ia=S.glAttribs.length,ih=0;ih<ia;ih++){var iu=S.glAttribs[ih];if(iu.name===ir.name){is=iu;break}}if(is){th.glArrayBuffer!==is.glBuffer&&(ta.bindBuffer(ta.ARRAY_BUFFER,is.glBuffer),th.glArrayBuffer=is.glBuffer);for(var ic=0;ic<is.componentCount;++ic){var i_=ir.glLoc+ic,id=is.offset+is.size*ic;!th.glEnabledAttribLocs[i_]&&i_>=0&&(ta.enableVertexAttribArray(i_),th.glEnabledAttribLocs[i_]=!0),th.glCurrentAttribLocs[i_]=!0,ta.vertexAttribPointer(i_,is.count,is.glType,is.isNormalized,is.stride,id),eW&&eW.vertexAttribDivisorANGLE(i_,is.isInstanced?1:0)}}}var ip=S.gpuIndexBuffer;ip&&th.glElementArrayBuffer!==ip.glBuffer&&(ta.bindBuffer(ta.ELEMENT_ARRAY_BUFFER,ip.glBuffer),th.glElementArrayBuffer=ip.glBuffer);for(var im=0;im<g.capabilities.maxVertexAttributes;++im)th.glEnabledAttribLocs[im]!==th.glCurrentAttribLocs[im]&&(ta.disableVertexAttribArray(im),th.glEnabledAttribLocs[im]=!1)}}if(v&&v.dynamicStates.length)for(var ig=v.dynamicStates.length,iS=0;iS<ig;iS++)switch(v.dynamicStates[iS]){case o0.LINE_WIDTH:th.rs.lineWidth!==Y.lineWidth&&(ta.lineWidth(Y.lineWidth),th.rs.lineWidth=Y.lineWidth);break;case o0.DEPTH_BIAS:th.rs.depthBias===Y.depthBiasConstant&&th.rs.depthBiasSlop===Y.depthBiasSlope||(ta.polygonOffset(Y.depthBiasConstant,Y.depthBiasSlope),th.rs.depthBias=Y.depthBiasConstant,th.rs.depthBiasSlop=Y.depthBiasSlope);break;case o0.BLEND_CONSTANTS:var iT=Y.blendConstant;th.bs.blendColor.x===iT.x&&th.bs.blendColor.y===iT.y&&th.bs.blendColor.z===iT.z&&th.bs.blendColor.w===iT.w||(ta.blendColor(iT.x,iT.y,iT.z,iT.w),th.bs.blendColor.copy(iT));break;case o0.STENCIL_WRITE_MASK:var iE=Y.stencilStatesFront,iC=Y.stencilStatesBack;th.dss.stencilWriteMaskFront!==iE.writeMask&&(ta.stencilMaskSeparate(ta.FRONT,iE.writeMask),th.dss.stencilWriteMaskFront=iE.writeMask),th.dss.stencilWriteMaskBack!==iC.writeMask&&(ta.stencilMaskSeparate(ta.BACK,iC.writeMask),th.dss.stencilWriteMaskBack=iC.writeMask);break;case o0.STENCIL_COMPARE_MASK:var ix=Y.stencilStatesFront,ib=Y.stencilStatesBack;th.dss.stencilRefFront===ix.reference&&th.dss.stencilReadMaskFront===ix.compareMask||(ta.stencilFuncSeparate(ta.FRONT,XE[th.dss.stencilFuncFront],ix.reference,ix.compareMask),th.dss.stencilRefFront=ix.reference,th.dss.stencilReadMaskFront=ix.compareMask),th.dss.stencilRefBack===ib.reference&&th.dss.stencilReadMaskBack===ib.compareMask||(ta.stencilFuncSeparate(ta.BACK,XE[th.dss.stencilFuncBack],ib.reference,ib.compareMask),th.dss.stencilRefBack=ib.reference,th.dss.stencilReadMaskBack=ib.compareMask)}}function z$(g,v){var S=g.gl,O=g.extensions,X=O.ANGLE_instanced_arrays,Y=O.WEBGL_multi_draw,te=XF.gpuInputAssembler,ti=XF.glPrimitive;if(te){var tr=te.gpuIndexBuffer;if(te.gpuIndirectBuffer){var ta=te.gpuIndirectBuffer.indirects;if(ta.drawByIndex){for(var th=0;th<ta.drawCount;th++)ta.byteOffsets[th]=ta.offsets[th]*tr.stride;if(Y)ta.instancedDraw?Y.multiDrawElementsInstancedWEBGL(ti,ta.counts,0,te.glIndexType,ta.byteOffsets,0,ta.instances,0,ta.drawCount):Y.multiDrawElementsWEBGL(ti,ta.counts,0,te.glIndexType,ta.byteOffsets,0,ta.drawCount);else for(var tu=0;tu<ta.drawCount;tu++)ta.instances[tu]&&X?X.drawElementsInstancedANGLE(ti,ta.counts[tu],te.glIndexType,ta.byteOffsets[tu],ta.instances[tu]):S.drawElements(ti,ta.counts[tu],te.glIndexType,ta.byteOffsets[tu])}else if(Y)ta.instancedDraw?Y.multiDrawArraysInstancedWEBGL(ti,ta.offsets,0,ta.counts,0,ta.instances,0,ta.drawCount):Y.multiDrawArraysWEBGL(ti,ta.offsets,0,ta.counts,0,ta.drawCount);else for(var tl=0;tl<ta.drawCount;tl++)ta.instances[tl]&&X?X.drawArraysInstancedANGLE(ti,ta.offsets[tl],ta.counts[tl],ta.instances[tl]):S.drawArrays(ti,ta.offsets[tl],ta.counts[tl])}else if(v.instanceCount&&X){if(tr){if(v.indexCount>0){var tc=v.firstIndex*tr.stride;X.drawElementsInstancedANGLE(ti,v.indexCount,te.glIndexType,tc,v.instanceCount)}}else v.vertexCount>0&&X.drawArraysInstancedANGLE(ti,v.firstVertex,v.vertexCount,v.instanceCount)}else if(tr){if(v.indexCount>0){var t_=v.firstIndex*tr.stride;S.drawElements(ti,v.indexCount,te.glIndexType,t_)}}else v.vertexCount>0&&S.drawArrays(ti,v.firstVertex,v.vertexCount)}}var Xk=new Array(XT.COUNT);function X$(g,v){Xk.fill(0);for(var S=0;S<v.cmds.length;++S){var O=v.cmds.array[S],X=Xk[O]++;switch(O){case XT.BEGIN_RENDER_PASS:var Y=v.beginRenderPassCmds.array[X];U$(g,Y.gpuRenderPass,Y.gpuFramebuffer,Y.renderArea,Y.clearColors,Y.clearDepth,Y.clearStencil);break;case XT.BIND_STATES:var te=v.bindStatesCmds.array[X];H$(g,te.gpuPipelineState,te.gpuInputAssembler,te.gpuDescriptorSets,te.dynamicOffsets,te.dynamicStates);break;case XT.DRAW:z$(g,v.drawCmds.array[X].drawInfo);break;case XT.UPDATE_BUFFER:var ti=v.updateBufferCmds.array[X];M$(g,ti.gpuBuffer,ti.buffer,ti.offset,ti.size);break;case XT.COPY_BUFFER_TO_TEXTURE:var tr=v.copyBufferToTextureCmds.array[X];q$(g,tr.buffers,tr.gpuTexture,tr.regions);break;case XT.BLIT_TEXTURE:var ta=v.blitTextureCmds.array[X];K$(g,ta.srcTexture,ta.dstTexture,ta.regions,ta.filter)}}}var XG=new Uint8Array(1);function Y$(g,v,S,O,X){var Y=O_(v).height,te=w_(v,X.width,X.height,X.depth),ti=w_(v,O.width,1,1),tr=w_(v,O.width,O.height,1),ta=w_(v,X.width,1,1),th=D_(uf[v]);XG.byteLength<te&&(XG=new Uint8Array(te));for(var tu=0,tl=S,tc=0;tc<X.depth;tc++){tl=S+tr*tc;for(var t_=0;t_<X.height;t_+=Y)XG.subarray(tu,tu+ta).set(new Uint8Array(g.buffer,g.byteOffset+tl,ta)),tu+=ta,tl+=ti}var tf=te/th.BYTES_PER_ELEMENT;return $(Number.isInteger(tf),9101),new th(XG.buffer,0,tf)}function q$(g,v,S,O){var X=g.gl,Y=g.stateCache.glTexUnits[g.stateCache.texUnit];Y.glTexture!==S.glTexture&&(X.bindTexture(S.glTarget,S.glTexture),Y.glTexture=S.glTexture);var te=0,ti=0,tr=uf[S.format],ta=D_(tr),th=tr.isCompressed,tu=O_(S.format),tl=new hc,tc=new hu,t_=new hc;switch(S.glTarget){case X.TEXTURE_2D:for(var tf=0;tf<O.length;tf++){var tp=O[tf],tm=tp.texSubres.mipLevel;tc.x=0===tp.texOffset.x?0:M_(tp.texOffset.x,tu.width),tc.y=0===tp.texOffset.y?0:M_(tp.texOffset.y,tu.height),tl.width=tp.texExtent.width<tu.width?tp.texExtent.width:M_(tp.texExtent.width,tu.width),tl.height=tp.texExtent.height<tu.height?tp.texExtent.width:M_(tp.texExtent.height,tu.height),t_.width=tp.buffStride>0?tp.buffStride:tl.width,t_.height=tp.buffTexHeight>0?tp.buffTexHeight:tl.height;var tg=tp.texExtent.width+tc.x===S.width>>tm?tp.texExtent.width:tl.width,tv=tp.texExtent.height+tc.y===S.height>>tm?tp.texExtent.height:tl.height,ty=void 0,tS=v[te++];if(t_.width===tl.width&&t_.height===tl.height){var tA=w_(S.format,tg,tv,1)/ta.BYTES_PER_ELEMENT;$(Number.isInteger(tA),9101),ty=new ta(tS.buffer,tS.byteOffset+tp.buffOffset,tA)}else ty=Y$(tS,S.format,tp.buffOffset,t_,tl);th?S.glInternalFmt===Xp.COMPRESSED_RGB_ETC1_WEBGL||g.extensions.noCompressedTexSubImage2D?X.compressedTexImage2D(X.TEXTURE_2D,tm,S.glInternalFmt,tg,tv,0,ty):X.compressedTexSubImage2D(X.TEXTURE_2D,tm,tc.x,tc.y,tg,tv,S.glFormat,ty):X.texSubImage2D(X.TEXTURE_2D,tm,tc.x,tc.y,tg,tv,S.glFormat,S.glType,ty)}break;case X.TEXTURE_CUBE_MAP:for(var tT=0;tT<O.length;tT++){var tE=O[tT],tC=tE.texSubres.mipLevel;tc.x=0===tE.texOffset.x?0:M_(tE.texOffset.x,tu.width),tc.y=0===tE.texOffset.y?0:M_(tE.texOffset.y,tu.height),tl.width=tE.texExtent.width<tu.width?tE.texExtent.width:M_(tE.texExtent.width,tu.width),tl.height=tE.texExtent.height<tu.height?tE.texExtent.width:M_(tE.texExtent.height,tu.height),t_.width=tE.buffStride>0?tE.buffStride:tl.width,t_.height=tE.buffTexHeight>0?tE.buffTexHeight:tl.height;var tx=tE.texExtent.width+tc.x===S.width>>tC?tE.texExtent.width:tl.width,tb=tE.texExtent.height+tc.y===S.height>>tC?tE.texExtent.height:tl.height,tw=tE.texSubres.baseArrayLayer+tE.texSubres.layerCount;for(ti=tE.texSubres.baseArrayLayer;ti<tw;++ti){var tI=void 0,tB=v[te++];if(t_.width===tl.width&&t_.height===tl.height){var tP=w_(S.format,tx,tb,1)/ta.BYTES_PER_ELEMENT;$(Number.isInteger(tP),9101),tI=new ta(tB.buffer,tB.byteOffset+tE.buffOffset,tP)}else tI=Y$(tB,S.format,tE.buffOffset,t_,tl);th?S.glInternalFmt===Xp.COMPRESSED_RGB_ETC1_WEBGL||g.extensions.noCompressedTexSubImage2D?X.compressedTexImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ti,tC,S.glInternalFmt,tx,tb,0,tI):X.compressedTexSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ti,tC,tc.x,tc.y,tx,tb,S.glFormat,tI):X.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ti,tC,tc.x,tc.y,tx,tb,S.glFormat,S.glType,tI)}}break;default:k("Unsupported GL texture type, copy buffer to texture failed.")}S.flags&oB.GEN_MIPMAP&&X.generateMipmap(S.glTarget)}function K$(g,v,S,O,X){g.blitManager.draw(v,S,O,X)}var XV=function(){function t1(){this.counts=void 0,this.offsets=void 0,this.instances=void 0,this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this.byteOffsets=void 0,this._capacity=4,this.counts=new Int32Array(this._capacity),this.offsets=new Int32Array(this._capacity),this.instances=new Int32Array(this._capacity),this.byteOffsets=new Int32Array(this._capacity)}var g=t1.prototype;return g.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},g.setDrawInfo=function(g,v){this._ensureCapacity(g),this.drawByIndex=v.indexCount>0,this.instancedDraw=!!v.instanceCount,this.drawCount=Math.max(g+1,this.drawCount),this.drawByIndex?(this.counts[g]=v.indexCount,this.offsets[g]=v.firstIndex):(this.counts[g]=v.vertexCount,this.offsets[g]=v.firstVertex),this.instances[g]=Math.max(1,v.instanceCount)},g._ensureCapacity=function(g){if(!(this._capacity>g)){this._capacity=wi(g);var v=new Int32Array(this._capacity),S=new Int32Array(this._capacity),O=new Int32Array(this._capacity);this.byteOffsets=new Int32Array(this._capacity),v.set(this.counts),S.set(this.offsets),O.set(this.instances),this.counts=v,this.offsets=S,this.instances=O}},t1}(),XU=function(){function t1(){this._gpuShader=null,this._gpuDescriptorSetLayout=null,this._gpuPipelineLayout=null,this._gpuPipelineState=null,this._gpuVertexBuffer=null,this._gpuInputAssembler=null,this._gpuPointSampler=null,this._gpuLinearSampler=null,this._gpuDescriptorSet=null,this._gpuUniformBuffer=null,this._drawInfo=null,this._glFramebuffer=null,this._uniformBuffer=null;var g=XA.instance.gl,v=XA.instance.bindingMappingInfo.maxBlockCounts[0];this._gpuShader={name:"Blit Pass",blocks:[new hL(0,0,"BlitParams",[new hM("tilingOffsetSrc",oE.FLOAT4,1),new hM("tilingOffsetDst",oE.FLOAT4,1)],1)],samplerTextures:[new hF(0,v,"textureSrc",oE.SAMPLER2D,1)],subpassInputs:[],gpuStages:[{type:oU.VERTEX,source:"\n                    precision mediump float;\n\n                    attribute vec2 a_position;\n                    attribute vec2 a_texCoord;\n            \n                    uniform vec4 tilingOffsetSrc;\n                    uniform vec4 tilingOffsetDst;\n            \n                    varying vec2 v_texCoord;\n            \n                    void main() {\n                        v_texCoord = a_texCoord * tilingOffsetSrc.xy + tilingOffsetSrc.zw;\n                        gl_Position = vec4((a_position + 1.0) * tilingOffsetDst.xy - 1.0 + tilingOffsetDst.zw * 2.0, 0, 1);\n                    }",glShader:null},{type:oU.FRAGMENT,source:"\n                    precision mediump float;\n                    uniform sampler2D textureSrc;\n\n                    varying vec2 v_texCoord;\n                    \n                    void main() {\n                        gl_FragColor = texture2D(textureSrc, v_texCoord);\n                    }",glShader:null}],glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]},L$(XA.instance,this._gpuShader),this._gpuDescriptorSetLayout={bindings:[new h3(0,o2.UNIFORM_BUFFER,1,oU.VERTEX),new h3(v,o2.SAMPLER_TEXTURE,1,oU.FRAGMENT)],dynamicBindings:[],descriptorIndices:[],descriptorCount:v+1};for(var S=0;S<v;S++)this._gpuDescriptorSetLayout.descriptorIndices[S]=0;this._gpuDescriptorSetLayout.descriptorIndices.push(1),this._gpuPipelineLayout={gpuSetLayouts:[this._gpuDescriptorSetLayout],dynamicOffsetCount:0,dynamicOffsetOffsets:[0],dynamicOffsetIndices:[[]]},this._gpuPipelineState={glPrimitive:g.TRIANGLE_STRIP,gpuShader:this._gpuShader,gpuPipelineLayout:this._gpuPipelineLayout,rs:null,dss:new uL(!1,!1),bs:null,dynamicStates:[],gpuRenderPass:null},this._gpuVertexBuffer={usage:oC.VERTEX,memUsage:oR.DEVICE,size:16*Float32Array.BYTES_PER_ELEMENT,stride:4*Float32Array.BYTES_PER_ELEMENT,buffer:null,vf32:null,indirects:new XV,glTarget:0,glBuffer:null},D$(XA.instance,this._gpuVertexBuffer),XA.instance.memoryStatus.bufferSize+=this._gpuVertexBuffer.size;var O=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);M$(XA.instance,this._gpuVertexBuffer,O,0,O.length),this._gpuInputAssembler={attributes:[new hz("a_position",oA.RG32F),new hz("a_texCoord",oA.RG32F)],gpuVertexBuffers:[this._gpuVertexBuffer],gpuIndexBuffer:null,gpuIndirectBuffer:null,glAttribs:[],glIndexType:0,glVAOs:new Map},N$(XA.instance,this._gpuInputAssembler),this._gpuPointSampler={glMinFilter:9728,glMagFilter:9728,glWrapS:10497,glWrapT:10497,glWrapR:10497},this._gpuLinearSampler={glMinFilter:9729,glMagFilter:9729,glWrapS:10497,glWrapT:10497,glWrapR:10497},this._uniformBuffer=new Float32Array(8),this._gpuUniformBuffer={usage:oC.UNIFORM,memUsage:oR.DEVICE,size:8*Float32Array.BYTES_PER_ELEMENT,stride:8*Float32Array.BYTES_PER_ELEMENT,buffer:this._uniformBuffer,vf32:null,indirects:new XV,glTarget:0,glBuffer:null},D$(XA.instance,this._gpuUniformBuffer),XA.instance.memoryStatus.bufferSize+=this._gpuUniformBuffer.size,this._gpuDescriptorSet={gpuDescriptors:[{type:o2.UNIFORM_BUFFER,gpuBuffer:this._gpuUniformBuffer,gpuTexture:null,gpuSampler:null},{type:o2.SAMPLER_TEXTURE,gpuBuffer:null,gpuTexture:null,gpuSampler:null}],descriptorIndices:this._gpuDescriptorSetLayout.descriptorIndices},this._drawInfo=new hR(4,0,0,0,0,0,0),this._glFramebuffer=XA.instance.gl.createFramebuffer()}var g=t1.prototype;return g.destroy=function(){this._glFramebuffer&&(XA.instance.gl.deleteFramebuffer(this._glFramebuffer),this._glFramebuffer=null),this._gpuVertexBuffer&&(XA.instance.memoryStatus.bufferSize-=this._gpuVertexBuffer.size,O$(XA.instance,this._gpuVertexBuffer)),this._gpuUniformBuffer&&(XA.instance.memoryStatus.bufferSize-=this._gpuUniformBuffer.size,O$(XA.instance,this._gpuUniformBuffer)),this._gpuShader&&F$(XA.instance,this._gpuShader),this._gpuInputAssembler&&G$(XA.instance,this._gpuInputAssembler)},g.draw=function(g,v,S,O){var X=XA.instance,Y=X.gl,te=X.stateCache,ti=te.glFramebuffer;if(Y.viewport(0,0,v.width,v.height),Y.scissor(0,0,v.width,v.height),this._uniformBuffer&&this._gpuUniformBuffer&&this._gpuPipelineState&&this._gpuInputAssembler&&this._gpuDescriptorSet&&this._drawInfo){var tr=this._gpuDescriptorSet.gpuDescriptors[1];tr.gpuTexture=g,tr.gpuSampler=O===oO.POINT?this._gpuPointSampler:this._gpuLinearSampler;var ta=uf[v.format],th=Y.COLOR_ATTACHMENT0;ta.hasStencil?th=Y.DEPTH_STENCIL_ATTACHMENT:ta.hasDepth&&(th=Y.DEPTH_ATTACHMENT);var tu=S.map(function(g,v){return v});tu.sort(function(g,v){return S[g].srcSubres.mipLevel-S[v].srcSubres.mipLevel}),te.glFramebuffer!==this._glFramebuffer&&(X.gl.bindFramebuffer(X.gl.FRAMEBUFFER,this._glFramebuffer),te.glFramebuffer=this._glFramebuffer);var tl=S[0].dstSubres.mipLevel;v.glTexture?Y.framebufferTexture2D(Y.FRAMEBUFFER,th,v.glTarget,v.glTexture,tl):Y.framebufferRenderbuffer(Y.FRAMEBUFFER,th,Y.RENDERBUFFER,v.glRenderbuffer);for(var tc=0;tc<tu.length;++tc){var t_=S[tu[tc]];g.glTexture&&tl!==t_.srcSubres.mipLevel&&(tl=t_.srcSubres.mipLevel,Y.framebufferTexture2D(Y.FRAMEBUFFER,th,v.glTarget,v.glTexture,tl));var tf=g.width,tp=g.height,tm=v.width,tg=v.height;this._uniformBuffer[0]=t_.srcExtent.width/tf,this._uniformBuffer[1]=t_.srcExtent.height/tp,this._uniformBuffer[2]=t_.srcOffset.x/tf,this._uniformBuffer[3]=t_.srcOffset.y/tp,this._uniformBuffer[4]=t_.dstExtent.width/tm,this._uniformBuffer[5]=t_.dstExtent.height/tg,this._uniformBuffer[6]=t_.dstOffset.x/tm,this._uniformBuffer[7]=t_.dstOffset.y/tg,M$(X,this._gpuUniformBuffer,this._uniformBuffer,0,this._uniformBuffer.length*Float32Array.BYTES_PER_ELEMENT),H$(X,this._gpuPipelineState,this._gpuInputAssembler,[this._gpuDescriptorSet],[],null),z$(X,this._drawInfo)}te.glFramebuffer!==ti&&(X.gl.bindFramebuffer(X.gl.FRAMEBUFFER,ti),te.glFramebuffer=ti);var tv=te.viewport;Y.viewport(tv.left,tv.top,tv.width,tv.height);var ty=te.scissorRect;Y.scissor(ty.x,ty.y,ty.width,ty.height)}},t1}(),XH=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuBuffer=null,v._gpuBufferView=null,v._uniformBuffer=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){if("buffer"in g){this._isBufferView=!0;var v=g.buffer;this._usage=v.usage,this._memUsage=v.memUsage,this._size=this._stride=g.range,this._count=1,this._flags=v.flags,this._gpuBufferView={gpuBuffer:v.gpuBuffer,offset:g.offset,range:g.range}}else this._usage=g.usage,this._memUsage=g.memUsage,this._size=g.size,this._stride=Math.max(g.stride||this._size,1),this._count=this._size/this._stride,this._flags=g.flags,this._usage&oC.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:new XV,glTarget:0,glBuffer:null},this._usage&oC.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),D$(XA.instance,this._gpuBuffer),XA.instance.memoryStatus.bufferSize+=this._size},v.destroy=function(){this._gpuBuffer&&(O$(XA.instance,this._gpuBuffer),XA.instance.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},v.resize=function(g){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var v=this._size;v!==g&&(this._size=g,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(g)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=g,g>0&&(function(g,v){var S=g.gl,O=g.stateCache,X=v.memUsage&oR.HOST?S.DYNAMIC_DRAW:S.STATIC_DRAW;v.usage&oC.VERTEX?(g.extensions.useVAO&&O.glVAO&&(g.extensions.OES_vertex_array_object.bindVertexArrayOES(null),O.glVAO=null),XF.gpuInputAssembler=null,g.stateCache.glArrayBuffer!==v.glBuffer&&S.bindBuffer(S.ARRAY_BUFFER,v.glBuffer),v.buffer?S.bufferData(S.ARRAY_BUFFER,v.buffer,X):S.bufferData(S.ARRAY_BUFFER,v.size,X),S.bindBuffer(S.ARRAY_BUFFER,null),g.stateCache.glArrayBuffer=null):v.usage&oC.INDEX?(g.extensions.useVAO&&O.glVAO&&(g.extensions.OES_vertex_array_object.bindVertexArrayOES(null),O.glVAO=null),XF.gpuInputAssembler=null,g.stateCache.glElementArrayBuffer!==v.glBuffer&&S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,v.glBuffer),v.buffer?S.bufferData(S.ELEMENT_ARRAY_BUFFER,v.buffer,X):S.bufferData(S.ELEMENT_ARRAY_BUFFER,v.size,X),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,null),g.stateCache.glElementArrayBuffer=null):v.usage&oC.UNIFORM?v.buffer&&(v.vf32=new Float32Array(v.buffer.buffer)):(v.usage&oC.INDIRECT||v.usage&oC.TRANSFER_DST||v.usage&oC.TRANSFER_SRC||k("Unsupported BufferType, create buffer failed."),v.glTarget=S.NONE)}(XA.instance,this._gpuBuffer),XA.instance.memoryStatus.bufferSize-=v,XA.instance.memoryStatus.bufferSize+=g)))}},v.update=function(g,v){var S;this._isBufferView?console.warn("cannot update through buffer views!"):(S=void 0!==v?v:this._usage&oC.INDIRECT?0:g.byteLength,M$(XA.instance,this._gpuBuffer,g,0,S))},n(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),e}(uA),Xz=function(){function t1(g,v){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(v),this._freeCmds=new am(v);for(var S=0;S<v;++S)this._frees[S]=new g;this._freeIdx=v-1}var g=t1.prototype;return g.alloc=function(g){if(this._freeIdx<0){var v=2*this._frees.length,S=this._frees;this._frees=new Array(v);for(var O=v-S.length,X=0;X<O;++X)this._frees[X]=new g;for(var Y=O,te=0;Y<v;++Y,++te)this._frees[Y]=S[te];this._freeIdx+=O}var ti=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++ti.refCount,ti},g.free=function(g){0==--g.refCount&&this._freeCmds.push(g)},g.freeCmds=function(g){for(var v=0;v<g.length;++v)0==--g.array[v].refCount&&this._freeCmds.push(g.array[v])},g.release=function(){for(var g=0;g<this._freeCmds.length;++g){var v=this._freeCmds.array[g];v.clear(),this._frees[++this._freeIdx]=v}this._freeCmds.clear()},t1}(),XX=function(){function t1(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.blitTextureCmdPool=void 0,this.beginRenderPassCmdPool=new Xz(Xw,1),this.bindStatesCmdPool=new Xz(XI,1),this.drawCmdPool=new Xz(XB,1),this.updateBufferCmdPool=new Xz(XP,1),this.copyBufferToTextureCmdPool=new Xz(XD,1),this.blitTextureCmdPool=new Xz(XO,1)}var g=t1.prototype;return g.clearCmds=function(g){g.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(g.beginRenderPassCmds),g.beginRenderPassCmds.clear()),g.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(g.bindStatesCmds),g.bindStatesCmds.clear()),g.drawCmds.length&&(this.drawCmdPool.freeCmds(g.drawCmds),g.drawCmds.clear()),g.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(g.updateBufferCmds),g.updateBufferCmds.clear()),g.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(g.copyBufferToTextureCmds),g.copyBufferToTextureCmds.clear()),g.blitTextureCmds.length&&(this.blitTextureCmdPool.freeCmds(g.blitTextureCmds),g.blitTextureCmds.clear()),g.cmds.clear()},g.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release(),this.blitTextureCmdPool.release()},t1}(),Xj=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).cmdPackage=new XL,v._cmdAllocator=new XX,v._isInRenderPass=!1,v._curGPUPipelineState=null,v._curGPUInputAssembler=null,v._curGPUDescriptorSets=[],v._curDynamicOffsets=Array(8).fill(0),v._curDynamicStates=new uc,v._isStateInvalied=!1,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._type=g.type,this._queue=g.queue;for(var v=XA.instance.bindingMappings.blockOffsets.length,S=0;S<v;S++)this._curGPUDescriptorSets.push(null)},v.destroy=function(){this._cmdAllocator.clearCmds(this.cmdPackage)},v.begin=function(){this._cmdAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},v.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},v.beginRenderPass=function(g,v,S,O,X,Y){var te=this._cmdAllocator.beginRenderPassCmdPool.alloc(Xw);te.gpuRenderPass=g.gpuRenderPass,te.gpuFramebuffer=v.gpuFramebuffer,te.renderArea.copy(S),te.clearColors.length=O.length;for(var ti=0;ti<O.length;++ti)te.clearColors[ti]=O[ti];te.clearDepth=X,te.clearStencil=Y,this.cmdPackage.beginRenderPassCmds.push(te),this.cmdPackage.cmds.push(XT.BEGIN_RENDER_PASS),this._isInRenderPass=!0},v.endRenderPass=function(){this._isInRenderPass=!1},v.bindPipelineState=function(g){var v=g.gpuPipelineState;v!==this._curGPUPipelineState&&(this._curGPUPipelineState=v,this._isStateInvalied=!0)},v.bindDescriptorSet=function(g,v,S){var O=v.gpuDescriptorSet;if(O!==this._curGPUDescriptorSets[g]&&(this._curGPUDescriptorSets[g]=O,this._isStateInvalied=!0),S){var X,Y=null===(X=this._curGPUPipelineState)||void 0===X?void 0:X.gpuPipelineLayout;if(Y){for(var te=this._curDynamicOffsets,ti=Y.dynamicOffsetOffsets[g],tr=0;tr<S.length;tr++)te[ti+tr]=S[tr];this._isStateInvalied=!0}}},v.bindInputAssembler=function(g){var v=g.gpuInputAssembler;this._curGPUInputAssembler=v,this._isStateInvalied=!0},v.setViewport=function(g){var v=this._curDynamicStates.viewport;v.left===g.left&&v.top===g.top&&v.width===g.width&&v.height===g.height&&v.minDepth===g.minDepth&&v.maxDepth===g.maxDepth||(v.left=g.left,v.top=g.top,v.width=g.width,v.height=g.height,v.minDepth=g.minDepth,v.maxDepth=g.maxDepth,this._isStateInvalied=!0)},v.setScissor=function(g){var v=this._curDynamicStates.scissor;v.x===g.x&&v.y===g.y&&v.width===g.width&&v.height===g.height||(v.x=g.x,v.y=g.y,v.width=g.width,v.height=g.height,this._isStateInvalied=!0)},v.setLineWidth=function(g){this._curDynamicStates.lineWidth!==g&&(this._curDynamicStates.lineWidth=g,this._isStateInvalied=!0)},v.setDepthBias=function(g,v,S){var O=this._curDynamicStates;O.depthBiasConstant===g&&O.depthBiasClamp===v&&O.depthBiasSlope===S||(O.depthBiasConstant=g,O.depthBiasClamp=v,O.depthBiasSlope=S,this._isStateInvalied=!0)},v.setBlendConstants=function(g){var v=this._curDynamicStates.blendConstant;v.x===g.x&&v.y===g.y&&v.z===g.z&&v.w===g.w||(v.copy(g),this._isStateInvalied=!0)},v.setDepthBound=function(g,v){var S=this._curDynamicStates;S.depthMinBounds===g&&S.depthMaxBounds===v||(S.depthMinBounds=g,S.depthMaxBounds=v,this._isStateInvalied=!0)},v.setStencilWriteMask=function(g,v){var S=this._curDynamicStates.stencilStatesFront,O=this._curDynamicStates.stencilStatesBack;g&o1.FRONT&&S.writeMask!==v&&(S.writeMask=v,this._isStateInvalied=!0),g&o1.BACK&&O.writeMask!==v&&(O.writeMask=v,this._isStateInvalied=!0)},v.setStencilCompareMask=function(g,v,S){var O=this._curDynamicStates.stencilStatesFront,X=this._curDynamicStates.stencilStatesBack;g&o1.FRONT&&(O.compareMask===S&&O.reference===v||(O.reference=v,O.compareMask=S,this._isStateInvalied=!0)),g&o1.BACK&&(X.compareMask===S&&X.reference===v||(X.reference=v,X.compareMask=S,this._isStateInvalied=!0))},v.draw=function(g){if(this._type===o6.PRIMARY&&this._isInRenderPass||this._type===o6.SECONDARY){this._isStateInvalied&&this.bindStates();var v="drawInfo"in g?g.drawInfo:g,S=this._cmdAllocator.drawCmdPool.alloc(XB);S.drawInfo.copy(v),this.cmdPackage.drawCmds.push(S),this.cmdPackage.cmds.push(XT.DRAW),++this._numDrawCalls,this._numInstances+=v.instanceCount;var O=v.indexCount||v.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=O/3*Math.max(v.instanceCount,1);break;case 5:case 6:this._numTris+=(O-2)*Math.max(v.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},v.updateBuffer=function(g,v,S){if((this._type!==o6.PRIMARY||this._isInRenderPass)&&this._type!==o6.SECONDARY)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var O=g.gpuBuffer;if(O){var X,Y=this._cmdAllocator.updateBufferCmdPool.alloc(XP),te=0;g.usage&oC.INDIRECT||(te=void 0!==S?S:v.byteLength),X=v,Y.gpuBuffer=O,Y.buffer=X,Y.offset=0,Y.size=te,this.cmdPackage.updateBufferCmds.push(Y),this.cmdPackage.cmds.push(XT.UPDATE_BUFFER)}}},v.copyBuffersToTexture=function(g,v,S){if((this._type!==o6.PRIMARY||this._isInRenderPass)&&this._type!==o6.SECONDARY)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var O=v.gpuTexture;if(O){var X=this._cmdAllocator.copyBufferToTextureCmdPool.alloc(XD);X&&(X.gpuTexture=O,X.regions=S,X.buffers=g,this.cmdPackage.copyBufferToTextureCmds.push(X),this.cmdPackage.cmds.push(XT.COPY_BUFFER_TO_TEXTURE))}}},v.execute=function(g,v){for(var S=0;S<v;++S){for(var O=g[S],X=0;X<O.cmdPackage.beginRenderPassCmds.length;++X){var Y=O.cmdPackage.beginRenderPassCmds.array[X];++Y.refCount,this.cmdPackage.beginRenderPassCmds.push(Y)}for(var te=0;te<O.cmdPackage.bindStatesCmds.length;++te){var ti=O.cmdPackage.bindStatesCmds.array[te];++ti.refCount,this.cmdPackage.bindStatesCmds.push(ti)}for(var tr=0;tr<O.cmdPackage.drawCmds.length;++tr){var ta=O.cmdPackage.drawCmds.array[tr];++ta.refCount,this.cmdPackage.drawCmds.push(ta)}for(var th=0;th<O.cmdPackage.updateBufferCmds.length;++th){var tu=O.cmdPackage.updateBufferCmds.array[th];++tu.refCount,this.cmdPackage.updateBufferCmds.push(tu)}for(var tl=0;tl<O.cmdPackage.copyBufferToTextureCmds.length;++tl){var tc=O.cmdPackage.copyBufferToTextureCmds.array[tl];++tc.refCount,this.cmdPackage.copyBufferToTextureCmds.push(tc)}for(var t_=0;t_<O.cmdPackage.blitTextureCmds.length;++t_){var tf=O.cmdPackage.blitTextureCmds.array[t_];++tf.refCount,this.cmdPackage.blitTextureCmds.push(tf)}this.cmdPackage.cmds.concat(O.cmdPackage.cmds.array),this._numDrawCalls+=O._numDrawCalls,this._numInstances+=O._numInstances,this._numTris+=O._numTris}},v.pipelineBarrier=function(){},v.bindStates=function(){var g=this._cmdAllocator.bindStatesCmdPool.alloc(XI);g&&(g.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(g.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(g.dynamicOffsets,this._curDynamicOffsets),g.gpuInputAssembler=this._curGPUInputAssembler,g.dynamicStates.copy(this._curDynamicStates),this.cmdPackage.bindStatesCmds.push(g),this.cmdPackage.cmds.push(XT.BIND_STATES),this._isStateInvalied=!1)},v.blitTexture=function(g,v,S,O){var X=this._cmdAllocator.blitTextureCmdPool.alloc(XO);X.srcTexture=g.gpuTexture,X.dstTexture=v.gpuTexture,X.regions=S,X.filter=O,++this._numDrawCalls,this.cmdPackage.blitTextureCmds.push(X),this.cmdPackage.cmds.push(XT.BLIT_TEXTURE)},e}(uT),Xq=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuFramebuffer=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._renderPass=g.renderPass,this._colorTextures=g.colorTextures||[],this._depthStencilTexture=g.depthStencilTexture||null;for(var v=0,S=[],O=0;O<g.colorTextures.length;++O){var X=g.colorTextures[O];X&&(S.push(X.gpuTexture),v=X.lodLevel)}var Y=null;g.depthStencilTexture&&(Y=g.depthStencilTexture.gpuTexture,v=g.depthStencilTexture.lodLevel);var te=Number.MAX_SAFE_INTEGER,ti=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:g.renderPass.gpuRenderPass,gpuColorTextures:S,gpuDepthStencilTexture:Y,glFramebuffer:null,isOffscreen:!0,get width(){return this.gpuColorTextures.length>0?this.gpuColorTextures[0].width:this.gpuDepthStencilTexture?this.gpuDepthStencilTexture.width:te},set width(t){te=t},get height(){return this.gpuColorTextures.length>0?this.gpuColorTextures[0].height:this.gpuDepthStencilTexture?this.gpuDepthStencilTexture.height:ti},set height(t){ti=t},lodLevel:v},function(g,v){for(var S=0;S<v.gpuColorTextures.length;++S)if(v.gpuColorTextures[S].isSwapchainTexture)return void(v.isOffscreen=!1);var O=g.gl,X=[],Y=O.createFramebuffer();if(Y){v.glFramebuffer=Y,g.stateCache.glFramebuffer!==v.glFramebuffer&&O.bindFramebuffer(O.FRAMEBUFFER,v.glFramebuffer);for(var te=0;te<v.gpuColorTextures.length;++te){var ti=v.gpuColorTextures[te];ti&&(ti.glTexture?O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0+te,ti.glTarget,ti.glTexture,0):O.framebufferRenderbuffer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0+te,O.RENDERBUFFER,ti.glRenderbuffer),X.push(O.COLOR_ATTACHMENT0+te),v.width=Math.min(v.width,ti.width),v.height=Math.min(v.height,ti.height))}var tr=v.gpuDepthStencilTexture;if(tr){var ta=uf[tr.format].hasStencil?O.DEPTH_STENCIL_ATTACHMENT:O.DEPTH_ATTACHMENT;tr.glTexture?O.framebufferTexture2D(O.FRAMEBUFFER,ta,tr.glTarget,tr.glTexture,0):O.framebufferRenderbuffer(O.FRAMEBUFFER,ta,O.RENDERBUFFER,tr.glRenderbuffer),v.width=Math.min(v.width,tr.width),v.height=Math.min(v.height,tr.height)}g.extensions.WEBGL_draw_buffers&&g.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(X);var th=O.checkFramebufferStatus(O.FRAMEBUFFER);if(th!==O.FRAMEBUFFER_COMPLETE)switch(th){case O.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:k("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case O.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:k("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case O.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:k("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case O.FRAMEBUFFER_UNSUPPORTED:k("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}g.stateCache.glFramebuffer!==v.glFramebuffer&&O.bindFramebuffer(O.FRAMEBUFFER,g.stateCache.glFramebuffer)}}(XA.instance,this._gpuFramebuffer),this._width=this._gpuFramebuffer.width,this._height=this._gpuFramebuffer.height},v.destroy=function(){var g,v;this._gpuFramebuffer&&(g=XA.instance,(v=this._gpuFramebuffer).glFramebuffer&&(g.gl.deleteFramebuffer(v.glFramebuffer),g.stateCache.glFramebuffer===v.glFramebuffer&&(g.gl.bindFramebuffer(g.gl.FRAMEBUFFER,null),g.stateCache.glFramebuffer=null),v.glFramebuffer=null),this._gpuFramebuffer=null)},n(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(uI),XY=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuInputAssembler=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){if(0!==g.vertexBuffers.length){if(this._attributes=g.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=g.vertexBuffers,g.indexBuffer)this._indexBuffer=g.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var v=this._vertexBuffers[0];this._drawInfo.vertexCount=v.size/v.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=g.indirectBuffer||null;for(var S=new Array(g.vertexBuffers.length),O=0;O<g.vertexBuffers.length;++O){var X=g.vertexBuffers[O];X.gpuBuffer&&(S[O]=X.gpuBuffer)}var Y=null,te=0;if(g.indexBuffer&&(Y=g.indexBuffer.gpuBuffer))switch(Y.stride){case 1:te=5121;break;case 2:te=5123;break;case 4:te=5125;break;default:console.error("Error index buffer stride.")}var ti=null;g.indirectBuffer&&(ti=g.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:g.attributes,gpuVertexBuffers:S,gpuIndexBuffer:Y,gpuIndirectBuffer:ti,glAttribs:[],glIndexType:te,glVAOs:new Map},N$(XA.instance,this._gpuInputAssembler)}else console.error("InputAssemblerInfo.vertexBuffers is null.")},v.destroy=function(){var g=XA.instance;this._gpuInputAssembler&&g.extensions.useVAO&&G$(g,this._gpuInputAssembler),this._gpuInputAssembler=null},n(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(uB),XK=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuDescriptorSetLayout=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){Array.prototype.push.apply(this._bindings,g.bindings);for(var v=0,S=-1,O=[],X=0;X<this._bindings.length;X++){var Y=this._bindings[X];O.push(v),v+=Y.count,Y.binding>S&&(S=Y.binding)}this._bindingIndices=Array(S+1).fill(-1);for(var te=this._descriptorIndices=Array(S+1).fill(-1),ti=0;ti<this._bindings.length;ti++){var tr=this._bindings[ti];this._bindingIndices[tr.binding]=ti,te[tr.binding]=O[ti]}for(var ta=[],th=0;th<this._bindings.length;th++){var tu=this._bindings[th];if(tu.descriptorType&ug)for(var tl=0;tl<tu.count;tl++)ta.push(tu.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:ta,descriptorIndices:te,descriptorCount:v}},v.destroy=function(){this._bindings.length=0},n(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(uD),XJ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuPipelineLayout=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){Array.prototype.push.apply(this._setLayouts,g.setLayouts);for(var v=[],S=[],O=0,X=[],Y=0;Y<this._setLayouts.length;Y++){for(var te=this._setLayouts[Y],ti=te.gpuDescriptorSetLayout.dynamicBindings,tr=Array(te.bindingIndices.length).fill(-1),ta=0;ta<ti.length;ta++){var th=ti[ta];tr[th]<0&&(tr[th]=O+ta)}S.push(te.gpuDescriptorSetLayout),v.push(tr),X.push(O),O+=ti.length}this._gpuPipelineLayout={gpuSetLayouts:S,dynamicOffsetIndices:v,dynamicOffsetCount:O,dynamicOffsetOffsets:X}},v.destroy=function(){this._setLayouts.length=0},n(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(uM),XQ=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],X1=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuPipelineState=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._primitive=g.primitive,this._shader=g.shader,this._pipelineLayout=g.pipelineLayout;var v=this._bs;if(g.blendState){var S=g.blendState,O=S.targets;O&&O.forEach(function(g,S){v.setTarget(S,g)}),void 0!==S.isA2C&&(v.isA2C=S.isA2C),void 0!==S.isIndepend&&(v.isIndepend=S.isIndepend),void 0!==S.blendColor&&(v.blendColor=S.blendColor)}Object.assign(this._rs,g.rasterizerState),Object.assign(this._dss,g.depthStencilState),this._is=g.inputState,this._renderPass=g.renderPass,this._dynamicStates=g.dynamicStates;for(var X=[],Y=0;Y<31;Y++)this._dynamicStates&1<<Y&&X.push(1<<Y);this._gpuPipelineState={glPrimitive:XQ[g.primitive],gpuShader:g.shader.gpuShader,gpuPipelineLayout:g.pipelineLayout.gpuPipelineLayout,rs:g.rasterizerState,dss:g.depthStencilState,bs:g.blendState,gpuRenderPass:g.renderPass.gpuRenderPass,dynamicStates:X}},v.destroy=function(){this._gpuPipelineState=null},n(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(uG),X2=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.beginRenderPass=function(g,v,S,O,X,Y){U$(XA.instance,g.gpuRenderPass,v.gpuFramebuffer,S,O,X,Y),this._isInRenderPass=!0},v.draw=function(g){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates();var v="drawInfo"in g?g.drawInfo:g;z$(XA.instance,v),++this._numDrawCalls,this._numInstances+=v.instanceCount;var S=v.indexCount||v.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=S/3*Math.max(v.instanceCount,1);break;case 5:case 6:this._numTris+=(S-2)*Math.max(v.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},v.setViewport=function(g){var v=XA.instance,S=v.stateCache,O=v.gl;S.viewport.left===g.left&&S.viewport.top===g.top&&S.viewport.width===g.width&&S.viewport.height===g.height||(O.viewport(g.left,g.top,g.width,g.height),S.viewport.left=g.left,S.viewport.top=g.top,S.viewport.width=g.width,S.viewport.height=g.height)},v.setScissor=function(g){var v=XA.instance,S=v.stateCache,O=v.gl;S.scissorRect.x===g.x&&S.scissorRect.y===g.y&&S.scissorRect.width===g.width&&S.scissorRect.height===g.height||(O.scissor(g.x,g.y,g.width,g.height),S.scissorRect.x=g.x,S.scissorRect.y=g.y,S.scissorRect.width=g.width,S.scissorRect.height=g.height)},v.updateBuffer=function(g,v,S){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var O,X=g.gpuBuffer;X&&(O=void 0!==S?S:g.usage&oC.INDIRECT?0:v.byteLength,M$(XA.instance,X,v,0,O))}},v.copyBuffersToTexture=function(g,v,S){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var O=v.gpuTexture;O&&q$(XA.instance,g,O,S)}},v.execute=function(g,v){for(var S=0;S<v;++S){var O=g[S];X$(XA.instance,O.cmdPackage),this._numDrawCalls+=O._numDrawCalls,this._numInstances+=O._numInstances,this._numTris+=O._numTris}},v.bindStates=function(){H$(XA.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},v.blitTexture=function(g,v,S,O){var X=g.gpuTexture,Y=v.gpuTexture;K$(XA.instance,X,Y,S,O)},e}(Xj),X3=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).numDrawCalls=0,v.numInstances=0,v.numTris=0,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._type=g.type},v.destroy=function(){},v.submit=function(g){for(var v=g.length,S=0;S<v;S++){var O=g[S];this.numDrawCalls+=O.numDrawCalls,this.numInstances+=O.numInstances,this.numTris+=O.numTris}},v.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(uV),X5=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuRenderPass=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._colorInfos=g.colorAttachments,this._depthStencilInfo=g.depthStencilAttachment,this._subpasses=g.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},v.destroy=function(){this._gpuRenderPass=null},n(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(uU),X4=[10497,33648,33071,33071],X8=function(g){function e(v,S){var O;(O=g.call(this,v,S)||this)._gpuSampler=null;var X,Y,te=O._info.minFilter,ti=O._info.magFilter,tr=O._info.mipFilter;X=te===oO.LINEAR||te===oO.ANISOTROPIC?tr===oO.LINEAR||tr===oO.ANISOTROPIC?9987:tr===oO.POINT?9985:9729:tr===oO.LINEAR||tr===oO.ANISOTROPIC?9986:tr===oO.POINT?9984:9728,Y=ti===oO.LINEAR||ti===oO.ANISOTROPIC?9729:9728;var ta=X4[O._info.addressU],th=X4[O._info.addressV],tu=X4[O._info.addressW];return O._gpuSampler={glMinFilter:X,glMagFilter:Y,glWrapS:ta,glWrapT:th,glWrapR:tu},O}return s(e,g),n(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(uH),X6=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuShader=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._name=g.name,this._stages=g.stages,this._attributes=g.attributes,this._blocks=g.blocks,this._samplers=g.samplers,this._gpuShader={name:g.name,blocks:g.blocks.slice(),samplerTextures:g.samplerTextures.slice(),subpassInputs:g.subpassInputs.slice(),gpuStages:new Array(g.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var v=0;v<g.stages.length;++v){var S=g.stages[v];this._gpuShader.gpuStages[v]={type:S.stage,source:S.source,glShader:null}}},v.destroy=function(){this._gpuShader&&(F$(XA.instance,this._gpuShader),this._gpuShader=null)},n(e,[{key:"gpuShader",get:function(){return null===this._gpuShader.glProgram&&L$(XA.instance,this._gpuShader),this._gpuShader}}]),e}(uz),X7=function(){function t1(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new hS,this.scissorRect=new hl(0,0,0,0),this.rs=new uO,this.dss=new uL,this.bs=new uk,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t1.prototype.initialize=function(g,v){for(var S=0;S<g;++S)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=v,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=v,this.glCurrentAttribLocs.fill(!1)},t1}(),X9=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuTexture=null,v._lodLevel=0,v}s(e,g);var v=e.prototype;return v.initialize=function(g,v){var S=g,O=g;"texture"in g&&(S=O.texture.info,this._isTextureView=!0),this._info.copy(S),this._isPowerOf2=R_(this._info.width)&&R_(this._info.height),this._size=I_(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,this._isTextureView?(this._viewInfo.copy(O),this._lodLevel=O.baseLevel,this._gpuTexture=O.texture._gpuTexture):(this._gpuTexture={type:S.type,format:S.format,usage:S.usage,width:S.width,height:S.height,depth:S.depth,size:this._size,arrayLayer:S.layerCount,mipLevel:S.levelCount,samples:S.samples,flags:S.flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:v||!1},this._gpuTexture.isSwapchainTexture||(function(g,v){var S=g.gl;v.glFormat=v.glInternalFmt=function(g,v){switch(g){case oA.A8:return v.ALPHA;case oA.L8:return v.LUMINANCE;case oA.LA8:return v.LUMINANCE_ALPHA;case oA.RGB8:case oA.RGB16F:case oA.RGB32F:return v.RGB;case oA.BGRA8:case oA.RGBA8:case oA.SRGB8_A8:case oA.RGBA16F:case oA.RGBA32F:return v.RGBA;case oA.R5G6B5:return v.RGB;case oA.RGB5A1:case oA.RGBA4:return v.RGBA;case oA.DEPTH:return v.DEPTH_COMPONENT;case oA.DEPTH_STENCIL:return v.DEPTH_STENCIL;case oA.BC1:return Xp.COMPRESSED_RGB_S3TC_DXT1_EXT;case oA.BC1_ALPHA:return Xp.COMPRESSED_RGBA_S3TC_DXT1_EXT;case oA.BC1_SRGB:return Xp.COMPRESSED_SRGB_S3TC_DXT1_EXT;case oA.BC1_SRGB_ALPHA:return Xp.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case oA.BC2:return Xp.COMPRESSED_RGBA_S3TC_DXT3_EXT;case oA.BC2_SRGB:return Xp.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case oA.BC3:return Xp.COMPRESSED_RGBA_S3TC_DXT5_EXT;case oA.BC3_SRGB:return Xp.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case oA.ETC_RGB8:return Xp.COMPRESSED_RGB_ETC1_WEBGL;case oA.ETC2_RGB8:return Xp.COMPRESSED_RGB8_ETC2;case oA.ETC2_SRGB8:return Xp.COMPRESSED_SRGB8_ETC2;case oA.ETC2_RGB8_A1:return Xp.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case oA.ETC2_SRGB8_A1:return Xp.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case oA.ETC2_RGBA8:return Xp.COMPRESSED_RGBA8_ETC2_EAC;case oA.ETC2_SRGB8_A8:return Xp.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case oA.EAC_R11:return Xp.COMPRESSED_R11_EAC;case oA.EAC_R11SN:return Xp.COMPRESSED_SIGNED_R11_EAC;case oA.EAC_RG11:return Xp.COMPRESSED_RG11_EAC;case oA.EAC_RG11SN:return Xp.COMPRESSED_SIGNED_RG11_EAC;case oA.PVRTC_RGB2:return Xp.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case oA.PVRTC_RGBA2:return Xp.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case oA.PVRTC_RGB4:return Xp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case oA.PVRTC_RGBA4:return Xp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case oA.ASTC_RGBA_4X4:return Xp.COMPRESSED_RGBA_ASTC_4x4_KHR;case oA.ASTC_RGBA_5X4:return Xp.COMPRESSED_RGBA_ASTC_5x4_KHR;case oA.ASTC_RGBA_5X5:return Xp.COMPRESSED_RGBA_ASTC_5x5_KHR;case oA.ASTC_RGBA_6X5:return Xp.COMPRESSED_RGBA_ASTC_6x5_KHR;case oA.ASTC_RGBA_6X6:return Xp.COMPRESSED_RGBA_ASTC_6x6_KHR;case oA.ASTC_RGBA_8X5:return Xp.COMPRESSED_RGBA_ASTC_8x5_KHR;case oA.ASTC_RGBA_8X6:return Xp.COMPRESSED_RGBA_ASTC_8x6_KHR;case oA.ASTC_RGBA_8X8:return Xp.COMPRESSED_RGBA_ASTC_8x8_KHR;case oA.ASTC_RGBA_10X5:return Xp.COMPRESSED_RGBA_ASTC_10x5_KHR;case oA.ASTC_RGBA_10X6:return Xp.COMPRESSED_RGBA_ASTC_10x6_KHR;case oA.ASTC_RGBA_10X8:return Xp.COMPRESSED_RGBA_ASTC_10x8_KHR;case oA.ASTC_RGBA_10X10:return Xp.COMPRESSED_RGBA_ASTC_10x10_KHR;case oA.ASTC_RGBA_12X10:return Xp.COMPRESSED_RGBA_ASTC_12x10_KHR;case oA.ASTC_RGBA_12X12:return Xp.COMPRESSED_RGBA_ASTC_12x12_KHR;case oA.ASTC_SRGBA_4X4:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case oA.ASTC_SRGBA_5X4:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case oA.ASTC_SRGBA_5X5:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case oA.ASTC_SRGBA_6X5:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case oA.ASTC_SRGBA_6X6:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case oA.ASTC_SRGBA_8X5:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case oA.ASTC_SRGBA_8X6:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case oA.ASTC_SRGBA_8X8:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case oA.ASTC_SRGBA_10X5:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case oA.ASTC_SRGBA_10X6:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case oA.ASTC_SRGBA_10X8:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case oA.ASTC_SRGBA_10X10:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case oA.ASTC_SRGBA_12X10:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case oA.ASTC_SRGBA_12X12:return Xp.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return k("Unsupported Format, convert to WebGL format failed."),v.RGBA}}(v.format,S),v.glType=f$(v.format,S);var O=v.width,X=v.height;switch(v.type){case ow.TEX2D:v.glTarget=S.TEXTURE_2D;var Y=Math.max(O,X);if(Y>g.capabilities.maxTextureSize&&J(9100,Y,g.capabilities.maxTextureSize),g.textureExclusive[v.format]||g.extensions.WEBGL_depth_texture||!uf[v.format].hasDepth){if(v.glTexture=S.createTexture(),v.size>0){var te=g.stateCache.glTexUnits[g.stateCache.texUnit];if(te.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_2D,v.glTexture),te.glTexture=v.glTexture),uf[v.format].isCompressed)for(var ti=0;ti<v.mipLevel;++ti){var tr=w_(v.format,O,X,1),ta=new Uint8Array(tr);S.compressedTexImage2D(S.TEXTURE_2D,ti,v.glInternalFmt,O,X,0,ta),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else for(var th=0;th<v.mipLevel;++th)S.texImage2D(S.TEXTURE_2D,th,v.glInternalFmt,O,X,0,v.glFormat,v.glType,null),O=Math.max(1,O>>1),X=Math.max(1,X>>1);v.isPowerOf2?(v.glWrapS=S.REPEAT,v.glWrapT=S.REPEAT):(v.glWrapS=S.CLAMP_TO_EDGE,v.glWrapT=S.CLAMP_TO_EDGE),v.glMinFilter=S.LINEAR,v.glMagFilter=S.LINEAR,S.texParameteri(v.glTarget,S.TEXTURE_WRAP_S,v.glWrapS),S.texParameteri(v.glTarget,S.TEXTURE_WRAP_T,v.glWrapT),S.texParameteri(v.glTarget,S.TEXTURE_MIN_FILTER,v.glMinFilter),S.texParameteri(v.glTarget,S.TEXTURE_MAG_FILTER,v.glMagFilter)}}else v.glInternalFmt=function(g,v){switch(g){case oA.R5G6B5:return v.RGB565;case oA.RGB5A1:return v.RGB5_A1;case oA.RGBA4:return v.RGBA4;case oA.RGBA16F:return Xp.RGBA16F_EXT;case oA.RGBA32F:return Xp.RGBA32F_EXT;case oA.SRGB8_A8:return Xp.SRGB8_ALPHA8_EXT;case oA.DEPTH:return v.DEPTH_COMPONENT16;case oA.DEPTH_STENCIL:return v.DEPTH_STENCIL;default:return k("Unsupported Format, convert to WebGL internal format failed."),v.RGBA}}(v.format,S),v.glRenderbuffer=S.createRenderbuffer(),v.size>0&&(g.stateCache.glRenderbuffer!==v.glRenderbuffer&&(S.bindRenderbuffer(S.RENDERBUFFER,v.glRenderbuffer),g.stateCache.glRenderbuffer=v.glRenderbuffer),S.renderbufferStorage(S.RENDERBUFFER,v.glInternalFmt,O,X));break;case ow.CUBE:v.glTarget=S.TEXTURE_CUBE_MAP;var tu=Math.max(O,X);if(tu>g.capabilities.maxCubeMapTextureSize&&J(9100,tu,g.capabilities.maxTextureSize),v.glTexture=S.createTexture(),v.size>0){var tl=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tl.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_CUBE_MAP,v.glTexture),tl.glTexture=v.glTexture),uf[v.format].isCompressed)for(var tc=0;tc<6;++tc){O=v.width,X=v.height;for(var t_=0;t_<v.mipLevel;++t_){var tf=w_(v.format,O,X,1),tp=new Uint8Array(tf);S.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+tc,t_,v.glInternalFmt,O,X,0,tp),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}}else for(var tm=0;tm<6;++tm){O=v.width,X=v.height;for(var tg=0;tg<v.mipLevel;++tg)S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+tm,tg,v.glInternalFmt,O,X,0,v.glFormat,v.glType,null),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}v.isPowerOf2?(v.glWrapS=S.REPEAT,v.glWrapT=S.REPEAT):(v.glWrapS=S.CLAMP_TO_EDGE,v.glWrapT=S.CLAMP_TO_EDGE),v.glMinFilter=S.LINEAR,v.glMagFilter=S.LINEAR,S.texParameteri(v.glTarget,S.TEXTURE_WRAP_S,v.glWrapS),S.texParameteri(v.glTarget,S.TEXTURE_WRAP_T,v.glWrapT),S.texParameteri(v.glTarget,S.TEXTURE_MIN_FILTER,v.glMinFilter),S.texParameteri(v.glTarget,S.TEXTURE_MAG_FILTER,v.glMagFilter)}break;default:k("Unsupported TextureType, create texture failed."),v.type=ow.TEX2D,v.glTarget=S.TEXTURE_2D}}(XA.instance,this._gpuTexture),XA.instance.memoryStatus.textureSize+=this._size),this._viewInfo.texture=this,this._viewInfo.type=g.type,this._viewInfo.format=g.format,this._viewInfo.baseLevel=0,this._viewInfo.levelCount=g.levelCount,this._viewInfo.baseLayer=0,this._viewInfo.layerCount=g.layerCount)},v.destroy=function(){!this._isTextureView&&this._gpuTexture&&(function(g,v){var S=g.gl;if(v.glTexture){var O=g.stateCache.glTexUnits,X=g.stateCache.texUnit;S.deleteTexture(v.glTexture);for(var Y=0;Y<O.length;Y++)O[Y].glTexture===v.glTexture&&(S.activeTexture(S.TEXTURE0+Y),X=Y,S.bindTexture(v.glTarget,null),O[Y].glTexture=null);g.stateCache.texUnit=X,v.glTexture=null}if(v.glRenderbuffer){var te=g.stateCache.glRenderbuffer;S.deleteRenderbuffer(v.glRenderbuffer),te===v.glRenderbuffer&&(S.bindRenderbuffer(S.RENDERBUFFER,null),te=null),v.glRenderbuffer=null}}(XA.instance,this._gpuTexture),XA.instance.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},v.getGLTextureHandle=function(){var g=this._gpuTexture;return g?g.glTexture?g.glTexture:g.glRenderbuffer?g.glRenderbuffer:0:0},v.resize=function(g,v){if(this._info.width!==g||this._info.height!==v){this._info.levelCount===e.getLevelCount(this._info.width,this._info.height)?this._info.levelCount=e.getLevelCount(g,v):this._info.levelCount>1&&(this._info.levelCount=Math.min(this._info.levelCount,e.getLevelCount(g,v)));var S=this._size;this._info.width=g,this._info.height=v,this._size=I_(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,!this._isTextureView&&this._gpuTexture&&(this._gpuTexture.width=g,this._gpuTexture.height=v,this._gpuTexture.size=this._size,this._gpuTexture.isSwapchainTexture||(function(g,v){if(v.size){var S=g.gl,O=v.width,X=v.height;switch(v.type){case ow.TEX2D:v.glTarget=S.TEXTURE_2D;var Y=Math.max(O,X);if(Y>g.capabilities.maxTextureSize&&J(9100,Y,g.capabilities.maxTextureSize),v.glRenderbuffer)g.stateCache.glRenderbuffer!==v.glRenderbuffer&&(S.bindRenderbuffer(S.RENDERBUFFER,v.glRenderbuffer),g.stateCache.glRenderbuffer=v.glRenderbuffer),S.renderbufferStorage(S.RENDERBUFFER,v.glInternalFmt,O,X);else if(v.glTexture){var te=g.stateCache.glTexUnits[g.stateCache.texUnit];if(te.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_2D,v.glTexture),te.glTexture=v.glTexture),uf[v.format].isCompressed)for(var ti=0;ti<v.mipLevel;++ti){var tr=w_(v.format,O,X,1),ta=new Uint8Array(tr);S.compressedTexImage2D(S.TEXTURE_2D,ti,v.glInternalFmt,O,X,0,ta),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else for(var th=0;th<v.mipLevel;++th)S.texImage2D(S.TEXTURE_2D,th,v.glInternalFmt,O,X,0,v.glFormat,v.glType,null),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}break;case ow.CUBE:v.glTarget=S.TEXTURE_CUBE_MAP;var tu=Math.max(O,X);tu>g.capabilities.maxCubeMapTextureSize&&J(9100,tu,g.capabilities.maxTextureSize);var tl=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tl.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_CUBE_MAP,v.glTexture),tl.glTexture=v.glTexture),uf[v.format].isCompressed)for(var tc=0;tc<6;++tc){O=v.width,X=v.height;for(var t_=0;t_<v.mipLevel;++t_){var tf=w_(v.format,O,X,1),tp=new Uint8Array(tf);S.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+tc,t_,v.glInternalFmt,O,X,0,tp),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}}else for(var tm=0;tm<6;++tm){O=v.width,X=v.height;for(var tg=0;tg<v.mipLevel;++tg)S.texImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+tm,tg,v.glInternalFmt,O,X,0,v.glFormat,v.glType,null),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}break;default:k("Unsupported TextureType, create texture failed."),v.type=ow.TEX2D,v.glTarget=S.TEXTURE_2D}}}(XA.instance,this._gpuTexture),XA.instance.memoryStatus.textureSize-=S,XA.instance.memoryStatus.textureSize+=this._size))}},v.initAsSwapchainTexture=function(g){var v=new hB;v.format=g.format,v.usage=uf[g.format].hasDepth?oI.DEPTH_STENCIL_ATTACHMENT:oI.COLOR_ATTACHMENT,v.width=g.width,v.height=g.height,this.initialize(v,!0)},n(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}},{key:"lodLevel",get:function(){return this._lodLevel}}]),e}(uW),je="webglcontextlost";function g0(g,v){for(var S=["","WEBKIT_","MOZ_"],O=0;O<S.length;++O){var X=g.getExtension(S[O]+v);if(X)return X}return null}function v0(g){var v={EXT_texture_filter_anisotropic:g0(g,"EXT_texture_filter_anisotropic"),EXT_blend_minmax:g0(g,"EXT_blend_minmax"),EXT_frag_depth:g0(g,"EXT_frag_depth"),EXT_shader_texture_lod:g0(g,"EXT_shader_texture_lod"),EXT_sRGB:g0(g,"EXT_sRGB"),OES_vertex_array_object:g0(g,"OES_vertex_array_object"),EXT_color_buffer_half_float:g0(g,"EXT_color_buffer_half_float"),WEBGL_color_buffer_float:g0(g,"WEBGL_color_buffer_float"),WEBGL_compressed_texture_etc1:g0(g,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:g0(g,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:g0(g,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_s3tc:g0(g,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:g0(g,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:g0(g,"WEBGL_debug_shaders"),WEBGL_draw_buffers:g0(g,"WEBGL_draw_buffers"),WEBGL_lose_context:g0(g,"WEBGL_lose_context"),WEBGL_depth_texture:g0(g,"WEBGL_depth_texture"),OES_texture_half_float:g0(g,"OES_texture_half_float"),OES_texture_half_float_linear:g0(g,"OES_texture_half_float_linear"),OES_texture_float:g0(g,"OES_texture_float"),OES_texture_float_linear:g0(g,"OES_texture_float_linear"),OES_standard_derivatives:g0(g,"OES_standard_derivatives"),OES_element_index_uint:g0(g,"OES_element_index_uint"),ANGLE_instanced_arrays:g0(g,"ANGLE_instanced_arrays"),WEBGL_debug_renderer_info:g0(g,"WEBGL_debug_renderer_info"),WEBGL_multi_draw:null,WEBGL_compressed_texture_astc:null,destroyShadersImmediately:!0,noCompressedTexSubImage2D:!1,isLocationActive:function(g){return!!g},useVAO:!1};return aD.os===aw.IOS&&14===aD.osMainVersion&&aD.isBrowser||(v.WEBGL_compressed_texture_astc=g0(g,"WEBGL_compressed_texture_astc")),aD.os!==aw.ANDROID&&aD.os!==aw.IOS&&(v.WEBGL_multi_draw=g0(g,"WEBGL_multi_draw")),aD.browserType===ax.UC&&(v.ANGLE_instanced_arrays=null),aD.os===aw.IOS&&aD.osMainVersion<=10&&(v.destroyShadersImmediately=!1),v.OES_vertex_array_object&&(v.useVAO=!0),v}var ji=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).stateCache=new X7,v.cmdAllocator=new XX,v.nullTex2D=null,v.nullTexCube=null,v._canvas=null,v._webGLContextLostHandler=null,v._extensions=null,v._blitManager=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._canvas=g.windowHandle,this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(je,this._onWebGLContextLost);var v=XA.instance.gl;this.stateCache.initialize(XA.instance.capabilities.maxTextureUnits,XA.instance.capabilities.maxVertexAttributes),this._extensions=v0(v),function(g){g.activeTexture(g.TEXTURE0),g.pixelStorei(g.PACK_ALIGNMENT,1),g.pixelStorei(g.UNPACK_ALIGNMENT,1),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1),g.bindFramebuffer(g.FRAMEBUFFER,null),g.enable(g.SCISSOR_TEST),g.enable(g.CULL_FACE),g.cullFace(g.BACK),g.frontFace(g.CCW),g.disable(g.POLYGON_OFFSET_FILL),g.polygonOffset(0,0),g.enable(g.DEPTH_TEST),g.depthMask(!0),g.depthFunc(g.LESS),g.depthRange(0,1),g.stencilFuncSeparate(g.FRONT,g.ALWAYS,1,65535),g.stencilOpSeparate(g.FRONT,g.KEEP,g.KEEP,g.KEEP),g.stencilMaskSeparate(g.FRONT,65535),g.stencilFuncSeparate(g.BACK,g.ALWAYS,1,65535),g.stencilOpSeparate(g.BACK,g.KEEP,g.KEEP,g.KEEP),g.stencilMaskSeparate(g.BACK,65535),g.disable(g.STENCIL_TEST),g.disable(g.SAMPLE_ALPHA_TO_COVERAGE),g.disable(g.BLEND),g.blendEquationSeparate(g.FUNC_ADD,g.FUNC_ADD),g.blendFuncSeparate(g.ONE,g.ZERO,g.ONE,g.ZERO),g.colorMask(!0,!0,!0,!0),g.blendColor(0,0,0,0)}(v);var S=oA.RGBA8,O=oA.DEPTH_STENCIL,X=v.getParameter(v.DEPTH_BITS),Y=v.getParameter(v.STENCIL_BITS);X&&Y?O=oA.DEPTH_STENCIL:X&&(O=oA.DEPTH),this._colorTexture=new X9,this._colorTexture.initAsSwapchainTexture({swapchain:this,format:S,width:g.width,height:g.height}),this._depthStencilTexture=new X9,this._depthStencilTexture.initAsSwapchainTexture({swapchain:this,format:O,width:g.width,height:g.height}),this.nullTex2D=XA.instance.createTexture(new hB(ow.TEX2D,oI.SAMPLED,oA.RGBA8,2,2,oB.GEN_MIPMAP)),this.nullTexCube=XA.instance.createTexture(new hB(ow.CUBE,oI.SAMPLED,oA.RGBA8,2,2,oB.GEN_MIPMAP,6));var te=new hg;te.texExtent.width=2,te.texExtent.height=2;var ti=new Uint8Array(this.nullTex2D.size);ti.fill(0),XA.instance.copyBuffersToTexture([ti],this.nullTex2D,[te]),te.texSubres.layerCount=6,XA.instance.copyBuffersToTexture([ti,ti,ti,ti,ti,ti],this.nullTexCube,[te]),this._blitManager=new XU},v.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener(je,this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._blitManager&&(this._blitManager.destroy(),this._blitManager=null),this._extensions=null,this._canvas=null},v.resize=function(g,v){this._colorTexture.width===g&&this._colorTexture.height===v||(U("Resizing swapchain: "+g+"x"+v),this._canvas.width=g,this._canvas.height=v,this._colorTexture.resize(g,v),this._depthStencilTexture.resize(g,v))},v._onWebGLContextLost=function(g){q(11e3),G(g)},n(e,[{key:"extensions",get:function(){return this._extensions}},{key:"blitManager",get:function(){return this._blitManager}}]),e}(uw),js=g("ep",function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._swapchain=null,v._context=null,v._bindingMappings=null,v._textureExclusive=new Array(oA.COUNT),v}s(e,g);var v=e.prototype;return v.initialize=function(g){XA.setInstance(this),this._gfxAPI=om.WEBGL;var v=this._bindingMappingInfo=g.bindingMappingInfo,S=[],O=[],X=v.setIndices[0];S[X]=0,O[X]=0;for(var Y=1;Y<v.setIndices.length;++Y){var te=v.setIndices[Y],ti=v.setIndices[Y-1];S[te]=v.maxBlockCounts[ti]+S[ti],O[te]=v.maxSamplerTextureCounts[ti]+O[ti]}for(var tr=0;tr<v.setIndices.length;++tr){var ta=v.setIndices[tr];O[ta]-=v.maxBlockCounts[ta]}this._bindingMappings={blockOffsets:S,samplerTextureOffsets:O,flexibleSet:v.setIndices[v.setIndices.length-1]};var th=this._context=function(g){var v=null;try{var S={alpha:t$.ENABLE_TRANSPARENT_CANVAS,antialias:t$.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};v=g.getContext("webgl",S)}catch(g){return null}return v}(uE.canvas);if(!th)return console.error("This device does not support WebGL."),!1;this._queue=this.createQueue(new ur(o4.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new ue(this._queue)),this._caps.maxVertexAttributes=th.getParameter(th.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=th.getParameter(th.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=th.getParameter(th.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=th.getParameter(th.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=th.getParameter(th.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=th.getParameter(th.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=th.getParameter(th.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxArrayTextureLayers=0,this._caps.max3DTextureSize=0,this._caps.maxUniformBufferBindings=16;var tu=th.getSupportedExtensions(),tl="";if(tu)for(var tc,t_=f(tu);!(tc=t_()).done;)tl+=tc.value+" ";var tf=v0(th);tf.WEBGL_debug_renderer_info?(this._renderer=th.getParameter(tf.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=th.getParameter(tf.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=th.getParameter(th.RENDERER),this._vendor=th.getParameter(th.VENDOR));var tp=th.getParameter(th.VERSION);this._features.fill(!1),this.initFormatFeatures(tf),tf.EXT_blend_minmax&&(this._features[oS.BLEND_MINMAX]=!0),tf.OES_element_index_uint&&(this._features[oS.ELEMENT_INDEX_UINT]=!0),tf.ANGLE_instanced_arrays&&(this._features[oS.INSTANCED_ARRAYS]=!0),tf.WEBGL_draw_buffers&&(this._features[oS.MULTIPLE_RENDER_TARGETS]=!0);var tm="";return this.getFormatFeatures(oA.ETC_RGB8)&&(tm+="etc1 "),this.getFormatFeatures(oA.ETC2_RGB8)&&(tm+="etc2 "),this.getFormatFeatures(oA.BC1)&&(tm+="dxt "),this.getFormatFeatures(oA.PVRTC_RGB2)&&(tm+="pvrtc "),this.getFormatFeatures(oA.ASTC_RGBA_4X4)&&(tm+="astc "),U("WebGL device initialized."),U("RENDERER: "+this._renderer),U("VENDOR: "+this._vendor),U("VERSION: "+tp),U("COMPRESSED_FORMAT: "+tm),U("EXTENSIONS: "+tl),!0},v.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._swapchain=null},v.flushCommands=function(){},v.acquire=function(){},v.present=function(){var g=this._queue;this._numDrawCalls=g.numDrawCalls,this._numInstances=g.numInstances,this._numTris=g.numTris,g.clear()},v.initFormatFeatures=function(g){this._formatFeatures.fill(oP.NONE),this._textureExclusive.fill(!0);var v=oP.RENDER_TARGET|oP.SAMPLED_TEXTURE|oP.LINEAR_FILTER;this._formatFeatures[oA.RGB8]=v,this._formatFeatures[oA.R5G6B5]=v,this._textureExclusive[oA.R5G6B5]=!1,this._formatFeatures[oA.RGBA8]=v,this._formatFeatures[oA.RGBA4]=v,this._textureExclusive[oA.RGBA4]=!1,this._formatFeatures[oA.RGB5A1]=v,this._textureExclusive[oA.RGB5A1]=!1,this._formatFeatures[oA.DEPTH]=oP.RENDER_TARGET,this._textureExclusive[oA.DEPTH]=!1,this._formatFeatures[oA.DEPTH_STENCIL]=oP.RENDER_TARGET,this._textureExclusive[oA.DEPTH_STENCIL]=!1,this._formatFeatures[oA.R8I]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RG8I]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGB8I]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGBA8I]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.R8UI]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RG8UI]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGB8UI]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGBA8UI]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.R8I]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RG8I]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGB8I]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGBA8I]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.R8UI]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RG8UI]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGB8UI]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGBA8UI]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.R32F]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RG32F]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGB32F]|=oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.RGBA32F]|=oP.VERTEX_ATTRIBUTE,g.EXT_sRGB&&(this._formatFeatures[oA.SRGB8]=v,this._formatFeatures[oA.SRGB8_A8]=v,this._textureExclusive[oA.SRGB8_A8]=!1),g.WEBGL_depth_texture&&(this._formatFeatures[oA.DEPTH]|=v,this._formatFeatures[oA.DEPTH_STENCIL]|=v),g.WEBGL_color_buffer_float&&(this._formatFeatures[oA.RGB32F]|=oP.RENDER_TARGET,this._formatFeatures[oA.RGBA32F]|=oP.RENDER_TARGET,this._textureExclusive[oA.RGB32F]=!1,this._textureExclusive[oA.RGBA32F]=!1),g.EXT_color_buffer_half_float&&(this._formatFeatures[oA.RGB16F]|=oP.RENDER_TARGET,this._formatFeatures[oA.RGBA16F]|=oP.RENDER_TARGET,this._textureExclusive[oA.RGB16F]=!1,this._textureExclusive[oA.RGBA16F]=!1),g.OES_texture_float&&(this._formatFeatures[oA.RGB32F]|=oP.RENDER_TARGET|oP.SAMPLED_TEXTURE,this._formatFeatures[oA.RGBA32F]|=oP.RENDER_TARGET|oP.SAMPLED_TEXTURE),g.OES_texture_half_float&&(this._formatFeatures[oA.RGB16F]|=oP.RENDER_TARGET|oP.SAMPLED_TEXTURE,this._formatFeatures[oA.RGBA16F]|=oP.RENDER_TARGET|oP.SAMPLED_TEXTURE),g.OES_texture_float_linear&&(this._formatFeatures[oA.RGB32F]|=oP.LINEAR_FILTER,this._formatFeatures[oA.RGBA32F]|=oP.LINEAR_FILTER),g.OES_texture_half_float_linear&&(this._formatFeatures[oA.RGB16F]|=oP.LINEAR_FILTER,this._formatFeatures[oA.RGBA16F]|=oP.LINEAR_FILTER);var S=oP.SAMPLED_TEXTURE|oP.LINEAR_FILTER;g.WEBGL_compressed_texture_etc1&&(this._formatFeatures[oA.ETC_RGB8]=S),g.WEBGL_compressed_texture_etc&&(this._formatFeatures[oA.ETC2_RGB8]=S,this._formatFeatures[oA.ETC2_RGBA8]=S,this._formatFeatures[oA.ETC2_SRGB8]=S,this._formatFeatures[oA.ETC2_SRGB8_A8]=S,this._formatFeatures[oA.ETC2_RGB8_A1]=S,this._formatFeatures[oA.ETC2_SRGB8_A1]=S),g.WEBGL_compressed_texture_s3tc&&(this._formatFeatures[oA.BC1]=S,this._formatFeatures[oA.BC1_ALPHA]=S,this._formatFeatures[oA.BC1_SRGB]=S,this._formatFeatures[oA.BC1_SRGB_ALPHA]=S,this._formatFeatures[oA.BC2]=S,this._formatFeatures[oA.BC2_SRGB]=S,this._formatFeatures[oA.BC3]=S,this._formatFeatures[oA.BC3_SRGB]=S),g.WEBGL_compressed_texture_pvrtc&&(this._formatFeatures[oA.PVRTC_RGB2]|=S,this._formatFeatures[oA.PVRTC_RGBA2]|=S,this._formatFeatures[oA.PVRTC_RGB4]|=S,this._formatFeatures[oA.PVRTC_RGBA4]|=S),g.WEBGL_compressed_texture_astc&&(this._formatFeatures[oA.ASTC_RGBA_4X4]|=S,this._formatFeatures[oA.ASTC_RGBA_5X4]|=S,this._formatFeatures[oA.ASTC_RGBA_5X5]|=S,this._formatFeatures[oA.ASTC_RGBA_6X5]|=S,this._formatFeatures[oA.ASTC_RGBA_6X6]|=S,this._formatFeatures[oA.ASTC_RGBA_8X5]|=S,this._formatFeatures[oA.ASTC_RGBA_8X6]|=S,this._formatFeatures[oA.ASTC_RGBA_8X8]|=S,this._formatFeatures[oA.ASTC_RGBA_10X5]|=S,this._formatFeatures[oA.ASTC_RGBA_10X6]|=S,this._formatFeatures[oA.ASTC_RGBA_10X8]|=S,this._formatFeatures[oA.ASTC_RGBA_10X10]|=S,this._formatFeatures[oA.ASTC_RGBA_12X10]|=S,this._formatFeatures[oA.ASTC_RGBA_12X12]|=S,this._formatFeatures[oA.ASTC_SRGBA_4X4]|=S,this._formatFeatures[oA.ASTC_SRGBA_5X4]|=S,this._formatFeatures[oA.ASTC_SRGBA_5X5]|=S,this._formatFeatures[oA.ASTC_SRGBA_6X5]|=S,this._formatFeatures[oA.ASTC_SRGBA_6X6]|=S,this._formatFeatures[oA.ASTC_SRGBA_8X5]|=S,this._formatFeatures[oA.ASTC_SRGBA_8X6]|=S,this._formatFeatures[oA.ASTC_SRGBA_8X8]|=S,this._formatFeatures[oA.ASTC_SRGBA_10X5]|=S,this._formatFeatures[oA.ASTC_SRGBA_10X6]|=S,this._formatFeatures[oA.ASTC_SRGBA_10X8]|=S,this._formatFeatures[oA.ASTC_SRGBA_10X10]|=S,this._formatFeatures[oA.ASTC_SRGBA_12X10]|=S,this._formatFeatures[oA.ASTC_SRGBA_12X12]|=S)},v.createCommandBuffer=function(g){var v=new(g.type===o6.PRIMARY?X2:Xj);return v.initialize(g),v},v.createSwapchain=function(g){var v=new ji;return this._swapchain=v,v.initialize(g),v},v.createBuffer=function(g){var v=new XH;return v.initialize(g),v},v.createTexture=function(g){var v=new X9;return v.initialize(g),v},v.createDescriptorSet=function(g){var v=new XS;return v.initialize(g),v},v.createShader=function(g){var v=new X6;return v.initialize(g),v},v.createInputAssembler=function(g){var v=new XY;return v.initialize(g),v},v.createRenderPass=function(g){var v=new X5;return v.initialize(g),v},v.createFramebuffer=function(g){var v=new Xq;return v.initialize(g),v},v.createDescriptorSetLayout=function(g){var v=new XK;return v.initialize(g),v},v.createPipelineLayout=function(g){var v=new XJ;return v.initialize(g),v},v.createPipelineState=function(g){var v=new X1;return v.initialize(g),v},v.createQueue=function(g){var v=new X3;return v.initialize(g),v},v.getSampler=function(g){var v=uH.computeHash(g);return this._samplers.has(v)||this._samplers.set(v,new X8(g,v)),this._samplers.get(v)},v.getSwapchains=function(){return[this._swapchain]},v.getGeneralBarrier=function(g){var v=uX.computeHash(g);return this._generalBarrierss.has(v)||this._generalBarrierss.set(v,new uX(g,v)),this._generalBarrierss.get(v)},v.getTextureBarrier=function(g){var v=uq.computeHash(g);return this._textureBarriers.has(v)||this._textureBarriers.set(v,new uq(g,v)),this._textureBarriers.get(v)},v.getBufferBarrier=function(g){var v=uY.computeHash(g);return this._bufferBarriers.has(v)||this._bufferBarriers.set(v,new uY(g,v)),this._bufferBarriers.get(v)},v.copyBuffersToTexture=function(g,v,S){q$(this,g,v.gpuTexture,S)},v.copyTextureToBuffers=function(g,v,S){!function(g,v,S,O){var X=g.gl,Y=g.stateCache,te=X.createFramebuffer();X.bindFramebuffer(X.FRAMEBUFFER,te);var ti=0,tr=0,ta=1,th=1;switch(v.glTarget){case X.TEXTURE_2D:for(var tu=0;tu<O.length;tu++){var tl=O[tu];X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,v.glTarget,v.glTexture,tl.texSubres.mipLevel),ti=tl.texOffset.x,tr=tl.texOffset.y,ta=tl.texExtent.width,th=tl.texExtent.height,X.readPixels(ti,tr,ta,th,v.glFormat,v.glType,S[tu])}break;default:k("Unsupported GL texture type, copy texture to buffers failed.")}X.bindFramebuffer(X.FRAMEBUFFER,null),Y.glFramebuffer=null,X.deleteFramebuffer(te)}(this,g.gpuTexture,v,S)},v.copyTexImagesToTexture=function(g,v,S){!function(g,v,S,O){var X=g.gl,Y=g.stateCache.glTexUnits[g.stateCache.texUnit];Y.glTexture!==S.glTexture&&(X.bindTexture(S.glTarget,S.glTexture),Y.glTexture=S.glTexture);var te=0,ti=0;switch(S.glTarget){case X.TEXTURE_2D:for(var tr=0;tr<O.length;tr++){var ta=O[tr];X.texSubImage2D(X.TEXTURE_2D,ta.texSubres.mipLevel,ta.texOffset.x,ta.texOffset.y,S.glFormat,S.glType,v[te++])}break;case X.TEXTURE_CUBE_MAP:for(var th=0;th<O.length;th++){var tu=O[th],tl=tu.texSubres.baseArrayLayer+tu.texSubres.layerCount;for(ti=tu.texSubres.baseArrayLayer;ti<tl;++ti)X.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ti,tu.texSubres.mipLevel,tu.texOffset.x,tu.texOffset.y,S.glFormat,S.glType,v[te++])}break;default:k("Unsupported GL texture type, copy buffer to texture failed.")}S.flags&oB.GEN_MIPMAP&&S.isPowerOf2&&X.generateMipmap(S.glTarget)}(this,g,v.gpuTexture,S)},n(e,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"stateCache",get:function(){return this._swapchain.stateCache}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}},{key:"textureExclusive",get:function(){return this._textureExclusive}},{key:"bindingMappings",get:function(){return this._bindingMappings}},{key:"blitManager",get:function(){return this._swapchain.blitManager}}]),e}(uE));X.WebGLDevice=js;var jo,ju=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuDescriptorSet=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._layout=g.layout;var v=g.layout.gpuDescriptorSetLayout,S=v.bindings,O=v.descriptorIndices,X=v.descriptorCount;this._buffers=Array(X).fill(null),this._textures=Array(X).fill(null),this._samplers=Array(X).fill(null);var Y=[];this._gpuDescriptorSet={gpuDescriptors:Y,descriptorIndices:O};for(var te=0;te<S.length;++te)for(var ti=S[te],tr=0;tr<ti.count;tr++)Y.push({type:ti.descriptorType,gpuBuffer:null,gpuTextureView:null,gpuSampler:null})},v.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},v.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var g=this._gpuDescriptorSet.gpuDescriptors,v=0;v<g.length;++v)g[v].type&ud?this._buffers[v]&&(g[v].gpuBuffer=this._buffers[v].gpuBuffer):g[v].type&um&&(this._textures[v]&&(g[v].gpuTextureView=this._textures[v].gpuTextureView),this._samplers[v]&&(g[v].gpuSampler=this._samplers[v].gpuSampler));this._isDirty=!1}},n(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(uP);!function(g){g[g.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",g[g.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",g[g.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",g[g.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",g[g.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",g[g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",g[g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",g[g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",g[g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",g[g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",g[g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",g[g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",g[g.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",g[g.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",g[g.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",g[g.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",g[g.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",g[g.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",g[g.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",g[g.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",g[g.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",g[g.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",g[g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",g[g.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",g[g.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",g[g.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",g[g.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",g[g.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",g[g.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",g[g.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",g[g.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",g[g.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",g[g.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",g[g.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",g[g.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",g[g.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",g[g.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",g[g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(jo||(jo={}));var jl=function(){function t1(){}return t1.setInstance=function(g){t1._instance=g},n(t1,null,[{key:"instance",get:function(){return t1._instance}}]),t1}();jl._instance=null;var jc=[10497,33648,33071,33071],j_=new Float32Array(4);function x0(g,v){switch(g){case oA.R8:return v.UNSIGNED_BYTE;case oA.R8SN:return v.BYTE;case oA.R8UI:return v.UNSIGNED_BYTE;case oA.R8I:return v.BYTE;case oA.R16F:return v.HALF_FLOAT;case oA.R16UI:return v.UNSIGNED_SHORT;case oA.R16I:return v.SHORT;case oA.R32F:return v.FLOAT;case oA.R32UI:return v.UNSIGNED_INT;case oA.R32I:return v.INT;case oA.RG8:return v.UNSIGNED_BYTE;case oA.RG8SN:return v.BYTE;case oA.RG8UI:return v.UNSIGNED_BYTE;case oA.RG8I:return v.BYTE;case oA.RG16F:return v.HALF_FLOAT;case oA.RG16UI:return v.UNSIGNED_SHORT;case oA.RG16I:return v.SHORT;case oA.RG32F:return v.FLOAT;case oA.RG32UI:return v.UNSIGNED_INT;case oA.RG32I:return v.INT;case oA.RGB8:case oA.SRGB8:return v.UNSIGNED_BYTE;case oA.RGB8SN:return v.BYTE;case oA.RGB8UI:return v.UNSIGNED_BYTE;case oA.RGB8I:return v.BYTE;case oA.RGB16F:return v.HALF_FLOAT;case oA.RGB16UI:return v.UNSIGNED_SHORT;case oA.RGB16I:return v.SHORT;case oA.RGB32F:return v.FLOAT;case oA.RGB32UI:return v.UNSIGNED_INT;case oA.RGB32I:return v.INT;case oA.BGRA8:case oA.RGBA8:case oA.SRGB8_A8:return v.UNSIGNED_BYTE;case oA.RGBA8SN:return v.BYTE;case oA.RGBA8UI:return v.UNSIGNED_BYTE;case oA.RGBA8I:return v.BYTE;case oA.RGBA16F:return v.HALF_FLOAT;case oA.RGBA16UI:return v.UNSIGNED_SHORT;case oA.RGBA16I:return v.SHORT;case oA.RGBA32F:return v.FLOAT;case oA.RGBA32UI:return v.UNSIGNED_INT;case oA.RGBA32I:return v.INT;case oA.R5G6B5:return v.UNSIGNED_SHORT_5_6_5;case oA.R11G11B10F:return v.UNSIGNED_INT_10F_11F_11F_REV;case oA.RGB5A1:return v.UNSIGNED_SHORT_5_5_5_1;case oA.RGBA4:return v.UNSIGNED_SHORT_4_4_4_4;case oA.RGB10A2:case oA.RGB10A2UI:return v.UNSIGNED_INT_2_10_10_10_REV;case oA.RGB9E5:case oA.DEPTH:return v.FLOAT;case oA.DEPTH_STENCIL:return v.UNSIGNED_INT_24_8;case oA.BC1:case oA.BC1_SRGB:case oA.BC2:case oA.BC2_SRGB:case oA.BC3:case oA.BC3_SRGB:case oA.BC4:return v.UNSIGNED_BYTE;case oA.BC4_SNORM:return v.BYTE;case oA.BC5:return v.UNSIGNED_BYTE;case oA.BC5_SNORM:return v.BYTE;case oA.BC6H_SF16:case oA.BC6H_UF16:return v.FLOAT;case oA.BC7:case oA.BC7_SRGB:case oA.ETC_RGB8:case oA.ETC2_RGB8:case oA.ETC2_SRGB8:case oA.ETC2_RGB8_A1:case oA.ETC2_SRGB8_A1:case oA.EAC_R11:return v.UNSIGNED_BYTE;case oA.EAC_R11SN:return v.BYTE;case oA.EAC_RG11:return v.UNSIGNED_BYTE;case oA.EAC_RG11SN:return v.BYTE;case oA.PVRTC_RGB2:case oA.PVRTC_RGBA2:case oA.PVRTC_RGB4:case oA.PVRTC_RGBA4:case oA.PVRTC2_2BPP:case oA.PVRTC2_4BPP:return v.UNSIGNED_BYTE;case oA.ASTC_RGBA_4X4:case oA.ASTC_RGBA_5X4:case oA.ASTC_RGBA_5X5:case oA.ASTC_RGBA_6X5:case oA.ASTC_RGBA_6X6:case oA.ASTC_RGBA_8X5:case oA.ASTC_RGBA_8X6:case oA.ASTC_RGBA_8X8:case oA.ASTC_RGBA_10X5:case oA.ASTC_RGBA_10X6:case oA.ASTC_RGBA_10X8:case oA.ASTC_RGBA_10X10:case oA.ASTC_RGBA_12X10:case oA.ASTC_RGBA_12X12:case oA.ASTC_SRGBA_4X4:case oA.ASTC_SRGBA_5X4:case oA.ASTC_SRGBA_5X5:case oA.ASTC_SRGBA_6X5:case oA.ASTC_SRGBA_6X6:case oA.ASTC_SRGBA_8X5:case oA.ASTC_SRGBA_8X6:case oA.ASTC_SRGBA_8X8:case oA.ASTC_SRGBA_10X5:case oA.ASTC_SRGBA_10X6:case oA.ASTC_SRGBA_10X8:case oA.ASTC_SRGBA_10X10:case oA.ASTC_SRGBA_12X10:case oA.ASTC_SRGBA_12X12:default:return v.UNSIGNED_BYTE}}function R0(g,v){switch(g){case oE.BOOL:return v.BOOL;case oE.BOOL2:return v.BOOL_VEC2;case oE.BOOL3:return v.BOOL_VEC3;case oE.BOOL4:return v.BOOL_VEC4;case oE.INT:return v.INT;case oE.INT2:return v.INT_VEC2;case oE.INT3:return v.INT_VEC3;case oE.INT4:return v.INT_VEC4;case oE.UINT:return v.UNSIGNED_INT;case oE.FLOAT:return v.FLOAT;case oE.FLOAT2:return v.FLOAT_VEC2;case oE.FLOAT3:return v.FLOAT_VEC3;case oE.FLOAT4:return v.FLOAT_VEC4;case oE.MAT2:return v.FLOAT_MAT2;case oE.MAT2X3:return v.FLOAT_MAT2x3;case oE.MAT2X4:return v.FLOAT_MAT2x4;case oE.MAT3X2:return v.FLOAT_MAT3x2;case oE.MAT3:return v.FLOAT_MAT3;case oE.MAT3X4:return v.FLOAT_MAT3x4;case oE.MAT4X2:return v.FLOAT_MAT4x2;case oE.MAT4X3:return v.FLOAT_MAT4x3;case oE.MAT4:return v.FLOAT_MAT4;case oE.SAMPLER2D:return v.SAMPLER_2D;case oE.SAMPLER2D_ARRAY:return v.SAMPLER_2D_ARRAY;case oE.SAMPLER3D:return v.SAMPLER_3D;case oE.SAMPLER_CUBE:return v.SAMPLER_CUBE;default:return k("Unsupported GLType, convert to GL type failed."),oE.UNKNOWN}}function w0(g,v){switch(g){case v.BOOL:return oE.BOOL;case v.BOOL_VEC2:return oE.BOOL2;case v.BOOL_VEC3:return oE.BOOL3;case v.BOOL_VEC4:return oE.BOOL4;case v.INT:return oE.INT;case v.INT_VEC2:return oE.INT2;case v.INT_VEC3:return oE.INT3;case v.INT_VEC4:return oE.INT4;case v.UNSIGNED_INT:return oE.UINT;case v.UNSIGNED_INT_VEC2:return oE.UINT2;case v.UNSIGNED_INT_VEC3:return oE.UINT3;case v.UNSIGNED_INT_VEC4:return oE.UINT4;case v.FLOAT:return oE.FLOAT;case v.FLOAT_VEC2:return oE.FLOAT2;case v.FLOAT_VEC3:return oE.FLOAT3;case v.FLOAT_VEC4:return oE.FLOAT4;case v.FLOAT_MAT2:return oE.MAT2;case v.FLOAT_MAT2x3:return oE.MAT2X3;case v.FLOAT_MAT2x4:return oE.MAT2X4;case v.FLOAT_MAT3x2:return oE.MAT3X2;case v.FLOAT_MAT3:return oE.MAT3;case v.FLOAT_MAT3x4:return oE.MAT3X4;case v.FLOAT_MAT4x2:return oE.MAT4X2;case v.FLOAT_MAT4x3:return oE.MAT4X3;case v.FLOAT_MAT4:return oE.MAT4;case v.SAMPLER_2D:return oE.SAMPLER2D;case v.SAMPLER_2D_ARRAY:return oE.SAMPLER2D_ARRAY;case v.SAMPLER_3D:return oE.SAMPLER3D;case v.SAMPLER_CUBE:return oE.SAMPLER_CUBE;default:return k("Unsupported GLType, convert to Type failed."),oE.UNKNOWN}}function I0(g,v){switch(g){case v.BOOL:return 4;case v.BOOL_VEC2:return 8;case v.BOOL_VEC3:return 12;case v.BOOL_VEC4:return 16;case v.INT:return 4;case v.INT_VEC2:return 8;case v.INT_VEC3:return 12;case v.INT_VEC4:return 16;case v.UNSIGNED_INT:return 4;case v.UNSIGNED_INT_VEC2:return 8;case v.UNSIGNED_INT_VEC3:return 12;case v.UNSIGNED_INT_VEC4:return 16;case v.FLOAT:return 4;case v.FLOAT_VEC2:return 8;case v.FLOAT_VEC3:return 12;case v.FLOAT_VEC4:case v.FLOAT_MAT2:return 16;case v.FLOAT_MAT2x3:return 24;case v.FLOAT_MAT2x4:return 32;case v.FLOAT_MAT3x2:return 24;case v.FLOAT_MAT3:return 36;case v.FLOAT_MAT3x4:return 48;case v.FLOAT_MAT4x2:return 32;case v.FLOAT_MAT4x3:return 48;case v.FLOAT_MAT4:return 64;case v.SAMPLER_2D:case v.SAMPLER_2D_ARRAY:case v.SAMPLER_2D_ARRAY_SHADOW:case v.SAMPLER_3D:case v.SAMPLER_CUBE:case v.INT_SAMPLER_2D:case v.INT_SAMPLER_2D_ARRAY:case v.INT_SAMPLER_3D:case v.INT_SAMPLER_CUBE:case v.UNSIGNED_INT_SAMPLER_2D:case v.UNSIGNED_INT_SAMPLER_2D_ARRAY:case v.UNSIGNED_INT_SAMPLER_3D:case v.UNSIGNED_INT_SAMPLER_CUBE:return 4;default:return k("Unsupported GLType, get type failed."),0}}function B0(g,v){switch(g){case v.FLOAT_MAT2:case v.FLOAT_MAT2x3:case v.FLOAT_MAT2x4:return 2;case v.FLOAT_MAT3x2:case v.FLOAT_MAT3:case v.FLOAT_MAT3x4:return 3;case v.FLOAT_MAT4x2:case v.FLOAT_MAT4x3:case v.FLOAT_MAT4:return 4;default:return 1}}var jf,jd=[512,513,514,515,516,517,518,519],jp=[0,7680,7681,7682,7683,5386,34055,34056],jS=[32774,32778,32779,32775,32776],jA=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(g){g[g.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",g[g.END_RENDER_PASS=1]="END_RENDER_PASS",g[g.BIND_STATES=2]="BIND_STATES",g[g.DRAW=3]="DRAW",g[g.UPDATE_BUFFER=4]="UPDATE_BUFFER",g[g.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",g[g.BLIT_TEXTURE=6]="BLIT_TEXTURE",g[g.COUNT=7]="COUNT"}(jf||(jf={}));var F0=function(g){this.cmdType=void 0,this.refCount=0,this.cmdType=g},jT=function(g){function e(){var v;return(v=g.call(this,jf.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,v.gpuFramebuffer=null,v.renderArea=new hl,v.clearColors=[],v.clearDepth=1,v.clearStencil=0,v}return s(e,g),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(F0),jE=function(g){function e(){var v;return(v=g.call(this,jf.BIND_STATES)||this).gpuPipelineState=null,v.gpuInputAssembler=null,v.gpuDescriptorSets=[],v.dynamicOffsets=[],v.dynamicStates=new uc,v}return s(e,g),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuInputAssembler=null,this.gpuDescriptorSets.length=0,this.dynamicOffsets.length=0},e}(F0),jC=function(g){function e(){var v;return(v=g.call(this,jf.DRAW)||this).drawInfo=new hR,v}return s(e,g),e.prototype.clear=function(){},e}(F0),jb=function(g){function e(){var v;return(v=g.call(this,jf.UPDATE_BUFFER)||this).gpuBuffer=null,v.buffer=null,v.offset=0,v.size=0,v}return s(e,g),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(F0),jR=function(g){function e(){var v;return(v=g.call(this,jf.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,v.buffers=[],v.regions=[],v}return s(e,g),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(F0),jw=function(g){function e(){var v;return(v=g.call(this,jf.BLIT_TEXTURE)||this).srcTexture=null,v.dstTexture=null,v.regions=[],v.filter=oO.LINEAR,v}return s(e,g),e.prototype.clear=function(){this.srcTexture=null,this.dstTexture=null,this.regions.length=0},e}(F0),jI=function(){function t1(){this.cmds=new am(1),this.beginRenderPassCmds=new am(1),this.bindStatesCmds=new am(1),this.drawCmds=new am(1),this.updateBufferCmds=new am(1),this.copyBufferToTextureCmds=new am(1),this.blitTextureCmds=new am(1)}return t1.prototype.clearCmds=function(g){this.beginRenderPassCmds.length&&(g.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(g.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(g.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(g.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(g.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.blitTextureCmds.length&&(g.blitTextureCmdPool.freeCmds(this.blitTextureCmds),this.blitTextureCmds.clear()),this.cmds.clear()},t1}();function W0(g,v,S,O,X){if(v.usage&oC.INDIRECT){v.indirects.clearDraws();for(var Y=S.drawInfos,te=0;te<Y.length;++te)v.indirects.setDrawInfo(O+te,Y[te])}else{var ti=S,tr=g.gl,ta=g.stateCache;switch(v.glTarget){case tr.ARRAY_BUFFER:g.extensions.useVAO&&ta.glVAO&&(tr.bindVertexArray(null),ta.glVAO=null),jB.gpuInputAssembler=null,ta.glArrayBuffer!==v.glBuffer&&(tr.bindBuffer(tr.ARRAY_BUFFER,v.glBuffer),ta.glArrayBuffer=v.glBuffer),X===ti.byteLength?tr.bufferSubData(v.glTarget,O,ti):tr.bufferSubData(v.glTarget,O,ti.slice(0,X));break;case tr.ELEMENT_ARRAY_BUFFER:g.extensions.useVAO&&ta.glVAO&&(tr.bindVertexArray(null),ta.glVAO=null),jB.gpuInputAssembler=null,ta.glElementArrayBuffer!==v.glBuffer&&(tr.bindBuffer(tr.ELEMENT_ARRAY_BUFFER,v.glBuffer),ta.glElementArrayBuffer=v.glBuffer),X===ti.byteLength?tr.bufferSubData(v.glTarget,O,ti):tr.bufferSubData(v.glTarget,O,ti.slice(0,X));break;case tr.UNIFORM_BUFFER:ta.glUniformBuffer!==v.glBuffer&&(tr.bindBuffer(tr.UNIFORM_BUFFER,v.glBuffer),ta.glUniformBuffer=v.glBuffer),X===ti.byteLength?tr.bufferSubData(v.glTarget,O,ti):tr.bufferSubData(v.glTarget,O,new Float32Array(ti,0,X/4));break;default:k("Unsupported BufferType, update buffer failed.")}}}function X0(g,v){var S=g.gl;v.glInternalFmt=function(g,v){switch(g){case oA.A8:return v.ALPHA;case oA.L8:return v.LUMINANCE;case oA.LA8:return v.LUMINANCE_ALPHA;case oA.R8:return v.R8;case oA.R8SN:return v.R8_SNORM;case oA.R8UI:return v.R8UI;case oA.R8I:return v.R8I;case oA.RG8:return v.RG8;case oA.RG8SN:return v.RG8_SNORM;case oA.RG8UI:return v.RG8UI;case oA.RG8I:return v.RG8I;case oA.RGB8:return v.RGB8;case oA.RGB8SN:return v.RGB8_SNORM;case oA.RGB8UI:return v.RGB8UI;case oA.RGB8I:return v.RGB8I;case oA.BGRA8:case oA.RGBA8:return v.RGBA8;case oA.RGBA8SN:return v.RGBA8_SNORM;case oA.RGBA8UI:return v.RGBA8UI;case oA.RGBA8I:return v.RGBA8I;case oA.R16I:return v.R16I;case oA.R16UI:return v.R16UI;case oA.R16F:return v.R16F;case oA.RG16I:return v.RG16I;case oA.RG16UI:return v.RG16UI;case oA.RG16F:return v.RG16F;case oA.RGB16I:return v.RGB16I;case oA.RGB16UI:return v.RGB16UI;case oA.RGB16F:return v.RGB16F;case oA.RGBA16I:return v.RGBA16I;case oA.RGBA16UI:return v.RGBA16UI;case oA.RGBA16F:return v.RGBA16F;case oA.R32I:return v.R32I;case oA.R32UI:return v.R32UI;case oA.R32F:return v.R32F;case oA.RG32I:return v.RG32I;case oA.RG32UI:return v.RG32UI;case oA.RG32F:return v.RG32F;case oA.RGB32I:return v.RGB32I;case oA.RGB32UI:return v.RGB32UI;case oA.RGB32F:return v.RGB32F;case oA.RGBA32I:return v.RGBA32I;case oA.RGBA32UI:return v.RGBA32UI;case oA.RGBA32F:return v.RGBA32F;case oA.R5G6B5:return v.RGB565;case oA.RGB5A1:return v.RGB5_A1;case oA.RGBA4:return v.RGBA4;case oA.SRGB8:return v.SRGB8;case oA.SRGB8_A8:return v.SRGB8_ALPHA8;case oA.RGB10A2:return v.RGB10_A2;case oA.RGB10A2UI:return v.RGB10_A2UI;case oA.R11G11B10F:return v.R11F_G11F_B10F;case oA.DEPTH:return v.DEPTH_COMPONENT32F;case oA.DEPTH_STENCIL:return v.DEPTH24_STENCIL8;case oA.BC1:return jo.COMPRESSED_RGB_S3TC_DXT1_EXT;case oA.BC1_ALPHA:return jo.COMPRESSED_RGBA_S3TC_DXT1_EXT;case oA.BC1_SRGB:return jo.COMPRESSED_SRGB_S3TC_DXT1_EXT;case oA.BC1_SRGB_ALPHA:return jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case oA.BC2:return jo.COMPRESSED_RGBA_S3TC_DXT3_EXT;case oA.BC2_SRGB:return jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case oA.BC3:return jo.COMPRESSED_RGBA_S3TC_DXT5_EXT;case oA.BC3_SRGB:return jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case oA.ETC_RGB8:return jo.COMPRESSED_RGB_ETC1_WEBGL;case oA.ETC2_RGB8:return jo.COMPRESSED_RGB8_ETC2;case oA.ETC2_SRGB8:return jo.COMPRESSED_SRGB8_ETC2;case oA.ETC2_RGB8_A1:return jo.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case oA.ETC2_SRGB8_A1:return jo.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case oA.ETC2_RGBA8:return jo.COMPRESSED_RGBA8_ETC2_EAC;case oA.ETC2_SRGB8_A8:return jo.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case oA.EAC_R11:return jo.COMPRESSED_R11_EAC;case oA.EAC_R11SN:return jo.COMPRESSED_SIGNED_R11_EAC;case oA.EAC_RG11:return jo.COMPRESSED_RG11_EAC;case oA.EAC_RG11SN:return jo.COMPRESSED_SIGNED_RG11_EAC;case oA.PVRTC_RGB2:return jo.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case oA.PVRTC_RGBA2:return jo.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case oA.PVRTC_RGB4:return jo.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case oA.PVRTC_RGBA4:return jo.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case oA.ASTC_RGBA_4X4:return jo.COMPRESSED_RGBA_ASTC_4x4_KHR;case oA.ASTC_RGBA_5X4:return jo.COMPRESSED_RGBA_ASTC_5x4_KHR;case oA.ASTC_RGBA_5X5:return jo.COMPRESSED_RGBA_ASTC_5x5_KHR;case oA.ASTC_RGBA_6X5:return jo.COMPRESSED_RGBA_ASTC_6x5_KHR;case oA.ASTC_RGBA_6X6:return jo.COMPRESSED_RGBA_ASTC_6x6_KHR;case oA.ASTC_RGBA_8X5:return jo.COMPRESSED_RGBA_ASTC_8x5_KHR;case oA.ASTC_RGBA_8X6:return jo.COMPRESSED_RGBA_ASTC_8x6_KHR;case oA.ASTC_RGBA_8X8:return jo.COMPRESSED_RGBA_ASTC_8x8_KHR;case oA.ASTC_RGBA_10X5:return jo.COMPRESSED_RGBA_ASTC_10x5_KHR;case oA.ASTC_RGBA_10X6:return jo.COMPRESSED_RGBA_ASTC_10x6_KHR;case oA.ASTC_RGBA_10X8:return jo.COMPRESSED_RGBA_ASTC_10x8_KHR;case oA.ASTC_RGBA_10X10:return jo.COMPRESSED_RGBA_ASTC_10x10_KHR;case oA.ASTC_RGBA_12X10:return jo.COMPRESSED_RGBA_ASTC_12x10_KHR;case oA.ASTC_RGBA_12X12:return jo.COMPRESSED_RGBA_ASTC_12x12_KHR;case oA.ASTC_SRGBA_4X4:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case oA.ASTC_SRGBA_5X4:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case oA.ASTC_SRGBA_5X5:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case oA.ASTC_SRGBA_6X5:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case oA.ASTC_SRGBA_6X6:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case oA.ASTC_SRGBA_8X5:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case oA.ASTC_SRGBA_8X6:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case oA.ASTC_SRGBA_8X8:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case oA.ASTC_SRGBA_10X5:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case oA.ASTC_SRGBA_10X6:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case oA.ASTC_SRGBA_10X8:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case oA.ASTC_SRGBA_10X10:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case oA.ASTC_SRGBA_12X10:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case oA.ASTC_SRGBA_12X12:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return k("Unsupported Format, convert to WebGL internal format failed."),v.RGBA}}(v.format,S),v.glFormat=function(g,v){switch(g){case oA.A8:return v.ALPHA;case oA.L8:return v.LUMINANCE;case oA.LA8:return v.LUMINANCE_ALPHA;case oA.R8:case oA.R8SN:return v.RED;case oA.R8UI:case oA.R8I:return v.RED;case oA.RG8:case oA.RG8SN:case oA.RG8UI:case oA.RG8I:return v.RG;case oA.RGB8:case oA.RGB8SN:case oA.RGB8UI:case oA.RGB8I:return v.RGB;case oA.BGRA8:case oA.RGBA8:case oA.RGBA8SN:case oA.RGBA8UI:case oA.RGBA8I:return v.RGBA;case oA.R16UI:case oA.R16I:case oA.R16F:return v.RED;case oA.RG16UI:case oA.RG16I:case oA.RG16F:return v.RG;case oA.RGB16UI:case oA.RGB16I:case oA.RGB16F:return v.RGB;case oA.RGBA16UI:case oA.RGBA16I:case oA.RGBA16F:return v.RGBA;case oA.R32UI:case oA.R32I:case oA.R32F:return v.RED;case oA.RG32UI:case oA.RG32I:case oA.RG32F:return v.RG;case oA.RGB32UI:case oA.RGB32I:case oA.RGB32F:return v.RGB;case oA.RGBA32UI:case oA.RGBA32I:case oA.RGBA32F:case oA.RGB10A2:return v.RGBA;case oA.R11G11B10F:case oA.R5G6B5:return v.RGB;case oA.RGB5A1:case oA.RGBA4:return v.RGBA;case oA.SRGB8:return v.RGB;case oA.SRGB8_A8:return v.RGBA;case oA.DEPTH:return v.DEPTH_COMPONENT;case oA.DEPTH_STENCIL:return v.DEPTH_STENCIL;case oA.BC1:return jo.COMPRESSED_RGB_S3TC_DXT1_EXT;case oA.BC1_ALPHA:return jo.COMPRESSED_RGBA_S3TC_DXT1_EXT;case oA.BC1_SRGB:return jo.COMPRESSED_SRGB_S3TC_DXT1_EXT;case oA.BC1_SRGB_ALPHA:return jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case oA.BC2:return jo.COMPRESSED_RGBA_S3TC_DXT3_EXT;case oA.BC2_SRGB:return jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case oA.BC3:return jo.COMPRESSED_RGBA_S3TC_DXT5_EXT;case oA.BC3_SRGB:return jo.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case oA.ETC_RGB8:return jo.COMPRESSED_RGB_ETC1_WEBGL;case oA.ETC2_RGB8:return jo.COMPRESSED_RGB8_ETC2;case oA.ETC2_SRGB8:return jo.COMPRESSED_SRGB8_ETC2;case oA.ETC2_RGB8_A1:return jo.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case oA.ETC2_SRGB8_A1:return jo.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case oA.ETC2_RGBA8:return jo.COMPRESSED_RGBA8_ETC2_EAC;case oA.ETC2_SRGB8_A8:return jo.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case oA.EAC_R11:return jo.COMPRESSED_R11_EAC;case oA.EAC_R11SN:return jo.COMPRESSED_SIGNED_R11_EAC;case oA.EAC_RG11:return jo.COMPRESSED_RG11_EAC;case oA.EAC_RG11SN:return jo.COMPRESSED_SIGNED_RG11_EAC;case oA.PVRTC_RGB2:return jo.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case oA.PVRTC_RGBA2:return jo.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case oA.PVRTC_RGB4:return jo.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case oA.PVRTC_RGBA4:return jo.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case oA.ASTC_RGBA_4X4:return jo.COMPRESSED_RGBA_ASTC_4x4_KHR;case oA.ASTC_RGBA_5X4:return jo.COMPRESSED_RGBA_ASTC_5x4_KHR;case oA.ASTC_RGBA_5X5:return jo.COMPRESSED_RGBA_ASTC_5x5_KHR;case oA.ASTC_RGBA_6X5:return jo.COMPRESSED_RGBA_ASTC_6x5_KHR;case oA.ASTC_RGBA_6X6:return jo.COMPRESSED_RGBA_ASTC_6x6_KHR;case oA.ASTC_RGBA_8X5:return jo.COMPRESSED_RGBA_ASTC_8x5_KHR;case oA.ASTC_RGBA_8X6:return jo.COMPRESSED_RGBA_ASTC_8x6_KHR;case oA.ASTC_RGBA_8X8:return jo.COMPRESSED_RGBA_ASTC_8x8_KHR;case oA.ASTC_RGBA_10X5:return jo.COMPRESSED_RGBA_ASTC_10x5_KHR;case oA.ASTC_RGBA_10X6:return jo.COMPRESSED_RGBA_ASTC_10x6_KHR;case oA.ASTC_RGBA_10X8:return jo.COMPRESSED_RGBA_ASTC_10x8_KHR;case oA.ASTC_RGBA_10X10:return jo.COMPRESSED_RGBA_ASTC_10x10_KHR;case oA.ASTC_RGBA_12X10:return jo.COMPRESSED_RGBA_ASTC_12x10_KHR;case oA.ASTC_RGBA_12X12:return jo.COMPRESSED_RGBA_ASTC_12x12_KHR;case oA.ASTC_SRGBA_4X4:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case oA.ASTC_SRGBA_5X4:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case oA.ASTC_SRGBA_5X5:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case oA.ASTC_SRGBA_6X5:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case oA.ASTC_SRGBA_6X6:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case oA.ASTC_SRGBA_8X5:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case oA.ASTC_SRGBA_8X6:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case oA.ASTC_SRGBA_8X8:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case oA.ASTC_SRGBA_10X5:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case oA.ASTC_SRGBA_10X6:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case oA.ASTC_SRGBA_10X8:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case oA.ASTC_SRGBA_10X10:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case oA.ASTC_SRGBA_12X10:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case oA.ASTC_SRGBA_12X12:return jo.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return k("Unsupported Format, convert to WebGL format failed."),v.RGBA}}(v.format,S),v.glType=x0(v.format,S);var O=v.width,X=v.height,Y=v.depth,te=v.arrayLayer;switch(v.type){case ow.TEX2D:v.glTarget=S.TEXTURE_2D;var ti=Math.max(O,X);if(ti>g.capabilities.maxTextureSize&&J(9100,ti,g.capabilities.maxTextureSize),v.samples===oD.X1){if(v.glTexture=S.createTexture(),v.size>0){var tr=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tr.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_2D,v.glTexture),tr.glTexture=v.glTexture),uf[v.format].isCompressed)for(var ta=0;ta<v.mipLevel;++ta){var th=w_(v.format,O,X,1),tu=new Uint8Array(th);S.compressedTexImage2D(S.TEXTURE_2D,ta,v.glInternalFmt,O,X,0,tu),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else v.flags&oB.MUTABLE_STORAGE?S.texImage2D(S.TEXTURE_2D,0,v.glInternalFmt,O,X,0,v.glFormat,v.glType,null):S.texStorage2D(S.TEXTURE_2D,v.mipLevel,v.glInternalFmt,O,X)}}else v.glRenderbuffer=S.createRenderbuffer(),v.size>0&&(g.stateCache.glRenderbuffer!==v.glRenderbuffer&&(S.bindRenderbuffer(S.RENDERBUFFER,v.glRenderbuffer),g.stateCache.glRenderbuffer=v.glRenderbuffer),S.renderbufferStorageMultisample(S.RENDERBUFFER,v.samples,v.glInternalFmt,v.width,v.height));break;case ow.TEX2D_ARRAY:v.glTarget=S.TEXTURE_2D_ARRAY;var tl=Math.max(O,X);if(tl>g.capabilities.maxTextureSize&&J(9100,tl,g.capabilities.maxTextureSize),te>g.capabilities.maxArrayTextureLayers&&J(9100,te,g.capabilities.maxArrayTextureLayers),v.glTexture=S.createTexture(),v.size>0){var tc=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tc.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_2D_ARRAY,v.glTexture),tc.glTexture=v.glTexture),uf[v.format].isCompressed)for(var t_=0;t_<v.mipLevel;++t_){var tf=w_(v.format,O,X,te),tp=new Uint8Array(tf);S.compressedTexImage3D(S.TEXTURE_2D_ARRAY,t_,v.glInternalFmt,O,X,te,0,tp),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else S.texStorage3D(S.TEXTURE_2D_ARRAY,v.mipLevel,v.glInternalFmt,O,X,te)}break;case ow.TEX3D:v.glTarget=S.TEXTURE_3D;var tm=Math.max(Math.max(O,X),Y);if(tm>g.capabilities.max3DTextureSize&&J(9100,tm,g.capabilities.max3DTextureSize),v.glTexture=S.createTexture(),v.size>0){var tg=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tg.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_3D,v.glTexture),tg.glTexture=v.glTexture),uf[v.format].isCompressed)for(var tv=0;tv<v.mipLevel;++tv){var ty=w_(v.format,O,X,Y),tS=new Uint8Array(ty);S.compressedTexImage3D(S.TEXTURE_3D,tv,v.glInternalFmt,O,X,Y,0,tS),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else S.texStorage3D(S.TEXTURE_3D,v.mipLevel,v.glInternalFmt,O,X,Y)}break;case ow.CUBE:v.glTarget=S.TEXTURE_CUBE_MAP;var tA=Math.max(O,X);if(tA>g.capabilities.maxCubeMapTextureSize&&J(9100,tA,g.capabilities.maxTextureSize),v.glTexture=S.createTexture(),v.size>0){var tT=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tT.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_CUBE_MAP,v.glTexture),tT.glTexture=v.glTexture),uf[v.format].isCompressed)for(var tE=0;tE<v.mipLevel;++tE){for(var tC=w_(v.format,O,X,1),tx=new Uint8Array(tC),tb=0;tb<6;++tb)S.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+tb,tE,v.glInternalFmt,O,X,0,tx);O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else S.texStorage2D(S.TEXTURE_CUBE_MAP,v.mipLevel,v.glInternalFmt,O,X)}break;default:k("Unsupported TextureType, create texture failed."),v.type=ow.TEX2D,v.glTarget=S.TEXTURE_2D}}function j0(g,v){var S=g.gl;if(v.glTexture){var O=g.stateCache.glTexUnits,X=g.stateCache.texUnit;S.deleteTexture(v.glTexture);for(var Y=0;Y<O.length;++Y)O[Y].glTexture===v.glTexture&&(S.activeTexture(S.TEXTURE0+Y),X=Y,S.bindTexture(v.glTarget,null),O[Y].glTexture=null);g.stateCache.texUnit=X,v.glTexture=null}if(v.glRenderbuffer){var te=g.stateCache.glRenderbuffer;S.deleteRenderbuffer(v.glRenderbuffer),te===v.glRenderbuffer&&(S.bindRenderbuffer(S.RENDERBUFFER,null),te=null),v.glRenderbuffer=null}}var jB={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0,invalidateAttachments:[]};function q0(g,v,S,O,X,Y,te){var ti=g.gl,tr=g.stateCache,ta=0;if(S&&v){tr.glFramebuffer!==S.glFramebuffer&&(ti.bindFramebuffer(ti.FRAMEBUFFER,S.glFramebuffer),tr.glFramebuffer=S.glFramebuffer),tr.viewport.left===O.x&&tr.viewport.top===O.y&&tr.viewport.width===O.width&&tr.viewport.height===O.height||(ti.viewport(O.x,O.y,O.width,O.height),tr.viewport.left=O.x,tr.viewport.top=O.y,tr.viewport.width=O.width,tr.viewport.height=O.height),tr.scissorRect.x===O.x&&tr.scissorRect.y===O.y&&tr.scissorRect.width===O.width&&tr.scissorRect.height===O.height||(ti.scissor(O.x,O.y,O.width,O.height),tr.scissorRect.x=O.x,tr.scissorRect.y=O.y,tr.scissorRect.width=O.width,tr.scissorRect.height=O.height),jB.invalidateAttachments.length=0;for(var th=0;th<X.length;++th){var tu=v.colorAttachments[th];if(tu.format!==oA.UNKNOWN)switch(tu.loadOp){case oH.LOAD:break;case oH.CLEAR:if(tr.bs.targets[0].blendColorMask!==oV.ALL&&ti.colorMask(!0,!0,!0,!0),1===v.colorAttachments.length){var tl=X[0];ti.clearColor(tl.x,tl.y,tl.z,tl.w),ta|=ti.COLOR_BUFFER_BIT}else j_[0]=X[th].x,j_[1]=X[th].y,j_[2]=X[th].z,j_[3]=X[th].w,ti.clearBufferfv(ti.COLOR,th,j_);break;case oH.DISCARD:jB.invalidateAttachments.push(ti.COLOR_ATTACHMENT0+th)}}if(v.depthStencilAttachment&&v.depthStencilAttachment.format!==oA.UNKNOWN){switch(v.depthStencilAttachment.depthLoadOp){case oH.LOAD:break;case oH.CLEAR:tr.dss.depthWrite||ti.depthMask(!0),ti.clearDepth(Y),ta|=ti.DEPTH_BUFFER_BIT;break;case oH.DISCARD:jB.invalidateAttachments.push(ti.DEPTH_ATTACHMENT)}if(uf[v.depthStencilAttachment.format].hasStencil)switch(v.depthStencilAttachment.stencilLoadOp){case oH.LOAD:break;case oH.CLEAR:tr.dss.stencilWriteMaskFront||ti.stencilMaskSeparate(ti.FRONT,65535),tr.dss.stencilWriteMaskBack||ti.stencilMaskSeparate(ti.BACK,65535),ti.clearStencil(te),ta|=ti.STENCIL_BUFFER_BIT;break;case oH.DISCARD:jB.invalidateAttachments.push(ti.STENCIL_ATTACHMENT)}}if(S.glFramebuffer&&jB.invalidateAttachments.length&&ti.invalidateFramebuffer(ti.FRAMEBUFFER,jB.invalidateAttachments),ta&&ti.clear(ta),ta&ti.COLOR_BUFFER_BIT){var tc=tr.bs.targets[0].blendColorMask;if(tc!==oV.ALL){var t_=(tc&oV.R)!==oV.NONE,tf=(tc&oV.G)!==oV.NONE,tp=(tc&oV.B)!==oV.NONE,tm=(tc&oV.A)!==oV.NONE;ti.colorMask(t_,tf,tp,tm)}}ta&ti.DEPTH_BUFFER_BIT&&!tr.dss.depthWrite&&ti.depthMask(!1),ta&ti.STENCIL_BUFFER_BIT&&(tr.dss.stencilWriteMaskFront||ti.stencilMaskSeparate(ti.FRONT,0),tr.dss.stencilWriteMaskBack||ti.stencilMaskSeparate(ti.BACK,0))}}function K0(g,v,S,O,X,Y){var te=g.gl,ti=g.stateCache,tr=v&&v.gpuShader,ta=!1;if(v&&jB.gpuPipelineState!==v){if(jB.gpuPipelineState=v,jB.glPrimitive=v.glPrimitive,tr){var th=tr.glProgram;ti.glProgram!==th&&(te.useProgram(th),ti.glProgram=th,ta=!0)}var tu=v.rs;if(tu){if(ti.rs.cullMode!==tu.cullMode){switch(tu.cullMode){case o$.NONE:te.disable(te.CULL_FACE);break;case o$.FRONT:te.enable(te.CULL_FACE),te.cullFace(te.FRONT);break;case o$.BACK:te.enable(te.CULL_FACE),te.cullFace(te.BACK)}g.stateCache.rs.cullMode=tu.cullMode}var tl=tu.isFrontFaceCCW;g.stateCache.rs.isFrontFaceCCW!==tl&&(te.frontFace(tl?te.CCW:te.CW),g.stateCache.rs.isFrontFaceCCW=tl),g.stateCache.rs.depthBias===tu.depthBias&&g.stateCache.rs.depthBiasSlop===tu.depthBiasSlop||(te.polygonOffset(tu.depthBias,tu.depthBiasSlop),g.stateCache.rs.depthBias=tu.depthBias,g.stateCache.rs.depthBiasSlop=tu.depthBiasSlop),g.stateCache.rs.lineWidth!==tu.lineWidth&&(te.lineWidth(tu.lineWidth),g.stateCache.rs.lineWidth=tu.lineWidth)}var tc=v.dss;tc&&(ti.dss.depthTest!==tc.depthTest&&(tc.depthTest?te.enable(te.DEPTH_TEST):te.disable(te.DEPTH_TEST),ti.dss.depthTest=tc.depthTest),ti.dss.depthWrite!==tc.depthWrite&&(te.depthMask(tc.depthWrite),ti.dss.depthWrite=tc.depthWrite),ti.dss.depthFunc!==tc.depthFunc&&(te.depthFunc(jd[tc.depthFunc]),ti.dss.depthFunc=tc.depthFunc),ti.dss.stencilTestFront===tc.stencilTestFront&&ti.dss.stencilTestBack===tc.stencilTestBack||(tc.stencilTestFront||tc.stencilTestBack?te.enable(te.STENCIL_TEST):te.disable(te.STENCIL_TEST),ti.dss.stencilTestFront=tc.stencilTestFront,ti.dss.stencilTestBack=tc.stencilTestBack),ti.dss.stencilFuncFront===tc.stencilFuncFront&&ti.dss.stencilRefFront===tc.stencilRefFront&&ti.dss.stencilReadMaskFront===tc.stencilReadMaskFront||(te.stencilFuncSeparate(te.FRONT,jd[tc.stencilFuncFront],tc.stencilRefFront,tc.stencilReadMaskFront),ti.dss.stencilFuncFront=tc.stencilFuncFront,ti.dss.stencilRefFront=tc.stencilRefFront,ti.dss.stencilReadMaskFront=tc.stencilReadMaskFront),ti.dss.stencilFailOpFront===tc.stencilFailOpFront&&ti.dss.stencilZFailOpFront===tc.stencilZFailOpFront&&ti.dss.stencilPassOpFront===tc.stencilPassOpFront||(te.stencilOpSeparate(te.FRONT,jp[tc.stencilFailOpFront],jp[tc.stencilZFailOpFront],jp[tc.stencilPassOpFront]),ti.dss.stencilFailOpFront=tc.stencilFailOpFront,ti.dss.stencilZFailOpFront=tc.stencilZFailOpFront,ti.dss.stencilPassOpFront=tc.stencilPassOpFront),ti.dss.stencilWriteMaskFront!==tc.stencilWriteMaskFront&&(te.stencilMaskSeparate(te.FRONT,tc.stencilWriteMaskFront),ti.dss.stencilWriteMaskFront=tc.stencilWriteMaskFront),ti.dss.stencilFuncBack===tc.stencilFuncBack&&ti.dss.stencilRefBack===tc.stencilRefBack&&ti.dss.stencilReadMaskBack===tc.stencilReadMaskBack||(te.stencilFuncSeparate(te.BACK,jd[tc.stencilFuncBack],tc.stencilRefBack,tc.stencilReadMaskBack),ti.dss.stencilFuncBack=tc.stencilFuncBack,ti.dss.stencilRefBack=tc.stencilRefBack,ti.dss.stencilReadMaskBack=tc.stencilReadMaskBack),ti.dss.stencilFailOpBack===tc.stencilFailOpBack&&ti.dss.stencilZFailOpBack===tc.stencilZFailOpBack&&ti.dss.stencilPassOpBack===tc.stencilPassOpBack||(te.stencilOpSeparate(te.BACK,jp[tc.stencilFailOpBack],jp[tc.stencilZFailOpBack],jp[tc.stencilPassOpBack]),ti.dss.stencilFailOpBack=tc.stencilFailOpBack,ti.dss.stencilZFailOpBack=tc.stencilZFailOpBack,ti.dss.stencilPassOpBack=tc.stencilPassOpBack),ti.dss.stencilWriteMaskBack!==tc.stencilWriteMaskBack&&(te.stencilMaskSeparate(te.BACK,tc.stencilWriteMaskBack),ti.dss.stencilWriteMaskBack=tc.stencilWriteMaskBack));var t_=v.bs;if(t_){ti.bs.isA2C!==t_.isA2C&&(t_.isA2C?te.enable(te.SAMPLE_ALPHA_TO_COVERAGE):te.disable(te.SAMPLE_ALPHA_TO_COVERAGE),ti.bs.isA2C=t_.isA2C),ti.bs.blendColor.x===t_.blendColor.x&&ti.bs.blendColor.y===t_.blendColor.y&&ti.bs.blendColor.z===t_.blendColor.z&&ti.bs.blendColor.w===t_.blendColor.w||(te.blendColor(t_.blendColor.x,t_.blendColor.y,t_.blendColor.z,t_.blendColor.w),ti.bs.blendColor.x=t_.blendColor.x,ti.bs.blendColor.y=t_.blendColor.y,ti.bs.blendColor.z=t_.blendColor.z,ti.bs.blendColor.w=t_.blendColor.w);var tf=t_.targets[0],tp=ti.bs.targets[0];tp.blend!==tf.blend&&(tf.blend?te.enable(te.BLEND):te.disable(te.BLEND),tp.blend=tf.blend),tp.blendEq===tf.blendEq&&tp.blendAlphaEq===tf.blendAlphaEq||(te.blendEquationSeparate(jS[tf.blendEq],jS[tf.blendAlphaEq]),tp.blendEq=tf.blendEq,tp.blendAlphaEq=tf.blendAlphaEq),tp.blendSrc===tf.blendSrc&&tp.blendDst===tf.blendDst&&tp.blendSrcAlpha===tf.blendSrcAlpha&&tp.blendDstAlpha===tf.blendDstAlpha||(te.blendFuncSeparate(jA[tf.blendSrc],jA[tf.blendDst],jA[tf.blendSrcAlpha],jA[tf.blendDstAlpha]),tp.blendSrc=tf.blendSrc,tp.blendDst=tf.blendDst,tp.blendSrcAlpha=tf.blendSrcAlpha,tp.blendDstAlpha=tf.blendDstAlpha),tp.blendColorMask!==tf.blendColorMask&&(te.colorMask((tf.blendColorMask&oV.R)!==oV.NONE,(tf.blendColorMask&oV.G)!==oV.NONE,(tf.blendColorMask&oV.B)!==oV.NONE,(tf.blendColorMask&oV.A)!==oV.NONE),tp.blendColorMask=tf.blendColorMask)}}if(v&&v.gpuPipelineLayout&&tr){for(var tm=tr.glBlocks.length,tg=v.gpuPipelineLayout.dynamicOffsetIndices,tv=0;tv<tm;tv++){var ty=tr.glBlocks[tv],tS=O[ty.set],tA=tS&&tS.descriptorIndices[ty.binding],tT=tA>=0&&tS.gpuDescriptors[tA];if(tT&&tT.gpuBuffer){var tE=tg[ty.set],tC=tE&&tE[ty.binding],tx=tT.gpuBuffer.glOffset;tC>=0&&(tx+=X[tC]),ti.glBindUBOs[ty.glBinding]===tT.gpuBuffer.glBuffer&&ti.glBindUBOOffsets[ty.glBinding]===tx||(tx?te.bindBufferRange(te.UNIFORM_BUFFER,ty.glBinding,tT.gpuBuffer.glBuffer,tx,tT.gpuBuffer.size):te.bindBufferBase(te.UNIFORM_BUFFER,ty.glBinding,tT.gpuBuffer.glBuffer),ti.glUniformBuffer=ti.glBindUBOs[ty.glBinding]=tT.gpuBuffer.glBuffer,ti.glBindUBOOffsets[ty.glBinding]=tx)}}for(var tb=tr.glSamplerTextures.length,tw=0;tw<tb;tw++)for(var tI=tr.glSamplerTextures[tw],tB=O[tI.set],tP=tB&&tB.descriptorIndices[tI.binding],tD=tP>=0&&tB.gpuDescriptors[tP],tM=0;tM<tI.units.length;tM++){var tO=tI.units[tM],tk=ti.glTexUnits[tO];if(tD&&tD.gpuTextureView&&tD.gpuTextureView.gpuTexture&&tD.gpuSampler){var tG=tD.gpuTextureView,tV=tG.gpuTexture,tU=tG.baseLevel,tH=tU+tG.levelCount;if(tV.size>0){tk.glTexture!==tV.glTexture&&(ti.texUnit!==tO&&(te.activeTexture(te.TEXTURE0+tO),ti.texUnit=tO),tV.glTexture?te.bindTexture(tV.glTarget,tV.glTexture):te.bindTexture(tV.glTarget,g.nullTex2D.gpuTexture.glTexture),tk.glTexture=tV.glTexture);var tz=tD.gpuSampler.getGLSampler(g,tU,tH);ti.glSamplerUnits[tO]!==tz&&(te.bindSampler(tO,tz),ti.glSamplerUnits[tO]=tz)}tD=tB.gpuDescriptors[++tP]}}}if(S&&tr&&(ta||jB.gpuInputAssembler!==S)){if(jB.gpuInputAssembler=S,g.extensions.useVAO){var tW=S.glVAOs.get(tr.glProgram);if(!tW){var tj;tW=te.createVertexArray(),S.glVAOs.set(tr.glProgram,tW),te.bindVertexArray(tW),te.bindBuffer(te.ARRAY_BUFFER,null),te.bindBuffer(te.ELEMENT_ARRAY_BUFFER,null),ti.glArrayBuffer=null,ti.glElementArrayBuffer=null;for(var tq=0;tq<tr.glInputs.length;tq++){var tK=tr.glInputs[tq];tj=null;for(var tZ=0;tZ<S.glAttribs.length;tZ++){var tQ=S.glAttribs[tZ];if(tQ.name===tK.name){tj=tQ;break}}if(tj){ti.glArrayBuffer!==tj.glBuffer&&(te.bindBuffer(te.ARRAY_BUFFER,tj.glBuffer),ti.glArrayBuffer=tj.glBuffer);for(var t$=0;t$<tj.componentCount;++t$){var t0=tK.glLoc+t$,t2=tj.offset+tj.size*t$;te.enableVertexAttribArray(t0),ti.glCurrentAttribLocs[t0]=!0,te.vertexAttribPointer(t0,tj.count,tj.glType,tj.isNormalized,tj.stride,t2),te.vertexAttribDivisor(t0,tj.isInstanced?1:0)}}}var t3=S.gpuIndexBuffer;t3&&te.bindBuffer(te.ELEMENT_ARRAY_BUFFER,t3.glBuffer),te.bindVertexArray(null),te.bindBuffer(te.ARRAY_BUFFER,null),te.bindBuffer(te.ELEMENT_ARRAY_BUFFER,null),ti.glArrayBuffer=null,ti.glElementArrayBuffer=null}ti.glVAO!==tW&&(te.bindVertexArray(tW),ti.glVAO=tW)}else{for(var t4=0;t4<g.capabilities.maxVertexAttributes;++t4)ti.glCurrentAttribLocs[t4]=!1;for(var t8=0;t8<tr.glInputs.length;t8++){for(var t6=tr.glInputs[t8],t7=null,t9=0;t9<S.glAttribs.length;t9++){var ee=S.glAttribs[t9];if(ee.name===t6.name){t7=ee;break}}if(t7){ti.glArrayBuffer!==t7.glBuffer&&(te.bindBuffer(te.ARRAY_BUFFER,t7.glBuffer),ti.glArrayBuffer=t7.glBuffer);for(var en=0;en<t7.componentCount;++en){var er=t6.glLoc+en,es=t7.offset+t7.size*en;!ti.glEnabledAttribLocs[er]&&er>=0&&(te.enableVertexAttribArray(er),ti.glEnabledAttribLocs[er]=!0),ti.glCurrentAttribLocs[er]=!0,te.vertexAttribPointer(er,t7.count,t7.glType,t7.isNormalized,t7.stride,es),te.vertexAttribDivisor(er,t7.isInstanced?1:0)}}}var ea=S.gpuIndexBuffer;ea&&ti.glElementArrayBuffer!==ea.glBuffer&&(te.bindBuffer(te.ELEMENT_ARRAY_BUFFER,ea.glBuffer),ti.glElementArrayBuffer=ea.glBuffer);for(var eh=0;eh<g.capabilities.maxVertexAttributes;++eh)ti.glEnabledAttribLocs[eh]!==ti.glCurrentAttribLocs[eh]&&(te.disableVertexAttribArray(eh),ti.glEnabledAttribLocs[eh]=!1)}}if(v&&v.dynamicStates.length)for(var eu=v.dynamicStates.length,ec=0;ec<eu;ec++)switch(v.dynamicStates[ec]){case o0.LINE_WIDTH:ti.rs.lineWidth!==Y.lineWidth&&(te.lineWidth(Y.lineWidth),ti.rs.lineWidth=Y.lineWidth);break;case o0.DEPTH_BIAS:ti.rs.depthBias===Y.depthBiasConstant&&ti.rs.depthBiasSlop===Y.depthBiasSlope||(te.polygonOffset(Y.depthBiasConstant,Y.depthBiasSlope),ti.rs.depthBias=Y.depthBiasConstant,ti.rs.depthBiasSlop=Y.depthBiasSlope);break;case o0.BLEND_CONSTANTS:var e_=Y.blendConstant;ti.bs.blendColor.x===e_.x&&ti.bs.blendColor.y===e_.y&&ti.bs.blendColor.z===e_.z&&ti.bs.blendColor.w===e_.w||(te.blendColor(e_.x,e_.y,e_.z,e_.w),ti.bs.blendColor.copy(e_));break;case o0.STENCIL_WRITE_MASK:var ef=Y.stencilStatesFront,em=Y.stencilStatesBack;ti.dss.stencilWriteMaskFront!==ef.writeMask&&(te.stencilMaskSeparate(te.FRONT,ef.writeMask),ti.dss.stencilWriteMaskFront=ef.writeMask),ti.dss.stencilWriteMaskBack!==em.writeMask&&(te.stencilMaskSeparate(te.BACK,em.writeMask),ti.dss.stencilWriteMaskBack=em.writeMask);break;case o0.STENCIL_COMPARE_MASK:var eg=Y.stencilStatesFront,ey=Y.stencilStatesBack;ti.dss.stencilRefFront===eg.reference&&ti.dss.stencilReadMaskFront===eg.compareMask||(te.stencilFuncSeparate(te.FRONT,jd[ti.dss.stencilFuncFront],eg.reference,eg.compareMask),ti.dss.stencilRefFront=eg.reference,ti.dss.stencilReadMaskFront=eg.compareMask),ti.dss.stencilRefBack===ey.reference&&ti.dss.stencilReadMaskBack===ey.compareMask||(te.stencilFuncSeparate(te.BACK,jd[ti.dss.stencilFuncBack],ey.reference,ey.compareMask),ti.dss.stencilRefBack=ey.reference,ti.dss.stencilReadMaskBack=ey.compareMask)}}function J0(g,v){var S=g.gl,O=jB.gpuInputAssembler,X=jB.glPrimitive,Y=g.extensions.WEBGL_multi_draw;if(O){var te=O.gpuIndexBuffer;if(O.gpuIndirectBuffer){var ti=O.gpuIndirectBuffer.indirects;if(ti.drawByIndex){for(var tr=0;tr<ti.drawCount;tr++)ti.byteOffsets[tr]=ti.offsets[tr]*te.stride;if(Y)ti.instancedDraw?Y.multiDrawElementsInstancedWEBGL(X,ti.counts,0,O.glIndexType,ti.byteOffsets,0,ti.instances,0,ti.drawCount):Y.multiDrawElementsWEBGL(X,ti.counts,0,O.glIndexType,ti.byteOffsets,0,ti.drawCount);else for(var ta=0;ta<ti.drawCount;ta++)ti.instances[ta]?S.drawElementsInstanced(X,ti.counts[ta],O.glIndexType,ti.byteOffsets[ta],ti.instances[ta]):S.drawElements(X,ti.counts[ta],O.glIndexType,ti.byteOffsets[ta])}else if(Y)ti.instancedDraw?Y.multiDrawArraysInstancedWEBGL(X,ti.offsets,0,ti.counts,0,ti.instances,0,ti.drawCount):Y.multiDrawArraysWEBGL(X,ti.offsets,0,ti.counts,0,ti.drawCount);else for(var th=0;th<ti.drawCount;th++)ti.instances[th]?S.drawArraysInstanced(X,ti.offsets[th],ti.counts[th],ti.instances[th]):S.drawArrays(X,ti.offsets[th],ti.counts[th])}else if(v.instanceCount){if(te){if(v.indexCount>0){var tu=v.firstIndex*te.stride;S.drawElementsInstanced(X,v.indexCount,O.glIndexType,tu,v.instanceCount)}}else v.vertexCount>0&&S.drawArraysInstanced(X,v.firstVertex,v.vertexCount,v.instanceCount)}else if(te){if(v.indexCount>0){var tl=v.firstIndex*te.stride;S.drawElements(X,v.indexCount,O.glIndexType,tl)}}else v.vertexCount>0&&S.drawArrays(X,v.firstVertex,v.vertexCount)}}var jP=new Array(jf.COUNT);function Z0(g,v){jP.fill(0);for(var S=0;S<v.cmds.length;++S){var O=v.cmds.array[S],X=jP[O]++;switch(O){case jf.BEGIN_RENDER_PASS:var Y=v.beginRenderPassCmds.array[X];q0(g,Y.gpuRenderPass,Y.gpuFramebuffer,Y.renderArea,Y.clearColors,Y.clearDepth,Y.clearStencil);break;case jf.BIND_STATES:var te=v.bindStatesCmds.array[X];K0(g,te.gpuPipelineState,te.gpuInputAssembler,te.gpuDescriptorSets,te.dynamicOffsets,te.dynamicStates);break;case jf.DRAW:J0(g,v.drawCmds.array[X].drawInfo);break;case jf.UPDATE_BUFFER:var ti=v.updateBufferCmds.array[X];W0(g,ti.gpuBuffer,ti.buffer,ti.offset,ti.size);break;case jf.COPY_BUFFER_TO_TEXTURE:var tr=v.copyBufferToTextureCmds.array[X];e1(g,tr.buffers,tr.gpuTexture,tr.regions);break;case jf.BLIT_TEXTURE:var ta=v.blitTextureCmds.array[X];i1(g,ta.srcTexture,ta.dstTexture,ta.regions,ta.filter)}}}var jD=new Uint8Array(1);function t11(g,v,S,O,X){var Y=O_(v).height,te=w_(v,X.width,X.height,X.depth),ti=w_(v,O.width,1,1),tr=w_(v,O.width,O.height,1),ta=w_(v,X.width,1,1),th=D_(uf[v]);jD.byteLength<te&&(jD=new Uint8Array(te));for(var tu=0,tl=S,tc=0;tc<X.depth;tc++){tl=S+tr*tc;for(var t_=0;t_<X.height;t_+=Y)jD.subarray(tu,tu+ta).set(new Uint8Array(g.buffer,g.byteOffset+tl,ta)),tu+=ta,tl+=ti}var tf=te/th.BYTES_PER_ELEMENT;return $(Number.isInteger(tf),9101),new th(jD.buffer,0,tf)}function e1(g,v,S,O){var X=g.gl,Y=g.stateCache.glTexUnits[g.stateCache.texUnit];Y.glTexture!==S.glTexture&&(X.bindTexture(S.glTarget,S.glTexture),Y.glTexture=S.glTexture);var te=0,ti=0,tr=uf[S.format],ta=D_(tr),th=tr.isCompressed,tu=O_(S.format),tl=new hc,tc=new hu,t_=new hc;switch(S.glTarget){case X.TEXTURE_2D:for(var tf=0;tf<O.length;tf++){var tp=O[tf],tm=tp.texSubres.mipLevel;tc.x=0===tp.texOffset.x?0:M_(tp.texOffset.x,tu.width),tc.y=0===tp.texOffset.y?0:M_(tp.texOffset.y,tu.height),tl.width=tp.texExtent.width<tu.width?tp.texExtent.width:M_(tp.texExtent.width,tu.width),tl.height=tp.texExtent.height<tu.height?tp.texExtent.width:M_(tp.texExtent.height,tu.height),t_.width=tp.buffStride>0?tp.buffStride:tl.width,t_.height=tp.buffTexHeight>0?tp.buffTexHeight:tl.height;var tg=tp.texExtent.width+tc.x===S.width>>tm?tp.texExtent.width:tl.width,tv=tp.texExtent.height+tc.y===S.height>>tm?tp.texExtent.height:tl.height,ty=void 0,tS=v[te++];if(t_.width===tl.width&&t_.height===tl.height){var tA=w_(S.format,tg,tv,1)/ta.BYTES_PER_ELEMENT;$(Number.isInteger(tA),9101),ty=new ta(tS.buffer,tS.byteOffset+tp.buffOffset,tA)}else ty=t11(tS,S.format,tp.buffOffset,t_,tl);th?S.glInternalFmt!==jo.COMPRESSED_RGB_ETC1_WEBGL?X.compressedTexSubImage2D(X.TEXTURE_2D,tm,tc.x,tc.y,tg,tv,S.glFormat,ty):X.compressedTexImage2D(X.TEXTURE_2D,tm,S.glInternalFmt,tg,tv,0,ty):X.texSubImage2D(X.TEXTURE_2D,tm,tc.x,tc.y,tg,tv,S.glFormat,S.glType,ty)}break;case X.TEXTURE_2D_ARRAY:for(var tT=0;tT<O.length;tT++){var tE=O[tT],tC=tE.texSubres.mipLevel;tc.x=0===tE.texOffset.x?0:M_(tE.texOffset.x,tu.width),tc.y=0===tE.texOffset.y?0:M_(tE.texOffset.y,tu.height),tl.width=tE.texExtent.width<tu.width?tE.texExtent.width:M_(tE.texExtent.width,tu.width),tl.height=tE.texExtent.height<tu.height?tE.texExtent.width:M_(tE.texExtent.height,tu.height),tl.depth=1,t_.width=tE.buffStride>0?tE.buffStride:tl.width,t_.height=tE.buffTexHeight>0?tE.buffTexHeight:tl.height;var tx=tE.texExtent.width+tc.x===S.width>>tC?tE.texExtent.width:tl.width,tb=tE.texExtent.height+tc.y===S.height>>tC?tE.texExtent.height:tl.height,tw=tE.texSubres.baseArrayLayer+tE.texSubres.layerCount;for(ti=tE.texSubres.baseArrayLayer;ti<tw;++ti){tc.z=ti;var tI=void 0,tB=v[te++];if(t_.width===tl.width&&t_.height===tl.height){var tP=w_(S.format,tx,tb,1)/ta.BYTES_PER_ELEMENT;$(Number.isInteger(tP),9101),tI=new ta(tB.buffer,tB.byteOffset+tE.buffOffset,tP)}else tI=t11(tB,S.format,tE.buffOffset,t_,tl);th?S.glInternalFmt!==jo.COMPRESSED_RGB_ETC1_WEBGL?X.compressedTexSubImage3D(X.TEXTURE_2D_ARRAY,tC,tc.x,tc.y,tc.z,tx,tb,tl.depth,S.glFormat,tI):X.compressedTexImage3D(X.TEXTURE_2D_ARRAY,tC,S.glInternalFmt,tx,tb,tl.depth,0,tI):X.texSubImage3D(X.TEXTURE_2D_ARRAY,tC,tc.x,tc.y,tc.z,tx,tb,tl.depth,S.glFormat,S.glType,tI)}}break;case X.TEXTURE_3D:for(var tD=0;tD<O.length;tD++){var tM=O[tD],tO=tM.texSubres.mipLevel;tc.x=0===tM.texOffset.x?0:M_(tM.texOffset.x,tu.width),tc.y=0===tM.texOffset.y?0:M_(tM.texOffset.y,tu.height),tc.z=tM.texOffset.z,tl.width=tM.texExtent.width<tu.width?tM.texExtent.width:M_(tM.texExtent.width,tu.width),tl.height=tM.texExtent.height<tu.height?tM.texExtent.width:M_(tM.texExtent.height,tu.height),tl.depth=tM.texExtent.depth,t_.width=tM.buffStride>0?tM.buffStride:tl.width,t_.height=tM.buffTexHeight>0?tM.buffTexHeight:tl.height;var tk=tM.texExtent.width+tc.x===S.width>>tO?tM.texExtent.width:tl.width,tG=tM.texExtent.height+tc.y===S.height>>tO?tM.texExtent.height:tl.height,tV=void 0,tU=v[te++];if(t_.width===tl.width&&t_.height===tl.height){var tH=w_(S.format,tk,tG,tl.depth)/ta.BYTES_PER_ELEMENT;$(Number.isInteger(tH),9101),tV=new ta(tU.buffer,tU.byteOffset+tM.buffOffset,tH)}else tV=t11(tU,S.format,tM.buffOffset,t_,tl);th?S.glInternalFmt!==jo.COMPRESSED_RGB_ETC1_WEBGL?X.compressedTexSubImage3D(X.TEXTURE_2D_ARRAY,tO,tc.x,tc.y,tc.z,tk,tG,tl.depth,S.glFormat,tV):X.compressedTexImage3D(X.TEXTURE_2D_ARRAY,tO,S.glInternalFmt,tk,tG,tl.depth,0,tV):X.texSubImage3D(X.TEXTURE_2D_ARRAY,tO,tc.x,tc.y,tc.z,tk,tG,tl.depth,S.glFormat,S.glType,tV)}break;case X.TEXTURE_CUBE_MAP:for(var tz=0;tz<O.length;tz++){var tW=O[tz],tj=tW.texSubres.mipLevel;tc.x=0===tW.texOffset.x?0:M_(tW.texOffset.x,tu.width),tc.y=0===tW.texOffset.y?0:M_(tW.texOffset.y,tu.height),tl.width=tW.texExtent.width<tu.width?tW.texExtent.width:M_(tW.texExtent.width,tu.width),tl.height=tW.texExtent.height<tu.height?tW.texExtent.width:M_(tW.texExtent.height,tu.height),t_.width=tW.buffStride>0?tW.buffStride:tl.width,t_.height=tW.buffTexHeight>0?tW.buffTexHeight:tl.height;var tq=tW.texExtent.width+tc.x===S.width>>tj?tW.texExtent.width:tl.width,tK=tW.texExtent.height+tc.y===S.height>>tj?tW.texExtent.height:tl.height,tZ=tW.texSubres.baseArrayLayer+tW.texSubres.layerCount;for(ti=tW.texSubres.baseArrayLayer;ti<tZ;++ti){var tQ=void 0,t$=v[te++];if(t_.width===tl.width&&t_.height===tl.height){var t0=w_(S.format,tq,tK,1)/ta.BYTES_PER_ELEMENT;$(Number.isInteger(t0),9101),tQ=new ta(t$.buffer,t$.byteOffset+tW.buffOffset,t0)}else tQ=t11(t$,S.format,tW.buffOffset,t_,tl);th?S.glInternalFmt!==jo.COMPRESSED_RGB_ETC1_WEBGL?X.compressedTexSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ti,tj,tc.x,tc.y,tq,tK,S.glFormat,tQ):X.compressedTexImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ti,tj,S.glInternalFmt,tq,tK,0,tQ):X.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ti,tj,tc.x,tc.y,tq,tK,S.glFormat,S.glType,tQ)}}break;default:k("Unsupported GL texture type, copy buffer to texture failed.")}S.flags&oB.GEN_MIPMAP&&X.generateMipmap(S.glTarget)}function i1(g,v,S,O,X){var Y=g.gl,te=g.stateCache,ti=g.blitManager;if(ti){var tr=X===oO.LINEAR||X===oO.ANISOTROPIC?Y.LINEAR:Y.NEAREST,ta=ti.srcFramebuffer,th=ti.dstFramebuffer,tu=te.glReadFramebuffer,tl=te.glFramebuffer,tc=O[0].srcSubres.mipLevel,t_=O[0].dstSubres.mipLevel,_$p=function(g){var v=0,S=Y.COLOR_ATTACHMENT0;return g.hasStencil?S=Y.DEPTH_STENCIL_ATTACHMENT:g.hasDepth&&(S=Y.DEPTH_ATTACHMENT),g.hasDepth||g.hasStencil?(g.hasDepth&&(v|=Y.DEPTH_BUFFER_BIT),g.hasStencil&&(v|=Y.STENCIL_BUFFER_BIT)):v|=Y.COLOR_BUFFER_BIT,{mask:v,attachment:S}},tf=O.map(function(g,v){return v});tf.sort(function(g,v){return O[g].srcSubres.mipLevel-O[v].srcSubres.mipLevel});var tp=_$p(uf[v.format]),tm=tp.mask,tg=tp.attachment,tv=_$p(uf[S.format]).attachment;te.glReadFramebuffer!==ta&&(Y.bindFramebuffer(Y.READ_FRAMEBUFFER,ta),te.glReadFramebuffer=ta),te.glFramebuffer!==th&&(Y.bindFramebuffer(Y.DRAW_FRAMEBUFFER,th),te.glFramebuffer=th),v.glTexture?Y.framebufferTexture2D(Y.READ_FRAMEBUFFER,tg,v.glTarget,v.glTexture,tc):Y.framebufferRenderbuffer(Y.READ_FRAMEBUFFER,tg,Y.RENDERBUFFER,v.glRenderbuffer),S.glTexture?Y.framebufferTexture2D(Y.DRAW_FRAMEBUFFER,tv,S.glTarget,S.glTexture,t_):Y.framebufferRenderbuffer(Y.DRAW_FRAMEBUFFER,tv,Y.RENDERBUFFER,S.glRenderbuffer);for(var ty=0;ty<tf.length;ty++){var tS=O[tf[ty]];v.glTexture&&tc!==tS.srcSubres.mipLevel&&(tc=tS.srcSubres.mipLevel,Y.framebufferTexture2D(Y.READ_FRAMEBUFFER,tg,v.glTarget,v.glTexture,tc)),S.glTexture&&t_!==tS.dstSubres.mipLevel&&(t_=tS.dstSubres.mipLevel,Y.framebufferTexture2D(Y.DRAW_FRAMEBUFFER,tv,S.glTarget,S.glTexture,t_)),Y.blitFramebuffer(tS.srcOffset.x,tS.srcOffset.y,tS.srcOffset.x+tS.srcExtent.width,tS.srcOffset.y+tS.srcExtent.height,tS.dstOffset.x,tS.dstOffset.y,tS.dstOffset.x+tS.dstExtent.width,tS.dstOffset.y+tS.dstExtent.height,tm,tr)}te.glReadFramebuffer!==tu&&(Y.bindFramebuffer(Y.READ_FRAMEBUFFER,tu),te.glReadFramebuffer=tu),te.glFramebuffer!==tl&&(Y.bindFramebuffer(Y.DRAW_FRAMEBUFFER,tl),te.glFramebuffer=tl)}}var jM=function(){function t1(){this.counts=void 0,this.offsets=void 0,this.instances=void 0,this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this.byteOffsets=void 0,this._capacity=4,this.counts=new Int32Array(this._capacity),this.offsets=new Int32Array(this._capacity),this.instances=new Int32Array(this._capacity),this.byteOffsets=new Int32Array(this._capacity)}var g=t1.prototype;return g.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},g.setDrawInfo=function(g,v){this._ensureCapacity(g),this.drawByIndex=v.indexCount>0,this.instancedDraw=!!v.instanceCount,this.drawCount=Math.max(g+1,this.drawCount),this.drawByIndex?(this.counts[g]=v.indexCount,this.offsets[g]=v.firstIndex):(this.counts[g]=v.vertexCount,this.offsets[g]=v.firstVertex),this.instances[g]=Math.max(1,v.instanceCount)},g._ensureCapacity=function(g){if(!(this._capacity>g)){this._capacity=wi(g);var v=new Int32Array(this._capacity),S=new Int32Array(this._capacity),O=new Int32Array(this._capacity);this.byteOffsets=new Int32Array(this._capacity),v.set(this.counts),S.set(this.offsets),O.set(this.instances),this.counts=v,this.offsets=S,this.instances=O}},t1}(),jO=function(){function t1(){this._srcFramebuffer=void 0,this._dstFramebuffer=void 0;var g=jl.instance.gl;this._srcFramebuffer=g.createFramebuffer(),this._dstFramebuffer=g.createFramebuffer()}return t1.prototype.destroy=function(){var g=jl.instance.gl;g.deleteFramebuffer(this._srcFramebuffer),g.deleteFramebuffer(this._dstFramebuffer)},n(t1,[{key:"srcFramebuffer",get:function(){return this._srcFramebuffer}},{key:"dstFramebuffer",get:function(){return this._dstFramebuffer}}]),t1}(),jL=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuBuffer=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){if("buffer"in g){this._isBufferView=!0;var v=g.buffer;this._usage=v.usage,this._memUsage=v.memUsage,this._size=this._stride=g.range,this._count=1,this._flags=v.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:v.gpuBuffer.indirects,glTarget:v.gpuBuffer.glTarget,glBuffer:v.gpuBuffer.glBuffer,glOffset:g.offset}}else this._usage=g.usage,this._memUsage=g.memUsage,this._size=g.size,this._stride=Math.max(g.stride||this._size,1),this._count=this._size/this._stride,this._flags=g.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:new jM,glTarget:0,glBuffer:null,glOffset:0},function(g,v){var S=g.gl,O=g.stateCache,X=v.memUsage&oR.HOST?S.DYNAMIC_DRAW:S.STATIC_DRAW;if(v.usage&oC.VERTEX){v.glTarget=S.ARRAY_BUFFER;var Y=S.createBuffer();Y&&(v.glBuffer=Y,v.size>0&&(g.extensions.useVAO&&O.glVAO&&(S.bindVertexArray(null),O.glVAO=null),jB.gpuInputAssembler=null,g.stateCache.glArrayBuffer!==v.glBuffer&&(S.bindBuffer(S.ARRAY_BUFFER,v.glBuffer),g.stateCache.glArrayBuffer=v.glBuffer),S.bufferData(S.ARRAY_BUFFER,v.size,X),S.bindBuffer(S.ARRAY_BUFFER,null),g.stateCache.glArrayBuffer=null))}else if(v.usage&oC.INDEX){v.glTarget=S.ELEMENT_ARRAY_BUFFER;var te=S.createBuffer();te&&(v.glBuffer=te,v.size>0&&(g.extensions.useVAO&&O.glVAO&&(S.bindVertexArray(null),O.glVAO=null),jB.gpuInputAssembler=null,g.stateCache.glElementArrayBuffer!==v.glBuffer&&(S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,v.glBuffer),g.stateCache.glElementArrayBuffer=v.glBuffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,v.size,X),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,null),g.stateCache.glElementArrayBuffer=null))}else if(v.usage&oC.UNIFORM){v.glTarget=S.UNIFORM_BUFFER;var ti=S.createBuffer();ti&&v.size>0&&(v.glBuffer=ti,g.stateCache.glUniformBuffer!==v.glBuffer&&(S.bindBuffer(S.UNIFORM_BUFFER,v.glBuffer),g.stateCache.glUniformBuffer=v.glBuffer),S.bufferData(S.UNIFORM_BUFFER,v.size,X),S.bindBuffer(S.UNIFORM_BUFFER,null),g.stateCache.glUniformBuffer=null)}else v.usage&oC.INDIRECT||v.usage&oC.TRANSFER_DST||v.usage&oC.TRANSFER_SRC||k("Unsupported BufferType, create buffer failed."),v.glTarget=S.NONE}(jl.instance,this._gpuBuffer),jl.instance.memoryStatus.bufferSize+=this._size},v.destroy=function(){this._gpuBuffer&&(this._isBufferView||(function(g,v){var S=g.gl,O=g.stateCache;if(v.glBuffer){switch(v.glTarget){case S.ARRAY_BUFFER:g.extensions.useVAO&&O.glVAO&&(S.bindVertexArray(null),g.stateCache.glVAO=null),jB.gpuInputAssembler=null,S.bindBuffer(S.ARRAY_BUFFER,null),g.stateCache.glArrayBuffer=null;break;case S.ELEMENT_ARRAY_BUFFER:g.extensions.useVAO&&O.glVAO&&(S.bindVertexArray(null),g.stateCache.glVAO=null),jB.gpuInputAssembler=null,S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,null),g.stateCache.glElementArrayBuffer=null;break;case S.UNIFORM_BUFFER:S.bindBuffer(S.UNIFORM_BUFFER,null),g.stateCache.glUniformBuffer=null}S.deleteBuffer(v.glBuffer),v.glBuffer=null}}(jl.instance,this._gpuBuffer),jl.instance.memoryStatus.bufferSize-=this._size),this._gpuBuffer=null)},v.resize=function(g){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var v=this._size;v!==g&&(this._size=g,this._count=this._size/this._stride,this._gpuBuffer&&(this._gpuBuffer.size=g,g>0&&(function(g,v){var S=g.gl,O=g.stateCache,X=v.memUsage&oR.HOST?S.DYNAMIC_DRAW:S.STATIC_DRAW;v.usage&oC.VERTEX?(g.extensions.useVAO&&O.glVAO&&(S.bindVertexArray(null),O.glVAO=null),jB.gpuInputAssembler=null,O.glArrayBuffer!==v.glBuffer&&S.bindBuffer(S.ARRAY_BUFFER,v.glBuffer),v.buffer?S.bufferData(S.ARRAY_BUFFER,v.buffer,X):S.bufferData(S.ARRAY_BUFFER,v.size,X),S.bindBuffer(S.ARRAY_BUFFER,null),O.glArrayBuffer=null):v.usage&oC.INDEX?(g.extensions.useVAO&&O.glVAO&&(S.bindVertexArray(null),O.glVAO=null),jB.gpuInputAssembler=null,g.stateCache.glElementArrayBuffer!==v.glBuffer&&S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,v.glBuffer),v.buffer?S.bufferData(S.ELEMENT_ARRAY_BUFFER,v.buffer,X):S.bufferData(S.ELEMENT_ARRAY_BUFFER,v.size,X),S.bindBuffer(S.ELEMENT_ARRAY_BUFFER,null),g.stateCache.glElementArrayBuffer=null):v.usage&oC.UNIFORM?(g.stateCache.glUniformBuffer!==v.glBuffer&&S.bindBuffer(S.UNIFORM_BUFFER,v.glBuffer),S.bufferData(S.UNIFORM_BUFFER,v.size,X),S.bindBuffer(S.UNIFORM_BUFFER,null),g.stateCache.glUniformBuffer=null):(v.usage&oC.INDIRECT||v.usage&oC.TRANSFER_DST||v.usage&oC.TRANSFER_SRC||k("Unsupported BufferType, create buffer failed."),v.glTarget=S.NONE)}(jl.instance,this._gpuBuffer),jl.instance.memoryStatus.bufferSize-=v,jl.instance.memoryStatus.bufferSize+=g)))}},v.update=function(g,v){var S;this._isBufferView?console.warn("cannot update through buffer views!"):(S=void 0!==v?v:this._usage&oC.INDIRECT?0:g.byteLength,W0(jl.instance,this._gpuBuffer,g,0,S))},n(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}}]),e}(uA),jF=function(){function t1(g,v){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(v),this._freeCmds=new am(v);for(var S=0;S<v;++S)this._frees[S]=new g;this._freeIdx=v-1}var g=t1.prototype;return g.alloc=function(g){if(this._freeIdx<0){var v=2*this._frees.length,S=this._frees;this._frees=new Array(v);for(var O=v-S.length,X=0;X<O;++X)this._frees[X]=new g;for(var Y=O,te=0;Y<v;++Y,++te)this._frees[Y]=S[te];this._freeIdx+=O}var ti=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++ti.refCount,ti},g.free=function(g){0==--g.refCount&&this._freeCmds.push(g)},g.freeCmds=function(g){for(var v=0;v<g.length;++v)0==--g.array[v].refCount&&this._freeCmds.push(g.array[v])},g.release=function(){for(var g=0;g<this._freeCmds.length;++g){var v=this._freeCmds.array[g];v.clear(),this._frees[++this._freeIdx]=v}this._freeCmds.clear()},t1}(),jN=function(){function t1(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.blitTextureCmdPool=void 0,this.beginRenderPassCmdPool=new jF(jT,1),this.bindStatesCmdPool=new jF(jE,1),this.drawCmdPool=new jF(jC,1),this.updateBufferCmdPool=new jF(jb,1),this.copyBufferToTextureCmdPool=new jF(jR,1),this.blitTextureCmdPool=new jF(jw,1)}var g=t1.prototype;return g.clearCmds=function(g){g.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(g.beginRenderPassCmds),g.beginRenderPassCmds.clear()),g.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(g.bindStatesCmds),g.bindStatesCmds.clear()),g.drawCmds.length&&(this.drawCmdPool.freeCmds(g.drawCmds),g.drawCmds.clear()),g.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(g.updateBufferCmds),g.updateBufferCmds.clear()),g.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(g.copyBufferToTextureCmds),g.copyBufferToTextureCmds.clear()),g.blitTextureCmds.length&&(this.blitTextureCmdPool.freeCmds(g.blitTextureCmds),g.blitTextureCmds.clear()),g.cmds.clear()},g.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release(),this.blitTextureCmdPool.release()},t1}(),jk=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).cmdPackage=new jI,v._cmdAllocator=new jN,v._isInRenderPass=!1,v._curGPUPipelineState=null,v._curGPUDescriptorSets=[],v._curGPUInputAssembler=null,v._curDynamicOffsets=Array(8).fill(0),v._curDynamicStates=new uc,v._isStateInvalied=!1,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._type=g.type,this._queue=g.queue;for(var v=jl.instance.bindingMappings.blockOffsets.length,S=0;S<v;S++)this._curGPUDescriptorSets.push(null)},v.destroy=function(){this._cmdAllocator.clearCmds(this.cmdPackage)},v.begin=function(){this._cmdAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},v.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},v.beginRenderPass=function(g,v,S,O,X,Y){var te=this._cmdAllocator.beginRenderPassCmdPool.alloc(jT);te.gpuRenderPass=g.gpuRenderPass,te.gpuFramebuffer=v.gpuFramebuffer,te.renderArea.copy(S);for(var ti=0;ti<O.length;++ti)te.clearColors[ti]=O[ti];te.clearDepth=X,te.clearStencil=Y,this.cmdPackage.beginRenderPassCmds.push(te),this.cmdPackage.cmds.push(jf.BEGIN_RENDER_PASS),this._isInRenderPass=!0},v.endRenderPass=function(){this._isInRenderPass=!1},v.bindPipelineState=function(g){var v=g.gpuPipelineState;v!==this._curGPUPipelineState&&(this._curGPUPipelineState=v,this._isStateInvalied=!0)},v.bindDescriptorSet=function(g,v,S){var O=v.gpuDescriptorSet;if(O!==this._curGPUDescriptorSets[g]&&(this._curGPUDescriptorSets[g]=O,this._isStateInvalied=!0),S){var X,Y=null===(X=this._curGPUPipelineState)||void 0===X?void 0:X.gpuPipelineLayout;if(Y){for(var te=this._curDynamicOffsets,ti=Y.dynamicOffsetOffsets[g],tr=0;tr<S.length;tr++)te[ti+tr]=S[tr];this._isStateInvalied=!0}}},v.bindInputAssembler=function(g){var v=g.gpuInputAssembler;this._curGPUInputAssembler=v,this._isStateInvalied=!0},v.setViewport=function(g){var v=this._curDynamicStates.viewport;v.left===g.left&&v.top===g.top&&v.width===g.width&&v.height===g.height&&v.minDepth===g.minDepth&&v.maxDepth===g.maxDepth||(v.left=g.left,v.top=g.top,v.width=g.width,v.height=g.height,v.minDepth=g.minDepth,v.maxDepth=g.maxDepth,this._isStateInvalied=!0)},v.setScissor=function(g){var v=this._curDynamicStates.scissor;v.x===g.x&&v.y===g.y&&v.width===g.width&&v.height===g.height||(v.x=g.x,v.y=g.y,v.width=g.width,v.height=g.height,this._isStateInvalied=!0)},v.setLineWidth=function(g){this._curDynamicStates.lineWidth!==g&&(this._curDynamicStates.lineWidth=g,this._isStateInvalied=!0)},v.setDepthBias=function(g,v,S){var O=this._curDynamicStates;O.depthBiasConstant===g&&O.depthBiasClamp===v&&O.depthBiasSlope===S||(O.depthBiasConstant=g,O.depthBiasClamp=v,O.depthBiasSlope=S,this._isStateInvalied=!0)},v.setBlendConstants=function(g){var v=this._curDynamicStates.blendConstant;v.x===g.x&&v.y===g.y&&v.z===g.z&&v.w===g.w||(v.copy(g),this._isStateInvalied=!0)},v.setDepthBound=function(g,v){var S=this._curDynamicStates;S.depthMinBounds===g&&S.depthMaxBounds===v||(S.depthMinBounds=g,S.depthMaxBounds=v,this._isStateInvalied=!0)},v.setStencilWriteMask=function(g,v){var S=this._curDynamicStates.stencilStatesFront,O=this._curDynamicStates.stencilStatesBack;g&o1.FRONT&&S.writeMask!==v&&(S.writeMask=v,this._isStateInvalied=!0),g&o1.BACK&&O.writeMask!==v&&(O.writeMask=v,this._isStateInvalied=!0)},v.setStencilCompareMask=function(g,v,S){var O=this._curDynamicStates.stencilStatesFront,X=this._curDynamicStates.stencilStatesBack;g&o1.FRONT&&(O.compareMask===S&&O.reference===v||(O.reference=v,O.compareMask=S,this._isStateInvalied=!0)),g&o1.BACK&&(X.compareMask===S&&X.reference===v||(X.reference=v,X.compareMask=S,this._isStateInvalied=!0))},v.draw=function(g){if(this._type===o6.PRIMARY&&this._isInRenderPass||this._type===o6.SECONDARY){this._isStateInvalied&&this.bindStates();var v="drawInfo"in g?g.drawInfo:g,S=this._cmdAllocator.drawCmdPool.alloc(jC);S.drawInfo.copy(v),this.cmdPackage.drawCmds.push(S),this.cmdPackage.cmds.push(jf.DRAW),++this._numDrawCalls,this._numInstances+=v.instanceCount;var O=v.indexCount||v.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=O/3*Math.max(v.instanceCount,1);break;case 5:case 6:this._numTris+=(O-2)*Math.max(v.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},v.updateBuffer=function(g,v,S){if((this._type!==o6.PRIMARY||this._isInRenderPass)&&this._type!==o6.SECONDARY)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var O=g.gpuBuffer;if(O){var X,Y=this._cmdAllocator.updateBufferCmdPool.alloc(jb),te=0;g.usage&oC.INDIRECT||(te=void 0!==S?S:v.byteLength),X=v,Y.gpuBuffer=O,Y.buffer=X,Y.offset=0,Y.size=te,this.cmdPackage.updateBufferCmds.push(Y),this.cmdPackage.cmds.push(jf.UPDATE_BUFFER)}}},v.copyBuffersToTexture=function(g,v,S){if((this._type!==o6.PRIMARY||this._isInRenderPass)&&this._type!==o6.SECONDARY)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var O=v.gpuTexture;if(O){var X=this._cmdAllocator.copyBufferToTextureCmdPool.alloc(jR);X.gpuTexture=O,X.regions=S,X.buffers=g,this.cmdPackage.copyBufferToTextureCmds.push(X),this.cmdPackage.cmds.push(jf.COPY_BUFFER_TO_TEXTURE)}}},v.execute=function(g,v){for(var S=0;S<v;++S){for(var O=g[S],X=0;X<O.cmdPackage.beginRenderPassCmds.length;++X){var Y=O.cmdPackage.beginRenderPassCmds.array[X];++Y.refCount,this.cmdPackage.beginRenderPassCmds.push(Y)}for(var te=0;te<O.cmdPackage.bindStatesCmds.length;++te){var ti=O.cmdPackage.bindStatesCmds.array[te];++ti.refCount,this.cmdPackage.bindStatesCmds.push(ti)}for(var tr=0;tr<O.cmdPackage.drawCmds.length;++tr){var ta=O.cmdPackage.drawCmds.array[tr];++ta.refCount,this.cmdPackage.drawCmds.push(ta)}for(var th=0;th<O.cmdPackage.updateBufferCmds.length;++th){var tu=O.cmdPackage.updateBufferCmds.array[th];++tu.refCount,this.cmdPackage.updateBufferCmds.push(tu)}for(var tl=0;tl<O.cmdPackage.copyBufferToTextureCmds.length;++tl){var tc=O.cmdPackage.copyBufferToTextureCmds.array[tl];++tc.refCount,this.cmdPackage.copyBufferToTextureCmds.push(tc)}for(var t_=0;t_<O.cmdPackage.blitTextureCmds.length;++t_){var tf=O.cmdPackage.blitTextureCmds.array[t_];++tf.refCount,this.cmdPackage.blitTextureCmds.push(tf)}this.cmdPackage.cmds.concat(O.cmdPackage.cmds.array),this._numDrawCalls+=O._numDrawCalls,this._numInstances+=O._numInstances,this._numTris+=O._numTris}},v.pipelineBarrier=function(){},v.bindStates=function(){var g=this._cmdAllocator.bindStatesCmdPool.alloc(jE);g.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(g.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(g.dynamicOffsets,this._curDynamicOffsets),g.gpuInputAssembler=this._curGPUInputAssembler,g.dynamicStates=this._curDynamicStates,this.cmdPackage.bindStatesCmds.push(g),this.cmdPackage.cmds.push(jf.BIND_STATES),this._isStateInvalied=!1},v.blitTexture=function(g,v,S,O){var X=this._cmdAllocator.blitTextureCmdPool.alloc(jw);X.srcTexture=g.gpuTexture,X.dstTexture=v.gpuTexture,X.regions=S,X.filter=O,++this._numDrawCalls,this.cmdPackage.blitTextureCmds.push(X),this.cmdPackage.cmds.push(jf.BLIT_TEXTURE)},e}(uT),jG=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuFramebuffer=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._renderPass=g.renderPass,this._colorTextures=g.colorTextures||[],this._depthStencilTexture=g.depthStencilTexture||null;for(var v=[],S=0;S<g.colorTextures.length;S++){var O=g.colorTextures[S];O&&v.push(O.gpuTextureView)}var X=null;g.depthStencilTexture&&(X=g.depthStencilTexture.gpuTextureView);var Y=Number.MAX_SAFE_INTEGER,te=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:g.renderPass.gpuRenderPass,gpuColorViews:v,gpuDepthStencilView:X,glFramebuffer:null,isOffscreen:!0,get width(){return this.gpuColorViews.length>0?this.gpuColorViews[0].gpuTexture.width:this.gpuDepthStencilView?this.gpuDepthStencilView.gpuTexture.width:Y},set width(t){Y=t},get height(){return this.gpuColorViews.length>0?this.gpuColorViews[0].gpuTexture.height:this.gpuDepthStencilView?this.gpuDepthStencilView.gpuTexture.height:te},set height(t){te=t}},function(g,v){for(var S=0;S<v.gpuColorViews.length;++S)if(v.gpuColorViews[S].gpuTexture.isSwapchainTexture)return void(v.isOffscreen=!1);var O=g.gl,X=[],Y=O.createFramebuffer();if(Y){v.glFramebuffer=Y,g.stateCache.glFramebuffer!==v.glFramebuffer&&O.bindFramebuffer(O.FRAMEBUFFER,v.glFramebuffer);for(var te=0;te<v.gpuColorViews.length;++te){var ti=v.gpuColorViews[te],tr=ti.gpuTexture;tr&&(tr.glTexture?O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0+te,tr.glTarget,tr.glTexture,ti.baseLevel):O.framebufferRenderbuffer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0+te,O.RENDERBUFFER,tr.glRenderbuffer),X.push(O.COLOR_ATTACHMENT0+te),v.width=Math.min(v.width,tr.width>>ti.baseLevel),v.height=Math.min(v.height,tr.height>>ti.baseLevel))}var ta=v.gpuDepthStencilView;if(ta){var th=ta.gpuTexture,tu=uf[th.format].hasStencil?O.DEPTH_STENCIL_ATTACHMENT:O.DEPTH_ATTACHMENT;th.glTexture?O.framebufferTexture2D(O.FRAMEBUFFER,tu,th.glTarget,th.glTexture,v.gpuDepthStencilView.baseLevel):O.framebufferRenderbuffer(O.FRAMEBUFFER,tu,O.RENDERBUFFER,th.glRenderbuffer),v.width=Math.min(v.width,th.width>>ta.baseLevel),v.height=Math.min(v.height,th.height>>ta.baseLevel)}O.drawBuffers(X);var tl=O.checkFramebufferStatus(O.FRAMEBUFFER);if(tl!==O.FRAMEBUFFER_COMPLETE)switch(tl){case O.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:k("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case O.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:k("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case O.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:k("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case O.FRAMEBUFFER_UNSUPPORTED:k("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}g.stateCache.glFramebuffer!==v.glFramebuffer&&O.bindFramebuffer(O.FRAMEBUFFER,g.stateCache.glFramebuffer)}}(jl.instance,this._gpuFramebuffer),this._width=this._gpuFramebuffer.width,this._height=this._gpuFramebuffer.height},v.destroy=function(){var g,v;this._gpuFramebuffer&&(g=jl.instance,(v=this._gpuFramebuffer).glFramebuffer&&(g.gl.deleteFramebuffer(v.glFramebuffer),g.stateCache.glFramebuffer===v.glFramebuffer&&(g.gl.bindFramebuffer(g.gl.FRAMEBUFFER,null),g.stateCache.glFramebuffer=null),v.glFramebuffer=null),this._gpuFramebuffer=null)},n(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(uI),jV=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuInputAssembler=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){if(0!==g.vertexBuffers.length){if(this._attributes=g.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=g.vertexBuffers,g.indexBuffer)this._indexBuffer=g.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var v=this._vertexBuffers[0];this._drawInfo.vertexCount=v.size/v.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=g.indirectBuffer||null;for(var S=new Array(g.vertexBuffers.length),O=0;O<g.vertexBuffers.length;++O){var X=g.vertexBuffers[O];X.gpuBuffer&&(S[O]=X.gpuBuffer)}var Y=null,te=0;if(g.indexBuffer&&(Y=g.indexBuffer.gpuBuffer))switch(Y.stride){case 1:te=5121;break;case 2:te=5123;break;case 4:te=5125;break;default:console.error("Illegal index buffer stride.")}var ti=null;g.indirectBuffer&&(ti=g.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:g.attributes,gpuVertexBuffers:S,gpuIndexBuffer:Y,gpuIndirectBuffer:ti,glAttribs:[],glIndexType:te,glVAOs:new Map},function(g,v){var S=g.gl;v.glAttribs=new Array(v.attributes.length);for(var O=[0,0,0,0,0,0,0,0],X=0;X<v.attributes.length;++X){var Y=v.attributes[X],te=void 0!==Y.stream?Y.stream:0,ti=v.gpuVertexBuffers[te],tr=x0(Y.format,S),ta=uf[Y.format].size;v.glAttribs[X]={name:Y.name,glBuffer:ti.glBuffer,glType:tr,size:ta,count:uf[Y.format].count,stride:ti.stride,componentCount:B0(tr,S),isNormalized:void 0!==Y.isNormalized&&Y.isNormalized,isInstanced:void 0!==Y.isInstanced&&Y.isInstanced,offset:O[te]},O[te]+=ta}}(jl.instance,this._gpuInputAssembler)}else console.error("InputAssemblerInfo.vertexBuffers is null.")},v.destroy=function(){var g=jl.instance;this._gpuInputAssembler&&g.extensions.useVAO&&function(g,v){for(var S=v.glVAOs.values(),O=S.next(),X=g.gl,Y=g.stateCache.glVAO;!O.done;)X.deleteVertexArray(O.value),Y===O.value&&(X.bindVertexArray(null),Y=null),O=S.next();g.stateCache.glVAO=Y,v.glVAOs.clear()}(g,this._gpuInputAssembler),this._gpuInputAssembler=null},n(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(uB),jU=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuDescriptorSetLayout=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){Array.prototype.push.apply(this._bindings,g.bindings);for(var v=0,S=-1,O=[],X=0;X<this._bindings.length;X++){var Y=this._bindings[X];O.push(v),v+=Y.count,Y.binding>S&&(S=Y.binding)}this._bindingIndices=Array(S+1).fill(-1);for(var te=this._descriptorIndices=Array(S+1).fill(-1),ti=0;ti<this._bindings.length;ti++){var tr=this._bindings[ti];this._bindingIndices[tr.binding]=ti,te[tr.binding]=O[ti]}for(var ta=[],th=0;th<this._bindings.length;th++){var tu=this._bindings[th];if(tu.descriptorType&ug)for(var tl=0;tl<tu.count;tl++)ta.push(tu.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:ta,descriptorIndices:te,descriptorCount:v}},v.destroy=function(){this._bindings.length=0},n(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(uD),jH=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuPipelineLayout=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){Array.prototype.push.apply(this._setLayouts,g.setLayouts);for(var v=[],S=[],O=0,X=[],Y=0;Y<this._setLayouts.length;Y++){for(var te=this._setLayouts[Y],ti=te.gpuDescriptorSetLayout.dynamicBindings,tr=Array(te.bindingIndices.length).fill(-1),ta=0;ta<ti.length;ta++){var th=ti[ta];tr[th]<0&&(tr[th]=O+ta)}S.push(te.gpuDescriptorSetLayout),v.push(tr),X.push(O),O+=ti.length}this._gpuPipelineLayout={gpuSetLayouts:S,dynamicOffsetIndices:v,dynamicOffsetCount:O,dynamicOffsetOffsets:X}},v.destroy=function(){this._setLayouts.length=0},n(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(uM),jz=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],jX=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuPipelineState=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._primitive=g.primitive,this._shader=g.shader,this._pipelineLayout=g.pipelineLayout;var v=this._bs;if(g.blendState){var S=g.blendState,O=S.targets;O&&O.forEach(function(g,S){v.setTarget(S,g)}),void 0!==S.isA2C&&(v.isA2C=S.isA2C),void 0!==S.isIndepend&&(v.isIndepend=S.isIndepend),void 0!==S.blendColor&&(v.blendColor=S.blendColor)}Object.assign(this._rs,g.rasterizerState),Object.assign(this._dss,g.depthStencilState),this._is=g.inputState,this._renderPass=g.renderPass,this._dynamicStates=g.dynamicStates;for(var X=[],Y=0;Y<31;Y++)this._dynamicStates&1<<Y&&X.push(1<<Y);this._gpuPipelineState={glPrimitive:jz[g.primitive],gpuShader:g.shader.gpuShader,gpuPipelineLayout:g.pipelineLayout.gpuPipelineLayout,rs:g.rasterizerState,dss:g.depthStencilState,bs:g.blendState,gpuRenderPass:g.renderPass.gpuRenderPass,dynamicStates:X}},v.destroy=function(){this._gpuPipelineState=null},n(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(uG),jj=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.beginRenderPass=function(g,v,S,O,X,Y){q0(jl.instance,g.gpuRenderPass,v.gpuFramebuffer,S,O,X,Y),this._isInRenderPass=!0},v.draw=function(g){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates();var v="drawInfo"in g?g.drawInfo:g;J0(jl.instance,v),++this._numDrawCalls,this._numInstances+=v.instanceCount;var S=v.indexCount||v.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=S/3*Math.max(v.instanceCount,1);break;case 5:case 6:this._numTris+=(S-2)*Math.max(v.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},v.setViewport=function(g){var v=jl.instance,S=v.stateCache,O=v.gl;S.viewport.left===g.left&&S.viewport.top===g.top&&S.viewport.width===g.width&&S.viewport.height===g.height||(O.viewport(g.left,g.top,g.width,g.height),S.viewport.left=g.left,S.viewport.top=g.top,S.viewport.width=g.width,S.viewport.height=g.height)},v.setScissor=function(g){var v=jl.instance,S=v.stateCache,O=v.gl;S.scissorRect.x===g.x&&S.scissorRect.y===g.y&&S.scissorRect.width===g.width&&S.scissorRect.height===g.height||(O.scissor(g.x,g.y,g.width,g.height),S.scissorRect.x=g.x,S.scissorRect.y=g.y,S.scissorRect.width=g.width,S.scissorRect.height=g.height)},v.updateBuffer=function(g,v,S){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var O,X=g.gpuBuffer;X&&(O=void 0!==S?S:g.usage&oC.INDIRECT?0:v.byteLength,W0(jl.instance,X,v,0,O))}},v.copyBuffersToTexture=function(g,v,S){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var O=v.gpuTexture;O&&e1(jl.instance,g,O,S)}},v.execute=function(g,v){for(var S=0;S<v;++S){var O=g[S];Z0(jl.instance,O.cmdPackage),this._numDrawCalls+=O._numDrawCalls,this._numInstances+=O._numInstances,this._numTris+=O._numTris}},v.bindStates=function(){K0(jl.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},v.blitTexture=function(g,v,S,O){var X=g.gpuTexture,Y=v.gpuTexture;i1(jl.instance,X,Y,S,O)},e}(jk),jq=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).numDrawCalls=0,v.numInstances=0,v.numTris=0,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._type=g.type},v.destroy=function(){},v.submit=function(g){for(var v=0;v<g.length;v++){var S=g[v];this.numDrawCalls+=S.numDrawCalls,this.numInstances+=S.numInstances,this.numTris+=S.numTris}},v.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(uV),jY=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuRenderPass=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._colorInfos=g.colorAttachments,this._depthStencilInfo=g.depthStencilAttachment,this._subpasses=g.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},v.destroy=function(){this._gpuRenderPass=null},n(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(uU),jK=function(g){function e(v,S){var O,X,Y,te;return(O=g.call(this,v,S)||this)._gpuSampler=null,O._gpuSampler={glSamplers:new Map,minFilter:O._info.minFilter,magFilter:O._info.magFilter,mipFilter:O._info.mipFilter,addressU:O._info.addressU,addressV:O._info.addressV,addressW:O._info.addressW,glMinFilter:0,glMagFilter:0,glWrapS:0,glWrapT:0,glWrapR:0,getGLSampler:function(g,v,S){var O=g.gl,X=v<<16|S;if(!this.glSamplers.has(X)){var Y=O.createSampler();Y&&(this.glSamplers.set(X,Y),O.samplerParameteri(Y,O.TEXTURE_MIN_FILTER,this.glMinFilter),O.samplerParameteri(Y,O.TEXTURE_MAG_FILTER,this.glMagFilter),O.samplerParameteri(Y,O.TEXTURE_WRAP_S,this.glWrapS),O.samplerParameteri(Y,O.TEXTURE_WRAP_T,this.glWrapT),O.samplerParameteri(Y,O.TEXTURE_WRAP_R,this.glWrapR),O.samplerParameterf(Y,O.TEXTURE_MIN_LOD,v),O.samplerParameterf(Y,O.TEXTURE_MAX_LOD,S))}return this.glSamplers.get(X)}},X=jl.instance,Y=O._gpuSampler,te=X.gl,Y.minFilter===oO.LINEAR||Y.minFilter===oO.ANISOTROPIC?Y.mipFilter===oO.LINEAR||Y.mipFilter===oO.ANISOTROPIC?Y.glMinFilter=te.LINEAR_MIPMAP_LINEAR:Y.mipFilter===oO.POINT?Y.glMinFilter=te.LINEAR_MIPMAP_NEAREST:Y.glMinFilter=te.LINEAR:Y.mipFilter===oO.LINEAR||Y.mipFilter===oO.ANISOTROPIC?Y.glMinFilter=te.NEAREST_MIPMAP_LINEAR:Y.mipFilter===oO.POINT?Y.glMinFilter=te.NEAREST_MIPMAP_NEAREST:Y.glMinFilter=te.NEAREST,Y.magFilter===oO.LINEAR||Y.magFilter===oO.ANISOTROPIC?Y.glMagFilter=te.LINEAR:Y.glMagFilter=te.NEAREST,Y.glWrapS=jc[Y.addressU],Y.glWrapT=jc[Y.addressV],Y.glWrapR=jc[Y.addressW],O}return s(e,g),e.prototype.destroy=function(){this._gpuSampler&&(function(g,v){for(var S=g.gl,O=v.glSamplers.values().next();!O.done;){S.deleteSampler(O.value);for(var X=g.stateCache.glSamplerUnits,Y=0;Y<X.length;++Y)X[Y]===O.value&&(S.bindSampler(Y,null),X[Y]=null)}v.glSamplers.clear()}(jl.instance,this._gpuSampler),this._gpuSampler=null)},n(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(uH),jJ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuShader=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._name=g.name,this._stages=g.stages,this._attributes=g.attributes,this._blocks=g.blocks,this._samplers=g.samplers,this._gpuShader={name:g.name,blocks:g.blocks.slice(),samplerTextures:g.samplerTextures.slice(),subpassInputs:g.subpassInputs.slice(),gpuStages:new Array(g.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var v=0;v<g.stages.length;++v){var S=g.stages[v];this._gpuShader.gpuStages[v]={type:S.stage,source:S.source,glShader:null}}},v.destroy=function(){var g,v;this._gpuShader&&(g=jl.instance,(v=this._gpuShader).glProgram&&(g.gl.deleteProgram(v.glProgram),g.stateCache.glProgram===v.glProgram&&(g.gl.useProgram(null),g.stateCache.glProgram=null),v.glProgram=null),this._gpuShader=null)},n(e,[{key:"gpuShader",get:function(){return null===this._gpuShader.glProgram&&function(g,v){for(var S,O=g.gl,_$r=function(){var g=v.gpuStages[Y],S=0,X="",te=1;switch(g.type){case oU.VERTEX:X="VertexShader",S=O.VERTEX_SHADER;break;case oU.FRAGMENT:X="FragmentShader",S=O.FRAGMENT_SHADER;break;default:return k("Unsupported ShaderType."),{v:void 0}}var ti=O.createShader(S);if(ti&&(g.glShader=ti,O.shaderSource(g.glShader,"#version 300 es\n"+g.source),O.compileShader(g.glShader),!O.getShaderParameter(g.glShader,O.COMPILE_STATUS))){k(X+" in '"+v.name+"' compilation failed."),k("Shader source dump:",g.source.replace(/^|\n/g,function(){return"\n"+te+++" "})),k(O.getShaderInfoLog(g.glShader));for(var tr=0;tr<v.gpuStages.length;tr++){var ta=v.gpuStages[Y];ta.glShader&&(O.deleteShader(ta.glShader),ta.glShader=null)}return{v:void 0}}},Y=0;Y<v.gpuStages.length;Y++)if(S=_$r())return S.v;var te=O.createProgram();if(te){v.glProgram=te;for(var ti=!(!X.rendering||!X.rendering.enableEffectImport),tr=0;tr<v.gpuStages.length;tr++){var ta=v.gpuStages[tr];O.attachShader(v.glProgram,ta.glShader)}O.linkProgram(v.glProgram);for(var th=0;th<v.gpuStages.length;th++){var tu=v.gpuStages[th];tu.glShader&&(O.detachShader(v.glProgram,tu.glShader),O.deleteShader(tu.glShader),tu.glShader=null)}if(!O.getProgramParameter(v.glProgram,O.LINK_STATUS))return k("Failed to link shader '"+v.name+"'."),void k(O.getProgramInfoLog(v.glProgram));U("Shader '"+v.name+"' compilation succeeded.");var tl=O.getProgramParameter(v.glProgram,O.ACTIVE_ATTRIBUTES);v.glInputs=new Array(tl);for(var tc=0;tc<tl;++tc){var t_=O.getActiveAttrib(v.glProgram,tc);if(t_){var tf,tp=t_.name.indexOf("[");tf=-1!==tp?t_.name.substr(0,tp):t_.name;var tm=O.getAttribLocation(v.glProgram,tf),tg=w0(t_.type,O),tv=I0(t_.type,O);v.glInputs[tc]={name:tf,type:tg,stride:tv,count:t_.size,size:tv*t_.size,glType:t_.type,glLoc:tm}}}var ty,tS,tA,tT,tE=O.getProgramParameter(v.glProgram,O.ACTIVE_UNIFORM_BLOCKS);if(tE){v.glBlocks=new Array(tE);for(var tC=0;tC<tE;++tC){var tx=(ty=O.getActiveUniformBlockName(v.glProgram,tC)).indexOf("[");-1!==tx&&(ty=ty.substr(0,tx)),tT=null;for(var tb=0;tb<v.blocks.length;tb++)if(v.blocks[tb].name===ty){tT=v.blocks[tb];break}if(tT){tS=tC,tA=O.getActiveUniformBlockParameter(v.glProgram,tS,O.UNIFORM_BLOCK_DATA_SIZE);var tw=ti?tT.flattened:tT.binding+(g.bindingMappings.blockOffsets[tT.set]||0);O.uniformBlockBinding(v.glProgram,tS,tw),v.glBlocks[tC]={set:tT.set,binding:tT.binding,idx:tS,name:ty,size:tA,glBinding:tw}}else k("Block '"+ty+"' does not bound")}}for(var tI=0;tI<v.subpassInputs.length;++tI){var tB=v.subpassInputs[tI];v.samplerTextures.push(new hF(tB.set,tB.binding,tB.name,oE.SAMPLER2D,tB.count))}if(v.samplerTextures.length>0){v.glSamplerTextures=new Array(v.samplerTextures.length);for(var tP=0;tP<v.samplerTextures.length;++tP){var tD=v.samplerTextures[tP];v.glSamplerTextures[tP]={set:tD.set,binding:tD.binding,name:tD.name,type:tD.type,count:tD.count,units:[],glUnits:null,glType:R0(tD.type,O),glLoc:null}}}var tM=[],tO=[],tk=g.stateCache.texUnitCacheMap;if(ti)for(var tG=0;tG<v.samplerTextures.length;++tG){var tV=v.samplerTextures[tG],tU=O.getUniformLocation(v.glProgram,tV.name);tU&&-1!==tU.id&&(tM.push(v.glSamplerTextures[tG]),tO.push(tU)),void 0===tk[tV.name]&&(tk[tV.name]=tV.flattened%g.capabilities.maxTextureUnits)}else{for(var tH=0,tz=0;tz<v.blocks.length;++tz)v.blocks[tz].set===g.bindingMappings.flexibleSet&&tH++;for(var tW=0,tj=0;tj<v.samplerTextures.length;++tj){var tq=v.samplerTextures[tj],tK=O.getUniformLocation(v.glProgram,tq.name);if(tK&&-1!==tK.id&&(tM.push(v.glSamplerTextures[tj]),tO.push(tK)),void 0===tk[tq.name]){var tZ=tq.binding+g.bindingMappings.samplerTextureOffsets[tq.set]+tW;tq.set===g.bindingMappings.flexibleSet&&(tZ-=tH),tk[tq.name]=tZ%g.capabilities.maxTextureUnits,tW+=tq.count-1}}}if(tM.length){for(var tQ=[],t$=0;t$<tM.length;++t$){var t0=tM[t$],t2=tk[t0.name];if(void 0!==t2){t0.glLoc=tO[t$];for(var t3=0;t3<t0.count;++t3){for(;tQ[t2];)t2=(t2+1)%g.capabilities.maxTextureUnits;t0.units.push(t2),tQ[t2]=!0}}}for(var t4=0,t8=0;t8<tM.length;++t8){var t6=tM[t8];if(!t6.glLoc){for(t6.glLoc=tO[t8];tQ[t4];)t4++;for(var t7=0;t7<t6.count;++t7){for(;tQ[t4];)t4=(t4+1)%g.capabilities.maxTextureUnits;void 0===tk[t6.name]&&(tk[t6.name]=t4),t6.units.push(t4),tQ[t4]=!0}}}g.stateCache.glProgram!==v.glProgram&&O.useProgram(v.glProgram);for(var t9=0;t9<tM.length;t9++){var ee=tM[t9];ee.glUnits=new Int32Array(ee.units),O.uniform1iv(ee.glLoc,ee.glUnits)}g.stateCache.glProgram!==v.glProgram&&O.useProgram(g.stateCache.glProgram)}v.glSamplerTextures=tM}}(jl.instance,this._gpuShader),this._gpuShader}}]),e}(uz),jZ=function(){function t1(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glUniformBuffer=null,this.glBindUBOs=[],this.glBindUBOOffsets=[],this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glSamplerUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.glReadFramebuffer=null,this.viewport=new hS,this.scissorRect=new hl(0,0,0,0),this.rs=new uO,this.dss=new uL,this.bs=new uk,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t1.prototype.initialize=function(g,v,S){for(var O=0;O<g;++O)this.glTexUnits.push({glTexture:null});this.glSamplerUnits.length=g,this.glSamplerUnits.fill(null),this.glBindUBOs.length=v,this.glBindUBOs.fill(null),this.glBindUBOOffsets.length=v,this.glBindUBOOffsets.fill(0),this.glEnabledAttribLocs.length=S,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=S,this.glCurrentAttribLocs.fill(!1)},t1}(),jQ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._gpuTexture=null,v._gpuTextureView=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g,v){var S=g,O=g;if("texture"in g&&(S=O.texture.info,this._isTextureView=!0),this._info.copy(S),this._isPowerOf2=R_(this._info.width)&&R_(this._info.height),this._size=I_(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,this._isTextureView){var X;if(this._viewInfo.copy(O),this._gpuTexture=O.texture._gpuTexture,(null===(X=this._gpuTexture)||void 0===X?void 0:X.format)!==S.format)return void console.log("GPU memory alias is not supported");this._gpuTextureView={gpuTexture:this._gpuTexture,type:O.type,format:O.format,baseLevel:O.baseLevel,levelCount:O.levelCount}}else this._gpuTexture={type:S.type,format:S.format,usage:S.usage,width:S.width,height:S.height,depth:S.depth,size:this._size,arrayLayer:S.layerCount,mipLevel:S.levelCount,samples:S.samples,flags:S.flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:v||!1},!this._gpuTexture.isSwapchainTexture&&this._gpuTexture&&(X0(jl.instance,this._gpuTexture),jl.instance.memoryStatus.textureSize+=this._size),this._viewInfo.texture=this,this._viewInfo.type=g.type,this._viewInfo.format=g.format,this._viewInfo.baseLevel=0,this._viewInfo.levelCount=g.levelCount,this._viewInfo.baseLayer=0,this._viewInfo.layerCount=g.layerCount,this._gpuTextureView={gpuTexture:this._gpuTexture,type:this._viewInfo.type,format:this._viewInfo.format,baseLevel:this._viewInfo.baseLevel,levelCount:this._viewInfo.levelCount}},v.destroy=function(){!this._isTextureView&&this._gpuTexture&&(j0(jl.instance,this._gpuTexture),jl.instance.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},v.getGLTextureHandle=function(){var g=this._gpuTexture;return g?g.glTexture?g.glTexture:g.glRenderbuffer?g.glRenderbuffer:0:0},v.resize=function(g,v){if(this._info.width!==g||this._info.height!==v){this._info.levelCount===e.getLevelCount(this._info.width,this._info.height)?this._info.levelCount=e.getLevelCount(g,v):this._info.levelCount>1&&(this._info.levelCount=Math.min(this._info.levelCount,e.getLevelCount(g,v)));var S=this._size;this._info.width=g,this._info.height=v,this._size=I_(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,!this._isTextureView&&this._gpuTexture&&(this._gpuTexture.width=g,this._gpuTexture.height=v,this._gpuTexture.size=this._size,this._gpuTexture.isSwapchainTexture||(function(g,v){if(v.size){var S=g.gl,O=v.width,X=v.height,Y=v.depth,te=v.arrayLayer;switch(v.type){case ow.TEX2D:v.glTarget=S.TEXTURE_2D;var ti=Math.max(O,X);if(ti>g.capabilities.maxTextureSize&&J(9100,ti,g.capabilities.maxTextureSize),v.samples===oD.X1){var tr=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tr.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_2D,v.glTexture),tr.glTexture=v.glTexture),uf[v.format].isCompressed)for(var ta=0;ta<v.mipLevel;++ta){var th=w_(v.format,O,X,1),tu=new Uint8Array(th);S.compressedTexImage2D(S.TEXTURE_2D,ta,v.glInternalFmt,O,X,0,tu),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else j0(g,v),X0(g,v)}else v.glRenderbuffer&&(g.stateCache.glRenderbuffer!==v.glRenderbuffer&&(S.bindRenderbuffer(S.RENDERBUFFER,v.glRenderbuffer),g.stateCache.glRenderbuffer=v.glRenderbuffer),S.renderbufferStorageMultisample(S.RENDERBUFFER,v.samples,v.glInternalFmt,v.width,v.height));break;case ow.TEX2D_ARRAY:v.glTarget=S.TEXTURE_2D_ARRAY;var tl=Math.max(O,X);if(tl>g.capabilities.maxTextureSize&&J(9100,tl,g.capabilities.maxTextureSize),te>g.capabilities.maxArrayTextureLayers&&J(9100,te,g.capabilities.maxArrayTextureLayers),v.glTexture=S.createTexture(),v.size>0){var tc=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tc.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_2D_ARRAY,v.glTexture),tc.glTexture=v.glTexture),uf[v.format].isCompressed)for(var t_=0;t_<v.mipLevel;++t_){var tf=w_(v.format,O,X,te),tp=new Uint8Array(tf);S.compressedTexImage3D(S.TEXTURE_2D_ARRAY,t_,v.glInternalFmt,O,X,te,0,tp),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else S.texStorage3D(S.TEXTURE_2D_ARRAY,v.mipLevel,v.glInternalFmt,O,X,te)}break;case ow.TEX3D:v.glTarget=S.TEXTURE_3D;var tm=Math.max(Math.max(O,X),Y);if(tm>g.capabilities.max3DTextureSize&&J(9100,tm,g.capabilities.max3DTextureSize),v.glTexture=S.createTexture(),v.size>0){var tg=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tg.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_3D,v.glTexture),tg.glTexture=v.glTexture),uf[v.format].isCompressed)for(var tv=0;tv<v.mipLevel;++tv){var ty=w_(v.format,O,X,Y),tS=new Uint8Array(ty);S.compressedTexImage3D(S.TEXTURE_3D,tv,v.glInternalFmt,O,X,Y,0,tS),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}else S.texStorage3D(S.TEXTURE_3D,v.mipLevel,v.glInternalFmt,O,X,Y)}break;case ow.CUBE:v.type=ow.CUBE,v.glTarget=S.TEXTURE_CUBE_MAP;var tA=Math.max(O,X);tA>g.capabilities.maxCubeMapTextureSize&&J(9100,tA,g.capabilities.maxTextureSize);var tT=g.stateCache.glTexUnits[g.stateCache.texUnit];if(tT.glTexture!==v.glTexture&&(S.bindTexture(S.TEXTURE_CUBE_MAP,v.glTexture),tT.glTexture=v.glTexture),uf[v.format].isCompressed)for(var tE=0;tE<6;++tE){O=v.width,X=v.height;for(var tC=0;tC<v.mipLevel;++tC){var tx=w_(v.format,O,X,1),tb=new Uint8Array(tx);S.compressedTexImage2D(S.TEXTURE_CUBE_MAP_POSITIVE_X+tE,tC,v.glInternalFmt,O,X,0,tb),O=Math.max(1,O>>1),X=Math.max(1,X>>1)}}else j0(g,v),X0(g,v);break;default:k("Unsupported TextureType, create texture failed."),v.type=ow.TEX2D,v.glTarget=S.TEXTURE_2D}}}(jl.instance,this._gpuTexture),jl.instance.memoryStatus.textureSize-=S,jl.instance.memoryStatus.textureSize+=this._size))}},v.initAsSwapchainTexture=function(g){var v=new hB;v.format=g.format,v.usage=uf[g.format].hasDepth?oI.DEPTH_STENCIL_ATTACHMENT:oI.COLOR_ATTACHMENT,v.width=g.width,v.height=g.height,this.initialize(v,!0)},n(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}},{key:"gpuTextureView",get:function(){return this._gpuTextureView}}]),e}(uW),j$="webglcontextlost";function E1(g,v){for(var S=["","WEBKIT_","MOZ_"],O=0;O<S.length;++O){var X=g.getExtension(S[O]+v);if(X)return X}return null}function C1(g){var v={EXT_texture_filter_anisotropic:E1(g,"EXT_texture_filter_anisotropic"),EXT_color_buffer_half_float:E1(g,"EXT_color_buffer_half_float"),EXT_color_buffer_float:E1(g,"EXT_color_buffer_float"),WEBGL_compressed_texture_etc1:E1(g,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:E1(g,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:E1(g,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_astc:E1(g,"WEBGL_compressed_texture_astc"),WEBGL_compressed_texture_s3tc:E1(g,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:E1(g,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:E1(g,"WEBGL_debug_shaders"),WEBGL_lose_context:E1(g,"WEBGL_lose_context"),WEBGL_debug_renderer_info:E1(g,"WEBGL_debug_renderer_info"),OES_texture_half_float_linear:E1(g,"OES_texture_half_float_linear"),OES_texture_float_linear:E1(g,"OES_texture_float_linear"),WEBGL_multi_draw:null,useVAO:!0};return aD.os!==aw.ANDROID&&aD.os!==aw.IOS&&(v.WEBGL_multi_draw=E1(g,"WEBGL_multi_draw")),v}var j1=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).stateCache=new jZ,v.nullTex2D=null,v.nullTexCube=null,v._canvas=null,v._webGL2ContextLostHandler=null,v._extensions=null,v._blitManager=null,v}s(e,g);var v=e.prototype;return v.initialize=function(g){this._canvas=g.windowHandle,this._webGL2ContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(j$,this._onWebGLContextLost);var v=jl.instance.gl;this.stateCache.initialize(jl.instance.capabilities.maxTextureUnits,jl.instance.capabilities.maxUniformBufferBindings,jl.instance.capabilities.maxVertexAttributes),this._extensions=C1(v),function(g){g.activeTexture(g.TEXTURE0),g.pixelStorei(g.PACK_ALIGNMENT,1),g.pixelStorei(g.UNPACK_ALIGNMENT,1),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,!1),g.bindFramebuffer(g.FRAMEBUFFER,null),g.enable(g.SCISSOR_TEST),g.enable(g.CULL_FACE),g.cullFace(g.BACK),g.frontFace(g.CCW),g.polygonOffset(0,0),g.enable(g.DEPTH_TEST),g.depthMask(!0),g.depthFunc(g.LESS),g.stencilFuncSeparate(g.FRONT,g.ALWAYS,1,65535),g.stencilOpSeparate(g.FRONT,g.KEEP,g.KEEP,g.KEEP),g.stencilMaskSeparate(g.FRONT,65535),g.stencilFuncSeparate(g.BACK,g.ALWAYS,1,65535),g.stencilOpSeparate(g.BACK,g.KEEP,g.KEEP,g.KEEP),g.stencilMaskSeparate(g.BACK,65535),g.disable(g.STENCIL_TEST),g.disable(g.SAMPLE_ALPHA_TO_COVERAGE),g.disable(g.BLEND),g.blendEquationSeparate(g.FUNC_ADD,g.FUNC_ADD),g.blendFuncSeparate(g.ONE,g.ZERO,g.ONE,g.ZERO),g.colorMask(!0,!0,!0,!0),g.blendColor(0,0,0,0)}(v);var S=oA.RGBA8,O=oA.DEPTH_STENCIL,X=v.getParameter(v.DEPTH_BITS),Y=v.getParameter(v.STENCIL_BITS);X&&Y?O=oA.DEPTH_STENCIL:X&&(O=oA.DEPTH),this._colorTexture=new jQ,this._colorTexture.initAsSwapchainTexture({swapchain:this,format:S,width:g.width,height:g.height}),this._depthStencilTexture=new jQ,this._depthStencilTexture.initAsSwapchainTexture({swapchain:this,format:O,width:g.width,height:g.height}),this.nullTex2D=jl.instance.createTexture(new hB(ow.TEX2D,oI.SAMPLED,oA.RGBA8,2,2,oB.NONE)),this.nullTexCube=jl.instance.createTexture(new hB(ow.CUBE,oI.SAMPLED,oA.RGBA8,2,2,oB.NONE,6));var te=new hg;te.texExtent.width=2,te.texExtent.height=2;var ti=new Uint8Array(this.nullTex2D.size);ti.fill(0),jl.instance.copyBuffersToTexture([ti],this.nullTex2D,[te]),te.texSubres.layerCount=6,jl.instance.copyBuffersToTexture([ti,ti,ti,ti,ti,ti],this.nullTexCube,[te]),this._blitManager=new jO},v.destroy=function(){this._canvas&&this._webGL2ContextLostHandler&&(this._canvas.removeEventListener(j$,this._webGL2ContextLostHandler),this._webGL2ContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._blitManager&&(this._blitManager.destroy(),this._blitManager=null),this._extensions=null,this._canvas=null},v.resize=function(g,v){this._colorTexture.width===g&&this._colorTexture.height===v||(U("Resizing swapchain: "+g+"x"+v),this._canvas.width=g,this._canvas.height=v,this._colorTexture.resize(g,v),this._depthStencilTexture.resize(g,v))},v._onWebGLContextLost=function(g){q(11e3),G(g)},n(e,[{key:"extensions",get:function(){return this._extensions}},{key:"blitManager",get:function(){return this._blitManager}}]),e}(uw),j2=g("eq",function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._swapchain=null,v._context=null,v._bindingMappings=null,v._textureExclusive=new Array(oA.COUNT),v}s(e,g);var v=e.prototype;return v.initialize=function(g){jl.setInstance(this),this._gfxAPI=om.WEBGL2;var v=this._bindingMappingInfo=g.bindingMappingInfo,S=[],O=[],X=v.setIndices[0];S[X]=0,O[X]=0;for(var Y=1;Y<v.setIndices.length;++Y){var te=v.setIndices[Y],ti=v.setIndices[Y-1];S[te]=v.maxBlockCounts[ti]+S[ti],O[te]=v.maxSamplerTextureCounts[ti]+O[ti]}for(var tr=0;tr<v.setIndices.length;++tr){var ta=v.setIndices[tr];O[ta]-=v.maxBlockCounts[ta]}this._bindingMappings={blockOffsets:S,samplerTextureOffsets:O,flexibleSet:v.setIndices[v.setIndices.length-1]};var th=this._context=function(g){var v=null;try{var S;if(null!==(S=globalThis.__globalXR)&&void 0!==S&&S.webxrCompatible){var O={alpha:t$.ENABLE_TRANSPARENT_CANVAS,antialias:t$.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1,xrCompatible:!0};return g.getContext("webgl2",O)}var X={alpha:t$.ENABLE_TRANSPARENT_CANVAS,antialias:t$.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};v=g.getContext("webgl2",X)}catch(g){return null}return v}(uE.canvas);if(!th)return console.error("This device does not support WebGL2."),!1;if(this._queue=this.createQueue(new ur(o4.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new ue(this._queue)),this._caps.maxVertexAttributes=th.getParameter(th.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=th.getParameter(th.MAX_VERTEX_UNIFORM_VECTORS),aD.os===aw.IOS){var tu=this._caps.maxVertexUniformVectors;a3.browserType===ax.WECHAT?this._caps.maxVertexUniformVectors=tu<256?tu:256:a3.browserType===ax.SAFARI&&(this._caps.maxVertexUniformVectors=tu<512?tu:512)}this._caps.maxFragmentUniformVectors=th.getParameter(th.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=th.getParameter(th.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=th.getParameter(th.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxUniformBufferBindings=th.getParameter(th.MAX_UNIFORM_BUFFER_BINDINGS),this._caps.maxUniformBlockSize=th.getParameter(th.MAX_UNIFORM_BLOCK_SIZE),this._caps.maxTextureSize=th.getParameter(th.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=th.getParameter(th.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxArrayTextureLayers=th.getParameter(th.MAX_ARRAY_TEXTURE_LAYERS),this._caps.max3DTextureSize=th.getParameter(th.MAX_3D_TEXTURE_SIZE),this._caps.uboOffsetAlignment=th.getParameter(th.UNIFORM_BUFFER_OFFSET_ALIGNMENT);var tl=th.getSupportedExtensions(),tc="";if(tl)for(var t_,tf=f(tl);!(t_=tf()).done;)tc+=t_.value+" ";var tp=C1(th);tp.WEBGL_debug_renderer_info?(this._renderer=th.getParameter(tp.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=th.getParameter(tp.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=th.getParameter(th.RENDERER),this._vendor=th.getParameter(th.VENDOR));var tm=th.getParameter(th.VERSION);this._features.fill(!1),this.initFormatFeatures(tp),this._features[oS.ELEMENT_INDEX_UINT]=!0,this._features[oS.INSTANCED_ARRAYS]=!0,this._features[oS.MULTIPLE_RENDER_TARGETS]=!0,this._features[oS.BLEND_MINMAX]=!0;var tg="";return this.getFormatFeatures(oA.ETC_RGB8)&&(tg+="etc1 "),this.getFormatFeatures(oA.ETC2_RGB8)&&(tg+="etc2 "),this.getFormatFeatures(oA.BC1)&&(tg+="dxt "),this.getFormatFeatures(oA.PVRTC_RGB2)&&(tg+="pvrtc "),this.getFormatFeatures(oA.ASTC_RGBA_4X4)&&(tg+="astc "),U("WebGL2 device initialized."),U("RENDERER: "+this._renderer),U("VENDOR: "+this._vendor),U("VERSION: "+tm),U("COMPRESSED_FORMAT: "+tg),U("EXTENSIONS: "+tc),!0},v.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null);for(var g=this._samplers.values(),v=g.next();!v.done;)v.value.destroy(),v=g.next();this._swapchain=null},v.flushCommands=function(){},v.acquire=function(){},v.present=function(){var g=this._queue;this._numDrawCalls=g.numDrawCalls,this._numInstances=g.numInstances,this._numTris=g.numTris,g.clear()},v.initFormatFeatures=function(g){this._formatFeatures.fill(oP.NONE),this._textureExclusive.fill(!0);var v=oP.RENDER_TARGET|oP.SAMPLED_TEXTURE|oP.STORAGE_TEXTURE|oP.LINEAR_FILTER|oP.VERTEX_ATTRIBUTE;this._formatFeatures[oA.R8]=v,this._formatFeatures[oA.RG8]=v,this._formatFeatures[oA.RGB8]=v,this._formatFeatures[oA.RGBA8]=v,v=oP.RENDER_TARGET|oP.SAMPLED_TEXTURE|oP.STORAGE_TEXTURE|oP.LINEAR_FILTER,this._formatFeatures[oA.R8SN]=v,this._formatFeatures[oA.RG8SN]=v,this._formatFeatures[oA.RGB8SN]=v,this._formatFeatures[oA.RGBA8SN]=v,this._formatFeatures[oA.R5G6B5]=v,this._formatFeatures[oA.RGBA4]=v,this._formatFeatures[oA.RGB5A1]=v,this._formatFeatures[oA.RGB10A2]=v,this._formatFeatures[oA.SRGB8]=v,this._formatFeatures[oA.SRGB8_A8]=v,this._formatFeatures[oA.R11G11B10F]=v,this._formatFeatures[oA.RGB9E5]=v,this._formatFeatures[oA.DEPTH]=v,this._formatFeatures[oA.DEPTH_STENCIL]=v,this._formatFeatures[oA.RGB10A2UI]=oP.RENDER_TARGET|oP.STORAGE_TEXTURE|oP.SAMPLED_TEXTURE|oP.LINEAR_FILTER,v=oP.RENDER_TARGET|oP.SAMPLED_TEXTURE|oP.STORAGE_TEXTURE|oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.R16F]=v,this._formatFeatures[oA.RG16F]=v,this._formatFeatures[oA.RGB16F]=v,this._formatFeatures[oA.RGBA16F]=v,v=oP.STORAGE_TEXTURE|oP.SAMPLED_TEXTURE|oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.R32F]=v,this._formatFeatures[oA.RG32F]=v,this._formatFeatures[oA.RGB32F]=v,this._formatFeatures[oA.RGBA32F]=v,this._formatFeatures[oA.RGB10A2UI]=oP.RENDER_TARGET|oP.STORAGE_TEXTURE|oP.SAMPLED_TEXTURE|oP.LINEAR_FILTER,v=oP.RENDER_TARGET|oP.STORAGE_TEXTURE|oP.SAMPLED_TEXTURE|oP.LINEAR_FILTER|oP.VERTEX_ATTRIBUTE,this._formatFeatures[oA.R8I]=v,this._formatFeatures[oA.R8UI]=v,this._formatFeatures[oA.R16I]=v,this._formatFeatures[oA.R16UI]=v,this._formatFeatures[oA.R32I]=v,this._formatFeatures[oA.R32UI]=v,this._formatFeatures[oA.RG8I]=v,this._formatFeatures[oA.RG8UI]=v,this._formatFeatures[oA.RG16I]=v,this._formatFeatures[oA.RG16UI]=v,this._formatFeatures[oA.RG32I]=v,this._formatFeatures[oA.RG32UI]=v,this._formatFeatures[oA.RGB8I]=v,this._formatFeatures[oA.RGB8UI]=v,this._formatFeatures[oA.RGB16I]=v,this._formatFeatures[oA.RGB16UI]=v,this._formatFeatures[oA.RGB32I]=v,this._formatFeatures[oA.RGB32UI]=v,this._formatFeatures[oA.RGBA8I]=v,this._formatFeatures[oA.RGBA8UI]=v,this._formatFeatures[oA.RGBA16I]=v,this._formatFeatures[oA.RGBA16UI]=v,this._formatFeatures[oA.RGBA32I]=v,this._formatFeatures[oA.RGBA32UI]=v,this._textureExclusive[oA.R8]=!1,this._textureExclusive[oA.RG8]=!1,this._textureExclusive[oA.RGB8]=!1,this._textureExclusive[oA.R5G6B5]=!1,this._textureExclusive[oA.RGBA4]=!1,this._textureExclusive[oA.RGB5A1]=!1,this._textureExclusive[oA.RGBA8]=!1,this._textureExclusive[oA.RGB10A2]=!1,this._textureExclusive[oA.RGB10A2UI]=!1,this._textureExclusive[oA.SRGB8_A8]=!1,this._textureExclusive[oA.R8I]=!1,this._textureExclusive[oA.R8UI]=!1,this._textureExclusive[oA.R16I]=!1,this._textureExclusive[oA.R16UI]=!1,this._textureExclusive[oA.R32I]=!1,this._textureExclusive[oA.R32UI]=!1,this._textureExclusive[oA.RG8I]=!1,this._textureExclusive[oA.RG8UI]=!1,this._textureExclusive[oA.RG16I]=!1,this._textureExclusive[oA.RG16UI]=!1,this._textureExclusive[oA.RG32I]=!1,this._textureExclusive[oA.RG32UI]=!1,this._textureExclusive[oA.RGBA8I]=!1,this._textureExclusive[oA.RGBA8UI]=!1,this._textureExclusive[oA.RGBA16I]=!1,this._textureExclusive[oA.RGBA16UI]=!1,this._textureExclusive[oA.RGBA32I]=!1,this._textureExclusive[oA.RGBA32UI]=!1,this._textureExclusive[oA.DEPTH]=!1,this._textureExclusive[oA.DEPTH_STENCIL]=!1,g.EXT_color_buffer_float&&(this._formatFeatures[oA.R32F]|=oP.RENDER_TARGET,this._formatFeatures[oA.RG32F]|=oP.RENDER_TARGET,this._formatFeatures[oA.RGBA32F]|=oP.RENDER_TARGET,this._textureExclusive[oA.R32F]=!1,this._textureExclusive[oA.RG32F]=!1,this._textureExclusive[oA.RGBA32F]=!1),g.EXT_color_buffer_half_float&&(this._textureExclusive[oA.R16F]=!1,this._textureExclusive[oA.RG16F]=!1,this._textureExclusive[oA.RGBA16F]=!1),g.OES_texture_float_linear&&(this._formatFeatures[oA.RGB32F]|=oP.LINEAR_FILTER,this._formatFeatures[oA.RGBA32F]|=oP.LINEAR_FILTER,this._formatFeatures[oA.R32F]|=oP.LINEAR_FILTER,this._formatFeatures[oA.RG32F]|=oP.LINEAR_FILTER),g.OES_texture_half_float_linear&&(this._formatFeatures[oA.RGB16F]|=oP.LINEAR_FILTER,this._formatFeatures[oA.RGBA16F]|=oP.LINEAR_FILTER,this._formatFeatures[oA.R16F]|=oP.LINEAR_FILTER,this._formatFeatures[oA.RG16F]|=oP.LINEAR_FILTER);var S=oP.SAMPLED_TEXTURE|oP.LINEAR_FILTER;g.WEBGL_compressed_texture_etc1&&(this._formatFeatures[oA.ETC_RGB8]=S),g.WEBGL_compressed_texture_etc&&(this._formatFeatures[oA.ETC2_RGB8]=S,this._formatFeatures[oA.ETC2_RGBA8]=S,this._formatFeatures[oA.ETC2_SRGB8]=S,this._formatFeatures[oA.ETC2_SRGB8_A8]=S,this._formatFeatures[oA.ETC2_RGB8_A1]=S,this._formatFeatures[oA.ETC2_SRGB8_A1]=S),g.WEBGL_compressed_texture_s3tc&&(this._formatFeatures[oA.BC1]=S,this._formatFeatures[oA.BC1_ALPHA]=S,this._formatFeatures[oA.BC1_SRGB]=S,this._formatFeatures[oA.BC1_SRGB_ALPHA]=S,this._formatFeatures[oA.BC2]=S,this._formatFeatures[oA.BC2_SRGB]=S,this._formatFeatures[oA.BC3]=S,this._formatFeatures[oA.BC3_SRGB]=S),g.WEBGL_compressed_texture_pvrtc&&(this._formatFeatures[oA.PVRTC_RGB2]=S,this._formatFeatures[oA.PVRTC_RGBA2]=S,this._formatFeatures[oA.PVRTC_RGB4]=S,this._formatFeatures[oA.PVRTC_RGBA4]=S),g.WEBGL_compressed_texture_astc&&(this._formatFeatures[oA.ASTC_RGBA_4X4]=S,this._formatFeatures[oA.ASTC_RGBA_5X4]=S,this._formatFeatures[oA.ASTC_RGBA_5X5]=S,this._formatFeatures[oA.ASTC_RGBA_6X5]=S,this._formatFeatures[oA.ASTC_RGBA_6X6]=S,this._formatFeatures[oA.ASTC_RGBA_8X5]=S,this._formatFeatures[oA.ASTC_RGBA_8X6]=S,this._formatFeatures[oA.ASTC_RGBA_8X8]=S,this._formatFeatures[oA.ASTC_RGBA_10X5]=S,this._formatFeatures[oA.ASTC_RGBA_10X6]=S,this._formatFeatures[oA.ASTC_RGBA_10X8]=S,this._formatFeatures[oA.ASTC_RGBA_10X10]=S,this._formatFeatures[oA.ASTC_RGBA_12X10]=S,this._formatFeatures[oA.ASTC_RGBA_12X12]=S,this._formatFeatures[oA.ASTC_SRGBA_4X4]=S,this._formatFeatures[oA.ASTC_SRGBA_5X4]=S,this._formatFeatures[oA.ASTC_SRGBA_5X5]=S,this._formatFeatures[oA.ASTC_SRGBA_6X5]=S,this._formatFeatures[oA.ASTC_SRGBA_6X6]=S,this._formatFeatures[oA.ASTC_SRGBA_8X5]=S,this._formatFeatures[oA.ASTC_SRGBA_8X6]=S,this._formatFeatures[oA.ASTC_SRGBA_8X8]=S,this._formatFeatures[oA.ASTC_SRGBA_10X5]=S,this._formatFeatures[oA.ASTC_SRGBA_10X6]=S,this._formatFeatures[oA.ASTC_SRGBA_10X8]=S,this._formatFeatures[oA.ASTC_SRGBA_10X10]=S,this._formatFeatures[oA.ASTC_SRGBA_12X10]=S,this._formatFeatures[oA.ASTC_SRGBA_12X12]=S)},v.createCommandBuffer=function(g){var v=new(g.type===o6.PRIMARY?jj:jk);return v.initialize(g),v},v.createSwapchain=function(g){var v=new j1;return this._swapchain=v,v.initialize(g),v},v.createBuffer=function(g){var v=new jL;return v.initialize(g),v},v.createTexture=function(g){var v=new jQ;return v.initialize(g),v},v.createDescriptorSet=function(g){var v=new ju;return v.initialize(g),v},v.createShader=function(g){var v=new jJ;return v.initialize(g),v},v.createInputAssembler=function(g){var v=new jV;return v.initialize(g),v},v.createRenderPass=function(g){var v=new jY;return v.initialize(g),v},v.createFramebuffer=function(g){var v=new jG;return v.initialize(g),v},v.createDescriptorSetLayout=function(g){var v=new jU;return v.initialize(g),v},v.createPipelineLayout=function(g){var v=new jH;return v.initialize(g),v},v.createPipelineState=function(g){var v=new jX;return v.initialize(g),v},v.createQueue=function(g){var v=new jq;return v.initialize(g),v},v.getSampler=function(g){var v=uH.computeHash(g);return this._samplers.has(v)||this._samplers.set(v,new jK(g,v)),this._samplers.get(v)},v.getSwapchains=function(){return[this._swapchain]},v.getGeneralBarrier=function(g){var v=uX.computeHash(g);return this._generalBarrierss.has(v)||this._generalBarrierss.set(v,new uX(g,v)),this._generalBarrierss.get(v)},v.getTextureBarrier=function(g){var v=uq.computeHash(g);return this._textureBarriers.has(v)||this._textureBarriers.set(v,new uq(g,v)),this._textureBarriers.get(v)},v.getBufferBarrier=function(g){var v=uY.computeHash(g);return this._bufferBarriers.has(v)||this._bufferBarriers.set(v,new uY(g,v)),this._bufferBarriers.get(v)},v.copyBuffersToTexture=function(g,v,S){e1(this,g,v.gpuTexture,S)},v.copyTextureToBuffers=function(g,v,S){!function(g,v,S,O){var X=g.gl,Y=g.stateCache,te=X.createFramebuffer();X.bindFramebuffer(X.FRAMEBUFFER,te);var ti=0,tr=0,ta=1,th=1;switch(v.glTarget){case X.TEXTURE_2D:for(var tu=0;tu<O.length;tu++){var tl=O[tu];X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,v.glTarget,v.glTexture,tl.texSubres.mipLevel),ti=tl.texOffset.x,tr=tl.texOffset.y,ta=tl.texExtent.width,th=tl.texExtent.height,X.readPixels(ti,tr,ta,th,v.glFormat,v.glType,S[tu])}break;default:k("Unsupported GL texture type, copy texture to buffers failed.")}X.bindFramebuffer(X.FRAMEBUFFER,null),Y.glFramebuffer=null,X.deleteFramebuffer(te)}(this,g.gpuTexture,v,S)},v.copyTexImagesToTexture=function(g,v,S){!function(g,v,S,O){var X=g.gl,Y=g.stateCache.glTexUnits[g.stateCache.texUnit];Y.glTexture!==S.glTexture&&(X.bindTexture(S.glTarget,S.glTexture),Y.glTexture=S.glTexture);var te=0,ti=0;switch(S.glTarget){case X.TEXTURE_2D:if(S.flags&oB.MUTABLE_STORAGE||function(g,v){if(g.length>1||v.length>1)return!1;if(_instanceof(g[0],HTMLVideoElement)){var S=g[0];return 0===v[0].texOffset.x&&0===v[0].texOffset.y&&v[0].texExtent.width===S.videoWidth&&v[0].texExtent.height===S.videoHeight}return!1}(v,O))X.texImage2D(X.TEXTURE_2D,O[0].texSubres.mipLevel,S.glInternalFmt,O[0].texExtent.width,O[0].texExtent.height,0,S.glFormat,S.glType,v[0]);else for(var tr=0;tr<O.length;tr++){var ta=O[tr];X.texSubImage2D(X.TEXTURE_2D,ta.texSubres.mipLevel,ta.texOffset.x,ta.texOffset.y,S.glFormat,S.glType,v[te++])}break;case X.TEXTURE_CUBE_MAP:for(var th=0;th<O.length;th++){var tu=O[th],tl=tu.texSubres.baseArrayLayer+tu.texSubres.layerCount;for(ti=tu.texSubres.baseArrayLayer;ti<tl;++ti)X.texSubImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ti,tu.texSubres.mipLevel,tu.texOffset.x,tu.texOffset.y,S.glFormat,S.glType,v[te++])}break;default:k("Unsupported GL texture type, copy buffer to texture failed.")}S.flags&oB.GEN_MIPMAP&&X.generateMipmap(S.glTarget)}(this,g,v.gpuTexture,S)},n(e,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"stateCache",get:function(){return this._swapchain.stateCache}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}},{key:"textureExclusive",get:function(){return this._textureExclusive}},{key:"bindingMappings",get:function(){return this._bindingMappings}},{key:"blitManager",get:function(){return this._swapchain.blitManager}}]),e}(uE));function R1(g,v,S,O){var X=(O.x-S.x)*(g.y-S.y)-(O.y-S.y)*(g.x-S.x),Y=(v.x-g.x)*(g.y-S.y)-(v.y-g.y)*(g.x-S.x),te=(O.y-S.y)*(v.x-g.x)-(O.x-S.x)*(v.y-g.y);if(0!==te){var ti=X/te,tr=Y/te;if(ti>=0&&ti<=1&&tr>=0&&tr<=1)return!0}return!1}X.WebGL2Device=j2;var j3=new e8,j5=new e8,j4=new e8,j8=new e8;function D1(g,v,S){for(var O=S.length,X=0;X<O;++X)if(R1(g,v,S[X],S[(X+1)%O]))return!0;return!1}function O1(g,v){for(var S=!1,O=g.x,X=g.y,Y=v.length,te=0,ti=Y-1;te<Y;ti=te++){var tr=v[te].x,ta=v[te].y,th=v[ti].x,tu=v[ti].y;ta>X!=tu>X&&O<(th-tr)*(X-ta)/(tu-ta)+tr&&(S=!S)}return S}function M1(g,v,S,O){var X,Y=S.x-v.x,te=S.y-v.y,ti=Y*Y+te*te,tr=((g.x-v.x)*Y+(g.y-v.y)*te)/ti;return X=O?ti?tr<0?v:tr>1?S:j3.set(v.x+tr*Y,v.y+tr*te):v:j3.set(v.x+tr*Y,v.y+tr*te),Y=g.x-X.x,te=g.y-X.y,Math.sqrt(Y*Y+te*te)}var j6=g("er",function(){});j6.lineLine=R1,j6.lineRect=function(g,v,S){var O=j3.set(S.x,S.y),X=j5.set(S.x,S.yMax),Y=j4.set(S.xMax,S.yMax),te=j8.set(S.xMax,S.y);return!!(R1(g,v,O,X)||R1(g,v,X,Y)||R1(g,v,Y,te)||R1(g,v,te,O))},j6.linePolygon=D1,j6.rectRect=function(g,v){var S=g.x,O=g.y,X=g.x+g.width,Y=g.y+g.height,te=v.x,ti=v.y,tr=v.x+v.width,ta=v.y+v.height;return S<=tr&&X>=te&&O<=ta&&Y>=ti},j6.rectPolygon=function(g,v){var S=j3.set(g.x,g.y),O=j5.set(g.x,g.yMax),X=j4.set(g.xMax,g.yMax),Y=j8.set(g.xMax,g.y);if(D1(S,O,v))return!0;if(D1(O,X,v))return!0;if(D1(X,Y,v))return!0;if(D1(Y,S,v))return!0;for(var te=0,ti=v.length;te<ti;++te)if(g.contains(v[te]))return!0;return!!(O1(S,v)||O1(O,v)||O1(X,v)||O1(Y,v))},j6.rectCircle=function(g,v,S){var O=v.x,X=v.y,Y=g.x,te=g.y,ti=g.width,tr=g.height,ta=O,th=X;O<Y?ta=Y:O>Y+ti&&(ta=Y+ti),X<te?th=te:X>te+tr&&(th=te+tr);var tu=O-ta,tl=X-th;return Math.sqrt(tu*tu+tl*tl)<=S},j6.polygonPolygon=function(g,v){var S,O;for(S=0,O=g.length;S<O;++S)if(D1(g[S],g[(S+1)%O],v))return!0;for(S=0,O=v.length;S<O;++S)if(O1(v[S],g))return!0;for(S=0,O=g.length;S<O;++S)if(O1(g[S],v))return!0;return!1},j6.circleCircle=function(g,v,S,O){return e8.distance(g,S)<v+O},j6.polygonCircle=function(g,v,S){var O=v;if(O1(O,g))return!0;for(var X=0,Y=g.length;X<Y;X++)if(M1(O,0===X?g[g.length-1]:g[X-1],g[X],!0)<S)return!0;return!1},j6.pointInPolygon=O1,j6.pointLineDistance=M1;var j7,j9,qi,qn=re({GRAVITY:0,RADIUS:1}),qo=re({FREE:0,RELATIVE:1,GROUPED:2}),qu=new e8(0,0),ql=new e8,qc=new e8,q_=new e8,qf=new e8,qp=qN(Ph),Y1=function(){this.pos=new e8(0,0),this.startPos=new e8(0,0),this.color=new is(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new e8(0,0),this.aspectRatio=1,this.dir=new e8(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},qm=new(function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.prototype.get=function(){return this._get()||new Y1},e}(tU))(function(g){g.pos.set(qu),g.startPos.set(qu),g.color._val=0xff000000,g.deltaColor.r=g.deltaColor.g=g.deltaColor.b=0,g.deltaColor.a=255,g.size=0,g.deltaSize=0,g.rotation=0,g.deltaRotation=0,g.timeToLive=0,g.drawPos.set(qu),g.aspectRatio=1,g.dir.set(qu),g.radialAccel=0,g.tangentialAccel=0,g.angle=0,g.degreesPerSecond=0,g.radius=0,g.deltaRadius=0},1024),qy=function(){function t1(g){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=g,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var g=t1.prototype;return g.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},g.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var g=this.particles,v=0;v<g.length;++v)qm.put(g[v]);g.length=0,this.renderData.resize(0,0)},g.emitParticle=function(g){var v=this.sys,S=qm.get();this.particles.push(S),S.timeToLive=v.life+v.lifeVar*(Ai()-.5)*2;var O=S.timeToLive=Math.max(0,S.timeToLive);S.pos.x=v.sourcePos.x+v.posVar.x*(Ai()-.5)*2,S.pos.y=v.sourcePos.y+v.posVar.y*(Ai()-.5)*2;var X,Y,te,ti,tr=v.startColor,ta=v.startColorVar,th=v.endColor,tu=v.endColorVar;S.color.r=X=be(tr.r+ta.r*(Ai()-.5)*2,0,255),S.color.g=Y=be(tr.g+ta.g*(Ai()-.5)*2,0,255),S.color.b=te=be(tr.b+ta.b*(Ai()-.5)*2,0,255),S.color.a=ti=be(tr.a+ta.a*(Ai()-.5)*2,0,255),S.deltaColor.r=(be(th.r+tu.r*(Ai()-.5)*2,0,255)-X)/O,S.deltaColor.g=(be(th.g+tu.g*(Ai()-.5)*2,0,255)-Y)/O,S.deltaColor.b=(be(th.b+tu.b*(Ai()-.5)*2,0,255)-te)/O,S.deltaColor.a=(be(th.a+tu.a*(Ai()-.5)*2,0,255)-ti)/O;var tl=v.startSize+v.startSizeVar*(Ai()-.5)*2;if(tl=Math.max(0,tl),S.size=tl,-1===v.endSize)S.deltaSize=0;else{var tc=v.endSize+v.endSizeVar*(Ai()-.5)*2;tc=Math.max(0,tc),S.deltaSize=(tc-tl)/O}var t_=v.startSpin+v.startSpinVar*(Ai()-.5)*2,tf=v.endSpin+v.endSpinVar*(Ai()-.5)*2;S.rotation=t_,S.deltaRotation=(tf-t_)/O,S.startPos.x=g.x,S.startPos.y=g.y,S.aspectRatio=v.aspectRatio||1;var tp=xe(v.angle+this._worldRotation+v.angleVar*(Ai()-.5)*2);if(v.emitterMode===qn.GRAVITY){var tm=v.speed+v.speedVar*(Ai()-.5)*2;S.dir.x=Math.cos(tp),S.dir.y=Math.sin(tp),S.dir.multiplyScalar(tm),S.radialAccel=v.radialAccel+v.radialAccelVar*(Ai()-.5)*2,S.tangentialAccel=v.tangentialAccel+v.tangentialAccelVar*(Ai()-.5)*2,v.rotationIsDir&&(S.rotation=-Re(Math.atan2(S.dir.y,S.dir.x)))}else{var tg=v.startRadius+v.startRadiusVar*(Ai()-.5)*2,tv=v.endRadius+v.endRadiusVar*(Ai()-.5)*2;S.radius=tg,S.deltaRadius=-1===v.endRadius?0:(tv-tg)/O,S.angle=tp,S.degreesPerSecond=xe(v.rotatePerS+v.rotatePerSVar*(Ai()-.5)*2)}},g.updateUVs=function(g){var v=this.renderData;if(v&&this.sys._renderSpriteFrame){for(var S=v.vData,O=this.sys._renderSpriteFrame.uv,X=g?0:this.uvFilled,Y=this.particles.length,te=X;te<Y;te++){var ti=te*qp*4;S[ti+3]=O[0],S[ti+4]=O[1],S[ti+12]=O[2],S[ti+13]=O[3],S[ti+21]=O[4],S[ti+22]=O[5],S[ti+30]=O[6],S[ti+31]=O[7]}this.uvFilled=Y}},g.updateParticleBuffer=function(g,v,S,O){var X=S.vData,Y=v.x,te=v.y,ti=g.size,tr=ti,ta=g.aspectRatio;ta>1?tr=ti/ta:ti=tr*ta;var th=ti/2,tu=tr/2;if(g.rotation){var tl=-th,tc=-tu,t_=th,tf=tu,tp=-xe(g.rotation),tm=Math.cos(tp),tg=Math.sin(tp);X[O]=tl*tm-tc*tg+Y,X[O+1]=tl*tg+tc*tm+te,X[O+2]=0,X[O+9]=t_*tm-tc*tg+Y,X[O+10]=t_*tg+tc*tm+te,X[O+11]=0,X[O+18]=tl*tm-tf*tg+Y,X[O+19]=tl*tg+tf*tm+te,X[O+20]=0,X[O+27]=t_*tm-tf*tg+Y,X[O+28]=t_*tg+tf*tm+te,X[O+29]=0}else X[O]=Y-th,X[O+1]=te-tu,X[O+2]=0,X[O+9]=Y+th,X[O+10]=te-tu,X[O+11]=0,X[O+18]=Y-th,X[O+19]=te+tu,X[O+20]=0,X[O+27]=Y+th,X[O+28]=te+tu,X[O+29]=0;is.toArray(X,g.color,O+5),is.toArray(X,g.color,O+14),is.toArray(X,g.color,O+23),is.toArray(X,g.color,O+32)},g.step=function(g){var v=this.sys.assembler,S=this.sys,O=S.node,X=this.particles;if(g=g>v.maxParticleDeltaTime?v.maxParticleDeltaTime:g,O.updateWorldTransform(),S.positionType===qo.FREE){this._worldRotation=function(g){for(var v=0,S=g;S;)v+=S.eulerAngles.z,S=S.parent;return v}(O);var Y=O.worldMatrix;ql.x=Y.m12,ql.y=Y.m13}else S.positionType===qo.RELATIVE?(this._worldRotation=O.eulerAngles.z,ql.x=O.position.x,ql.y=O.position.y):this._worldRotation=0;if(this.active&&S.emissionRate){var te=1/S.emissionRate;for(X.length<S.totalParticles&&(this.emitCounter+=g);X.length<S.totalParticles&&this.emitCounter>te;)this.emitParticle(ql),this.emitCounter-=te;this.elapsed+=g,-1!==S.duration&&S.duration<this.elapsed&&S.stopSystem()}var ti=this.renderData,tr=X.length;ti.reset(),this.requestData(4*tr,6*tr),tr>this.uvFilled&&this.updateUVs();for(var ta=0;ta<X.length;){qc.x=qc.y=q_.x=q_.y=qf.x=qf.y=0;var th=X[ta];if(th.timeToLive-=g,th.timeToLive>0){if(S.emitterMode===qn.GRAVITY){var tu=qf,tl=qc,tc=q_;(th.pos.x||th.pos.y)&&(tl.set(th.pos),tl.normalize()),tc.set(tl),tl.multiplyScalar(th.radialAccel);var t_=tc.x;tc.x=-tc.y,tc.y=t_,tc.multiplyScalar(th.tangentialAccel),tu.set(tl),tu.add(tc),tu.add(S.gravity),tu.multiplyScalar(g),th.dir.add(tu),tu.set(th.dir),tu.multiplyScalar(g),th.pos.add(tu)}else th.angle+=th.degreesPerSecond*g,th.radius+=th.deltaRadius*g,th.pos.x=-Math.cos(th.angle)*th.radius,th.pos.y=-Math.sin(th.angle)*th.radius;th.color.r+=th.deltaColor.r*g,th.color.g+=th.deltaColor.g*g,th.color.b+=th.deltaColor.b*g,th.color.a+=th.deltaColor.a*g,th.size+=th.deltaSize*g,th.size<0&&(th.size=0),th.rotation+=th.deltaRotation*g;var tf=qc;tf.set(th.pos),S.positionType!==qo.GROUPED&&tf.add(th.startPos);var tp=qp*ta*4;this.updateParticleBuffer(th,tf,ti,tp),++ta}else{var tm=X[ta];ta!==X.length-1&&(X[ta]=X[X.length-1]),qm.put(tm),X.length--,ti.resize(ti.vertexCount-4,ti.indexCount-6)}}this.renderData.material=this.sys.getRenderMaterial(0),this.renderData.frame=this.sys._renderSpriteFrame,ti.setRenderDrawInfoAttributes(),0!==X.length||this.active||this.readyToPlay||(this.finished=!0,S._finishedSimulation())},g.requestData=function(g,v){var S=this.renderData.indexCount;this.renderData.request(g,v);for(var O=this.renderData.indexCount/6,X=this.renderData.iData,Y=S;Y<O;Y++){var te=4*Y;X[S++]=te,X[S++]=te+1,X[S++]=te+2,X[S++]=te+1,X[S++]=te+3,X[S++]=te+2}},g.initDrawInfo=function(){this.renderData.setRenderDrawInfoAttributes()},t1}(),qS=n2,qA=g("ew",nJ("cc.ParticleAsset")((j9=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).spriteFrame=qi&&qi(),v}return s(e,g),e}(lx),qi=ws(j9.prototype,"spriteFrame",[qS],function(){return null}),j7=j9))||j7);X.ParticleAsset=qA;for(var qT=function(){function t1(g){var v,S=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=g,this.transparency={indexed:[],rgb:0,grayscale:0};for(var O=0,X=0,Y=0;;){Y=this.readUInt32();var te=(function(){var g=[];for(O=0;O<4;++O)g.push(String.fromCharCode(S.data[S.pos++]));return g}).call(this).join("");switch(te){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(Y);break;case"fcTL":v&&this.animation.frames.push(v),this.pos+=4,v={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var ti=this.readUInt16(),tr=this.readUInt16()||100;v.delay=1e3*ti/tr,v.disposeOp=this.data[this.pos++],v.blendOp=this.data[this.pos++],v.data=[];break;case"IDAT":case"fdAT":for("fdAT"===te&&(this.pos+=4,Y-=4),g=(null!=v?v.data:void 0)||this.imgData,O=0;Y>=0?O<Y:O>Y;Y>=0?++O:--O)g.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(Y);var ta=255-this.transparency.indexed.length;if(ta>0)for(X=0;ta>=0?X<ta:X>ta;ta>=0?++X:--X)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(Y)[0];break;case 2:this.transparency.rgb=this.read(Y)}break;case"tEXt":var th=this.read(Y),tu=th.indexOf(0),tl=String.fromCharCode.apply(String,th.slice(0,tu));this.text[tl]=String.fromCharCode.apply(String,th.slice(tu+1));break;case"IEND":v&&this.animation.frames.push(v),this.colors=(function(){switch(S.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this);var tc=this.colorType;this.hasAlphaChannel=4===tc||6===tc;var t_=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*t_,this.colorSpace=(function(){switch(S.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(_instanceof(this.imgData,Uint8Array)||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=Y}if(this.pos+=4,this.pos>this.data.length)throw new Error(tt(6017))}}var g=t1.prototype;return g.read=function(g){var v=0,S=[];for(v=0;g>=0?v<g:v>g;g>=0?++v:--v)S.push(this.data[this.pos++]);return S},g.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},g.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},g.decodePixels=function(g){if(null==g&&(g=this.imgData),0===g.length)return new Uint8Array(0);g=new I$.Inflate(g,{index:0,verify:!1}).decompress();for(var v=this.pixelBitlength/8,S=v*this.width,O=new Uint8Array(S*this.height),X=g.length,Y=0,te=0,ti=0,tr=0,ta=0,th=0,tu=0,tl=0,tc=0,t_=0,tf=0,tp=0,tm=0,tg=0,tv=0,ty=0,tS=0,tA=0,tT=0;te<X;){switch(g[te++]){case 0:for(th=tu=0;tu<S;th=tu+=1)O[ti++]=g[te++];break;case 1:for(th=tl=0;tl<S;th=tl+=1)tr=g[te++],tp=th<v?0:O[ti-v],O[ti++]=(tr+tp)%256;break;case 2:for(th=tc=0;tc<S;th=tc+=1)tr=g[te++],ta=(th-th%v)/v,tA=Y&&O[(Y-1)*S+ta*v+th%v],O[ti++]=(tA+tr)%256;break;case 3:for(th=t_=0;t_<S;th=t_+=1)tr=g[te++],ta=(th-th%v)/v,tp=th<v?0:O[ti-v],tA=Y&&O[(Y-1)*S+ta*v+th%v],O[ti++]=(tr+Math.floor((tp+tA)/2))%256;break;case 4:for(th=tf=0;tf<S;th=tf+=1)tr=g[te++],ta=(th-th%v)/v,tp=th<v?0:O[ti-v],0===Y?tA=tT=0:(tA=O[(Y-1)*S+ta*v+th%v],tT=ta&&O[(Y-1)*S+(ta-1)*v+th%v]),tm=tp+tA-tT,tg=Math.abs(tm-tp),ty=Math.abs(tm-tA),tS=Math.abs(tm-tT),tv=tg<=ty&&tg<=tS?tp:ty<=tS?tA:tT,O[ti++]=(tr+tv)%256;break;default:throw new Error(tt(6018,g[te-1]))}Y++}return O},g.copyToImageData=function(g,v){var S,O=this.hasAlphaChannel,X=this.colors;this.palette.length&&(S=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),X=4,O=!0);var Y=g.data||g,te=Y.length,ti=S||v,tr=0,ta=0,th=0,tu=0;if(1===X)for(;tr<te;)th=S?4*v[tr/4]:ta,tu=ti[th++],Y[tr++]=tu,Y[tr++]=tu,Y[tr++]=tu,Y[tr++]=O?ti[th++]:255,ta=th;else for(;tr<te;)th=S?4*v[tr/4]:ta,Y[tr++]=ti[th++],Y[tr++]=ti[th++],Y[tr++]=ti[th++],Y[tr++]=O?ti[th++]:255,ta=th},g.decodePalette=function(){for(var g=this.palette,v=this.transparency.indexed||[],S=new Uint8Array((v.length||0)+g.length),O=0,X=0,Y=0,te=0,ti=0,tr=g.length;ti<tr;te=ti+=3)S[O++]=g[te],S[O++]=g[te+1],S[O++]=g[te+2],Y=v[X++],S[O++]=null!=Y?Y:255;return S},g.render=function(g){g.width=this.width,g.height=this.height;var v=g.getContext("2d"),S=v.createImageData(this.width,this.height);return this.copyToImageData(S,this.decodePixels(null)),v.putImageData(S,0,0)},t1}(),qE=function(){function t1(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var g=t1.prototype;return g.getUint8=function(g){return this._tiffData[g]},g.getUint16=function(g){return this._littleEndian?this._tiffData[g+1]<<8|this._tiffData[g]:this._tiffData[g]<<8|this._tiffData[g+1]},g.getUint32=function(g){var v=this._tiffData;return this._littleEndian?v[g+3]<<24|v[g+2]<<16|v[g+1]<<8|v[g]:v[g]<<24|v[g+1]<<16|v[g+2]<<8|v[g+3]},g.checkLittleEndian=function(){var g=this.getUint16(0);if(18761===g)this._littleEndian=!0;else{if(19789!==g)throw console.log(g),TypeError(tt(6019));this._littleEndian=!1}return this._littleEndian},g.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(tt(6020));return!0},g.getFieldTypeName=function(g){return g in qb?qb[g]:null},g.getFieldTagName=function(g){return g in qC?qC[g]:(j(6021,g),"Tag"+g)},g.getFieldTypeLength=function(g){return -1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(g)?1:-1!==["SHORT","SSHORT"].indexOf(g)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(g)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(g)?8:0},g.getFieldValues=function(g,v,S,O){var X=[],Y=this.getFieldTypeLength(v);if(Y*S<=4)!1===this._littleEndian?X.push(O>>>8*(4-Y)):X.push(O);else for(var te=0;te<S;te++){var ti=Y*te;Y>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(v)?(X.push(this.getUint32(O+ti)),X.push(this.getUint32(O+ti+4))):j(8e3):X.push(this.getBytes(Y,O+ti))}return"ASCII"===v&&X.forEach(function(g,v,S){S[v]=String.fromCharCode(g)}),X},g.getBytes=function(g,v){if(g<=0)j(8001);else{if(g<=1)return this.getUint8(v);if(g<=2)return this.getUint16(v);if(g<=3)return this.getUint32(v)>>>8;if(g<=4)return this.getUint32(v);j(8002)}return 0},g.getBits=function(g,v,S){S=S||0;var O=v+Math.floor(S/8),X=S+g,Y=32-g,te=0,ti=0;return X<=0?j(6023):X<=8?(te=24+S,ti=this.getUint8(O)):X<=16?(te=16+S,ti=this.getUint16(O)):X<=32?(te=S,ti=this.getUint32(O)):j(6022),{bits:ti<<te>>>Y,byteOffset:O+Math.floor(X/8),bitOffset:X%8}},g.parseFileDirectory=function(g){var v=this.getUint16(g),S=[],O=0,X=0;for(O=g+2,X=0;X<v;O+=12,X++){var Y=this.getUint16(O),te=this.getUint16(O+2),ti=this.getUint32(O+4),tr=this.getUint32(O+8),ta=this.getFieldTagName(Y),th=this.getFieldTypeName(te),tu=this.getFieldValues(ta,th,ti,tr);S[ta]={type:th,values:tu}}this._fileDirectories.push(S);var tl=this.getUint32(O);0!==tl&&this.parseFileDirectory(tl)},g.clampColorSample=function(g,v){var S=Math.pow(2,8-v);return Math.floor(g*S+(S-1))},g.parseTIFF=function(g,v){var S=this;if(v=v||te.document.createElement("canvas"),this._tiffData=g,this._canvas=v,this.checkLittleEndian(),this.hasTowel()){var O=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(O);var X=this._fileDirectories[0],Y=X.ImageWidth.values[0],ti=X.ImageLength.values[0];this._canvas.width=Y,this._canvas.height=ti;var tr=[],ta=X.Compression?X.Compression.values[0]:1,th=X.SamplesPerPixel.values[0],tu=[],tl=0,tc=!1;X.BitsPerSample.values.forEach(function(g,v){tu[v]={bitsPerSample:g,hasBytesPerSample:!1,bytesPerSample:void 0},g%8==0&&(tu[v].hasBytesPerSample=!0,tu[v].bytesPerSample=g/8),tl+=g},this);var t_=0;tl%8==0&&(tc=!0,t_=tl/8);var tf,tp=X.StripOffsets.values,tm=tp.length;if(X.StripByteCounts)tf=X.StripByteCounts.values;else{if(j(8003),1!==tm)throw Error(tt(6024));tf=[Math.ceil(Y*ti*tl/8)]}for(var tg=1,tv=1,ty=0;ty<tm;ty++){var tS=tp[ty];tr[ty]=[];for(var tA=tf[ty],tT=0,tE=0,tC=1,tx=!0,tb=[],tw=0,tI=0,tB=0;tT<tA;tT+=tC)switch(ta){case 1:tb=[];for(var tP=0;tP<th;tP++){var tD=tu[tP];if(!tD.hasBytesPerSample){var tM=this.getBits(tD.bitsPerSample,tS+tT,tE);throw tb.push(tM.bits),tT=tM.byteOffset-tS,tE=tM.bitOffset,RangeError(tt(6025))}var tO=tD.bytesPerSample*tP;tb.push(this.getBytes(tD.bytesPerSample,tS+tT+tO))}if(tr[ty].push(tb),!tc)throw tC=0,RangeError(tt(6026));tC=t_;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(tx){tx=!1;var tk=this.getUint8(tS+tT);tk>=0&&tk<=127?tg=tk+1:tk>=-127&&tk<=-1?tv=1-tk:tx=!0}else{for(var tG=this.getUint8(tS+tT),tV=0;tV<tv;tV++){var tU=tu[tI];if(!tU.hasBytesPerSample)throw RangeError(tt(6025));tB=tB<<8*tw|tG,++tw===tU.bytesPerSample&&(tb.push(tB),tB=tw=0,tI++),tI===th&&(tr[ty].push(tb),tb=[],tI=0)}0==--tg&&(tx=!0)}tC=1}}if(v.getContext){var tH=this._canvas.getContext("2d");tH.fillStyle="rgba(255, 255, 255, 0)";var tz=X.RowsPerStrip?X.RowsPerStrip.values[0]:ti,tW=tr.length,tj=ti%tz,tq=0===tj?tz:tj,tK=tz,tZ=0,tQ=X.PhotometricInterpretation.values[0],t$=[],t0=0;X.ExtraSamples&&(t$=X.ExtraSamples.values,t0=t$.length);var t2=[],t3=0;X.ColorMap&&(t2=X.ColorMap.values,t3=Math.pow(2,tu[0].bitsPerSample));for(var t4=0;t4<tW;t4++){t4+1===tW&&(tK=tq);for(var t8=tr[t4].length,t6=tZ*t4,t7=0,t9=0;t7<tK&&t9<t8;t7++)for(var rt=function(){var g=tr[t4][t9],v=0,O=0,X=0,Y=1;if(t0>0){for(var te=0;te<t0;te++)if(1===t$[te]||2===t$[te]){Y=g[3+te]/256;break}}switch(tQ){case 0:var ti=0;tu[0].hasBytesPerSample&&(ti=Math.pow(16,2*tu[0].bytesPerSample)),g.forEach(function(g,v,S){S[v]=ti-g});case 1:v=O=X=S.clampColorSample(g[0],tu[0].bitsPerSample);break;case 2:v=S.clampColorSample(g[0],tu[0].bitsPerSample),O=S.clampColorSample(g[1],tu[1].bitsPerSample),X=S.clampColorSample(g[2],tu[2].bitsPerSample);break;case 3:if(void 0===t2)throw Error(tt(6027));var ta=g[0];v=S.clampColorSample(t2[ta],16),O=S.clampColorSample(t2[t3+ta],16),X=S.clampColorSample(t2[2*t3+ta],16);break;default:throw RangeError(tt(6028,tQ))}tH.fillStyle="rgba("+v+", "+O+", "+X+", "+Y+")",tH.fillRect(ee,t6+t7,1,1)},ee=0;ee<Y;ee++,t9++)rt();tZ=tK}}return this._canvas}},t1}(),qC={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},qb={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},qR=new Array(123),qw=0;qw<123;++qw)qR[qw]=64;for(var qI=0;qI<64;++qI)qR["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(qI)]=qI;var qB={name:"Jacob__Codec__Base64",decode:function(g){var v,S,O,X,Y,te,ti=[],tr=0;for(g=g.replace(/[^A-Za-z0-9\+\/\=]/g,"");tr<g.length;)v=qR[g.charCodeAt(tr++)]<<2|(X=qR[g.charCodeAt(tr++)])>>4,S=(15&X)<<4|(Y=qR[g.charCodeAt(tr++)])>>2,O=(3&Y)<<6|(te=qR[g.charCodeAt(tr++)]),ti.push(String.fromCharCode(v)),64!==Y&&ti.push(String.fromCharCode(S)),64!==te&&ti.push(String.fromCharCode(O));return ti.join("")},decodeAsArray:function(g,v){var S,O,X,Y=this.decode(g),te=[];for(S=0,X=Y.length/v;S<X;S++)for(te[S]=0,O=v-1;O>=0;--O)te[S]+=Y.charCodeAt(S*v+O)<<8*O;return te}},a2=function(g){this.data=g,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(a2.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};a2.gunzip=function(g){return g.constructor===Array||g.constructor,new a2(g).gunzip()[0][0]},a2.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},a2.LITERALS=288,a2.NAMEMAX=256,a2.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],a2.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a2.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],a2.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],a2.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],a2.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],a2.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},a2.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},a2.prototype.byteAlign=function(){this.bb=1},a2.prototype.readBit=function(){var g;return this.bits++,g=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),g=1&this.bb,this.bb=this.bb>>1|128),g},a2.prototype.readBits=function(g){for(var v=0,S=g;S--;)v=v<<1|this.readBit();return g&&(v=a2.bitReverse[v]>>8-g),v},a2.prototype.flushBuffer=function(){this.bIdx=0},a2.prototype.addBuffer=function(g){this.buf32k[this.bIdx++]=g,this.outputArr.push(String.fromCharCode(g)),32768===this.bIdx&&(this.bIdx=0)},a2.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return -1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},a2.prototype.Rec=function(){var g,v=this.Places[this.treepos];if(17===this.len)return -1;if(this.treepos++,this.len++,(g=this.IsPat())>=0)v.b0=g;else if(v.b0=32768,this.Rec())return -1;if((g=this.IsPat())>=0)v.b1=g,v.jump=null;else if(v.b1=32768,v.jump=this.Places[this.treepos],v.jumppos=this.treepos,this.Rec())return -1;return this.len--,0},a2.prototype.CreateTree=function(g,v,S){var O;for(this.Places=g,this.treepos=0,this.flens=S,this.fmax=v,O=0;O<17;O++)this.fpos[O]=0;return this.len=0,this.Rec()?-1:0},a2.prototype.DecodeValue=function(g){for(var v,S,O=0,X=g[O];;)if(this.readBit()){if(!(32768&X.b1))return X.b1;for(X=X.jump,v=g.length,S=0;S<v;S++)if(g[S]===X){O=S;break}}else{if(!(32768&X.b0))return X.b0;X=g[++O]}return -1},a2.prototype.DeflateLoop=function(){var g,v,S;do{var O,X;if(g=this.readBit(),0===(v=this.readBits(2)))for(this.byteAlign(),O=this.readByte(),O|=this.readByte()<<8,X=this.readByte(),65535&(O^~(X|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");O--;)Y=this.readByte(),this.addBuffer(Y);else if(1===v)for(;;)if((te=a2.bitReverse[this.readBits(7)]>>1)>23?(te=te<<1|this.readBit())>199?te=(te-=128)<<1|this.readBit():(te-=48)>143&&(te+=136):te+=256,te<256)this.addBuffer(te);else{if(256===te)break;for(te-=257,t_=this.readBits(a2.cplext[te])+a2.cplens[te],te=a2.bitReverse[this.readBits(5)]>>3,a2.cpdext[te]>8?(tf=this.readBits(8),tf|=this.readBits(a2.cpdext[te]-8)<<8):tf=this.readBits(a2.cpdext[te]),tf+=a2.cpdist[te],te=0;te<t_;te++){var Y=this.buf32k[this.bIdx-tf&32767];this.addBuffer(Y)}}else if(2===v){var te,ti,tr,ta,th,tu=new Array(320);for(tr=257+this.readBits(5),ta=1+this.readBits(5),th=4+this.readBits(4),te=0;te<19;te++)tu[te]=0;for(te=0;te<th;te++)tu[a2.border[te]]=this.readBits(3);for(t_=this.distanceTree.length,S=0;S<t_;S++)this.distanceTree[S]=new a2.HufNode;if(this.CreateTree(this.distanceTree,19,tu,0))return this.flushBuffer(),1;for(ti=tr+ta,S=0;S<ti;)if((te=this.DecodeValue(this.distanceTree))<16)tu[S++]=te;else if(16===te){var tl;if(S+(te=3+this.readBits(2))>ti)return this.flushBuffer(),1;for(tl=S?tu[S-1]:0;te--;)tu[S++]=tl}else{if(S+(te=17===te?3+this.readBits(3):11+this.readBits(7))>ti)return this.flushBuffer(),1;for(;te--;)tu[S++]=0}for(t_=this.literalTree.length,S=0;S<t_;S++)this.literalTree[S]=new a2.HufNode;if(this.CreateTree(this.literalTree,tr,tu,0))return this.flushBuffer(),1;for(t_=this.literalTree.length,S=0;S<t_;S++)this.distanceTree[S]=new a2.HufNode;var tc=new Array;for(S=tr;S<tu.length;S++)tc[S-tr]=tu[S];if(this.CreateTree(this.distanceTree,ta,tc,0))return this.flushBuffer(),1;for(;;)if((te=this.DecodeValue(this.literalTree))>=256){var t_,tf;if(0==(te-=256))break;for(te--,t_=this.readBits(a2.cplext[te])+a2.cplens[te],te=this.DecodeValue(this.distanceTree),a2.cpdext[te]>8?(tf=this.readBits(8),tf|=this.readBits(a2.cpdext[te]-8)<<8):tf=this.readBits(a2.cpdext[te]),tf+=a2.cpdist[te];t_--;)Y=this.buf32k[this.bIdx-tf&32767],this.addBuffer(Y)}else this.addBuffer(te)}}while(!g);return this.flushBuffer(),this.byteAlign(),0},a2.prototype.unzipFile=function(g){var v;for(this.gunzip(),v=0;v<this.unzipped.length;v++)if(this.unzipped[v][1]===g)return this.unzipped[v][0]},a2.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var g=[];if(g[0]=this.readByte(),g[1]=this.readByte(),120===g[0]&&218===g[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===g[0]&&139===g[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===g[0]&&75===g[1]&&(this.modeZIP=!0,g[2]=this.readByte(),g[3]=this.readByte(),3===g[2]&&4===g[3])){g[0]=this.readByte(),g[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var v=this.readByte();v|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var S=this.readByte();S|=this.readByte()<<8;var O=this.readByte();for(O|=this.readByte()<<8,Y=0,this.nameBuf=[];S--;){var X=this.readByte();"/"===X|":"===X?Y=0:Y<a2.NAMEMAX-1&&(this.nameBuf[Y++]=String.fromCharCode(X))}this.fileout||(this.fileout=this.nameBuf);for(var Y=0;Y<O;)X=this.readByte(),Y++;8===v&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},a2.prototype.skipdir=function(){var g,v,S=[];if(8&this.gpflags&&(S[0]=this.readByte(),S[1]=this.readByte(),S[2]=this.readByte(),S[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),S[0]=this.readByte(),8!==S[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(S[0]=this.readByte(),S[2]=this.readByte(),this.len=S[0]+256*S[1],g=0;g<this.len;g++)this.readByte();if(8&this.gpflags)for(g=0,this.nameBuf=[];v=this.readByte();)"7"!==v&&":"!==v||(g=0),g<a2.NAMEMAX-1&&(this.nameBuf[g++]=v);if(16&this.gpflags)for(;v=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var qP,qD,qM,qO,qL,qk,qG,qV,qU,qH,qz,qX,qj,qq,qY,qK,qJ,qZ,q1,q2,q3,q5,q4,q8,q6,q7,q9,Yt,Ye,Yn,Yo,Yh,Yu,Yl,Yc,Y_,Yf,Yp,Yy,YS,YA,YT,YE,YC,Yb,YR,Yw,YI,YP,YD,YO,YL,YN,Yk={name:"Jacob__Codec"};function o3(g){var v=g.parent,S=g.getComponent(YZ);return v&&S?o3(v):g.getComponentsInChildren(YZ)}Yk.Base64=qB,Yk.GZip=a2,Yk.unzip=function(){return Yk.GZip.gunzip.apply(Yk.GZip,arguments)},Yk.unzipBase64=function(){var g=Yk.Base64.decode.apply(Yk.Base64,arguments);try{return Yk.GZip.gunzip.call(Yk.GZip,g)}catch(v){return g.slice(7)}},Yk.unzipBase64AsArray=function(g,v){v=v||1;var S,O,X,Y=this.unzipBase64(g),te=[];for(S=0,X=Y.length/v;S<X;S++)for(te[S]=0,O=v-1;O>=0;--O)te[S]+=Y.charCodeAt(S*v+O)<<8*O;return te},Yk.unzipAsArray=function(g,v){v=v||1;var S,O,X,Y=this.unzip(g),te=[];for(S=0,X=Y.length/v;S<X;S++)for(te[S]=0,O=v-1;O>=0;--O)te[S]+=Y.charCodeAt(S*v+O)<<8*O;return te},function(g){g[g.JPG=0]="JPG",g[g.PNG=1]="PNG",g[g.TIFF=2]="TIFF",g[g.WEBP=3]="WEBP",g[g.PVR=4]="PVR",g[g.ETC=5]="ETC",g[g.S3TC=6]="S3TC",g[g.ATITC=7]="ATITC",g[g.TGA=8]="TGA",g[g.RAWDATA=9]="RAWDATA",g[g.UNKNOWN=10]="UNKNOWN"}(YN||(YN={}));var YG,YV,YU,YH,Yz,YX,Yj,Yq,YY,YK,YJ,YZ=g("es",(qP=nJ("cc.ParticleSystem2D"),qD=ma(qA),qM=ma(Bf),qO=ma(qo),qL=ma(qn),qk=Ys("preview"),qP(((YL=function(g){function e(){var v;return(v=g.call(this)||this).duration=qU&&qU(),v.emissionRate=qH&&qH(),v.life=qz&&qz(),v.lifeVar=qX&&qX(),v.angle=qj&&qj(),v.angleVar=qq&&qq(),v.startSize=qY&&qY(),v.startSizeVar=qK&&qK(),v.endSize=qJ&&qJ(),v.endSizeVar=qZ&&qZ(),v.startSpin=q1&&q1(),v.startSpinVar=q2&&q2(),v.endSpin=q3&&q3(),v.endSpinVar=q5&&q5(),v.sourcePos=q4&&q4(),v.posVar=q8&&q8(),v.emitterMode=q6&&q6(),v.gravity=q7&&q7(),v.speed=q9&&q9(),v.speedVar=Yt&&Yt(),v.tangentialAccel=Ye&&Ye(),v.tangentialAccelVar=Yn&&Yn(),v.radialAccel=Yo&&Yo(),v.radialAccelVar=Yh&&Yh(),v.rotationIsDir=Yu&&Yu(),v.startRadius=Yl&&Yl(),v.startRadiusVar=Yc&&Yc(),v.endRadius=Y_&&Y_(),v.endRadiusVar=Yf&&Yf(),v.rotatePerS=Yp&&Yp(),v.rotatePerSVar=Yy&&Yy(),v.aspectRatio=1,v.playOnLoad=YS&&YS(),v.autoRemoveOnFinish=YA&&YA(),v._preview=YT&&YT(),v._custom=YE&&YE(),v._file=YC&&YC(),v._spriteFrame=Yb&&Yb(),v._totalParticles=YR&&YR(),v._startColor=Yw&&Yw(),v._startColorVar=YI&&YI(),v._endColor=YP&&YP(),v._endColorVar=YD&&YD(),v._positionType=YO&&YO(),v._stopped=!0,v._useFile=void 0,v.initProperties(),v._useFile=!1,v}s(e,g);var v=e.prototype;return v.onEnable=function(){g.prototype.onEnable.call(this),this._updateMaterial(),this._updatePositionType()},v.onDestroy=function(){g.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0,this._simulator.renderData&&this._assembler&&this._assembler.removeData(this._simulator.renderData)},v.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new qy(this)},v.onFocusInEditor=function(){this._focused=!0;for(var g=o3(this.node),v=0;v<g.length;++v)g[v]._startPreview()},v.onLostFocusInEditor=function(){this._focused=!1;for(var g=o3(this.node),v=0;v<g.length;++v)g[v]._stopPreview()},v._startPreview=function(){this._preview&&this.resetSystem()},v._stopPreview=function(){this._preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},v.__preload=function(){g.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?this._getTexture()||this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},v._flushAssembler=function(){var g=e.Assembler.getAssembler(this);this._assembler!==g&&(this._assembler=g),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this),this._simulator.renderData.particleInitRenderDrawInfo(this.renderEntity),this._simulator.initDrawInfo())},v.lateUpdate=function(g){this._simulator.finished||this._simulator.step(g)},v.addParticle=function(){},v.stopSystem=function(){this._stopped=!0,this._simulator.stop()},v.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this.markForUpdateRenderData()},v.isFull=function(){return this.particleCount>=this.totalParticles},v._applyFile=function(){var g=this._file;if(g){if(!g)return void J(6029);if(!this.isValid)return;this._plistFile=g.nativeUrl,this._custom||(this._spriteFrame!==g.spriteFrame&&(this.spriteFrame=g.spriteFrame),this._initWithDictionary(g._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():g.spriteFrame?this.spriteFrame=g.spriteFrame:this._custom&&this._initTextureWithDictionary(g._nativeAsset)}},v._initTextureWithDictionary=function(g){var v,S=this;if(g.spriteFrameUuid){var O=g.spriteFrameUuid;dO.loadAny(O,function(v,O){v?(g.spriteFrameUuid=void 0,S._initTextureWithDictionary(g),k(v)):S.spriteFrame=O})}else{var X=ku(this._plistFile,g.textureFileName||"");if(g.textureFileName)dO.loadRemote(X,function(v,O){v?(g.textureFileName=void 0,S._initTextureWithDictionary(g),k(v)):S.spriteFrame=O?Bf.createWithImage(O):Bf.createWithImage(dU.get("white-texture"))});else if(g.textureImageData){var Y=g.textureImageData;if(!(Y&&Y.length>0))return!1;var ti=X;this.file&&(ti+="-"+this.file.uuid);var tr=dO.assets.get(ti);if(!tr){var ta=Yk.unzipBase64AsArray(Y,1);if(!ta)return q(6030,this._file.name),!1;var th=(v=ta).length>8&&137===v[0]&&80===v[1]&&78===v[2]&&71===v[3]&&13===v[4]&&10===v[5]&&26===v[6]&&10===v[7]?YN.PNG:v.length>2&&(73===v[0]&&73===v[1]||77===v[0]&&77===v[1]||255===v[0]&&216===v[1])?YN.TIFF:YN.UNKNOWN;if(th!==YN.TIFF&&th!==YN.PNG)return q(6031,this._file.name),!1;var tu=te.document.createElement("canvas");th===YN.PNG?new qT(ta).render(tu):(this._tiffReader||(this._tiffReader=new qE),this._tiffReader.parseTIFF(ta,tu)),tr=new lX(tu),dO.assets.add(ti,tr)}tr||q(6032,this._file.name),this.spriteFrame=tr?Bf.createWithImage(tr):Bf.createWithImage(dU.get("white-texture"))}}return!0},v._initWithDictionary=function(g){this._useFile=!0,this.totalParticles=parseInt(g.maxParticles||0),this.life=parseFloat(g.particleLifespan||0),this.lifeVar=parseFloat(g.particleLifespanVariance||0);var v=g.emissionRate;this.emissionRate=v||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(g.duration||0),this._srcBlendFactor=parseInt(g.blendFuncSource||ok.SRC_ALPHA),this._dstBlendFactor=parseInt(g.blendFuncDestination||ok.ONE_MINUS_SRC_ALPHA);var S=this._startColor;S.r=255*parseFloat(g.startColorRed||0),S.g=255*parseFloat(g.startColorGreen||0),S.b=255*parseFloat(g.startColorBlue||0),S.a=255*parseFloat(g.startColorAlpha||0);var O=this._startColorVar;O.r=255*parseFloat(g.startColorVarianceRed||0),O.g=255*parseFloat(g.startColorVarianceGreen||0),O.b=255*parseFloat(g.startColorVarianceBlue||0),O.a=255*parseFloat(g.startColorVarianceAlpha||0);var X=this._endColor;X.r=255*parseFloat(g.finishColorRed||0),X.g=255*parseFloat(g.finishColorGreen||0),X.b=255*parseFloat(g.finishColorBlue||0),X.a=255*parseFloat(g.finishColorAlpha||0);var Y=this._endColorVar;if(Y.r=255*parseFloat(g.finishColorVarianceRed||0),Y.g=255*parseFloat(g.finishColorVarianceGreen||0),Y.b=255*parseFloat(g.finishColorVarianceBlue||0),Y.a=255*parseFloat(g.finishColorVarianceAlpha||0),this.startSize=parseFloat(g.startParticleSize||0),this.startSizeVar=parseFloat(g.startParticleSizeVariance||0),this.endSize=parseFloat(g.finishParticleSize||0),this.endSizeVar=parseFloat(g.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==g.positionType?g.positionType:qo.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(g.sourcePositionVariancex||0),parseFloat(g.sourcePositionVariancey||0)),this.angle=parseFloat(g.angle||0),this.angleVar=parseFloat(g.angleVariance||0),this.startSpin=parseFloat(g.rotationStart||0),this.startSpinVar=parseFloat(g.rotationStartVariance||0),this.endSpin=parseFloat(g.rotationEnd||0),this.endSpinVar=parseFloat(g.rotationEndVariance||0),this.emitterMode=parseInt(g.emitterType||qn.GRAVITY),this.emitterMode===qn.GRAVITY){this.gravity.set(parseFloat(g.gravityx||0),parseFloat(g.gravityy||0)),this.speed=parseFloat(g.speed||0),this.speedVar=parseFloat(g.speedVariance||0),this.radialAccel=parseFloat(g.radialAcceleration||0),this.radialAccelVar=parseFloat(g.radialAccelVariance||0),this.tangentialAccel=parseFloat(g.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(g.tangentialAccelVariance||0);var te=g.rotationIsDir||"";null!==te?(te=te.toString().toLowerCase(),this.rotationIsDir="true"===te||"1"===te):this.rotationIsDir=!1}else{if(this.emitterMode!==qn.RADIUS)return q(6009),!1;this.startRadius=parseFloat(g.maxRadius||0),this.startRadiusVar=parseFloat(g.maxRadiusVariance||0),this.endRadius=parseFloat(g.minRadius||0),this.endRadiusVar=parseFloat(g.minRadiusVariance||0),this.rotatePerS=parseFloat(g.rotatePerSecond||0),this.rotatePerSVar=parseFloat(g.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(g),!0},v._syncAspect=function(){if(this._renderSpriteFrame){var g=this._renderSpriteFrame.rect;this.aspectRatio=g.width/g.height}},v._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator&&this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this.markForUpdateRenderData()):this.resetSystem()},v._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},v._updateMaterial=function(){if(this._customMaterial){this.setSharedMaterial(this._customMaterial,0);var g=this.getRenderMaterial(0).passes[0].blendState.targets[0];this._dstBlendFactor=g.blendDst,this._srcBlendFactor=g.blendSrc}var v=this.getMaterialInstance(0);v&&v.recompileShaders({USE_LOCAL:this._positionType!==qo.FREE}),v&&v.passes.length>0&&this._updateBlendFunc()},v._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this.markForUpdateRenderData(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},v._canRender=function(){return g.prototype._canRender.call(this)&&!this._stopped&&null!==this._renderSpriteFrame&&void 0!==this._renderSpriteFrame},v._render=function(g){this._positionType===qo.RELATIVE?g.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===qo.GROUPED?g.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):g.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)},v._updatePositionType=function(){this._positionType===qo.RELATIVE?(this._renderEntity.setRenderTransform(this.node.parent),this._renderEntity.setUseLocal(!0)):this.positionType===qo.GROUPED?(this._renderEntity.setRenderTransform(this.node),this._renderEntity.setUseLocal(!0)):(this._renderEntity.setRenderTransform(null),this._renderEntity.setUseLocal(!1))},n(e,[{key:"custom",get:function(){return this._custom},set:function(g){this._custom!==g&&(this._custom=g,this._applyFile(),this._updateMaterial())}},{key:"file",get:function(){return this._file},set:function(g){this._file!==g&&(this._file=g,g?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(g){this._renderSpriteFrame!==g&&(this._renderSpriteFrame=g,g&&!g._uuid||(this._spriteFrame=g),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(g){this._totalParticles!==g&&(this._totalParticles=g)}},{key:"startColor",get:function(){return this._startColor},set:function(g){this._startColor.r=g.r,this._startColor.g=g.g,this._startColor.b=g.b,this._startColor.a=g.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(g){this._startColorVar.r=g.r,this._startColorVar.g=g.g,this._startColorVar.b=g.b,this._startColorVar.a=g.a}},{key:"color",get:function(){return this._color},set:function(){}},{key:"endColor",get:function(){return this._endColor},set:function(g){this._endColor.r=g.r,this._endColor.g=g.g,this._endColor.b=g.b,this._endColor.a=g.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(g){this._endColorVar.r=g.r,this._endColorVar.g=g.g,this._endColorVar.b=g.b,this._endColorVar.a=g.a}},{key:"positionType",get:function(){return this._positionType},set:function(g){this._positionType=g,this._updateMaterial(),this._updatePositionType()}},{key:"preview",get:function(){return this._preview},set:function(g){g?this._startPreview():this._stopPreview(),this._preview=g}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),e}(Dg)).EmitterMode=qn,YL.PositionType=qo,YL.DURATION_INFINITY=-1,YL.START_SIZE_EQUAL_TO_END_SIZE=-1,YL.START_RADIUS_EQUAL_TO_END_RADIUS=-1,p((qV=YL).prototype,"file",[qD],Object.getOwnPropertyDescriptor(qV.prototype,"file"),qV.prototype),p(qV.prototype,"spriteFrame",[qM],Object.getOwnPropertyDescriptor(qV.prototype,"spriteFrame"),qV.prototype),qU=ws(qV.prototype,"duration",[n2],function(){return -1}),qH=ws(qV.prototype,"emissionRate",[n2],function(){return 10}),qz=ws(qV.prototype,"life",[n2],function(){return 1}),qX=ws(qV.prototype,"lifeVar",[n2],function(){return 0}),p(qV.prototype,"color",[rE],Object.getOwnPropertyDescriptor(qV.prototype,"color"),qV.prototype),qj=ws(qV.prototype,"angle",[n2],function(){return 90}),qq=ws(qV.prototype,"angleVar",[n2],function(){return 20}),qY=ws(qV.prototype,"startSize",[n2],function(){return 50}),qK=ws(qV.prototype,"startSizeVar",[n2],function(){return 0}),qJ=ws(qV.prototype,"endSize",[n2],function(){return 0}),qZ=ws(qV.prototype,"endSizeVar",[n2],function(){return 0}),q1=ws(qV.prototype,"startSpin",[n2],function(){return 0}),q2=ws(qV.prototype,"startSpinVar",[n2],function(){return 0}),q3=ws(qV.prototype,"endSpin",[n2],function(){return 0}),q5=ws(qV.prototype,"endSpinVar",[n2],function(){return 0}),q4=ws(qV.prototype,"sourcePos",[n2],function(){return e8.ZERO.clone()}),q8=ws(qV.prototype,"posVar",[n2],function(){return e8.ZERO.clone()}),p(qV.prototype,"positionType",[qO],Object.getOwnPropertyDescriptor(qV.prototype,"positionType"),qV.prototype),q6=ws(qV.prototype,"emitterMode",[n2,qL],function(){return qn.GRAVITY}),q7=ws(qV.prototype,"gravity",[n2],function(){return e8.ZERO.clone()}),q9=ws(qV.prototype,"speed",[n2],function(){return 180}),Yt=ws(qV.prototype,"speedVar",[n2],function(){return 50}),Ye=ws(qV.prototype,"tangentialAccel",[n2],function(){return 80}),Yn=ws(qV.prototype,"tangentialAccelVar",[n2],function(){return 0}),Yo=ws(qV.prototype,"radialAccel",[n2],function(){return 0}),Yh=ws(qV.prototype,"radialAccelVar",[n2],function(){return 0}),Yu=ws(qV.prototype,"rotationIsDir",[n2],function(){return!1}),Yl=ws(qV.prototype,"startRadius",[n2],function(){return 0}),Yc=ws(qV.prototype,"startRadiusVar",[n2],function(){return 0}),Y_=ws(qV.prototype,"endRadius",[n2],function(){return 0}),Yf=ws(qV.prototype,"endRadiusVar",[n2],function(){return 0}),Yp=ws(qV.prototype,"rotatePerS",[n2],function(){return 0}),Yy=ws(qV.prototype,"rotatePerSVar",[n2],function(){return 0}),YS=ws(qV.prototype,"playOnLoad",[n2],function(){return!0}),YA=ws(qV.prototype,"autoRemoveOnFinish",[n2],function(){return!1}),YT=ws(qV.prototype,"_preview",[qk],function(){return!0}),YE=ws(qV.prototype,"_custom",[n2],function(){return!1}),YC=ws(qV.prototype,"_file",[n2],function(){return null}),Yb=ws(qV.prototype,"_spriteFrame",[n2],function(){return null}),YR=ws(qV.prototype,"_totalParticles",[n2],function(){return 150}),Yw=ws(qV.prototype,"_startColor",[n2],function(){return new is(255,255,255,255)}),YI=ws(qV.prototype,"_startColorVar",[n2],function(){return new is(0,0,0,0)}),YP=ws(qV.prototype,"_endColor",[n2],function(){return new is(255,255,255,0)}),YD=ws(qV.prototype,"_endColorVar",[n2],function(){return new is(0,0,0,0)}),YO=ws(qV.prototype,"_positionType",[n2],function(){return qo.FREE}),qG=qV))||qG)),Y0=function(){function t1(g,v){this.point=new e8,this.dir=new e8,this.distance=0,this.time=0,g&&this.point.set(g),v&&this.dir.set(v)}var g=t1.prototype;return g.setPoint=function(g,v){this.point.x=g,this.point.y=v},g.setDir=function(g,v){this.dir.x=g,this.dir.y=v},t1}(),Y2=g("et",(YG=nJ("cc.MotionStreak"),YV=ma(cK),YG(((YJ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._preview=Yz&&Yz(),v._fadeTime=YX&&YX(),v._minSeg=Yj&&Yj(),v._stroke=Yq&&Yq(),v._texture=YY&&YY(),v._fastMode=YK&&YK(),v._points=[],v}s(e,g);var v=e.prototype;return v.onEnable=function(){g.prototype.onEnable.call(this),this.reset()},v._flushAssembler=function(){var g=e.Assembler.getAssembler(this);this._assembler!==g&&(this._assembler=g),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material,this._updateColor())},v.onFocusInEditor=function(){this._preview&&this.reset()},v.onLostFocusInEditor=function(){this._preview&&this.reset()},v.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},v.lateUpdate=function(g){this._assembler&&this._assembler.update(this,g)},v._render=function(g){g.commitComp(this,this._renderData,this._texture,this._assembler,null)},n(e,[{key:"preview",get:function(){return this._preview},set:function(g){this._preview=g,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(g){this._fadeTime=g,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(g){this._minSeg=g}},{key:"stroke",get:function(){return this._stroke},set:function(g){this._stroke=g}},{key:"texture",get:function(){return this._texture},set:function(g){this._texture!==g&&(this._texture=g)}},{key:"fastMode",get:function(){return this._fastMode},set:function(g){this._fastMode=g}},{key:"points",get:function(){return this._points}}]),e}(Dg)).Point=Y0,p((YH=YJ).prototype,"texture",[YV],Object.getOwnPropertyDescriptor(YH.prototype,"texture"),YH.prototype),Yz=ws(YH.prototype,"_preview",[n2],function(){return!1}),YX=ws(YH.prototype,"_fadeTime",[n2],function(){return 1}),Yj=ws(YH.prototype,"_minSeg",[n2],function(){return 1}),Yq=ws(YH.prototype,"_stroke",[n2],function(){return 64}),YY=ws(YH.prototype,"_texture",[n2],function(){return null}),YK=ws(YH.prototype,"_fastMode",[n2],function(){return!1}),YU=YH))||YU));new e8;var Y3,Y5=new e8,Y4=new e8;function b3(g,v){return g.x=-v.y,g.y=v.x,g}var Y8={createData:function(g){var v=g.requestRenderData();return v.dataLength=4,v.resize(16,42),v},update:function(g,v){var S,O=g.stroke/2,X=g.node.worldMatrix,Y=X.m12,te=X.m13,ti=g.points;if(ti.length>1){var tr=ti[0],ta=tr.point.x-Y,th=tr.point.y-te;ta*ta+th*th<g.minSeg&&(S=tr)}S||(S=new Y2.Point,ti.unshift(S)),S.setPoint(Y,te),S.time=g.fadeTime+v;var tu,tl=0;if(!(ti.length<2)){var tc=g.renderData;this.updateRenderDataCache(g,tc);var t_=g.color,tf=t_.r,tp=t_.g,tm=t_.b,tg=t_.a,tv=ti[1];tv.distance=e8.subtract(Y4,S.point,tv.point).length(),Y4.normalize(),tv.setDir(Y4.x,Y4.y),S.setDir(Y4.x,Y4.y),tc.dataLength=2*ti.length;for(var ty=tc.data,tS=g.fadeTime,tA=!1,tT=ti.length-1;tT>=0;tT--){var tE=ti[tT],tC=tE.point,tx=tE.dir;if(tE.time-=v,tE.time<0)ti.splice(tT,1);else{var tb=tE.time/tS,tw=ti[tT-1];if(!tA){if(!tw){ti.splice(tT,1);continue}tC.x=tw.point.x-tx.x*tb,tC.y=tw.point.y-tx.y*tb}tA=!0,b3(Y5,tx);var tI=(tb*tg<<24>>>0)+(tm<<16)+(tp<<8)+tf,tB=tl;ty[tB].x=tC.x+Y5.x*O,ty[tB].y=tC.y+Y5.y*O,ty[tB].u=1,ty[tB].v=tb,ty[tB].color._val=tI,ty[tB+=1].x=tC.x-Y5.x*O,ty[tB].y=tC.y-Y5.y*O,ty[tB].u=0,ty[tB].v=tb,ty[tB].color._val=tI,tl+=2}}tu=tl<=2?0:3*(tl-2),tc.resize(tl,tu)}},updateWorldVertexAllData:function(g){for(var v=g.renderData,S=v.floatStride,O=v.data,X=v.chunk.vb,Y=0;Y<O.length;Y++){var te=Y*S;X[te+0]=O[Y].x,X[te+1]=O[Y].y,X[te+2]=O[Y].z,X[te+3]=O[Y].u,X[te+4]=O[Y].v,is.toArray(X,O[Y].color,te+5)}},createQuadIndices:function(g,v){var S=g.renderData.chunk.meshBuffer.indexOffset;Y3=null,Y3=new Uint16Array(v);for(var O=0,X=v;O<X;O+=2){var Y=0+O;Y3[S++]=Y,Y3[S++]=Y+2,Y3[S++]=Y+1,Y3[S++]=Y+1,Y3[S++]=Y+2,Y3[S++]=Y+3}},updateRenderDataCache:function(g,v){v.passDirty&&v.updatePass(g),v.nodeDirty&&v.updateNode(g),v.textureDirty&&g.texture&&(v.updateTexture(g.texture),v.material=g.getRenderMaterial(0)),v.hashDirty&&v.updateHash()},updateRenderData:function(){},updateColor:function(){},fillBuffers:function(g){for(var v=g.renderData,S=v.chunk,O=v.data,X=v.vertexCount,Y=v.indexCount,te=S.vb,ti=0,tr=0;tr<X;tr++){var ta=O[tr];te[ti++]=ta.x,te[ti++]=ta.y,te[ti++]=ta.z,te[ti++]=ta.u,te[ti++]=ta.v,is.toArray(te,ta.color,ti),ti+=4}S.bufferId;for(var th=S.vertexOffset,tu=S.meshBuffer,tl=S.meshBuffer.iData,tc=tu.indexOffset,t_=0,tf=Y;t_<tf;t_+=2){var tp=th+t_;tl[tc++]=tp,tl[tc++]=tp+2,tl[tc++]=tp+1,tl[tc++]=tp+1,tl[tc++]=tp+2,tl[tc++]=tp+3}tu.indexOffset+=v.indexCount,tu.setDirty()}},Y6=g("eu",{getAssembler:function(){return Y8}});Y2.Assembler=Y6;var Y7,Y9,Ki,Kn,Kr,Ko={maxParticleDeltaTime:0,createData:function(){return Pj.add()},removeData:function(g){Pj.remove(g)},updateRenderData:function(){},fillBuffers:function(){}},Kh=g("ev",{getAssembler:function(){return Ko.maxParticleDeltaTime||(Ko.maxParticleDeltaTime=X.game.frameTime/1e3*2),Ko}});YZ.Assembler=Kh,g("ez",Y7),function(g){g[g.Static=0]="Static",g[g.Kinematic=1]="Kinematic",g[g.Dynamic=2]="Dynamic",g[g.Animated=3]="Animated"}(Y7||g("ez",Y7={})),re(Y7),g("eA",Y9),function(g){g[g.None=0]="None",g[g.BOX=1]="BOX",g[g.CIRCLE=2]="CIRCLE",g[g.POLYGON=3]="POLYGON"}(Y9||g("eA",Y9={})),re(Y9),g("eB",Ki),function(g){g[g.None=0]="None",g[g.DISTANCE=1]="DISTANCE",g[g.SPRING=2]="SPRING",g[g.WHEEL=3]="WHEEL",g[g.MOUSE=4]="MOUSE",g[g.FIXED=5]="FIXED",g[g.SLIDER=6]="SLIDER",g[g.RELATIVE=7]="RELATIVE",g[g.HINGE=8]="HINGE"}(Ki||g("eB",Ki={})),re(Ki),g("eC",Kn),function(g){g[g.DEFAULT=1]="DEFAULT"}(Kn||g("eC",Kn={})),re(Kn),g("eD",Kr),function(g){g[g.Closest=0]="Closest",g[g.Any=1]="Any",g[g.AllClosest=2]="AllClosest",g[g.All=3]="All"}(Kr||g("eD",Kr={}));var Ku,Kl=g("eE",{None:"none-contact",BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"});g("eF",Ku),function(g){g[g.None=0]="None",g[g.Shape=1]="Shape",g[g.Joint=2]="Joint",g[g.Aabb=4]="Aabb",g[g.Pair=8]="Pair",g[g.CenterOfMass=16]="CenterOfMass",g[g.Particle=32]="Particle",g[g.Controller=64]="Controller",g[g.All=63]="All"}(Ku||g("eF",Ku={}));var Kc=g("eG",32),K_=g("ey",{id:"",switchTo:function(g){var v=K_;K_.physicsWorld&&g!==K_.id&&null!=K_.backend[g]?(N("[PHYSICS2D]: switch from "+K_.id+" to "+g+"."),v.id=g,v.wrapper=K_.backend[g],v.physicsWorld=V3()):(N("[PHYSICS2D]: using "+v.id+"."),v.physicsWorld=V3())},register:function(g,v){if(N("[PHYSICS2D]: register "+g+"."),K_.backend[g]=v,!K_.physicsWorld||K_.id===g){var S=K_;S.id=g,S.wrapper=v}},wrapper:{},backend:{},physicsWorld:null,runInEditor:!0}),k3=function(){return 0};function V3(){return new K_.wrapper.PhysicsWorld}var Kf={impl:null,rigidBody:null,isAwake:!1,isSleeping:!1,initialize:k3,setType:k3,setLinearDamping:k3,setAngularDamping:k3,setGravityScale:k3,setFixedRotation:k3,setAllowSleep:k3,isActive:k3,setActive:k3,wakeUp:k3,sleep:k3,getMass:k3,getInertia:k3,getLinearVelocity:k3,setLinearVelocity:k3,getLinearVelocityFromWorldPoint:k3,getAngularVelocity:k3,setAngularVelocity:k3,getLocalVector:k3,getWorldVector:k3,getLocalPoint:k3,getWorldPoint:k3,getLocalCenter:k3,getWorldCenter:k3,applyForce:k3,applyForceToCenter:k3,applyTorque:k3,applyLinearImpulse:k3,applyLinearImpulseToCenter:k3,applyAngularImpulse:k3,onEnable:k3,onDisable:k3,onDestroy:k3},Kd={INITED:!1};var Kp={INITED:!1},Km={impl:null,initialize:k3,apply:k3,setDampingRatio:k3,setFrequency:k3,setMaxForce:k3,setTarget:k3,setDistance:k3,setAngularOffset:k3,setCorrectionFactor:k3,setLinearOffset:k3,setMaxLength:k3,setMaxTorque:k3,setLowerLimit:k3,setUpperLimit:k3,setMaxMotorForce:k3,setMaxMotorTorque:k3,setMotorSpeed:k3,enableLimit:k3,enableMotor:k3,setLowerAngle:k3,setUpperAngle:k3};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Ky,KS=function(g,v){return function(g){function e(g){if(!g){for(var v=arguments.length,S=new Array(v>1?v-1:0),O=1;O<v;O++)S[O-1]=arguments[O];throw u(Error,S)}}function i(g,v){return void 0!==g?g:v}var v=1e37,S=1e-5,O=S*S,X=3.14159265359,Y=2,te=8,ti=.1,tr=2,ta=.008,th=2/180*X,tu=2*ta,tl=8,tc=32,t_=1,tf=.2,tp=8/180*X,tm=2,tg=tm*tm,tv=.5*X,ty=tv*tv,tS=.2,tA=.75,tT=-1,tE=0x7fffffff,tC=.75,tx=1,tb=.25,tw=.5,tI=2,tB=tI*tI,tP=256,tD=2.5,tM=.5,tO=.01,tk=2/180*X;function H(){return null}function z(){}function W(){}var tG=function(){function t1(g,v,S){void 0===g&&(g=0),void 0===v&&(v=0),void 0===S&&(S=0),this.major=0,this.minor=0,this.revision=0,this.major=g,this.minor=v,this.revision=S}return t1.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},t1}(),tV=new tG(2,3,2),tU="master",tH="fbf51801d80fc389d43dc46524520e89043b6faf";function K(g){return parseInt(g,10)}function J(g){return Math.abs(parseInt(g,10))}function Q(g,v){for(var S=new Array(g),O=0;O<g;++O)S[O]=v(O);return S}function Z(g){for(var v=new Array(g),S=0;S<g;++S)v[S]=null;return v}function $(g,v){void 0===v&&(v=0);for(var S=new Array(g),O=0;O<g;++O)S[O]=v;return S}var tz=X/180,tW=180/X,tj=2*X,tq=Math.abs;function rt(g,v){return g<v?g:v}function st(g,v){return g>v?g:v}function at(g,v,S){return g<v?v:g>S?S:g}function ot(g,v){var S=g[0];g[0]=v[0],v[0]=S}var tK=isFinite;function ut(g){return g*g}function lt(g){return 1/Math.sqrt(g)}var tZ=Math.sqrt,tQ=Math.pow;function ft(g){return g*tz}function dt(g){return g*tW}var t$=Math.cos,t0=Math.sin,t2=Math.acos,t3=Math.asin,t4=Math.atan2;function St(g){return g|=g>>1&0x7fffffff,g|=g>>2&0x3fffffff,g|=g>>4&0xfffffff,1+((g|=g>>8&0xffffff)|g>>16&65535)}function At(g){return g>0&&0==(g&g-1)}function Tt(){return 2*Math.random()-1}function Et(g,v){return(v-g)*Math.random()+g}var t8=function(){function t1(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];if(_instanceof(v[0],Float32Array)){if(2!==v[0].length)throw new Error;this.data=v[0]}else{var O="number"==typeof v[0]?v[0]:0,X="number"==typeof v[1]?v[1]:0;this.data=new Float32Array([O,X])}}var g=t1.prototype;return g.Clone=function(){return new t1(this.x,this.y)},g.SetZero=function(){return this.x=0,this.y=0,this},g.Set=function(g,v){return this.x=g,this.y=v,this},g.Copy=function(g){return this.x=g.x,this.y=g.y,this},g.SelfAdd=function(g){return this.x+=g.x,this.y+=g.y,this},g.SelfAddXY=function(g,v){return this.x+=g,this.y+=v,this},g.SelfSub=function(g){return this.x-=g.x,this.y-=g.y,this},g.SelfSubXY=function(g,v){return this.x-=g,this.y-=v,this},g.SelfMul=function(g){return this.x*=g,this.y*=g,this},g.SelfMulAdd=function(g,v){return this.x+=g*v.x,this.y+=g*v.y,this},g.SelfMulSub=function(g,v){return this.x-=g*v.x,this.y-=g*v.y,this},g.Dot=function(g){return this.x*g.x+this.y*g.y},g.Cross=function(g){return this.x*g.y-this.y*g.x},g.Length=function(){var g=this.x,v=this.y;return Math.sqrt(g*g+v*v)},g.LengthSquared=function(){var g=this.x,v=this.y;return g*g+v*v},g.Normalize=function(){var g=this.Length();if(g>=S){var v=1/g;this.x*=v,this.y*=v}return g},g.SelfNormalize=function(){var g=this.Length();if(g>=S){var v=1/g;this.x*=v,this.y*=v}return this},g.SelfRotate=function(g){var v=Math.cos(g),S=Math.sin(g),O=this.x;return this.x=v*O-S*this.y,this.y=S*O+v*this.y,this},g.SelfRotateCosSin=function(g,v){var S=this.x;return this.x=g*S-v*this.y,this.y=v*S+g*this.y,this},g.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},g.SelfCrossVS=function(g){var v=this.x;return this.x=g*this.y,this.y=-g*v,this},g.SelfCrossSV=function(g){var v=this.x;return this.x=-g*this.y,this.y=g*v,this},g.SelfMinV=function(g){return this.x=rt(this.x,g.x),this.y=rt(this.y,g.y),this},g.SelfMaxV=function(g){return this.x=st(this.x,g.x),this.y=st(this.y,g.y),this},g.SelfAbs=function(){return this.x=tq(this.x),this.y=tq(this.y),this},g.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},g.SelfSkew=function(){var g=this.x;return this.x=-this.y,this.y=g,this},t1.MakeArray=function(g){return Q(g,function(){return new t1})},t1.AbsV=function(g,v){return v.x=tq(g.x),v.y=tq(g.y),v},t1.MinV=function(g,v,S){return S.x=rt(g.x,v.x),S.y=rt(g.y,v.y),S},t1.MaxV=function(g,v,S){return S.x=st(g.x,v.x),S.y=st(g.y,v.y),S},t1.ClampV=function(g,v,S,O){return O.x=at(g.x,v.x,S.x),O.y=at(g.y,v.y,S.y),O},t1.RotateV=function(g,v,S){var O=g.x,X=g.y,Y=Math.cos(v),te=Math.sin(v);return S.x=Y*O-te*X,S.y=te*O+Y*X,S},t1.DotVV=function(g,v){return g.x*v.x+g.y*v.y},t1.CrossVV=function(g,v){return g.x*v.y-g.y*v.x},t1.CrossVS=function(g,v,S){var O=g.x;return S.x=v*g.y,S.y=-v*O,S},t1.CrossVOne=function(g,v){var S=g.x;return v.x=g.y,v.y=-S,v},t1.CrossSV=function(g,v,S){var O=v.x;return S.x=-g*v.y,S.y=g*O,S},t1.CrossOneV=function(g,v){var S=g.x;return v.x=-g.y,v.y=S,v},t1.AddVV=function(g,v,S){return S.x=g.x+v.x,S.y=g.y+v.y,S},t1.SubVV=function(g,v,S){return S.x=g.x-v.x,S.y=g.y-v.y,S},t1.MulSV=function(g,v,S){return S.x=v.x*g,S.y=v.y*g,S},t1.MulVS=function(g,v,S){return S.x=g.x*v,S.y=g.y*v,S},t1.AddVMulSV=function(g,v,S,O){return O.x=g.x+v*S.x,O.y=g.y+v*S.y,O},t1.SubVMulSV=function(g,v,S,O){return O.x=g.x-v*S.x,O.y=g.y-v*S.y,O},t1.AddVCrossSV=function(g,v,S,O){var X=S.x;return O.x=g.x-v*S.y,O.y=g.y+v*X,O},t1.MidVV=function(g,v,S){return S.x=.5*(g.x+v.x),S.y=.5*(g.y+v.y),S},t1.ExtVV=function(g,v,S){return S.x=.5*(v.x-g.x),S.y=.5*(v.y-g.y),S},t1.IsEqualToV=function(g,v){return g.x===v.x&&g.y===v.y},t1.DistanceVV=function(g,v){var S=g.x-v.x,O=g.y-v.y;return Math.sqrt(S*S+O*O)},t1.DistanceSquaredVV=function(g,v){var S=g.x-v.x,O=g.y-v.y;return S*S+O*O},t1.NegV=function(g,v){return v.x=-g.x,v.y=-g.y,v},n(t1,[{key:"x",get:function(){return this.data[0]},set:function(g){this.data[0]=g}},{key:"y",get:function(){return this.data[1]},set:function(g){this.data[1]=g}}]),t1}();t8.ZERO=new t8(0,0),t8.UNITX=new t8(1,0),t8.UNITY=new t8(0,1),t8.s_t0=new t8,t8.s_t1=new t8,t8.s_t2=new t8,t8.s_t3=new t8;var t6=new t8(0,0),t7=function(){function t1(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];if(_instanceof(v[0],Float32Array)){if(3!==v[0].length)throw new Error;this.data=v[0]}else{var O="number"==typeof v[0]?v[0]:0,X="number"==typeof v[1]?v[1]:0,Y="number"==typeof v[2]?v[2]:0;this.data=new Float32Array([O,X,Y])}}var g=t1.prototype;return g.Clone=function(){return new t1(this.x,this.y,this.z)},g.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},g.SetXYZ=function(g,v,S){return this.x=g,this.y=v,this.z=S,this},g.Copy=function(g){return this.x=g.x,this.y=g.y,this.z=g.z,this},g.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},g.SelfAdd=function(g){return this.x+=g.x,this.y+=g.y,this.z+=g.z,this},g.SelfAddXYZ=function(g,v,S){return this.x+=g,this.y+=v,this.z+=S,this},g.SelfSub=function(g){return this.x-=g.x,this.y-=g.y,this.z-=g.z,this},g.SelfSubXYZ=function(g,v,S){return this.x-=g,this.y-=v,this.z-=S,this},g.SelfMul=function(g){return this.x*=g,this.y*=g,this.z*=g,this},t1.DotV3V3=function(g,v){return g.x*v.x+g.y*v.y+g.z*v.z},t1.CrossV3V3=function(g,v,S){var O=g.x,X=g.y,Y=g.z,te=v.x,ti=v.y,tr=v.z;return S.x=X*tr-Y*ti,S.y=Y*te-O*tr,S.z=O*ti-X*te,S},n(t1,[{key:"x",get:function(){return this.data[0]},set:function(g){this.data[0]=g}},{key:"y",get:function(){return this.data[1]},set:function(g){this.data[1]=g}},{key:"z",get:function(){return this.data[2]},set:function(g){this.data[2]=g}}]),t1}();t7.ZERO=new t7(0,0,0),t7.s_t0=new t7;var t9=function(){function t1(){this.data=new Float32Array([1,0,0,1]),this.ex=new t8(this.data.subarray(0,2)),this.ey=new t8(this.data.subarray(2,4))}var g=t1.prototype;return g.Clone=function(){return(new t1).Copy(this)},t1.FromVV=function(g,v){return(new t1).SetVV(g,v)},t1.FromSSSS=function(g,v,S,O){return(new t1).SetSSSS(g,v,S,O)},t1.FromAngle=function(g){return(new t1).SetAngle(g)},g.SetSSSS=function(g,v,S,O){return this.ex.Set(g,S),this.ey.Set(v,O),this},g.SetVV=function(g,v){return this.ex.Copy(g),this.ey.Copy(v),this},g.SetAngle=function(g){var v=Math.cos(g),S=Math.sin(g);return this.ex.Set(v,S),this.ey.Set(-S,v),this},g.Copy=function(g){return this.ex.Copy(g.ex),this.ey.Copy(g.ey),this},g.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},g.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},g.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},g.GetInverse=function(g){var v=this.ex.x,S=this.ey.x,O=this.ex.y,X=this.ey.y,Y=v*X-S*O;return 0!==Y&&(Y=1/Y),g.ex.x=Y*X,g.ey.x=-Y*S,g.ex.y=-Y*O,g.ey.y=Y*v,g},g.Solve=function(g,v,S){var O=this.ex.x,X=this.ey.x,Y=this.ex.y,te=this.ey.y,ti=O*te-X*Y;return 0!==ti&&(ti=1/ti),S.x=ti*(te*g-X*v),S.y=ti*(O*v-Y*g),S},g.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},g.SelfInv=function(){return this.GetInverse(this),this},g.SelfAddM=function(g){return this.ex.SelfAdd(g.ex),this.ey.SelfAdd(g.ey),this},g.SelfSubM=function(g){return this.ex.SelfSub(g.ex),this.ey.SelfSub(g.ey),this},t1.AbsM=function(g,v){var S=g.ex,O=g.ey;return v.ex.x=tq(S.x),v.ex.y=tq(S.y),v.ey.x=tq(O.x),v.ey.y=tq(O.y),v},t1.MulMV=function(g,v,S){var O=g.ex,X=g.ey,Y=v.x,te=v.y;return S.x=O.x*Y+X.x*te,S.y=O.y*Y+X.y*te,S},t1.MulTMV=function(g,v,S){var O=g.ex,X=g.ey,Y=v.x,te=v.y;return S.x=O.x*Y+O.y*te,S.y=X.x*Y+X.y*te,S},t1.AddMM=function(g,v,S){var O=g.ex,X=g.ey,Y=v.ex,te=v.ey;return S.ex.x=O.x+Y.x,S.ex.y=O.y+Y.y,S.ey.x=X.x+te.x,S.ey.y=X.y+te.y,S},t1.MulMM=function(g,v,S){var O=g.ex.x,X=g.ex.y,Y=g.ey.x,te=g.ey.y,ti=v.ex.x,tr=v.ex.y,ta=v.ey.x,th=v.ey.y;return S.ex.x=O*ti+Y*tr,S.ex.y=X*ti+te*tr,S.ey.x=O*ta+Y*th,S.ey.y=X*ta+te*th,S},t1.MulTMM=function(g,v,S){var O=g.ex.x,X=g.ex.y,Y=g.ey.x,te=g.ey.y,ti=v.ex.x,tr=v.ex.y,ta=v.ey.x,th=v.ey.y;return S.ex.x=O*ti+X*tr,S.ex.y=Y*ti+te*tr,S.ey.x=O*ta+X*th,S.ey.y=Y*ta+te*th,S},t1}();t9.IDENTITY=new t9;var ee=function(){function t1(){this.data=new Float32Array([1,0,0,0,1,0,0,0,1]),this.ex=new t7(this.data.subarray(0,3)),this.ey=new t7(this.data.subarray(3,6)),this.ez=new t7(this.data.subarray(6,9))}var g=t1.prototype;return g.Clone=function(){return(new t1).Copy(this)},g.SetVVV=function(g,v,S){return this.ex.Copy(g),this.ey.Copy(v),this.ez.Copy(S),this},g.Copy=function(g){return this.ex.Copy(g.ex),this.ey.Copy(g.ey),this.ez.Copy(g.ez),this},g.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},g.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},g.SelfAddM=function(g){return this.ex.SelfAdd(g.ex),this.ey.SelfAdd(g.ey),this.ez.SelfAdd(g.ez),this},g.Solve33=function(g,v,S,O){var X=this.ex.x,Y=this.ex.y,te=this.ex.z,ti=this.ey.x,tr=this.ey.y,ta=this.ey.z,th=this.ez.x,tu=this.ez.y,tl=this.ez.z,tc=X*(tr*tl-ta*tu)+Y*(ta*th-ti*tl)+te*(ti*tu-tr*th);return 0!==tc&&(tc=1/tc),O.x=tc*(g*(tr*tl-ta*tu)+v*(ta*th-ti*tl)+S*(ti*tu-tr*th)),O.y=tc*(X*(v*tl-S*tu)+Y*(S*th-g*tl)+te*(g*tu-v*th)),O.z=tc*(X*(tr*S-ta*v)+Y*(ta*g-ti*S)+te*(ti*v-tr*g)),O},g.Solve22=function(g,v,S){var O=this.ex.x,X=this.ey.x,Y=this.ex.y,te=this.ey.y,ti=O*te-X*Y;return 0!==ti&&(ti=1/ti),S.x=ti*(te*g-X*v),S.y=ti*(O*v-Y*g),S},g.GetInverse22=function(g){var v=this.ex.x,S=this.ey.x,O=this.ex.y,X=this.ey.y,Y=v*X-S*O;0!==Y&&(Y=1/Y),g.ex.x=Y*X,g.ey.x=-Y*S,g.ex.z=0,g.ex.y=-Y*O,g.ey.y=Y*v,g.ey.z=0,g.ez.x=0,g.ez.y=0,g.ez.z=0},g.GetSymInverse33=function(g){var v=t7.DotV3V3(this.ex,t7.CrossV3V3(this.ey,this.ez,t7.s_t0));0!==v&&(v=1/v);var S=this.ex.x,O=this.ey.x,X=this.ez.x,Y=this.ey.y,te=this.ez.y,ti=this.ez.z;g.ex.x=v*(Y*ti-te*te),g.ex.y=v*(X*te-O*ti),g.ex.z=v*(O*te-X*Y),g.ey.x=g.ex.y,g.ey.y=v*(S*ti-X*X),g.ey.z=v*(X*O-S*te),g.ez.x=g.ex.z,g.ez.y=g.ey.z,g.ez.z=v*(S*Y-O*O)},t1.MulM33V3=function(g,v,S){var O=v.x,X=v.y,Y=v.z;return S.x=g.ex.x*O+g.ey.x*X+g.ez.x*Y,S.y=g.ex.y*O+g.ey.y*X+g.ez.y*Y,S.z=g.ex.z*O+g.ey.z*X+g.ez.z*Y,S},t1.MulM33XYZ=function(g,v,S,O,X){return X.x=g.ex.x*v+g.ey.x*S+g.ez.x*O,X.y=g.ex.y*v+g.ey.y*S+g.ez.y*O,X.z=g.ex.z*v+g.ey.z*S+g.ez.z*O,X},t1.MulM33V2=function(g,v,S){var O=v.x,X=v.y;return S.x=g.ex.x*O+g.ey.x*X,S.y=g.ex.y*O+g.ey.y*X,S},t1.MulM33XY=function(g,v,S,O){return O.x=g.ex.x*v+g.ey.x*S,O.y=g.ex.y*v+g.ey.y*S,O},t1}();ee.IDENTITY=new ee;var en=function(){function t1(g){void 0===g&&(g=0),this.s=0,this.c=1,g&&(this.s=Math.sin(g),this.c=Math.cos(g))}var g=t1.prototype;return g.Clone=function(){return(new t1).Copy(this)},g.Copy=function(g){return this.s=g.s,this.c=g.c,this},g.SetAngle=function(g){return this.s=Math.sin(g),this.c=Math.cos(g),this},g.SetIdentity=function(){return this.s=0,this.c=1,this},g.GetAngle=function(){return Math.atan2(this.s,this.c)},g.GetXAxis=function(g){return g.x=this.c,g.y=this.s,g},g.GetYAxis=function(g){return g.x=-this.s,g.y=this.c,g},t1.MulRR=function(g,v,S){var O=g.c,X=g.s,Y=v.c,te=v.s;return S.s=X*Y+O*te,S.c=O*Y-X*te,S},t1.MulTRR=function(g,v,S){var O=g.c,X=g.s,Y=v.c,te=v.s;return S.s=O*te-X*Y,S.c=O*Y+X*te,S},t1.MulRV=function(g,v,S){var O=g.c,X=g.s,Y=v.x,te=v.y;return S.x=O*Y-X*te,S.y=X*Y+O*te,S},t1.MulTRV=function(g,v,S){var O=g.c,X=g.s,Y=v.x,te=v.y;return S.x=O*Y+X*te,S.y=-X*Y+O*te,S},t1}();en.IDENTITY=new en;var er=function(){function t1(){this.p=new t8,this.q=new en}var g=t1.prototype;return g.Clone=function(){return(new t1).Copy(this)},g.Copy=function(g){return this.p.Copy(g.p),this.q.Copy(g.q),this},g.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},g.SetPositionRotation=function(g,v){return this.p.Copy(g),this.q.Copy(v),this},g.SetPositionAngle=function(g,v){return this.p.Copy(g),this.q.SetAngle(v),this},g.SetPosition=function(g){return this.p.Copy(g),this},g.SetPositionXY=function(g,v){return this.p.Set(g,v),this},g.SetRotation=function(g){return this.q.Copy(g),this},g.SetRotationAngle=function(g){return this.q.SetAngle(g),this},g.GetPosition=function(){return this.p},g.GetRotation=function(){return this.q},g.GetRotationAngle=function(){return this.q.GetAngle()},g.GetAngle=function(){return this.q.GetAngle()},t1.MulXV=function(g,v,S){var O=g.q.c,X=g.q.s,Y=v.x,te=v.y;return S.x=O*Y-X*te+g.p.x,S.y=X*Y+O*te+g.p.y,S},t1.MulTXV=function(g,v,S){var O=g.q.c,X=g.q.s,Y=v.x-g.p.x,te=v.y-g.p.y;return S.x=O*Y+X*te,S.y=-X*Y+O*te,S},t1.MulXX=function(g,v,S){return en.MulRR(g.q,v.q,S.q),t8.AddVV(en.MulRV(g.q,v.p,S.p),g.p,S.p),S},t1.MulTXX=function(g,v,S){return en.MulTRR(g.q,v.q,S.q),en.MulTRV(g.q,t8.SubVV(v.p,g.p,S.p),S.p),S},t1}();er.IDENTITY=new er;var es,ea=function(){function t1(){this.localCenter=new t8,this.c0=new t8,this.c=new t8,this.a0=0,this.a=0,this.alpha0=0}var g=t1.prototype;return g.Clone=function(){return(new t1).Copy(this)},g.Copy=function(g){return this.localCenter.Copy(g.localCenter),this.c0.Copy(g.c0),this.c.Copy(g.c),this.a0=g.a0,this.a=g.a,this.alpha0=g.alpha0,this},g.GetTransform=function(g,v){var S=1-v;g.p.x=S*this.c0.x+v*this.c.x,g.p.y=S*this.c0.y+v*this.c.y;var O=S*this.a0+v*this.a;return g.q.SetAngle(O),g.p.SelfSub(en.MulRV(g.q,this.localCenter,t8.s_t0)),g},g.Advance=function(g){var v=(g-this.alpha0)/(1-this.alpha0),S=1-v;this.c0.x=S*this.c0.x+v*this.c.x,this.c0.y=S*this.c0.y+v*this.c.y,this.a0=S*this.a0+v*this.a,this.alpha0=g},g.Normalize=function(){var g=tj*Math.floor(this.a0/tj);this.a0-=g,this.a-=g},t1}(),eh=function(){function t1(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];if(_instanceof(v[0],Float32Array)){if(4!==v[0].length)throw new Error;this.data=v[0]}else{var O="number"==typeof v[0]?v[0]:.5,X="number"==typeof v[1]?v[1]:.5,Y="number"==typeof v[2]?v[2]:.5,te="number"==typeof v[3]?v[3]:1;this.data=new Float32Array([O,X,Y,te])}}var g=t1.prototype;return g.Clone=function(){return(new t1).Copy(this)},g.Copy=function(g){return this.r=g.r,this.g=g.g,this.b=g.b,this.a=g.a,this},g.IsEqual=function(g){return this.r===g.r&&this.g===g.g&&this.b===g.b&&this.a===g.a},g.IsZero=function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a},g.Set=function(g,v,S,O){void 0===O&&(O=this.a),this.SetRGBA(g,v,S,O)},g.SetByteRGB=function(g,v,S){return this.r=g/255,this.g=v/255,this.b=S/255,this},g.SetByteRGBA=function(g,v,S,O){return this.r=g/255,this.g=v/255,this.b=S/255,this.a=O/255,this},g.SetRGB=function(g,v,S){return this.r=g,this.g=v,this.b=S,this},g.SetRGBA=function(g,v,S,O){return this.r=g,this.g=v,this.b=S,this.a=O,this},g.SelfAdd=function(g){return this.r+=g.r,this.g+=g.g,this.b+=g.b,this.a+=g.a,this},g.Add=function(g,v){return v.r=this.r+g.r,v.g=this.g+g.g,v.b=this.b+g.b,v.a=this.a+g.a,v},g.SelfSub=function(g){return this.r-=g.r,this.g-=g.g,this.b-=g.b,this.a-=g.a,this},g.Sub=function(g,v){return v.r=this.r-g.r,v.g=this.g-g.g,v.b=this.b-g.b,v.a=this.a-g.a,v},g.SelfMul=function(g){return this.r*=g,this.g*=g,this.b*=g,this.a*=g,this},g.Mul=function(g,v){return v.r=this.r*g,v.g=this.g*g,v.b=this.b*g,v.a=this.a*g,v},g.Mix=function(g,v){t1.MixColors(this,g,v)},t1.MixColors=function(g,v,S){var O=S*(v.r-g.r),X=S*(v.g-g.g),Y=S*(v.b-g.b),te=S*(v.a-g.a);g.r+=O,g.g+=X,g.b+=Y,g.a+=te,v.r-=O,v.g-=X,v.b-=Y,v.a-=te},g.MakeStyleString=function(g){return void 0===g&&(g=this.a),t1.MakeStyleString(this.r,this.g,this.b,g)},t1.MakeStyleString=function(g,v,S,O){return void 0===O&&(O=1),g*=255,v*=255,S*=255,O<1?"rgba("+g+","+v+","+S+","+O+")":"rgb("+g+","+v+","+S+")"},n(t1,[{key:"r",get:function(){return this.data[0]},set:function(g){this.data[0]=g}},{key:"g",get:function(){return this.data[1]},set:function(g){this.data[1]=g}},{key:"b",get:function(){return this.data[2]},set:function(g){this.data[2]=g}},{key:"a",get:function(){return this.data[3]},set:function(g){this.data[3]=g}}]),t1}();eh.ZERO=new eh(0,0,0,0),eh.RED=new eh(1,0,0),eh.GREEN=new eh(0,1,0),eh.BLUE=new eh(0,0,1),(es=g.b2DrawFlags||(g.b2DrawFlags={}))[es.e_none=0]="e_none",es[es.e_shapeBit=1]="e_shapeBit",es[es.e_jointBit=2]="e_jointBit",es[es.e_aabbBit=4]="e_aabbBit",es[es.e_pairBit=8]="e_pairBit",es[es.e_centerOfMassBit=16]="e_centerOfMassBit",es[es.e_particleBit=32]="e_particleBit",es[es.e_controllerBit=64]="e_controllerBit",es[es.e_all=63]="e_all";var eu=function(){function t1(){this.m_drawFlags=0}var g=t1.prototype;return g.SetFlags=function(g){this.m_drawFlags=g},g.GetFlags=function(){return this.m_drawFlags},g.AppendFlags=function(g){this.m_drawFlags|=g},g.ClearFlags=function(g){this.m_drawFlags&=~g},t1}(),ec=function(){function t1(){this.m_start=Date.now()}var g=t1.prototype;return g.Reset=function(){return this.m_start=Date.now(),this},g.GetMilliseconds=function(){return Date.now()-this.m_start},t1}(),e_=function(){function t1(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}var g=t1.prototype;return g.GetCount=function(){return this.m_count},g.GetMinCount=function(){return this.m_min_count},g.GetMaxCount=function(){return this.m_max_count},g.ResetCount=function(){var g=this.m_count;return this.m_count=0,g},g.ResetMinCount=function(){this.m_min_count=0},g.ResetMaxCount=function(){this.m_max_count=0},g.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},g.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},t1}(),ef=function(){function t1(g){this.m_stack=[],this.m_count=0,this.m_stack=Q(g,function(){return null}),this.m_count=0}var g=t1.prototype;return g.Reset=function(){return this.m_count=0,this},g.Push=function(g){this.m_stack[this.m_count]=g,this.m_count++},g.Pop=function(){this.m_count--;var g=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===g)throw new Error;return g},g.GetCount=function(){return this.m_count},t1}(),_$Gt=function(){},_$kt=function(){},em=function(){function t1(){this.m_buffer=t8.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}var g=t1.prototype;return g.Copy=function(g){return g.m_vertices===g.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(g.m_buffer[0]),this.m_buffer[1].Copy(g.m_buffer[1])):this.m_vertices=g.m_vertices,this.m_count=g.m_count,this.m_radius=g.m_radius,this},g.Reset=function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this},g.SetShape=function(g,v){g.SetupDistanceProxy(this,v)},g.SetVerticesRadius=function(g,v,S){this.m_vertices=g,this.m_count=v,this.m_radius=S},g.GetSupport=function(g){for(var v=0,S=t8.DotVV(this.m_vertices[0],g),O=1;O<this.m_count;++O){var X=t8.DotVV(this.m_vertices[O],g);X>S&&(v=O,S=X)}return v},g.GetSupportVertex=function(g){for(var v=0,S=t8.DotVV(this.m_vertices[0],g),O=1;O<this.m_count;++O){var X=t8.DotVV(this.m_vertices[O],g);X>S&&(v=O,S=X)}return this.m_vertices[v]},g.GetVertexCount=function(){return this.m_count},g.GetVertex=function(g){return this.m_vertices[g]},t1}(),eg=function(){function t1(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return t1.prototype.Reset=function(){return this.metric=0,this.count=0,this},t1}(),ey=function(){function t1(){this.proxyA=new em,this.proxyB=new em,this.transformA=new er,this.transformB=new er,this.useRadii=!1}return t1.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},t1}(),eS=function(){function t1(){this.pointA=new t8,this.pointB=new t8,this.distance=0,this.iterations=0}return t1.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},t1}(),_$Wt=function(){this.proxyA=new em,this.proxyB=new em,this.transformA=new er,this.transformB=new er,this.translationB=new t8},_$Xt=function(){this.point=new t8,this.normal=new t8,this.lambda=0,this.iterations=0};function jt(){g.b2_gjkCalls=0,g.b2_gjkIters=0,g.b2_gjkMaxIters=0}g.b2_gjkCalls=0,g.b2_gjkIters=0,g.b2_gjkMaxIters=0;var eT=function(){function t1(){this.wA=new t8,this.wB=new t8,this.w=new t8,this.a=0,this.indexA=0,this.indexB=0}return t1.prototype.Copy=function(g){return this.wA.Copy(g.wA),this.wB.Copy(g.wB),this.w.Copy(g.w),this.a=g.a,this.indexA=g.indexA,this.indexB=g.indexB,this},t1}(),eE=function(){function t1(){this.m_v1=new eT,this.m_v2=new eT,this.m_v3=new eT,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}var g=t1.prototype;return g.ReadCache=function(g,v,O,X,Y){this.m_count=g.count;for(var te=this.m_vertices,ti=0;ti<this.m_count;++ti){var tr=te[ti];tr.indexA=g.indexA[ti],tr.indexB=g.indexB[ti];var ta=v.GetVertex(tr.indexA),th=X.GetVertex(tr.indexB);er.MulXV(O,ta,tr.wA),er.MulXV(Y,th,tr.wB),t8.SubVV(tr.wB,tr.wA,tr.w),tr.a=0}if(this.m_count>1){var tu=g.metric,tl=this.GetMetric();(tl<.5*tu||2*tu<tl||tl<S)&&(this.m_count=0)}if(0===this.m_count){var tc=te[0];tc.indexA=0,tc.indexB=0;var t_=v.GetVertex(0),tf=X.GetVertex(0);er.MulXV(O,t_,tc.wA),er.MulXV(Y,tf,tc.wB),t8.SubVV(tc.wB,tc.wA,tc.w),tc.a=1,this.m_count=1}},g.WriteCache=function(g){g.metric=this.GetMetric(),g.count=this.m_count;for(var v=this.m_vertices,S=0;S<this.m_count;++S)g.indexA[S]=v[S].indexA,g.indexB[S]=v[S].indexB},g.GetSearchDirection=function(g){switch(this.m_count){case 1:return t8.NegV(this.m_v1.w,g);case 2:var v=t8.SubVV(this.m_v2.w,this.m_v1.w,g);return t8.CrossVV(v,t8.NegV(this.m_v1.w,t8.s_t0))>0?t8.CrossOneV(v,g):t8.CrossVOne(v,g);default:return g.SetZero()}},g.GetClosestPoint=function(g){switch(this.m_count){case 0:return g.SetZero();case 1:return g.Copy(this.m_v1.w);case 2:return g.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return g.SetZero()}},g.GetWitnessPoints=function(g,v){switch(this.m_count){case 0:break;case 1:g.Copy(this.m_v1.wA),v.Copy(this.m_v1.wB);break;case 2:g.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,g.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,v.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,v.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:v.x=g.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,v.y=g.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}},g.GetMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return t8.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return t8.CrossVV(t8.SubVV(this.m_v2.w,this.m_v1.w,t8.s_t0),t8.SubVV(this.m_v3.w,this.m_v1.w,t8.s_t1));default:return 0}},g.Solve2=function(){var g=this.m_v1.w,v=this.m_v2.w,S=t8.SubVV(v,g,t1.s_e12),O=-t8.DotVV(g,S);if(O<=0)return this.m_v1.a=1,void(this.m_count=1);var X=t8.DotVV(v,S);if(X<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var Y=1/(X+O);this.m_v1.a=X*Y,this.m_v2.a=O*Y,this.m_count=2},g.Solve3=function(){var g=this.m_v1.w,v=this.m_v2.w,S=this.m_v3.w,O=t8.SubVV(v,g,t1.s_e12),X=t8.DotVV(g,O),Y=t8.DotVV(v,O),te=-X,ti=t8.SubVV(S,g,t1.s_e13),tr=t8.DotVV(g,ti),ta=t8.DotVV(S,ti),th=-tr,tu=t8.SubVV(S,v,t1.s_e23),tl=t8.DotVV(v,tu),tc=t8.DotVV(S,tu),t_=-tl,tf=t8.CrossVV(O,ti),tp=tf*t8.CrossVV(v,S),tm=tf*t8.CrossVV(S,g),tg=tf*t8.CrossVV(g,v);if(te<=0&&th<=0)return this.m_v1.a=1,void(this.m_count=1);if(Y>0&&te>0&&tg<=0){var tv=1/(Y+te);return this.m_v1.a=Y*tv,this.m_v2.a=te*tv,void(this.m_count=2)}if(ta>0&&th>0&&tm<=0){var ty=1/(ta+th);return this.m_v1.a=ta*ty,this.m_v3.a=th*ty,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(Y<=0&&t_<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(ta<=0&&tc<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(tc>0&&t_>0&&tp<=0){var tS=1/(tc+t_);return this.m_v2.a=tc*tS,this.m_v3.a=t_*tS,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var tA=1/(tp+tm+tg);this.m_v1.a=tp*tA,this.m_v2.a=tm*tA,this.m_v3.a=tg*tA,this.m_count=3},t1}();eE.s_e12=new t8,eE.s_e13=new t8,eE.s_e23=new t8;var eC=new eE,ex=[0,0,0],eb=[0,0,0],eR=new t8,ew=new t8,eI=new t8,eB=new t8,eP=new t8;function ne(v,X,Y){++g.b2_gjkCalls;var te=Y.proxyA,ti=Y.proxyB,tr=Y.transformA,ta=Y.transformB,th=eC;th.ReadCache(X,te,tr,ti,ta);for(var tu=th.m_vertices,tl=20,tc=ex,t_=eb,tf=0,tp=0;tp<tl;){tf=th.m_count;for(var tm=0;tm<tf;++tm)tc[tm]=tu[tm].indexA,t_[tm]=tu[tm].indexB;switch(th.m_count){case 1:break;case 2:th.Solve2();break;case 3:th.Solve3()}if(3===th.m_count)break;var tg=th.GetSearchDirection(ew);if(tg.LengthSquared()<O)break;var tv=tu[th.m_count];tv.indexA=te.GetSupport(en.MulTRV(tr.q,t8.NegV(tg,t8.s_t0),eB)),er.MulXV(tr,te.GetVertex(tv.indexA),tv.wA),tv.indexB=ti.GetSupport(en.MulTRV(ta.q,tg,eP)),er.MulXV(ta,ti.GetVertex(tv.indexB),tv.wB),t8.SubVV(tv.wB,tv.wA,tv.w),++tp,++g.b2_gjkIters;for(var ty=!1,tS=0;tS<tf;++tS)if(tv.indexA===tc[tS]&&tv.indexB===t_[tS]){ty=!0;break}if(ty)break;++th.m_count}if(g.b2_gjkMaxIters=st(g.b2_gjkMaxIters,tp),th.GetWitnessPoints(v.pointA,v.pointB),v.distance=t8.DistanceVV(v.pointA,v.pointB),v.iterations=tp,th.WriteCache(X),Y.useRadii){var tA=te.m_radius,tT=ti.m_radius;if(v.distance>tA+tT&&v.distance>S){v.distance-=tA+tT;var tE=t8.SubVV(v.pointB,v.pointA,eI);tE.Normalize(),v.pointA.SelfMulAdd(tA,tE),v.pointB.SelfMulSub(tT,tE)}else{var tC=t8.MidVV(v.pointA,v.pointB,eR);v.pointA.Copy(tC),v.pointB.Copy(tC),v.distance=0}}}var eD,eM=new t8,eO=new eE,eL=new t8,eF=new t8,ek=new t8,eG=new t8,eV=new t8,eU=new t8;function fe(g,v){g.iterations=0,g.lambda=1,g.normal.SetZero(),g.point.SetZero();var S=v.proxyA,O=v.proxyB,X=st(S.m_radius,tu)+st(O.m_radius,tu),Y=v.transformA,te=v.transformB,ti=v.translationB,tr=eM.Set(0,0),th=0,tl=eO;tl.m_count=0;for(var tc=tl.m_vertices,t_=S.GetSupport(en.MulTRV(Y.q,t8.NegV(ti,t8.s_t1),t8.s_t0)),tf=er.MulXV(Y,S.GetVertex(t_),eL),tp=O.GetSupport(en.MulTRV(te.q,ti,t8.s_t0)),tm=er.MulXV(te,O.GetVertex(tp),eF),tg=t8.SubVV(tf,tm,ek),tv=st(tu,X-tu),ty=.5*ta,tS=20,tA=0;tA<tS&&tq(tg.Length()-tv)>ty;){g.iterations+=1,t_=S.GetSupport(en.MulTRV(Y.q,t8.NegV(tg,t8.s_t1),t8.s_t0)),tf=er.MulXV(Y,S.GetVertex(t_),eL),tp=O.GetSupport(en.MulTRV(te.q,tg,t8.s_t0)),tm=er.MulXV(te,O.GetVertex(tp),eF);var tT=t8.SubVV(tf,tm,eG);tg.Normalize();var tE=t8.DotVV(tg,tT),tC=t8.DotVV(tg,ti);if(tE-tv>th*tC){if(tC<=0)return!1;if((th=(tE-tv)/tC)>1)return!1;tr.Copy(tg).SelfNeg(),tl.m_count=0}var tx=tc[tl.m_count];switch(tx.indexA=tp,tx.wA.Copy(tm).SelfMulAdd(th,ti),tx.indexB=t_,tx.wB.Copy(tf),tx.w.Copy(tx.wB).SelfSub(tx.wA),tx.a=1,tl.m_count+=1,tl.m_count){case 1:break;case 2:tl.Solve2();break;case 3:tl.Solve3()}if(3===tl.m_count)return!1;tl.GetClosestPoint(tg),++tA}var tb=eV,tw=eU;return tl.GetWitnessPoints(tb,tw),tg.LengthSquared()>0&&(tr.Copy(tg).SelfNeg(),tr.Normalize()),g.normal.Copy(tr),g.lambda=th,g.iterations=tA,!0}(eD=g.b2ContactFeatureType||(g.b2ContactFeatureType={}))[eD.e_vertex=0]="e_vertex",eD[eD.e_face=1]="e_face";var eH,ez=function(){function t1(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return n(t1,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(g){this._key=g,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(g){this._indexA=g,this._key_invalid=!0}},{key:"indexB",get:function(){return this._indexB},set:function(g){this._indexB=g,this._key_invalid=!0}},{key:"typeA",get:function(){return this._typeA},set:function(g){this._typeA=g,this._key_invalid=!0}},{key:"typeB",get:function(){return this._typeB},set:function(g){this._typeB=g,this._key_invalid=!0}}]),t1}(),eW=function(){function t1(){this.cf=new ez}var g=t1.prototype;return g.Copy=function(g){return this.key=g.key,this},g.Clone=function(){return(new t1).Copy(this)},n(t1,[{key:"key",get:function(){return this.cf.key},set:function(g){this.cf.key=g}}]),t1}(),ej=function(){function t1(){this.localPoint=new t8,this.normalImpulse=0,this.tangentImpulse=0,this.id=new eW}t1.MakeArray=function(g){return Q(g,function(){return new t1})};var g=t1.prototype;return g.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},g.Copy=function(g){return this.localPoint.Copy(g.localPoint),this.normalImpulse=g.normalImpulse,this.tangentImpulse=g.tangentImpulse,this.id.Copy(g.id),this},t1}();(eH=g.b2ManifoldType||(g.b2ManifoldType={}))[eH.e_unknown=-1]="e_unknown",eH[eH.e_circles=0]="e_circles",eH[eH.e_faceA=1]="e_faceA",eH[eH.e_faceB=2]="e_faceB";var eq,eY=function(){function e(){this.points=ej.MakeArray(Y),this.localNormal=new t8,this.localPoint=new t8,this.type=g.b2ManifoldType.e_unknown,this.pointCount=0}var v=e.prototype;return v.Reset=function(){for(var v=0;v<Y;++v)this.points[v].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=g.b2ManifoldType.e_unknown,this.pointCount=0},v.Copy=function(g){this.pointCount=g.pointCount;for(var v=0;v<Y;++v)this.points[v].Copy(g.points[v]);return this.localNormal.Copy(g.localNormal),this.localPoint.Copy(g.localPoint),this.type=g.type,this},v.Clone=function(){return(new e).Copy(this)},e}(),eK=function(){function e(){this.normal=new t8,this.points=t8.MakeArray(Y),this.separations=$(Y)}return e.prototype.Initialize=function(v,S,X,Y,te){if(0!==v.pointCount)switch(v.type){case g.b2ManifoldType.e_circles:this.normal.Set(1,0);var ti=er.MulXV(S,v.localPoint,e.Initialize_s_pointA),tr=er.MulXV(Y,v.points[0].localPoint,e.Initialize_s_pointB);t8.DistanceSquaredVV(ti,tr)>O&&t8.SubVV(tr,ti,this.normal).SelfNormalize();var ta=t8.AddVMulSV(ti,X,this.normal,e.Initialize_s_cA),th=t8.SubVMulSV(tr,te,this.normal,e.Initialize_s_cB);t8.MidVV(ta,th,this.points[0]),this.separations[0]=t8.DotVV(t8.SubVV(th,ta,t8.s_t0),this.normal);break;case g.b2ManifoldType.e_faceA:en.MulRV(S.q,v.localNormal,this.normal);for(var tu=er.MulXV(S,v.localPoint,e.Initialize_s_planePoint),tl=0;tl<v.pointCount;++tl){var tc=er.MulXV(Y,v.points[tl].localPoint,e.Initialize_s_clipPoint),t_=X-t8.DotVV(t8.SubVV(tc,tu,t8.s_t0),this.normal),tf=t8.AddVMulSV(tc,t_,this.normal,e.Initialize_s_cA),tp=t8.SubVMulSV(tc,te,this.normal,e.Initialize_s_cB);t8.MidVV(tf,tp,this.points[tl]),this.separations[tl]=t8.DotVV(t8.SubVV(tp,tf,t8.s_t0),this.normal)}break;case g.b2ManifoldType.e_faceB:en.MulRV(Y.q,v.localNormal,this.normal);for(var tm=er.MulXV(Y,v.localPoint,e.Initialize_s_planePoint),tg=0;tg<v.pointCount;++tg){var tv=er.MulXV(S,v.points[tg].localPoint,e.Initialize_s_clipPoint),ty=te-t8.DotVV(t8.SubVV(tv,tm,t8.s_t0),this.normal),tS=t8.AddVMulSV(tv,ty,this.normal,e.Initialize_s_cB),tA=t8.SubVMulSV(tv,X,this.normal,e.Initialize_s_cA);t8.MidVV(tA,tS,this.points[tg]),this.separations[tg]=t8.DotVV(t8.SubVV(tA,tS,t8.s_t0),this.normal)}this.normal.SelfNeg()}},e}();function Ae(v,S,O,X){var te;for(te=0;te<O.pointCount;++te){var ti=O.points[te].id.key;v[te]=g.b2PointState.b2_removeState;for(var tr=0,ta=X.pointCount;tr<ta;++tr)if(X.points[tr].id.key===ti){v[te]=g.b2PointState.b2_persistState;break}}for(;te<Y;++te)v[te]=g.b2PointState.b2_nullState;for(te=0;te<X.pointCount;++te){var th=X.points[te].id.key;S[te]=g.b2PointState.b2_addState;for(var tu=0,tl=O.pointCount;tu<tl;++tu)if(O.points[tu].id.key===th){S[te]=g.b2PointState.b2_persistState;break}}for(;te<Y;++te)S[te]=g.b2PointState.b2_nullState}eK.Initialize_s_pointA=new t8,eK.Initialize_s_pointB=new t8,eK.Initialize_s_cA=new t8,eK.Initialize_s_cB=new t8,eK.Initialize_s_planePoint=new t8,eK.Initialize_s_clipPoint=new t8,(eq=g.b2PointState||(g.b2PointState={}))[eq.b2_nullState=0]="b2_nullState",eq[eq.b2_addState=1]="b2_addState",eq[eq.b2_persistState=2]="b2_persistState",eq[eq.b2_removeState=3]="b2_removeState";var eJ=function(){function t1(){this.v=new t8,this.id=new eW}return t1.MakeArray=function(g){return Q(g,function(){return new t1})},t1.prototype.Copy=function(g){return this.v.Copy(g.v),this.id.Copy(g.id),this},t1}(),eZ=function(){function t1(){this.p1=new t8,this.p2=new t8,this.maxFraction=1}return t1.prototype.Copy=function(g){return this.p1.Copy(g.p1),this.p2.Copy(g.p2),this.maxFraction=g.maxFraction,this},t1}(),eQ=function(){function t1(){this.normal=new t8,this.fraction=0}return t1.prototype.Copy=function(g){return this.normal.Copy(g.normal),this.fraction=g.fraction,this},t1}(),e$=function(){function t1(){this.lowerBound=new t8,this.upperBound=new t8,this.m_cache_center=new t8,this.m_cache_extent=new t8}var g=t1.prototype;return g.Copy=function(g){return this.lowerBound.Copy(g.lowerBound),this.upperBound.Copy(g.upperBound),this},g.IsValid=function(){return!(!this.lowerBound.IsValid()||!this.upperBound.IsValid()||this.upperBound.x<this.lowerBound.x||this.upperBound.y<this.lowerBound.y)},g.GetCenter=function(){return t8.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)},g.GetExtents=function(){return t8.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)},g.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},g.Combine1=function(g){return this.lowerBound.x=rt(this.lowerBound.x,g.lowerBound.x),this.lowerBound.y=rt(this.lowerBound.y,g.lowerBound.y),this.upperBound.x=st(this.upperBound.x,g.upperBound.x),this.upperBound.y=st(this.upperBound.y,g.upperBound.y),this},g.Combine2=function(g,v){return this.lowerBound.x=rt(g.lowerBound.x,v.lowerBound.x),this.lowerBound.y=rt(g.lowerBound.y,v.lowerBound.y),this.upperBound.x=st(g.upperBound.x,v.upperBound.x),this.upperBound.y=st(g.upperBound.y,v.upperBound.y),this},t1.Combine=function(g,v,S){return S.Combine2(g,v),S},g.Contains=function(g){return!(this.lowerBound.x<=g.lowerBound.x||this.lowerBound.y<=g.lowerBound.y||g.upperBound.x<=this.upperBound.x||g.upperBound.y<=this.upperBound.y)},g.RayCast=function(g,O){var X=-v,Y=v,te=O.p1.x,ti=O.p1.y,tr=O.p2.x-O.p1.x,ta=O.p2.y-O.p1.y,th=tq(tr),tu=tq(ta),tl=g.normal;if(th<S){if(te<this.lowerBound.x||this.upperBound.x<te)return!1}else{var tc=1/tr,t_=(this.lowerBound.x-te)*tc,tf=(this.upperBound.x-te)*tc,tp=-1;if(t_>tf){var tm=t_;t_=tf,tf=tm,tp=1}if(t_>X&&(tl.x=tp,tl.y=0,X=t_),X>(Y=rt(Y,tf)))return!1}if(tu<S){if(ti<this.lowerBound.y||this.upperBound.y<ti)return!1}else{var tg=1/ta,tv=(this.lowerBound.y-ti)*tg,ty=(this.upperBound.y-ti)*tg,tS=-1;if(tv>ty){var tA=tv;tv=ty,ty=tA,tS=1}if(tv>X&&(tl.x=0,tl.y=tS,X=tv),X>(Y=rt(Y,ty)))return!1}return!(X<0||O.maxFraction<X||(g.fraction=X,0))},g.TestContain=function(g){return!(g.x<this.lowerBound.x||this.upperBound.x<g.x||g.y<this.lowerBound.y||this.upperBound.y<g.y)},g.TestOverlap=function(g){return!(this.upperBound.x<g.lowerBound.x||this.upperBound.y<g.lowerBound.y||g.upperBound.x<this.lowerBound.x||g.upperBound.y<this.lowerBound.y)},t1}();function xe(g,v){return!(g.upperBound.x<v.lowerBound.x||g.upperBound.y<v.lowerBound.y||v.upperBound.x<g.lowerBound.x||v.upperBound.y<g.lowerBound.y)}function Re(v,S,O,X,Y){var te=0,ti=S[0],tr=S[1],ta=t8.DotVV(O,ti.v)-X,th=t8.DotVV(O,tr.v)-X;if(ta<=0&&v[te++].Copy(ti),th<=0&&v[te++].Copy(tr),ta*th<0){var tu=ta/(ta-th),tl=v[te].v;tl.x=ti.v.x+tu*(tr.v.x-ti.v.x),tl.y=ti.v.y+tu*(tr.v.y-ti.v.y);var tc=v[te].id;tc.cf.indexA=Y,tc.cf.indexB=ti.id.cf.indexB,tc.cf.typeA=g.b2ContactFeatureType.e_vertex,tc.cf.typeB=g.b2ContactFeatureType.e_face,++te}return te}var e0=new ey,e2=new eg,e3=new eS;function Pe(g,v,O,X,Y,te){var ti=e0.Reset();ti.proxyA.SetShape(g,v),ti.proxyB.SetShape(O,X),ti.transformA.Copy(Y),ti.transformB.Copy(te),ti.useRadii=!0;var tr=e2.Reset();tr.count=0;var ta=e3.Reset();return ne(ta,tr,ti),ta.distance<10*S}function De(g){if(null===g)throw new Error;return g}var e4=function(){function t1(g){void 0===g&&(g=0),this.m_id=0,this.aabb=new e$,this._userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=g}var g=t1.prototype;return g.Reset=function(){this._userData=null},g.IsLeaf=function(){return null===this.child1},n(t1,[{key:"userData",get:function(){if(null===this._userData)throw new Error;return this._userData},set:function(g){if(null!==this._userData)throw new Error;this._userData=g}}]),t1}(),e8=function(){function t1(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new ef(256)}var g=t1.prototype;return g.Query=function(g,v){var S=this.m_stack.Reset();for(S.Push(this.m_root);S.GetCount()>0;){var O=S.Pop();if(null!==O&&O.aabb.TestOverlap(g)){if(O.IsLeaf()){if(!v(O))return}else S.Push(O.child1),S.Push(O.child2)}}},g.QueryPoint=function(g,v){var S=this.m_stack.Reset();for(S.Push(this.m_root);S.GetCount()>0;){var O=S.Pop();if(null!==O&&O.aabb.TestContain(g)){if(O.IsLeaf()){if(!v(O))return}else S.Push(O.child1),S.Push(O.child2)}}},g.RayCast=function(g,v){var S=g.p1,O=g.p2,X=t8.SubVV(O,S,t1.s_r);X.Normalize();var Y=t8.CrossOneV(X,t1.s_v),te=t8.AbsV(Y,t1.s_abs_v),ti=g.maxFraction,tr=t1.s_segmentAABB,ta=S.x+ti*(O.x-S.x),th=S.y+ti*(O.y-S.y);tr.lowerBound.x=rt(S.x,ta),tr.lowerBound.y=rt(S.y,th),tr.upperBound.x=st(S.x,ta),tr.upperBound.y=st(S.y,th);var tu=this.m_stack.Reset();for(tu.Push(this.m_root);tu.GetCount()>0;){var tl=tu.Pop();if(null!==tl&&xe(tl.aabb,tr)){var tc=tl.aabb.GetCenter(),t_=tl.aabb.GetExtents();if(!(tq(t8.DotVV(Y,t8.SubVV(S,tc,t8.s_t0)))-t8.DotVV(te,t_)>0)){if(tl.IsLeaf()){var tf=t1.s_subInput;tf.p1.Copy(g.p1),tf.p2.Copy(g.p2),tf.maxFraction=ti;var tp=v(tf,tl);if(0===tp)return;tp>0&&(ti=tp,ta=S.x+ti*(O.x-S.x),th=S.y+ti*(O.y-S.y),tr.lowerBound.x=rt(S.x,ta),tr.lowerBound.y=rt(S.y,th),tr.upperBound.x=st(S.x,ta),tr.upperBound.y=st(S.y,th))}else tu.Push(tl.child1),tu.Push(tl.child2)}}}},g.AllocateNode=function(){if(null!==this.m_freeList){var g=this.m_freeList;return this.m_freeList=g.parent,g.parent=null,g.child1=null,g.child2=null,g.height=0,g}return new e4(t1.s_node_id++)},g.FreeNode=function(g){g.parent=this.m_freeList,g.child1=null,g.child2=null,g.height=-1,g.Reset(),this.m_freeList=g},g.CreateProxy=function(g,v){var S=this.AllocateNode(),O=ti,X=ti;return S.aabb.lowerBound.x=g.lowerBound.x-O,S.aabb.lowerBound.y=g.lowerBound.y-X,S.aabb.upperBound.x=g.upperBound.x+O,S.aabb.upperBound.y=g.upperBound.y+X,S.userData=v,S.height=0,this.InsertLeaf(S),S},g.DestroyProxy=function(g){this.RemoveLeaf(g),this.FreeNode(g)},g.MoveProxy=function(g,v,S){if(g.aabb.Contains(v))return!1;this.RemoveLeaf(g);var O=ti,X=ti;g.aabb.lowerBound.x=v.lowerBound.x-O,g.aabb.lowerBound.y=v.lowerBound.y-X,g.aabb.upperBound.x=v.upperBound.x+O,g.aabb.upperBound.y=v.upperBound.y+X;var Y=tr*S.x,te=tr*S.y;return Y<0?g.aabb.lowerBound.x+=Y:g.aabb.upperBound.x+=Y,te<0?g.aabb.lowerBound.y+=te:g.aabb.upperBound.y+=te,this.InsertLeaf(g),!0},g.InsertLeaf=function(g){if(++this.m_insertionCount,null===this.m_root)return this.m_root=g,void(this.m_root.parent=null);for(var v=g.aabb,S=this.m_root;!S.IsLeaf();){var O=De(S.child1),X=De(S.child2),Y=S.aabb.GetPerimeter(),te=t1.s_combinedAABB;te.Combine2(S.aabb,v);var ti=te.GetPerimeter(),tr=2*ti,ta=2*(ti-Y),th=void 0,tu=t1.s_aabb,tl=void 0;O.IsLeaf()?(tu.Combine2(v,O.aabb),th=tu.GetPerimeter()+ta):(tu.Combine2(v,O.aabb),tl=O.aabb.GetPerimeter(),th=tu.GetPerimeter()-tl+ta);var tc=void 0;if(X.IsLeaf()?(tu.Combine2(v,X.aabb),tc=tu.GetPerimeter()+ta):(tu.Combine2(v,X.aabb),tl=X.aabb.GetPerimeter(),tc=tu.GetPerimeter()-tl+ta),tr<th&&tr<tc)break;S=th<tc?O:X}var t_=S.parent,tf=this.AllocateNode();tf.parent=t_,tf.aabb.Combine2(v,S.aabb),tf.height=S.height+1,null!==t_?(t_.child1===S?t_.child1=tf:t_.child2=tf,tf.child1=S,tf.child2=g,S.parent=tf,g.parent=tf):(tf.child1=S,tf.child2=g,S.parent=tf,g.parent=tf,this.m_root=tf);for(var tp=g.parent;null!==tp;){var tm=De((tp=this.Balance(tp)).child1),tg=De(tp.child2);tp.height=1+st(tm.height,tg.height),tp.aabb.Combine2(tm.aabb,tg.aabb),tp=tp.parent}},g.RemoveLeaf=function(g){if(g!==this.m_root){var v=De(g.parent),S=v&&v.parent,O=De(v.child1===g?v.child2:v.child1);if(null!==S){S.child1===v?S.child1=O:S.child2=O,O.parent=S,this.FreeNode(v);for(var X=S;null!==X;){var Y=De((X=this.Balance(X)).child1),te=De(X.child2);X.aabb.Combine2(Y.aabb,te.aabb),X.height=1+st(Y.height,te.height),X=X.parent}}else this.m_root=O,O.parent=null,this.FreeNode(v)}else this.m_root=null},g.Balance=function(g){if(g.IsLeaf()||g.height<2)return g;var v=De(g.child1),S=De(g.child2),O=S.height-v.height;if(O>1){var X=De(S.child1),Y=De(S.child2);return S.child1=g,S.parent=g.parent,g.parent=S,null!==S.parent?S.parent.child1===g?S.parent.child1=S:S.parent.child2=S:this.m_root=S,X.height>Y.height?(S.child2=X,g.child2=Y,Y.parent=g,g.aabb.Combine2(v.aabb,Y.aabb),S.aabb.Combine2(g.aabb,X.aabb),g.height=1+st(v.height,Y.height),S.height=1+st(g.height,X.height)):(S.child2=Y,g.child2=X,X.parent=g,g.aabb.Combine2(v.aabb,X.aabb),S.aabb.Combine2(g.aabb,Y.aabb),g.height=1+st(v.height,X.height),S.height=1+st(g.height,Y.height)),S}if(O<-1){var te=De(v.child1),ti=De(v.child2);return v.child1=g,v.parent=g.parent,g.parent=v,null!==v.parent?v.parent.child1===g?v.parent.child1=v:v.parent.child2=v:this.m_root=v,te.height>ti.height?(v.child2=te,g.child1=ti,ti.parent=g,g.aabb.Combine2(S.aabb,ti.aabb),v.aabb.Combine2(g.aabb,te.aabb),g.height=1+st(S.height,ti.height),v.height=1+st(g.height,te.height)):(v.child2=ti,g.child1=te,te.parent=g,g.aabb.Combine2(S.aabb,te.aabb),v.aabb.Combine2(g.aabb,ti.aabb),g.height=1+st(S.height,te.height),v.height=1+st(g.height,ti.height)),v}return g},g.GetHeight=function(){return null===this.m_root?0:this.m_root.height},t1.GetAreaNode=function(g){if(null===g)return 0;if(g.IsLeaf())return 0;var v=g.aabb.GetPerimeter();return(v+=t1.GetAreaNode(g.child1))+t1.GetAreaNode(g.child2)},g.GetAreaRatio=function(){if(null===this.m_root)return 0;var g=this.m_root.aabb.GetPerimeter();return t1.GetAreaNode(this.m_root)/g},t1.ComputeHeightNode=function(g){return null===g||g.IsLeaf()?0:1+st(t1.ComputeHeightNode(g.child1),t1.ComputeHeightNode(g.child2))},g.ComputeHeight=function(){return t1.ComputeHeightNode(this.m_root)},g.ValidateStructure=function(g){if(null!==g&&(this.m_root,!g.IsLeaf())){var v=De(g.child1),S=De(g.child2);this.ValidateStructure(v),this.ValidateStructure(S)}},g.ValidateMetrics=function(g){if(null!==g&&!g.IsLeaf()){var v=De(g.child1),S=De(g.child2);t1.s_aabb.Combine2(v.aabb,S.aabb),this.ValidateMetrics(v),this.ValidateMetrics(S)}},g.Validate=function(){},t1.GetMaxBalanceNode=function(g,v){if(null===g)return v;if(g.height<=1)return v;var S=De(g.child1),O=De(g.child2);return st(v,tq(O.height-S.height))},g.GetMaxBalance=function(){return t1.GetMaxBalanceNode(this.m_root,0)},g.RebuildBottomUp=function(){this.Validate()},t1.ShiftOriginNode=function(g,v){if(null!==g&&!(g.height<=1)){var S=g.child1,O=g.child2;t1.ShiftOriginNode(S,v),t1.ShiftOriginNode(O,v),g.aabb.lowerBound.SelfSub(v),g.aabb.upperBound.SelfSub(v)}},g.ShiftOrigin=function(g){t1.ShiftOriginNode(this.m_root,g)},t1}();function Le(g,v,S){var O=g[v];g[v]=g[S],g[S]=O}function Fe(g,v){return g<v}function Ne(g,v,S,O){void 0===v&&(v=0),void 0===S&&(S=g.length-v),void 0===O&&(O=Fe);for(var X=v,Y=[],te=0;;){for(;X+1<S;S++){var ti=g[X+Math.floor(Math.random()*(S-X))];Y[te++]=S;for(var tr=X-1;;){for(;O(g[++tr],ti););for(;O(ti,g[--S]););if(tr>=S)break;Le(g,tr,S)}}if(0===te)break;X=S,S=Y[--te]}return g}e8.s_r=new t8,e8.s_v=new t8,e8.s_abs_v=new t8,e8.s_segmentAABB=new e$,e8.s_subInput=new eZ,e8.s_combinedAABB=new e$,e8.s_aabb=new e$,e8.s_node_id=0;var Ge=function(g,v){this.proxyA=g,this.proxyB=v},e6=function(){function t1(){this.m_tree=new e8,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}var g=t1.prototype;return g.CreateProxy=function(g,v){var S=this.m_tree.CreateProxy(g,v);return++this.m_proxyCount,this.BufferMove(S),S},g.DestroyProxy=function(g){this.UnBufferMove(g),--this.m_proxyCount,this.m_tree.DestroyProxy(g)},g.MoveProxy=function(g,v,S){this.m_tree.MoveProxy(g,v,S)&&this.BufferMove(g)},g.TouchProxy=function(g){this.BufferMove(g)},g.GetProxyCount=function(){return this.m_proxyCount},g.UpdatePairs=function(g){var v=this;this.m_pairCount=0;for(var _$i=function(){var g=v.m_moveBuffer[S];if(null===g)return 1;var O=g.aabb;v.m_tree.Query(O,function(S){if(S.m_id===g.m_id)return!0;var O,X;if(S.m_id<g.m_id?(O=S,X=g):(O=g,X=S),v.m_pairCount===v.m_pairBuffer.length)v.m_pairBuffer[v.m_pairCount]=new Ge(O,X);else{var Y=v.m_pairBuffer[v.m_pairCount];Y.proxyA=O,Y.proxyB=X}return++v.m_pairCount,!0})},S=0;S<this.m_moveCount;++S)_$i();this.m_moveCount=0,Ne(this.m_pairBuffer,0,this.m_pairCount,Ve);for(var O=0;O<this.m_pairCount;){var X=this.m_pairBuffer[O];for(g(X.proxyA.userData,X.proxyB.userData),++O;O<this.m_pairCount;){var Y=this.m_pairBuffer[O];if(Y.proxyA.m_id!==X.proxyA.m_id||Y.proxyB.m_id!==X.proxyB.m_id)break;++O}}},g.Query=function(g,v){this.m_tree.Query(g,v)},g.QueryPoint=function(g,v){this.m_tree.QueryPoint(g,v)},g.RayCast=function(g,v){this.m_tree.RayCast(g,v)},g.GetTreeHeight=function(){return this.m_tree.GetHeight()},g.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},g.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},g.ShiftOrigin=function(g){this.m_tree.ShiftOrigin(g)},g.BufferMove=function(g){this.m_moveBuffer[this.m_moveCount]=g,++this.m_moveCount},g.UnBufferMove=function(g){var v=this.m_moveBuffer.indexOf(g);this.m_moveBuffer[v]=null},t1}();function Ve(g,v){return g.proxyA.m_id<v.proxyA.m_id||g.proxyA.m_id===v.proxyA.m_id&&g.proxyB.m_id<v.proxyB.m_id}function Ue(){g.b2_toiTime=0,g.b2_toiMaxTime=0,g.b2_toiCalls=0,g.b2_toiIters=0,g.b2_toiMaxIters=0,g.b2_toiRootIters=0,g.b2_toiMaxRootIters=0}g.b2_toiTime=0,g.b2_toiMaxTime=0,g.b2_toiCalls=0,g.b2_toiIters=0,g.b2_toiMaxIters=0,g.b2_toiRootIters=0,g.b2_toiMaxRootIters=0;var e7,e9=new er,ir=new er,is=new t8,ia=new t8,ih=new t8,iu=new t8,ic=new t8,_$Je=function(){this.proxyA=new em,this.proxyB=new em,this.sweepA=new ea,this.sweepB=new ea,this.tMax=0};(e7=g.b2TOIOutputState||(g.b2TOIOutputState={}))[e7.e_unknown=0]="e_unknown",e7[e7.e_failed=1]="e_failed",e7[e7.e_overlapped=2]="e_overlapped",e7[e7.e_touching=3]="e_touching",e7[e7.e_separated=4]="e_separated";var i_,Ze=function(){this.state=g.b2TOIOutputState.e_unknown,this.t=0};(i_=g.b2SeparationFunctionType||(g.b2SeparationFunctionType={}))[i_.e_unknown=-1]="e_unknown",i_[i_.e_points=0]="e_points",i_[i_.e_faceA=1]="e_faceA",i_[i_.e_faceB=2]="e_faceB";var id=function(){function e(){this.m_sweepA=new ea,this.m_sweepB=new ea,this.m_type=g.b2SeparationFunctionType.e_unknown,this.m_localPoint=new t8,this.m_axis=new t8}var v=e.prototype;return v.Initialize=function(v,S,O,X,Y,te){this.m_proxyA=S,this.m_proxyB=X;var ti=v.count;this.m_sweepA.Copy(O),this.m_sweepB.Copy(Y);var tr=e9,ta=ir;if(this.m_sweepA.GetTransform(tr,te),this.m_sweepB.GetTransform(ta,te),1===ti){this.m_type=g.b2SeparationFunctionType.e_points;var th=this.m_proxyA.GetVertex(v.indexA[0]),tu=this.m_proxyB.GetVertex(v.indexB[0]),tl=er.MulXV(tr,th,is),tc=er.MulXV(ta,tu,ia);t8.SubVV(tc,tl,this.m_axis);var t_=this.m_axis.Normalize();return this.m_localPoint.SetZero(),t_}if(v.indexA[0]===v.indexA[1]){this.m_type=g.b2SeparationFunctionType.e_faceB;var tf=this.m_proxyB.GetVertex(v.indexB[0]),tp=this.m_proxyB.GetVertex(v.indexB[1]);t8.CrossVOne(t8.SubVV(tp,tf,t8.s_t0),this.m_axis).SelfNormalize();var tm=en.MulRV(ta.q,this.m_axis,ih);t8.MidVV(tf,tp,this.m_localPoint);var tg=er.MulXV(ta,this.m_localPoint,ia),tv=this.m_proxyA.GetVertex(v.indexA[0]),ty=er.MulXV(tr,tv,is),tS=t8.DotVV(t8.SubVV(ty,tg,t8.s_t0),tm);return tS<0&&(this.m_axis.SelfNeg(),tS=-tS),tS}this.m_type=g.b2SeparationFunctionType.e_faceA;var tA=this.m_proxyA.GetVertex(v.indexA[0]),tT=this.m_proxyA.GetVertex(v.indexA[1]);t8.CrossVOne(t8.SubVV(tT,tA,t8.s_t0),this.m_axis).SelfNormalize();var tE=en.MulRV(tr.q,this.m_axis,ih);t8.MidVV(tA,tT,this.m_localPoint);var tC=er.MulXV(tr,this.m_localPoint,is),tx=this.m_proxyB.GetVertex(v.indexB[0]),tb=er.MulXV(ta,tx,ia),tw=t8.DotVV(t8.SubVV(tb,tC,t8.s_t0),tE);return tw<0&&(this.m_axis.SelfNeg(),tw=-tw),tw},v.FindMinSeparation=function(v,S,O){var X=e9,Y=ir;switch(this.m_sweepA.GetTransform(X,O),this.m_sweepB.GetTransform(Y,O),this.m_type){case g.b2SeparationFunctionType.e_points:var te=en.MulTRV(X.q,this.m_axis,iu),ti=en.MulTRV(Y.q,t8.NegV(this.m_axis,t8.s_t0),ic);v[0]=this.m_proxyA.GetSupport(te),S[0]=this.m_proxyB.GetSupport(ti);var tr=this.m_proxyA.GetVertex(v[0]),ta=this.m_proxyB.GetVertex(S[0]),th=er.MulXV(X,tr,is),tu=er.MulXV(Y,ta,ia);return t8.DotVV(t8.SubVV(tu,th,t8.s_t0),this.m_axis);case g.b2SeparationFunctionType.e_faceA:var tl=en.MulRV(X.q,this.m_axis,ih),tc=er.MulXV(X,this.m_localPoint,is),t_=en.MulTRV(Y.q,t8.NegV(tl,t8.s_t0),ic);v[0]=-1,S[0]=this.m_proxyB.GetSupport(t_);var tf=this.m_proxyB.GetVertex(S[0]),tp=er.MulXV(Y,tf,ia);return t8.DotVV(t8.SubVV(tp,tc,t8.s_t0),tl);case g.b2SeparationFunctionType.e_faceB:var tm=en.MulRV(Y.q,this.m_axis,ih),tg=er.MulXV(Y,this.m_localPoint,ia),tv=en.MulTRV(X.q,t8.NegV(tm,t8.s_t0),iu);S[0]=-1,v[0]=this.m_proxyA.GetSupport(tv);var ty=this.m_proxyA.GetVertex(v[0]),tS=er.MulXV(X,ty,is);return t8.DotVV(t8.SubVV(tS,tg,t8.s_t0),tm);default:return v[0]=-1,S[0]=-1,0}},v.Evaluate=function(v,S,O){var X=e9,Y=ir;switch(this.m_sweepA.GetTransform(X,O),this.m_sweepB.GetTransform(Y,O),this.m_type){case g.b2SeparationFunctionType.e_points:var te=this.m_proxyA.GetVertex(v),ti=this.m_proxyB.GetVertex(S),tr=er.MulXV(X,te,is),ta=er.MulXV(Y,ti,ia);return t8.DotVV(t8.SubVV(ta,tr,t8.s_t0),this.m_axis);case g.b2SeparationFunctionType.e_faceA:var th=en.MulRV(X.q,this.m_axis,ih),tu=er.MulXV(X,this.m_localPoint,is),tl=this.m_proxyB.GetVertex(S),tc=er.MulXV(Y,tl,ia);return t8.DotVV(t8.SubVV(tc,tu,t8.s_t0),th);case g.b2SeparationFunctionType.e_faceB:var t_=en.MulRV(Y.q,this.m_axis,ih),tf=er.MulXV(Y,this.m_localPoint,ia),tp=this.m_proxyA.GetVertex(v),tm=er.MulXV(X,tp,is);return t8.DotVV(t8.SubVV(tm,tf,t8.s_t0),t_);default:return 0}},e}(),ip=new ec,im=new eg,ig=new ey,iS=new eS,iT=new id,iE=[0],iC=[0],ix=new ea,ib=new ea;function ui(v,S){var O=ip.Reset();++g.b2_toiCalls,v.state=g.b2TOIOutputState.e_unknown,v.t=S.tMax;var X=S.proxyA,Y=S.proxyB,ti=st(te,st(X.m_count,Y.m_count)),tr=ix.Copy(S.sweepA),th=ib.Copy(S.sweepB);tr.Normalize(),th.Normalize();var tu=S.tMax,tl=X.m_radius+Y.m_radius,tc=st(ta,tl-3*ta),t_=.25*ta,tf=0,tp=20,tm=0,tg=im;tg.count=0;var tv=ig;for(tv.proxyA.Copy(S.proxyA),tv.proxyB.Copy(S.proxyB),tv.useRadii=!1;;){var ty=e9,tS=ir;tr.GetTransform(ty,tf),th.GetTransform(tS,tf),tv.transformA.Copy(ty),tv.transformB.Copy(tS);var tA=iS;if(ne(tA,tg,tv),tA.distance<=0){v.state=g.b2TOIOutputState.e_overlapped,v.t=0;break}if(tA.distance<tc+t_){v.state=g.b2TOIOutputState.e_touching,v.t=tf;break}var tT=iT;tT.Initialize(tg,X,tr,Y,th,tf);for(var tE=!1,tC=tu,tx=0;;){var tb=iE,tw=iC,tI=tT.FindMinSeparation(tb,tw,tC);if(tI>tc+t_){v.state=g.b2TOIOutputState.e_separated,v.t=tu,tE=!0;break}if(tI>tc-t_){tf=tC;break}var tB=tT.Evaluate(tb[0],tw[0],tf);if(tB<tc-t_){v.state=g.b2TOIOutputState.e_failed,v.t=tf,tE=!0;break}if(tB<=tc+t_){v.state=g.b2TOIOutputState.e_touching,v.t=tf,tE=!0;break}for(var tP=0,tD=tf,tM=tC;;){var tO=0;tO=1&tP?tD+(tc-tB)*(tM-tD)/(tI-tB):.5*(tD+tM),++tP,++g.b2_toiRootIters;var tk=tT.Evaluate(tb[0],tw[0],tO);if(tq(tk-tc)<t_){tC=tO;break}if(tk>tc?(tD=tO,tB=tk):(tM=tO,tI=tk),50===tP)break}if(g.b2_toiMaxRootIters=st(g.b2_toiMaxRootIters,tP),++tx===ti)break}if(++tm,++g.b2_toiIters,tE)break;if(tm===tp){v.state=g.b2TOIOutputState.e_failed,v.t=tf;break}}g.b2_toiMaxIters=st(g.b2_toiMaxIters,tm);var tG=O.GetMilliseconds();g.b2_toiMaxTime=st(g.b2_toiMaxTime,tG),g.b2_toiTime+=tG}var iR=new t8,iw=new t8;function _i(v,S,O,X,Y){v.pointCount=0;var te=er.MulXV(O,S.m_p,iR),ti=er.MulXV(Y,X.m_p,iw),tr=t8.DistanceSquaredVV(te,ti),ta=S.m_radius+X.m_radius;tr>ta*ta||(v.type=g.b2ManifoldType.e_circles,v.localPoint.Copy(S.m_p),v.localNormal.SetZero(),v.pointCount=1,v.points[0].localPoint.Copy(X.m_p),v.points[0].id.key=0)}var iI=new t8,iB=new t8,iP=new t8;function mi(O,X,Y,te,ti){O.pointCount=0;for(var tr=er.MulXV(ti,te.m_p,iI),ta=er.MulTXV(Y,tr,iB),th=0,tu=-v,tl=X.m_radius+te.m_radius,tc=X.m_count,t_=X.m_vertices,tf=X.m_normals,tp=0;tp<tc;++tp){var tm=t8.DotVV(tf[tp],t8.SubVV(ta,t_[tp],t8.s_t0));if(tm>tl)return;tm>tu&&(tu=tm,th=tp)}var tg=th,tv=(tg+1)%tc,ty=t_[tg],tS=t_[tv];if(tu<S)return O.pointCount=1,O.type=g.b2ManifoldType.e_faceA,O.localNormal.Copy(tf[th]),t8.MidVV(ty,tS,O.localPoint),O.points[0].localPoint.Copy(te.m_p),void(O.points[0].id.key=0);var tA=t8.DotVV(t8.SubVV(ta,ty,t8.s_t0),t8.SubVV(tS,ty,t8.s_t1)),tT=t8.DotVV(t8.SubVV(ta,tS,t8.s_t0),t8.SubVV(ty,tS,t8.s_t1));if(tA<=0){if(t8.DistanceSquaredVV(ta,ty)>tl*tl)return;O.pointCount=1,O.type=g.b2ManifoldType.e_faceA,t8.SubVV(ta,ty,O.localNormal).SelfNormalize(),O.localPoint.Copy(ty),O.points[0].localPoint.Copy(te.m_p),O.points[0].id.key=0}else if(tT<=0){if(t8.DistanceSquaredVV(ta,tS)>tl*tl)return;O.pointCount=1,O.type=g.b2ManifoldType.e_faceA,t8.SubVV(ta,tS,O.localNormal).SelfNormalize(),O.localPoint.Copy(tS),O.points[0].localPoint.Copy(te.m_p),O.points[0].id.key=0}else{var tE=t8.MidVV(ty,tS,iP);if(t8.DotVV(t8.SubVV(ta,tE,t8.s_t1),tf[tg])>tl)return;O.pointCount=1,O.type=g.b2ManifoldType.e_faceA,O.localNormal.Copy(tf[tg]).SelfNormalize(),O.localPoint.Copy(tE),O.points[0].localPoint.Copy(te.m_p),O.points[0].id.key=0}}var iD=new t8,iM=new t8,iO=new t8,iL=new t8;function Ai(g,S,O,X,Y){for(var te=g.m_vertices,ti=g.m_normals,tr=X.m_count,ta=X.m_vertices,th=en.MulRV(S.q,ti[O],iD),tu=en.MulTRV(Y.q,th,iM),tl=0,tc=v,t_=0;t_<tr;++t_){var tf=t8.DotVV(ta[t_],tu);tf<tc&&(tc=tf,tl=t_)}var tp=er.MulXV(S,te[O],iO),tm=er.MulXV(Y,ta[tl],iL);return t8.DotVV(t8.SubVV(tm,tp,t8.s_t0),th)}var iF=new t8,ik=new t8;function Ci(g,S,O,X,Y){for(var te=S.m_count,ti=S.m_normals,tr=t8.SubVV(er.MulXV(Y,X.m_centroid,t8.s_t0),er.MulXV(O,S.m_centroid,t8.s_t1),iF),ta=en.MulTRV(O.q,tr,ik),th=0,tu=-v,tl=0;tl<te;++tl){var tc=t8.DotVV(ti[tl],ta);tc>tu&&(tu=tc,th=tl)}var t_=Ai(S,O,th,X,Y),tf=(th+te-1)%te,tp=Ai(S,O,tf,X,Y),tm=(th+1)%te,tg=Ai(S,O,tm,X,Y),tv=0,ty=0,tS=0;if(tp>t_&&tp>tg)tS=-1,tv=tf,ty=tp;else{if(!(tg>t_))return g[0]=th,t_;tS=1,tv=tm,ty=tg}for(;(t_=Ai(S,O,th=-1===tS?(tv+te-1)%te:(tv+1)%te,X,Y))>ty;)tv=th,ty=t_;return g[0]=tv,ty}var iG=new t8;function xi(S,O,X,Y,te,ti){for(var tr=O.m_normals,ta=te.m_count,th=te.m_vertices,tu=te.m_normals,tl=en.MulTRV(ti.q,en.MulRV(X.q,tr[Y],t8.s_t0),iG),tc=0,t_=v,tf=0;tf<ta;++tf){var tp=t8.DotVV(tl,tu[tf]);tp<t_&&(t_=tp,tc=tf)}var tm=tc,tg=(tm+1)%ta,tv=S[0];er.MulXV(ti,th[tm],tv.v);var ty=tv.id.cf;ty.indexA=Y,ty.indexB=tm,ty.typeA=g.b2ContactFeatureType.e_face,ty.typeB=g.b2ContactFeatureType.e_vertex;var tS=S[1];er.MulXV(ti,th[tg],tS.v);var tA=tS.id.cf;tA.indexA=Y,tA.indexB=tg,tA.typeA=g.b2ContactFeatureType.e_face,tA.typeB=g.b2ContactFeatureType.e_vertex}var iV=eJ.MakeArray(2),iU=eJ.MakeArray(2),iH=eJ.MakeArray(2),iz=[0],iW=[0],ij=new t8,iq=new t8,iY=new t8,iK=new t8,iJ=new t8,iZ=new t8,iQ=new t8,i0=new t8;function Vi(v,S,O,X,te){v.pointCount=0;var ti=S.m_radius+X.m_radius,tr=iz;tr[0]=0;var ta=Ci(tr,S,O,X,te);if(!(ta>ti)){var th=iW;th[0]=0;var tu=Ci(th,X,te,S,O);if(!(tu>ti)){var tl,tc,t_,tf,tp=0,tm=0;tu>.98*ta+.001?(tl=X,tc=S,t_=te,tf=O,tp=th[0],v.type=g.b2ManifoldType.e_faceB,tm=1):(tl=S,tc=X,t_=O,tf=te,tp=tr[0],v.type=g.b2ManifoldType.e_faceA,tm=0);var tg=iV;xi(tg,tl,t_,tp,tc,tf);var tv=tl.m_count,ty=tl.m_vertices,tS=tp,tA=(tp+1)%tv,tT=ty[tS],tE=ty[tA],tC=t8.SubVV(tE,tT,ij);tC.Normalize();var tx=t8.CrossVOne(tC,iq),tb=t8.MidVV(tT,tE,iY),tw=en.MulRV(t_.q,tC,iJ),tI=t8.CrossVOne(tw,iK),tB=er.MulXV(t_,tT,iQ),tP=er.MulXV(t_,tE,i0),tD=t8.DotVV(tI,tB),tM=-t8.DotVV(tw,tB)+ti,tO=t8.DotVV(tw,tP)+ti,tk=iU,tG=iH;if(!(Re(tk,tg,t8.NegV(tw,iZ),tM,tS)<2||Re(tG,tk,tw,tO,tA)<2)){v.localNormal.Copy(tx),v.localPoint.Copy(tb);for(var tV=0,tU=0;tU<Y;++tU){var tH=tG[tU];if(t8.DotVV(tI,tH.v)-tD<=ti){var tz=v.points[tV];if(er.MulTXV(tf,tH.v,tz.localPoint),tz.id.Copy(tH.id),tm){var tW=tz.id.cf;tz.id.cf.indexA=tW.indexB,tz.id.cf.indexB=tW.indexA,tz.id.cf.typeA=tW.typeB,tz.id.cf.typeB=tW.typeA}++tV}}v.pointCount=tV}}}}var i2,i3=new t8,i4=new t8,i8=new t8,i6=new t8,i7=new t8,i9=new t8,nn=new t8,nr=new eW;function Ji(v,S,O,X,Y){v.pointCount=0;var te=er.MulTXV(O,er.MulXV(Y,X.m_p,t8.s_t0),i3),ti=S.m_vertex1,tr=S.m_vertex2,ta=t8.SubVV(tr,ti,i4),th=t8.DotVV(ta,t8.SubVV(tr,te,t8.s_t0)),tu=t8.DotVV(ta,t8.SubVV(te,ti,t8.s_t0)),tl=S.m_radius+X.m_radius,tc=nr;if(tc.cf.indexB=0,tc.cf.typeB=g.b2ContactFeatureType.e_vertex,tu<=0){var t_=ti,tf=t8.SubVV(te,t_,i8);if(t8.DotVV(tf,tf)>tl*tl)return;if(S.m_hasVertex0){var tp=S.m_vertex0,tm=ti,tg=t8.SubVV(tm,tp,i6);if(t8.DotVV(tg,t8.SubVV(tm,te,t8.s_t0))>0)return}return tc.cf.indexA=0,tc.cf.typeA=g.b2ContactFeatureType.e_vertex,v.pointCount=1,v.type=g.b2ManifoldType.e_circles,v.localNormal.SetZero(),v.localPoint.Copy(t_),v.points[0].id.Copy(tc),void v.points[0].localPoint.Copy(X.m_p)}if(th<=0){var tv=tr,ty=t8.SubVV(te,tv,i8);if(t8.DotVV(ty,ty)>tl*tl)return;if(S.m_hasVertex3){var tS=S.m_vertex3,tA=tr,tT=t8.SubVV(tS,tA,i7);if(t8.DotVV(tT,t8.SubVV(te,tA,t8.s_t0))>0)return}return tc.cf.indexA=1,tc.cf.typeA=g.b2ContactFeatureType.e_vertex,v.pointCount=1,v.type=g.b2ManifoldType.e_circles,v.localNormal.SetZero(),v.localPoint.Copy(tv),v.points[0].id.Copy(tc),void v.points[0].localPoint.Copy(X.m_p)}var tE=t8.DotVV(ta,ta),tC=i9;tC.x=1/tE*(th*ti.x+tu*tr.x),tC.y=1/tE*(th*ti.y+tu*tr.y);var tx=t8.SubVV(te,tC,i8);if(!(t8.DotVV(tx,tx)>tl*tl)){var tb=nn.Set(-ta.y,ta.x);t8.DotVV(tb,t8.SubVV(te,ti,t8.s_t0))<0&&tb.Set(-tb.x,-tb.y),tb.Normalize(),tc.cf.indexA=0,tc.cf.typeA=g.b2ContactFeatureType.e_face,v.pointCount=1,v.type=g.b2ManifoldType.e_faceA,v.localNormal.Copy(tb),v.localPoint.Copy(ti),v.points[0].id.Copy(tc),v.points[0].localPoint.Copy(X.m_p)}}!function(g){g[g.e_unknown=0]="e_unknown",g[g.e_edgeA=1]="e_edgeA",g[g.e_edgeB=2]="e_edgeB"}(i2||(i2={}));var ns,Zi=function(){this.type=i2.e_unknown,this.index=0,this.separation=0},$i=function(){this.vertices=[],this.normals=[],this.count=0},tn=function(){this.i1=0,this.i2=0,this.v1=new t8,this.v2=new t8,this.normal=new t8,this.sideNormal1=new t8,this.sideOffset1=0,this.sideNormal2=new t8,this.sideOffset2=0};!function(g){g[g.e_isolated=0]="e_isolated",g[g.e_concave=1]="e_concave",g[g.e_convex=2]="e_convex"}(ns||(ns={}));var na=function(){function e(){this.m_polygonB=new $i,this.m_xf=new er,this.m_centroidB=new t8,this.m_v0=new t8,this.m_v1=new t8,this.m_v2=new t8,this.m_v3=new t8,this.m_normal0=new t8,this.m_normal1=new t8,this.m_normal2=new t8,this.m_normal=new t8,this.m_type1=ns.e_isolated,this.m_type2=ns.e_isolated,this.m_lowerLimit=new t8,this.m_upperLimit=new t8,this.m_radius=0,this.m_front=!1}var S=e.prototype;return S.Collide=function(v,S,O,X,te){er.MulTXX(O,te,this.m_xf),er.MulXV(this.m_xf,X.m_centroid,this.m_centroidB),this.m_v0.Copy(S.m_vertex0),this.m_v1.Copy(S.m_vertex1),this.m_v2.Copy(S.m_vertex2),this.m_v3.Copy(S.m_vertex3);var ti=S.m_hasVertex0,tr=S.m_hasVertex3,ta=t8.SubVV(this.m_v2,this.m_v1,e.s_edge1);ta.Normalize(),this.m_normal1.Set(ta.y,-ta.x);var th=t8.DotVV(this.m_normal1,t8.SubVV(this.m_centroidB,this.m_v1,t8.s_t0)),tu=0,tl=0,tc=!1,t_=!1;if(ti){var tf=t8.SubVV(this.m_v1,this.m_v0,e.s_edge0);tf.Normalize(),this.m_normal0.Set(tf.y,-tf.x),tc=t8.CrossVV(tf,ta)>=0,tu=t8.DotVV(this.m_normal0,t8.SubVV(this.m_centroidB,this.m_v0,t8.s_t0))}if(tr){var tp=t8.SubVV(this.m_v3,this.m_v2,e.s_edge2);tp.Normalize(),this.m_normal2.Set(tp.y,-tp.x),t_=t8.CrossVV(ta,tp)>0,tl=t8.DotVV(this.m_normal2,t8.SubVV(this.m_centroidB,this.m_v2,t8.s_t0))}ti&&tr?tc&&t_?(this.m_front=tu>=0||th>=0||tl>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):tc?(this.m_front=tu>=0||th>=0&&tl>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):t_?(this.m_front=tl>=0||tu>=0&&th>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=tu>=0&&th>=0&&tl>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):ti?tc?(this.m_front=tu>=0||th>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=tu>=0&&th>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):tr?t_?(this.m_front=th>=0||tl>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=th>=0&&tl>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=th>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=X.m_count;for(var tm=0;tm<X.m_count;++tm)this.m_polygonB.vertices.length<=tm&&this.m_polygonB.vertices.push(new t8),this.m_polygonB.normals.length<=tm&&this.m_polygonB.normals.push(new t8),er.MulXV(this.m_xf,X.m_vertices[tm],this.m_polygonB.vertices[tm]),en.MulRV(this.m_xf.q,X.m_normals[tm],this.m_polygonB.normals[tm]);this.m_radius=X.m_radius+S.m_radius,v.pointCount=0;var tg=this.ComputeEdgeSeparation(e.s_edgeAxis);if(tg.type!==i2.e_unknown&&!(tg.separation>this.m_radius)){var tv=this.ComputePolygonSeparation(e.s_polygonAxis);if(!(tv.type!==i2.e_unknown&&tv.separation>this.m_radius)){var ty,tS=.98,tA=.001;ty=tv.type===i2.e_unknown?tg:tv.separation>tS*tg.separation+tA?tv:tg;var tT=e.s_ie,tE=e.s_rf;if(ty.type===i2.e_edgeA){v.type=g.b2ManifoldType.e_faceA;for(var tC=0,tx=t8.DotVV(this.m_normal,this.m_polygonB.normals[0]),tb=1;tb<this.m_polygonB.count;++tb){var tw=t8.DotVV(this.m_normal,this.m_polygonB.normals[tb]);tw<tx&&(tx=tw,tC=tb)}var tI=tC,tB=(tI+1)%this.m_polygonB.count,tP=tT[0];tP.v.Copy(this.m_polygonB.vertices[tI]),tP.id.cf.indexA=0,tP.id.cf.indexB=tI,tP.id.cf.typeA=g.b2ContactFeatureType.e_face,tP.id.cf.typeB=g.b2ContactFeatureType.e_vertex;var tD=tT[1];tD.v.Copy(this.m_polygonB.vertices[tB]),tD.id.cf.indexA=0,tD.id.cf.indexB=tB,tD.id.cf.typeA=g.b2ContactFeatureType.e_face,tD.id.cf.typeB=g.b2ContactFeatureType.e_vertex,this.m_front?(tE.i1=0,tE.i2=1,tE.v1.Copy(this.m_v1),tE.v2.Copy(this.m_v2),tE.normal.Copy(this.m_normal1)):(tE.i1=1,tE.i2=0,tE.v1.Copy(this.m_v2),tE.v2.Copy(this.m_v1),tE.normal.Copy(this.m_normal1).SelfNeg())}else{v.type=g.b2ManifoldType.e_faceB;var tM=tT[0];tM.v.Copy(this.m_v1),tM.id.cf.indexA=0,tM.id.cf.indexB=ty.index,tM.id.cf.typeA=g.b2ContactFeatureType.e_vertex,tM.id.cf.typeB=g.b2ContactFeatureType.e_face;var tO=tT[1];tO.v.Copy(this.m_v2),tO.id.cf.indexA=0,tO.id.cf.indexB=ty.index,tO.id.cf.typeA=g.b2ContactFeatureType.e_vertex,tO.id.cf.typeB=g.b2ContactFeatureType.e_face,tE.i1=ty.index,tE.i2=(tE.i1+1)%this.m_polygonB.count,tE.v1.Copy(this.m_polygonB.vertices[tE.i1]),tE.v2.Copy(this.m_polygonB.vertices[tE.i2]),tE.normal.Copy(this.m_polygonB.normals[tE.i1])}tE.sideNormal1.Set(tE.normal.y,-tE.normal.x),tE.sideNormal2.Copy(tE.sideNormal1).SelfNeg(),tE.sideOffset1=t8.DotVV(tE.sideNormal1,tE.v1),tE.sideOffset2=t8.DotVV(tE.sideNormal2,tE.v2);var tk=e.s_clipPoints1,tG=e.s_clipPoints2;if(!(Re(tk,tT,tE.sideNormal1,tE.sideOffset1,tE.i1)<Y||Re(tG,tk,tE.sideNormal2,tE.sideOffset2,tE.i2)<Y)){ty.type===i2.e_edgeA?(v.localNormal.Copy(tE.normal),v.localPoint.Copy(tE.v1)):(v.localNormal.Copy(X.m_normals[tE.i1]),v.localPoint.Copy(X.m_vertices[tE.i1]));for(var tV=0,tU=0;tU<Y;++tU)if(t8.DotVV(tE.normal,t8.SubVV(tG[tU].v,tE.v1,t8.s_t0))<=this.m_radius){var tH=v.points[tV];ty.type===i2.e_edgeA?(er.MulTXV(this.m_xf,tG[tU].v,tH.localPoint),tH.id.Copy(tG[tU].id)):(tH.localPoint.Copy(tG[tU].v),tH.id.cf.typeA=tG[tU].id.cf.typeB,tH.id.cf.typeB=tG[tU].id.cf.typeA,tH.id.cf.indexA=tG[tU].id.cf.indexB,tH.id.cf.indexB=tG[tU].id.cf.indexA),++tV}v.pointCount=tV}}}},S.ComputeEdgeSeparation=function(g){var S=g;S.type=i2.e_edgeA,S.index=this.m_front?0:1,S.separation=v;for(var O=0;O<this.m_polygonB.count;++O){var X=t8.DotVV(this.m_normal,t8.SubVV(this.m_polygonB.vertices[O],this.m_v1,t8.s_t0));X<S.separation&&(S.separation=X)}return S},S.ComputePolygonSeparation=function(g){var S=g;S.type=i2.e_unknown,S.index=-1,S.separation=-v;for(var O=e.s_perp.Set(-this.m_normal.y,this.m_normal.x),X=0;X<this.m_polygonB.count;++X){var Y=t8.NegV(this.m_polygonB.normals[X],e.s_n),te=rt(t8.DotVV(Y,t8.SubVV(this.m_polygonB.vertices[X],this.m_v1,t8.s_t0)),t8.DotVV(Y,t8.SubVV(this.m_polygonB.vertices[X],this.m_v2,t8.s_t0)));if(te>this.m_radius)return S.type=i2.e_edgeB,S.index=X,S.separation=te,S;if(t8.DotVV(Y,O)>=0){if(t8.DotVV(t8.SubVV(Y,this.m_upperLimit,t8.s_t0),this.m_normal)<-th)continue}else if(t8.DotVV(t8.SubVV(Y,this.m_lowerLimit,t8.s_t0),this.m_normal)<-th)continue;te>S.separation&&(S.type=i2.e_edgeB,S.index=X,S.separation=te)}return S},e}();na.s_edge1=new t8,na.s_edge0=new t8,na.s_edge2=new t8,na.s_ie=eJ.MakeArray(2),na.s_rf=new tn,na.s_clipPoints1=eJ.MakeArray(2),na.s_clipPoints2=eJ.MakeArray(2),na.s_edgeAxis=new Zi,na.s_polygonAxis=new Zi,na.s_n=new t8,na.s_perp=new t8;var nh=new na;function rn(g,v,S,O,X){nh.Collide(g,v,S,O,X)}var nu,an=function(){this.mass=0,this.center=new t8(0,0),this.I=0};(nu=g.b2ShapeType||(g.b2ShapeType={}))[nu.e_unknown=-1]="e_unknown",nu[nu.e_circleShape=0]="e_circleShape",nu[nu.e_edgeShape=1]="e_edgeShape",nu[nu.e_polygonShape=2]="e_polygonShape",nu[nu.e_chainShape=3]="e_chainShape",nu[nu.e_shapeTypeCount=4]="e_shapeTypeCount";var nl=function(){function e(v,S){this.m_type=g.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=v,this.m_radius=S}var v=e.prototype;return v.Copy=function(g){return this.m_radius=g.m_radius,this},v.GetType=function(){return this.m_type},e}(),nc=function(v){function i(S){var O;return void 0===S&&(S=0),(O=v.call(this,g.b2ShapeType.e_circleShape,S)||this).m_p=new t8,O}s(i,v);var O=i.prototype;return O.Set=function(g,v){return void 0===v&&(v=this.m_radius),this.m_p.Copy(g),this.m_radius=v,this},O.Clone=function(){return(new i).Copy(this)},O.Copy=function(g){return v.prototype.Copy.call(this,g),this.m_p.Copy(g.m_p),this},O.GetChildCount=function(){return 1},O.TestPoint=function(g,v){var S=er.MulXV(g,this.m_p,i.TestPoint_s_center),O=t8.SubVV(v,S,i.TestPoint_s_d);return t8.DotVV(O,O)<=ut(this.m_radius)},O.ComputeDistance=function(g,v,S){var O=er.MulXV(g,this.m_p,i.ComputeDistance_s_center);return t8.SubVV(v,O,S),S.Normalize()-this.m_radius},O.RayCast=function(g,v,O){var X=er.MulXV(O,this.m_p,i.RayCast_s_position),Y=t8.SubVV(v.p1,X,i.RayCast_s_s),te=t8.DotVV(Y,Y)-ut(this.m_radius),ti=t8.SubVV(v.p2,v.p1,i.RayCast_s_r),tr=t8.DotVV(Y,ti),ta=t8.DotVV(ti,ti),th=tr*tr-ta*te;if(th<0||ta<S)return!1;var tu=-(tr+tZ(th));return 0<=tu&&tu<=v.maxFraction*ta&&(tu/=ta,g.fraction=tu,t8.AddVMulSV(Y,tu,ti,g.normal).SelfNormalize(),!0)},O.ComputeAABB=function(g,v){var S=er.MulXV(v,this.m_p,i.ComputeAABB_s_p);g.lowerBound.Set(S.x-this.m_radius,S.y-this.m_radius),g.upperBound.Set(S.x+this.m_radius,S.y+this.m_radius)},O.ComputeMass=function(g,v){var S=ut(this.m_radius);g.mass=v*X*S,g.center.Copy(this.m_p),g.I=g.mass*(.5*S+t8.DotVV(this.m_p,this.m_p))},O.SetupDistanceProxy=function(g){g.m_vertices=g.m_buffer,g.m_vertices[0].Copy(this.m_p),g.m_count=1,g.m_radius=this.m_radius},O.ComputeSubmergedArea=function(g,v,O,Y){var te=er.MulXV(O,this.m_p,new t8),ti=-(t8.DotVV(g,te)-v);if(ti<-this.m_radius+S)return 0;if(ti>this.m_radius)return Y.Copy(te),X*this.m_radius*this.m_radius;var tr=this.m_radius*this.m_radius,ta=ti*ti,th=tr*(t3(ti/this.m_radius)+X/2)+ti*tZ(tr-ta),tu=-2/3*tQ(tr-ta,1.5)/th;return Y.x=te.x+g.x*tu,Y.y=te.y+g.y*tu,th},O.Dump=function(g){g("    const shape: b2CircleShape = new b2CircleShape();\n"),g("    shape.m_radius = %.15f;\n",this.m_radius),g("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},i}(nl);nc.TestPoint_s_center=new t8,nc.TestPoint_s_d=new t8,nc.ComputeDistance_s_center=new t8,nc.RayCast_s_position=new t8,nc.RayCast_s_s=new t8,nc.RayCast_s_r=new t8,nc.ComputeAABB_s_p=new t8;var n_=function(O){function i(){var v;return(v=O.call(this,g.b2ShapeType.e_polygonShape,tu)||this).m_centroid=new t8(0,0),v.m_vertices=[],v.m_normals=[],v.m_count=0,v}s(i,O);var X=i.prototype;return X.Clone=function(){return(new i).Copy(this)},X.Copy=function(g){O.prototype.Copy.call(this,g),this.m_centroid.Copy(g.m_centroid),this.m_count=g.m_count,this.m_vertices=t8.MakeArray(this.m_count),this.m_normals=t8.MakeArray(this.m_count);for(var v=0;v<this.m_count;++v)this.m_vertices[v].Copy(g.m_vertices[v]),this.m_normals[v].Copy(g.m_normals[v]);return this},X.GetChildCount=function(){return 1},X.Set=function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];if("number"==typeof v[0][0]){var O=v[0];if(O.length%2!=0)throw new Error;return this._Set(function(g){return{x:O[2*g],y:O[2*g+1]}},O.length/2)}var X=v[0],Y=v[1]||X.length;return this._Set(function(g){return X[g]},Y)},X._Set=function(g,v){if(v<3)return this.SetAsBox(1,1);for(var S=v,O=[],X=0;X<S;++X){for(var Y=g(X),te=!0,ti=0;ti<O.length;++ti)if(t8.DistanceSquaredVV(Y,O[ti])<.25*ta*ta){te=!1;break}te&&O.push(Y)}if((S=O.length)<3)return this.SetAsBox(1,1);for(var tr=0,th=O[0].x,tu=1;tu<S;++tu){var tl=O[tu].x;(tl>th||tl===th&&O[tu].y<O[tr].y)&&(tr=tu,th=tl)}for(var tc=[],t_=0,tf=tr;;){tc[t_]=tf;for(var tp=0,tm=1;tm<S;++tm)if(tp!==tf){var tg=t8.SubVV(O[tp],O[tc[t_]],i.Set_s_r),tv=t8.SubVV(O[tm],O[tc[t_]],i.Set_s_v),ty=t8.CrossVV(tg,tv);ty<0&&(tp=tm),0===ty&&tv.LengthSquared()>tg.LengthSquared()&&(tp=tm)}else tp=tm;if(++t_,tf=tp,tp===tr)break}this.m_count=t_,this.m_vertices=t8.MakeArray(this.m_count),this.m_normals=t8.MakeArray(this.m_count);for(var tS=0;tS<t_;++tS)this.m_vertices[tS].Copy(O[tc[tS]]);for(var tA=0;tA<t_;++tA){var tT=this.m_vertices[tA],tE=this.m_vertices[(tA+1)%t_],tC=t8.SubVV(tE,tT,t8.s_t0);t8.CrossVOne(tC,this.m_normals[tA]).SelfNormalize()}return i.ComputeCentroid(this.m_vertices,t_,this.m_centroid),this},X.SetAsBox=function(g,v,S,O){if(void 0===O&&(O=0),this.m_count=4,this.m_vertices=t8.MakeArray(this.m_count),this.m_normals=t8.MakeArray(this.m_count),this.m_vertices[0].Set(-g,-v),this.m_vertices[1].Set(g,-v),this.m_vertices[2].Set(g,v),this.m_vertices[3].Set(-g,v),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),S){this.m_centroid.Copy(S);var X=new er;X.SetPosition(S),X.SetRotationAngle(O);for(var Y=0;Y<this.m_count;++Y)er.MulXV(X,this.m_vertices[Y],this.m_vertices[Y]),en.MulRV(X.q,this.m_normals[Y],this.m_normals[Y])}return this},X.TestPoint=function(g,v){for(var S=er.MulTXV(g,v,i.TestPoint_s_pLocal),O=0;O<this.m_count;++O)if(t8.DotVV(this.m_normals[O],t8.SubVV(S,this.m_vertices[O],t8.s_t0))>0)return!1;return!0},X.ComputeDistance=function(g,S,O){for(var X=er.MulTXV(g,S,i.ComputeDistance_s_pLocal),Y=-v,te=i.ComputeDistance_s_normalForMaxDistance.Copy(X),ti=0;ti<this.m_count;++ti){var tr=t8.DotVV(this.m_normals[ti],t8.SubVV(X,this.m_vertices[ti],t8.s_t0));tr>Y&&(Y=tr,te.Copy(this.m_normals[ti]))}if(Y>0){for(var ta=i.ComputeDistance_s_minDistance.Copy(te),th=Y*Y,tu=0;tu<this.m_count;++tu){var tl=t8.SubVV(X,this.m_vertices[tu],i.ComputeDistance_s_distance),tc=tl.LengthSquared();th>tc&&(ta.Copy(tl),th=tc)}return en.MulRV(g.q,ta,O),O.Normalize(),Math.sqrt(th)}return en.MulRV(g.q,te,O),Y},X.RayCast=function(g,v,S){for(var O=er.MulTXV(S,v.p1,i.RayCast_s_p1),X=er.MulTXV(S,v.p2,i.RayCast_s_p2),Y=t8.SubVV(X,O,i.RayCast_s_d),te=0,ti=v.maxFraction,tr=-1,ta=0;ta<this.m_count;++ta){var th=t8.DotVV(this.m_normals[ta],t8.SubVV(this.m_vertices[ta],O,t8.s_t0)),tu=t8.DotVV(this.m_normals[ta],Y);if(0===tu){if(th<0)return!1}else tu<0&&th<te*tu?(te=th/tu,tr=ta):tu>0&&th<ti*tu&&(ti=th/tu);if(ti<te)return!1}return tr>=0&&(g.fraction=te,en.MulRV(S.q,this.m_normals[tr],g.normal),!0)},X.ComputeAABB=function(g,v){for(var S=er.MulXV(v,this.m_vertices[0],g.lowerBound),O=g.upperBound.Copy(S),X=0;X<this.m_count;++X){var Y=er.MulXV(v,this.m_vertices[X],i.ComputeAABB_s_v);t8.MinV(Y,S,S),t8.MaxV(Y,O,O)}var te=this.m_radius;S.SelfSubXY(te,te),O.SelfAddXY(te,te)},X.ComputeMass=function(g,v){for(var S=i.ComputeMass_s_center.SetZero(),O=0,X=0,Y=i.ComputeMass_s_s.SetZero(),te=0;te<this.m_count;++te)Y.SelfAdd(this.m_vertices[te]);Y.SelfMul(1/this.m_count);for(var ti=1/3,tr=0;tr<this.m_count;++tr){var ta=t8.SubVV(this.m_vertices[tr],Y,i.ComputeMass_s_e1),th=t8.SubVV(this.m_vertices[(tr+1)%this.m_count],Y,i.ComputeMass_s_e2),tu=t8.CrossVV(ta,th),tl=.5*tu;O+=tl,S.SelfAdd(t8.MulSV(tl*ti,t8.AddVV(ta,th,t8.s_t0),t8.s_t1));var tc=ta.x,t_=ta.y,tf=th.x,tp=th.y;X+=.25*ti*tu*(tc*tc+tf*tc+tf*tf+t_*t_+tp*t_+tp*tp)}g.mass=v*O,S.SelfMul(1/O),t8.AddVV(S,Y,g.center),g.I=v*X,g.I+=g.mass*(t8.DotVV(g.center,g.center)-t8.DotVV(S,S))},X.Validate=function(){for(var g=0;g<this.m_count;++g)for(var v=g,S=(g+1)%this.m_count,O=this.m_vertices[v],X=t8.SubVV(this.m_vertices[S],O,i.Validate_s_e),Y=0;Y<this.m_count;++Y)if(Y!==v&&Y!==S){var te=t8.SubVV(this.m_vertices[Y],O,i.Validate_s_v);if(t8.CrossVV(X,te)<0)return!1}return!0},X.SetupDistanceProxy=function(g){g.m_vertices=this.m_vertices,g.m_count=this.m_count,g.m_radius=this.m_radius},X.ComputeSubmergedArea=function(g,v,O,X){for(var Y=en.MulTRV(O.q,g,i.ComputeSubmergedArea_s_normalL),te=v-t8.DotVV(g,O.p),ti=[],tr=0,ta=-1,th=-1,tu=!1,tl=0;tl<this.m_count;++tl){ti[tl]=t8.DotVV(Y,this.m_vertices[tl])-te;var tc=ti[tl]<-S;tl>0&&(tc?tu||(ta=tl-1,tr++):tu&&(th=tl-1,tr++)),tu=tc}switch(tr){case 0:if(tu){var t_=i.ComputeSubmergedArea_s_md;return this.ComputeMass(t_,1),er.MulXV(O,t_.center,X),t_.mass}return 0;case 1:-1===ta?ta=this.m_count-1:th=this.m_count-1}for(var tf,tp=(ta+1)%this.m_count,tm=(th+1)%this.m_count,tg=(0-ti[ta])/(ti[tp]-ti[ta]),tv=(0-ti[th])/(ti[tm]-ti[th]),ty=i.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[ta].x*(1-tg)+this.m_vertices[tp].x*tg,this.m_vertices[ta].y*(1-tg)+this.m_vertices[tp].y*tg),tS=i.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[th].x*(1-tv)+this.m_vertices[tm].x*tv,this.m_vertices[th].y*(1-tv)+this.m_vertices[tm].y*tv),tA=0,tT=i.ComputeSubmergedArea_s_center.SetZero(),tE=this.m_vertices[tp],tC=tp;tC!==tm;){tf=(tC=(tC+1)%this.m_count)===tm?tS:this.m_vertices[tC];var tx=.5*((tE.x-ty.x)*(tf.y-ty.y)-(tE.y-ty.y)*(tf.x-ty.x));tA+=tx,tT.x+=tx*(ty.x+tE.x+tf.x)/3,tT.y+=tx*(ty.y+tE.y+tf.y)/3,tE=tf}return tT.SelfMul(1/tA),er.MulXV(O,tT,X),tA},X.Dump=function(g){g("    const shape: b2PolygonShape = new b2PolygonShape();\n"),g("    const vs: b2Vec2[] = [];\n");for(var v=0;v<this.m_count;++v)g("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",v,this.m_vertices[v].x,this.m_vertices[v].y);g("    shape.Set(vs, %d);\n",this.m_count)},i.ComputeCentroid=function(g,v,S){var O=S;O.SetZero();for(var X=0,Y=i.ComputeCentroid_s_pRef.SetZero(),te=1/3,ti=0;ti<v;++ti){var tr=Y,ta=g[ti],th=g[(ti+1)%v],tu=t8.SubVV(ta,tr,i.ComputeCentroid_s_e1),tl=t8.SubVV(th,tr,i.ComputeCentroid_s_e2),tc=.5*t8.CrossVV(tu,tl);X+=tc,O.x+=tc*te*(tr.x+ta.x+th.x),O.y+=tc*te*(tr.y+ta.y+th.y)}return O.SelfMul(1/X),O},i}(nl);n_.Set_s_r=new t8,n_.Set_s_v=new t8,n_.TestPoint_s_pLocal=new t8,n_.ComputeDistance_s_pLocal=new t8,n_.ComputeDistance_s_normalForMaxDistance=new t8,n_.ComputeDistance_s_minDistance=new t8,n_.ComputeDistance_s_distance=new t8,n_.RayCast_s_p1=new t8,n_.RayCast_s_p2=new t8,n_.RayCast_s_d=new t8,n_.ComputeAABB_s_v=new t8,n_.ComputeMass_s_center=new t8,n_.ComputeMass_s_s=new t8,n_.ComputeMass_s_e1=new t8,n_.ComputeMass_s_e2=new t8,n_.Validate_s_e=new t8,n_.Validate_s_v=new t8,n_.ComputeSubmergedArea_s_normalL=new t8,n_.ComputeSubmergedArea_s_md=new an,n_.ComputeSubmergedArea_s_intoVec=new t8,n_.ComputeSubmergedArea_s_outoVec=new t8,n_.ComputeSubmergedArea_s_center=new t8,n_.ComputeCentroid_s_pRef=new t8,n_.ComputeCentroid_s_e1=new t8,n_.ComputeCentroid_s_e2=new t8;var nf=function(v){function i(){var S;return(S=v.call(this,g.b2ShapeType.e_edgeShape,tu)||this).m_vertex1=new t8,S.m_vertex2=new t8,S.m_vertex0=new t8,S.m_vertex3=new t8,S.m_hasVertex0=!1,S.m_hasVertex3=!1,S}s(i,v);var S=i.prototype;return S.Set=function(g,v){return this.m_vertex1.Copy(g),this.m_vertex2.Copy(v),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},S.Clone=function(){return(new i).Copy(this)},S.Copy=function(g){return v.prototype.Copy.call(this,g),this.m_vertex1.Copy(g.m_vertex1),this.m_vertex2.Copy(g.m_vertex2),this.m_vertex0.Copy(g.m_vertex0),this.m_vertex3.Copy(g.m_vertex3),this.m_hasVertex0=g.m_hasVertex0,this.m_hasVertex3=g.m_hasVertex3,this},S.GetChildCount=function(){return 1},S.TestPoint=function(){return!1},S.ComputeDistance=function(g,v,S){var O=er.MulXV(g,this.m_vertex1,i.ComputeDistance_s_v1),X=er.MulXV(g,this.m_vertex2,i.ComputeDistance_s_v2),Y=t8.SubVV(v,O,i.ComputeDistance_s_d),te=t8.SubVV(X,O,i.ComputeDistance_s_s),ti=t8.DotVV(Y,te);if(ti>0){var tr=t8.DotVV(te,te);ti>tr?t8.SubVV(v,X,Y):Y.SelfMulSub(ti/tr,te)}return S.Copy(Y),S.Normalize()},S.RayCast=function(g,v,S){var O=er.MulTXV(S,v.p1,i.RayCast_s_p1),X=er.MulTXV(S,v.p2,i.RayCast_s_p2),Y=t8.SubVV(X,O,i.RayCast_s_d),te=this.m_vertex1,ti=this.m_vertex2,tr=t8.SubVV(ti,te,i.RayCast_s_e),ta=g.normal.Set(tr.y,-tr.x).SelfNormalize(),th=t8.DotVV(ta,t8.SubVV(te,O,t8.s_t0)),tu=t8.DotVV(ta,Y);if(0===tu)return!1;var tl=th/tu;if(tl<0||v.maxFraction<tl)return!1;var tc=t8.AddVMulSV(O,tl,Y,i.RayCast_s_q),t_=t8.SubVV(ti,te,i.RayCast_s_r),tf=t8.DotVV(t_,t_);if(0===tf)return!1;var tp=t8.DotVV(t8.SubVV(tc,te,t8.s_t0),t_)/tf;return!(tp<0||1<tp||(g.fraction=tl,en.MulRV(S.q,g.normal,g.normal),th>0&&g.normal.SelfNeg(),0))},S.ComputeAABB=function(g,v){var S=er.MulXV(v,this.m_vertex1,i.ComputeAABB_s_v1),O=er.MulXV(v,this.m_vertex2,i.ComputeAABB_s_v2);t8.MinV(S,O,g.lowerBound),t8.MaxV(S,O,g.upperBound);var X=this.m_radius;g.lowerBound.SelfSubXY(X,X),g.upperBound.SelfAddXY(X,X)},S.ComputeMass=function(g){g.mass=0,t8.MidVV(this.m_vertex1,this.m_vertex2,g.center),g.I=0},S.SetupDistanceProxy=function(g){g.m_vertices=g.m_buffer,g.m_vertices[0].Copy(this.m_vertex1),g.m_vertices[1].Copy(this.m_vertex2),g.m_count=2,g.m_radius=this.m_radius},S.ComputeSubmergedArea=function(g,v,S,O){return O.SetZero(),0},S.Dump=function(g){g("    const shape: b2EdgeShape = new b2EdgeShape();\n"),g("    shape.m_radius = %.15f;\n",this.m_radius),g("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),g("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),g("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),g("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),g("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),g("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},i}(nl);nf.ComputeDistance_s_v1=new t8,nf.ComputeDistance_s_v2=new t8,nf.ComputeDistance_s_d=new t8,nf.ComputeDistance_s_s=new t8,nf.RayCast_s_p1=new t8,nf.RayCast_s_p2=new t8,nf.RayCast_s_d=new t8,nf.RayCast_s_e=new t8,nf.RayCast_s_q=new t8,nf.RayCast_s_r=new t8,nf.ComputeAABB_s_v1=new t8,nf.ComputeAABB_s_v2=new t8;var nd=function(v){function i(){var S;return(S=v.call(this,g.b2ShapeType.e_chainShape,tu)||this).m_vertices=[],S.m_count=0,S.m_prevVertex=new t8,S.m_nextVertex=new t8,S.m_hasPrevVertex=!1,S.m_hasNextVertex=!1,S}s(i,v);var S=i.prototype;return S.CreateLoop=function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];if("number"==typeof v[0][0]){var O=v[0];if(O.length%2!=0)throw new Error;return this._CreateLoop(function(g){return{x:O[2*g],y:O[2*g+1]}},O.length/2)}var X=v[0],Y=v[1]||X.length;return this._CreateLoop(function(g){return X[g]},Y)},S._CreateLoop=function(g,v){if(v<3)return this;this.m_count=v+1,this.m_vertices=t8.MakeArray(this.m_count);for(var S=0;S<v;++S)this.m_vertices[S].Copy(g(S));return this.m_vertices[v].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},S.CreateChain=function(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];if("number"==typeof v[0][0]){var O=v[0];if(O.length%2!=0)throw new Error;return this._CreateChain(function(g){return{x:O[2*g],y:O[2*g+1]}},O.length/2)}var X=v[0],Y=v[1]||X.length;return this._CreateChain(function(g){return X[g]},Y)},S._CreateChain=function(g,v){this.m_count=v,this.m_vertices=t8.MakeArray(v);for(var S=0;S<v;++S)this.m_vertices[S].Copy(g(S));return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},S.SetPrevVertex=function(g){return this.m_prevVertex.Copy(g),this.m_hasPrevVertex=!0,this},S.SetNextVertex=function(g){return this.m_nextVertex.Copy(g),this.m_hasNextVertex=!0,this},S.Clone=function(){return(new i).Copy(this)},S.Copy=function(g){return v.prototype.Copy.call(this,g),this._CreateChain(function(v){return g.m_vertices[v]},g.m_count),this.m_prevVertex.Copy(g.m_prevVertex),this.m_nextVertex.Copy(g.m_nextVertex),this.m_hasPrevVertex=g.m_hasPrevVertex,this.m_hasNextVertex=g.m_hasNextVertex,this},S.GetChildCount=function(){return this.m_count-1},S.GetChildEdge=function(g,v){g.m_radius=this.m_radius,g.m_vertex1.Copy(this.m_vertices[v]),g.m_vertex2.Copy(this.m_vertices[v+1]),v>0?(g.m_vertex0.Copy(this.m_vertices[v-1]),g.m_hasVertex0=!0):(g.m_vertex0.Copy(this.m_prevVertex),g.m_hasVertex0=this.m_hasPrevVertex),v<this.m_count-2?(g.m_vertex3.Copy(this.m_vertices[v+2]),g.m_hasVertex3=!0):(g.m_vertex3.Copy(this.m_nextVertex),g.m_hasVertex3=this.m_hasNextVertex)},S.TestPoint=function(){return!1},S.ComputeDistance=function(g,v,S,O){var X=i.ComputeDistance_s_edgeShape;return this.GetChildEdge(X,O),X.ComputeDistance(g,v,S,0)},S.RayCast=function(g,v,S,O){var X=i.RayCast_s_edgeShape;return X.m_vertex1.Copy(this.m_vertices[O]),X.m_vertex2.Copy(this.m_vertices[(O+1)%this.m_count]),X.RayCast(g,v,S,0)},S.ComputeAABB=function(g,v,S){var O=this.m_vertices[S],X=this.m_vertices[(S+1)%this.m_count],Y=er.MulXV(v,O,i.ComputeAABB_s_v1),te=er.MulXV(v,X,i.ComputeAABB_s_v2);t8.MinV(Y,te,g.lowerBound),t8.MaxV(Y,te,g.upperBound)},S.ComputeMass=function(g){g.mass=0,g.center.SetZero(),g.I=0},S.SetupDistanceProxy=function(g,v){g.m_vertices=g.m_buffer,g.m_vertices[0].Copy(this.m_vertices[v]),v+1<this.m_count?g.m_vertices[1].Copy(this.m_vertices[v+1]):g.m_vertices[1].Copy(this.m_vertices[0]),g.m_count=2,g.m_radius=this.m_radius},S.ComputeSubmergedArea=function(g,v,S,O){return O.SetZero(),0},S.Dump=function(g){g("    const shape: b2ChainShape = new b2ChainShape();\n"),g("    const vs: b2Vec2[] = [];\n");for(var v=0;v<this.m_count;++v)g("    vs[%d] = new bVec2(%.15f, %.15f);\n",v,this.m_vertices[v].x,this.m_vertices[v].y);g("    shape.CreateChain(vs, %d);\n",this.m_count),g("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),g("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),g("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),g("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},i}(nl);nd.ComputeDistance_s_edgeShape=new nf,nd.RayCast_s_edgeShape=new nf,nd.ComputeAABB_s_v1=new t8,nd.ComputeAABB_s_v2=new t8;var np=function(){function t1(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}var g=t1.prototype;return g.Clone=function(){return(new t1).Copy(this)},g.Copy=function(g){return this.categoryBits=g.categoryBits,this.maskBits=g.maskBits,this.groupIndex=g.groupIndex||0,this},t1}();np.DEFAULT=new np;var fn=function(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new np},nm=function(){function t1(g,v){this.aabb=new e$,this.childIndex=0,this.fixture=g,this.childIndex=v,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),v),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}var g=t1.prototype;return g.Reset=function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)},g.Touch=function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)},g.Synchronize=function(g,v,S){if(g===v)this.fixture.m_shape.ComputeAABB(this.aabb,g,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,S);else{var O=t1.Synchronize_s_aabb1,X=t1.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(O,g,this.childIndex),this.fixture.m_shape.ComputeAABB(X,v,this.childIndex),this.aabb.Combine2(O,X),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,S)}},t1}();nm.Synchronize_s_aabb1=new e$,nm.Synchronize_s_aabb2=new e$;var ng,ny=function(){function t1(g,v){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_filter=new np,this.m_isSensor=!1,this.m_userData=null,this.m_body=g,this.m_shape=v.shape.Clone(),this.m_userData=i(v.userData,null),this.m_friction=i(v.friction,.2),this.m_restitution=i(v.restitution,0),this.m_filter.Copy(i(v.filter,np.DEFAULT)),this.m_isSensor=i(v.isSensor,!1),this.m_density=i(v.density,0)}var g=t1.prototype;return g.Reset=function(){},g.GetType=function(){return this.m_shape.GetType()},g.GetShape=function(){return this.m_shape},g.SetSensor=function(g){g!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=g)},g.IsSensor=function(){return this.m_isSensor},g.SetFilterData=function(g){this.m_filter.Copy(g),this.Refilter()},g.GetFilterData=function(){return this.m_filter},g.Refilter=function(){for(var g=this.m_body.GetContactList();g;){var v=g.contact,S=v.GetFixtureA(),O=v.GetFixtureB();S!==this&&O!==this||v.FlagForFiltering(),g=g.next}this.TouchProxies()},g.GetBody=function(){return this.m_body},g.GetNext=function(){return this.m_next},g.GetUserData=function(){return this.m_userData},g.SetUserData=function(g){this.m_userData=g},g.TestPoint=function(g){return this.m_shape.TestPoint(this.m_body.GetTransform(),g)},g.ComputeDistance=function(g,v,S){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),g,v,S)},g.RayCast=function(g,v,S){return this.m_shape.RayCast(g,v,this.m_body.GetTransform(),S)},g.GetMassData=function(g){return void 0===g&&(g=new an),this.m_shape.ComputeMass(g,this.m_density),g},g.SetDensity=function(g){this.m_density=g},g.GetDensity=function(){return this.m_density},g.GetFriction=function(){return this.m_friction},g.SetFriction=function(g){this.m_friction=g},g.GetRestitution=function(){return this.m_restitution},g.SetRestitution=function(g){this.m_restitution=g},g.GetAABB=function(g){return this.m_proxies[g].aabb},g.Dump=function(g,v){g("    const fd: b2FixtureDef = new b2FixtureDef();\n"),g("    fd.friction = %.15f;\n",this.m_friction),g("    fd.restitution = %.15f;\n",this.m_restitution),g("    fd.density = %.15f;\n",this.m_density),g("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),g("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),g("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),g("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(g),g("\n"),g("    fd.shape = shape;\n"),g("\n"),g("    bodies[%d].CreateFixture(fd);\n",v)},g.CreateProxies=function(){if(0!==this.m_proxies.length)throw new Error;for(var g=0;g<this.m_shape.GetChildCount();++g)this.m_proxies[g]=new nm(this,g)},g.DestroyProxies=function(){for(var g,v=f(this.m_proxies);!(g=v()).done;)g.value.Reset();this.m_proxies.length=0},g.TouchProxies=function(){for(var g,v=f(this.m_proxies);!(g=v()).done;)g.value.Touch()},g.SynchronizeProxies=function(g,v,S){for(var O,X=f(this.m_proxies);!(O=X()).done;)O.value.Synchronize(g,v,S)},n(t1,[{key:"m_proxyCount",get:function(){return this.m_proxies.length}}]),t1}();(ng=g.b2BodyType||(g.b2BodyType={}))[ng.b2_unknown=-1]="b2_unknown",ng[ng.b2_staticBody=0]="b2_staticBody",ng[ng.b2_kinematicBody=1]="b2_kinematicBody",ng[ng.b2_dynamicBody=2]="b2_dynamicBody";var nS,nT,yn=function(){this.type=g.b2BodyType.b2_staticBody,this.position=new t8(0,0),this.angle=0,this.linearVelocity=new t8(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1},nE=function(){function e(v,S){this.m_type=g.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new er,this.m_xf0=new er,this.m_sweep=new ea,this.m_linearVelocity=new t8,this.m_angularVelocity=0,this.m_force=new t8,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=i(v.bullet,!1),this.m_fixedRotationFlag=i(v.fixedRotation,!1),this.m_autoSleepFlag=i(v.allowSleep,!0),this.m_awakeFlag=i(v.awake,!0),this.m_activeFlag=i(v.active,!0),this.m_world=S,this.m_xf.p.Copy(i(v.position,t8.ZERO)),this.m_xf.q.SetAngle(i(v.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(i(v.linearVelocity,t8.ZERO)),this.m_angularVelocity=i(v.angularVelocity,0),this.m_linearDamping=i(v.linearDamping,0),this.m_angularDamping=i(v.angularDamping,0),this.m_gravityScale=i(v.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=i(v.type,g.b2BodyType.b2_staticBody),v.type===g.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=v.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}var v=e.prototype;return v.CreateFixture=function(g,v){return void 0===v&&(v=0),_instanceof(g,nl)?this.CreateFixtureShapeDensity(g,v):this.CreateFixtureDef(g)},v.CreateFixtureDef=function(g){if(this.m_world.IsLocked())throw new Error;var v=new ny(this,g);return this.m_activeFlag&&v.CreateProxies(),v.m_next=this.m_fixtureList,this.m_fixtureList=v,++this.m_fixtureCount,v.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,v},v.CreateFixtureShapeDensity=function(g,v){void 0===v&&(v=0);var S=e.CreateFixtureShapeDensity_s_def;return S.shape=g,S.density=v,this.CreateFixtureDef(S)},v.DestroyFixture=function(g){if(this.m_world.IsLocked())throw new Error;for(var v=this.m_fixtureList,S=null;null!==v;){if(v===g){S?S.m_next=g.m_next:this.m_fixtureList=g.m_next;break}S=v,v=v.m_next}for(var O=this.m_contactList;O;){var X=O.contact;O=O.next;var Y=X.GetFixtureA(),te=X.GetFixtureB();g!==Y&&g!==te||this.m_world.m_contactManager.Destroy(X)}this.m_activeFlag&&g.DestroyProxies(),g.m_next=null,g.Reset(),--this.m_fixtureCount,this.ResetMassData()},v.SetTransformVec=function(g,v){this.SetTransformXY(g.x,g.y,v)},v.SetTransformXY=function(g,v,S){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(S),this.m_xf.p.Set(g,v),this.m_xf0.Copy(this.m_xf),er.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=S,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=S;for(var O=this.m_fixtureList;O;O=O.m_next)O.SynchronizeProxies(this.m_xf,this.m_xf,t8.ZERO);this.m_world.m_contactManager.FindNewContacts()},v.SetTransform=function(g){this.SetTransformVec(g.p,g.GetAngle())},v.GetTransform=function(){return this.m_xf},v.GetPosition=function(){return this.m_xf.p},v.SetPosition=function(g){this.SetTransformVec(g,this.GetAngle())},v.SetPositionXY=function(g,v){this.SetTransformXY(g,v,this.GetAngle())},v.GetAngle=function(){return this.m_sweep.a},v.SetAngle=function(g){this.SetTransformVec(this.GetPosition(),g)},v.GetWorldCenter=function(){return this.m_sweep.c},v.GetLocalCenter=function(){return this.m_sweep.localCenter},v.SetLinearVelocity=function(v){this.m_type!==g.b2BodyType.b2_staticBody&&(t8.DotVV(v,v)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(v))},v.GetLinearVelocity=function(){return this.m_linearVelocity},v.SetAngularVelocity=function(v){this.m_type!==g.b2BodyType.b2_staticBody&&(v*v>0&&this.SetAwake(!0),this.m_angularVelocity=v)},v.GetAngularVelocity=function(){return this.m_angularVelocity},v.GetDefinition=function(g){return g.type=this.GetType(),g.allowSleep=this.m_autoSleepFlag,g.angle=this.GetAngle(),g.angularDamping=this.m_angularDamping,g.gravityScale=this.m_gravityScale,g.angularVelocity=this.m_angularVelocity,g.fixedRotation=this.m_fixedRotationFlag,g.bullet=this.m_bulletFlag,g.awake=this.m_awakeFlag,g.linearDamping=this.m_linearDamping,g.linearVelocity.Copy(this.GetLinearVelocity()),g.position.Copy(this.GetPosition()),g.userData=this.GetUserData(),g},v.ApplyForce=function(v,S,O){void 0===O&&(O=!0),this.m_type===g.b2BodyType.b2_dynamicBody&&(O&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=v.x,this.m_force.y+=v.y,this.m_torque+=(S.x-this.m_sweep.c.x)*v.y-(S.y-this.m_sweep.c.y)*v.x))},v.ApplyForceToCenter=function(v,S){void 0===S&&(S=!0),this.m_type===g.b2BodyType.b2_dynamicBody&&(S&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=v.x,this.m_force.y+=v.y))},v.ApplyTorque=function(v,S){void 0===S&&(S=!0),this.m_type===g.b2BodyType.b2_dynamicBody&&(S&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=v))},v.ApplyLinearImpulse=function(v,S,O){void 0===O&&(O=!0),this.m_type===g.b2BodyType.b2_dynamicBody&&(O&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*v.x,this.m_linearVelocity.y+=this.m_invMass*v.y,this.m_angularVelocity+=this.m_invI*((S.x-this.m_sweep.c.x)*v.y-(S.y-this.m_sweep.c.y)*v.x)))},v.ApplyLinearImpulseToCenter=function(v,S){void 0===S&&(S=!0),this.m_type===g.b2BodyType.b2_dynamicBody&&(S&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*v.x,this.m_linearVelocity.y+=this.m_invMass*v.y))},v.ApplyAngularImpulse=function(v,S){void 0===S&&(S=!0),this.m_type===g.b2BodyType.b2_dynamicBody&&(S&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*v))},v.GetMass=function(){return this.m_mass},v.GetInertia=function(){return this.m_I+this.m_mass*t8.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},v.GetMassData=function(g){return g.mass=this.m_mass,g.I=this.m_I+this.m_mass*t8.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),g.center.Copy(this.m_sweep.localCenter),g},v.SetMassData=function(v){if(this.m_world.IsLocked())throw new Error;if(this.m_type===g.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=v.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,v.I>0&&!this.m_fixedRotationFlag&&(this.m_I=v.I-this.m_mass*t8.DotVV(v.center,v.center),this.m_invI=1/this.m_I);var S=e.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(v.center),er.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),t8.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t8.SubVV(this.m_sweep.c,S,t8.s_t0),this.m_linearVelocity)}},v.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===g.b2BodyType.b2_staticBody||this.m_type===g.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var v=e.ResetMassData_s_localCenter.SetZero(),S=this.m_fixtureList;S;S=S.m_next)if(0!==S.m_density){var O=S.GetMassData(e.ResetMassData_s_massData);this.m_mass+=O.mass,v.x+=O.center.x*O.mass,v.y+=O.center.y*O.mass,this.m_I+=O.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,v.x*=this.m_invMass,v.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*t8.DotVV(v,v),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var X=e.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(v),er.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),t8.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t8.SubVV(this.m_sweep.c,X,t8.s_t0),this.m_linearVelocity)},v.GetWorldPoint=function(g,v){return er.MulXV(this.m_xf,g,v)},v.GetWorldVector=function(g,v){return en.MulRV(this.m_xf.q,g,v)},v.GetLocalPoint=function(g,v){return er.MulTXV(this.m_xf,g,v)},v.GetLocalVector=function(g,v){return en.MulTRV(this.m_xf.q,g,v)},v.GetLinearVelocityFromWorldPoint=function(g,v){return t8.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t8.SubVV(g,this.m_sweep.c,t8.s_t0),v)},v.GetLinearVelocityFromLocalPoint=function(g,v){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(g,v),v)},v.GetLinearDamping=function(){return this.m_linearDamping},v.SetLinearDamping=function(g){this.m_linearDamping=g},v.GetAngularDamping=function(){return this.m_angularDamping},v.SetAngularDamping=function(g){this.m_angularDamping=g},v.GetGravityScale=function(){return this.m_gravityScale},v.SetGravityScale=function(g){this.m_gravityScale=g},v.SetType=function(v){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==v){this.m_type=v,this.ResetMassData(),this.m_type===g.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var S=this.m_contactList;S;){var O=S;S=S.next,this.m_world.m_contactManager.Destroy(O.contact)}this.m_contactList=null;for(var X=this.m_fixtureList;X;X=X.m_next)X.TouchProxies()}},v.GetType=function(){return this.m_type},v.SetBullet=function(g){this.m_bulletFlag=g},v.IsBullet=function(){return this.m_bulletFlag},v.SetSleepingAllowed=function(g){this.m_autoSleepFlag=g,g||this.SetAwake(!0)},v.IsSleepingAllowed=function(){return this.m_autoSleepFlag},v.SetAwake=function(g){g?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},v.IsAwake=function(){return this.m_awakeFlag},v.SetActive=function(g){if(this.m_world.IsLocked())throw new Error;if(g!==this.IsActive()){if(this.m_activeFlag=g,g)for(var v=this.m_fixtureList;v;v=v.m_next)v.CreateProxies();else{for(var S=this.m_fixtureList;S;S=S.m_next)S.DestroyProxies();for(var O=this.m_contactList;O;){var X=O;O=O.next,this.m_world.m_contactManager.Destroy(X.contact)}this.m_contactList=null}}},v.IsActive=function(){return this.m_activeFlag},v.SetFixedRotation=function(g){this.m_fixedRotationFlag!==g&&(this.m_fixedRotationFlag=g,this.m_angularVelocity=0,this.ResetMassData())},v.IsFixedRotation=function(){return this.m_fixedRotationFlag},v.GetFixtureList=function(){return this.m_fixtureList},v.GetJointList=function(){return this.m_jointList},v.GetContactList=function(){return this.m_contactList},v.GetNext=function(){return this.m_next},v.GetUserData=function(){return this.m_userData},v.SetUserData=function(g){this.m_userData=g},v.GetWorld=function(){return this.m_world},v.Dump=function(v){var S=this.m_islandIndex;v("{\n"),v("  const bd: b2BodyDef = new b2BodyDef();\n");var O="";switch(this.m_type){case g.b2BodyType.b2_staticBody:O="b2BodyType.b2_staticBody";break;case g.b2BodyType.b2_kinematicBody:O="b2BodyType.b2_kinematicBody";break;case g.b2BodyType.b2_dynamicBody:O="b2BodyType.b2_dynamicBody"}v("  bd.type = %s;\n",O),v("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),v("  bd.angle = %.15f;\n",this.m_sweep.a),v("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),v("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),v("  bd.linearDamping = %.15f;\n",this.m_linearDamping),v("  bd.angularDamping = %.15f;\n",this.m_angularDamping),v("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),v("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),v("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),v("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),v("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),v("  bd.gravityScale = %.15f;\n",this.m_gravityScale),v("\n"),v("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),v("\n");for(var X=this.m_fixtureList;X;X=X.m_next)v("  {\n"),X.Dump(v,S),v("  }\n");v("}\n")},v.SynchronizeFixtures=function(){var g=e.SynchronizeFixtures_s_xf1;g.q.SetAngle(this.m_sweep.a0),en.MulRV(g.q,this.m_sweep.localCenter,g.p),t8.SubVV(this.m_sweep.c0,g.p,g.p);for(var v=t8.SubVV(this.m_sweep.c,this.m_sweep.c0,e.SynchronizeFixtures_s_displacement),S=this.m_fixtureList;S;S=S.m_next)S.SynchronizeProxies(g,this.m_xf,v)},v.SynchronizeTransform=function(){this.m_xf.q.SetAngle(this.m_sweep.a),en.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),t8.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},v.ShouldCollide=function(v){return(this.m_type!==g.b2BodyType.b2_staticBody||v.m_type!==g.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(v)},v.ShouldCollideConnected=function(g){for(var v=this.m_jointList;v;v=v.next)if(v.other===g&&!v.joint.m_collideConnected)return!1;return!0},v.Advance=function(g){this.m_sweep.Advance(g),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),en.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),t8.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},v.GetControllerList=function(){return this.m_controllerList},v.GetControllerCount=function(){return this.m_controllerCount},e}();nE.CreateFixtureShapeDensity_s_def=new fn,nE.SetMassData_s_oldCenter=new t8,nE.ResetMassData_s_localCenter=new t8,nE.ResetMassData_s_oldCenter=new t8,nE.ResetMassData_s_massData=new an,nE.SynchronizeFixtures_s_xf1=new er,nE.SynchronizeFixtures_s_displacement=new t8,(nT=g.b2JointType||(g.b2JointType={}))[nT.e_unknownJoint=0]="e_unknownJoint",nT[nT.e_revoluteJoint=1]="e_revoluteJoint",nT[nT.e_prismaticJoint=2]="e_prismaticJoint",nT[nT.e_distanceJoint=3]="e_distanceJoint",nT[nT.e_pulleyJoint=4]="e_pulleyJoint",nT[nT.e_mouseJoint=5]="e_mouseJoint",nT[nT.e_gearJoint=6]="e_gearJoint",nT[nT.e_wheelJoint=7]="e_wheelJoint",nT[nT.e_weldJoint=8]="e_weldJoint",nT[nT.e_frictionJoint=9]="e_frictionJoint",nT[nT.e_ropeJoint=10]="e_ropeJoint",nT[nT.e_motorJoint=11]="e_motorJoint",nT[nT.e_areaJoint=12]="e_areaJoint",(nS=g.b2LimitState||(g.b2LimitState={}))[nS.e_inactiveLimit=0]="e_inactiveLimit",nS[nS.e_atLowerLimit=1]="e_atLowerLimit",nS[nS.e_atUpperLimit=2]="e_atUpperLimit",nS[nS.e_equalLimits=3]="e_equalLimits";var nC=function(){function t1(){this.linear=new t8,this.angularA=0,this.angularB=0}var g=t1.prototype;return g.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},g.Set=function(g,v,S){return this.linear.Copy(g),this.angularA=v,this.angularB=S,this},t1}(),nx=function(){function t1(g){this._other=null,this.prev=null,this.next=null,this.joint=g}return t1.prototype.Reset=function(){this._other=null,this.prev=null,this.next=null},n(t1,[{key:"other",get:function(){if(null===this._other)throw new Error;return this._other},set:function(g){if(null!==this._other)throw new Error;this._other=g}}]),t1}(),En=function(v){this.type=g.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=v},nb=function(){function e(v){this.m_type=g.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_edgeA=new nx(this),this.m_edgeB=new nx(this),this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=v.type,this.m_edgeA.other=v.bodyB,this.m_edgeB.other=v.bodyA,this.m_bodyA=v.bodyA,this.m_bodyB=v.bodyB,this.m_collideConnected=i(v.collideConnected,!1),this.m_userData=i(v.userData,null)}var v=e.prototype;return v.GetType=function(){return this.m_type},v.GetBodyA=function(){return this.m_bodyA},v.GetBodyB=function(){return this.m_bodyB},v.GetNext=function(){return this.m_next},v.GetUserData=function(){return this.m_userData},v.SetUserData=function(g){this.m_userData=g},v.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},v.GetCollideConnected=function(){return this.m_collideConnected},v.Dump=function(g){g("// Dump is not supported for this joint type.\n")},v.ShiftOrigin=function(){},e}(),nR=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_distanceJoint)||this).localAnchorA=new t8,S.localAnchorB=new t8,S.length=1,S.frequencyHz=0,S.dampingRatio=0,S}return s(i,v),i.prototype.Initialize=function(g,v,S,O){this.bodyA=g,this.bodyB=v,this.bodyA.GetLocalPoint(S,this.localAnchorA),this.bodyB.GetLocalPoint(O,this.localAnchorB),this.length=t8.DistanceVV(S,O),this.frequencyHz=0,this.dampingRatio=0},i}(En),nw=function(g){function e(v){var S;return(S=g.call(this,v)||this).m_frequencyHz=0,S.m_dampingRatio=0,S.m_bias=0,S.m_localAnchorA=new t8,S.m_localAnchorB=new t8,S.m_gamma=0,S.m_impulse=0,S.m_length=0,S.m_indexA=0,S.m_indexB=0,S.m_u=new t8,S.m_rA=new t8,S.m_rB=new t8,S.m_localCenterA=new t8,S.m_localCenterB=new t8,S.m_invMassA=0,S.m_invMassB=0,S.m_invIA=0,S.m_invIB=0,S.m_mass=0,S.m_qA=new en,S.m_qB=new en,S.m_lalcA=new t8,S.m_lalcB=new t8,S.m_frequencyHz=i(v.frequencyHz,0),S.m_dampingRatio=i(v.dampingRatio,0),S.m_localAnchorA.Copy(v.localAnchorA),S.m_localAnchorB.Copy(v.localAnchorB),S.m_length=v.length,S}s(e,g);var v=e.prototype;return v.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},v.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},v.GetReactionForce=function(g,v){return v.x=g*this.m_impulse*this.m_u.x,v.y=g*this.m_impulse*this.m_u.y,v},v.GetReactionTorque=function(){return 0},v.GetLocalAnchorA=function(){return this.m_localAnchorA},v.GetLocalAnchorB=function(){return this.m_localAnchorB},v.SetLength=function(g){this.m_length=g},v.Length=function(){return this.m_length},v.SetFrequency=function(g){this.m_frequencyHz=g},v.GetFrequency=function(){return this.m_frequencyHz},v.SetDampingRatio=function(g){this.m_dampingRatio=g},v.GetDampingRatio=function(){return this.m_dampingRatio},v.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),g("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),g("  jd.length = %.15f;\n",this.m_length),g("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),g("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},v.InitVelocityConstraints=function(g){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.velocities[this.m_indexA].v,Y=g.velocities[this.m_indexA].w,te=g.positions[this.m_indexB].c,ti=g.positions[this.m_indexB].a,tr=g.velocities[this.m_indexB].v,th=g.velocities[this.m_indexB].w,tu=this.m_qA.SetAngle(S),tl=this.m_qB.SetAngle(ti);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),en.MulRV(tu,this.m_lalcA,this.m_rA),t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),en.MulRV(tl,this.m_lalcB,this.m_rB),this.m_u.x=te.x+this.m_rB.x-v.x-this.m_rA.x,this.m_u.y=te.y+this.m_rB.y-v.y-this.m_rA.y;var tc=this.m_u.Length();tc>ta?this.m_u.SelfMul(1/tc):this.m_u.SetZero();var t_=t8.CrossVV(this.m_rA,this.m_u),tf=t8.CrossVV(this.m_rB,this.m_u),tp=this.m_invMassA+this.m_invIA*t_*t_+this.m_invMassB+this.m_invIB*tf*tf;if(this.m_mass=0!==tp?1/tp:0,this.m_frequencyHz>0){var tm=tc-this.m_length,tg=2*X*this.m_frequencyHz,tv=2*this.m_mass*this.m_dampingRatio*tg,ty=this.m_mass*tg*tg,tS=g.step.dt;this.m_gamma=tS*(tv+tS*ty),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=tm*tS*ty*this.m_gamma,tp+=this.m_gamma,this.m_mass=0!==tp?1/tp:0}else this.m_gamma=0,this.m_bias=0;if(g.step.warmStarting){this.m_impulse*=g.step.dtRatio;var tA=t8.MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);O.SelfMulSub(this.m_invMassA,tA),Y-=this.m_invIA*t8.CrossVV(this.m_rA,tA),tr.SelfMulAdd(this.m_invMassB,tA),th+=this.m_invIB*t8.CrossVV(this.m_rB,tA)}else this.m_impulse=0;g.velocities[this.m_indexA].w=Y,g.velocities[this.m_indexB].w=th},v.SolveVelocityConstraints=function(g){var v=g.velocities[this.m_indexA].v,S=g.velocities[this.m_indexA].w,O=g.velocities[this.m_indexB].v,X=g.velocities[this.m_indexB].w,Y=t8.AddVCrossSV(v,S,this.m_rA,e.SolveVelocityConstraints_s_vpA),te=t8.AddVCrossSV(O,X,this.m_rB,e.SolveVelocityConstraints_s_vpB),ti=t8.DotVV(this.m_u,t8.SubVV(te,Y,t8.s_t0)),tr=-this.m_mass*(ti+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=tr;var ta=t8.MulSV(tr,this.m_u,e.SolveVelocityConstraints_s_P);v.SelfMulSub(this.m_invMassA,ta),S-=this.m_invIA*t8.CrossVV(this.m_rA,ta),O.SelfMulAdd(this.m_invMassB,ta),X+=this.m_invIB*t8.CrossVV(this.m_rB,ta),g.velocities[this.m_indexA].w=S,g.velocities[this.m_indexB].w=X},v.SolvePositionConstraints=function(g){if(this.m_frequencyHz>0)return!0;var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.positions[this.m_indexB].c,X=g.positions[this.m_indexB].a,Y=this.m_qA.SetAngle(S),te=this.m_qB.SetAngle(X),ti=en.MulRV(Y,this.m_lalcA,this.m_rA),tr=en.MulRV(te,this.m_lalcB,this.m_rB),th=this.m_u;th.x=O.x+tr.x-v.x-ti.x,th.y=O.y+tr.y-v.y-ti.y;var tu=this.m_u.Normalize()-this.m_length;tu=at(tu,-tf,tf);var tl=-this.m_mass*tu,tc=t8.MulSV(tl,th,e.SolvePositionConstraints_s_P);return v.SelfMulSub(this.m_invMassA,tc),S-=this.m_invIA*t8.CrossVV(ti,tc),O.SelfMulAdd(this.m_invMassB,tc),X+=this.m_invIB*t8.CrossVV(tr,tc),g.positions[this.m_indexA].a=S,g.positions[this.m_indexB].a=X,tq(tu)<ta},e}(nb);nw.InitVelocityConstraints_s_P=new t8,nw.SolveVelocityConstraints_s_vpA=new t8,nw.SolveVelocityConstraints_s_vpB=new t8,nw.SolveVelocityConstraints_s_P=new t8,nw.SolvePositionConstraints_s_P=new t8;var nI=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_areaJoint)||this).bodies=[],S.frequencyHz=0,S.dampingRatio=0,S}return s(i,v),i.prototype.AddBody=function(g){this.bodies.push(g),1===this.bodies.length?this.bodyA=g:2===this.bodies.length&&(this.bodyB=g)},i}(En),nB=function(g){function e(v){var S;(S=g.call(this,v)||this).m_frequencyHz=0,S.m_dampingRatio=0,S.m_impulse=0,S.m_targetArea=0,S.m_delta=new t8,S.m_bodies=v.bodies,S.m_frequencyHz=i(v.frequencyHz,0),S.m_dampingRatio=i(v.dampingRatio,0),S.m_targetLengths=$(v.bodies.length),S.m_normals=t8.MakeArray(v.bodies.length),S.m_joints=[],S.m_deltas=t8.MakeArray(v.bodies.length);var O=new nR;O.frequencyHz=S.m_frequencyHz,O.dampingRatio=S.m_dampingRatio,S.m_targetArea=0;for(var X=0;X<S.m_bodies.length;++X){var Y=S.m_bodies[X],te=S.m_bodies[(X+1)%S.m_bodies.length],ti=Y.GetWorldCenter(),tr=te.GetWorldCenter();S.m_targetLengths[X]=t8.DistanceVV(ti,tr),S.m_targetArea+=t8.CrossVV(ti,tr),O.Initialize(Y,te,ti,tr),S.m_joints[X]=Y.GetWorld().CreateJoint(O)}return S.m_targetArea*=.5,S}s(e,g);var v=e.prototype;return v.GetAnchorA=function(g){return g},v.GetAnchorB=function(g){return g},v.GetReactionForce=function(g,v){return v},v.GetReactionTorque=function(){return 0},v.SetFrequency=function(g){this.m_frequencyHz=g;for(var v=0;v<this.m_joints.length;++v)this.m_joints[v].SetFrequency(g)},v.GetFrequency=function(){return this.m_frequencyHz},v.SetDampingRatio=function(g){this.m_dampingRatio=g;for(var v=0;v<this.m_joints.length;++v)this.m_joints[v].SetDampingRatio(g)},v.GetDampingRatio=function(){return this.m_dampingRatio},v.Dump=function(g){g("Area joint dumping is not supported.\n")},v.InitVelocityConstraints=function(g){for(var v=0;v<this.m_bodies.length;++v){var S=this.m_bodies[(v+this.m_bodies.length-1)%this.m_bodies.length],O=this.m_bodies[(v+1)%this.m_bodies.length],X=g.positions[S.m_islandIndex].c,Y=g.positions[O.m_islandIndex].c,te=this.m_deltas[v];t8.SubVV(Y,X,te)}if(g.step.warmStarting){this.m_impulse*=g.step.dtRatio;for(var ti=0;ti<this.m_bodies.length;++ti){var tr=this.m_bodies[ti],ta=g.velocities[tr.m_islandIndex].v,th=this.m_deltas[ti];ta.x+=tr.m_invMass*th.y*.5*this.m_impulse,ta.y+=tr.m_invMass*-th.x*.5*this.m_impulse}}else this.m_impulse=0},v.SolveVelocityConstraints=function(g){for(var v=0,S=0,O=0;O<this.m_bodies.length;++O){var X=this.m_bodies[O],Y=g.velocities[X.m_islandIndex].v,te=this.m_deltas[O];v+=te.LengthSquared()/X.GetMass(),S+=t8.CrossVV(Y,te)}var ti=-2*S/v;this.m_impulse+=ti;for(var tr=0;tr<this.m_bodies.length;++tr){var ta=this.m_bodies[tr],th=g.velocities[ta.m_islandIndex].v,tu=this.m_deltas[tr];th.x+=ta.m_invMass*tu.y*.5*ti,th.y+=ta.m_invMass*-tu.x*.5*ti}},v.SolvePositionConstraints=function(g){for(var v=0,O=0,X=0;X<this.m_bodies.length;++X){var Y=this.m_bodies[X],te=this.m_bodies[(X+1)%this.m_bodies.length],ti=g.positions[Y.m_islandIndex].c,tr=g.positions[te.m_islandIndex].c,th=t8.SubVV(tr,ti,this.m_delta),tu=th.Length();tu<S&&(tu=1),this.m_normals[X].x=th.y/tu,this.m_normals[X].y=-th.x/tu,v+=tu,O+=t8.CrossVV(ti,tr)}O*=.5;for(var tl=.5*(this.m_targetArea-O)/v,tc=!0,t_=0;t_<this.m_bodies.length;++t_){var tp=this.m_bodies[t_],tm=g.positions[tp.m_islandIndex].c,tg=(t_+1)%this.m_bodies.length,tv=t8.AddVV(this.m_normals[t_],this.m_normals[tg],this.m_delta);tv.SelfMul(tl);var ty=tv.LengthSquared();ty>ut(tf)&&tv.SelfMul(tf/tZ(ty)),ty>ut(ta)&&(tc=!1),tm.x+=tv.x,tm.y+=tv.y}return tc},e}(nb),nP=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_frictionJoint)||this).localAnchorA=new t8,S.localAnchorB=new t8,S.maxForce=0,S.maxTorque=0,S}return s(i,v),i.prototype.Initialize=function(g,v,S){this.bodyA=g,this.bodyB=v,this.bodyA.GetLocalPoint(S,this.localAnchorA),this.bodyB.GetLocalPoint(S,this.localAnchorB)},i}(En),nD=function(g){function e(v){var S;return(S=g.call(this,v)||this).m_localAnchorA=new t8,S.m_localAnchorB=new t8,S.m_linearImpulse=new t8,S.m_angularImpulse=0,S.m_maxForce=0,S.m_maxTorque=0,S.m_indexA=0,S.m_indexB=0,S.m_rA=new t8,S.m_rB=new t8,S.m_localCenterA=new t8,S.m_localCenterB=new t8,S.m_invMassA=0,S.m_invMassB=0,S.m_invIA=0,S.m_invIB=0,S.m_linearMass=new t9,S.m_angularMass=0,S.m_qA=new en,S.m_qB=new en,S.m_lalcA=new t8,S.m_lalcB=new t8,S.m_K=new t9,S.m_localAnchorA.Copy(v.localAnchorA),S.m_localAnchorB.Copy(v.localAnchorB),S.m_linearImpulse.SetZero(),S.m_maxForce=i(v.maxForce,0),S.m_maxTorque=i(v.maxTorque,0),S.m_linearMass.SetZero(),S}s(e,g);var v=e.prototype;return v.InitVelocityConstraints=function(g){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var v=g.positions[this.m_indexA].a,S=g.velocities[this.m_indexA].v,O=g.velocities[this.m_indexA].w,X=g.positions[this.m_indexB].a,Y=g.velocities[this.m_indexB].v,te=g.velocities[this.m_indexB].w,ti=this.m_qA.SetAngle(v),tr=this.m_qB.SetAngle(X);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var ta=en.MulRV(ti,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var th=en.MulRV(tr,this.m_lalcB,this.m_rB),tu=this.m_invMassA,tl=this.m_invMassB,tc=this.m_invIA,t_=this.m_invIB,tf=this.m_K;if(tf.ex.x=tu+tl+tc*ta.y*ta.y+t_*th.y*th.y,tf.ex.y=-tc*ta.x*ta.y-t_*th.x*th.y,tf.ey.x=tf.ex.y,tf.ey.y=tu+tl+tc*ta.x*ta.x+t_*th.x*th.x,tf.GetInverse(this.m_linearMass),this.m_angularMass=tc+t_,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),g.step.warmStarting){this.m_linearImpulse.SelfMul(g.step.dtRatio),this.m_angularImpulse*=g.step.dtRatio;var tp=this.m_linearImpulse;S.SelfMulSub(tu,tp),O-=tc*(t8.CrossVV(this.m_rA,tp)+this.m_angularImpulse),Y.SelfMulAdd(tl,tp),te+=t_*(t8.CrossVV(this.m_rB,tp)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;g.velocities[this.m_indexA].w=O,g.velocities[this.m_indexB].w=te},v.SolveVelocityConstraints=function(g){var v=g.velocities[this.m_indexA].v,S=g.velocities[this.m_indexA].w,O=g.velocities[this.m_indexB].v,X=g.velocities[this.m_indexB].w,Y=this.m_invMassA,te=this.m_invMassB,ti=this.m_invIA,tr=this.m_invIB,ta=g.step.dt,th=X-S,tu=-this.m_angularMass*th,tl=this.m_angularImpulse,tc=ta*this.m_maxTorque;this.m_angularImpulse=at(this.m_angularImpulse+tu,-tc,tc),S-=ti*(tu=this.m_angularImpulse-tl),X+=tr*tu;var t_=t8.SubVV(t8.AddVCrossSV(O,X,this.m_rB,t8.s_t0),t8.AddVCrossSV(v,S,this.m_rA,t8.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),tf=t9.MulMV(this.m_linearMass,t_,e.SolveVelocityConstraints_s_impulseV).SelfNeg(),tp=e.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(tf);var tm=ta*this.m_maxForce;this.m_linearImpulse.LengthSquared()>tm*tm&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(tm)),t8.SubVV(this.m_linearImpulse,tp,tf),v.SelfMulSub(Y,tf),S-=ti*t8.CrossVV(this.m_rA,tf),O.SelfMulAdd(te,tf),X+=tr*t8.CrossVV(this.m_rB,tf),g.velocities[this.m_indexA].w=S,g.velocities[this.m_indexB].w=X},v.SolvePositionConstraints=function(){return!0},v.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},v.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},v.GetReactionForce=function(g,v){return v.x=g*this.m_linearImpulse.x,v.y=g*this.m_linearImpulse.y,v},v.GetReactionTorque=function(g){return g*this.m_angularImpulse},v.GetLocalAnchorA=function(){return this.m_localAnchorA},v.GetLocalAnchorB=function(){return this.m_localAnchorB},v.SetMaxForce=function(g){this.m_maxForce=g},v.GetMaxForce=function(){return this.m_maxForce},v.SetMaxTorque=function(g){this.m_maxTorque=g},v.GetMaxTorque=function(){return this.m_maxTorque},v.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),g("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),g("  jd.maxForce = %.15f;\n",this.m_maxForce),g("  jd.maxTorque = %.15f;\n",this.m_maxTorque),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e}(nb);nD.SolveVelocityConstraints_s_Cdot_v2=new t8,nD.SolveVelocityConstraints_s_impulseV=new t8,nD.SolveVelocityConstraints_s_oldImpulseV=new t8;var nM=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_gearJoint)||this).ratio=1,S}return s(i,v),i}(En),nO=function(v){function n(S){var O,X,Y;(O=v.call(this,S)||this).m_typeA=g.b2JointType.e_unknownJoint,O.m_typeB=g.b2JointType.e_unknownJoint,O.m_localAnchorA=new t8,O.m_localAnchorB=new t8,O.m_localAnchorC=new t8,O.m_localAnchorD=new t8,O.m_localAxisC=new t8,O.m_localAxisD=new t8,O.m_referenceAngleA=0,O.m_referenceAngleB=0,O.m_constant=0,O.m_ratio=0,O.m_impulse=0,O.m_indexA=0,O.m_indexB=0,O.m_indexC=0,O.m_indexD=0,O.m_lcA=new t8,O.m_lcB=new t8,O.m_lcC=new t8,O.m_lcD=new t8,O.m_mA=0,O.m_mB=0,O.m_mC=0,O.m_mD=0,O.m_iA=0,O.m_iB=0,O.m_iC=0,O.m_iD=0,O.m_JvAC=new t8,O.m_JvBD=new t8,O.m_JwA=0,O.m_JwB=0,O.m_JwC=0,O.m_JwD=0,O.m_mass=0,O.m_qA=new en,O.m_qB=new en,O.m_qC=new en,O.m_qD=new en,O.m_lalcA=new t8,O.m_lalcB=new t8,O.m_lalcC=new t8,O.m_lalcD=new t8,O.m_joint1=S.joint1,O.m_joint2=S.joint2,O.m_typeA=O.m_joint1.GetType(),O.m_typeB=O.m_joint2.GetType(),O.m_bodyC=O.m_joint1.GetBodyA(),O.m_bodyA=O.m_joint1.GetBodyB();var te=O.m_bodyA.m_xf,ti=O.m_bodyA.m_sweep.a,tr=O.m_bodyC.m_xf,ta=O.m_bodyC.m_sweep.a;if(O.m_typeA===g.b2JointType.e_revoluteJoint){var th=S.joint1;O.m_localAnchorC.Copy(th.m_localAnchorA),O.m_localAnchorA.Copy(th.m_localAnchorB),O.m_referenceAngleA=th.m_referenceAngle,O.m_localAxisC.SetZero(),X=ti-ta-O.m_referenceAngleA}else{var tu=S.joint1;O.m_localAnchorC.Copy(tu.m_localAnchorA),O.m_localAnchorA.Copy(tu.m_localAnchorB),O.m_referenceAngleA=tu.m_referenceAngle,O.m_localAxisC.Copy(tu.m_localXAxisA);var tl=O.m_localAnchorC,tc=en.MulTRV(tr.q,t8.AddVV(en.MulRV(te.q,O.m_localAnchorA,t8.s_t0),t8.SubVV(te.p,tr.p,t8.s_t1),t8.s_t0),t8.s_t0);X=t8.DotVV(t8.SubVV(tc,tl,t8.s_t0),O.m_localAxisC)}O.m_bodyD=O.m_joint2.GetBodyA(),O.m_bodyB=O.m_joint2.GetBodyB();var t_=O.m_bodyB.m_xf,tf=O.m_bodyB.m_sweep.a,tp=O.m_bodyD.m_xf,tm=O.m_bodyD.m_sweep.a;if(O.m_typeB===g.b2JointType.e_revoluteJoint){var tg=S.joint2;O.m_localAnchorD.Copy(tg.m_localAnchorA),O.m_localAnchorB.Copy(tg.m_localAnchorB),O.m_referenceAngleB=tg.m_referenceAngle,O.m_localAxisD.SetZero(),Y=tf-tm-O.m_referenceAngleB}else{var tv=S.joint2;O.m_localAnchorD.Copy(tv.m_localAnchorA),O.m_localAnchorB.Copy(tv.m_localAnchorB),O.m_referenceAngleB=tv.m_referenceAngle,O.m_localAxisD.Copy(tv.m_localXAxisA);var ty=O.m_localAnchorD,tS=en.MulTRV(tp.q,t8.AddVV(en.MulRV(t_.q,O.m_localAnchorB,t8.s_t0),t8.SubVV(t_.p,tp.p,t8.s_t1),t8.s_t0),t8.s_t0);Y=t8.DotVV(t8.SubVV(tS,ty,t8.s_t0),O.m_localAxisD)}return O.m_ratio=i(S.ratio,1),O.m_constant=X+O.m_ratio*Y,O.m_impulse=0,O}s(n,v);var S=n.prototype;return S.InitVelocityConstraints=function(v){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var S=v.positions[this.m_indexA].a,O=v.velocities[this.m_indexA].v,X=v.velocities[this.m_indexA].w,Y=v.positions[this.m_indexB].a,te=v.velocities[this.m_indexB].v,ti=v.velocities[this.m_indexB].w,tr=v.positions[this.m_indexC].a,ta=v.velocities[this.m_indexC].v,th=v.velocities[this.m_indexC].w,tu=v.positions[this.m_indexD].a,tl=v.velocities[this.m_indexD].v,tc=v.velocities[this.m_indexD].w,t_=this.m_qA.SetAngle(S),tf=this.m_qB.SetAngle(Y),tp=this.m_qC.SetAngle(tr),tm=this.m_qD.SetAngle(tu);if(this.m_mass=0,this.m_typeA===g.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var tg=en.MulRV(tp,this.m_localAxisC,n.InitVelocityConstraints_s_u);t8.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var tv=en.MulRV(tp,this.m_lalcC,n.InitVelocityConstraints_s_rC);t8.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var ty=en.MulRV(t_,this.m_lalcA,n.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(tg),this.m_JwC=t8.CrossVV(tv,tg),this.m_JwA=t8.CrossVV(ty,tg),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===g.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var tS=en.MulRV(tm,this.m_localAxisD,n.InitVelocityConstraints_s_u);t8.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var tA=en.MulRV(tm,this.m_lalcD,n.InitVelocityConstraints_s_rD);t8.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var tT=en.MulRV(tf,this.m_lalcB,n.InitVelocityConstraints_s_rB);t8.MulSV(this.m_ratio,tS,this.m_JvBD),this.m_JwD=this.m_ratio*t8.CrossVV(tA,tS),this.m_JwB=this.m_ratio*t8.CrossVV(tT,tS),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,v.step.warmStarting?(O.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),X+=this.m_iA*this.m_impulse*this.m_JwA,te.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),ti+=this.m_iB*this.m_impulse*this.m_JwB,ta.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),th-=this.m_iC*this.m_impulse*this.m_JwC,tl.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),tc-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,v.velocities[this.m_indexA].w=X,v.velocities[this.m_indexB].w=ti,v.velocities[this.m_indexC].w=th,v.velocities[this.m_indexD].w=tc},S.SolveVelocityConstraints=function(g){var v=g.velocities[this.m_indexA].v,S=g.velocities[this.m_indexA].w,O=g.velocities[this.m_indexB].v,X=g.velocities[this.m_indexB].w,Y=g.velocities[this.m_indexC].v,te=g.velocities[this.m_indexC].w,ti=g.velocities[this.m_indexD].v,tr=g.velocities[this.m_indexD].w,ta=t8.DotVV(this.m_JvAC,t8.SubVV(v,Y,t8.s_t0))+t8.DotVV(this.m_JvBD,t8.SubVV(O,ti,t8.s_t0));ta+=this.m_JwA*S-this.m_JwC*te+(this.m_JwB*X-this.m_JwD*tr);var th=-this.m_mass*ta;this.m_impulse+=th,v.SelfMulAdd(this.m_mA*th,this.m_JvAC),S+=this.m_iA*th*this.m_JwA,O.SelfMulAdd(this.m_mB*th,this.m_JvBD),X+=this.m_iB*th*this.m_JwB,Y.SelfMulSub(this.m_mC*th,this.m_JvAC),te-=this.m_iC*th*this.m_JwC,ti.SelfMulSub(this.m_mD*th,this.m_JvBD),tr-=this.m_iD*th*this.m_JwD,g.velocities[this.m_indexA].w=S,g.velocities[this.m_indexB].w=X,g.velocities[this.m_indexC].w=te,g.velocities[this.m_indexD].w=tr},S.SolvePositionConstraints=function(v){var S,O,X,Y,te,ti,tr=v.positions[this.m_indexA].c,th=v.positions[this.m_indexA].a,tu=v.positions[this.m_indexB].c,tl=v.positions[this.m_indexB].a,tc=v.positions[this.m_indexC].c,t_=v.positions[this.m_indexC].a,tf=v.positions[this.m_indexD].c,tp=v.positions[this.m_indexD].a,tm=this.m_qA.SetAngle(th),tg=this.m_qB.SetAngle(tl),tv=this.m_qC.SetAngle(t_),ty=this.m_qD.SetAngle(tp),tS=0,tA=this.m_JvAC,tT=this.m_JvBD,tE=0;if(this.m_typeA===g.b2JointType.e_revoluteJoint)tA.SetZero(),X=1,te=1,tE+=this.m_iA+this.m_iC,S=th-t_-this.m_referenceAngleA;else{var tC=en.MulRV(tv,this.m_localAxisC,n.SolvePositionConstraints_s_u),tx=en.MulRV(tv,this.m_lalcC,n.SolvePositionConstraints_s_rC),tb=en.MulRV(tm,this.m_lalcA,n.SolvePositionConstraints_s_rA);tA.Copy(tC),te=t8.CrossVV(tx,tC),X=t8.CrossVV(tb,tC),tE+=this.m_mC+this.m_mA+this.m_iC*te*te+this.m_iA*X*X;var tw=this.m_lalcC,tI=en.MulTRV(tv,t8.AddVV(tb,t8.SubVV(tr,tc,t8.s_t0),t8.s_t0),t8.s_t0);S=t8.DotVV(t8.SubVV(tI,tw,t8.s_t0),this.m_localAxisC)}if(this.m_typeB===g.b2JointType.e_revoluteJoint)tT.SetZero(),Y=this.m_ratio,ti=this.m_ratio,tE+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),O=tl-tp-this.m_referenceAngleB;else{var tB=en.MulRV(ty,this.m_localAxisD,n.SolvePositionConstraints_s_u),tP=en.MulRV(ty,this.m_lalcD,n.SolvePositionConstraints_s_rD),tD=en.MulRV(tg,this.m_lalcB,n.SolvePositionConstraints_s_rB);t8.MulSV(this.m_ratio,tB,tT),ti=this.m_ratio*t8.CrossVV(tP,tB),Y=this.m_ratio*t8.CrossVV(tD,tB),tE+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*ti*ti+this.m_iB*Y*Y;var tM=this.m_lalcD,tO=en.MulTRV(ty,t8.AddVV(tD,t8.SubVV(tu,tf,t8.s_t0),t8.s_t0),t8.s_t0);O=t8.DotVV(t8.SubVV(tO,tM,t8.s_t0),this.m_localAxisD)}var tk=S+this.m_ratio*O-this.m_constant,tG=0;return tE>0&&(tG=-tk/tE),tr.SelfMulAdd(this.m_mA*tG,tA),th+=this.m_iA*tG*X,tu.SelfMulAdd(this.m_mB*tG,tT),tl+=this.m_iB*tG*Y,tc.SelfMulSub(this.m_mC*tG,tA),t_-=this.m_iC*tG*te,tf.SelfMulSub(this.m_mD*tG,tT),tp-=this.m_iD*tG*ti,v.positions[this.m_indexA].a=th,v.positions[this.m_indexB].a=tl,v.positions[this.m_indexC].a=t_,v.positions[this.m_indexD].a=tp,tS<ta},S.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},S.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},S.GetReactionForce=function(g,v){return t8.MulSV(g*this.m_impulse,this.m_JvAC,v)},S.GetReactionTorque=function(g){return g*this.m_impulse*this.m_JwA},S.GetJoint1=function(){return this.m_joint1},S.GetJoint2=function(){return this.m_joint2},S.GetRatio=function(){return this.m_ratio},S.SetRatio=function(g){this.m_ratio=g},S.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex,O=this.m_joint1.m_index,X=this.m_joint2.m_index;g("  const jd: b2GearJointDef = new b2GearJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.joint1 = joints[%d];\n",O),g("  jd.joint2 = joints[%d];\n",X),g("  jd.ratio = %.15f;\n",this.m_ratio),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},n}(nb);nO.InitVelocityConstraints_s_u=new t8,nO.InitVelocityConstraints_s_rA=new t8,nO.InitVelocityConstraints_s_rB=new t8,nO.InitVelocityConstraints_s_rC=new t8,nO.InitVelocityConstraints_s_rD=new t8,nO.SolvePositionConstraints_s_u=new t8,nO.SolvePositionConstraints_s_rA=new t8,nO.SolvePositionConstraints_s_rB=new t8,nO.SolvePositionConstraints_s_rC=new t8,nO.SolvePositionConstraints_s_rD=new t8;var nL=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_motorJoint)||this).linearOffset=new t8(0,0),S.angularOffset=0,S.maxForce=1,S.maxTorque=1,S.correctionFactor=.3,S}return s(i,v),i.prototype.Initialize=function(g,v){this.bodyA=g,this.bodyB=v,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var S=this.bodyA.GetAngle(),O=this.bodyB.GetAngle();this.angularOffset=O-S},i}(En),nF=function(g){function e(v){var S;return(S=g.call(this,v)||this).m_linearOffset=new t8,S.m_angularOffset=0,S.m_linearImpulse=new t8,S.m_angularImpulse=0,S.m_maxForce=0,S.m_maxTorque=0,S.m_correctionFactor=.3,S.m_indexA=0,S.m_indexB=0,S.m_rA=new t8,S.m_rB=new t8,S.m_localCenterA=new t8,S.m_localCenterB=new t8,S.m_linearError=new t8,S.m_angularError=0,S.m_invMassA=0,S.m_invMassB=0,S.m_invIA=0,S.m_invIB=0,S.m_linearMass=new t9,S.m_angularMass=0,S.m_qA=new en,S.m_qB=new en,S.m_K=new t9,S.m_linearOffset.Copy(i(v.linearOffset,t8.ZERO)),S.m_linearImpulse.SetZero(),S.m_maxForce=i(v.maxForce,0),S.m_maxTorque=i(v.maxTorque,0),S.m_correctionFactor=i(v.correctionFactor,.3),S}s(e,g);var v=e.prototype;return v.GetAnchorA=function(g){var v=this.m_bodyA.GetPosition();return g.x=v.x,g.y=v.y,g},v.GetAnchorB=function(g){var v=this.m_bodyB.GetPosition();return g.x=v.x,g.y=v.y,g},v.GetReactionForce=function(g,v){return t8.MulSV(g,this.m_linearImpulse,v)},v.GetReactionTorque=function(g){return g*this.m_angularImpulse},v.SetLinearOffset=function(g){t8.IsEqualToV(g,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(g))},v.GetLinearOffset=function(){return this.m_linearOffset},v.SetAngularOffset=function(g){g!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=g)},v.GetAngularOffset=function(){return this.m_angularOffset},v.SetMaxForce=function(g){this.m_maxForce=g},v.GetMaxForce=function(){return this.m_maxForce},v.SetMaxTorque=function(g){this.m_maxTorque=g},v.GetMaxTorque=function(){return this.m_maxTorque},v.InitVelocityConstraints=function(g){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.velocities[this.m_indexA].v,X=g.velocities[this.m_indexA].w,Y=g.positions[this.m_indexB].c,te=g.positions[this.m_indexB].a,ti=g.velocities[this.m_indexB].v,tr=g.velocities[this.m_indexB].w,ta=this.m_qA.SetAngle(S),th=this.m_qB.SetAngle(te),tu=en.MulRV(ta,t8.SubVV(this.m_linearOffset,this.m_localCenterA,t8.s_t0),this.m_rA),tl=en.MulRV(th,t8.NegV(this.m_localCenterB,t8.s_t0),this.m_rB),tc=this.m_invMassA,t_=this.m_invMassB,tf=this.m_invIA,tp=this.m_invIB,tm=this.m_K;if(tm.ex.x=tc+t_+tf*tu.y*tu.y+tp*tl.y*tl.y,tm.ex.y=-tf*tu.x*tu.y-tp*tl.x*tl.y,tm.ey.x=tm.ex.y,tm.ey.y=tc+t_+tf*tu.x*tu.x+tp*tl.x*tl.x,tm.GetInverse(this.m_linearMass),this.m_angularMass=tf+tp,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t8.SubVV(t8.AddVV(Y,tl,t8.s_t0),t8.AddVV(v,tu,t8.s_t1),this.m_linearError),this.m_angularError=te-S-this.m_angularOffset,g.step.warmStarting){this.m_linearImpulse.SelfMul(g.step.dtRatio),this.m_angularImpulse*=g.step.dtRatio;var tg=this.m_linearImpulse;O.SelfMulSub(tc,tg),X-=tf*(t8.CrossVV(tu,tg)+this.m_angularImpulse),ti.SelfMulAdd(t_,tg),tr+=tp*(t8.CrossVV(tl,tg)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;g.velocities[this.m_indexA].w=X,g.velocities[this.m_indexB].w=tr},v.SolveVelocityConstraints=function(g){var v=g.velocities[this.m_indexA].v,S=g.velocities[this.m_indexA].w,O=g.velocities[this.m_indexB].v,X=g.velocities[this.m_indexB].w,Y=this.m_invMassA,te=this.m_invMassB,ti=this.m_invIA,tr=this.m_invIB,ta=g.step.dt,th=g.step.inv_dt,tu=X-S+th*this.m_correctionFactor*this.m_angularError,tl=-this.m_angularMass*tu,tc=this.m_angularImpulse,t_=ta*this.m_maxTorque;this.m_angularImpulse=at(this.m_angularImpulse+tl,-t_,t_),S-=ti*(tl=this.m_angularImpulse-tc),X+=tr*tl;var tf=this.m_rA,tp=this.m_rB,tm=t8.AddVV(t8.SubVV(t8.AddVV(O,t8.CrossSV(X,tp,t8.s_t0),t8.s_t0),t8.AddVV(v,t8.CrossSV(S,tf,t8.s_t1),t8.s_t1),t8.s_t2),t8.MulSV(th*this.m_correctionFactor,this.m_linearError,t8.s_t3),e.SolveVelocityConstraints_s_Cdot_v2),tg=t9.MulMV(this.m_linearMass,tm,e.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),tv=e.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(tg);var ty=ta*this.m_maxForce;this.m_linearImpulse.LengthSquared()>ty*ty&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(ty)),t8.SubVV(this.m_linearImpulse,tv,tg),v.SelfMulSub(Y,tg),S-=ti*t8.CrossVV(tf,tg),O.SelfMulAdd(te,tg),X+=tr*t8.CrossVV(tp,tg),g.velocities[this.m_indexA].w=S,g.velocities[this.m_indexB].w=X},v.SolvePositionConstraints=function(){return!0},v.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),g("  jd.angularOffset = %.15f;\n",this.m_angularOffset),g("  jd.maxForce = %.15f;\n",this.m_maxForce),g("  jd.maxTorque = %.15f;\n",this.m_maxTorque),g("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e}(nb);nF.SolveVelocityConstraints_s_Cdot_v2=new t8,nF.SolveVelocityConstraints_s_impulse_v2=new t8,nF.SolveVelocityConstraints_s_oldImpulse_v2=new t8;var nk=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_mouseJoint)||this).target=new t8,S.maxForce=0,S.frequencyHz=5,S.dampingRatio=.7,S}return s(i,v),i}(En),nG=function(g){function e(v){var S;return(S=g.call(this,v)||this).m_localAnchorB=new t8,S.m_targetA=new t8,S.m_frequencyHz=0,S.m_dampingRatio=0,S.m_beta=0,S.m_impulse=new t8,S.m_maxForce=0,S.m_gamma=0,S.m_indexA=0,S.m_indexB=0,S.m_rB=new t8,S.m_localCenterB=new t8,S.m_invMassB=0,S.m_invIB=0,S.m_mass=new t9,S.m_C=new t8,S.m_qB=new en,S.m_lalcB=new t8,S.m_K=new t9,S.m_targetA.Copy(i(v.target,t8.ZERO)),er.MulTXV(S.m_bodyB.GetTransform(),S.m_targetA,S.m_localAnchorB),S.m_maxForce=i(v.maxForce,0),S.m_impulse.SetZero(),S.m_frequencyHz=i(v.frequencyHz,0),S.m_dampingRatio=i(v.dampingRatio,0),S.m_beta=0,S.m_gamma=0,S}s(e,g);var v=e.prototype;return v.SetTarget=function(g){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(g)},v.GetTarget=function(){return this.m_targetA},v.SetMaxForce=function(g){this.m_maxForce=g},v.GetMaxForce=function(){return this.m_maxForce},v.SetFrequency=function(g){this.m_frequencyHz=g},v.GetFrequency=function(){return this.m_frequencyHz},v.SetDampingRatio=function(g){this.m_dampingRatio=g},v.GetDampingRatio=function(){return this.m_dampingRatio},v.InitVelocityConstraints=function(g){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var v=g.positions[this.m_indexB].c,S=g.positions[this.m_indexB].a,O=g.velocities[this.m_indexB].v,Y=g.velocities[this.m_indexB].w,te=this.m_qB.SetAngle(S),ti=this.m_bodyB.GetMass(),tr=2*X*this.m_frequencyHz,ta=2*ti*this.m_dampingRatio*tr,th=ti*tr*tr,tu=g.step.dt;this.m_gamma=tu*(ta+tu*th),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=tu*th*this.m_gamma,t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),en.MulRV(te,this.m_lalcB,this.m_rB);var tl=this.m_K;tl.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,tl.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,tl.ey.x=tl.ex.y,tl.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,tl.GetInverse(this.m_mass),this.m_C.x=v.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=v.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),Y*=.98,g.step.warmStarting?(this.m_impulse.SelfMul(g.step.dtRatio),O.x+=this.m_invMassB*this.m_impulse.x,O.y+=this.m_invMassB*this.m_impulse.y,Y+=this.m_invIB*t8.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),g.velocities[this.m_indexB].w=Y},v.SolveVelocityConstraints=function(g){var v=g.velocities[this.m_indexB].v,S=g.velocities[this.m_indexB].w,O=t8.AddVCrossSV(v,S,this.m_rB,e.SolveVelocityConstraints_s_Cdot),X=t9.MulMV(this.m_mass,t8.AddVV(O,t8.AddVV(this.m_C,t8.MulSV(this.m_gamma,this.m_impulse,t8.s_t0),t8.s_t0),t8.s_t0).SelfNeg(),e.SolveVelocityConstraints_s_impulse),Y=e.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(X);var te=g.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>te*te&&this.m_impulse.SelfMul(te/this.m_impulse.Length()),t8.SubVV(this.m_impulse,Y,X),v.SelfMulAdd(this.m_invMassB,X),S+=this.m_invIB*t8.CrossVV(this.m_rB,X),g.velocities[this.m_indexB].w=S},v.SolvePositionConstraints=function(){return!0},v.GetAnchorA=function(g){return g.x=this.m_targetA.x,g.y=this.m_targetA.y,g},v.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},v.GetReactionForce=function(g,v){return t8.MulSV(g,this.m_impulse,v)},v.GetReactionTorque=function(){return 0},v.Dump=function(g){g("Mouse joint dumping is not supported.\n")},v.ShiftOrigin=function(g){this.m_targetA.SelfSub(g)},e}(nb);nG.SolveVelocityConstraints_s_Cdot=new t8,nG.SolveVelocityConstraints_s_impulse=new t8,nG.SolveVelocityConstraints_s_oldImpulse=new t8;var nV=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_prismaticJoint)||this).localAnchorA=new t8,S.localAnchorB=new t8,S.localAxisA=new t8(1,0),S.referenceAngle=0,S.enableLimit=!1,S.lowerTranslation=0,S.upperTranslation=0,S.enableMotor=!1,S.maxMotorForce=0,S.motorSpeed=0,S}return s(i,v),i.prototype.Initialize=function(g,v,S,O){this.bodyA=g,this.bodyB=v,this.bodyA.GetLocalPoint(S,this.localAnchorA),this.bodyB.GetLocalPoint(S,this.localAnchorB),this.bodyA.GetLocalVector(O,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},i}(En),nU=function(v){function n(S){var O;return(O=v.call(this,S)||this).m_localAnchorA=new t8,O.m_localAnchorB=new t8,O.m_localXAxisA=new t8,O.m_localYAxisA=new t8,O.m_referenceAngle=0,O.m_impulse=new t7(0,0,0),O.m_motorImpulse=0,O.m_lowerTranslation=0,O.m_upperTranslation=0,O.m_maxMotorForce=0,O.m_motorSpeed=0,O.m_enableLimit=!1,O.m_enableMotor=!1,O.m_limitState=g.b2LimitState.e_inactiveLimit,O.m_indexA=0,O.m_indexB=0,O.m_localCenterA=new t8,O.m_localCenterB=new t8,O.m_invMassA=0,O.m_invMassB=0,O.m_invIA=0,O.m_invIB=0,O.m_axis=new t8(0,0),O.m_perp=new t8(0,0),O.m_s1=0,O.m_s2=0,O.m_a1=0,O.m_a2=0,O.m_K=new ee,O.m_K3=new ee,O.m_K2=new t9,O.m_motorMass=0,O.m_qA=new en,O.m_qB=new en,O.m_lalcA=new t8,O.m_lalcB=new t8,O.m_rA=new t8,O.m_rB=new t8,O.m_localAnchorA.Copy(i(S.localAnchorA,t8.ZERO)),O.m_localAnchorB.Copy(i(S.localAnchorB,t8.ZERO)),O.m_localXAxisA.Copy(i(S.localAxisA,new t8(1,0))).SelfNormalize(),t8.CrossOneV(O.m_localXAxisA,O.m_localYAxisA),O.m_referenceAngle=i(S.referenceAngle,0),O.m_lowerTranslation=i(S.lowerTranslation,0),O.m_upperTranslation=i(S.upperTranslation,0),O.m_maxMotorForce=i(S.maxMotorForce,0),O.m_motorSpeed=i(S.motorSpeed,0),O.m_enableLimit=i(S.enableLimit,!1),O.m_enableMotor=i(S.enableMotor,!1),O}s(n,v);var S=n.prototype;return S.InitVelocityConstraints=function(v){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var S=v.positions[this.m_indexA].c,O=v.positions[this.m_indexA].a,X=v.velocities[this.m_indexA].v,Y=v.velocities[this.m_indexA].w,te=v.positions[this.m_indexB].c,ti=v.positions[this.m_indexB].a,tr=v.velocities[this.m_indexB].v,th=v.velocities[this.m_indexB].w,tu=this.m_qA.SetAngle(O),tl=this.m_qB.SetAngle(ti);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var tc=en.MulRV(tu,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var t_=en.MulRV(tl,this.m_lalcB,this.m_rB),tf=t8.AddVV(t8.SubVV(te,S,t8.s_t0),t8.SubVV(t_,tc,t8.s_t1),n.InitVelocityConstraints_s_d),tp=this.m_invMassA,tm=this.m_invMassB,tg=this.m_invIA,tv=this.m_invIB;if(en.MulRV(tu,this.m_localXAxisA,this.m_axis),this.m_a1=t8.CrossVV(t8.AddVV(tf,tc,t8.s_t0),this.m_axis),this.m_a2=t8.CrossVV(t_,this.m_axis),this.m_motorMass=tp+tm+tg*this.m_a1*this.m_a1+tv*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),en.MulRV(tu,this.m_localYAxisA,this.m_perp),this.m_s1=t8.CrossVV(t8.AddVV(tf,tc,t8.s_t0),this.m_perp),this.m_s2=t8.CrossVV(t_,this.m_perp),this.m_K.ex.x=tp+tm+tg*this.m_s1*this.m_s1+tv*this.m_s2*this.m_s2,this.m_K.ex.y=tg*this.m_s1+tv*this.m_s2,this.m_K.ex.z=tg*this.m_s1*this.m_a1+tv*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=tg+tv,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=tg*this.m_a1+tv*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=tp+tm+tg*this.m_a1*this.m_a1+tv*this.m_a2*this.m_a2,this.m_enableLimit){var ty=t8.DotVV(this.m_axis,tf);tq(this.m_upperTranslation-this.m_lowerTranslation)<2*ta?this.m_limitState=g.b2LimitState.e_equalLimits:ty<=this.m_lowerTranslation?this.m_limitState!==g.b2LimitState.e_atLowerLimit&&(this.m_limitState=g.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):ty>=this.m_upperTranslation?this.m_limitState!==g.b2LimitState.e_atUpperLimit&&(this.m_limitState=g.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=g.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=g.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),v.step.warmStarting){this.m_impulse.SelfMul(v.step.dtRatio),this.m_motorImpulse*=v.step.dtRatio;var tS=t8.AddVV(t8.MulSV(this.m_impulse.x,this.m_perp,t8.s_t0),t8.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,t8.s_t1),n.InitVelocityConstraints_s_P),tA=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,tT=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;X.SelfMulSub(tp,tS),Y-=tg*tA,tr.SelfMulAdd(tm,tS),th+=tv*tT}else this.m_impulse.SetZero(),this.m_motorImpulse=0;v.velocities[this.m_indexA].w=Y,v.velocities[this.m_indexB].w=th},S.SolveVelocityConstraints=function(v){var S=v.velocities[this.m_indexA].v,O=v.velocities[this.m_indexA].w,X=v.velocities[this.m_indexB].v,Y=v.velocities[this.m_indexB].w,te=this.m_invMassA,ti=this.m_invMassB,tr=this.m_invIA,ta=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==g.b2LimitState.e_equalLimits){var th=t8.DotVV(this.m_axis,t8.SubVV(X,S,t8.s_t0))+this.m_a2*Y-this.m_a1*O,tu=this.m_motorMass*(this.m_motorSpeed-th),tl=this.m_motorImpulse,tc=v.step.dt*this.m_maxMotorForce;this.m_motorImpulse=at(this.m_motorImpulse+tu,-tc,tc),tu=this.m_motorImpulse-tl;var t_=t8.MulSV(tu,this.m_axis,n.SolveVelocityConstraints_s_P),tf=tu*this.m_a1,tp=tu*this.m_a2;S.SelfMulSub(te,t_),O-=tr*tf,X.SelfMulAdd(ti,t_),Y+=ta*tp}var tm=t8.DotVV(this.m_perp,t8.SubVV(X,S,t8.s_t0))+this.m_s2*Y-this.m_s1*O,tg=Y-O;if(this.m_enableLimit&&this.m_limitState!==g.b2LimitState.e_inactiveLimit){var tv=t8.DotVV(this.m_axis,t8.SubVV(X,S,t8.s_t0))+this.m_a2*Y-this.m_a1*O,ty=n.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),tS=this.m_K.Solve33(-tm,-tg,-tv,n.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(tS),this.m_limitState===g.b2LimitState.e_atLowerLimit?this.m_impulse.z=st(this.m_impulse.z,0):this.m_limitState===g.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=rt(this.m_impulse.z,0));var tA=-tm-(this.m_impulse.z-ty.z)*this.m_K.ez.x,tT=-tg-(this.m_impulse.z-ty.z)*this.m_K.ez.y,tE=this.m_K.Solve22(tA,tT,n.SolveVelocityConstraints_s_f2r);tE.x+=ty.x,tE.y+=ty.y,this.m_impulse.x=tE.x,this.m_impulse.y=tE.y,tS.x=this.m_impulse.x-ty.x,tS.y=this.m_impulse.y-ty.y,tS.z=this.m_impulse.z-ty.z;var tC=t8.AddVV(t8.MulSV(tS.x,this.m_perp,t8.s_t0),t8.MulSV(tS.z,this.m_axis,t8.s_t1),n.SolveVelocityConstraints_s_P),tx=tS.x*this.m_s1+tS.y+tS.z*this.m_a1,tb=tS.x*this.m_s2+tS.y+tS.z*this.m_a2;S.SelfMulSub(te,tC),O-=tr*tx,X.SelfMulAdd(ti,tC),Y+=ta*tb}else{var tw=this.m_K.Solve22(-tm,-tg,n.SolveVelocityConstraints_s_df2);this.m_impulse.x+=tw.x,this.m_impulse.y+=tw.y;var tI=t8.MulSV(tw.x,this.m_perp,n.SolveVelocityConstraints_s_P),tB=tw.x*this.m_s1+tw.y,tP=tw.x*this.m_s2+tw.y;S.SelfMulSub(te,tI),O-=tr*tB,X.SelfMulAdd(ti,tI),Y+=ta*tP}v.velocities[this.m_indexA].w=O,v.velocities[this.m_indexB].w=Y},S.SolvePositionConstraints=function(g){var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.positions[this.m_indexB].c,X=g.positions[this.m_indexB].a,Y=this.m_qA.SetAngle(S),te=this.m_qB.SetAngle(X),ti=this.m_invMassA,tr=this.m_invMassB,tu=this.m_invIA,tl=this.m_invIB,tc=en.MulRV(Y,this.m_lalcA,this.m_rA),t_=en.MulRV(te,this.m_lalcB,this.m_rB),tp=t8.SubVV(t8.AddVV(O,t_,t8.s_t0),t8.AddVV(v,tc,t8.s_t1),n.SolvePositionConstraints_s_d),tm=en.MulRV(Y,this.m_localXAxisA,this.m_axis),tg=t8.CrossVV(t8.AddVV(tp,tc,t8.s_t0),tm),tv=t8.CrossVV(t_,tm),ty=en.MulRV(Y,this.m_localYAxisA,this.m_perp),tS=t8.CrossVV(t8.AddVV(tp,tc,t8.s_t0),ty),tA=t8.CrossVV(t_,ty),tT=n.SolvePositionConstraints_s_impulse,tE=t8.DotVV(ty,tp),tC=X-S-this.m_referenceAngle,tx=tq(tE),tb=tq(tC),tw=!1,tI=0;if(this.m_enableLimit){var tB=t8.DotVV(tm,tp);tq(this.m_upperTranslation-this.m_lowerTranslation)<2*ta?(tI=at(tB,-tf,tf),tx=st(tx,tq(tB)),tw=!0):tB<=this.m_lowerTranslation?(tI=at(tB-this.m_lowerTranslation+ta,-tf,0),tx=st(tx,this.m_lowerTranslation-tB),tw=!0):tB>=this.m_upperTranslation&&(tI=at(tB-this.m_upperTranslation-ta,0,tf),tx=st(tx,tB-this.m_upperTranslation),tw=!0)}if(tw){var tP=ti+tr+tu*tS*tS+tl*tA*tA,tD=tu*tS+tl*tA,tM=tu*tS*tg+tl*tA*tv,tO=tu+tl;0===tO&&(tO=1);var tk=tu*tg+tl*tv,tG=ti+tr+tu*tg*tg+tl*tv*tv,tV=this.m_K3;tV.ex.SetXYZ(tP,tD,tM),tV.ey.SetXYZ(tD,tO,tk),tV.ez.SetXYZ(tM,tk,tG),tT=tV.Solve33(-tE,-tC,-tI,tT)}else{var tU=ti+tr+tu*tS*tS+tl*tA*tA,tH=tu*tS+tl*tA,tz=tu+tl;0===tz&&(tz=1);var tW=this.m_K2;tW.ex.Set(tU,tH),tW.ey.Set(tH,tz);var tj=tW.Solve(-tE,-tC,n.SolvePositionConstraints_s_impulse1);tT.x=tj.x,tT.y=tj.y,tT.z=0}var tK=t8.AddVV(t8.MulSV(tT.x,ty,t8.s_t0),t8.MulSV(tT.z,tm,t8.s_t1),n.SolvePositionConstraints_s_P),tZ=tT.x*tS+tT.y+tT.z*tg,tQ=tT.x*tA+tT.y+tT.z*tv;return v.SelfMulSub(ti,tK),S-=tu*tZ,O.SelfMulAdd(tr,tK),X+=tl*tQ,g.positions[this.m_indexA].a=S,g.positions[this.m_indexB].a=X,tx<=ta&&tb<=th},S.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},S.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},S.GetReactionForce=function(g,v){return v.x=g*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),v.y=g*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),v},S.GetReactionTorque=function(g){return g*this.m_impulse.y},S.GetLocalAnchorA=function(){return this.m_localAnchorA},S.GetLocalAnchorB=function(){return this.m_localAnchorB},S.GetLocalAxisA=function(){return this.m_localXAxisA},S.GetReferenceAngle=function(){return this.m_referenceAngle},S.GetJointTranslation=function(){var g=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n.GetJointTranslation_s_pA),v=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n.GetJointTranslation_s_pB),S=t8.SubVV(v,g,n.GetJointTranslation_s_d),O=this.m_bodyA.GetWorldVector(this.m_localXAxisA,n.GetJointTranslation_s_axis);return t8.DotVV(S,O)},S.GetJointSpeed=function(){var g=this.m_bodyA,v=this.m_bodyB;t8.SubVV(this.m_localAnchorA,g.m_sweep.localCenter,this.m_lalcA);var S=en.MulRV(g.m_xf.q,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,v.m_sweep.localCenter,this.m_lalcB);var O=en.MulRV(v.m_xf.q,this.m_lalcB,this.m_rB),X=t8.AddVV(g.m_sweep.c,S,t8.s_t0),Y=t8.AddVV(v.m_sweep.c,O,t8.s_t1),te=t8.SubVV(Y,X,t8.s_t2),ti=g.GetWorldVector(this.m_localXAxisA,this.m_axis),tr=g.m_linearVelocity,ta=v.m_linearVelocity,th=g.m_angularVelocity,tu=v.m_angularVelocity;return t8.DotVV(te,t8.CrossSV(th,ti,t8.s_t0))+t8.DotVV(ti,t8.SubVV(t8.AddVCrossSV(ta,tu,O,t8.s_t0),t8.AddVCrossSV(tr,th,S,t8.s_t1),t8.s_t0))},S.IsLimitEnabled=function(){return this.m_enableLimit},S.EnableLimit=function(g){g!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=g,this.m_impulse.z=0)},S.GetLowerLimit=function(){return this.m_lowerTranslation},S.GetUpperLimit=function(){return this.m_upperTranslation},S.SetLimits=function(g,v){g===this.m_lowerTranslation&&v===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=g,this.m_upperTranslation=v,this.m_impulse.z=0)},S.IsMotorEnabled=function(){return this.m_enableMotor},S.EnableMotor=function(g){g!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=g)},S.SetMotorSpeed=function(g){g!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=g)},S.GetMotorSpeed=function(){return this.m_motorSpeed},S.SetMaxMotorForce=function(g){g!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=g)},S.GetMaxMotorForce=function(){return this.m_maxMotorForce},S.GetMotorForce=function(g){return g*this.m_motorImpulse},S.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),g("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),g("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),g("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),g("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),g("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),g("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),g("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),g("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),g("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},n}(nb);nU.InitVelocityConstraints_s_d=new t8,nU.InitVelocityConstraints_s_P=new t8,nU.SolveVelocityConstraints_s_P=new t8,nU.SolveVelocityConstraints_s_f2r=new t8,nU.SolveVelocityConstraints_s_f1=new t7,nU.SolveVelocityConstraints_s_df3=new t7,nU.SolveVelocityConstraints_s_df2=new t8,nU.SolvePositionConstraints_s_d=new t8,nU.SolvePositionConstraints_s_impulse=new t7,nU.SolvePositionConstraints_s_impulse1=new t8,nU.SolvePositionConstraints_s_P=new t8,nU.GetJointTranslation_s_pA=new t8,nU.GetJointTranslation_s_pB=new t8,nU.GetJointTranslation_s_d=new t8,nU.GetJointTranslation_s_axis=new t8;var nH=2,nz=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_pulleyJoint)||this).groundAnchorA=new t8(-1,1),S.groundAnchorB=new t8(1,1),S.localAnchorA=new t8(-1,0),S.localAnchorB=new t8(1,0),S.lengthA=0,S.lengthB=0,S.ratio=1,S.collideConnected=!0,S}return s(i,v),i.prototype.Initialize=function(g,v,S,O,X,Y,te){this.bodyA=g,this.bodyB=v,this.groundAnchorA.Copy(S),this.groundAnchorB.Copy(O),this.bodyA.GetLocalPoint(X,this.localAnchorA),this.bodyB.GetLocalPoint(Y,this.localAnchorB),this.lengthA=t8.DistanceVV(X,S),this.lengthB=t8.DistanceVV(Y,O),this.ratio=te},i}(En),nW=function(g){function e(v){var S;return(S=g.call(this,v)||this).m_groundAnchorA=new t8,S.m_groundAnchorB=new t8,S.m_lengthA=0,S.m_lengthB=0,S.m_localAnchorA=new t8,S.m_localAnchorB=new t8,S.m_constant=0,S.m_ratio=0,S.m_impulse=0,S.m_indexA=0,S.m_indexB=0,S.m_uA=new t8,S.m_uB=new t8,S.m_rA=new t8,S.m_rB=new t8,S.m_localCenterA=new t8,S.m_localCenterB=new t8,S.m_invMassA=0,S.m_invMassB=0,S.m_invIA=0,S.m_invIB=0,S.m_mass=0,S.m_qA=new en,S.m_qB=new en,S.m_lalcA=new t8,S.m_lalcB=new t8,S.m_groundAnchorA.Copy(i(v.groundAnchorA,new t8(-1,1))),S.m_groundAnchorB.Copy(i(v.groundAnchorB,new t8(1,0))),S.m_localAnchorA.Copy(i(v.localAnchorA,new t8(-1,0))),S.m_localAnchorB.Copy(i(v.localAnchorB,new t8(1,0))),S.m_lengthA=i(v.lengthA,0),S.m_lengthB=i(v.lengthB,0),S.m_ratio=i(v.ratio,1),S.m_constant=i(v.lengthA,0)+S.m_ratio*i(v.lengthB,0),S.m_impulse=0,S}s(e,g);var v=e.prototype;return v.InitVelocityConstraints=function(g){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.velocities[this.m_indexA].v,X=g.velocities[this.m_indexA].w,Y=g.positions[this.m_indexB].c,te=g.positions[this.m_indexB].a,ti=g.velocities[this.m_indexB].v,tr=g.velocities[this.m_indexB].w,th=this.m_qA.SetAngle(S),tu=this.m_qB.SetAngle(te);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),en.MulRV(th,this.m_lalcA,this.m_rA),t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),en.MulRV(tu,this.m_lalcB,this.m_rB),this.m_uA.Copy(v).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(Y).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var tl=this.m_uA.Length(),tc=this.m_uB.Length();tl>10*ta?this.m_uA.SelfMul(1/tl):this.m_uA.SetZero(),tc>10*ta?this.m_uB.SelfMul(1/tc):this.m_uB.SetZero();var t_=t8.CrossVV(this.m_rA,this.m_uA),tf=t8.CrossVV(this.m_rB,this.m_uB),tp=this.m_invMassA+this.m_invIA*t_*t_,tm=this.m_invMassB+this.m_invIB*tf*tf;if(this.m_mass=tp+this.m_ratio*this.m_ratio*tm,this.m_mass>0&&(this.m_mass=1/this.m_mass),g.step.warmStarting){this.m_impulse*=g.step.dtRatio;var tg=t8.MulSV(-this.m_impulse,this.m_uA,e.InitVelocityConstraints_s_PA),tv=t8.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,e.InitVelocityConstraints_s_PB);O.SelfMulAdd(this.m_invMassA,tg),X+=this.m_invIA*t8.CrossVV(this.m_rA,tg),ti.SelfMulAdd(this.m_invMassB,tv),tr+=this.m_invIB*t8.CrossVV(this.m_rB,tv)}else this.m_impulse=0;g.velocities[this.m_indexA].w=X,g.velocities[this.m_indexB].w=tr},v.SolveVelocityConstraints=function(g){var v=g.velocities[this.m_indexA].v,S=g.velocities[this.m_indexA].w,O=g.velocities[this.m_indexB].v,X=g.velocities[this.m_indexB].w,Y=t8.AddVCrossSV(v,S,this.m_rA,e.SolveVelocityConstraints_s_vpA),te=t8.AddVCrossSV(O,X,this.m_rB,e.SolveVelocityConstraints_s_vpB),ti=-t8.DotVV(this.m_uA,Y)-this.m_ratio*t8.DotVV(this.m_uB,te),tr=-this.m_mass*ti;this.m_impulse+=tr;var ta=t8.MulSV(-tr,this.m_uA,e.SolveVelocityConstraints_s_PA),th=t8.MulSV(-this.m_ratio*tr,this.m_uB,e.SolveVelocityConstraints_s_PB);v.SelfMulAdd(this.m_invMassA,ta),S+=this.m_invIA*t8.CrossVV(this.m_rA,ta),O.SelfMulAdd(this.m_invMassB,th),X+=this.m_invIB*t8.CrossVV(this.m_rB,th),g.velocities[this.m_indexA].w=S,g.velocities[this.m_indexB].w=X},v.SolvePositionConstraints=function(g){var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.positions[this.m_indexB].c,X=g.positions[this.m_indexB].a,Y=this.m_qA.SetAngle(S),te=this.m_qB.SetAngle(X);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var ti=en.MulRV(Y,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var tr=en.MulRV(te,this.m_lalcB,this.m_rB),th=this.m_uA.Copy(v).SelfAdd(ti).SelfSub(this.m_groundAnchorA),tu=this.m_uB.Copy(O).SelfAdd(tr).SelfSub(this.m_groundAnchorB),tl=th.Length(),tc=tu.Length();tl>10*ta?th.SelfMul(1/tl):th.SetZero(),tc>10*ta?tu.SelfMul(1/tc):tu.SetZero();var t_=t8.CrossVV(ti,th),tf=t8.CrossVV(tr,tu),tp=this.m_invMassA+this.m_invIA*t_*t_,tm=this.m_invMassB+this.m_invIB*tf*tf,tg=tp+this.m_ratio*this.m_ratio*tm;tg>0&&(tg=1/tg);var tv=this.m_constant-tl-this.m_ratio*tc,ty=tq(tv),tS=-tg*tv,tA=t8.MulSV(-tS,th,e.SolvePositionConstraints_s_PA),tT=t8.MulSV(-this.m_ratio*tS,tu,e.SolvePositionConstraints_s_PB);return v.SelfMulAdd(this.m_invMassA,tA),S+=this.m_invIA*t8.CrossVV(ti,tA),O.SelfMulAdd(this.m_invMassB,tT),X+=this.m_invIB*t8.CrossVV(tr,tT),g.positions[this.m_indexA].a=S,g.positions[this.m_indexB].a=X,ty<ta},v.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},v.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},v.GetReactionForce=function(g,v){return v.x=g*this.m_impulse*this.m_uB.x,v.y=g*this.m_impulse*this.m_uB.y,v},v.GetReactionTorque=function(){return 0},v.GetGroundAnchorA=function(){return this.m_groundAnchorA},v.GetGroundAnchorB=function(){return this.m_groundAnchorB},v.GetLengthA=function(){return this.m_lengthA},v.GetLengthB=function(){return this.m_lengthB},v.GetRatio=function(){return this.m_ratio},v.GetCurrentLengthA=function(){var g=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetCurrentLengthA_s_p),v=this.m_groundAnchorA;return t8.DistanceVV(g,v)},v.GetCurrentLengthB=function(){var g=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetCurrentLengthB_s_p),v=this.m_groundAnchorB;return t8.DistanceVV(g,v)},v.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),g("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),g("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),g("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),g("  jd.lengthA = %.15f;\n",this.m_lengthA),g("  jd.lengthB = %.15f;\n",this.m_lengthB),g("  jd.ratio = %.15f;\n",this.m_ratio),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},v.ShiftOrigin=function(g){this.m_groundAnchorA.SelfSub(g),this.m_groundAnchorB.SelfSub(g)},e}(nb);nW.InitVelocityConstraints_s_PA=new t8,nW.InitVelocityConstraints_s_PB=new t8,nW.SolveVelocityConstraints_s_vpA=new t8,nW.SolveVelocityConstraints_s_vpB=new t8,nW.SolveVelocityConstraints_s_PA=new t8,nW.SolveVelocityConstraints_s_PB=new t8,nW.SolvePositionConstraints_s_PA=new t8,nW.SolvePositionConstraints_s_PB=new t8,nW.GetCurrentLengthA_s_p=new t8,nW.GetCurrentLengthB_s_p=new t8;var nj=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_revoluteJoint)||this).localAnchorA=new t8(0,0),S.localAnchorB=new t8(0,0),S.referenceAngle=0,S.enableLimit=!1,S.lowerAngle=0,S.upperAngle=0,S.enableMotor=!1,S.motorSpeed=0,S.maxMotorTorque=0,S}return s(i,v),i.prototype.Initialize=function(g,v,S){this.bodyA=g,this.bodyB=v,this.bodyA.GetLocalPoint(S,this.localAnchorA),this.bodyB.GetLocalPoint(S,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},i}(En),nq=function(v){function n(S){var O;return(O=v.call(this,S)||this).m_localAnchorA=new t8,O.m_localAnchorB=new t8,O.m_impulse=new t7,O.m_motorImpulse=0,O.m_enableMotor=!1,O.m_maxMotorTorque=0,O.m_motorSpeed=0,O.m_enableLimit=!1,O.m_referenceAngle=0,O.m_lowerAngle=0,O.m_upperAngle=0,O.m_indexA=0,O.m_indexB=0,O.m_rA=new t8,O.m_rB=new t8,O.m_localCenterA=new t8,O.m_localCenterB=new t8,O.m_invMassA=0,O.m_invMassB=0,O.m_invIA=0,O.m_invIB=0,O.m_mass=new ee,O.m_motorMass=0,O.m_limitState=g.b2LimitState.e_inactiveLimit,O.m_qA=new en,O.m_qB=new en,O.m_lalcA=new t8,O.m_lalcB=new t8,O.m_K=new t9,O.m_localAnchorA.Copy(i(S.localAnchorA,t8.ZERO)),O.m_localAnchorB.Copy(i(S.localAnchorB,t8.ZERO)),O.m_referenceAngle=i(S.referenceAngle,0),O.m_impulse.SetZero(),O.m_motorImpulse=0,O.m_lowerAngle=i(S.lowerAngle,0),O.m_upperAngle=i(S.upperAngle,0),O.m_maxMotorTorque=i(S.maxMotorTorque,0),O.m_motorSpeed=i(S.motorSpeed,0),O.m_enableLimit=i(S.enableLimit,!1),O.m_enableMotor=i(S.enableMotor,!1),O.m_limitState=g.b2LimitState.e_inactiveLimit,O}s(n,v);var S=n.prototype;return S.InitVelocityConstraints=function(v){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var S=v.positions[this.m_indexA].a,O=v.velocities[this.m_indexA].v,X=v.velocities[this.m_indexA].w,Y=v.positions[this.m_indexB].a,te=v.velocities[this.m_indexB].v,ti=v.velocities[this.m_indexB].w,tr=this.m_qA.SetAngle(S),ta=this.m_qB.SetAngle(Y);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),en.MulRV(tr,this.m_lalcA,this.m_rA),t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),en.MulRV(ta,this.m_lalcB,this.m_rB);var tu=this.m_invMassA,tl=this.m_invMassB,tc=this.m_invIA,t_=this.m_invIB,tf=tc+t_===0;if(this.m_mass.ex.x=tu+tl+this.m_rA.y*this.m_rA.y*tc+this.m_rB.y*this.m_rB.y*t_,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*tc-this.m_rB.y*this.m_rB.x*t_,this.m_mass.ez.x=-this.m_rA.y*tc-this.m_rB.y*t_,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=tu+tl+this.m_rA.x*this.m_rA.x*tc+this.m_rB.x*this.m_rB.x*t_,this.m_mass.ez.y=this.m_rA.x*tc+this.m_rB.x*t_,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=tc+t_,this.m_motorMass=tc+t_,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!tf||(this.m_motorImpulse=0),this.m_enableLimit&&!tf){var tp=Y-S-this.m_referenceAngle;tq(this.m_upperAngle-this.m_lowerAngle)<2*th?this.m_limitState=g.b2LimitState.e_equalLimits:tp<=this.m_lowerAngle?(this.m_limitState!==g.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=g.b2LimitState.e_atLowerLimit):tp>=this.m_upperAngle?(this.m_limitState!==g.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=g.b2LimitState.e_atUpperLimit):(this.m_limitState=g.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=g.b2LimitState.e_inactiveLimit;if(v.step.warmStarting){this.m_impulse.SelfMul(v.step.dtRatio),this.m_motorImpulse*=v.step.dtRatio;var tm=n.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);O.SelfMulSub(tu,tm),X-=tc*(t8.CrossVV(this.m_rA,tm)+this.m_motorImpulse+this.m_impulse.z),te.SelfMulAdd(tl,tm),ti+=t_*(t8.CrossVV(this.m_rB,tm)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;v.velocities[this.m_indexA].w=X,v.velocities[this.m_indexB].w=ti},S.SolveVelocityConstraints=function(v){var S=v.velocities[this.m_indexA].v,O=v.velocities[this.m_indexA].w,X=v.velocities[this.m_indexB].v,Y=v.velocities[this.m_indexB].w,te=this.m_invMassA,ti=this.m_invMassB,tr=this.m_invIA,ta=this.m_invIB,th=tr+ta===0;if(this.m_enableMotor&&this.m_limitState!==g.b2LimitState.e_equalLimits&&!th){var tu=Y-O-this.m_motorSpeed,tl=-this.m_motorMass*tu,tc=this.m_motorImpulse,t_=v.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=at(this.m_motorImpulse+tl,-t_,t_),O-=tr*(tl=this.m_motorImpulse-tc),Y+=ta*tl}if(this.m_enableLimit&&this.m_limitState!==g.b2LimitState.e_inactiveLimit&&!th){var tf=t8.SubVV(t8.AddVCrossSV(X,Y,this.m_rB,t8.s_t0),t8.AddVCrossSV(S,O,this.m_rA,t8.s_t1),n.SolveVelocityConstraints_s_Cdot1),tp=Y-O,tm=this.m_mass.Solve33(tf.x,tf.y,tp,n.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===g.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(tm);else if(this.m_limitState===g.b2LimitState.e_atLowerLimit){if(this.m_impulse.z+tm.z<0){var tg=-tf.x+this.m_impulse.z*this.m_mass.ez.x,tv=-tf.y+this.m_impulse.z*this.m_mass.ez.y,ty=this.m_mass.Solve22(tg,tv,n.SolveVelocityConstraints_s_reduced_v2);tm.x=ty.x,tm.y=ty.y,tm.z=-this.m_impulse.z,this.m_impulse.x+=ty.x,this.m_impulse.y+=ty.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(tm)}else if(this.m_limitState===g.b2LimitState.e_atUpperLimit){if(this.m_impulse.z+tm.z>0){var tS=-tf.x+this.m_impulse.z*this.m_mass.ez.x,tA=-tf.y+this.m_impulse.z*this.m_mass.ez.y,tT=this.m_mass.Solve22(tS,tA,n.SolveVelocityConstraints_s_reduced_v2);tm.x=tT.x,tm.y=tT.y,tm.z=-this.m_impulse.z,this.m_impulse.x+=tT.x,this.m_impulse.y+=tT.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(tm)}var tE=n.SolveVelocityConstraints_s_P.Set(tm.x,tm.y);S.SelfMulSub(te,tE),O-=tr*(t8.CrossVV(this.m_rA,tE)+tm.z),X.SelfMulAdd(ti,tE),Y+=ta*(t8.CrossVV(this.m_rB,tE)+tm.z)}else{var tC=t8.SubVV(t8.AddVCrossSV(X,Y,this.m_rB,t8.s_t0),t8.AddVCrossSV(S,O,this.m_rA,t8.s_t1),n.SolveVelocityConstraints_s_Cdot_v2),tx=this.m_mass.Solve22(-tC.x,-tC.y,n.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=tx.x,this.m_impulse.y+=tx.y,S.SelfMulSub(te,tx),O-=tr*t8.CrossVV(this.m_rA,tx),X.SelfMulAdd(ti,tx),Y+=ta*t8.CrossVV(this.m_rB,tx)}v.velocities[this.m_indexA].w=O,v.velocities[this.m_indexB].w=Y},S.SolvePositionConstraints=function(v){var S=v.positions[this.m_indexA].c,O=v.positions[this.m_indexA].a,X=v.positions[this.m_indexB].c,Y=v.positions[this.m_indexB].a,te=this.m_qA.SetAngle(O),ti=this.m_qB.SetAngle(Y),tr=0,tu=0,tl=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==g.b2LimitState.e_inactiveLimit&&!tl){var tc=Y-O-this.m_referenceAngle,t_=0;if(this.m_limitState===g.b2LimitState.e_equalLimits){var tf=at(tc-this.m_lowerAngle,-tp,tp);t_=-this.m_motorMass*tf,tr=tq(tf)}else if(this.m_limitState===g.b2LimitState.e_atLowerLimit){var tm=tc-this.m_lowerAngle;tr=-tm,tm=at(tm+th,-tp,0),t_=-this.m_motorMass*tm}else if(this.m_limitState===g.b2LimitState.e_atUpperLimit){var tg=tc-this.m_upperAngle;tr=tg,tg=at(tg-th,0,tp),t_=-this.m_motorMass*tg}O-=this.m_invIA*t_,Y+=this.m_invIB*t_}te.SetAngle(O),ti.SetAngle(Y),t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var tv=en.MulRV(te,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var ty=en.MulRV(ti,this.m_lalcB,this.m_rB),tS=t8.SubVV(t8.AddVV(X,ty,t8.s_t0),t8.AddVV(S,tv,t8.s_t1),n.SolvePositionConstraints_s_C_v2);tu=tS.Length();var tA=this.m_invMassA,tT=this.m_invMassB,tE=this.m_invIA,tC=this.m_invIB,tx=this.m_K;tx.ex.x=tA+tT+tE*tv.y*tv.y+tC*ty.y*ty.y,tx.ex.y=-tE*tv.x*tv.y-tC*ty.x*ty.y,tx.ey.x=tx.ex.y,tx.ey.y=tA+tT+tE*tv.x*tv.x+tC*ty.x*ty.x;var tb=tx.Solve(tS.x,tS.y,n.SolvePositionConstraints_s_impulse).SelfNeg();return S.SelfMulSub(tA,tb),O-=tE*t8.CrossVV(tv,tb),X.SelfMulAdd(tT,tb),Y+=tC*t8.CrossVV(ty,tb),v.positions[this.m_indexA].a=O,v.positions[this.m_indexB].a=Y,tu<=ta&&tr<=th},S.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},S.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},S.GetReactionForce=function(g,v){return v.x=g*this.m_impulse.x,v.y=g*this.m_impulse.y,v},S.GetReactionTorque=function(g){return g*this.m_impulse.z},S.GetLocalAnchorA=function(){return this.m_localAnchorA},S.GetLocalAnchorB=function(){return this.m_localAnchorB},S.GetReferenceAngle=function(){return this.m_referenceAngle},S.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},S.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},S.IsMotorEnabled=function(){return this.m_enableMotor},S.EnableMotor=function(g){g!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=g)},S.GetMotorTorque=function(g){return g*this.m_motorImpulse},S.GetMotorSpeed=function(){return this.m_motorSpeed},S.SetMaxMotorTorque=function(g){g!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=g)},S.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},S.IsLimitEnabled=function(){return this.m_enableLimit},S.EnableLimit=function(g){g!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=g,this.m_impulse.z=0)},S.GetLowerLimit=function(){return this.m_lowerAngle},S.GetUpperLimit=function(){return this.m_upperAngle},S.SetLimits=function(g,v){g===this.m_lowerAngle&&v===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=g,this.m_upperAngle=v)},S.SetMotorSpeed=function(g){g!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=g)},S.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),g("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),g("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),g("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),g("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),g("  jd.upperAngle = %.15f;\n",this.m_upperAngle),g("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),g("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),g("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},n}(nb);nq.InitVelocityConstraints_s_P=new t8,nq.SolveVelocityConstraints_s_P=new t8,nq.SolveVelocityConstraints_s_Cdot_v2=new t8,nq.SolveVelocityConstraints_s_Cdot1=new t8,nq.SolveVelocityConstraints_s_impulse_v3=new t7,nq.SolveVelocityConstraints_s_reduced_v2=new t8,nq.SolveVelocityConstraints_s_impulse_v2=new t8,nq.SolvePositionConstraints_s_C_v2=new t8,nq.SolvePositionConstraints_s_impulse=new t8;var nY=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_ropeJoint)||this).localAnchorA=new t8(-1,0),S.localAnchorB=new t8(1,0),S.maxLength=0,S}return s(i,v),i}(En),nK=function(v){function n(S){var O;return(O=v.call(this,S)||this).m_localAnchorA=new t8,O.m_localAnchorB=new t8,O.m_maxLength=0,O.m_length=0,O.m_impulse=0,O.m_indexA=0,O.m_indexB=0,O.m_u=new t8,O.m_rA=new t8,O.m_rB=new t8,O.m_localCenterA=new t8,O.m_localCenterB=new t8,O.m_invMassA=0,O.m_invMassB=0,O.m_invIA=0,O.m_invIB=0,O.m_mass=0,O.m_state=g.b2LimitState.e_inactiveLimit,O.m_qA=new en,O.m_qB=new en,O.m_lalcA=new t8,O.m_lalcB=new t8,O.m_localAnchorA.Copy(i(S.localAnchorA,new t8(-1,0))),O.m_localAnchorB.Copy(i(S.localAnchorB,new t8(1,0))),O.m_maxLength=i(S.maxLength,0),O}s(n,v);var S=n.prototype;return S.InitVelocityConstraints=function(v){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var S=v.positions[this.m_indexA].c,O=v.positions[this.m_indexA].a,X=v.velocities[this.m_indexA].v,Y=v.velocities[this.m_indexA].w,te=v.positions[this.m_indexB].c,ti=v.positions[this.m_indexB].a,tr=v.velocities[this.m_indexB].v,th=v.velocities[this.m_indexB].w,tu=this.m_qA.SetAngle(O),tl=this.m_qB.SetAngle(ti);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),en.MulRV(tu,this.m_lalcA,this.m_rA),t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),en.MulRV(tl,this.m_lalcB,this.m_rB),this.m_u.Copy(te).SelfAdd(this.m_rB).SelfSub(S).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var tc=this.m_length-this.m_maxLength;if(this.m_state=tc>0?g.b2LimitState.e_atUpperLimit:g.b2LimitState.e_inactiveLimit,!(this.m_length>ta))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var t_=t8.CrossVV(this.m_rA,this.m_u),tf=t8.CrossVV(this.m_rB,this.m_u),tp=this.m_invMassA+this.m_invIA*t_*t_+this.m_invMassB+this.m_invIB*tf*tf;if(this.m_mass=0!==tp?1/tp:0,v.step.warmStarting){this.m_impulse*=v.step.dtRatio;var tm=t8.MulSV(this.m_impulse,this.m_u,n.InitVelocityConstraints_s_P);X.SelfMulSub(this.m_invMassA,tm),Y-=this.m_invIA*t8.CrossVV(this.m_rA,tm),tr.SelfMulAdd(this.m_invMassB,tm),th+=this.m_invIB*t8.CrossVV(this.m_rB,tm)}else this.m_impulse=0;v.velocities[this.m_indexA].w=Y,v.velocities[this.m_indexB].w=th},S.SolveVelocityConstraints=function(g){var v=g.velocities[this.m_indexA].v,S=g.velocities[this.m_indexA].w,O=g.velocities[this.m_indexB].v,X=g.velocities[this.m_indexB].w,Y=t8.AddVCrossSV(v,S,this.m_rA,n.SolveVelocityConstraints_s_vpA),te=t8.AddVCrossSV(O,X,this.m_rB,n.SolveVelocityConstraints_s_vpB),ti=this.m_length-this.m_maxLength,tr=t8.DotVV(this.m_u,t8.SubVV(te,Y,t8.s_t0));ti<0&&(tr+=g.step.inv_dt*ti);var ta=-this.m_mass*tr,th=this.m_impulse;this.m_impulse=rt(0,this.m_impulse+ta),ta=this.m_impulse-th;var tu=t8.MulSV(ta,this.m_u,n.SolveVelocityConstraints_s_P);v.SelfMulSub(this.m_invMassA,tu),S-=this.m_invIA*t8.CrossVV(this.m_rA,tu),O.SelfMulAdd(this.m_invMassB,tu),X+=this.m_invIB*t8.CrossVV(this.m_rB,tu),g.velocities[this.m_indexA].w=S,g.velocities[this.m_indexB].w=X},S.SolvePositionConstraints=function(g){var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.positions[this.m_indexB].c,X=g.positions[this.m_indexB].a,Y=this.m_qA.SetAngle(S),te=this.m_qB.SetAngle(X);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var ti=en.MulRV(Y,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var tr=en.MulRV(te,this.m_lalcB,this.m_rB),th=this.m_u.Copy(O).SelfAdd(tr).SelfSub(v).SelfSub(ti),tu=th.Normalize(),tl=tu-this.m_maxLength;tl=at(tl,0,tf);var tc=-this.m_mass*tl,t_=t8.MulSV(tc,th,n.SolvePositionConstraints_s_P);return v.SelfMulSub(this.m_invMassA,t_),S-=this.m_invIA*t8.CrossVV(ti,t_),O.SelfMulAdd(this.m_invMassB,t_),X+=this.m_invIB*t8.CrossVV(tr,t_),g.positions[this.m_indexA].a=S,g.positions[this.m_indexB].a=X,tu-this.m_maxLength<ta},S.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},S.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},S.GetReactionForce=function(g,v){return t8.MulSV(g*this.m_impulse,this.m_u,v)},S.GetReactionTorque=function(){return 0},S.GetLocalAnchorA=function(){return this.m_localAnchorA},S.GetLocalAnchorB=function(){return this.m_localAnchorB},S.SetMaxLength=function(g){this.m_maxLength=g},S.GetMaxLength=function(){return this.m_maxLength},S.GetLimitState=function(){return this.m_state},S.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),g("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),g("  jd.maxLength = %.15f;\n",this.m_maxLength),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},n}(nb);nK.InitVelocityConstraints_s_P=new t8,nK.SolveVelocityConstraints_s_vpA=new t8,nK.SolveVelocityConstraints_s_vpB=new t8,nK.SolveVelocityConstraints_s_P=new t8,nK.SolvePositionConstraints_s_P=new t8;var nJ=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_weldJoint)||this).localAnchorA=new t8,S.localAnchorB=new t8,S.referenceAngle=0,S.frequencyHz=0,S.dampingRatio=0,S}return s(i,v),i.prototype.Initialize=function(g,v,S){this.bodyA=g,this.bodyB=v,this.bodyA.GetLocalPoint(S,this.localAnchorA),this.bodyB.GetLocalPoint(S,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},i}(En),nZ=function(g){function e(v){var S;return(S=g.call(this,v)||this).m_frequencyHz=0,S.m_dampingRatio=0,S.m_bias=0,S.m_localAnchorA=new t8,S.m_localAnchorB=new t8,S.m_referenceAngle=0,S.m_gamma=0,S.m_impulse=new t7(0,0,0),S.m_indexA=0,S.m_indexB=0,S.m_rA=new t8,S.m_rB=new t8,S.m_localCenterA=new t8,S.m_localCenterB=new t8,S.m_invMassA=0,S.m_invMassB=0,S.m_invIA=0,S.m_invIB=0,S.m_mass=new ee,S.m_qA=new en,S.m_qB=new en,S.m_lalcA=new t8,S.m_lalcB=new t8,S.m_K=new ee,S.m_frequencyHz=i(v.frequencyHz,0),S.m_dampingRatio=i(v.dampingRatio,0),S.m_localAnchorA.Copy(i(v.localAnchorA,t8.ZERO)),S.m_localAnchorB.Copy(i(v.localAnchorB,t8.ZERO)),S.m_referenceAngle=i(v.referenceAngle,0),S.m_impulse.SetZero(),S}s(e,g);var v=e.prototype;return v.InitVelocityConstraints=function(g){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var v=g.positions[this.m_indexA].a,S=g.velocities[this.m_indexA].v,O=g.velocities[this.m_indexA].w,Y=g.positions[this.m_indexB].a,te=g.velocities[this.m_indexB].v,ti=g.velocities[this.m_indexB].w,tr=this.m_qA.SetAngle(v),ta=this.m_qB.SetAngle(Y);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),en.MulRV(tr,this.m_lalcA,this.m_rA),t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),en.MulRV(ta,this.m_lalcB,this.m_rB);var th=this.m_invMassA,tu=this.m_invMassB,tl=this.m_invIA,tc=this.m_invIB,t_=this.m_K;if(t_.ex.x=th+tu+this.m_rA.y*this.m_rA.y*tl+this.m_rB.y*this.m_rB.y*tc,t_.ey.x=-this.m_rA.y*this.m_rA.x*tl-this.m_rB.y*this.m_rB.x*tc,t_.ez.x=-this.m_rA.y*tl-this.m_rB.y*tc,t_.ex.y=t_.ey.x,t_.ey.y=th+tu+this.m_rA.x*this.m_rA.x*tl+this.m_rB.x*this.m_rB.x*tc,t_.ez.y=this.m_rA.x*tl+this.m_rB.x*tc,t_.ex.z=t_.ez.x,t_.ey.z=t_.ez.y,t_.ez.z=tl+tc,this.m_frequencyHz>0){t_.GetInverse22(this.m_mass);var tf=tl+tc,tp=tf>0?1/tf:0,tm=Y-v-this.m_referenceAngle,tg=2*X*this.m_frequencyHz,tv=2*tp*this.m_dampingRatio*tg,ty=tp*tg*tg,tS=g.step.dt;this.m_gamma=tS*(tv+tS*ty),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=tm*tS*ty*this.m_gamma,tf+=this.m_gamma,this.m_mass.ez.z=0!==tf?1/tf:0}else t_.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(g.step.warmStarting){this.m_impulse.SelfMul(g.step.dtRatio);var tA=e.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);S.SelfMulSub(th,tA),O-=tl*(t8.CrossVV(this.m_rA,tA)+this.m_impulse.z),te.SelfMulAdd(tu,tA),ti+=tc*(t8.CrossVV(this.m_rB,tA)+this.m_impulse.z)}else this.m_impulse.SetZero();g.velocities[this.m_indexA].w=O,g.velocities[this.m_indexB].w=ti},v.SolveVelocityConstraints=function(g){var v=g.velocities[this.m_indexA].v,S=g.velocities[this.m_indexA].w,O=g.velocities[this.m_indexB].v,X=g.velocities[this.m_indexB].w,Y=this.m_invMassA,te=this.m_invMassB,ti=this.m_invIA,tr=this.m_invIB;if(this.m_frequencyHz>0){var ta=X-S,th=-this.m_mass.ez.z*(ta+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=th,S-=ti*th,X+=tr*th;var tu=t8.SubVV(t8.AddVCrossSV(O,X,this.m_rB,t8.s_t0),t8.AddVCrossSV(v,S,this.m_rA,t8.s_t1),e.SolveVelocityConstraints_s_Cdot1),tl=ee.MulM33XY(this.m_mass,tu.x,tu.y,e.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=tl.x,this.m_impulse.y+=tl.y;var tc=tl;v.SelfMulSub(Y,tc),S-=ti*t8.CrossVV(this.m_rA,tc),O.SelfMulAdd(te,tc),X+=tr*t8.CrossVV(this.m_rB,tc)}else{var t_=t8.SubVV(t8.AddVCrossSV(O,X,this.m_rB,t8.s_t0),t8.AddVCrossSV(v,S,this.m_rA,t8.s_t1),e.SolveVelocityConstraints_s_Cdot1),tf=X-S,tp=ee.MulM33XYZ(this.m_mass,t_.x,t_.y,tf,e.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(tp);var tm=e.SolveVelocityConstraints_s_P.Set(tp.x,tp.y);v.SelfMulSub(Y,tm),S-=ti*(t8.CrossVV(this.m_rA,tm)+tp.z),O.SelfMulAdd(te,tm),X+=tr*(t8.CrossVV(this.m_rB,tm)+tp.z)}g.velocities[this.m_indexA].w=S,g.velocities[this.m_indexB].w=X},v.SolvePositionConstraints=function(g){var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.positions[this.m_indexB].c,X=g.positions[this.m_indexB].a,Y=this.m_qA.SetAngle(S),te=this.m_qB.SetAngle(X),ti=this.m_invMassA,tr=this.m_invMassB,tu=this.m_invIA,tl=this.m_invIB;t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var tc=en.MulRV(Y,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var t_,tf,tp=en.MulRV(te,this.m_lalcB,this.m_rB),tm=this.m_K;if(tm.ex.x=ti+tr+tc.y*tc.y*tu+tp.y*tp.y*tl,tm.ey.x=-tc.y*tc.x*tu-tp.y*tp.x*tl,tm.ez.x=-tc.y*tu-tp.y*tl,tm.ex.y=tm.ey.x,tm.ey.y=ti+tr+tc.x*tc.x*tu+tp.x*tp.x*tl,tm.ez.y=tc.x*tu+tp.x*tl,tm.ex.z=tm.ez.x,tm.ey.z=tm.ez.y,tm.ez.z=tu+tl,this.m_frequencyHz>0){var tg=t8.SubVV(t8.AddVV(O,tp,t8.s_t0),t8.AddVV(v,tc,t8.s_t1),e.SolvePositionConstraints_s_C1);t_=tg.Length(),tf=0;var tv=tm.Solve22(tg.x,tg.y,e.SolvePositionConstraints_s_P).SelfNeg();v.SelfMulSub(ti,tv),S-=tu*t8.CrossVV(tc,tv),O.SelfMulAdd(tr,tv),X+=tl*t8.CrossVV(tp,tv)}else{var ty=t8.SubVV(t8.AddVV(O,tp,t8.s_t0),t8.AddVV(v,tc,t8.s_t1),e.SolvePositionConstraints_s_C1),tS=X-S-this.m_referenceAngle;t_=ty.Length(),tf=tq(tS);var tA=tm.Solve33(ty.x,ty.y,tS,e.SolvePositionConstraints_s_impulse).SelfNeg(),tT=e.SolvePositionConstraints_s_P.Set(tA.x,tA.y);v.SelfMulSub(ti,tT),S-=tu*(t8.CrossVV(this.m_rA,tT)+tA.z),O.SelfMulAdd(tr,tT),X+=tl*(t8.CrossVV(this.m_rB,tT)+tA.z)}return g.positions[this.m_indexA].a=S,g.positions[this.m_indexB].a=X,t_<=ta&&tf<=th},v.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},v.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},v.GetReactionForce=function(g,v){return v.x=g*this.m_impulse.x,v.y=g*this.m_impulse.y,v},v.GetReactionTorque=function(g){return g*this.m_impulse.z},v.GetLocalAnchorA=function(){return this.m_localAnchorA},v.GetLocalAnchorB=function(){return this.m_localAnchorB},v.GetReferenceAngle=function(){return this.m_referenceAngle},v.SetFrequency=function(g){this.m_frequencyHz=g},v.GetFrequency=function(){return this.m_frequencyHz},v.SetDampingRatio=function(g){this.m_dampingRatio=g},v.GetDampingRatio=function(){return this.m_dampingRatio},v.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),g("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),g("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),g("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),g("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e}(nb);nZ.InitVelocityConstraints_s_P=new t8,nZ.SolveVelocityConstraints_s_Cdot1=new t8,nZ.SolveVelocityConstraints_s_impulse1=new t8,nZ.SolveVelocityConstraints_s_impulse=new t7,nZ.SolveVelocityConstraints_s_P=new t8,nZ.SolvePositionConstraints_s_C1=new t8,nZ.SolvePositionConstraints_s_P=new t8,nZ.SolvePositionConstraints_s_impulse=new t7;var nQ=function(v){function i(){var S;return(S=v.call(this,g.b2JointType.e_wheelJoint)||this).localAnchorA=new t8(0,0),S.localAnchorB=new t8(0,0),S.localAxisA=new t8(1,0),S.enableMotor=!1,S.maxMotorTorque=0,S.motorSpeed=0,S.frequencyHz=2,S.dampingRatio=.7,S}return s(i,v),i.prototype.Initialize=function(g,v,S,O){this.bodyA=g,this.bodyB=v,this.bodyA.GetLocalPoint(S,this.localAnchorA),this.bodyB.GetLocalPoint(S,this.localAnchorB),this.bodyA.GetLocalVector(O,this.localAxisA)},i}(En),n0=function(g){function e(v){var S;return(S=g.call(this,v)||this).m_frequencyHz=0,S.m_dampingRatio=0,S.m_localAnchorA=new t8,S.m_localAnchorB=new t8,S.m_localXAxisA=new t8,S.m_localYAxisA=new t8,S.m_impulse=0,S.m_motorImpulse=0,S.m_springImpulse=0,S.m_maxMotorTorque=0,S.m_motorSpeed=0,S.m_enableMotor=!1,S.m_indexA=0,S.m_indexB=0,S.m_localCenterA=new t8,S.m_localCenterB=new t8,S.m_invMassA=0,S.m_invMassB=0,S.m_invIA=0,S.m_invIB=0,S.m_ax=new t8,S.m_ay=new t8,S.m_sAx=0,S.m_sBx=0,S.m_sAy=0,S.m_sBy=0,S.m_mass=0,S.m_motorMass=0,S.m_springMass=0,S.m_bias=0,S.m_gamma=0,S.m_qA=new en,S.m_qB=new en,S.m_lalcA=new t8,S.m_lalcB=new t8,S.m_rA=new t8,S.m_rB=new t8,S.m_frequencyHz=i(v.frequencyHz,2),S.m_dampingRatio=i(v.dampingRatio,.7),S.m_localAnchorA.Copy(i(v.localAnchorA,t8.ZERO)),S.m_localAnchorB.Copy(i(v.localAnchorB,t8.ZERO)),S.m_localXAxisA.Copy(i(v.localAxisA,t8.UNITX)),t8.CrossOneV(S.m_localXAxisA,S.m_localYAxisA),S.m_maxMotorTorque=i(v.maxMotorTorque,0),S.m_motorSpeed=i(v.motorSpeed,0),S.m_enableMotor=i(v.enableMotor,!1),S.m_ax.SetZero(),S.m_ay.SetZero(),S}s(e,g);var v=e.prototype;return v.GetMotorSpeed=function(){return this.m_motorSpeed},v.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},v.SetSpringFrequencyHz=function(g){this.m_frequencyHz=g},v.GetSpringFrequencyHz=function(){return this.m_frequencyHz},v.SetSpringDampingRatio=function(g){this.m_dampingRatio=g},v.GetSpringDampingRatio=function(){return this.m_dampingRatio},v.InitVelocityConstraints=function(g){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var v=this.m_invMassA,S=this.m_invMassB,O=this.m_invIA,Y=this.m_invIB,te=g.positions[this.m_indexA].c,ti=g.positions[this.m_indexA].a,tr=g.velocities[this.m_indexA].v,ta=g.velocities[this.m_indexA].w,th=g.positions[this.m_indexB].c,tu=g.positions[this.m_indexB].a,tl=g.velocities[this.m_indexB].v,tc=g.velocities[this.m_indexB].w,t_=this.m_qA.SetAngle(ti),tf=this.m_qB.SetAngle(tu);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var tp=en.MulRV(t_,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var tm=en.MulRV(tf,this.m_lalcB,this.m_rB),tg=t8.SubVV(t8.AddVV(th,tm,t8.s_t0),t8.AddVV(te,tp,t8.s_t1),e.InitVelocityConstraints_s_d);if(en.MulRV(t_,this.m_localYAxisA,this.m_ay),this.m_sAy=t8.CrossVV(t8.AddVV(tg,tp,t8.s_t0),this.m_ay),this.m_sBy=t8.CrossVV(tm,this.m_ay),this.m_mass=v+S+O*this.m_sAy*this.m_sAy+Y*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){en.MulRV(t_,this.m_localXAxisA,this.m_ax),this.m_sAx=t8.CrossVV(t8.AddVV(tg,tp,t8.s_t0),this.m_ax),this.m_sBx=t8.CrossVV(tm,this.m_ax);var tv=v+S+O*this.m_sAx*this.m_sAx+Y*this.m_sBx*this.m_sBx;if(tv>0){this.m_springMass=1/tv;var ty=t8.DotVV(tg,this.m_ax),tS=2*X*this.m_frequencyHz,tA=2*this.m_springMass*this.m_dampingRatio*tS,tT=this.m_springMass*tS*tS,tE=g.step.dt;this.m_gamma=tE*(tA+tE*tT),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=ty*tE*tT*this.m_gamma,this.m_springMass=tv+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=O+Y,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),g.step.warmStarting){this.m_impulse*=g.step.dtRatio,this.m_springImpulse*=g.step.dtRatio,this.m_motorImpulse*=g.step.dtRatio;var tC=t8.AddVV(t8.MulSV(this.m_impulse,this.m_ay,t8.s_t0),t8.MulSV(this.m_springImpulse,this.m_ax,t8.s_t1),e.InitVelocityConstraints_s_P),tx=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,tb=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;tr.SelfMulSub(this.m_invMassA,tC),ta-=this.m_invIA*tx,tl.SelfMulAdd(this.m_invMassB,tC),tc+=this.m_invIB*tb}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;g.velocities[this.m_indexA].w=ta,g.velocities[this.m_indexB].w=tc},v.SolveVelocityConstraints=function(g){var v=this.m_invMassA,S=this.m_invMassB,O=this.m_invIA,X=this.m_invIB,Y=g.velocities[this.m_indexA].v,te=g.velocities[this.m_indexA].w,ti=g.velocities[this.m_indexB].v,tr=g.velocities[this.m_indexB].w,ta=t8.DotVV(this.m_ax,t8.SubVV(ti,Y,t8.s_t0))+this.m_sBx*tr-this.m_sAx*te,th=-this.m_springMass*(ta+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=th;var tu=t8.MulSV(th,this.m_ax,e.SolveVelocityConstraints_s_P),tl=th*this.m_sAx,tc=th*this.m_sBx;Y.SelfMulSub(v,tu),te-=O*tl,ti.SelfMulAdd(S,tu);var t_=(tr+=X*tc)-te-this.m_motorSpeed,tf=-this.m_motorMass*t_,tp=this.m_motorImpulse,tm=g.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=at(this.m_motorImpulse+tf,-tm,tm),te-=O*(tf=this.m_motorImpulse-tp),tr+=X*tf;var tg=t8.DotVV(this.m_ay,t8.SubVV(ti,Y,t8.s_t0))+this.m_sBy*tr-this.m_sAy*te,tv=-this.m_mass*tg;this.m_impulse+=tv;var ty=t8.MulSV(tv,this.m_ay,e.SolveVelocityConstraints_s_P),tS=tv*this.m_sAy,tA=tv*this.m_sBy;Y.SelfMulSub(v,ty),te-=O*tS,ti.SelfMulAdd(S,ty),tr+=X*tA,g.velocities[this.m_indexA].w=te,g.velocities[this.m_indexB].w=tr},v.SolvePositionConstraints=function(g){var v=g.positions[this.m_indexA].c,S=g.positions[this.m_indexA].a,O=g.positions[this.m_indexB].c,X=g.positions[this.m_indexB].a,Y=this.m_qA.SetAngle(S),te=this.m_qB.SetAngle(X);t8.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var ti=en.MulRV(Y,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var tr,th=en.MulRV(te,this.m_lalcB,this.m_rB),tu=t8.AddVV(t8.SubVV(O,v,t8.s_t0),t8.SubVV(th,ti,t8.s_t1),e.SolvePositionConstraints_s_d),tl=en.MulRV(Y,this.m_localYAxisA,this.m_ay),tc=t8.CrossVV(t8.AddVV(tu,ti,t8.s_t0),tl),t_=t8.CrossVV(th,tl),tf=t8.DotVV(tu,this.m_ay),tp=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;tr=0!==tp?-tf/tp:0;var tm=t8.MulSV(tr,tl,e.SolvePositionConstraints_s_P),tg=tr*tc,tv=tr*t_;return v.SelfMulSub(this.m_invMassA,tm),S-=this.m_invIA*tg,O.SelfMulAdd(this.m_invMassB,tm),X+=this.m_invIB*tv,g.positions[this.m_indexA].a=S,g.positions[this.m_indexB].a=X,tq(tf)<=ta},v.GetDefinition=function(g){return g},v.GetAnchorA=function(g){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,g)},v.GetAnchorB=function(g){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,g)},v.GetReactionForce=function(g,v){return v.x=g*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),v.y=g*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),v},v.GetReactionTorque=function(g){return g*this.m_motorImpulse},v.GetLocalAnchorA=function(){return this.m_localAnchorA},v.GetLocalAnchorB=function(){return this.m_localAnchorB},v.GetLocalAxisA=function(){return this.m_localXAxisA},v.GetJointTranslation=function(){return this.GetPrismaticJointTranslation()},v.GetJointLinearSpeed=function(){return this.GetPrismaticJointSpeed()},v.GetJointAngle=function(){return this.GetRevoluteJointAngle()},v.GetJointAngularSpeed=function(){return this.GetRevoluteJointSpeed()},v.GetPrismaticJointTranslation=function(){var g=this.m_bodyA,v=this.m_bodyB,S=g.GetWorldPoint(this.m_localAnchorA,new t8),O=v.GetWorldPoint(this.m_localAnchorB,new t8),X=t8.SubVV(O,S,new t8),Y=g.GetWorldVector(this.m_localXAxisA,new t8);return t8.DotVV(X,Y)},v.GetPrismaticJointSpeed=function(){var g=this.m_bodyA,v=this.m_bodyB;t8.SubVV(this.m_localAnchorA,g.m_sweep.localCenter,this.m_lalcA);var S=en.MulRV(g.m_xf.q,this.m_lalcA,this.m_rA);t8.SubVV(this.m_localAnchorB,v.m_sweep.localCenter,this.m_lalcB);var O=en.MulRV(v.m_xf.q,this.m_lalcB,this.m_rB),X=t8.AddVV(g.m_sweep.c,S,t8.s_t0),Y=t8.AddVV(v.m_sweep.c,O,t8.s_t1),te=t8.SubVV(Y,X,t8.s_t2),ti=g.GetWorldVector(this.m_localXAxisA,new t8),tr=g.m_linearVelocity,ta=v.m_linearVelocity,th=g.m_angularVelocity,tu=v.m_angularVelocity;return t8.DotVV(te,t8.CrossSV(th,ti,t8.s_t0))+t8.DotVV(ti,t8.SubVV(t8.AddVCrossSV(ta,tu,O,t8.s_t0),t8.AddVCrossSV(tr,th,S,t8.s_t1),t8.s_t0))},v.GetRevoluteJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a},v.GetRevoluteJointSpeed=function(){var g=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-g},v.IsMotorEnabled=function(){return this.m_enableMotor},v.EnableMotor=function(g){g!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=g)},v.SetMotorSpeed=function(g){g!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=g)},v.SetMaxMotorTorque=function(g){g!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=g)},v.GetMotorTorque=function(g){return g*this.m_motorImpulse},v.Dump=function(g){var v=this.m_bodyA.m_islandIndex,S=this.m_bodyB.m_islandIndex;g("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),g("  jd.bodyA = bodies[%d];\n",v),g("  jd.bodyB = bodies[%d];\n",S),g("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),g("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),g("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),g("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),g("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),g("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),g("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),g("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),g("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),g("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e}(nb);function Jn(g,v){return tZ(g*v)}function Qn(g,v){return g>v?g:v}n0.InitVelocityConstraints_s_d=new t8,n0.InitVelocityConstraints_s_P=new t8,n0.SolveVelocityConstraints_s_P=new t8,n0.SolvePositionConstraints_s_d=new t8,n0.SolvePositionConstraints_s_P=new t8;var n1=function(){function t1(g){this._other=null,this.prev=null,this.next=null,this.contact=g}return t1.prototype.Reset=function(){this._other=null,this.prev=null,this.next=null},n(t1,[{key:"other",get:function(){if(null===this._other)throw new Error;return this._other},set:function(g){if(null!==this._other)throw new Error;this._other=g}}]),t1}(),n2=function(){function t1(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new n1(this),this.m_nodeB=new n1(this),this.m_indexA=0,this.m_indexB=0,this.m_manifold=new eY,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new eY}var g=t1.prototype;return g.GetManifold=function(){return this.m_manifold},g.GetWorldManifold=function(g){var v=this.m_fixtureA.GetBody(),S=this.m_fixtureB.GetBody(),O=this.GetShapeA(),X=this.GetShapeB();g.Initialize(this.m_manifold,v.GetTransform(),O.m_radius,S.GetTransform(),X.m_radius)},g.IsTouching=function(){return this.m_touchingFlag},g.SetEnabled=function(g){this.m_enabledFlag=g},g.IsEnabled=function(){return this.m_enabledFlag},g.GetNext=function(){return this.m_next},g.GetFixtureA=function(){return this.m_fixtureA},g.GetChildIndexA=function(){return this.m_indexA},g.GetShapeA=function(){return this.m_fixtureA.GetShape()},g.GetFixtureB=function(){return this.m_fixtureB},g.GetChildIndexB=function(){return this.m_indexB},g.GetShapeB=function(){return this.m_fixtureB.GetShape()},g.FlagForFiltering=function(){this.m_filterFlag=!0},g.SetFriction=function(g){this.m_friction=g},g.GetFriction=function(){return this.m_friction},g.ResetFriction=function(){this.m_friction=Jn(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},g.SetRestitution=function(g){this.m_restitution=g},g.GetRestitution=function(){return this.m_restitution},g.ResetRestitution=function(){this.m_restitution=Qn(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},g.SetTangentSpeed=function(g){this.m_tangentSpeed=g},g.GetTangentSpeed=function(){return this.m_tangentSpeed},g.Reset=function(g,v,S,O){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=g,this.m_fixtureB=S,this.m_indexA=v,this.m_indexB=O,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=Jn(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Qn(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},g.Update=function(g){var v=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=v,this.m_enabledFlag=!0;var S=!1,O=this.m_touchingFlag,X=this.m_fixtureA.IsSensor(),Y=this.m_fixtureB.IsSensor(),te=X||Y,ti=this.m_fixtureA.GetBody(),tr=this.m_fixtureB.GetBody(),ta=ti.GetTransform(),th=tr.GetTransform();if(te){var tu=this.GetShapeA(),tl=this.GetShapeB();S=Pe(tu,this.m_indexA,tl,this.m_indexB,ta,th),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,ta,th),S=this.m_manifold.pointCount>0;for(var tc=0;tc<this.m_manifold.pointCount;++tc){var t_=this.m_manifold.points[tc];t_.normalImpulse=0,t_.tangentImpulse=0;for(var tf=t_.id,tp=0;tp<this.m_oldManifold.pointCount;++tp){var tm=this.m_oldManifold.points[tp];if(tm.id.key===tf.key){t_.normalImpulse=tm.normalImpulse,t_.tangentImpulse=tm.tangentImpulse;break}}}S!==O&&(ti.SetAwake(!0),tr.SetAwake(!0))}this.m_touchingFlag=S,!O&&S&&g&&g.BeginContact(this),O&&!S&&g&&g.EndContact(this),!te&&S&&g&&g.PreSolve(this,this.m_oldManifold)},g.ComputeTOI=function(g,v){var S=t1.ComputeTOI_s_input;S.proxyA.SetShape(this.GetShapeA(),this.m_indexA),S.proxyB.SetShape(this.GetShapeB(),this.m_indexB),S.sweepA.Copy(g),S.sweepB.Copy(v),S.tMax=ta;var O=t1.ComputeTOI_s_output;return ui(O,S),O.t},t1}();n2.ComputeTOI_s_input=new _$Je,n2.ComputeTOI_s_output=new Ze;var n3=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(g,v,S){_i(g,this.GetShapeA(),v,this.GetShapeB(),S)},e}(n2),n4=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(g,v,S){Vi(g,this.GetShapeA(),v,this.GetShapeB(),S)},e}(n2),n8=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(g,v,S){mi(g,this.GetShapeA(),v,this.GetShapeB(),S)},e}(n2),n6=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(g,v,S){Ji(g,this.GetShapeA(),v,this.GetShapeB(),S)},e}(n2),n7=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(g,v,S){rn(g,this.GetShapeA(),v,this.GetShapeB(),S)},e}(n2),n9=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(g,v,S){var O=e.Evaluate_s_edge;this.GetShapeA().GetChildEdge(O,this.m_indexA),Ji(g,O,v,this.GetShapeB(),S)},e}(n2);n9.Evaluate_s_edge=new nf;var rr=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(g,v,S){var O=e.Evaluate_s_edge;this.GetShapeA().GetChildEdge(O,this.m_indexA),rn(g,O,v,this.GetShapeB(),S)},e}(n2);rr.Evaluate_s_edge=new nf;var or=function(){this.pool=[],this.createFcn=null,this.destroyFcn=null,this.primary=!1},ra=function(){function e(){this.m_registers=[],this.InitializeRegisters()}var v=e.prototype;return v.AddType=function(g,v,S,O){var X=[];function s(){return X.pop()||g()}function a(g){X.push(g)}this.m_registers[S][O].pool=X,this.m_registers[S][O].createFcn=s,this.m_registers[S][O].destroyFcn=a,this.m_registers[S][O].primary=!0,S!==O&&(this.m_registers[O][S].pool=X,this.m_registers[O][S].createFcn=s,this.m_registers[O][S].destroyFcn=a,this.m_registers[O][S].primary=!1)},v.InitializeRegisters=function(){for(var v=0;v<g.b2ShapeType.e_shapeTypeCount;v++){this.m_registers[v]=[];for(var S=0;S<g.b2ShapeType.e_shapeTypeCount;S++)this.m_registers[v][S]=new or}this.AddType(n3.Create,n3.Destroy,g.b2ShapeType.e_circleShape,g.b2ShapeType.e_circleShape),this.AddType(n8.Create,n8.Destroy,g.b2ShapeType.e_polygonShape,g.b2ShapeType.e_circleShape),this.AddType(n4.Create,n4.Destroy,g.b2ShapeType.e_polygonShape,g.b2ShapeType.e_polygonShape),this.AddType(n6.Create,n6.Destroy,g.b2ShapeType.e_edgeShape,g.b2ShapeType.e_circleShape),this.AddType(n7.Create,n7.Destroy,g.b2ShapeType.e_edgeShape,g.b2ShapeType.e_polygonShape),this.AddType(n9.Create,n9.Destroy,g.b2ShapeType.e_chainShape,g.b2ShapeType.e_circleShape),this.AddType(rr.Create,rr.Destroy,g.b2ShapeType.e_chainShape,g.b2ShapeType.e_polygonShape)},v.Create=function(g,v,S,O){var X=g.GetType(),Y=S.GetType(),te=this.m_registers[X][Y];if(te.createFcn){var ti=te.createFcn();return te.primary?ti.Reset(g,v,S,O):ti.Reset(S,O,g,v),ti}return null},v.Destroy=function(g){var v=g.m_fixtureA.GetType(),S=g.m_fixtureB.GetType(),O=this.m_registers[v][S];O.destroyFcn&&O.destroyFcn(g)},e}(),ru=function(){function t1(){}var g=t1.prototype;return g.SayGoodbyeJoint=function(){},g.SayGoodbyeFixture=function(){},g.SayGoodbyeParticleGroup=function(){},g.SayGoodbyeParticle=function(){},t1}(),rl=function(){function e(){}var v=e.prototype;return v.ShouldCollide=function(v,S){var O=v.GetBody(),X=S.GetBody();if(X.GetType()===g.b2BodyType.b2_staticBody&&O.GetType()===g.b2BodyType.b2_staticBody)return!1;if(!X.ShouldCollideConnected(O))return!1;var Y=v.GetFilterData(),te=S.GetFilterData();return Y.groupIndex===te.groupIndex&&0!==Y.groupIndex?Y.groupIndex>0:0!=(Y.maskBits&te.categoryBits)&&0!=(Y.categoryBits&te.maskBits)},v.ShouldCollideFixtureParticle=function(){return!0},v.ShouldCollideParticleParticle=function(){return!0},e}();rl.b2_defaultFilter=new rl;var cr=function(){this.normalImpulses=$(Y),this.tangentImpulses=$(Y),this.count=0},rc=function(){function t1(){}var g=t1.prototype;return g.BeginContact=function(){},g.EndContact=function(){},g.BeginContactFixtureParticle=function(){},g.EndContactFixtureParticle=function(){},g.BeginContactParticleParticle=function(){},g.EndContactParticleParticle=function(){},g.PreSolve=function(){},g.PostSolve=function(){},t1}();rc.b2_defaultListener=new rc;var r_=function(){function t1(){}var g=t1.prototype;return g.ReportFixture=function(){return!0},g.ReportParticle=function(){return!1},g.ShouldQueryParticleSystem=function(){return!0},t1}(),rf=function(){function t1(){}var g=t1.prototype;return g.ReportFixture=function(g,v,S,O){return O},g.ReportParticle=function(){return 0},g.ShouldQueryParticleSystem=function(){return!0},t1}(),rd=function(){function e(){this.m_broadPhase=new e6,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=rl.b2_defaultFilter,this.m_contactListener=rc.b2_defaultListener,this.m_contactFactory=new ra}var v=e.prototype;return v.AddPair=function(g,v){var S=g.fixture,O=v.fixture,X=g.childIndex,Y=v.childIndex,te=S.GetBody(),ti=O.GetBody();if(te!==ti){for(var tr=ti.GetContactList();tr;){if(tr.other===te){var ta=tr.contact.GetFixtureA(),th=tr.contact.GetFixtureB(),tu=tr.contact.GetChildIndexA(),tl=tr.contact.GetChildIndexB();if(ta===S&&th===O&&tu===X&&tl===Y)return;if(ta===O&&th===S&&tu===Y&&tl===X)return}tr=tr.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(S,O)){var tc=this.m_contactFactory.Create(S,X,O,Y);null!==tc&&(S=tc.GetFixtureA(),O=tc.GetFixtureB(),X=tc.GetChildIndexA(),Y=tc.GetChildIndexB(),te=S.m_body,ti=O.m_body,tc.m_prev=null,tc.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=tc),this.m_contactList=tc,tc.m_nodeA.other=ti,tc.m_nodeA.prev=null,tc.m_nodeA.next=te.m_contactList,null!==te.m_contactList&&(te.m_contactList.prev=tc.m_nodeA),te.m_contactList=tc.m_nodeA,tc.m_nodeB.other=te,tc.m_nodeB.prev=null,tc.m_nodeB.next=ti.m_contactList,null!==ti.m_contactList&&(ti.m_contactList.prev=tc.m_nodeB),ti.m_contactList=tc.m_nodeB,S.IsSensor()||O.IsSensor()||(te.SetAwake(!0),ti.SetAwake(!0)),++this.m_contactCount)}}},v.FindNewContacts=function(){var g=this;this.m_broadPhase.UpdatePairs(function(v,S){g.AddPair(v,S)})},v.Destroy=function(g){var v=g.GetFixtureA(),S=g.GetFixtureB(),O=v.GetBody(),X=S.GetBody();this.m_contactListener&&g.IsTouching()&&this.m_contactListener.EndContact(g),g.m_prev&&(g.m_prev.m_next=g.m_next),g.m_next&&(g.m_next.m_prev=g.m_prev),g===this.m_contactList&&(this.m_contactList=g.m_next),g.m_nodeA.prev&&(g.m_nodeA.prev.next=g.m_nodeA.next),g.m_nodeA.next&&(g.m_nodeA.next.prev=g.m_nodeA.prev),g.m_nodeA===O.m_contactList&&(O.m_contactList=g.m_nodeA.next),g.m_nodeB.prev&&(g.m_nodeB.prev.next=g.m_nodeB.next),g.m_nodeB.next&&(g.m_nodeB.next.prev=g.m_nodeB.prev),g.m_nodeB===X.m_contactList&&(X.m_contactList=g.m_nodeB.next),!(g.m_manifold.pointCount>0)||v.IsSensor()||S.IsSensor()||(v.GetBody().SetAwake(!0),S.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(g),--this.m_contactCount},v.Collide=function(){for(var v=this.m_contactList;v;){var S=v.GetFixtureA(),O=v.GetFixtureB(),X=v.GetChildIndexA(),Y=v.GetChildIndexB(),te=S.GetBody(),ti=O.GetBody();if(v.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(S,O)){var tr=v;v=tr.m_next,this.Destroy(tr);continue}v.m_filterFlag=!1}var ta=te.IsAwake()&&te.m_type!==g.b2BodyType.b2_staticBody,th=ti.IsAwake()&&ti.m_type!==g.b2BodyType.b2_staticBody;if(ta||th){var tu=S.m_proxies[X].treeNode,tl=O.m_proxies[Y].treeNode;if(xe(tu.aabb,tl.aabb))v.Update(this.m_contactListener),v=v.m_next;else{var tc=v;v=tc.m_next,this.Destroy(tc)}}else v=v.m_next}},e}(),rp=function(){function t1(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return t1.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},t1}(),rm=function(){function t1(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}return t1.prototype.Copy=function(g){return this.dt=g.dt,this.inv_dt=g.inv_dt,this.dtRatio=g.dtRatio,this.positionIterations=g.positionIterations,this.velocityIterations=g.velocityIterations,this.particleIterations=g.particleIterations,this.warmStarting=g.warmStarting,this},t1}(),rg=function(){function t1(){this.c=new t8,this.a=0}return t1.MakeArray=function(g){return Q(g,function(){return new t1})},t1}(),rS=function(){function t1(){this.v=new t8,this.w=0}return t1.MakeArray=function(g){return Q(g,function(){return new t1})},t1}(),Sr=function(){this.step=new rm},rA=!1,rT=function(){function t1(){this.rA=new t8,this.rB=new t8,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t1.MakeArray=function(g){return Q(g,function(){return new t1})},t1}(),rE=function(){function t1(){this.points=rT.MakeArray(Y),this.normal=new t8,this.tangent=new t8,this.normalMass=new t9,this.K=new t9,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return t1.MakeArray=function(g){return Q(g,function(){return new t1})},t1}(),rC=function(){function e(){this.localPoints=t8.MakeArray(Y),this.localNormal=new t8,this.localPoint=new t8,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new t8,this.localCenterB=new t8,this.invIA=0,this.invIB=0,this.type=g.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return e.MakeArray=function(g){return Q(g,function(){return new e})},e}(),br=function(){this.step=new rm,this.count=0},rx=function(){function e(){this.normal=new t8,this.point=new t8,this.separation=0}return e.prototype.Initialize=function(v,S,O,X){var Y=e.Initialize_s_pointA,te=e.Initialize_s_pointB,ti=e.Initialize_s_planePoint,tr=e.Initialize_s_clipPoint;switch(v.type){case g.b2ManifoldType.e_circles:er.MulXV(S,v.localPoint,Y),er.MulXV(O,v.localPoints[0],te),t8.SubVV(te,Y,this.normal).SelfNormalize(),t8.MidVV(Y,te,this.point),this.separation=t8.DotVV(t8.SubVV(te,Y,t8.s_t0),this.normal)-v.radiusA-v.radiusB;break;case g.b2ManifoldType.e_faceA:en.MulRV(S.q,v.localNormal,this.normal),er.MulXV(S,v.localPoint,ti),er.MulXV(O,v.localPoints[X],tr),this.separation=t8.DotVV(t8.SubVV(tr,ti,t8.s_t0),this.normal)-v.radiusA-v.radiusB,this.point.Copy(tr);break;case g.b2ManifoldType.e_faceB:en.MulRV(O.q,v.localNormal,this.normal),er.MulXV(O,v.localPoint,ti),er.MulXV(S,v.localPoints[X],tr),this.separation=t8.DotVV(t8.SubVV(tr,ti,t8.s_t0),this.normal)-v.radiusA-v.radiusB,this.point.Copy(tr),this.normal.SelfNeg()}},e}();rx.Initialize_s_pointA=new t8,rx.Initialize_s_pointB=new t8,rx.Initialize_s_planePoint=new t8,rx.Initialize_s_clipPoint=new t8;var rb=function(){function t1(){this.m_step=new rm,this.m_positionConstraints=rC.MakeArray(1024),this.m_velocityConstraints=rE.MakeArray(1024),this.m_count=0}var g=t1.prototype;return g.Initialize=function(g){if(this.m_step.Copy(g.step),this.m_count=g.count,this.m_positionConstraints.length<this.m_count)for(var v=st(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<v;)this.m_positionConstraints[this.m_positionConstraints.length]=new rC;if(this.m_velocityConstraints.length<this.m_count)for(var S=st(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<S;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new rE;this.m_positions=g.positions,this.m_velocities=g.velocities,this.m_contacts=g.contacts;for(var O=0;O<this.m_count;++O){var X=this.m_contacts[O],Y=X.m_fixtureA,te=X.m_fixtureB,ti=Y.GetShape(),tr=te.GetShape(),ta=ti.m_radius,th=tr.m_radius,tu=Y.GetBody(),tl=te.GetBody(),tc=X.GetManifold(),t_=tc.pointCount,tf=this.m_velocityConstraints[O];tf.friction=X.m_friction,tf.restitution=X.m_restitution,tf.tangentSpeed=X.m_tangentSpeed,tf.indexA=tu.m_islandIndex,tf.indexB=tl.m_islandIndex,tf.invMassA=tu.m_invMass,tf.invMassB=tl.m_invMass,tf.invIA=tu.m_invI,tf.invIB=tl.m_invI,tf.contactIndex=O,tf.pointCount=t_,tf.K.SetZero(),tf.normalMass.SetZero();var tp=this.m_positionConstraints[O];tp.indexA=tu.m_islandIndex,tp.indexB=tl.m_islandIndex,tp.invMassA=tu.m_invMass,tp.invMassB=tl.m_invMass,tp.localCenterA.Copy(tu.m_sweep.localCenter),tp.localCenterB.Copy(tl.m_sweep.localCenter),tp.invIA=tu.m_invI,tp.invIB=tl.m_invI,tp.localNormal.Copy(tc.localNormal),tp.localPoint.Copy(tc.localPoint),tp.pointCount=t_,tp.radiusA=ta,tp.radiusB=th,tp.type=tc.type;for(var tm=0;tm<t_;++tm){var tg=tc.points[tm],tv=tf.points[tm];this.m_step.warmStarting?(tv.normalImpulse=this.m_step.dtRatio*tg.normalImpulse,tv.tangentImpulse=this.m_step.dtRatio*tg.tangentImpulse):(tv.normalImpulse=0,tv.tangentImpulse=0),tv.rA.SetZero(),tv.rB.SetZero(),tv.normalMass=0,tv.tangentMass=0,tv.velocityBias=0,tp.localPoints[tm].Copy(tg.localPoint)}}return this},g.InitializeVelocityConstraints=function(){for(var g=t1.InitializeVelocityConstraints_s_xfA,v=t1.InitializeVelocityConstraints_s_xfB,S=t1.InitializeVelocityConstraints_s_worldManifold,O=1e3,X=0;X<this.m_count;++X){var Y=this.m_velocityConstraints[X],te=this.m_positionConstraints[X],ti=te.radiusA,tr=te.radiusB,ta=this.m_contacts[Y.contactIndex].GetManifold(),th=Y.indexA,tu=Y.indexB,tl=Y.invMassA,tc=Y.invMassB,tf=Y.invIA,tp=Y.invIB,tm=te.localCenterA,tg=te.localCenterB,tv=this.m_positions[th].c,ty=this.m_positions[th].a,tS=this.m_velocities[th].v,tA=this.m_velocities[th].w,tT=this.m_positions[tu].c,tE=this.m_positions[tu].a,tC=this.m_velocities[tu].v,tx=this.m_velocities[tu].w;g.q.SetAngle(ty),v.q.SetAngle(tE),t8.SubVV(tv,en.MulRV(g.q,tm,t8.s_t0),g.p),t8.SubVV(tT,en.MulRV(v.q,tg,t8.s_t0),v.p),S.Initialize(ta,g,ti,v,tr),Y.normal.Copy(S.normal),t8.CrossVOne(Y.normal,Y.tangent);for(var tb=Y.pointCount,tw=0;tw<tb;++tw){var tI=Y.points[tw];t8.SubVV(S.points[tw],tv,tI.rA),t8.SubVV(S.points[tw],tT,tI.rB);var tB=t8.CrossVV(tI.rA,Y.normal),tP=t8.CrossVV(tI.rB,Y.normal),tD=tl+tc+tf*tB*tB+tp*tP*tP;tI.normalMass=tD>0?1/tD:0;var tM=Y.tangent,tO=t8.CrossVV(tI.rA,tM),tk=t8.CrossVV(tI.rB,tM),tG=tl+tc+tf*tO*tO+tp*tk*tk;tI.tangentMass=tG>0?1/tG:0,tI.velocityBias=0;var tV=t8.DotVV(Y.normal,t8.SubVV(t8.AddVCrossSV(tC,tx,tI.rB,t8.s_t0),t8.AddVCrossSV(tS,tA,tI.rA,t8.s_t1),t8.s_t0));tV<-t_&&(tI.velocityBias+=-Y.restitution*tV)}if(2===Y.pointCount&&rA){var tU=Y.points[0],tH=Y.points[1],tz=t8.CrossVV(tU.rA,Y.normal),tW=t8.CrossVV(tU.rB,Y.normal),tj=t8.CrossVV(tH.rA,Y.normal),tq=t8.CrossVV(tH.rB,Y.normal),tK=tl+tc+tf*tz*tz+tp*tW*tW,tZ=tl+tc+tf*tj*tj+tp*tq*tq,tQ=tl+tc+tf*tz*tj+tp*tW*tq;tK*tK<O*(tK*tZ-tQ*tQ)?(Y.K.ex.Set(tK,tQ),Y.K.ey.Set(tQ,tZ),Y.K.GetInverse(Y.normalMass)):Y.pointCount=1}}},g.WarmStart=function(){for(var g=t1.WarmStart_s_P,v=0;v<this.m_count;++v){for(var S=this.m_velocityConstraints[v],O=S.indexA,X=S.indexB,Y=S.invMassA,te=S.invIA,ti=S.invMassB,tr=S.invIB,ta=S.pointCount,th=this.m_velocities[O].v,tu=this.m_velocities[O].w,tl=this.m_velocities[X].v,tc=this.m_velocities[X].w,t_=S.normal,tf=S.tangent,tp=0;tp<ta;++tp){var tm=S.points[tp];t8.AddVV(t8.MulSV(tm.normalImpulse,t_,t8.s_t0),t8.MulSV(tm.tangentImpulse,tf,t8.s_t1),g),tu-=te*t8.CrossVV(tm.rA,g),th.SelfMulSub(Y,g),tc+=tr*t8.CrossVV(tm.rB,g),tl.SelfMulAdd(ti,g)}this.m_velocities[O].w=tu,this.m_velocities[X].w=tc}},g.SolveVelocityConstraints=function(){for(var g=t1.SolveVelocityConstraints_s_dv,v=t1.SolveVelocityConstraints_s_dv1,S=t1.SolveVelocityConstraints_s_dv2,O=t1.SolveVelocityConstraints_s_P,X=t1.SolveVelocityConstraints_s_a,Y=t1.SolveVelocityConstraints_s_b,te=t1.SolveVelocityConstraints_s_x,ti=t1.SolveVelocityConstraints_s_d,tr=t1.SolveVelocityConstraints_s_P1,ta=t1.SolveVelocityConstraints_s_P2,th=t1.SolveVelocityConstraints_s_P1P2,tu=0;tu<this.m_count;++tu){for(var tl=this.m_velocityConstraints[tu],tc=tl.indexA,t_=tl.indexB,tf=tl.invMassA,tp=tl.invIA,tm=tl.invMassB,tg=tl.invIB,tv=tl.pointCount,ty=this.m_velocities[tc].v,tS=this.m_velocities[tc].w,tA=this.m_velocities[t_].v,tT=this.m_velocities[t_].w,tE=tl.normal,tC=tl.tangent,tx=tl.friction,tb=0;tb<tv;++tb){var tw=tl.points[tb];t8.SubVV(t8.AddVCrossSV(tA,tT,tw.rB,t8.s_t0),t8.AddVCrossSV(ty,tS,tw.rA,t8.s_t1),g);var tI=t8.DotVV(g,tC)-tl.tangentSpeed,tB=tw.tangentMass*-tI,tP=tx*tw.normalImpulse,tD=at(tw.tangentImpulse+tB,-tP,tP);tB=tD-tw.tangentImpulse,tw.tangentImpulse=tD,t8.MulSV(tB,tC,O),ty.SelfMulSub(tf,O),tS-=tp*t8.CrossVV(tw.rA,O),tA.SelfMulAdd(tm,O),tT+=tg*t8.CrossVV(tw.rB,O)}if(1===tl.pointCount||!1===rA)for(var tM=0;tM<tv;++tM){var tO=tl.points[tM];t8.SubVV(t8.AddVCrossSV(tA,tT,tO.rB,t8.s_t0),t8.AddVCrossSV(ty,tS,tO.rA,t8.s_t1),g);var tk=t8.DotVV(g,tE),tG=-tO.normalMass*(tk-tO.velocityBias),tV=st(tO.normalImpulse+tG,0);tG=tV-tO.normalImpulse,tO.normalImpulse=tV,t8.MulSV(tG,tE,O),ty.SelfMulSub(tf,O),tS-=tp*t8.CrossVV(tO.rA,O),tA.SelfMulAdd(tm,O),tT+=tg*t8.CrossVV(tO.rB,O)}else{var tU=tl.points[0],tH=tl.points[1];X.Set(tU.normalImpulse,tH.normalImpulse),t8.SubVV(t8.AddVCrossSV(tA,tT,tU.rB,t8.s_t0),t8.AddVCrossSV(ty,tS,tU.rA,t8.s_t1),v),t8.SubVV(t8.AddVCrossSV(tA,tT,tH.rB,t8.s_t0),t8.AddVCrossSV(ty,tS,tH.rA,t8.s_t1),S);var tz=t8.DotVV(v,tE),tW=t8.DotVV(S,tE);for(Y.x=tz-tU.velocityBias,Y.y=tW-tH.velocityBias,Y.SelfSub(t9.MulMV(tl.K,X,t8.s_t0));;){if(t9.MulMV(tl.normalMass,Y,te).SelfNeg(),te.x>=0&&te.y>=0){t8.SubVV(te,X,ti),t8.MulSV(ti.x,tE,tr),t8.MulSV(ti.y,tE,ta),t8.AddVV(tr,ta,th),ty.SelfMulSub(tf,th),tS-=tp*(t8.CrossVV(tU.rA,tr)+t8.CrossVV(tH.rA,ta)),tA.SelfMulAdd(tm,th),tT+=tg*(t8.CrossVV(tU.rB,tr)+t8.CrossVV(tH.rB,ta)),tU.normalImpulse=te.x,tH.normalImpulse=te.y;break}if(te.x=-tU.normalMass*Y.x,te.y=0,tz=0,tW=tl.K.ex.y*te.x+Y.y,te.x>=0&&tW>=0){t8.SubVV(te,X,ti),t8.MulSV(ti.x,tE,tr),t8.MulSV(ti.y,tE,ta),t8.AddVV(tr,ta,th),ty.SelfMulSub(tf,th),tS-=tp*(t8.CrossVV(tU.rA,tr)+t8.CrossVV(tH.rA,ta)),tA.SelfMulAdd(tm,th),tT+=tg*(t8.CrossVV(tU.rB,tr)+t8.CrossVV(tH.rB,ta)),tU.normalImpulse=te.x,tH.normalImpulse=te.y;break}if(te.x=0,te.y=-tH.normalMass*Y.y,tz=tl.K.ey.x*te.y+Y.x,tW=0,te.y>=0&&tz>=0){t8.SubVV(te,X,ti),t8.MulSV(ti.x,tE,tr),t8.MulSV(ti.y,tE,ta),t8.AddVV(tr,ta,th),ty.SelfMulSub(tf,th),tS-=tp*(t8.CrossVV(tU.rA,tr)+t8.CrossVV(tH.rA,ta)),tA.SelfMulAdd(tm,th),tT+=tg*(t8.CrossVV(tU.rB,tr)+t8.CrossVV(tH.rB,ta)),tU.normalImpulse=te.x,tH.normalImpulse=te.y;break}if(te.x=0,te.y=0,tz=Y.x,tW=Y.y,tz>=0&&tW>=0)t8.SubVV(te,X,ti),t8.MulSV(ti.x,tE,tr),t8.MulSV(ti.y,tE,ta),t8.AddVV(tr,ta,th),ty.SelfMulSub(tf,th),tS-=tp*(t8.CrossVV(tU.rA,tr)+t8.CrossVV(tH.rA,ta)),tA.SelfMulAdd(tm,th),tT+=tg*(t8.CrossVV(tU.rB,tr)+t8.CrossVV(tH.rB,ta)),tU.normalImpulse=te.x,tH.normalImpulse=te.y;break}}this.m_velocities[tc].w=tS,this.m_velocities[t_].w=tT}},g.StoreImpulses=function(){for(var g=0;g<this.m_count;++g)for(var v=this.m_velocityConstraints[g],S=this.m_contacts[v.contactIndex].GetManifold(),O=0;O<v.pointCount;++O)S.points[O].normalImpulse=v.points[O].normalImpulse,S.points[O].tangentImpulse=v.points[O].tangentImpulse},g.SolvePositionConstraints=function(){for(var g=t1.SolvePositionConstraints_s_xfA,v=t1.SolvePositionConstraints_s_xfB,S=t1.SolvePositionConstraints_s_psm,O=t1.SolvePositionConstraints_s_rA,X=t1.SolvePositionConstraints_s_rB,Y=t1.SolvePositionConstraints_s_P,te=0,ti=0;ti<this.m_count;++ti){for(var tr=this.m_positionConstraints[ti],th=tr.indexA,tu=tr.indexB,tl=tr.localCenterA,tc=tr.invMassA,t_=tr.invIA,tp=tr.localCenterB,tm=tr.invMassB,tg=tr.invIB,tv=tr.pointCount,ty=this.m_positions[th].c,tA=this.m_positions[th].a,tT=this.m_positions[tu].c,tE=this.m_positions[tu].a,tC=0;tC<tv;++tC){g.q.SetAngle(tA),v.q.SetAngle(tE),t8.SubVV(ty,en.MulRV(g.q,tl,t8.s_t0),g.p),t8.SubVV(tT,en.MulRV(v.q,tp,t8.s_t0),v.p),S.Initialize(tr,g,v,tC);var tx=S.normal,tb=S.point,tw=S.separation;t8.SubVV(tb,ty,O),t8.SubVV(tb,tT,X),te=rt(te,tw);var tI=at(tS*(tw+ta),-tf,0),tB=t8.CrossVV(O,tx),tP=t8.CrossVV(X,tx),tD=tc+tm+t_*tB*tB+tg*tP*tP,tM=tD>0?-tI/tD:0;t8.MulSV(tM,tx,Y),ty.SelfMulSub(tc,Y),tA-=t_*t8.CrossVV(O,Y),tT.SelfMulAdd(tm,Y),tE+=tg*t8.CrossVV(X,Y)}this.m_positions[th].a=tA,this.m_positions[tu].a=tE}return te>-3*ta},g.SolveTOIPositionConstraints=function(g,v){for(var S=t1.SolveTOIPositionConstraints_s_xfA,O=t1.SolveTOIPositionConstraints_s_xfB,X=t1.SolveTOIPositionConstraints_s_psm,Y=t1.SolveTOIPositionConstraints_s_rA,te=t1.SolveTOIPositionConstraints_s_rB,ti=t1.SolveTOIPositionConstraints_s_P,tr=0,th=0;th<this.m_count;++th){var tu=this.m_positionConstraints[th],tl=tu.indexA,tc=tu.indexB,t_=tu.localCenterA,tp=tu.localCenterB,tm=tu.pointCount,tg=0,tv=0;tl!==g&&tl!==v||(tg=tu.invMassA,tv=tu.invIA);var ty=0,tS=0;tc!==g&&tc!==v||(ty=tu.invMassB,tS=tu.invIB);for(var tT=this.m_positions[tl].c,tE=this.m_positions[tl].a,tC=this.m_positions[tc].c,tx=this.m_positions[tc].a,tb=0;tb<tm;++tb){S.q.SetAngle(tE),O.q.SetAngle(tx),t8.SubVV(tT,en.MulRV(S.q,t_,t8.s_t0),S.p),t8.SubVV(tC,en.MulRV(O.q,tp,t8.s_t0),O.p),X.Initialize(tu,S,O,tb);var tw=X.normal,tI=X.point,tB=X.separation;t8.SubVV(tI,tT,Y),t8.SubVV(tI,tC,te),tr=rt(tr,tB);var tP=at(tA*(tB+ta),-tf,0),tD=t8.CrossVV(Y,tw),tM=t8.CrossVV(te,tw),tO=tg+ty+tv*tD*tD+tS*tM*tM,tk=tO>0?-tP/tO:0;t8.MulSV(tk,tw,ti),tT.SelfMulSub(tg,ti),tE-=tv*t8.CrossVV(Y,ti),tC.SelfMulAdd(ty,ti),tx+=tS*t8.CrossVV(te,ti)}this.m_positions[tl].a=tE,this.m_positions[tc].a=tx}return tr>=-1.5*ta},t1}();rb.InitializeVelocityConstraints_s_xfA=new er,rb.InitializeVelocityConstraints_s_xfB=new er,rb.InitializeVelocityConstraints_s_worldManifold=new eK,rb.WarmStart_s_P=new t8,rb.SolveVelocityConstraints_s_dv=new t8,rb.SolveVelocityConstraints_s_dv1=new t8,rb.SolveVelocityConstraints_s_dv2=new t8,rb.SolveVelocityConstraints_s_P=new t8,rb.SolveVelocityConstraints_s_a=new t8,rb.SolveVelocityConstraints_s_b=new t8,rb.SolveVelocityConstraints_s_x=new t8,rb.SolveVelocityConstraints_s_d=new t8,rb.SolveVelocityConstraints_s_P1=new t8,rb.SolveVelocityConstraints_s_P2=new t8,rb.SolveVelocityConstraints_s_P1P2=new t8,rb.SolvePositionConstraints_s_xfA=new er,rb.SolvePositionConstraints_s_xfB=new er,rb.SolvePositionConstraints_s_psm=new rx,rb.SolvePositionConstraints_s_rA=new t8,rb.SolvePositionConstraints_s_rB=new t8,rb.SolvePositionConstraints_s_P=new t8,rb.SolveTOIPositionConstraints_s_xfA=new er,rb.SolveTOIPositionConstraints_s_xfB=new er,rb.SolveTOIPositionConstraints_s_psm=new rx,rb.SolveTOIPositionConstraints_s_rA=new t8,rb.SolveTOIPositionConstraints_s_rB=new t8,rb.SolveTOIPositionConstraints_s_P=new t8;var rR,rw=function(){function e(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=rg.MakeArray(1024),this.m_velocities=rS.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}var S=e.prototype;return S.Initialize=function(g,v,S,O){if(this.m_bodyCapacity=g,this.m_contactCapacity=v,this.m_jointCapacity=S,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=O,this.m_positions.length<g)for(var X=st(2*this.m_positions.length,g);this.m_positions.length<X;)this.m_positions[this.m_positions.length]=new rg;if(this.m_velocities.length<g)for(var Y=st(2*this.m_velocities.length,g);this.m_velocities.length<Y;)this.m_velocities[this.m_velocities.length]=new rS},S.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},S.AddBody=function(g){g.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=g},S.AddContact=function(g){this.m_contacts[this.m_contactCount++]=g},S.AddJoint=function(g){this.m_joints[this.m_jointCount++]=g},S.Solve=function(S,O,X,Y){for(var te=e.s_timer.Reset(),ti=O.dt,tr=0;tr<this.m_bodyCount;++tr){var ta=this.m_bodies[tr];this.m_positions[tr].c.Copy(ta.m_sweep.c);var th=ta.m_sweep.a,tu=this.m_velocities[tr].v.Copy(ta.m_linearVelocity),tl=ta.m_angularVelocity;ta.m_sweep.c0.Copy(ta.m_sweep.c),ta.m_sweep.a0=ta.m_sweep.a,ta.m_type===g.b2BodyType.b2_dynamicBody&&(tu.x+=ti*(ta.m_gravityScale*X.x+ta.m_invMass*ta.m_force.x),tu.y+=ti*(ta.m_gravityScale*X.y+ta.m_invMass*ta.m_force.y),tl+=ti*ta.m_invI*ta.m_torque,tu.SelfMul(1/(1+ti*ta.m_linearDamping)),tl*=1/(1+ti*ta.m_angularDamping)),this.m_positions[tr].a=th,this.m_velocities[tr].w=tl}te.Reset();var tc=e.s_solverData;tc.step.Copy(O),tc.positions=this.m_positions,tc.velocities=this.m_velocities;var t_=e.s_contactSolverDef;t_.step.Copy(O),t_.contacts=this.m_contacts,t_.count=this.m_contactCount,t_.positions=this.m_positions,t_.velocities=this.m_velocities;var tf=e.s_contactSolver.Initialize(t_);tf.InitializeVelocityConstraints(),O.warmStarting&&tf.WarmStart();for(var tp=0;tp<this.m_jointCount;++tp)this.m_joints[tp].InitVelocityConstraints(tc);S.solveInit=te.GetMilliseconds(),te.Reset();for(var tS=0;tS<O.velocityIterations;++tS){for(var tA=0;tA<this.m_jointCount;++tA)this.m_joints[tA].SolveVelocityConstraints(tc);tf.SolveVelocityConstraints()}tf.StoreImpulses(),S.solveVelocity=te.GetMilliseconds();for(var tT=0;tT<this.m_bodyCount;++tT){var tE=this.m_positions[tT].c,tC=this.m_positions[tT].a,tx=this.m_velocities[tT].v,tb=this.m_velocities[tT].w,tw=t8.MulSV(ti,tx,e.s_translation);if(t8.DotVV(tw,tw)>tg){var tI=tm/tw.Length();tx.SelfMul(tI)}var tB=ti*tb;tB*tB>ty&&(tb*=tv/tq(tB)),tE.x+=ti*tx.x,tE.y+=ti*tx.y,tC+=ti*tb,this.m_positions[tT].a=tC,this.m_velocities[tT].w=tb}te.Reset();for(var tP=!1,tD=0;tD<O.positionIterations;++tD){for(var tG=tf.SolvePositionConstraints(),tV=!0,tU=0;tU<this.m_jointCount;++tU){var tH=this.m_joints[tU].SolvePositionConstraints(tc);tV=tV&&tH}if(tG&&tV){tP=!0;break}}for(var tz=0;tz<this.m_bodyCount;++tz){var tW=this.m_bodies[tz];tW.m_sweep.c.Copy(this.m_positions[tz].c),tW.m_sweep.a=this.m_positions[tz].a,tW.m_linearVelocity.Copy(this.m_velocities[tz].v),tW.m_angularVelocity=this.m_velocities[tz].w,tW.SynchronizeTransform()}if(S.solvePosition=te.GetMilliseconds(),this.Report(tf.m_velocityConstraints),Y){for(var tj=v,tK=tO*tO,tZ=tk*tk,tQ=0;tQ<this.m_bodyCount;++tQ){var t$=this.m_bodies[tQ];t$.GetType()!==g.b2BodyType.b2_staticBody&&(!t$.m_autoSleepFlag||t$.m_angularVelocity*t$.m_angularVelocity>tZ||t8.DotVV(t$.m_linearVelocity,t$.m_linearVelocity)>tK?(t$.m_sleepTime=0,tj=0):(t$.m_sleepTime+=ti,tj=rt(tj,t$.m_sleepTime)))}if(tj>=tM&&tP)for(var t0=0;t0<this.m_bodyCount;++t0)this.m_bodies[t0].SetAwake(!1)}},S.SolveTOI=function(g,v,S){for(var O=0;O<this.m_bodyCount;++O){var X=this.m_bodies[O];this.m_positions[O].c.Copy(X.m_sweep.c),this.m_positions[O].a=X.m_sweep.a,this.m_velocities[O].v.Copy(X.m_linearVelocity),this.m_velocities[O].w=X.m_angularVelocity}var Y=e.s_contactSolverDef;Y.contacts=this.m_contacts,Y.count=this.m_contactCount,Y.step.Copy(g),Y.positions=this.m_positions,Y.velocities=this.m_velocities;for(var te=e.s_contactSolver.Initialize(Y),ti=0;ti<g.positionIterations&&!te.SolveTOIPositionConstraints(v,S);++ti);this.m_bodies[v].m_sweep.c0.Copy(this.m_positions[v].c),this.m_bodies[v].m_sweep.a0=this.m_positions[v].a,this.m_bodies[S].m_sweep.c0.Copy(this.m_positions[S].c),this.m_bodies[S].m_sweep.a0=this.m_positions[S].a,te.InitializeVelocityConstraints();for(var tr=0;tr<g.velocityIterations;++tr)te.SolveVelocityConstraints();for(var ta=g.dt,th=0;th<this.m_bodyCount;++th){var tu=this.m_positions[th].c,tl=this.m_positions[th].a,tc=this.m_velocities[th].v,t_=this.m_velocities[th].w,tf=t8.MulSV(ta,tc,e.s_translation);if(t8.DotVV(tf,tf)>tg){var tp=tm/tf.Length();tc.SelfMul(tp)}var tS=ta*t_;tS*tS>ty&&(t_*=tv/tq(tS)),tu.SelfMulAdd(ta,tc),tl+=ta*t_,this.m_positions[th].a=tl,this.m_velocities[th].w=t_;var tA=this.m_bodies[th];tA.m_sweep.c.Copy(tu),tA.m_sweep.a=tl,tA.m_linearVelocity.Copy(tc),tA.m_angularVelocity=t_,tA.SynchronizeTransform()}this.Report(te.m_velocityConstraints)},S.Report=function(g){if(null!==this.m_listener)for(var v=0;v<this.m_contactCount;++v){var S=this.m_contacts[v];if(S){var O=g[v],X=e.s_impulse;X.count=O.pointCount;for(var Y=0;Y<O.pointCount;++Y)X.normalImpulses[Y]=O.points[Y].normalImpulse,X.tangentImpulses[Y]=O.points[Y].tangentImpulse;this.m_listener.PostSolve(S,X)}}},e}();rw.s_timer=new ec,rw.s_solverData=new Sr,rw.s_contactSolverDef=new br,rw.s_contactSolver=new rb,rw.s_translation=new t8,rw.s_impulse=new cr,(rR=g.b2ParticleFlag||(g.b2ParticleFlag={}))[rR.b2_waterParticle=0]="b2_waterParticle",rR[rR.b2_zombieParticle=2]="b2_zombieParticle",rR[rR.b2_wallParticle=4]="b2_wallParticle",rR[rR.b2_springParticle=8]="b2_springParticle",rR[rR.b2_elasticParticle=16]="b2_elasticParticle",rR[rR.b2_viscousParticle=32]="b2_viscousParticle",rR[rR.b2_powderParticle=64]="b2_powderParticle",rR[rR.b2_tensileParticle=128]="b2_tensileParticle",rR[rR.b2_colorMixingParticle=256]="b2_colorMixingParticle",rR[rR.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",rR[rR.b2_barrierParticle=1024]="b2_barrierParticle",rR[rR.b2_staticPressureParticle=2048]="b2_staticPressureParticle",rR[rR.b2_reactiveParticle=4096]="b2_reactiveParticle",rR[rR.b2_repulsiveParticle=8192]="b2_repulsiveParticle",rR[rR.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",rR[rR.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",rR[rR.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",rR[rR.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";var Br=function(){this.flags=0,this.position=new t8,this.velocity=new t8,this.color=new eh(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null};function Pr(g,v,S){var O=8,X=.01;return at(Math.ceil(Math.sqrt(g/(X*v))*S),1,O)}var rI,rB=function(){function t1(){this.m_index=tT}var g=t1.prototype;return g.GetIndex=function(){return this.m_index},g.SetIndex=function(g){this.m_index=g},t1}();(rI=g.b2ParticleGroupFlag||(g.b2ParticleGroupFlag={}))[rI.b2_solidParticleGroup=1]="b2_solidParticleGroup",rI[rI.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",rI[rI.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",rI[rI.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",rI[rI.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",rI[rI.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var Mr=function(){this.flags=0,this.groupFlags=0,this.position=new t8,this.angle=0,this.linearVelocity=new t8,this.angularVelocity=0,this.color=new eh,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},rP=function(){function e(g){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new t8,this.m_linearVelocity=new t8,this.m_angularVelocity=0,this.m_transform=new er,this.m_userData=null,this.m_system=g}var v=e.prototype;return v.GetNext=function(){return this.m_next},v.GetParticleSystem=function(){return this.m_system},v.GetParticleCount=function(){return this.m_lastIndex-this.m_firstIndex},v.GetBufferIndex=function(){return this.m_firstIndex},v.ContainsParticle=function(g){return this.m_firstIndex<=g&&g<this.m_lastIndex},v.GetAllParticleFlags=function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var g=0,v=this.m_firstIndex;v<this.m_lastIndex;v++)g|=this.m_system.m_flagsBuffer.data[v];return g},v.GetGroupFlags=function(){return this.m_groupFlags},v.SetGroupFlags=function(v){v|=this.m_groupFlags&g.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,v)},v.GetMass=function(){return this.UpdateStatistics(),this.m_mass},v.GetInertia=function(){return this.UpdateStatistics(),this.m_inertia},v.GetCenter=function(){return this.UpdateStatistics(),this.m_center},v.GetLinearVelocity=function(){return this.UpdateStatistics(),this.m_linearVelocity},v.GetAngularVelocity=function(){return this.UpdateStatistics(),this.m_angularVelocity},v.GetTransform=function(){return this.m_transform},v.GetPosition=function(){return this.m_transform.p},v.GetAngle=function(){return this.m_transform.q.GetAngle()},v.GetLinearVelocityFromWorldPoint=function(g,v){var S=e.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),t8.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,t8.SubVV(g,this.m_center,S),v)},v.GetUserData=function(){return this.m_userData},v.SetUserData=function(g){this.m_userData=g},v.ApplyForce=function(g){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,g)},v.ApplyLinearImpulse=function(g){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,g)},v.DestroyParticles=function(g){if(this.m_system.m_world.IsLocked())throw new Error;for(var v=this.m_firstIndex;v<this.m_lastIndex;v++)this.m_system.DestroyParticle(v,g)},v.UpdateStatistics=function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var g=new t8,v=new t8;if(this.m_timestamp!==this.m_system.m_timestamp){var S=this.m_system.GetParticleMass();this.m_mass=S*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var O=this.m_firstIndex;O<this.m_lastIndex;O++)this.m_center.SelfMulAdd(S,this.m_system.m_positionBuffer.data[O]),this.m_linearVelocity.SelfMulAdd(S,this.m_system.m_velocityBuffer.data[O]);if(this.m_mass>0){var X=1/this.m_mass;this.m_center.SelfMul(X),this.m_linearVelocity.SelfMul(X)}this.m_inertia=0,this.m_angularVelocity=0;for(var Y=this.m_firstIndex;Y<this.m_lastIndex;Y++)t8.SubVV(this.m_system.m_positionBuffer.data[Y],this.m_center,g),t8.SubVV(this.m_system.m_velocityBuffer.data[Y],this.m_linearVelocity,v),this.m_inertia+=S*t8.DotVV(g,g),this.m_angularVelocity+=S*t8.CrossVV(g,v);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}},e}();rP.GetLinearVelocityFromWorldPoint_s_t0=new t8;var rD=function(){function t1(g){this.m_buffer=[],this.m_front=0,this.m_back=0,this.m_buffer.fill(null,0,g)}var g=t1.prototype;return g.Push=function(g){if(this.m_back>=this.m_capacity){for(var v=this.m_front;v<this.m_back;v++)this.m_buffer[v-this.m_front]=this.m_buffer[v];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=g,this.m_back++},g.Pop=function(){this.m_buffer[this.m_front]=null,this.m_front++},g.Empty=function(){return this.m_front===this.m_back},g.Front=function(){var g=this.m_buffer[this.m_front];if(!g)throw new Error;return g},n(t1,[{key:"m_capacity",get:function(){return this.m_buffer.length}}]),t1}(),rM=function(){function t1(g){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=Q(g,function(){return new _$Gr}),this.m_generatorCapacity=g}var g=t1.prototype;return g.AddGenerator=function(g,v,S){var O=this.m_generatorBuffer[this.m_generatorCount++];O.center.Copy(g),O.tag=v,O.necessary=S},g.Generate=function(g,S){for(var O=1/g,X=new t8(+v,+v),Y=new t8(-v,-v),te=0,ti=0;ti<this.m_generatorCount;ti++){var tr=this.m_generatorBuffer[ti];tr.necessary&&(t8.MinV(X,tr.center,X),t8.MaxV(Y,tr.center,Y),++te)}if(0===te)return this.m_countX=0,void(this.m_countY=0);X.x-=S,X.y-=S,Y.x+=S,Y.y+=S,this.m_countX=1+Math.floor(O*(Y.x-X.x)),this.m_countY=1+Math.floor(O*(Y.y-X.y)),this.m_diagram=[];for(var ta=new rD(4*this.m_countX*this.m_countY),th=0;th<this.m_generatorCount;th++){var tu=this.m_generatorBuffer[th];tu.center.SelfSub(X).SelfMul(O);var tl=Math.floor(tu.center.x),tc=Math.floor(tu.center.y);tl>=0&&tc>=0&&tl<this.m_countX&&tc<this.m_countY&&ta.Push(new _$kr(tl,tc,tl+tc*this.m_countX,tu))}for(;!ta.Empty();){var t_=ta.Front(),tf=t_.m_x,tp=t_.m_y,tm=t_.m_i,tg=t_.m_generator;ta.Pop(),this.m_diagram[tm]||(this.m_diagram[tm]=tg,tf>0&&ta.Push(new _$kr(tf-1,tp,tm-1,tg)),tp>0&&ta.Push(new _$kr(tf,tp-1,tm-this.m_countX,tg)),tf<this.m_countX-1&&ta.Push(new _$kr(tf+1,tp,tm+1,tg)),tp<this.m_countY-1&&ta.Push(new _$kr(tf,tp+1,tm+this.m_countX,tg)))}for(var tv=0;tv<this.m_countY;tv++)for(var ty=0;ty<this.m_countX-1;ty++){var tS=ty+tv*this.m_countX,tA=this.m_diagram[tS],tT=this.m_diagram[tS+1];tA!==tT&&(ta.Push(new _$kr(ty,tv,tS,tT)),ta.Push(new _$kr(ty+1,tv,tS+1,tA)))}for(var tE=0;tE<this.m_countY-1;tE++)for(var tC=0;tC<this.m_countX;tC++){var tx=tC+tE*this.m_countX,tb=this.m_diagram[tx],tw=this.m_diagram[tx+this.m_countX];tb!==tw&&(ta.Push(new _$kr(tC,tE,tx,tw)),ta.Push(new _$kr(tC,tE+1,tx+this.m_countX,tb)))}for(;!ta.Empty();){var tI=ta.Front(),tB=tI.m_x,tP=tI.m_y,tD=tI.m_i,tM=tI.m_generator;ta.Pop();var tO=this.m_diagram[tD],tk=tM;if(tO!==tk){var tG=tO.center.x-tB,tV=tO.center.y-tP,tU=tk.center.x-tB,tH=tk.center.y-tP;tG*tG+tV*tV>tU*tU+tH*tH&&(this.m_diagram[tD]=tk,tB>0&&ta.Push(new _$kr(tB-1,tP,tD-1,tk)),tP>0&&ta.Push(new _$kr(tB,tP-1,tD-this.m_countX,tk)),tB<this.m_countX-1&&ta.Push(new _$kr(tB+1,tP,tD+1,tk)),tP<this.m_countY-1&&ta.Push(new _$kr(tB,tP+1,tD+this.m_countX,tk)))}}},g.GetNodes=function(g){for(var v=0;v<this.m_countY-1;v++)for(var S=0;S<this.m_countX-1;S++){var O=S+v*this.m_countX,X=this.m_diagram[O],Y=this.m_diagram[O+1],te=this.m_diagram[O+this.m_countX],ti=this.m_diagram[O+1+this.m_countX];Y!==te&&(X!==Y&&X!==te&&(X.necessary||Y.necessary||te.necessary)&&g(X.tag,Y.tag,te.tag),ti!==Y&&ti!==te&&(X.necessary||Y.necessary||te.necessary)&&g(Y.tag,ti.tag,te.tag))}},t1}(),_$Gr=function(){this.center=new t8,this.tag=0,this.necessary=!1},_$kr=function(g,v,S,O){this.m_x=g,this.m_y=v,this.m_i=S,this.m_generator=O};function Vr(g,v,S){var O=g[v];g[v]=g[S],g[S]=O}function Ur(g,v){return g<v}function Hr(g,v,S,O){void 0===v&&(v=0),void 0===S&&(S=g.length-v),void 0===O&&(O=Ur);for(var X=v,Y=[],te=0;;){for(;X+1<S;S++){var ti=g[X+Math.floor(Math.random()*(S-X))];Y[te++]=S;for(var tr=X-1;;){for(;O(g[++tr],ti););for(;O(ti,g[--S]););if(tr>=S)break;Vr(g,tr,S)}}if(0===te)break;X=S,S=Y[--te]}return g}function zr(g,v,S,O){return void 0===v&&(v=0),void 0===S&&(S=g.length-v),void 0===O&&(O=Ur),Hr(g,v,S,O)}function Wr(g,v,S){void 0===S&&(S=g.length);for(var O=0,X=0;X<S;++X)v(g[X])||(X!==O?Vr(g,O++,X):++O);return O}function Xr(g,v,S,O,X){for(var Y=S-v;Y>0;){var te=Math.floor(Y/2),ti=v+te;X(g[ti],O)?(v=++ti,Y-=te+1):Y=te}return v}function jr(g,v,S,O,X){for(var Y=S-v;Y>0;){var te=Math.floor(Y/2),ti=v+te;X(O,g[ti])?Y=te:(v=++ti,Y-=te+1)}return v}function Yr(g,v,S,O){for(var X=S;v!==X;)Vr(g,v++,X++),X===O?X=S:v===S&&(S=X)}function qr(g,v,S,O){if(v===S)return S;for(var X=v;++v!==S;)O(g[X],g[v])||Vr(g,++X,v);return++X}var rO=function(){function t1(g){this.data=[],this.count=0,this.capacity=0,this.allocator=g}var g=t1.prototype;return g.Append=function(){return this.count>=this.capacity&&this.Grow(),this.count++},g.Reserve=function(g){if(!(this.capacity>=g)){for(var v=this.capacity;v<g;++v)this.data[v]=this.allocator();this.capacity=g}},g.Grow=function(){var g=this.capacity?2*this.capacity:tP;this.Reserve(g)},g.Free=function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)},g.Shorten=function(){},g.Data=function(){return this.data},g.GetCount=function(){return this.count},g.SetCount=function(g){this.count=g},g.GetCapacity=function(){return this.capacity},g.RemoveIf=function(g){this.count=Wr(this.data,g,this.count)},g.Unique=function(g){this.count=qr(this.data,0,this.count,g)},t1}(),rL=function(g){function e(v){var S;return(S=g.call(this)||this).m_system=v,S}s(e,g);var v=e.prototype;return v.ShouldQueryParticleSystem=function(){return!1},v.ReportFixture=function(g){if(g.IsSensor())return!0;for(var v=g.GetShape().GetChildCount(),S=0;S<v;S++)for(var O=g.GetAABB(S),X=this.m_system.GetInsideBoundsEnumerator(O),Y=void 0;(Y=X.GetNext())>=0;)this.ReportFixtureAndParticle(g,S,Y);return!0},v.ReportParticle=function(){return!1},v.ReportFixtureAndParticle=function(){},e}(r_),rF=function(){function t1(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new t8,this.flags=0}var g=t1.prototype;return g.SetIndices=function(g,v){this.indexA=g,this.indexB=v},g.SetWeight=function(g){this.weight=g},g.SetNormal=function(g){this.normal.Copy(g)},g.SetFlags=function(g){this.flags=g},g.GetIndexA=function(){return this.indexA},g.GetIndexB=function(){return this.indexB},g.GetWeight=function(){return this.weight},g.GetNormal=function(){return this.normal},g.GetFlags=function(){return this.flags},g.IsEqual=function(g){return this.indexA===g.indexA&&this.indexB===g.indexB&&this.flags===g.flags&&this.weight===g.weight&&this.normal.x===g.normal.x&&this.normal.y===g.normal.y},g.IsNotEqual=function(g){return!this.IsEqual(g)},g.ApproximatelyEqual=function(g){var v=.01,S=1e-4;return this.indexA===g.indexA&&this.indexB===g.indexB&&this.flags===g.flags&&tq(this.weight-g.weight)<v&&t8.DistanceSquaredVV(this.normal,g.normal)<S},t1}(),Zr=function(){this.index=0,this.weight=0,this.normal=new t8,this.mass=0},$r=function(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0},ts=function(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new t8(0,0),this.pb=new t8(0,0),this.pc=new t8(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0},rk=function(){function t1(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}var g=t1.prototype;return g.Copy=function(g){return this.strictContactCheck=g.strictContactCheck,this.density=g.density,this.gravityScale=g.gravityScale,this.radius=g.radius,this.maxCount=g.maxCount,this.pressureStrength=g.pressureStrength,this.dampingStrength=g.dampingStrength,this.elasticStrength=g.elasticStrength,this.springStrength=g.springStrength,this.viscousStrength=g.viscousStrength,this.surfaceTensionPressureStrength=g.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=g.surfaceTensionNormalStrength,this.repulsiveStrength=g.repulsiveStrength,this.powderStrength=g.powderStrength,this.ejectionStrength=g.ejectionStrength,this.staticPressureStrength=g.staticPressureStrength,this.staticPressureRelaxation=g.staticPressureRelaxation,this.staticPressureIterations=g.staticPressureIterations,this.colorMixingStrength=g.colorMixingStrength,this.destroyByAge=g.destroyByAge,this.lifetimeGranularity=g.lifetimeGranularity,this},g.Clone=function(){return(new t1).Copy(this)},t1}(),rG=function(){function e(g,v){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new rV,this.m_flagsBuffer=new rV,this.m_positionBuffer=new rV,this.m_velocityBuffer=new rV,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new rV,this.m_groupBuffer=[],this.m_userDataBuffer=new rV,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new rV,this.m_bodyContactCountBuffer=new rV,this.m_consecutiveContactStepsBuffer=new rV,this.m_stuckParticleBuffer=new rO(function(){return 0}),this.m_proxyBuffer=new rO(function(){return new rU}),this.m_contactBuffer=new rO(function(){return new rF}),this.m_bodyContactBuffer=new rO(function(){return new Zr}),this.m_pairBuffer=new rO(function(){return new $r}),this.m_triadBuffer=new rO(function(){return new ts}),this.m_expirationTimeBuffer=new rV,this.m_indexByExpirationTimeBuffer=new rV,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new rk,this.m_prev=null,this.m_next=null,this.UpdateBodyContacts_callback=null,this.SolveCollision_callback=null,this.SetStrictContactCheck(g.strictContactCheck),this.SetDensity(g.density),this.SetGravityScale(g.gravityScale),this.SetRadius(g.radius),this.SetMaxParticleCount(g.maxCount),this.m_def=g.Clone(),this.m_world=v,this.SetDestructionByAge(this.m_def.destroyByAge)}e.computeTag=function(g,v){return(v+e.yOffset>>>0<<e.yShift)+(e.xScale*g+e.xOffset>>>0)>>>0},e.computeRelativeTag=function(g,v,S){return g+(S<<e.yShift)+(v<<e.xShift)>>>0};var S=e.prototype;return S.Drop=function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)},S.CreateParticle=function(g){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var v=this.m_count?2*this.m_count:tP;this.ReallocateInternalAllocatedBuffers(v)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return tT;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var S=this.m_count++;this.m_flagsBuffer.data[S]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[S]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[S]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[S]=0),this.m_positionBuffer.data[S]=(this.m_positionBuffer.data[S]||new t8).Copy(i(g.position,t8.ZERO)),this.m_velocityBuffer.data[S]=(this.m_velocityBuffer.data[S]||new t8).Copy(i(g.velocity,t8.ZERO)),this.m_weightBuffer[S]=0,this.m_forceBuffer[S]=(this.m_forceBuffer[S]||new t8).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[S]=0),this.m_depthBuffer&&(this.m_depthBuffer[S]=0);var O=(new eh).Copy(i(g.color,eh.ZERO));!this.m_colorBuffer.data&&O.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[S]=(this.m_colorBuffer.data[S]||new eh).Copy(O)),(this.m_userDataBuffer.data||g.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[S]=g.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[S]=null);var X=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],Y=i(g.lifetime,0),te=Y>0;(this.m_expirationTimeBuffer.data||te)&&(this.SetParticleLifetime(S,te?Y:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[S]=S),X.index=S;var ti=i(g.group,null);return this.m_groupBuffer[S]=ti,ti&&(ti.m_firstIndex<ti.m_lastIndex?(this.RotateBuffer(ti.m_firstIndex,ti.m_lastIndex,S),ti.m_lastIndex=S+1):(ti.m_firstIndex=S,ti.m_lastIndex=S+1)),this.SetParticleFlags(S,i(g.flags,0)),S},S.GetParticleHandleFromIndex=function(g){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var v=this.m_handleIndexBuffer.data[g];return v||((v=new rB).SetIndex(g),this.m_handleIndexBuffer.data[g]=v,v)},S.DestroyParticle=function(v,S){void 0===S&&(S=!1);var O=g.b2ParticleFlag.b2_zombieParticle;S&&(O|=g.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(v,this.m_flagsBuffer.data[v]|O)},S.DestroyOldestParticle=function(g,v){void 0===v&&(v=!1);var S=this.GetParticleCount(),O=this.m_indexByExpirationTimeBuffer.data[S-(g+1)],X=this.m_indexByExpirationTimeBuffer.data[g];this.DestroyParticle(this.m_expirationTimeBuffer.data[O]>0?O:X,v)},S.DestroyParticlesInShape=function(g,v,S){void 0===S&&(S=!1);var O=e.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var X=new rq(this,g,v,S),Y=O;return g.ComputeAABB(Y,v,0),this.m_world.QueryAABB(X,Y),X.Destroyed()},S.CreateParticleGroup=function(g){var v=e.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var S=v;S.SetPositionAngle(i(g.position,t8.ZERO),i(g.angle,0));var O=this.m_count;if(g.shape&&this.CreateParticlesWithShapeForGroup(g.shape,g,S),g.shapes&&this.CreateParticlesWithShapesForGroup(g.shapes,i(g.shapeCount,g.shapes.length),g,S),g.positionData)for(var X=i(g.particleCount,g.positionData.length),Y=0;Y<X;Y++){var te=g.positionData[Y];this.CreateParticleForGroup(g,S,te)}var ti=this.m_count,tr=new rP(this);tr.m_firstIndex=O,tr.m_lastIndex=ti,tr.m_strength=i(g.strength,1),tr.m_userData=g.userData,tr.m_transform.Copy(S),tr.m_prev=null,tr.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=tr),this.m_groupList=tr,++this.m_groupCount;for(var ta=O;ta<ti;ta++)this.m_groupBuffer[ta]=tr;this.SetGroupFlags(tr,i(g.groupFlags,0));var th=new rj;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(O,ti,th),g.group&&(this.JoinParticleGroups(g.group,tr),tr=g.group),tr},S.JoinParticleGroups=function(g,v){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(v.m_firstIndex,v.m_lastIndex,this.m_count),this.RotateBuffer(g.m_firstIndex,g.m_lastIndex,v.m_firstIndex);var S=new rY(v.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(g.m_firstIndex,v.m_lastIndex,S);for(var O=v.m_firstIndex;O<v.m_lastIndex;O++)this.m_groupBuffer[O]=g;var X=g.m_groupFlags|v.m_groupFlags;this.SetGroupFlags(g,X),g.m_lastIndex=v.m_lastIndex,v.m_firstIndex=v.m_lastIndex,this.DestroyParticleGroup(v)},S.SplitParticleGroup=function(g){this.UpdateContacts(!0);var v=Q(g.GetParticleCount(),function(){return new as});e.InitializeParticleLists(g,v),this.MergeParticleListsInContact(g,v);var S=e.FindLongestParticleList(g,v);this.MergeZombieParticleListNodes(g,v,S),this.CreateParticleGroupsFromParticleList(g,v,S),this.UpdatePairsAndTriadsWithParticleList(g,v)},S.GetParticleGroupList=function(){return this.m_groupList},S.GetParticleGroupCount=function(){return this.m_groupCount},S.GetParticleCount=function(){return this.m_count},S.GetMaxParticleCount=function(){return this.m_def.maxCount},S.SetMaxParticleCount=function(g){this.m_def.maxCount=g},S.GetAllParticleFlags=function(){return this.m_allParticleFlags},S.GetAllGroupFlags=function(){return this.m_allGroupFlags},S.SetPaused=function(g){this.m_paused=g},S.GetPaused=function(){return this.m_paused},S.SetDensity=function(g){this.m_def.density=g,this.m_inverseDensity=1/this.m_def.density},S.GetDensity=function(){return this.m_def.density},S.SetGravityScale=function(g){this.m_def.gravityScale=g},S.GetGravityScale=function(){return this.m_def.gravityScale},S.SetDamping=function(g){this.m_def.dampingStrength=g},S.GetDamping=function(){return this.m_def.dampingStrength},S.SetStaticPressureIterations=function(g){this.m_def.staticPressureIterations=g},S.GetStaticPressureIterations=function(){return this.m_def.staticPressureIterations},S.SetRadius=function(g){this.m_particleDiameter=2*g,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter},S.GetRadius=function(){return this.m_particleDiameter/2},S.GetPositionBuffer=function(){return this.m_positionBuffer.data},S.GetVelocityBuffer=function(){return this.m_velocityBuffer.data},S.GetColorBuffer=function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data},S.GetGroupBuffer=function(){return this.m_groupBuffer},S.GetWeightBuffer=function(){return this.m_weightBuffer},S.GetUserDataBuffer=function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data},S.GetFlagsBuffer=function(){return this.m_flagsBuffer.data},S.SetParticleFlags=function(v,S){this.m_flagsBuffer.data[v]&~S&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&S&&(S&g.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),S&g.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=S),this.m_flagsBuffer.data[v]=S},S.GetParticleFlags=function(g){return this.m_flagsBuffer.data[g]},S.SetFlagsBuffer=function(g){this.SetUserOverridableBuffer(this.m_flagsBuffer,g)},S.SetPositionBuffer=function(g){if(_instanceof(g,Float32Array)){if(g.length%2!=0)throw new Error;for(var v=g.length/2,S=new Array(v),O=0;O<v;++O)S[O]=new t8(g.subarray(2*O,2*O+2));g=S}this.SetUserOverridableBuffer(this.m_positionBuffer,g)},S.SetVelocityBuffer=function(g){if(_instanceof(g,Float32Array)){if(g.length%2!=0)throw new Error;for(var v=g.length/2,S=new Array(v),O=0;O<v;++O)S[O]=new t8(g.subarray(2*O,2*O+2));g=S}this.SetUserOverridableBuffer(this.m_velocityBuffer,g)},S.SetColorBuffer=function(g){if(_instanceof(g,Float32Array)){if(g.length%4!=0)throw new Error;for(var v=g.length/4,S=new Array(v),O=0;O<v;++O)S[O]=new eh(g.subarray(4*O,4*O+4));g=S}this.SetUserOverridableBuffer(this.m_colorBuffer,g)},S.SetUserDataBuffer=function(g){this.SetUserOverridableBuffer(this.m_userDataBuffer,g)},S.GetContacts=function(){return this.m_contactBuffer.data},S.GetContactCount=function(){return this.m_contactBuffer.count},S.GetBodyContacts=function(){return this.m_bodyContactBuffer.data},S.GetBodyContactCount=function(){return this.m_bodyContactBuffer.count},S.GetPairs=function(){return this.m_pairBuffer.data},S.GetPairCount=function(){return this.m_pairBuffer.count},S.GetTriads=function(){return this.m_triadBuffer.data},S.GetTriadCount=function(){return this.m_triadBuffer.count},S.SetStuckThreshold=function(g){this.m_stuckThreshold=g,g>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))},S.GetStuckCandidates=function(){return this.m_stuckParticleBuffer.Data()},S.GetStuckCandidateCount=function(){return this.m_stuckParticleBuffer.GetCount()},S.ComputeCollisionEnergy=function(){for(var g=e.ComputeCollisionEnergy_s_v,v=this.m_velocityBuffer.data,S=0,O=0;O<this.m_contactBuffer.count;O++){var X=this.m_contactBuffer.data[O],Y=X.indexA,te=X.indexB,ti=X.normal,tr=t8.SubVV(v[te],v[Y],g),ta=t8.DotVV(tr,ti);ta<0&&(S+=ta*ta)}return .5*this.GetParticleMass()*S},S.SetStrictContactCheck=function(g){this.m_def.strictContactCheck=g},S.GetStrictContactCheck=function(){return this.m_def.strictContactCheck},S.SetParticleLifetime=function(g,v){var S=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),S)for(var O=this.GetParticleCount(),X=0;X<O;++X)this.m_indexByExpirationTimeBuffer.data[X]=X;var Y=v/this.m_def.lifetimeGranularity,te=Y>0?this.GetQuantizedTimeElapsed()+Y:Y;te!==this.m_expirationTimeBuffer.data[g]&&(this.m_expirationTimeBuffer.data[g]=te,this.m_expirationTimeBufferRequiresSorting=!0)},S.GetParticleLifetime=function(g){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[g])},S.SetDestructionByAge=function(g){g&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=g},S.GetDestructionByAge=function(){return this.m_def.destroyByAge},S.GetExpirationTimeBuffer=function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data},S.ExpirationTimeToLifetime=function(g){return(g>0?g-this.GetQuantizedTimeElapsed():g)*this.m_def.lifetimeGranularity},S.GetIndexByExpirationTimeBuffer=function(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data},S.ParticleApplyLinearImpulse=function(g,v){this.ApplyLinearImpulse(g,g+1,v)},S.ApplyLinearImpulse=function(g,v,S){for(var O=this.m_velocityBuffer.data,X=(v-g)*this.GetParticleMass(),Y=(new t8).Copy(S).SelfMul(1/X),te=g;te<v;te++)O[te].SelfAdd(Y)},e.IsSignificantForce=function(g){return 0!==g.x||0!==g.y},S.ParticleApplyForce=function(g,v){e.IsSignificantForce(v)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[g])&&(this.PrepareForceBuffer(),this.m_forceBuffer[g].SelfAdd(v))},S.ApplyForce=function(g,v,S){var O=(new t8).Copy(S).SelfMul(1/(v-g));if(e.IsSignificantForce(O)){this.PrepareForceBuffer();for(var X=g;X<v;X++)this.m_forceBuffer[X].SelfAdd(O)}},S.GetNext=function(){return this.m_next},S.QueryAABB=function(g,v){if(0!==this.m_proxyBuffer.count)for(var S=0,O=this.m_proxyBuffer.count,X=Xr(this.m_proxyBuffer.data,S,O,e.computeTag(this.m_inverseDiameter*v.lowerBound.x,this.m_inverseDiameter*v.lowerBound.y),rU.CompareProxyTag),Y=jr(this.m_proxyBuffer.data,X,O,e.computeTag(this.m_inverseDiameter*v.upperBound.x,this.m_inverseDiameter*v.upperBound.y),rU.CompareTagProxy),te=this.m_positionBuffer.data,ti=X;ti<Y;++ti){var tr=this.m_proxyBuffer.data[ti].index,ta=te[tr];if(v.lowerBound.x<ta.x&&ta.x<v.upperBound.x&&v.lowerBound.y<ta.y&&ta.y<v.upperBound.y&&!g.ReportParticle(this,tr))break}},S.QueryShapeAABB=function(g,v,S,O){void 0===O&&(O=0);var X=e.QueryShapeAABB_s_aabb;v.ComputeAABB(X,S,O),this.QueryAABB(g,X)},S.QueryPointAABB=function(g,v,S){void 0===S&&(S=ta);var O=e.QueryPointAABB_s_aabb;O.lowerBound.Set(v.x-S,v.y-S),O.upperBound.Set(v.x+S,v.y+S),this.QueryAABB(g,O)},S.RayCast=function(g,v,S){var O=e.RayCast_s_aabb,X=e.RayCast_s_p,Y=e.RayCast_s_v,te=e.RayCast_s_n,ti=e.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var tr=this.m_positionBuffer.data,ta=O;t8.MinV(v,S,ta.lowerBound),t8.MaxV(v,S,ta.upperBound);for(var th,tu=1,tl=t8.SubVV(S,v,Y),tc=t8.DotVV(tl,tl),t_=this.GetInsideBoundsEnumerator(ta);(th=t_.GetNext())>=0;){var tf=t8.SubVV(v,tr[th],X),tp=t8.DotVV(tf,tl),tm=tp*tp-tc*(t8.DotVV(tf,tf)-this.m_squaredDiameter);if(tm>=0){var tg=tZ(tm),tv=(-tp-tg)/tc;if(tv>tu)continue;if(tv<0&&((tv=(-tp+tg)/tc)<0||tv>tu))continue;var ty=t8.AddVMulSV(tf,tv,tl,te);if(ty.Normalize(),(tu=rt(tu,g.ReportParticle(this,th,t8.AddVMulSV(v,tv,tl,ti),ty,tv)))<=0)break}}}},S.ComputeAABB=function(g){var S=this.GetParticleCount();g.lowerBound.x=+v,g.lowerBound.y=+v,g.upperBound.x=-v,g.upperBound.y=-v;for(var O=this.m_positionBuffer.data,X=0;X<S;X++){var Y=O[X];t8.MinV(g.lowerBound,Y,g.lowerBound),t8.MaxV(g.upperBound,Y,g.upperBound)}g.lowerBound.x-=this.m_particleDiameter,g.lowerBound.y-=this.m_particleDiameter,g.upperBound.x+=this.m_particleDiameter,g.upperBound.y+=this.m_particleDiameter},S.FreeBuffer=function(g){null!==g&&(g.length=0)},S.FreeUserOverridableBuffer=function(g){0===g.userSuppliedCapacity&&this.FreeBuffer(g.data,this.m_internalAllocatedCapacity)},S.ReallocateBuffer3=function(g,v,S){if(S<=v)throw new Error;var O=g?g.slice():[];return O.length=S,O},S.ReallocateBuffer5=function(g,v,S,O,X){if(O<=S)throw new Error;if(v&&!(O<=v))throw new Error;return X&&!g||v||(g=this.ReallocateBuffer3(g,S,O)),g},S.ReallocateBuffer4=function(g,v,S,O){return this.ReallocateBuffer5(g.data,g.userSuppliedCapacity,v,S,O)},S.RequestBuffer=function(g){return g||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(tP),(g=[]).length=this.m_internalAllocatedCapacity),g},S.ReallocateHandleBuffers=function(g){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,g,!0)},S.ReallocateInternalAllocatedBuffers=function(g){function e(g,v){return v&&g>v?v:g}if(g=e(g,this.m_def.maxCount),g=e(g,this.m_flagsBuffer.userSuppliedCapacity),g=e(g,this.m_positionBuffer.userSuppliedCapacity),g=e(g,this.m_velocityBuffer.userSuppliedCapacity),g=e(g,this.m_colorBuffer.userSuppliedCapacity),g=e(g,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<g){this.ReallocateHandleBuffers(g),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,g,!1);var v=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,g,v),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,g,v),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,g,v),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,g,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,g,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,g,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,g,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,g,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,g,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,g,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,g,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,g,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,g,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,g,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,g,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,g,!1),this.m_internalAllocatedCapacity=g}},S.CreateParticleForGroup=function(g,v,S){var O=new Br;O.flags=i(g.flags,0),er.MulXV(v,S,O.position),t8.AddVV(i(g.linearVelocity,t8.ZERO),t8.CrossSV(i(g.angularVelocity,0),t8.SubVV(O.position,i(g.position,t8.ZERO),t8.s_t0),t8.s_t0),O.velocity),O.color.Copy(i(g.color,eh.ZERO)),O.lifetime=i(g.lifetime,0),O.userData=g.userData,this.CreateParticle(O)},S.CreateParticlesStrokeShapeForGroup=function(v,S,O){var X=e.CreateParticlesStrokeShapeForGroup_s_edge,Y=e.CreateParticlesStrokeShapeForGroup_s_d,te=e.CreateParticlesStrokeShapeForGroup_s_p,ti=i(S.stride,0);0===ti&&(ti=this.GetParticleStride());for(var tr=0,ta=v.GetChildCount(),th=0;th<ta;th++){var tu=null;v.GetType()===g.b2ShapeType.e_edgeShape?tu=v:(tu=X,v.GetChildEdge(tu,th));for(var tl=t8.SubVV(tu.m_vertex2,tu.m_vertex1,Y),tc=tl.Length();tr<tc;){var t_=t8.AddVMulSV(tu.m_vertex1,tr/tc,tl,te);this.CreateParticleForGroup(S,O,t_),tr+=ti}tr-=tc}},S.CreateParticlesFillShapeForGroup=function(g,v,S){var O=e.CreateParticlesFillShapeForGroup_s_aabb,X=e.CreateParticlesFillShapeForGroup_s_p,Y=i(v.stride,0);0===Y&&(Y=this.GetParticleStride());var te=er.IDENTITY,ti=O;g.ComputeAABB(ti,te,0);for(var tr=Math.floor(ti.lowerBound.y/Y)*Y;tr<ti.upperBound.y;tr+=Y)for(var ta=Math.floor(ti.lowerBound.x/Y)*Y;ta<ti.upperBound.x;ta+=Y){var th=X.Set(ta,tr);g.TestPoint(te,th)&&this.CreateParticleForGroup(v,S,th)}},S.CreateParticlesWithShapeForGroup=function(v,S,O){switch(v.GetType()){case g.b2ShapeType.e_edgeShape:case g.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(v,S,O);break;case g.b2ShapeType.e_polygonShape:case g.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(v,S,O)}},S.CreateParticlesWithShapesForGroup=function(g,v,S,O){var X=new rK(g,v);this.CreateParticlesFillShapeForGroup(X,S,O)},S.CloneParticle=function(g,v){var S=new Br;S.flags=this.m_flagsBuffer.data[g],S.position.Copy(this.m_positionBuffer.data[g]),S.velocity.Copy(this.m_velocityBuffer.data[g]),this.m_colorBuffer.data&&S.color.Copy(this.m_colorBuffer.data[g]),this.m_userDataBuffer.data&&(S.userData=this.m_userDataBuffer.data[g]),S.group=v;var O=this.CreateParticle(S);if(this.m_handleIndexBuffer.data){var X=this.m_handleIndexBuffer.data[g];X&&X.SetIndex(O),this.m_handleIndexBuffer.data[O]=X,this.m_handleIndexBuffer.data[g]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[O]=this.m_lastBodyContactStepBuffer.data[g]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[O]=this.m_bodyContactCountBuffer.data[g]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[O]=this.m_consecutiveContactStepsBuffer.data[g]),this.m_hasForce&&this.m_forceBuffer[O].Copy(this.m_forceBuffer[g]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[O]=this.m_staticPressureBuffer[g]),this.m_depthBuffer&&(this.m_depthBuffer[O]=this.m_depthBuffer[g]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[O]=this.m_expirationTimeBuffer.data[g]),O},S.DestroyParticlesInGroup=function(g,v){void 0===v&&(v=!1);for(var S=g.m_firstIndex;S<g.m_lastIndex;S++)this.DestroyParticle(S,v)},S.DestroyParticleGroup=function(g){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(g),this.SetGroupFlags(g,0);for(var v=g.m_firstIndex;v<g.m_lastIndex;v++)this.m_groupBuffer[v]=null;g.m_prev&&(g.m_prev.m_next=g.m_next),g.m_next&&(g.m_next.m_prev=g.m_prev),g===this.m_groupList&&(this.m_groupList=g.m_next),--this.m_groupCount},e.ParticleCanBeConnected=function(v,S){return 0!=(v&(g.b2ParticleFlag.b2_wallParticle|g.b2ParticleFlag.b2_springParticle|g.b2ParticleFlag.b2_elasticParticle))||null!==S&&0!=(S.GetGroupFlags()&g.b2ParticleGroupFlag.b2_rigidParticleGroup)},S.UpdatePairsAndTriads=function(v,S,O){for(var X=e.UpdatePairsAndTriads_s_dab,Y=e.UpdatePairsAndTriads_s_dbc,te=e.UpdatePairsAndTriads_s_dca,ti=this.m_positionBuffer.data,tr=0,ta=v;ta<S;ta++)tr|=this.m_flagsBuffer.data[ta];if(tr&e.k_pairFlags)for(var th=0;th<this.m_contactBuffer.count;th++){var tu=this.m_contactBuffer.data[th],tl=tu.indexA,tc=tu.indexB,t_=this.m_flagsBuffer.data[tl],tf=this.m_flagsBuffer.data[tc],tp=this.m_groupBuffer[tl],tm=this.m_groupBuffer[tc];if(tl>=v&&tl<S&&tc>=v&&tc<S&&!((t_|tf)&g.b2ParticleFlag.b2_zombieParticle)&&(t_|tf)&e.k_pairFlags&&(O.IsNecessary(tl)||O.IsNecessary(tc))&&e.ParticleCanBeConnected(t_,tp)&&e.ParticleCanBeConnected(tf,tm)&&O.ShouldCreatePair(tl,tc)){var tg=this.m_pairBuffer.data[this.m_pairBuffer.Append()];tg.indexA=tl,tg.indexB=tc,tg.flags=tu.flags,tg.strength=rt(tp?tp.m_strength:1,tm?tm.m_strength:1),tg.distance=t8.DistanceVV(ti[tl],ti[tc])}zr(this.m_pairBuffer.data,0,this.m_pairBuffer.count,e.ComparePairIndices),this.m_pairBuffer.Unique(e.MatchPairIndices)}if(tr&e.k_triadFlags){for(var tv=new rM(S-v),ty=v;ty<S;ty++){var tS=this.m_flagsBuffer.data[ty],tA=this.m_groupBuffer[ty];tS&g.b2ParticleFlag.b2_zombieParticle||!e.ParticleCanBeConnected(tS,tA)||tv.AddGenerator(ti[ty],ty,O.IsNecessary(ty))}var tT=this.GetParticleStride();tv.Generate(tT/2,2*tT);var tE=this,x=function(g,v,S){var tr=tE.m_flagsBuffer.data[g],ta=tE.m_flagsBuffer.data[v],th=tE.m_flagsBuffer.data[S];if((tr|ta|th)&e.k_triadFlags&&O.ShouldCreateTriad(g,v,S)){var tu=ti[g],tl=ti[v],tc=ti[S],t_=t8.SubVV(tu,tl,X),tf=t8.SubVV(tl,tc,Y),tp=t8.SubVV(tc,tu,te),tm=tB*tE.m_squaredDiameter;if(t8.DotVV(t_,t_)>tm||t8.DotVV(tf,tf)>tm||t8.DotVV(tp,tp)>tm)return;var tg=tE.m_groupBuffer[g],tv=tE.m_groupBuffer[v],ty=tE.m_groupBuffer[S],tS=tE.m_triadBuffer.data[tE.m_triadBuffer.Append()];tS.indexA=g,tS.indexB=v,tS.indexC=S,tS.flags=tr|ta|th,tS.strength=rt(rt(tg?tg.m_strength:1,tv?tv.m_strength:1),ty?ty.m_strength:1);var tA=(tu.x+tl.x+tc.x)/3,tT=(tu.y+tl.y+tc.y)/3;tS.pa.x=tu.x-tA,tS.pa.y=tu.y-tT,tS.pb.x=tl.x-tA,tS.pb.y=tl.y-tT,tS.pc.x=tc.x-tA,tS.pc.y=tc.y-tT,tS.ka=-t8.DotVV(tp,t_),tS.kb=-t8.DotVV(t_,tf),tS.kc=-t8.DotVV(tf,tp),tS.s=t8.CrossVV(tu,tl)+t8.CrossVV(tl,tc)+t8.CrossVV(tc,tu)}};tv.GetNodes(x),zr(this.m_triadBuffer.data,0,this.m_triadBuffer.count,e.CompareTriadIndices),this.m_triadBuffer.Unique(e.MatchTriadIndices)}},S.UpdatePairsAndTriadsWithReactiveParticles=function(){var v=new rJ(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,v);for(var S=0;S<this.m_count;S++)this.m_flagsBuffer.data[S]&=~g.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~g.b2ParticleFlag.b2_reactiveParticle},e.ComparePairIndices=function(g,v){var S=g.indexA-v.indexA;return 0!==S?S<0:g.indexB<v.indexB},e.MatchPairIndices=function(g,v){return g.indexA===v.indexA&&g.indexB===v.indexB},e.CompareTriadIndices=function(g,v){var S=g.indexA-v.indexA;if(0!==S)return S<0;var O=g.indexB-v.indexB;return 0!==O?O<0:g.indexC<v.indexC},e.MatchTriadIndices=function(g,v){return g.indexA===v.indexA&&g.indexB===v.indexB&&g.indexC===v.indexC},e.InitializeParticleLists=function(g,v){for(var S=g.GetBufferIndex(),O=g.GetParticleCount(),X=0;X<O;X++){var Y=v[X];Y.list=Y,Y.next=null,Y.count=1,Y.index=X+S}},S.MergeParticleListsInContact=function(g,v){for(var S=g.GetBufferIndex(),O=0;O<this.m_contactBuffer.count;O++){var X=this.m_contactBuffer.data[O],Y=X.indexA,te=X.indexB;if(g.ContainsParticle(Y)&&g.ContainsParticle(te)){var ti=v[Y-S].list,tr=v[te-S].list;if(ti!==tr){if(ti.count<tr.count){var ta=ti;ti=tr,tr=ta}e.MergeParticleLists(ti,tr)}}}},e.MergeParticleLists=function(g,v){for(var S=v;;){S.list=g;var O=S.next;if(!O){S.next=g.next;break}S=O}g.next=v,g.count+=v.count,v.count=0},e.FindLongestParticleList=function(g,v){for(var S=g.GetParticleCount(),O=v[0],X=0;X<S;X++){var Y=v[X];O.count<Y.count&&(O=Y)}return O},S.MergeZombieParticleListNodes=function(v,S,O){for(var X=v.GetParticleCount(),Y=0;Y<X;Y++){var te=S[Y];te!==O&&this.m_flagsBuffer.data[te.index]&g.b2ParticleFlag.b2_zombieParticle&&e.MergeParticleListAndNode(O,te)}},e.MergeParticleListAndNode=function(g,v){v.list=g,v.next=g.next,g.next=v,g.count++,v.count=0},S.CreateParticleGroupsFromParticleList=function(v,S,O){var X=v.GetParticleCount(),Y=new Mr;Y.groupFlags=v.GetGroupFlags(),Y.userData=v.GetUserData();for(var te=0;te<X;te++){var ti=S[te];if(ti.count&&ti!==O)for(var tr=this.CreateParticleGroup(Y),ta=ti;ta;ta=ta.next){var th=ta.index,tu=this.CloneParticle(th,tr);this.m_flagsBuffer.data[th]|=g.b2ParticleFlag.b2_zombieParticle,ta.index=tu}}},S.UpdatePairsAndTriadsWithParticleList=function(g,v){for(var S=g.GetBufferIndex(),O=0;O<this.m_pairBuffer.count;O++){var X=this.m_pairBuffer.data[O],Y=X.indexA,te=X.indexB;g.ContainsParticle(Y)&&(X.indexA=v[Y-S].index),g.ContainsParticle(te)&&(X.indexB=v[te-S].index)}for(var ti=0;ti<this.m_triadBuffer.count;ti++){var tr=this.m_triadBuffer.data[ti],ta=tr.indexA,th=tr.indexB,tu=tr.indexC;g.ContainsParticle(ta)&&(tr.indexA=v[ta-S].index),g.ContainsParticle(th)&&(tr.indexB=v[th-S].index),g.ContainsParticle(tu)&&(tr.indexC=v[tu-S].index)}},S.ComputeDepth=function(){for(var S=[],O=0,X=0;X<this.m_contactBuffer.count;X++){var Y=this.m_contactBuffer.data[X],te=Y.indexA,ti=Y.indexB,tr=this.m_groupBuffer[te],ta=this.m_groupBuffer[ti];tr&&tr===ta&&tr.m_groupFlags&g.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(S[O++]=Y)}for(var th=[],tu=0,tl=this.m_groupList;tl;tl=tl.GetNext())if(tl.m_groupFlags&g.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){th[tu++]=tl,this.SetGroupFlags(tl,tl.m_groupFlags&~g.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var tc=tl.m_firstIndex;tc<tl.m_lastIndex;tc++)this.m_accumulationBuffer[tc]=0}for(var t_=0;t_<O;t_++){var tf=S[t_],tp=tf.indexA,tm=tf.indexB,tg=tf.weight;this.m_accumulationBuffer[tp]+=tg,this.m_accumulationBuffer[tm]+=tg}for(var tv=0;tv<tu;tv++)for(var ty=th[tv],tS=ty.m_firstIndex;tS<ty.m_lastIndex;tS++){var tA=this.m_accumulationBuffer[tS];this.m_depthBuffer[tS]=tA<.8?0:v}for(var tT=tZ(this.m_count)>>0,tE=0;tE<tT;tE++){for(var tC=!1,tx=0;tx<O;tx++){var tb=S[tx],tw=tb.indexA,tI=tb.indexB,tB=1-tb.weight,tP=this.m_depthBuffer[tw],tD=this.m_depthBuffer[tI],tM=tD+tB,tO=tP+tB;tP>tM&&(this.m_depthBuffer[tw]=tM,tC=!0),tD>tO&&(this.m_depthBuffer[tI]=tO,tC=!0)}if(!tC)break}for(var tk=0;tk<tu;tk++)for(var tG=th[tk],tV=tG.m_firstIndex;tV<tG.m_lastIndex;tV++)this.m_depthBuffer[tV]<v?this.m_depthBuffer[tV]*=this.m_particleDiameter:this.m_depthBuffer[tV]=0},S.GetInsideBoundsEnumerator=function(g){var v=e.computeTag(this.m_inverseDiameter*g.lowerBound.x-1,this.m_inverseDiameter*g.lowerBound.y-1),S=e.computeTag(this.m_inverseDiameter*g.upperBound.x+1,this.m_inverseDiameter*g.upperBound.y+1),O=0,X=this.m_proxyBuffer.count,Y=Xr(this.m_proxyBuffer.data,O,X,v,rU.CompareProxyTag),te=jr(this.m_proxyBuffer.data,O,X,S,rU.CompareTagProxy);return new rH(this,v,S,Y,te)},S.UpdateAllParticleFlags=function(){this.m_allParticleFlags=0;for(var g=0;g<this.m_count;g++)this.m_allParticleFlags|=this.m_flagsBuffer.data[g];this.m_needsUpdateAllParticleFlags=!1},S.UpdateAllGroupFlags=function(){this.m_allGroupFlags=0;for(var g=this.m_groupList;g;g=g.GetNext())this.m_allGroupFlags|=g.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1},S.AddContact=function(g,v){var S=this.m_flagsBuffer.data,O=this.m_positionBuffer.data,X=t8.SubVV(O[v],O[g],e.AddContact_s_d),Y=t8.DotVV(X,X);if(0<Y&&Y<this.m_squaredDiameter){var te=lt(Y),ti=this.m_contactBuffer.data[this.m_contactBuffer.Append()];ti.indexA=g,ti.indexB=v,ti.flags=S[g]|S[v],ti.weight=1-Y*te*this.m_inverseDiameter,ti.normal.x=te*X.x,ti.normal.y=te*X.y}},S.FindContacts_Reference=function(){var g=0,v=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var S=g,O=g;S<v;S++){for(var X=e.computeRelativeTag(this.m_proxyBuffer.data[S].tag,1,0),Y=S+1;Y<v&&!(X<this.m_proxyBuffer.data[Y].tag);Y++)this.AddContact(this.m_proxyBuffer.data[S].index,this.m_proxyBuffer.data[Y].index,this.m_contactBuffer);for(var te=e.computeRelativeTag(this.m_proxyBuffer.data[S].tag,-1,1);O<v&&!(te<=this.m_proxyBuffer.data[O].tag);O++);for(var ti=e.computeRelativeTag(this.m_proxyBuffer.data[S].tag,1,1),tr=O;tr<v&&!(ti<this.m_proxyBuffer.data[tr].tag);tr++)this.AddContact(this.m_proxyBuffer.data[S].index,this.m_proxyBuffer.data[tr].index,this.m_contactBuffer)}},S.FindContacts=function(g){this.FindContacts_Reference(g)},S.UpdateProxies_Reference=function(){for(var g=this.m_positionBuffer.data,v=this.m_inverseDiameter,S=0;S<this.m_proxyBuffer.count;++S){var O=this.m_proxyBuffer.data[S],X=g[O.index];O.tag=e.computeTag(v*X.x,v*X.y)}},S.UpdateProxies=function(g){this.UpdateProxies_Reference(g)},S.SortProxies=function(){Hr(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,rU.CompareProxyProxy)},S.FilterContacts=function(){var v=this.GetParticleContactFilter();if(null!==v){var S=this,n=function(O){return 0!=(O.flags&g.b2ParticleFlag.b2_particleContactFilterParticle)&&!v.ShouldCollideParticleParticle(S,O.indexA,O.indexB)};this.m_contactBuffer.RemoveIf(n)}},S.NotifyContactListenerPreContact=function(g){if(null!==this.GetParticleContactListener())throw g.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error},S.NotifyContactListenerPostContact=function(){var g=this.GetParticleContactListener();if(null!==g){for(var v=0;v<this.m_contactBuffer.count;++v){var S=this.m_contactBuffer.data[v];g.BeginContactParticleParticle(this,S)}throw new Error}},e.b2ParticleContactIsZombie=function(v){return(v.flags&g.b2ParticleFlag.b2_zombieParticle)===g.b2ParticleFlag.b2_zombieParticle},S.UpdateContacts=function(g){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var v=new rX;this.NotifyContactListenerPreContact(v),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(v),g&&this.m_contactBuffer.RemoveIf(e.b2ParticleContactIsZombie)},S.NotifyBodyContactListenerPreContact=function(g){if(null!==this.GetFixtureContactListener())throw g.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error},S.NotifyBodyContactListenerPostContact=function(){var g=this.GetFixtureContactListener();if(null!==g){for(var v=0;v<this.m_bodyContactBuffer.count;v++){var S=this.m_bodyContactBuffer.data[v];g.BeginContactFixtureParticle(this,S)}throw new Error}},S.UpdateBodyContacts=function(){var g=e.UpdateBodyContacts_s_aabb,v=new rW;if(this.NotifyBodyContactListenerPreContact(v),this.m_stuckThreshold>0)for(var S=this.GetParticleCount(),O=0;O<S;O++)this.m_bodyContactCountBuffer.data[O]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[O]+1&&(this.m_consecutiveContactStepsBuffer.data[O]=0);this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var X=g;this.ComputeAABB(X),null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new rZ(this));var Y=this.UpdateBodyContacts_callback;Y.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(Y,X),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(v)},S.Solve=function(v){var S=e.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(v),this.m_allParticleFlags&g.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<v.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var O=S.Copy(v);O.dt/=v.particleIterations,O.inv_dt*=v.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&g.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&g.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(O),this.m_allParticleFlags&g.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&g.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(O),this.m_allParticleFlags&g.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(O),this.m_allParticleFlags&g.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(O),this.m_allGroupFlags&g.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(O),this.m_allParticleFlags&g.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(O),this.m_allParticleFlags&g.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(O),this.SolvePressure(O),this.SolveDamping(O),this.m_allParticleFlags&e.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&g.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(O),this.m_allParticleFlags&g.b2ParticleFlag.b2_springParticle&&this.SolveSpring(O),this.LimitVelocity(O),this.m_allGroupFlags&g.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&g.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(O),this.SolveCollision(O),this.m_allGroupFlags&g.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(O),this.m_allParticleFlags&g.b2ParticleFlag.b2_wallParticle&&this.SolveWall();for(var X=0;X<this.m_count;X++)this.m_positionBuffer.data[X].SelfMulAdd(O.dt,this.m_velocityBuffer.data[X])}},S.SolveCollision=function(g){var S=e.SolveCollision_s_aabb,O=this.m_positionBuffer.data,X=this.m_velocityBuffer.data,Y=S;Y.lowerBound.x=+v,Y.lowerBound.y=+v,Y.upperBound.x=-v,Y.upperBound.y=-v;for(var te=0;te<this.m_count;te++){var ti=X[te],tr=O[te],ta=tr.x+g.dt*ti.x,th=tr.y+g.dt*ti.y;Y.lowerBound.x=rt(Y.lowerBound.x,rt(tr.x,ta)),Y.lowerBound.y=rt(Y.lowerBound.y,rt(tr.y,th)),Y.upperBound.x=st(Y.upperBound.x,st(tr.x,ta)),Y.upperBound.y=st(Y.upperBound.y,st(tr.y,th))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new rQ(this,g));var tu=this.SolveCollision_callback;tu.m_step=g,this.m_world.QueryAABB(tu,Y)},S.LimitVelocity=function(g){for(var v=this.m_velocityBuffer.data,S=this.GetCriticalVelocitySquared(g),O=0;O<this.m_count;O++){var X=v[O],Y=t8.DotVV(X,X);Y>S&&X.SelfMul(tZ(S/Y))}},S.SolveGravity=function(g){for(var v=e.SolveGravity_s_gravity,S=this.m_velocityBuffer.data,O=t8.MulSV(g.dt*this.m_def.gravityScale,this.m_world.GetGravity(),v),X=0;X<this.m_count;X++)S[X].SelfAdd(O)},S.SolveBarrier=function(v){for(var S=e.SolveBarrier_s_aabb,O=e.SolveBarrier_s_va,X=e.SolveBarrier_s_vb,Y=e.SolveBarrier_s_pba,te=e.SolveBarrier_s_vba,ti=e.SolveBarrier_s_vc,tr=e.SolveBarrier_s_pca,ta=e.SolveBarrier_s_vca,th=e.SolveBarrier_s_qba,tu=e.SolveBarrier_s_qca,tl=e.SolveBarrier_s_dv,tc=e.SolveBarrier_s_f,t_=this.m_positionBuffer.data,tf=this.m_velocityBuffer.data,tp=0;tp<this.m_count;tp++)0!=(this.m_flagsBuffer.data[tp]&e.k_barrierWallFlags)&&tf[tp].SetZero();for(var tm=tD*v.dt,tg=this.GetParticleMass(),tv=0;tv<this.m_pairBuffer.count;tv++){var ty=this.m_pairBuffer.data[tv];if(ty.flags&g.b2ParticleFlag.b2_barrierParticle){var tS=ty.indexA,tA=ty.indexB,tT=t_[tS],tE=t_[tA],tC=S;t8.MinV(tT,tE,tC.lowerBound),t8.MaxV(tT,tE,tC.upperBound);for(var tx=this.m_groupBuffer[tS],tb=this.m_groupBuffer[tA],tw=this.GetLinearVelocity(tx,tS,tT,O),tI=this.GetLinearVelocity(tb,tA,tE,X),tB=t8.SubVV(tE,tT,Y),tP=t8.SubVV(tI,tw,te),tM=this.GetInsideBoundsEnumerator(tC),tO=void 0;(tO=tM.GetNext())>=0;){var tk=t_[tO],tG=this.m_groupBuffer[tO];if(tx!==tG&&tb!==tG){var tV=this.GetLinearVelocity(tG,tO,tk,ti),tU=t8.SubVV(tk,tT,tr),tH=t8.SubVV(tV,tw,ta),tz=t8.CrossVV(tP,tH),tW=t8.CrossVV(tB,tH)-t8.CrossVV(tU,tP),tj=t8.CrossVV(tB,tU),tq=void 0,tK=void 0,tQ=th,t$=tu;if(0===tz){if(0===tW)continue;if(!((tK=-tj/tW)>=0&&tK<tm))continue;if(t8.AddVMulSV(tB,tK,tP,tQ),t8.AddVMulSV(tU,tK,tH,t$),!((tq=t8.DotVV(tQ,t$)/t8.DotVV(tQ,tQ))>=0&&tq<=1))continue}else{var t0=tW*tW-4*tj*tz;if(t0<0)continue;var t2=tZ(t0),t3=(-tW-t2)/(2*tz),t4=(-tW+t2)/(2*tz);if(t3>t4){var t6=t3;t3=t4,t4=t6}if(tK=t3,t8.AddVMulSV(tB,tK,tP,tQ),t8.AddVMulSV(tU,tK,tH,t$),tq=t8.DotVV(tQ,t$)/t8.DotVV(tQ,tQ),!(tK>=0&&tK<tm&&tq>=0&&tq<=1)){if(!((tK=t4)>=0&&tK<tm))continue;if(t8.AddVMulSV(tB,tK,tP,tQ),t8.AddVMulSV(tU,tK,tH,t$),!((tq=t8.DotVV(tQ,t$)/t8.DotVV(tQ,tQ))>=0&&tq<=1))continue}}var t7=tl;t7.x=tw.x+tq*tP.x-tV.x,t7.y=tw.y+tq*tP.y-tV.y;var t9=t8.MulSV(tg,t7,tc);if(tG&&this.IsRigidGroup(tG)){var ee=tG.GetMass(),en=tG.GetInertia();ee>0&&tG.m_linearVelocity.SelfMulAdd(1/ee,t9),en>0&&(tG.m_angularVelocity+=t8.CrossVV(t8.SubVV(tk,tG.GetCenter(),t8.s_t0),t9)/en)}else tf[tO].SelfAdd(t7);this.ParticleApplyForce(tO,t9.SelfMul(-v.inv_dt))}}}}},S.SolveStaticPressure=function(v){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var S=this.GetCriticalPressure(v),O=this.m_def.staticPressureStrength*S,X=tb*S,Y=this.m_def.staticPressureRelaxation,te=0;te<this.m_def.staticPressureIterations;te++){for(var ti=0;ti<this.m_count;ti++)this.m_accumulationBuffer[ti]=0;for(var tr=0;tr<this.m_contactBuffer.count;tr++){var ta=this.m_contactBuffer.data[tr];if(ta.flags&g.b2ParticleFlag.b2_staticPressureParticle){var th=ta.indexA,tu=ta.indexB,tl=ta.weight;this.m_accumulationBuffer[th]+=tl*this.m_staticPressureBuffer[tu],this.m_accumulationBuffer[tu]+=tl*this.m_staticPressureBuffer[th]}}for(var tc=0;tc<this.m_count;tc++){var t_=this.m_weightBuffer[tc];if(this.m_flagsBuffer.data[tc]&g.b2ParticleFlag.b2_staticPressureParticle){var tf=(this.m_accumulationBuffer[tc]+O*(t_-tx))/(t_+Y);this.m_staticPressureBuffer[tc]=at(tf,0,X)}else this.m_staticPressureBuffer[tc]=0}}},S.ComputeWeight=function(){for(var g=0;g<this.m_count;g++)this.m_weightBuffer[g]=0;for(var v=0;v<this.m_bodyContactBuffer.count;v++){var S=this.m_bodyContactBuffer.data[v],O=S.index,X=S.weight;this.m_weightBuffer[O]+=X}for(var Y=0;Y<this.m_contactBuffer.count;Y++){var te=this.m_contactBuffer.data[Y],ti=te.indexA,tr=te.indexB,ta=te.weight;this.m_weightBuffer[ti]+=ta,this.m_weightBuffer[tr]+=ta}},S.SolvePressure=function(v){for(var S=e.SolvePressure_s_f,O=this.m_positionBuffer.data,X=this.m_velocityBuffer.data,Y=this.GetCriticalPressure(v),te=this.m_def.pressureStrength*Y,ti=tb*Y,tr=0;tr<this.m_count;tr++){var ta=te*st(0,this.m_weightBuffer[tr]-tx);this.m_accumulationBuffer[tr]=rt(ta,ti)}if(this.m_allParticleFlags&e.k_noPressureFlags)for(var th=0;th<this.m_count;th++)this.m_flagsBuffer.data[th]&e.k_noPressureFlags&&(this.m_accumulationBuffer[th]=0);if(this.m_allParticleFlags&g.b2ParticleFlag.b2_staticPressureParticle)for(var tu=0;tu<this.m_count;tu++)this.m_flagsBuffer.data[tu]&g.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[tu]+=this.m_staticPressureBuffer[tu]);for(var tl=v.dt/(this.m_def.density*this.m_particleDiameter),tc=this.GetParticleInvMass(),t_=0;t_<this.m_bodyContactBuffer.count;t_++){var tf=this.m_bodyContactBuffer.data[t_],tp=tf.index,tm=tf.body,tg=tf.weight,tv=tf.mass,ty=tf.normal,tS=O[tp],tA=this.m_accumulationBuffer[tp]+te*tg,tT=t8.MulSV(tl*tg*tv*tA,ty,S);X[tp].SelfMulSub(tc,tT),tm.ApplyLinearImpulse(tT,tS,!0)}for(var tE=0;tE<this.m_contactBuffer.count;tE++){var tC=this.m_contactBuffer.data[tE],tw=tC.indexA,tI=tC.indexB,tB=tC.weight,tP=tC.normal,tD=this.m_accumulationBuffer[tw]+this.m_accumulationBuffer[tI],tM=t8.MulSV(tl*tB*tD,tP,S);X[tw].SelfSub(tM),X[tI].SelfAdd(tM)}},S.SolveDamping=function(g){for(var v=e.SolveDamping_s_v,S=e.SolveDamping_s_f,O=this.m_positionBuffer.data,X=this.m_velocityBuffer.data,Y=this.m_def.dampingStrength,te=1/this.GetCriticalVelocity(g),ti=this.GetParticleInvMass(),tr=0;tr<this.m_bodyContactBuffer.count;tr++){var ta=this.m_bodyContactBuffer.data[tr],th=ta.index,tu=ta.body,tl=ta.weight,tc=ta.mass,t_=ta.normal,tf=O[th],tp=t8.SubVV(tu.GetLinearVelocityFromWorldPoint(tf,t8.s_t0),X[th],v),tm=t8.DotVV(tp,t_);if(tm<0){var tg=st(Y*tl,rt(-te*tm,.5)),tv=t8.MulSV(tg*tc*tm,t_,S);X[th].SelfMulAdd(ti,tv),tu.ApplyLinearImpulse(tv.SelfNeg(),tf,!0)}}for(var ty=0;ty<this.m_contactBuffer.count;ty++){var tS=this.m_contactBuffer.data[ty],tA=tS.indexA,tT=tS.indexB,tE=tS.weight,tC=tS.normal,tx=t8.SubVV(X[tT],X[tA],v),tb=t8.DotVV(tx,tC);if(tb<0){var tw=st(Y*tE,rt(-te*tb,.5)),tI=t8.MulSV(tw*tb,tC,S);X[tA].SelfAdd(tI),X[tT].SelfSub(tI)}}},S.SolveRigidDamping=function(){for(var g=e.SolveRigidDamping_s_t0,v=e.SolveRigidDamping_s_t1,S=e.SolveRigidDamping_s_p,O=e.SolveRigidDamping_s_v,X=[0],Y=[0],te=[0],ti=[0],tr=[0],ta=[0],th=this.m_positionBuffer.data,tu=this.m_def.dampingStrength,tl=0;tl<this.m_bodyContactBuffer.count;tl++){var tc=this.m_bodyContactBuffer.data[tl],t_=tc.index,tf=this.m_groupBuffer[t_];if(tf&&this.IsRigidGroup(tf)){var tp=tc.body,tm=tc.normal,tg=tc.weight,tv=th[t_],ty=t8.SubVV(tp.GetLinearVelocityFromWorldPoint(tv,g),tf.GetLinearVelocityFromWorldPoint(tv,v),O),tS=t8.DotVV(ty,tm);if(tS<0){this.InitDampingParameterWithRigidGroupOrParticle(X,Y,te,!0,tf,t_,tv,tm),this.InitDampingParameter(ti,tr,ta,tp.GetMass(),tp.GetInertia()-tp.GetMass()*tp.GetLocalCenter().LengthSquared(),tp.GetWorldCenter(),tv,tm);var tA=tu*rt(tg,1)*this.ComputeDampingImpulse(X[0],Y[0],te[0],ti[0],tr[0],ta[0],tS);this.ApplyDamping(X[0],Y[0],te[0],!0,tf,t_,tA,tm),tp.ApplyLinearImpulse(t8.MulSV(-tA,tm,t8.s_t0),tv,!0)}}}for(var tT=0;tT<this.m_contactBuffer.count;tT++){var tE=this.m_contactBuffer.data[tT],tC=tE.indexA,tx=tE.indexB,tb=tE.normal,tw=tE.weight,tI=this.m_groupBuffer[tC],tB=this.m_groupBuffer[tx],tP=this.IsRigidGroup(tI),tD=this.IsRigidGroup(tB);if(tI!==tB&&(tP||tD)){var tM=t8.MidVV(th[tC],th[tx],S),tO=t8.SubVV(this.GetLinearVelocity(tB,tx,tM,g),this.GetLinearVelocity(tI,tC,tM,v),O),tk=t8.DotVV(tO,tb);if(tk<0){this.InitDampingParameterWithRigidGroupOrParticle(X,Y,te,tP,tI,tC,tM,tb),this.InitDampingParameterWithRigidGroupOrParticle(ti,tr,ta,tD,tB,tx,tM,tb);var tG=tu*tw*this.ComputeDampingImpulse(X[0],Y[0],te[0],ti[0],tr[0],ta[0],tk);this.ApplyDamping(X[0],Y[0],te[0],tP,tI,tC,tG,tb),this.ApplyDamping(ti[0],tr[0],ta[0],tD,tB,tx,-tG,tb)}}}},S.SolveExtraDamping=function(){for(var g=e.SolveExtraDamping_s_v,v=e.SolveExtraDamping_s_f,S=this.m_velocityBuffer.data,O=this.m_positionBuffer.data,X=this.GetParticleInvMass(),Y=0;Y<this.m_bodyContactBuffer.count;Y++){var te=this.m_bodyContactBuffer.data[Y],ti=te.index;if(this.m_flagsBuffer.data[ti]&e.k_extraDampingFlags){var tr=te.body,ta=te.mass,th=te.normal,tu=O[ti],tl=t8.SubVV(tr.GetLinearVelocityFromWorldPoint(tu,t8.s_t0),S[ti],g),tc=t8.DotVV(tl,th);if(tc<0){var t_=t8.MulSV(.5*ta*tc,th,v);S[ti].SelfMulAdd(X,t_),tr.ApplyLinearImpulse(t_.SelfNeg(),tu,!0)}}}},S.SolveWall=function(){for(var v=this.m_velocityBuffer.data,S=0;S<this.m_count;S++)this.m_flagsBuffer.data[S]&g.b2ParticleFlag.b2_wallParticle&&v[S].SetZero()},S.SolveRigid=function(v){for(var S=e.SolveRigid_s_position,O=e.SolveRigid_s_rotation,X=e.SolveRigid_s_transform,Y=e.SolveRigid_s_velocityTransform,te=this.m_positionBuffer.data,ti=this.m_velocityBuffer.data,tr=this.m_groupList;tr;tr=tr.GetNext())if(tr.m_groupFlags&g.b2ParticleGroupFlag.b2_rigidParticleGroup){tr.UpdateStatistics();var ta=O;ta.SetAngle(v.dt*tr.m_angularVelocity);var th=t8.AddVV(tr.m_center,t8.SubVV(t8.MulSV(v.dt,tr.m_linearVelocity,t8.s_t0),en.MulRV(ta,tr.m_center,t8.s_t1),t8.s_t0),S),tu=X;tu.SetPositionRotation(th,ta),er.MulXX(tu,tr.m_transform,tr.m_transform);var tl=Y;tl.p.x=v.inv_dt*tu.p.x,tl.p.y=v.inv_dt*tu.p.y,tl.q.s=v.inv_dt*tu.q.s,tl.q.c=v.inv_dt*(tu.q.c-1);for(var tc=tr.m_firstIndex;tc<tr.m_lastIndex;tc++)er.MulXV(tl,te[tc],ti[tc])}},S.SolveElastic=function(v){for(var S=e.SolveElastic_s_pa,O=e.SolveElastic_s_pb,X=e.SolveElastic_s_pc,Y=e.SolveElastic_s_r,te=e.SolveElastic_s_t0,ti=this.m_positionBuffer.data,tr=this.m_velocityBuffer.data,ta=v.inv_dt*this.m_def.elasticStrength,th=0;th<this.m_triadBuffer.count;th++){var tu=this.m_triadBuffer.data[th];if(tu.flags&g.b2ParticleFlag.b2_elasticParticle){var tl=tu.indexA,tc=tu.indexB,t_=tu.indexC,tf=tu.pa,tp=tu.pb,tm=tu.pc,tg=S.Copy(ti[tl]),tv=O.Copy(ti[tc]),ty=X.Copy(ti[t_]),tS=tr[tl],tA=tr[tc],tT=tr[t_];tg.SelfMulAdd(v.dt,tS),tv.SelfMulAdd(v.dt,tA),ty.SelfMulAdd(v.dt,tT);var tE=(tg.x+tv.x+ty.x)/3,tC=(tg.y+tv.y+ty.y)/3;tg.x-=tE,tg.y-=tC,tv.x-=tE,tv.y-=tC,ty.x-=tE,ty.y-=tC;var tx=Y;tx.s=t8.CrossVV(tf,tg)+t8.CrossVV(tp,tv)+t8.CrossVV(tm,ty),tx.c=t8.DotVV(tf,tg)+t8.DotVV(tp,tv)+t8.DotVV(tm,ty);var tb=lt(tx.s*tx.s+tx.c*tx.c);isFinite(tb)||(tb=198177537e11),tx.s*=tb,tx.c*=tb;var tw=ta*tu.strength;en.MulRV(tx,tf,te),t8.SubVV(te,tg,te),t8.MulSV(tw,te,te),tS.SelfAdd(te),en.MulRV(tx,tp,te),t8.SubVV(te,tv,te),t8.MulSV(tw,te,te),tA.SelfAdd(te),en.MulRV(tx,tm,te),t8.SubVV(te,ty,te),t8.MulSV(tw,te,te),tT.SelfAdd(te)}}},S.SolveSpring=function(v){for(var S=e.SolveSpring_s_pa,O=e.SolveSpring_s_pb,X=e.SolveSpring_s_d,Y=e.SolveSpring_s_f,te=this.m_positionBuffer.data,ti=this.m_velocityBuffer.data,tr=v.inv_dt*this.m_def.springStrength,ta=0;ta<this.m_pairBuffer.count;ta++){var th=this.m_pairBuffer.data[ta];if(th.flags&g.b2ParticleFlag.b2_springParticle){var tu=th.indexA,tl=th.indexB,tc=S.Copy(te[tu]),t_=O.Copy(te[tl]),tf=ti[tu],tp=ti[tl];tc.SelfMulAdd(v.dt,tf),t_.SelfMulAdd(v.dt,tp);var tm=t8.SubVV(t_,tc,X),tg=th.distance,tv=tm.Length(),ty=tr*th.strength,tS=t8.MulSV(ty*(tg-tv)/tv,tm,Y);tf.SelfSub(tS),tp.SelfAdd(tS)}}},S.SolveTensile=function(v){for(var S=e.SolveTensile_s_weightedNormal,O=e.SolveTensile_s_s,X=e.SolveTensile_s_f,Y=this.m_velocityBuffer.data,te=0;te<this.m_count;te++)this.m_accumulation2Buffer[te]=new t8,this.m_accumulation2Buffer[te].SetZero();for(var ti=0;ti<this.m_contactBuffer.count;ti++){var tr=this.m_contactBuffer.data[ti];if(tr.flags&g.b2ParticleFlag.b2_tensileParticle){var ta=tr.indexA,th=tr.indexB,tu=tr.weight,tl=tr.normal,tc=t8.MulSV((1-tu)*tu,tl,S);this.m_accumulation2Buffer[ta].SelfSub(tc),this.m_accumulation2Buffer[th].SelfAdd(tc)}}for(var t_=this.GetCriticalVelocity(v),tf=this.m_def.surfaceTensionPressureStrength*t_,tp=this.m_def.surfaceTensionNormalStrength*t_,tm=tw*t_,tg=0;tg<this.m_contactBuffer.count;tg++){var tv=this.m_contactBuffer.data[tg];if(tv.flags&g.b2ParticleFlag.b2_tensileParticle){var ty=tv.indexA,tS=tv.indexB,tA=tv.weight,tT=tv.normal,tE=this.m_weightBuffer[ty]+this.m_weightBuffer[tS],tC=t8.SubVV(this.m_accumulation2Buffer[tS],this.m_accumulation2Buffer[ty],O),tx=rt(tf*(tE-2)+tp*t8.DotVV(tC,tT),tm)*tA,tb=t8.MulSV(tx,tT,X);Y[ty].SelfSub(tb),Y[tS].SelfAdd(tb)}}},S.SolveViscous=function(){for(var v=e.SolveViscous_s_v,S=e.SolveViscous_s_f,O=this.m_positionBuffer.data,X=this.m_velocityBuffer.data,Y=this.m_def.viscousStrength,te=this.GetParticleInvMass(),ti=0;ti<this.m_bodyContactBuffer.count;ti++){var tr=this.m_bodyContactBuffer.data[ti],ta=tr.index;if(this.m_flagsBuffer.data[ta]&g.b2ParticleFlag.b2_viscousParticle){var th=tr.body,tu=tr.weight,tl=tr.mass,tc=O[ta],t_=t8.SubVV(th.GetLinearVelocityFromWorldPoint(tc,t8.s_t0),X[ta],v),tf=t8.MulSV(Y*tl*tu,t_,S);X[ta].SelfMulAdd(te,tf),th.ApplyLinearImpulse(tf.SelfNeg(),tc,!0)}}for(var tp=0;tp<this.m_contactBuffer.count;tp++){var tm=this.m_contactBuffer.data[tp];if(tm.flags&g.b2ParticleFlag.b2_viscousParticle){var tg=tm.indexA,tv=tm.indexB,ty=tm.weight,tS=t8.SubVV(X[tv],X[tg],v),tA=t8.MulSV(Y*ty,tS,S);X[tg].SelfAdd(tA),X[tv].SelfSub(tA)}}},S.SolveRepulsive=function(v){for(var S=e.SolveRepulsive_s_f,O=this.m_velocityBuffer.data,X=this.m_def.repulsiveStrength*this.GetCriticalVelocity(v),Y=0;Y<this.m_contactBuffer.count;Y++){var te=this.m_contactBuffer.data[Y];if(te.flags&g.b2ParticleFlag.b2_repulsiveParticle){var ti=te.indexA,tr=te.indexB;if(this.m_groupBuffer[ti]!==this.m_groupBuffer[tr]){var ta=te.weight,th=te.normal,tu=t8.MulSV(X*ta,th,S);O[ti].SelfSub(tu),O[tr].SelfAdd(tu)}}}},S.SolvePowder=function(v){for(var S=e.SolvePowder_s_f,O=this.m_positionBuffer.data,X=this.m_velocityBuffer.data,Y=this.m_def.powderStrength*this.GetCriticalVelocity(v),te=1-tC,ti=this.GetParticleInvMass(),tr=0;tr<this.m_bodyContactBuffer.count;tr++){var ta=this.m_bodyContactBuffer.data[tr],th=ta.index;if(this.m_flagsBuffer.data[th]&g.b2ParticleFlag.b2_powderParticle){var tu=ta.weight;if(tu>te){var tl=ta.body,tc=ta.mass,t_=O[th],tf=ta.normal,tp=t8.MulSV(Y*tc*(tu-te),tf,S);X[th].SelfMulSub(ti,tp),tl.ApplyLinearImpulse(tp,t_,!0)}}}for(var tm=0;tm<this.m_contactBuffer.count;tm++){var tg=this.m_contactBuffer.data[tm];if(tg.flags&g.b2ParticleFlag.b2_powderParticle){var tv=tg.weight;if(tv>te){var ty=tg.indexA,tS=tg.indexB,tA=tg.normal,tT=t8.MulSV(Y*(tv-te),tA,S);X[ty].SelfSub(tT),X[tS].SelfAdd(tT)}}}},S.SolveSolid=function(g){var v=e.SolveSolid_s_f,S=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var O=g.inv_dt*this.m_def.ejectionStrength,X=0;X<this.m_contactBuffer.count;X++){var Y=this.m_contactBuffer.data[X],te=Y.indexA,ti=Y.indexB;if(this.m_groupBuffer[te]!==this.m_groupBuffer[ti]){var tr=Y.weight,ta=Y.normal,th=this.m_depthBuffer[te]+this.m_depthBuffer[ti],tu=t8.MulSV(O*th*tr,ta,v);S[te].SelfSub(tu),S[ti].SelfAdd(tu)}}},S.SolveForce=function(g){for(var v=this.m_velocityBuffer.data,S=g.dt*this.GetParticleInvMass(),O=0;O<this.m_count;O++)v[O].SelfMulAdd(S,this.m_forceBuffer[O]);this.m_hasForce=!1},S.SolveColorMixing=function(){var v=.5*this.m_def.colorMixingStrength;if(v)for(var S=0;S<this.m_contactBuffer.count;S++){var O=this.m_contactBuffer.data[S],X=O.indexA,Y=O.indexB;if(this.m_flagsBuffer.data[X]&this.m_flagsBuffer.data[Y]&g.b2ParticleFlag.b2_colorMixingParticle){var te=this.m_colorBuffer.data[X],ti=this.m_colorBuffer.data[Y];eh.MixColors(te,ti,v)}}},S.SolveZombie=function(){for(var v=0,S=[],O=0;O<this.m_count;O++)S[O]=tT;for(var X=0,Y=0;Y<this.m_count;Y++){var te=this.m_flagsBuffer.data[Y];if(te&g.b2ParticleFlag.b2_zombieParticle){var ti=this.m_world.m_destructionListener;if(te&g.b2ParticleFlag.b2_destructionListenerParticle&&ti&&ti.SayGoodbyeParticle(this,Y),this.m_handleIndexBuffer.data){var tr=this.m_handleIndexBuffer.data[Y];tr&&(tr.SetIndex(tT),this.m_handleIndexBuffer.data[Y]=null)}S[Y]=tT}else{if(S[Y]=v,Y!==v){if(this.m_handleIndexBuffer.data){var ta=this.m_handleIndexBuffer.data[Y];ta&&ta.SetIndex(v),this.m_handleIndexBuffer.data[v]=ta}this.m_flagsBuffer.data[v]=this.m_flagsBuffer.data[Y],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[v]=this.m_lastBodyContactStepBuffer.data[Y]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[v]=this.m_bodyContactCountBuffer.data[Y]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[v]=this.m_consecutiveContactStepsBuffer.data[Y]),this.m_positionBuffer.data[v].Copy(this.m_positionBuffer.data[Y]),this.m_velocityBuffer.data[v].Copy(this.m_velocityBuffer.data[Y]),this.m_groupBuffer[v]=this.m_groupBuffer[Y],this.m_hasForce&&this.m_forceBuffer[v].Copy(this.m_forceBuffer[Y]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[v]=this.m_staticPressureBuffer[Y]),this.m_depthBuffer&&(this.m_depthBuffer[v]=this.m_depthBuffer[Y]),this.m_colorBuffer.data&&this.m_colorBuffer.data[v].Copy(this.m_colorBuffer.data[Y]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[v]=this.m_userDataBuffer.data[Y]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[v]=this.m_expirationTimeBuffer.data[Y])}v++,X|=te}}for(var th={IsProxyInvalid:function(g){return g.index<0},IsContactInvalid:function(g){return g.indexA<0||g.indexB<0},IsBodyContactInvalid:function(g){return g.index<0},IsPairInvalid:function(g){return g.indexA<0||g.indexB<0},IsTriadInvalid:function(g){return g.indexA<0||g.indexB<0||g.indexC<0}},tu=0;tu<this.m_proxyBuffer.count;tu++){var tl=this.m_proxyBuffer.data[tu];tl.index=S[tl.index]}this.m_proxyBuffer.RemoveIf(th.IsProxyInvalid);for(var tc=0;tc<this.m_contactBuffer.count;tc++){var t_=this.m_contactBuffer.data[tc];t_.indexA=S[t_.indexA],t_.indexB=S[t_.indexB]}this.m_contactBuffer.RemoveIf(th.IsContactInvalid);for(var tf=0;tf<this.m_bodyContactBuffer.count;tf++){var tp=this.m_bodyContactBuffer.data[tf];tp.index=S[tp.index]}this.m_bodyContactBuffer.RemoveIf(th.IsBodyContactInvalid);for(var tm=0;tm<this.m_pairBuffer.count;tm++){var tg=this.m_pairBuffer.data[tm];tg.indexA=S[tg.indexA],tg.indexB=S[tg.indexB]}this.m_pairBuffer.RemoveIf(th.IsPairInvalid);for(var tv=0;tv<this.m_triadBuffer.count;tv++){var ty=this.m_triadBuffer.data[tv];ty.indexA=S[ty.indexA],ty.indexB=S[ty.indexB],ty.indexC=S[ty.indexC]}if(this.m_triadBuffer.RemoveIf(th.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data)for(var tS=0,tA=0;tA<this.m_count;tA++){var tE=S[this.m_indexByExpirationTimeBuffer.data[tA]];tE!==tT&&(this.m_indexByExpirationTimeBuffer.data[tS++]=tE)}for(var tC=this.m_groupList;tC;tC=tC.GetNext()){for(var tx=v,tb=0,tw=!1,tI=tC.m_firstIndex;tI<tC.m_lastIndex;tI++){var tB=S[tI];tB>=0?(tx=rt(tx,tB),tb=st(tb,tB+1)):tw=!0}tx<tb?(tC.m_firstIndex=tx,tC.m_lastIndex=tb,tw&&tC.m_groupFlags&g.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(tC,tC.m_groupFlags|g.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(tC.m_firstIndex=0,tC.m_lastIndex=0,tC.m_groupFlags&g.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(tC,tC.m_groupFlags|g.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}this.m_count=v,this.m_allParticleFlags=X,this.m_needsUpdateAllParticleFlags=!1;for(var tP=this.m_groupList;tP;){var tD=tP.GetNext();tP.m_groupFlags&g.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(tP),tP=tD}},S.SolveLifetimes=function(g){this.m_timeElapsed=this.LifetimeToExpirationTime(g.dt);var v=this.GetQuantizedTimeElapsed(),S=this.m_expirationTimeBuffer.data,O=this.m_indexByExpirationTimeBuffer.data,X=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(Hr(O,0,X,function(g,v){var O=S[g],X=S[v],Y=O<=0;return Y===X<=0?O>X:Y}),this.m_expirationTimeBufferRequiresSorting=!1);for(var Y=X-1;Y>=0;--Y){var te=O[Y],ti=S[te];if(v<ti||ti<=0)break;this.DestroyParticle(te)}},S.RotateBuffer=function(g,v,S){if(g!==v&&v!==S){if(Yr(this.m_flagsBuffer.data,g,v,S),this.m_lastBodyContactStepBuffer.data&&Yr(this.m_lastBodyContactStepBuffer.data,g,v,S),this.m_bodyContactCountBuffer.data&&Yr(this.m_bodyContactCountBuffer.data,g,v,S),this.m_consecutiveContactStepsBuffer.data&&Yr(this.m_consecutiveContactStepsBuffer.data,g,v,S),Yr(this.m_positionBuffer.data,g,v,S),Yr(this.m_velocityBuffer.data,g,v,S),Yr(this.m_groupBuffer,g,v,S),this.m_hasForce&&Yr(this.m_forceBuffer,g,v,S),this.m_staticPressureBuffer&&Yr(this.m_staticPressureBuffer,g,v,S),this.m_depthBuffer&&Yr(this.m_depthBuffer,g,v,S),this.m_colorBuffer.data&&Yr(this.m_colorBuffer.data,g,v,S),this.m_userDataBuffer.data&&Yr(this.m_userDataBuffer.data,g,v,S),this.m_handleIndexBuffer.data){Yr(this.m_handleIndexBuffer.data,g,v,S);for(var O=g;O<S;++O){var X=this.m_handleIndexBuffer.data[O];X&&X.SetIndex(y(X.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Yr(this.m_expirationTimeBuffer.data,g,v,S);for(var Y=this.GetParticleCount(),te=this.m_indexByExpirationTimeBuffer.data,ti=0;ti<Y;++ti)te[ti]=y(te[ti])}for(var tr=0;tr<this.m_proxyBuffer.count;tr++){var ta=this.m_proxyBuffer.data[tr];ta.index=y(ta.index)}for(var th=0;th<this.m_contactBuffer.count;th++){var tu=this.m_contactBuffer.data[th];tu.indexA=y(tu.indexA),tu.indexB=y(tu.indexB)}for(var tl=0;tl<this.m_bodyContactBuffer.count;tl++){var tc=this.m_bodyContactBuffer.data[tl];tc.index=y(tc.index)}for(var t_=0;t_<this.m_pairBuffer.count;t_++){var tf=this.m_pairBuffer.data[t_];tf.indexA=y(tf.indexA),tf.indexB=y(tf.indexB)}for(var tp=0;tp<this.m_triadBuffer.count;tp++){var tm=this.m_triadBuffer.data[tp];tm.indexA=y(tm.indexA),tm.indexB=y(tm.indexB),tm.indexC=y(tm.indexC)}for(var tg=this.m_groupList;tg;tg=tg.GetNext())tg.m_firstIndex=y(tg.m_firstIndex),tg.m_lastIndex=y(tg.m_lastIndex-1)+1}function y(O){return O<g?O:O<v?O+S-v:O<S?O+g-v:O}},S.GetCriticalVelocity=function(g){return this.m_particleDiameter*g.inv_dt},S.GetCriticalVelocitySquared=function(g){var v=this.GetCriticalVelocity(g);return v*v},S.GetCriticalPressure=function(g){return this.m_def.density*this.GetCriticalVelocitySquared(g)},S.GetParticleStride=function(){return tC*this.m_particleDiameter},S.GetParticleMass=function(){var g=this.GetParticleStride();return this.m_def.density*g*g},S.GetParticleInvMass=function(){var g=this.m_inverseDiameter*(1/tC);return this.m_inverseDensity*g*g},S.GetFixtureContactFilter=function(){return this.m_allParticleFlags&g.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},S.GetParticleContactFilter=function(){return this.m_allParticleFlags&g.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},S.GetFixtureContactListener=function(){return this.m_allParticleFlags&g.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},S.GetParticleContactListener=function(){return this.m_allParticleFlags&g.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},S.SetUserOverridableBuffer=function(g,v){g.data=v,g.userSuppliedCapacity=v.length},S.SetGroupFlags=function(v,S){var O=v.m_groupFlags;(O^S)&g.b2ParticleGroupFlag.b2_solidParticleGroup&&(S|=g.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),O&~S&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&S&&(S&g.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=S),v.m_groupFlags=S},e.BodyContactCompare=function(g,v){return g.index===v.index?g.weight>v.weight:g.index<v.index},S.RemoveSpuriousBodyContacts=function(){Hr(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,e.BodyContactCompare);var g=e.RemoveSpuriousBodyContacts_s_n,v=e.RemoveSpuriousBodyContacts_s_pos,S=e.RemoveSpuriousBodyContacts_s_normal,O=3,X=this,Y=-1,te=0,h=function(ti){if(ti.index!==Y&&(te=0,Y=ti.index),te++>O)return!0;var tr=g.Copy(ti.normal);tr.SelfMul(X.m_particleDiameter*(1-ti.weight));var th=t8.AddVV(X.m_positionBuffer.data[ti.index],tr,v);if(!ti.fixture.TestPoint(th)){for(var tu=ti.fixture.GetShape().GetChildCount(),tl=0;tl<tu;tl++){var tc=S;if(ti.fixture.ComputeDistance(th,tc,tl)<ta)return!1}return!0}return!1};this.m_bodyContactBuffer.count=Wr(this.m_bodyContactBuffer.data,h,this.m_bodyContactBuffer.count)},S.DetectStuckParticle=function(g){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[g],2===this.m_bodyContactCountBuffer.data[g]&&(++this.m_consecutiveContactStepsBuffer.data[g],this.m_consecutiveContactStepsBuffer.data[g]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=g)),this.m_lastBodyContactStepBuffer.data[g]=this.m_timestamp)},S.ValidateParticleIndex=function(g){return g>=0&&g<this.GetParticleCount()&&g!==tT},S.GetQuantizedTimeElapsed=function(){return Math.floor(this.m_timeElapsed/0x100000000)},S.LifetimeToExpirationTime=function(g){return this.m_timeElapsed+Math.floor(g/this.m_def.lifetimeGranularity*0x100000000)},S.ForceCanBeApplied=function(v){return!(v&g.b2ParticleFlag.b2_wallParticle)},S.PrepareForceBuffer=function(){if(!this.m_hasForce){for(var g=0;g<this.m_count;g++)this.m_forceBuffer[g].SetZero();this.m_hasForce=!0}},S.IsRigidGroup=function(v){return null!==v&&0!=(v.m_groupFlags&g.b2ParticleGroupFlag.b2_rigidParticleGroup)},S.GetLinearVelocity=function(g,v,S,O){return g&&this.IsRigidGroup(g)?g.GetLinearVelocityFromWorldPoint(S,O):O.Copy(this.m_velocityBuffer.data[v])},S.InitDampingParameter=function(g,v,S,O,X,Y,te,ti){g[0]=O>0?1/O:0,v[0]=X>0?1/X:0,S[0]=t8.CrossVV(t8.SubVV(te,Y,t8.s_t0),ti)},S.InitDampingParameterWithRigidGroupOrParticle=function(v,S,O,X,Y,te,ti,tr){if(Y&&X)this.InitDampingParameter(v,S,O,Y.GetMass(),Y.GetInertia(),Y.GetCenter(),ti,tr);else{var ta=this.m_flagsBuffer.data[te];this.InitDampingParameter(v,S,O,ta&g.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,ti,ti,tr)}},S.ComputeDampingImpulse=function(g,v,S,O,X,Y,te){var ti=g+v*S*S+O+X*Y*Y;return ti>0?te/ti:0},S.ApplyDamping=function(g,v,S,O,X,Y,te,ti){X&&O?(X.m_linearVelocity.SelfMulAdd(te*g,ti),X.m_angularVelocity+=te*S*v):this.m_velocityBuffer.data[Y].SelfMulAdd(te*g,ti)},e}();rG.xTruncBits=12,rG.yTruncBits=12,rG.tagBits=32,rG.yOffset=1<<rG.yTruncBits-1,rG.yShift=rG.tagBits-rG.yTruncBits,rG.xShift=rG.tagBits-rG.yTruncBits-rG.xTruncBits,rG.xScale=1<<rG.xShift,rG.xOffset=rG.xScale*(1<<rG.xTruncBits-1),rG.yMask=(1<<rG.yTruncBits)-1<<rG.yShift,rG.xMask=~rG.yMask,rG.DestroyParticlesInShape_s_aabb=new e$,rG.CreateParticleGroup_s_transform=new er,rG.ComputeCollisionEnergy_s_v=new t8,rG.QueryShapeAABB_s_aabb=new e$,rG.QueryPointAABB_s_aabb=new e$,rG.RayCast_s_aabb=new e$,rG.RayCast_s_p=new t8,rG.RayCast_s_v=new t8,rG.RayCast_s_n=new t8,rG.RayCast_s_point=new t8,rG.k_pairFlags=g.b2ParticleFlag.b2_springParticle,rG.k_triadFlags=g.b2ParticleFlag.b2_elasticParticle,rG.k_noPressureFlags=g.b2ParticleFlag.b2_powderParticle|g.b2ParticleFlag.b2_tensileParticle,rG.k_extraDampingFlags=g.b2ParticleFlag.b2_staticPressureParticle,rG.k_barrierWallFlags=g.b2ParticleFlag.b2_barrierParticle|g.b2ParticleFlag.b2_wallParticle,rG.CreateParticlesStrokeShapeForGroup_s_edge=new nf,rG.CreateParticlesStrokeShapeForGroup_s_d=new t8,rG.CreateParticlesStrokeShapeForGroup_s_p=new t8,rG.CreateParticlesFillShapeForGroup_s_aabb=new e$,rG.CreateParticlesFillShapeForGroup_s_p=new t8,rG.UpdatePairsAndTriads_s_dab=new t8,rG.UpdatePairsAndTriads_s_dbc=new t8,rG.UpdatePairsAndTriads_s_dca=new t8,rG.AddContact_s_d=new t8,rG.UpdateBodyContacts_s_aabb=new e$,rG.Solve_s_subStep=new rm,rG.SolveCollision_s_aabb=new e$,rG.SolveGravity_s_gravity=new t8,rG.SolveBarrier_s_aabb=new e$,rG.SolveBarrier_s_va=new t8,rG.SolveBarrier_s_vb=new t8,rG.SolveBarrier_s_pba=new t8,rG.SolveBarrier_s_vba=new t8,rG.SolveBarrier_s_vc=new t8,rG.SolveBarrier_s_pca=new t8,rG.SolveBarrier_s_vca=new t8,rG.SolveBarrier_s_qba=new t8,rG.SolveBarrier_s_qca=new t8,rG.SolveBarrier_s_dv=new t8,rG.SolveBarrier_s_f=new t8,rG.SolvePressure_s_f=new t8,rG.SolveDamping_s_v=new t8,rG.SolveDamping_s_f=new t8,rG.SolveRigidDamping_s_t0=new t8,rG.SolveRigidDamping_s_t1=new t8,rG.SolveRigidDamping_s_p=new t8,rG.SolveRigidDamping_s_v=new t8,rG.SolveExtraDamping_s_v=new t8,rG.SolveExtraDamping_s_f=new t8,rG.SolveRigid_s_position=new t8,rG.SolveRigid_s_rotation=new en,rG.SolveRigid_s_transform=new er,rG.SolveRigid_s_velocityTransform=new er,rG.SolveElastic_s_pa=new t8,rG.SolveElastic_s_pb=new t8,rG.SolveElastic_s_pc=new t8,rG.SolveElastic_s_r=new en,rG.SolveElastic_s_t0=new t8,rG.SolveSpring_s_pa=new t8,rG.SolveSpring_s_pb=new t8,rG.SolveSpring_s_d=new t8,rG.SolveSpring_s_f=new t8,rG.SolveTensile_s_weightedNormal=new t8,rG.SolveTensile_s_s=new t8,rG.SolveTensile_s_f=new t8,rG.SolveViscous_s_v=new t8,rG.SolveViscous_s_f=new t8,rG.SolveRepulsive_s_f=new t8,rG.SolvePowder_s_f=new t8,rG.SolveSolid_s_f=new t8,rG.RemoveSpuriousBodyContacts_s_n=new t8,rG.RemoveSpuriousBodyContacts_s_pos=new t8,rG.RemoveSpuriousBodyContacts_s_normal=new t8;var rV=function(){function t1(){this._data=null,this.userSuppliedCapacity=0}return n(t1,[{key:"data",get:function(){return this._data},set:function(g){this._data=g}}]),t1}(),rU=function(){function t1(){this.index=tT,this.tag=0}return t1.CompareProxyProxy=function(g,v){return g.tag<v.tag},t1.CompareTagProxy=function(g,v){return g<v.tag},t1.CompareProxyTag=function(g,v){return g.tag<v},t1}(),rH=function(){function t1(g,v,S,O,X){this.m_system=g,this.m_xLower=(v&rG.xMask)>>>0,this.m_xUpper=(S&rG.xMask)>>>0,this.m_yLower=(v&rG.yMask)>>>0,this.m_yUpper=(S&rG.yMask)>>>0,this.m_first=O,this.m_last=X}return t1.prototype.GetNext=function(){for(;this.m_first<this.m_last;){var g=(this.m_system.m_proxyBuffer.data[this.m_first].tag&rG.xMask)>>>0;if(g>=this.m_xLower&&g<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return tT},t1}(),as=function(){this.next=null,this.count=0,this.index=0},rz=function(){function t1(){}var g=t1.prototype;return g.Allocate=function(g,v){return v},g.Clear=function(){},g.GetCount=function(){return 0},g.Invalidate=function(){},g.GetValidBuffer=function(){return[]},g.GetBuffer=function(){return[]},g.SetCount=function(){},t1}(),hs=function(g,v){this.second=tT,this.first=g,this.second=v},rW=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.Initialize=function(){},v.Find=function(){return tT},e}(rz),ls=function(g,v){this.first=tT,this.second=tT,this.first=g,this.second=v},rX=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.Initialize=function(){},v.Find=function(){return tT},e}(rz),rj=function(){function t1(){}var g=t1.prototype;return g.IsNecessary=function(){return!0},g.ShouldCreatePair=function(){return!0},g.ShouldCreateTriad=function(){return!0},t1}(),rq=function(g){function e(v,S,O,X){var Y;return(Y=g.call(this)||this).m_callDestructionListener=!1,Y.m_destroyed=0,Y.m_system=v,Y.m_shape=S,Y.m_xf=O,Y.m_callDestructionListener=X,Y.m_destroyed=0,Y}s(e,g);var v=e.prototype;return v.ReportFixture=function(){return!1},v.ReportParticle=function(g,v){return g===this.m_system&&(this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[v])&&(this.m_system.DestroyParticle(v,this.m_callDestructionListener),this.m_destroyed++),!0)},v.Destroyed=function(){return this.m_destroyed},e}(r_),rY=function(g){function e(v){var S;return(S=g.call(this)||this).m_threshold=0,S.m_threshold=v,S}s(e,g);var v=e.prototype;return v.ShouldCreatePair=function(g,v){return g<this.m_threshold&&this.m_threshold<=v||v<this.m_threshold&&this.m_threshold<=g},v.ShouldCreateTriad=function(g,v,S){return(g<this.m_threshold||v<this.m_threshold||S<this.m_threshold)&&(this.m_threshold<=g||this.m_threshold<=v||this.m_threshold<=S)},e}(rj),rK=function(S){function i(v,O){var X;return void 0===O&&(O=v.length),(X=S.call(this,g.b2ShapeType.e_unknown,0)||this).m_shapeCount=0,X.m_shapes=v,X.m_shapeCount=O,X}s(i,S);var O=i.prototype;return O.Clone=function(){throw new Error},O.GetChildCount=function(){return 1},O.TestPoint=function(g,v){for(var S=0;S<this.m_shapeCount;S++)if(this.m_shapes[S].TestPoint(g,v))return!0;return!1},O.ComputeDistance=function(){return 0},O.RayCast=function(){return!1},O.ComputeAABB=function(g,S){var O=new e$;g.lowerBound.x=+v,g.lowerBound.y=+v,g.upperBound.x=-v,g.upperBound.y=-v;for(var X=0;X<this.m_shapeCount;X++)for(var Y=this.m_shapes[X].GetChildCount(),te=0;te<Y;te++){var ti=O;this.m_shapes[X].ComputeAABB(ti,S,te),g.Combine1(ti)}},O.ComputeMass=function(){},O.SetupDistanceProxy=function(){},O.ComputeSubmergedArea=function(){return 0},O.Dump=function(){},i}(nl),rJ=function(v){function i(g){var S;return(S=v.call(this)||this).m_flagsBuffer=g,S}return s(i,v),i.prototype.IsNecessary=function(v){return 0!=(this.m_flagsBuffer.data[v]&g.b2ParticleFlag.b2_reactiveParticle)},i}(rj),rZ=function(v){function i(g,S){var O;return void 0===S&&(S=null),(O=v.call(this,g)||this).m_contactFilter=null,O.m_contactFilter=S,O}s(i,v);var S=i.prototype;return S.ShouldCollideFixtureParticle=function(v,S,O){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[O]&g.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(v,this.m_system,O)},S.ReportFixtureAndParticle=function(v,S,O){var X=i.ReportFixtureAndParticle_s_n,Y=i.ReportFixtureAndParticle_s_rp,te=this.m_system.m_positionBuffer.data[O],ti=X,tr=v.ComputeDistance(te,ti,S);if(tr<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(v,this.m_system,O)){var ta=v.GetBody(),th=ta.GetWorldCenter(),tu=ta.GetMass(),tl=ta.GetInertia()-tu*ta.GetLocalCenter().LengthSquared(),tc=tu>0?1/tu:0,t_=tl>0?1/tl:0,tf=this.m_system.m_flagsBuffer.data[O]&g.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),tp=t8.SubVV(te,th,Y),tm=t8.CrossVV(tp,ti),tg=tf+tc+t_*tm*tm,tv=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];tv.index=O,tv.body=ta,tv.fixture=v,tv.weight=1-tr*this.m_system.m_inverseDiameter,tv.normal.Copy(ti.SelfNeg()),tv.mass=tg>0?1/tg:0,this.m_system.DetectStuckParticle(O)}},i}(rL);rZ.ReportFixtureAndParticle_s_n=new t8,rZ.ReportFixtureAndParticle_s_rp=new t8;var rQ=function(v){function i(g,S){var O;return(O=v.call(this,g)||this).m_step=S,O}s(i,v);var S=i.prototype;return S.ReportFixtureAndParticle=function(v,S,O){var X=i.ReportFixtureAndParticle_s_p1,Y=i.ReportFixtureAndParticle_s_output,te=i.ReportFixtureAndParticle_s_input,ti=i.ReportFixtureAndParticle_s_p,tr=i.ReportFixtureAndParticle_s_v,th=i.ReportFixtureAndParticle_s_f,tu=v.GetBody(),tl=this.m_system.m_positionBuffer.data[O],tc=this.m_system.m_velocityBuffer.data[O],t_=Y,tf=te;if(0===this.m_system.m_iterationIndex){var tp=er.MulTXV(tu.m_xf0,tl,X);v.GetShape().GetType()===g.b2ShapeType.e_circleShape&&(tp.SelfSub(tu.GetLocalCenter()),en.MulRV(tu.m_xf0.q,tp,tp),en.MulTRV(tu.m_xf.q,tp,tp),tp.SelfAdd(tu.GetLocalCenter())),er.MulXV(tu.m_xf,tp,tf.p1)}else tf.p1.Copy(tl);if(t8.AddVMulSV(tl,this.m_step.dt,tc,tf.p2),tf.maxFraction=1,v.RayCast(t_,tf,S)){var tm=t_.normal,tg=ti;tg.x=(1-t_.fraction)*tf.p1.x+t_.fraction*tf.p2.x+ta*tm.x,tg.y=(1-t_.fraction)*tf.p1.y+t_.fraction*tf.p2.y+ta*tm.y;var tv=tr;tv.x=this.m_step.inv_dt*(tg.x-tl.x),tv.y=this.m_step.inv_dt*(tg.y-tl.y),this.m_system.m_velocityBuffer.data[O].Copy(tv);var ty=th;ty.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(tc.x-tv.x),ty.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(tc.y-tv.y),this.m_system.ParticleApplyForce(O,ty)}},S.ReportParticle=function(){return!1},i}(rL);rQ.ReportFixtureAndParticle_s_p1=new t8,rQ.ReportFixtureAndParticle_s_output=new eQ,rQ.ReportFixtureAndParticle_s_input=new eZ,rQ.ReportFixtureAndParticle_s_p=new t8,rQ.ReportFixtureAndParticle_s_v=new t8,rQ.ReportFixtureAndParticle_s_f=new t8;var r0=function(){function e(g){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new rd,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new t8,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new rp,this.m_island=new rw,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(g)}var O=e.prototype;return O.SetDestructionListener=function(g){this.m_destructionListener=g},O.SetContactFilter=function(g){this.m_contactManager.m_contactFilter=g},O.SetContactListener=function(g){this.m_contactManager.m_contactListener=g},O.SetDebugDraw=function(g){this.m_debugDraw=g},O.CreateBody=function(g){if(void 0===g&&(g={}),this.IsLocked())throw new Error;var v=new nE(g,this);return v.m_prev=null,v.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=v),this.m_bodyList=v,++this.m_bodyCount,v},O.DestroyBody=function(g){if(this.IsLocked())throw new Error;for(var v=g.m_jointList;v;){var S=v;v=v.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(S.joint),this.DestroyJoint(S.joint),g.m_jointList=v}g.m_jointList=null;for(var O=g.m_controllerList;O;){var X=O;O=O.nextController,X.controller.RemoveBody(g)}for(var Y=g.m_contactList;Y;){var te=Y;Y=Y.next,this.m_contactManager.Destroy(te.contact)}g.m_contactList=null;for(var ti=g.m_fixtureList;ti;){var tr=ti;ti=ti.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(tr),tr.DestroyProxies(),tr.Reset(),g.m_fixtureList=ti,g.m_fixtureCount-=1}g.m_fixtureList=null,g.m_fixtureCount=0,g.m_prev&&(g.m_prev.m_next=g.m_next),g.m_next&&(g.m_next.m_prev=g.m_prev),g===this.m_bodyList&&(this.m_bodyList=g.m_next),--this.m_bodyCount},e._Joint_Create=function(v){switch(v.type){case g.b2JointType.e_distanceJoint:return new nw(v);case g.b2JointType.e_mouseJoint:return new nG(v);case g.b2JointType.e_prismaticJoint:return new nU(v);case g.b2JointType.e_revoluteJoint:return new nq(v);case g.b2JointType.e_pulleyJoint:return new nW(v);case g.b2JointType.e_gearJoint:return new nO(v);case g.b2JointType.e_wheelJoint:return new n0(v);case g.b2JointType.e_weldJoint:return new nZ(v);case g.b2JointType.e_frictionJoint:return new nD(v);case g.b2JointType.e_ropeJoint:return new nK(v);case g.b2JointType.e_motorJoint:return new nF(v);case g.b2JointType.e_areaJoint:return new nB(v)}throw new Error},e._Joint_Destroy=function(){},O.CreateJoint=function(g){if(this.IsLocked())throw new Error;var v=e._Joint_Create(g);v.m_prev=null,v.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=v),this.m_jointList=v,++this.m_jointCount,v.m_edgeA.prev=null,v.m_edgeA.next=v.m_bodyA.m_jointList,v.m_bodyA.m_jointList&&(v.m_bodyA.m_jointList.prev=v.m_edgeA),v.m_bodyA.m_jointList=v.m_edgeA,v.m_edgeB.prev=null,v.m_edgeB.next=v.m_bodyB.m_jointList,v.m_bodyB.m_jointList&&(v.m_bodyB.m_jointList.prev=v.m_edgeB),v.m_bodyB.m_jointList=v.m_edgeB;var S=v.m_bodyA,O=v.m_bodyB;if(!v.m_collideConnected)for(var X=O.GetContactList();X;)X.other===S&&X.contact.FlagForFiltering(),X=X.next;return v},O.DestroyJoint=function(g){if(this.IsLocked())throw new Error;g.m_prev&&(g.m_prev.m_next=g.m_next),g.m_next&&(g.m_next.m_prev=g.m_prev),g===this.m_jointList&&(this.m_jointList=g.m_next);var v=g.m_bodyA,S=g.m_bodyB,O=g.m_collideConnected;if(v.SetAwake(!0),S.SetAwake(!0),g.m_edgeA.prev&&(g.m_edgeA.prev.next=g.m_edgeA.next),g.m_edgeA.next&&(g.m_edgeA.next.prev=g.m_edgeA.prev),g.m_edgeA===v.m_jointList&&(v.m_jointList=g.m_edgeA.next),g.m_edgeA.Reset(),g.m_edgeB.prev&&(g.m_edgeB.prev.next=g.m_edgeB.next),g.m_edgeB.next&&(g.m_edgeB.next.prev=g.m_edgeB.prev),g.m_edgeB===S.m_jointList&&(S.m_jointList=g.m_edgeB.next),g.m_edgeB.Reset(),e._Joint_Destroy(g),--this.m_jointCount,!O)for(var X=S.GetContactList();X;)X.other===v&&X.contact.FlagForFiltering(),X=X.next},O.CreateParticleSystem=function(g){if(this.IsLocked())throw new Error;var v=new rG(g,this);return v.m_prev=null,v.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=v),this.m_particleSystemList=v,v},O.DestroyParticleSystem=function(g){if(this.IsLocked())throw new Error;g.m_prev&&(g.m_prev.m_next=g.m_next),g.m_next&&(g.m_next.m_prev=g.m_prev),g===this.m_particleSystemList&&(this.m_particleSystemList=g.m_next)},O.CalculateReasonableParticleIterations=function(g){if(null===this.m_particleSystemList)return 1;function e(g){for(var S=v,O=g.GetParticleSystemList();null!==O;O=O.m_next)S=rt(S,O.GetRadius());return S}return Pr(this.m_gravity.Length(),e(this),g)},O.Step=function(g,v,S,O){void 0===O&&(O=this.CalculateReasonableParticleIterations(g));var X=e.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var Y=e.Step_s_step;Y.dt=g,Y.velocityIterations=v,Y.positionIterations=S,Y.particleIterations=O,Y.inv_dt=g>0?1/g:0,Y.dtRatio=this.m_inv_dt0*g,Y.warmStarting=this.m_warmStarting;var te=e.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=te.GetMilliseconds(),this.m_stepComplete&&Y.dt>0){for(var ti=e.Step_s_timer.Reset(),tr=this.m_particleSystemList;tr;tr=tr.m_next)tr.Solve(Y);this.Solve(Y),this.m_profile.solve=ti.GetMilliseconds()}if(this.m_continuousPhysics&&Y.dt>0){var ta=e.Step_s_timer.Reset();this.SolveTOI(Y),this.m_profile.solveTOI=ta.GetMilliseconds()}Y.dt>0&&(this.m_inv_dt0=Y.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=X.GetMilliseconds()},O.ClearForces=function(){for(var g=this.m_bodyList;g;g=g.m_next)g.m_force.SetZero(),g.m_torque=0},O.DrawParticleSystem=function(g){if(null!==this.m_debugDraw){var v=g.GetParticleCount();if(v){var S=g.GetRadius(),O=g.GetPositionBuffer();if(g.m_colorBuffer.data){var X=g.GetColorBuffer();this.m_debugDraw.DrawParticles(O,S,X,v)}else this.m_debugDraw.DrawParticles(O,S,null,v)}}},O.DrawDebugData=function(){if(null!==this.m_debugDraw){var v=this.m_debugDraw.GetFlags(),S=e.DrawDebugData_s_color.SetRGB(0,0,0);if(v&g.b2DrawFlags.e_shapeBit)for(var O=this.m_bodyList;O;O=O.m_next){var X=O.m_xf;this.m_debugDraw.PushTransform(X);for(var Y=O.GetFixtureList();Y;Y=Y.m_next)O.IsActive()?O.GetType()===g.b2BodyType.b2_staticBody?(S.SetRGB(.5,.9,.5),this.DrawShape(Y,S)):O.GetType()===g.b2BodyType.b2_kinematicBody?(S.SetRGB(.5,.5,.9),this.DrawShape(Y,S)):O.IsAwake()?(S.SetRGB(.9,.7,.7),this.DrawShape(Y,S)):(S.SetRGB(.6,.6,.6),this.DrawShape(Y,S)):(S.SetRGB(.5,.5,.3),this.DrawShape(Y,S));this.m_debugDraw.PopTransform(X)}if(v&g.b2DrawFlags.e_particleBit)for(var te=this.m_particleSystemList;te;te=te.m_next)this.DrawParticleSystem(te);if(v&g.b2DrawFlags.e_jointBit)for(var ti=this.m_jointList;ti;ti=ti.m_next)this.DrawJoint(ti);if(v&g.b2DrawFlags.e_aabbBit){S.SetRGB(.9,.3,.9);for(var tr=e.DrawDebugData_s_vs,ta=this.m_bodyList;ta;ta=ta.m_next)if(ta.IsActive())for(var th=ta.GetFixtureList();th;th=th.m_next)for(var tu=0;tu<th.m_proxyCount;++tu){var tl=th.m_proxies[tu].treeNode.aabb;tr[0].Set(tl.lowerBound.x,tl.lowerBound.y),tr[1].Set(tl.upperBound.x,tl.lowerBound.y),tr[2].Set(tl.upperBound.x,tl.upperBound.y),tr[3].Set(tl.lowerBound.x,tl.upperBound.y),this.m_debugDraw.DrawPolygon(tr,4,S)}}if(v&g.b2DrawFlags.e_centerOfMassBit)for(var tc=this.m_bodyList;tc;tc=tc.m_next){var t_=e.DrawDebugData_s_xf;t_.q.Copy(tc.m_xf.q),t_.p.Copy(tc.GetWorldCenter()),this.m_debugDraw.DrawTransform(t_)}if(v&g.b2DrawFlags.e_controllerBit)for(var tf=this.m_controllerList;tf;tf=tf.m_next)tf.Draw(this.m_debugDraw)}},O.QueryAABB=function(g,v){_instanceof(arguments.length<=0?void 0:g,r_)?this._QueryAABB(arguments.length<=0?void 0:g,arguments.length<=1?void 0:v):this._QueryAABB(null,arguments.length<=0?void 0:g,arguments.length<=1?void 0:v)},O._QueryAABB=function(g,v,S){if(this.m_contactManager.m_broadPhase.Query(v,function(v){var O=v.userData.fixture;return g?g.ReportFixture(O):!S||S(O)}),_instanceof(g,r_))for(var O=this.m_particleSystemList;O;O=O.m_next)g.ShouldQueryParticleSystem(O)&&O.QueryAABB(g,v)},O.QueryAllAABB=function(g,v){return void 0===v&&(v=[]),this.QueryAABB(g,function(g){return v.push(g),!0}),v},O.QueryPointAABB=function(g,v){_instanceof(arguments.length<=0?void 0:g,r_)?this._QueryPointAABB(arguments.length<=0?void 0:g,arguments.length<=1?void 0:v):this._QueryPointAABB(null,arguments.length<=0?void 0:g,arguments.length<=1?void 0:v)},O._QueryPointAABB=function(g,v,S){if(this.m_contactManager.m_broadPhase.QueryPoint(v,function(v){var O=v.userData.fixture;return g?g.ReportFixture(O):!S||S(O)}),_instanceof(g,r_))for(var O=this.m_particleSystemList;O;O=O.m_next)g.ShouldQueryParticleSystem(O)&&O.QueryPointAABB(g,v)},O.QueryAllPointAABB=function(g,v){return void 0===v&&(v=[]),this.QueryPointAABB(g,function(g){return v.push(g),!0}),v},O.QueryFixtureShape=function(g,v,S,O){_instanceof(arguments.length<=0?void 0:g,r_)?this._QueryFixtureShape(arguments.length<=0?void 0:g,arguments.length<=1?void 0:v,arguments.length<=2?void 0:S,arguments.length<=3?void 0:O):this._QueryFixtureShape(null,arguments.length<=0?void 0:g,arguments.length<=1?void 0:v,arguments.length<=2?void 0:S,arguments.length<=3?void 0:O)},O._QueryFixtureShape=function(g,v,S,O,X){var Y=e.QueryFixtureShape_s_aabb;if(v.ComputeAABB(Y,O,S),this.m_contactManager.m_broadPhase.Query(Y,function(Y){var te=Y.userData,ti=te.fixture;if(Pe(v,S,ti.GetShape(),te.childIndex,O,ti.GetBody().GetTransform())){if(g)return g.ReportFixture(ti);if(X)return X(ti)}return!0}),_instanceof(g,r_))for(var te=this.m_particleSystemList;te;te=te.m_next)g.ShouldQueryParticleSystem(te)&&te.QueryAABB(g,Y)},O.QueryAllFixtureShape=function(g,v,S,O){return void 0===O&&(O=[]),this.QueryFixtureShape(g,v,S,function(g){return O.push(g),!0}),O},O.QueryFixturePoint=function(g,v){_instanceof(arguments.length<=0?void 0:g,r_)?this._QueryFixturePoint(arguments.length<=0?void 0:g,arguments.length<=1?void 0:v):this._QueryFixturePoint(null,arguments.length<=0?void 0:g,arguments.length<=1?void 0:v)},O._QueryFixturePoint=function(g,v,S){if(this.m_contactManager.m_broadPhase.QueryPoint(v,function(O){var X=O.userData.fixture;if(X.TestPoint(v)){if(g)return g.ReportFixture(X);if(S)return S(X)}return!0}),g)for(var O=this.m_particleSystemList;O;O=O.m_next)g.ShouldQueryParticleSystem(O)&&O.QueryPointAABB(g,v)},O.QueryAllFixturePoint=function(g,v){return void 0===v&&(v=[]),this.QueryFixturePoint(g,function(g){return v.push(g),!0}),v},O.RayCast=function(g,v,S){_instanceof(arguments.length<=0?void 0:g,rf)?this._RayCast(arguments.length<=0?void 0:g,arguments.length<=1?void 0:v,arguments.length<=2?void 0:S):this._RayCast(null,arguments.length<=0?void 0:g,arguments.length<=1?void 0:v,arguments.length<=2?void 0:S)},O._RayCast=function(g,v,S,O){var X=e.RayCast_s_input;if(X.maxFraction=1,X.p1.Copy(v),X.p2.Copy(S),this.m_contactManager.m_broadPhase.RayCast(X,function(X,Y){var te=Y.userData,ti=te.fixture,tr=te.childIndex,ta=e.RayCast_s_output;if(ti.RayCast(ta,X,tr)){var th=ta.fraction,tu=e.RayCast_s_point;if(tu.Set((1-th)*v.x+th*S.x,(1-th)*v.y+th*S.y),g)return g.ReportFixture(ti,tu,ta.normal,th);if(O)return O(ti,tu,ta.normal,th)}return X.maxFraction}),g)for(var Y=this.m_particleSystemList;Y;Y=Y.m_next)g.ShouldQueryParticleSystem(Y)&&Y.RayCast(g,v,S)},O.RayCastOne=function(g,v){var S=null,O=1;return this.RayCast(g,v,function(g,v,X,Y){return Y<O&&(O=Y,S=g),O}),S},O.RayCastAll=function(g,v,S){return void 0===S&&(S=[]),this.RayCast(g,v,function(g){return S.push(g),1}),S},O.GetBodyList=function(){return this.m_bodyList},O.GetJointList=function(){return this.m_jointList},O.GetParticleSystemList=function(){return this.m_particleSystemList},O.GetContactList=function(){return this.m_contactManager.m_contactList},O.SetAllowSleeping=function(g){if(g!==this.m_allowSleep&&(this.m_allowSleep=g,!this.m_allowSleep))for(var v=this.m_bodyList;v;v=v.m_next)v.SetAwake(!0)},O.GetAllowSleeping=function(){return this.m_allowSleep},O.SetWarmStarting=function(g){this.m_warmStarting=g},O.GetWarmStarting=function(){return this.m_warmStarting},O.SetContinuousPhysics=function(g){this.m_continuousPhysics=g},O.GetContinuousPhysics=function(){return this.m_continuousPhysics},O.SetSubStepping=function(g){this.m_subStepping=g},O.GetSubStepping=function(){return this.m_subStepping},O.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},O.GetBodyCount=function(){return this.m_bodyCount},O.GetJointCount=function(){return this.m_jointCount},O.GetContactCount=function(){return this.m_contactManager.m_contactCount},O.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},O.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},O.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},O.SetGravity=function(g,v){if(void 0===v&&(v=!0),!t8.IsEqualToV(this.m_gravity,g)&&(this.m_gravity.Copy(g),v))for(var S=this.m_bodyList;S;S=S.m_next)S.SetAwake(!0)},O.GetGravity=function(){return this.m_gravity},O.IsLocked=function(){return this.m_locked},O.SetAutoClearForces=function(g){this.m_clearForces=g},O.GetAutoClearForces=function(){return this.m_clearForces},O.ShiftOrigin=function(g){if(this.IsLocked())throw new Error;for(var v=this.m_bodyList;v;v=v.m_next)v.m_xf.p.SelfSub(g),v.m_sweep.c0.SelfSub(g),v.m_sweep.c.SelfSub(g);for(var S=this.m_jointList;S;S=S.m_next)S.ShiftOrigin(g);this.m_contactManager.m_broadPhase.ShiftOrigin(g)},O.GetContactManager=function(){return this.m_contactManager},O.GetProfile=function(){return this.m_profile},O.Dump=function(v){if(!this.m_locked){v("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),v("this.m_world.SetGravity(g);\n"),v("const bodies: b2Body[] = [];\n"),v("const joints: b2Joint[] = [];\n");for(var S=0,O=this.m_bodyList;O;O=O.m_next)O.m_islandIndex=S,O.Dump(v),++S;S=0;for(var X=this.m_jointList;X;X=X.m_next)X.m_index=S,++S;for(var Y=this.m_jointList;Y;Y=Y.m_next)Y.m_type!==g.b2JointType.e_gearJoint&&(v("{\n"),Y.Dump(v),v("}\n"));for(var te=this.m_jointList;te;te=te.m_next)te.m_type===g.b2JointType.e_gearJoint&&(v("{\n"),te.Dump(v),v("}\n"))}},O.DrawJoint=function(v){if(null!==this.m_debugDraw){var S=v.GetBodyA(),O=v.GetBodyB(),X=S.m_xf,Y=O.m_xf,te=X.p,ti=Y.p,tr=v.GetAnchorA(e.DrawJoint_s_p1),ta=v.GetAnchorB(e.DrawJoint_s_p2),th=e.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(v.m_type){case g.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(tr,ta,th);break;case g.b2JointType.e_pulleyJoint:var tu=v,tl=tu.GetGroundAnchorA(),tc=tu.GetGroundAnchorB();this.m_debugDraw.DrawSegment(tl,tr,th),this.m_debugDraw.DrawSegment(tc,ta,th),this.m_debugDraw.DrawSegment(tl,tc,th);break;case g.b2JointType.e_mouseJoint:var t_=e.DrawJoint_s_c;t_.Set(0,1,0),this.m_debugDraw.DrawPoint(tr,4,t_),this.m_debugDraw.DrawPoint(ta,4,t_),t_.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(tr,ta,t_);break;default:this.m_debugDraw.DrawSegment(te,tr,th),this.m_debugDraw.DrawSegment(tr,ta,th),this.m_debugDraw.DrawSegment(ti,ta,th)}}},O.DrawShape=function(v,S){if(null!==this.m_debugDraw){var O=v.GetShape();switch(O.m_type){case g.b2ShapeType.e_circleShape:var X=O,Y=X.m_p,te=X.m_radius,ti=t8.UNITX;this.m_debugDraw.DrawSolidCircle(Y,te,ti,S);break;case g.b2ShapeType.e_edgeShape:var tr=O,ta=tr.m_vertex1,th=tr.m_vertex2;this.m_debugDraw.DrawSegment(ta,th,S);break;case g.b2ShapeType.e_chainShape:var tu=O,tl=tu.m_count,tc=tu.m_vertices,t_=e.DrawShape_s_ghostColor.SetRGBA(.75*S.r,.75*S.g,.75*S.b,S.a),tf=tc[0];if(this.m_debugDraw.DrawPoint(tf,4,S),tu.m_hasPrevVertex){var tp=tu.m_prevVertex;this.m_debugDraw.DrawSegment(tp,tf,t_),this.m_debugDraw.DrawCircle(tp,.1,t_)}for(var tm=1;tm<tl;++tm){var tg=tc[tm];this.m_debugDraw.DrawSegment(tf,tg,S),this.m_debugDraw.DrawPoint(tg,4,S),tf=tg}if(tu.m_hasNextVertex){var tv=tu.m_nextVertex;this.m_debugDraw.DrawSegment(tv,tf,t_),this.m_debugDraw.DrawCircle(tv,.1,t_)}break;case g.b2ShapeType.e_polygonShape:var ty=O,tS=ty.m_count,tA=ty.m_vertices;this.m_debugDraw.DrawSolidPolygon(tA,tS,S)}}},O.Solve=function(v){for(var S=this.m_bodyList;S;S=S.m_next)S.m_xf0.Copy(S.m_xf);for(var O=this.m_controllerList;O;O=O.m_next)O.Step(v);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var X=this.m_island;X.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var Y=this.m_bodyList;Y;Y=Y.m_next)Y.m_islandFlag=!1;for(var te=this.m_contactManager.m_contactList;te;te=te.m_next)te.m_islandFlag=!1;for(var ti=this.m_jointList;ti;ti=ti.m_next)ti.m_islandFlag=!1;for(var tr=this.s_stack,ta=this.m_bodyList;ta;ta=ta.m_next)if(!ta.m_islandFlag&&ta.IsAwake()&&ta.IsActive()&&ta.GetType()!==g.b2BodyType.b2_staticBody){X.Clear();var th=0;for(tr[th++]=ta,ta.m_islandFlag=!0;th>0;){var tu=tr[--th];if(!tu)throw new Error;if(X.AddBody(tu),tu.m_awakeFlag=!0,tu.GetType()!==g.b2BodyType.b2_staticBody){for(var tl=tu.m_contactList;tl;tl=tl.next){var tc=tl.contact;if(!tc.m_islandFlag&&tc.IsEnabled()&&tc.IsTouching()){var t_=tc.m_fixtureA.m_isSensor,tf=tc.m_fixtureB.m_isSensor;if(!t_&&!tf){X.AddContact(tc),tc.m_islandFlag=!0;var tp=tl.other;tp.m_islandFlag||(tr[th++]=tp,tp.m_islandFlag=!0)}}}for(var tm=tu.m_jointList;tm;tm=tm.next)if(!tm.joint.m_islandFlag){var tg=tm.other;tg.IsActive()&&(X.AddJoint(tm.joint),tm.joint.m_islandFlag=!0,tg.m_islandFlag||(tr[th++]=tg,tg.m_islandFlag=!0))}}}var tv=new rp;X.Solve(tv,v,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=tv.solveInit,this.m_profile.solveVelocity+=tv.solveVelocity,this.m_profile.solvePosition+=tv.solvePosition;for(var ty=0;ty<X.m_bodyCount;++ty){var tS=X.m_bodies[ty];tS.GetType()===g.b2BodyType.b2_staticBody&&(tS.m_islandFlag=!1)}}for(var tA=0;tA<tr.length&&tr[tA];++tA)tr[tA]=null;for(var tT=new ec,tE=this.m_bodyList;tE;tE=tE.m_next)tE.m_islandFlag&&tE.GetType()!==g.b2BodyType.b2_staticBody&&tE.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=tT.GetMilliseconds()},O.SolveTOI=function(v){var O=this.m_island;if(O.Initialize(2*tc,tc,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var X=this.m_bodyList;X;X=X.m_next)X.m_islandFlag=!1,X.m_sweep.alpha0=0;for(var Y=this.m_contactManager.m_contactList;Y;Y=Y.m_next)Y.m_toiFlag=!1,Y.m_islandFlag=!1,Y.m_toiCount=0,Y.m_toi=1}for(;;){for(var te=null,ti=1,tr=this.m_contactManager.m_contactList;tr;tr=tr.m_next)if(tr.IsEnabled()&&!(tr.m_toiCount>tl)){var ta=1;if(tr.m_toiFlag)ta=tr.m_toi;else{var th=tr.GetFixtureA(),tu=tr.GetFixtureB();if(th.IsSensor()||tu.IsSensor())continue;var t_=th.GetBody(),tf=tu.GetBody(),tp=t_.m_type,tm=tf.m_type,tg=t_.IsAwake()&&tp!==g.b2BodyType.b2_staticBody,tv=tf.IsAwake()&&tm!==g.b2BodyType.b2_staticBody;if(!tg&&!tv)continue;var ty=t_.IsBullet()||tp!==g.b2BodyType.b2_dynamicBody,tS=tf.IsBullet()||tm!==g.b2BodyType.b2_dynamicBody;if(!ty&&!tS)continue;var tA=t_.m_sweep.alpha0;t_.m_sweep.alpha0<tf.m_sweep.alpha0?(tA=tf.m_sweep.alpha0,t_.m_sweep.Advance(tA)):tf.m_sweep.alpha0<t_.m_sweep.alpha0&&(tA=t_.m_sweep.alpha0,tf.m_sweep.Advance(tA));var tT=tr.GetChildIndexA(),tE=tr.GetChildIndexB(),tC=e.SolveTOI_s_toi_input;tC.proxyA.SetShape(th.GetShape(),tT),tC.proxyB.SetShape(tu.GetShape(),tE),tC.sweepA.Copy(t_.m_sweep),tC.sweepB.Copy(tf.m_sweep),tC.tMax=1;var tx=e.SolveTOI_s_toi_output;ui(tx,tC);var tb=tx.t;ta=tx.state===g.b2TOIOutputState.e_touching?rt(tA+(1-tA)*tb,1):1,tr.m_toi=ta,tr.m_toiFlag=!0}ta<ti&&(te=tr,ti=ta)}if(null===te||1-10*S<ti){this.m_stepComplete=!0;break}var tw=te.GetFixtureA(),tI=te.GetFixtureB(),tB=tw.GetBody(),tP=tI.GetBody(),tD=e.SolveTOI_s_backup1.Copy(tB.m_sweep),tM=e.SolveTOI_s_backup2.Copy(tP.m_sweep);if(tB.Advance(ti),tP.Advance(ti),te.Update(this.m_contactManager.m_contactListener),te.m_toiFlag=!1,++te.m_toiCount,te.IsEnabled()&&te.IsTouching()){tB.SetAwake(!0),tP.SetAwake(!0),O.Clear(),O.AddBody(tB),O.AddBody(tP),O.AddContact(te),tB.m_islandFlag=!0,tP.m_islandFlag=!0,te.m_islandFlag=!0;for(var tO=0;tO<2;++tO){var tk=0===tO?tB:tP;if(tk.m_type===g.b2BodyType.b2_dynamicBody)for(var tG=tk.m_contactList;tG&&O.m_bodyCount!==O.m_bodyCapacity&&O.m_contactCount!==O.m_contactCapacity;tG=tG.next){var tV=tG.contact;if(!tV.m_islandFlag){var tU=tG.other;if(tU.m_type!==g.b2BodyType.b2_dynamicBody||tk.IsBullet()||tU.IsBullet()){var tH=tV.m_fixtureA.m_isSensor,tz=tV.m_fixtureB.m_isSensor;if(!tH&&!tz){var tW=e.SolveTOI_s_backup.Copy(tU.m_sweep);tU.m_islandFlag||tU.Advance(ti),tV.Update(this.m_contactManager.m_contactListener),tV.IsEnabled()&&tV.IsTouching()?(tV.m_islandFlag=!0,O.AddContact(tV),tU.m_islandFlag||(tU.m_islandFlag=!0,tU.m_type!==g.b2BodyType.b2_staticBody&&tU.SetAwake(!0),O.AddBody(tU))):(tU.m_sweep.Copy(tW),tU.SynchronizeTransform())}}}}}var tj=e.SolveTOI_s_subStep;tj.dt=(1-ti)*v.dt,tj.inv_dt=1/tj.dt,tj.dtRatio=1,tj.positionIterations=20,tj.velocityIterations=v.velocityIterations,tj.particleIterations=v.particleIterations,tj.warmStarting=!1,O.SolveTOI(tj,tB.m_islandIndex,tP.m_islandIndex);for(var tq=0;tq<O.m_bodyCount;++tq){var tK=O.m_bodies[tq];if(tK.m_islandFlag=!1,tK.m_type===g.b2BodyType.b2_dynamicBody){tK.SynchronizeFixtures();for(var tZ=tK.m_contactList;tZ;tZ=tZ.next)tZ.contact.m_toiFlag=!1,tZ.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else te.SetEnabled(!1),tB.m_sweep.Copy(tD),tP.m_sweep.Copy(tM),tB.SynchronizeTransform(),tP.SynchronizeTransform()}},O.AddController=function(g){return g.m_next=this.m_controllerList,g.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=g),this.m_controllerList=g,++this.m_controllerCount,g},O.RemoveController=function(g){return g.m_prev&&(g.m_prev.m_next=g.m_next),g.m_next&&(g.m_next.m_prev=g.m_prev),this.m_controllerList===g&&(this.m_controllerList=g.m_next),--this.m_controllerCount,g.m_prev=null,g.m_next=null,g},e}();r0.Step_s_step=new rm,r0.Step_s_stepTimer=new ec,r0.Step_s_timer=new ec,r0.DrawDebugData_s_color=new eh(0,0,0),r0.DrawDebugData_s_vs=t8.MakeArray(4),r0.DrawDebugData_s_xf=new er,r0.QueryFixtureShape_s_aabb=new e$,r0.RayCast_s_input=new eZ,r0.RayCast_s_output=new eQ,r0.RayCast_s_point=new t8,r0.DrawJoint_s_p1=new t8,r0.DrawJoint_s_p2=new t8,r0.DrawJoint_s_color=new eh(.5,.8,.8),r0.DrawJoint_s_c=new eh,r0.DrawShape_s_ghostColor=new eh,r0.SolveTOI_s_subStep=new rm,r0.SolveTOI_s_backup=new ea,r0.SolveTOI_s_backup1=new ea,r0.SolveTOI_s_backup2=new ea,r0.SolveTOI_s_toi_input=new _$Je,r0.SolveTOI_s_toi_output=new Ze;var Ss=function(g,v){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=g,this.body=v},r1=function(){function t1(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}var g=t1.prototype;return g.GetNext=function(){return this.m_next},g.GetPrev=function(){return this.m_prev},g.GetBodyList=function(){return this.m_bodyList},g.AddBody=function(g){var v=new Ss(this,g);v.nextBody=this.m_bodyList,v.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=v),this.m_bodyList=v,++this.m_bodyCount,v.nextController=g.m_controllerList,v.prevController=null,g.m_controllerList&&(g.m_controllerList.prevController=v),g.m_controllerList=v,++g.m_controllerCount},g.RemoveBody=function(g){if(this.m_bodyCount<=0)throw new Error;for(var v=this.m_bodyList;v&&v.body!==g;)v=v.nextBody;if(null===v)throw new Error;v.prevBody&&(v.prevBody.nextBody=v.nextBody),v.nextBody&&(v.nextBody.prevBody=v.prevBody),this.m_bodyList===v&&(this.m_bodyList=v.nextBody),--this.m_bodyCount,v.nextController&&(v.nextController.prevController=v.prevController),v.prevController&&(v.prevController.nextController=v.nextController),g.m_controllerList===v&&(g.m_controllerList=v.nextController),--g.m_controllerCount},g.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},t1}(),r2=function(g){function e(){var v;return(v=g.apply(this,arguments)||this).normal=new t8(0,1),v.offset=0,v.density=0,v.velocity=new t8(0,0),v.linearDrag=0,v.angularDrag=0,v.useDensity=!1,v.useWorldGravity=!0,v.gravity=new t8(0,0),v}s(e,g);var v=e.prototype;return v.Step=function(){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var g=this.m_bodyList;g;g=g.nextBody){var v=g.body;if(v.IsAwake()){for(var O=new t8,X=new t8,Y=0,te=0,ti=v.GetFixtureList();ti;ti=ti.m_next){var tr=new t8,ta=ti.GetShape().ComputeSubmergedArea(this.normal,this.offset,v.GetTransform(),tr);Y+=ta,O.x+=ta*tr.x,O.y+=ta*tr.y;var th=0;te+=ta*(th=this.useDensity?ti.GetDensity():1),X.x+=ta*tr.x*th,X.y+=ta*tr.y*th}if(O.x/=Y,O.y/=Y,X.x/=te,X.y/=te,!(Y<S)){var tu=this.gravity.Clone().SelfNeg();tu.SelfMul(this.density*Y),v.ApplyForce(tu,X);var tl=v.GetLinearVelocityFromWorldPoint(O,new t8);tl.SelfSub(this.velocity),tl.SelfMul(-this.linearDrag*Y),v.ApplyForce(tl,O),v.ApplyTorque(-v.GetInertia()/v.GetMass()*Y*v.GetAngularVelocity()*this.angularDrag)}}}}},v.Draw=function(g){var v=100,S=new t8,O=new t8;S.x=this.normal.x*this.offset+this.normal.y*v,S.y=this.normal.y*this.offset-this.normal.x*v,O.x=this.normal.x*this.offset-this.normal.y*v,O.y=this.normal.y*this.offset+this.normal.x*v;var X=new eh(0,0,.8);g.DrawSegment(S,O,X)},e}(r1),r3=function(g){function e(){var v;return(v=g.apply(this,arguments)||this).A=new t8(0,0),v}s(e,g);var v=e.prototype;return v.Step=function(g){for(var v=t8.MulSV(g.dt,this.A,e.Step_s_dtA),S=this.m_bodyList;S;S=S.nextBody){var O=S.body;O.IsAwake()&&O.SetLinearVelocity(t8.AddVV(O.GetLinearVelocity(),v,t8.s_t0))}},v.Draw=function(){},e}(r1);r3.Step_s_dtA=new t8;var r4=function(g){function e(){var v;return(v=g.apply(this,arguments)||this).F=new t8(0,0),v}s(e,g);var v=e.prototype;return v.Step=function(){for(var g=this.m_bodyList;g;g=g.nextBody){var v=g.body;v.IsAwake()&&v.ApplyForce(this.F,v.GetWorldCenter())}},v.Draw=function(){},e}(r1),r8=function(g){function e(){var v;return(v=g.apply(this,arguments)||this).G=1,v.invSqr=!0,v}s(e,g);var v=e.prototype;return v.Step=function(){if(this.invSqr)for(var g=this.m_bodyList;g;g=g.nextBody)for(var v=g.body,O=v.GetWorldCenter(),X=v.GetMass(),Y=this.m_bodyList;Y&&Y!==g;Y=Y.nextBody){var te=Y.body,ti=te.GetWorldCenter(),tr=te.GetMass(),ta=ti.x-O.x,th=ti.y-O.y,tu=ta*ta+th*th;if(!(tu<S)){var tl=e.Step_s_f.Set(ta,th);tl.SelfMul(this.G/tu/tZ(tu)*X*tr),v.IsAwake()&&v.ApplyForce(tl,O),te.IsAwake()&&te.ApplyForce(tl.SelfMul(-1),ti)}}else for(var tc=this.m_bodyList;tc;tc=tc.nextBody)for(var t_=tc.body,tf=t_.GetWorldCenter(),tp=t_.GetMass(),tm=this.m_bodyList;tm&&tm!==tc;tm=tm.nextBody){var tg=tm.body,tv=tg.GetWorldCenter(),ty=tg.GetMass(),tS=tv.x-tf.x,tA=tv.y-tf.y,tT=tS*tS+tA*tA;if(!(tT<S)){var tE=e.Step_s_f.Set(tS,tA);tE.SelfMul(this.G/tT*tp*ty),t_.IsAwake()&&t_.ApplyForce(tE,tf),tg.IsAwake()&&tg.ApplyForce(tE.SelfMul(-1),tv)}}},v.Draw=function(){},e}(r1);r8.Step_s_f=new t8;var r6=function(g){function e(){var v;return(v=g.apply(this,arguments)||this).T=new t9,v.maxTimestep=0,v}s(e,g);var v=e.prototype;return v.Step=function(g){var v=g.dt;if(!(v<=S)){v>this.maxTimestep&&this.maxTimestep>0&&(v=this.maxTimestep);for(var O=this.m_bodyList;O;O=O.nextBody){var X=O.body;if(X.IsAwake()){var Y=X.GetWorldVector(t9.MulMV(this.T,X.GetLocalVector(X.GetLinearVelocity(),t8.s_t0),t8.s_t1),e.Step_s_damping);X.SetLinearVelocity(t8.AddVV(X.GetLinearVelocity(),t8.MulSV(v,Y,t8.s_t0),t8.s_t1))}}}},v.Draw=function(){},v.SetAxisAligned=function(g,v){this.T.ex.x=-g,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-v,this.maxTimestep=g>0||v>0?1/st(g,v):0},e}(r1);r6.Step_s_damping=new t8;var Rs=function(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new t8(0,0),this.damping=.1,this.k2=.9,this.k3=.1},r7=function(){function t1(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new t8,this.m_damping=0,this.m_k2=1,this.m_k3=.1}var g=t1.prototype;return g.GetVertexCount=function(){return this.m_count},g.GetVertices=function(){return this.m_ps},g.Initialize=function(g){this.m_count=g.count,this.m_ps=t8.MakeArray(this.m_count),this.m_p0s=t8.MakeArray(this.m_count),this.m_vs=t8.MakeArray(this.m_count),this.m_ims=$(this.m_count);for(var v=0;v<this.m_count;++v){this.m_ps[v].Copy(g.vertices[v]),this.m_p0s[v].Copy(g.vertices[v]),this.m_vs[v].SetZero();var S=g.masses[v];this.m_ims[v]=S>0?1/S:0}var O=this.m_count-1,X=this.m_count-2;this.m_Ls=$(O),this.m_as=$(X);for(var Y=0;Y<O;++Y){var te=this.m_ps[Y],ti=this.m_ps[Y+1];this.m_Ls[Y]=t8.DistanceVV(te,ti)}for(var tr=0;tr<X;++tr){var ta=this.m_ps[tr],th=this.m_ps[tr+1],tu=this.m_ps[tr+2],tl=t8.SubVV(th,ta,t8.s_t0),tc=t8.SubVV(tu,th,t8.s_t1),t_=t8.CrossVV(tl,tc),tf=t8.DotVV(tl,tc);this.m_as[tr]=t4(t_,tf)}this.m_gravity.Copy(g.gravity),this.m_damping=g.damping,this.m_k2=g.k2,this.m_k3=g.k3},g.Step=function(g,v){if(0!==g){for(var S=Math.exp(-g*this.m_damping),O=0;O<this.m_count;++O)this.m_p0s[O].Copy(this.m_ps[O]),this.m_ims[O]>0&&this.m_vs[O].SelfMulAdd(g,this.m_gravity),this.m_vs[O].SelfMul(S),this.m_ps[O].SelfMulAdd(g,this.m_vs[O]);for(var X=0;X<v;++X)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var Y=1/g,te=0;te<this.m_count;++te)t8.MulSV(Y,t8.SubVV(this.m_ps[te],this.m_p0s[te],t8.s_t0),this.m_vs[te])}},g.SolveC2=function(){for(var g=this.m_count-1,v=0;v<g;++v){var S=this.m_ps[v],O=this.m_ps[v+1],X=t8.SubVV(O,S,t1.s_d),Y=X.Normalize(),te=this.m_ims[v],ti=this.m_ims[v+1];if(te+ti!==0){var tr=te/(te+ti),ta=ti/(te+ti);S.SelfMulSub(this.m_k2*tr*(this.m_Ls[v]-Y),X),O.SelfMulAdd(this.m_k2*ta*(this.m_Ls[v]-Y),X)}}},g.SetAngle=function(g){for(var v=this.m_count-2,S=0;S<v;++S)this.m_as[S]=g},g.SolveC3=function(){for(var g=this.m_count-2,v=0;v<g;++v){var S=this.m_ps[v],O=this.m_ps[v+1],Y=this.m_ps[v+2],te=this.m_ims[v],ti=this.m_ims[v+1],tr=this.m_ims[v+2],ta=t8.SubVV(O,S,t1.s_d1),th=t8.SubVV(Y,O,t1.s_d2),tu=ta.LengthSquared(),tl=th.LengthSquared();if(tu*tl!=0){var tc=t8.CrossVV(ta,th),t_=t8.DotVV(ta,th),tf=t4(tc,t_),tp=t8.MulSV(-1/tu,ta.SelfSkew(),t1.s_Jd1),tm=t8.MulSV(1/tl,th.SelfSkew(),t1.s_Jd2),tg=t8.NegV(tp,t1.s_J1),tv=t8.SubVV(tp,tm,t1.s_J2),ty=tm,tS=te*t8.DotVV(tg,tg)+ti*t8.DotVV(tv,tv)+tr*t8.DotVV(ty,ty);if(0!==tS){tS=1/tS;for(var tA=tf-this.m_as[v];tA>X;)tA=(tf-=2*X)-this.m_as[v];for(;tA<-X;)tA=(tf+=2*X)-this.m_as[v];var tT=-this.m_k3*tS*tA;S.SelfMulAdd(te*tT,tg),O.SelfMulAdd(ti*tT,tv),Y.SelfMulAdd(tr*tT,ty)}}}},g.Draw=function(g){for(var v=new eh(.4,.5,.7),S=0;S<this.m_count-1;++S)g.DrawSegment(this.m_ps[S],this.m_ps[S+1],v)},t1}();r7.s_d=new t8,r7.s_d1=new t8,r7.s_d2=new t8,r7.s_Jd1=new t8,r7.s_Jd2=new t8,r7.s_J1=new t8,r7.s_J2=new t8,g.b2AABB=e$,g.b2Abs=tq,g.b2Acos=t2,g.b2Alloc=H,g.b2AreaJoint=nB,g.b2AreaJointDef=nI,g.b2Asin=t3,g.b2Assert=e,g.b2Atan2=t4,g.b2BlockAllocator=_$Gt,g.b2Body=nE,g.b2BodyDef=yn,g.b2BroadPhase=e6,g.b2BuoyancyController=r2,g.b2CalculateParticleIterations=Pr,g.b2ChainAndCircleContact=n9,g.b2ChainAndPolygonContact=rr,g.b2ChainShape=nd,g.b2CircleContact=n3,g.b2CircleShape=nc,g.b2Clamp=at,g.b2ClipSegmentToLine=Re,g.b2ClipVertex=eJ,g.b2CollideCircles=_i,g.b2CollideEdgeAndCircle=Ji,g.b2CollideEdgeAndPolygon=rn,g.b2CollidePolygonAndCircle=mi,g.b2CollidePolygons=Vi,g.b2Color=eh,g.b2ConstantAccelController=r3,g.b2ConstantForceController=r4,g.b2Contact=n2,g.b2ContactEdge=n1,g.b2ContactFactory=ra,g.b2ContactFeature=ez,g.b2ContactFilter=rl,g.b2ContactID=eW,g.b2ContactImpulse=cr,g.b2ContactListener=rc,g.b2ContactManager=rd,g.b2ContactPositionConstraint=rC,g.b2ContactRegister=or,g.b2ContactSolver=rb,g.b2ContactSolverDef=br,g.b2ContactVelocityConstraint=rE,g.b2Controller=r1,g.b2ControllerEdge=Ss,g.b2Cos=t$,g.b2Counter=e_,g.b2DegToRad=ft,g.b2DestructionListener=ru,g.b2Distance=ne,g.b2DistanceInput=ey,g.b2DistanceJoint=nw,g.b2DistanceJointDef=nR,g.b2DistanceOutput=eS,g.b2DistanceProxy=em,g.b2Draw=eu,g.b2DynamicTree=e8,g.b2EdgeAndCircleContact=n6,g.b2EdgeAndPolygonContact=n7,g.b2EdgeShape=nf,g.b2Filter=np,g.b2Fixture=ny,g.b2FixtureDef=fn,g.b2FixtureParticleQueryCallback=rL,g.b2FixtureProxy=nm,g.b2Free=z,g.b2FrictionJoint=nD,g.b2FrictionJointDef=nP,g.b2GearJoint=nO,g.b2GearJointDef=nM,g.b2GetPointStates=Ae,g.b2GravityController=r8,g.b2GrowableBuffer=rO,g.b2GrowableStack=ef,g.b2InvSqrt=lt,g.b2IsPowerOfTwo=At,g.b2IsValid=tK,g.b2Island=rw,g.b2Jacobian=nC,g.b2Joint=nb,g.b2JointDef=En,g.b2JointEdge=nx,g.b2Log=W,g.b2MakeArray=Q,g.b2MakeNullArray=Z,g.b2MakeNumberArray=$,g.b2Manifold=eY,g.b2ManifoldPoint=ej,g.b2MassData=an,g.b2Mat22=t9,g.b2Mat33=ee,g.b2Max=st,g.b2Maybe=i,g.b2Min=rt,g.b2MixFriction=Jn,g.b2MixRestitution=Qn,g.b2MotorJoint=nF,g.b2MotorJointDef=nL,g.b2MouseJoint=nG,g.b2MouseJointDef=nk,g.b2NextPowerOfTwo=St,g.b2Pair=Ge,g.b2PairLessThan=Ve,g.b2ParseInt=K,g.b2ParseUInt=J,g.b2ParticleBodyContact=Zr,g.b2ParticleContact=rF,g.b2ParticleDef=Br,g.b2ParticleGroup=rP,g.b2ParticleGroupDef=Mr,g.b2ParticleHandle=rB,g.b2ParticlePair=$r,g.b2ParticlePairSet=rX,g.b2ParticleSystem=rG,g.b2ParticleSystemDef=rk,g.b2ParticleSystem_CompositeShape=rK,g.b2ParticleSystem_ConnectionFilter=rj,g.b2ParticleSystem_DestroyParticlesInShapeCallback=rq,g.b2ParticleSystem_FixedSetAllocator=rz,g.b2ParticleSystem_FixtureParticle=hs,g.b2ParticleSystem_FixtureParticleSet=rW,g.b2ParticleSystem_InsideBoundsEnumerator=rH,g.b2ParticleSystem_JoinParticleGroupsFilter=rY,g.b2ParticleSystem_ParticleListNode=as,g.b2ParticleSystem_ParticlePair=ls,g.b2ParticleSystem_Proxy=rU,g.b2ParticleSystem_ReactiveFilter=rJ,g.b2ParticleSystem_SolveCollisionCallback=rQ,g.b2ParticleSystem_UpdateBodyContactsCallback=rZ,g.b2ParticleSystem_UserOverridableBuffer=rV,g.b2ParticleTriad=ts,g.b2PolygonAndCircleContact=n8,g.b2PolygonContact=n4,g.b2PolygonShape=n_,g.b2Position=rg,g.b2PositionSolverManifold=rx,g.b2Pow=tQ,g.b2PrismaticJoint=nU,g.b2PrismaticJointDef=nV,g.b2Profile=rp,g.b2PulleyJoint=nW,g.b2PulleyJointDef=nz,g.b2QueryCallback=r_,g.b2RadToDeg=dt,g.b2Random=Tt,g.b2RandomRange=Et,g.b2RayCastCallback=rf,g.b2RayCastInput=eZ,g.b2RayCastOutput=eQ,g.b2RevoluteJoint=nq,g.b2RevoluteJointDef=nj,g.b2Rope=r7,g.b2RopeDef=Rs,g.b2RopeJoint=nK,g.b2RopeJointDef=nY,g.b2Rot=en,g.b2SeparationFunction=id,g.b2Shape=nl,g.b2ShapeCast=fe,g.b2ShapeCastInput=_$Wt,g.b2ShapeCastOutput=_$Xt,g.b2Simplex=eE,g.b2SimplexCache=eg,g.b2SimplexVertex=eT,g.b2Sin=t0,g.b2SolverData=Sr,g.b2Sq=ut,g.b2Sqrt=tZ,g.b2StackAllocator=_$kt,g.b2Swap=ot,g.b2Sweep=ea,g.b2TOIInput=_$Je,g.b2TOIOutput=Ze,g.b2TensorDampingController=r6,g.b2TestOverlapAABB=xe,g.b2TestOverlapShape=Pe,g.b2TimeOfImpact=ui,g.b2TimeStep=rm,g.b2Timer=ec,g.b2Transform=er,g.b2TreeNode=e4,g.b2Vec2=t8,g.b2Vec2_zero=t6,g.b2Vec3=t7,g.b2Velocity=rS,g.b2VelocityConstraintPoint=rT,g.b2Version=tG,g.b2WeldJoint=nZ,g.b2WeldJointDef=nJ,g.b2WheelJoint=n0,g.b2WheelJointDef=nQ,g.b2World=r0,g.b2WorldManifold=eK,g.b2_180_over_pi=tW,g.b2_aabbExtension=ti,g.b2_aabbMultiplier=tr,g.b2_angularSleepTolerance=tk,g.b2_angularSlop=th,g.b2_barrierCollisionTime=tD,g.b2_baumgarte=tS,g.b2_branch=tU,g.b2_commit=tH,g.b2_epsilon=S,g.b2_epsilon_sq=O,g.b2_gjk_reset=jt,g.b2_invalidParticleIndex=tT,g.b2_linearSleepTolerance=tO,g.b2_linearSlop=ta,g.b2_maxAngularCorrection=tp,g.b2_maxFloat=v,g.b2_maxLinearCorrection=tf,g.b2_maxManifoldPoints=Y,g.b2_maxParticleForce=tw,g.b2_maxParticleIndex=tE,g.b2_maxParticlePressure=tb,g.b2_maxPolygonVertices=te,g.b2_maxRotation=tv,g.b2_maxRotationSquared=ty,g.b2_maxSubSteps=tl,g.b2_maxTOIContacts=tc,g.b2_maxTranslation=tm,g.b2_maxTranslationSquared=tg,g.b2_maxTriadDistance=tI,g.b2_maxTriadDistanceSquared=tB,g.b2_minParticleSystemBufferCapacity=tP,g.b2_minParticleWeight=tx,g.b2_minPulleyLength=nH,g.b2_particleStride=tC,g.b2_pi=X,g.b2_pi_over_180=tz,g.b2_polygonRadius=tu,g.b2_timeToSleep=tM,g.b2_toiBaumgarte=tA,g.b2_toi_reset=Ue,g.b2_two_pi=tj,g.b2_velocityThreshold=t_,g.b2_version=tV,g.g_blockSolve=rA,Object.defineProperty(g,"__esModule",{value:!0})}((v={exports:{}}).exports),v.exports}();(Ky=KS)&&Ky.__esModule&&Object.prototype.hasOwnProperty.call(Ky,"default")&&Ky.default;var KA={};for(var KT in KS)-1===KT.indexOf("b2_")&&(KA[KT.replace("b2","")]=KS[KT]);var KE=KA,KC=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._contactFixtures=[],v._BeginContact=null,v._EndContact=null,v._PreSolve=null,v._PostSolve=null,v}s(e,g);var v=e.prototype;return v.setBeginContact=function(g){this._BeginContact=g},v.setEndContact=function(g){this._EndContact=g},v.setPreSolve=function(g){this._PreSolve=g},v.setPostSolve=function(g){this._PostSolve=g},v.BeginContact=function(g){if(this._BeginContact){var v=g.GetFixtureA(),S=g.GetFixtureB(),O=this._contactFixtures;g._shouldReport=!1,-1===O.indexOf(v)&&-1===O.indexOf(S)||(g._shouldReport=!0,this._BeginContact(g))}},v.EndContact=function(g){this._EndContact&&g._shouldReport&&(g._shouldReport=!1,this._EndContact(g))},v.PreSolve=function(g,v){this._PreSolve&&g._shouldReport&&this._PreSolve(g,v)},v.PostSolve=function(g,v){this._PostSolve&&g._shouldReport&&this._PostSolve(g,v)},v.registerContactFixture=function(g){this._contactFixtures.push(g)},v.unregisterContactFixture=function(g){Jt(this._contactFixtures,g)},e}(KE.ContactListener),Kb=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._point=new KE.Vec2,v._isPoint=!1,v._fixtures=[],v}s(e,g);var v=e.prototype;return v.init=function(g){g?(this._isPoint=!0,this._point.x=g.x,this._point.y=g.y):this._isPoint=!1,this._fixtures.length=0},v.ReportFixture=function(g){return this._isPoint?g.TestPoint(this._point)&&this._fixtures.push(g):this._fixtures.push(g),!0},v.getFixture=function(){return this._fixtures[0]},v.getFixtures=function(){return this._fixtures},e}(KE.QueryCallback);function Z3(g,v){var S=v.length;return v[g<0?S- -g%S:g%S]}function $3(g,v,S){for(var O=[];v<g;)v+=S.length;for(;g<=v;++g)O.push(Z3(g,S));return O}function t5(g,v,S){if(e5(g,S)){if(r5(Z3(g,S),Z3(g-1,S),Z3(v,S))&&s5(Z3(g,S),Z3(g+1,S),Z3(v,S)))return!1}else if(s5(Z3(g,S),Z3(g+1,S),Z3(v,S))||r5(Z3(g,S),Z3(g-1,S),Z3(v,S)))return!1;if(e5(v,S)){if(r5(Z3(v,S),Z3(v-1,S),Z3(g,S))&&s5(Z3(v,S),Z3(v+1,S),Z3(g,S)))return!1}else if(s5(Z3(v,S),Z3(v+1,S),Z3(g,S))||r5(Z3(v,S),Z3(v-1,S),Z3(g,S)))return!1;for(var O=0;O<S.length;++O)if((O+1)%S.length!=g&&O!=g&&(O+1)%S.length!=v&&O!=v){var X=new e8;if(l5(Z3(g,S),Z3(v,S),Z3(O,S),Z3(O+1,S),X))return!1}return!0}function e5(g,v){return i5(g,v)}function i5(g,v,S){if(void 0===S){var O=g,X=v;g=Z3(O-1,X),v=Z3(O,X),void 0===g&&(g=v),void 0===(S=Z3(O+1,X))&&(S=v)}return c5(g,v,S)<0}function n5(g,v,S){return c5(g,v,S)>0}function r5(g,v,S){return c5(g,v,S)>=0}function s5(g,v,S){return c5(g,v,S)<=0}function a5(g,v){var S=v.x-g.x,O=v.y-g.y;return S*S+O*O}function o5(g){h5(g)||g.reverse()}function h5(g){return g.length<3||function(g){var v,S=0;for(v=0;v<g.length;v++){var O=(v+1)%g.length;S+=g[v].x*g[O].y,S-=g[v].y*g[O].x}return S/2}(g)>0}function u5(g,v,S,O){var X,Y=new e8,te=v.y-g.y,ti=g.x-v.x,tr=te*g.x+ti*g.y,ta=O.y-S.y,th=S.x-O.x,tu=ta*S.x+th*S.y,tl=te*th-ta*ti;return X=tl,Math.abs(X-0)<=1e-6||(Y.x=(th*tr-ti*tu)/tl,Y.y=(te*tu-ta*tr)/tl),Y}function l5(g,v,S,O,X){if(g==S||g==O||v==S||v==O)return!1;var Y=g.x,te=g.y,ti=v.x,tr=v.y,ta=S.x,th=S.y,tu=O.x,tl=O.y;if(Math.max(Y,ti)<Math.min(ta,tu)||Math.max(ta,tu)<Math.min(Y,ti))return!1;if(Math.max(te,tr)<Math.min(th,tl)||Math.max(th,tl)<Math.min(te,tr))return!1;var tc=(tu-ta)*(te-th)-(tl-th)*(Y-ta),t_=(ti-Y)*(te-th)-(tr-te)*(Y-ta),tf=(tl-th)*(ti-Y)-(tu-ta)*(tr-te);return!(Math.abs(tf)<1e-6)&&(t_/=tf,(tc/=tf)>0&&tc<1&&t_>0&&t_<1&&(X.x=Y+tc*(ti-Y),X.y=te+tc*(tr-te),!0))}function c5(g,v,S){return g.x*(v.y-S.y)+v.x*(S.y-g.y)+S.x*(g.y-v.y)}var KR=Object.freeze({__proto__:null,ConvexPartition:function t1(g){o5(g);for(var v,S,O,X,Y,te,ti=[],tr=new e8,ta=new e8,th=0,tu=0,tl=0;tl<g.length;++tl)if(e5(tl,g)){S=O=1e8;for(var tc=0;tc<g.length;++tc)n5(Z3(tl-1,g),Z3(tl,g),Z3(tc,g))&&s5(Z3(tl-1,g),Z3(tl,g),Z3(tc-1,g))&&(X=u5(Z3(tl-1,g),Z3(tl,g),Z3(tc,g),Z3(tc-1,g)),i5(Z3(tl+1,g),Z3(tl,g),X)&&(v=a5(Z3(tl,g),X))<S&&(S=v,tr=X,th=tc)),n5(Z3(tl+1,g),Z3(tl,g),Z3(tc+1,g))&&s5(Z3(tl+1,g),Z3(tl,g),Z3(tc,g))&&(X=u5(Z3(tl+1,g),Z3(tl,g),Z3(tc,g),Z3(tc+1,g)),n5(Z3(tl-1,g),Z3(tl,g),X)&&(v=a5(Z3(tl,g),X))<O&&(O=v,tu=tc,ta=X));if(th==(tu+1)%g.length){var t_=tr.add(ta).multiplyScalar(.5);(Y=$3(tl,tu,g)).push(t_),(te=$3(th,tl,g)).push(t_)}else{for(var tf=0,tp=th;tu<th;)tu+=g.length;for(var tm=th;tm<=tu;++tm)if(t5(tl,tm,g)){var tg=1/(a5(Z3(tl,g),Z3(tm,g))+1);e5(tm,g)?s5(Z3(tm-1,g),Z3(tm,g),Z3(tl,g))&&r5(Z3(tm+1,g),Z3(tm,g),Z3(tl,g))?tg+=3:tg+=2:tg+=1,tg>tf&&(tp=tm,tf=tg)}Y=$3(tl,tp,g),te=$3(tp,tl,g)}return(ti=ti.concat(t1(Y))).concat(t1(te))}ti.push(g);for(var tv=ti.length-1;tv>=0;tv--)0==ti[tv].length&&ti.splice(tv,0);return ti},ForceCounterClockWise:o5,IsCounterClockWise:h5});function f5(g){v5(g);for(var v=!0,S=0,O=g.length;S<O;++S)if(!m5(g[(S+O-1)%O],g[S],g[(S+1)%O])){v=!1;break}if(v)return[g];var X=[],Y=function(g){if(v5(g),g.length<4)return[g];for(var v=g.length,S=[],O=[],X=0;X<v;++X){var Y=new d5;Y.isActive=!0,Y.isConvex=!1,Y.isEar=!1,Y.point=g[X],Y.angleCos=0,Y.shouldUpdate=!0,Y.index=X,S.push(Y)}for(var te=0;te<v;++te){var ti=S[te];ti.prev=S[(te+v-1)%v],ti.next=S[(te+1)%v]}S.forEach(function(g){return y5(g,S)});for(var tr=0;tr<v-3;++tr){for(var ta=void 0,th=0;th<v;++th){var tu=S[th];tu.isActive&&tu.isEar&&(ta?tu.angleCos>ta.angleCos&&(ta=tu):ta=tu)}if(!ta){for(var tl=0;tl<v;++tl){var tc=S[tl];if(tc.isActive){var t_=tc.prev.point,tf=tc.point,tp=tc.next.point;if(Math.abs(p5(t_,tf,tp))>1e-5)return console.log("Failed to find ear. There might be self-intersection in the polygon."),null}}break}if(O.push([ta.prev.point,ta.point,ta.next.point]),ta.isActive=!1,ta.prev.next=ta.next,ta.next.prev=ta.prev,ta.prev.shouldUpdate=!0,ta.next.shouldUpdate=!0,S5(ta.next),tr===v-4)break;for(var tm=0;tm<v;++tm)y5(S[tm],S)}for(var tg=0;tg<v;++tg){var tv=S[tg];if(tv.isActive){tv.prev.isActive=!1,tv.next.isActive=!1;var ty=tv.prev.point,tS=tv.point,tA=tv.next.point;Math.abs(p5(ty,tS,tA))>1e-5&&O.push([ty,tS,tA])}}return O}(g);if(!Y)return null;for(;Y.length;){for(var te=Y.splice(0,1)[0],ti=0,tr=te.length;ti<tr;++ti){for(var ta=te[ti],th=te[(ti+1)%tr],tu=null,tl=0;tl<Y.length;++tl){for(var tc=Y[tl],t_=0;t_<3;++t_){var tf=tc[t_];if(g5(ta,tc[(t_+1)%3])&&g5(th,tf)){tu=tc[(t_+2)%3];break}}if(tu)break}if(tu&&!(p5(te[(ti+tr-1)%tr],ta,tu)>0||p5(tu,th,te[(ti+2)%tr])>0)){for(var tp=[],tm=(ti+1)%tr;tm!==ti;tm=(tm+1)%tr)tp.push(te[tm]);tp.push(ta,tu),te=tp,tr=tp.length,ti=-1,Y.splice(tl,1)}}X.push(te)}return X}var d5=function(){this.isActive=!1,this.isConvex=!1,this.isEar=!1,this.point=null,this.angleCos=0,this.shouldUpdate=!1,this.index=0,this.prev=null,this.next=null};function p5(g,v,S){return(v.y-g.y)*(S.x-v.x)-(v.x-g.x)*(S.y-v.y)}function m5(g,v,S){return p5(g,v,S)<0}function g5(g,v){return g.x===v.x&&g.y===v.y}function v5(g){(function(g){for(var v=0,S=0,O=g.length;S<O;++S){var X=g[S],Y=g[(S+1)%O];v+=(Y.x-X.x)*(Y.y+X.y)}return v>0})(g)&&g.reverse()}function y5(g,v){if(g.shouldUpdate){g.shouldUpdate=!1;var S=g.prev.point,O=g.point,X=g.next.point;g.isConvex=m5(S,O,X);var Y=S.x-O.x,te=S.y-O.y,ti=Math.sqrt(Y*Y+te*te);Y/=ti,te/=ti;var tr=X.x-O.x,ta=X.y-O.y,th=Math.sqrt(tr*tr+ta*ta);if(tr/=th,ta/=th,g.angleCos=Y*tr+te*ta,g.isConvex){g.isEar=!0;for(var tu=0,tl=v.length;tu<tl;++tu){var tc=v[tu];if(tc.isActive&&tc!==g){var t_=tc.point;if(!(g5(S,t_)||g5(O,t_)||g5(X,t_))){var tf=p5(S,t_,O),tp=p5(O,t_,X),tm=p5(X,t_,S);if(tf>0&&tp>0&&tm>0){g.isEar=!1;break}if(0===tf&&tp>=0&&tm>=0&&(p5(S,tc.prev.point,O)>0||p5(S,tc.next.point,O)>0)){g.isEar=!1;break}if(0===tp&&tf>=0&&tm>=0&&(p5(O,tc.prev.point,X)>0||p5(O,tc.next.point,X)>0)){g.isEar=!1;break}if(0===tm&&tf>=0&&tp>=0&&(p5(X,tc.prev.point,S)>0||p5(X,tc.next.point,S)>0)){g.isEar=!1;break}}}}}else g.isEar=!1}}function S5(g){for(var v=g,S=g;;)if(g5(v.point,v.next.point)||0===p5(v.prev.point,v.point,v.next.point)){if(v.prev.next=v.next,v.next.prev=v.prev,v.prev.shouldUpdate=!0,v.next.shouldUpdate=!0,v===v.next)break;S=v.prev,v=v.next}else if((v=v.next)===S)break}var Kw,KI,KB,KP,KD,KM,KO,KL,KG,KV,KU,KH=Object.freeze({__proto__:null,ConvexPartition:f5});!function(g){g[g.DYNAMIC=1]="DYNAMIC",g[g.STATIC=2]="STATIC",g[g.KINEMATIC=4]="KINEMATIC"}(Kw||(Kw={})),re(Kw),function(g){g[g.X_AXIS=0]="X_AXIS",g[g.Y_AXIS=1]="Y_AXIS",g[g.Z_AXIS=2]="Z_AXIS"}(KI||(KI={})),re(KI),function(g){g[g.X=0]="X",g[g.Y=1]="Y",g[g.Z=2]="Z",g[g.SWING1=3]="SWING1",g[g.SWING2=4]="SWING2",g[g.TWIST=5]="TWIST"}(KB||(KB={})),re(KB),function(g){g[g.VERTEX=1]="VERTEX",g[g.LINE=2]="LINE",g[g.TRIANGLE=3]="TRIANGLE",g[g.TETRAHEDRON=4]="TETRAHEDRON"}(KP||(KP={})),re(KP),function(g){g[g.BOX=0]="BOX",g[g.SPHERE=1]="SPHERE",g[g.CAPSULE=2]="CAPSULE",g[g.CYLINDER=3]="CYLINDER",g[g.CONE=4]="CONE",g[g.MESH=5]="MESH",g[g.PLANE=6]="PLANE",g[g.SIMPLEX=7]="SIMPLEX",g[g.TERRAIN=8]="TERRAIN"}(KD||(KD={})),re(KD),function(g){g[g.POINT_TO_POINT=0]="POINT_TO_POINT",g[g.HINGE=1]="HINGE",g[g.FIXED=2]="FIXED",g[g.CONFIGURABLE=3]="CONFIGURABLE"}(KM||(KM={})),re(KM),function(g){g[g.FREE=0]="FREE",g[g.LIMITED=1]="LIMITED",g[g.LOCKED=2]="LOCKED"}(KO||(KO={})),re(KO),function(g){g[g.DISABLED=0]="DISABLED",g[g.SERVO=1]="SERVO",g[g.INDUCTION=2]="INDUCTION"}(KL||(KL={})),re(KL),function(g){g[g.BOX=0]="BOX",g[g.CAPSULE=1]="CAPSULE"}(KG||(KG={})),re(KG),function(g){g[g.DEFAULT=1]="DEFAULT"}(KV||(KV={})),re(KV),function(g){g[g.NONE=0]="NONE",g[g.WIRE_FRAME=1]="WIRE_FRAME",g[g.CONSTRAINT=2]="CONSTRAINT",g[g.AABB=4]="AABB"}(KU||(KU={})),re(KU);var O5=function(g){if(1===g){for(var v=this,i=function(g){var S="_"+(1<<g);v[S]=0,v.updateArray=[],Object.defineProperty(v,1<<g,{get:function(){return this[S]},set:function(v){this[S]!==v&&(this[S]=v,this.updateArray.indexOf(g)<0&&this.updateArray.push(g))}})},S=0;S<32;S++)i(S);this._1=KV.DEFAULT}else{for(var O=0;O<32;O++)this[""+(1<<O)]=0;this[1]=KV.DEFAULT}},Kz=null;X.internal.PhysicsGroup2D=Kn;var KX,Kj,Kq,KY,KK,KJ,K1,K2,K3,K5,K4,K8,K6,K7,K9,Jr,Js,Jo,Jh,Ju,Jl,Jc,J_,Jf,Jp,Jm=g("eH",function(g){function e(){var v,S,O,X,Y;(Y=g.call(this)||this).velocityIterations=10,Y.positionIterations=10,Y.collisionMatrix=new O5,Y._enable=!0,Y._allowSleep=!0,Y._maxSubSteps=1,Y._fixedTimeStep=1/60,Y._autoSimulation=!0,Y._accumulator=0,Y._steping=!1,Y._gravity=new e8(0,-10*Kc),Y._delayEvents=[];var te=tQ.querySettings(tK.Category.PHYSICS,"gravity");te&&(e8.copy(Y._gravity,te),Y._gravity.multiplyScalar(Kc)),Y._allowSleep=null!==(v=tQ.querySettings(tK.Category.PHYSICS,"allowSleep"))&&void 0!==v?v:Y._allowSleep,Y._fixedTimeStep=null!==(S=tQ.querySettings(tK.Category.PHYSICS,"fixedTimeStep"))&&void 0!==S?S:Y._fixedTimeStep,Y._maxSubSteps=null!==(O=tQ.querySettings(tK.Category.PHYSICS,"maxSubSteps"))&&void 0!==O?O:Y._maxSubSteps,Y._autoSimulation=null!==(X=tQ.querySettings(tK.Category.PHYSICS,"autoSimulation"))&&void 0!==X?X:Y._autoSimulation;var ti=tQ.querySettings(tK.Category.PHYSICS,"collisionMatrix");if(ti)for(var tr in ti){var ta=parseInt(tr),th=1<<parseInt(tr);Y.collisionMatrix[""+th]=ti[ta]}var tu=tQ.querySettings(tK.Category.PHYSICS,"collisionGroups");return tu&&_instanceof(tu,Array)&&(tu.forEach(function(g){Kn[g.name]=1<<g.index}),re.update(Kn)),K_.physicsWorld=V3(),Y.gravity=Y._gravity,Y.allowSleep=Y._allowSleep,Y}s(e,g);var v=e.prototype;return v.postUpdate=function(g){if(this._enable&&this._autoSimulation){II.emit(Iw.EVENT_BEFORE_PHYSICS),this.physicsWorld.syncSceneToPhysics(),this._steping=!0;var v=this._fixedTimeStep,S=this.velocityIterations,O=this.positionIterations;this._accumulator+=g;for(var X=0;X++<this._maxSubSteps&&this._accumulator>v;)this.physicsWorld.step(v,S,O),this._accumulator-=v;for(var Y=this._delayEvents,te=0,ti=Y.length;te<ti;te++){var tr=Y[te];tr.func.call(tr.target)}Y.length=0,this.physicsWorld.syncPhysicsToScene(),this.debugDrawFlags&&this.physicsWorld.drawDebug(),this._steping=!1,II.emit(Iw.EVENT_AFTER_PHYSICS)}},v._callAfterStep=function(g,v){this._steping?this._delayEvents.push({target:g,func:v}):v.call(g)},v.resetAccumulator=function(g){void 0===g&&(g=0),this._accumulator=g},v.step=function(g){this.physicsWorld.step(g,this.velocityIterations,this.positionIterations)},v.raycast=function(g,v,S,O){return void 0===S&&(S=Kr.Closest),void 0===O&&(O=0xffffffff),this.physicsWorld.raycast(g,v,S,O)},v.testPoint=function(g){return this.physicsWorld.testPoint(g)},v.testAABB=function(g){return this.physicsWorld.testAABB(g)},e.constructAndRegister=function(){II.registerSystem(e.ID,e.instance,a8.Priority.LOW)},n(e,[{key:"enable",get:function(){return this._enable},set:function(g){this._enable=g}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(g){this._allowSleep=g,this.physicsWorld.setAllowSleep(g)}},{key:"gravity",get:function(){return this._gravity},set:function(g){this._gravity.set(g),this.physicsWorld.setGravity(new e8(g.x/Kc,g.y/Kc))}},{key:"maxSubSteps",get:function(){return this._maxSubSteps},set:function(g){this._maxSubSteps=g}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(g){this._fixedTimeStep=g}},{key:"autoSimulation",get:function(){return this._autoSimulation},set:function(g){this._autoSimulation=g}},{key:"debugDrawFlags",get:function(){return this.physicsWorld.debugDrawFlags},set:function(g){this.physicsWorld.debugDrawFlags=g}},{key:"physicsWorld",get:function(){return K_.physicsWorld}},{key:"stepping",get:function(){return this._steping}}],[{key:"PHYSICS_NONE",get:function(){return!K_.id}},{key:"PHYSICS_BUILTIN",get:function(){return"builtin"===K_.id}},{key:"PHYSICS_BOX2D",get:function(){return"box2d"===K_.id}},{key:"PHYSICS_BOX2D_WASM",get:function(){return"box2d-wasm"===K_.id}},{key:"PhysicsGroup",get:function(){return Kn}},{key:"instance",get:function(){return Kz||(Kz=new e),Kz}}]),e}(Su(a8)));Jm.ID="PHYSICS_2D",II.once(Iw.EVENT_INIT,function(){Jm.constructAndRegister()}),g("eI",KX),function(g){g[g.Circles=0]="Circles",g[g.FaceA=1]="FaceA",g[g.FaceB=2]="FaceB"}(KX||g("eI",KX={}));var Jv,Jy,JS,JA,JT,JE,JC,Jb,JR,Jw,JI,JB,JP,JD,JO,JL,JN,JG,JV,JU,JH,Jz,JX,Jj,Jq,JY,JK,JJ,JQ,J$,J1,J2,J3,J5,J4,J8,J6,J7,J9,Zn,Zs,Zo,Zu,Zl,Zc,Zf,Zd,Zp,Zm,Zg,Zy,ZS,ZA,ZT,ZE,ZC,Zb,ZR,Zw,ZI,ZB,ZP,ZD,ZM,ZO,ZN,Zk,ZG,ZV,ZU,ZH,Zz,ZX,Zj,Zq,ZY,ZK,ZJ,ZQ,Z$,Z1,Z2,Z5,Z4,Z8,Z6,Z7,Z9,Qe,Qi,Qr,Qs,Qo,Qh,Qu,Ql,Qc,Q_,Qf,Qd,Qp,Qm,Qg,Qv,Qy,QS,QA,QT,QE,QC,Qb,QR,Qw,QI,QP,QD,QM,QO,QL,QN,Qk,QG,QV,QU,QH,Qz,QX,Qj,Qq,QY,QJ,QQ,Q$,Q0,Q1,Q2,Q3,Q5,Q4,Q8,Q6=ma,Q7=g("eJ",(Kj=nJ("cc.RigidBody2D"),Kq=Q6(KV),KY=Q6(Y7),KK=Q6(en),KJ=Q6(ee),K1=Q6(ee),K2=Q6(ee),K3=Q6(e8),K5=Q6(ee),K4=Q6(en),Kj((p((K6=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).enabledContactListener=K7&&K7(),v.bullet=K9&&K9(),v.awakeOnLoad=Jr&&Jr(),v._body=null,v._group=Js&&Js(),v._type=Jo&&Jo(),v._allowSleep=Jh&&Jh(),v._gravityScale=Ju&&Ju(),v._linearDamping=Jl&&Jl(),v._angularDamping=Jc&&Jc(),v._linearVelocity=J_&&J_(),v._angularVelocity=Jf&&Jf(),v._fixedRotation=Jp&&Jp(),v}s(e,g);var v=e.prototype;return v.isAwake=function(){return!!this._body&&this._body.isAwake},v.wakeUp=function(){this._body&&this._body.wakeUp()},v.sleep=function(){this._body&&this._body.sleep()},v.getMass=function(){return this._body?this._body.getMass():0},v.applyForce=function(g,v,S){this._body&&this._body.applyForce(g,v,S)},v.applyForceToCenter=function(g,v){this._body&&this._body.applyForceToCenter(g,v)},v.applyTorque=function(g,v){this._body&&this._body.applyTorque(g,v)},v.applyLinearImpulse=function(g,v,S){this._body&&this._body.applyLinearImpulse(g,v,S)},v.applyLinearImpulseToCenter=function(g,v){this._body&&this._body.applyLinearImpulseToCenter(g,v)},v.applyAngularImpulse=function(g,v){this._body&&this._body.applyAngularImpulse(g,v)},v.getLinearVelocityFromWorldPoint=function(g,v){return this._body?this._body.getLinearVelocityFromWorldPoint(g,v):v},v.getLocalVector=function(g,v){return this._body?this._body.getLocalVector(g,v):v},v.getWorldVector=function(g,v){return this._body?this._body.getWorldVector(g,v):v},v.getLocalPoint=function(g,v){return this._body?this._body.getLocalPoint(g,v):v},v.getWorldPoint=function(g,v){return this._body?this._body.getWorldPoint(g,v):v},v.getLocalCenter=function(g){return this._body?this._body.getLocalCenter(g):g},v.getWorldCenter=function(g){return this._body?this._body.getWorldCenter(g):g},v.getInertia=function(){return this._body?this._body.getInertia():0},v.onLoad=function(){this._body="builtin"===K_.id?Kf:new K_.wrapper.RigidBody,this._body.initialize(this)},v.onEnable=function(){this._body&&this._body.onEnable()},v.onDisable=function(){this._body&&this._body.onDisable()},v.onDestroy=function(){this._body&&this._body.onDestroy()},n(e,[{key:"group",get:function(){return this._group},set:function(g){this._group=g}},{key:"type",get:function(){return this._type},set:function(g){this._type=g,this._body&&(g===Y7.Animated?this._body.setType(Y7.Kinematic):this._body.setType(g))}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(g){this._allowSleep=g,this._body&&this._body.setAllowSleep(g)}},{key:"gravityScale",get:function(){return this._gravityScale},set:function(g){this._gravityScale=g,this._body&&this._body.setGravityScale(g)}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(g){this._linearDamping=g,this._body&&this._body.setLinearDamping(g)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(g){this._angularDamping=g,this._body&&this._body.setAngularDamping(g)}},{key:"linearVelocity",get:function(){return this._body&&this._body.getLinearVelocity(this._linearVelocity),this._linearVelocity},set:function(g){this._linearVelocity=g,this._body&&this._body.setLinearVelocity(g)}},{key:"angularVelocity",get:function(){return this._body&&(this._angularVelocity=this._body.getAngularVelocity()),this._angularVelocity},set:function(g){this._angularVelocity=g,this._body&&this._body.setAngularVelocity(g)}},{key:"fixedRotation",get:function(){return this._fixedRotation},set:function(g){this._fixedRotation=g,this._body&&this._body.setFixedRotation(g)}},{key:"impl",get:function(){return this._body}}]),e}(cS)).prototype,"group",[Kq],Object.getOwnPropertyDescriptor(K6.prototype,"group"),K6.prototype),K7=ws(K6.prototype,"enabledContactListener",[n2],function(){return!1}),K9=ws(K6.prototype,"bullet",[n2],function(){return!1}),p(K6.prototype,"type",[KY],Object.getOwnPropertyDescriptor(K6.prototype,"type"),K6.prototype),p(K6.prototype,"allowSleep",[KK],Object.getOwnPropertyDescriptor(K6.prototype,"allowSleep"),K6.prototype),p(K6.prototype,"gravityScale",[KJ],Object.getOwnPropertyDescriptor(K6.prototype,"gravityScale"),K6.prototype),p(K6.prototype,"linearDamping",[K1],Object.getOwnPropertyDescriptor(K6.prototype,"linearDamping"),K6.prototype),p(K6.prototype,"angularDamping",[K2],Object.getOwnPropertyDescriptor(K6.prototype,"angularDamping"),K6.prototype),p(K6.prototype,"linearVelocity",[K3],Object.getOwnPropertyDescriptor(K6.prototype,"linearVelocity"),K6.prototype),p(K6.prototype,"angularVelocity",[K5],Object.getOwnPropertyDescriptor(K6.prototype,"angularVelocity"),K6.prototype),p(K6.prototype,"fixedRotation",[K4],Object.getOwnPropertyDescriptor(K6.prototype,"fixedRotation"),K6.prototype),Jr=ws(K6.prototype,"awakeOnLoad",[n2],function(){return!0}),Js=ws(K6.prototype,"_group",[n2],function(){return KV.DEFAULT}),Jo=ws(K6.prototype,"_type",[n2],function(){return Y7.Dynamic}),Jh=ws(K6.prototype,"_allowSleep",[n2],function(){return!0}),Ju=ws(K6.prototype,"_gravityScale",[n2],function(){return 1}),Jl=ws(K6.prototype,"_linearDamping",[n2],function(){return 0}),Jc=ws(K6.prototype,"_angularDamping",[n2],function(){return 0}),J_=ws(K6.prototype,"_linearVelocity",[n2],function(){return new e8}),Jf=ws(K6.prototype,"_angularVelocity",[n2],function(){return 0}),Jp=ws(K6.prototype,"_fixedRotation",[n2],function(){return!1}),K8=K6))||K8)),Q9=ma,$e=g("eK",(Jv=nJ("cc.Collider2D"),Jy=Q9(ee),JS=Q9(KV),JA=Q9(ee),JT=Q9(en),JE=Q9(ee),JC=Q9(ee),Jb=Q9(e8),Jv((Jw=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).editing=!1,v.tag=JI&&JI(),v.TYPE=Y9.None,v._shape=null,v._body=null,v._group=JB&&JB(),v._density=JP&&JP(),v._sensor=JD&&JD(),v._friction=JO&&JO(),v._restitution=JL&&JL(),v._offset=JN&&JN(),v}s(e,g);var v=e.prototype;return v.onLoad=function(){this._shape=function(g){return Kd.INITED||(Kd.INITED=!0,Kd[Y9.BOX]=function(){return new K_.wrapper.BoxShape},Kd[Y9.CIRCLE]=function(){return new K_.wrapper.CircleShape},Kd[Y9.POLYGON]=function(){return new K_.wrapper.PolygonShape}),Kd[g]()}(this.TYPE),this._shape.initialize(this),this._shape.onLoad&&this._shape.onLoad(),this._body=this.getComponent(Q7)},v.onEnable=function(){this._shape&&this._shape.onEnable()},v.onDisable=function(){this._shape&&this._shape.onDisable&&this._shape.onDisable()},v.onDestroy=function(){this._shape&&this._shape.onDestroy&&this._shape.onDestroy()},v.apply=function(){this._shape&&this._shape.apply&&this._shape.apply()},n(e,[{key:"group",get:function(){return this._group},set:function(g){this._group=g,this._shape&&this._shape.onGroupChanged&&this._shape.onGroupChanged()}},{key:"density",get:function(){return this._density},set:function(g){this._density=g}},{key:"sensor",get:function(){return this._sensor},set:function(g){this._sensor=g}},{key:"friction",get:function(){return this._friction},set:function(g){this._friction=g}},{key:"restitution",get:function(){return this._restitution},set:function(g){this._restitution=g}},{key:"offset",get:function(){return this._offset},set:function(g){this._offset=g}},{key:"body",get:function(){return this._body}},{key:"impl",get:function(){return this._shape}},{key:"worldAABB",get:function(){return this._shape?this._shape.worldAABB:new ic}}]),e}(Su(cS)),JI=ws(Jw.prototype,"tag",[Jy,n2],function(){return 0}),p(Jw.prototype,"group",[JS],Object.getOwnPropertyDescriptor(Jw.prototype,"group"),Jw.prototype),p(Jw.prototype,"density",[JA],Object.getOwnPropertyDescriptor(Jw.prototype,"density"),Jw.prototype),p(Jw.prototype,"sensor",[JT],Object.getOwnPropertyDescriptor(Jw.prototype,"sensor"),Jw.prototype),p(Jw.prototype,"friction",[JE],Object.getOwnPropertyDescriptor(Jw.prototype,"friction"),Jw.prototype),p(Jw.prototype,"restitution",[JC],Object.getOwnPropertyDescriptor(Jw.prototype,"restitution"),Jw.prototype),p(Jw.prototype,"offset",[Jb],Object.getOwnPropertyDescriptor(Jw.prototype,"offset"),Jw.prototype),JB=ws(Jw.prototype,"_group",[n2],function(){return KV.DEFAULT}),JP=ws(Jw.prototype,"_density",[n2],function(){return 1}),JD=ws(Jw.prototype,"_sensor",[n2],function(){return!1}),JO=ws(Jw.prototype,"_friction",[n2],function(){return .2}),JL=ws(Jw.prototype,"_restitution",[n2],function(){return 0}),JN=ws(Jw.prototype,"_offset",[n2],function(){return new e8}),JR=Jw))||JR)),$n=(g("eL",(JG=nJ("cc.BoxCollider2D"),JV=ma(iu),JG((JH=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._size=Jz&&Jz(),v.TYPE=Y9.BOX,v}return s(e,g),n(e,[{key:"size",get:function(){return this._size},set:function(g){this._size=g}},{key:"worldPoints",get:function(){return this._shape?this._shape.worldPoints:[]}}]),e}($e),Jz=ws(JH.prototype,"_size",[n2],function(){return new iu(1,1)}),p(JH.prototype,"size",[JV],Object.getOwnPropertyDescriptor(JH.prototype,"size"),JH.prototype),JU=JH))||JU)),g("eM",(JX=nJ("cc.CircleCollider2D"),Jj=ma(ee),JX((JY=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._radius=JK&&JK(),v.TYPE=Y9.CIRCLE,v}return s(e,g),n(e,[{key:"radius",get:function(){return this._radius},set:function(g){this._radius=g<0?0:g}},{key:"worldPosition",get:function(){return this._shape?this._shape.worldPosition:new e8}},{key:"worldRadius",get:function(){return this._shape?this._shape.worldRadius:0}}]),e}($e),JK=ws(JY.prototype,"_radius",[n2],function(){return 1}),p(JY.prototype,"radius",[Jj],Object.getOwnPropertyDescriptor(JY.prototype,"radius"),JY.prototype),Jq=JY))||Jq)),g("eN",(JJ=nJ("cc.PolygonCollider2D"),JQ=ma(ee),J$=ma([e8]),JJ((J2=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).threshold=J3&&J3(),v._points=J5&&J5(),v.TYPE=Y9.POLYGON,v}return s(e,g),n(e,[{key:"points",get:function(){return this._points},set:function(g){this._points=g}},{key:"worldPoints",get:function(){return this._shape?this._shape.worldPoints:[]}}]),e}($e),J3=ws(J2.prototype,"threshold",[JQ],function(){return 1}),J5=ws(J2.prototype,"_points",[n2],function(){return[new e8(-1,-1),new e8(1,-1),new e8(1,1),new e8(-1,1)]}),p(J2.prototype,"points",[J$],Object.getOwnPropertyDescriptor(J2.prototype,"points"),J2.prototype),J1=J2))||J1)),ma),$s=g("eO",(J4=nJ("cc.Joint2D"),J8=$n(Q7),J4((J7=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).anchor=J9&&J9(),v.connectedAnchor=Zn&&Zn(),v.collideConnected=Zs&&Zs(),v.connectedBody=Zo&&Zo(),v._body=null,v._joint=null,v.TYPE=Ki.None,v}s(e,g);var v=e.prototype;return v.onLoad=function(){this._joint=function(g){return function(){if(!Kp.INITED){Kp.INITED=!0;var g="builtin"===K_.id;Kp[Ki.SPRING]=function(){return g?Km:new K_.wrapper.SpringJoint},Kp[Ki.DISTANCE]=function(){return g?Km:new K_.wrapper.DistanceJoint},Kp[Ki.FIXED]=function(){return g?Km:new K_.wrapper.FixedJoint},Kp[Ki.MOUSE]=function(){return g?Km:new K_.wrapper.MouseJoint},Kp[Ki.RELATIVE]=function(){return g?Km:new K_.wrapper.RelativeJoint},Kp[Ki.SLIDER]=function(){return g?Km:new K_.wrapper.SliderJoint},Kp[Ki.WHEEL]=function(){return g?Km:new K_.wrapper.WheelJoint},Kp[Ki.HINGE]=function(){return g?Km:new K_.wrapper.HingeJoint}}}(),Kp[g]()}(this.TYPE),this._joint.initialize(this),this._body=this.getComponent(Q7)},v.onEnable=function(){this._joint&&this._joint.onEnable&&this._joint.onEnable()},v.onDisable=function(){this._joint&&this._joint.onDisable&&this._joint.onDisable()},v.start=function(){this._joint&&this._joint.start&&this._joint.start()},v.onDestroy=function(){this._joint&&this._joint.onDestroy&&this._joint.onDestroy()},v.apply=function(){this._joint&&this._joint.apply&&this._joint.apply()},n(e,[{key:"body",get:function(){return this._body}},{key:"impl",get:function(){return this._joint}}]),e}(cS),J9=ws(J7.prototype,"anchor",[n2],function(){return new e8}),Zn=ws(J7.prototype,"connectedAnchor",[n2],function(){return new e8}),Zs=ws(J7.prototype,"collideConnected",[n2],function(){return!1}),Zo=ws(J7.prototype,"connectedBody",[J8,n2],function(){return null}),J6=J7))||J6)),$o=(g("eP",(Zu=nJ("cc.DistanceJoint2D"),Zl=ma(ee),Zc=ma(en),Zu((p((Zd=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).TYPE=Ki.DISTANCE,v._maxLength=Zp&&Zp(),v._autoCalcDistance=Zm&&Zm(),v}return s(e,g),n(e,[{key:"maxLength",get:function(){return this._autoCalcDistance?this.connectedBody?eL.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):eL.len(this.node.worldPosition):this._maxLength},set:function(g){this._maxLength=g,this._joint&&this._joint.setMaxLength(g)}},{key:"autoCalcDistance",get:function(){return this._autoCalcDistance},set:function(g){this._autoCalcDistance=g}}]),e}($s)).prototype,"maxLength",[Zl],Object.getOwnPropertyDescriptor(Zd.prototype,"maxLength"),Zd.prototype),p(Zd.prototype,"autoCalcDistance",[Zc],Object.getOwnPropertyDescriptor(Zd.prototype,"autoCalcDistance"),Zd.prototype),Zp=ws(Zd.prototype,"_maxLength",[n2],function(){return 5}),Zm=ws(Zd.prototype,"_autoCalcDistance",[n2],function(){return!0}),Zf=Zd))||Zf)),g("eQ",(Zg=nJ("cc.SpringJoint2D"),Zy=ma(ee),ZS=ma(ee),ZA=ma(ee),ZT=ma(en),Zg((p((ZC=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).TYPE=Ki.SPRING,v._frequency=Zb&&Zb(),v._dampingRatio=ZR&&ZR(),v._distance=Zw&&Zw(),v._autoCalcDistance=ZI&&ZI(),v}return s(e,g),n(e,[{key:"frequency",get:function(){return this._frequency},set:function(g){this._frequency=g,this._joint&&this._joint.setFrequency(g)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(g){this._dampingRatio=g,this._joint&&this._joint.setDampingRatio(g)}},{key:"distance",get:function(){return this._autoCalcDistance?this.connectedBody?eL.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):eL.len(this.node.worldPosition):this._distance},set:function(g){this._distance=g,this._joint&&this._joint.setDistance(g)}},{key:"autoCalcDistance",get:function(){return this._autoCalcDistance},set:function(g){this._autoCalcDistance=g}}]),e}($s)).prototype,"frequency",[Zy],Object.getOwnPropertyDescriptor(ZC.prototype,"frequency"),ZC.prototype),p(ZC.prototype,"dampingRatio",[ZS],Object.getOwnPropertyDescriptor(ZC.prototype,"dampingRatio"),ZC.prototype),p(ZC.prototype,"distance",[ZA],Object.getOwnPropertyDescriptor(ZC.prototype,"distance"),ZC.prototype),p(ZC.prototype,"autoCalcDistance",[ZT],Object.getOwnPropertyDescriptor(ZC.prototype,"autoCalcDistance"),ZC.prototype),Zb=ws(ZC.prototype,"_frequency",[n2],function(){return 5}),ZR=ws(ZC.prototype,"_dampingRatio",[n2],function(){return .7}),Zw=ws(ZC.prototype,"_distance",[n2],function(){return 10}),ZI=ws(ZC.prototype,"_autoCalcDistance",[n2],function(){return!0}),ZE=ZC))||ZE)),g("eR",(ZB=nJ("cc.MouseJoint2D"),ZP=ma(ee),ZD=ma(ee),ZM=ma(ee),ZB((p((ZN=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).TYPE=Ki.MOUSE,v._maxForce=Zk&&Zk(),v._dampingRatio=ZG&&ZG(),v._frequency=ZV&&ZV(),v._target=new e8,v}return s(e,g),e.prototype.update=function(g){this._joint.update(g)},n(e,[{key:"target",get:function(){return this._target},set:function(g){this._target=g,this._joint&&this._joint.setTarget(g)}},{key:"frequency",get:function(){return this._frequency},set:function(g){this._frequency=g,this._joint&&this._joint.setFrequency(g)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(g){this._dampingRatio=g,this._joint&&this._joint.setDampingRatio(g)}},{key:"maxForce",get:function(){return this._maxForce},set:function(g){this._maxForce=g,this._joint&&this._joint.setMaxForce(g)}}]),e}($s)).prototype,"frequency",[ZP],Object.getOwnPropertyDescriptor(ZN.prototype,"frequency"),ZN.prototype),p(ZN.prototype,"dampingRatio",[ZD],Object.getOwnPropertyDescriptor(ZN.prototype,"dampingRatio"),ZN.prototype),p(ZN.prototype,"maxForce",[ZM],Object.getOwnPropertyDescriptor(ZN.prototype,"maxForce"),ZN.prototype),Zk=ws(ZN.prototype,"_maxForce",[n2],function(){return 1e3}),ZG=ws(ZN.prototype,"_dampingRatio",[n2],function(){return .7}),ZV=ws(ZN.prototype,"_frequency",[n2],function(){return 5}),ZO=ZN))||ZO)),new eL),$l=new eL,$c=(g("eS",(ZU=nJ("cc.RelativeJoint2D"),ZH=ma(ee),Zz=ma(ee),ZX=ma(ee),Zj=ma(e8),Zq=ma(ee),ZY=ma(en),ZU((p((ZJ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).TYPE=Ki.RELATIVE,v._maxForce=ZQ&&ZQ(),v._maxTorque=Z$&&Z$(),v._correctionFactor=Z1&&Z1(),v._angularOffset=Z2&&Z2(),v._linearOffset=Z5&&Z5(),v._autoCalcOffset=Z4&&Z4(),v}return s(e,g),n(e,[{key:"maxForce",get:function(){return this._maxForce},set:function(g){this._maxForce=g,this._joint&&this._joint.setMaxForce(g)}},{key:"maxTorque",get:function(){return this._maxTorque},set:function(g){this._maxTorque=g,this._joint&&this._joint.setMaxTorque(g)}},{key:"correctionFactor",get:function(){return this._correctionFactor},set:function(g){this._correctionFactor=g,this._joint&&this._joint.setCorrectionFactor(g)}},{key:"linearOffset",get:function(){return this._autoCalcOffset?this.connectedBody?e8.subtract(this._linearOffset,this.connectedBody.node.worldPosition,this.node.worldPosition):e8.subtract(this._linearOffset,new e8(0,0),this.node.worldPosition):this._linearOffset},set:function(g){this._linearOffset.set(g),this._joint&&this._joint.setLinearOffset(g)}},{key:"angularOffset",get:function(){return this._autoCalcOffset&&(eW.toEuler($o,this.node.worldRotation),this.connectedBody?eW.toEuler($l,this.connectedBody.node.worldRotation):eW.toEuler($l,new eW),this._angularOffset=$l.z-$o.z),this._angularOffset},set:function(g){this._angularOffset=g,this._joint&&this._joint.setAngularOffset(g)}},{key:"autoCalcOffset",get:function(){return this._autoCalcOffset},set:function(g){this._autoCalcOffset=g}}]),e}($s)).prototype,"maxForce",[ZH],Object.getOwnPropertyDescriptor(ZJ.prototype,"maxForce"),ZJ.prototype),p(ZJ.prototype,"maxTorque",[Zz],Object.getOwnPropertyDescriptor(ZJ.prototype,"maxTorque"),ZJ.prototype),p(ZJ.prototype,"correctionFactor",[ZX],Object.getOwnPropertyDescriptor(ZJ.prototype,"correctionFactor"),ZJ.prototype),p(ZJ.prototype,"linearOffset",[Zj],Object.getOwnPropertyDescriptor(ZJ.prototype,"linearOffset"),ZJ.prototype),p(ZJ.prototype,"angularOffset",[Zq],Object.getOwnPropertyDescriptor(ZJ.prototype,"angularOffset"),ZJ.prototype),p(ZJ.prototype,"autoCalcOffset",[ZY],Object.getOwnPropertyDescriptor(ZJ.prototype,"autoCalcOffset"),ZJ.prototype),ZQ=ws(ZJ.prototype,"_maxForce",[n2],function(){return 5}),Z$=ws(ZJ.prototype,"_maxTorque",[n2],function(){return .7}),Z1=ws(ZJ.prototype,"_correctionFactor",[n2],function(){return .3}),Z2=ws(ZJ.prototype,"_angularOffset",[n2],function(){return 0}),Z5=ws(ZJ.prototype,"_linearOffset",[n2],function(){return new e8}),Z4=ws(ZJ.prototype,"_autoCalcOffset",[n2],function(){return!0}),ZK=ZJ))||ZK)),new e8);g("eT",(Z8=nJ("cc.SliderJoint2D"),Z6=ma(ee),Z7=ma(en),Z9=ma(en),Qe=ma(ee),Qi=ma(ee),Qr=ma(en),Qs=ma(ee),Qo=ma(ee),Z8((p((Qu=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).TYPE=Ki.SLIDER,v._angle=Ql&&Ql(),v._autoCalcAngle=Qc&&Qc(),v._enableMotor=Q_&&Q_(),v._maxMotorForce=Qf&&Qf(),v._motorSpeed=Qd&&Qd(),v._enableLimit=Qp&&Qp(),v._lowerLimit=Qm&&Qm(),v._upperLimit=Qg&&Qg(),v}return s(e,g),n(e,[{key:"angle",get:function(){return this._autoCalcAngle&&(this.connectedBody?e8.subtract($c,this.connectedBody.node.worldPosition,this.node.worldPosition):e8.subtract($c,new e8(0,0),this.node.worldPosition),this._angle=Si(Math.atan2($c.y,$c.x))),this._angle},set:function(g){this._angle=g}},{key:"autoCalcAngle",get:function(){return this._autoCalcAngle},set:function(g){this._autoCalcAngle=g}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(g){this._enableMotor=g}},{key:"maxMotorForce",get:function(){return this._maxMotorForce},set:function(g){this._maxMotorForce=g,this._joint&&this._joint.setMaxMotorForce(g)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(g){this._motorSpeed=g,this._joint&&this._joint.setMotorSpeed(g)}},{key:"enableLimit",get:function(){return this._enableLimit},set:function(g){this._enableLimit=g}},{key:"lowerLimit",get:function(){return this._lowerLimit},set:function(g){this._lowerLimit=g,this._joint&&this._joint.setLowerLimit(g)}},{key:"upperLimit",get:function(){return this._upperLimit},set:function(g){this._upperLimit=g,this._joint&&this._joint.setUpperLimit(g)}}]),e}($s)).prototype,"angle",[Z6],Object.getOwnPropertyDescriptor(Qu.prototype,"angle"),Qu.prototype),p(Qu.prototype,"autoCalcAngle",[Z7],Object.getOwnPropertyDescriptor(Qu.prototype,"autoCalcAngle"),Qu.prototype),p(Qu.prototype,"enableMotor",[Z9],Object.getOwnPropertyDescriptor(Qu.prototype,"enableMotor"),Qu.prototype),p(Qu.prototype,"maxMotorForce",[Qe],Object.getOwnPropertyDescriptor(Qu.prototype,"maxMotorForce"),Qu.prototype),p(Qu.prototype,"motorSpeed",[Qi],Object.getOwnPropertyDescriptor(Qu.prototype,"motorSpeed"),Qu.prototype),p(Qu.prototype,"enableLimit",[Qr],Object.getOwnPropertyDescriptor(Qu.prototype,"enableLimit"),Qu.prototype),p(Qu.prototype,"lowerLimit",[Qs],Object.getOwnPropertyDescriptor(Qu.prototype,"lowerLimit"),Qu.prototype),p(Qu.prototype,"upperLimit",[Qo],Object.getOwnPropertyDescriptor(Qu.prototype,"upperLimit"),Qu.prototype),Ql=ws(Qu.prototype,"_angle",[n2],function(){return 0}),Qc=ws(Qu.prototype,"_autoCalcAngle",[n2],function(){return!0}),Q_=ws(Qu.prototype,"_enableMotor",[n2],function(){return!1}),Qf=ws(Qu.prototype,"_maxMotorForce",[n2],function(){return 1e3}),Qd=ws(Qu.prototype,"_motorSpeed",[n2],function(){return 1e3}),Qp=ws(Qu.prototype,"_enableLimit",[n2],function(){return!1}),Qm=ws(Qu.prototype,"_lowerLimit",[n2],function(){return 0}),Qg=ws(Qu.prototype,"_upperLimit",[n2],function(){return 0}),Qh=Qu))||Qh)),g("eU",(Qv=nJ("cc.FixedJoint2D"),Qy=ma(ee),QS=ma(ee),Qv((p((QT=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).TYPE=Ki.FIXED,v._frequency=QE&&QE(),v._dampingRatio=QC&&QC(),v}return s(e,g),n(e,[{key:"frequency",get:function(){return this._frequency},set:function(g){this._frequency=g,this._joint&&this._joint.setFrequency(g)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(g){this._dampingRatio=g,this._joint&&this._joint.setDampingRatio(g)}}]),e}($s)).prototype,"frequency",[Qy],Object.getOwnPropertyDescriptor(QT.prototype,"frequency"),QT.prototype),p(QT.prototype,"dampingRatio",[QS],Object.getOwnPropertyDescriptor(QT.prototype,"dampingRatio"),QT.prototype),QE=ws(QT.prototype,"_frequency",[n2],function(){return .7}),QC=ws(QT.prototype,"_dampingRatio",[n2],function(){return .5}),QA=QT))||QA)),g("eV",(Qb=nJ("cc.WheelJoint2D"),QR=ma(ee),Qw=ma(en),QI=ma(ee),QP=ma(ee),QD=ma(ee),QM=ma(ee),Qb((p((QL=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).TYPE=Ki.WHEEL,v._angle=QN&&QN(),v._enableMotor=Qk&&Qk(),v._maxMotorTorque=QG&&QG(),v._motorSpeed=QV&&QV(),v._frequency=QU&&QU(),v._dampingRatio=QH&&QH(),v}return s(e,g),n(e,[{key:"angle",get:function(){return this._angle},set:function(g){this._angle=g}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(g){this._enableMotor=g,this._joint&&this._joint.enableMotor(g)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(g){this._maxMotorTorque=g,this._joint&&this._joint.setMaxMotorTorque(g)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(g){this._motorSpeed=g,this._joint&&this._joint.setMotorSpeed(g)}},{key:"frequency",get:function(){return this._frequency},set:function(g){this._frequency=g,this._joint&&this._joint.setFrequency(g)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(g){this._dampingRatio=g,this._joint&&this._joint.setDampingRatio(g)}}]),e}($s)).prototype,"angle",[QR],Object.getOwnPropertyDescriptor(QL.prototype,"angle"),QL.prototype),p(QL.prototype,"enableMotor",[Qw],Object.getOwnPropertyDescriptor(QL.prototype,"enableMotor"),QL.prototype),p(QL.prototype,"maxMotorTorque",[QI],Object.getOwnPropertyDescriptor(QL.prototype,"maxMotorTorque"),QL.prototype),p(QL.prototype,"motorSpeed",[QP],Object.getOwnPropertyDescriptor(QL.prototype,"motorSpeed"),QL.prototype),p(QL.prototype,"frequency",[QD],Object.getOwnPropertyDescriptor(QL.prototype,"frequency"),QL.prototype),p(QL.prototype,"dampingRatio",[QM],Object.getOwnPropertyDescriptor(QL.prototype,"dampingRatio"),QL.prototype),QN=ws(QL.prototype,"_angle",[n2],function(){return 90}),Qk=ws(QL.prototype,"_enableMotor",[n2],function(){return!1}),QG=ws(QL.prototype,"_maxMotorTorque",[n2],function(){return 1e3}),QV=ws(QL.prototype,"_motorSpeed",[n2],function(){return 0}),QU=ws(QL.prototype,"_frequency",[n2],function(){return 5}),QH=ws(QL.prototype,"_dampingRatio",[n2],function(){return .7}),QO=QL))||QO)),g("eW",(Qz=nJ("cc.HingeJoint2D"),QX=ma(en),Qj=ma(ee),Qq=ma(ee),QY=ma(en),QJ=ma(ee),QQ=ma(ee),Qz((p((Q0=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).TYPE=Ki.HINGE,v._enableLimit=Q1&&Q1(),v._lowerAngle=Q2&&Q2(),v._upperAngle=Q3&&Q3(),v._enableMotor=Q5&&Q5(),v._maxMotorTorque=Q4&&Q4(),v._motorSpeed=Q8&&Q8(),v}return s(e,g),n(e,[{key:"enableLimit",get:function(){return this._enableLimit},set:function(g){this._enableLimit=g}},{key:"lowerAngle",get:function(){return this._lowerAngle},set:function(g){this._lowerAngle=g,this._joint&&this._joint.setLowerAngle(g)}},{key:"upperAngle",get:function(){return this._upperAngle},set:function(g){this._upperAngle=g,this._joint&&this._joint.setUpperAngle(g)}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(g){this._enableMotor=g,this._joint&&this._joint.enableMotor(g)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(g){this._maxMotorTorque=g,this._joint&&this._joint.setMaxMotorTorque(g)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(g){this._motorSpeed=g,this._joint&&this._joint.setMotorSpeed(g)}}]),e}($s)).prototype,"enableLimit",[QX],Object.getOwnPropertyDescriptor(Q0.prototype,"enableLimit"),Q0.prototype),p(Q0.prototype,"lowerAngle",[Qj],Object.getOwnPropertyDescriptor(Q0.prototype,"lowerAngle"),Q0.prototype),p(Q0.prototype,"upperAngle",[Qq],Object.getOwnPropertyDescriptor(Q0.prototype,"upperAngle"),Q0.prototype),p(Q0.prototype,"enableMotor",[QY],Object.getOwnPropertyDescriptor(Q0.prototype,"enableMotor"),Q0.prototype),p(Q0.prototype,"maxMotorTorque",[QJ],Object.getOwnPropertyDescriptor(Q0.prototype,"maxMotorTorque"),Q0.prototype),p(Q0.prototype,"motorSpeed",[QQ],Object.getOwnPropertyDescriptor(Q0.prototype,"motorSpeed"),Q0.prototype),Q1=ws(Q0.prototype,"_enableLimit",[n2],function(){return!1}),Q2=ws(Q0.prototype,"_lowerAngle",[n2],function(){return 0}),Q3=ws(Q0.prototype,"_upperAngle",[n2],function(){return 0}),Q5=ws(Q0.prototype,"_enableMotor",[n2],function(){return!1}),Q4=ws(Q0.prototype,"_maxMotorTorque",[n2],function(){return 1e3}),Q8=ws(Q0.prototype,"_motorSpeed",[n2],function(){return 0}),Q$=Q0))||Q$)),g("ex",{PolygonSeparator:KR,PolygonPartition:KH}),X.internal.physics2d={selector:K_};var $_=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._type=Kr.Closest,v._fixtures=[],v._points=[],v._normals=[],v._fractions=[],v._mask=0xffffffff,v}s(e,g);var v=e.prototype;return v.init=function(g,v){this._type=g,this._mask=v,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0},v.ReportFixture=function(g,v,S,O){return 0==(g.GetFilterData().categoryBits&this._mask)?0:this._type===Kr.Closest?(this._fixtures[0]=g,this._points[0]=v,this._normals[0]=S,this._fractions[0]=O,O):(this._fixtures.push(g),this._points.push(new e8(v.x,v.y)),this._normals.push(new e8(S.x,S.y)),this._fractions.push(O),this._type===Kr.Any?0:this._type>=Kr.All?1:O)},v.getFixtures=function(){return this._fixtures},v.getPoints=function(){return this._points},v.getNormals=function(){return this._normals},v.getFractions=function(){return this._fractions},e}(KE.RayCastCallback),$f=[],$d=[new e8,new e8],$p=new KE.WorldManifold,$m={points:[],separations:[],normal:new e8},$6=function(){this.localPoint=new e8,this.normalImpulse=0,this.tangentImpulse=0},$g=[new $6,new $6],$y={type:0,localPoint:new e8,localNormal:new e8,points:[]},$S={normalImpulses:[],tangentImpulses:[]},$A=function(){function t1(){this.colliderA=null,this.colliderB=null,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=null}t1.get=function(g){var v=$f.pop();return v||(v=new t1),v.init(g),v},t1.put=function(g){var v=g.m_userData;v&&($f.push(v),v.reset())};var g=t1.prototype;return g._setImpulse=function(g){this._impulse=g},g.init=function(g){this.colliderA=g.m_fixtureA.m_userData.collider,this.colliderB=g.m_fixtureB.m_userData.collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=g,g.m_userData=this},g.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact.m_userData=null,this._b2contact=null},g.getWorldManifold=function(){var g=$m.points,v=$m.separations,S=$m.normal;this._b2contact.GetWorldManifold($p);var O=$p.points,X=$p.separations,Y=this._b2contact.GetManifold().pointCount;g.length=v.length=Y;for(var te=0;te<Y;te++){var ti=$d[te];ti.x=O[te].x*Kc,ti.y=O[te].y*Kc,g[te]=ti,v[te]=X[te]*Kc}return S.x=$p.normal.x,S.y=$p.normal.y,this._inverted&&(S.x*=-1,S.y*=-1),$m},g.getManifold=function(){for(var g=$y.points,v=$y.localNormal,S=$y.localPoint,O=this._b2contact.GetManifold(),X=O.points,Y=g.length=O.pointCount,te=0;te<Y;te++){var ti=$g[te],tr=X[te];ti.localPoint.x=tr.localPoint.x*Kc,ti.localPoint.y=tr.localPoint.y*Kc,ti.normalImpulse=tr.normalImpulse*Kc,ti.tangentImpulse=tr.tangentImpulse,g[te]=ti}return S.x=O.localPoint.x*Kc,S.y=O.localPoint.y*Kc,v.x=O.localNormal.x,v.y=O.localNormal.y,$y.type=O.type,this._inverted&&(v.x*=-1,v.y*=-1),$y},g.getImpulse=function(){var g=this._impulse;if(!g)return null;for(var v=$S.normalImpulses,S=$S.tangentImpulses,O=g.count,X=0;X<O;X++)v[X]=g.normalImpulses[X]*Kc,S[X]=g.tangentImpulses[X];return S.length=v.length=O,$S},g.emit=function(g){switch(g){case Kl.BEGIN_CONTACT:case Kl.END_CONTACT:case Kl.PRE_SOLVE:case Kl.POST_SOLVE:}var v=this.colliderA,S=this.colliderB,O=v.body,X=S.body;O.enabledContactListener&&(null==v||v.emit(g,v,S,this)),X.enabledContactListener&&(null==S||S.emit(g,S,v,this)),(O.enabledContactListener||X.enabledContactListener)&&Jm.instance.emit(g,v,S,this),(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},g.setEnabled=function(g){this._b2contact.SetEnabled(g)},g.isTouching=function(){return this._b2contact.IsTouching()},g.setTangentSpeed=function(g){this._b2contact.SetTangentSpeed(g)},g.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()},g.setFriction=function(g){this._b2contact.SetFriction(g)},g.getFriction=function(){return this._b2contact.GetFriction()},g.resetFriction=function(){return this._b2contact.ResetFriction()},g.setRestitution=function(g){this._b2contact.SetRestitution(g)},g.getRestitution=function(){return this._b2contact.GetRestitution()},g.resetRestitution=function(){return this._b2contact.ResetRestitution()},t1}(),$T=new KE.Vec2,$E=new is,$C=is.GREEN,$b=is.RED,$R=function(g){function e(v){var S;return(S=g.call(this)||this)._drawer=null,S._xf=new KE.Transform,S._dxf=new KE.Transform,S._drawer=v,S}s(e,g);var v=e.prototype;return v._DrawPolygon=function(g,v){for(var S=this._drawer,O=0;O<v;O++){KE.Transform.MulXV(this._xf,g[O],$T);var X=$T.x*Kc,Y=$T.y*Kc;0===O?S.moveTo(X,Y):S.lineTo(X,Y)}S.close()},v.DrawPolygon=function(g,v,S){this._applyStrokeColor(S),this._DrawPolygon(g,v),this._drawer.stroke()},v.DrawSolidPolygon=function(g,v,S){this._applyFillColor(S),this._DrawPolygon(g,v),this._drawer.fill(),this._drawer.stroke()},v._DrawCircle=function(g,v){KE.Transform.MulXV(this._xf,g,$T),this._drawer.circle($T.x*Kc,$T.y*Kc,v*Kc)},v.DrawCircle=function(g,v,S){this._applyStrokeColor(S),this._DrawCircle(g,v),this._drawer.stroke()},v.DrawSolidCircle=function(g,v,S,O){this._applyFillColor(O),this._DrawCircle(g,v),this._drawer.fill()},v.DrawSegment=function(g,v,S){var O=this._drawer;if(g.x===v.x&&g.y===v.y)return this._applyFillColor(S),this._DrawCircle(g,2/Kc),void O.fill();this._applyStrokeColor(S),KE.Transform.MulXV(this._xf,g,$T),O.moveTo($T.x*Kc,$T.y*Kc),KE.Transform.MulXV(this._xf,v,$T),O.lineTo($T.x*Kc,$T.y*Kc),O.stroke()},v.DrawTransform=function(g){var v=this._drawer;v.strokeColor=$b,$T.x=$T.y=0,KE.Transform.MulXV(g,$T,$T),v.moveTo($T.x*Kc,$T.y*Kc),$T.x=1,$T.y=0,KE.Transform.MulXV(g,$T,$T),v.lineTo($T.x*Kc,$T.y*Kc),v.stroke(),v.strokeColor=$C,$T.x=$T.y=0,KE.Transform.MulXV(g,$T,$T),v.moveTo($T.x*Kc,$T.y*Kc),$T.x=0,$T.y=1,KE.Transform.MulXV(g,$T,$T),v.lineTo($T.x*Kc,$T.y*Kc),v.stroke()},v.DrawPoint=function(){},v.DrawParticles=function(){},v._applyStrokeColor=function(g){this._drawer.strokeColor=$E.set(255*g.r,255*g.g,255*g.b,150)},v._applyFillColor=function(g){this._drawer.fillColor=$E.set(255*g.r,255*g.g,255*g.b,150)},v.PushTransform=function(g){this._xf=g},v.PopTransform=function(){this._xf=this._dxf},e}(KE.Draw),$w=new eL,$I=new e8,$B=new e8,$P=new KE.BodyDef,$D=new KE.AABB,$M=[],$O=function(){function t1(){this._world=void 0,this._bodies=[],this._animatedBodies=[],this._rotationAxis=new eL,this._physicsGroundBody=void 0,this._contactListener=void 0,this._aabbQueryCallback=void 0,this._raycastQueryCallback=void 0,this._debugGraphics=null,this._b2DebugDrawer=null,this._debugDrawFlags=0,this._world=new KE.World(new KE.Vec2(0,-10));var g=new KE.BodyDef;this._physicsGroundBody=this._world.CreateBody(g);var v=new KC;v.setBeginContact(this._onBeginContact),v.setEndContact(this._onEndContact),v.setPreSolve(this._onPreSolve),v.setPostSolve(this._onPostSolve),this._world.SetContactListener(v),this._contactListener=v,this._aabbQueryCallback=new Kb,this._raycastQueryCallback=new $_}var g=t1.prototype;return g._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var g=VM("Canvas");if(!g){var v=II.getScene();if(!v)return;(g=new mJ("Canvas")).addComponent("cc.Canvas"),g.parent=v}var S=new mJ("PHYSICS_2D_DEBUG_DRAW");S.hideFlags|=rG.Flags.DontSave,S.parent=g,S.worldPosition=eL.ZERO,S.layer=_a.Enum.UI_2D,this._debugGraphics=S.addComponent("cc.Graphics"),this._debugGraphics.lineWidth=3;var O=new $R(this._debugGraphics);this._b2DebugDrawer=O,this._world.SetDebugDraw(O)}var X=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(X.children.length-1),this._b2DebugDrawer&&this._b2DebugDrawer.SetFlags(this.debugDrawFlags)},g.setGravity=function(g){this._world.SetGravity(g)},g.setAllowSleep=function(){this._world.SetAllowSleeping(!0)},g.step=function(g,v,S){void 0===v&&(v=10),void 0===S&&(S=10);for(var O=this._animatedBodies,X=0,Y=O.length;X<Y;X++)O[X].animate(g);this._world.Step(g,v,S)},g.raycast=function(g,v,S,O){if(g.equals(v))return[];S=S||Kr.Closest,$I.x=g.x/Kc,$I.y=g.y/Kc,$B.x=v.x/Kc,$B.y=v.y/Kc;var X=this._raycastQueryCallback;X.init(S,O),this._world.RayCast(X,$I,$B);var Y=X.getFixtures();if(Y.length>0){for(var te=X.getPoints(),ti=X.getNormals(),tr=X.getFractions(),ta=[],th=0,tu=Y.length;th<tu;th++){var tl=Y[th],tc=tl.m_userData,t_=tc.collider;if(S===Kr.AllClosest){for(var tf=void 0,tp=0;tp<ta.length;tp++)ta[tp].collider===t_&&(tf=ta[tp]);if(tf){tr[th]<tf.fraction&&(tf.fixtureIndex=tc.getFixtureIndex(tl),tf.point.x=te[th].x*Kc,tf.point.y=te[th].y*Kc,tf.normal.x=ti[th].x,tf.normal.y=ti[th].y,tf.fraction=tr[th]);continue}}ta.push({collider:t_,fixtureIndex:tc.getFixtureIndex(tl),point:new e8(te[th].x*Kc,te[th].y*Kc),normal:new e8(ti[th].x,ti[th].y),fraction:tr[th]})}return ta}return[]},g.syncPhysicsToScene=function(){for(var g=this._bodies,v=0,S=g.length;v<S;v++){var O=g[v],X=O.rigidBody;if(X.type!==Y7.Animated){var Y=X.node,te=O.impl,ti=te.GetPosition();$w.x=ti.x*Kc,$w.y=ti.y*Kc,$w.z=0,Y.worldPosition=$w;var tr=Si(te.GetAngle());Y.setWorldRotationFromEuler(0,0,tr)}else O.resetVelocity()}},g.syncSceneToPhysics=function(){for(var g=this._bodies,v=0;v<g.length;v++)g[v].syncSceneToPhysics()},g.addBody=function(g){if(!this._bodies.includes(g)){var v=$P,S=g.rigidBody;v.allowSleep=S.allowSleep,v.gravityScale=S.gravityScale,v.linearDamping=S.linearDamping,v.angularDamping=S.angularDamping,v.fixedRotation=S.fixedRotation,v.bullet=S.bullet;var O=S.node,X=O.worldPosition;v.position.Set(X.x/Kc,X.y/Kc),$w.z=eW.getAxisAngle(this._rotationAxis,O.worldRotation),this._rotationAxis.z<0&&($w.z=2*Math.PI-$w.z),v.angle=$w.z,v.awake=S.awakeOnLoad,S.type===Y7.Animated?(v.type=Y7.Kinematic,this._animatedBodies.push(g),g._animatedPos.set(v.position.x,v.position.y),g._animatedAngle=v.angle):v.type=S.type;var Y=S,te=Y._linearVelocity;v.linearVelocity.Set(te.x,te.y),v.angularVelocity=Y._angularVelocity;var ti=this._world.CreateBody(v);ti.m_userData=g,g._imp=ti,this._bodies.push(g)}},g.removeBody=function(g){this._bodies.includes(g)&&(g.impl&&(g.impl.m_userData=null,this._world.DestroyBody(g.impl),g._imp=null),Jt(this._bodies,g),g.rigidBody.type===Y7.Animated&&Jt(this._animatedBodies,g))},g.registerContactFixture=function(g){this._contactListener.registerContactFixture(g)},g.unregisterContactFixture=function(g){this._contactListener.unregisterContactFixture(g)},g.testPoint=function(g){var v=$I.x=g.x/Kc,S=$I.y=g.y/Kc,O=.2/Kc;$D.lowerBound.x=v-O,$D.lowerBound.y=S-O,$D.upperBound.x=v+O,$D.upperBound.y=S+O;var X=this._aabbQueryCallback;X.init($I),this._world.QueryAABB(X,$D);var Y=X.getFixtures();$M.length=0;for(var te=0;te<Y.length;te++){var ti=Y[te].m_userData.collider;$M.includes(ti)||$M.push(ti)}return $M},g.testAABB=function(g){$D.lowerBound.x=g.xMin/Kc,$D.lowerBound.y=g.yMin/Kc,$D.upperBound.x=g.xMax/Kc,$D.upperBound.y=g.yMax/Kc;var v=this._aabbQueryCallback;v.init(),this._world.QueryAABB(v,$D);var S=v.getFixtures();$M.length=0;for(var O=0;O<S.length;O++){var X=S[O].m_userData.collider;$M.includes(X)||$M.push(X)}return $M},g.drawDebug=function(){this._checkDebugDrawValid(),this._debugGraphics&&(this._debugGraphics.clear(),this._world.DrawDebugData())},g._onBeginContact=function(g){$A.get(g).emit(Kl.BEGIN_CONTACT)},g._onEndContact=function(g){var v=g.m_userData;v&&(v.emit(Kl.END_CONTACT),$A.put(g))},g._onPreSolve=function(g){var v=g.m_userData;v&&v.emit(Kl.PRE_SOLVE)},g._onPostSolve=function(g,v){var S=g.m_userData;S&&(S._setImpulse(v),S.emit(Kl.POST_SOLVE),S._setImpulse(null))},n(t1,[{key:"impl",get:function(){return this._world}},{key:"groundBodyImpl",get:function(){return this._physicsGroundBody}},{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(g){g||this._debugGraphics&&(this._debugGraphics.node.parent=null),this._debugDrawFlags=g}}]),t1}(),$N=new eL,$k=new KE.Vec2,$G=function(){function t1(){this._animatedPos=new e8,this._animatedAngle=0,this._body=null,this._rigidBody=void 0,this._inited=!1}var g=t1.prototype;return g.initialize=function(g){this._rigidBody=g,Jm.instance._callAfterStep(this,this._init)},g.onDestroy=function(){Jm.instance._callAfterStep(this,this._destroy)},g.onEnable=function(){this.setActive(!0)},g.onDisable=function(){this.setActive(!1)},g.nodeTransformChanged=function(g){if(!Jm.instance.stepping){if(g&mJ.TransformBit.SCALE)for(var v=this.rigidBody.getComponents($e),S=0;S<v.length;S++)v[S].apply();g&mJ.TransformBit.POSITION&&this.syncPositionToPhysics(!0),g&mJ.TransformBit.ROTATION&&this.syncRotationToPhysics(!0)}},g._init=function(){this._inited||(Jm.instance.physicsWorld.addBody(this),this.setActive(!1),this._inited=!0)},g._destroy=function(){this._inited&&(Jm.instance.physicsWorld.removeBody(this),this._inited=!1)},g.animate=function(g){var v=this._body;if(v){var S=v.GetPosition();v.SetAwake(!0);var O=1/g;$k.x=(this._animatedPos.x-S.x)*O,$k.y=(this._animatedPos.y-S.y)*O,v.SetLinearVelocity($k);var X=v.GetAngle()%eC;X>Math.PI&&(X-=eC);var Y=(this._animatedAngle-X)*O;this._animatedAngle<-eE&&X>eE&&(Y=(this._animatedAngle+eC-X)*O),this._animatedAngle>eE&&X<-eE&&(Y=(this._animatedAngle-eC-X)*O),v.SetAngularVelocity(Y)}},g.syncSceneToPhysics=function(){var g=this._rigidBody.node.hasChangedFlags;g&&this.nodeTransformChanged(g)},g.syncPositionToPhysics=function(g){void 0===g&&(g=!1);var v=this._body;if(v){var S,O=this._rigidBody.node.worldPosition,X=this._rigidBody.type;(S=X===Y7.Animated?v.GetLinearVelocity():v.GetPosition()).x=O.x/Kc,S.y=O.y/Kc,X===Y7.Animated&&g?this._animatedPos.set(S.x,S.y):v.SetTransformVec(S,v.GetAngle())}},g.syncRotationToPhysics=function(g){void 0===g&&(g=!1);var v=this._body;if(v){var S=this._rigidBody.node.worldRotation,O=$N;eW.toEulerInYXZOrder(O,S);var X=yi(O.z);this._rigidBody.type===Y7.Animated&&g?this._animatedAngle=X:v.SetTransformVec(v.GetPosition(),X)}},g.resetVelocity=function(){var g=this._body;if(g){var v=g.m_linearVelocity;v.Set(0,0),g.SetLinearVelocity(v),g.SetAngularVelocity(0)}},g.setType=function(g){this._body.SetType(g)},g.setLinearDamping=function(g){this._body.SetLinearDamping(g)},g.setAngularDamping=function(g){this._body.SetAngularDamping(g)},g.setGravityScale=function(g){this._body.SetGravityScale(g)},g.setFixedRotation=function(g){this._body.SetFixedRotation(g)},g.setAllowSleep=function(g){this._body.SetSleepingAllowed(g)},g.isActive=function(){return this._body.IsActive()},g.setActive=function(g){this._body.SetActive(g)},g.wakeUp=function(){this._body.SetAwake(!0)},g.sleep=function(){this._body.SetAwake(!1)},g.getMass=function(){return this._body.GetMass()},g.setLinearVelocity=function(g){this._body.SetLinearVelocity(g)},g.getLinearVelocity=function(g){var v=this._body.GetLinearVelocity();return g.x=v.x,g.y=v.y,g},g.getLinearVelocityFromWorldPoint=function(g,v){return $k.Set(g.x/Kc,g.y/Kc),this._body.GetLinearVelocityFromWorldPoint($k,v),v.x*=Kc,v.y*=Kc,v},g.setAngularVelocity=function(g){this._body.SetAngularVelocity(g)},g.getAngularVelocity=function(){return this._body.GetAngularVelocity()},g.getLocalVector=function(g,v){return v=v||new e8,$k.Set(g.x/Kc,g.y/Kc),this._body.GetLocalVector($k,v),v.x*=Kc,v.y*=Kc,v},g.getWorldVector=function(g,v){return $k.Set(g.x/Kc,g.y/Kc),this._body.GetWorldVector($k,v),v.x*=Kc,v.y*=Kc,v},g.getLocalPoint=function(g,v){return v=v||new e8,$k.Set(g.x/Kc,g.y/Kc),this._body.GetLocalPoint($k,v),v.x*=Kc,v.y*=Kc,v},g.getWorldPoint=function(g,v){return v=v||new e8,$k.Set(g.x/Kc,g.y/Kc),this._body.GetWorldPoint($k,v),v.x*=Kc,v.y*=Kc,v},g.getLocalCenter=function(g){g=g||new e8;var v=this._body.GetLocalCenter();return g.x=v.x*Kc,g.y=v.y*Kc,g},g.getWorldCenter=function(g){g=g||new e8;var v=this._body.GetWorldCenter();return g.x=v.x*Kc,g.y=v.y*Kc,g},g.getInertia=function(){return this._body.GetInertia()},g.applyForce=function(g,v,S){this._body&&($k.Set(v.x/Kc,v.y/Kc),this._body.ApplyForce(g,$k,S))},g.applyForceToCenter=function(g,v){this._body&&this._body.ApplyForceToCenter(g,v)},g.applyTorque=function(g,v){this._body&&this._body.ApplyTorque(g,v)},g.applyLinearImpulse=function(g,v,S){this._body&&($k.Set(v.x/Kc,v.y/Kc),this._body.ApplyLinearImpulse(g,$k,S))},g.applyLinearImpulseToCenter=function(g,v){this._body&&this._body.ApplyLinearImpulse(g,this._body.GetPosition(),v)},g.applyAngularImpulse=function(g,v){this._body&&this._body.ApplyAngularImpulse(g,v)},n(t1,[{key:"impl",get:function(){return this._body}},{key:"_imp",set:function(g){this._body=g}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"isAwake",get:function(){return this._body.IsAwake()}},{key:"isSleeping",get:function(){return!this._body.IsAwake()}}]),t1}(),$V=new KE.Filter,$U=new KE.Vec2,$H=new KE.Vec2;function T7(g){var v=g.collider;return v.body?$V.categoryBits=v.group===KV.DEFAULT?v.body.group:v.group:$V.categoryBits=v.group,$V.maskBits=Jm.instance.collisionMatrix[$V.categoryBits],$V}var $z,$X=function(){function t1(){this._shapes=[],this._fixtures=[],this._collider=null,this._body=null,this._inited=!1,this._rect=new ic}var g=t1.prototype;return g.initialize=function(g){this._collider=g},g.onLoad=function(){},g.onEnable=function(){Jm.instance._callAfterStep(this,this._init)},g.onDisable=function(){Jm.instance._callAfterStep(this,this._destroy)},g.start=function(){},g.onGroupChanged=function(){var g=T7(this);this._fixtures.forEach(function(v){v.SetFilterData(g)})},g.apply=function(){this._destroy(),this.collider.enabledInHierarchy&&this._init()},g.getFixtureIndex=function(g){return this._fixtures.indexOf(g)},g._createShapes=function(){return[]},g._init=function(){if(!this._inited){var g=this.collider,v=g.node.worldScale,S=eL.ZERO,O=g.getComponent(Q7);O&&O.impl&&O.impl.impl?this._body=O.impl.impl:(this._body=Jm.instance.physicsWorld.groundBodyImpl,S=g.node.worldPosition);for(var X=0===v.x&&0===v.y?[]:this._createShapes(v.x,v.y,S.x,S.y),Y=T7(this),te=0;te<X.length;te++){var ti=X[te],tr={density:g.density,isSensor:g.sensor,friction:g.friction,restitution:g.restitution,shape:ti,filter:Y},ta=this._body.CreateFixture(tr);ta.m_userData=this,null!=O&&O.enabledContactListener&&Jm.instance.physicsWorld.registerContactFixture(ta),this._shapes.push(ti),this._fixtures.push(ta)}this._inited=!0}},g._destroy=function(){if(this._inited){for(var g=this._fixtures,v=this._body,S=g.length-1;S>=0;S--){var O=g[S];O.m_userData=null,Jm.instance.physicsWorld.unregisterContactFixture(O),v&&v.DestroyFixture(O)}this._body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},n(t1,[{key:"impl",get:function(){return this._shapes}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){for(var g=1e7,v=g,S=g,O=-g,X=-g,Y=this._fixtures,te=0;te<Y.length;te++)for(var ti=Y[te],tr=ti.GetShape().GetChildCount(),ta=0;ta<tr;ta++){if($U.Copy(ti.GetAABB(ta).lowerBound),$H.Copy(ti.GetAABB(ta).upperBound),2===ti.GetShape().m_type){var th=ti.GetShape().m_radius;$U.SelfAddXY(th,th),$H.SelfSubXY(th,th)}$U.x<v&&(v=$U.x),$U.y<S&&(S=$U.y),$H.x>O&&(O=$H.x),$H.y>X&&(X=$H.y)}v*=Kc,S*=Kc,O*=Kc,X*=Kc;var tu=this._rect;return tu.x=v,tu.y=S,tu.width=O-v,tu.height=X-S,tu}}]),t1}(),$j=new ic,$q=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._worldPoints=[new e8,new e8,new e8,new e8],v}return s(e,g),e.prototype._createShapes=function(g,v,S,O){g=Math.abs(g),v=Math.abs(v);var X=this.collider,Y=X.size.width/2/Kc*g,te=X.size.height/2/Kc*v,ti=(S+X.offset.x*g)/Kc,tr=(O+X.offset.y*v)/Kc,ta=new KE.PolygonShape;return ta.SetAsBox(Y,te,new KE.Vec2(ti,tr),0),[ta]},n(e,[{key:"worldPoints",get:function(){var g=$j,v=this.collider,S=v.size,O=v.offset;g.x=O.x-S.width/2,g.y=O.y-S.height/2,g.width=S.width,g.height=S.height;var X=this._worldPoints,Y=X[0],te=X[1],ti=X[2],tr=X[3];return g.transformMat4ToPoints(v.node.worldMatrix,Y,te,ti,tr),X}}]),e}($X),$Y=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._worldPosition=new e8,v}return s(e,g),e.prototype._createShapes=function(g,v,S,O){g=Math.abs(g),v=Math.abs(v);var X=this.collider,Y=(S+X.offset.x*g)/Kc,te=(O+X.offset.y*v)/Kc,ti=new KE.CircleShape;return ti.m_radius=X.radius/Kc*g,ti.m_p.Set(Y,te),[ti]},n(e,[{key:"worldRadius",get:function(){return this._shapes[0].m_radius*Kc}},{key:"worldPosition",get:function(){var g=this._shapes[0].m_p;return this._worldPosition.set(g.x*Kc,g.y*Kc)}}]),e}($X),$J=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._worldPoints=[],v}return s(e,g),e.prototype._createShapes=function(g,v,S,O){var X=[],Y=this.collider,te=Y.points;te.length>0&&te[0].equals(te[te.length-1])&&(te.length-=1);var ti=f5(te);if(!ti)return console.log("[Physics2D] b2PolygonShape failed to decompose polygon into convex polygons, node name: ",Y.node.name),X;for(var tr=Y.offset,ta=0;ta<ti.length;ta++){for(var th=ti[ta],tu=null,tl=[],tc=null,t_=0,tf=th.length;t_<tf;t_++){tu||(tu=new KE.PolygonShape);var tp=th[t_],tm=(S+(tp.x+tr.x)*g)/Kc,tg=(O+(tp.y+tr.y)*v)/Kc,tv=new KE.Vec2(tm,tg);tl.push(tv),tc||(tc=tv),tl.length===KE.maxPolygonVertices&&(tu.Set(tl,tl.length),X.push(tu),tu=null,t_<tf-1&&(tl=[tc,tl[tl.length-1]]))}tu&&(tu.Set(tl,tl.length),X.push(tu))}return X},n(e,[{key:"worldPoints",get:function(){for(var g=this.collider,v=g.points,S=this._worldPoints,O=g.node.worldMatrix,X=0;X<v.length;X++)S[X]||(S[X]=new e8),e8.transformMat4(S[X],v[X],O);return S.length=v.length,this._worldPoints}}]),e}($X),$Z=function(){function t1(){this._b2joint=null,this._jointComp=null,this._body=null,this._inited=!1}var g=t1.prototype;return g.initialize=function(g){this._jointComp=g},g.onEnable=function(){Jm.instance._callAfterStep(this,this._init)},g.onDisable=function(){Jm.instance._callAfterStep(this,this._destroy)},g.start=function(){Jm.instance._callAfterStep(this,this._init)},g.apply=function(){Jm.instance._callAfterStep(this,this._destroy),this.comp.enabledInHierarchy&&Jm.instance._callAfterStep(this,this._init)},g._init=function(){if(!this._inited){var g=this._jointComp;if(g.isValid){this._body=g.getComponent(Q7);var v=this._createJointDef();if(v){v.bodyA=this._body.impl.impl;var S=g.connectedBody;S&&!S.enabledInHierarchy||(v.bodyB=S?S.impl.impl:Jm.instance.physicsWorld.groundBodyImpl,v.collideConnected=g.collideConnected,this._b2joint=Jm.instance.physicsWorld.impl.CreateJoint(v),this._inited=!0)}}}},g._destroy=function(){this._inited&&(Jm.instance.physicsWorld.impl.DestroyJoint(this._b2joint),this._b2joint=null,this._inited=!1)},g._createJointDef=function(){return null},g.isValid=function(){return this._b2joint&&this._body&&this._body.impl&&this._jointComp},n(t1,[{key:"impl",get:function(){return this._b2joint}},{key:"comp",get:function(){return this._jointComp}},{key:"body",get:function(){return this._body}}]),t1}(),$Q=new KE.Vec2,$$=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._touchPoint=new e8,v._isTouched=!1,v}s(e,g);var v=e.prototype;return v.setTarget=function(g){this._b2joint&&($Q.x=g.x/Kc,$Q.y=g.y/Kc,this._b2joint.SetTarget($Q))},v.setDampingRatio=function(g){this._b2joint&&this._b2joint.SetDampingRatio(g)},v.setFrequency=function(g){this._b2joint&&this._b2joint.SetFrequency(g)},v.setMaxForce=function(g){this._b2joint&&this._b2joint.SetMaxForce(g)},v._createJointDef=function(){var g=new KE.MouseJointDef,v=this._jointComp;return g.target.Set(this._touchPoint.x/Kc,this._touchPoint.y/Kc),g.maxForce=v.maxForce,g.dampingRatio=v.dampingRatio,g.frequencyHz=v.frequency,g},v.initialize=function(v){g.prototype.initialize.call(this,v);var S=VM("Canvas");S&&(S.on(md.TOUCH_START,this.onTouchBegan,this),S.on(md.TOUCH_MOVE,this.onTouchMove,this),S.on(md.TOUCH_END,this.onTouchEnd,this),S.on(md.TOUCH_CANCEL,this.onTouchEnd,this))},v.onEnable=function(){},v.start=function(){},v.onTouchBegan=function(g){this._isTouched=!0;var v=this._touchPoint.set(g.getUILocation()),S=Jm.instance.physicsWorld.testPoint(v);if(!(S.length<=0)){var O=S[0].body;O.wakeUp();var X=this._jointComp;X.connectedBody=O,this._init(),this.setMaxForce(X.maxForce*O.getMass()),this.setTarget(v)}},v.onTouchMove=function(g){this._touchPoint=g.getUILocation()},v.onTouchEnd=function(){this._destroy(),this._isTouched=!1},v.update=function(){this._isTouched&&this.isValid()&&this.setTarget(this._touchPoint)},e}($Z),$0=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.setMaxLength=function(g){this._b2joint&&this._b2joint.SetMaxLength(g)},v._createJointDef=function(){var g=this._jointComp,v=new KE.RopeJointDef;return v.localAnchorA.Set(g.anchor.x/Kc,g.anchor.y/Kc),v.localAnchorB.Set(g.connectedAnchor.x/Kc,g.connectedAnchor.y/Kc),v.maxLength=g.maxLength/Kc,v},e}($Z),$1=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.setDampingRatio=function(g){this._b2joint&&this._b2joint.SetDampingRatio(g)},v.setFrequency=function(g){this._b2joint&&this._b2joint.SetFrequency(g)},v.setDistance=function(g){this._b2joint&&this._b2joint.SetLength(g)},v._createJointDef=function(){var g=this._jointComp,v=new KE.DistanceJointDef;return v.localAnchorA.Set(g.anchor.x/Kc,g.anchor.y/Kc),v.localAnchorB.Set(g.connectedAnchor.x/Kc,g.connectedAnchor.y/Kc),v.length=g.distance/Kc,v.dampingRatio=g.dampingRatio,v.frequencyHz=g.frequency,v},e}($Z),$2=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.setMaxForce=function(g){this._b2joint&&this._b2joint.SetMaxForce(g)},v.setAngularOffset=function(g){this._b2joint&&this._b2joint.SetAngularOffset(yi(g))},v.setLinearOffset=function(g){this._b2joint&&this._b2joint.SetLinearOffset(new KE.Vec2(g.x/Kc,g.y/Kc))},v.setCorrectionFactor=function(g){this._b2joint&&(this._b2joint.m_correctionFactor=g)},v.setMaxTorque=function(g){this._b2joint&&this._b2joint.SetMaxTorque(g)},v._createJointDef=function(){var g=this._jointComp,v=new KE.MotorJointDef;return v.linearOffset.Set(g.linearOffset.x/Kc,g.linearOffset.y/Kc),v.angularOffset=yi(g.angularOffset),v.maxForce=g.maxForce,v.maxTorque=g.maxTorque,v.correctionFactor=g.correctionFactor,v},e}($Z),$5=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.enableLimit=function(g){this._b2joint&&this._b2joint.EnableLimit(g)},v.setLowerLimit=function(){this.updateLimits()},v.setUpperLimit=function(){this.updateLimits()},v.updateLimits=function(){if(this._b2joint){var g=this._jointComp;this._b2joint.SetLimits(g.lowerLimit/Kc,g.upperLimit/Kc)}},v.enableMotor=function(g){this._b2joint&&this._b2joint.EnableMotor(g)},v.setMaxMotorForce=function(g){this._b2joint&&this._b2joint.SetMaxMotorForce(g)},v.setMotorSpeed=function(g){this._b2joint&&this._b2joint.SetMotorSpeed(g)},v._createJointDef=function(){var g=this._jointComp,v=new KE.PrismaticJointDef;v.localAnchorA.Set(g.anchor.x/Kc,g.anchor.y/Kc),v.localAnchorB.Set(g.connectedAnchor.x/Kc,g.connectedAnchor.y/Kc);var S=yi(g.angle);return v.localAxisA.Set(Math.cos(S),Math.sin(S)),v.referenceAngle=0,v.enableLimit=g.enableLimit,v.lowerTranslation=g.lowerLimit/Kc,v.upperTranslation=g.upperLimit/Kc,v.enableMotor=g.enableMotor,v.maxMotorForce=g.maxMotorForce,v.motorSpeed=g.motorSpeed,v},e}($Z),$4=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.setFrequency=function(g){this._b2joint&&this._b2joint.SetFrequency(g)},v.setDampingRatio=function(g){this._b2joint&&this._b2joint.SetDampingRatio(g)},v._createJointDef=function(){var g=this._jointComp,v=new KE.WeldJointDef;return v.localAnchorA.Set(g.anchor.x/Kc,g.anchor.y/Kc),v.localAnchorB.Set(g.connectedAnchor.x/Kc,g.connectedAnchor.y/Kc),v.referenceAngle=0,v.frequencyHz=g.frequency,v.dampingRatio=g.dampingRatio,v},e}($Z),$8=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.setDampingRatio=function(g){this._b2joint&&this._b2joint.SetSpringDampingRatio(g)},v.setFrequency=function(g){this._b2joint&&this._b2joint.SetSpringFrequencyHz(g)},v.enableMotor=function(g){this._b2joint&&this._b2joint.EnableMotor(g)},v.setMaxMotorTorque=function(g){this._b2joint&&this._b2joint.SetMaxMotorTorque(g)},v.setMotorSpeed=function(g){this._b2joint&&this._b2joint.SetMotorSpeed(g)},v._createJointDef=function(){var g=this._jointComp,v=new KE.WheelJointDef;v.localAnchorA.Set(g.anchor.x/Kc,g.anchor.y/Kc),v.localAnchorB.Set(g.connectedAnchor.x/Kc,g.connectedAnchor.y/Kc);var S=yi(g.angle);return v.localAxisA.Set(Math.cos(S),Math.sin(S)),v.maxMotorTorque=g.maxMotorTorque,v.motorSpeed=yi(g.motorSpeed),v.enableMotor=g.enableMotor,v.dampingRatio=g.dampingRatio,v.frequencyHz=g.frequency,v},e}($Z),$7=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.enableLimit=function(g){this._b2joint&&this._b2joint.EnableLimit(g)},v.setLowerAngle=function(){this.updateLimits()},v.setUpperAngle=function(){this.updateLimits()},v.updateLimits=function(){if(this._b2joint){var g=this._jointComp;this._b2joint.SetLimits(yi(g.lowerAngle),yi(g.upperAngle))}},v.enableMotor=function(g){this._b2joint&&this._b2joint.EnableMotor(g)},v.setMaxMotorTorque=function(g){this._b2joint&&this._b2joint.SetMaxMotorTorque(g)},v.setMotorSpeed=function(g){this._b2joint&&this._b2joint.SetMotorSpeed(g)},v._createJointDef=function(){var g=this._jointComp,v=new KE.RevoluteJointDef;return v.localAnchorA.Set(g.anchor.x/Kc,g.anchor.y/Kc),v.localAnchorB.Set(g.connectedAnchor.x/Kc,g.connectedAnchor.y/Kc),v.enableMotor=g.enableMotor,v.maxMotorTorque=g.maxMotorTorque,v.motorSpeed=yi(g.motorSpeed),v.enableLimit=g.enableLimit,v.lowerAngle=yi(g.lowerAngle),v.upperAngle=yi(g.upperAngle),v},e}($Z);IL.once(IO.EVENT_PRE_SUBSYSTEM_INIT,function(){K_.register("box2d",{PhysicsWorld:$O,RigidBody:$G,BoxShape:$q,CircleShape:$Y,PolygonShape:$J,MouseJoint:$$,DistanceJoint:$0,SpringJoint:$1,RelativeJoint:$2,SliderJoint:$5,FixedJoint:$4,WheelJoint:$8,HingeJoint:$7})}),function(g){var v,S,O,X,Y,te,ti,tr,ta,th;(v=g.MixBlend||(g.MixBlend={}))[v.setup=0]="setup",v[v.first=1]="first",v[v.replace=2]="replace",v[v.add=3]="add",(S=g.MixDirection||(g.MixDirection={}))[S.mixIn=0]="mixIn",S[S.mixOut=1]="mixOut",(O=g.TimelineType||(g.TimelineType={}))[O.rotate=0]="rotate",O[O.translate=1]="translate",O[O.scale=2]="scale",O[O.shear=3]="shear",O[O.attachment=4]="attachment",O[O.color=5]="color",O[O.deform=6]="deform",O[O.event=7]="event",O[O.drawOrder=8]="drawOrder",O[O.ikConstraint=9]="ikConstraint",O[O.transformConstraint=10]="transformConstraint",O[O.pathConstraintPosition=11]="pathConstraintPosition",O[O.pathConstraintSpacing=12]="pathConstraintSpacing",O[O.pathConstraintMix=13]="pathConstraintMix",O[O.twoColor=14]="twoColor",function(g){g[g.start=0]="start",g[g.interrupt=1]="interrupt",g[g.end=2]="end",g[g.dispose=3]="dispose",g[g.complete=4]="complete",g[g.event=5]="event"}(g.EventType||(g.EventType={})),(X=g.BlendMode||(g.BlendMode={}))[X.Normal=0]="Normal",X[X.Additive=1]="Additive",X[X.Multiply=2]="Multiply",X[X.Screen=3]="Screen",(Y=g.TransformMode||(g.TransformMode={}))[Y.Normal=0]="Normal",Y[Y.OnlyTranslation=1]="OnlyTranslation",Y[Y.NoRotationOrReflection=2]="NoRotationOrReflection",Y[Y.NoScale=3]="NoScale",Y[Y.NoScaleOrReflection=4]="NoScaleOrReflection",(te=g.PositionMode||(g.PositionMode={}))[te.Fixed=0]="Fixed",te[te.Percent=1]="Percent",(ti=g.SpacingMode||(g.SpacingMode={}))[ti.Length=0]="Length",ti[ti.Fixed=1]="Fixed",ti[ti.Percent=2]="Percent",(tr=g.RotateMode||(g.RotateMode={}))[tr.Tangent=0]="Tangent",tr[tr.Chain=1]="Chain",tr[tr.ChainScale=2]="ChainScale",(ta=g.TextureFilter||(g.TextureFilter={}))[ta.Nearest=9728]="Nearest",ta[ta.Linear=9729]="Linear",ta[ta.MipMap=9987]="MipMap",ta[ta.MipMapNearestNearest=9984]="MipMapNearestNearest",ta[ta.MipMapLinearNearest=9985]="MipMapLinearNearest",ta[ta.MipMapNearestLinear=9986]="MipMapNearestLinear",ta[ta.MipMapLinearLinear=9987]="MipMapLinearLinear",(th=g.TextureWrap||(g.TextureWrap={}))[th.MirroredRepeat=33648]="MirroredRepeat",th[th.ClampToEdge=33071]="ClampToEdge",th[th.Repeat=10497]="Repeat",function(g){g[g.Region=0]="Region",g[g.BoundingBox=1]="BoundingBox",g[g.Mesh=2]="Mesh",g[g.LinkedMesh=3]="LinkedMesh",g[g.Path=4]="Path",g[g.Point=5]="Point",g[g.Clipping=6]="Clipping"}(g.AttachmentType||(g.AttachmentType={}))}($z||($z={}));var $9=$z,ttt=0,tte=0,tti=function(){function t1(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t1.getListeners=function(g,v){if(!g.listener){g.listener=new t1;var S=++tte;v.setTrackEntryListener(S,g),t1._trackSet.set(S,g)}return g.listener},t1.emitListener=function(g,v,S){var O=t1._listenerSet.get(g);O&&O&&O(v,S)},t1.emitTrackEntryListener=function(g,v,S,O){var X=this._trackSet.get(g);if(X)switch(O){case $9.EventType.start:X.listener.start&&X.listener.start(v);break;case $9.EventType.interrupt:X.listener.interrupt&&X.listener.interrupt(v);break;case $9.EventType.end:X.listener.end&&X.listener.end(v);break;case $9.EventType.dispose:X.listener.dispose&&X.listener.dispose(v),this._trackSet.delete(g),X.listener=null;break;case $9.EventType.complete:X.listener.complete&&X.listener.complete(v);break;case $9.EventType.event:X.listener.event&&X.listener.event(v,S);break;default:G("TrackEntry doesn't handled",O)}},t1.addListener=function(g){var v=++ttt;return t1._listenerSet.set(v,g),v},t1}();function z7(g,v){return g?v===g.length?g:v<g.length?g.slice(0,v):new Array(v):new Array(v)}function W7(g,v,S){var O="_"+S;Object.defineProperty(g,S,{get:function(){var g=v.call(this),S=g.size(),X=this[O];X=z7(X,S);for(var Y=0;Y<S;Y++)X[Y]=g.get(Y);return this[O]=X,X}})}tti._listenerSet=new Map,tti._trackSet=new Map,globalThis.TrackEntryListeners=tti;var ttn,ttr=null,tts=[];IL.onPostInfrastructureInitDelegate.add(function(){return Promise.resolve().then(function(){return a3.hasFeature(a3.Feature.WASM)?Promise.all([v.import("./spine.wasm-3ab93163.js"),v.import("./spine-9a8528df.js")]).then(function(g){var v,S;return v=g[0].default,S=g[1].default,new Promise(function(g,O){var _$r=function(g){return"[Spine]: Spine wasm load failed: "+g};v({instantiateWasm:function(g,v){(function(g,v){return tF(g).then(function(g){return WebAssembly.instantiate(g,v)})})(S,g).then(function(g){v(g.instance,g.module)}).catch(function(g){return O(_$r(g))})}}).then(function(g){ttr=g,tts.forEach(function(g){g(ttr)})}).then(g).catch(function(g){return O(_$r(g))})})}):Promise.all([v.import("./spine.asm-97b906da.js"),v.import("./spine.js-6d0b02e3.js")]).then(function(g){var v,S;return v=g[0].default,S=g[1].default,new Promise(function(g,O){tF(S).then(function(g){var S={};return S.buffer=new ArrayBuffer(0x2000000),v({wasmMemory:S,memoryInitializerRequest:{response:g,status:200}}).then(function(g){ttr=g,tts.forEach(function(g){g(ttr)})})}).then(g).catch(O)})})}).catch(function(g){k(g)})}),tts.push(function(g){var v;(function(g){$9.wasmUtil=g.SpineWasmUtil,$9.wasmUtil.wasm=g,$9.wasmUtil.spineWasmInit(),$9.SPVectorFloat=g.SPVectorFloat,$9.MathUtils=g.MathUtils,$9.Color=g.Color,$9.String=g.String,$9.Vector2=g.Vector2,$9.Interpolation=g.Interpolation,$9.Triangulator=g.Triangulator,$9.ConstraintData=g.ConstraintData,$9.IkConstraintData=g.IkConstraintData,$9.PathConstraintData=g.PathConstraintData,$9.SkeletonBounds=g.SkeletonBounds,$9.Event=g.Event,$9.EventData=g.EventData,$9.Attachment=g.Attachment,$9.VertexAttachment=g.VertexAttachment,$9.BoundingBoxAttachment=g.BoundingBoxAttachment,$9.ClippingAttachment=g.ClippingAttachment,$9.MeshAttachment=g.MeshAttachment,$9.PathAttachment=g.PathAttachment,$9.PointAttachment=g.PointAttachment,$9.RegionAttachment=g.RegionAttachment,$9.AtlasAttachmentLoader=g.AtlasAttachmentLoader,$9.TextureAtlasPage=g.TextureAtlasPage,$9.TextureAtlasRegion=g.TextureAtlasRegion,$9.TextureAtlas=g.TextureAtlas,$9.PowOut=g.PowOut,$9.BoneData=g.BoneData,$9.SlotData=g.SlotData,$9.Updatable=g.Updatable,$9.IkConstraint=g.IkConstraint,$9.PathConstraint=g.PathConstraint,$9.TransformConstraintData=g.TransformConstraintData,$9.TransformConstraint=g.TransformConstraint,$9.Bone=g.Bone,$9.Slot=g.Slot,$9.Skin=g.Skin,$9.SkinEntry=g.SkinEntry,$9.SkeletonClipping=g.SkeletonClipping,$9.SkeletonData=g.SkeletonData,$9.TranslateTimeline=g.TranslateTimeline,$9.ScaleTimeline=g.ScaleTimeline,$9.ShearTimeline=g.ShearTimeline,$9.RotateTimeline=g.RotateTimeline,$9.ColorTimeline=g.ColorTimeline,$9.TwoColorTimeline=g.TwoColorTimeline,$9.AttachmentTimeline=g.AttachmentTimeline,$9.DeformTimeline=g.DeformTimeline,$9.EventTimeline=g.EventTimeline,$9.DrawOrderTimeline=g.DrawOrderTimeline,$9.IkConstraintTimeline=g.IkConstraintTimeline,$9.TransformConstraintTimeline=g.TransformConstraintTimeline,$9.PathConstraintPositionTimeline=g.PathConstraintPositionTimeline,$9.PathConstraintMixTimeline=g.PathConstraintMixTimeline,$9.TrackEntry=g.TrackEntry,$9.AnimationStateData=g.AnimationStateData,$9.AnimationState=g.AnimationState,$9.Animation=g.Animation,$9.EventQueue=g.EventQueue,$9.AnimationStateAdapter=g.AnimationStateAdapter,$9.Skeleton=g.Skeleton,$9.SkeletonBinary=g.SkeletonBinary,$9.SkeletonJson=g.SkeletonJson,$9.VertexEffect=g.VertexEffect,$9.JitterEffect=g.JitterEffect,$9.SwirlEffect=g.SwirlEffect,$9.SkeletonInstance=g.SkeletonInstance,$9.SkeletonSystem=g.SkeletonSystem})(g),[{proto:v=$9.String.prototype,property:"length",getter:v.length},{proto:v,property:"isEmpty",getter:v.isEmpty},{proto:v,property:"str",getter:v.str}].forEach(function(g){tB(g.proto,g.property,g.getter)}),function(g,v){Object.defineProperty(g,"strPtr",{value:function(){var g=v.call(this),S=$9.wasmUtil.wasm.HEAPU8,O=this.length,X=S.subarray(g,g+O);return String.fromCharCode.apply(String,X)}})}(v,v.strPtr),function(){var g=$9.Vector2.prototype;[{proto:g,property:"x",getter:g.getX,setter:g.setX},{proto:g,property:"y",getter:g.getY,setter:g.setY}].forEach(function(g){tB(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.BoneData.prototype;[{proto:g,property:"index",getter:g.getIndex},{proto:g,property:"name",getter:g.getName},{proto:g,property:"parent",getter:g.getParent},{proto:g,property:"length",getter:g.getLength,setter:g.setLength},{proto:g,property:"x",getter:g.getX,setter:g.setX},{proto:g,property:"y",getter:g.getY,setter:g.setY},{proto:g,property:"rotation",getter:g.getRotation,setter:g.setRotation},{proto:g,property:"scaleX",getter:g.getScaleX,setter:g.setScaleX},{proto:g,property:"scaleY",getter:g.getScaleY,setter:g.setScaleY},{proto:g,property:"shearX",getter:g.getShearX,setter:g.setShearX},{proto:g,property:"shearY",getter:g.getShearY,setter:g.setShearY},{proto:g,property:"transformMode",getter:g.getTransformMode,setter:g.setTransformMode},{proto:g,property:"skinRequired",getter:g.getSkinRequired,setter:g.setSkinRequired}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.ConstraintData.prototype;[{proto:g,property:"name",getter:g.getName},{proto:g,property:"order",getter:g.getOrder,setter:g.setOder},{proto:g,property:"skinRequired",getter:g.getSkinRequired,setter:g.setSkinRequired}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.IkConstraintData.prototype;[{proto:g,property:"target",getter:g.getTarget,setter:g.setTarget},{proto:g,property:"bendDirection",getter:g.getBendDirection,setter:g.setBendDirection},{proto:g,property:"compress",getter:g.getCompress,setter:g.setCompress},{proto:g,property:"stretch",getter:g.getStretch,setter:g.setStretch},{proto:g,property:"uniform",getter:g.getUniform,setter:g.setUniform},{proto:g,property:"mix",getter:g.getMix,setter:g.setMix},{proto:g,property:"softness",getter:g.getSoftness,setter:g.setSoftness}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getBones,"bones")}(),function(){var g=$9.PathConstraintData.prototype;[{proto:g,property:"target",getter:g.getTarget,setter:g.setTarget},{proto:g,property:"positionMode",getter:g.getPositionMode,setter:g.setPositionMode},{proto:g,property:"spacingMode",getter:g.getSpacingMode,setter:g.setSpacingMode},{proto:g,property:"rotateMode",getter:g.getRotateMode,setter:g.setRotateMode},{proto:g,property:"offsetRotation",getter:g.getOffsetRotation,setter:g.setOffsetRotation},{proto:g,property:"position",getter:g.getPosition,setter:g.setPosition},{proto:g,property:"spacing",getter:g.getSpacing,setter:g.setSpacing},{proto:g,property:"rotateMix",getter:g.getRotateMix,setter:g.setRotateMix},{proto:g,property:"translateMix",getter:g.getTranslateMix,setter:g.setTranslateMix}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getBones,"bones")}(),function(){var g=$9.Event.prototype;[{proto:g,property:"data",getter:g.getData},{proto:g,property:"intValue",getter:g.getIntValue,setter:g.setIntValue},{proto:g,property:"floatValue",getter:g.getFloatValue,setter:g.setFloatValue},{proto:g,property:"stringValue",getter:g.getStringValue,setter:g.setStringValue},{proto:g,property:"time",getter:g.getTime},{proto:g,property:"volume",getter:g.getVolume,setter:g.setVolume},{proto:g,property:"balance",getter:g.getBalance,setter:g.setBalance}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.EventData.prototype;[{proto:g,property:"name",getter:g.getName},{proto:g,property:"intValue",getter:g.getIntValue,setter:g.setIntValue},{proto:g,property:"floatValue",getter:g.getFloatValue,setter:g.setFloatValue},{proto:g,property:"stringValue",getter:g.getStringValue,setter:g.setStringValue},{proto:g,property:"audioPath",getter:g.getAudioPath,setter:g.setAudioPath},{proto:g,property:"volume",getter:g.getVolume,setter:g.setVolume},{proto:g,property:"balance",getter:g.getBalance,setter:g.setBalance}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.BoundingBoxAttachment.prototype;[{proto:g,property:"name",getter:g.getName}].forEach(function(g){tI(g.proto,g.property,g.getter)})}(),function(){var g=$9.ClippingAttachment.prototype;[{proto:g,property:"endSlot",getter:g.getEndSlot,setter:g.setEndSlot}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.MeshAttachment.prototype;[{proto:g,property:"path",getter:g.getPath,setter:g.setPath},{proto:g,property:"color",getter:g.getColor},{proto:g,property:"width",getter:g.getWidth,setter:g.setWidth},{proto:g,property:"height",getter:g.getHeight,setter:g.setHeight},{proto:g,property:"hullLength",getter:g.getHullLength,setter:g.setHullLength}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getRegionUVs,"regionUVs"),W7(g,g.getUVs,"uvs"),W7(g,g.getTriangles,"triangles"),W7(g,g.getEdges,"edges")}(),function(){var g=$9.PathAttachment.prototype;[{proto:g,property:"closed",getter:g.getClosed,setter:g.setClosed},{proto:g,property:"constantSpeed",getter:g.getConstantSpeed,setter:g.setConstantSpeed}].forEach(function(g){tI(g.proto,g.property,g.getter)}),W7(g,g.getLengths,"lengths")}(),function(){var g=$9.PointAttachment.prototype;[{proto:g,property:"x",getter:g.getX,setter:g.setX},{proto:g,property:"y",getter:g.getY,setter:g.setY},{proto:g,property:"rotation",getter:g.getRotation,setter:g.setRotation}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.RegionAttachment.prototype;[{proto:g,property:"x",getter:g.getX,setter:g.setX},{proto:g,property:"y",getter:g.getY,setter:g.setY},{proto:g,property:"scaleX",getter:g.getScaleX,setter:g.setScaleX},{proto:g,property:"scaleY",getter:g.getScaleY,setter:g.setScaleY},{proto:g,property:"rotation",getter:g.getRotation,setter:g.setRotation},{proto:g,property:"width",getter:g.getWidth,setter:g.setWidth},{proto:g,property:"height",getter:g.getHeight,setter:g.setHeight},{proto:g,property:"color",getter:g.getColor},{proto:g,property:"path",getter:g.getPath,setter:g.setPath},{proto:g,property:"rendererObject",getter:g.getRendererObject}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getOffset,"offset");var v=g.getUVs,S=g.setUVs;Object.defineProperty(g,"uvs",{get:function(){var S=v.call(this),O=S.size(),X=g._uvs;X=z7(X,O);for(var Y=0;Y<O;Y++)X[Y]=S.get(Y);return g._uvs=X,X},set:function(g){S.call(this,g[0],g[1],g[2],g[3],1===g[4])}});var O=g.computeWorldVertices,X=new $9.SPVectorFloat;Object.defineProperty(g,"computeWorldVertices",{value:function(g,v,S,Y){var te=v.length;X.resize(te,0);for(var ti=0;ti<te;ti++)X.set(ti,v[ti]);O.call(this,g,X,S,Y);for(var tr=0;tr<te;tr++)v[tr]=X.get(tr)}})}(),function(){var g=$9.VertexAttachment.prototype;[{proto:g,property:"id",getter:g.getId},{proto:g,property:"worldVerticesLength",getter:g.getWorldVerticesLength,setter:g.setWorldVerticesLength},{proto:g,property:"deformAttachment",getter:g.getDeformAttachment,setter:g.setDeformAttachment}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getBones,"bones"),W7(g,g.getVertices,"vertices");var v=g.computeWorldVertices,S=new $9.SPVectorFloat;Object.defineProperty(g,"computeWorldVertices",{value:function(g,O,X,Y,te,ti){var tr=Y.length;S.resize(tr,0);for(var ta=0;ta<tr;ta++)S.set(ta,Y[ta]);v.call(this,g,O,X,S,te,ti);for(var th=0;th<tr;th++)Y[th]=S.get(th)}})}(),function(){var g=$9.SlotData.prototype;[{proto:g,property:"index",getter:g.getIndex},{proto:g,property:"boneData",getter:g.getBoneData},{proto:g,property:"name",getter:g.getName},{proto:g,property:"color",getter:g.getColor},{proto:g,property:"darkColor",getter:g.getDarkColor},{proto:g,property:"blendMode",getter:g.getBlendMode,setter:g.setBlendMode}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.IkConstraint.prototype;[{proto:g,property:"data",getter:g.getData},{proto:g,property:"target",getter:g.getTarget,setter:g.setTarget},{proto:g,property:"bendDirection",getter:g.getBendDirection,setter:g.setBendDirection},{proto:g,property:"compress",getter:g.getCompress,setter:g.setCompress},{proto:g,property:"stretch",getter:g.getStretch,setter:g.setStretch},{proto:g,property:"mix",getter:g.getMix,setter:g.setMix},{proto:g,property:"softness",getter:g.getSoftness,setter:g.setSoftness},{proto:g,property:"active",getter:g.getActive,setter:g.setActive}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getBones,"bones")}(),function(){var g=$9.PathConstraint.prototype;[{proto:g,property:"data",getter:g.getData},{proto:g,property:"target",getter:g.getTarget,setter:g.setTarget},{proto:g,property:"position",getter:g.getPosition,setter:g.setPosition},{proto:g,property:"spacing",getter:g.getSpacing,setter:g.setSpacing},{proto:g,property:"rotateMix",getter:g.getRotateMix,setter:g.setRotateMix},{proto:g,property:"translateMix",getter:g.getTranslateMix,setter:g.setTranslateMix},{proto:g,property:"active",getter:g.getActive,setter:g.setActive}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getBones,"bones")}(),function(){var g=$9.TransformConstraintData.prototype;[{proto:g,property:"target",getter:g.getTarget},{proto:g,property:"rotateMix",getter:g.getRotateMix},{proto:g,property:"translateMix",getter:g.getTranslateMix},{proto:g,property:"scaleMix",getter:g.getScaleMix},{proto:g,property:"shearMix",getter:g.getShearMix},{proto:g,property:"offsetRotation",getter:g.getOffsetRotation},{proto:g,property:"offsetX",getter:g.getOffsetX},{proto:g,property:"offsetY",getter:g.getOffsetY},{proto:g,property:"offsetScaleX",getter:g.getOffsetScaleX},{proto:g,property:"offsetScaleY",getter:g.getOffsetScaleY},{proto:g,property:"offsetShearY",getter:g.getOffsetShearY},{proto:g,property:"relative",getter:g.getRelative},{proto:g,property:"local",getter:g.getLocal}].forEach(function(g){tI(g.proto,g.property,g.getter)}),W7(g,g.getBones,"bones")}(),function(){var g=$9.TransformConstraint.prototype;[{proto:g,property:"data",getter:g.getData},{proto:g,property:"target",getter:g.getTarget},{proto:g,property:"rotateMix",getter:g.getRotateMix,setter:g.setRotateMix},{proto:g,property:"translateMix",getter:g.getTranslateMix,setter:g.setTranslateMix},{proto:g,property:"scaleMix",getter:g.getScaleMix,setter:g.setScaleMix},{proto:g,property:"shearMix",getter:g.getShearMix,setter:g.setShearMix},{proto:g,property:"active",getter:g.getActive,setter:g.setActive}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getBones,"bones")}(),function(){var g=$9.Bone.prototype;[{proto:g,property:"skeleton",getter:g.getSkeleton},{proto:g,property:"data",getter:g.getData},{proto:g,property:"parent",getter:g.getParent},{proto:g,property:"x",getter:g.getX,setter:g.setX},{proto:g,property:"y",getter:g.getY,setter:g.setY},{proto:g,property:"rotation",getter:g.getRotation,setter:g.setRotation},{proto:g,property:"scaleX",getter:g.getScaleX,setter:g.setScaleX},{proto:g,property:"scaleY",getter:g.getScaleY,setter:g.setScaleY},{proto:g,property:"shearX",getter:g.getShearX,setter:g.setShearX},{proto:g,property:"shearY",getter:g.getShearY,setter:g.setShearY},{proto:g,property:"ax",getter:g.getAX,setter:g.setAX},{proto:g,property:"ay",getter:g.getAY,setter:g.setAY},{proto:g,property:"arotation",getter:g.getARotation,setter:g.setARotation},{proto:g,property:"ascaleX",getter:g.getAScaleX,setter:g.setAScaleX},{proto:g,property:"ascaleY",getter:g.getAScaleY,setter:g.setAScaleY},{proto:g,property:"ashearX",getter:g.getAShearX,setter:g.setAShearX},{proto:g,property:"ashearY",getter:g.getAShearY,setter:g.setAShearY},{proto:g,property:"appliedValid",getter:g.getAppliedValid,setter:g.setAppliedValid},{proto:g,property:"a",getter:g.getA,setter:g.setA},{proto:g,property:"b",getter:g.getB,setter:g.setB},{proto:g,property:"c",getter:g.getC,setter:g.setC},{proto:g,property:"d",getter:g.getD,setter:g.setD},{proto:g,property:"worldX",getter:g.getWorldX,setter:g.setWorldX},{proto:g,property:"worldY",getter:g.getWorldY,setter:g.setWorldY},{proto:g,property:"active",getter:g.getActive,setter:g.setActive}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getChildren,"children")}(),function(){var g=$9.Slot.prototype;[{proto:g,property:"data",getter:g.getData},{proto:g,property:"bone",getter:g.getBone},{proto:g,property:"color",getter:g.getColor},{proto:g,property:"darkColor",getter:g.getDarkColor},{proto:g,property:"skeleton",getter:g.getSkeleton}].forEach(function(g){tI(g.proto,g.property,g.getter)}),W7(g,g.getDeform,"deform")}(),function(){var g=$9.Skin.prototype;[{proto:g,property:"name",getter:g.getName}].forEach(function(g){tI(g.proto,g.property,g.getter)}),W7(g,g.getBones,"bones"),W7(g,g.getAttachments,"attachments"),W7(g,g.getConstraints,"constraints"),function(g,v,S){var O="_"+S;Object.defineProperty(g,S,{value:function(){var g=v.call(this),S=g.size(),X=this[O];X=z7(X,S);for(var Y=0;Y<S;Y++)X[Y]=g.get(Y);return this[O]=X,X}})}(g,g.getAttachments,"getAttachments");var v=g.getAttachmentsForSlot;Object.defineProperty(g,"getAttachmentsForSlot",{value:function(g,S){var O=v.call(this,g),X=O.size();S=z7(S,X);for(var Y=0;Y<X;Y++)S[Y]=O.get(Y);O.delete()}});var S=g.findNamesForSlot;Object.defineProperty(g,"findNamesForSlot",{value:function(g,v){var O=S.call(this,g),X=O.size();v=z7(v,X);for(var Y=0;Y<X;Y++)v[Y]=O.get(Y);O.delete()}})}(),function(){var g=$9.Attachment.prototype;[{proto:g,property:"name",getter:g.getName}].forEach(function(g){tI(g.proto,g.property,g.getter)})}(),function(){var g=$9.SkinEntry.prototype;[{proto:g,property:"name",getter:g.getName},{proto:g,property:"attachment",getter:g.getAttachment}].forEach(function(g){tI(g.proto,g.property,g.getter)})}(),function(){var g=$9.SkeletonClipping.prototype;[{proto:g,property:"clippedVertices",getter:g.getClippedVertices},{proto:g,property:"clippedTriangles",getter:g.getClippedTriangles},{proto:g,property:"clippedUVs",getter:g.getClippedUVs}].forEach(function(g){tI(g.proto,g.property,g.getter)})}(),function(){var g=$9.SkeletonData.prototype;[{proto:g,property:"name",getter:g.getName},{proto:g,property:"defaultSkin",getter:g.getDefaultSkin,setter:g.setDefaultSkin},{proto:g,property:"x",getter:g.getX,setter:g.setX},{proto:g,property:"y",getter:g.getY,setter:g.setY},{proto:g,property:"width",getter:g.getWidth,setter:g.setWidth},{proto:g,property:"height",getter:g.getHeight,setter:g.setHeight},{proto:g,property:"version",getter:g.getVersion,setter:g.setVersion},{proto:g,property:"hash",getter:g.getHash,setter:g.setHash},{proto:g,property:"fps",getter:g.getFps,setter:g.setFps},{proto:g,property:"imagesPath",getter:g.getImagesPath,setter:g.setImagesPath},{proto:g,property:"audioPath",getter:g.getAudioPath,setter:g.setAudioPath}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getBones,"bones"),W7(g,g.getSlots,"slots"),W7(g,g.getSkins,"skins"),W7(g,g.getAnimations,"animations"),W7(g,g.getEvents,"events"),W7(g,g.getIkConstraints,"ikConstraints"),W7(g,g.getTransformConstraints,"transformConstraints"),W7(g,g.getPathConstraints,"pathConstraints")}(),function(){var g=$9.RotateTimeline.prototype;[{proto:g,property:"boneIndex",getter:g.getBoneIndex}].forEach(function(g){tI(g.proto,g.property,g.getter)}),W7(g,g.getFrames,"frames")}(),function(){var g=$9.ColorTimeline.prototype;[{proto:g,property:"slotIndex",getter:g.getSlotIndex}].forEach(function(g){tI(g.proto,g.property,g.getter)}),W7(g,g.getFrames,"frames")}(),function(){var g=$9.TwoColorTimeline.prototype;[{proto:g,property:"slotIndex",getter:g.getSlotIndex}].forEach(function(g){tI(g.proto,g.property,g.getter)})}(),function(){var g=$9.AttachmentTimeline.prototype;[{proto:g,property:"slotIndex",getter:g.getSlotIndex}].forEach(function(g){tI(g.proto,g.property,g.getter)}),W7(g,g.getFrames,"frames"),W7(g,g.getAttachmentNames,"attachmentNames")}(),function(){var g=$9.DeformTimeline.prototype;[{proto:g,property:"slotIndex",getter:g.getSlotIndex},{proto:g,property:"attachment",getter:g.getAttachment}].forEach(function(g){tI(g.proto,g.property,g.getter)}),W7(g,g.getFrames,"frames"),function(g,v,S){var O="_"+S;Object.defineProperty(g,S,{get:function(){var g=v.call(this),S=g.size(),X=this[O];X=z7(X,S);for(var Y=0;Y<S;Y++){var te=g.get(Y),ti=te.size(),tr=X[Y];tr=z7(tr,ti);for(var ta=0;ta<ti;ta++)tr[ta]=te.get(ta);X[Y]=tr}return this[O]=X,X}})}(g,g.getFrameVertices,"frameVertices")}(),function(){var g=$9.EventTimeline.prototype;W7(g,g.getFrames,"frames"),W7(g,g.getEvents,"events")}(),function(){var g=$9.DrawOrderTimeline.prototype;W7(g,g.getFrames,"frames")}(),function(){var g=$9.TrackEntry.prototype;[{proto:g,property:"animation",getter:g.getAnimation},{proto:g,property:"next",getter:g.getNext},{proto:g,property:"mixingFrom",getter:g.getMixingFrom},{proto:g,property:"mixingTo",getter:g.getMixingTo},{proto:g,property:"trackIndex",getter:g.getTrackIndex},{proto:g,property:"loop",getter:g.getLoop,setter:g.setLoop},{proto:g,property:"holdPrevious",getter:g.getHoldPrevious,setter:g.setHoldPrevious},{proto:g,property:"eventThreshold",getter:g.getEventThreshold,setter:g.setEventThreshold},{proto:g,property:"attachmentThreshold",getter:g.getAttachmentThreshold,setter:g.setAttachmentThreshold},{proto:g,property:"drawOrderThreshold",getter:g.getDrawOrderThreshold,setter:g.setDrawOrderThreshold},{proto:g,property:"animationStart",getter:g.getAnimationStart,setter:g.setAnimationStart},{proto:g,property:"animationEnd",getter:g.getAnimationEnd,setter:g.setAnimationEnd},{proto:g,property:"animationLast",getter:g.getAnimationLast,setter:g.setAnimationLast},{proto:g,property:"delay",getter:g.getDelay,setter:g.setDelay},{proto:g,property:"trackTime",getter:g.getTrackTime,setter:g.setTrackTime},{proto:g,property:"trackEnd",getter:g.getTrackEnd,setter:g.setTrackEnd},{proto:g,property:"timeScale",getter:g.getTimeScale,setter:g.setTimeScale},{proto:g,property:"alpha",getter:g.getAlpha,setter:g.setAlpha},{proto:g,property:"mixTime",getter:g.getMixTime,setter:g.setMixTime},{proto:g,property:"mixDuration",getter:g.getMixDuration,setter:g.setMixDuration},{proto:g,property:"mixBlend",getter:g.getMixBlend,setter:g.setMixBlend}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.AnimationStateData.prototype;[{proto:g,property:"defaultMix",getter:g.getDefaultMix},{proto:g,property:"skeletonData",getter:g.getSkeletonData}].forEach(function(g){tI(g.proto,g.property,g.getter)})}(),function(){var g=$9.AnimationState.prototype;[{proto:g,property:"data",getter:g.getData},{proto:g,property:"timeScale",getter:g.getTimeScale,setter:g.setTimeScale}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getTracks,"tracks")}(),function(){var g=$9.Animation.prototype;[{proto:g,property:"name",getter:g.getName},{proto:g,property:"duration",getter:g.getDuration,setter:g.setDuration}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getTimelines,"timelines")}(),function(){var g=$9.Skeleton.prototype;[{proto:g,property:"data",getter:g.getData},{proto:g,property:"skin",getter:g.getSkin},{proto:g,property:"color",getter:g.getColor},{proto:g,property:"time",getter:g.getTime},{proto:g,property:"scaleX",getter:g.getScaleX,setter:g.setScaleX},{proto:g,property:"scaleY",getter:g.getScaleY,setter:g.setScaleY},{proto:g,property:"x",getter:g.getX,setter:g.setX},{proto:g,property:"y",getter:g.getY,setter:g.setY}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)}),W7(g,g.getBones,"bones"),W7(g,g.getSlots,"slots"),W7(g,g.getDrawOrder,"drawOrder"),W7(g,g.getIkConstraints,"ikConstraints"),W7(g,g.getTransformConstraints,"transformConstraints"),W7(g,g.getPathConstraints,"pathConstraints"),W7(g,g.getUpdateCacheList,"_updateCache")}(),function(){var g=$9.JitterEffect.prototype;[{proto:g,property:"jitterX",getter:g.getJitterX,setter:g.setJitterX},{proto:g,property:"jitterY",getter:g.getJitterY,setter:g.setJitterY}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}(),function(){var g=$9.SwirlEffect.prototype;[{proto:g,property:"centerX",getter:g.getCenterX,setter:g.setCenterX},{proto:g,property:"centerY",getter:g.getCenterY,setter:g.setCenterY},{proto:g,property:"radius",getter:g.getRadius,setter:g.setRadius},{proto:g,property:"angle",getter:g.getAngle,setter:g.setAngle}].forEach(function(g){tI(g.proto,g.property,g.getter,g.setter)})}()});var tta=1/60;KN(Pu);var tto,tth,ttu,ttl,ttc,tt_,ttf,ttd,ttp,ttm,ttg=KN(Pc),a9=function(){this.a=0,this.b=0,this.c=0,this.d=0,this.worldX=0,this.worldY=0},o9=function(){this.vCount=0,this.iCount=0,this.vData=null,this.iData=null,this.meshes=[]},h9=function(){this.iCount=0,this.blendMode=0,this.textureID=0},ttv=function(){function t1(g){this._instance=null,this._state=null,this._skeletonData=null,this._skeleton=null,this._privateMode=!1,this._curIndex=-1,this._isCompleted=!1,this._maxFrameIdex=0,this._frameIdx=-1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._skeletonInfo=null,this._animationName=null,this.isCompleted=!1,this.totalTime=0,this.frames=[],this._privateMode=!1,this._inited=!1,this._invalid=!0,this._instance=new $9.SkeletonInstance,this._instance.isCache=!0,this._skeletonData=g,this._skeleton=this._instance.initSkeleton(g),this._instance.setUseTint(!0)}var g=t1.prototype;return g.init=function(g,v){this._inited=!0,this._animationName=v,this._skeletonInfo=g},g.setSkin=function(g){this._skeleton&&this._skeleton.setSkinByName(g),this._instance.setSkin(g)},g.setAnimation=function(g){var v=this._skeletonData.animations,S=null;v.forEach(function(v){v.name===g&&(S=v)}),S?(this._maxFrameIdex=Math.floor(S.duration/tta),this._maxFrameIdex<=0&&(this._maxFrameIdex=1),this._instance.setAnimation(0,g,!1)):G("find no animation named "+g+" !!!")},g.updateToFrame=function(g){if(this._inited&&(this.begin(),this.needToUpdate(g)))do{this._frameIdx++,this.totalTime+=tta,this._instance.updateAnimation(tta);var v=this._instance.updateRenderData();this.updateRenderData(this._frameIdx,v),this._frameIdx>=this._maxFrameIdex&&(this.isCompleted=!0)}while(this.needToUpdate(g))},g.getFrame=function(g){var v=g%this._maxFrameIdex;return this.frames[v]},g.invalidAnimationFrames=function(){this._curIndex=-1,this._isCompleted=!1,this.frames.length=0},g.updateRenderData=function(g,v){var S=v.vCount,O=v.iCount,X=ttg/Float32Array.BYTES_PER_ELEMENT,Y=new Uint8Array(Float32Array.BYTES_PER_ELEMENT*X*S),te=new Uint16Array(O),ti=$9.wasmUtil.wasm.HEAPU8,tr=v.vPtr,ta=S*Float32Array.BYTES_PER_ELEMENT*X;Y.set(ti.subarray(tr,tr+ta));var th=v.iPtr,tu=Uint16Array.BYTES_PER_ELEMENT*O;new Uint8Array(te.buffer).set(ti.subarray(th,th+tu));var tl=new o9;tl.vCount=S,tl.iCount=O,tl.vData=Y,tl.iData=te;for(var tc=v.getData(),t_=tc.size(),tf=0;tf<t_;tf+=6){var tp=new h9;tp.iCount=tc.get(tf+3),tp.blendMode=tc.get(tf+4),tp.textureID=tc.get(tf+5),tl.meshes.push(tp)}var tm=this._skeleton.bones,tg=[];tm.forEach(function(g){var v=new a9;v.a=g.a,v.b=g.b,v.c=g.c,v.d=g.d,v.worldX=g.worldX,v.worldY=g.worldY,tg.push(v)}),this.frames[g]={model:tl,boneInfos:tg}},g.begin=function(){if(this._invalid){var g=this._skeletonInfo,v=null==g?void 0:g.curAnimationCache;v&&v!==this&&(this._privateMode?v.invalidAllFrame():v.updateToFrame(0));var S=null==g?void 0:g.listener;this._instance.setAnimation(0,this._animationName,!1),this.bind(S),g.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},g.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},g.bind=function(g){var v=this;g.complete=function(g){g&&g.animation.name===v._animationName&&(v.isCompleted=!0)}},g.unbind=function(g){g.complete=null},g.needToUpdate=function(g){return!this.isCompleted&&this.totalTime<30&&(void 0===g||this._frameIdx<g)},g.isInited=function(){return this._inited},g.isInvalid=function(){return this._invalid},g.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},g.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},g.clear=function(){this._inited=!1,this.invalidAllFrame()},g.destroy=function(){this._instance&&(this._instance.destroy(),this._instance=null)},n(t1,[{key:"skeleton",get:function(){return this._skeleton}}]),t1}(),tty=function(){function t1(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._sharedCacheMap=new Map,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var g=t1.prototype;return g.enablePrivateMode=function(){this._privateMode=!0},g.clear=function(){this._animationPool={},this._skeletonCache={}},g.invalidAnimationCache=function(g){var v=this._skeletonCache[g];if(v&&v.skeleton){var S=v.animationsCache;for(var O in S)S[O].invalidAllFrame()}},g.destroySkeleton=function(g){var v=this;if(!this._privateMode){var S=this._sharedCacheMap.get(g);if(S){if((S-=1)>0)return void this._sharedCacheMap.set(g,S);this._sharedCacheMap.delete(g)}}var O=this._privateMode?function(g,v){v.destroy()}:function(S,O){v._animationPool[g+"#"+S]=O,O.clear()},X=this._skeletonCache[g];if(X){var Y=X.animationsCache;for(var te in Y){var ti=Y[te];ti&&O(te,ti)}X.skeleton&&$9.wasmUtil.destroySpineSkeleton(X.skeleton),delete this._skeletonCache[g]}},g.createSkeletonInfo=function(g){var v=g.uuid,S=g.getRuntimeData();if(!this._privateMode){var O=this._sharedCacheMap.get(v);O?O+=1:O=1,this._sharedCacheMap.set(v,O)}if(this._skeletonCache[v])return this._skeletonCache[v];var X=new $9.Skeleton(S),Y=new tti;return this._skeletonCache[v]={skeleton:X,clipper:null,state:null,listener:Y,animationsCache:{},curAnimationCache:null,assetUUID:v}},g.getSkeletonInfo=function(g){var v=g.uuid;return this._skeletonCache[v]},g.getAnimationCache=function(g,v){var S=this._skeletonCache[g];return S?S.animationsCache[v]:null},g.initAnimationCache=function(g,v,S){var O=v.getRuntimeData();if(!O)return null;var X=this._skeletonCache[g];if(!X||!X.skeleton)return null;var Y=X.animationsCache,te=Y[S];if(!te){var ti=g+"#"+S;(te=this._animationPool[ti])?delete this._animationPool[ti]:(te=new ttv(O))._privateMode=this._privateMode,te.init(X,S),Y[S]=te}return te.init(X,S),te.setAnimation(S),te},g.destroyCachedAnimations=function(g){if(g){var v=this._animationPool;for(var S in v)S.includes(g)&&(v[S].destroy(),delete v[S])}else{var O=this._animationPool;for(var X in O)O[X].destroy(),delete O[X]}},t1}();ttn=tty,tty.FrameTime=tta,tty.sharedCache=new ttn;var ttS=(tto=nJ("sp.SkeletonData"),tth=ma([cK]),ttu=ma([er]),tto((ttc=function(g){function e(){var v;return(v=g.call(this)||this)._skeletonJson=tt_&&tt_(),v.textures=ttf&&ttf(),v.textureNames=ttd&&ttd(),v.scale=ttp&&ttp(),v._atlasText=ttm&&ttm(),v._buffer=void 0,v._skeletonCache=null,v._skinsEnum=null,v._animsEnum=null,v.reset(),v}s(e,g);var v=e.prototype;return v.createNode=function(g){var v=new mJ(this.name);return v.addComponent("cc.Skeleton").skeletonData=this,g(null,v)},v.reset=function(){this._skeletonCache=null},v.resetEnums=function(){},v.getRuntimeData=function(g){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return g||k(this.name+" no textures found!"),null;var v=$9.wasmUtil.querySpineSkeletonDataByUUID(this._uuid);if(v)this._skeletonCache=v;else if(this.skeletonJsonStr)this._skeletonCache=$9.wasmUtil.createSpineSkeletonDataWithJson(this.skeletonJsonStr,this._atlasText),$9.wasmUtil.registerSpineSkeletonDataWithUUID(this._skeletonCache,this._uuid);else{var S=new Uint8Array(this._nativeAsset),O=S.length,X=$9.wasmUtil.queryStoreMemory(O);$9.wasmUtil.wasm.HEAPU8.subarray(X,X+O).set(S),this._skeletonCache=$9.wasmUtil.createSpineSkeletonDataWithBinary(O,this._atlasText),$9.wasmUtil.registerSpineSkeletonDataWithUUID(this._skeletonCache,this._uuid)}return this._skeletonCache},v.getSkinsEnum=function(){if(this._skinsEnum)return this._skinsEnum;var g=this.getRuntimeData(!0);if(g){for(var v=g.skins,S={},O=0;O<v.length;O++)S[v[O].name]=O;return this._skinsEnum=re(S)}return null},v.getAnimsEnum=function(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;var g=this.getRuntimeData(!0);if(g){for(var v={"<None>":0},S=g.animations,O=0;O<S.length;O++)v[S[O].name]=O+1;return this._animsEnum=re(v)}return null},v.destroy=function(){return tty.sharedCache.destroyCachedAnimations(this._uuid),this._skeletonCache&&$9.wasmUtil.registerSpineSkeletonDataWithUUID(this._skeletonCache,this._uuid),g.prototype.destroy.call(this)},n(e,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(g){this.reset(),this._skeletonJson="string"==typeof g?JSON.parse(g):g,!this._uuid&&g.skeleton&&(this._uuid=g.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(g){this._atlasText=g,this.reset()}},{key:"_nativeAsset",get:function(){return this._buffer},set:function(g){this._buffer=g,this.reset()}}]),e}(lx),tt_=ws(ttc.prototype,"_skeletonJson",[n2],function(){return null}),ttf=ws(ttc.prototype,"textures",[n2,tth],function(){return[]}),ttd=ws(ttc.prototype,"textureNames",[n2,ttu],function(){return[]}),ttp=ws(ttc.prototype,"scale",[n2],function(){return 1}),ttm=ws(ttc.prototype,"_atlasText",[n2],function(){return""}),ttl=ttc))||ttl);X.internal.SpineSkeletonData=ttS;var ttA=function(g){function e(){var v;return(v=g.call(this)||this)._skeletons=new Set,v}s(e,g),e.getInstance=function(){return e._instance||(e._instance=new e,II.registerSystem(e.ID,e._instance,a8.Priority.HIGH)),e._instance};var v=e.prototype;return v.add=function(g){g&&(this._skeletons.has(g)||this._skeletons.add(g))},v.remove=function(g){g&&this._skeletons.has(g)&&this._skeletons.delete(g)},v.postUpdate=function(g){this._skeletons&&this._skeletons.forEach(function(v){v.updateAnimation(g)})},v.prepareRenderData=function(){this._skeletons&&this._skeletons.forEach(function(g){g.markForUpdateRenderData()})},e}(a8);ttA.ID="SKELETON",ttA._instance=void 0,X.internal.SpineSkeletonSystem=ttA;var ttT,ttE,ttC,ttx,ttb,ttR,ttw,ttI,ttB,ttP,ttD,ttM,ttO,ttL,ttF,ttN,ttk,ttG,ttV,ttU,ttH,ttz,ttW,ttX,ttj,ttq,ttY,ttK,ttJ,ttZ,ttQ,tt$,tt0,tt1,tt2=new e$,tt3=function(){function t1(){this._isInitialized=!1,this._skeletonBones=null,this._socketNodes=null,this._keysToDelete=[],this._isInitialized=!1}var g=t1.prototype;return g.init=function(g){var v;this._isInitialized=!1,g&&0!==(null===(v=g.socketNodes)||void 0===v?void 0:v.size)&&(this._skeletonBones=g._skeleton.bones,!this._skeletonBones||this._skeletonBones.length<1||(this._socketNodes=g.socketNodes,!this._socketNodes||this._socketNodes.size<=0||(this._isInitialized=!0,this._syncAttachedNode())))},g.updateSkeletonBones=function(g){this._skeletonBones=g},g.reset=function(){this._isInitialized=!1,this._skeletonBones=null,this._socketNodes=null,this._keysToDelete.length=0},g._syncAttachedNode=function(){if(this._isInitialized){for(var g,v=this._socketNodes,S=f(v);!(g=S()).done;){var O=g.value,X=O[0],Y=O[1];if(Y&&Y.isValid){var te=this._skeletonBones[X];te&&this.matrixHandle(Y,te)}else this._keysToDelete.push(X)}if(!(this._keysToDelete.length<=0)){for(var ti,tr=f(this._keysToDelete);!(ti=tr()).done;){var ta=ti.value;v.delete(ta)}this._keysToDelete.length=0}}},g.matrixHandle=function(g,v){var S=tt2;S.m00=v.a,S.m01=v.c,S.m04=v.b,S.m05=v.d,S.m12=v.worldX,S.m13=v.worldY,g.matrix=tt2},t1}(),tt5=1e4;!function(g){g[g.UNSET=-1]="UNSET",g[g.REALTIME=0]="REALTIME",g[g.SHARED_CACHE=1]="SHARED_CACHE",g[g.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(ttQ||(ttQ={})),oe(ttQ),function(g){g[g.default=0]="default"}(tt$||(tt$={})),oe(tt$),function(g){g[g["<None>"]=0]="<None>"}(tt0||(tt0={})),oe(tt0),function(g){g[g.COLORED_TEXTURED=0]="COLORED_TEXTURED",g[g.TWO_COLORED=1]="TWO_COLORED"}(tt1||(tt1={}));var tt4=(ttT=nJ("sp.Skeleton.SpineSocket"),ttE=ma(mJ),ttT((ttx=function(g,v){void 0===g&&(g=""),void 0===v&&(v=null),this.path=ttb&&ttb(),this.target=ttR&&ttR(),this.path=g,this.target=v},ttb=ws(ttx.prototype,"path",[n2],function(){return""}),ttR=ws(ttx.prototype,"target",[ttE,n2],function(){return null}),ttC=ttx))||ttC);kt(tt4,"sp.Skeleton.SpineSocket");var tt8=(ttw=nJ("sp.Skeleton"),ttI=ma(ttS),ttB=ma(tt$),ttP=ma(tt0),ttD=ma(ttQ),ttM=ma([tt4]),ttO=ma(pf),ttw(((ttZ=function(g){function e(){var v;return(v=g.call(this)||this)._skeletonData=ttN&&ttN(),v.defaultSkin=ttk&&ttk(),v.defaultAnimation=ttG&&ttG(),v._premultipliedAlpha=ttV&&ttV(),v._timeScale=ttU&&ttU(),v._preCacheMode=ttH&&ttH(),v._cacheMode=ttz&&ttz(),v._sockets=ttW&&ttW(),v._useTint=ttX&&ttX(),v._debugMesh=ttj&&ttj(),v._debugBones=ttq&&ttq(),v._debugSlots=ttY&&ttY(),v._enableBatch=ttK&&ttK(),v._runtimeData=null,v._skeleton=null,v._instance=null,v._state=null,v._textures=[],v._skeletonInfo=null,v._animationName="",v._skinName="",v._drawList=new ap(function(){return{material:null,texture:null,indexOffset:0,indexCount:0}},1),v._materialCache={},v.paused=!1,v._enumSkins=re({}),v._enumAnimations=re({}),v.attachUtil=void 0,v._socketNodes=new Map,v._cachedSockets=new Map,v._startEntry=void 0,v._endEntry=void 0,v._paused=!1,v._accTime=0,v._playCount=0,v._skeletonCache=null,v._animCache=null,v._animationQueue=[],v._headAniInfo=null,v._isAniComplete=!0,v._playTimes=0,v._curFrame=null,v._needUpdateSkeltonData=!0,v._listener=null,v._debugRenderer=null,v._startSlotIndex=void 0,v._endSlotIndex=void 0,v._slotTextures=null,v._vLength=0,v._vBuffer=null,v._iLength=0,v._iBuffer=null,v._model=void 0,v._tempColor={r:0,g:0,b:0,a:0},v.loop=ttJ&&ttJ(),v._useVertexOpacity=!0,v._startEntry={animation:{name:""},trackIndex:0},v._endEntry={animation:{name:""},trackIndex:0},v._startSlotIndex=-1,v._endSlotIndex=-1,v._instance=new $9.SkeletonInstance,v._instance.dtRate=1*v._timeScale,v._instance.isCache=v.isAnimationCached(),v.attachUtil=new tt3,v}s(e,g);var v=e.prototype;return v.__preload=function(){g.prototype.__preload.call(this),this._updateSkeletonData(),this._updateDebugDraw()},v.onRestore=function(){this.updateMaterial(),this.markForUpdateRenderData()},v.getState=function(){return this._state},v.onEnable=function(){g.prototype.onEnable.call(this),this._instance&&(this._instance.enable=!0),this._flushAssembler(),ttA.getInstance().add(this)},v.onDisable=function(){g.prototype.onDisable.call(this),this._instance&&(this._instance.enable=!1),ttA.getInstance().remove(this)},v.onDestroy=function(){var v;this._drawList.destroy(),this.destroyRenderData(),this._cleanMaterialCache(),this._vBuffer=null,this._iBuffer=null,this.attachUtil.reset(),null===(v=this._slotTextures)||void 0===v||v.clear(),this._slotTextures=null,this._cachedSockets.clear(),this._socketNodes.clear(),this._animCache=null,ttA.getInstance().remove(this),this._instance&&(this._instance.destroy(),this._instance=null),this._destroySkeletonInfo(this._skeletonCache),this._skeletonCache=null,g.prototype.onDestroy.call(this)},v.clearAnimation=function(g){this.isAnimationCached()||(this.clearTrack(g||0),this.setToSetupPose())},v.clearAnimations=function(){this.isAnimationCached()||(this.clearTracks(),this.setToSetupPose())},v._updateSkeletonData=function(){var g=this._skeletonData;if(!g)return this._runtimeData=null,this._state=null,this._skeleton=null,this._textures=[],void this._refreshInspector();this._instance&&(this._instance.dtRate=1*this._timeScale),this._needUpdateSkeltonData=!1,this._runtimeData=g.getRuntimeData(),this._runtimeData&&(this.setSkeletonData(this._runtimeData),this._textures=g.textures,this._refreshInspector(),this.defaultAnimation&&(this.animation=this.defaultAnimation.toString()),this.defaultSkin&&""!==this.defaultSkin&&this.setSkin(this.defaultSkin),this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings(),this.attachUtil.init(this),this._preCacheMode=this._cacheMode)},v.setSkeletonData=function(g){var v=this._skeletonCache;if(this._cacheMode===ttQ.SHARED_CACHE?this._skeletonCache=tty.sharedCache:this._cacheMode===ttQ.PRIVATE_CACHE?(this._skeletonCache=new tty,this._skeletonCache.enablePrivateMode()):this._skeletonCache=null,v!==this._skeletonCache&&this._destroySkeletonInfo(v),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&G("Debug bones or slots is invalid in cached mode");var S=this._skeletonCache.getSkeletonInfo(this._skeletonData);this._skeletonInfo!==S&&(this._destroySkeletonInfo(this._skeletonCache),this._skeletonInfo=this._skeletonCache.createSkeletonInfo(this._skeletonData),this._skeleton=this._skeletonInfo.skeleton)}else this._skeleton=this._instance.initSkeleton(g),this._state=this._instance.getAnimationState(),this._instance.setPremultipliedAlpha(this._premultipliedAlpha);this._flushAssembler()},v.setSlotsRange=function(g,v){this.isAnimationCached()?G("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=g,this._endSlotIndex=v)},v.getAttachment=function(g,v){return this._skeleton?this._skeleton.getAttachmentByName(g,v):null},v.setAttachment=function(g,v){this._skeleton&&this._skeleton.setAttachment(g,v),this.invalidAnimationCache()},v.getTextureAtlas=function(g){return g.region},v.setAnimation=function(g,v,S){if("string"!=typeof v)return j(7511),null;if(!this._skeleton.data.findAnimation(v))return j(7509,v),null;var O=null;if(void 0===S&&(S=!0),this._playTimes=S?0:1,this.isAnimationCached()){if(0!==g&&G("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var X,Y=this._skeletonCache.getAnimationCache(this._skeletonData.uuid,v);Y||null===(X=Y=this._skeletonCache.initAnimationCache(this.skeletonData.uuid,this._skeletonData,v))||void 0===X||X.setSkin(this._skinName),Y&&(this._animationName=v,this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._animCache=Y,this._socketNodes.size>0&&this._animCache.enableCacheAttachedInfo(),this._animCache.updateToFrame(0),this._curFrame=this._animCache.frames[0])}else this._animationName=v,O=this._instance.setAnimation(g,v,S);return this.markForUpdateRenderData(),O},v.addAnimation=function(g,v,S,O){if(O=O||0,this.isAnimationCached())return 0!==g&&G("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:v,loop:S,delay:O}),null;if(this._skeleton){var X,Y=this._skeleton.data.findAnimation(v);return Y?null===(X=this._state)||void 0===X?void 0:X.addAnimationWith(g,Y,S,O):(j(7510,v),null)}return null},v.findAnimation=function(g){return this._skeleton?this._skeleton.data.findAnimation(g):null},v.getCurrent=function(g){if(this.isAnimationCached())G("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(g);return null},v.setSkin=function(g){this._skeleton&&this._skeleton.setSkinByName(g),this._instance.setSkin(g),this.isAnimationCached()&&this._animCache&&this._animCache.setSkin(g),this._skinName=g,this.invalidAnimationCache()},v.updateAnimation=function(g){if(this.markForUpdateRenderData(),!this.paused){if(this.isAnimationCached()){if(g*=1*this._timeScale,this._isAniComplete){var v;if(0===this._animationQueue.length&&!this._headAniInfo){var S=this._animCache;if(S&&S.isInvalid()){S.updateToFrame(0);var O=S.frames;this._curFrame=O[O.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=g,this._accTime>(null===(v=this._headAniInfo)||void 0===v?void 0:v.delay)){var X=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,null==X?void 0:X.animationName,null==X?void 0:X.loop)}return}this._updateCache(g)}else this._instance.updateAnimation(g)}},v._updateCache=function(g){var v=this._animCache;if(v.isInited()){var S=v.frames,O=tty.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=g;var X=Math.floor(this._accTime/O);if(v.isCompleted||v.updateToFrame(X),this._curFrame=S[X],void 0!==this._curFrame&&this.attachUtil.updateSkeletonBones(this._curFrame.boneInfos),v.isCompleted&&X>=S.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=S[S.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0,X=0,this._curFrame=S[X],this._emitCacheCompleteEvent()}}},v._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},v.updateRenderData=function(){return this.isAnimationCached()?this._curFrame?this._curFrame.model:null:this._instance.updateRenderData()},v._flushAssembler=function(){var g=e.Assembler.getAssembler(this);this._assembler!==g&&(this._assembler=g),this._skeleton&&this._assembler&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},v._render=function(g){var v=0;if(this.renderData&&this._drawList.length>0){for(var S=this.renderData,O=S.chunk,X=O.vertexAccessor,Y=S.getMeshBuffer(),te=Y.indexOffset,ti=0;ti<this._drawList.length;ti++){var tr=this._drawList.data[ti];tr.texture&&g.commitMiddleware(this,Y,te+tr.indexOffset,tr.indexCount,tr.texture,tr.material,this._enableBatch),v+=tr.indexCount}var ta=S.indices.subarray(0,v);X.appendIndices(O.bufferId,ta),X.getMeshBuffer(O.bufferId).setDirty()}},v.requestDrawData=function(g,v,S,O){var X=this._drawList.add();if(X.material=g,v<1e4)X.texture=this._textures[v];else{var Y,te=null===(Y=this._slotTextures)||void 0===Y?void 0:Y.get(v);te&&(X.texture=te)}return X.indexOffset=S,X.indexCount=O,X},v._updateBuiltinMaterial=function(){return dU.get("default-spine-material")},v.updateMaterial=function(){var g;g=this._customMaterial?this._customMaterial:this._updateBuiltinMaterial(),this.setSharedMaterial(g,0),this._cleanMaterialCache()},v.getMaterialTemplate=function(){return null!==this.customMaterial?this.customMaterial:(this.material||this.updateMaterial(),this.material)},v._cleanMaterialCache=function(){for(var g in this._materialCache)this._materialCache[g].destroy();this._materialCache={}},v.getMaterialForBlendAndTint=function(g,v,S){var O=S+"/"+g+"/"+v,X=this._materialCache[O];if(X)return X;var Y=this.getMaterialTemplate();X=new m0({parent:Y,subModelIdx:0,owner:this}),this._materialCache[O]=X,X.overridePipelineStates({blendState:{blendColor:is.WHITE,targets:[{blendEq:oG.ADD,blendAlphaEq:oG.ADD,blendSrc:g,blendDst:v,blendSrcAlpha:g,blendDstAlpha:v}]}});var te=!1;S===tt1.TWO_COLORED&&(te=!0);var ti=!this._enableBatch;return X.recompileShaders({TWO_COLORED:te,USE_LOCAL:ti}),X},v._updateAnimEnum=function(){var g;g=this.skeletonData?this.skeletonData.getAnimsEnum():tt0,this._enumAnimations=re({}),Object.assign(this._enumAnimations,g),re.update(this._enumAnimations),Ke(this,"_animationIndex",this._enumAnimations)},v._updateSkinEnum=function(){var g;g=this.skeletonData?this.skeletonData.getSkinsEnum():tt$,this._enumSkins=re({}),Object.assign(this._enumSkins,g),re.update(this._enumSkins),Ke(this,"_defaultSkinIndex",this._enumSkins)},v._refreshInspector=function(){},v.destroyRenderData=function(){this._drawList.reset(),g.prototype.destroyRenderData.call(this)},v.createRenderEntity=function(){var g=new PH(Px.DYNAMIC);return g.setUseLocal(!0),g},v.markForUpdateRenderData=function(v){void 0===v&&(v=!0),g.prototype.markForUpdateRenderData.call(this,v),this._debugRenderer&&this._debugRenderer.markForUpdateRenderData(v)},v.syncAttachedNode=function(){this.attachUtil._syncAttachedNode()},v.isAnimationCached=function(){return this._cacheMode!==ttQ.REALTIME},v.setAnimationCacheMode=function(g){this._preCacheMode!==g&&(this._cacheMode=g,this._preCacheMode=g,this._instance&&(this._instance.isCache=this.isAnimationCached()),this._updateSkeletonData(),this.markForUpdateRenderData())},v.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},v.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},v.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},v.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData.uuid)},v.findBone=function(g){return this._skeleton?this._skeleton.findBone(g):null},v.findSlot=function(g){return this._skeleton?this._skeleton.findSlot(g):null},v.setMix=function(g,v,S){this.isAnimationCached()?G("cached mode not support setMix!!!"):this._state&&this._instance.setMix(g,v,S)},v.clearTracks=function(){this.isAnimationCached()?G("'clearTracks' interface can not be invoked in cached mode."):this._state&&(this._state.clearTracks(),this.setToSetupPose())},v.clearTrack=function(g){this.isAnimationCached()?G("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(g)},v.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},v._verifySockets=function(g){for(var v=0,S=g.length;v<S;v++){var O=g[v].target;!O||O.parent&&O.parent===this.node||k("Target node "+O.name+" is expected to be a direct child of "+this.node.name)}var X=new Map;g.forEach(function(g){g.target&&(X.get(g.target)?k("Target node "+g.target.name+" has existed."):X.set(g.target,!0))})},v._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var g=0,v=this._sockets.length;g<v;g++){var S=this._sockets[g];if(S.path&&S.target){var O=this._cachedSockets.get(S.path);if(!O){k("Skeleton data does not contain path "+S.path);continue}this._socketNodes.set(O,S.target)}}}},v._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var g=this._skeleton.bones,_$e=function e(v){return null==v.parent?v.data.name||"<Unamed>":e(g[v.parent.data.index])+"/"+v.data.name},v=0,S=g.length;v<S;v++){var O=g[v].data,X=_$e(g[v]);this._cachedSockets.set(X,O.index)}}},v.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},v._updateUseTint=function(){this._cleanMaterialCache(),this.destroyRenderData(),this.isAnimationCached()||this._instance.setUseTint(this._useTint),this._assembler&&this._skeleton&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},v._updateBatch=function(){this._cleanMaterialCache(),this.markForUpdateRenderData()},v._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){var g=new mJ("DEBUG_DRAW_NODE");g.layer=this.node.layer,g.hideFlags|=rG.Flags.DontSave|rG.Flags.HideInHierarchy;var v=g.addComponent(OW);v.lineWidth=5,v.strokeColor=new is(255,0,0,255),this._debugRenderer=v,g.parent=this.node,this.node.on(md.LAYER_CHANGED,this._applyLayer,this)}this.isAnimationCached()?G("Debug bones or slots is invalid in cached mode"):this._instance.setDebugMode(!0)}else this._debugRenderer&&(this.node.off(md.LAYER_CHANGED,this._applyLayer,this),this._debugRenderer.node.destroy(),this._debugRenderer=null,this.isAnimationCached()||this._instance&&this._instance.setDebugMode(!1))},v._updateUITransform=function(){var g=this.node._uiProps.uiTransformComp,v=this._runtimeData;if(!v)return g.setContentSize(100,100),g.anchorX=.5,void(g.anchorX=.5);var S=v.width,O=v.height;S&&O&&(g.setContentSize(S,O),0!==S&&(g.anchorX=Math.abs(v.x)/S),0!==O&&(g.anchorY=Math.abs(v.y)/O))},v._updateColor=function(){var g=this.node._uiProps.opacity;if(this._tempColor.r!==this._color.r||this._tempColor.g!==this.color.g||this._tempColor.b!==this.color.b||this._tempColor.a!==g){this.node._uiProps.colorDirty=!0,this._tempColor.r=this._color.r,this._tempColor.g=this._color.g,this._tempColor.b=this._color.b,this._tempColor.a=g;var v=this._color.r/255,S=this._color.g/255,O=this._color.b/255;this._instance.setColor(v,S,O,g)}},v.setVertexEffectDelegate=function(g){if(this._instance){if(g){var v=null==g?void 0:g.getEffectType();if("jitter"===v){var S=null==g?void 0:g.getJitterVertexEffect();this._instance.setJitterEffect(S)}else if("swirl"===v){var O=null==g?void 0:g.getJitterVertexEffect();this._instance.setSwirlEffect(O)}}else this._instance.clearEffect()}},v._ensureListener=function(){this._listener||(this._listener=new tti)},v.setStartListener=function(g){this._ensureListener();var v=tti.addListener(g);this._instance.setListener(v,$9.EventType.start),this._listener.start=g},v.setInterruptListener=function(g){this._ensureListener();var v=tti.addListener(g);this._instance.setListener(v,$9.EventType.interrupt),this._listener.interrupt=g},v.setEndListener=function(g){this._ensureListener();var v=tti.addListener(g);this._instance.setListener(v,$9.EventType.end),this._listener.end=g},v.setDisposeListener=function(g){this._ensureListener();var v=tti.addListener(g);this._instance.setListener(v,$9.EventType.dispose),this._listener.dispose=g},v.setCompleteListener=function(g){this._ensureListener();var v=tti.addListener(g);this._instance.setListener(v,$9.EventType.complete),this._listener.complete=g},v.setEventListener=function(g){this._ensureListener();var v=tti.addListener(g);this._instance.setListener(v,$9.EventType.event),this._listener.event=g},v.setTrackStartListener=function(g,v){tti.getListeners(g,this._instance).start=v},v.setTrackInterruptListener=function(g,v){tti.getListeners(g,this._instance).interrupt=v},v.setTrackEndListener=function(g,v){tti.getListeners(g,this._instance).end=v},v.setTrackDisposeListener=function(g,v){tti.getListeners(g,this._instance).dispose=v},v.setTrackCompleteListener=function(g,v){tti.getListeners(g,this._instance).complete=function(g){var S=Math.floor(g.trackTime/g.animationEnd);tti.addListener(v),v(g,S)}},v.setTrackEventListener=function(g,v){tti.getListeners(g,this._instance).event=v},v.getDebugShapes=function(){return this._instance.getDebugShapes()},v.setSlotTexture=function(g,v,S){if(this.isAnimationCached())k("Cached mode can't change texture of slot");else if(this.findSlot(g)){var O=v.width,X=v.height,Y=S||!1;this._instance.resizeSlotRegion(g,O,X,Y),this._slotTextures||(this._slotTextures=new Map);var te=0;this._slotTextures.forEach(function(g,S){g===v&&(te=S)}),0===te&&(te=++tt5,this._slotTextures.set(te,v)),this._instance.setSlotTexture(g,te)}else k("No slot named:"+g)},v._destroySkeletonInfo=function(g){g&&this._skeletonInfo&&(g.destroySkeleton(this._skeletonInfo.assetUUID),this._skeletonInfo=null)},v._applyLayer=function(){this._debugRenderer&&(this._debugRenderer.node.layer=this.node.layer)},n(e,[{key:"drawList",get:function(){return this._drawList}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(g){g&&g.resetEnums(),this._skeletonData!==g&&(this.destroyRenderData(),this._skeletonData=g,this.defaultSkin="",this.defaultAnimation="",this._animationName="",this._skinName="",this._updateSkeletonData(),this._updateUITransform())}},{key:"_defaultSkinIndex",get:function(){if(this.skeletonData){var g=this.skeletonData.getSkinsEnum();if(g){if(""===this.defaultSkin){if(g.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var v=g[this.defaultSkin];if(void 0!==v)return v}}}return 0},set:function(g){var v;if(this.skeletonData&&(v=this.skeletonData.getSkinsEnum()),v){var S=v[g];void 0!==S?(this.defaultSkin=String(S),this.setSkin(this.defaultSkin),this._refreshInspector(),this.markForUpdateRenderData()):k(this.name+" skin enums are invalid")}else k(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var g=this.animation;if(this.skeletonData){if(g){var v=this.skeletonData.getAnimsEnum();if(v){var S=v[g];if(void 0!==S)return S}}else this._refreshInspector()}return 0},set:function(g){var v;if(this.skeletonData&&(v=this.skeletonData.getAnimsEnum()),v){var S=String(v[g]);void 0!==S?(this.animation=S,this.animation=S):k(this.name+" animation enums are invalid")}else k(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._cacheMode},set:function(g){this._cacheMode=g,this.setAnimationCacheMode(this._cacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(g){g!==this._premultipliedAlpha&&(this._premultipliedAlpha=g,this._instance.setPremultipliedAlpha(g),this.markForUpdateRenderData())}},{key:"timeScale",get:function(){return this._timeScale},set:function(g){g!==this._timeScale&&(this._timeScale=g,this._instance&&(this._instance.dtRate=1*this._timeScale))}},{key:"useTint",get:function(){return this._useTint},set:function(g){g!==this._useTint&&(this._useTint=g,this._updateUseTint())}},{key:"enableBatch",get:function(){return this._enableBatch},set:function(g){g!==this._enableBatch&&(this._enableBatch=g,this._updateBatch())}},{key:"sockets",get:function(){return this._sockets},set:function(g){this._sockets=g,this._updateSocketBindings(),this.attachUtil.init(this)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(g){g!==this._debugSlots&&(this._debugSlots=g,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugBones",get:function(){return this._debugBones},set:function(g){g!==this._debugBones&&(this._debugBones=g,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(g){g!==this._debugMesh&&(this._debugMesh=g,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"socketNodes",get:function(){return this._socketNodes}},{key:"animation",get:function(){return this._animationName},set:function(g){g?this.setAnimation(0,g,this.loop):this.clearAnimation(0)}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(g){this._customMaterial=g,this.updateMaterial(),this.markForUpdateRenderData()}}]),e}(Dg)).SpineSocket=tt4,ttZ.AnimationCacheMode=ttQ,ttN=ws((ttF=ttZ).prototype,"_skeletonData",[n2],function(){return null}),ttk=ws(ttF.prototype,"defaultSkin",[n2],function(){return""}),ttG=ws(ttF.prototype,"defaultAnimation",[n2],function(){return""}),ttV=ws(ttF.prototype,"_premultipliedAlpha",[n2],function(){return!0}),ttU=ws(ttF.prototype,"_timeScale",[n2],function(){return 1}),ttH=ws(ttF.prototype,"_preCacheMode",[n2],function(){return ttQ.UNSET}),ttz=ws(ttF.prototype,"_cacheMode",[n2],function(){return ttQ.REALTIME}),ttW=ws(ttF.prototype,"_sockets",[n2],function(){return[]}),ttX=ws(ttF.prototype,"_useTint",[n2],function(){return!1}),ttj=ws(ttF.prototype,"_debugMesh",[n2],function(){return!1}),ttq=ws(ttF.prototype,"_debugBones",[n2],function(){return!1}),ttY=ws(ttF.prototype,"_debugSlots",[n2],function(){return!1}),ttK=ws(ttF.prototype,"_enableBatch",[n2],function(){return!1}),p(ttF.prototype,"skeletonData",[ttI],Object.getOwnPropertyDescriptor(ttF.prototype,"skeletonData"),ttF.prototype),p(ttF.prototype,"_defaultSkinIndex",[ttB],Object.getOwnPropertyDescriptor(ttF.prototype,"_defaultSkinIndex"),ttF.prototype),p(ttF.prototype,"_animationIndex",[ttP],Object.getOwnPropertyDescriptor(ttF.prototype,"_animationIndex"),ttF.prototype),p(ttF.prototype,"defaultCacheMode",[ttD],Object.getOwnPropertyDescriptor(ttF.prototype,"defaultCacheMode"),ttF.prototype),ttJ=ws(ttF.prototype,"loop",[n2],function(){return!0}),p(ttF.prototype,"sockets",[ttM],Object.getOwnPropertyDescriptor(ttF.prototype,"sockets"),ttF.prototype),p(ttF.prototype,"customMaterial",[rE,ttO],Object.getOwnPropertyDescriptor(ttF.prototype,"customMaterial"),ttF.prototype),ttL=ttF))||ttL);X.internal.SpineSkeleton=tt8;var tt6,tt7,tt9,tet,tee=function(){function t1(){this.name="sp.VertexEffectDelegate",this._vertexEffect=void 0,this._interpolation=void 0,this._effectType=void 0,this._vertexEffect=null,this._interpolation=null,this._effectType="none"}var g=t1.prototype;return g.clear=function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},g.initJitter=function(g,v){return this._effectType="jitter",this._vertexEffect=new $9.JitterEffect(g,v),this._vertexEffect},g.initSwirlWithPow=function(g,v){return this._effectType="swirl",this._interpolation=new $9.Pow(v),this._vertexEffect=new $9.SwirlEffect(g,this._interpolation),this._vertexEffect},g.initSwirlWithPowOut=function(g,v){return this._effectType="swirl",this._interpolation=new $9.PowOut(v),this._vertexEffect=new $9.SwirlEffect(g,this._interpolation),this._vertexEffect},g.getJitterVertexEffect=function(){return this._vertexEffect},g.getSwirlVertexEffect=function(){return this._vertexEffect},g.getVertexEffect=function(){return this._vertexEffect},g.getEffectType=function(){return this._effectType},t1}(),tei=new is(0,0,255,255),ten=new is(255,0,0,255),ter=new is(0,255,0,255),tes=new is(255,255,0,255),tea=null,teo=null,teh=!1,teu=!1,tel=KN(Pu),tec=KN(Pc),te_=new eL(0,0,0);function dtt(g,v){var S,O;switch(g){case 1:S=teh?ok.ONE:ok.SRC_ALPHA,O=ok.ONE;break;case 2:S=ok.DST_COLOR,O=ok.ONE_MINUS_SRC_ALPHA;break;case 3:S=ok.ONE,O=ok.ONE_MINUS_SRC_COLOR;break;case 0:default:S=teh?ok.ONE:ok.SRC_ALPHA,O=ok.ONE_MINUS_SRC_ALPHA}return v.getMaterialForBlendAndTint(S,O,teu?tt1.TWO_COLORED:tt1.COLORED_TEXTURED)}var tef={vCount:32767,ensureAccessor:function(g){var v=g?teo:tea;if(!v){var S=II.root.device,O=II.root.batcher2D,X=g?Pc:Pu;g?(v=teo=new PC(S,X,this.vCount),O.registerBufferAccessor(Number.parseInt("SPINETINT",36),teo)):(v=tea=new PC(S,X,this.vCount),O.registerBufferAccessor(Number.parseInt("SPINE",36),tea))}return v},createData:function(g){var v=g.renderData;if(!v){var S=g.useTint||g.isAnimationCached(),O=this.ensureAccessor(S);v=PX.add(S?Pc:Pu,O)}return v},updateRenderData:function(g){g._skeleton&&function(g){if(g.drawList.reset(),0!==g.color.a){g._updateColor(),teh=g.premultipliedAlpha,teu=g.useTint||g.isAnimationCached(),g.isAnimationCached()?function(g){var v=g.updateRenderData();if(v){var S=v.vCount,O=v.iCount;if(!(S<1||O<1)){var X=g.renderData;X.vertexCount===S&&X.indexCount===O||(X.resize(S,O),X.indices=new Uint16Array(O));var Y=X.chunk.vb,te=new Uint8Array(Y.buffer,Y.byteOffset,Float32Array.BYTES_PER_ELEMENT*Y.length);te.set(v.vData);var ti=g.color;if(0xffffffff!==ti._val||teh){tt6=ti.r/255,tt7=ti.g/255,tt9=ti.b/255,tet=ti.a/255;for(var tr=0;tr<S;tr++){var ta=tr*tec+5*Float32Array.BYTES_PER_ELEMENT,th=te[ta],tu=te[ta+1],tl=te[ta+2],tc=te[ta+3]*tet,t_=teh?tc/255:1;te[ta]=Math.floor(t_*th*tt6),te[ta+1]=Math.floor(t_*tu*tt7),te[ta+2]=Math.floor(t_*tl*tt9),te[ta+3]=Math.floor(tc),te[ta+4]=Math.floor(te[ta+4]*tt6),te[ta+5]=Math.floor(te[ta+5]*tt7),te[ta+6]=Math.floor(te[ta+6]*tt9),te[ta+7]=teh?255:0}}var tf=X.indices;tf.set(v.iData);for(var tp=X.chunk.vertexOffset,tm=0;tm<O;tm++)tf[tm]+=tp;for(var tg=v.meshes,tv=tg.length,ty=0,tS=0,tA=0;tA<tv;tA++){var tT=tg[tA],tE=dtt(tT.blendMode,g),tC=tT.textureID;tS=tT.iCount,g.requestDrawData(tE,tC,ty,tS),ty+=tS}var tx=tec/Float32Array.BYTES_PER_ELEMENT;if(g.enableBatch)for(var tb=g.node.worldMatrix,tw=0,tI=0;tI<S;tI++)tw=tI*tx,te_.x=Y[tw],te_.y=Y[tw+1],te_.z=0,te_.transformMat4(tb),Y[tw]=te_.x,Y[tw+1]=te_.y,Y[tw+2]=te_.z}}}(g):function(g){var v,S,O=(g.useTint?tec:tel)/Float32Array.BYTES_PER_ELEMENT,X=g.updateRenderData(),Y=X.vCount,te=X.iCount;if(!(Y<1||te<1)){var ti=g.renderData;ti.vertexCount===Y&&ti.indexCount===te||(ti.resize(Y,te),ti.indices=new Uint16Array(te),g._vLength=Y*Float32Array.BYTES_PER_ELEMENT*O,g._vBuffer=new Uint8Array(ti.chunk.vb.buffer,ti.chunk.vb.byteOffset,Float32Array.BYTES_PER_ELEMENT*ti.chunk.vb.length),g._iLength=Uint16Array.BYTES_PER_ELEMENT*te,g._iBuffer=new Uint8Array(ti.indices.buffer));var tr=ti.chunk.vb,ta=X.vPtr,th=X.iPtr,tu=ti.indices,tl=$9.wasmUtil.wasm.HEAPU8;null===(v=g._vBuffer)||void 0===v||v.set(tl.subarray(ta,ta+g._vLength),0),null===(S=g._iBuffer)||void 0===S||S.set(tl.subarray(th,th+g._iLength),0);for(var tc=ti.chunk.vertexOffset,t_=0;t_<te;t_++)tu[t_]+=tc;for(var tf=X.getData(),tp=tf.size(),tm=0,tg=0,tv=0;tv<tp;tv+=6){tg=tf.get(tv+3);var ty=dtt(tf.get(tv+4),g),tS=tf.get(tv+5);g.requestDrawData(ty,tS,tm,tg),tm+=tg}if(g.enableBatch)for(var tA=g.node.worldMatrix,tT=0,tE=0;tE<Y;tE++)tT=tE*O,te_.x=tr[tT],te_.y=tr[tT+1],te_.transformMat4(tA),tr[tT]=te_.x,tr[tT+1]=te_.y,tr[tT+2]=0;var tC=g._debugRenderer,tx=g._skeleton;if(tC&&(g.debugBones||g.debugSlots||g.debugMesh)){tC.clear();for(var tb=g.getDebugShapes(),tw=tb.size(),tI=0;tI<tw;tI++){var tB=tb.get(tI);if(0===tB.type&&g.debugSlots){tC.strokeColor=tei;var tP=tB.vOffset*O,tD=tB.vCount*O;tC.moveTo(tr[tP],tr[tP+1]);for(var tM=tP+O,tO=tP+tD;tM<tO;tM+=O)tC.lineTo(tr[tM],tr[tM+1]);tC.close(),tC.stroke()}else if(1===tB.type&&g.debugMesh){tC.strokeColor=tes;for(var tk=tB.iCount,tG=tB.iOffset,tV=tG,tU=tG+tk;tV<tU;tV+=3){var tH=tu[tV]*O,tz=tu[tV+1]*O,tW=tu[tV+2]*O;tC.moveTo(tr[tH],tr[tH+1]),tC.lineTo(tr[tz],tr[tz+1]),tC.lineTo(tr[tW],tr[tW+1]),tC.close(),tC.stroke()}}}if(g.debugBones){tC.strokeColor=ten,tC.fillColor=tei;for(var tj=0,tq=tx.bones.length;tj<tq;tj++){var tK=tx.bones[tj],tZ=tK.data.length*tK.a+tK.worldX,tQ=tK.data.length*tK.c+tK.worldY;tC.moveTo(tK.worldX,tK.worldY),tC.lineTo(tZ,tQ),tC.stroke(),tC.circle(tK.worldX,tK.worldY,1.5*Math.PI),tC.fill(),0===tj&&(tC.fillColor=ter)}}}}}(g);var v=g.renderData,S=teu?teo:tea;g.syncAttachedNode(),(v.vertexCount>0||v.indexCount>0)&&S.getMeshBuffer(v.chunk.bufferId).setDirty()}}(g)}};X.internal.SpineAssembler=tef;var ted,tep,tem={getAssembler:function(){return tef}};tt8.Assembler=tem,function(g){g[g.REGION=0]="REGION",g[g.BOUNDING_BOX=1]="BOUNDING_BOX",g[g.MESH=2]="MESH",g[g.SKINNED_MESH=3]="SKINNED_MESH"}(ted||(ted={})),oe(ted),function(g){g[g.START=0]="START",g[g.INTERRUPT=1]="INTERRUPT",g[g.END=2]="END",g[g.DISPOSE=3]="DISPOSE",g[g.COMPLETE=4]="COMPLETE",g[g.EVENT=5]="EVENT"}(tep||(tep={})),oe(tep),g("eX",Object.freeze({__proto__:null,spine:$9,get ATTACHMENT_TYPE(){return ted},get AnimationEventType(){return tep},timeScale:1,get AnimationCacheMode(){return ttQ},get DefaultSkinsEnum(){return tt$},get DefaultAnimsEnum(){return tt0},get SpineMaterialType(){return tt1},SpineSocket:tt4,Skeleton:tt8,SkeletonData:ttS,VertexEffectDelegate:tee,simpleSpineAssembler:tem}));var teg=function(){function t1(){this.originalTarget=null,this.target=null,this.tag=t1.TAG_INVALID}var g=t1.prototype;return g.clone=function(){var g=new t1;return g.originalTarget=null,g.target=null,g.tag=this.tag,g},g.isDone=function(){return!0},g.startWithTarget=function(g){this.originalTarget=g,this.target=g},g.stop=function(){this.target=null},g.step=function(){j(1006)},g.update=function(){j(1007)},g.getTarget=function(){return this.target},g.setTarget=function(g){this.target=g},g.getOriginalTarget=function(){return this.originalTarget},g.setOriginalTarget=function(g){this.originalTarget=g},g.getTag=function(){return this.tag},g.setTag=function(g){this.tag=g},g.reverse=function(){return j(1008),null},g.retain=function(){},g.release=function(){},t1}();teg.TAG_INVALID=-1;var tev=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._duration=0,v._timesForRepeat=1,v}s(e,g);var v=e.prototype;return v.getDuration=function(){return this._duration*(this._timesForRepeat||1)},v.setDuration=function(g){this._duration=g},v.clone=function(){return new e},e}(teg);!function(g){function e(v,S){var O;return void 0===S&&(S=1),(O=g.call(this)||this)._speed=0,O._innerAction=null,v&&O.initWithAction(v,S),O}s(e,g);var v=e.prototype;v.getSpeed=function(){return this._speed},v.setSpeed=function(g){this._speed=g},v.initWithAction=function(g,v){return g?(this._innerAction=g,this._speed=v,!0):(J(1021),!1)},v.clone=function(){var g=new e;return g.initWithAction(this._innerAction.clone(),this._speed),g},v.startWithTarget=function(g){teg.prototype.startWithTarget.call(this,g),this._innerAction.startWithTarget(g)},v.stop=function(){this._innerAction.stop(),teg.prototype.stop.call(this)},v.step=function(g){this._innerAction.step(g*this._speed)},v.isDone=function(){return this._innerAction.isDone()},v.reverse=function(){return new e(this._innerAction.reverse(),this._speed)},v.setInnerAction=function(g){this._innerAction!==g&&(this._innerAction=g)},v.getInnerAction=function(){return this._innerAction}}(teg);var tey=0,Ttt=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},teS=function(){function t1(){this._hashTargets=new Map,this._arrayTargets=[],this._currentTarget=void 0,this._elementPool=[]}var g=t1.prototype;return g._searchElementByTarget=function(g,v){for(var S=0;S<g.length;S++)if(v===g[S].target)return g[S];return null},g._getElement=function(g,v){var S=this._elementPool.pop();return S||(S=new Ttt),S.target=g,S.paused=!!v,S},g._putElement=function(g){g.actions.length=0,g.actionIndex=0,g.currentAction=null,g.paused=!1,g.target=null,g.lock=!1,this._elementPool.push(g)},g.addAction=function(g,v,S){if(g&&v){null==v.uuid&&(v.uuid="_TWEEN_UUID_"+tey++);var O=this._hashTargets.get(v);O?O.actions||(O.actions=[]):(O=this._getElement(v,S),this._hashTargets.set(v,O),this._arrayTargets.push(O)),O.target=v,O.actions.push(g),g.startWithTarget(v)}else J(1e3)},g.removeAllActions=function(){for(var g=this._arrayTargets,v=0;v<g.length;v++){var S=g[v];S&&this._putElement(S)}this._arrayTargets.length=0,this._hashTargets=new Map},g.removeAllActionsFromTarget=function(g){if(null!=g){var v=this._hashTargets.get(g);v&&(v.actions.length=0,this._deleteHashElement(v))}},g.removeAction=function(g){if(null!=g){var v=g.getOriginalTarget(),S=this._hashTargets.get(v);if(S){for(var O=0;O<S.actions.length;O++)if(S.actions[O]===g){S.actions.splice(O,1),S.actionIndex>=O&&S.actionIndex--;break}}}},g._removeActionByTag=function(g,v,S){for(var O=0,X=v.actions.length;O<X;++O){var Y=v.actions[O];if(Y&&Y.getTag()===g){if(S&&Y.getOriginalTarget()!==S)continue;this._removeActionAtIndex(O,v);break}}},g._removeAllActionsByTag=function(g,v,S){for(var O=v.actions.length-1;O>=0;--O){var X=v.actions[O];if(X&&X.getTag()===g){if(S&&X.getOriginalTarget()!==S)continue;this._removeActionAtIndex(O,v)}}},g.removeActionByTag=function(g,v){var S=this;g===teg.TAG_INVALID&&j(1002);var O=this._hashTargets;if(v){var X=O.get(v);X&&this._removeActionByTag(g,X,v)}else O.forEach(function(v){S._removeActionByTag(g,v)})},g.removeAllActionsByTag=function(g,v){var S=this;g===teg.TAG_INVALID&&j(1002);var O=this._hashTargets;if(v){var X=O.get(v);X&&this._removeAllActionsByTag(g,X,v)}else O.forEach(function(v){S._removeAllActionsByTag(g,v)})},g.getActionByTag=function(g,v){g===teg.TAG_INVALID&&j(1004);var S=this._hashTargets.get(v);if(S){if(null!=S.actions)for(var O=0;O<S.actions.length;++O){var X=S.actions[O];if(X&&X.getTag()===g)return X}j(1005,g)}return null},g.getNumberOfRunningActionsInTarget=function(g){var v=this._hashTargets.get(g);return v&&v.actions?v.actions.length:0},g.pauseTarget=function(g){var v=this._hashTargets.get(g);v&&(v.paused=!0)},g.resumeTarget=function(g){var v=this._hashTargets.get(g);v&&(v.paused=!1)},g.pauseAllRunningActions=function(){for(var g=[],v=this._arrayTargets,S=0;S<v.length;S++){var O=v[S];O&&!O.paused&&(O.paused=!0,g.push(O.target))}return g},g.resumeTargets=function(g){if(g)for(var v=0;v<g.length;v++)g[v]&&this.resumeTarget(g[v])},g.pauseTargets=function(g){if(g)for(var v=0;v<g.length;v++)g[v]&&this.pauseTarget(g[v])},g.purgeSharedManager=function(){X.director.getScheduler().unscheduleUpdate(this)},g._removeActionAtIndex=function(g,v){v.actions[g],v.actions.splice(g,1),v.actionIndex>=g&&v.actionIndex--,0===v.actions.length&&this._deleteHashElement(v)},g._deleteHashElement=function(g){var v=!1;if(g&&!g.lock&&this._hashTargets.get(g.target)){this._hashTargets.delete(g.target);for(var S=this._arrayTargets,O=0,X=S.length;O<X;O++)if(S[O]===g){S.splice(O,1);break}this._putElement(g),v=!0}return v},g.update=function(g){for(var v,S=this._arrayTargets,O=0;O<S.length;O++){this._currentTarget=S[O];var X=(v=this._currentTarget).target;if(!Oa(X)||X.isValid){if(!v.paused&&v.actions){for(v.lock=!0,v.actionIndex=0;v.actionIndex<v.actions.length;v.actionIndex++)if(v.currentAction=v.actions[v.actionIndex],v.currentAction){if(v.currentAction.step(g*(this._isActionInternal(v.currentAction)?v.currentAction.getSpeed():1)),v.currentAction&&v.currentAction.isDone()){v.currentAction.stop();var Y=v.currentAction;v.currentAction=null,this.removeAction(Y)}v.currentAction=null}v.lock=!1}0===v.actions.length&&this._deleteHashElement(v)&&O--}else this.removeAllActionsFromTarget(X),O--}},g._isActionInternal=function(g){return void 0!==g._speedMethod},t1}(),teA=g("eY",function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).actionMgr=new teS,v}return s(e,g),e.prototype.update=function(g){this.actionMgr.update(g)},n(e,[{key:"ActionManager",get:function(){return this.actionMgr}}]),e}(a8));teA.ID="TWEEN",teA.instance=void 0,II.on(Iw.EVENT_INIT,function(){var g=new teA;teA.instance=g,II.registerSystem(teA.ID,g,a8.Priority.MEDIUM)});var teT=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.isDone=function(){return!0},v.step=function(){this.update(1)},v.update=function(){},v.reverse=function(){return this.clone()},v.clone=function(){return new e},e}(tev),teE=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.update=function(){for(var g=this.target.getComponentsInChildren(Dm),v=0;v<g.length;++v)g[v].enabled=!0},v.reverse=function(){return new teC},v.clone=function(){return new e},e}(teT),teC=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.update=function(){for(var g=this.target.getComponentsInChildren(Dm),v=0;v<g.length;++v)g[v].enabled=!1},v.reverse=function(){return new teE},v.clone=function(){return new e},e}(teT);!function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;v.update=function(){for(var g=this.target.getComponentsInChildren(Dm),v=0;v<g.length;++v){var S=g[v];S.enabled=!S.enabled}},v.reverse=function(){return new e},v.clone=function(){return new e}}(teT);var tex=function(g){function e(v){var S;return(S=g.call(this)||this)._isNeedCleanUp=!0,void 0!==v&&S.init(v),S}s(e,g);var v=e.prototype;return v.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},v.init=function(g){return this._isNeedCleanUp=g,!0},v.reverse=function(){return new e(this._isNeedCleanUp)},v.clone=function(){return new e(this._isNeedCleanUp)},e}(teT);function Itt(g){return new tex(g)}var teb,teR,tew=function(g){function e(v,S,O){var X;return(X=g.call(this)||this)._selectorTarget=null,X._function=null,X._data=null,X.initWithFunction(v,S,O),X}s(e,g);var v=e.prototype;return v.initWithFunction=function(g,v,S){return g&&(this._function=g),v&&(this._selectorTarget=v),void 0!==S&&(this._data=S),!0},v.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},v.update=function(){this.execute()},v.getTargetCallback=function(){return this._selectorTarget},v.setTargetCallback=function(g){g!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=g)},v.clone=function(){var g=new e;return g.initWithFunction(this._function,this._selectorTarget,this._data),g},e}(teT),teI=function(g){function e(v){var S;return(S=g.call(this)||this).MAX_VALUE=2,S._elapsed=0,S._firstTick=!1,S._easeList=[],S._speed=1,S._repeatForever=!1,S._repeatMethod=!1,S._speedMethod=!1,void 0===v||Number.isNaN(v)||S.initWithDuration(v),S}s(e,g);var v=e.prototype;return v.getElapsed=function(){return this._elapsed},v.initWithDuration=function(g){return this._duration=0===g?t$.FLT_EPSILON:g,this._elapsed=0,this._firstTick=!0,!0},v.isDone=function(){return this._elapsed>=this._duration},v._cloneDecoration=function(g){g._repeatForever=this._repeatForever,g._speed=this._speed,g._timesForRepeat=this._timesForRepeat,g._easeList=this._easeList,g._speedMethod=this._speedMethod,g._repeatMethod=this._repeatMethod},v._reverseEaseList=function(g){if(this._easeList){g._easeList=[];for(var v=0;v<this._easeList.length;v++)g._easeList.push(this._easeList[v])}},v.clone=function(){var g=new e(this._duration);return this._cloneDecoration(g),g},v.easing=function(g){this._easeList?this._easeList.length=0:this._easeList=[];for(var v=0;v<arguments.length;v++)this._easeList.push(arguments[v]);return this},v._computeEaseTime=function(g){return g},v.step=function(g){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=g;var v=this._elapsed/(this._duration>1192092896e-16?this._duration:1192092896e-16);v=v<1?v:1,this.update(v>0?v:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},v.startWithTarget=function(g){teg.prototype.startWithTarget.call(this,g),this._elapsed=0,this._firstTick=!0},v.reverse=function(){return j(1010),this},v.setAmplitudeRate=function(){j(1011)},v.getAmplitudeRate=function(){return j(1012),0},v.speed=function(g){return g<=0?(j(1013),this):(this._speedMethod=!0,this._speed*=g,this)},v.getSpeed=function(){return this._speed},v.setSpeed=function(g){return this._speed=g,this},v.repeat=function(g){return g=Math.round(g),Number.isNaN(g)||g<1?(j(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=g,this)},v.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},e}(tev),teB=function(g){function e(v){var S;(S=g.call(this)||this)._actions=[],S._split=0,S._last=0,S._reversed=!1;var O=_instanceof(v,Array)?v:arguments;if(1===O.length)return J(1019),c(S);var X=O.length-1;if(X>=0&&null==O[X]&&j(1015),X>=0){for(var Y,te=O[0],ti=1;ti<X;ti++)O[ti]&&(Y=te,te=e._actionOneTwo(Y,O[ti]));S.initWithTwoActions(te,O[X])}return S}s(e,g);var v=e.prototype;return v.initWithTwoActions=function(g,v){if(!g||!v)return J(1025),!1;var S=g._duration,O=v._duration,X=(S*=g._repeatMethod?g._timesForRepeat:1)+(O*=v._repeatMethod?v._timesForRepeat:1);return this.initWithDuration(X),this._actions[0]=g,this._actions[1]=v,!0},v.clone=function(){var g=new e;return this._cloneDecoration(g),g.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),g},v.startWithTarget=function(g){teI.prototype.startWithTarget.call(this,g),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},v.stop=function(){-1!==this._last&&this._actions[this._last].stop(),teg.prototype.stop.call(this)},v.update=function(g){var v,S,O=0,X=this._split,Y=this._actions,te=this._last;(g=this._computeEaseTime(g))<X?(v=0!==X?g/X:1,0===O&&1===te&&this._reversed&&(Y[1].update(0),Y[1].stop())):(O=1,v=1===X?1:(g-X)/(1-X),-1===te&&(Y[0].startWithTarget(this.target),Y[0].update(1),Y[0].stop()),0===te&&(Y[0].update(1),Y[0].stop())),S=Y[O],te===O&&S.isDone()||(te!==O&&S.startWithTarget(this.target),v*=S._timesForRepeat,S.update(v>1?v%1:v),this._last=O)},v.reverse=function(){var g=e._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(g),this._reverseEaseList(g),g._reversed=!0,g},e}(teI);function Ltt(g){var v=_instanceof(g,Array)?g:arguments;if(1===v.length)return v[0];var S=v.length-1;S>=0&&null==v[S]&&j(1015);var O=null;if(S>=0){O=v[0];for(var X=1;X<=S;X++)v[X]&&(O=teB._actionOneTwo(O,v[X]))}return O}teb=teB,teB._actionOneTwo=function(g,v){var S=new teb;return S.initWithTwoActions(g,v),S};var teP=function(g){function e(v,S){var O;return(O=g.call(this)||this)._times=0,O._total=0,O._nextDt=0,O._actionInstant=!1,O._innerAction=null,void 0!==S&&O.initWithAction(v,S),O}s(e,g);var v=e.prototype;return v.initWithAction=function(g,v){var S=g._duration*v;return!!this.initWithDuration(S)&&(this._times=v,this._innerAction=g,_instanceof(g,teT)&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},v.clone=function(){var g=new e;return this._cloneDecoration(g),g.initWithAction(this._innerAction.clone(),this._times),g},v.startWithTarget=function(g){this._total=0,this._nextDt=this._innerAction._duration/this._duration,teI.prototype.startWithTarget.call(this,g),this._innerAction.startWithTarget(g)},v.stop=function(){this._innerAction.stop(),teg.prototype.stop.call(this)},v.update=function(g){g=this._computeEaseTime(g);var v=this._innerAction,S=this._duration,O=this._times,X=this._nextDt;if(g>=X){for(;g>X&&this._total<O;)v.update(1),this._total++,v.stop(),v.startWithTarget(this.target),X+=v._duration/S,this._nextDt=X>1?1:X;g>=1&&this._total<O&&(v.update(1),this._total++),this._actionInstant||(this._total===O?v.stop():v.update(g-(X-v._duration/S)))}else v.update(g*O%1)},v.isDone=function(){return this._total===this._times},v.reverse=function(){var g=new e(this._innerAction.reverse(),this._times);return this._cloneDecoration(g),this._reverseEaseList(g),g},v.setInnerAction=function(g){this._innerAction!==g&&(this._innerAction=g)},v.getInnerAction=function(){return this._innerAction},e}(teI),teD=function(g){function e(v){var S;return(S=g.call(this)||this)._innerAction=null,v&&S.initWithAction(v),S}s(e,g);var v=e.prototype;return v.initWithAction=function(g){return g?(this._innerAction=g,!0):(J(1026),!1)},v.clone=function(){var g=new e;return this._cloneDecoration(g),g.initWithAction(this._innerAction.clone()),g},v.startWithTarget=function(g){teI.prototype.startWithTarget.call(this,g),this._innerAction.startWithTarget(g)},v.step=function(g){var v=this._innerAction;v.step(g),v.isDone()&&(v.startWithTarget(this.target),v.step(v.getElapsed()-v._duration))},v.isDone=function(){return!1},v.reverse=function(){var g=new e(this._innerAction.reverse());return this._cloneDecoration(g),this._reverseEaseList(g),g},v.setInnerAction=function(g){this._innerAction!==g&&(this._innerAction=g)},v.getInnerAction=function(){return this._innerAction},e}(teI),teM=function(g){function e(v){var S;(S=g.call(this)||this)._one=null,S._two=null;var O=_instanceof(v,Array)?v:arguments;if(1===O.length)return J(1020),c(S);var X=O.length-1;if(X>=0&&null==O[X]&&j(1015),X>=0){for(var Y,te=O[0],ti=1;ti<X;ti++)O[ti]&&(Y=te,te=e._actionOneTwo(Y,O[ti]));S.initWithTwoActions(te,O[X])}return S}s(e,g);var v=e.prototype;return v.initWithTwoActions=function(g,v){if(!g||!v)return J(1027),!1;var S=!1,O=g._duration,X=v._duration;return this.initWithDuration(Math.max(O,X))&&(this._one=g,this._two=v,O>X?this._two=teB._actionOneTwo(v,Utt(O-X)):O<X&&(this._one=teB._actionOneTwo(g,Utt(X-O))),S=!0),S},v.clone=function(){var g=new e;return this._cloneDecoration(g),g.initWithTwoActions(this._one.clone(),this._two.clone()),g},v.startWithTarget=function(g){teI.prototype.startWithTarget.call(this,g),this._one.startWithTarget(g),this._two.startWithTarget(g)},v.stop=function(){this._one.stop(),this._two.stop(),teg.prototype.stop.call(this)},v.update=function(g){g=this._computeEaseTime(g),this._one&&this._one.update(g),this._two&&this._two.update(g)},v.reverse=function(){var g=e._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(g),this._reverseEaseList(g),g},e}(teI);function ktt(g){var v=_instanceof(g,Array)?g:arguments;if(1===v.length)return J(1020),null;v.length>0&&null==v[v.length-1]&&j(1015);for(var S=v[0],O=1;O<v.length;O++)null!=v[O]&&(S=teM._actionOneTwo(S,v[O]));return S}teR=teM,teM._actionOneTwo=function(g,v){var S=new teR;return S.initWithTwoActions(g,v),S};var teO=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.update=function(){},v.reverse=function(){var g=new e(this._duration);return this._cloneDecoration(g),this._reverseEaseList(g),g},v.clone=function(){var g=new e;return this._cloneDecoration(g),g.initWithDuration(this._duration),g},e}(teI);function Utt(g){return new teO(g)}var teL,teF,teN,tek,teG,teV,teU,teH,tez,teW,teX,tej,teq,teY,teK,teJ,teZ,teQ,te$,te0,te1,te2,te3,te5,te4,te8,te6,te7,te9,tit,tie,tii=function(g){function e(v){var S;return(S=g.call(this)||this)._other=null,v&&S.initWithAction(v),S}s(e,g);var v=e.prototype;return v.initWithAction=function(g){return g?g===this._other?(J(1029),!1):!!teI.prototype.initWithDuration.call(this,g._duration)&&(this._other=g,!0):(J(1028),!1)},v.clone=function(){var g=new e;return this._cloneDecoration(g),g.initWithAction(this._other.clone()),g},v.startWithTarget=function(g){teI.prototype.startWithTarget.call(this,g),this._other.startWithTarget(g)},v.update=function(g){g=this._computeEaseTime(g),this._other&&this._other.update(1-g)},v.reverse=function(){return this._other.clone()},v.stop=function(){this._other.stop(),teg.prototype.stop.call(this)},e}(teI),tin=g("f0",function(g){function e(v,S,O){var X;if((X=g.call(this)||this)._opts=void 0,X._props=void 0,X._originProps=void 0,null==O)O=Object.create(null);else if(function(g){var v=" [Tween:] ",S=" option is not support in v + "+Y,O=g;O.delay&&G(v+"delay"+S),O.repeat&&G(v+"repeat"+S),O.repeatDelay&&G(v+"repeatDelay"+S),O.interpolation&&G(v+"interpolation"+S),O.onStop&&G(v+"onStop"+S)}(O),O.easing&&"string"==typeof O.easing&&(O.easing=function(g){var v=g.charAt(0);if(/[A-Z]/.test(v)){var S=(g=g.replace(v,v.toLowerCase())).split("-");if(2===S.length){var O=S[0];if("linear"===O)g="linear";else{var X=S[1];switch(O){case"quadratic":g="quad"+X;break;case"quartic":g="quart"+X;break;case"quintic":g="quint"+X;break;case"sinusoidal":g="sine"+X;break;case"exponential":g="expo"+X;break;case"circular":g="circ"+X;break;default:g=O+X}}}}return g}(O.easing)),O.progress||(O.progress=X.progress),O.easing&&"string"==typeof O.easing){var te=O.easing;O.easing=r2[te],O.easing||q(1031,te)}for(var ti in X._opts=O,X._props=Object.create(null),S)if(S.hasOwnProperty(ti)){var tr=S[ti];if("function"==typeof tr&&(tr=tr()),null!=tr&&"string"!=typeof tr){var ta=void 0,th=void 0;void 0!==tr.value&&(tr.easing||tr.progress)&&("string"==typeof tr.easing?(ta=r2[tr.easing])||q(1031,tr.easing):ta=tr.easing,th=tr.progress,tr=tr.value);var tu=Object.create(null);tu.value=tr,tu.easing=ta,tu.progress=th,X._props[ti]=tu}}return X._originProps=S,X.initWithDuration(v),X}s(e,g);var v=e.prototype;return v.clone=function(){var g=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(g),g},v.startWithTarget=function(g){teI.prototype.startWithTarget.call(this,g);var v=!!this._opts.relative,S=this._props;for(var O in S){var X=g[O];if(void 0!==X){var Y=S[O],te=Y.value;if("number"==typeof X)Y.start=X,Y.current=X,Y.end=v?X+te:te;else if("object"==(void 0===X?"undefined":_type_of(X)))for(var ti in null==Y.start&&(Y.start={},Y.current={},Y.end={}),te)isNaN(X[ti])||(Y.start[ti]=X[ti],Y.current[ti]=X[ti],Y.end[ti]=v?X[ti]+te[ti]:te[ti])}}this._opts.onStart&&this._opts.onStart(this.target)},v.update=function(g){var v=this.target;if(v){var S=this._props,O=this._opts,X=g;O.easing&&(X=O.easing(g));var Y=O.progress;for(var te in S){var ti=S[te],tr=ti.easing?ti.easing(g):X,ta=ti.progress?ti.progress:Y,th=ti.start,tu=ti.end;if("number"==typeof th)ti.current=ta(th,tu,ti.current,tr);else if("object"==(void 0===th?"undefined":_type_of(th)))for(var tl in th)ti.current[tl]=ta(th[tl],tu[tl],ti.current[tl],tr);v[te]=ti.current}O.onUpdate&&O.onUpdate(this.target,g),1===g&&O.onComplete&&O.onComplete(this.target)}},v.progress=function(g,v,S,O){return g+(v-g)*O},e}(teI)),tir=function(g){function e(v){var S;return(S=g.call(this)||this)._props=void 0,S._props={},void 0!==v&&S.init(v),S}s(e,g);var v=e.prototype;return v.init=function(g){for(var v in g)this._props[v]=g[v];return!0},v.update=function(){var g=this._props,v=this.target;for(var S in g)v[S]=g[S]},v.clone=function(){var g=new e;return g.init(this._props),g},e}(teT),tis=g("e$",function(){function t1(g){this._actions=[],this._finalAction=null,this._target=null,this._tag=teg.TAG_INVALID,this._target=void 0===g?null:g}var g=t1.prototype;return g.tag=function(g){return this._tag=g,this},g.then=function(g){return _instanceof(g,teg)?this._actions.push(g.clone()):this._actions.push(g._union()),this},g.target=function(g){return this._target=g,this},g.start=function(){return this._target?(this._finalAction&&teA.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),teA.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(G("Please set target to tween first"),this)},g.stop=function(){return this._finalAction&&teA.instance.ActionManager.removeAction(this._finalAction),this},g.clone=function(g){var v=this._union();return bet(g).then(v.clone())},g.union=function(){var g=this._union();return this._actions.length=0,this._actions.push(g),this},g.to=function(g,v,S){(S=S||Object.create(null)).relative=!1;var O=new tin(g,v,S);return this._actions.push(O),this},g.by=function(g,v,S){(S=S||Object.create(null)).relative=!0;var O=new tin(g,v,S);return this._actions.push(O),this},g.set=function(g){var v=new tir(g);return this._actions.push(v),this},g.delay=function(g){var v=Utt(g);return this._actions.push(v),this},g.call=function(g){var v=function(g){return new tew(g,void 0,void 0)}(g);return this._actions.push(v),this},g.sequence=function(){var g=t1._wrappedSequence.apply(t1,arguments);return this._actions.push(g),this},g.parallel=function(){var g=t1._wrappedParallel.apply(t1,arguments);return this._actions.push(g),this},g.repeat=function(g,v){if(g===1/0)return this.repeatForever(v);var S,O=this._actions;return S=_instanceof(v,t1)?v._union():O.pop(),O.push(function(g,v){return new teP(g,v)}(S,g)),this},g.repeatForever=function(g){var v,S=this._actions;return v=_instanceof(g,t1)?g._union():S.pop(),S.push(function(g){return new teD(g)}(v)),this},g.reverseTime=function(g){var v,S=this._actions;return v=_instanceof(g,t1)?g._union():S.pop(),S.push(function(g){return new tii(g)}(v)),this},g.hide=function(){var g=new teC;return this._actions.push(g),this},g.show=function(){var g=new teE;return this._actions.push(g),this},g.removeSelf=function(){var g=Itt(!1);return this._actions.push(g),this},g.destroySelf=function(){var g=Itt(!0);return this._actions.push(g),this},t1.stopAll=function(){teA.instance.ActionManager.removeAllActions()},t1.stopAllByTag=function(g,v){teA.instance.ActionManager.removeAllActionsByTag(g,v)},t1.stopAllByTarget=function(g){teA.instance.ActionManager.removeAllActionsFromTarget(g)},g._union=function(){var g=this._actions;return 1===g.length?g[0]:Ltt(g)},g._destroy=function(){this.stop()},t1._wrappedSequence=function(){var g=t1._tmp_args;g.length=0;for(var v=arguments.length,S=0;S<v;S++){var O=g[S]=S<0||arguments.length<=S?void 0:arguments[S];_instanceof(O,t1)&&(g[S]=O._union())}return Ltt.apply(Ltt,g)},t1._wrappedParallel=function(){var g=t1._tmp_args;g.length=0;for(var v=arguments.length,S=0;S<v;S++){var O=g[S]=S<0||arguments.length<=S?void 0:arguments[S];_instanceof(O,t1)&&(g[S]=O._union())}return ktt.apply(ktt,g)},t1}());function bet(g){return new tis(g)}function xet(g){return G("tweenUtil' is deprecated, please use 'tween' instead "),new tis(g)}tis._tmp_args=[],X.Tween=tis,X.tween=bet,X.tweenUtil=xet,function(g){g[g.Other=0]="Other",g[g.Left=1]="Left",g[g.Right=2]="Right"}(teL||(teL={})),function(g){g.XRUI_HOVER_ENTERED="xrui-hover-entered",g.XRUI_HOVER_EXITED="xrui-hover-exited",g.XRUI_HOVER_STAY="xrui-hover-stay",g.XRUI_CLICK="xrui-click",g.XRUI_UNCLICK="xrui-unclick"}(teF||(teF={})),function(g){g.XR_CAPS_LOCK="xr-caps-lock",g.XR_KEYBOARD_INIT="xr-keyboard-init",g.XR_KEYBOARD_INPUT="xr-keyboard-input",g.TO_LATIN="to-latin",g.TO_SYMBOL="to-symbol",g.TO_MATH_SYMBOL="to-math-symbol"}(teN||(teN={})),s(function(){for(var g,v=arguments.length,S=new Array(v),O=0;O<v;O++)S[O]=arguments[O];return(g=tie.call.apply(tie,[this].concat(S))||this).deviceType=teL.Other,g.hitPoint=new eL,g},tie=b$);var tia,tio,tih,tiu=new is;!function(g){g[g.NONE=0]="NONE",g[g.COLOR=1]="COLOR",g[g.SPRITE=2]="SPRITE",g[g.SCALE=3]="SCALE"}(tia||(tia={})),oe(tia),function(g){g.NORMAL="normal",g.HOVER="hover",g.PRESSED="pressed",g.DISABLED="disabled"}(tio||(tio={})),function(g){g.CLICK="click"}(tih||(tih={}));var til=g("f1",(tek=nJ("cc.Button"),teG=nQ(110),teV=nZ(P2),teU=ma(mJ),teH=ma(tia),tez=ma(Bf),teW=ma(Bf),teX=ma(Bf),tej=ma(Bf),teq=ma([cd]),tek(teY=teG(teY=teV(((tit=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).clickEvents=teJ&&teJ(),v._interactable=teZ&&teZ(),v._transition=teQ&&teQ(),v._normalColor=te$&&te$(),v._hoverColor=te0&&te0(),v._pressedColor=te1&&te1(),v._disabledColor=te2&&te2(),v._normalSprite=te3&&te3(),v._hoverSprite=te5&&te5(),v._pressedSprite=te4&&te4(),v._disabledSprite=te8&&te8(),v._duration=te6&&te6(),v._zoomScale=te7&&te7(),v._target=te9&&te9(),v._pressed=!1,v._hovered=!1,v._fromColor=new is,v._toColor=new is,v._time=0,v._transitionFinished=!0,v._fromScale=new eL,v._toScale=new eL,v._originalScale=null,v._sprite=null,v._targetScale=new eL,v}s(e,g);var v=e.prototype;return v.__preload=function(){this.target||(this.target=this.node),this._applyTarget(),this._resetState()},v.onEnable=function(){this._registerNodeEvent()},v.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},v.onDestroy=function(){this.target.isValid&&this._unregisterTargetEvent(this.target)},v.update=function(g){var v=this.target;if(!this._transitionFinished&&v&&(this._transition===tia.COLOR||this._transition===tia.SCALE)){this._time+=g;var S=1;if(this._duration>0&&(S=this._time/this._duration),S>=1&&(S=1),this._transition===tia.COLOR){var O=v._uiProps.uiComp;is.lerp(tiu,this._fromColor,this._toColor,S),O&&(O.color=tiu)}else this.transition===tia.SCALE&&(v.getScale(this._targetScale),this._targetScale.x=vi(this._fromScale.x,this._toScale.x,S),this._targetScale.y=vi(this._fromScale.y,this._toScale.y,S),v.setScale(this._targetScale));1===S&&(this._transitionFinished=!0)}},v._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},v._resetState=function(){this._pressed=!1,this._hovered=!1;var g=this.target;if(g){var v=this._transition;if(v===tia.COLOR&&this._interactable){var S=g.getComponent(Dg);S&&(S.color=this._normalColor)}else v===tia.SCALE&&this._originalScale&&g.setScale(this._originalScale);this._transitionFinished=!0}},v._registerNodeEvent=function(){this.node.on(md.TOUCH_START,this._onTouchBegan,this),this.node.on(md.TOUCH_MOVE,this._onTouchMove,this),this.node.on(md.TOUCH_END,this._onTouchEnded,this),this.node.on(md.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(md.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(md.MOUSE_LEAVE,this._onMouseMoveOut,this),this.node.on(teF.XRUI_HOVER_ENTERED,this._xrHoverEnter,this),this.node.on(teF.XRUI_HOVER_EXITED,this._xrHoverExit,this),this.node.on(teF.XRUI_CLICK,this._xrClick,this),this.node.on(teF.XRUI_UNCLICK,this._xrUnClick,this)},v._registerTargetEvent=function(g){g.on(md.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},v._unregisterNodeEvent=function(){this.node.off(md.TOUCH_START,this._onTouchBegan,this),this.node.off(md.TOUCH_MOVE,this._onTouchMove,this),this.node.off(md.TOUCH_END,this._onTouchEnded,this),this.node.off(md.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(md.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(md.MOUSE_LEAVE,this._onMouseMoveOut,this),this.node.off(teF.XRUI_HOVER_ENTERED,this._xrHoverEnter,this),this.node.off(teF.XRUI_HOVER_EXITED,this._xrHoverExit,this),this.node.off(teF.XRUI_CLICK,this._xrClick,this),this.node.off(teF.XRUI_UNCLICK,this._xrUnClick,this)},v._unregisterTargetEvent=function(g){g.off(md.TRANSFORM_CHANGED)},v._getTargetSprite=function(g){var v=null;return g&&(v=g.getComponent(O3)),v},v._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new eL),eL.copy(this._originalScale,this.target.getScale()),this._registerTargetEvent(this.target))},v._onTargetSpriteFrameChanged=function(g){this._transition===tia.SPRITE&&this._setCurrentStateSpriteFrame(g.spriteFrame)},v._setCurrentStateSpriteFrame=function(g){if(g)switch(this._getButtonState()){case tio.NORMAL:this._normalSprite=g;break;case tio.HOVER:this._hoverSprite=g;break;case tio.PRESSED:this._pressedSprite=g;break;case tio.DISABLED:this._disabledSprite=g}},v._onTargetColorChanged=function(g){this._transition===tia.COLOR&&this._setCurrentStateColor(g)},v._setCurrentStateColor=function(g){switch(this._getButtonState()){case tio.NORMAL:this._normalColor=g;break;case tio.HOVER:this._hoverColor=g;break;case tio.PRESSED:this._pressedColor=g;break;case tio.DISABLED:this._disabledColor=g}},v._onTargetTransformChanged=function(g){g&pq.SCALE&&this._originalScale&&this._transition===tia.SCALE&&this._transitionFinished&&eL.copy(this._originalScale,this.target.getScale())},v._onTouchBegan=function(g){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),g&&(g.propagationStopped=!0))},v._onTouchMove=function(g){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&g){var v=g.touch;if(v){var S,O=this.node._uiProps.uiTransformComp.hitTest(v.getLocation(),g.windowId);this._transition===tia.SCALE&&this.target&&this._originalScale?O?(eL.copy(this._fromScale,this._originalScale),eL.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(S=O?tio.PRESSED:tio.NORMAL,this._applyTransition(S)),g&&(g.propagationStopped=!0)}}},v._onTouchEnded=function(g){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(cd.emitEvents(this.clickEvents,g),this.node.emit(tih.CLICK,this)),this._pressed=!1,this._updateState(),g&&(g.propagationStopped=!0))},v._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},v._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==tia.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},v._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},v._updateState=function(){var g=this._getButtonState();this._applyTransition(g)},v._getButtonState=function(){var g=tio.NORMAL;return this._interactable?this._pressed?g=tio.PRESSED:this._hovered&&(g=tio.HOVER):g=tio.DISABLED,g.toString()},v._updateColorTransition=function(g){var v,S=this[g+"Color"],O=null===(v=this.target)||void 0===v?void 0:v.getComponent(Dg);O&&(g===tio.DISABLED.toString()?O.color=S:(this._fromColor=O.color.clone(),this._toColor=S,this._time=0,this._transitionFinished=!1))},v._updateSpriteTransition=function(g){var v=this[g+"Sprite"];this._sprite&&v&&(this._sprite.spriteFrame=v)},v._updateScaleTransition=function(g){this._interactable&&(g===tio.PRESSED.toString()?this._zoomUp():this._zoomBack())},v._zoomUp=function(){this._originalScale&&(eL.copy(this._fromScale,this._originalScale),eL.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},v._zoomBack=function(){this.target&&this._originalScale&&(eL.copy(this._fromScale,this.target.getScale()),eL.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},v._applyTransition=function(g){var v=this._transition;v===tia.COLOR?this._updateColorTransition(g):v===tia.SPRITE?this._updateSpriteTransition(g):v===tia.SCALE&&this._updateScaleTransition(g)},v._xrHoverEnter=function(){this._onMouseMoveIn(),this._updateState()},v._xrHoverExit=function(){this._onMouseMoveOut(),this._pressed&&(this._pressed=!1,this._updateState())},v._xrClick=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState())},v._xrUnClick=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(cd.emitEvents(this.clickEvents,this),this.node.emit(tih.CLICK,this)),this._pressed=!1,this._updateState())},n(e,[{key:"target",get:function(){return this._target||this.node},set:function(g){this._target!==g&&(this._target&&this._unregisterTargetEvent(this._target),this._target=g,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(g){this._interactable!==g&&(this._interactable=g,this._updateState(),this._interactable||this._resetState())}},{key:"_resizeToTarget",set:function(g){g&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(g){this._transition!==g&&(this._transition===tia.COLOR?this._updateColorTransition(tio.NORMAL):this._transition===tia.SPRITE&&this._updateSpriteTransition(tio.NORMAL),this._transition=g,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(g){this._normalColor!==g&&(this._normalColor.set(g),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(g){this._pressedColor!==g&&this._pressedColor.set(g)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(g){this._hoverColor!==g&&this._hoverColor.set(g)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(g){this._disabledColor!==g&&(this._disabledColor.set(g),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(g){this._duration!==g&&(this._duration=g)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(g){this._zoomScale!==g&&(this._zoomScale=g)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(g){if(this._normalSprite!==g){this._normalSprite=g;var v=this.node.getComponent(O3);v&&(v.spriteFrame=g),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(g){this._pressedSprite!==g&&(this._pressedSprite=g,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(g){this._hoverSprite!==g&&(this._hoverSprite=g,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(g){this._disabledSprite!==g&&(this._disabledSprite=g,this._updateState())}}]),e}(cS)).Transition=tia,tit.EventType=tih,p((teK=tit).prototype,"target",[teU],Object.getOwnPropertyDescriptor(teK.prototype,"target"),teK.prototype),p(teK.prototype,"transition",[teH],Object.getOwnPropertyDescriptor(teK.prototype,"transition"),teK.prototype),p(teK.prototype,"normalSprite",[tez],Object.getOwnPropertyDescriptor(teK.prototype,"normalSprite"),teK.prototype),p(teK.prototype,"pressedSprite",[teW],Object.getOwnPropertyDescriptor(teK.prototype,"pressedSprite"),teK.prototype),p(teK.prototype,"hoverSprite",[teX],Object.getOwnPropertyDescriptor(teK.prototype,"hoverSprite"),teK.prototype),p(teK.prototype,"disabledSprite",[tej],Object.getOwnPropertyDescriptor(teK.prototype,"disabledSprite"),teK.prototype),teJ=ws(teK.prototype,"clickEvents",[teq,n2],function(){return[]}),teZ=ws(teK.prototype,"_interactable",[n2],function(){return!0}),teQ=ws(teK.prototype,"_transition",[n2],function(){return tia.NONE}),te$=ws(teK.prototype,"_normalColor",[n2],function(){return is.WHITE.clone()}),te0=ws(teK.prototype,"_hoverColor",[n2],function(){return new is(211,211,211,255)}),te1=ws(teK.prototype,"_pressedColor",[n2],function(){return is.WHITE.clone()}),te2=ws(teK.prototype,"_disabledColor",[n2],function(){return new is(124,124,124,255)}),te3=ws(teK.prototype,"_normalSprite",[n2],function(){return null}),te5=ws(teK.prototype,"_hoverSprite",[n2],function(){return null}),te4=ws(teK.prototype,"_pressedSprite",[n2],function(){return null}),te8=ws(teK.prototype,"_disabledSprite",[n2],function(){return null}),te6=ws(teK.prototype,"_duration",[n2],function(){return .1}),te7=ws(teK.prototype,"_zoomScale",[n2],function(){return 1.2}),te9=ws(teK.prototype,"_target",[n2],function(){return null}),teY=teK))||teY)||teY)||teY));X.Button=til;var tic,ti_,tif,tid=function(){function t1(){}return t1.add=function(g){var v=this._tabIndexList;-1===v.indexOf(g)&&v.push(g)},t1.remove=function(g){var v=this._tabIndexList,S=v.indexOf(g);-1!==S&&v.splice(S,1)},t1.resort=function(){this._tabIndexList.sort(function(g,v){return g._delegate.tabIndex-v._delegate.tabIndex})},t1.next=function(g){var v=this._tabIndexList,S=v.indexOf(g);if(g.setFocus(!1),-1!==S){var O=v[S+1];O&&O._delegate.tabIndex>=0&&O.setFocus(!0)}},t1}();tid._tabIndexList=[],function(g){g[g.DEFAULT=0]="DEFAULT",g[g.DONE=1]="DONE",g[g.SEND=2]="SEND",g[g.SEARCH=3]="SEARCH",g[g.GO=4]="GO",g[g.NEXT=5]="NEXT"}(tic||(tic={})),re(tic),function(g){g[g.ANY=0]="ANY",g[g.EMAIL_ADDR=1]="EMAIL_ADDR",g[g.NUMERIC=2]="NUMERIC",g[g.PHONE_NUMBER=3]="PHONE_NUMBER",g[g.URL=4]="URL",g[g.DECIMAL=5]="DECIMAL",g[g.SINGLE_LINE=6]="SINGLE_LINE"}(ti_||(ti_={})),re(ti_),function(g){g[g.PASSWORD=0]="PASSWORD",g[g.SENSITIVE=1]="SENSITIVE",g[g.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",g[g.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",g[g.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",g[g.DEFAULT=5]="DEFAULT"}(tif||(tif={})),re(tif);var tip,tim,tig,tiv,tiy,tiS,tiA,tiT,tiE,tiC,tix,tib,tiR,tiw,tiI,tiB,tiP,tiD,tiM,tiO,tiL,tiF,tiN,tik,tiG,tiV,tiU,tiH,tiz,tiW,tiX=function(){function t1(){this._editing=!1,this._delegate=null}var g=t1.prototype;return g.init=function(){},g.onEnable=function(){},g.beforeDraw=function(){},g.onDisable=function(){this._editing&&this.endEditing()},g.clear=function(){this._delegate=null},g.setTabIndex=function(){},g.setSize=function(){},g.setFocus=function(g){g?this.beginEditing():this.endEditing()},g.isFocused=function(){return this._editing},g.beginEditing=function(){},g.endEditing=function(){},t1}(),tij=te.document,tiq=new e$,tiY=new e$,tiK=new eL,tiJ=null,tiZ=0,tiQ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._delegate=null,v._inputMode=-1,v._inputFlag=-1,v._returnType=-1,v.__eventListeners={},v.__autoResize=!1,v.__orientationChanged=void 0,v._edTxt=null,v._isTextArea=!1,v._textLabelFont=null,v._textLabelFontSize=null,v._textLabelFontColor=null,v._textLabelAlign=null,v._placeholderLabelFont=null,v._placeholderLabelFontSize=null,v._placeholderLabelFontColor=null,v._placeholderLabelAlign=null,v._placeholderLineHeight=null,v._placeholderStyleSheet=null,v._domId="EditBoxId_"+ ++tiZ,v._forceUpdate=!1,v}s(e,g);var v=e.prototype;return v.init=function(g){g&&(this._delegate=g,g.inputMode===ti_.ANY?this._createTextArea():this._createInput(),tid.add(this),this.setTabIndex(g.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),Fo.instance.on("canvas-resize",this._resize,this),a$.on("window-resize",this._resize,this))},v.clear=function(){Fo.instance.off("canvas-resize",this._resize,this),a$.off("window-resize",this._resize,this),this._removeEventListeners(),this._removeDomFromGameContainer(),tid.remove(this),tiJ===this&&(tiJ=null),this._delegate=null},v._resize=function(){this._forceUpdate=!0},v.beforeDraw=function(){(this._delegate.node.hasChangedFlags||this._forceUpdate)&&(this._forceUpdate=!1,this._updateMatrix())},v.setTabIndex=function(g){this._edTxt.tabIndex=g,tid.resort()},v.setSize=function(g,v){var S=this._edTxt;S&&(S.style.width=g+"px",S.style.height=v+"px")},v.beginEditing=function(){tiJ&&tiJ!==this&&tiJ.setFocus(!1),this._editing=!0,tiJ=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},v.endEditing=function(){this._edTxt.blur()},v._createInput=function(){this._isTextArea=!1,this._edTxt=tij.createElement("input")},v._createTextArea=function(){this._isTextArea=!0,this._edTxt=tij.createElement("textarea")},v._addDomToGameContainer=function(){IL.container&&this._edTxt&&(IL.container.appendChild(this._edTxt),tij.head.appendChild(this._placeholderStyleSheet))},v._removeDomFromGameContainer=function(){Ae(IL.container,this._edTxt)&&this._edTxt&&IL.container.removeChild(this._edTxt),Ae(tij.head,this._placeholderStyleSheet)&&tij.head.removeChild(this._placeholderStyleSheet),this._edTxt=null,this._placeholderStyleSheet=null},v._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),a3.isMobile&&this._showDomOnMobile()},v._hideDom=function(){var g=this._edTxt;g&&this._delegate&&(g.style.display="none",this._delegate._showLabels()),a3.isMobile&&this._hideDomOnMobile()},v._showDomOnMobile=function(){a3.os!==aw.ANDROID&&a3.os!==aw.OHOS||(a$.handleResizeEvent=!1,this._adjustWindowScroll())},v._hideDomOnMobile=function(){a3.os!==aw.ANDROID&&a3.os!==aw.OHOS||(a$.handleResizeEvent=!0),this._scrollBackWindow()},v._isElementInViewport=function(){if(this._edTxt){var g=this._edTxt.getBoundingClientRect();return g.top>=0&&g.left>=0&&g.bottom<=(te.innerHeight||tij.documentElement.clientHeight)&&g.right<=(te.innerWidth||tij.documentElement.clientWidth)}return!1},v._adjustWindowScroll=function(){var g=this;setTimeout(function(){te.scrollY<40&&!g._isElementInViewport()&&g._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})},400)},v._scrollBackWindow=function(){setTimeout(function(){a3.browserType!==ax.WECHAT||a3.os!==aw.IOS?te.scrollTo(0,0):te.top&&te.top.scrollTo(0,0)},400)},v._updateMatrix=function(){if(this._edTxt){var g=this._delegate.node,v=Fd.getScaleX(),S=Fd.getScaleY(),O=Fd.getViewportRect(),X=a$.devicePixelRatio;g.getWorldMatrix(tiq);var Y=g._uiProps.uiTransformComp;if(Y&&(eL.set(tiK,-Y.anchorX*Y.width,-Y.anchorY*Y.height,tiK.z),e$.transform(tiq,tiq,tiK)),g._uiProps.uiTransformComp){var te=II.root.batcher2D.getFirstRenderCamera(g);if(te){te.node.getWorldRT(tiY);var ti=tiY.m12,tr=tiY.m13,ta=a4.center;tiY.m12=ta.x-(tiY.m00*ti+tiY.m04*tr),tiY.m13=ta.y-(tiY.m01*ti+tiY.m05*tr),v/=X,S/=X,eL.set(tiK,v,S,1),e$.scale(tiY,tiY,tiK);var th=IL.container,tu=parseInt(th&&th.style.paddingLeft||"0");tu+=O.x/X;var tl=parseInt(th&&th.style.paddingBottom||"0");tl+=O.y/X,tiY.m12+=tu,tiY.m13+=tl,e$.multiply(tiY,tiY,tiq);var tc="matrix("+tiY.m00+","+-tiY.m01+","+-tiY.m04+","+tiY.m05+","+tiY.m12+","+-tiY.m13+")";this._edTxt.style.transform=tc,this._edTxt.style["-webkit-transform"]=tc,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},v._updateInputType=function(){var g=this._delegate,v=g.inputMode,S=g.inputFlag,O=g.returnType,X=this._edTxt;if(this._inputMode!==v||this._inputFlag!==S||this._returnType!==O){if(this._inputMode=v,this._inputFlag=S,this._returnType=O,this._isTextArea){var Y="none";return S===tif.INITIAL_CAPS_ALL_CHARACTERS?Y="uppercase":S===tif.INITIAL_CAPS_WORD&&(Y="capitalize"),void(X.style.textTransform=Y)}if(S===tif.PASSWORD)return X.type="password",void(X.style.textTransform="none");var te=X.type;v===ti_.EMAIL_ADDR?te="email":v===ti_.NUMERIC?te="number":v===ti_.DECIMAL?te="digit":v===ti_.PHONE_NUMBER?(te="tel",X.addEventListener("wheel",function(){return!1})):v===ti_.URL?te="url":(te="text",O===tic.SEARCH&&(te="search")),X.type=te;var ti="none";S===tif.INITIAL_CAPS_ALL_CHARACTERS?ti="uppercase":S===tif.INITIAL_CAPS_WORD&&(ti="capitalize"),X.style.textTransform=ti}},v._updateMaxLength=function(){var g=this._delegate.maxLength;g<0&&(g=65535),this._edTxt.maxLength=g},v._initStyleSheet=function(){if(this._edTxt){var g=this._edTxt;g.style.color="#000000",g.style.border="0px",g.style.background="transparent",g.style.width="100%",g.style.height="100%",g.style.outline="medium",g.style.padding="0",g.style.textTransform="none",g.style.display="none",g.style.position="absolute",g.style.bottom="0px",g.style.left="2px",g.className="cocosEditBox",g.style.fontFamily="Arial",g.id=this._domId,this._isTextArea?(g.style.resize="none",g.style.overflowY="scroll"):(g.type="text",g.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=tij.createElement("style")}},v._updateStyleSheet=function(){var g=this._delegate,v=this._edTxt;v&&g&&(v.value=g.string,this._updateTextLabel(g.textLabel))},v._updateTextLabel=function(g){if(g){var v=g.font;v=!v||_instanceof(v,B1)?g.fontFamily:v._fontFamily;var S=g.fontSize*g.node.scale.y;if((this._textLabelFont!==v||this._textLabelFontSize!==S||this._textLabelFontColor!==g.fontColor||this._textLabelAlign!==g.horizontalAlign)&&(this._textLabelFont=v,this._textLabelFontSize=S,this._textLabelFontColor=g.fontColor,this._textLabelAlign=g.horizontalAlign,this._edTxt)){var O=this._edTxt;switch(O.style.fontSize=S+"px",O.style.color=g.color.toCSS(),O.style.fontFamily=v,g.horizontalAlign){case Mt.HorizontalAlign.LEFT:O.style.textAlign="left";break;case Mt.HorizontalAlign.CENTER:O.style.textAlign="center";break;case Mt.HorizontalAlign.RIGHT:O.style.textAlign="right"}}}},v._updatePlaceholderLabel=function(g){if(g){var v=g.font;v=!v||_instanceof(v,B1)?g.fontFamily:g.font._fontFamily;var S=g.fontSize*g.node.scale.y;if(this._placeholderLabelFont!==v||this._placeholderLabelFontSize!==S||this._placeholderLabelFontColor!==g.fontColor||this._placeholderLabelAlign!==g.horizontalAlign||this._placeholderLineHeight!==g.fontSize){this._placeholderLabelFont=v,this._placeholderLabelFontSize=S,this._placeholderLabelFontColor=g.fontColor,this._placeholderLabelAlign=g.horizontalAlign,this._placeholderLineHeight=g.fontSize;var O=this._placeholderStyleSheet,X=g.color.toCSS(),Y=g.fontSize,te="";switch(g.horizontalAlign){case Mt.HorizontalAlign.LEFT:te="left";break;case Mt.HorizontalAlign.CENTER:te="center";break;case Mt.HorizontalAlign.RIGHT:te="right"}O.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+v+";font-size: "+S+"px;color: "+X+";line-height: "+Y+"px;text-align: "+te+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+v+";font-size: "+S+"px;color: "+X+";line-height: "+Y+"px;text-align: "+te+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+v+";font-size: "+S+"px;color: "+X+";line-height: "+Y+"px;text-align: "+te+";}",a3.browserType===ax.EDGE&&(O.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},v._registerEventListeners=function(){var g=this;if(this._edTxt){var v=this._edTxt,S=!1,O=this.__eventListeners;O.compositionStart=function(){S=!0},O.compositionEnd=function(){S=!1,g._delegate._editBoxTextChanged(v.value)},O.onInput=function(){if(!S){var O=g._delegate,X=O.maxLength;X>=0&&(v.value=v.value.slice(0,X)),O._editBoxTextChanged(v.value)}},O.onClick=function(){g._editing&&a3.isMobile&&g._adjustWindowScroll()},O.onKeydown=function(S){S.keyCode===b8.ENTER?(S.propagationStopped=!0,g._delegate._editBoxEditingReturn(),g._isTextArea||v.blur()):S.keyCode===b8.TAB&&(S.propagationStopped=!0,S.preventDefault(),tid.next(g))},O.onBlur=function(){a3.isMobile&&S&&O.compositionEnd(),g._editing=!1,tiJ=null,g._hideDom(),g._delegate._editBoxEditingDidEnded()},v.addEventListener("compositionstart",O.compositionStart),v.addEventListener("compositionend",O.compositionEnd),v.addEventListener("input",O.onInput),v.addEventListener("keydown",O.onKeydown),v.addEventListener("blur",O.onBlur),v.addEventListener("touchstart",O.onClick)}},v._removeEventListeners=function(){if(this._edTxt){var g=this._edTxt,v=this.__eventListeners;g.removeEventListener("compositionstart",v.compositionStart),g.removeEventListener("compositionend",v.compositionEnd),g.removeEventListener("input",v.onInput),g.removeEventListener("keydown",v.onKeydown),g.removeEventListener("blur",v.onBlur),g.removeEventListener("touchstart",v.onClick),v.compositionStart=null,v.compositionEnd=null,v.onInput=null,v.onKeydown=null,v.onBlur=null,v.onClick=null}},e}(tiX);!function(g){g.EDITING_DID_BEGAN="editing-did-began",g.EDITING_DID_ENDED="editing-did-ended",g.TEXT_CHANGED="text-changed",g.EDITING_RETURN="editing-return",g.XR_EDITING_DID_BEGAN="xr-editing-did-began",g.XR_EDITING_DID_ENDED="xr-editing-did-ended"}(tiW||(tiW={}));var ti$,ti0,ti1,ti2,ti3,ti5,ti4,ti8,ti6,ti7,ti9,tnt,tne,tni,tnn,tnr,tns,tna,tno,tnh,tnu,tnl,tnc,tn_,tnf,tnd,tnp,tnm,tng,tnv,tny,tnS,tnA,tnT,tnE=g("f2",(tip=nJ("cc.EditBox"),tim=nQ(110),tig=nZ(P2),tiv=ma(Mt),tiy=ma(Mt),tiS=ma(Bf),tiA=ma(tif),tiT=ma(ti_),tiE=ma(tic),tiC=ma([cd]),tix=ma([cd]),tib=ma([cd]),tiR=ma([cd]),tip(tiw=tim(tiw=tig(((tiz=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).editingDidBegan=tiB&&tiB(),v.textChanged=tiP&&tiP(),v.editingDidEnded=tiD&&tiD(),v.editingReturn=tiM&&tiM(),v._impl=null,v._background=null,v._textLabel=tiO&&tiO(),v._placeholderLabel=tiL&&tiL(),v._returnType=tiF&&tiF(),v._string=tiN&&tiN(),v._tabIndex=tik&&tik(),v._backgroundImage=tiG&&tiG(),v._inputFlag=tiV&&tiV(),v._inputMode=tiU&&tiU(),v._maxLength=tiH&&tiH(),v._isLabelVisible=!1,v}s(e,g);var v=e.prototype;return v.__preload=function(){this._init()},v.onEnable=function(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()},v._beforeDraw=function(){this._impl&&this._impl.beforeDraw()},v.onDisable=function(){this._unregisterEvent(),this._unregisterBackgroundEvent(),this._impl&&this._impl.onDisable()},v.onDestroy=function(){II.off(Iw.EVENT_BEFORE_DRAW,this._beforeDraw,this),this._impl&&this._impl.clear()},v.setFocus=function(){this._impl&&this._impl.setFocus(!0)},v.focus=function(){this._impl&&this._impl.setFocus(!0)},v.blur=function(){this._impl&&this._impl.setFocus(!1)},v.isFocused=function(){return!!this._impl&&this._impl.isFocused()},v._editBoxEditingDidBegan=function(){cd.emitEvents(this.editingDidBegan,this),this.node.emit(tiW.EDITING_DID_BEGAN,this)},v._editBoxEditingDidEnded=function(g){cd.emitEvents(this.editingDidEnded,this),this.node.emit(tiW.EDITING_DID_ENDED,this,g)},v._editBoxTextChanged=function(g){g=this._updateLabelStringStyle(g,!0),this.string=g,cd.emitEvents(this.textChanged,g,this),this.node.emit(tiW.TEXT_CHANGED,this)},v._editBoxEditingReturn=function(g){cd.emitEvents(this.editingReturn,this),this.node.emit(tiW.EDITING_RETURN,this,g)},v._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},v._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},v._onTouchBegan=function(g){g.propagationStopped=!0},v._onTouchCancel=function(g){g.propagationStopped=!0},v._onTouchEnded=function(g){this._impl&&this._impl.beginEditing(),g.propagationStopped=!0},v._init=function(){this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(md.SIZE_CHANGED,this._resizeChildNodes,this),II.on(Iw.EVENT_BEFORE_DRAW,this._beforeDraw,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},v._ensureBackgroundSprite=function(){if(!this._background){var g=this.node.getComponent(O3);g||(g=this.node.addComponent(O3)),g!==this._background&&(g.type=O3.Type.SLICED,g.spriteFrame=this._backgroundImage,this._background=g,this._registerBackgroundEvent())}},v._updateTextLabel=function(){var g=this._textLabel;if(!g){var v=this.node.getChildByName("TEXT_LABEL");v||((v=new mJ("TEXT_LABEL")).layer=this.node.layer),(g=v.getComponent(Mt))||(g=v.addComponent(Mt)),v.parent=this.node,this._textLabel=g}this._inputMode===ti_.ANY?(g.verticalAlign=D3.TOP,g.enableWrapText=!0):g.enableWrapText=!1,g.string=this._updateLabelStringStyle(this._string)},v._updatePlaceholderLabel=function(){var g=this._placeholderLabel;if(!g){var v=this.node.getChildByName("PLACEHOLDER_LABEL");v||((v=new mJ("PLACEHOLDER_LABEL")).layer=this.node.layer),(g=v.getComponent(Mt))||(g=v.addComponent(Mt)),v.parent=this.node,this._placeholderLabel=g}this._inputMode===ti_.ANY?g.enableWrapText=!0:g.enableWrapText=!1,g.string=this.placeholder},v._syncSize=function(){var g=this.node._uiProps.uiTransformComp,v=g.contentSize;if(this._background){var S=this._background.node._uiProps.uiTransformComp;S.anchorPoint=g.anchorPoint,S.setContentSize(v)}this._updateLabelPosition(v),this._impl&&this._impl.setSize(v.width,v.height)},v._updateLabels=function(){if(this._isLabelVisible){var g=this._string;this._textLabel&&(this._textLabel.node.active=""!==g),this._placeholderLabel&&(this._placeholderLabel.node.active=""===g)}},v._updateString=function(g){var v=this._textLabel;if(v){var S=g;S&&(S=this._updateLabelStringStyle(S)),v.string=S,this._updateLabels()}},v._updateLabelStringStyle=function(g,v){void 0===v&&(v=!1);var S,O=this._inputFlag;if(v||O!==tif.PASSWORD)O===tif.INITIAL_CAPS_ALL_CHARACTERS?g=g.toUpperCase():O===tif.INITIAL_CAPS_WORD?g=g.replace(/(?:^|\s)\S/g,function(g){return g.toUpperCase()}):O===tif.INITIAL_CAPS_SENTENCE&&(g=(S=g).charAt(0).toUpperCase()+S.slice(1));else{for(var X="",Y=g.length,te=0;te<Y;++te)X+="";g=X}return g},v._registerEvent=function(){this.node.on(md.TOUCH_START,this._onTouchBegan,this),this.node.on(md.TOUCH_END,this._onTouchEnded,this),this.node.on(teF.XRUI_UNCLICK,this._xrUnClick,this),this.node.on(teN.XR_KEYBOARD_INPUT,this._xrKeyBoardInput,this)},v._unregisterEvent=function(){this.node.off(md.TOUCH_START,this._onTouchBegan,this),this.node.off(md.TOUCH_END,this._onTouchEnded,this),this.node.off(teF.XRUI_UNCLICK,this._xrUnClick,this),this.node.off(teN.XR_KEYBOARD_INPUT,this._xrKeyBoardInput,this)},v._onBackgroundSpriteFrameChanged=function(){this._background&&(this.backgroundImage=this._background.spriteFrame)},v._registerBackgroundEvent=function(){var g=this._background&&this._background.node;null==g||g.on(O3.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},v._unregisterBackgroundEvent=function(){var g=this._background&&this._background.node;null==g||g.off(O3.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},v._updateLabelPosition=function(g){var v=this.node._uiProps.uiTransformComp,S=-v.anchorX*v.width,O=-v.anchorY*v.height,X=this._placeholderLabel,Y=this._textLabel;Y&&(Y.node._uiProps.uiTransformComp.setContentSize(g.width-2,g.height),Y.node.setPosition(S+2,O+g.height,Y.node.position.z),this._inputMode===ti_.ANY&&(Y.verticalAlign=D3.TOP),Y.enableWrapText=this._inputMode===ti_.ANY),X&&(X.node._uiProps.uiTransformComp.setContentSize(g.width-2,g.height),X.node.setPosition(S+2,O+g.height,X.node.position.z),X.enableWrapText=this._inputMode===ti_.ANY)},v._resizeChildNodes=function(){var g=this.node._uiProps.uiTransformComp,v=this._textLabel&&this._textLabel.node;v&&(v.setPosition(-g.width/2,g.height/2,v.position.z),v._uiProps.uiTransformComp.setContentSize(g.contentSize));var S=this._placeholderLabel&&this._placeholderLabel.node;S&&(S.setPosition(-g.width/2,g.height/2,S.position.z),S._uiProps.uiTransformComp.setContentSize(g.contentSize));var O=this._background&&this._background.node;O&&O._uiProps.uiTransformComp.setContentSize(g.contentSize),this._syncSize()},v._xrUnClick=function(){this.node.emit(tiW.XR_EDITING_DID_BEGAN,this._maxLength,this.string)},v._xrKeyBoardInput=function(g){this.string=g},n(e,[{key:"string",get:function(){return this._string},set:function(g){this._maxLength>=0&&g.length>=this._maxLength&&(g=g.slice(0,this._maxLength)),this._string!==g&&(this._string=g,this._updateString(g))}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(g){this._placeholderLabel&&(this._placeholderLabel.string=g)}},{key:"textLabel",get:function(){return this._textLabel},set:function(g){this._textLabel!==g&&(this._textLabel=g,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(g){this._placeholderLabel!==g&&(this._placeholderLabel=g,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(g){this._backgroundImage!==g&&(this._backgroundImage=g,this._ensureBackgroundSprite(),this._background.spriteFrame=g)}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(g){this._inputFlag!==g&&(this._inputFlag=g,this._updateString(this._string))}},{key:"inputMode",get:function(){return this._inputMode},set:function(g){this._inputMode!==g&&(this._inputMode=g,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(g){this._returnType=g}},{key:"maxLength",get:function(){return this._maxLength},set:function(g){this._maxLength=g}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(g){this._tabIndex!==g&&(this._tabIndex=g,this._impl&&this._impl.setTabIndex(g))}}]),e}(cS))._EditBoxImpl=tiX,tiz.KeyboardReturnType=tic,tiz.InputFlag=tif,tiz.InputMode=ti_,tiz.EventType=tiW,p((tiI=tiz).prototype,"textLabel",[tiv],Object.getOwnPropertyDescriptor(tiI.prototype,"textLabel"),tiI.prototype),p(tiI.prototype,"placeholderLabel",[tiy],Object.getOwnPropertyDescriptor(tiI.prototype,"placeholderLabel"),tiI.prototype),p(tiI.prototype,"backgroundImage",[tiS],Object.getOwnPropertyDescriptor(tiI.prototype,"backgroundImage"),tiI.prototype),p(tiI.prototype,"inputFlag",[tiA],Object.getOwnPropertyDescriptor(tiI.prototype,"inputFlag"),tiI.prototype),p(tiI.prototype,"inputMode",[tiT],Object.getOwnPropertyDescriptor(tiI.prototype,"inputMode"),tiI.prototype),p(tiI.prototype,"returnType",[tiE],Object.getOwnPropertyDescriptor(tiI.prototype,"returnType"),tiI.prototype),tiB=ws(tiI.prototype,"editingDidBegan",[tiC,n2],function(){return[]}),tiP=ws(tiI.prototype,"textChanged",[tix,n2],function(){return[]}),tiD=ws(tiI.prototype,"editingDidEnded",[tib,n2],function(){return[]}),tiM=ws(tiI.prototype,"editingReturn",[tiR,n2],function(){return[]}),tiO=ws(tiI.prototype,"_textLabel",[n2],function(){return null}),tiL=ws(tiI.prototype,"_placeholderLabel",[n2],function(){return null}),tiF=ws(tiI.prototype,"_returnType",[n2],function(){return tic.DEFAULT}),tiN=ws(tiI.prototype,"_string",[n2],function(){return""}),tik=ws(tiI.prototype,"_tabIndex",[n2],function(){return 0}),tiG=ws(tiI.prototype,"_backgroundImage",[n2],function(){return null}),tiV=ws(tiI.prototype,"_inputFlag",[n2],function(){return tif.DEFAULT}),tiU=ws(tiI.prototype,"_inputMode",[n2],function(){return ti_.ANY}),tiH=ws(tiI.prototype,"_maxLength",[n2],function(){return 20}),tiw=tiI))||tiw)||tiw)||tiw));"object"==("undefined"==typeof window?"undefined":_type_of(window))&&"object"==("undefined"==typeof document?"undefined":_type_of(document))&&(tnE._EditBoxImpl=tiQ),X.internal.EditBox=tnE,function(g){g[g.NONE=0]="NONE",g[g.HORIZONTAL=1]="HORIZONTAL",g[g.VERTICAL=2]="VERTICAL",g[g.GRID=3]="GRID"}(tng||(tng={})),oe(tng),function(g){g[g.NONE=0]="NONE",g[g.CONTAINER=1]="CONTAINER",g[g.CHILDREN=2]="CHILDREN"}(tnv||(tnv={})),oe(tnv),function(g){g[g.HORIZONTAL=0]="HORIZONTAL",g[g.VERTICAL=1]="VERTICAL"}(tny||(tny={})),oe(tny),function(g){g[g.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",g[g.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(tnS||(tnS={})),oe(tnS),function(g){g[g.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",g[g.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(tnA||(tnA={})),oe(tnA),function(g){g[g.NONE=0]="NONE",g[g.FIXED_ROW=1]="FIXED_ROW",g[g.FIXED_COL=2]="FIXED_COL"}(tnT||(tnT={})),oe(tnT);var tnC,tnx,tnb,tnR,tnw,tnI,tnB,tnP,tnD,tnM,tnO,tnL,tnF,tnN,tnk=new eL,tnG=g("f3",(ti$=nJ("cc.Layout"),ti0=nQ(110),ti1=nZ(P2),ti2=ma(tng),ti3=ma(tnv),ti5=ma(tny),ti4=ma(tnS),ti8=ma(tnA),ti6=ma(tnT),ti$(ti7=ti0(ti7=ti1(((tnm=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._resizeMode=tnt&&tnt(),v._layoutType=tne&&tne(),v._cellSize=tni&&tni(),v._startAxis=tnn&&tnn(),v._paddingLeft=tnr&&tnr(),v._paddingRight=tns&&tns(),v._paddingTop=tna&&tna(),v._paddingBottom=tno&&tno(),v._spacingX=tnh&&tnh(),v._spacingY=tnu&&tnu(),v._verticalDirection=tnl&&tnl(),v._horizontalDirection=tnc&&tnc(),v._constraint=tn_&&tn_(),v._constraintNum=tnf&&tnf(),v._affectedByScale=tnd&&tnd(),v._isAlign=tnp&&tnp(),v._layoutSize=new iu(300,200),v._layoutDirty=!0,v._childrenDirty=!1,v._usefulLayoutObj=[],v._init=!1,v}s(e,g);var v=e.prototype;return v.updateLayout=function(g){void 0===g&&(g=!1),(this._layoutDirty||g)&&(this._doLayout(),this._layoutDirty=!1)},v.onEnable=function(){this._addEventListeners();var g=this.node._uiProps.uiTransformComp;g.contentSize.equals(iu.ZERO)&&g.setContentSize(this._layoutSize),this._childrenChanged()},v.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},v._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var g=this.node.children,v=0;v<g.length;++v){var S=g[v],O=S._uiProps.uiTransformComp;S.activeInHierarchy&&O&&this._usefulLayoutObj.push(O)}},v._addEventListeners=function(){II.on(Iw.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(md.SIZE_CHANGED,this._resized,this),this.node.on(md.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(md.CHILD_ADDED,this._childAdded,this),this.node.on(md.CHILD_REMOVED,this._childRemoved,this),this.node.on(md.CHILDREN_ORDER_CHANGED,this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},v._removeEventListeners=function(){II.off(Iw.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(md.SIZE_CHANGED,this._resized,this),this.node.off(md.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(md.CHILD_ADDED,this._childAdded,this),this.node.off(md.CHILD_REMOVED,this._childRemoved,this),this.node.off(md.CHILDREN_ORDER_CHANGED,this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},v._addChildrenEventListeners=function(){for(var g=this.node.children,v=0;v<g.length;++v){var S=g[v];S.on(md.SIZE_CHANGED,this._doLayoutDirty,this),S.on(md.TRANSFORM_CHANGED,this._transformDirty,this),S.on(md.ANCHOR_CHANGED,this._doLayoutDirty,this),S.on(md.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},v._removeChildrenEventListeners=function(){for(var g=this.node.children,v=0;v<g.length;++v){var S=g[v];S.off(md.SIZE_CHANGED,this._doLayoutDirty,this),S.off(md.TRANSFORM_CHANGED,this._transformDirty,this),S.off(md.ANCHOR_CHANGED,this._doLayoutDirty,this),S.off(md.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},v._childAdded=function(g){g.on(md.SIZE_CHANGED,this._doLayoutDirty,this),g.on(md.TRANSFORM_CHANGED,this._transformDirty,this),g.on(md.ANCHOR_CHANGED,this._doLayoutDirty,this),g.on(md.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},v._childRemoved=function(g){g.off(md.SIZE_CHANGED,this._doLayoutDirty,this),g.off(md.TRANSFORM_CHANGED,this._transformDirty,this),g.off(md.ANCHOR_CHANGED,this._doLayoutDirty,this),g.off(md.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},v._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},v._doLayoutHorizontally=function(g,v,S,O){var X=this.node._uiProps.uiTransformComp.anchorPoint,Y=this._getFixedBreakingNum(),te=1,ti=this._paddingLeft;this._horizontalDirection===tnA.RIGHT_TO_LEFT&&(te=-1,ti=this._paddingRight);var tr=(this._horizontalDirection-X.x)*g+te*ti,ta=tr-te*this._spacingX,th=0,tu=0,tl=0,tc=0,t_=!1,tf=this._usefulLayoutObj.length,tp=this._cellSize.width,tm=this._getPaddingH();this._layoutType!==tng.GRID&&this._resizeMode===tnv.CHILDREN&&(tp=(g-tm-(tf-1)*this._spacingX)/tf);for(var tg=this._usefulLayoutObj,tv=0;tv<tg.length;++tv){var ty=tg[tv],tS=ty.node,tA=tS.scale,tT=this._getUsedScaleValue(tA.x),tE=this._getUsedScaleValue(tA.y);this._resizeMode===tnv.CHILDREN&&(ty.width=tp/tT,this._layoutType===tng.GRID&&(ty.height=this._cellSize.height/tE));var tC=Math.abs(this._horizontalDirection-ty.anchorX),tx=ty.width*tT,tb=ty.height*tE;tb>tl&&(tc=Math.max(tl,tc),tu=tl||tb,tl=tb),ta+=te*(tC*tx+this._spacingX);var tw=te*(1-tC)*tx;if(v){if(Y>0)(t_=tv/Y>0&&tv%Y==0)&&(tu=tl>tb?tl:tu);else if(tx>g-tm)ta>tr+te*tC*tx&&(t_=!0);else{var tI=(1-this._horizontalDirection-X.x)*g,tB=ta+tw+te*(te>0?this._paddingRight:this._paddingLeft);t_=Math.abs(tB)>Math.abs(tI)}t_&&(ta=tr+te*tC*tx,tb!==tl&&(tu=tl),th+=tu+this._spacingY,tu=tl=tb)}var tP=S(tS,ty,th);O&&tS.setPosition(ta,tP),ta+=tw}return tu=Math.max(tu,tl),Math.max(tc,th+tu)+this._getPaddingV()},v._doLayoutVertically=function(g,v,S,O){var X=this.node._uiProps.uiTransformComp.anchorPoint,Y=this._getFixedBreakingNum(),te=1,ti=this._paddingBottom;this._verticalDirection===tnS.TOP_TO_BOTTOM&&(te=-1,ti=this._paddingTop);var tr=(this._verticalDirection-X.y)*g+te*ti,ta=tr-te*this._spacingY,th=0,tu=0,tl=0,tc=0,t_=!1,tf=this._usefulLayoutObj.length,tp=this._cellSize.height,tm=this._getPaddingV();this._layoutType!==tng.GRID&&this._resizeMode===tnv.CHILDREN&&(tp=(g-tm-(tf-1)*this._spacingY)/tf);for(var tg=this._usefulLayoutObj,tv=0;tv<tg.length;++tv){var ty=tg[tv],tS=ty.node,tA=tS.scale,tT=this._getUsedScaleValue(tA.x),tE=this._getUsedScaleValue(tA.y);this._resizeMode===tnv.CHILDREN&&(ty.height=tp/tE,this._layoutType===tng.GRID&&(ty.width=this._cellSize.width/tT));var tC=Math.abs(this._verticalDirection-ty.anchorY),tx=ty.width*tT,tb=ty.height*tE;tx>th&&(tu=Math.max(th,tu),tl=th||tx,th=tx),ta+=te*(tC*tb+this._spacingY);var tw=te*(1-tC)*tb;if(v){if(Y>0)(t_=tv/Y>0&&tv%Y==0)&&(tl=th>tb?th:tl);else if(tb>g-tm)ta>tr+te*tC*tb&&(t_=!0);else{var tI=(1-this._verticalDirection-X.y)*g,tB=ta+tw+te*(te>0?this._paddingTop:this._paddingBottom);t_=Math.abs(tB)>Math.abs(tI)}t_&&(ta=tr+te*tC*tb,tx!==th&&(tl=th),tc+=tl+this._spacingX,tl=th=tx)}var tP=S(tS,ty,tc);O&&(tS.getPosition(tnk),tS.setPosition(tP,ta,tnk.z)),ta+=tw}return tl=Math.max(tl,th),Math.max(tu,tc+tl)+this._getPaddingH()},v._doLayoutGridAxisHorizontal=function(g,v){var S=this,O=v.width,X=1,Y=-g.y*v.height,te=this._paddingBottom;this._verticalDirection===tnS.TOP_TO_BOTTOM&&(X=-1,Y=(1-g.y)*v.height,te=this._paddingTop);var o=function(g,v,O){return Y+X*(O+(1-v.anchorY)*v.height*S._getUsedScaleValue(g.scale.y)+te)},ti=0;this._resizeMode===tnv.CONTAINER&&(ti=this._doLayoutHorizontally(O,!0,o,!1),Y=-g.y*ti,this._verticalDirection===tnS.TOP_TO_BOTTOM&&(X=-1,Y=(1-g.y)*ti)),this._doLayoutHorizontally(O,!0,o,!0),this._resizeMode===tnv.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(O,ti)},v._doLayoutGridAxisVertical=function(g,v){var S=this,O=v.height,X=1,Y=-g.x*v.width,te=this._paddingLeft;this._horizontalDirection===tnA.RIGHT_TO_LEFT&&(X=-1,Y=(1-g.x)*v.width,te=this._paddingRight);var o=function(g,v,O){return Y+X*(O+(1-v.anchorX)*v.width*S._getUsedScaleValue(g.scale.x)+te)},ti=0;this._resizeMode===tnv.CONTAINER&&(ti=this._doLayoutVertically(O,!0,o,!1),Y=-g.x*ti,this._horizontalDirection===tnA.RIGHT_TO_LEFT&&(X=-1,Y=(1-g.x)*ti)),this._doLayoutVertically(O,!0,o,!0),this._resizeMode===tnv.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(ti,O)},v._doLayoutGrid=function(){var g=this.node._uiProps.uiTransformComp,v=g.anchorPoint,S=g.contentSize;this.startAxis===tny.HORIZONTAL?this._doLayoutGridAxisHorizontal(v,S):this.startAxis===tny.VERTICAL&&this._doLayoutGridAxisVertical(v,S)},v._getHorizontalBaseWidth=function(){var g=this._usefulLayoutObj,v=0,S=g.length;if(this._resizeMode===tnv.CONTAINER){for(var O=0;O<g.length;++O){var X=g[O],Y=X.node.scale;v+=X.width*this._getUsedScaleValue(Y.x)}v+=(S-1)*this._spacingX+this._getPaddingH()}else v=this.node._uiProps.uiTransformComp.width;return v},v._getVerticalBaseHeight=function(){var g=this._usefulLayoutObj,v=0,S=g.length;if(this._resizeMode===tnv.CONTAINER){for(var O=0;O<g.length;++O){var X=g[O],Y=X.node.scale;v+=X.height*this._getUsedScaleValue(Y.y)}v+=(S-1)*this._spacingY+this._getPaddingV()}else v=this.node._uiProps.uiTransformComp.height;return v},v._doLayout=function(){var g=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===tng.HORIZONTAL){var v=this._getHorizontalBaseWidth();this._doLayoutHorizontally(v,!1,function(v){return(g._isAlign?eL.ZERO:v.position).y},!0),this.node._uiProps.uiTransformComp.width=v}else if(this._layoutType===tng.VERTICAL){var S=this._getVerticalBaseHeight();this._doLayoutVertically(S,!1,function(v){return(g._isAlign?eL.ZERO:v.position).x},!0),this.node._uiProps.uiTransformComp.height=S}else this._layoutType===tng.GRID&&this._doLayoutGrid()},v._getUsedScaleValue=function(g){return this._affectedByScale?Math.abs(g):1},v._transformDirty=function(g){g&pq.SCALE&&g&pq.POSITION&&this._affectedByScale&&this._doLayoutDirty()},v._doLayoutDirty=function(){this._layoutDirty=!0},v._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},v._getPaddingH=function(){return this._paddingLeft+this._paddingRight},v._getPaddingV=function(){return this._paddingTop+this._paddingBottom},v._getFixedBreakingNum=function(){if(this._layoutType!==tng.GRID||this._constraint===tnT.NONE||this._constraintNum<=0)return 0;var g=this._constraint===tnT.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===tny.VERTICAL&&(g=this._constraint===tnT.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),g},n(e,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(g){this._layoutType===tng.HORIZONTAL&&(this._isAlign=g,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(g){this._layoutType===tng.VERTICAL&&(this._isAlign=g,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(g){this._layoutType=g,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(g){this._layoutType!==tng.NONE&&(this._resizeMode=g,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(g){this._cellSize!==g&&(this._cellSize.set(g),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(g){this._startAxis!==g&&(this._startAxis=g,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(g){this._paddingLeft!==g&&(this._paddingLeft=g,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(g){this._paddingRight!==g&&(this._paddingRight=g,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(g){this._paddingTop!==g&&(this._paddingTop=g,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(g){this._paddingBottom!==g&&(this._paddingBottom=g,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(g){this._spacingX!==g&&(this._spacingX=g,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(g){this._spacingY!==g&&(this._spacingY=g,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(g){this._verticalDirection!==g&&(this._verticalDirection=g,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(g){this._horizontalDirection!==g&&(this._horizontalDirection=g,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(g){this.paddingLeft===g&&this._paddingRight===g&&this._paddingTop===g&&this._paddingBottom===g||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=g,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(g){this._layoutType!==tng.NONE&&this._constraint!==g&&(this._constraint=g,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(g){this._constraint!==tnT.NONE&&this._constraintNum!==g&&(g<=0&&G("Limit values to be greater than 0"),this._constraintNum=g,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(g){this._affectedByScale=g,this._doLayoutDirty()}}]),e}(cS)).Type=tng,tnm.VerticalDirection=tnS,tnm.HorizontalDirection=tnA,tnm.ResizeMode=tnv,tnm.AxisDirection=tny,tnm.Constraint=tnT,p((ti9=tnm).prototype,"type",[ti2],Object.getOwnPropertyDescriptor(ti9.prototype,"type"),ti9.prototype),p(ti9.prototype,"resizeMode",[ti3],Object.getOwnPropertyDescriptor(ti9.prototype,"resizeMode"),ti9.prototype),p(ti9.prototype,"startAxis",[ti5],Object.getOwnPropertyDescriptor(ti9.prototype,"startAxis"),ti9.prototype),p(ti9.prototype,"verticalDirection",[ti4],Object.getOwnPropertyDescriptor(ti9.prototype,"verticalDirection"),ti9.prototype),p(ti9.prototype,"horizontalDirection",[ti8],Object.getOwnPropertyDescriptor(ti9.prototype,"horizontalDirection"),ti9.prototype),p(ti9.prototype,"constraint",[ti6],Object.getOwnPropertyDescriptor(ti9.prototype,"constraint"),ti9.prototype),tnt=ws(ti9.prototype,"_resizeMode",[n2],function(){return tnv.NONE}),tne=ws(ti9.prototype,"_layoutType",[n2],function(){return tng.NONE}),tni=ws(ti9.prototype,"_cellSize",[n2],function(){return new iu(40,40)}),tnn=ws(ti9.prototype,"_startAxis",[n2],function(){return tny.HORIZONTAL}),tnr=ws(ti9.prototype,"_paddingLeft",[n2],function(){return 0}),tns=ws(ti9.prototype,"_paddingRight",[n2],function(){return 0}),tna=ws(ti9.prototype,"_paddingTop",[n2],function(){return 0}),tno=ws(ti9.prototype,"_paddingBottom",[n2],function(){return 0}),tnh=ws(ti9.prototype,"_spacingX",[n2],function(){return 0}),tnu=ws(ti9.prototype,"_spacingY",[n2],function(){return 0}),tnl=ws(ti9.prototype,"_verticalDirection",[n2],function(){return tnS.TOP_TO_BOTTOM}),tnc=ws(ti9.prototype,"_horizontalDirection",[n2],function(){return tnA.LEFT_TO_RIGHT}),tn_=ws(ti9.prototype,"_constraint",[n2],function(){return tnT.NONE}),tnf=ws(ti9.prototype,"_constraintNum",[n2],function(){return 2}),tnd=ws(ti9.prototype,"_affectedByScale",[n2],function(){return!1}),tnp=ws(ti9.prototype,"_isAlign",[n2],function(){return!1}),ti7=ti9))||ti7)||ti7)||ti7));X.Layout=tnG,function(g){g[g.HORIZONTAL=0]="HORIZONTAL",g[g.VERTICAL=1]="VERTICAL",g[g.FILLED=2]="FILLED"}(tnN||(tnN={})),re(tnN);var tnV,tnU,tnH,tnz,tnW,tnX,tnj,tnq,tnY,tnK,tnJ,tnZ,tnQ,tn$=g("f4",(tnC=nJ("cc.ProgressBar"),tnx=nQ(110),tnb=nZ(P2),tnR=ma(O3),tnw=ma(tnN),tnC(tnI=tnx(tnI=tnb(((tnF=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._barSprite=tnP&&tnP(),v._mode=tnD&&tnD(),v._totalLength=tnM&&tnM(),v._progress=tnO&&tnO(),v._reverse=tnL&&tnL(),v}s(e,g);var v=e.prototype;return v.onLoad=function(){this._updateBarStatus()},v._initBarSprite=function(){if(this._barSprite){var g=this._barSprite.node;if(!g)return;var v=this.node._uiProps.uiTransformComp,S=v.contentSize,O=v.anchorPoint,X=g._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===O3.FillType.RADIAL&&(this._mode=tnN.FILLED),this._mode===tnN.HORIZONTAL?this.totalLength=X.width:this._mode===tnN.VERTICAL?this.totalLength=X.height:this.totalLength=this._barSprite.fillRange,g.parent===this.node){var Y=-S.width*O.x;g.setPosition(Y,0,0)}}},v._updateBarStatus=function(){if(this._barSprite){var g=this._barSprite.node;if(!g)return;var v=g._uiProps.uiTransformComp,S=v.anchorPoint,O=v.contentSize,X=g.getPosition(),Y=new e8(0,.5),te=gi(this._progress),ti=this._totalLength*te,tr=O,ta=0,th=0;switch(this._mode){case tnN.HORIZONTAL:this._reverse&&(Y=new e8(1,.5)),tr=new iu(ti,O.height),ta=this._totalLength,th=O.height;break;case tnN.VERTICAL:Y=this._reverse?new e8(.5,1):new e8(.5,0),tr=new iu(O.width,ti),ta=O.width,th=this._totalLength}if(this._mode===tnN.FILLED)this._barSprite.type!==O3.Type.FILLED?G("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(ti*=-1),this._barSprite.fillRange=ti);else if(this._barSprite.type!==O3.Type.FILLED){var tu=Y.x-S.x,tl=Y.y-S.y,tc=new eL(ta*tu,th*tl,0);g.setPosition(X.x+tc.x,X.y+tc.y,X.z),v.setAnchorPoint(Y),v.setContentSize(tr)}else G("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},n(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(g){this._barSprite!==g&&(this._barSprite=g,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(g){if(this._mode!==g&&(this._mode=g,this._barSprite)){var v=this._barSprite.node;if(!v)return;var S=v._uiProps.uiTransformComp.contentSize;this._mode===tnN.HORIZONTAL?this.totalLength=S.width:this._mode===tnN.VERTICAL?this.totalLength=S.height:this._mode===tnN.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(g){this._mode===tnN.FILLED&&(g=gi(g)),this._totalLength!==g&&(this._totalLength=g,this._updateBarStatus())}},{key:"progress",get:function(){return this._progress},set:function(g){this._progress!==g&&(this._progress=g,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(g){this._reverse!==g&&(this._reverse=g,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}(cS)).Mode=tnN,p((tnB=tnF).prototype,"barSprite",[tnR],Object.getOwnPropertyDescriptor(tnB.prototype,"barSprite"),tnB.prototype),p(tnB.prototype,"mode",[tnw],Object.getOwnPropertyDescriptor(tnB.prototype,"mode"),tnB.prototype),tnP=ws(tnB.prototype,"_barSprite",[n2],function(){return null}),tnD=ws(tnB.prototype,"_mode",[n2],function(){return tnN.HORIZONTAL}),tnM=ws(tnB.prototype,"_totalLength",[n2],function(){return 1}),tnO=ws(tnB.prototype,"_progress",[n2],function(){return .1}),tnL=ws(tnB.prototype,"_reverse",[n2],function(){return!1}),tnI=tnB))||tnI)||tnI)||tnI));X.ProgressBar=tn$;var tn0,tn1=new eL,tn2=new eL,tn3=new eL,tn5=new e8,tn4=new is,tn8=new e8;!function(g){g[g.HORIZONTAL=0]="HORIZONTAL",g[g.VERTICAL=1]="VERTICAL"}(tn0||(tn0={})),oe(tn0);var tn6,tn7=g("f5",(tnV=nJ("cc.ScrollBar"),tnU=nQ(110),tnH=nZ(P2),tnz=ma(O3),tnW=ma(tn0),tnV(tnX=tnU(tnX=tnH(((tnQ=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._scrollView=tnq&&tnq(),v._handle=tnY&&tnY(),v._direction=tnK&&tnK(),v._enableAutoHide=tnJ&&tnJ(),v._autoHideTime=tnZ&&tnZ(),v._touching=!1,v._opacity=255,v._autoHideRemainingTime=0,v}s(e,g);var v=e.prototype;return v.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},v.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._opacity=255,this._setOpacity(this._opacity)},v.onScroll=function(g){if(this._scrollView){var v=this._scrollView.content;if(v){var S=v._uiProps.uiTransformComp.contentSize,O=this._scrollView.node._uiProps.uiTransformComp.contentSize,X=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(S,O)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var Y=0,te=0,ti=0,tr=0,ta=0,th=tn8;th.set(0,0),this._direction===tn0.HORIZONTAL?(Y=S.width,te=O.width,ta=X.width,ti=g.x,this._convertToScrollViewSpace(th,v),tr=-th.x):this._direction===tn0.VERTICAL&&(Y=S.height,te=O.height,ta=X.height,ti=g.y,this._convertToScrollViewSpace(th,v),tr=-th.y);var tu=this._calculateLength(Y,te,ta,ti),tl=tn8;this._calculatePosition(tl,Y,te,ta,tr,ti,tu),this._updateLength(tu),this._updateHandlerPosition(tl)}}}},v.setScrollView=function(g){this._scrollView=g},v.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},v.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var g=this._scrollView.content;if(g){var v=g._uiProps.uiTransformComp.contentSize,S=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(v,S))return}}this._autoHideRemainingTime=this._autoHideTime}},v.onEnable=function(){var g=this.node.getComponent(O3);g&&(this._opacity=g.color.a)},v.start=function(){this._enableAutoHide&&this._setOpacity(0)},v.update=function(g){this._processAutoHide(g)},v._convertToScrollViewSpace=function(g,v){var S=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,O=v._uiProps.uiTransformComp;if(S&&O){tn1.set(-O.anchorX*O.width,-O.anchorY*O.height,0),O.convertToWorldSpaceAR(tn1,tn2);var X=S.convertToNodeSpaceAR(tn2);X.x+=S.anchorX*S.width,X.y+=S.anchorY*S.height,g.set(X.x,X.y)}else g.set(e8.ZERO)},v._setOpacity=function(g){if(this._handle){var v=this.node.getComponent(O3);v&&(tn4.set(v.color),tn4.a=g,v.color=tn4),(v=this._handle.getComponent(O3))&&(tn4.set(v.color),tn4.a=g,v.color=tn4)}},v._updateHandlerPosition=function(g){if(this._handle){var v=tn3;this._fixupHandlerPosition(v),this._handle.node.setPosition(g.x+v.x,g.y+v.y,v.z)}},v._fixupHandlerPosition=function(g){var v=this.node._uiProps.uiTransformComp,S=v.contentSize,O=v.anchorPoint,X=this.handle.node._uiProps.uiTransformComp.contentSize,Y=this.handle.node.parent;eL.set(tn1,-S.width*O.x,-S.height*O.y,0);var te=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR(tn1,tn2),ti=g;ti.set(0,0,0),Y._uiProps.uiTransformComp.convertToNodeSpaceAR(te,ti),this.direction===tn0.HORIZONTAL?ti.set(ti.x,ti.y+(S.height-X.height)/2,ti.z):this.direction===tn0.VERTICAL&&ti.set(ti.x+(S.width-X.width)/2,ti.y,ti.z),this.handle.node.setPosition(ti)},v._conditionalDisableScrollBar=function(g,v){return g.width<=v.width&&this._direction===tn0.HORIZONTAL||g.height<=v.height&&this._direction===tn0.VERTICAL},v._calculateLength=function(g,v,S,O){var X=g;return O&&(X+=20*(O>0?O:-O)),v/X*S},v._calculatePosition=function(g,v,S,O,X,Y,te){var ti=v-S;Y&&(ti+=Math.abs(Y));var tr=0;ti&&(tr=gi(tr=X/ti));var ta=(O-te)*tr;this._direction===tn0.VERTICAL?g.set(0,ta):g.set(ta,0)},v._updateLength=function(g){if(this._handle){var v=this._handle.node._uiProps.uiTransformComp,S=v.contentSize,O=v.anchorPoint;O.x===tn5.x&&O.y===tn5.y||v.setAnchorPoint(tn5),this._direction===tn0.HORIZONTAL?v.setContentSize(g,S.height):v.setContentSize(S.width,g)}},v._processAutoHide=function(g){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=g,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var v=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(v)}},n(e,[{key:"handle",get:function(){return this._handle},set:function(g){this._handle!==g&&(this._handle=g,this.onScroll(e8.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(g){this._direction!==g&&(this._direction=g,this.onScroll(e8.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(g){this._enableAutoHide!==g&&(this._enableAutoHide=g,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(g){this._autoHideTime!==g&&(this._autoHideTime=g)}}]),e}(cS)).Direction=tn0,p((tnj=tnQ).prototype,"handle",[tnz],Object.getOwnPropertyDescriptor(tnj.prototype,"handle"),tnj.prototype),p(tnj.prototype,"direction",[tnW],Object.getOwnPropertyDescriptor(tnj.prototype,"direction"),tnj.prototype),tnq=ws(tnj.prototype,"_scrollView",[n2],function(){return null}),tnY=ws(tnj.prototype,"_handle",[n2],function(){return null}),tnK=ws(tnj.prototype,"_direction",[n2],function(){return tn0.HORIZONTAL}),tnJ=ws(tnj.prototype,"_enableAutoHide",[n2],function(){return!1}),tnZ=ws(tnj.prototype,"_autoHideTime",[n2],function(){return 1}),tnX=tnj))||tnX)||tnX)||tnX));X.ScrollBar=tn7;var tn9,trt,tre,tri,trn,trr,trs,tra,tro,trh,tru,trl,trc,tr_,trf,trd,trp,trm,trg,trv,trS,trA=g("fa",nJ("cc.ViewGroup")(tn6=nQ(110)(tn6=function(g){function e(){return g.apply(this,arguments)||this}return s(e,g),e}(cS))||tn6)||tn6);X.ViewGroup=trA;var trT,trE,trC=1e-4,trx=new eL,trb=new eL,trR=new e8,trw=new e8,prt=function(){return(new Date).getMilliseconds()},trI={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(g){g.NONE="",g.SCROLL_TO_TOP="scroll-to-top",g.SCROLL_TO_BOTTOM="scroll-to-bottom",g.SCROLL_TO_LEFT="scroll-to-left",g.SCROLL_TO_RIGHT="scroll-to-right",g.SCROLL_BEGAN="scroll-began",g.SCROLL_ENDED="scroll-ended",g.BOUNCE_TOP="bounce-top",g.BOUNCE_BOTTOM="bounce-bottom",g.BOUNCE_LEFT="bounce-left",g.BOUNCE_RIGHT="bounce-right",g.SCROLLING="scrolling",g.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",g.TOUCH_UP="touch-up"}(trT||(trT={})),function(g){g[g.NONE=0]="NONE",g[g.LEFT=1]="LEFT",g[g.RIGHT=2]="RIGHT"}(trE||(trE={}));var trB,trP,trD,trM,trO,trL,trF,trN,trk,trG,trV,trU,trH,trz=g("f6",(tn9=nJ("cc.ScrollView"),trt=nQ(110),tre=nZ(P2),tri=ma(mJ),trn=ma(tn7),trr=ma(tn7),trs=ma([cd]),tn9(tra=trt(tra=tre(((trS=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).bounceDuration=trh&&trh(),v.brake=tru&&tru(),v.elastic=trl&&trl(),v.inertia=trc&&trc(),v.horizontal=tr_&&tr_(),v.vertical=trf&&trf(),v.cancelInnerEvents=trd&&trd(),v.scrollEvents=trp&&trp(),v._autoScrolling=!1,v._scrolling=!1,v._content=trm&&trm(),v._horizontalScrollBar=trg&&trg(),v._verticalScrollBar=trv&&trv(),v._topBoundary=0,v._bottomBoundary=0,v._leftBoundary=0,v._rightBoundary=0,v._touchMoveDisplacements=[],v._touchMoveTimeDeltas=[],v._touchMovePreviousTimestamp=0,v._touchMoved=!1,v._autoScrollAttenuate=!1,v._autoScrollStartPosition=new eL,v._autoScrollTargetDelta=new eL,v._autoScrollTotalTime=0,v._autoScrollAccumulatedTime=0,v._autoScrollCurrentlyOutOfBoundary=!1,v._autoScrollBraking=!1,v._autoScrollBrakingStartPosition=new eL,v._outOfBoundaryAmount=new eL,v._outOfBoundaryAmountDirty=!0,v._stopMouseWheel=!1,v._mouseWheelEventElapsedTime=0,v._isScrollEndedWithThresholdEventFired=!1,v._scrollEventEmitMask=0,v._isBouncing=!1,v._contentPos=new eL,v._deltaPos=new eL,v._deltaAmount=new eL,v._hoverIn=trE.NONE,v}s(e,g);var v=e.prototype;return v.scrollToBottom=function(g,v){void 0===v&&(v=!0);var S=this._calculateMovePercentDelta({anchor:new e8(0,0),applyToHorizontal:!1,applyToVertical:!0});g?this._startAutoScroll(S,g,!1!==v):this._moveContent(S,!0)},v.scrollToTop=function(g,v){void 0===v&&(v=!0);var S=this._calculateMovePercentDelta({anchor:new e8(0,1),applyToHorizontal:!1,applyToVertical:!0});g?this._startAutoScroll(S,g,!1!==v):this._moveContent(S)},v.scrollToLeft=function(g,v){void 0===v&&(v=!0);var S=this._calculateMovePercentDelta({anchor:new e8(0,0),applyToHorizontal:!0,applyToVertical:!1});g?this._startAutoScroll(S,g,!1!==v):this._moveContent(S)},v.scrollToRight=function(g,v){void 0===v&&(v=!0);var S=this._calculateMovePercentDelta({anchor:new e8(1,0),applyToHorizontal:!0,applyToVertical:!1});g?this._startAutoScroll(S,g,!1!==v):this._moveContent(S)},v.scrollToTopLeft=function(g,v){void 0===v&&(v=!0);var S=this._calculateMovePercentDelta({anchor:new e8(0,1),applyToHorizontal:!0,applyToVertical:!0});g?this._startAutoScroll(S,g,!1!==v):this._moveContent(S)},v.scrollToTopRight=function(g,v){void 0===v&&(v=!0);var S=this._calculateMovePercentDelta({anchor:new e8(1,1),applyToHorizontal:!0,applyToVertical:!0});g?this._startAutoScroll(S,g,!1!==v):this._moveContent(S)},v.scrollToBottomLeft=function(g,v){void 0===v&&(v=!0);var S=this._calculateMovePercentDelta({anchor:new e8(0,0),applyToHorizontal:!0,applyToVertical:!0});g?this._startAutoScroll(S,g,!1!==v):this._moveContent(S)},v.scrollToBottomRight=function(g,v){void 0===v&&(v=!0);var S=this._calculateMovePercentDelta({anchor:new e8(1,0),applyToHorizontal:!0,applyToVertical:!0});g?this._startAutoScroll(S,g,!1!==v):this._moveContent(S)},v.scrollToOffset=function(g,v,S){void 0===S&&(S=!0);var O=this.getMaxScrollOffset(),X=new e8(0,0);0===O.x?X.x=0:X.x=g.x/O.x,0===O.y?X.y=1:X.y=(O.y-g.y)/O.y,this.scrollTo(X,v,S)},v.getScrollOffset=function(){var g=this._getContentTopBoundary()-this._topBoundary,v=this._getContentLeftBoundary()-this._leftBoundary;return new e8(v,g)},v.getMaxScrollOffset=function(){if(!this._content||!this.view)return e8.ZERO;var g=this._content._uiProps.uiTransformComp.contentSize,v=g.width-this.view.width,S=g.height-this.view.height;return new e8(v=v>=0?v:0,S=S>=0?S:0)},v.scrollToPercentHorizontal=function(g,v,S){var O=this._calculateMovePercentDelta({anchor:new e8(g,0),applyToHorizontal:!0,applyToVertical:!1});v?this._startAutoScroll(O,v,!1!==S):this._moveContent(O)},v.scrollTo=function(g,v,S){var O=this._calculateMovePercentDelta({anchor:new e8(g),applyToHorizontal:!0,applyToVertical:!0});v?this._startAutoScroll(O,v,S):this._moveContent(O)},v.scrollToPercentVertical=function(g,v,S){var O=this._calculateMovePercentDelta({anchor:new e8(0,g),applyToHorizontal:!1,applyToVertical:!0});v?this._startAutoScroll(O,v,S):this._moveContent(O)},v.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},v.setContentPosition=function(g){this._setContentPosition(g)},v._setContentPosition=function(g){if(this._content){var v=this._getContentPosition();Math.abs(g.x-v.x)<trC&&Math.abs(g.y-v.y)<trC||(this._content.setPosition(g),this._outOfBoundaryAmountDirty=!0)}},v.getContentPosition=function(){return this._getContentPosition()},v._getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):eL.ZERO.clone()},v.isScrolling=function(){return this._scrolling},v.isAutoScrolling=function(){return this._autoScrolling},v.getScrollEndedEventTiming=function(){return trC},v.start=function(){this._calculateBoundary(),this._content&&II.once(Iw.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},v.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(md.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(md.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(md.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(md.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},v.update=function(g){var v=this._deltaAmount;this._autoScrolling?(this._processAutoScrolling(g),v.x=0,v.y=0):0===v.x&&0===v.y||(this._processDeltaMove(v),v.x=0,v.y=0)},v.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(md.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(md.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(md.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(md.SIZE_CHANGED,this._calculateBoundary,this))),this._deltaAmount.set(0,0),this._hideScrollBar(),this.stopAutoScroll()},v._registerEvent=function(){this.node.on(md.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(md.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(md.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(md.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(md.MOUSE_WHEEL,this._onMouseWheel,this,!0),this.node.on(teF.XRUI_HOVER_ENTERED,this._xrHoverEnter,this),this.node.on(teF.XRUI_HOVER_EXITED,this._xrHoverExit,this),RJ.on(RK.EventType.HANDLE_INPUT,this._dispatchEventHandleInput,this),RJ.on(RK.EventType.GAMEPAD_INPUT,this._dispatchEventHandleInput,this)},v._unregisterEvent=function(){this.node.off(md.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(md.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(md.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(md.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(md.MOUSE_WHEEL,this._onMouseWheel,this,!0),this.node.off(teF.XRUI_HOVER_ENTERED,this._xrHoverEnter,this),this.node.off(teF.XRUI_HOVER_EXITED,this._xrHoverExit,this),RJ.off(RK.EventType.HANDLE_INPUT,this._dispatchEventHandleInput,this),RJ.off(RK.EventType.GAMEPAD_INPUT,this._dispatchEventHandleInput,this)},v._onMouseWheel=function(g,v){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(g,v)){var S=new eL,O=g.getScrollY();this.vertical?S.set(0,-.1*O,0):this.horizontal&&S.set(-.1*O,0,0),this._mouseWheelEventElapsedTime=0,this._deltaAmount.add(S),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(g)}},v._onTouchBegan=function(g,v){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(g,v)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(g)))},v._onTouchMoved=function(g,v){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(g,v)){var S=g.touch;if(this._handleMoveLogic(S),this.cancelInnerEvents){var O=S.getUILocation(trR);if(O.subtract(S.getUIStartLocation(trw)),O.length()>7&&!this._touchMoved&&g.target!==this.node){var X=new b4(g.getTouches(),g.bubbles,bZ.TOUCH_CANCEL);X.touch=g.touch,X.simulate=!0,g.target.dispatchEvent(X),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(g)}}},v._onTouchEnded=function(g,v){if(this.enabledInHierarchy&&this._content&&g&&!this._hasNestedViewGroup(g,v)){this._dispatchEvent(trT.TOUCH_UP);var S=g.touch;this._handleReleaseLogic(S),this._touchMoved?g.propagationStopped=!0:this._stopPropagationIfTargetIsMe(g)}},v._onTouchCancelled=function(g,v){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(g,v)){if(g&&!g.simulate){var S=g.touch;this._handleReleaseLogic(S)}this._stopPropagationIfTargetIsMe(g)}},v._calculateBoundary=function(){if(this._content&&this.view){var g=this._content.getComponent(tnG);g&&g.enabledInHierarchy&&g.updateLayout();var v=this.view,S=v.width*v.anchorX,O=v.height*v.anchorY;this._leftBoundary=-S,this._bottomBoundary=-O,this._rightBoundary=this._leftBoundary+v.width,this._topBoundary=this._bottomBoundary+v.height,this._moveContentToTopLeft(v.contentSize)}},v._hasNestedViewGroup=function(g,v){if(!g||g.eventPhase!==b$.CAPTURING_PHASE)return!1;if(v)for(var S,O=f(v);!(S=O()).done;){var X=S.value;if(this.node===X)return!(!g.target||!g.target.getComponent(trA));if(X.getComponent(trA))return!0}return!1},v._startInertiaScroll=function(g){var v=new eL(g);v.multiplyScalar(.7),this._startAttenuatingAutoScroll(v,g)},v._calculateAttenuatedFactor=function(g){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*g+g*g*8e-9))},v._startAttenuatingAutoScroll=function(g,v){var S=g.clone();if(S.normalize(),this._content&&this.view){var O=this._content._uiProps.uiTransformComp.contentSize,X=this.view.contentSize,Y=O.width-X.width,te=O.height-X.height,ti=this._calculateAttenuatedFactor(Y),tr=this._calculateAttenuatedFactor(te);S.x=S.x*Y*(1-this.brake)*ti,S.y=S.y*te*tr*(1-this.brake),S.z=0}var ta=g.length(),th=S.length()/ta;if(S.add(g),this.brake>0&&th>7){th=Math.sqrt(th);var tu=g.clone();tu.multiplyScalar(th),S.set(tu),S.add(g)}var tl=this._calculateAutoScrollTimeByInitialSpeed(v.length());this.brake>0&&th>3&&(tl*=th=3),0===this.brake&&th>1&&(tl*=th),this._startAutoScroll(S,tl,!0)},v._calculateAutoScrollTimeByInitialSpeed=function(g){return Math.sqrt(Math.sqrt(g/5))},v._startAutoScroll=function(g,v,S){void 0===S&&(S=!1);var O=this._flattenVectorByDirection(g);this._autoScrolling=!0,this._autoScrollTargetDelta=O,this._autoScrollAttenuate=S,eL.copy(this._autoScrollStartPosition,this._getContentPosition()),this._autoScrollTotalTime=v,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition.set(0,0,0),this._getHowMuchOutOfBoundary().equals(eL.ZERO,trC)||(this._autoScrollCurrentlyOutOfBoundary=!0)},v._calculateTouchMoveVelocity=function(){var g=new eL,v=0;if((v=this._touchMoveTimeDeltas.reduce(function(g,v){return g+v},v))<=0||v>=.5)g.set(eL.ZERO);else{var S=new eL;S=this._touchMoveDisplacements.reduce(function(g,v){return g.add(v),g},S),g.set(S.x*(1-this.brake)/v,S.y*(1-this.brake)/v,S.z)}return g},v._flattenVectorByDirection=function(g){var v=g;return v.x=this.horizontal?v.x:0,v.y=this.vertical?v.y:0,v},v._moveContent=function(g,v){var S=this._flattenVectorByDirection(g);trx.set(this._getContentPosition()),trx.add(S),trx.set(Math.round(1e4*trx.x)*trC,Math.round(1e4*trx.y)*trC,trx.z),this._setContentPosition(trx);var O=this._getHowMuchOutOfBoundary();trR.set(O.x,O.y),this._updateScrollBar(trR),this.elastic&&v&&this._startBounceBackIfNeeded()},v._getContentLeftBoundary=function(){if(!this._content)return -1;var g=this._getContentPosition(),v=this._content._uiProps.uiTransformComp;return g.x-v.anchorX*v.width},v._getContentRightBoundary=function(){if(!this._content)return -1;var g=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+g.width},v._getContentTopBoundary=function(){if(!this._content)return -1;var g=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+g.height},v._getContentBottomBoundary=function(){if(!this._content)return -1;var g=this._getContentPosition(),v=this._content._uiProps.uiTransformComp;return g.y-v.anchorY*v.height},v._getHowMuchOutOfBoundary=function(g){if((g=g||new eL).equals(eL.ZERO,trC)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var v=new eL,S=this._getContentLeftBoundary(),O=this._getContentRightBoundary();S+g.x>this._leftBoundary?v.x=this._leftBoundary-(S+g.x):O+g.x<this._rightBoundary&&(v.x=this._rightBoundary-(O+g.x));var X=this._getContentTopBoundary(),Y=this._getContentBottomBoundary();return X+g.y<this._topBoundary?v.y=this._topBoundary-(X+g.y):Y+g.y>this._bottomBoundary&&(v.y=this._bottomBoundary-(Y+g.y)),g.equals(eL.ZERO,trC)&&(this._outOfBoundaryAmount=v,this._outOfBoundaryAmountDirty=!1),this._clampDelta(v),v},v._updateScrollBar=function(g){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onScroll(g),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onScroll(g)},v._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchBegan(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchBegan()},v._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchEnded(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchEnded()},v._dispatchEvent=function(g){if(g===trT.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(g===trT.SCROLL_TO_TOP||g===trT.SCROLL_TO_BOTTOM||g===trT.SCROLL_TO_LEFT||g===trT.SCROLL_TO_RIGHT){var v=1<<trI[g];if(this._scrollEventEmitMask&v)return;this._scrollEventEmitMask|=v}cd.emitEvents(this.scrollEvents,this,trI[g]),this.node.emit(g,this)},v._adjustContentOutOfBoundary=function(){if(this._content){this._outOfBoundaryAmountDirty=!0;var g=this._getHowMuchOutOfBoundary();g.equals(eL.ZERO,trC)||(trx.set(this._getContentPosition()),trx.add(g),this._setContentPosition(trx),this._updateScrollBar(e8.ZERO))}},v._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.hide()},v._updateScrollBarState=function(){if(this._content&&this.view){var g=this.view,v=this._content._uiProps.uiTransformComp;this._verticalScrollBar&&this._verticalScrollBar.isValid&&(v.height<g.height||pi(v.height,g.height)?this._verticalScrollBar.hide():this._verticalScrollBar.show()),this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&(v.width<g.width||pi(v.width,g.width)?this._horizontalScrollBar.hide():this._horizontalScrollBar.show())}},v._stopPropagationIfTargetIsMe=function(g){g.eventPhase===b$.AT_TARGET&&g.target===this.node&&(g.propagationStopped=!0)},v._processDeltaMove=function(g){this._scrollChildren(g),this._gatherTouchMove(g)},v._handleMoveLogic=function(g){this._getLocalAxisAlignDelta(this._deltaPos,g),this._deltaAmount.add(this._deltaPos)},v._handleReleaseLogic=function(g){this._getLocalAxisAlignDelta(this._deltaPos,g),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(trT.SCROLL_ENDED))},v._getLocalAxisAlignDelta=function(g,v){var S=this.node._uiProps.uiTransformComp,O=new eL;S&&(v.getUILocation(trR),v.getUIPreviousLocation(trw),trx.set(trR.x,trR.y,0),trb.set(trw.x,trw.y,0),S.convertToNodeSpaceAR(trx,trx),S.convertToNodeSpaceAR(trb,trb),eL.subtract(O,trx,trb)),g.set(O)},v._scrollChildren=function(g){this._clampDelta(g);var v,S=g;this.elastic&&(v=this._getHowMuchOutOfBoundary(),S.x*=0===v.x?1:.5,S.y*=0===v.y?1:.5),this.elastic||(v=this._getHowMuchOutOfBoundary(S),S.add(v));var O=trT.NONE,X=trT.NONE;if(this._content){var Y=this._content._uiProps.uiTransformComp,te=Y.anchorX,ti=Y.anchorY,tr=Y.width,ta=Y.height,th=this._content.position||eL.ZERO;this.vertical&&(S.y>0?th.y-ti*ta+S.y>=this._bottomBoundary&&(O=trT.SCROLL_TO_BOTTOM):S.y<0&&th.y-ti*ta+ta+S.y<=this._topBoundary&&(O=trT.SCROLL_TO_TOP)),this.horizontal&&(S.x<0?th.x-te*tr+tr+S.x<=this._rightBoundary&&(X=trT.SCROLL_TO_RIGHT):S.x>0&&th.x-te*tr+S.x>=this._leftBoundary&&(X=trT.SCROLL_TO_LEFT))}this._moveContent(S,!1),(this.horizontal&&0!==S.x||this.vertical&&0!==S.y)&&(this._scrolling||(this._scrolling=!0,this._dispatchEvent(trT.SCROLL_BEGAN)),this._dispatchEvent(trT.SCROLLING)),O!==trT.NONE&&this._dispatchEvent(O),X!==trT.NONE&&this._dispatchEvent(X)},v._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(trT.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=prt(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},v._clampDelta=function(g){if(this._content&&this.view){var v=this.view.contentSize,S=this._content._uiProps.uiTransformComp;S.width<v.width&&(g.x=0),S.height<v.height&&(g.y=0)}},v._gatherTouchMove=function(g){var v=g.clone();for(this._clampDelta(v);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(v);var S=prt();this._touchMoveTimeDeltas.push((S-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=S},v._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var g=this._getHowMuchOutOfBoundary();if(this._clampDelta(g),g.equals(eL.ZERO,trC))return!1;var v=Math.max(this.bounceDuration,0);return this._startAutoScroll(g,v,!0),this._isBouncing||(g.y>0&&this._dispatchEvent(trT.BOUNCE_TOP),g.y<0&&this._dispatchEvent(trT.BOUNCE_BOTTOM),g.x>0&&this._dispatchEvent(trT.BOUNCE_RIGHT),g.x<0&&this._dispatchEvent(trT.BOUNCE_LEFT),this._isBouncing=!0),!0},v._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var g=this._calculateTouchMoveVelocity();!g.equals(trx,trC)&&this.brake<1&&this._startInertiaScroll(g)}this._onScrollBarTouchEnded()},v._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(eL.ZERO,trC)},v._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,eL.copy(this._autoScrollBrakingStartPosition,this._getContentPosition()),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},v._processAutoScrolling=function(g){var v=this._isNecessaryAutoScrollBrake(),S=v?.05:1;this._autoScrollAccumulatedTime+=1/S*g;var O,X=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(O=X,X=(O-=1)*O*O*O*O+1);var Y=this._autoScrollTargetDelta.clone();Y.multiplyScalar(X);var te=this._autoScrollStartPosition.clone();te.add(Y);var ti=Math.abs(X-1)<=trC;if(Math.abs(X-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(trT.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var tr=te.clone();tr.subtract(this._autoScrollBrakingStartPosition),v&&tr.multiplyScalar(S),te.set(this._autoScrollBrakingStartPosition),te.add(tr)}else{var ta=te.clone();ta.subtract(this.getContentPosition());var th=this._getHowMuchOutOfBoundary(ta);th.equals(eL.ZERO,trC)||(te.add(th),ti=!0)}ti&&(this._autoScrolling=!1);var tu=te.clone();tu.subtract(this._getContentPosition()),this._clampDelta(tu),this._moveContent(tu,ti),this._dispatchEvent(trT.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(trT.SCROLL_ENDED))},v._checkMouseWheel=function(g){if(!this._getHowMuchOutOfBoundary().equals(eL.ZERO,trC))return this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(trT.SCROLL_ENDED)),this.unschedule(this._checkMouseWheel),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=g,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(trT.SCROLL_ENDED)),this.unschedule(this._checkMouseWheel),this._stopMouseWheel=!1)},v._calculateMovePercentDelta=function(g){var v=g.anchor,S=g.applyToHorizontal,O=g.applyToVertical;this._calculateBoundary(),v.clampf(e8.ZERO,e8.ONE);var X=this._getContentBottomBoundary()-this._bottomBoundary;X=-X;var Y=this._getContentLeftBoundary()-this._leftBoundary;Y=-Y;var te=new eL;if(this._content&&this.view){var ti=0,tr=this._content._uiProps.uiTransformComp.contentSize,ta=this.view.contentSize;S&&(ti=tr.width-ta.width,te.x=Y-ti*v.x),O&&(ti=tr.height-ta.height,te.y=X-ti*v.y)}return te},v._moveContentToTopLeft=function(g){var v=this._getContentBottomBoundary()-this._bottomBoundary;v=-v;var S=new eL,O=0,X=this._getContentLeftBoundary()-this._leftBoundary;if(X=-X,this._content){var Y=this._content._uiProps.uiTransformComp.contentSize;Y.height<g.height&&(O=Y.height-g.height,S.y=v-O),Y.width<g.width&&(O=Y.width-g.width,S.x=X)}this._updateScrollBarState(),this._moveContent(S),this._adjustContentOutOfBoundary()},v._scaleChanged=function(g){g===pq.SCALE&&this._calculateBoundary()},v._xrHoverEnter=function(g){g.deviceType===teL.Left?this._hoverIn=trE.LEFT:g.deviceType===teL.Right&&(this._hoverIn=trE.RIGHT)},v._xrHoverExit=function(){this._hoverIn=trE.NONE},v._dispatchEventHandleInput=function(g){var v,S;_instanceof(g,b6)?v=g.gamepad:_instanceof(g,b7)&&(v=g.handleInputDevice),this.enabledInHierarchy&&this._hoverIn!==trE.NONE&&(this._hoverIn===trE.LEFT?(S=v.leftStick.getValue()).equals(e8.ZERO)||this._xrThumbStickMove(S):this._hoverIn===trE.RIGHT&&((S=v.rightStick.getValue()).equals(e8.ZERO)||this._xrThumbStickMove(S)))},v._xrThumbStickMove=function(g){if(this.enabledInHierarchy){var v=new eL,S=g.y;this.vertical?v.set(0,-62.5*S,0):this.horizontal&&v.set(-62.5*S,0,0),this._mouseWheelEventElapsedTime=0,this._deltaAmount.add(v),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0)}},n(e,[{key:"content",get:function(){return this._content},set:function(g){if(this._content!==g){var v=g&&g.parent&&g.parent._uiProps.uiTransformComp;!g||g&&v?(this._content=g,this._calculateBoundary()):j(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar&&!this._horizontalScrollBar.isValid&&J(4303,"horizontal",this.node.name),this._horizontalScrollBar},set:function(g){this._horizontalScrollBar!==g&&(this._horizontalScrollBar=g,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(e8.ZERO)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar&&!this._verticalScrollBar.isValid&&J(4303,"vertical",this.node.name),this._verticalScrollBar},set:function(g){this._verticalScrollBar!==g&&(this._verticalScrollBar=g,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(e8.ZERO)))}},{key:"view",get:function(){var g=this._content&&this._content.parent;return g?g._uiProps.uiTransformComp:null}}]),e}(trA)).EventType=trT,trh=ws((tro=trS).prototype,"bounceDuration",[n2],function(){return 1}),tru=ws(tro.prototype,"brake",[n2],function(){return .5}),trl=ws(tro.prototype,"elastic",[n2],function(){return!0}),trc=ws(tro.prototype,"inertia",[n2],function(){return!0}),p(tro.prototype,"content",[tri],Object.getOwnPropertyDescriptor(tro.prototype,"content"),tro.prototype),tr_=ws(tro.prototype,"horizontal",[n2],function(){return!0}),p(tro.prototype,"horizontalScrollBar",[trn],Object.getOwnPropertyDescriptor(tro.prototype,"horizontalScrollBar"),tro.prototype),trf=ws(tro.prototype,"vertical",[n2],function(){return!0}),p(tro.prototype,"verticalScrollBar",[trr],Object.getOwnPropertyDescriptor(tro.prototype,"verticalScrollBar"),tro.prototype),trd=ws(tro.prototype,"cancelInnerEvents",[n2],function(){return!0}),trp=ws(tro.prototype,"scrollEvents",[trs,n2],function(){return[]}),trm=ws(tro.prototype,"_content",[n2],function(){return null}),trg=ws(tro.prototype,"_horizontalScrollBar",[n2],function(){return null}),trv=ws(tro.prototype,"_verticalScrollBar",[n2],function(){return null}),tra=tro))||tra)||tra)||tra));X.ScrollView=trz;var trW,trX=new eL;!function(g){g[g.Horizontal=0]="Horizontal",g[g.Vertical=1]="Vertical"}(trW||(trW={})),oe(trW);var trj,trq,trY,trK,trJ,trZ,trQ,tr$,tr0,tr1,tr2,tr3,tr5=g("f7",(trB=nJ("cc.Slider"),trP=nQ(110),trD=nZ(P2),trM=ma(O3),trO=ma(trW),trL=ma([cd]),trB(trF=trP(trF=trD(((trH=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).slideEvents=trk&&trk(),v._handle=trG&&trG(),v._direction=trV&&trV(),v._progress=trU&&trU(),v._offset=new eL,v._dragging=!1,v._touchHandle=!1,v._handleLocalPos=new eL,v._touchPos=new eL,v}s(e,g);var v=e.prototype;return v.__preload=function(){this._updateHandlePosition()},v.onEnable=function(){this._updateHandlePosition(),this.node.on(md.TOUCH_START,this._onTouchBegan,this),this.node.on(md.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(md.TOUCH_END,this._onTouchEnded,this),this.node.on(md.TOUCH_CANCEL,this._onTouchCancelled,this),this.node.on(teF.XRUI_HOVER_STAY,this._xrHoverStay,this),this.node.on(teF.XRUI_CLICK,this._xrClick,this),this.node.on(teF.XRUI_UNCLICK,this._xrUnClick,this),this._handle&&this._handle.isValid&&(this._handle.node.on(md.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(md.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(md.TOUCH_END,this._onTouchEnded,this))},v.onDisable=function(){this.node.off(md.TOUCH_START,this._onTouchBegan,this),this.node.off(md.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(md.TOUCH_END,this._onTouchEnded,this),this.node.off(md.TOUCH_CANCEL,this._onTouchCancelled,this),this.node.off(teF.XRUI_HOVER_STAY,this._xrHoverStay,this),this.node.off(teF.XRUI_CLICK,this._xrClick,this),this.node.off(teF.XRUI_UNCLICK,this._xrUnClick,this),this._handle&&this._handle.isValid&&(this._handle.node.off(md.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(md.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(md.TOUCH_END,this._onTouchEnded,this))},v._onHandleDragStart=function(g){if(g&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var v=g.touch.getUILocation();eL.set(this._touchPos,v.x,v.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),g.propagationStopped=!0}},v._onTouchBegan=function(g){this._handle&&g&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(g.touch),g.propagationStopped=!0)},v._onTouchMoved=function(g){this._dragging&&g&&(this._handleSliderLogic(g.touch),g.propagationStopped=!0)},v._onTouchEnded=function(g){this._dragging=!1,this._touchHandle=!1,this._offset=new eL,g&&(g.propagationStopped=!0)},v._onTouchCancelled=function(g){this._dragging=!1,g&&(g.propagationStopped=!0)},v._handleSliderLogic=function(g){this._updateProgress(g),this._emitSlideEvent()},v._emitSlideEvent=function(){cd.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},v._updateProgress=function(g){if(this._handle&&g){var v=g.getUILocation();eL.set(this._touchPos,v.x,v.y,0);var S=this.node._uiProps.uiTransformComp,O=S.convertToNodeSpaceAR(this._touchPos,trX);this.direction===trW.Horizontal?this.progress=gi(.5+(O.x-this._offset.x)/S.width):this.progress=gi(.5+(O.y-this._offset.y)/S.height)}},v._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var g=this.node._uiProps.uiTransformComp;this._direction===trW.Horizontal?this._handleLocalPos.x=-g.width*g.anchorX+this.progress*g.width:this._handleLocalPos.y=-g.height*g.anchorY+this.progress*g.height,this._handle.node.setPosition(this._handleLocalPos)}},v._changeLayout=function(){var g=this.node._uiProps.uiTransformComp,v=g.contentSize;if(g.setContentSize(v.height,v.width),this._handle){var S=this._handle.node.position;this._direction===trW.Horizontal?this._handle.node.setPosition(S.x,0,S.z):this._handle.node.setPosition(0,S.y,S.z),this._updateHandlePosition()}},v._xrHandleProgress=function(g){if(!this._touchHandle){var v=this.node._uiProps.uiTransformComp;v.convertToNodeSpaceAR(g,trX),this.direction===trW.Horizontal?this.progress=gi(.5+(trX.x-this.node.position.x)/v.width):this.progress=gi(.5+(trX.y-this.node.position.y)/v.height)}},v._xrClick=function(g){this._handle&&(this._dragging=!0,this._xrHandleProgress(g.hitPoint),this._emitSlideEvent())},v._xrUnClick=function(){this._dragging=!1,this._touchHandle=!1},v._xrHoverStay=function(g){this._dragging&&(this._xrHandleProgress(g.hitPoint),this._emitSlideEvent())},n(e,[{key:"handle",get:function(){return this._handle},set:function(g){this._handle!==g&&(this._handle=g)}},{key:"direction",get:function(){return this._direction},set:function(g){this._direction!==g&&(this._direction=g,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(g){this._progress!==g&&(this._progress=g,this._updateHandlePosition())}}]),e}(cS)).Direction=trW,p((trN=trH).prototype,"handle",[trM],Object.getOwnPropertyDescriptor(trN.prototype,"handle"),trN.prototype),p(trN.prototype,"direction",[trO],Object.getOwnPropertyDescriptor(trN.prototype,"direction"),trN.prototype),trk=ws(trN.prototype,"slideEvents",[trL,n2],function(){return[]}),trG=ws(trN.prototype,"_handle",[n2],function(){return null}),trV=ws(trN.prototype,"_direction",[n2],function(){return trW.Horizontal}),trU=ws(trN.prototype,"_progress",[n2],function(){return .1}),trF=trN))||trF)||trF)||trF));function jrt(){for(var g=arguments.length,v=new Array(g),S=0;S<g;S++)v[S]=arguments[S];return Object.assign.apply(Object,[{}].concat(v))}X.Slider=tr5,function(g){g.TOGGLE="toggle"}(tr3||(tr3={}));var tr4,tr8,tr6,tr7,tr9,tst,tse,tsi=g("f8",(trj=nJ("cc.Toggle"),trq=nQ(110),trY=nZ(P2),trK=ma(O3),trJ=ma([cd]),trj(trZ=trq(trZ=trY(((tr2=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).checkEvents=tr$&&tr$(),v._isChecked=tr0&&tr0(),v._checkMark=tr1&&tr1(),v}s(e,g);var v=e.prototype;return v._internalToggle=function(){this.isChecked=!this.isChecked},v._set=function(g,v){if(void 0===v&&(v=!0),this._isChecked!=g){this._isChecked=g;var S=this._toggleContainer;S&&S.enabled&&this.enabled&&(g||!S.anyTogglesChecked()&&!S.allowSwitchOff)&&(this._isChecked=!0,S.notifyToggleCheck(this,v)),this.playEffect(),v&&this._emitToggleEvents()}},v.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},v.setIsCheckedWithoutNotify=function(g){this._set(g,!1)},v.onEnable=function(){g.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},v.onDisable=function(){g.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},v._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&cd.emitEvents(this.checkEvents,this)},n(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(g){this._set(g)}},{key:"checkMark",get:function(){return this._checkMark},set:function(g){this._checkMark!==g&&(this._checkMark=g)}},{key:"_resizeToTarget",set:function(g){g&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var g=this.node.parent;return X.Node.isNode(g)?g.getComponent("cc.ToggleContainer"):null}}]),e}(til)).EventType=jrt(tr3,tih),p((trQ=tr2).prototype,"checkMark",[trK],Object.getOwnPropertyDescriptor(trQ.prototype,"checkMark"),trQ.prototype),tr$=ws(trQ.prototype,"checkEvents",[trJ,n2],function(){return[]}),tr0=ws(trQ.prototype,"_isChecked",[n2],function(){return!0}),tr1=ws(trQ.prototype,"_checkMark",[n2],function(){return null}),trZ=trQ))||trZ)||trZ)||trZ));X.Toggle=tsi;var tsn,tsr,tss,tsa,tso,tsh,tsu,tsl,tsc,ts_,tsf,tsd,tsp,tsm,tsg,tsv,tsy,tsS,tsA,tsT,tsE,tsC,tsx,tsb,tsR,tsw,tsI=g("f9",(tr4=nJ("cc.ToggleContainer"),tr8=nQ(110),tr6=ma([cd]),tr4(tr7=tr8((tr9=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._allowSwitchOff=tst&&tst(),v.checkEvents=tse&&tse(),v}s(e,g);var v=e.prototype;return v.onEnable=function(){this.ensureValidState(),this.node.on(md.CHILD_ADDED,this.ensureValidState,this),this.node.on(md.CHILD_REMOVED,this.ensureValidState,this)},v.onDisable=function(){this.node.off(md.CHILD_ADDED,this.ensureValidState,this),this.node.off(md.CHILD_REMOVED,this.ensureValidState,this)},v.activeToggles=function(){return this.toggleItems.filter(function(g){return g.isChecked})},v.anyTogglesChecked=function(){return!!this.toggleItems.find(function(g){return g.isChecked})},v.notifyToggleCheck=function(g,v){if(void 0===v&&(v=!0),this.enabledInHierarchy){for(var S=0;S<this.toggleItems.length;S++){var O=this.toggleItems[S];O!==g&&(v?O.isChecked=!1:O.setIsCheckedWithoutNotify(!1))}this.checkEvents&&X.Component.EventHandler.emitEvents(this.checkEvents,g)}},v.ensureValidState=function(){var g=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==g.length){var v=g[0];v.isChecked=!0,this.notifyToggleCheck(v)}var S=this.activeToggles();if(S.length>1)for(var O=S[0],X=0;X<S.length;++X){var Y=S[X];Y!==O&&(Y.isChecked=!1)}},n(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(g){this._allowSwitchOff=g}},{key:"toggleItems",get:function(){return this.node.children.map(function(g){var v=g.getComponent("cc.Toggle");return v&&v.enabled?v:null}).filter(Boolean)}}]),e}(cS),tst=ws(tr9.prototype,"_allowSwitchOff",[n2],function(){return!1}),tse=ws(tr9.prototype,"checkEvents",[tr6,n2],function(){return[]}),tr7=tr9))||tr7)||tr7));X.ToggleContainer=tsI;var tsB,tsP,tsD=new e8;function Pst(g){return _instanceof(g,AN)?a4:g._uiProps.uiTransformComp?g._uiProps.uiTransformComp.contentSize:iu.ZERO}function Dst(g,v,S,O){g.parent?tsD.set(g.parent.getScale().x,g.parent.getScale().y):tsD.set(0,0);for(var X=tsD.x,Y=tsD.y,te=0,ti=0,tr=g.parent;;){if(!tr)return S.x=S.y=0,void(O.x=O.y=1);var ta=tr.getPosition();if(te+=ta.x,ti+=ta.y,(tr=tr.parent)===v)break;tr?tsD.set(tr.getScale().x,tr.getScale().y):tsD.set(0,0);var th=tsD.x,tu=tsD.y;te*=th,ti*=tu,X*=th,Y*=tu}O.x=0!==X?1/X:1,O.y=0!==Y?1/Y:1,S.x=-te,S.y=-ti}!function(g){g[g.ONCE=0]="ONCE",g[g.ALWAYS=1]="ALWAYS",g[g.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(tsB||(tsB={})),oe(tsB),function(g){g[g.TOP=1]="TOP",g[g.MID=2]="MID",g[g.BOT=4]="BOT",g[g.LEFT=8]="LEFT",g[g.CENTER=16]="CENTER",g[g.RIGHT=32]="RIGHT",g[g.HORIZONTAL=56]="HORIZONTAL",g[g.VERTICAL=7]="VERTICAL"}(tsP||(tsP={}));var tsM,tsO,tsL,tsF,tsN,tsk,tsG,tsV,tsU,tsH,tsz,tsW,tsX=tsP.TOP|tsP.BOT,tsj=tsP.LEFT|tsP.RIGHT,tsq=g("fb",(tsn=nJ("cc.Widget"),tsr=nQ(110),tss=nZ(P2),tsa=ma(mJ),tso=ma(tsB),tsn(tsh=tsr(tsh=tss(((tsw=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this)._lastPos=new eL,v._lastSize=new iu,v._dirty=!0,v._hadAlignOnce=!1,v._alignFlags=tsl&&tsl(),v._target=tsc&&tsc(),v._left=ts_&&ts_(),v._right=tsf&&tsf(),v._top=tsd&&tsd(),v._bottom=tsp&&tsp(),v._horizontalCenter=tsm&&tsm(),v._verticalCenter=tsg&&tsg(),v._isAbsLeft=tsv&&tsv(),v._isAbsRight=tsy&&tsy(),v._isAbsTop=tsS&&tsS(),v._isAbsBottom=tsA&&tsA(),v._isAbsHorizontalCenter=tsT&&tsT(),v._isAbsVerticalCenter=tsE&&tsE(),v._originalWidth=tsC&&tsC(),v._originalHeight=tsx&&tsx(),v._alignMode=tsb&&tsb(),v._lockFlags=tsR&&tsR(),v}s(e,g);var v=e.prototype;return v.updateAlignment=function(){X._widgetManager.updateAlignment(this.node)},v._validateTargetInDEV=function(){},v.setDirty=function(){this._recursiveDirty()},v.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),X._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},v.onDisable=function(){X._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},v.onDestroy=function(){this._removeParentEvent()},v._adjustWidgetToAllowMovingInEditor=function(){},v._adjustWidgetToAllowResizingInEditor=function(){},v._adjustWidgetToAnchorChanged=function(){this.setDirty()},v._adjustTargetToParentChanged=function(g){g&&this._unregisterOldParentEvents(g),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},v._registerEvent=function(){this.node.on(md.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(md.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(md.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(md.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},v._unregisterEvent=function(){this.node.off(md.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(md.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(md.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},v._removeParentEvent=function(){this.node.off(md.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},v._autoChangedValue=function(g,v){if((this._alignFlags&g)>0){var S=this.node.parent&&this.node.parent._uiProps,O=S&&S.uiTransformComp,X=O?O.contentSize:a4;this.isAlignLeft&&g===tsP.LEFT?this._left=v?this._left*X.width:this._left/X.width:this.isAlignRight&&g===tsP.RIGHT?this._right=v?this._right*X.width:this._right/X.width:this.isAlignHorizontalCenter&&g===tsP.CENTER?this._horizontalCenter=v?this._horizontalCenter*X.width:this._horizontalCenter/X.width:this.isAlignTop&&g===tsP.TOP?this._top=v?this._top*X.height:this._top/X.height:this.isAlignBottom&&g===tsP.BOT?this._bottom=v?this._bottom*X.height:this._bottom/X.height:this.isAbsoluteVerticalCenter&&g===tsP.MID&&(this._verticalCenter=this._verticalCenter/X.height),this._recursiveDirty()}},v._registerTargetEvents=function(){var g=this._target||this.node.parent;g&&g.getComponent(P2)&&(g.on(md.TRANSFORM_CHANGED,this._setDirtyByMode,this),g.on(md.SIZE_CHANGED,this._setDirtyByMode,this),g.on(md.ANCHOR_CHANGED,this._setDirtyByMode,this))},v._unregisterTargetEvents=function(){var g=this._target||this.node.parent;g&&(g.off(md.TRANSFORM_CHANGED,this._setDirtyByMode,this),g.off(md.SIZE_CHANGED,this._setDirtyByMode,this),g.off(md.ANCHOR_CHANGED,this._setDirtyByMode,this))},v._unregisterOldParentEvents=function(g){var v=this._target||g;v&&(v.off(md.TRANSFORM_CHANGED,this._setDirtyByMode,this),v.off(md.SIZE_CHANGED,this._setDirtyByMode,this))},v._setDirtyByMode=function(){this.alignMode===tsB.ALWAYS&&this._recursiveDirty()},v._setAlign=function(g,v){if(v!==(this._alignFlags&g)>0){var S=(g&tsj)>0,O=this.node._uiProps.uiTransformComp;v?(this._alignFlags|=g,S?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=O.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=O.height))):(S?this.isStretchWidth&&(O.width=this._originalWidth):this.isStretchHeight&&(O.height=this._originalHeight),this._alignFlags&=~g)}},v._recursiveDirty=function(){this._dirty||(this._dirty=!0)},n(e,[{key:"target",get:function(){return this._target},set:function(g){this._target!==g&&(this._unregisterTargetEvents(),this._target=g,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&tsP.TOP)>0},set:function(g){this._setAlign(tsP.TOP,g),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&tsP.BOT)>0},set:function(g){this._setAlign(tsP.BOT,g),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&tsP.LEFT)>0},set:function(g){this._setAlign(tsP.LEFT,g),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&tsP.RIGHT)>0},set:function(g){this._setAlign(tsP.RIGHT,g),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&tsP.MID)>0},set:function(g){g?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=tsP.MID):this._alignFlags&=~tsP.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&tsP.CENTER)>0},set:function(g){g?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=tsP.CENTER):this._alignFlags&=~tsP.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&tsj)===tsj}},{key:"isStretchHeight",get:function(){return(this._alignFlags&tsX)===tsX}},{key:"top",get:function(){return this._top},set:function(g){this._top=g,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(g){this._top=this._isAbsTop?g:g/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(g){this._bottom=g,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(g){this._bottom=this._isAbsBottom?g:g/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(g){this._left=g,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(g){this._left=this._isAbsLeft?g:g/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(g){this._right=g,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(g){this._right=this._isAbsRight?g:g/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(g){this._horizontalCenter=g,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(g){this._horizontalCenter=this._isAbsHorizontalCenter?g:g/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(g){this._verticalCenter=g,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(g){this._verticalCenter=this._isAbsVerticalCenter?g:g/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(g){this._isAbsTop!==g&&(this._isAbsTop=g,this._autoChangedValue(tsP.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(g){this._isAbsBottom!==g&&(this._isAbsBottom=g,this._autoChangedValue(tsP.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(g){this._isAbsLeft!==g&&(this._isAbsLeft=g,this._autoChangedValue(tsP.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(g){this._isAbsRight!==g&&(this._isAbsRight=g,this._autoChangedValue(tsP.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(g){this._isAbsHorizontalCenter!==g&&(this._isAbsHorizontalCenter=g,this._autoChangedValue(tsP.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(g){this._isAbsVerticalCenter!==g&&(this._isAbsVerticalCenter=g,this._autoChangedValue(tsP.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(g){this._alignMode=g,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(g){this._alignFlags!==g&&(this._alignFlags=g,this._recursiveDirty())}}]),e}(cS)).AlignMode=tsB,p((tsu=tsw).prototype,"target",[tsa],Object.getOwnPropertyDescriptor(tsu.prototype,"target"),tsu.prototype),p(tsu.prototype,"alignMode",[tso],Object.getOwnPropertyDescriptor(tsu.prototype,"alignMode"),tsu.prototype),tsl=ws(tsu.prototype,"_alignFlags",[n2],function(){return 0}),tsc=ws(tsu.prototype,"_target",[n2],function(){return null}),ts_=ws(tsu.prototype,"_left",[n2],function(){return 0}),tsf=ws(tsu.prototype,"_right",[n2],function(){return 0}),tsd=ws(tsu.prototype,"_top",[n2],function(){return 0}),tsp=ws(tsu.prototype,"_bottom",[n2],function(){return 0}),tsm=ws(tsu.prototype,"_horizontalCenter",[n2],function(){return 0}),tsg=ws(tsu.prototype,"_verticalCenter",[n2],function(){return 0}),tsv=ws(tsu.prototype,"_isAbsLeft",[n2],function(){return!0}),tsy=ws(tsu.prototype,"_isAbsRight",[n2],function(){return!0}),tsS=ws(tsu.prototype,"_isAbsTop",[n2],function(){return!0}),tsA=ws(tsu.prototype,"_isAbsBottom",[n2],function(){return!0}),tsT=ws(tsu.prototype,"_isAbsHorizontalCenter",[n2],function(){return!0}),tsE=ws(tsu.prototype,"_isAbsVerticalCenter",[n2],function(){return!0}),tsC=ws(tsu.prototype,"_originalWidth",[n2],function(){return 0}),tsx=ws(tsu.prototype,"_originalHeight",[n2],function(){return 0}),tsb=ws(tsu.prototype,"_alignMode",[n2],function(){return tsB.ON_WINDOW_RESIZE}),tsR=ws(tsu.prototype,"_lockFlags",[n2,qs],function(){return 0}),tsh=tsu))||tsh)||tsh)||tsh));X.internal.computeInverseTransForTarget=Dst,X.internal.getReadonlyNodeSize=Pst,X.Widget=tsq;var tsY,tsK=new is;!function(g){g[g.HORIZONTAL=0]="HORIZONTAL",g[g.VERTICAL=1]="VERTICAL"}(tsY||(tsY={})),oe(tsY);var tsJ,tsZ,tsQ,ts$,ts0,ts1,ts2,ts3,ts5,ts4,ts8,ts6,ts7,ts9,tat,tae,tai,tan,tar,tas,taa,tao,tah,tau,tal=g("fd",(tsM=nJ("cc.PageViewIndicator"),tsO=nQ(110),tsL=ma(Bf),tsF=ma(tsY),tsN=ma(iu),tsM(tsk=tsO(((tsW=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).spacing=tsV&&tsV(),v._spriteFrame=tsU&&tsU(),v._direction=tsH&&tsH(),v._cellSize=tsz&&tsz(),v._layout=null,v._pageView=null,v._indicators=[],v}s(e,g);var v=e.prototype;return v.onLoad=function(){this._updateLayout()},v.setPageView=function(g){this._pageView=g,this._refresh()},v._updateLayout=function(){this._layout=this.getComponent(tnG),this._layout||(this._layout=this.addComponent(tnG));var g=this._layout;this.direction===tsY.HORIZONTAL?(g.type=tnG.Type.HORIZONTAL,g.spacingX=this.spacing):this.direction===tsY.VERTICAL&&(g.type=tnG.Type.VERTICAL,g.spacingY=this.spacing),g.resizeMode=tnG.ResizeMode.CONTAINER},v._createIndicator=function(){var g=new mJ;g.layer=this.node.layer;var v=g.addComponent(O3);return v.spriteFrame=this.spriteFrame,v.sizeMode=O3.SizeMode.CUSTOM,g.parent=this.node,g._uiProps.uiTransformComp.setContentSize(this._cellSize),g},v._changedState=function(){var g=this._indicators;if(0!==g.length&&this._pageView){var v=this._pageView.curPageIdx;if(!(v>=g.length)){for(var S=0;S<g.length;++S){var O=g[S];if(O._uiProps.uiComp){var X=O._uiProps.uiComp;tsK.set(X.color),tsK.a=127.5,X.color=tsK}}if(g[v]._uiProps.uiComp){var Y=g[v]._uiProps.uiComp;tsK.set(Y.color),tsK.a=255,Y.color=tsK}}}},v._refresh=function(){if(this._pageView){var g=this._indicators,v=this._pageView.getPages();if(v.length!==g.length){var S=0;if(v.length>g.length)for(S=0;S<v.length;++S)g[S]||(g[S]=this._createIndicator());else for(S=g.length-v.length;S>0;--S){var O=g[S-1];this.node.removeChild(O),g.splice(S-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},n(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(g){this._spriteFrame!==g&&(this._spriteFrame=g)}},{key:"direction",get:function(){return this._direction},set:function(g){this._direction!==g&&(this._direction=g)}},{key:"cellSize",get:function(){return this._cellSize},set:function(g){this._cellSize!==g&&(this._cellSize=g)}}]),e}(cS)).Direction=tsY,p((tsG=tsW).prototype,"spriteFrame",[tsL],Object.getOwnPropertyDescriptor(tsG.prototype,"spriteFrame"),tsG.prototype),p(tsG.prototype,"direction",[tsF],Object.getOwnPropertyDescriptor(tsG.prototype,"direction"),tsG.prototype),p(tsG.prototype,"cellSize",[tsN],Object.getOwnPropertyDescriptor(tsG.prototype,"cellSize"),tsG.prototype),tsV=ws(tsG.prototype,"spacing",[n2],function(){return 0}),tsU=ws(tsG.prototype,"_spriteFrame",[n2],function(){return null}),tsH=ws(tsG.prototype,"_direction",[n2],function(){return tsY.HORIZONTAL}),tsz=ws(tsG.prototype,"_cellSize",[n2],function(){return new iu(20,20)}),tsk=tsG))||tsk)||tsk));X.PageViewIndicator=tal;var tac,ta_,taf,tad=new e8;!function(g){g[g.Unified=0]="Unified",g[g.Free=1]="Free"}(tac||(tac={})),oe(tac),function(g){g[g.Horizontal=0]="Horizontal",g[g.Vertical=1]="Vertical"}(ta_||(ta_={})),oe(ta_),function(g){g.PAGE_TURNING="page-turning"}(taf||(taf={}));var tap=g("fc",(tsJ=nJ("cc.PageView"),tsZ=nQ(110),tsQ=ma(tac),ts$=ma(ta_),ts0=ma(tal),ts1=ma(tn7),ts2=ma(tn7),ts3=ma([cd]),ts5=ma([cd]),tsJ(ts4=tsZ(((tau=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).autoPageTurningThreshold=ts6&&ts6(),v.horizontal=ts7&&ts7(),v.vertical=ts9&&ts9(),v.cancelInnerEvents=tat&&tat(),v.scrollEvents=tae&&tae(),v.pageTurningSpeed=tai&&tai(),v.pageEvents=tan&&tan(),v._sizeMode=tar&&tar(),v._direction=tas&&tas(),v._scrollThreshold=taa&&taa(),v._pageTurningEventTiming=tao&&tao(),v._indicator=tah&&tah(),v._curPageIdx=0,v._lastPageIdx=0,v._pages=[],v._initContentPos=new eL,v._scrollCenterOffsetX=[],v._scrollCenterOffsetY=[],v._touchBeganPosition=new e8,v._touchEndPosition=new e8,v}s(e,g);var v=e.prototype;return v.onEnable=function(){g.prototype.onEnable.call(this),this.node.on(md.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},v.onDisable=function(){g.prototype.onDisable.call(this),this.node.off(md.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},v.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},v.getCurrentPageIndex=function(){return this._curPageIdx},v.setCurrentPageIndex=function(g){this.scrollToPage(g,1)},v.getPages=function(){return this._pages},v.addPage=function(g){g&&-1===this._pages.indexOf(g)&&this.content&&(g._uiProps.uiTransformComp?(this.content.addChild(g),this._pages.push(g),this._updatePageView()):j(4301))},v.insertPage=function(g,v){if(!(v<0)&&g&&-1===this._pages.indexOf(g)&&this.content){if(v>=this._pages.length)this.addPage(g);else{if(!g._uiProps.uiTransformComp)return void j(4301);this._pages.splice(v,0,g),this.content.insertChild(g,v),this._updatePageView()}}},v.removePage=function(g){if(g&&this.content){var v=this._pages.indexOf(g);-1!==v?this.removePageAtIndex(v):q(4300,g.name)}},v.removePageAtIndex=function(g){var v=this._pages;if(!(g<0||g>=v.length)){var S=v[g];S&&this.content&&(this.content.removeChild(S),v.splice(g,1),this._updatePageView())}},v.removeAllPages=function(){if(this.content){for(var g=this._pages,v=0,S=g.length;v<S;v++)this.content.removeChild(g[v]);this._pages.length=0,this._updatePageView()}},v.scrollToPage=function(g,v){void 0===v&&(v=.3),g<0||g>=this._pages.length||(this._curPageIdx=g,this.scrollToOffset(this._moveOffsetValue(g),v,!0),this.indicator&&this.indicator._changedState())},v.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},v._updatePageView=function(){if(this.content){var g=this.content.getComponent(tnG);g&&g.enabled&&g.updateLayout();var v=this._pages.length;this._curPageIdx>=v&&(this._curPageIdx=0===v?0:v-1,this._lastPageIdx=this._curPageIdx);for(var S=this._initContentPos,O=0;O<v;++O){var X=this._pages[O].position;this.direction===ta_.Horizontal?this._scrollCenterOffsetX[O]=Math.abs(S.x+X.x):this._scrollCenterOffsetY[O]=Math.abs(S.y+X.y)}this.indicator&&this.indicator._refresh()}},v._updateAllPagesSize=function(){var g=this.view;if(this.content&&g&&this._sizeMode===tac.Unified)for(var v=this._pages,S=g.contentSize,O=0,X=v.length;O<X;O++)v[O]._uiProps.uiTransformComp.setContentSize(S)},v._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},v._onTouchBegan=function(v,S){v.touch.getUILocation(tad),e8.set(this._touchBeganPosition,tad.x,tad.y),g.prototype._onTouchBegan.call(this,v,S)},v._onTouchMoved=function(v,S){g.prototype._onTouchMoved.call(this,v,S)},v._onTouchEnded=function(v,S){v.touch.getUILocation(tad),e8.set(this._touchEndPosition,tad.x,tad.y),g.prototype._onTouchEnded.call(this,v,S)},v._onTouchCancelled=function(v,S){v.touch.getUILocation(tad),e8.set(this._touchEndPosition,tad.x,tad.y),g.prototype._onTouchCancelled.call(this,v,S)},v._onMouseWheel=function(){},v._syncScrollDirection=function(){this.horizontal=this.direction===ta_.Horizontal,this.vertical=this.direction===ta_.Vertical},v._syncSizeMode=function(){var g=this.view;if(this.content&&g){var v=this.content.getComponent(tnG);if(v){if(this._sizeMode===tac.Free&&this._pages.length>0){var S=this._pages[0]._uiProps.uiTransformComp,O=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===ta_.Horizontal?(v.paddingLeft=(g.width-S.width)/2,v.paddingRight=(g.width-O.width)/2):this.direction===ta_.Vertical&&(v.paddingTop=(g.height-S.height)/2,v.paddingBottom=(g.height-O.height)/2)}v.updateLayout()}}},v._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var g=this.content.children,v=0;v<g.length;++v){var S=g[v];this._pages.indexOf(S)>=0||this._pages.push(S)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},v._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,cd.emitEvents(this.pageEvents,this,taf.PAGE_TURNING),this.node.emit(taf.PAGE_TURNING,this))},v._isQuicklyScrollable=function(g){if(this.direction===ta_.Horizontal){if(Math.abs(g.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===ta_.Vertical&&Math.abs(g.y)>this.autoPageTurningThreshold)return!0;return!1},v._moveOffsetValue=function(g){var v=new e8;if(this._sizeMode===tac.Free)this.direction===ta_.Horizontal?v.x=this._scrollCenterOffsetX[g]:this.direction===ta_.Vertical&&(v.y=this._scrollCenterOffsetY[g]);else{var S=this.view;if(!S)return v;this.direction===ta_.Horizontal?v.x=g*S.width:this.direction===ta_.Vertical&&(v.y=g*S.height)}return v},v._getDragDirection=function(g){return this._direction===ta_.Horizontal?0===g.x?0:g.x>0?1:-1:0===g.y?0:g.y<0?1:-1},v._isScrollable=function(g,v,S){if(this._sizeMode===tac.Free){var O=0,X=0;if(this.direction===ta_.Horizontal)return O=this._scrollCenterOffsetX[v],X=this._scrollCenterOffsetX[S],Math.abs(g.x)>=Math.abs(O-X)*this.scrollThreshold;if(this.direction===ta_.Vertical)return O=this._scrollCenterOffsetY[v],X=this._scrollCenterOffsetY[S],Math.abs(g.y)>=Math.abs(O-X)*this.scrollThreshold}else{var Y=this.view;if(!Y)return!1;if(this.direction===ta_.Horizontal)return Math.abs(g.x)>=Y.width*this.scrollThreshold;if(this.direction===ta_.Vertical)return Math.abs(g.y)>=Y.height*this.scrollThreshold}return!1},v._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var g=this._getHowMuchOutOfBoundary();this._clampDelta(g),(g.x>0||g.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(g.x<0||g.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var v=new e8;e8.subtract(v,this._touchBeganPosition,this._touchEndPosition);var S=this._curPageIdx,O=S+this._getDragDirection(v),X=this.pageTurningSpeed*Math.abs(S-O);if(O<this._pages.length){if(this._isScrollable(v,S,O))return void this.scrollToPage(O,X);var Y=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(Y))return void this.scrollToPage(O,X)}this.scrollToPage(S,X)}},n(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(g){this._sizeMode!==g&&(this._sizeMode=g,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(g){this._direction!==g&&(this._direction=g,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(g){this._scrollThreshold!==g&&(this._scrollThreshold=g)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(g){this._pageTurningEventTiming!==g&&(this._pageTurningEventTiming=g)}},{key:"indicator",get:function(){return this._indicator},set:function(g){this._indicator!==g&&(this._indicator=g,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return g.prototype.verticalScrollBar},set:function(g){this.verticalScrollBar=g}},{key:"horizontalScrollBar",get:function(){return g.prototype.horizontalScrollBar},set:function(g){this.horizontalScrollBar=g}}]),e}(trz)).SizeMode=tac,tau.Direction=ta_,tau.EventType=jrt(taf,trT),p((ts8=tau).prototype,"sizeMode",[tsQ],Object.getOwnPropertyDescriptor(ts8.prototype,"sizeMode"),ts8.prototype),p(ts8.prototype,"direction",[ts$],Object.getOwnPropertyDescriptor(ts8.prototype,"direction"),ts8.prototype),p(ts8.prototype,"indicator",[ts0],Object.getOwnPropertyDescriptor(ts8.prototype,"indicator"),ts8.prototype),ts6=ws(ts8.prototype,"autoPageTurningThreshold",[n2],function(){return 100}),p(ts8.prototype,"verticalScrollBar",[ts1,rE],Object.getOwnPropertyDescriptor(ts8.prototype,"verticalScrollBar"),ts8.prototype),p(ts8.prototype,"horizontalScrollBar",[ts2,rE],Object.getOwnPropertyDescriptor(ts8.prototype,"horizontalScrollBar"),ts8.prototype),ts7=ws(ts8.prototype,"horizontal",[rE,n2],function(){return!0}),ts9=ws(ts8.prototype,"vertical",[rE,n2],function(){return!0}),tat=ws(ts8.prototype,"cancelInnerEvents",[rE,n2],function(){return!0}),tae=ws(ts8.prototype,"scrollEvents",[ts3,n2,rE],function(){return[]}),tai=ws(ts8.prototype,"pageTurningSpeed",[n2],function(){return .3}),tan=ws(ts8.prototype,"pageEvents",[ts5,n2],function(){return[]}),tar=ws(ts8.prototype,"_sizeMode",[n2],function(){return tac.Unified}),tas=ws(ts8.prototype,"_direction",[n2],function(){return ta_.Horizontal}),taa=ws(ts8.prototype,"_scrollThreshold",[n2],function(){return .5}),tao=ws(ts8.prototype,"_pageTurningEventTiming",[n2],function(){return .1}),tah=ws(ts8.prototype,"_indicator",[n2],function(){return null}),ts4=ts8))||ts4)||ts4));X.PageView=tap;var tam=new eL,tag=new e8,tav=new e8,tay=new e8(1,1),taS=new e8,taA=new e8;function Dat(g,v){if(!v._hadAlignOnce){v.alignMode===tsB.ONCE&&(v._hadAlignOnce=!0);var S,O=v.target,X=tav,Y=tay;O?Dst(g,S=O,X,Y):S=g.parent;var te=Pst(S),ti=_instanceof(S,AN)||!S.getComponent(P2),tr=ti?tag:S.getComponent(P2).anchorPoint,ta=ti;g.getPosition(tam);var th=g._uiProps.uiTransformComp,tu=tam.x,tl=tam.y,tc=th.anchorPoint,t_=g.getScale();if(v.alignFlags&tsP.HORIZONTAL){var tf=0,tp=0,tm=te.width;ta?(tf=a4.left.x,tp=a4.right.x):tp=(tf=-tr.x*tm)+tm,tf+=v.isAbsoluteLeft?v.left:v.left*tm,tp-=v.isAbsoluteRight?v.right:v.right*tm,O&&(tf+=X.x,tf*=Y.x,tp+=X.x,tp*=Y.x);var tg=0,tv=tc.x,ty=t_.x;if(ty<0&&(tv=1-tv,ty=-ty),v.isStretchWidth)tg=tp-tf,0!==ty&&(th.width=tg/ty),tu=tf+tv*tg;else{if(tg=th.width*ty,v.isAlignHorizontalCenter){var tS=v.isAbsoluteHorizontalCenter?v.horizontalCenter:v.horizontalCenter*tm,tA=(.5-tr.x)*te.width;O&&(tS*=Y.x,tA+=X.x,tA*=Y.x),tu=tA+(tv-.5)*tg+tS}else tu=v.isAlignLeft?tf+tv*tg:tp+(tv-1)*tg;pi(ty,0,ex)?tg=th.width:tg/=ty}v._lastSize.width=tg}if(v.alignFlags&tsP.VERTICAL){var tT=0,tE=0,tC=te.height;ta?(tE=a4.bottom.y,tT=a4.top.y):tT=(tE=-tr.y*tC)+tC,tE+=v.isAbsoluteBottom?v.bottom:v.bottom*tC,tT-=v.isAbsoluteTop?v.top:v.top*tC,O&&(tE+=X.y,tE*=Y.y,tT+=X.y,tT*=Y.y);var tx=0,tb=tc.y,tw=t_.y;if(tw<0&&(tb=1-tb,tw=-tw),v.isStretchHeight)tx=tT-tE,0!==tw&&(th.height=tx/tw),tl=tE+tb*tx;else{if(tx=th.height*tw,v.isAlignVerticalCenter){var tI=v.isAbsoluteVerticalCenter?v.verticalCenter:v.verticalCenter*tC,tB=(.5-tr.y)*te.height;O&&(tI*=Y.y,tB+=X.y,tB*=Y.y),tl=tB+(tb-.5)*tx+tI}else tl=v.isAlignBottom?tE+tb*tx:tT+(tb-1)*tx;pi(tw,0,ex)?tx=th.height:tx/=tw}v._lastSize.height=tx}g.setPosition(tu,tl,tam.z),eL.set(v._lastPos,tu,tl,tam.z)}}function Oat(g){var v=g.getComponent(tsq);if(v&&v.enabled){if(!X.isValid(g,!0))return;taE.push(v)}for(var S,O=f(g.children);!(S=O()).done;){var Y=S.value;Y.active&&Oat(Y)}}function Mat(){var g=II.getScene();if(g){taC.isAligning=!0,taC._nodesOrderDirty&&(taE.length=0,Oat(g),taC._nodesOrderDirty=!1);var v=null,S=taC._activeWidgetsIterator;for(S.i=0;S.i<taE.length;++S.i)(v=taE[S.i])._dirty&&(Dat(v.node,v),v._dirty=!1);taC.isAligning=!1}}var taT,taE=[],taC=g("fi",X._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new tH(taE),animationState:null,init:function(){II.on(Iw.EVENT_AFTER_SCENE_LAUNCH,Mat),II.on(Iw.EVENT_AFTER_UPDATE,Mat),Fo.instance.on("design-resolution-changed",this.onResized,this);var g=this.onResized.bind(this);Fo.instance.on("canvas-resize",g),a$.on("window-resize",g)},add:function(){this._nodesOrderDirty=!0},remove:function(g){this._activeWidgetsIterator.remove(g)},onResized:function(){var g=II.getScene();g&&this.refreshWidgetOnResized(g)},refreshWidgetOnResized:function(g){var v=mJ.isNode(g)&&g.getComponent(tsq);v&&v.enabled&&(v.alignMode===tsB.ON_WINDOW_RESIZE||v.alignMode===tsB.ALWAYS)&&v.setDirty();for(var S,O=f(g.children);!(S=O()).done;){var X=S.value;this.refreshWidgetOnResized(X)}},updateOffsetsToStayPut:function(g,v){function i(g,v){return Math.abs(g-v)>1e-10?v:g}var S=g.node,O=S.parent;if(O){var X=taS;X.set(0,0);var Y=taA;if(Y.set(1,1),g.target&&Dst(S,O=g.target,X,Y),!v)return;var te=O._uiProps&&O._uiProps.uiTransformComp,ti=te?te.anchorPoint:tag,tr=S._uiProps.uiTransformComp,ta=Pst(O),th=tr.anchorPoint,tu=S.getPosition(),tl=tsP,tc=S.getScale(),t_=0;if(v&tl.LEFT){var tf=-ti.x*ta.width;tf+=X.x,tf*=Y.x,t_=tu.x-th.x*tr.width*Math.abs(tc.x)-tf,g.isAbsoluteLeft||(t_/=ta.width),t_/=Y.x,g.left=i(g.left,t_)}if(v&tl.RIGHT){var tp=(1-ti.x)*ta.width;tp+=X.x,t_=(tp*=Y.x)-(tu.x+(1-th.x)*tr.width*Math.abs(tc.x)),g.isAbsoluteRight||(t_/=ta.width),t_/=Y.x,g.right=i(g.right,t_)}if(v&tl.TOP){var tm=(1-ti.y)*ta.height;tm+=X.y,t_=(tm*=Y.y)-(tu.y+(1-th.y)*tr.height*Math.abs(tc.y)),g.isAbsoluteTop||(t_/=ta.height),t_/=Y.y,g.top=i(g.top,t_)}if(v&tl.BOT){var tg=-ti.y*ta.height;tg+=X.y,tg*=Y.y,t_=tu.y-th.y*tr.height*Math.abs(tc.y)-tg,g.isAbsoluteBottom||(t_/=ta.height),t_/=Y.y,g.bottom=i(g.bottom,t_)}}},updateAlignment:function t1(g){var v=g.parent;v&&mJ.isNode(v)&&t1(v);var S=g.getComponent(tsq);S&&v&&Dat(g,S)},AlignMode:tsB,AlignFlags:tsP});II.on(Iw.EVENT_INIT,function(){taC.init()});var tax,tab,taR,taw,taI,taB,taP,taD,taM,taO,taL,taF,taN=g("fe",nJ("cc.SafeArea")(taT=nQ(110)(taT=nZ(tsq)(taT=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.onEnable=function(){this.updateArea(),a$.on("window-resize",this.updateArea,this),a$.on("orientation-change",this.updateArea,this)},v.onDisable=function(){a$.off("window-resize",this.updateArea,this),a$.off("orientation-change",this.updateArea,this)},v.updateArea=function(){var g=this.node.getComponent(tsq),v=this.node.getComponent(P2);if(g&&v){g.updateAlignment();var S=this.node.position.clone(),O=v.anchorPoint.clone();g.isAlignTop=g.isAlignBottom=g.isAlignLeft=g.isAlignRight=!0;var X=Fd.getVisibleSize(),Y=X.width,te=X.height,ti=a3.getSafeAreaRect();g.top=te-ti.y-ti.height,g.bottom=ti.y,g.left=ti.x,g.right=Y-ti.x-ti.width,g.updateAlignment();var tr=this.node.position.clone(),ta=O.x-(tr.x-S.x)/v.width,th=O.y-(tr.y-S.y)/v.height;v.setAnchorPoint(ta,th),taC.add(g)}},e}(cS))||taT)||taT)||taT);X.SafeArea=taN,g("ff",(tax=nJ("cc.UICoordinateTracker"),tab=nQ(110),taR=ma(mJ),taw=ma(Fi),taI=ma([cd]),tax(taB=tab((p((taP=function(g){function e(){for(var v,S=arguments.length,O=new Array(S),X=0;X<S;X++)O[X]=arguments[X];return(v=g.call.apply(g,[this].concat(O))||this).syncEvents=taD&&taD(),v._target=taM&&taM(),v._camera=taO&&taO(),v._useScale=taL&&taL(),v._distance=taF&&taF(),v._transformPos=new eL,v._viewPos=new eL,v._canMove=!0,v._lastWPos=new eL,v._lastCameraPos=new eL,v}s(e,g);var v=e.prototype;return v.onEnable=function(){this._checkCanMove()},v.update=function(){var g=this.node.worldPosition,v=this._camera;if(this._canMove&&v&&v.camera&&(!this._lastWPos.equals(g)||!this._lastCameraPos.equals(v.node.worldPosition))&&(this._lastWPos.set(g),this._lastCameraPos.set(v.node.worldPosition),v.camera.update(),v.convertToUINode(g,this._target,this._transformPos),this._useScale&&eL.transformMat4(this._viewPos,this.node.worldPosition,v.camera.matView),this.syncEvents.length>0)){var S=this._distance/Math.abs(this._viewPos.z);cd.emitEvents(this.syncEvents,this._transformPos,S)}},v._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},n(e,[{key:"target",get:function(){return this._target},set:function(g){this._target!==g&&(this._target=g,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(g){this._camera!==g&&(this._camera=g,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(g){this._useScale!==g&&(this._useScale=g)}},{key:"distance",get:function(){return this._distance},set:function(g){this._distance!==g&&(this._distance=g)}}]),e}(cS)).prototype,"target",[taR],Object.getOwnPropertyDescriptor(taP.prototype,"target"),taP.prototype),p(taP.prototype,"camera",[taw],Object.getOwnPropertyDescriptor(taP.prototype,"camera"),taP.prototype),taD=ws(taP.prototype,"syncEvents",[taI,n2],function(){return[]}),taM=ws(taP.prototype,"_target",[n2],function(){return null}),taO=ws(taP.prototype,"_camera",[n2],function(){return null}),taL=ws(taP.prototype,"_useScale",[n2],function(){return!0}),taF=ws(taP.prototype,"_distance",[n2],function(){return 1}),taB=taP))||taB)||taB));var tak,taG=[md.TOUCH_START,md.TOUCH_END,md.TOUCH_MOVE,md.MOUSE_DOWN,md.MOUSE_MOVE,md.MOUSE_UP,md.MOUSE_ENTER,md.MOUSE_LEAVE,md.MOUSE_WHEEL];function $at(g){g.propagationStopped=!0}g("fg",nJ("cc.BlockInputEvents")(tak=function(g){function e(){return g.apply(this,arguments)||this}s(e,g);var v=e.prototype;return v.onEnable=function(){for(var g=0;g<taG.length;g++)this.node.on(taG[g],$at,this)},v.onDisable=function(){for(var g=0;g<taG.length;g++)this.node.off(taG[g],$at,this)},e}(cS))||tak);var taV,taU,taH,taz,taW=g("fh",nJ("cc.SubContextView")(taV=nQ(110)(taV=nZ(P2)((taU=function(g){function e(){var v;return(v=g.call(this)||this)._fps=taH&&taH(),v._sprite=void 0,v._imageAsset=void 0,v._texture=void 0,v._updatedTime=0,v._updateInterval=0,v._openDataContext=void 0,v._content=void 0,v._designResolutionSize=taz&&taz(),v._content=new mJ("content"),v._content.hideFlags|=rG.Flags.DontSave|rG.Flags.HideInHierarchy,v._sprite=null,v._imageAsset=new lX,v._openDataContext=null,v._updatedTime=performance.now(),v._texture=new cK,v}s(e,g);var v=e.prototype;return v.onLoad=function(){u$.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=u$.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1},v.onEnable=function(){this._registerNodeEvent()},v.onDisable=function(){this._unregisterNodeEvent()},v._initSharedCanvas=function(){if(this._openDataContext){var g=this._openDataContext.canvas,v=this._designResolutionSize.width,S=this._designResolutionSize.height;g.width=v,g.height=S}},v._initContentNode=function(){if(this._openDataContext){var g=this._openDataContext.canvas,v=this._imageAsset;if(v.reset(g),this._texture.image=v,this._texture.create(g.width,g.height),this._sprite=this._content.getComponent(O3),this._sprite||(this._sprite=this._content.addComponent(O3)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._texture;else{var S=new Bf;S.texture=this._texture,this._sprite.spriteFrame=S}this._content.parent=this.node}},v._updateSubContextView=function(){if(this._openDataContext){var g=this.node.getComponent(P2),v=this._content.getComponent(P2),S=g.width/v.width,O=g.height/v.height,X=S>O?O:S;v.width*=X,v.height*=X;var Y=Fd.getViewportRect(),te=v.getBoundingBoxToWorld(),ti=Fd.getVisibleSize(),tr=a$.devicePixelRatio,ta=(Y.width*(te.x/ti.width)+Y.x)/tr,th=(Y.height*(te.y/ti.height)+Y.y)/tr,tu=Y.width*(te.width/ti.width)/tr,tl=Y.height*(te.height/ti.height)/tr;this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:ta,y:th,width:tu,height:tl})}},v._updateSubContextTexture=function(){var g=this._imageAsset;if(g&&this._openDataContext&&!(g.width<=0||g.height<=0)){var v=this._openDataContext.canvas;g.reset(v),(v.width>g.width||v.height>g.height)&&this._texture.create(v.width,v.height),this._texture.uploadData(v)}},v._registerNodeEvent=function(){this.node.on(md.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(md.SIZE_CHANGED,this._updateSubContextView,this),this.node.on(md.LAYER_CHANGED,this._updateContentLayer,this)},v._unregisterNodeEvent=function(){this.node.off(md.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(md.SIZE_CHANGED,this._updateSubContextView,this),this.node.off(md.LAYER_CHANGED,this._updateContentLayer,this)},v._updateContentLayer=function(){this._content.layer=this.node.layer},v.update=function(g){void 0===g?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},v.onDestroy=function(){this._content.destroy(),this._texture.destroy(),this._sprite&&this._sprite.destroy(),this._imageAsset.destroy(),this._openDataContext=null},n(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(g){this._fps!==g&&(this._fps=g,this._updateInterval=1e3/g)}}]),e}(cS),taH=ws(taU.prototype,"_fps",[n2],function(){return 60}),taz=ws(taU.prototype,"_designResolutionSize",[n2],function(){return new iu(640,960)}),taV=taU))||taV)||taV)||taV);X.SubContextView=taW}}});