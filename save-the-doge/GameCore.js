var le=Object.defineProperty;var he=(i,e,t)=>e in i?le(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(he(i,typeof e!="symbol"?e+"":e,t),t);import{G as u,P as D,w as de}from"./bundle/core.js";import{E as ue}from"./bundle/vendor.js";import"./bundle/__commonjsHelpers__.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const pe="modulepreload",ye=function(i,e){return new URL(i,e).href},Mt={},W=function(e,t,s){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=ye(a,s),a in Mt)return;Mt[a]=!0;const o=a.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(!!s)for(let d=n.length-1;d>=0;d--){const p=n[d];if(p.href===a&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${r}`))return;const h=document.createElement("link");if(h.rel=o?"stylesheet":pe,o||(h.as="script",h.crossOrigin=""),h.href=a,document.head.appendChild(h),o)return new Promise((d,p)=>{h.addEventListener("load",d),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a})};class jt extends Error{constructor(t,s){super(t);l(this,"payload");this.name="BadRequest",this.message=t||"This request is bad",this.payload=s}}class wt extends Error{constructor(t,s){super(t);l(this,"payload");this.name="RequestTimeout",this.message=t||"This request is timeout",this.payload=s}}const{Utils:ge,Configs:fe}=u,{AppId:we,Network:At}=fe,me=i=>{if(!i.ok)throw new jt(void 0,{response:i})},Wt=()=>{const i=window.game.auth.getToken();return{token:i,timeout:At.Timeout,headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}},qt=(i,e,t,s)=>async()=>{try{const n=`${i}/apps/${we}/${e}`,a=new AbortController;t.signal=a.signal;const o=setTimeout(()=>{a.abort()},t.timeout);u.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const r=await fetch(n,t);return clearTimeout(o),me(r),await r.json()||{}}catch(n){if(n instanceof jt)return null;throw n instanceof Object&&"name"in n&&n.name==="AbortError"?new wt:n}},It=async(i,e)=>{try{return i()}catch(t){if(t instanceof wt&&e>0)try{return await ge.Time.sleepAsync(600),await It(i,e-1)}catch{return{}}return t instanceof wt?{}:{}}},k=async(i,e={},t,s=At.Retries)=>{try{const n={...Wt(),...e,method:"GET"},a=qt(t,i,n);return await It(a,s)}catch{return{}}},x=async(i,e,t={},s,n=At.Retries)=>{try{const a={...Wt(),...t,method:"POST"},o=qt(s,i,a,e);return await It(o,n)}catch{return{}}},{ApiUrl:Ae}=u.Configs.Notification,Ie=async i=>{if(!u.Utils.Object.hasOwn(i,"playerId"))throw new Error("Missing playerId");const{playerId:e}=i;await x(`players/${e}`,i,{},Ae,10)};var zt=(i=>(i.LOADED="loaded",i.DISPLAYED="displayed",i))(zt||{}),Pt=(i=>(i.IDLE="idle",i.LOADING="loading",i.FILLED="filled",i.SHOWING="showing",i))(Pt||{}),P=(i=>(i.BANNER="banner",i.INTERSTITIAL="interstitial",i.REWARDED_VIDEO="rewarded_video",i))(P||{});let U=class extends Error{constructor(t,s){super(s);l(this,"code");this.code=t,this.message=s}};class Pe{constructor(e,t){l(this,"type");l(this,"status");l(this,"placementId");this.type=e,this.status=Pt.IDLE,this.placementId=t}getStatus(){return this.status}}let Jt=class extends Pe{loadAsync(){return Promise.reject("This method is not implemented")}showAsync(){return Promise.reject("This method is not implemented")}hideAsync(){return Promise.reject("Unsupported method")}};u.Plugins.Ads={Types:P,Status:Pt,Events:zt,AdError:U,AdInstance:Jt};class xe extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"enabled");l(this,"config");l(this,"lastAdShownTime");l(this,"banner");l(this,"interstitial");l(this,"rewardedVideo");l(this,"safeAreaBottom");l(this,"intervalBannerAd");l(this,"loadBannerAdAsync",async()=>{try{if(!this.enabled)return;await this.showAdAsync(P.BANNER)}catch{this.cleanBannerInterval()}})}init(){this.lastAdShownTime=0,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{this.safeAreaBottom=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sab")),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.enabled=t.Enabled,this.config=t}setAdInstance(t,s,n){switch(t){case P.BANNER:this.banner=new n(t,s);break;case P.INTERSTITIAL:this.interstitial=new n(t,s);break;case P.REWARDED_VIDEO:this.rewardedVideo=new n(t,s);break}}async preloadInterstitialAdAsync(){await this.preloadAdAsync(P.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new U("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(P.INTERSTITIAL)}async preloadRewardedVideoAsync(){await this.preloadAdAsync(P.REWARDED_VIDEO)}async showRewardedVideoAsync(){await this.showAdAsync(P.REWARDED_VIDEO)}async preloadAdAsync(t){if(!this.enabled)throw new U("ADS_NOT_ENABLED","Ads is't enabled");const s=this.getAdInstanceByType(t);if(s===null)throw new U("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");await s.loadAsync()}async showAdAsync(t){if(!this.enabled)throw new U("ADS_NOT_ENABLED","Ads is't enabled");const s=this.getAdInstanceByType(t);if(s===null)throw new U("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");this.lastAdShownTime=window.performance.now()/1e3,await s.showAsync()}async hideAdAsync(t){if(!this.enabled)throw new U("ADS_NOT_ENABLED","Ads is't enabled");const s=this.getAdInstanceByType(t);if(s===null)throw new U("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");await s.hideAsync()}getAdStatus(t){const s=this.getAdInstanceByType(t);return s?s.getStatus():null}getAdInstanceByType(t){switch(t){case P.BANNER:return this.banner;case P.INTERSTITIAL:return this.interstitial;case P.REWARDED_VIDEO:return this.rewardedVideo;default:return null}}canbeShowInterstitialAd(){return this.canbeShowInterstitialAdByTime()}canbeShowInterstitialAdByTime(){const t=window.performance.now()/1e3,{secondsFirstTime:s,secondsBetweenAds:n}=this.config.InterstitialAdOptions,a=t-this.lastAdShownTime;return this.lastAdShownTime>0?a>n:a>s}async showBannerAdAsync(t=!0){if(!this.enabled)return;const{BannerReloadPeriod:s}=this.config;this.intervalBannerAd&&clearInterval(this.intervalBannerAd),await this.loadBannerAdAsync(),t&&(this.intervalBannerAd=setInterval(this.loadBannerAdAsync,s*1e3))}async hideBannerAdAsync(){try{if(!this.enabled)return;await this.hideAdAsync(P.BANNER)}catch{}finally{this.cleanBannerInterval()}}cleanBannerInterval(){this.intervalBannerAd&&(clearInterval(this.intervalBannerAd),this.intervalBannerAd=null)}getBannerHeight(){if(!this.enabled)return 0;const t=this.safeAreaBottom,{BannerHeight:s}=u.Configs.Ads;let n=50;return u.Utils.Device.isDesktop()?n=s.Desktop:n=s.Mobile,n+t}}var Kt=(i=>(i.BUTTON_CLICK="button_click",i.SCREEN_OPEN="screen_open",i.LOAD_START="load_start",i.LOAD_COMPLETE="load_complete",i.APP_READY="app_ready",i.TUTORIAL_BEGIN="tutorial_begin",i.TUTORIAL_STEP="tutorial_step",i.TUTORIAL_COMPLETE="tutorial_complete",i.MATCH_START="match_start",i.MATCH_RESCUE="match_rescue",i.MATCH_END="match_end",i.LEVEL_START="level_start",i.LEVEL_RESCUE="level_rescue",i.LEVEL_END="level_end",i.SHARE="share",i.MESSAGE="message",i.INVITE="invite",i.SHORTCUT_CREATE="shortcut_create",i.SHORTCUT_CREATE_POPUP="shortcut_create_popup",i.BOT_SUBSCRIBE="bot_subscribe",i.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",i.AD_SHOW="ad_show",i.AD_SHOW_FAILED="ad_show_failed",i.NEW_USER="new_user",i.AD_IMPRESSION="ad_impression",i.JOIN_GROUP="join_group",i.TOURNAMENT_SHARE="tournament_share",i.TOURNAMENT_CREATE="tournament_create",i.TOURNAMENT_POST_SCORE="tournament_post_score",i))(Kt||{});let De=class{constructor(e,t,s){l(this,"name");l(this,"color");l(this,"options");l(this,"selfLog");this.name=e,this.color=s||"#FFF",this.options=t,this.selfLog=!0}event(e,t,s){this.processEvent(e,t,s)}pageview(e){const t=this.getPageByKey(e);this.processPageView(t)}levelStart(e,t,s){this.processLevelStart(e,t,s)}levelFail(e,t,s){this.processLevelFail(e,t,s)}levelRescue(e,t,s){this.processLevelRescue(e,t,s)}levelComplete(e,t,s){this.processLevelComplete(e,t,s)}showInterstitialAd(e){this.processShowInterstitialAd(e)}showRewardedVideoAd(e){this.processShowRewardedVideoAd(e)}receiveVideoReward(e){this.processReceiveReward(e)}showAdFail(e,t,s){this.processShowAdFail(e,t,s)}getPageByKey(e){let t=e.replace(/_/g,"-");return t=t.toLowerCase(),t}processEvent(e,t,s){throw new Error("Method not implemented.")}processLevelStart(e,t,s){throw new Error("Method not implemented.")}processLevelFail(e,t,s){throw new Error("Method not implemented.")}processLevelRescue(e,t,s){throw new Error("Method not implemented.")}processLevelComplete(e,t,s){throw new Error("Method not implemented.")}processShowInterstitialAd(e){throw new Error("Method not implemented.")}processShowRewardedVideoAd(e){throw new Error("Method not implemented.")}processReceiveReward(e){throw new Error("Method not implemented.")}processShowAdFail(e,t,s){throw new Error("Method not implemented.")}processPageView(e){throw new Error("Method not implemented.")}};u.Plugins.Analytics={Events:Kt,BaseAnalytics:De};class Ne extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"analytics",[]);l(this,"placement","unknown");l(this,"pageview",t=>{this.isActive()&&this.analytics.forEach(s=>{s.pageview(t)})})}add(t){this.analytics.push(t)}event(t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.event(t,s,n)})}levelStart(t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.levelStart(t,s,n)})}levelRescue(t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.levelRescue(t,s,n)})}levelFail(t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.levelFail(t,s,n)})}levelComplete(t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.levelComplete(t,s,n)})}showInterstitialAd(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.showInterstitialAd(t)})}showRewardedVideoAd(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.showRewardedVideoAd(t)})}receiveVideoReward(){if(!this.isActive())return;const t=this.getCurrentPlacement();this.analytics.forEach(s=>{s.receiveVideoReward(t)})}showAdFail(t,s,n){this.isActive()&&this.analytics.forEach(a=>{a.showAdFail(t,s,n)})}isActive(){return this.analytics.length>=1}setPlacement(t){this.placement=t}getCurrentPlacement(){return this.placement}}class be{constructor(e){l(this,"key");this.key=e}getKey(){return this.key}}class Ee{constructor(e){l(this,"id");l(this,"isMuteAll");l(this,"masterVolume");l(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:n}=s;this.playWithRealConfig(n,t)}else this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:n=1}=t||{};this.setAudioClip(e,{volume:n,audioPlayer:s}),this.playWithRealConfig(s,t)}catch{}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:n=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*n);break;default:throw new Error(`Unsupported function: ${t}`)}}catch{}}callAudioPlayers(e){Object.values(this.audioClips).forEach(s=>{this.queueAudioPlayer(s,e)})}}u.Plugins.Audio={BaseAudioPlayer:be,BaseChannelManager:Ee};class Ce extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"firstChannelId");l(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}play(t,s,n){try{this.getChannel(n).play(t,s)}catch{}}pause(t,s){try{this.getChannel(s).pause(t)}catch{}}resume(t,s){try{this.getChannel(s).resume(t)}catch{}}stop(t,s){try{this.getChannel(s).stop(t)}catch{}}stopAll(t){try{this.getChannel(t).stopAll()}catch{}}mute(t){try{this.getChannel(t).muteAll()}catch{}}unmute(t){try{this.getChannel(t).unmuteAll()}catch{}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch{}}}const Se={token:"",isRequesting:!1};class Me extends D.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",Se)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const a=(await FBInstant.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",a)}catch(t){if(u.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token","")}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}}var L=(i=>(i.SOLO="solo",i.TOURNAMENT="tournament",i.SHARE_INVITE="share_invite",i.MATCHING_GROUP="matching_group_match",i.CHALLENGE_FRIEND="challenge_friend_match",i))(L||{});const{Object:K,Valid:Y}=u.Utils;class xt{constructor(e){l(this,"playerId");l(this,"name");l(this,"photo");l(this,"locale");this.initDefaultData(),K.hasOwn(e,"playerId")&&Y.isString(e.playerId)&&(this.playerId=e.playerId),K.hasOwn(e,"name")&&Y.isString(e.name)&&(this.name=e.name),K.hasOwn(e,"photo")&&Y.isString(e.photo)&&(this.photo=e.photo),K.hasOwn(e,"locale")&&Y.isString(e.locale)&&(this.locale=e.locale)}initDefaultData(){this.playerId="0000",this.name="unknown",this.photo="",this.locale="en_US"}toObject(){return{playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale}}}let Dt=class extends xt{initDefaultData(){super.initDefaultData()}};const H=new Dt({playerId:"10",name:"Your Friend"}).toObject();var E=(i=>(i.SINGLE="single",i.ONLINE="online",i.TOURNAMENT="tournament",i.MATCHING_GROUP="matching-group",i.CHALLENGE_FRIEND="challenge-friend",i))(E||{});const Te=E,V=Te;class Oe{constructor(e){l(this,"game");this.game=e}isValidContextType(e){return e==="THREAD"||e==="SOLO"||e==="GROUP"}isValidEntryPointData(e){return u.Utils.Valid.isObject(e)}receiveContext(e,t,s){const{storage:n}=this.game;n.setStorageData("context","contextId",e),this.isValidEntryPointData(s)&&n.setStorageData("context","entryPointData",s),this.isValidContextType(t)&&n.setStorageData("context","contextType",t)}async detectContextSessionType(){const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:n,TOURNAMENT:a,MATCHING_GROUP:o,SHARE_INVITE:r,CHALLENGE_FRIEND:c}=L;let h=n;if(s===a&&(h=a),s===o&&(h=o),(s===c||s===r)&&(h=c),h===n)try{await FBInstant.getTournamentAsync(),h=a}catch{}e.setStorageData("context","sessionContextType",h)}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),n=t.getStorageData("context","sessionContextType"),a=e.getPlayerId(),{matchId:o,playerId:r,opponentId:c=H.playerId}=s,h=a===r,p=c===H.playerId||[c,r].indexOf(a)>=0,{TOURNAMENT:y,MATCHING_GROUP:g,SHARE_INVITE:b,CHALLENGE_FRIEND:M}=L;let m=V.SINGLE;n===y&&(m=V.TOURNAMENT),n===b&&!h&&(m=V.CHALLENGE_FRIEND),n===M&&o&&p&&(m=V.CHALLENGE_FRIEND),n===g&&(m=V.MATCHING_GROUP),t.setStorageData("context","contextGameMode",m)}}class Yt extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e||"Player has finished match"}}class Xt extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}}const{Events:pt,Plugins:ve}=u,{Analytics:_e}=ve;class Le{constructor(e){l(this,"game");l(this,"processTournamentMode",async()=>{const{match:e,player:t}=this.game,s=t.getPlayerId(),n=FBInstant.context.getID();if(typeof n!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:n}),this.switchToGameScene()});l(this,"switchToDashboardScene",()=>{const{event:e}=this.game;e.emit(pt.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isContextProcessing:!0}})});l(this,"switchToGameScene",()=>{const{event:e}=this.game;e.emit(pt.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isContextProcessing:!0}})});l(this,"switchToResultScene",()=>{const{event:e}=this.game;e.emit(pt.SWITCH_SCENE,{sceneName:"ResultScene",sceneData:{isContextProcessing:!0}})});this.game=e}async processContextData(){const{player:e,analytics:t,storage:s}=this.game,n=e.getPlayer(),a=s.getStorageData("context","contextId"),o=s.getStorageData("context","entryPointData"),r=s.getStorageData("context","sessionContextType"),{type:c,matchId:h,playerId:d,opponentId:p,playerScore:y}=o||{};n.isUserNew&&t.event(_e.Events.NEW_USER);const{TOURNAMENT:g,SHARE_INVITE:b,MATCHING_GROUP:M,CHALLENGE_FRIEND:m}=L;if(r===g){this.processTournamentMode();return}if(r===m){if(c===b&&typeof d=="string"){await this.processChallengeFromPost(d);return}if(c===m&&typeof h=="string"&&typeof d=="string"&&typeof p=="string"){await this.processChallengeFromMessage({contextId:a,matchId:h,playerId:d,opponentId:p});return}}if(r===M&&typeof d=="string"&&typeof y=="number"){await this.processMatchingGroupMode(d,y);return}if(n.isUserNew){await this.processNewUserMode();return}this.switchToDashboardScene()}async processChallengeFromPost(e){const{match:t,player:s}=this.game,n=s.getPlayerId();if(n===e)throw new Error("Cannot play with yourself");await t.challenge.friend.processAsync({playerId:n,opponentId:e}),this.switchToGameScene()}async processChallengeFromMessage(e){try{await this.processContinueChallengeFromMessage(e);return}catch(t){if(t instanceof Yt){this.switchToResultScene();return}if(t instanceof Xt){await this.processJoinChallengeFromMessage(e);return}}}async processContinueChallengeFromMessage(e){const{contextId:t,matchId:s,playerId:n,opponentId:a}=e,{match:o,player:r}=this.game,c=r.getPlayerId();if(n===c)await o.challenge.continue.processAsync({contextId:t,matchId:s,playerId:c,opponentId:a});else{const d=a===H.playerId;await o.challenge.continue.processAsync({contextId:t,matchId:s,playerId:c,opponentId:d?a:n})}this.switchToGameScene()}async processJoinChallengeFromMessage(e){const{contextId:t,matchId:s,playerId:n}=e,{match:a,player:o}=this.game,r=o.getPlayerId();await a.challenge.join.processAsync({contextId:t,matchId:s,playerId:r,opponentId:n}),this.switchToGameScene()}async processMatchingGroupMode(e,t){const{match:s,player:n}=this.game;await s.group.join.processAsync({playerId:n.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processNewUserMode(){const{match:e,player:t}=this.game,s=t.getPlayerId();await e.single.start.processAsync({playerId:s}),this.switchToGameScene()}}const ot={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""};class Fe extends D.Plugins.BasePlugin{constructor(t){super(t);l(this,"context");l(this,"loader");this.loader=new Le(t),this.context=new Oe(t)}init(){const{storage:t}=this.game;t.addStorage("context",ot)}getSessionContextTypes(){return L}async processContextData(){try{await this.loader.processContextData()}catch{}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch{}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,n){this.context.receiveContext(t,s,n)}}const R=new ue,Re={names:[],history:[]};class Be extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"enableLog",!1)}init(){const{storage:t}=this.game;t.addStorage("event",Re)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),R.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),R.once(t,s)}off(t,s){this.validateCallback(s),R.off(t,s),this.addHistory(t,"on","removed")}clear(t){R.removeAllListeners(t),this.addHistory(t,"on","removed")}emit(t,s){let n=[];s&&(n=[s]),this.addHistory(t,"on","called",s),R.emit(t,...n)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,n=s.getStorageData("event","names");n.includes(t)||n.push(t)}getEventListeners(){const t=R.eventNames();return Object.keys(t)}getEventEmitCount(t){const{storage:s}=this.game;return s.getStorageData("event","history").filter(a=>a.name===t&&a.status==="called").length}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}addHistory(t,s,n,a){var d,p;const o=this.getHistory(),r=(d=o.find(y=>y.name===t))==null?void 0:d.type,c=((p=o.find(y=>y.name===t))==null?void 0:p.called)||0,h=n==="called"?c+1:c;o.push({type:r||s,status:n,name:t,called:h,payload:a||{}}),this.logEventInfo(t,s,n,h)}logEventInfo(t,s,n,a){this.enableLog&&(n==="listening"&&R.listenerCount(t),n==="called"&&R.listenerCount(t))}}const Ue='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',He=(i,e)=>{if(isNaN(i)||isNaN(e))throw new Error("width and height must be numbers");return{string:"+",style:"font-size: 1px; padding: "+Math.floor(e/2)+"px "+Math.floor(i/2)+"px;"}},Ge=(i,e=1)=>{const t=new Image;t.onload=function(){const s=this,n=s.width*e,a=s.height*e;He(n,a)},t.src=i};class Ve extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"width");l(this,"height");l(this,"canvas",null);l(this,"renderOptions");l(this,"caches",{})}preload(t){const s=Object.keys(t);s.length<1||s.forEach(n=>{const a=t[n];a&&this.loadImage(n,a)})}async capture(t){const{width:s,height:n,renderOptions:a}=t;return this.width=s,this.height=n,this.renderOptions=a,this.createCanvas(),await this.loadImages(),this.drawObjects(),this.snapshotFrame()}createCanvas(){this.canvas?this.canvas.remove():this.canvas=document.createElement("canvas",{is:"canvas"}),this.canvas.width=this.width,this.canvas.height=this.height}async loadImage(t,s){return new Promise((n,a)=>{if(this.caches[t]){n();return}const o=document.createElement("img");o.src=s,o.onload=()=>{this.caches[t]=o,n()},o.onerror=r=>{a(r)}})}async loadImages(){const t=[];for(const s in this.renderOptions){const{name:n,image:a}=this.renderOptions[s];if(!a||this.caches[n])continue;const r=this.loadImage(n,a);t.push(r)}await Promise.all(t)}drawObjects(){for(const t in this.renderOptions){const s=this.renderOptions[t];switch(s.type){case"text":this.drawText(s);break;case"image":this.drawImage(s);break}}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{x:n,y:a,font:o,text:r,fillStyle:c,lineWidth:h,textAlign:d}=t;s.font=`${o} ${Ue}`,s.fillStyle=c||"#ffffff",h&&(s.lineWidth=h),d&&(s.textAlign=d),s.fillText(r,n,a)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{x:n,y:a,name:o,width:r,height:c,fallbackWithImage:h}=t;let d=this.caches[o];if(!d&&h)d=this.caches[h];else if(!d)throw new Error(`Image ${o} not found`);s.drawImage(d,n,a,r,c)}snapshotFrame(){if(!this.canvas)return"";const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return"";const s=t.canvas.toDataURL("image/jpeg",.85);return u.Utils.Valid.isDebugger()&&Ge(s),s}}const{Utils:Tt}=u;class $e extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"locale");l(this,"data",{})}add(t,s){this.data[t]=s}choose(t){this.locale=t;const{event:s}=this.game;s.emit(u.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,n){const{text:a}=this.getLocaleData(n);if(!Tt.Object.hasOwn(a,t))return n||this.getCurrentLocale(),String(t);const o=a[t];return this.replaceVariables(o,s||[])}getTexture(t){const{texture:s}=this.getLocaleData();return s[t]}getCurrentLocale(){return this.locale||"en"}getLocaleData(t){const s=t||this.getCurrentLocale();if(!Tt.Object.hasOwn(this.data,s))throw new Error(`Locale "${s}" not found`);return this.data[s]}replaceVariables(t,s){const n=s.length;if(n==0)return t;let a=t;for(let o=0;o<n;o++){const r=s[o],c=`%{${o}}`;a=a.replace(c,r)}return a}}const{OtherHost:Qt}=u.Configs,Ot=async(i,e)=>{const t=u.Utils.String.params(e),s=await k(`${i}?${t}`,{},Qt);return u.Utils.Valid.isObject(s)?u.Utils.Object.hasOwn(s,"data")&&Array.isArray(s.data)?s.data:[]:[]},ke=async(i,e,t)=>{await x(`leaderboards/${i}/players/${e}`,{score:t},{},Qt)},vt={id:"",type:"",limit:0,offset:0,leaders:{},isRequesting:!1},je={leaderboards:{}};class We extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",je),this.configs={}}addLeaderboard(t,s,n,a){if(this.getLeaderboard(t))return;const{LeaderboardId:r}=a;let c=`leaderboards/${r}/`;n==="global"?c+="leaders":n==="friend"&&(c+="players"),this.configs[t]={id:t,type:n,host:c,mock:s},this.setLeaderboard(t,{...vt})}async requestLeaderboard(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{type:n,host:a,playerIds:o}=this.configs[t],r={limit:s,offset:0,playerIds:o};if(n==="friend"&&!o){const{player:h}=this.game,d=h.getPlayerId(),p=h.getConnectedPlayerIds(s,0);r.playerIds=[d,...p]}const c=await Ot(a,r);await this.receiveLeaderboard(t,c),this.setLeaderboard(t,{limit:s,offset:0})}finally{this.setLeaderboard(t,{isRequesting:!1})}}async loadMoreLeaderboard(t,s){try{const n=this.getLeaderboard(t);if(!n)return;this.setLeaderboard(t,{isRequesting:!0});const{host:a}=this.configs[t],{offset:o}=n,r=o+s,c=await Ot(a,{limit:s,offset:r});this.receiveLeaderboard(t,c),this.setLeaderboard(t,{limit:s,offset:r})}finally{this.setLeaderboard(t,{isRequesting:!1})}}getLeaderboard(t){const{storage:s}=this.game,n=s.getStorageData("leaderboard","leaderboards");return n[t]?n[t]:null}clearLeaderboard(t){try{this.validateLeaderboard(t),this.setLeaderboard(t,{...vt})}catch{}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:n}=s;return Object.keys(n).length===0}async setLeaderboardScore(t,s,n){try{this.validateLeaderboard(t),await ke(t,s,n)}catch{}}validateLeaderboard(t){const{storage:s}=this.game;if(!s.getStorageData("leaderboard","leaderboards")[t])throw new Error(`Leaderboard with id ${t} not found`)}setLeaderboard(t,s){const{storage:n}=this.game;n.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboard(t,s){this.validateLeaderboard(t);const{profile:n}=this.game,a=s.map(y=>y.playerId);await n.requestProfiles(a);const o=n.getProfiles(),d=s.map(y=>{const g=o[y.playerId];return g?{...y,...g}:{...y,name:"Unknown",photo:""}}).filter(y=>y.name&&y.photo).sort((y,g)=>g.score-y.score).map((y,g)=>({...y,rank:g+1})),p=u.Utils.Object.keyBy(d,"playerId");this.setLeaderboard(t,{leaders:p})}}class Nt{constructor(){l(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}}const{Utils:yt}=u;class qe extends Nt{constructor(){super(...arguments);l(this,"appId")}setAppId(t){this.appId=t}async setLeaderboardScoreAsync(t){const{leaderboardId:s,playerId:n,score:a=0}=t,o=`leaderboards/${s}/players/${n}`;await x(o,{score:a},{},this.getAPIHost())}async createLeaderboardAsync(t){const s={_id:t._id,appId:this.appId,resetScore:t.resetScore||0,numberOfLeaders:t.numberOfLeaders||15,timezone:t.timezone||"utc+0",sortOrder:t.sortOrder||"desc",statistics:t.statistics||"max",resettable:t.resettable||"manually",description:t.description||"no description",createdBy:t.createdBy,name:t.name,expireTime:t.expireTime||6048e5};await x("leaderboards",s,{},this.getAPIHost())}async getLeaderboardAsync(t,s={}){let n=[];const a=yt.String.params(s),o=`leaderboards/${t}/leaders`,r=await k(`${o}?${a}`,{},this.getAPIHost());return yt.Valid.isObject(r)?yt.Object.hasOwn(r,"data")?(n=r.data,n):[]:[]}}const{Utils:_t}=u;class ze extends Nt{async createSingleMatchAsync(e){const s=await x("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await k("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,n=await x(s,t,{},this.getAPIHost());return this.returnValidMatchData(n)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await x(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await x("matches",{opponentPlayerId:e},{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await x(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await k(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:n=0,extraData:a={}}=e,o=`matches/${t}/finish`,r=await x(o,{matchId:t,score:s,level:n,extraData:a},{},this.getAPIHost());return this.returnValidMatchData(r)}returnValidMatchData(e){let t={};return!_t.Valid.isObject(e)||!_t.Object.hasOwn(e,"data")||(t=e.data),t}}const{Utils:X}=u;class Je extends Nt{async getPlayersAsync(e){const t=X.String.params(e),s=await k(`players?${t}`,{},this.getAPIHost());return!X.Valid.isObject(s)||!X.Object.hasOwn(s,"data")?null:s.data}async updatePlayerProfileAsync(e){const t=await x("players",e,{},this.getAPIHost(),10);return X.Object.hasOwn(t,"data")?t.data:null}async increaseUserGuideDisplays(e){await x(`players/${e}/user-guide-displays/inc`,{},{},this.getAPIHost())}}class Ke{constructor(e){l(this,"matchAPI");l(this,"playerAPI");l(this,"leaderboardAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new ze,this.playerAPI=new Je,this.leaderboardAPI=new qe}setAPIConfig(e){e.playerAPIHost&&this.playerAPI.setAPIHost(e.playerAPIHost),e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost),e.leaderboardAPIHost&&this.leaderboardAPI.setAPIHost(e.leaderboardAPIHost),e.appId&&this.leaderboardAPI.setAppId(e.appId)}setMatchAPIInstance(e){this.matchAPI=e}setPlayerAPIInstance(e){this.playerAPI=e}setLeaderboardAPIInstance(e){this.leaderboardAPI=e}getPlayerAPI(){return this.playerAPI}getMatchAPI(){return this.matchAPI}getLeaderboardAPI(){return this.leaderboardAPI}}class F extends Error{constructor(t){super(t);l(this,"code");this.code="CREATE_MATCH_FAILED"}}class Zt extends F{constructor(e){super(e),this.name="LevelNotDefined",this.message=e||"Level is not defined"}}class te extends F{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e||"Match id is not defined"}}const{Utils:Ye}=u;class f{constructor(e){l(this,"game");l(this,"match");l(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){this.logData("Before",e)}async nextAsync(e){this.logData("After",e),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){Ye.Valid.isDebugger()}}const{Utils:Xe}=u,{Analytics:Qe}=u.Plugins;class v extends f{async processAsync(e){super.processAsync(e);const{customData:t,mode:s}=e;if(s===null)throw new te;const{level:n}=t;if(typeof n!="number")throw new Zt;const{analytics:a}=this.game;a.event(Qe.Events.MATCH_START,{game_mode:Xe.String.toUpperCamelCase(s),level:n,level_name:`level_${n}`}),await this.nextAsync(e)}}const C={OPEN:"open",ACTIVE:"active",FINISHED:"finished"};class N extends f{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let n=t||V.SINGLE;s===C.FINISHED&&(n=V.SINGLE),this.contextGameModeDetected(n),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}}class bt extends F{constructor(e){super(e),this.name="CreateContextFailed",this.message=e||"Create context failed"}}const{Utils:Ze}=u;class ts extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,n=await this.createAsync(s);t.customData.contextId=n,await this.nextAsync(t)}async createAsync(t){try{await FBInstant.context.createAsync(t)}catch(n){if(!Ze.Object.hasOwn(n,"code")||n.code!=="SAME_CONTEXT")throw n}const s=FBInstant.context.getID();if(typeof s!="string")throw new bt;return s}}class rt{constructor(e){l(this,"_id");l(this,"mode");l(this,"status");l(this,"winnerId");l(this,"whitePlayerId");l(this,"blackPlayerId");l(this,"whitePlayerScore");l(this,"blackPlayerScore");l(this,"whitePlayerFinish");l(this,"blackPlayerFinish");this.setupDefaultData(),u.Utils.Valid.isObject(e)&&(this.updateID(e._id),this.updateMode(e.mode),this.updateStatus(e.status),this.updateWinnerId(e.winnerId),this.updateWhitePlayerId(e.whitePlayerId),this.updateBlackPlayerId(e.blackPlayerId),this.updateWhitePlayerScore(e.whitePlayerScore),this.updateBlackPlayerScore(e.blackPlayerScore),this.updateWhitePlayerFinish(e.whitePlayerFinish),this.updateBlackPlayerFinish(e.blackPlayerFinish))}setupDefaultData(){this._id="",this.mode="",this.status="",this.winnerId="",this.whitePlayerId="",this.blackPlayerId="",this.whitePlayerScore=0,this.blackPlayerScore=0,this.whitePlayerFinish=!1,this.blackPlayerFinish=!1}updateID(e){typeof e=="string"&&(this._id=e)}updateMode(e){typeof e=="string"&&(this.mode=e)}updateStatus(e){typeof e=="string"&&(this.status=e)}updateWinnerId(e){typeof e=="string"&&(this.winnerId=e)}updateWhitePlayerId(e){typeof e=="string"&&(this.whitePlayerId=e)}updateBlackPlayerId(e){typeof e=="string"&&(this.blackPlayerId=e)}updateWhitePlayerScore(e){typeof e=="number"&&(this.whitePlayerScore=e)}updateBlackPlayerScore(e){typeof e=="number"&&(this.blackPlayerScore=e)}updateWhitePlayerFinish(e){typeof e=="boolean"&&(this.whitePlayerFinish=e)}updateBlackPlayerFinish(e){typeof e=="boolean"&&(this.blackPlayerFinish=e)}toObject(){return{_id:this._id,mode:this.mode,status:this.status,winnerId:this.winnerId,whitePlayerId:this.whitePlayerId,blackPlayerId:this.blackPlayerId,whitePlayerScore:this.whitePlayerScore,blackPlayerScore:this.blackPlayerScore,whitePlayerFinish:this.whitePlayerFinish,blackPlayerFinish:this.blackPlayerFinish}}}class ct extends F{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e||"Match are not open"}}class $ extends F{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e||"Opponent id is not valid"}}class ee extends f{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createMatchAsync(e),s=new rt(t).toObject();this.updateMatchState(e,s),await this.nextAsync(e)}validateData(e){const{status:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new $;if(t!==C.OPEN)throw new ct}async createMatchAsync(e){const{opponentId:t}=e.customData;return t?await this.match.api.getMatchAPI().createMatchAsync(t):{}}updateMatchState(e,t){const{customData:s}=e,{_id:n,whitePlayerId:a,blackPlayerId:o,whitePlayerFinish:r,blackPlayerFinish:c}=t,h=a===s.opponentId;e.id=n||null;const d=h?o:a,p=h?a:o;e.customData.playerId=d,e.customData.opponentId=p,e.profiles[d]||(e.profiles[d]={id:d,name:"",photo:"",finished:!1}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1});const y=h?c:r,g=h?r:c;e.profiles[d].finished=y,e.profiles[p].finished=g}}const{LeaderboardId:es}=u.Configs.LeadersBoard,se={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,leaderboardId:es};class S extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:n,customData:a}=this.payload;t.id=s||null,t.mode=n||null,t.status=C.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...se,...t.customData,...a}}}class _ extends f{async processAsync(e){if(super.processAsync(e),e.status!==C.OPEN)throw new ct;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=C.ACTIVE,e.startAt=Date.now()}}const it=L;class j extends F{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e||"Context id is not valid"}}class lt extends F{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e||"Match id is not valid"}}class A extends F{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e||"Player id is not valid"}}const ss=async()=>{const{player:i,match:e,frameCapture:t}=window.game,s=e.getMatchState(),{profiles:n}=s,{playerId:a,photo:o}=i.getPlayer(),{score:r}=n[a]||{},c=ns({playerId:a,playerPhoto:o,playerScore:r});if(!c)return;const h={name:"share-current-score",width:952,height:492,renderOptions:c};return await t.capture(h)},ns=i=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0}=i;return typeof e!="string"||typeof t!="string"||typeof s!="number"?null:{avatar:{name:`${e}`,type:"image",x:634,y:118,image:t,width:240,height:240},wideFrame:{name:"wide-frame-message-win",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-message-win.png",width:952,height:492},playerScoreShadow:{type:"text",x:760,y:454,font:"600 70px",fillStyle:"#c4683f",text:`${s}`,textAlign:"center"},playerScore:{type:"text",x:760,y:450,font:"600 70px",fillStyle:"#f2a62e",text:`${s}`,textAlign:"center"}}},Et=async()=>{const{match:i,frameCapture:e}=window.game,t=i.getMatchState(),{profiles:s,customData:n}=t,{playerId:a,opponentId:o}=n;if(!a||!o)return;const r=s[a],c=s[o],{photo:h,score:d,finished:p}=r,{photo:y,score:g=0,finished:b}=c,m=as({playerId:a,playerPhoto:h,playerScore:d,opponentId:o,opponentPhoto:y,opponentScore:g,isPlayerFinished:p,isOpponentFinished:b});if(!m)return;const ce={name:"share-game-result",width:952,height:492,renderOptions:m};return await e.capture(ce)},as=i=>{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:n="20",opponentPhoto:a="",opponentScore:o=0,isPlayerFinished:r,isOpponentFinished:c}=i;if(typeof e!="string"||typeof t!="string"||typeof s!="number"||typeof n!="string"||typeof a!="string"||typeof o!="number"||typeof r!="boolean"||typeof c!="boolean")return null;const h=s===o,d=s>o,p=r||c,y=r&&c,g={leftPhoto:{name:`${e}`,type:"image",x:56,y:140,image:t,width:220,height:220},rightPhoto:{name:`${n}`,type:"image",x:690,y:140,image:a,width:220,height:220},wideFrame:{name:"wide-frame-game-result",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-result.png",width:952,height:492}};return p&&(g.leftScoreShadow={type:"text",x:162,y:444,font:"600 70px",fillStyle:"#c4683f",text:r?`${s}`:"???",textAlign:"center"},g.leftScore={type:"text",x:162,y:440,font:"600 70px",fillStyle:"#f2a62e",text:r?`${s}`:"???",textAlign:"center"},g.rightScoreShadow={type:"text",x:796,y:444,font:"600 70px",fillStyle:"#c4683f",text:c?`${o}`:"???",textAlign:"center"},g.rightScore={type:"text",x:796,y:440,font:"600 70px",fillStyle:"#f2a62e",text:c?`${o}`:"???",textAlign:"center"}),!h&&y&&(d?g.leftCrown={name:"crown-icon",type:"image",x:112,y:72,image:"./assets/images/others/crown-icon.png",width:106,height:78}:g.rightCrown={name:"crown-icon",type:"image",x:750,y:72,image:"./assets/images/others/crown-icon.png",width:106,height:78}),g};class ne extends f{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync().catch(()=>{});t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:a}=s;if(!t||typeof t!="string")throw new lt;if(!n||typeof n!="string")throw new j;if(!a||typeof a!="string")throw new $}async createWideframesResultAsync(){return await Et()}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:a}=e,{playerId:o,opponentId:r}=a;if(!o||typeof o!="string")throw new A;const{name:c}=n[o],h={data:{type:it.CHALLENGE_FRIEND,matchId:s,playerId:o,opponentId:r},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${c} challenges you`,localizations:{en_US:`${c} challenges you`,vi_VN:`${c} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await FBInstant.updateAsync(h)}}class I extends f{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}}const{Utils:B}=u;class Ct{constructor(e){l(this,"id");l(this,"name");l(this,"photo");l(this,"score");l(this,"diamond");l(this,"bestScore");l(this,"finished");this.setupDefaultData(),B.Valid.isObject(e)&&(B.Object.hasOwn(e,"id")&&this.updateID(e.id),B.Object.hasOwn(e,"name")&&this.updateName(e.name),B.Object.hasOwn(e,"photo")&&this.updatePhoto(e.photo),B.Object.hasOwn(e,"score")&&this.updateScore(e.score),B.Object.hasOwn(e,"diamond")&&this.updateDiamond(e.diamond),B.Object.hasOwn(e,"finished")&&this.updateFinished(e.finished),B.Object.hasOwn(e,"bestScore")&&this.updateBestScore(e.bestScore))}setupDefaultData(){this.id="",this.name="Your Friend",this.photo="./assets/images/others/avatar.png",this.score=0,this.diamond=0,this.bestScore=0,this.finished=!1}updateID(e){typeof e=="string"&&(this.id=e)}updateName(e){typeof e=="string"&&(this.name=e)}updatePhoto(e){typeof e=="string"&&(this.photo=e)}updateScore(e){typeof e=="number"&&(this.score=e)}updateDiamond(e){typeof e=="number"&&(this.diamond=e)}updateBestScore(e){typeof e=="number"&&(this.bestScore=e)}updateFinished(e){typeof e=="boolean"&&(this.finished=e)}toObject(){return{id:this.id,name:this.name,photo:this.photo,score:this.score,diamond:this.diamond,bestScore:this.bestScore,finished:this.finished}}}class G extends F{constructor(e){super(e),this.name="ProfileNotFound",this.message=e||"Profile not found"}}class q extends f{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:n}=t;let a=s;const o=await this.getProfile(a);if(!o)throw new G;if(this.updateMatchProfile(e,a,o),a=n,a!==H.playerId){const r=await this.getProfile(a);if(!r)throw new G;this.updateMatchProfile(e,a,r)}else this.updateMatchProfile(e,a);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:n}=t;if(!s||typeof s!="string")throw new A;if(!n||typeof n!="string")throw new $}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:n,photo:a}=s||H,o=new Ct({id:t,name:n,photo:a}).toObject();e.profiles[t]?(e.profiles[t].name=o.name,e.profiles[t].photo=o.photo):e.profiles[t]=o}}class w{constructor(e,t){l(this,"game");l(this,"match");this.game=e,this.match=t}startLog(e){}endLog(){}async processAsync(e){throw new Error("Not implemented")}}class os extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,n=new I(this),a=new ts(this,{opponentId:s});n.setNext(a);const o=new S(this,{mode:E.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});a.setNext(o);const r=new ee(this);o.setNext(r);const c=new q(this);r.setNext(c);const h=new _(this);c.setNext(h);const d=new v(this);h.setNext(d);const p=new ne(this);d.setNext(p);const y=new N(this);p.setNext(y);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}}class gt extends Error{constructor(e){super(e),this.name="SameContext",this.message=e||"Same context"}}const{Utils:is}=u;class St extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",n=FBInstant.context.getID();if(n===t)throw new gt;if(s&&n===null)throw new gt}async switchAsync(t){try{this.checkSameContext(t);const s=t==="SOLO";await FBInstant.context.switchAsync(t,s)}catch(s){if(s instanceof gt)return;if(!is.Object.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}}class rs extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e||"The player is not currently in this match"}}class cs extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e||"Get match detail failed"}}class ls extends f{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new rt(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new lt;if(s!==C.OPEN)throw new ct}validateContinueMatchData(e,t){const{id:s,customData:n}=e,{_id:a,whitePlayerId:o,blackPlayerId:r}=t;if(typeof a!="string"||a!==s)throw new cs;const{playerId:c}=n,h=o===c,d=r===c;if(!h&&r===H.playerId)throw new Xt;if(!h&&!d)throw new rs}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new A;const{finished:a}=t[n];if(a)throw new Yt}async getMatchAsync(e){const{id:t}=e;return t?await this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:a,whitePlayerScore:o,blackPlayerScore:r,whitePlayerFinish:c,blackPlayerFinish:h}=t,d=n===s.playerId,p=d?n:a,y=d?a:n;e.customData.playerId=p,e.customData.opponentId=y,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?o:r,b=d?r:o;e.profiles[p].score=g,e.profiles[y].score=b;const M=d?c:h,m=d?h:c;e.profiles[p].finished=M,e.profiles[y].finished=m}}class hs extends w{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:n,opponentId:a}=e,o=new I(this),r=new St(this,{contextId:t});o.setNext(r);const c=new S(this,{id:s,mode:E.CHALLENGE_FRIEND,customData:{playerId:n,opponentId:a}});r.setNext(c);const h=new ls(this);c.setNext(h);const d=new q(this);h.setNext(d);const p=new _(this);d.setNext(p);const y=new v(this);p.setNext(y);const g=new N(this);y.setNext(g);const b=this.match.getMatchState();await o.processAsync(b)}finally{this.endLog()}}}const{Utils:ds}=u,{Analytics:us}=u.Plugins;class ht extends f{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:n,finishAt:a}=e;if(s===null)throw new te;const{level:o}=t;if(typeof o!="number")throw new Zt;const{analytics:r}=this.game,c=Math.floor((a-n)/1e3);r.event(us.Events.MATCH_END,{game_mode:ds.String.toUpperCamelCase(s),level:o,level_name:`level_${o}`,time_played:c}),await this.nextAsync(e)}}class ps extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e||"Leaderboard id is not valid"}}class z extends f{async processAsync(e){super.processAsync(e),await this.setLeaderboardScoreAsync(e),await this.nextAsync(e)}async setLeaderboardScoreAsync(e){try{const{profiles:t,customData:s}=e,{playerId:n,leaderboardId:a}=s;if(!n||!t[n])throw new G;if(!a)throw new ps;const{score:o}=t[n],r={leaderboardId:a,playerId:n,score:o};await this.match.api.getLeaderboardAPI().setLeaderboardScoreAsync(r)}catch{}}}class ys extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e||"Match are not active"}}class dt extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){if(super.processAsync(t),t.status!==C.ACTIVE)throw new ys;const{useAPI:s}=this.payload;if(s){const n=await this.finishMatchAsync(t),a=new rt(n).toObject();this.updateMatchFromAPI(t,a)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}updateMatchData(t){const{playerId:s}=t.customData;if(typeof s!="string")throw new A;t.profiles[s].finished=!0}updateMatchState(t){t.status=C.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:n,customData:a}=t,{level:o,playerId:r}=a;if(typeof r!="string")throw new A;const{score:c}=n[r],{extraData:h}=this.payload,d={matchId:s||"",score:c,level:o,extraData:h};return await this.match.api.getMatchAPI().finishMatchAsync(d)}updateMatchFromAPI(t,s){const{playerId:n,opponentId:a}=t.customData;if(typeof n!="string")throw new A;if(typeof a!="string")throw new $;const{whitePlayerId:o,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:h,blackPlayerFinish:d}=s,p=n===o,y=p?r:c,g=p?c:r,b=p?h:d,M=p?d:h;t.profiles[n].score=y,t.profiles[a].score=g,t.profiles[n].finished=b,t.profiles[a].finished=M}}class gs extends f{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync().catch(()=>{});t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:a}=s;if(!t||typeof t!="string")throw new lt;if(!n||typeof n!="string")throw new j;if(!a||typeof a!="string")throw new $}async createWideframesResultAsync(){return await Et()}progressSendFinishedMessage(e,t){const{profiles:s,customData:n}=e,{playerId:a,opponentId:o}=n;if(!a||typeof a!="string")throw new A;if(!o||typeof o!="string")throw new $;const{score:r=0,finished:c}=s[a],{score:h=0,finished:d}=s[o];c?this.sendFinishMessageAsync(e,t):d&&r>h?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:n,customData:a}=e,{playerId:o,opponentId:r}=a;if(!o||typeof o!="string")throw new A;const{name:c}=n[o],h={data:{type:it.CHALLENGE_FRIEND,matchId:s,playerId:o,opponentId:r,status:C.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem kết quả"}},text:{default:`${c} just finished. Check them now.`,localizations:{en_US:`${c} just finished. Check them now.`,vi_VN:`${c} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await FBInstant.updateAsync(h)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:n,customData:a}=e,{playerId:o,opponentId:r}=a;if(!o||typeof o!="string")throw new A;const{name:c,score:h}=n[o],d={data:{type:it.CHALLENGE_FRIEND,matchId:s,playerId:o,opponentId:r,status:C.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${c} got ${h} scores. So easy! Can you?`,localizations:{en_US:`${c} got ${h} scores. So easy! Can you?`,vi_VN:`${c} đã đạt ${h} điểm! Nhấn Chơi để so tài!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await FBInstant.updateAsync(d)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:n,customData:a}=e,{playerId:o,opponentId:r}=a;if(!o||typeof o!="string")throw new A;const{name:c,score:h}=n[o],d={data:{type:it.CHALLENGE_FRIEND,matchId:s,playerId:o,opponentId:r,status:C.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{en_US:"See result",vi_VN:"Xem kết quả"}},text:{default:`${c} beat your high score. Their score: ${h}`,localizations:{en_US:`${c} beat your high score. Their score: ${h}`,vi_VN:`${c} đã vượt qua điểm số của bạn, với ${h} điểm!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await FBInstant.updateAsync(d)}}class ut extends f{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new G;const{player:a}=this.game,o=a.getPlayerDataByKey("score")||0,{score:r=0}=t[n];r<=o||(a.setBestScore(r),t[n].bestScore=r)}}class fs extends w{async processAsync(e){try{this.startLog(e);const{extraData:t}=e,s=new I(this),n=new dt(this,{useAPI:!0,extraData:t});s.setNext(n);const a=new gs(this);n.setNext(a);const o=new ht(this);a.setNext(o);const r=new ut(this);o.setNext(r);const c=new z(this);r.setNext(c);const h=new N(this);c.setNext(h);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}class mt extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e||"Context is a tournament"}}const{Utils:ws}=u;class ms extends f{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await FBInstant.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!ws.Object.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=FBInstant.context.getID();if(typeof e!="string")throw new bt;return e}async checkContextTournament(){try{throw await FBInstant.getTournamentAsync(),new mt}catch(e){if(e instanceof mt)throw e}}}class Lt extends Error{constructor(e){super(e),this.name="ContextNotChallenge",this.message=e||"Context is not a challenge"}}class As extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e||"Network failure"}}const{Utils:Ft}=u;class Is extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=FBInstant.context.getID();if(typeof t!="string")throw new j;if(t==="SOLO")throw new Lt}async getOpponentIdFromContextAsync(){const{playerId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new Lt;let n=H;return s.length===1&&(n=s[0]),n.playerId}async getContextPlayers(t){try{const s=await FBInstant.context.getPlayersAsync(),n=[];return s.forEach(a=>{const o=a.getID();if(t.includes(o))return;const r=a.getName();if(!r)return;const c=a.getPhoto();n.push(new Dt({playerId:o,name:r,photo:c}).toObject())}),Ft.Array.unique(n)}catch(s){if(Ft.Object.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new As;return[]}}}class Ps extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),n=new ms(this);s.setNext(n);const a=new S(this,{mode:E.CHALLENGE_FRIEND,customData:{playerId:t}});n.setNext(a);const o=new Is(this,{playerId:t});a.setNext(o);const r=new ee(this);o.setNext(r);const c=new q(this);r.setNext(c);const h=new _(this);c.setNext(h);const d=new v(this);h.setNext(d);const p=new ne(this);d.setNext(p);const y=new N(this);p.setNext(y);const g=this.match.getMatchState();await s.processAsync(g)}finally{this.endLog()}}}class xs extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e||"Join match failed"}}class Ds extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e||"Match are finished"}}class Ns extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e||"Other player has joined match"}}class bs extends f{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new rt(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==C.OPEN)throw new ct}validateJoinMatchData(e,t){const{id:s,customData:n}=e,{_id:a,blackPlayerId:o,whitePlayerId:r,whitePlayerFinish:c,blackPlayerFinish:h}=t,d=r===n.playerId,p=o===n.opponentId;if(typeof a!="string"||a!==s||!d)throw new xs;if(c&&h)throw new Ds;if(!p)throw new Ns}async joinMatchAsync(e){const{id:t}=e;return t?await this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:a,whitePlayerScore:o,blackPlayerScore:r,whitePlayerFinish:c,blackPlayerFinish:h}=t,d=n===s.playerId,p=d?n:a,y=d?a:n;e.customData.playerId=p,e.customData.opponentId=y,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?o:r,b=d?r:o;e.profiles[p].score=g,e.profiles[y].score=b;const M=d?c:h,m=d?h:c;e.profiles[p].finished=M,e.profiles[y].finished=m}}class Es extends w{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,a=new I(this),o=new S(this,{id:t,mode:E.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});a.setNext(o);const r=new bs(this);o.setNext(r);const c=new q(this);r.setNext(c);const h=new _(this);c.setNext(h);const d=new v(this);h.setNext(d);const p=new N(this);d.setNext(p);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}}class Cs extends w{constructor(){super(...arguments);l(this,"fallbackSingleMode");l(this,"startFLowChallengeFriend",async t=>{try{return await this.match.challenge.invite.processAsync({playerId:t}),!0}catch(s){return s}});l(this,"startFlowTournament",async t=>{try{await this.match.tournament.start.processAsync({playerId:t})}catch{await this.startFlowSingle(t)}});l(this,"startFlowSingle",async t=>{if(!this.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");await this.match.single.start.processAsync({playerId:t})})}async processAsync(t){try{this.startLog(t);const{playerId:s,fallbackSingleMode:n}=t;this.fallbackSingleMode=n;const a=await this.startFLowChallengeFriend(s);if(a===!0)return;a instanceof mt?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}}class Ss extends f{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:a}=s;if(!t||typeof t!="string")throw new lt;if(!n||typeof n!="string")throw new j;if(!a||typeof a!="string")throw new $}async createWideframesResultAsync(){return await Et()}async createWideframesCurrentScoreAsync(){return await ss()}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:n,opponentId:a}=s;if(a&&typeof a=="string"){if(!n||typeof n!="string")throw new A;const{score:r=0}=t[n]||{},{score:c=0}=t[a]||{};if(r>c){const h=await this.createWideframesResultAsync().catch(()=>{});if(!h)return;this.sendBestScoreMessageAsync(e,h);return}}const o=await this.createWideframesCurrentScoreAsync().catch(()=>{});o&&this.sendChallengeMessageAsync(e,o)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:n}=e,{playerId:a}=n;if(!a||typeof a!="string")throw new A;const{name:o,score:r}=s[a],c={data:{type:L.MATCHING_GROUP,playerId:a,playerName:o,playerScore:r},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi"}},text:{default:`${o} beats your high score. Their score: ${r}.`,localizations:{en_US:`${o} beats your high score. Their score: ${r}.`,vi_VN:`${o} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await FBInstant.updateAsync(c)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:n}=e,{playerId:a}=n;if(!a||typeof a!="string")throw new A;const{name:o,score:r}=s[a],c={data:{type:L.MATCHING_GROUP,playerId:a,playerName:o,playerScore:r},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{en_US:"Play",vi_VN:"Chơi ngay"}},text:{default:`${o} got ${r} scores. So easy! Can you?`,localizations:{en_US:`${o} got ${r} scores. So easy! Can you?`,vi_VN:`${o} đã đạt ${r} điểm! Quá dễ luôn. Chơi lại nào!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await FBInstant.updateAsync(c)}}class Ms extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new dt(this,{useAPI:!1});e.setNext(t);const s=new Ss(this);t.setNext(s);const n=new ht(this);s.setNext(n);const a=new ut(this);n.setNext(a);const o=new z(this);a.setNext(o);const r=new N(this);o.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}}class Ts extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:n}=t;if(!n[s])throw new G;const a={...n[s],...this.payload},o=new Ct(a).toObject();n[o.id]=o}}class Os extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:n}=e,a=new I(this),o=new S(this,{id:"7749",mode:E.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});a.setNext(o);const r=new q(this);o.setNext(r);const c=new Ts(this,{id:t,score:n});r.setNext(c);const h=new _(this);c.setNext(h);const d=new v(this);h.setNext(d);const p=new N(this);d.setNext(p);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}}class Rt extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e||"Match group is not supported"}}const{Utils:vs}=u;class _s extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=this.getMatchTag(),n=await this.matchingGroup(s);t.customData.contextId=n,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!FBInstant.getSupportedAPIs().includes("checkCanPlayerMatchAsync"))throw new Rt;if(!await FBInstant.checkCanPlayerMatchAsync())throw new Rt}getMatchTag(){const{locale:t}=this.payload;let s="global";if(t){const n=vs.String.getLanguageCode(t);n==="en"?s="en":n==="in"&&(s="in")}return s}async matchingGroup(t){await FBInstant.matchPlayerAsync(t,!0,!0);const s=FBInstant.context.getID();if(typeof s!="string")throw new bt;return s}}class Ls extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e||"Profile id is not defined"}}class J extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new Ls;const{player:n}=this.game,a=n.getPlayerId();let o;if(s===a)o=this.getPlayerProfile();else if(o=await this.getProfileAsync(s),!o)throw new G;this.updateMatchData(o,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:n,photo:a,locale:o}=t.getPlayer();return{playerId:s,name:n,photo:a,locale:o}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:n,name:a,photo:o}=t,r=new Ct({id:n,name:a,photo:o}).toObject();s.profiles[n]=r}}class Fs extends w{async processAsync(e){try{this.startLog(e);const{locale:t,playerId:s}=e,n=new I(this),a=new _s(this,{locale:t});n.setNext(a);const o=new S(this,{id:"7749",mode:E.MATCHING_GROUP,customData:{playerId:s}});a.setNext(o);const r=new _(this);o.setNext(r);const c=new J(this,{profileId:s});r.setNext(c);const h=new v(this);c.setNext(h);const d=new N(this);h.setNext(d);const p=this.match.getMatchState();await n.processAsync(p)}finally{this.endLog()}}}const{Analytics:ft}=u.Plugins;class ae extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:n}=t,{playerId:a}=n;if(this.validatePlayerId(a),!s[a])throw new G}validatePlayerId(t){if(typeof t!="string")throw new A}getPlayerProfile(t){const{profiles:s,customData:n}=t,{playerId:a}=n;return this.validatePlayerId(a),s[a]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:n=0,bestScore:a=0}=s;return n>a}async postScoreTournamentAsync(t){const{analytics:s}=window.game,n=this.getPlayerProfile(t),{score:a=0}=n;let o=null,r=!1;const{checkBestScore:c}=this.payload,h=c&&this.isNewBestScore(t);try{await FBInstant.getTournamentAsync(),h?(o=ft.Events.TOURNAMENT_SHARE,await FBInstant.tournament.shareAsync({score:a})):(o=ft.Events.TOURNAMENT_POST_SCORE,await FBInstant.tournament.postScoreAsync(a)),r=!0}catch{if(h){o=ft.Events.TOURNAMENT_CREATE,await this.createTournamentAsync(a),r=!0;return}}finally{o&&s.event(o,{success:r})}}getTournamentTitle(){const t=FBInstant.player.getName();let s="Yours Tournament";return t&&(s=`${t}'s Tournament`),s}async createTournamentAsync(t,s){try{const n=this.getTournamentTitle();await FBInstant.tournament.createAsync({initialScore:t,config:{tournamentTitle:n},data:{...s,type:L.TOURNAMENT}})}catch{}}}class Rs extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new dt(this,{useAPI:!1});e.setNext(t);const s=new ae(this,{checkBestScore:!1});t.setNext(s);const n=new ht(this);s.setNext(n);const a=new ut(this);n.setNext(a);const o=new z(this);a.setNext(o);const r=new N(this);o.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}}class Bs extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),n=new St(this,{contextId:"SOLO"});s.setNext(n);const a=new S(this,{id:"123456",mode:E.SINGLE,customData:{playerId:t}});n.setNext(a);const o=new _(this);a.setNext(o);const r=new J(this,{profileId:t});o.setNext(r);const c=new v(this);r.setNext(c);const h=new N(this);c.setNext(h);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}class Us extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s),t.customData.contextId=s,await this.nextAsync(t)}validateContextId(t){if(typeof t!="string")throw new j}}class Hs extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,n=new I(this),a=new Us(this,{contextId:s});n.setNext(a);const o=new S(this,{id:"1997",mode:E.TOURNAMENT,customData:{playerId:t}});a.setNext(o);const r=new _(this);o.setNext(r);const c=new J(this,{profileId:t});r.setNext(c);const h=new v(this);c.setNext(h);const d=new N(this);h.setNext(d);const p=this.match.getMatchState();await n.processAsync(p)}finally{this.endLog()}}}const{Utils:Gs}=u;class Vs extends f{constructor(){super(...arguments);l(this,"leaderboardPayload")}async processAsync(t){super.processAsync(t),await this.setupCreatePayload(t),await this.createLeaderboardAsync(),this.updateMatchState(t),await this.nextAsync(t)}async setupCreatePayload(t){const{playerId:s}=t.customData;if(!s)throw new G;const a=(await FBInstant.getTournamentAsync()).getID(),o=Gs.String.generateObjectId(),r=FBInstant.player.getName(),c=r?`${r}'s Tournament`:"Your Tournament";this.leaderboardPayload={_id:o,name:a,createdBy:s,description:c}}async createLeaderboardAsync(){await this.match.api.getLeaderboardAPI().createLeaderboardAsync(this.leaderboardPayload)}updateMatchState(t){const{_id:s}=this.leaderboardPayload;t.customData.leaderboardId=s}}class $s extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),n=new S(this,{id:"1997",mode:E.TOURNAMENT,customData:{playerId:t}});s.setNext(n);const a=new Vs(this);n.setNext(a);const o=new z(this);a.setNext(o);const r=this.match.getMatchState();await s.processAsync(r)}finally{this.endLog()}}}class ks extends w{async processAsync(){try{this.startLog();const e=new I(this),t=new dt(this,{useAPI:!1});e.setNext(t);const s=new ae(this,{checkBestScore:!0});t.setNext(s);const n=new ht(this);s.setNext(n);const a=new ut(this);n.setNext(a);const o=new z(this);a.setNext(o);const r=new N(this);o.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}}class js extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e||"Tournament id is not valid"}}const{Utils:Ws}=u;class qs extends f{constructor(t,s){super(t);l(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const n=FBInstant.context.getID();this.validateContextId(n),t.customData.contextId=n,await this.nextAsync(t)}validateTournamentId(t){if(typeof t!="string")throw new js}validateContextId(t){if(typeof t!="string")throw new j}async joinTournamentAsync(t){try{await FBInstant.tournament.joinAsync(t)}catch(s){if(!Ws.Object.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}}class zs extends w{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,n=new I(this),a=new qs(this,{tournamentId:s});n.setNext(a);const o=new S(this,{id:"1997",mode:E.TOURNAMENT,customData:{playerId:t}});a.setNext(o);const r=new _(this);o.setNext(r);const c=new J(this,{profileId:t});r.setNext(c);const h=new v(this);c.setNext(h);const d=new N(this);h.setNext(d);const p=this.match.getMatchState();await n.processAsync(p)}finally{this.endLog()}}}class Js extends w{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new I(this),n=new St(this,{contextId:"SOLO"});s.setNext(n);const a=new S(this,{id:"1997",mode:E.TOURNAMENT,customData:{playerId:t}});n.setNext(a);const o=new _(this);a.setNext(o);const r=new J(this,{profileId:t});o.setNext(r);const c=new v(this);r.setNext(c);const h=new N(this);c.setNext(h);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}}const Ks={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...se}},{Configs:Q}=u;class Ys extends D.Plugins.BasePlugin{constructor(){super(...arguments);l(this,"group");l(this,"single");l(this,"context");l(this,"challenge");l(this,"tournament");l(this,"api");l(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createConcreteFlows()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",Ks)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createAPIHandler(){const t={appId:Q.AppId,matchAPIHost:Q.ApiHost,playerAPIHost:Q.ApiHost,leaderboardAPIHost:Q.OtherHost};this.api=new Ke(t)}createGroupFlows(){this.group={join:new Os(this.game,this),start:new Fs(this.game,this),finish:new Ms(this.game,this)}}createSingleFlows(){this.single={start:new Bs(this.game,this),finish:new Rs(this.game,this)}}createContextFlows(){this.context={choose:new Cs(this.game,this)}}createChallengeFlows(){this.challenge={invite:new Ps(this.game,this),friend:new os(this.game,this),join:new Es(this.game,this),finish:new fs(this.game,this),continue:new hs(this.game,this)}}createTournamentFlows(){this.tournament={join:new zs(this.game,this),start:new Js(this.game,this),create:new $s(this.game,this),finish:new ks(this.game,this),continue:new Hs(this.game,this)}}}const{Utils:oe}=u,{ApiHost:ie}=u.Configs,Xs=async i=>{const e=await x("players",i,{},ie,10);return oe.Object.hasOwn(e,"data")?e.data||{}:{}},Qs=async i=>{const e=await x(`players/${i}/user-guide-displays/inc`,{},{},ie);return oe.Object.hasOwn(e,"data")?(e==null?void 0:e.data)||{}:{}},re={ASID:"",playerId:"",name:"",photo:"",locale:"",isUserNew:!0,connectedPlayers:{},data:{score:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},userGuideDisplays:0}},{Utils:Zs,Configs:tn}=u,{AppId:en}=tn;class sn extends D.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",re)}async saveToCloud(){const e=this.getPlayerData();FBInstant.player.setDataAsync(e)}receiveData(e,t){const{storage:s}=this.game,{playerId:n,name:a,photo:o,locale:r}=e;s.setStorageData("player","playerId",n),s.setStorageData("player","name",a),s.setStorageData("player","photo",o),s.setStorageData("player","locale",r),t&&this.setPlayerData(t)}async syncProfileToServer(){const e=this.getPlayer(),{ASID:t,playerId:s,name:n,photo:a,locale:o}=e;await Xs({appId:en,ASID:t,playerId:s,name:n,photo:a,locale:o})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e)}setBestScore(e){this.setPlayerDataByName("score",e),this.saveToCloud()}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t}),this.saveToCloud()}setGameData(e){const t=this.getGameData()||{},s=Zs.Object.merge(t,e);this.setPlayerDataByName("gameData",s),this.saveToCloud()}async incUserGuideDisplays(){const{storage:e}=this.game,{userGuideDisplays:t}=e.getStorageData("player","data");this.setPlayerDataByName("userGuideDisplays",t+1),this.saveToCloud();const s=this.getPlayerId();await Qs(s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await FBInstant.player.getConnectedPlayersAsync()).map(o=>{const r=o.getID(),c=o.getName(),h=o.getPhoto();return!r||!c||!h?null:new xt({playerId:r,name:c,photo:h}).toObject()}),n=u.Utils.Array.unique(s);if(n.length<1)return;const a=u.Utils.Object.keyBy(n,"playerId");e.setStorageData("player","connectedPlayers",a)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return u.Utils.Object.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return u.Utils.Object.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}getPlayerIsNew(){const{storage:e}=this.game;return e.getStorageData("player","isUserNew")}getBestScore(){const{score:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,e)}}const{Utils:nn}=u,{ApiHost:an}=u.Configs,on=async i=>{const e=u.Utils.String.params(i),t=await k(`players?${e}`,{},an);return nn.Object.hasOwn(t,"data")?Array.isArray(t.data)?t.data:[]:[]};class rn extends Dt{}const cn={profiles:{},profileIds:[]},{Utils:Bt}=u;class ln extends D.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("profile",cn)}async requestProfiles(e){const{storage:t}=this.game,s=t.getStorageData("profile","profileIds"),n=Bt.Array.difference(e,s);if(n.length<1)return;const a=await on({playerIds:n});if(!this.validateProfilesResponse(a))return;const o=this.convertToProfiles(a);t.setStorageData("profile","profiles",o),t.setStorageData("profile","profileIds",[...s,...n])}getProfile(e){return this.getProfiles()[e]??null}getProfiles(){const{storage:e}=this.game;return e.getStorageData("profile","profiles")}getProfileIds(){const{storage:e}=this.game;return e.getStorageData("profile","profileIds")}validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}convertToProfiles(e){const t={};return e.forEach(s=>{Bt.Object.hasOwn(s,"playerId")&&typeof s.playerId=="string"&&(t[s.playerId]=new rn(s).toObject())}),t}}const{Utils:Ut}=u;class hn extends D.Plugins.BasePlugin{constructor(t){super(t);l(this,"storages");this.storages={}}addStorage(t,s){this.storages[t]=s}setStorageData(t,s,n){const a=this.getStorageData(t,s);let o=a;Ut.Valid.isObject(n)?o=Ut.Object.merge(a,n):o=n,this.storages[t][s]=o}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}}const dn={score:"score",settings:"settings",gameData:"gameData",userGuideDisplays:"userGuideDisplays"};class un{constructor(e,t,s){l(this,"contextId");l(this,"contextType");l(this,"entryPointData");this.contextId=e||ot.contextId,this.contextType=t||ot.contextType,this.entryPointData=s||ot.entryPointData}toObject(){return{contextId:this.contextId,contextType:this.contextType,entryPointData:this.entryPointData}}}const{Object:Ht,Valid:Gt}=u.Utils;class Vt{constructor(e){l(this,"level");l(this,"coins");l(this,"otherData");this.initDefaultData(),this.otherData=e,Ht.hasOwn(e,"level")&&Gt.isNumber(e.level)&&(this.level=e.level),Ht.hasOwn(e,"coins")&&Gt.isNumber(e.coins)&&(this.coins=e.coins)}initDefaultData(){this.level=0,this.coins=0,this.otherData={}}toObject(){return{...this.otherData,level:this.level,coins:this.coins}}}const{sound:pn,music:yn,vibrate:gn,language:fn}=re.data.settings,{Object:Z,Valid:tt}=u.Utils;class $t{constructor(e){l(this,"sound");l(this,"music");l(this,"vibrate");l(this,"language");this.initDefaultData(),Z.hasOwn(e,"sound")&&tt.isBoolean(e.sound)&&(this.sound=e.sound),Z.hasOwn(e,"music")&&tt.isBoolean(e.music)&&(this.music=e.music),Z.hasOwn(e,"vibrate")&&tt.isBoolean(e.vibrate)&&(this.vibrate=e.vibrate),Z.hasOwn(e,"language")&&tt.isString(e.language)&&(this.language=e.language)}initDefaultData(){this.sound=pn,this.music=yn,this.vibrate=gn,this.language=fn}toObject(){return{sound:this.sound,music:this.music,vibrate:this.vibrate,language:this.language}}}const{Object:et,Valid:st}=u.Utils;class wn{constructor(e){l(this,"score");l(this,"settings");l(this,"gameData");l(this,"userGuideDisplays");this.initDefaultData(),et.hasOwn(e,"score")&&st.isNumber(e.score)&&(this.score=e.score),et.hasOwn(e,"settings")&&st.isObject(e.settings)&&(this.settings=new $t(e.settings).toObject()),et.hasOwn(e,"gameData")&&st.isObject(e.gameData)&&(this.gameData=new Vt(e.gameData).toObject()),et.hasOwn(e,"userGuideDisplays")&&st.isNumber(e.userGuideDisplays)&&(this.userGuideDisplays=e.userGuideDisplays)}initDefaultData(){this.score=0,this.settings=new $t({}).toObject(),this.gameData=new Vt({}).toObject(),this.userGuideDisplays=0}toObject(){return{score:this.score,settings:this.settings,gameData:this.gameData,userGuideDisplays:this.userGuideDisplays}}}class mn{constructor(e){l(this,"game");l(this,"initContext",()=>{const e=window.FBInstant.context.getID(),t=window.FBInstant.context.getType(),s=window.FBInstant.getEntryPointData(),n=new un(e,t,s),{contextId:a,contextType:o,entryPointData:r}=n.toObject();this.game.context.receiveContext(a,o,r)});l(this,"initPlayer",async()=>{const{player:e}=this.game,t=this.getPlayerInfo(),s=Object.values(dn),n=await FBInstant.player.getDataAsync(s),a=new wn(n).toObject();e.receiveData(t,a)});l(this,"getPlayerInfo",()=>{try{const e=window.FBInstant.player.getID();let t=window.FBInstant.player.getName();const s=window.FBInstant.player.getPhoto(),n=window.FBInstant.getLocale();if(!u.Utils.Valid.isString(e))throw new A;return u.Utils.Valid.isString(t)||(t="You"),new xt({playerId:e,name:t,photo:s,locale:n}).toObject()}catch{return H}});this.game=e}}const{Status:T,Types:nt,AdError:at,AdInstance:An}=u.Plugins.Ads;class kt extends An{constructor(t,s){super(t,s);l(this,"instance");this.instance=null}async loadAsync(){if(this.status!==T.IDLE)throw new at("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new at("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.status=T.LOADING,await this.instance.loadAsync(),this.status=T.FILLED}catch(t){throw this.status=T.IDLE,t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),t}}async showAsync(){if(this.status!==T.FILLED)throw new at("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new at("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");try{this.status=T.SHOWING,await this.instance.showAsync(),this.status=T.IDLE,this.instance=null,this.type===nt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),this.type===nt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()}catch(t){throw this.status=T.FILLED,t instanceof Object&&"code"in t&&(["ADS_NOT_LOADED"].includes(`${t.code}`)&&(this.status=T.IDLE),["USER_INPUT","INVALID_PARAM","INVALID_OPERATION"].includes(`${t.code}`)&&(this.status=T.IDLE,this.instance=null)),self.game.analytics.showAdFail(this.type,t),t}}async createInstanceByType(t){switch(t){case nt.REWARDED_VIDEO:return await FBInstant.getRewardedVideoAsync(this.placementId);case nt.INTERSTITIAL:return await FBInstant.getInterstitialAdAsync(this.placementId);default:return null}}}class In extends Jt{async loadAsync(){return Promise.reject("Unsupported method")}async showAsync(){return Promise.reject("This method is not implemented")}async hideAsync(){return Promise.reject("This method is not implemented")}}class Pn extends In{async showAsync(){FBInstant.getSupportedAPIs().indexOf("loadBannerAdAsync")===-1&&Promise.reject("Unsupported method"),await FBInstant.loadBannerAdAsync(this.placementId)}async hideAsync(){FBInstant.getSupportedAPIs().indexOf("hideBannerAdAsync")===-1&&Promise.reject("Unsupported method"),await FBInstant.hideBannerAdAsync()}}const{BaseAnalytics:xn,Events:O}=u.Plugins.Analytics,Dn=[O.BUTTON_CLICK,O.SCREEN_OPEN];class Nn extends xn{constructor(e,t){super("FacebookAnalytics",{...t},"#0F52BA");const{consoleLog:s}=t;this.selfLog=!!s}processEvent(e,t,s){if(Dn.includes(e))return;const n=this.formatEventName(e),a={};Object.keys(t||{}).map(o=>{t&&typeof t[o]=="string"&&(a[o]=t[o])}),FBInstant.logEvent(n,s,a)}processPageView(e){this.processEvent(O.SCREEN_OPEN,{screen_name:e})}processLevelStart(e,t,s){this.processEvent(O.LEVEL_START,{level:e,score:t,level_name:s})}processLevelRescue(e,t,s){this.processEvent(O.LEVEL_RESCUE,{level:e,score:t,level_name:s})}processLevelFail(e,t,s){this.processEvent(O.LEVEL_END,{level:e,score:t,level_name:s,success:!1})}processLevelComplete(e,t,s){this.processEvent(O.LEVEL_END,{level:e,score:t,level_name:s,success:!0})}processShowInterstitialAd(e){this.processEvent(O.AD_SHOW,{ad_type:"interstitial",screen_name:`${e}`})}processShowRewardedVideoAd(e){this.processEvent(O.AD_SHOW,{ad_type:"rewarded_video",screen_name:`${e}`})}processShowAdFail(e,t){this.processEvent(O.AD_SHOW_FAILED,{ad_type:e,screen_name:`${t}`})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}}const bn="production",En="null",Cn="0";class Sn extends D.Game{constructor(){super(...arguments);l(this,"ads");l(this,"auth");l(this,"audio");l(this,"match");l(this,"event");l(this,"player");l(this,"profile");l(this,"context");l(this,"storage");l(this,"analytics");l(this,"leaderboard");l(this,"frameCapture");l(this,"monitorError");l(this,"console");l(this,"profiler");l(this,"initMonitorError",()=>{const{MonitorError:t}=u.Configs.Debugger;t.Enable&&(this.monitorError.configure({accessToken:En,payload:{environment:bn,client:{javascript:{code_version:`${Cn}`}}}}),this.monitorError.setFilterError(t.FilterError))});l(this,"processAfterSyncProfile",()=>{const{Notification:t}=u.Configs;t.Enable&&(this.updatePlayerProfileToNotificationService(),this.sendFirstNotification())})}async boot(){super.boot(),this.addPlugins(),this.addMonitorPlugin().then(this.initMonitorError),this.addDevPlugins().then(()=>{this.initConsole(),this.initProfilerPlugin()}),this.initEventPlugin(),this.initMatchPlugin(),await this.initAds()}async start(){super.start(),await this.auth.requestToken(),await this.initState(),this.processPlayerProfile(),await this.context.detectContextSessionType(),this.context.detectContextGameMode(),this.initGoogleAnalytics(),this.initFacebookAnalytics(),this.event.emit(u.Events.CORE_READY)}testLWZUtils(){const{Hash:t,String:s}=u.Utils,n="Blumen thal Blumen thal Blumen thal Blumenthal",a=s.findDuplicateSubstrings(n),o={};for(const y of a){const g=Object.keys(o).length;o[y]=g+1}let r=t.lwzCompress(n,o),c=t.lwzDecompress(r,o);const h=r.join(" "),d=s.findDuplicateSubstrings(h),p={};for(const y of d){const g=Object.keys(p).length;p[y]=g+1}r=t.lwzCompress(h,p,2),c=t.lwzDecompress(r,p,2),r=c.split(" ").map(y=>Number.parseInt(y)),c=t.lwzDecompress(r,o)}addPlugins(){this.plugins.install("Storage",hn,!0,"storage"),this.storage=this.plugins.get("Storage"),this.plugins.install("Ads",xe,!0,"ads"),this.plugins.install("Auth",Me,!0,"auth"),this.plugins.install("Audio",Ce,!0,"audio"),this.plugins.install("Match",Ys,!0,"match"),this.plugins.install("Event",Be,!0,"event"),this.plugins.install("Player",sn,!0,"player"),this.plugins.install("Profile",ln,!0,"profile"),this.plugins.install("Context",Fe,!0,"context"),this.plugins.install("Language",$e,!0,"language"),this.plugins.install("Analytics",Ne,!0,"analytics"),this.plugins.install("Leaderboard",We,!0,"leaderboard"),this.plugins.install("FrameCapture",Ve,!0,"frameCapture"),this.ads=this.plugins.get("Ads"),this.auth=this.plugins.get("Auth"),this.audio=this.plugins.get("Audio"),this.match=this.plugins.get("Match"),this.event=this.plugins.get("Event"),this.player=this.plugins.get("Player"),this.profile=this.plugins.get("Profile"),this.context=this.plugins.get("Context"),this.language=this.plugins.get("Language"),this.analytics=this.plugins.get("Analytics"),this.leaderboard=this.plugins.get("Leaderboard"),this.frameCapture=this.plugins.get("FrameCapture")}async addMonitorPlugin(){const{MonitorError:t}=u.Configs.Debugger;if(!t.Enable)return;const s=(await W(()=>import("./bundle/monitor.js"),["./bundle\\monitor.js","./bundle\\core.js","./bundle\\vendor.js","./bundle\\__commonjsHelpers__.js"],import.meta.url)).default;this.plugins.install("MonitorError",s,!0,"monitorError"),this.monitorError=this.plugins.get("MonitorError")}async addDevPlugins(){if(!u.Utils.Valid.isDebugger())return;const t=(await W(()=>import("./bundle/console.js"),["./bundle\\console.js","./bundle\\core.js","./bundle\\vendor.js","./bundle\\__commonjsHelpers__.js"],import.meta.url)).default,s=(await W(()=>import("./bundle/profiler.js"),["./bundle\\profiler.js","./bundle\\core.js","./bundle\\vendor.js","./bundle\\__commonjsHelpers__.js"],import.meta.url)).default;this.plugins.install("Console",t,!0,"console"),this.plugins.install("Profiler",s,!0,"profiler"),this.console=this.plugins.get("Console"),this.profiler=this.plugins.get("Profiler")}initEventPlugin(){const{EventLogging:t}=u.Configs.Debugger;t&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}async initAds(){const{Configs:t,Plugins:s}=u,{Ads:n}=s;this.ads.configure(t.Ads),t.Mockup.Ads.Enable?await this.initMockAdsInstance(n,t):this.initAdInstance(n,t)}initAdInstance(t,s){this.ads.setAdInstance(t.Types.BANNER,s.Ads.BannerPlacementId,Pn),this.ads.setAdInstance(t.Types.INTERSTITIAL,s.Ads.InterstitialPlacementId,kt),this.ads.setAdInstance(t.Types.REWARDED_VIDEO,s.Ads.VideoRewardsPlacementId,kt)}async initMockAdsInstance(t,s){const n=(await W(()=>import("./bundle/MockAdInstance.js"),["./bundle\\MockAdInstance.js","./bundle\\core.js","./bundle\\vendor.js","./bundle\\__commonjsHelpers__.js"],import.meta.url)).default,a=(await W(()=>import("./bundle/MockBannerInstance.js"),["./bundle\\MockBannerInstance.js","./bundle\\core.js","./bundle\\vendor.js","./bundle\\__commonjsHelpers__.js"],import.meta.url)).default;this.ads.setAdInstance(t.Types.BANNER,s.Ads.BannerPlacementId,a),this.ads.setAdInstance(t.Types.INTERSTITIAL,s.Ads.InterstitialPlacementId,n),this.ads.setAdInstance(t.Types.REWARDED_VIDEO,s.Ads.VideoRewardsPlacementId,n)}async initState(){try{const t=new mn(this);t.initContext(),await t.initPlayer()}catch{}}initConsole(){if(!u.Utils.Valid.isDebugger())return;const{ShowConsole:t}=u.Configs.Debugger;t&&this.console.configure()}initProfilerPlugin(){if(!u.Utils.Valid.isDebugger())return;const{ShowProfiler:t}=u.Configs.Debugger;t&&this.profiler.configure()}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch{}}updatePlayerProfileToNotificationService(){const{AppId:t}=u.Configs,s=this.player.getPlayer(),{ASID:n,playerId:a,name:o,photo:r,locale:c}=s;Ie({appId:t,ASID:n,playerId:a,name:o,photo:r,locale:c})}async sendFirstNotification(){try{if(!this.player.getPlayerIsNew())return;const s=this.player.getPlayerASID();if(!s)return;const n=await FBInstant.player.getDataAsync(["isNotificationFirstSent"])||{},{isNotificationFirstSent:a}=n;if(a===!0)return;const{Facebook:o}=u.Utils;await o.sendNotification({message:`Hi @[${s}] your friends are waiting to play with you, play now!`,delayTime:3600}),FBInstant.player.setDataAsync({isNotificationFirstSent:!0})}catch{}}initGoogleAnalytics(){}initFacebookAnalytics(){const{prefix:t,consoleLog:s}=u.Configs.Analytics.FacebookAnalytics||{};typeof t=="string"&&this.analytics.add(new Nn(this.game,{prefix:t,consoleLog:s}))}}const Mn=async()=>{try{const i=new Sn;window.game=i,de(window,"game"),window.__sdkLoadingCount<30&&(window.__sdkLoadingCount=30),window.__gameCoreReady=!0,await i.boot(),i.start(),window.__sdkLoadingCount<35&&(window.__sdkLoadingCount=35)}catch{}},Tn=()=>{const i=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(i),window.__sdkLoadingCount<20&&(window.__sdkLoadingCount=20);try{gtag("event","app_initialize",{send_to:["GA"]})}catch{}On().catch(t=>{}).finally(()=>{Mn()})},50)};Tn();const On=async()=>{const{RemoteConfig:i}=window.GameCore.Configs,{Firebase:e,API:t}=i,{RemoteConfig:s}=window.GameCore.Utils;if(e.enabled)return s.initializeConfigWithFirebase();if(t.enabled)return s.initializeConfigWithAPI()};export{kt as F,Pn as a};
