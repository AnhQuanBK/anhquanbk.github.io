import"./engine.js";const El=(n,e=1)=>Array.from({length:Math.ceil(n.length/e)},(t,s)=>n.slice(s*e,s*e+e)),fl=(n,e)=>n.filter(t=>!e.includes(t)),ml=n=>{for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}},Al=(n,e,t)=>t.indexOf(n)===e&&n!==null&&n!==void 0,Sl=n=>n.filter(Al),Tl={chunk:El,difference:fl,shuffle:ml,unique:Sl};var yl={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},Cl=Array.prototype.slice;function vs(n){var e=n.length;return e?e===1?[n[0]]:e===2?[n[0],n[1]]:e===3?[n[0],n[1],n[2]]:Cl.call(n,0):[]}function Il(n){var e={};for(var t in n)yl[t]||(e[t]=n[t]);return e}function Rl(n){return typeof n=="function"&&n.isMemoized}function _l(n,e){return n===e||n!==n&&e!==e}function kn(n,e){var t={};for(var s in n)t[s]=n[s];for(var s in e)t[s]=e[s];return t}var Ll=function(){function n(e){this.keys=[],this.values=[],this.options=e;var t=typeof e.isMatchingKey=="function";t?this.getKeyIndex=this._getKeyIndexFromMatchingKey:e.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey=typeof e.transformKey=="function",this.shouldCloneArguments=this.canTransformKey||t,this.shouldUpdateOnAdd=typeof e.onCacheAdd=="function",this.shouldUpdateOnChange=typeof e.onCacheChange=="function",this.shouldUpdateOnHit=typeof e.onCacheHit=="function"}return Object.defineProperty(n.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"snapshot",{get:function(){return{keys:vs(this.keys),size:this.size,values:vs(this.values)}},enumerable:!1,configurable:!0}),n.prototype._getKeyIndexFromMatchingKey=function(e){var t=this.options,s=t.isMatchingKey,i=t.maxSize,a=this.keys,r=a.length;if(!r)return-1;if(s(a[0],e))return 0;if(i>1){for(var o=1;o<r;o++)if(s(a[o],e))return o}return-1},n.prototype._getKeyIndexForMany=function(e){var t=this.options.isEqual,s=this.keys,i=s.length;if(!i)return-1;if(i===1)return this._getKeyIndexForSingle(e);var a=e.length,r,o;if(a>1){for(var c=0;c<i;c++)if(r=s[c],r.length===a){for(o=0;o<a&&t(r[o],e[o]);o++);if(o===a)return c}}else for(var c=0;c<i;c++)if(r=s[c],r.length===a&&t(r[0],e[0]))return c;return-1},n.prototype._getKeyIndexForSingle=function(e){var t=this.keys;if(!t.length)return-1;var s=t[0],i=s.length;if(e.length!==i)return-1;var a=this.options.isEqual;if(i>1){for(var r=0;r<i;r++)if(!a(s[r],e[r]))return-1;return 0}return a(s[0],e[0])?0:-1},n.prototype.orderByLru=function(e,t,s){for(var i=this.keys,a=this.values,r=i.length,o=s;o--;)i[o+1]=i[o],a[o+1]=a[o];i[0]=e,a[0]=t;var c=this.options.maxSize;r===c&&s===r?(i.pop(),a.pop()):s>=c&&(i.length=a.length=c)},n.prototype.updateAsyncCache=function(e){var t=this,s=this.options,i=s.onCacheChange,a=s.onCacheHit,r=this.keys[0],o=this.values[0];this.values[0]=o.then(function(c){return t.shouldUpdateOnHit&&a(t,t.options,e),t.shouldUpdateOnChange&&i(t,t.options,e),c},function(c){var l=t.getKeyIndex(r);throw l!==-1&&(t.keys.splice(l,1),t.values.splice(l,1)),c})},n}();function rs(n,e){if(e===void 0&&(e={}),Rl(n))return rs(n.fn,kn(n.options,e));if(typeof n!="function")throw new TypeError("You must pass a function to `memoize`.");var t=e.isEqual,s=t===void 0?_l:t,i=e.isMatchingKey,a=e.isPromise,r=a===void 0?!1:a,o=e.maxSize,c=o===void 0?1:o,l=e.onCacheAdd,h=e.onCacheChange,u=e.onCacheHit,p=e.transformKey,g=kn({isEqual:s,isMatchingKey:i,isPromise:r,maxSize:c,onCacheAdd:l,onCacheChange:h,onCacheHit:u,transformKey:p},Il(e)),S=new Ll(g),f=S.keys,T=S.values,A=S.canTransformKey,m=S.shouldCloneArguments,C=S.shouldUpdateOnAdd,O=S.shouldUpdateOnChange,U=S.shouldUpdateOnHit,Y=function(){var z=m?vs(arguments):arguments;A&&(z=p(z));var Ae=f.length?S.getKeyIndex(z):-1;if(Ae!==-1)U&&u(S,g,Y),Ae&&(S.orderByLru(f[Ae],T[Ae],Ae),O&&h(S,g,Y));else{var ie=n.apply(this,arguments),Le=m?z:vs(arguments);S.orderByLru(Le,ie,f.length),r&&S.updateAsyncCache(Y),C&&l(S,g,Y),O&&h(S,g,Y)}return T[0]};return Y.cache=S,Y.fn=n,Y.isMemoized=!0,Y.options=g,Y}const wl=rs((n,e)=>{if(typeof n=="string"){const t=e[n.toLowerCase()];if(typeof t=="string")return t}return"?"}),Pl=rs(n=>{let e=null;const t=[],s=/:([A-Z0-9?]+)/gm;for(;(e=s.exec(n))!==null;)t.push(e[1]);return t}),Ol=rs(n=>{let e=null;const t=[],s=/([0-9]+[A-Z?]{1}|[A-Z?]{1})/gm;for(;(e=s.exec(n))!==null;){const i=e[0];if(i.length>=2){const{length:a}=i,r=i.slice(0,a-1),o=i[a-1],c=new Array(+r).fill(o);t.push(...c);continue}t.push(i)}return t}),Dl=(n,e)=>{const t=n,s=GameCore.Utils.Object.invert(e),i={};let a=0,r=0;return Pl(t).forEach(c=>{a=0,r++,i[r]||(i[r]={}),Ol(c).forEach(h=>{a++,i[r][a]=wl(h,s)})}),i},vl=rs((n,e)=>{const t=e[n];return typeof t=="string"?`${t.toUpperCase()}`:"?"}),to=(n,e,t=!1)=>{let s="";if(!GameCore.Utils.Valid.isObject(n))return s;let i="",a=1;for(const r in n){if(!GameCore.Utils.Object.hasOwn(n,r))continue;const o=n[r];if(GameCore.Utils.Valid.isObject(o)){s+=`:${to(o,e,!0)}`;continue}if(!GameCore.Utils.Valid.isString(o))continue;const c=vl(o,e);c===i?(a++,s=s.slice(0,-2)):a=1,s+=`${a}${c}`,i=c}return s=s.replace(/1([A-Z])/g,"$1"),s},Nl=n=>{try{return atob(n)}catch{return""}},bl=n=>{try{return btoa(n)}catch{return""}},Ml={decodeMap:Dl,encodeMap:to,hashToString:Nl,stringToHash:bl},Ul=(n,e)=>{const t=document.createElement("style"),s=Object.keys(e).map(i=>kl(i,e[i])).join(";");return t.innerHTML=`${n} { ${s} }`,document.head.appendChild(t),t},kl=(n,e)=>`${GameCore.Utils.String.toKebabCase(n)}: ${e}`,Bl={dynamicCSS:Ul},so=n=>{try{return JSON.parse(n)}catch{return null}},io=n=>{try{return JSON.stringify(n,null,0)}catch{return""}},xl=n=>so(io(n)),Fl={clone:xl,decode:so,encode:io},Fi=n=>{const e=typeof n=="object"||typeof n=="function",t=Array.isArray(n);return n!==null&&e&&!t},Gl=n=>n==null,no=n=>{if(!Fi(n))return n;for(const e in n){Gl(n[e])&&delete n[e];const t=n[e];Fi(t)&&(n[e]=no(t))}return n},Ji=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),Hl=n=>{const e={};return Object.keys(n).forEach(t=>{if(!Ji(n,t))return;const s=n[t];typeof s=="string"&&(e[s]=t)}),e},Yl=(n,e)=>{if(!Array.isArray(n))return{};const t={};return n.forEach(s=>{if(!Ji(s,e))return;const i=s[e];typeof i=="string"&&(t[i]=s)}),t},Kl={clear:no,hasOwn:Ji,invert:Hl,keyBy:Yl},Vl=n=>n&&n[0].toUpperCase()+n.slice(1),Wl=n=>{let e=0;if(n.length==0)return e;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return e},$l=n=>Object.keys(n).reduce((t,s)=>{const i=n[s];return i!==void 0&&t.push(`${s}=${i}`),t},[]).join("&"),jl="0123456789ABCDEF",zl=(n="0x")=>{let e=n;for(let t=0;t<6;t++)e+=jl[Math.floor(Math.random()*16)];return e},Xl=n=>n.replace(/^([a-z])|\s+([a-z])/g,(e,t)=>t?t.toUpperCase():e.toUpperCase()).replace(/\s+/g,""),Zl=n=>n.replace(/^([a-z])|\s+([a-z])/g,(e,t)=>t?t.toUpperCase():e.toLowerCase()).replace(/\s+/g,""),ql=n=>n.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase(),Ql=(n,e)=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789*#%&!";let s="",i=n;e!=null&&(i-=e.length,s+=e);for(let a=0;a<i;a++){const r=Math.floor(Math.random()*t.length);s+=t.charAt(r)}return s},Jl=n=>n.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[đĐ]/g,t=>t==="đ"?"d":"D"),eh=(n,e)=>{const t=n.split(" "),i=(t.length<=1?[...t]:[t[0],t.pop()]).join(" "),a=i.lastIndexOf(" ")||0,r=a>=0?a:e;return(i.length>e?i.substring(0,r):i).substring(0,e)},th=(n=16)=>{const e=s=>Math.floor(s).toString(n);return e(Date.now()/1e3)+" ".repeat(n).replace(/./g,()=>e(Math.random()*n))},sh={capitalize:Vl,hashCode:Wl,params:$l,toCamelCase:Zl,toKebabCase:ql,toUpperCamelCase:Xl,randomColor:zl,random:Ql,removeDiacritics:Jl,getShortName:eh,generateObjectId:th},ih=n=>typeof n=="boolean",ao="false";console.log("DEBUG",ao);const nh=()=>ao==="true",ah=n=>typeof n=="function",rh=n=>typeof n=="number"&&!isNaN(n),oh=n=>["string","number","symbol"].indexOf(typeof n)>-1,ch=n=>typeof n=="string",lh=(n,e,t)=>{const{timeout:s=1e3,checkInterval:i=100}=t||{};return new Promise(a=>{const r=setInterval(()=>{const o=typeof n=="function"?n():n,c=typeof e=="function"?e():e;o===c&&(clearInterval(r),a(!0))},i);s>0&&setTimeout(()=>{clearInterval(r),a(!1)},s)})},hh={isBoolean:ih,isDebugger:nh,isFunction:ah,isNumber:rh,isObject:Fi,isPropertyKey:oh,isString:ch,isValueChangeAsync:lh},uh=n=>{const{scene:e,key:t,newKey:s}=n,i=e.textures.get(t).getSourceImage();if(!i)return!1;const a=Math.min(i.width,i.height);s||e.textures.removeKey(t);const r=e.textures.createCanvas(s||t,a,a),o=r.context;return o.beginPath(),o.arc(a/2,a/2,a/2,0,Math.PI*2,!1),o.clip(),r.draw((i.width-a)/2,(i.height-a)/2,i),!0},dh=n=>{const{scene:e,key:t,newKey:s,radius:i}=n;let{width:a,height:r}=n;const o=e.textures.get(t).getSourceImage();if(!o)return!1;a||(a=o.width),r||(r=o.height),s||e.textures.removeKey(t);const c=e.textures.createCanvas(s||t,a,r),l=c.context,u=Math.min(a,r)/100*i/2,p=0,g=0;return l.beginPath(),l.moveTo(p+u,g),l.lineTo(p+a-u,g),l.quadraticCurveTo(p+a,g,p+a,g+u),l.lineTo(p+a,g+r-u),l.quadraticCurveTo(p+a,g+r,p+a-u,g+r),l.lineTo(p+u,g+r),l.quadraticCurveTo(p,g+r,p,g+r-u),l.lineTo(p,g+u),l.quadraticCurveTo(p,g,p+u,g),l.closePath(),l.clip(),c.draw(0,0,o),!0},ph={drawCircle:uh,drawBorder:dh},gh=["","K","M","B","T","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV","AW","AX","AY","AZ","BA","BB","BC","BD","BE","BF","BG","BH","BI","BJ","BK","BL","BM","BN","BO","BP","BQ","BR"],Eh=(n,e)=>{const{fractionalDigits:t=0,startAbbreviate:s=1e3,abbreviateStep:i=3,maxLength:a=-1,removeLastZero:r=!0,suffixes:o=gh}=e||{},c=a===-1?99999999:a;if(n>=s){const p=Math.floor(n/10**i),g=Math.floor((p.toString().length-1)/i)+1,f=(n/(10**i)**g).toFixed(t),T=c-o[g].length,A=f.substring(0,T);return(r?Bn(A):A)+o[g]}const l=n.toFixed(t),h=c-o[0].length,u=l.substring(0,h);return r?Bn(u):u+o[0]},Bn=n=>{if(n.indexOf(".")<0)return n;for(let e=n.length-1;e>=0;e--){if(n[e]==".")return n.substring(0,e);if(n[e]!="0")return n.substring(0,e+1)}return n},fh=(n,e,t="0")=>{let s=n.toString();const i=s.length;for(let a=0;a<e-i;a++)s=t+s;return s},mh=(n,e,t="0")=>{let s=n.toString();const i=s.length;for(let a=0;a<e-i;a++)s=s+t;return s},Ah={toAbbreviatedString:Eh,padStart:fh,padEnd:mh},Sh=()=>{const n=navigator.userAgent;return/Windows|Mac OS/i.test(n)&&!/like Mac OS/.test(n)},Th=()=>{const n=navigator.userAgent;return/Android|iP[ao]d|iPhone/i.test(n)},yh=()=>FBInstant.getPlatform()==="ANDROID",Ch=()=>FBInstant.getPlatform()==="IOS",Ih=()=>FBInstant.getPlatform()==="MOBILE_WEB",Rh=()=>Math.round(window.devicePixelRatio)||1,_h={isDesktop:Sh,isMobile:Th,isAndroid:yh,isIOS:Ch,isMobileWeb:Ih,pixelRatio:Rh},ro={Array:Tl,Hash:Ml,Html:Bl,Json:Fl,Object:Kl,String:sh,Valid:hh,Image:ph,Number:Ah,Device:_h};function oo(n){return Object.prototype.toString.call(n).slice(8,-1)}function ms(n){if(oo(n)!=="Object")return!1;const e=Object.getPrototypeOf(n);return e.constructor===Object&&e===Object.prototype}function xn(n){return oo(n)==="Symbol"}function Fn(n,e,t,s){const i={}.propertyIsEnumerable.call(s,e)?"enumerable":"nonenumerable";i==="enumerable"&&(n[e]=t),i==="nonenumerable"&&Object.defineProperty(n,e,{value:t,enumerable:!1,writable:!0,configurable:!0})}function co(n,e,t){if(!ms(e))return e;let s={};if(ms(n)){const o=Object.getOwnPropertyNames(n),c=Object.getOwnPropertySymbols(n);s=[...o,...c].reduce((l,h)=>{const u=n[h];return(!xn(h)&&!Object.getOwnPropertyNames(e).includes(h)||xn(h)&&!Object.getOwnPropertySymbols(e).includes(h))&&Fn(l,h,u,n),l},{})}const i=Object.getOwnPropertyNames(e),a=Object.getOwnPropertySymbols(e);return[...i,...a].reduce((o,c)=>{let l=e[c];const h=ms(n)?n[c]:void 0;h!==void 0&&ms(l)&&(l=co(h,l,t));const u=t?t(h,l,c):l;return Fn(o,c,u,e),o},s)}function Ie(n,...e){return e.reduce((t,s)=>co(t,s),n)}const lo=2,Lh=1920/lo,wh=1080/lo,Ph=530,Gn=Lh-Ph,Hn=wh,Oh={ENV:"development",AppId:"195590",ApiHost:"",OtherHost:"",Notification:{Enable:!0,DisableSendNotification:!0,ApiUrl:"https://nostra-notifications.suncs.io",GameTitle:"Sun Studio",GameImage:""},PlayerMock:{id:"",signature:""},OpponentMock:{id:"",signature:""},MatchMockFailRate:5,Gameplay:{StartLevel:1,StartCoins:6,DelayFinishGame:1700,HintWaitTime:5e3,Powers:{FreeCoins:{enable:!0,duration:1e3*60*3},SpeedUp:{enable:!0,modifier:2}},MaxLevel:1598,MaximumMeleeLevel:11,MaximumRangedLevel:11,CheaterIds:[],ChallengeFriends:{activePerLevel:2,maxActiveCount:1}},Tutorial:{ForceUseTutorial:!1,NumberOfTutorial:{GuideOne:1,GuideTwo:1,GuidePrevent:-1,GuideThree:1}},PlayerDataStore:"PlayerData.PopJewels",Game:{AutoResize:!0,PortraitRatio:320/518,PortraitWidth:375,PortraitHeight:667,LandscapeRatio:Gn/Hn,LandscapeWidth:Gn,LandscapeHeight:Hn,ForcePixelRatio:0,DisableLandscape:!0,FullSizeOnLandscape:!1},Debugger:{ShowInspector:!1,ShowMonitoring:!1,ShowConsole:!1,Expanded:!1,AutoRefresh:!0,InspectorAutoUpdate:!0,Opacity:.8},Statistics:{Enable:!1,DisplayMode:0,FPS:!0,MS:!0,MB:!0,Opacity:.8,ShowFPSInGame:!0,ShowMemoryInGame:!1},ParticleEditor:{Enable:!1,Opacity:.8,Expanded:!0},LevelBuilder:{Enable:!1,Opacity:.8,Expanded:!1},OfflineReward:{Enable:!0,ValuePerMinute:1,MinimumTimeToActive:1*60*60*1e3,LevelScalingModifier:1.12},ProfilerPlugin:{Enable:!1},Match:{MaxRescueCount:1,RescueGamePopupTimeout:15,ContinueSingleMatchEnabled:!1,SingleMatchStore:"singleMatch",LocalSingleMatchDefault:{_id:"12345678890",status:"open",playerId:"",score:0,level:1,startedAt:0,updateAt:0,finishAt:0,data:{}}},DailyRewards:{MaxDays:6,MockTime:0,CheckInterrupt:!0},DailyTasks:{Duration:86400},Tournament:{UseMock:!1,ForcePlay:!1,UseLeaderboard:!1,TournamentContextIds:[]},Battle:{UseMock:!1,RankingDevTest:!1},LeadersBoard:{Name:null,UseMock:!1,Prefix:"leaderboards",LeaderboardId:"",Limit:50},EnableEffectSceneTransition:!1,Ads:{Enabled:!0,CalculateSafeAreaBottom:!0,EnableRewardVideoResetInterstitial:!1,Mockup:{Enable:!1,ErrorRate:5,GiphyApiKey:""},InterstitialAdOptions:{pID:"",showWhenStartGame:!1,secondsFirstTime:45,secondsBetweenAds:90},RewardAdOptions:{pID:"",secondsFirstTime:0,secondsBetweenAds:0},BannerAdOptions:[{placementId:"1",bannerHeight:50,platform:"MOBILE",secondsReload:0},{placementId:"2",bannerHeight:50,platform:"DESKTOP",secondsReload:0}]},Network:{MaximumRequest:6,Timeout:15e3,Retries:3},Analytics:{GoogleAnalytics:{consoleLog:!1},FacebookAnalytics:null},Sentry:{errorCodes:{accepted:[],ignored:["USER_INPUT","NETWORK_FAILURE"]},errorMessages:{accepted:[],ignored:["Load image failed","Request failed to be processed","Failed to fetch","reading 'renderList'","reading 'skeletonData'"]}},Rollbar:{Enable:!1,UseMockup:!1,FilterError:{Codes:{accepted:[],ignored:["USER_INPUT","NETWORK_FAILURE"]},Messages:{accepted:[],ignored:["Load image failed","Request failed to be processed","Failed to fetch","reading 'renderList'","reading 'skeletonData'"]}},ListPlayerDevIds:[]},UnitsConfig:{MELEE:{listLevelsUseSprite:[]},RANGED:{listLevelsUseSprite:[]}},Performance:{Enable:!1,trackingSceneKeys:["DASHBOARD_SCENE","GAME_SCENE"],minQuality:1,maxQuality:2,fpsThreshold:48,checkInterval:2e3,qualityAdjustStep:.1,autoUpgradeQuality:!0,onlyUpdateWhenSwitchScene:!0}},Dh={AppId:"527305895544198",Game:{},Ads:{Enabled:!1,InterstitialAdOptions:{showWhenStartGame:!0,secondsFirstTime:0,secondsBetweenAds:0},Mockup:{Enable:!0,ErrorRate:5,GiphyApiKey:"VmjHIRsfrwCAssDS4mDo9DoImxJm1lLM"},BannerAdOptions:[{placementId:"1",bannerHeight:80,platform:"MOBILE",secondsReload:50},{placementId:"2",bannerHeight:80,platform:"DESKTOP",secondsReload:70}]},ParticleEditor:{Enable:!1,Expanded:!1},Debugger:{ShowMonitoring:!1,ShowInspector:!1},Statistics:{Enable:!1,ShowFPSInGame:!1}},vh={ENV:"development",Notification:{Enable:!1},Ads:{Enabled:!0,Mockup:{Enable:!1,ErrorRate:5,GiphyApiKey:"VmjHIRsfrwCAssDS4mDo9DoImxJm1lLM"},RewardAdOptions:{pID:"123"},InterstitialAdOptions:{pID:"456"},BannerAdOptions:[{placementId:"789",bannerHeight:50,platform:"MOBILE",secondsReload:0},{placementId:"012",bannerHeight:50,platform:"DESKTOP",secondsReload:0}]},Analytics:{GoogleAnalytics:null},Statistics:{ShowFPSInGame:!0},Tournament:{UseMock:!0},Battle:{UseMock:!0}},ho=2,Nh=1920/ho,bh=1080/ho,Mh=530,Yn=Nh-Mh,Kn=bh,Uh={Game:{LandscapeRatio:Yn/Kn,LandscapeWidth:Yn,LandscapeHeight:Kn,ForcePixelRatio:0},Rollbar:{Enable:!1},Ads:{Enabled:!0},Analytics:{FacebookAnalytics:{}}},kh={ENV:"production",ApiHost:"",OtherHost:"",Notification:{Enable:!1,GameTitle:"Dinosaur Merge Master",GameImage:"https://static-tt.citigo.site/fbig-singleplay-apps/dino-merge-master.jpg"},LeadersBoard:{Prefix:"leaderboards",LeaderboardId:""},Debugger:{ShowConsole:!1,ShowInspector:!1,ShowMonitoring:!1},Statistics:{Enable:!1,ShowFPSInGame:!1,ShowMemoryInGame:!1},Ads:{Enabled:!0,Mockup:{Enable:!1}}};let Ue=Oh;const Bh="production";switch(Bh){case"development":Ue=Ie({...Ue},vh),Ue=Ie({...Ue},Dh);break;case"production":Ue=Ie({...Ue},kh),Ue=Ie({...Ue},Uh);break}window._forcePixelRatio!=null&&(Ue.Game.ForcePixelRatio=window._forcePixelRatio);const uo=Ue,xh=n=>e=>{try{const{game:t}=window,{module:s}=e;if(!t.scene.getScenes(!0).find(o=>o.scene.key===n))return;const r=s.default;t.scene.remove(n),t.scene.add(n,r,!0),t.scene.bringToTop(t.globalScene),console.log("%c HotScene: ",n)}catch{}};function os(n,e,t){var s,i,a;e===void 0&&(e=50),t===void 0&&(t={});var r=(s=t.isImmediate)!=null&&s,o=(i=t.callback)!=null&&i,c=t.maxWait,l=Date.now(),h=[];function u(){if(c!==void 0){var g=Date.now()-l;if(g+e>=c)return c-g}return e}var p=function(){var g=[].slice.call(arguments),S=this;return new Promise(function(f,T){var A=r&&a===void 0;if(a!==void 0&&clearTimeout(a),a=setTimeout(function(){if(a=void 0,l=Date.now(),!r){var C=n.apply(S,g);o&&o(C),h.forEach(function(O){return(0,O.resolve)(C)}),h=[]}},u()),A){var m=n.apply(S,g);return o&&o(m),f(m)}h.push({resolve:f,reject:T})})};return p.cancel=function(g){a!==void 0&&clearTimeout(a),h.forEach(function(S){return(0,S.reject)(g)}),h=[]},p}let Mt=!1;const Fh=(n,e=Mt)=>t=>{try{const{game:s}=window,{module:i}=t;Mt=e;const r=s.scene.getScenes(!0).find(h=>h.scene.key===n);if(!r)return;const o=i.default,c=`${n}-draft`;s.scene.remove(c);const l=s.scene.add(c,o);Mt&&console.log("HotSceneObjects: ",n,l),l.events.once(Phaser.Scenes.Events.RENDER,os(()=>{const h=l.children.getAll();po(r,h),s.scene.remove(c)}),50),s.scene.run(c),s.scene.bringToTop(r),s.scene.bringToTop(s.globalScene)}catch(s){console.warn(s)}},po=(n,e,t)=>{e.forEach(s=>{if(!s.name)return;let i=null;if(t?i=t.getByName(s.name):i=n.children.getByName(s.name),Mt&&console.log("Checking object: ",s.name,s.type),!i)return;if(s.type==="Container"){const c=s,l=i,h=c.getAll();if(po(n,h,l),l.freezeContainer)return;console.log("%c Update container: ",l.name)}const a=Reflect.ownKeys(s),r=["_events","_sysEvents","input","localTransform","list","displayList","frame"],o=a.filter(c=>{if(typeof c!="string"||r.indexOf(c)>=0||!i)return!1;const l=Reflect.get(s,c);if(l instanceof Function||l instanceof Phaser.Scene||l instanceof Phaser.GameObjects.Group||l instanceof Phaser.GameObjects.GameObject)return!1;const h=Reflect.get(i,c);return l!==h});o.length<1||(Mt&&console.log("HotObject: ",s.name,o),o.forEach(c=>{if(!i)return;const l=Reflect.get(s,c),h=Reflect.get(i,c),u=Reflect.set(i,c,l);Mt&&console.log("Update property: ",u,c,{oldValue:h,newValue:l})}))})},Gh={Scene:xh,SceneObjects:Fh},Hh={Configs:uo,Utils:ro,LiveUpdate:Gh};window.GameCore=Hh;const Yh="production";console.warn(Yh,{Configs:uo,isDebugger:ro.Valid.isDebugger()});const Kh="modulepreload",Vh=function(n,e){return new URL(n,e).href},Vn={},je=function(e,t,s){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=Vh(a,s),a in Vn)return;Vn[a]=!0;const r=a.endsWith(".css"),o=r?'[rel="stylesheet"]':"";if(!!s)for(let h=i.length-1;h>=0;h--){const u=i[h];if(u.href===a&&(!r||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${o}`))return;const l=document.createElement("link");if(l.rel=r?"stylesheet":Kh,r||(l.as="script",l.crossOrigin=""),l.href=a,document.head.appendChild(l),r)return new Promise((h,u)=>{l.addEventListener("load",h),l.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e())},v={BUTTON_CLICK:"button_click",SCREEN_OPEN:"screen_open",LOAD_START:"load_start",LOAD_COMPLETE:"load_complete",APP_READY:"app_ready",TUTORIAL_BEGIN:"tutorial_begin",TUTORIAL_STEP:"tutorial_step",TUTORIAL_COMPLETE:"tutorial_complete",MATCH_START:"match_start",MATCH_RESCUE:"match_rescue",MATCH_END:"match_end",LEVEL_START:"level_start",LEVEL_RESCUE:"level_rescue",LEVEL_END:"level_end",SHARE:"share",MESSAGE:"message",INVITE:"invite",SHORTCUT_CREATE:"shortcut_create",SHORTCUT_CREATE_POPUP:"shortcut_create_popup",BOT_SUBSCRIBE:"bot_subscribe",BOT_SUBSCRIBE_POPUP:"bot_subscribe_popup",AD_SHOW:"ad_show",AD_SHOW_FAILED:"ad_show_failed",NEW_USER:"new_user",AD_IMPRESSION:"ad_impression",JOIN_GROUP:"join_group",EARN_UNIT:"earn_unit",USE_ITEM:"use_item",TOURNAMENT_SHARE:"tournament_share",TOURNAMENT_CREATE:"tournament_create",TOURNAMENT_POST_SCORE:"tournament_post_score",GLANCE_GAME_LOAD:"game_load",GLANCE_GAME_START:"game_start",GLANCE_GAME_REPLAY:"game_replay",GLANCE_GAME_LEVEL:"game_level",GLANCE_GAME_END:"game_end",GLANCE_GAME_LEVEL_COMPLETED:"level_completed",GLANCE_REWARDED_AD:"rewarded_ad",GLANCE_GAME_MILESTONE:"game_milestone",GLANCE_GAME_LIFE_END:"game_life_end",GLANCE_INGAME_TRANSACTIONS:"ingame_transactions"},go=()=>GameCore.Configs.Game.ForcePixelRatio?GameCore.Configs.Game.ForcePixelRatio:GameCore.Utils.Device.isDesktop()||GameCore.Utils.Device.pixelRatio()>1?2:1,Ne=go(),L={AVATAR:{KEY:"avatar",FILE:"./assets/images/others/avatar.png",CONFIG:{}},ICON_EARTH:{KEY:"icon-earth",FILE:"./assets/images/others/icon-earth.png",CONFIG:{}},BG_DESERT:{KEY:"background_desert",FILE:`./assets/images/${Ne}x/bg_desert.jpg`,CONFIG:{}},BG_ICE:{KEY:"background_ice",FILE:`./assets/images/${Ne}x/bg_ice.jpg`,CONFIG:{}},BG_TREE:{KEY:"background_tree",FILE:`./assets/images/${Ne}x/bg_tree.jpg`,CONFIG:{}},BG_VOLCANO:{KEY:"background_volcano",FILE:`./assets/images/${Ne}x/bg_volcano.jpg`,CONFIG:{}},BG_CRYSTAL:{KEY:"background_crystal",FILE:`./assets/images/${Ne}x/bg_crystal.jpg`,CONFIG:{}},BG_LANDSCAPE_DESERT:{KEY:"background_landscape_desert",FILE:`./assets/images/${Ne}x/bg_landscape_desert.jpg`,CONFIG:{}},BG_LANDSCAPE_ICE:{KEY:"background_landscape_ice",FILE:`./assets/images/${Ne}x/bg_landscape_ice.jpg`,CONFIG:{}},BG_LANDSCAPE_TREE:{KEY:"background_landscape_tree",FILE:`./assets/images/${Ne}x/bg_landscape_tree.jpg`,CONFIG:{}},BG_LANDSCAPE_VOLCANO:{KEY:"background_landscape_volcano",FILE:`./assets/images/${Ne}x/bg_landscape_volcano.jpg`,CONFIG:{}},BG_LANDSCAPE_CRYSTAL:{KEY:"background_landscape_crystal",FILE:`./assets/images/${Ne}x/bg_landscape_crystal.jpg`,CONFIG:{}}};class ts{playerId;name;photo;locale;constructor(e,t,s,i){this.playerId=e,this.name=t,this.photo=s||L.AVATAR.FILE,this.locale=i||"en_US"}toObject(){return{playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale,score:0}}}const Wh=n=>new Promise(e=>setTimeout(e,n)),Wn=n=>{const e=new Date(n),t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},{Notification:$h}=GameCore.Configs,{GameTitle:jh,GameImage:zh}=$h;class Xh{async createAsync(e){return await GameSDK.tournament.createAsync(e)}async shareAsync(e){await GameSDK.tournament.shareAsync(e)}async joinAsync(e){return await GameSDK.tournament.joinAsync(e)}async postScoreAsync(e){await GameSDK.tournament.postScoreAsync(e)}async getTournamentsAsync(){return await GameSDK.tournament.getTournamentsAsync()}}class Zh{facebook;isCalledSubscribeBot=!1;isCalledCreateShortcut=!1;constructor(e){this.facebook=e}async switchAsync(e){await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.switchAsync(e)}async chooseAsync(){try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2}),GameSDK.context.getID()}catch(e){if(e instanceof Object&&GameCore.Utils.Object.hasOwn(e,"code"))switch(e.code){case"USER_INPUT":return!1;case"SAME_CONTEXT":return GameSDK.context.getID()}return null}}async createAsync(e){try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.context.createAsync(`${e}`),GameSDK.context.getID()}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code"))switch(t.code){case"USER_INPUT":return!1;case"SAME_CONTEXT":return GameSDK.context.getID()}return null}}async getPlayerToken(){return(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature()}async getContextPlayers(e){try{const t=await GameSDK.context.getPlayersAsync(),s=[];return t.forEach(i=>{const a=i.getID();if(a===e)return;const r=i.getName();if(!r)return;const o=i.getPhoto();s.push(new ts(a,r,o).toObject())}),GameCore.Utils.Array.unique(s)}catch(t){return console.warn("getPlayersAsync",{error:t}),[]}}async shareAsync(e){await GameSDK.shareAsync(e)}async sendMessage(e){}async inviteAsync(e){}async postSessionScoreAsync(e){await GameSDK.postSessionScoreAsync(e)}async getRewardedVideoAsync(e){return await GameSDK.getRewardedVideoAsync(e)}async getInterstitialAdAsync(e){return await GameSDK.getInterstitialAdAsync(e)}getContextID(){return GameSDK.context.getID()}async attemptToAddShortcut(){if(this.isCalledCreateShortcut)return!1;try{if(GameSDK.getPlatform()==="ANDROID")return!1;const s=(await GameSDK.player.getDataAsync(["lastCallCreateShortcut"])||{}).lastCallCreateShortcut;if(s&&Wn(+s))return!1;const i=Date.now();if(GameSDK.player.setDataAsync({lastCallCreateShortcut:i}),!this.isSupportAPI("canCreateShortcutAsync"))return!1;if(await GameSDK.canCreateShortcutAsync()){const{SHORTCUT_CREATE:o,SHORTCUT_CREATE_POPUP:c}=v;this.isCalledCreateShortcut=!0,window.game.analytics.event(c);try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.createShortcutAsync(),window.game.analytics.event(o,{success:!0}),!0}catch{return window.game.analytics.event(o,{success:!1}),!1}}return!1}catch{return!1}}async attemptToSubscribeBot(){if(this.isCalledSubscribeBot)return!1;try{if(!this.isSupportAPI("player.canSubscribeBotAsync"))return!1;if(await GameSDK.player.canSubscribeBotAsync()){const i=(await GameSDK.player.getDataAsync(["lastCallSubscribeBot"])||{}).lastCallSubscribeBot;if(i&&Wn(+i))return!1;const a=Date.now();GameSDK.player.setDataAsync({lastCallSubscribeBot:a});const{BOT_SUBSCRIBE:r,BOT_SUBSCRIBE_POPUP:o}=v;this.isCalledSubscribeBot=!0,window.game.analytics.event(o);try{return await GameCore.Utils.Valid.isValueChangeAsync(window.__fbGameReady,!0),await GameSDK.player.subscribeBotAsync(),window.game.analytics.event(r,{success:!0}),!0}catch{return window.game.analytics.event(r,{success:!1}),!1}}return!1}catch{return!1}}async matchPlayerAsync(e,t,s){try{return!this.isSupportAPI("checkCanPlayerMatchAsync")||!await GameSDK.checkCanPlayerMatchAsync()?!1:(await GameSDK.matchPlayerAsync(e,t,s),!0)}catch{return!1}}setLoadingProgress(e){GameSDK.setLoadingProgress(e)}getLocale(){return GameSDK.getLocale()||"en"}async injectTournament(){this.facebook.tournament=new Xh,this.facebook.getTournamentAsync=this.getTournamentAsync,this.facebook.requestTournamentAsync=this.requestTournamentAsync}async getTournamentAsync(){return await GameSDK.getTournamentAsync()}requestTournamentAsync=async e=>{try{await this.facebook.getTournamentAsync(),await this.facebook.tournament.shareAsync({score:e})}catch{const s=GameSDK.player.getName();await this.facebook.tournament.createAsync({initialScore:e,config:{tournamentTitle:`${s}'s Tournament`}})}};async sendNotificationAsync(e){try{const{message:t,delayTime:s}=e;await FBInstant.graphApi.requestAsync("/me/notifications","POST",{message:JSON.stringify({title:jh,body:t,media_url:zh}),schedule_interval:s})}catch(t){console.warn("🤖 ? sendNotificationAsync",t)}}isSupportAPI(e){return GameSDK.getSupportedAPIs().includes(e)}}let $n=0,Pe=0;class qh{game;progressFbTimeEvent;constructor(e){this.game=e}loadingProgressFbBootScene(){let i=100;Pe=30;const a=()=>{if(i<=0){clearTimeout(this.progressFbTimeEvent);return}this.progressFbTimeEvent=setTimeout(()=>{this.game.facebook.setLoadingProgress(Math.round(Pe)),Pe+=30/i,i--,a()},50)};a()}finishLoadingProgressFbBootScene(){clearTimeout(this.progressFbTimeEvent)}loadingProgressFbLoadScene(){(!Pe||Pe<30)&&(Pe=60),$n=Pe;const t=()=>{this.progressFbTimeEvent=setTimeout(()=>{this.game.facebook.setLoadingProgress(Math.round(Pe)),Pe+=.1,t()},50)};t()}onProgress(e){const t=100-Pe,s=Math.round(e*t+Pe);s>$n&&clearTimeout(this.progressFbTimeEvent),this.game.facebook.setLoadingProgress(s)}}class Qh{addKillRevive(){[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Particles.ParticleEmitter,Phaser.GameObjects.Particles.ParticleEmitterManager].forEach(e=>{e.prototype.kill=this.kill,e.prototype.revive=this.revive})}addKillReviveGroup(){Phaser.GameObjects.Group.prototype.killGroup=this.killGroup,Phaser.GameObjects.Group.prototype.reviveGroup=this.reviveGroup}addSetWorldSize(){[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite].forEach(e=>{e.prototype.setWorldSize=this.setWorldSize})}addSetWorldSizeForContainer(){[Phaser.GameObjects.Container].forEach(e=>{e.prototype.setWorldSize=this.setWorldSizeForContainer})}addGetWorldPosition(){[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText].forEach(e=>{e.prototype.getWorldPosition=this.getWorldPosition})}addDrawDebugBox(){[Phaser.GameObjects.RenderTexture,Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.Zone].forEach(e=>{e.prototype.drawDebugBox=this.drawDebugBox})}addHighQuality(){[Phaser.GameObjects.Text].forEach(e=>{e.prototype.setHighQuality=this.setHighQuality})}kill(){this.setActive(!1),this.setVisible(!1)}revive(){this.setActive(!0),this.setVisible(!0)}killGroup(){this.getChildren().forEach(e=>{e.setActive(!1),e.setVisible(!1)})}reviveGroup(){this.getChildren().forEach(e=>{e.setActive(!0),e.setVisible(!0)})}setWorldSize(e,t){this.setSize(e,t),this.setDisplaySize(e,t)}setWorldSizeForContainer(e,t,s=2){this.setSize(e*s,t*s),this.setDisplaySize(e,t)}getWorldPosition(){const e=this.getWorldTransformMatrix(),{translateX:t,translateY:s}=e.decomposeMatrix();return{x:t,y:s}}drawDebugBox(e,t){const{x:s,y:i,width:a,height:r,depth:o,originX:c,originY:l}=this,h=this.scene.add.rectangle(s,i,a,r,e,t);h.setName("Debug Box"),h.setDepth(o);const{isNumber:u}=GameCore.Utils.Valid;return u(c)&&u(l)&&h.setOrigin(c,l),h}setHighQuality(){return this.renderer instanceof Phaser.Renderer.WebGL.WebGLRenderer?this.setResolution(this.scene.game.world.getZoomRatio()*2):this}}const Gi={LOADED:"loaded",DISPLAYED:"displayed"};var Eo=(n=>(n.IDLE="idle",n.LOADING="loading",n.FILLED="filled",n.SHOWING="showing",n))(Eo||{});const fo=Eo;var mo=(n=>(n.REWARDED="rewarded",n.INTERSTITIAL="interstitial",n))(mo||{});const Oe=mo;class Et extends Error{code;constructor(e,t){super(t),this.code=e,this.message=t}}class Jh{type;status;constructor(e){this.type=e,this.status=fo.IDLE}}GameCore.Ads={Types:Oe,Status:fo,Events:Gi,AdError:Et,AdInstance:Jh};class eu extends Phaser.Plugins.BasePlugin{events;enabled;config;lastInterAdShownTime;lastRewardAdShownTime;interstitial;rewardedVideo;safeAreaBottom;showingBannerAd;reloadBannerAdIntervals;bannerAdConfig;isHaveBannerAdOptions;init(){this.events=new Phaser.Events.EventEmitter,this.safeAreaBottom=0,this.lastInterAdShownTime=0,this.lastRewardAdShownTime=0,this.showingBannerAd={},this.reloadBannerAdIntervals={},this.isHaveBannerAdOptions=!0}calculateSafeAreaBottom(){try{if(!this.config.calculateSafeAreaBottom)return;this.safeAreaBottom=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--sab")),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(e,t){this.enabled=t.enabled,this.config=t;const{bannerAdOptions:s}=this.config;s.length===0&&(this.isHaveBannerAdOptions=!1),this.setAdInstance(e),this.calculateSafeAreaBottom()}setAdInstance(e){const{rewardAdOptions:t,interstitialAdOptions:s}=this.config;this.interstitial=new e(Oe.INTERSTITIAL,t.pID),this.rewardedVideo=new e(Oe.REWARDED,s.pID)}async preloadInterstitialAdAsync(){console.log("preloading Interstitial"),await this.preloadAdAsync(Oe.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new Et("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(Oe.INTERSTITIAL)}async preloadRewardedVideoAsync(){console.log("preloading RewardedVideo"),await this.preloadAdAsync(Oe.REWARDED)}async showRewardedVideoAsync(){if(!this.canbeShowRewardAd())throw new Et("REWARDED_VIDEO_CAN_NOT_SHOW","Can't show rewarded video");await this.showAdAsync(Oe.REWARDED),this.lastRewardAdShownTime=window.performance.now()/1e3}getRemainingRewardTime(){const e=window.performance.now()/1e3,{secondsBetweenAds:t}=this.config.rewardAdOptions,s=e-this.lastRewardAdShownTime;return s<t?t-s:0}async preloadAdAsync(e){if(!this.enabled)throw new Et("ADS_NOT_ENABLED","Ads is't enabled");const t=this.getAdInstanceByType(e);if(t===null)throw new Et("AD_INSTANCE_NOT_INITIALLED","The instance ads not yet initiated");await t.loadAsync(),this.events.emit(Gi.LOADED,e)}async showAdAsync(e){if(!this.enabled)throw new Et("ADS_NOT_ENABLED","Ads is't enabled");const t=this.getAdInstanceByType(e);if(t===null)throw new Et("AD_INSTANCE_NOT_INITIALLED","The instance ads not yet initiated");if(e===Oe.INTERSTITIAL&&(this.lastInterAdShownTime=window.performance.now()/1e3),e===Oe.REWARDED){this.lastRewardAdShownTime=window.performance.now()/1e3;const{enableRewardVideoResetInterstitial:s}=this.config;s&&(this.lastInterAdShownTime=this.lastRewardAdShownTime)}await t.showAsync(),this.events.emit(Gi.DISPLAYED,e)}getAdStatus(e){const t=this.getAdInstanceByType(e);return t?t.getStatus():null}getAdInstanceByType(e){switch(e){case Oe.INTERSTITIAL:return this.interstitial;case Oe.REWARDED:return this.rewardedVideo;default:return null}}canbeShowInterstitialAd(){return this.canbeShowInterstitialAdByTime()}canbeShowInterstitialAdByTime(){const e=window.performance.now()/1e3,{secondsFirstTime:t,secondsBetweenAds:s}=this.config.interstitialAdOptions,i=Math.floor(e-this.lastInterAdShownTime);return this.lastInterAdShownTime>0?i>=s:i>=t}canbeShowRewardAd(){const e=window.performance.now()/1e3,{secondsFirstTime:t,secondsBetweenAds:s}=this.config.rewardAdOptions,i=Math.floor(e-this.lastRewardAdShownTime);return this.lastRewardAdShownTime>0?i>=s:i>=t}canShowBannerAd(){if(!this.isHaveBannerAdOptions)return!1;const{bannerAdOptions:e}=this.config,t=GameCore.Utils.Device.isDesktop();for(let s=0;s<e.length;s++){const i=e[s],a=i.platform;if(a=="ALL"||a=="DESKTOP"&&t||a=="MOBILE"&&!t)return this.bannerAdConfig=i,!0}return!1}async showBannerAdAsync(){if(!this.enabled||!this.canShowBannerAd())return;this.reloadBannerAdIntervals=this.reloadBannerAdIntervals||{};const{placementId:e,secondsReload:t}=this.bannerAdConfig;if(!(!e||e=="")){if(t>0){if(this.reloadBannerAdIntervals[e])return;this.loadBannerAdAsync(e),this.reloadBannerAdIntervals[e]=setInterval(()=>{this.loadBannerAdAsync(e)},t*1e3);return}this.loadBannerAdAsync(e)}}async loadBannerAdAsync(e){if(this.enabled)try{await GameSDK.loadBannerAdAsync(e),this.showingBannerAd[e]=!0}catch(t){console.log(t)}}async hideBannerAdAsync(){if(this.enabled&&this.isHaveBannerAdOptions)try{if(!this.enabled)return;const{bannerAdOptions:e}=this.config;e.forEach(t=>{const{placementId:s}=t,i=this.reloadBannerAdIntervals[s];i&&(clearInterval(i),this.reloadBannerAdIntervals[s]=null),this.showingBannerAd[s]=!1}),await GameSDK.hideBannerAdAsync()}catch(e){console.log(e)}}getBannerHeight(){if(!this.enabled||!this.canShowBannerAd())return 0;const{bannerHeight:e=0}=this.bannerAdConfig||{},t=e+this.safeAreaBottom;if(this.game.world){const s=this.game.world,i=s.getPixelRatio(),a=s.getZoomRatio(),r=s.getScreenHeight()*.01;return this.game.world.getPhysicPixels(t+r,i/a)}return t}}class tu{name;color;selfLog;options;constructor(e,t,s){this.name=e,this.color=s||"#FFF",this.options=t,this.selfLog=!0,console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t,s){this.processEvent(e,t,s),this.selfLog&&console.info(`%c${this.name}: event`,`color: ${this.color}`,{name:e,value:s,payload:t})}pageview(e){const t=this.getPageByKey(e);this.processPageView(t),this.selfLog&&console.info(`%c${this.name}: pageview`,`color: ${this.color}`,{page:t})}levelStart(e,t,s){this.processLevelStart(e,t,s),this.selfLog&&console.info(`%c${this.name}: level start`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelFail(e,t,s){this.processLevelFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: level fail`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelRescue(e,t,s){this.processLevelRescue(e,t,s),this.selfLog&&console.info(`%c${this.name}: level rescue`,`color: ${this.color}`,{level:e,score:t,levelName:s})}levelComplete(e,t,s){this.processLevelComplete(e,t,s),this.selfLog&&console.info(`%c${this.name}: level complete`,`color: ${this.color}`,{level:e,score:t,levelName:s})}showInterstitialAd(e){this.processShowInterstitialAd(e),this.selfLog&&console.info(`%c${this.name}: show interstitial ad`,`color: ${this.color}`,{placement:e})}showRewardedVideoAd(e){this.processShowRewardedVideoAd(e),this.selfLog&&console.info(`%c${this.name}: show rewarded video ad`,`color: ${this.color}`,{placement:e})}receiveReward(e){this.processReceiveReward(e),this.selfLog&&console.info(`%c${this.name}: receive reward`,`color: ${this.color}`,{placement:e})}showAdFail(e,t,s){this.processShowAdFail(e,t,s),this.selfLog&&console.info(`%c${this.name}: show ad fail`,`color: ${this.color}`,{type:e,placement:t,reason:s})}gameMilestone(e,t,s,i){this.processGameMilestone(e,t,s,i),this.selfLog&&console.info(`%c${this.name}: game milestone`,`color: ${this.color}`,{type:e,meta:t,level:s,score:i})}gameLifeEnd(e,t,s){this.processGameLifeEnd(e,t,s),this.selfLog&&console.info(`%c${this.name}: game life end`,`color: ${this.color}`,{remainingLife:e,level:t,score:s})}gameIngameTransactions(e,t,s,i){this.gameIngameTransactions(e,t,s,i),this.selfLog&&console.info(`%c${this.name}: ingame transaction`,`color: ${this.color}`,{transactionType:e,meta:t,level:s,score:i})}getPageByKey(e){let t=e.replace(/_/g,"-");return t=t.toLowerCase(),t}processLevelStart(e,t,s){}processLevelFail(e,t,s){}processLevelRescue(e,t,s){}processLevelComplete(e,t,s){}processShowInterstitialAd(e){}processShowRewardedVideoAd(e){}processReceiveReward(e){}processShowAdFail(e,t,s){}processGameMilestone(e,t={},s=0,i=0){}processGameLifeEnd(e,t=0,s=0){}processIngameTransactions(e,t={},s=0,i=0){}}GameCore.Analytics={BaseAnalytics:tu};class su extends Phaser.Plugins.BasePlugin{analytics;init(){this.analytics=[]}add(e){this.analytics.push(e)}pageview=e=>{this.isActive()&&this.analytics.forEach(t=>{t.pageview(e)})};event(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.event(e,t,s)})}levelStart(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.levelStart(e,t,s)})}levelRescue(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.levelRescue(e,t,s)})}levelFail(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.levelFail(e,t,s)})}levelComplete(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.levelComplete(e,t,s)})}showInterstitialAd(e){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(e)})}showRewardedVideoAd(e){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(e)})}receiveReward(e){this.isActive()&&this.analytics.forEach(t=>{t.receiveReward(e)})}showAdFail(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.showAdFail(e,t,s)})}gameMilestone(e,t,s,i){this.isActive()&&this.analytics.forEach(a=>{a.gameMilestone(e,t,s,i)})}gameLifeEnd(e,t,s){this.isActive()&&this.analytics.forEach(i=>{i.gameLifeEnd(e,t,s)})}gameIngameTransactions(e,t,s,i){this.isActive()&&this.analytics.forEach(a=>{a.gameIngameTransactions(e,t,s,i)})}isActive(){return this.analytics.length>=1}}const St={BACKGROUND:{KEY:"background",FILE:"./assets/music/bg_music.ogg"},EFFECTS_FILES:{"start-game-sound":"./assets/sounds/start-game-sound.ogg","next-round-effect":"./assets/sounds/next-round-effect.ogg","lose-sound":"./assets/sounds/lose-sound.ogg","thunder-sound":"./assets/sounds/thunder-sound.ogg","close-click":"./assets/sounds/close-click.ogg","button-click":"./assets/sounds/button-click.ogg","drag-unit-end":"./assets/sounds/drag-unit-end.ogg","drag-unit-start":"./assets/sounds/drag-unit-start.ogg","start-battle":"./assets/sounds/start-battle.ogg","melee-attack":"./assets/sounds/melee-attack.ogg","arrow-shoot":"./assets/sounds/arrow-shoot.ogg","win-battle":"./assets/sounds/win-battle.ogg","unit-damaged":"./assets/sounds/unit-damaged.ogg","unit-merge":"./assets/sounds/unit-merge.ogg","turn-switch":"./assets/sounds/turn-switch.ogg","unit-unlock":"./assets/sounds/unit-unlock.ogg","coin-spawn":"./assets/sounds/coin-spawn.ogg","coin-increase-repeatedly":"./assets/sounds/coin-increase-repeatedly.ogg","gift-charge":"./assets/sounds/gift-charge.ogg","gift-explode":"./assets/sounds/gift-explode.ogg","gift-reveal":"./assets/sounds/gift-reveal.ogg"}},{EFFECTS_FILES:iu}=St;class nu{game;audios;volume;constructor(e){this.game=e,this.audios=new Map}play(e,t){const s={volume:this.volume,...t||{}};s.volume!==this.volume&&(s.volume*=this.volume);const i=this.audios.get(e);if(i){i.play(void 0,s);return}this.game.globalScene.load.audio(e,iu[e]),this.game.globalScene.load.on(`${Phaser.Loader.Events.FILE_KEY_COMPLETE}audio-${e}`,()=>{const a=this.game.sound.add(e);this.audios.set(e,a),a.play(void 0,s)}),this.game.globalScene.load.start()}pause(e){const t=this.audios.get(e);t&&t.pause()}pauseAll(){this.audios.forEach(e=>{e.pause()})}resumeAll(){this.audios.forEach(e=>{e.resume()})}stop(e){const t=this.audios.get(e);t&&t.stop()}setVolume(e){this.volume=e}isMusicEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("music")};isSoundEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("sound")}}class au{name;game;isSprite;audio;markers;volume;volumePerMs;targetVolume;constructor(e,t,s){this.name=t,this.game=e,this.markers={},this.isSprite=s,this.volume=0,this.isSprite||(this.audio=this.game.sound.add(this.name))}play(e,t){const s={volume:this.volume,...t||{}};if(s.volume!==this.volume&&(s.volume*=this.volume),!this.isSprite){if(this.audio?.seek>0){this.audio.resume();return}this.audio?.play(e,s);return}this.createMaker(e),this.markers[e]?.play(e,s)}pause(e){if(!this.isSprite){this.audio?.pause();return}this.markers[e]?.pause()}stop(e){if(!this.isSprite){this.audio?.stop();return}this.markers[e]?.stop()}setVolume(e,t){if(t===0||e===this.volume){this.game.globalScene.events.off(Phaser.Scenes.Events.UPDATE,this.handleIncreaseVolume),this.volume=e,this.audio?.setVolume(e);return}this.volumePerMs=(e-this.volume)/t,this.targetVolume=e,this.game.globalScene.events.off(Phaser.Scenes.Events.UPDATE,this.handleIncreaseVolume),this.game.globalScene.events.on(Phaser.Scenes.Events.UPDATE,this.handleIncreaseVolume)}handleIncreaseVolume=(e,t)=>{this.volume+=this.volumePerMs*t,this.audio?.setVolume(this.volume),(this.volumePerMs>=0&&this.volume>=this.targetVolume||this.volumePerMs<=0&&this.volume<=this.targetVolume)&&(this.volume=this.targetVolume,this.game.globalScene.events.off(Phaser.Scenes.Events.UPDATE,this.handleIncreaseVolume))};isMusicEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("music")};isSoundEnabled=()=>{const{player:e}=this.game;return!!e.getPlayerSetting("sound")};createMaker(e){if(!this.markers[e])try{this.markers[e]=this.game.sound.addAudioSprite(this.name)}catch(t){console.warn("createMaker",t)}}}const{EFFECTS_FILES:V_}=St;class ru extends Phaser.Plugins.BasePlugin{soundManager;musicManager;isMuteAll;initMusic=e=>{this.musicManager=new au(this.game,e,!1),this.setMusicVolume(0)};initSound=()=>{this.soundManager=new nu(this.game),this.setSoundVolume(1)};playSound(e,t){try{if(!this.soundManager||this.isMuteAll||!this.soundManager.isSoundEnabled())return;this.soundManager.play(e,t)}catch{}}stopSound(e){try{this.soundManager.stop(e)}catch{}}playMusic(e={}){try{if(!this.musicManager||this.isMuteAll||!this.musicManager.isMusicEnabled())return;this.musicManager.play("",{loop:!0,volume:.4,...e})}catch{}}pauseMusic(){try{if(!this.musicManager)return;this.musicManager.pause("")}catch{}}stopMusic(){try{if(!this.musicManager)return;this.musicManager.stop("")}catch{}}pauseAllSounds(){try{if(!this.soundManager)return;this.soundManager.pauseAll()}catch{}}resumeAllSounds(){try{if(!this.soundManager)return;this.soundManager.resumeAll()}catch{}}setSoundVolume(e){try{if(!this.soundManager)return;this.soundManager.setVolume(e)}catch(t){console.warn("setSoundVolume",t)}}setMusicVolume(e,t=0){try{if(!this.musicManager)return;this.musicManager.setVolume(e,t)}catch(s){console.warn("setMusicVolume",s)}}muteAll(){this.isMuteAll=!0,this.game.globalScene.sound.mute=!0}unmuteAll(){this.isMuteAll=!1,this.game.globalScene.sound.mute=!1}}const Ao="AUTH_TOKEN_REQUEST",So="AUTH_TOKEN_RECEIVED";class ou extends Error{payload;constructor(e,t){super(e),this.name="RequestTokenFail",this.message=e||"Request token fail",this.payload=t||{}}}var Ns="NOT_FOUND";function cu(n){var e;return{get:function(s){return e&&n(e.key,s)?e.value:Ns},put:function(s,i){e={key:s,value:i}},getEntries:function(){return e?[e]:[]},clear:function(){e=void 0}}}function lu(n,e){var t=[];function s(o){var c=t.findIndex(function(h){return e(o,h.key)});if(c>-1){var l=t[c];return c>0&&(t.splice(c,1),t.unshift(l)),l.value}return Ns}function i(o,c){s(o)===Ns&&(t.unshift({key:o,value:c}),t.length>n&&t.pop())}function a(){return t}function r(){t=[]}return{get:s,put:i,getEntries:a,clear:r}}var hu=function(e,t){return e===t};function uu(n){return function(t,s){if(t===null||s===null||t.length!==s.length)return!1;for(var i=t.length,a=0;a<i;a++)if(!n(t[a],s[a]))return!1;return!0}}function du(n,e){var t=typeof e=="object"?e:{equalityCheck:e},s=t.equalityCheck,i=s===void 0?hu:s,a=t.maxSize,r=a===void 0?1:a,o=t.resultEqualityCheck,c=uu(i),l=r===1?cu(c):lu(r,c);function h(){var u=l.get(arguments);if(u===Ns){if(u=n.apply(null,arguments),o){var p=l.getEntries(),g=p.find(function(S){return o(S.value,u)});g&&(u=g.value)}l.put(arguments,u)}return u}return h.clearCache=function(){return l.clear()},h}function pu(n){var e=Array.isArray(n[0])?n[0]:n;if(!e.every(function(s){return typeof s=="function"})){var t=e.map(function(s){return typeof s=="function"?"function "+(s.name||"unnamed")+"()":typeof s}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+t+"]")}return e}function gu(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];var i=function(){for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];var l=0,h,u={memoizeOptions:void 0},p=o.pop();if(typeof p=="object"&&(u=p,p=o.pop()),typeof p!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof p+"]");var g=u,S=g.memoizeOptions,f=S===void 0?t:S,T=Array.isArray(f)?f:[f],A=pu(o),m=n.apply(void 0,[function(){return l++,p.apply(null,arguments)}].concat(T)),C=n(function(){for(var U=[],Y=A.length,z=0;z<Y;z++)U.push(A[z].apply(null,arguments));return h=m.apply(null,U),h});return Object.assign(C,{resultFunc:p,memoizedResultFunc:m,dependencies:A,lastResult:function(){return h},recomputations:function(){return l},resetRecomputations:function(){return l=0}}),C};return i}var k=gu(du);const en="auth",Eu=n=>n[en].token,fu=n=>n[en].isRequesting,To=k([Eu],n=>n),mu=k([fu],n=>n),Au=()=>async(n,e)=>{try{const{facebook:t}=window.game,s=e(),i=To(s);if(mu(s)||i!=="")return;n({type:Ao,payload:{}});const r=await t.getPlayerToken();n(jn(r))}catch(t){if(t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;if(n(jn("")),t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"message")&&typeof t.message=="string"){console.error(new Error(t.message));return}console.error(new ou)}},jn=n=>({type:So,payload:{token:n}});class Su extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async requestToken(){const{storage:e}=this.game;await e.dispatch(Au())}getToken(){return To(this.state)}}const N={BOOT_SCENE:"BOOT_SCENE",LOAD_SCENE:"LOAD_SCENE",MAP_SCENE:"MAP_SCENE",GAME_SCENE:"GAME_SCENE",GLOBAL_SCENE:"GLOBAL_SCENE",LEVEL_BUILDER_SCENE:"LEVEL_BUILDER_SCENE",TEST_SCENE:"TEST_SCENE",ANIMATIONS_SCENE:"ANIMATIONS_SCENE"},Ds={RUN:Symbol("RUN"),SLEEP:Symbol("SLEEP"),SWITCH:Symbol("SWITCH")},Tu={OPEN:"open",CLOSE:"close",CREATED:"created"},I={UNITS_SCREEN:"UNITS_SCREEN",READY_SCREEN:"READY_SCREEN",NOTIFY_SCREEN:"NOTIFY_SCREEN",RESULT_SCREEN:"RESULT_SCREEN",BATTLE_SCREEN:"BATTLE_SCREEN",LOADING_SCREEN:"LOADING_SCREEN",SETTINGS_SCREEN:"SETTINGS_SCREEN",UNIT_REWARD_SCREEN:"UNIT_REWARD_SCREEN",UNIT_UNLOCK_SCREEN:"UNIT_UNLOCK_SCREEN",LEADER_BOARD_SCREEN:"LEADER_BOARD_SCREEN",BATTLE_RESULT_SCREEN:"BATTLE_RESULT_SCREEN",OFFLINE_REWARD_SCREEN:"OFFLINE_REWARD_SCREEN",CLOSEABLE_NOTIFY_SCREEN:"CLOSEABLE_NOTIFY_SCREEN",FREE_GOLD_REWARD_SCREEN:"FREE_GOLD_REWARD_SCREEN",CHALLENGE_SPLASH_SCREEN:"CHALLENGE_SPLASH_SCREEN",RESET_DATA_SCREEN:"RESET_DATA_SCREEN",START_OVER_POPUP:"START_OVER_POPUP"},Be={SCREEN:200,POPUP:300,SPLASH:400,PRIORITY:999},yu="single",Ut="challenge-friends",Cu="matching-group",zn="tournaments",bt="open",ss="active",bs="finished",yo="CONTEXT_RECEIVED",Iu="CONTEXT_PROCESSED",Co="CONTEXT_GAME_MODE_DETECTED",Io="CONTEXT_GAME_MODE_REQUESTED",Ro="MESSAGES_SENT_UPDATE",_o="MESSAGES_SENT_REMOVE",Lo="SCENE_KEY_UPDATE",Ru="share_invite",Xn="tournament",Ks="challenge_friend_match",_u="matching_group_match",wo="challenge_friends_message";class Po extends Error{constructor(e,t){super(e,t),this.name="InvalidContextId",this.message=e||"This contextId is not valid",this.payload=t}}class Lu extends Error{constructor(e,t){super(e,t),this.name="InvalidOpponentId",this.message=e||"This opponentId is not valid",this.payload=t}}class wu extends Error{constructor(e,t){super(e,t),this.name="WideFrameRenderFail",this.message=e||"Wide frame render fail",this.payload=t}}const Pu={PASS_LEVELS:{ID:"pass-levels",EVENTS:{PASS_LEVEL:"pass-level"}},COLLECT_DIAMONDS:{ID:"collect-diamonds",EVENTS:{COLLECT_DIAMONDS:"collect-diamonds"}},INVITE_FRIENDS:{ID:"invite-friends",EVENTS:{INVITED_FRIEND:"INVITED_FRIEND"}},REACH_SCORE:{ID:"reach-score",EVENTS:{ADD_SCORE:"add-score"}},EVENTS:{TASKS_RESET:"tasks-reset",NOTICE_UPDATE:"notice-update"}},Ou=n=>n.messages.data,Du=(n,e)=>e.opponentId,Oo=k([Ou],n=>n);k([Oo,Du],(n,e)=>!GameCore.Utils.Valid.isString(e)||!GameCore.Utils.Object.hasOwn(n,e)?!1:n[e].sent);var vu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function W_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Hi={},Nu={get exports(){return Hi},set exports(n){Hi=n}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function i(c,l,h){this.fn=c,this.context=l,this.once=h||!1}function a(c,l,h,u,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var g=new i(h,u||c,p),S=t?t+l:l;return c._events[S]?c._events[S].fn?c._events[S]=[c._events[S],g]:c._events[S].push(g):(c._events[S]=g,c._eventsCount++),c}function r(c,l){--c._eventsCount===0?c._events=new s:delete c._events[l]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],h,u;if(this._eventsCount===0)return l;for(u in h=this._events)e.call(h,u)&&l.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},o.prototype.listeners=function(l){var h=t?t+l:l,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var p=0,g=u.length,S=new Array(g);p<g;p++)S[p]=u[p].fn;return S},o.prototype.listenerCount=function(l){var h=t?t+l:l,u=this._events[h];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,h,u,p,g,S){var f=t?t+l:l;if(!this._events[f])return!1;var T=this._events[f],A=arguments.length,m,C;if(T.fn){switch(T.once&&this.removeListener(l,T.fn,void 0,!0),A){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,h),!0;case 3:return T.fn.call(T.context,h,u),!0;case 4:return T.fn.call(T.context,h,u,p),!0;case 5:return T.fn.call(T.context,h,u,p,g),!0;case 6:return T.fn.call(T.context,h,u,p,g,S),!0}for(C=1,m=new Array(A-1);C<A;C++)m[C-1]=arguments[C];T.fn.apply(T.context,m)}else{var O=T.length,U;for(C=0;C<O;C++)switch(T[C].once&&this.removeListener(l,T[C].fn,void 0,!0),A){case 1:T[C].fn.call(T[C].context);break;case 2:T[C].fn.call(T[C].context,h);break;case 3:T[C].fn.call(T[C].context,h,u);break;case 4:T[C].fn.call(T[C].context,h,u,p);break;default:if(!m)for(U=1,m=new Array(A-1);U<A;U++)m[U-1]=arguments[U];T[C].fn.apply(T[C].context,m)}}return!0},o.prototype.on=function(l,h,u){return a(this,l,h,u,!1)},o.prototype.once=function(l,h,u){return a(this,l,h,u,!0)},o.prototype.removeListener=function(l,h,u,p){var g=t?t+l:l;if(!this._events[g])return this;if(!h)return r(this,g),this;var S=this._events[g];if(S.fn)S.fn===h&&(!p||S.once)&&(!u||S.context===u)&&r(this,g);else{for(var f=0,T=[],A=S.length;f<A;f++)(S[f].fn!==h||p&&!S[f].once||u&&S[f].context!==u)&&T.push(S[f]);T.length?this._events[g]=T.length===1?T[0]:T:r(this,g)}return this},o.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&r(this,h)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Nu);const bu=Hi,Mu=new bu,ce={COIN_SUFFIX:"coinSuffixValue",COIN_BASE_VALUE:"coinBaseValue",PLAYER_UNIT_DATA:"playerUnitData",LEVEL_PROGRESS:"playerLevelProgress",MELEE_UNLOCKED:"meleeUnlockedUnitLevel",RANGED_UNLOCKED:"rangedUnlockedUnitLevel",FREE_GOLD_LAST_USED:"freeCoinsLastUsedTime",SELECTED_LEVEL:"selectedLevel",UNIT_SCREEN_AD_WATCHED_COUNT:"unitScreenAdWatchedCount"},{LEVEL_PROGRESS:Uu}=ce,ku=async()=>{const{player:n,globalScene:e}=window.game,{playerId:t,photo:s}=n.getPlayer(),i=n.getCustomData(Uu),a=Bu({playerId:t,playerPhoto:s,playerLevel:i});if(!a)return console.warn("getRenderOptionsGameResult"),null;const r={name:"mess-game-result",width:476,height:246,renderOptions:a};return await e.frameCapture.capture(r)},Bu=n=>{const{playerId:e,playerPhoto:t,playerLevel:s=1}=n;return typeof e!="string"||typeof t!="string"?null:{avatar:{name:`${e}`,type:"image",x:50,y:68,image:t,width:105,height:105,fallbackWithImage:L.AVATAR.KEY},wideFrame:{name:"wide-frame-game-result",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-result.png",width:476,height:246},playerLevel:{type:"text",x:234,y:35,font:"800 18px",fillStyle:"#424ec4",text:`Level ${s}`,textAlign:"center"}}},xu=async n=>{const{globalScene:e}=window.game;console.info("🚀 > getRenderOptionsChallenge",n);const t=Fu(n);if(!t)return console.warn("getRenderOptionsChallenge"),null;const s={name:"mess-challenge",width:476,height:246,renderOptions:t};return await e.frameCapture.capture(s)},Fu=n=>{const{playerId:e,playerPhoto:t,opponentId:s,opponentPhoto:i}=n;return typeof e!="string"||typeof s!="string"?null:{playerAvatar:{name:`${e}`,type:"image",x:20,y:75,image:t||L.AVATAR.FILE,width:105,height:105,fallbackWithImage:L.AVATAR.KEY},opponentAvatar:{name:`${s}`,type:"image",x:357,y:75,image:i||L.AVATAR.FILE,width:105,height:105,fallbackWithImage:L.AVATAR.KEY},wideFrame:{name:"wide-frame-game-challenge",type:"image",x:0,y:0,image:"./assets/wideframes/wide-frame-game-challenge.png",width:476,height:246}}},Do=n=>{const{contextId:e}=n;if(e===""||typeof e!="string")throw new Po(null,{contextId:e})},Gu=n=>{const{opponentId:e,contextId:t}=n;if(e===""||typeof e!="string")throw new Lu(null,{opponentId:e});if(t===""||typeof t!="string")throw new Po(null,{contextId:t})},vo=n=>{const{imageShare:e}=n;if(e===null)throw new wu},No=(n,e=!0)=>(t,s)=>{const i=s(),a=Oo(i);if(e){if(a[n]?.sent)return;t(Hu(n))}a[n]?.sent&&t(Yu(n))},Hu=n=>({type:Ro,payload:{opponentId:n}}),Yu=n=>({type:_o,payload:{opponentId:n}}),bo=async(n,e)=>{const{facebook:t}=window.game;try{Gu({opponentId:n,contextId:e});const s=FBInstant.context.getID();if(s===e&&e!=="")return s;if(n==="10"&&e!=="")return e;if(e)return await t.switchAsync(e),FBInstant.context.getID()}catch(s){console.warn(s)}return""},Ku=async n=>{const{battle:e,analytics:t,facebook:s,storage:i}=window.game;try{const{matchId:a,opponentId:r,contextId:o}=n,c=e.getPlayerInfo();if(!c)return;const l=e.getOpponentInfo();if(!l)return;const{playerId:h,playerName:u,playerPhoto:p}=c,{playerPhoto:g}=l,S=await bo(r,o);Do({contextId:S});const f=await xu({playerId:h,playerPhoto:p,opponentId:r,opponentPhoto:g});vo({imageShare:f}),await s.sendMessage({cta:{default:"Play now",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${u} challenges you`,localizations:{vi_VN:`${u} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:f||"",template:"challenge",data:{type:Ks,matchId:a,playerId:h,opponentId:r,status:ss}}),i.dispatch(No(r)),t.event(v.MESSAGE,{message_content_type:"Challenge",success:!0}),Mu.emit(Pu.INVITE_FRIENDS.EVENTS.INVITED_FRIEND,{type:"friend",value:1,opponentId:r})}catch(a){t.event(v.MESSAGE,{message_content_type:"Challenge",success:!1}),console.warn(a)}},Vu=async n=>{const{player:e,analytics:t,facebook:s,storage:i}=window.game;try{const{matchId:a,opponentId:r,contextId:o}=n,c=await bo(r,o);Do({contextId:c});const l=await ku();vo({imageShare:l});const{name:h,playerId:u}=e.getPlayer();await s.sendMessage({cta:{default:"Revenge",localizations:{vi_VN:"Trả thù"}},text:{default:`${h} beat your troops!`,localizations:{vi_VN:`${h} đã đánh bại quân của bạn!`}},image:l||"",template:"pass_score",data:{type:Ks,matchId:a,playerId:u,opponentId:r,status:ss}}),i.dispatch(No(r)),t.event(v.MESSAGE,{message_content_type:"Beat",success:!0})}catch(a){t.event(v.MESSAGE,{message_content_type:"Beat",success:!1}),console.warn(a)}},Vs="player",Wu=n=>n[Vs],$u=n=>n[Vs].data,ju=n=>n[Vs].connectedPlayers,zu=(n,e)=>e.limit,Xu=(n,e)=>e.offset,Ws=k([Wu],n=>n),Qt=k([Ws],n=>n.playerId),Zu=k([Ws],n=>n.ASID),Ht=k([$u],n=>n);k([Ht],n=>n.settings);const Mo=k([ju],n=>n),qu=k([Mo,zu,Xu],(n,e,t)=>typeof e!="number"?[]:typeof t!="number"?[]:Object.keys(n).slice(t,e+t)||[]),Qu=k([Ht],n=>n.customFields);class Uo extends Error{constructor(e,t){super(e,t),this.name="BadRequest",this.message=e||"This request is bad",this.payload=t}}class Yi extends Error{constructor(e,t){super(e,t),this.name="RequestTimeout",this.message=e||"This request is timeout",this.payload=t}}const{AppId:Ju,Network:tn}=GameCore.Configs,ed=n=>{if(!n.ok)throw new Uo(null,{response:n})},ko=()=>{const n=window.game.auth.getToken();return{token:n,timeout:tn.Timeout,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}},Bo=(n,e,t,s)=>async()=>{try{const i=`${n}/apps/${Ju}/${e}`,a=new AbortController;t.signal=a.signal;const r=setTimeout(()=>{a.abort()},t.timeout);GameCore.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const o=await fetch(i,t);return clearTimeout(r),ed(o),await o.json()||{}}catch(i){if(i instanceof Uo)return null;throw i instanceof Object&&GameCore.Utils.Object.hasOwn(i,"name")&&i.name==="AbortError"?new Yi(null):i}},sn=async(n,e)=>{try{return n()}catch(t){if(t instanceof Yi&&e>0)try{return await Wh(600),await sn(n,e-1)}catch{return{}}return t instanceof Yi?{}:(console.warn(t),{})}},$s=async(n,e={},t,s=tn.Retries)=>{if(!t)return{};try{const i={...ko(),...e,method:"GET"},a=Bo(t,n,i);return await sn(a,s)}catch(i){return console.warn(i),{}}},Yt=async(n,e,t={},s,i=tn.Retries)=>{if(!s)return{};try{const a={...ko(),...t,method:"POST"},r=Bo(s,n,a,e);return await sn(r,i)}catch(a){return console.warn(a),{}}},{ApiHost:cs}=GameCore.Configs,ei=async n=>{try{const t=await Yt("matches",{opponentPlayerId:n},{},cs);return t?GameCore.Utils.Valid.isObject(t.data)?t.data:{}:{}}catch(e){return console.warn("createMatchAsync",e),{}}},td=async()=>{try{const e=await $s("matches",{},cs);return e?e.data:[]}catch(n){return console.warn("getMatchesAsync",n),[]}},sd=async n=>{try{const e=`matches/${n}/join`,t=await Yt(e,{},{},cs);return t?GameCore.Utils.Valid.isObject(t.data)?t.data:{}:{}}catch(e){return console.warn("joinMatchAsync",e),{}}},id=async n=>{try{const e=`matches/${n}`,t=await $s(e,{},cs);return t?GameCore.Utils.Valid.isObject(t.data)?t.data:{}:{}}catch(e){return console.warn("getMatchDetailByIdAsync",e),{}}},Zn=async(n,e)=>{try{const t=`matches/${n}/finish`,s=await Yt(t,{matchId:n,level:e},{},cs);return s?GameCore.Utils.Valid.isObject(s.data)?s.data:{}:{}}catch(t){return console.warn("finishMatchAsync",t),{}}},Ve={IDLE:"IDLE",INITIALIZING:"INITIALIZING",STARTED:"STARTED"},{MaximumMeleeLevel:nd,MaximumRangedLevel:ad}=GameCore.Configs.Gameplay,{CheaterIds:rd}=GameCore.Configs.Gameplay;class od extends Phaser.Plugins.BasePlugin{status=Ve.IDLE;matchId;contextId;playerInfo;opponentInfo;replayOpponentId;get state(){return this.game.storage.getState()}async sendChallengeMessage(e,t){try{const s=Qt(this.state);await this.updateProfiles(s,t);const i=await ei(t);this.validateMatchData(i);const a=i._id;await Ku({contextId:e,opponentId:t,matchId:a})}catch(s){console.warn("sendChallengeMessage",s)}finally{this.playerInfo=null,this.opponentInfo=null}}async createBattle(e,t=!0){const{facebook:s,globalScene:i}=this.game;try{i.screen.open(I.NOTIFY_SCREEN,{message:i.lang.Text.LOADING,loading:!0}),this.setStatus(Ve.INITIALIZING);const a=Qt(this.state);if(e===a)throw new Error("You can not challenge yourself");let r=null;const o=await s.getContextPlayers("");o.length>0&&o.map(({playerId:l})=>l).includes(e)&&(r=FBInstant.context.getID()),r||(r=await s.createAsync(e)),this.validateContextId(r),r===""||typeof r!="string"||await this.startBattle(r,e),t&&this.game.scene.sleep(N.GAME_SCENE),this.setStatus(Ve.STARTED)}catch(a){console.warn("createBattle",a),t&&this.game.scene.sleep(N.GAME_SCENE),this.setStatus(Ve.IDLE)}finally{t&&this.game.scene.run(N.GAME_SCENE),i.screen.close(I.NOTIFY_SCREEN)}}async continueBattle(e,t){const{globalScene:s,facebook:i}=this.game;try{s.screen.open(I.NOTIFY_SCREEN,{message:s.lang.Text.LOADING,loading:!0}),this.setStatus(Ve.INITIALIZING);const a=Qt(this.state);if(t===a)throw new Error("You can not challenge yourself");let r=await sd(e);if("_id"in r||(r=await id(e)),this.validateMatchData(r,e),this.matchId=e,this.contextId=i.getContextID(),r.status===bs){const o=await ei(t);this.validateMatchData(o),this.matchId=o._id}await this.updateProfiles(a,t),this.setStatus(Ve.STARTED)}catch(a){console.warn("continueBattle",a),this.setStatus(Ve.IDLE)}finally{s.screen.close(I.NOTIFY_SCREEN)}}async finishBattle(e){console.log("🤖 ? finishBattle",e);try{if(!this.matchId)return;if(e==="win"){await Zn(this.matchId,1);const{playerId:t}=this.opponentInfo||{};this.contextId&&t&&await Vu({matchId:this.matchId,contextId:this.contextId,opponentId:t})}e==="lose"&&await Zn(this.matchId,2),this.logMatchEvent(v.MATCH_END)}catch(t){console.warn("finishBattle",t)}finally{this.matchId=null,this.contextId=null,this.playerInfo=null;const{playerId:t}=this.opponentInfo||{};this.replayOpponentId=t||this.replayOpponentId,this.opponentInfo=null,window.clientInformation.opponentIsCheater=!1,this.setStatus(Ve.IDLE)}}getReplayOpponentId(){return this.replayOpponentId}getPlayerInfo(){return this.playerInfo}getOpponentInfo(){return this.opponentInfo}logMatchEvent(e){const{playerLevel:t}=this.opponentInfo||{};if(!t)return;const{analytics:s}=this.game;s.event(e,{game_mode:GameCore.Utils.String.toUpperCamelCase(Ut),level:t,level_name:`level_${t}`})}async startBattle(e,t){try{const s=await ei(t);this.validateMatchData(s);const{_id:i}=s;this.matchId=i,this.contextId=e,this.logMatchEvent(v.MATCH_START)}catch(s){console.warn("startBattleFriends",s)}}async updateProfiles(e,t){try{const{profile:s}=this.game;await s.requestProfile(e),await s.requestProfile(t);const i=s.getProfiles(),a=i[e];this.validateProfileData(a);let r=i[t]||{};console.log("opponentProfile",r),r=this.handleNewPlayerInvitation(r),this.validateProfileData(r),console.log("🤖 ? updateProfiles",a,r);const{playerUnitData:o,playerLevelProgress:c}=a.customFields||{};this.updatePlayerProfile({playerId:e,playerName:a.name,playerPhoto:a.photo?a.photo:L.AVATAR.FILE,playerLevel:c,unitData:o});const{playerUnitData:l,playerLevelProgress:h}=r.customFields||{};this.updatePlayerProfile({playerId:t,playerName:r.name,playerPhoto:r.photo?r.photo:L.AVATAR.FILE,playerLevel:h,unitData:l}),rd.includes(t)&&(window.clientInformation.opponentIsCheater=!0)}catch(s){throw console.warn(s),new Error("Can not update profiles")}}updatePlayerProfile(e){this.playerInfo=e}updateOpponentProfile(e){this.opponentInfo=e}handleNewPlayerInvitation(e){const t=GameCore.Utils.Json.clone(e||{});if(!t.customFields){const r={MELEE:{},RANGED:{}};for(let o=1;o<=nd;o++)r.MELEE[o]=0;for(let o=1;o<=ad;o++)r.RANGED[o]=0;return t.customFields={playerUnitData:"0-0-m2-0-0/0-0-0-0-0/r1-0-0-0-0",playerLevelProgress:2},t}const{playerUnitData:s,playerLevelProgress:i}=t.customFields||{},a=i&&typeof i=="number"&&i>=2;return a||(t.customFields.playerLevelProgress=2),(!s||!a)&&(t.customFields.playerUnitData="0-0-m2-0-0/0-0-0-0-0/r1-0-0-0-0"),t}validateProfileData(e){if(!e)throw new Error("Profile is not found");const{customFields:t}=e;if(!t)throw new Error("Profile customFields is not found");const{playerUnitData:s,playerLevelProgress:i}=t||{};if(typeof i!="number")throw new Error("Player level is not found");if(typeof s!="string")throw new Error("Player unit data is not found");this.validateUnitData(s)}validateUnitData(e){const t=e.split("/");if(t.length!==3)throw new Error("Unit data segment is not valid");const s=[],i=t[0].split("-");if(i.length!==5)throw new Error("Unit data row 1 is not valid");s.push(...i);const a=t[1].split("-");if(a.length!==5)throw new Error("Unit data row 2 is not valid");s.push(...a);const r=t[2].split("-");if(r.length!==5)throw new Error("Unit data row 3 is not valid");if(s.push(...r),s.some(c=>{if(c[0]==="0")return!1;if(c[0]!=="r"&&c[0]!=="m")return!0;const l=parseInt(c.substring(1));return l<1||l>11}))throw new Error("Unit type is not valid")}validateContextId(e){if(e===!1)throw new Error("User canceled")}validateMatchData(e,t){if(console.log("🤖 ? validateMatchData",e),!e)throw new Error("Match is not found");if(!GameCore.Utils.Valid.isObject(e))throw new Error("Match is not valid");if(!("_id"in e))throw new Error("Match id is not valid");if(t&&t!==e._id)throw new Error("Match id is not matched");if(!("whitePlayerId"in e))throw new Error("Match white player id is not valid");if(!("blackPlayerId"in e))throw new Error("Match black player id is not valid")}async getMatchHistory(){try{const e=await td(),{UseMock:t}=GameCore.Configs.Battle;if(console.log("🤖 ? getMatchHistory",e,t),t){const s=[],i=Qt(this.state);if(console.log("🤖 ? getMatchHistory",i),!i)return[];for(let a=0;a<50;a++){const r=`${a+1e5}`,o=a%2===0?i:r,c=a%2===0?1:2,l=a%2===0?2:1,h={_id:`${a}`,whitePlayerId:i,blackPlayerId:r,winnerId:o,whitePlayerScore:c,blackPlayerScore:l,whitePlayerLevel:c,blackPlayerLevel:l,status:"finished",updatedAt:"2022-07-13T07:07:00.524Z"};s.push(h)}return this.validateMatchHistory(s),s}return this.validateMatchHistory(e),e}catch(e){return console.warn("getMatchHistory",e),[]}}validateMatchHistory(e){if(Array.isArray(e)===!1)throw new Error("Match history is invalid");e.forEach(t=>{if(GameCore.Utils.Valid.isObject(t)===!1)throw new Error("Match is not valid");if(!("_id"in t))throw new Error("Match id is not valid");if(!("whitePlayerId"in t))throw new Error("Match white player id is not valid");if(!("blackPlayerId"in t))throw new Error("Match black player id is not valid");if(!("status"in t))throw new Error("Match status is not valid");if(!("whitePlayerScore"in t))throw new Error("Match white player score is not valid");if(!("blackPlayerScore"in t))throw new Error("Match black player score is not valid");if(!("whitePlayerLevel"in t))throw new Error("Match white player level is not valid");if(!("blackPlayerLevel"in t))throw new Error("Match black player level is not valid");if(!("updatedAt"in t))throw new Error("Match updated at is not valid")})}setStatus(e){this.status=e}getStatus(){return this.status}}class F{baseValue;suffix;constructor(e,t,s){this.suffix=t||0,this.baseValue=Math.floor(e),!s&&(this.initValue(),this.refactorValue())}initValue(){if(this.suffix===0&&this.baseValue>=1e3){const e=this.baseValue.toString(),t=e.length-1;this.suffix=Math.floor(t/3);const s=t%3;this.suffix>=2&&(this.baseValue=parseInt(e.substring(0,4+s)));return}this.baseValue*=1e3}refactorValue(){if(this.baseValue=Math.floor(this.baseValue),this.baseValue>=1e6){this.baseValue=Math.floor(this.baseValue/1e3),this.suffix++;return}if(this.baseValue===0){this.suffix=0;return}if(this.baseValue<1e3&&this.suffix>0){this.baseValue*=1e3,this.suffix--;return}}add(e){if(e.baseValue<0){this.subtract(new F(e.baseValue*-1,e.suffix,!0));return}if(!(this.suffix-e.suffix>=2)){if(e.suffix-this.suffix>=2){this.baseValue=e.baseValue,this.suffix=e.suffix;return}if(this.suffix===e.suffix)this.baseValue+=e.baseValue;else{this.suffix=this.suffix>e.suffix?this.suffix:e.suffix;const t=this.suffix>e.suffix?this.baseValue:e.baseValue,s=this.suffix>e.suffix?e:this;this.baseValue=t+Math.floor(s.baseValue/1e3)}this.refactorValue()}}subtract(e){if(e.suffix>this.suffix){this.baseValue=0,this.suffix=0;return}if(e.baseValue>this.baseValue&&e.suffix===this.suffix){this.baseValue=0,this.suffix=0;return}this.suffix-e.suffix>=2||(this.baseValue-=Math.floor(e.baseValue/Math.pow(1e3,this.suffix-e.suffix)),this.refactorValue())}multiply(e){if(typeof e=="number"&&e<1e3){this.baseValue*=e,this.refactorValue();return}const t=typeof e=="number"?new F(e):e;this.suffix+=t.suffix,this.baseValue*=Math.floor(t.baseValue/1e3),this.refactorValue()}divide(e){if(typeof e=="number"&&e<1e3){this.baseValue/=e,this.refactorValue();return}const t=typeof e=="number"?new F(e):e;this.suffix-=t.suffix,this.baseValue/=Math.floor(t.baseValue/1e3),this.refactorValue()}clone(){return new F(this.baseValue,this.suffix,!0)}biggerThan(e){return this.suffix>e.suffix?!0:this.suffix<e.suffix?!1:this.baseValue>e.baseValue}smallerThan(e){return this.suffix<e.suffix?!0:this.suffix>e.suffix?!1:this.baseValue<e.baseValue}toString(){return`${Math.floor(this.baseValue/1e3)}${this.generateTextSuffix()}`}generateTextSuffix(){switch(this.suffix){case 0:return"";case 1:return"K";case 2:return"M";case 3:return"B";case 4:return"T";default:{const e=this.suffix-5,t=Math.floor(e/26),s=e%26,i=String.fromCharCode(t+65),a=String.fromCharCode(s+65);return`${i}${a}`}}}}class cd extends Phaser.Events.EventEmitter{emit(e,t){return super.emit(e,t)}}const xo={RECEIVED:"received"},Fo="UPDATE_COINS",Go="coins",Ho=n=>n[Go],ld=n=>Ho(n).coinBaseValue,hd=n=>Ho(n).coinSuffixValue,ud=k([ld],n=>n),dd=k([hd],n=>n),{COIN_BASE_VALUE:pd,COIN_SUFFIX:gd}=ce,Yo=(n,e)=>async t=>{try{const s=new F(n,e,!0);t(Ko(s.baseValue,s.suffix))}catch(s){const{rollbar:i}=window.game;i.sendException(s)}},Ed=(n,e)=>async t=>{try{const s=new F(n,e,!0),{suffix:i,baseValue:a}=s;t(Ko(a,i));const{player:r}=window.game;r.setMultiCustomData({[gd]:i,[pd]:a})}catch(s){const{rollbar:i}=window.game;i.sendException(s)}},Ko=(n,e)=>({type:Fo,payload:{coinBaseValue:n,coinSuffixValue:e}});let fd=class extends Phaser.Plugins.BasePlugin{events;currentCoins;constructor(e){super(e),this.events=new cd}get state(){return this.game.storage.getState()}getCurrentCoins(){if(!this.currentCoins){const e=ud(this.state),t=dd(this.state);this.currentCoins=new F(e,t,!0)}return this.currentCoins}plusCoins(e,t){const s=new F(e,t,!0);this.currentCoins.add(s),this.updateCurrentCoins()}minusCoins(e,t){const s=new F(e,t,!0);this.currentCoins.subtract(s),this.updateCurrentCoins()}updateCurrentCoins=os(()=>{const{storage:e}=this.game,{baseValue:t,suffix:s}=this.currentCoins;e.dispatch(Ed(t,s))},2e3);receiveCoins(e,t){const{storage:s}=this.game;s.dispatch(Yo(e,t)),this.currentCoins=new F(e,t,!0),this.events.emit(xo.RECEIVED,this.currentCoins)}};const md='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',Ad=(n,e)=>({string:"+",style:"font-size: 1px; padding: "+Math.floor(e/2)+"px "+Math.floor(n/2)+"px;"}),Sd=(n,e=1)=>{const t=new Image;t.onload=function(){const s=Ad(this.width*e,this.height*e);console.info(`%c ${s.string}`,`${s.style} background: transparent url(${n}) no-repeat center center; background-size: ${this.width*e}px ${this.height*e}px;`)},t.src=n};class Td extends Phaser.Plugins.ScenePlugin{width;height;renderOptions;canvas;preload(e){const t=Object.keys(e);t.length<1||(t.forEach(s=>{this.scene.load.image(s,e[s])}),this.scene.load.start())}async capture(e){const{width:t,height:s,renderOptions:i}=e;return this.width=t,this.height=s,this.renderOptions=i,this.createCanvas(),await this.loadImages(),this.drawObjects(),this.snapshotFrame()}createCanvas(){this.canvas||(this.canvas=this.game.textures.createCanvas("FrameCaptureCanvas")),this.canvas.clear(),this.canvas.setSize(this.width,this.height)}loadImages(){return new Promise((e,t)=>{for(const s in this.renderOptions){const{name:i,image:a}=this.renderOptions[s];!a||this.scene.textures.get(i).key===i||this.scene.load.image(i,a)}this.scene.load.on(Phaser.Loader.Events.COMPLETE,e),this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,()=>{const s=new Error("Load image failed");t(s)}),this.scene.load.start()})}drawObjects(){for(const e in this.renderOptions){const t=this.renderOptions[e];switch(t.type){case"text":this.drawText(t);break;case"image":this.drawImage(t);break}}}drawText(e){const{context:t}=this.canvas,{x:s,y:i,font:a,text:r,fillStyle:o,lineWidth:c,textAlign:l}=e;t.font=`${a} ${md}`,t.fillStyle=o||"#ffffff",c&&(t.lineWidth=c),l&&(t.textAlign=l),t.fillText(r,s,i)}drawImage(e){const{context:t}=this.canvas,{x:s,y:i,name:a,frame:r,width:o,height:c,fallbackWithImage:l}=e;let h=this.scene.textures.get(a),u=h.getSourceImage(r);h.key==="__MISSING"&&l&&(h=this.scene.textures.get(l),u=h.getSourceImage()),t.drawImage(u,s,i,o,c)}snapshotFrame(){const e=this.canvas.getCanvas().toDataURL("image/jpeg",.85);return GameCore.Utils.Valid.isDebugger()&&Sd(e),e}}class yd extends Phaser.Events.EventEmitter{game;options;performance;isRunning=!1;checkTimer;fpsHistory;constructor(e,t,s){super(),this.game=e,this.options=s,this.performance=t}start=()=>{if(this.isRunning)return;this.isRunning=!0;const{checkInterval:e}=this.options;this.checkTimer=e,this.fpsHistory=[],this.game.events.on(Phaser.Core.Events.POST_STEP,this.onPostStep)};stop=()=>{if(!this.isRunning)return;this.isRunning=!1,this.game.events.off(Phaser.Core.Events.POST_STEP,this.onPostStep);const{onlyUpdateWhenSwitchScene:e}=this.options;e&&this.checkFps()};onPostStep=(e,t)=>{if(this.checkTimer-=t,this.checkTimer>0)return;const{checkInterval:s,onlyUpdateWhenSwitchScene:i}=this.options;this.checkTimer+=s,this.fpsHistory.push(this.game.loop.actualFps),i===!1&&this.fpsHistory.length>=5&&this.checkFps()};checkFps(){if(this.fpsHistory.length===0)return;const{autoUpgradeQuality:e}=this.options;let t=!1;this.isLowFps()?t=this.performance.downgradeGraphicsQuality():e&&this.isHighFps()&&(t=this.performance.upgradeGraphicsQuality()),t&&(this.fpsHistory=[])}getFpsMedian(){return Phaser.Math.Median(this.fpsHistory)}isLowFps(){return this.getFpsMedian()<this.options.fpsThreshold}isHighFps(){return this.getFpsMedian()>this.options.fpsThreshold*1.2}}class Cd extends Phaser.Plugins.BasePlugin{fpsTracker;pixelRatio;minQuality;maxQuality;qualityAdjustStep;trackingSceneKeys=[];configure(e){const{pixelRatio:t,minQuality:s,maxQuality:i,qualityAdjustStep:a,trackingSceneKeys:r,...o}=e;this.pixelRatio=t,this.minQuality=s,this.maxQuality=i,this.qualityAdjustStep=a,this.trackingSceneKeys=r,this.fpsTracker=new yd(this.game,this,o)}active(){this.game.events.on(Phaser.Scenes.Events.WAKE,this.trackingScene),this.game.events.on(Phaser.Scenes.Events.START,this.trackingScene)}trackingScene=e=>{if(!this.trackingSceneKeys.includes(e))return;const t=this.game.scene.getScene(e);t.events.once(Phaser.Scenes.Events.UPDATE,this.fpsTracker.start),t.events.once(Phaser.Scenes.Events.SLEEP,this.fpsTracker.stop)};downgradeGraphicsQuality(){const e=this.pixelRatio;if(e<=this.minQuality)return!1;const t=+(e-this.qualityAdjustStep).toFixed(2);return t<this.minQuality?!1:(this.pixelRatio=t,this.game.world.resize(this.pixelRatio),console.warn(`💫 Graphics quality was downgraded! (${e} -> ${t})`),!0)}upgradeGraphicsQuality(){const e=this.pixelRatio;if(e>=this.maxQuality)return!1;const t=+(e+this.qualityAdjustStep).toFixed(2);return t>this.maxQuality?!1:(this.pixelRatio=t,this.game.world.resize(this.pixelRatio),console.warn(`🚀 Graphics quality was upgraded! (${e} -> ${t})`),!0)}}const Ft={sound:!0,music:!0,vibrate:!0,speedUp:!1},{StartCoins:Id,MaximumMeleeLevel:Rd,MaximumRangedLevel:_d}=GameCore.Configs.Gameplay,{Valid:Z,Object:Se}=GameCore.Utils;class nn{coins;settings;gameData;userGuideDisplays;freeCoinsLastUsedTime;offlineRewardLastCheck;constructor(e){this.setupDefaultData(),this.updateCoins(e),this.updateSettings(e),this.updateGameData(e),this.updateUserGuideDisplays(e),this.updateFreeCoinsLastUsedTime(e),this.updateOfflineRewardLastCheck(e)}setupDefaultData(){this.coins={suffix:0,baseValue:Id*1e3},this.settings={...Ft};const e={MELEE:{},RANGED:{}};for(let t=1;t<=Rd;t++)e.MELEE[t]=0;for(let t=1;t<=_d;t++)e.RANGED[t]=0;this.gameData={selectedLevel:0,playerUnitData:"0-0-0-0-0/0-0-0-0-0/0-0-m1-0-0",playerLevelProgress:0,meleeUnlockedUnitLevel:0,rangedUnlockedUnitLevel:0,unitScreenAdWatchedCount:e},this.userGuideDisplays=0,this.freeCoinsLastUsedTime=0,this.offlineRewardLastCheck=0}updateCoins(e){const{coins:t}=e;Z.isObject(t)!==!1&&(Se.hasOwn(t,"suffix")&&Z.isNumber(t.suffix)&&(this.coins.suffix=t.suffix),Se.hasOwn(t,"baseValue")&&Z.isNumber(t.baseValue)&&(this.coins.baseValue=t.baseValue))}updateSettings(e){const{settings:t}=e;Z.isObject(t)!==!1&&(Se.hasOwn(t,"sound")&&Z.isBoolean(t.sound)&&(this.settings.sound=t.sound),Se.hasOwn(t,"music")&&Z.isBoolean(t.music)&&(this.settings.music=t.music),Se.hasOwn(t,"vibrate")&&Z.isBoolean(t.vibrate)&&(this.settings.vibrate=t.vibrate),Se.hasOwn(t,"speedUp")&&Z.isBoolean(t.speedUp)&&(this.settings.speedUp=t.speedUp))}updateGameData(e){const{gameData:t}=e;if(Z.isObject(t)!==!1&&(Se.hasOwn(t,"selectedLevel")&&Z.isNumber(t.selectedLevel)&&(this.gameData.selectedLevel=t.selectedLevel),Se.hasOwn(t,"playerUnitData")&&Z.isString(t.playerUnitData)&&this.validateUnitData(t.playerUnitData)&&(this.gameData.playerUnitData=t.playerUnitData),Se.hasOwn(t,"playerLevelProgress")&&Z.isNumber(t.playerLevelProgress)&&(this.gameData.playerLevelProgress=t.playerLevelProgress),Se.hasOwn(t,"playerLevelProgress")&&Z.isNumber(t.meleeUnlockedUnitLevel)&&(this.gameData.meleeUnlockedUnitLevel=t.meleeUnlockedUnitLevel),Se.hasOwn(t,"rangedUnlockedUnitLevel")&&Z.isNumber(t.rangedUnlockedUnitLevel)&&(this.gameData.rangedUnlockedUnitLevel=t.rangedUnlockedUnitLevel),Se.hasOwn(t,"unitScreenAdWatchedCount")&&Z.isObject(t.unitScreenAdWatchedCount))){const s=t.unitScreenAdWatchedCount;if(Z.isObject(s.MELEE))for(const[i,a]of Object.entries(s.MELEE)){const r=parseInt(i);Z.isNumber(r)&&Z.isNumber(a)&&(this.gameData.unitScreenAdWatchedCount.MELEE[r]=a)}if(Z.isObject(s.RANGED))for(const[i,a]of Object.entries(s.RANGED)){const r=parseInt(i);Z.isNumber(r)&&Z.isNumber(a)&&(this.gameData.unitScreenAdWatchedCount.RANGED[r]=a)}}}updateUserGuideDisplays(e){const{userGuideDisplays:t}=e;Z.isNumber(t)!==!1&&(this.userGuideDisplays=t)}updateFreeCoinsLastUsedTime(e){const{freeCoinsLastUsedTime:t}=e;Z.isNumber(t)!==!1&&(this.freeCoinsLastUsedTime=t)}updateOfflineRewardLastCheck(e){const{offlineRewardLastCheck:t}=e;Z.isNumber(t)!==!1&&(this.offlineRewardLastCheck=t)}validateUnitData=e=>{const t=e.split("/");if(t.length!==3)return!1;const s=[],i=t[0].split("-");if(i.length!==5)return!1;s.push(...i);const a=t[1].split("-");if(a.length!==5)return!1;s.push(...a);const r=t[2].split("-");return!(r.length!==5||(s.push(...r),s.some(c=>{if(c[0]==="0")return!1;if(c[0]!=="r"&&c[0]!=="m")return!0;const l=parseInt(c.substring(1));return l<1||l>11})))};toObject(){return{coins:this.coins,settings:this.settings,gameData:this.gameData,userGuideDisplays:this.userGuideDisplays,freeCoinsLastUsedTime:this.freeCoinsLastUsedTime,offlineRewardLastCheck:this.offlineRewardLastCheck}}convertToPlayerData(){const{gameData:e}=this,{baseValue:t,suffix:s}=this.coins;return{settings:this.settings,customFields:{coinBaseValue:t,coinSuffixValue:s,freeCoinsLastUsedTime:this.freeCoinsLastUsedTime,offlineRewardLastCheck:this.offlineRewardLastCheck,selectedLevel:e.selectedLevel,playerUnitData:e.playerUnitData,playerLevelProgress:e.playerLevelProgress,meleeUnlockedUnitLevel:e.meleeUnlockedUnitLevel,rangedUnlockedUnitLevel:e.rangedUnlockedUnitLevel,unitScreenAdWatchedCount:e.unitScreenAdWatchedCount},userGuideDisplays:this.userGuideDisplays}}convertToFacebookData(e){const{settings:t,customFields:s,userGuideDisplays:i}=e,{selectedLevel:a,coinBaseValue:r,coinSuffixValue:o,freeCoinsLastUsedTime:c,offlineRewardLastCheck:l,playerUnitData:h,playerLevelProgress:u,meleeUnlockedUnitLevel:p,rangedUnlockedUnitLevel:g,unitScreenAdWatchedCount:S}=s;return this.settings=t,this.userGuideDisplays=i,this.freeCoinsLastUsedTime=c,this.offlineRewardLastCheck=l,this.coins.suffix=o,this.coins.baseValue=r,this.gameData.selectedLevel=a,this.gameData.playerUnitData=h,this.gameData.playerLevelProgress=u,this.gameData.meleeUnlockedUnitLevel=p,this.gameData.rangedUnlockedUnitLevel=g,this.gameData.unitScreenAdWatchedCount=S,this.toObject()}}const{ApiHost:Ld}=GameCore.Configs,js=async n=>{},wd=async n=>(await Yt(`players/${n}/user-guide-displays/inc`,{},{},Ld))?.data||{},Vo="PLAYER_RECEIVED",Wo="PLAYER_DATA_UPDATE",$o="PLAYER_SCORE_UPDATE",jo="PLAYER_PROFILE_UPDATE",zo="PLAYER_SETTING_UPDATE",Xo="PLAYER_CONNECTED_PLAYERS_UPDATE";class Zo extends Error{payload;constructor(e,t){super(e),this.name="PlayerDataNameNotSupport",this.message=e||"The name of player data is not supported",this.payload=t||{}}}const ft=n=>{try{const e=localStorage.getItem(n);return e===null?null:GameCore.Utils.Json.decode(e)}catch{return null}},mt=(n,e)=>{try{const t=ft(n);let s={};GameCore.Utils.Valid.isObject(t)&&(s=t);const i=GameCore.Utils.Json.clone(e);if(!GameCore.Utils.Valid.isObject(i))return!1;const a=GameCore.Utils.Object.clear(i),r=Ie(s,a),o=GameCore.Utils.Json.encode(r);return localStorage.setItem(n,o),!0}catch{return!1}},{AppId:qn}=GameCore.Configs,Pd=(n,e)=>t=>{const{playerId:s,name:i,photo:a,locale:r}=n;t({type:Vo,payload:{playerId:s,name:i,photo:a,locale:r,data:e||{}}})},Od=()=>async n=>{try{const{facebook:e}=window.game,t=await new Promise((a,r)=>{e.once("players",o=>{a(o)}),e.once("playersfail",()=>r([])),e.getPlayers()}),s=a=>!!a,i=t.map(a=>{const r=a.getID(),o=a.getName(),c=a.getPhoto();return!r||!o||!c?null:new ts(r,o,c).toObject()}).filter(s);if(i.length<1)return;n(qo(i))}catch(e){console.warn(e)}},qo=n=>({type:Xo,payload:{connectedPlayers:n}}),Dd=(n,e)=>(t,s)=>{try{let i=s();t({type:zo,payload:{name:n,value:e}}),i=s();const a=Ht(i),r=new nn({}).convertToFacebookData(a);FBInstant.player.setDataAsync(r)}catch(i){console.warn(i)}},vd=()=>async(n,e)=>{try{const t=e(),s=Ws(t),{playerId:i,name:a,photo:r,locale:o}=s,c=await FBInstant.player.getASIDAsync();n({type:jo,payload:{profile:{appId:qn,playerId:i,name:a,photo:r,locale:o,ASID:c}}}),await js({appId:qn,playerId:i,name:a,photo:r,locale:o,ASID:c})}catch(t){console.warn(t)}},Nd=(n,e)=>async(t,s)=>{try{console.info("🚀 > setPlayerCustomData",{name:n,data:e});const i={customFields:{[n]:e}};await t(an(i));const a=s(),o={...Ht(a)};js(o)}catch(i){if(i instanceof Zo)return;console.warn(i)}},bd=n=>async(e,t)=>{try{console.info("🚀 > setMultiCustomData",n),await e(an({customFields:n}));const i=t(),r={...Ht(i)};js(r)}catch(s){if(console.log("🤖 ? error",s),s instanceof Zo)return;console.warn(s)}},an=n=>e=>{try{e({type:Wo,payload:{data:n}})}catch(t){console.warn(t)}},Md=()=>async(n,e)=>{try{const{facebook:t}=window.game;n(an({userGuideDisplays:1}));const s=e(),i=Qt(s);await wd(i),t.data.set("userGuideDisplays",1)}catch(t){console.warn(t)}},Qn=n=>async(e,t)=>{try{await e({type:$o,payload:{score:n}}),js({score:n});const s=t(),a={...Ht(s)};mt(GameCore.Configs.PlayerDataStore,a)}catch(s){console.warn(s)}},{COIN_BASE_VALUE:Ud,COIN_SUFFIX:kd}=ce;class Bd extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async incUserGuideDisplays(){const{storage:e}=this.game;await e.dispatch(Md())}receiveData(e,t){const{storage:s}=this.game;s.dispatch(Pd(e,t))}async updateData(){const{storage:e}=this.game;await e.dispatch(vd())}async updateBestScore(e){const t=this.getBestScore();if(e<=t)return;const{storage:s}=this.game;await s.dispatch(Qn(e))}async setScore(e){const{storage:t}=this.game;await t.dispatch(Qn(e))}async setSetting(e,t){const{storage:s}=this.game;await s.dispatch(Dd(e,t))}async setCustomData(e,t){const{storage:s}=this.game;await s.dispatch(Nd(e,t))}async setMultiCustomData(e){const{storage:t}=this.game;await t.dispatch(bd(e))}async requestConnectedPlayers(){const{storage:e}=this.game;await e.dispatch(Od())}async updateConnectedPlayers(e){const{storage:t}=this.game;await t.dispatch(qo(e))}getPlayer(){return Ws(this.state)}getPlayerId(){return this.getPlayer().playerId}getPlayerASID(){return Zu(this.state)}getPlayerData(){return this.getPlayer().data}getPlayerSetting(e){const t=this.getPlayerSettings();return typeof e!="string"?null:GameCore.Utils.Object.hasOwn(t,e)?t[e]:GameCore.Utils.Object.hasOwn(Ft,e)?Ft[e]:null}getPlayerSettings(){return this.getPlayerData().settings}getPlayerIsNew(){return this.getPlayer().isUserNew}getCoins(){const e=this.getCustomData(Ud),t=this.getCustomData(kd);return!GameCore.Utils.Valid.isNumber(e)||!GameCore.Utils.Valid.isNumber(t)?0:new F(e,t,!0)}getDiamond(){const e=this.getCustomData("diamond");return GameCore.Utils.Valid.isNumber(e)?e:0}getCustomData(e){const t=Qu(this.state);return!GameCore.Utils.Valid.isObject(t)||!GameCore.Utils.Object.hasOwn(t,e)?null:t[e]}getConnectedPlayers(){return Mo(this.state)}getConnectedPlayerIds(e,t){return qu(this.state,{limit:e,offset:t})}getBestScore(){return 0}}const{ApiHost:Qo}=GameCore.Configs,xd=async n=>{const e=GameCore.Utils.String.params(n);return(await $s(`players?${e}`,{},Qo))?.data||[]},Fd=async n=>(await $s(`players/${n}`,{},Qo))?.data||[],rn="PROFILES_DATA_UPDATE",on="profile",Gd=n=>n[on].data,Hd=n=>n[on].profileIds,Yd=k([Gd],n=>n),Kd=k([Hd],n=>n),Vd=n=>async(e,t)=>{try{const s=t(),i=Kd(s),a=GameCore.Utils.Array.difference(n,i);if(a.length<1)return;const r=await xd({playerIds:a});e({type:rn,payload:{data:r}})}catch(s){console.warn(s)}},Wd=n=>async e=>{try{const t=await Fd(n);e({type:rn,payload:{data:[t]}})}catch(t){console.warn(t)}};class $d extends Phaser.Plugins.BasePlugin{get state(){return this.game.storage.getState()}async requestProfiles(e){const{storage:t}=this.game;await t.dispatch(Vd(e))}async requestProfile(e){const{storage:t}=this.game;await t.dispatch(Wd(e))}getProfiles(){return Yd(this.state)}}class jd extends Phaser.Events.EventEmitter{emit(e,t){return super.emit(e,t)}}class zd extends Phaser.GameObjects.Container{zone;background;constructor(e,t,s,i){super(e),this.setName(t),this.setVisible(!1);const{width:a,height:r}=this.scene.world.getWorldSize();this.setSize(s||a,i||r),this.addZone(),this.addBackground()}open(e){GameCore.Utils.Valid.isObject(e)&&(this.setDataEnabled(),this.setData(e)),this.setBlockInputOutsideEnabled(!0),this.scene.screen.bringToTop(this.name),!this.visible&&(this.setVisible(!0),this.logPageviewOnOpen(),this.logEventOpen())}close(){(this.scene.screen.get(I.UNITS_SCREEN)?.visible===!1||this.name===I.UNITS_SCREEN)&&this.setBlockInputOutsideEnabled(!1),this.visible&&(this.setVisible(!1),this.logPageviewOnClose())}incY(e){this.y+=e,this.background.y-=e}incX(e){this.x+=e,this.background.x-=e}incScale(e){this.scale+=e,this.background.scale-=e^e*(100/e)}setBlockInputOutsideEnabled(e){this.scene.input.setTopOnly(e)}addZone(){this.zone=this.scene.add.zone(0,0,this.width,this.height),this.zone.setInteractive({}),this.add(this.zone)}addBackground(){const e="screen-background";if(!this.scene.textures.exists(e)){const t=this.width+2,s=this.height+2,i=this.scene.add.graphics();i.fillStyle(0,1),i.fillRect(0,0,t,s),i.generateTexture(e,t,s),i.destroy()}this.background=this.scene.add.image(0,0,e),this.add(this.background)}logPageviewOnOpen(){this.scene.analytics.pageview(this.name)}logPageviewOnClose(){this.scene.analytics.pageview(this.scene.scene.key)}logEventOpen(){this.scene.analytics.event(v.SCREEN_OPEN,{screen_name:this.getScreenName()})}getScreenName(){return GameCore.Utils.String.toUpperCamelCase(this.name.toLowerCase())}}GameCore.Screen=zd;GameCore.Screens={Events:Tu};let Xd=class extends Phaser.Plugins.ScenePlugin{events;boot(){this.events=new jd,this.registryScreenFactory()}get(e){const t=this.scene.children.getByName(e);return t===null?null:t}add(e,t,s,i){let a=this.get(e);return a||(a=this.scene.add.screen(e,t,s,i),this.events.emit(GameCore.Screens.Events.CREATED,a),a)}open(e,t){const s=this.get(e);return s?(s.open(t),s.emit(GameCore.Screens.Events.OPEN,s),this.events.emit(GameCore.Screens.Events.OPEN,s),console.log("Screen open",e,t),!0):!1}close(e){const t=this.get(e);return t?(t.close(),t.emit(GameCore.Screens.Events.CLOSE,t),this.events.emit(GameCore.Screens.Events.CLOSE,t),console.log("Screen close",e),!0):!1}bringToTop(e){const t=this.scene.children.getByName(e);t&&this.scene.children.bringToTop(t)}registryScreenFactory(){Phaser.GameObjects.GameObjectFactory.register("screen",this.createScreen)}createScreen(e,t,s,i){const a=new t(this.scene,e,s,i);return Phaser.Display.Align.In.Center(a,this.scene.gameZone),this.existing(a),a}};var Ki={},Zd={get exports(){return Ki},set exports(n){Ki=n}};(function(n){(function(e,t){n.exports=t()})(vu,function(){var e=Object.prototype.toString;function t(u,p){return u==null?!1:Object.prototype.hasOwnProperty.call(u,p)}function s(u){if(!u||r(u)&&u.length===0)return!0;if(typeof u!="string"){for(var p in u)if(t(u,p))return!1;return!0}return!1}function i(u){return e.call(u)}function a(u){return typeof u=="object"&&i(u)==="[object Object]"}var r=Array.isArray||function(u){return e.call(u)==="[object Array]"};function o(u){return typeof u=="boolean"||i(u)==="[object Boolean]"}function c(u){var p=parseInt(u);return p.toString()===u?p:u}function l(u){u=u||{};var p=function(A){return Object.keys(p).reduce(function(m,C){return C==="create"||typeof p[C]=="function"&&(m[C]=p[C].bind(p,A)),m},{})},g;u.includeInheritedProps?g=function(){return!0}:g=function(A,m){return typeof m=="number"&&Array.isArray(A)||t(A,m)};function S(A,m){if(g(A,m))return A[m]}var f;u.includeInheritedProps?f=function(A,m){typeof m!="string"&&typeof m!="number"&&(m=String(m));var C=S(A,m);if(m==="__proto__"||m==="prototype"||m==="constructor"&&typeof C=="function")throw new Error("For security reasons, object's magic properties cannot be set");return C}:f=function(A,m){return S(A,m)};function T(A,m,C,O){if(typeof m=="number"&&(m=[m]),!m||m.length===0)return A;if(typeof m=="string")return T(A,m.split(".").map(c),C,O);var U=m[0],Y=f(A,U);return m.length===1?((Y===void 0||!O)&&(A[U]=C),Y):(Y===void 0&&(typeof m[1]=="number"?A[U]=[]:A[U]={}),T(A[U],m.slice(1),C,O))}return p.has=function(A,m){if(typeof m=="number"?m=[m]:typeof m=="string"&&(m=m.split(".")),!m||m.length===0)return!!A;for(var C=0;C<m.length;C++){var O=c(m[C]);if(typeof O=="number"&&r(A)&&O<A.length||(u.includeInheritedProps?O in Object(A):t(A,O)))A=A[O];else return!1}return!0},p.ensureExists=function(A,m,C){return T(A,m,C,!0)},p.set=function(A,m,C,O){return T(A,m,C,O)},p.insert=function(A,m,C,O){var U=p.get(A,m);O=~~O,r(U)||(U=[],p.set(A,m,U)),U.splice(O,0,C)},p.empty=function(A,m){if(!s(m)&&A!=null){var C,O;if(C=p.get(A,m)){if(typeof C=="string")return p.set(A,m,"");if(o(C))return p.set(A,m,!1);if(typeof C=="number")return p.set(A,m,0);if(r(C))C.length=0;else if(a(C))for(O in C)g(C,O)&&delete C[O];else return p.set(A,m,null)}}},p.push=function(A,m){var C=p.get(A,m);r(C)||(C=[],p.set(A,m,C)),C.push.apply(C,Array.prototype.slice.call(arguments,2))},p.coalesce=function(A,m,C){for(var O,U=0,Y=m.length;U<Y;U++)if((O=p.get(A,m[U]))!==void 0)return O;return C},p.get=function(A,m,C){if(typeof m=="number"&&(m=[m]),!m||m.length===0)return A;if(A==null)return C;if(typeof m=="string")return p.get(A,m.split("."),C);var O=c(m[0]),U=f(A,O);return U===void 0?C:m.length===1?U:p.get(A[O],m.slice(1),C)},p.del=function(m,C){if(typeof C=="number"&&(C=[C]),m==null||s(C))return m;if(typeof C=="string")return p.del(m,C.split("."));var O=c(C[0]);if(f(m,O),!g(m,O))return m;if(C.length===1)r(m)?m.splice(O,1):delete m[O];else return p.del(m[O],C.slice(1));return m},p}var h=l();return h.create=l,h.withInheritedProps=l({includeInheritedProps:!0}),h})})(Zd);var Jn=Ki.get;function qd(n,e){return n===e}function Qd(n,e,t){t=t||qd;var s=Jn(n(),e);return function(a){return function(){var r=Jn(n(),e);if(!t(s,r)){var o=s;s=r,a(r,o,e)}}}}var Jd=Qd;const ep=Jd;function is(n){return is=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},is(n)}function tp(n,e){if(is(n)!=="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e||"default");if(is(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function sp(n){var e=tp(n,"string");return is(e)==="symbol"?e:String(e)}function ip(n,e,t){return e=sp(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function ea(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function ta(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ea(Object(t),!0).forEach(function(s){ip(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ea(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function re(n){return"Minified Redux error #"+n+"; visit https://redux.js.org/Errors?code="+n+" for the full message or use the non-minified dev environment for full errors. "}var sa=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),ti=function(){return Math.random().toString(36).substring(7).split("").join(".")},Ms={INIT:"@@redux/INIT"+ti(),REPLACE:"@@redux/REPLACE"+ti(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ti()}};function np(n){if(typeof n!="object"||n===null)return!1;for(var e=n;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(n)===e}function Jo(n,e,t){var s;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(re(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(re(1));return t(Jo)(n,e)}if(typeof n!="function")throw new Error(re(2));var i=n,a=e,r=[],o=r,c=!1;function l(){o===r&&(o=r.slice())}function h(){if(c)throw new Error(re(3));return a}function u(f){if(typeof f!="function")throw new Error(re(4));if(c)throw new Error(re(5));var T=!0;return l(),o.push(f),function(){if(T){if(c)throw new Error(re(6));T=!1,l();var m=o.indexOf(f);o.splice(m,1),r=null}}}function p(f){if(!np(f))throw new Error(re(7));if(typeof f.type>"u")throw new Error(re(8));if(c)throw new Error(re(9));try{c=!0,a=i(a,f)}finally{c=!1}for(var T=r=o,A=0;A<T.length;A++){var m=T[A];m()}return f}function g(f){if(typeof f!="function")throw new Error(re(10));i=f,p({type:Ms.REPLACE})}function S(){var f,T=u;return f={subscribe:function(m){if(typeof m!="object"||m===null)throw new Error(re(11));function C(){m.next&&m.next(h())}C();var O=T(C);return{unsubscribe:O}}},f[sa]=function(){return this},f}return p({type:Ms.INIT}),s={dispatch:p,subscribe:u,getState:h,replaceReducer:g},s[sa]=S,s}function ap(n){Object.keys(n).forEach(function(e){var t=n[e],s=t(void 0,{type:Ms.INIT});if(typeof s>"u")throw new Error(re(12));if(typeof t(void 0,{type:Ms.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(re(13))})}function ec(n){for(var e=Object.keys(n),t={},s=0;s<e.length;s++){var i=e[s];typeof n[i]=="function"&&(t[i]=n[i])}var a=Object.keys(t),r;try{ap(t)}catch(o){r=o}return function(c,l){if(c===void 0&&(c={}),r)throw r;for(var h=!1,u={},p=0;p<a.length;p++){var g=a[p],S=t[g],f=c[g],T=S(f,l);if(typeof T>"u")throw l&&l.type,new Error(re(14));u[g]=T,h=h||T!==f}return h=h||a.length!==Object.keys(c).length,h?u:c}}function tc(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return e.length===0?function(s){return s}:e.length===1?e[0]:e.reduce(function(s,i){return function(){return s(i.apply(void 0,arguments))}})}function rp(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return function(s){return function(){var i=s.apply(void 0,arguments),a=function(){throw new Error(re(15))},r={getState:i.getState,dispatch:function(){return a.apply(void 0,arguments)}},o=e.map(function(c){return c(r)});return a=tc.apply(void 0,o)(i.dispatch),ta(ta({},i),{},{dispatch:a})}}}function sc(n){var e=function(s){var i=s.dispatch,a=s.getState;return function(r){return function(o){return typeof o=="function"?o(i,a,n):r(o)}}};return e}var ic=sc();ic.withExtraArgument=sc;const op=ic;function De(n){for(var e=arguments.length,t=Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Tt(n){return!!n&&!!n[q]}function yt(n){var e;return!!n&&(function(t){if(!t||typeof t!="object")return!1;var s=Object.getPrototypeOf(t);if(s===null)return!0;var i=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return i===Object||typeof i=="function"&&Function.toString.call(i)===fp}(n)||Array.isArray(n)||!!n[la]||!!(!((e=n.constructor)===null||e===void 0)&&e[la])||cn(n)||ln(n))}function Ct(n,e,t){t===void 0&&(t=!1),Kt(n)===0?(t?Object.keys:Bt)(n).forEach(function(s){t&&typeof s=="symbol"||e(s,n[s],n)}):n.forEach(function(s,i){return e(i,s,n)})}function Kt(n){var e=n[q];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:cn(n)?2:ln(n)?3:0}function kt(n,e){return Kt(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function cp(n,e){return Kt(n)===2?n.get(e):n[e]}function nc(n,e,t){var s=Kt(n);s===2?n.set(e,t):s===3?n.add(t):n[e]=t}function ac(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function cn(n){return gp&&n instanceof Map}function ln(n){return Ep&&n instanceof Set}function At(n){return n.o||n.t}function hn(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=oc(n);delete e[q];for(var t=Bt(e),s=0;s<t.length;s++){var i=t[s],a=e[i];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(e[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),e)}function un(n,e){return e===void 0&&(e=!1),dn(n)||Tt(n)||!yt(n)||(Kt(n)>1&&(n.set=n.add=n.clear=n.delete=lp),Object.freeze(n),e&&Ct(n,function(t,s){return un(s,!0)},!0)),n}function lp(){De(2)}function dn(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function ke(n){var e=ji[n];return e||De(18,n),e}function hp(n,e){ji[n]||(ji[n]=e)}function Vi(){return ns}function si(n,e){e&&(ke("Patches"),n.u=[],n.s=[],n.v=e)}function Us(n){Wi(n),n.p.forEach(up),n.p=null}function Wi(n){n===ns&&(ns=n.l)}function ia(n){return ns={p:[],l:ns,h:n,m:!0,_:0}}function up(n){var e=n[q];e.i===0||e.i===1?e.j():e.g=!0}function ii(n,e){e._=e.p.length;var t=e.p[0],s=n!==void 0&&n!==t;return e.h.O||ke("ES5").S(e,n,s),s?(t[q].P&&(Us(e),De(4)),yt(n)&&(n=ks(e,n),e.l||Bs(e,n)),e.u&&ke("Patches").M(t[q].t,n,e.u,e.s)):n=ks(e,t,[]),Us(e),e.u&&e.v(e.u,e.s),n!==rc?n:void 0}function ks(n,e,t){if(dn(e))return e;var s=e[q];if(!s)return Ct(e,function(o,c){return na(n,s,e,o,c,t)},!0),e;if(s.A!==n)return e;if(!s.P)return Bs(n,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var i=s.i===4||s.i===5?s.o=hn(s.k):s.o,a=i,r=!1;s.i===3&&(a=new Set(i),i.clear(),r=!0),Ct(a,function(o,c){return na(n,s,i,o,c,t,r)}),Bs(n,i,!1),t&&n.u&&ke("Patches").N(s,t,n.u,n.s)}return s.o}function na(n,e,t,s,i,a,r){if(Tt(i)){var o=ks(n,i,a&&e&&e.i!==3&&!kt(e.R,s)?a.concat(s):void 0);if(nc(t,s,o),!Tt(o))return;n.m=!1}else r&&t.add(i);if(yt(i)&&!dn(i)){if(!n.h.D&&n._<1)return;ks(n,i),e&&e.A.l||Bs(n,i)}}function Bs(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&un(e,t)}function ni(n,e){var t=n[q];return(t?At(t):n)[e]}function aa(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=Object.getPrototypeOf(t)}}function st(n){n.P||(n.P=!0,n.l&&st(n.l))}function ai(n){n.o||(n.o=hn(n.t))}function $i(n,e,t){var s=cn(e)?ke("MapSet").F(e,t):ln(e)?ke("MapSet").T(e,t):n.O?function(i,a){var r=Array.isArray(i),o={i:r?1:0,A:a?a.A:Vi(),P:!1,I:!1,R:{},l:a,t:i,k:null,o:null,j:null,C:!1},c=o,l=as;r&&(c=[o],l=Jt);var h=Proxy.revocable(c,l),u=h.revoke,p=h.proxy;return o.k=p,o.j=u,p}(e,t):ke("ES5").J(e,t);return(t?t.A:Vi()).p.push(s),s}function dp(n){return Tt(n)||De(22,n),function e(t){if(!yt(t))return t;var s,i=t[q],a=Kt(t);if(i){if(!i.P&&(i.i<4||!ke("ES5").K(i)))return i.t;i.I=!0,s=ra(t,a),i.I=!1}else s=ra(t,a);return Ct(s,function(r,o){i&&cp(i.t,r)===o||nc(s,r,e(o))}),a===3?new Set(s):s}(n)}function ra(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return hn(n)}function pp(){function n(a,r){var o=i[a];return o?o.enumerable=r:i[a]=o={configurable:!0,enumerable:r,get:function(){var c=this[q];return as.get(c,a)},set:function(c){var l=this[q];as.set(l,a,c)}},o}function e(a){for(var r=a.length-1;r>=0;r--){var o=a[r][q];if(!o.P)switch(o.i){case 5:s(o)&&st(o);break;case 4:t(o)&&st(o)}}}function t(a){for(var r=a.t,o=a.k,c=Bt(o),l=c.length-1;l>=0;l--){var h=c[l];if(h!==q){var u=r[h];if(u===void 0&&!kt(r,h))return!0;var p=o[h],g=p&&p[q];if(g?g.t!==u:!ac(p,u))return!0}}var S=!!r[q];return c.length!==Bt(r).length+(S?0:1)}function s(a){var r=a.k;if(r.length!==a.t.length)return!0;var o=Object.getOwnPropertyDescriptor(r,r.length-1);if(o&&!o.get)return!0;for(var c=0;c<r.length;c++)if(!r.hasOwnProperty(c))return!0;return!1}var i={};hp("ES5",{J:function(a,r){var o=Array.isArray(a),c=function(h,u){if(h){for(var p=Array(u.length),g=0;g<u.length;g++)Object.defineProperty(p,""+g,n(g,!0));return p}var S=oc(u);delete S[q];for(var f=Bt(S),T=0;T<f.length;T++){var A=f[T];S[A]=n(A,h||!!S[A].enumerable)}return Object.create(Object.getPrototypeOf(u),S)}(o,a),l={i:o?5:4,A:r?r.A:Vi(),P:!1,I:!1,R:{},l:r,t:a,k:c,o:null,g:!1,C:!1};return Object.defineProperty(c,q,{value:l,writable:!0}),c},S:function(a,r,o){o?Tt(r)&&r[q].A===a&&e(a.p):(a.u&&function c(l){if(l&&typeof l=="object"){var h=l[q];if(h){var u=h.t,p=h.k,g=h.R,S=h.i;if(S===4)Ct(p,function(C){C!==q&&(u[C]!==void 0||kt(u,C)?g[C]||c(p[C]):(g[C]=!0,st(h)))}),Ct(u,function(C){p[C]!==void 0||kt(p,C)||(g[C]=!1,st(h))});else if(S===5){if(s(h)&&(st(h),g.length=!0),p.length<u.length)for(var f=p.length;f<u.length;f++)g[f]=!1;else for(var T=u.length;T<p.length;T++)g[T]=!0;for(var A=Math.min(p.length,u.length),m=0;m<A;m++)p.hasOwnProperty(m)||(g[m]=!0),g[m]===void 0&&c(p[m])}}}}(a.p[0]),e(a.p))},K:function(a){return a.i===4?t(a):s(a)}})}var oa,ns,pn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",gp=typeof Map<"u",Ep=typeof Set<"u",ca=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",rc=pn?Symbol.for("immer-nothing"):((oa={})["immer-nothing"]=!0,oa),la=pn?Symbol.for("immer-draftable"):"__$immer_draftable",q=pn?Symbol.for("immer-state"):"__$immer_state";var fp=""+Object.prototype.constructor,Bt=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,oc=Object.getOwnPropertyDescriptors||function(n){var e={};return Bt(n).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)}),e},ji={},as={get:function(n,e){if(e===q)return n;var t=At(n);if(!kt(t,e))return function(i,a,r){var o,c=aa(a,r);return c?"value"in c?c.value:(o=c.get)===null||o===void 0?void 0:o.call(i.k):void 0}(n,t,e);var s=t[e];return n.I||!yt(s)?s:s===ni(n.t,e)?(ai(n),n.o[e]=$i(n.A.h,s,n)):s},has:function(n,e){return e in At(n)},ownKeys:function(n){return Reflect.ownKeys(At(n))},set:function(n,e,t){var s=aa(At(n),e);if(s?.set)return s.set.call(n.k,t),!0;if(!n.P){var i=ni(At(n),e),a=i?.[q];if(a&&a.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(ac(t,i)&&(t!==void 0||kt(n.t,e)))return!0;ai(n),st(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return ni(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,ai(n),st(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=At(n),s=Reflect.getOwnPropertyDescriptor(t,e);return s&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty:function(){De(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){De(12)}},Jt={};Ct(as,function(n,e){Jt[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),Jt.deleteProperty=function(n,e){return Jt.set.call(this,n,e,void 0)},Jt.set=function(n,e,t){return as.set.call(this,n[0],e,t,n[0])};var mp=function(){function n(t){var s=this;this.O=ca,this.D=!0,this.produce=function(i,a,r){if(typeof i=="function"&&typeof a!="function"){var o=a;a=i;var c=s;return function(f){var T=this;f===void 0&&(f=o);for(var A=arguments.length,m=Array(A>1?A-1:0),C=1;C<A;C++)m[C-1]=arguments[C];return c.produce(f,function(O){var U;return(U=a).call.apply(U,[T,O].concat(m))})}}var l;if(typeof a!="function"&&De(6),r!==void 0&&typeof r!="function"&&De(7),yt(i)){var h=ia(s),u=$i(s,i,void 0),p=!0;try{l=a(u),p=!1}finally{p?Us(h):Wi(h)}return typeof Promise<"u"&&l instanceof Promise?l.then(function(f){return si(h,r),ii(f,h)},function(f){throw Us(h),f}):(si(h,r),ii(l,h))}if(!i||typeof i!="object"){if((l=a(i))===void 0&&(l=i),l===rc&&(l=void 0),s.D&&un(l,!0),r){var g=[],S=[];ke("Patches").M(i,l,g,S),r(g,S)}return l}De(21,i)},this.produceWithPatches=function(i,a){if(typeof i=="function")return function(l){for(var h=arguments.length,u=Array(h>1?h-1:0),p=1;p<h;p++)u[p-1]=arguments[p];return s.produceWithPatches(l,function(g){return i.apply(void 0,[g].concat(u))})};var r,o,c=s.produce(i,a,function(l,h){r=l,o=h});return typeof Promise<"u"&&c instanceof Promise?c.then(function(l){return[l,r,o]}):[c,r,o]},typeof t?.useProxies=="boolean"&&this.setUseProxies(t.useProxies),typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){yt(t)||De(8),Tt(t)&&(t=dp(t));var s=ia(this),i=$i(this,t,void 0);return i[q].C=!0,Wi(s),i},e.finishDraft=function(t,s){var i=t&&t[q],a=i.A;return si(a,s),ii(void 0,a)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!ca&&De(20),this.O=t},e.applyPatches=function(t,s){var i;for(i=s.length-1;i>=0;i--){var a=s[i];if(a.path.length===0&&a.op==="replace"){t=a.value;break}}i>-1&&(s=s.slice(i+1));var r=ke("Patches").$;return Tt(t)?r(t,s):this.produce(t,function(o){return r(o,s)})},n}(),ge=new mp,Ap=ge.produce;ge.produceWithPatches.bind(ge);ge.setAutoFreeze.bind(ge);ge.setUseProxies.bind(ge);ge.applyPatches.bind(ge);ge.createDraft.bind(ge);ge.finishDraft.bind(ge);const Re=Ap,Sp={currentSceneKey:"",prevSceneKey:""},Tp=(n=Sp,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{sceneKey:i}=s;switch(e.type){case Lo:t.currentSceneKey=i,t.prevSceneKey=n.currentSceneKey;break}});pp();const cc={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},currentGameMode:"",isRequestingDetectGameMode:!0},ri=cc,yp=(n=cc,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{gameMode:i,contextId:a,contextType:r,entryPointData:o,isRequestingDetectGameMode:c}=s;switch(e.type){case yo:t.contextId=a,t.contextType=r,t.entryPointData=o;break;case Iu:t.contextId=a,t.contextType=r,t.processed=!0;break;case Co:t.currentGameMode=i,t.isRequestingDetectGameMode=!1;break;case Io:t.isRequestingDetectGameMode=c;break}}),Cp={data:{}},Ip=(n=Cp,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{opponentId:i}=s;if(typeof i=="string")switch(e.type){case Ro:n.data[i]?t.data[i].sent=!0:t.data[i]={sent:!0};break;case _o:n.data[i]?t.data[i].sent=!1:t.data[i]={sent:!1};break}}),Rp={token:"",isRequesting:!1},_p=(n=Rp,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{token:i}=s;switch(e.type){case Ao:t.isRequesting=!0;break;case So:t.token=i,t.isRequesting=!1;break}}),Lp={[en]:_p},wp={coinBaseValue:0,coinSuffixValue:0},Pp=(n=wp,e)=>Re(n,t=>{const{type:s,payload:i}=e;if(!i)return;const{coinBaseValue:a,coinSuffixValue:r}=i;switch(s){case Fo:t.coinBaseValue=a,t.coinSuffixValue=r;break}}),Op={[Go]:Pp},lc={settings:{...Ft},userGuideDisplays:0,customFields:{selectedLevel:0,playerUnitData:"",playerLevelProgress:0,meleeUnlockedUnitLevel:0,rangedUnlockedUnitLevel:0,coinBaseValue:0,coinSuffixValue:0,freeCoinsLastUsedTime:0,offlineRewardLastCheck:0,unitScreenAdWatchedCount:{MELEE:{},RANGED:{}}}},Dp={ASID:"",playerId:"",name:"",photo:"",locale:"",connectedPlayers:{},data:{settings:Ft,customFields:lc.customFields,userGuideDisplays:0},isUserNew:!0},vp=(n=Dp,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{name:i,value:a,data:r={},score:o,connectedPlayers:c=[],profile:l}=s;switch(e.type){case Vo:{const{playerId:h,name:u,photo:p,locale:g,data:S}=s;if(t.playerId=h,t.name=u,t.photo=p,t.locale=g,GameCore.Utils.Valid.isObject(S)){const f=S;t.data=Ie(n.data,f)}S.userGuideDisplays>0&&(t.isUserNew=!1)}break;case jo:{const{playerId:h,name:u,photo:p,locale:g,ASID:S}=l;t.ASID=S,t.playerId=h,t.name=u,t.photo=p,t.locale=g}break;case $o:t.data.score=o;break;case zo:if(!GameCore.Utils.Object.hasOwn(t.data.settings,i))break;t.data.settings[i]=a;break;case Wo:t.data=Ie(n.data,r),r.userGuideDisplays>0&&(t.isUserNew=!1);break;case Xo:{if(c.length<=0)break;const h=GameCore.Utils.Object.keyBy(c,"playerId");t.connectedPlayers=Ie(n.connectedPlayers,h)}break}}),Np={[Vs]:vp},bp={data:{},profileIds:[]},Mp=(n=bp,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{data:i=[]}=s;switch(e.type){case rn:{const a=GameCore.Utils.Object.keyBy(i,"playerId"),r=Object.keys(a);t.data=Ie({...n.data},a),t.profileIds=GameCore.Utils.Array.unique([...n.profileIds,...r])}break}}),Up={[on]:Mp},hc="match",kp="MATCH_GAMEPLAY_INITIALIZE",Bp="MATCH_GAMEPLAY_START",xp="MATCH_GAMEPLAY_FINISH",Fp="MATCH_GAMEPLAY_UPDATE",Gp="MATCH_GAMEPLAY_RESCUE",Hp="MATCH_GAMEPLAY_TYPE_UPDATE",Yp="MATCH_STATS_DATA_CLEAR",uc="MATCH_STATS_DATA_UPDATE",dc="MATCH_STATS_CURRENT_UPDATE",Kp="MATCH_STATS_CONTEXT_REQUEST",Vp="MATCH_STATS_CONTEXT_RECEIVED",Wp="MATCH_SINGLE_CREATE_REQUEST",$p="MATCH_SINGLE_DETAIL_REQUEST",jp="MATCH_SINGLE_MOVE_UPDATED",zp="MATCH_SINGLE_DATA_RECEIVED",Xp="MATCH_SINGLE_DATA_CLEAR",Zp="MATCH_CHALLENGE_JOIN_REQUEST",qp="MATCH_CHALLENGE_CREATE_REQUEST",Qp="MATCH_CHALLENGE_FINISH_REQUEST",Jp="MATCH_CHALLENGE_CONTINUE_REQUEST",pc="MATCH_CHALLENGE_DATA_RECEIVED",eg="MATCH_CHALLENGE_DATA_CLEAR",tg="MATCH_GROUP_CREATE_REQUEST",sg="MATCH_GROUP_FINISH_REQUEST",ig="MATCH_ONLINE_CREATE_REQUEST",gc="MATCH_ONLINE_DATA_RECEIVED",ng="MATCH_ONLINE_STATS_UPDATE",ag="MATCH_ONLINE_FINISH_REQUEST",rg="MATCH_ONLINE_DATA_CLEAR",ze={mode:"",status:bt,rescued:0,startAt:0,finishAt:0,type:"level"},og=(n=ze,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{mode:i,status:a,type:r}=s;switch(e.type){case kp:t.status=bt,t.mode=ze.mode,t.rescued=ze.rescued,t.startAt=ze.startAt,t.finishAt=ze.finishAt,t.opponentInfo=ze.opponentInfo,t.type=ze.type;break;case Bp:t.mode=i,t.status=ss,t.rescued=ze.rescued,t.startAt=Date.now();break;case Fp:t.mode=typeof i=="string"?i:n.mode,t.status=a||n.status;break;case xp:t.status=bs,t.finishAt=Date.now();break;case Gp:t.rescued+=1;break;case Hp:t.type=r;break}}),at={single:{_id:"",data:{fen:""},playerId:"",status:bt},group:{status:bt,opponentInfo:{playerId:"",name:"",photo:""}},challenge:{_id:"",status:bt,whitePlayerId:"",blackPlayerId:"",opponentInfo:{playerId:"",name:"",photo:""}},online:{_id:"",status:bt,players:{}},updateAt:0,isRequesting:!1},cg=(n=at,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{match:i,opponentInfo:a,players:r}=s;switch(e.type){case Wp:case $p:case Zp:case Qp:case ig:t.isRequesting=!0;break;case jp:t.single={...n.single,...i},t.updateAt=Date.now();break;case zp:t.isRequesting=!1,t.single=i||at.single;break;case Xp:t.isRequesting=!1,t.single=at.single;break;case qp:case Jp:t.isRequesting=!0,t.challenge.opponentInfo=a;break;case pc:t.isRequesting=!1,t.challenge={...i||at.challenge},t.challenge.opponentInfo=n.challenge.opponentInfo;break;case eg:t.isRequesting=!1,t.challenge=at.challenge;break;case tg:t.group.status=ss,a&&(t.group.opponentInfo=a);break;case sg:t.group.status=bs;break;case rg:t.online.status=at.online.status,t.online.players=at.online.players;break;case gc:t.online.status=ss,t.online.players=r;break;case ag:t.online.status=bs;break}}),oi={current:{updateAt:0},data:{updateAt:0},isRequesting:!1},lg=(n=oi,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{playerId:i,stats:a,match:r,current:o,players:c,leaders:l}=s;switch(e.type){case Yp:delete t.data[i],t.current=oi.current;break;case Kp:t.data=oi.data,t.isRequesting=!0;break;case Vp:t.data=a,t.isRequesting=!1;break;case uc:t.data[i]=a;break;case dc:t.current=Ie({...n.current},a);break;case gc:Object.keys(c).forEach(h=>{t.data[h]={score:0}});break;case ng:l.forEach(h=>{const{playerId:u,score:p,rank:g}=h;t.data[u]={score:p,rank:g}});break;case pc:{const{blackPlayerId:h,blackPlayerScore:u,whitePlayerId:p,whitePlayerScore:g,whitePlayerLevel:S,blackPlayerLevel:f}=r||{};if(!h||!p)break;o&&(t.current=o),t.data[h]={score:u,level:f},t.data[p]={score:g,level:S}}break}}),hg={[hc]:ec({gameplay:og,match:cg,stats:lg})},Ec="offline-reward",fc="OFFLINE_REWARD_CHECKING",mc="OFFLINE_REWARD_RECEIVED",Ac="OFFLINE_REWARD_RECEIVED_CHECKED",ug={checked:!1,valueReceived:-1,hasShowReward:!1},dg=(n=ug,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{value:i}=s;switch(e.type){case fc:t.checked=!0;break;case mc:t.valueReceived=i;break;case Ac:t.hasShowReward=!0}}),pg={[Ec]:dg},gg="leaderboards",Eg="LEADERBOARD_DATA_REQUEST",fg="LEADERBOARD_DATA_UPDATE",mg="LEADERBOARD_DATA_CLEAR",rt={leaderboardId:"",type:"",limit:0,offset:0,leaders:{},isRequesting:!1},Ag=(n=rt,e)=>Re(n,t=>{const{payload:s}=e;if(!s)return;const{leaderboardId:i,type:a,limit:r,offset:o,leaders:c}=s;switch(e.type){case Eg:n.type!==a&&o===0&&(t.leaders=rt.leaders),t.isRequesting=!0,t.leaderboardId=i,t.type=a,t.limit=r,t.offset=o;break;case fg:{if(t.isRequesting=!1,n.type!==a)break;const l=GameCore.Utils.Json.clone({...n.leaders,...c}),u=Object.values(l).filter(p=>!!p.name);u.sort((p,g)=>+g.score-+p.score),u.forEach((p,g)=>{p.rank=g+1,n.leaders[p.playerId]||(t.leaders[p.playerId]=p)})}break;case mg:t.isRequesting=!1,t.type=rt.type,t.limit=rt.limit,t.offset=rt.offset,t.leaders=rt.leaders,t.leaderboardId=rt.leaderboardId;break}}),Sg={[gg]:Ag},Tg=ec({scene:Tp,context:yp,messages:Ip,...Lp,...Op,...Np,...Up,...pg,...Sg,...hg}),{__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:z_}=window;let yg=tc;const Cg=n=>{const e=yg(rp(op));return Jo(Tg,n,e)};class Ig extends Phaser.Plugins.BasePlugin{store;initiator;init(){this.store=Cg({})}setInitiator(e){this.initiator=e}async syncStore(){this.initiator.initContext(),await this.initiator.initPlayer()}dispatch=e=>this.store.dispatch(e);getState=()=>this.store.getState();subscribe=e=>this.store.subscribe(e);watch=(e,t)=>{const s=ep(()=>{const i=this.getState();return e(i)});return this.subscribe(s(i=>{t(i)}))}}var zi={},Rg={get exports(){return zi},set exports(n){zi=n}};(function(n){(function(){function e(d,E,_){return d.call.apply(d.bind,arguments)}function t(d,E,_){if(!d)throw Error();if(2<arguments.length){var R=Array.prototype.slice.call(arguments,2);return function(){var P=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(P,R),d.apply(E,P)}}return function(){return d.apply(E,arguments)}}function s(d,E,_){return s=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?e:t,s.apply(null,arguments)}var i=Date.now||function(){return+new Date};function a(d,E){this.a=d,this.o=E||d,this.c=this.o.document}var r=!!window.FontFace;function o(d,E,_,R){if(E=d.c.createElement(E),_)for(var P in _)_.hasOwnProperty(P)&&(P=="style"?E.style.cssText=_[P]:E.setAttribute(P,_[P]));return R&&E.appendChild(d.c.createTextNode(R)),E}function c(d,E,_){d=d.c.getElementsByTagName(E)[0],d||(d=document.documentElement),d.insertBefore(_,d.lastChild)}function l(d){d.parentNode&&d.parentNode.removeChild(d)}function h(d,E,_){E=E||[],_=_||[];for(var R=d.className.split(/\s+/),P=0;P<E.length;P+=1){for(var b=!1,x=0;x<R.length;x+=1)if(E[P]===R[x]){b=!0;break}b||R.push(E[P])}for(E=[],P=0;P<R.length;P+=1){for(b=!1,x=0;x<_.length;x+=1)if(R[P]===_[x]){b=!0;break}b||E.push(R[P])}d.className=E.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function u(d,E){for(var _=d.className.split(/\s+/),R=0,P=_.length;R<P;R++)if(_[R]==E)return!0;return!1}function p(d){return d.o.location.hostname||d.a.location.hostname}function g(d,E,_){function R(){K&&P&&b&&(K(x),K=null)}E=o(d,"link",{rel:"stylesheet",href:E,media:"all"});var P=!1,b=!0,x=null,K=_||null;r?(E.onload=function(){P=!0,R()},E.onerror=function(){P=!0,x=Error("Stylesheet failed to load"),R()}):setTimeout(function(){P=!0,R()},0),c(d,"head",E)}function S(d,E,_,R){var P=d.c.getElementsByTagName("head")[0];if(P){var b=o(d,"script",{src:E}),x=!1;return b.onload=b.onreadystatechange=function(){x||this.readyState&&this.readyState!="loaded"&&this.readyState!="complete"||(x=!0,_&&_(null),b.onload=b.onreadystatechange=null,b.parentNode.tagName=="HEAD"&&P.removeChild(b))},P.appendChild(b),setTimeout(function(){x||(x=!0,_&&_(Error("Script load timeout")))},R||5e3),b}return null}function f(){this.a=0,this.c=null}function T(d){return d.a++,function(){d.a--,m(d)}}function A(d,E){d.c=E,m(d)}function m(d){d.a==0&&d.c&&(d.c(),d.c=null)}function C(d){this.a=d||"-"}C.prototype.c=function(d){for(var E=[],_=0;_<arguments.length;_++)E.push(arguments[_].replace(/[\W_]+/g,"").toLowerCase());return E.join(this.a)};function O(d,E){this.c=d,this.f=4,this.a="n";var _=(E||"n4").match(/^([nio])([1-9])$/i);_&&(this.a=_[1],this.f=parseInt(_[2],10))}function U(d){return Ae(d)+" "+(d.f+"00")+" 300px "+Y(d.c)}function Y(d){var E=[];d=d.split(/,\s*/);for(var _=0;_<d.length;_++){var R=d[_].replace(/['"]/g,"");R.indexOf(" ")!=-1||/^\d/.test(R)?E.push("'"+R+"'"):E.push(R)}return E.join(",")}function z(d){return d.a+d.f}function Ae(d){var E="normal";return d.a==="o"?E="oblique":d.a==="i"&&(E="italic"),E}function ie(d){var E=4,_="n",R=null;return d&&((R=d.match(/(normal|oblique|italic)/i))&&R[1]&&(_=R[1].substr(0,1).toLowerCase()),(R=d.match(/([1-9]00|normal|bold)/i))&&R[1]&&(/bold/i.test(R[1])?E=7:/[1-9]00/.test(R[1])&&(E=parseInt(R[1].substr(0,1),10)))),_+E}function Le(d,E){this.c=d,this.f=d.o.document.documentElement,this.h=E,this.a=new C("-"),this.j=E.events!==!1,this.g=E.classes!==!1}function ue(d){d.g&&h(d.f,[d.a.c("wf","loading")]),_t(d,"loading")}function yn(d){if(d.g){var E=u(d.f,d.a.c("wf","active")),_=[],R=[d.a.c("wf","loading")];E||_.push(d.a.c("wf","inactive")),h(d.f,_,R)}_t(d,"inactive")}function _t(d,E,_){d.j&&d.h[E]&&(_?d.h[E](_.c,z(_)):d.h[E]())}function Jc(){this.c={}}function el(d,E,_){var R=[],P;for(P in E)if(E.hasOwnProperty(P)){var b=d.c[P];b&&R.push(b(E[P],_))}return R}function ds(d,E){this.c=d,this.f=E,this.a=o(this.c,"span",{"aria-hidden":"true"},this.f)}function ps(d){c(d.c,"body",d.a)}function gs(d){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+Y(d.c)+";"+("font-style:"+Ae(d)+";font-weight:"+(d.f+"00")+";")}function Cn(d,E,_,R,P,b){this.g=d,this.j=E,this.a=R,this.c=_,this.f=P||3e3,this.h=b||void 0}Cn.prototype.start=function(){var d=this.c.o.document,E=this,_=i(),R=new Promise(function(x,K){function $(){i()-_>=E.f?K():d.fonts.load(U(E.a),E.h).then(function(J){1<=J.length?x():setTimeout($,25)},function(){K()})}$()}),P=null,b=new Promise(function(x,K){P=setTimeout(K,E.f)});Promise.race([b,R]).then(function(){P&&(clearTimeout(P),P=null),E.g(E.a)},function(){E.j(E.a)})};function In(d,E,_,R,P,b,x){this.v=d,this.B=E,this.c=_,this.a=R,this.s=x||"BESbswy",this.f={},this.w=P||3e3,this.u=b||null,this.m=this.j=this.h=this.g=null,this.g=new ds(this.c,this.s),this.h=new ds(this.c,this.s),this.j=new ds(this.c,this.s),this.m=new ds(this.c,this.s),d=new O(this.a.c+",serif",z(this.a)),d=gs(d),this.g.a.style.cssText=d,d=new O(this.a.c+",sans-serif",z(this.a)),d=gs(d),this.h.a.style.cssText=d,d=new O("serif",z(this.a)),d=gs(d),this.j.a.style.cssText=d,d=new O("sans-serif",z(this.a)),d=gs(d),this.m.a.style.cssText=d,ps(this.g),ps(this.h),ps(this.j),ps(this.m)}var Es={D:"serif",C:"sans-serif"},qs=null;function Rn(){if(qs===null){var d=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);qs=!!d&&(536>parseInt(d[1],10)||parseInt(d[1],10)===536&&11>=parseInt(d[2],10))}return qs}In.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=i(),Ln(this)};function _n(d,E,_){for(var R in Es)if(Es.hasOwnProperty(R)&&E===d.f[Es[R]]&&_===d.f[Es[R]])return!0;return!1}function Ln(d){var E=d.g.a.offsetWidth,_=d.h.a.offsetWidth,R;(R=E===d.f.serif&&_===d.f["sans-serif"])||(R=Rn()&&_n(d,E,_)),R?i()-d.A>=d.w?Rn()&&_n(d,E,_)&&(d.u===null||d.u.hasOwnProperty(d.a.c))?Qs(d,d.v):Qs(d,d.B):tl(d):Qs(d,d.v)}function tl(d){setTimeout(s(function(){Ln(this)},d),50)}function Qs(d,E){setTimeout(s(function(){l(this.g.a),l(this.h.a),l(this.j.a),l(this.m.a),E(this.a)},d),0)}function Js(d,E,_){this.c=d,this.a=E,this.f=0,this.m=this.j=!1,this.s=_}var fs=null;Js.prototype.g=function(d){var E=this.a;E.g&&h(E.f,[E.a.c("wf",d.c,z(d).toString(),"active")],[E.a.c("wf",d.c,z(d).toString(),"loading"),E.a.c("wf",d.c,z(d).toString(),"inactive")]),_t(E,"fontactive",d),this.m=!0,wn(this)},Js.prototype.h=function(d){var E=this.a;if(E.g){var _=u(E.f,E.a.c("wf",d.c,z(d).toString(),"active")),R=[],P=[E.a.c("wf",d.c,z(d).toString(),"loading")];_||R.push(E.a.c("wf",d.c,z(d).toString(),"inactive")),h(E.f,R,P)}_t(E,"fontinactive",d),wn(this)};function wn(d){--d.f==0&&d.j&&(d.m?(d=d.a,d.g&&h(d.f,[d.a.c("wf","active")],[d.a.c("wf","loading"),d.a.c("wf","inactive")]),_t(d,"active")):yn(d.a))}function Pn(d){this.j=d,this.a=new Jc,this.h=0,this.f=this.g=!0}Pn.prototype.load=function(d){this.c=new a(this.j,d.context||this.j),this.g=d.events!==!1,this.f=d.classes!==!1,il(this,new Le(this.c,d),d)};function sl(d,E,_,R,P){var b=--d.h==0;(d.f||d.g)&&setTimeout(function(){var x=P||null,K=R||null||{};if(_.length===0&&b)yn(E.a);else{E.f+=_.length,b&&(E.j=b);var $,J=[];for($=0;$<_.length;$++){var ee=_[$],oe=K[ee.c],we=E.a,Lt=ee;if(we.g&&h(we.f,[we.a.c("wf",Lt.c,z(Lt).toString(),"loading")]),_t(we,"fontloading",Lt),we=null,fs===null)if(window.FontFace){var Lt=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),gl=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);fs=Lt?42<parseInt(Lt[1],10):!gl}else fs=!1;fs?we=new Cn(s(E.g,E),s(E.h,E),E.c,ee,E.s,oe):we=new In(s(E.g,E),s(E.h,E),E.c,ee,E.s,x,oe),J.push(we)}for($=0;$<J.length;$++)J[$].start()}},0)}function il(d,E,_){var P=[],R=_.timeout;ue(E);var P=el(d.a,_,d.c),b=new Js(d.c,E,R);for(d.h=P.length,E=0,_=P.length;E<_;E++)P[E].load(function(x,K,$){sl(d,b,x,K,$)})}function On(d,E){this.c=d,this.a=E}On.prototype.load=function(d){function E(){if(b["__mti_fntLst"+R]){var x=b["__mti_fntLst"+R](),K=[],$;if(x)for(var J=0;J<x.length;J++){var ee=x[J].fontfamily;x[J].fontStyle!=null&&x[J].fontWeight!=null?($=x[J].fontStyle+x[J].fontWeight,K.push(new O(ee,$))):K.push(new O(ee))}d(K)}else setTimeout(function(){E()},50)}var _=this,R=_.a.projectId,P=_.a.version;if(R){var b=_.c.o;S(this.c,(_.a.api||"https://fast.fonts.net/jsapi")+"/"+R+".js"+(P?"?v="+P:""),function(x){x?d([]):(b["__MonotypeConfiguration__"+R]=function(){return _.a},E())}).id="__MonotypeAPIScript__"+R}else d([])};function Dn(d,E){this.c=d,this.a=E}Dn.prototype.load=function(d){var E,_,R=this.a.urls||[],P=this.a.families||[],b=this.a.testStrings||{},x=new f;for(E=0,_=R.length;E<_;E++)g(this.c,R[E],T(x));var K=[];for(E=0,_=P.length;E<_;E++)if(R=P[E].split(":"),R[1])for(var $=R[1].split(","),J=0;J<$.length;J+=1)K.push(new O(R[0],$[J]));else K.push(new O(R[0]));A(x,function(){d(K,b)})};function nl(d,E){d?this.c=d:this.c=al,this.a=[],this.f=[],this.g=E||""}var al="https://fonts.googleapis.com/css";function rl(d,E){for(var _=E.length,R=0;R<_;R++){var P=E[R].split(":");P.length==3&&d.f.push(P.pop());var b="";P.length==2&&P[1]!=""&&(b=":"),d.a.push(P.join(b))}}function ol(d){if(d.a.length==0)throw Error("No fonts to load!");if(d.c.indexOf("kit=")!=-1)return d.c;for(var E=d.a.length,_=[],R=0;R<E;R++)_.push(d.a[R].replace(/ /g,"+"));return E=d.c+"?family="+_.join("%7C"),0<d.f.length&&(E+="&subset="+d.f.join(",")),0<d.g.length&&(E+="&text="+encodeURIComponent(d.g)),E}function cl(d){this.f=d,this.a=[],this.c={}}var vn={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},ll={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},hl={i:"i",italic:"i",n:"n",normal:"n"},ul=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function dl(d){for(var E=d.f.length,_=0;_<E;_++){var R=d.f[_].split(":"),P=R[0].replace(/\+/g," "),b=["n4"];if(2<=R.length){var x,K=R[1];if(x=[],K)for(var K=K.split(","),$=K.length,J=0;J<$;J++){var ee;if(ee=K[J],ee.match(/^[\w-]+$/)){var oe=ul.exec(ee.toLowerCase());if(oe==null)ee="";else{if(ee=oe[2],ee=ee==null||ee==""?"n":hl[ee],oe=oe[1],oe==null||oe=="")oe="4";else var we=ll[oe],oe=we||(isNaN(oe)?"4":oe.substr(0,1));ee=[ee,oe].join("")}}else ee="";ee&&x.push(ee)}0<x.length&&(b=x),R.length==3&&(R=R[2],x=[],R=R?R.split(","):x,0<R.length&&(R=vn[R[0]])&&(d.c[P]=R))}for(d.c[P]||(R=vn[P])&&(d.c[P]=R),R=0;R<b.length;R+=1)d.a.push(new O(P,b[R]))}}function Nn(d,E){this.c=d,this.a=E}var pl={Arimo:!0,Cousine:!0,Tinos:!0};Nn.prototype.load=function(d){var E=new f,_=this.c,R=new nl(this.a.api,this.a.text),P=this.a.families;rl(R,P);var b=new cl(P);dl(b),g(_,ol(R),T(E)),A(E,function(){d(b.a,b.c,pl)})};function bn(d,E){this.c=d,this.a=E}bn.prototype.load=function(d){var E=this.a.id,_=this.c.o;E?S(this.c,(this.a.api||"https://use.typekit.net")+"/"+E+".js",function(R){if(R)d([]);else if(_.Typekit&&_.Typekit.config&&_.Typekit.config.fn){R=_.Typekit.config.fn;for(var P=[],b=0;b<R.length;b+=2)for(var x=R[b],K=R[b+1],$=0;$<K.length;$++)P.push(new O(x,K[$]));try{_.Typekit.load({events:!1,classes:!1,async:!0})}catch{}d(P)}},2e3):d([])};function Mn(d,E){this.c=d,this.f=E,this.a=[]}Mn.prototype.load=function(d){var E=this.f.id,_=this.c.o,R=this;E?(_.__webfontfontdeckmodule__||(_.__webfontfontdeckmodule__={}),_.__webfontfontdeckmodule__[E]=function(P,b){for(var x=0,K=b.fonts.length;x<K;++x){var $=b.fonts[x];R.a.push(new O($.name,ie("font-weight:"+$.weight+";font-style:"+$.style)))}d(R.a)},S(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+p(this.c)+"/"+E+".js",function(P){P&&d([])})):d([])};var $e=new Pn(window);$e.a.c.custom=function(d,E){return new Dn(E,d)},$e.a.c.fontdeck=function(d,E){return new Mn(E,d)},$e.a.c.monotype=function(d,E){return new On(E,d)},$e.a.c.typekit=function(d,E){return new bn(E,d)},$e.a.c.google=function(d,E){return new Nn(E,d)};var Un={load:s($e.load,$e)};n.exports?n.exports=Un:(window.WebFont=Un,window.WebFontConfig&&$e.load(window.WebFontConfig))})()})(Rg);const _g=zi;class Lg extends Phaser.Loader.File{payload;constructor(e,t){super(e,{type:"webfont",key:t.type}),this.payload=t}load(){const{type:e}=this.payload;let t;switch(e){case"google":t=this.getGoogleFontConfig(this.payload);break;case"local":t=this.getLocalFontConfig(this.payload);break}_g.load(t)}getGoogleFontConfig(e){const{character:t,fontName:s,fontWeight:i=400}=e;return{google:{families:[`${s}:${i}`],text:t},active:()=>{this.loader.nextFile(this,!0)},timeout:15e3}}getLocalFontConfig(e){const{fontName:t,fontType:s}=e,i=document.createElement("style");document.head.appendChild(i);const a=i.sheet;if(a){const o=`@font-face { font-family: "${t}"; src: url("assets/fonts/${t}${s==="opentype"?".otf":".ttf"}") format("${s}"); }`;a.insertRule(o,0)}return{custom:{families:[t]},active:()=>{this.loader.nextFile(this,!0)},timeout:15e3}}}class wg extends Phaser.Plugins.ScenePlugin{addFont(e){const t=new Lg(this.scene.load,e);this.scene.load.addFile(t)}}class Pg extends Phaser.Plugins.BasePlugin{portraitRatio;portraitWidth;portraitHeight;landscapeRatio;landscapeWidth;landscapeHeight;worldWidth;worldHeight;worldRatio;autoResize;disableLandscape;fullSizeOnLandscape;forcePixelRatio;configure(e){const{autoResize:t,portraitRatio:s,portraitWidth:i,portraitHeight:a,landscapeWidth:r,landscapeHeight:o,landscapeRatio:c,disableLandscape:l,fullSizeOnLandscape:h}=e;this.autoResize=t,this.disableLandscape=l,this.fullSizeOnLandscape=h,this.portraitRatio=s,this.portraitWidth=i,this.portraitHeight=a,this.landscapeRatio=c,this.landscapeWidth=r,this.landscapeHeight=o,this.initWorldSize(),this.addEventResize()}resize(e){e&&e>0&&(this.forcePixelRatio=e);const{width:t,height:s}=this.getCanvasSizeFixedRatio(this.worldRatio);this.resizeCanvas(t,s),this.game.scene.scenes.forEach(i=>{const a=i.cameras.main;if(!a)return;const r=this.getZoomRatio(),{width:o,height:c}=this.getWorldSize();a.setZoom(r),a.centerOn(o/2,c/2)})}resizeCanvas(e,t){this.game.canvas.width=e,this.game.canvas.height=t,this.game.scale.resize(e,t)}getWorldSize(){return{width:this.worldWidth,height:this.worldHeight}}initWorldSize(){this.worldWidth=this.portraitWidth,this.worldHeight=this.portraitHeight;const e=this.getScreenRatio();if(this.isScreenSmallerRatio(this.portraitRatio))this.worldHeight=this.worldWidth/this.getScreenRatio();else if(this.disableLandscape)this.isScreenSmallerRatio(this.portraitRatio)&&(this.worldHeight=this.worldWidth/e);else if(this.worldWidth=this.landscapeWidth,this.worldHeight=this.landscapeHeight,this.landscapeRatio>e&&(this.worldHeight=this.worldWidth/e),this.fullSizeOnLandscape){this.worldRatio=this.worldWidth/this.worldHeight,this.landscapeRatio=e;const{width:t,height:s}=this.getCanvasSizeFixedRatio(this.landscapeRatio),i=this.getZoomRatio();this.worldWidth=t/i,this.worldHeight=s/i}this.worldRatio=this.worldWidth/this.worldHeight,console.info("🚀 > this.worldRatio",this.worldRatio)}getZoomRatio(){const{width:e}=this.getWorldSize(),{width:t}=this.getCanvasSizeFixedRatio(this.worldRatio);return t/e}getPixelRatio(){if(this.forcePixelRatio>0)return this.forcePixelRatio;if(GameCore.Utils.Device.isDesktop())return 2;let e=GameCore.Utils.Device.pixelRatio();return e>2&&(e=2),e}getPhysicPixels(e,t){return e*t}getCanvasSizeFixedRatio(e){const t=this.getPixelRatio();let s=this.getScreenWidth()*t,i=this.getScreenHeight()*t;return this.isScreenSmallerRatio(e)?i=s/e:s=i*e,{width:s,height:i}}getScreenRatio(){return this.getScreenWidth()/this.getScreenHeight()}getScreenHeight(){const{body:e,documentElement:t}=document,{clientHeight:s}=e,{clientHeight:i}=t;return Math.max(i,s)||0}getScreenWidth(){const{body:e,documentElement:t}=document,{clientWidth:s}=e,{clientWidth:i}=t;return Math.max(i,s)||0}isScreenSmallerRatio(e){return this.getScreenRatio()<e}isGameWorldSmallerRatio(e){const{width:t,height:s}=this.getWorldSize();return t/s<=e}addEventResize(){this.autoResize&&window.addEventListener("resize",this.handleResize)}handleResize=os(()=>{this.resize()},300);isLandscape(){return this.worldRatio>this.portraitRatio}isUsingLandscapeBackground(){return this.worldRatio>.796}}class Og{contextId;contextType;entryPointData;constructor(e,t,s){this.contextId=e||ri.contextId,this.contextType=t||ri.contextType,this.entryPointData=s||ri.entryPointData}toObject(){return{contextId:this.contextId,contextType:this.contextType,entryPointData:this.entryPointData}}}class Dg extends Error{constructor(e,t){super(e,t),this.name="InvalidPlayerId",this.message=e||"The playerId is not valid",this.payload=t}}const xs=new ts("10","Your Friend",L.AVATAR.FILE).toObject(),vg=n=>n.context,Ng=n=>n.context.currentGameMode,bg=n=>n.context.isRequestingDetectGameMode,ls=k([vg],n=>n),gn=k([Ng],n=>n),Mg=k([bg],n=>n),Ug=(n,e,t)=>({type:yo,payload:{contextId:n,contextType:e,entryPointData:t}}),Sc=()=>(n,e)=>{const t=e(),s=ls(t),{player:i}=window.game,a=i.getPlayerId(),{contextId:r,entryPointData:o}=s,{type:c,matchId:l,playerId:h,opponentId:u=xs.playerId,tournamentContextId:p}=o||{},g=a===h,S=u===xs.playerId||[u,h].indexOf(a)>=0;let f=yu;r&&(c===void 0||c===Xn)&&(f=zn),c===Xn&&p&&(f=zn),r&&c===Ru&&!g&&(f=Ut),l&&r&&S&&c===Ks&&(f=Ut),r&&c===wo&&!g&&(f=Ut),r&&c===_u&&(f=Cu),n(kg(f))},kg=n=>e=>{e({type:Co,payload:{gameMode:n}})},Bg=n=>({type:Io,payload:{isRequestingDetectGameMode:n}}),xg={COINS:"coins",SETTINGS:"settings",GAME_DATA:"gameData",USER_GUIDE_DISPLAYS:"userGuideDisplays",FREE_COINS_LAST_USED_TIME:"freeCoinsLastUsedTime",OFFLINE_REWARD_LAST_CHECK:"offlineRewardLastCheck"};let Tc=!1,yc=!1;const Fg=n=>{Tc=n},Gg=()=>{yc=Hg()},Hg=()=>{const n=GameCore.Utils.Device,{vibrate:e}=window.navigator;return n.isAndroid()&&typeof e=="function"||n.isMobileWeb()&&typeof e=="function"||n.isIOS()},it=n=>{try{if(!Tc||!yc)return!1;const e=GameCore.Utils.Device;return(e.isAndroid()||e.isMobileWeb())&&Yg(n),!0}catch{return!1}},Yg=n=>{window.navigator.vibrate(0),window.navigator.vibrate(n)},{MaxLevel:ha}=GameCore.Configs.Gameplay;class Kg{game;constructor(e){this.game=e}initContext=()=>{const e=window.GameSDK.context.getID(),t=window.GameSDK.context.getType(),s=window.GameSDK.getEntryPointData(),i=new Og(e,t,s),{contextId:a,contextType:r,entryPointData:o}=i.toObject();this.game.storage.dispatch(Ug(a,r,o))};initPlayer=async()=>{const{player:e,storage:t}=this.game,s=this.getPlayerInfo(),i=Object.values(xg),a=await FBInstant.player.getDataAsync(i),r=new nn(a),o=r.toObject();o.settings.music===!0&&window.game.audio.playMusic(),o.settings.vibrate===!0&&Fg(!0),o.gameData.playerLevelProgress&&o.gameData.playerLevelProgress>=ha&&(o.gameData.playerLevelProgress=ha-1);const{baseValue:c,suffix:l}=o.coins;t.dispatch(Yo(c,l)),e.receiveData(s,r.convertToPlayerData())};getPlayerInfo=()=>{try{const e=window.GameSDK.player.getID();let t=window.GameSDK.player.getName();const s=window.GameSDK.player.getPhoto(),i=window.GameSDK.getLocale();if(!GameCore.Utils.Valid.isString(e))throw new Dg(null,{playerId:e});return GameCore.Utils.Valid.isString(t)||(t="You"),new ts(e,t,s,i).toObject()}catch{return new ts("123","You").toObject()}}}class Vg extends Phaser.Plugins.BasePlugin{Text;Texture;currentLocale;supportedLanguages;data;configure(e){this.applyOptions(e)}getCurrentLanguage(){return this.currentLocale}switchLanguage(e="en"){const t=this.getCorrectLocale(e);this.currentLocale=t,this.Text=this.data[t].Text,this.Texture=this.data[t].Texture}getText(e){if(typeof e=="object"){const{key:t,variables:s=[],locale:i=this.currentLocale}=e,a=this.getCorrectLocale(i),r=this.data[a].Text[t];return this.replaceVariables(r,s)}return this.Text[e]}getTexture(e){if(typeof e=="object"){const{key:t,variables:s=[],locale:i=this.currentLocale}=e,a=this.getCorrectLocale(i),r=this.data[a].Texture[t];return this.replaceVariables(r,s)}return this.Texture[e]}isSupportLanguage(e){return this.supportedLanguages.indexOf(e)>=0}applyOptions(e){const{data:t,locale:s="en",upperCaseText:i=!1}=e;this.data=t,this.supportedLanguages=Object.keys(t);const a=this.getCorrectLocale(s);if(this.currentLocale=a,this.Text=t[a].Text,this.Texture=t[a].Texture,i)for(const r in this.Text)this.Text[r]=this.Text[r].toUpperCase()}replaceVariables(e,t){const s=t.length;if(s==0)return e;let i=0;return e.replace(/{.*}/,function(){return String(t[Math.min(i++,s-1)])})}getCorrectLocale(e){let t=e.split("_")[0];return this.isSupportLanguage(t)||(t="en"),t}}const Wg={START_FIGHT:"START FIGHT",COLLECT:"Collect",SETTINGS:"Settings",SOUND_FX:"Sound Fx",MUSIC:"Music",VIBRATION:"Vibration",QUICK_FIGHT:"Quick Fight",SPEED:"Speed",LEADERBOARD:"Leaderboard",RANK:"Rank",PHOTO:"Photo",NAME:"Name",LEVEL:"Level",CHARACTER_LIST:"Character List",DINOSAURS:"Dinosaurs",WARRIORS:"Warriors",BUY:"BUY",FREE:"FREE",LOCKED:"Locked",BATTLE:"Battle",FRIENDS:"Friends",REVENGE:"Revenge",RANKING:"Ranking",HISTORY:"History",CHALLENGE_FRIENDS:`CHALLENGE
FRIENDS`,GLOBAL:"Global",WIN:"WIN",LOSE:"LOSE",FULL:"FULL",NEW_CHARACTER:"New Character",SHARE:"SHARE",SHARE_CAPITAL:"Share",VICTORY:"VICTORY",YOU_EARNED:"YOU EARNED",LEVEL_COMPLETED_BONUS_X:"Level Completed Bonus x",SPIN:"SPIN!",CLAIM:"CLAIM",CONTINUE:"Continue",FAILED:"FAILED",OFFLINE_COINS_REWARDS:"OFFLINE COINS REWARDS",X2_COINS:"X2 COINS",UNAVAILABLE:"UNAVAILABLE",REPLAY:"REPLAY",BACK_TO_SINGLEPLAY:`BACK TO
 SINGLEPLAY`,LOADING:"Loading...",VS:"VS",NO_ADS_TO_DISPLAY:"No ads to display!",WATCH_A_VIDEO:"Watch a video to get free unit!",LOADING_ADS:"Loading ads...",SORRY_NO_REWARDS:`Sorry, No Rewards!
You have cancelled the ad!`,DISPLAY_ADS_FAILED:"Display Ads Failed",UNABLE_TO_DISPLAY_ADS:`Unable to display ads.
Please try again later.`,LEADERBOARD_IS_EMPTY:"Leaderboard is empty!",NO_MATCHES_AVAILABLE:"No matches available!",GET_NOW:"GET NOW!",GET:"GET",RESET_DATA:"Reset Data",RESET_DESC:`This will reset your data and
 you will lose all your
 progress. Are you sure you
 want to continue?`,YES:"Yes",NO:"No",START_OVER_TITLE:"Completed",START_OVER_DESC:"Are you sure to start over?"},$g={TITLE:"icons/title"},jg={Text:Wg,Texture:$g},zg={START_FIGHT:"НАЧАТЬ БОЙ",COLLECT:"Собрать",SETTINGS:"Настройки",SOUND_FX:"Звуковые",MUSIC:"Музыка",VIBRATION:"Вибрация",QUICK_FIGHT:"Быстрый Бой",SPEED:"Скорость",LEADERBOARD:"Таблица Лидеров",RANK:"Ранг",PHOTO:"Фото",NAME:"Имя",LEVEL:"Уровень",CHARACTER_LIST:"Список Персонажей",DINOSAURS:"Динозавры",WARRIORS:"Воины",BUY:"КУПИТЬ",FREE:"БЕСПЛАТНО",LOCKED:"Заблокировано",BATTLE:"Бой",FRIENDS:"Друзья",REVENGE:"Месть",RANKING:"Рейтинг",HISTORY:"История",CHALLENGE_FRIENDS:`Бросьте вызов
друзьям`,GLOBAL:"Глобальный",WIN:"ПОБЕДА",LOSE:"ПОРАЖЕНИЕ",FULL:"ПОЛНЫЙ",NEW_CHARACTER:"Новый Персонаж",SHARE:"ПОДЕЛИТЬСЯ",SHARE_CAPITAL:"Поделиться",VICTORY:"ПОБЕДА",YOU_EARNED:"ВЫ ЗАРАБОТАЛИ",LEVEL_COMPLETED_BONUS_X:"Бонус За Завершение Уровня x",SPIN:"ВРАЩЕНИЕ!",CLAIM:"СОБРАТЬ",CONTINUE:"Продолжить",FAILED:"НЕУДАЧА",OFFLINE_COINS_REWARDS:"НАГРАДЫ В ОФФЛАЙНЕ",X2_COINS:"X2 МОНЕТ",UNAVAILABLE:"НЕДОСТУПЕН",REPLAY:"ПОВТОР",BACK_TO_SINGLEPLAY:`ВЕРНУТЬСЯ В
 ОДИНОЧНУЮ ИГРУ`,LOADING:"Загрузка...",VS:"ПРОТИВ",NO_ADS_TO_DISPLAY:`Нет Объявлений
Для Отображения`,WATCH_A_VIDEO:`Посмотрите Видео, Чтобы
Получить Бесплатный Юнит!`,LOADING_ADS:"Загрузка Объявлений...",SORRY_NO_REWARDS:`Извините, наград нет!
Вы отменили рекламу!`,DISPLAY_ADS_FAILED:"Отобразить рекламу не удалось",UNABLE_TO_DISPLAY_ADS:`Невозможно показать рекламу.
Пожалуйста, попробуйте
позже.`,LEADERBOARD_IS_EMPTY:"Таблица лидеров пуста!",NO_MATCHES_AVAILABLE:"Нет доступных совпадений!",GET_NOW:"ПОЛУЧИТЬ СЕЙЧАС!",GET:"ПОЛУЧИТЬ",RESET_DATA:"Сбросить данные",RESET_DESC:`Это действие приведет к сбросу
 всех ваших данных и прогресса.
 Вы уверены, что хотите
 продолжить?`,YES:"Да",NO:"Нет",START_OVER_TITLE:"Завершен",START_OVER_DESC:`Вы уверены, что начнете
 сначала?`},Xg={TITLE:"icons/title"},Zg={Text:zg,Texture:Xg},qg={START_FIGHT:"バトルスタート",COLLECT:"集める",SETTINGS:"設定",SOUND_FX:"効果音",MUSIC:"BGM",VIBRATION:"振動",QUICK_FIGHT:"クイックバトル",SPEED:"スピード",LEADERBOARD:"リーダーボード",RANK:"ランク",PHOTO:"写真",NAME:"名前",LEVEL:"レベル",CHARACTER_LIST:"キャラクターリスト",DINOSAURS:"恐竜",WARRIORS:"戦士",BUY:"購入する",FREE:"無料",LOCKED:"ロック",BATTLE:"バトル",FRIENDS:"フレンド",REVENGE:"リベンジ",RANKING:"ランキング",HISTORY:"歴史",CHALLENGE_FRIENDS:"フレンドに挑戦",GLOBAL:"ブローバル",WIN:"勝利",LOSE:"敗北",FULL:"フル",NEW_CHARACTER:"新しいキャラクター",SHARE:"シェア",SHARE_CAPITAL:"シェア",VICTORY:"勝利",YOU_EARNED:"獲得",LEVEL_COMPLETED_BONUS_X:"レベル完了ボーナス x",SPIN:"スピン",CLAIM:"受け取る",CONTINUE:"続ける",FAILED:"失敗",OFFLINE_COINS_REWARDS:"オフラインコイン報酬",X2_COINS:"X2 コイン",UNAVAILABLE:"利用不可",REPLAY:"リプレイ",BACK_TO_SINGLEPLAY:"シングルプレイに戻る",LOADING:"読み込んでいます...",VS:"VS",NO_ADS_TO_DISPLAY:"表示できる広告はありません",WATCH_A_VIDEO:`動画を視聴して無料
ユニットを獲得する！`,LOADING_ADS:"広告を読み込んでいます...",SORRY_NO_REWARDS:`リワードはありません！
広告をキャンセルしました！`,DISPLAY_ADS_FAILED:"広告の表示に失敗",UNABLE_TO_DISPLAY_ADS:`広告を表示できませんでした。
また後で試してください。`,LEADERBOARD_IS_EMPTY:"リーダーボードが空です！",NO_MATCHES_AVAILABLE:"利用可能な試合がありません",GET_NOW:"取得",GET:"取得",RESET_DATA:"データリセット",RESET_DESC:`これを行うとデータがリセットされ,
進捗状況がすべて失われます.
続けますか？`,YES:"はい",NO:"いいえ",START_OVER_TITLE:"完了",START_OVER_DESC:`本当に最初からやり直して
よろしいですか？`},Qg={TITLE:"icons/title-jp"},Jg={Text:qg,Texture:Qg},eE={START_FIGHT:"开战",COLLECT:"收集",SETTINGS:"设置",SOUND_FX:"音效",MUSIC:"音乐",VIBRATION:"振动",QUICK_FIGHT:"快速战斗",SPEED:"速度",LEADERBOARD:"排行榜",RANK:"阶级",PHOTO:"头像",NAME:"名字",LEVEL:"等级",CHARACTER_LIST:"角色列表",DINOSAURS:"恐龙",WARRIORS:"战士",BUY:"购买",FREE:"免费",LOCKED:"锁定",BATTLE:"对战",FRIENDS:"好友",REVENGE:"复仇",RANKING:"排名",HISTORY:"历史",CHALLENGE_FRIENDS:"挑战好友",GLOBAL:"全球",WIN:"获胜",LOSE:"战败",FULL:"已满",NEW_CHARACTER:"新角色",SHARE:"分享",SHARE_CAPITAL:"分享",VICTORY:"胜利",YOU_EARNED:"你赢得了",LEVEL_COMPLETED_BONUS_X:"关卡完成奖励X",SPIN:"转",CLAIM:"领取",CONTINUE:"继续",FAILED:"失败",OFFLINE_COINS_REWARDS:"离线金币奖励",X2_COINS:"X2金币",UNAVAILABLE:"不可用",REPLAY:"回放",BACK_TO_SINGLEPLAY:"返回单人模式",LOADING:"加载中……",VS:"对",NO_ADS_TO_DISPLAY:"无广告可展示",WATCH_A_VIDEO:"观看视频免费获得战力！",LOADING_ADS:"载入广告中……",SORRY_NO_REWARDS:`抱歉，没有奖励！
你已经取消了广告！`,DISPLAY_ADS_FAILED:"广告显示失败",UNABLE_TO_DISPLAY_ADS:"无法显示广告。请稍后重试。",LEADERBOARD_IS_EMPTY:"排行榜为空！",NO_MATCHES_AVAILABLE:"没有可用的比赛",GET_NOW:"今すぐ入手",GET:"得到",RESET_DATA:"重置数据",RESET_DESC:`这将重置您的数据，您将失去
所有进度。 你确定你要继续吗？`,YES:"是的",NO:"不",START_OVER_TITLE:"已完成",START_OVER_DESC:"你确定想要重来吗？"},tE={TITLE:"icons/title"},sE={Text:eE,Texture:tE},iE={START_FIGHT:"COMEÇAR LUTA",COLLECT:"COLETAR",SETTINGS:"DEFINIÇÕES",SOUND_FX:"EFEITOS DE SOM",MUSIC:"MÚSICA",VIBRATION:"VIBRAÇÃO",QUICK_FIGHT:"LUTA RÁPIDA",SPEED:"VELOC",LEADERBOARD:"CLASSIFICAÇÃO",RANK:"CLAS",PHOTO:"FOTO",NAME:"NOME",LEVEL:"NÍVEL",CHARACTER_LIST:"LISTA DE PERSONAGENS",DINOSAURS:"DINOSSAUROS",WARRIORS:"GUERREIROS",BUY:"COMPRAR",FREE:"GRÁTIS",LOCKED:"BLOQUEADO",BATTLE:"BATALHA",FRIENDS:"AMIGOS",REVENGE:"VINGANÇA",RANKING:"CLASSIFICAÇÃO",HISTORY:"HISTÓRIA",CHALLENGE_FRIENDS:"DESAFIA OS TEUS AMIGOS",GLOBAL:"GLOBAL",WIN:"VITÓRIA",LOSE:"DERROTA",FULL:"COMPLETO",NEW_CHARACTER:"NOVA PERSONAGEM!",SHARE:"PARTILHAR",SHARE_CAPITAL:"PARTILHAR",VICTORY:"VITÓRIA",YOU_EARNED:"GANHASTE",LEVEL_COMPLETED_BONUS_X:"BÓNUS DE NÍVEL COMPLETADO x",SPIN:"GIRAR",CLAIM:"REIVINDICAR",CONTINUE:"CONTINUAR",FAILED:"FALHOU",OFFLINE_COINS_REWARDS:"RECOMPENSAS OFFLINE",X2_COINS:"MOEDAS x2",UNAVAILABLE:"NÃO DISPONÍVEL",REPLAY:"REPETIÇÃO",BACK_TO_SINGLEPLAY:"VOLTAR AO JOGO INDIVIDUAL",LOADING:"A CARREGAR...",VS:"VS",NO_ADS_TO_DISPLAY:"SEM ANÚNCIOS A EXIBIR",WATCH_A_VIDEO:"VÊ UM VÍDEO PARA RECEBER UMA UNIDADE GRÁTIS!",LOADING_ADS:"A CARREGAR ANÚNCIOS...",SORRY_NO_REWARDS:`Desculpa, não há recompensas! 
Cancelaste o anúncio!`,DISPLAY_ADS_FAILED:"Falha na exibição de anúncios",UNABLE_TO_DISPLAY_ADS:`Não é possível exibir anúncios. 
Por favor, tenta novamente
 mais tarde.`,LEADERBOARD_IS_EMPTY:"Placar está vazio!",NO_MATCHES_AVAILABLE:"Nenhum jogo disponível",GET_NOW:"OBTER",GET:"OBTER",RESET_DATA:"Redefinir dados",RESET_DESC:`Isso redefinirá seus dados e
 você perderá todo o progresso.
 Você tem certeza que quer
 continuar?`,YES:"SIM",NO:"NÃO",START_OVER_TITLE:"Concluído",START_OVER_DESC:`Tens a certeza que queres
 começar de novo?`},nE={TITLE:"icons/title"},aE={Text:iE,Texture:nE},rE={START_FIGHT:"EMPEZAR PELEA",COLLECT:"RECOGER",SETTINGS:"CONFIGURACIÓN",SOUND_FX:"EFECTOS DE SONIDO",MUSIC:"MÚSICA",VIBRATION:"VIBRACIÓN",QUICK_FIGHT:"PELEA RÁPIDA",SPEED:"VELOC",LEADERBOARD:"TABLA DE CLASIFICACIÓN",RANK:"CLASIF",PHOTO:"FOTO",NAME:"NOMBRE",LEVEL:"NIVEL",CHARACTER_LIST:"LISTA DE PERSONAJES",DINOSAURS:"DINOSAURIOS",WARRIORS:"GUERREROS",BUY:"COMPRAR",FREE:"GRATIS",LOCKED:"BLOQUEADO",BATTLE:"BATALLA",FRIENDS:"AMIGOS",REVENGE:"VENGANZA",RANKING:"CLASIFICACIÓN",HISTORY:"HISTORIA",CHALLENGE_FRIENDS:"DESAFÍA A TUS AMIGOS",GLOBAL:"GLOBAL",WIN:"VICTORIA",LOSE:"DERROTA",FULL:"LLENO",NEW_CHARACTER:"¡NUEVO PERSONAJE!",SHARE:"COMPARTIR",SHARE_CAPITAL:"COMPARTIR",VICTORY:"VICTORIA",YOU_EARNED:"HAS GANADO",LEVEL_COMPLETED_BONUS_X:"BONO DE NIVEL COMPLETADO x",SPIN:"GIRAR",CLAIM:"RECLAMAR",CONTINUE:"CONTINUAR",FAILED:"FRACASO",OFFLINE_COINS_REWARDS:"RECOMPENSAS OFFLINE",X2_COINS:"MONEDAS X2",UNAVAILABLE:"NO DISPONIBLE",REPLAY:"REPETICIÓN",BACK_TO_SINGLEPLAY:"VOLVER AL JUEGO INDIVIDUAL",LOADING:"CARGANDO...",VS:"vs",NO_ADS_TO_DISPLAY:"SIN ANUNCIOS QUE MOSTRAR",WATCH_A_VIDEO:"¡MIRA UN VÍDEO PARA RECIBIR UNA UNIDAD GRATIS!",LOADING_ADS:"CARGANDO ANUNCIOS...",SORRY_NO_REWARDS:`Lo sentimos, no hay
 recompensas. ¡Has cancelado
 el anuncio!`,DISPLAY_ADS_FAILED:`Error en la visualización de
 anuncios`,UNABLE_TO_DISPLAY_ADS:`No se pueden mostrar anuncios. 
Por favor, inténtalo de nuevo
 más tarde.`,LEADERBOARD_IS_EMPTY:"¡Tabla de líderes está vacía!",NO_MATCHES_AVAILABLE:"No hay partidas disponibles",GET_NOW:"OBTENER",GET:"OBTENER",RESET_DATA:"Reiniciar datos",RESET_DESC:`Esto restablecerá sus datos y
 perderá todo el progreso. Estás
 seguro de que quieres
 continuar?`,YES:"SÍ",NO:"NO",START_OVER_TITLE:"Completo",START_OVER_DESC:`¿Estás seguro de que quieres
 empezar de nuevo?`},oE={TITLE:"icons/title"},cE={Text:rE,Texture:oE},lE={START_FIGHT:"DÖVÜŞE BAŞLA",COLLECT:"TOPLA",SETTINGS:"AYARLAR",SOUND_FX:"SES",MUSIC:"MÜZİK",VIBRATION:"TİTREŞİM",QUICK_FIGHT:"HIZLI DÖVÜŞ",SPEED:"HIZ",LEADERBOARD:"LİDERLİK TABLOSU",RANK:"SIRA",PHOTO:"FOTO",NAME:"AD",LEVEL:"SEVİYE",CHARACTER_LIST:"KARAKTER LİSTESİ",DINOSAURS:"DİNOZORLAR",WARRIORS:"SAVAŞÇILAR",BUY:"SATIN AL",FREE:"ÜCRETSİZ",LOCKED:"KİLİTLİ",BATTLE:"DÖVÜŞ",FRIENDS:"ARKADAŞLAR",REVENGE:"İNTİKAM",RANKING:"SIRALAMA",HISTORY:"GEÇMİŞ",CHALLENGE_FRIENDS:"ARKADAŞLARINA MEYDAN OKU",GLOBAL:"GENEL",WIN:"GALİBİYET",LOSE:"YENİLGİ",FULL:"TAM",NEW_CHARACTER:"YENİ KARAKTER",SHARE:"PAYLAŞ",SHARE_CAPITAL:"PAYLAŞ",VICTORY:"ZAFER",YOU_EARNED:"KAZANCIN",LEVEL_COMPLETED_BONUS_X:"SEVİYE TAMAMLAMA BONUSU x",SPIN:"DÖNDÜR",CLAIM:"TALEP ET",CONTINUE:"DEVAM",FAILED:"BAŞARISIZ",OFFLINE_COINS_REWARDS:"ÇEVRİMDIŞI PARA ÖDÜLLERİ",X2_COINS:"X2 PARA",UNAVAILABLE:"KULLANILAMIYOR",REPLAY:"YENİDEN OYNAT",BACK_TO_SINGLEPLAY:"TEKLİ OYUNA DÖN",LOADING:"YÜKLENİYOR…",VS:"VS",NO_ADS_TO_DISPLAY:"GÖRÜNTÜLENECEK REKLAM YOK",WATCH_A_VIDEO:"ÜCRETSİZ BİRİM ALMAK İÇİN VİDEO İZLE!",LOADING_ADS:"REKLAM YÜKLENİYOR...",SORRY_NO_REWARDS:`Üzgünüm, Ödül Yok!
 Reklamı iptal ettin!`,DISPLAY_ADS_FAILED:"Reklam Görüntülenemedi",UNABLE_TO_DISPLAY_ADS:`Reklam gösterilemiyor. 
Lütfen daha sonra tekrar dene.`,LEADERBOARD_IS_EMPTY:"Lider tablosu boş!",NO_MATCHES_AVAILABLE:"Eşleşme yok",GET_NOW:"AL",GET:"ŞİMDİ AL",RESET_DATA:"Veriyi sıfırla",RESET_DESC:`Bu, verilerinizi sıfırlayacak ve
 tüm ilerlemenizi
 kaybedeceksiniz. Devam etmek
 istediğine emin misin?`,YES:"EVET",NO:"HAYIR",START_OVER_TITLE:"Tamamlandı",START_OVER_DESC:`Baştan başlayacağından emin
 misin?`},hE={TITLE:"icons/title"},uE={Text:lE,Texture:hE},dE={START_FIGHT:"COMBATTRE",COLLECT:"RECEVOIR",SETTINGS:"PARAMÈTRES",SOUND_FX:"EFFETS AUDIO",MUSIC:"MUSIQUE",VIBRATION:"VIBRATIONS",QUICK_FIGHT:"COMBAT RAPIDE",SPEED:"VITESSE",LEADERBOARD:"CLASSEMENT",RANK:"PLACE",PHOTO:"PHOTO",NAME:"NOM",LEVEL:"NIVEAU",CHARACTER_LIST:"LISTE DES UNITÉS",DINOSAURS:"DINOSAURES",WARRIORS:"GUERRIERS",BUY:"ACHETER",FREE:"GRATUIT",LOCKED:"VERROUILLÉ",BATTLE:"COMBATS",FRIENDS:"AMIS",REVENGE:"VENGEANCES",RANKING:"CLASSEMENT",HISTORY:"HISTORIQUE",CHALLENGE_FRIENDS:"DÉFIER DES AMIS",GLOBAL:"MONDIAL",WIN:"VICTOIRE",LOSE:"DÉFAITE",FULL:"PLEIN",NEW_CHARACTER:"NOUVELLE UNITÉ",SHARE:"PARTAGER",SHARE_CAPITAL:"PARTAGER",VICTORY:"VICTOIRE",YOU_EARNED:"VOUS AVEZ GAGNÉ",LEVEL_COMPLETED_BONUS_X:"BONUS DE NIVEAU TERMINÉ x",SPIN:"LANCER",CLAIM:"RECEVOIR",CONTINUE:"CONTINUER",FAILED:"ÉCHEC",OFFLINE_COINS_REWARDS:"RÉCOMPENSE HORS LIGNE",X2_COINS:"PIÈCES X2",UNAVAILABLE:"INDISPONIBLE",REPLAY:"RECOMMENCER",BACK_TO_SINGLEPLAY:"REVENIR EN MODE SOLO",LOADING:"CHARGEMENT...",VS:"VS",NO_ADS_TO_DISPLAY:"AUCUNE PUB DISPONIBLE",WATCH_A_VIDEO:"REGARDEZ UNE VIDÉO ET RECEVEZ UNE UNITÉ GRATUITEMENT !",LOADING_ADS:"CHARGEMENT DES PUBS...",SORRY_NO_REWARDS:`Vous avez interrompu la
 pub ! Aucune récompense !`,DISPLAY_ADS_FAILED:"Échec de l'affichage des pubs",UNABLE_TO_DISPLAY_ADS:`Erreur lors de l'affichage des
 publicités. Réessayez
 ultérieurement.`,LEADERBOARD_IS_EMPTY:"Le tableau des leaders est vide !",NO_MATCHES_AVAILABLE:"Aucune correspondance disponible",GET_NOW:"OBTENIR",GET:"OBTENIR",RESET_DATA:"Réinitialiser",RESET_DESC:`Cela réinitialisera vos données
 et vous perdrez toute
 progression. Es-tu sur de
 vouloir continuer?`,YES:"OUI",NO:"NON",START_OVER_TITLE:"Terminé",START_OVER_DESC:`Voulez-vous vraiment
 recommencer ?`},pE={TITLE:"icons/title"},gE={Text:dE,Texture:pE},EE={START_FIGHT:"MULAI TARUNG",COLLECT:"KUMPUL",SETTINGS:"PENGATURAN",SOUND_FX:"EFEK SUARA",MUSIC:"MUSIK",VIBRATION:"GETARAN",QUICK_FIGHT:"TARUNG CEPAT",SPEED:"KECEP",LEADERBOARD:"PAPAN PERINGKAT",RANK:"RANK",PHOTO:"FOTO",NAME:"NAMA",LEVEL:"LEVEL",CHARACTER_LIST:"DAFTAR KARAKTER",DINOSAURS:"DINOSAURUS",WARRIORS:"PEJUANG",BUY:"BELI",FREE:"GRATIS",LOCKED:"TERKUNCI",BATTLE:"PERTEMPURAN",FRIENDS:"TEMAN",REVENGE:"PEMBALASAN",RANKING:"PERINGKAT",HISTORY:"RIWAYAT",CHALLENGE_FRIENDS:"TANTANG TEMAN",GLOBAL:"GLOBAL",WIN:"MENANG",LOSE:"KALAH",FULL:"PENUH",NEW_CHARACTER:"KARAKTER BARU",SHARE:"BAGIKAN",SHARE_CAPITAL:"BAGIKAN",VICTORY:"KEMENANGAN",YOU_EARNED:"KAMU MENDAPAT",LEVEL_COMPLETED_BONUS_X:"BONUS LEVEL SELESAI x",SPIN:"PUTAR",CLAIM:"KLAIM",CONTINUE:"LANJUT",FAILED:"GAGAL",OFFLINE_COINS_REWARDS:"HADIAH KOIN OFFLINE",X2_COINS:"X2 KOIN",UNAVAILABLE:"TIDAK TERSEDIA",REPLAY:"ULANGI PERMAINAN",BACK_TO_SINGLEPLAY:"KEMBALI KE MAIN TUNGGAL",LOADING:"MEMUAT...",VS:"VS",NO_ADS_TO_DISPLAY:"TIDAK ADA IKLAN UNTUK DITONTON",WATCH_A_VIDEO:"TONTON VIDEO UNTUK MENDAPAT UNIT GRATIS!",LOADING_ADS:"MEMUAT IKLAN...",SORRY_NO_REWARDS:`Maaf, Tak Ada Hadiah!
 Kamu membatalkan iklan!`,DISPLAY_ADS_FAILED:"Tonton Iklan Gagal",UNABLE_TO_DISPLAY_ADS:`Tidak bisa menonton iklan. 
Silakan coba lagi nanti.`,LEADERBOARD_IS_EMPTY:"Papan peringkat kosong!",NO_MATCHES_AVAILABLE:"Tidak ada pertandingan tersedia",GET_NOW:"AMBIL",GET:"AMBIL",RESET_DATA:"Setel ulang data",RESET_DESC:`Ini akan mengatur ulang data Anda
 dan Anda akan kehilangan semua
 kemajuan. Apakah anda yakin ingin
 melanjutkan?`,YES:"YA",NO:"TIDAK",START_OVER_TITLE:"Selesai",START_OVER_DESC:`Yakin ingin memulai dari
 awal?`},fE={TITLE:"icons/title"},mE={Text:EE,Texture:fE},AE={START_FIGHT:"KAMPFBEGINN",COLLECT:"SAMMELN",SETTINGS:"EINSTELLUNGEN",SOUND_FX:"TON",MUSIC:"MUSIK",VIBRATION:"VIBRATION",QUICK_FIGHT:"SCHNELLER KAMPF",SPEED:"GESCH",LEADERBOARD:"BESTENLISTE",RANK:"RANG",PHOTO:"FOTO",NAME:"NAME",LEVEL:"EBENE",CHARACTER_LIST:"CHARAKTERLISTE",DINOSAURS:"DINOSAURIER",WARRIORS:"KRIEGER",BUY:"KAUFEN",FREE:"KOSTENLOS",LOCKED:"GESPERRT",BATTLE:"KAMPF",FRIENDS:"FREUNDE",REVENGE:"RACHE",RANKING:"RANGLISTE",HISTORY:"VERLAUF",CHALLENGE_FRIENDS:"FREUNDE HERAUSFORDERN",GLOBAL:"GLOBAL",WIN:"SIEG",LOSE:"NIEDERLAGE",FULL:"VOLL",NEW_CHARACTER:"NEUER CHARAKTER",SHARE:"TEILEN",SHARE_CAPITAL:"TEILEN",VICTORY:"SIEG",YOU_EARNED:"VERDIENT",LEVEL_COMPLETED_BONUS_X:"BONUSBETRAG FÜR EBENEABSCHLUSS x",SPIN:"DREHEN",CLAIM:"EINFORDERN",CONTINUE:"WEITER",FAILED:"GESCHEITERT",OFFLINE_COINS_REWARDS:"OFFLINE-BELOHNUNGEN",X2_COINS:"X2 MÜNZEN",UNAVAILABLE:"NICHT VERFÜGBAR",REPLAY:"WIEDERHOLEN",BACK_TO_SINGLEPLAY:"ZURÜCK ZUM EINZELSPIELER",LOADING:"LÄDT …",VS:"VS",NO_ADS_TO_DISPLAY:"KEINE ANZEIGEN VERFÜGBAR",WATCH_A_VIDEO:`VIDEO ANSCHAUEN, UM
 KOSTENLOSE EINHEIT ZU
 ERHALTEN!`,LOADING_ADS:"ANZEIGEN WERDEN GELADEN …",SORRY_NO_REWARDS:`Leider keine Belohnungen!
 Du hast die Anzeige
 abgebrochen!`,DISPLAY_ADS_FAILED:`Abspielen von Anzeigen
 gescheitert`,UNABLE_TO_DISPLAY_ADS:`Anzeigen können nicht
 abgespielt werden. Bitte
 versuche es später noch einmal.`,LEADERBOARD_IS_EMPTY:"Die Bestenliste ist leer!",NO_MATCHES_AVAILABLE:"Keine Spiele verfügbar",GET_NOW:"BEKOMMEN",GET:"BEKOMMEN",RESET_DATA:"Zurücksetzen",RESET_DESC:`Dadurch werden Ihre Daten
 zurückgesetzt und Sie verlieren
 jeglichen Fortschritt. Bist du dir
 sicher, dass du weitermachen
 willst?`,YES:"JA",NO:"NEIN",START_OVER_TITLE:"Abgeschlossen",START_OVER_DESC:"Willst du neu starten?"},SE={TITLE:"icons/title"},TE={Text:AE,Texture:SE},yE={START_FIGHT:"INIZIA IL DUELLO",COLLECT:"RACCOGLI",SETTINGS:"IMPOSTAZIONI",SOUND_FX:"SOUND FX",MUSIC:"MUSICA",VIBRATION:"VIBRAZIONE",QUICK_FIGHT:"LOTTA VELOCE",SPEED:"VELOC",LEADERBOARD:"CLASSIFICA",RANK:"RANGO",PHOTO:"FOTO",NAME:"NOME",LEVEL:"LIVELLO",CHARACTER_LIST:"ELENCO PERSONAGGI",DINOSAURS:"DINOSAURI",WARRIORS:"GUERRIERI",BUY:"ACQUISTA",FREE:"LIBERA",LOCKED:"BLOCCATO",BATTLE:"BATTAGLIA",FRIENDS:"AMICI",REVENGE:"VENDETTA",RANKING:"CLASSIFICA",HISTORY:"CRONOLOGIA",CHALLENGE_FRIENDS:"SFIDA I TUOI AMICI",GLOBAL:"GLOBALE",WIN:"VITTORIA",LOSE:"SCONFITTA",FULL:"COMPLETATO",NEW_CHARACTER:"NUOVO PERSONAGGIO",SHARE:"CONDIVIDI",SHARE_CAPITAL:"CONDIVIDI",VICTORY:"VITTORIA",YOU_EARNED:"HAI GUADAGNATO",LEVEL_COMPLETED_BONUS_X:"LIVELLO COMPLETATO BONUS x",SPIN:"RUOTA",CLAIM:"RIVENDICA",CONTINUE:"CONTINUA",FAILED:"FALLITO",OFFLINE_COINS_REWARDS:"RICOMPENSE OFFLINE",X2_COINS:"X2 MONETE",UNAVAILABLE:"NON DISPONIBILE",REPLAY:"GIOCA ANCORA",BACK_TO_SINGLEPLAY:"TORNA AL GIOCATORE SINGOLO",LOADING:"CARICAMENTO…",VS:"VS",NO_ADS_TO_DISPLAY:`NESSUN ANNUNCIO DA
 VISUALIZZARE`,WATCH_A_VIDEO:`GUARDA UN VIDEO PER
 OTTENERE UN'UNITÀ GRATUITA!`,LOADING_ADS:"CARICAMENTO ANNUNCI...",SORRY_NO_REWARDS:`Spiacente, nessuna ricompensa!
 Hai cancellato l'annuncio!`,DISPLAY_ADS_FAILED:`Visualizzazione annunci non
 riuscita`,UNABLE_TO_DISPLAY_ADS:`Impossibile visualizzare gli
 annunci. Riprova più tardi.`,LEADERBOARD_IS_EMPTY:"La classifica è vuota!",NO_MATCHES_AVAILABLE:"Nessuna partita disponibile",GET_NOW:"OTTIENI",GET:"OTTIENI",RESET_DATA:"Reimposta i dati",RESET_DESC:`Questo ripristinerà i tuoi dati
 e perderai tutti i progressi. Sei
 sicuro di voler continuare?`,YES:"SÌ",NO:"NO",START_OVER_TITLE:"Completato",START_OVER_DESC:`Sei sicuro di voler
 ricominciare da capo?`},CE={TITLE:"icons/title"},IE={Text:yE,Texture:CE},RE={en:jg,ru:Zg,ja:Jg,zh:sE,pt:aE,es:cE,tr:uE,fr:gE,id:mE,de:TE,it:IE};class _E extends Vg{configure(e){super.configure({data:RE,locale:"en",upperCaseText:!1,...e})}}const j=n=>n[hc],LE=n=>j(n).gameplay.mode,wE=n=>j(n).gameplay.status,PE=n=>j(n).gameplay.rescued,OE=n=>j(n).gameplay.startAt,DE=n=>j(n).gameplay.finishAt,vE=n=>j(n).gameplay.type;k([LE],n=>n);k([wE],n=>n);k([PE],n=>n);k([OE],n=>n);k([DE],n=>n);const NE=k([vE],n=>n);class bE extends GameCore.Analytics.BaseAnalytics{isGamePlaying=!1;isGameStartLog=!1;constructor(e,t){super("GLanceAnalytics",{...t},"#E35360"),this.selfLog=!1}processEvent(e,t,s){if(e==v.LOAD_COMPLETE){window.sendCustomAnalyticsEvent(v.GLANCE_GAME_LOAD,{});return}}processGameEnd(e,t,s=-1e5){let i;const a=this.getCurrentGameType(),r={score:e,highScore:t};s!==-1e5&&a==="level"?i={...r,level:s}:i=r,Object.keys(i).forEach(o=>{i[o]==null&&delete i[o]}),e!=null&&t!=null&&a!="level"&&(window.game.audio.pauseMusic(),window.game.audio.muteAll()),window.sendCustomAnalyticsEvent(v.GLANCE_GAME_END,i)}processGameStart(e,t=-1e5){if(!this.isGameStartLog){this.isGameStartLog=!0,window.sendCustomAnalyticsEvent(v.GLANCE_GAME_START,{});return}let s;const i=this.getCurrentGameType(),a={score:0,highScore:e};t!==-1e5&&i==="level"?s={...a,level:t}:s=a,window.sendCustomAnalyticsEvent(v.GLANCE_GAME_REPLAY,s)}processGameLevel(e){window.sendCustomAnalyticsEvent(v.GLANCE_GAME_LEVEL,{level:e})}processPageView(e){}processLevelStart(e){if(!this.isGamePlaying){const t=window.game.player.getBestScore();this.processGameStart(t,e),this.isGamePlaying=!0}this.isGamePlaying&&this.getCurrentGameType()==="level"&&this.processGameLevel(e)}processLevelFail(e,t){if(this.isGamePlaying){if(t!=null){const s=t||0,i=window.game.player.getBestScore(),a=Math.max(i,s);this.processGameEnd(s,a,e)}else this.processGameEnd(void 0,void 0,e);this.isGamePlaying=!1}}processLevelComplete(e,t){if(this.getCurrentGameType()!=="level")return;const i=t||0;window.sendCustomAnalyticsEvent(v.GLANCE_GAME_LEVEL_COMPLETED,{level:e,score:i})}processShowRewardedVideoAd(e){}processGameMilestone(e,t={},s=0,i=0){const a=window.game.player.getBestScore();sendCustomAnalyticsEvent(v.GLANCE_GAME_MILESTONE,{type:e,meta:t,level:s,score:i,highScore:Math.max(a,i)})}processGameLifeEnd(e,t=0,s=0){const i=window.game.player.getBestScore();sendCustomAnalyticsEvent(v.GLANCE_GAME_LIFE_END,{remainingLife:e,level:t,score:s,highScore:Math.max(i,s)})}processIngameTransactions(e,t={},s=0,i=0){const a=window.game.player.getBestScore();sendCustomAnalyticsEvent(v.GLANCE_INGAME_TRANSACTIONS,{transactionType:e,meta:t,level:s,score:i,highScore:Math.max(a,i)})}getCurrentGameType(){const{storage:e}=window.game,t=e.getState();let s=NE(t);if(s!=="endless"&&s!=="level"){//! INVALID GAME TYPE
console.warn("Invalid game type detected. Game type must be either endless or level!"),s="level"}return s}}const ME=[v.SCREEN_OPEN];class X_ extends GameCore.Analytics.BaseAnalytics{game;trackingId;currentPath="/";constructor(e,t){super("GoogleAnalytics",{...t},"#E35335");const{trackingId:s}=t;this.game=e;const{consoleLog:i}=GameCore.Configs.Analytics.GoogleAnalytics||{};this.selfLog=!!i,this.trackingId=s}processEvent(e,t,s){if(ME.indexOf(e)>=0)return;const i=this.formatEventName(e);let a=t?{...t}:{};a=s?{...a,value:s}:a,a={...a,page_path:this.currentPath,send_to:"GA"},gtag("event",i,a)}processLevelStart(e,t,s){this.processEvent(v.LEVEL_START,{level:e,score:t,level_name:s})}processLevelRescue(e,t,s){this.processEvent(v.LEVEL_RESCUE,{level:e,score:t,level_name:s})}processLevelFail(e,t,s){this.processEvent(v.LEVEL_END,{level:e,score:t,level_name:s,success:!1})}processLevelComplete(e,t,s){this.processEvent(v.LEVEL_END,{level:e,score:t,level_name:s,success:!0})}processShowInterstitialAd(e){this.processEvent(v.AD_SHOW,{ad_type:"interstitial",screen_name:`${e}`}),this.processEvent(v.AD_IMPRESSION,{ad_format:"Interstitial"})}processShowRewardedVideoAd(e){this.processEvent(v.AD_SHOW,{ad_type:"rewarded_video",screen_name:`${e}`}),this.processEvent(v.AD_IMPRESSION,{ad_format:"Rewarded"})}processShowAdFail(e,t){const s=e===GameCore.Ads.Types.REWARDED?"rewarded_video":"interstitial";this.processEvent(v.AD_SHOW_FAILED,{ad_type:s,screen_name:`${t}`})}processPageView(e){const s=`/${this.getGameplayMode()}/${e}`;this.currentPath=s,gtag("event","page_view",{page_path:this.currentPath,send_to:["GA",this.trackingId]})}getGameplayMode(){const{storage:e}=this.game,t=e.getState();return gn(t)}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}}const{CheaterIds:UE}=GameCore.Configs.Gameplay;class kE extends Phaser.Scene{create(){this.facebook.progressLoading.loadingProgressFbBootScene(),this.startGame()}startGame=async()=>{try{await this.auth.requestToken(),await this.storage.syncStore();const{playerId:e}=this.player.getPlayer();window.clientInformation||(window.clientInformation={}),UE.includes(e)&&(window.clientInformation.playerIsCheater=!0),this.detectGameMode(),this.initAnalytics(),this.analytics.event(v.LOAD_START),this.scene.launch(N.GLOBAL_SCENE),this.scene.start(N.LOAD_SCENE),this.analytics.pageview(N.LOAD_SCENE)}catch{}finally{this.facebook.progressLoading.finishLoadingProgressFbBootScene(),this.scene.sleep(N.BOOT_SCENE)}};detectGameMode(){this.storage.dispatch(Sc())}initAnalytics(){this.analytics.add(new bE(this.game,{}))}}const V={NORMAL:"NORMAL",BATTLE:"BATTLE",TUTORIAL:"TUTORIAL"},he=go(),y={DEFAULT_8_BIT:{KEY:"default-8bit-resources",PATH:`./assets/textures/${he}x/`,JSON:`./assets/textures/${he}x/default-8bit-resources.json`,FRAME:{BLANK:"blank",CHALLENGE_BACK_EFFECT:"challenge-screen/back-effect",CHALLENGE_FX:"challenge-screen/fx",CHALLENGE_GLOW:"challenge-screen/glow",CHALLENGE_GRADE_BLUE:"challenge-screen/grade-blue",CHALLENGE_GRADE_RED:"challenge-screen/grade-red",CHALLENGE_ICON_ENERGY:"challenge-screen/icon-energy",CHALLENGE_SHAPE:"challenge-screen/shape",CHALLENGE_VS:"challenge-screen/vs",RESULT_SCREEN_FX_WIN:"result-screen/win-fx",RESULT_SCREEN_FX_LOSE:"result-screen/lose-fx",RESULT_SCREEN_GOLD_ICON:"result-screen/golds",RESULT_SCREEN_GREEN_BUTTON:"result-screen/green-button",RESULT_SCREEN_SINGLE_COIN_ICON:"result-screen/mini-gold",RESULT_SCREEN_LEVEL_COMPLETE_TEXT:"result-screen/level-complete",RESULT_SCREEN_CONTINUE_TEXT:"result-screen/continue",RESULT_SCREEN_WIN_TEXT:"result-screen/victory",RESULT_SCREEN_CLAIM_TEXT:"result-screen/claim",RESULT_SCREEN_EARN_TEXT:"result-screen/you-earned",RESULT_SCREEN_RIBBON_WIN:"result-screen/ribbon-green",RESULT_SCREEN_RIBBON_LOSE:"result-screen/ribbon-red",RESULT_SCREEN_YELLOW_BUTTON:"result-screen/yellow-button",RESULT_SCREEN_GREEN_BUTTON_RESULT:"result-screen/green-button-result",UNIT_UNLOCK_GLOW:"unit-unlock/glow",UNIT_UNLOCK_BG:"unit-unlock/bg",UNIT_UNLOCK_BG_1:"unit-unlock/bg-1",UNIT_UNLOCK_FRAME:"unit-unlock/frame",UNIT_UNLOCK_ICON_BATTLE:"unit-unlock/icon-battle",UNIT_UNLOCK_ICON_HEART:"unit-unlock/icon-heart",UNIT_UNLOCK_ROTATE:"unit-unlock/rotate",UNIT_REWARD_ELLIPSE_FX:"unit-reward/ellipse-fx",UNIT_REWARD_FX:"unit-reward/fx",UNIT_REWARD_GLOW:"unit-reward/glow",UNIT_REWARD_GIFT:"unit-reward/gift",UNIT_REWARD_GIFT_GLOW:"unit-reward/gift-glow",UNIT_REWARD_NO_THANKS_TEXT:"unit-reward/no-thanks-text",UNIT_REWARD_GIFT_AD:"unit-reward/gift-ad",UNIT_REWARD_PARTICLE:"unit-reward/particle",TEXT_LOADING:"loading",PRELOADER:"preloader/dual-ring",LEADERBOARD_BG_DARK:"leaderboards/bg-dark",LEADERBOARD_BG_LIGHT:"leaderboards/bg-light",LEADERBOARD_BG_LOSE:"leaderboards/bg-lose",LEADERBOARD_BG_WIN:"leaderboards/bg-win",LEADERBOARD_TAB_BG:"leaderboards/tab-bg",LEADERBOARD_TAB_LINE:"leaderboards/tab-focus",LEADERBOARD_AVATAR:"leaderboards/avatar",LEADERBOARD_RANK_GOLD:"leaderboards/rank-gold",LEADERBOARD_RANK_SILVER:"leaderboards/rank-silver",LEADERBOARD_RANK_COPPER:"leaderboards/rank-copper",LEADERBOARD_BUTTON_GREEN:"leaderboards/green-button",RIBBON_GREEN:"ribbon/green",ICON_AD:"icons/ad-icon",ICON_VIBRATION:"icons/vib",ICON_MUSIC:"icons/music",ICON_SOUND:"icons/sound",ICON_SHARE:"icons/share",ICON_BATTLE:"icons/battle",ICON_TITLE:"icons/title",ICON_TITLE_JP:"icons/title-jp",ICON_ALERT:"icons/alert",ICON_BACK_TO:"icons/back-to",ICON_REPLAY:"icons/replay",ICON_QUICK_FIGHT:"icons/quick-fight",BUTTON_CLOSE:"buttons/close",BUTTON_GREEN:"buttons/green",BUTTON_GREEN_LONG:"buttons/green-long",BUTTON_RED:"buttons/red",OFFLINE_REWARD_ADS:"offline-reward/ads",OFFLINE_REWARD_CLOSE_BTN:"offline-reward/close-btn",OFFLINE_REWARD_GOLD:"offline-reward/gold",OFFLINE_REWARD_GOLDS:"offline-reward/golds",OFFLINE_REWARD_GREEN_BTN:"offline-reward/green-btn",OFFLINE_REWARD_PARTICLE_1:"offline-reward/particle-1",OFFLINE_REWARD_PARTICLE_2:"offline-reward/particle-2",OFFLINE_REWARD_RIBBON:"offline-reward/ribbon",OFFLINE_REWARD_TICKET:"offline-reward/ticket",OFFLINE_REWARD_YELLOW_BTN:"offline-reward/yellow-btn",UNIT_SCREEN_AD_BUTTON:"unit-screen/ad-button",UNIT_SCREEN_AD_COUNT_BG:"unit-screen/ad-count-bg",UNIT_SCREEN_AD_ICON:"unit-screen/ad-icon",UNIT_SCREEN_BAR:"unit-screen/bar",UNIT_SCREEN_BG:"unit-screen/bg",UNIT_SCREEN_COIN_ICON:"unit-screen/coin-icon",UNIT_SCREEN_FRAME_1:"unit-screen/frame-1",UNIT_SCREEN_FRAME_LOCKED:"unit-screen/frame-locked",UNIT_SCREEN_ICON_BATTLE:"unit-screen/icon-battle",UNIT_SCREEN_ICON_HEART:"unit-screen/icon-heart",UNIT_SCREEN_ICON_LOCK:"unit-screen/icon-lock",UNIT_SCREEN_SLIDEBAR_BG:"unit-screen/slidebar-bg",UNIT_SCREEN_TAB_BG:"unit-screen/tab-bg",UNIT_SCREEN_TAB_FOCUS:"unit-screen/tab-focus",WHEEL_ARROW:"reward-wheel/arrow",WHEEL_LUCKY_SPIN:"reward-wheel/lucky-spin"}},DEFAULT:{KEY:"default-resources",TEXTURE:`./assets/textures/${he}x/default-resources.png`,JSON:`./assets/textures/${he}x/default-resources.json`,FRAME:{BLANK:"blank",RIBBON_BLUE:"ribbon/blue",PROGRESS_BAR_MID:"progress/bar-mid",PROGRESS_BG_LEFT:"progress/bg-left",PROGRESS_BG_MID:"progress/bg-mid",PROGRESS_BG_RIGHT:"progress/bg-right",PROGRESS_BAR_LEFT:"progress/bar-left",PROGRESS_BAR_RIGHT:"progress/bar-right",SETTINGS_SWITCH_ON:"settings/switch-on",SETTINGS_SWITCH_OFF:"settings/switch-off",TITLE_LINE:"settings/title-line",DASHBOARD_UNITBAR_BOTTOM_BG:"dashboard/unitbar-bottom-bg"}},EFFECTS:{KEY:"effects-resources",PATH:`./assets/textures/${he}x/`,JSON:`./assets/textures/${he}x/effects-resources.json`,FRAME:{BLANK:"blank",FX_COMET:"comet",FX_SPARK:"spark",FX_CIRCLE:"circle",FX_CIRCLE_LIGHT:"circle-light",FX_GLOW_LIGHT:"glow-light",FX_GLOW_SMALL:"glow-small",FX_STAR_WHITE:"star-white",FX_STAR_YELLOW:"star-yellow",FX_WHITE_GLOW:"white-glow",FX_CONFETTI_SMALL_1:"confetti/small-1",FX_CONFETTI_SMALL_2:"confetti/small-2",FX_CONFETTI_SMALL_3:"confetti/small-3",FX_CONFETTI_SMALL_4:"confetti/small-4",FX_CONFETTI_HEXAGON:"confetti/hexagon-",FX_FIREWORKS_SMALL:"fireworks/small",FX_FIREWORKS_BIG_0:"fireworks/big-explosive-0",FX_FIREWORKS_BIG_1:"fireworks/big-explosive-1",FX_FIREWORKS_SOAR_LINE:"fireworks/soar-line",FX_FIREWORKS_SOAR_CIRCLE:"fireworks/soar-circle",ANIMATION_STAR_X:"star-x/star-",ANIMATION_STAR_Y:"star-y/star-",PREFIX_ANIMATION_RIBBON_CONFETTI_A:"ribbon/falling-confetti/confetti-a/confetti-a-",PREFIX_ANIMATION_RIBBON_CONFETTI_B:"ribbon/falling-confetti/confetti-b/confetti-b-",PREFIX_ANIMATION_RIBBON_CONFETTI_C:"ribbon/falling-confetti/confetti-c/confetti-c-",PREFIX_ANIMATION_RIBBON_CONFETTI_D:"ribbon/falling-confetti/confetti-d/confetti-d-"}},ANIMATION_SCENE:{KEY:"effects-resources",PATH:`./assets/textures/${he}x/`,JSON:`./assets/textures/${he}x/animation-scene-resources.json`,FRAME:{BLANK:"blank",COIN:"coins/coin",COIN_SMALL:"coins/coin-small",COIN_SMALL_GREY:"coins/coin-small-grey",ANIMATION_STAR_X:"star-x/star-",ANIMATION_STAR_Y:"star-y/star-",FX_SPARK_YELLOW:"yellow-spark",FX_CONFETTI_RIBBON:"ribbon/ribbon",PREFIX_ANIMATION_RIBBON_CONFETTI_A:"ribbon/falling-confetti/confetti-a/confetti-a-",PREFIX_ANIMATION_RIBBON_CONFETTI_B:"ribbon/falling-confetti/confetti-b/confetti-b-",PREFIX_ANIMATION_RIBBON_CONFETTI_C:"ribbon/falling-confetti/confetti-c/confetti-c-",PREFIX_ANIMATION_RIBBON_CONFETTI_D:"ribbon/falling-confetti/confetti-d/confetti-d-"}},GAMEPLAY:{KEY:"gameplay-resources",TEXTURE:`./assets/textures/${he}x/gameplay-resources.png`,JSON:`./assets/textures/${he}x/gameplay-resources.json`,FRAME:{BLANK:"blank",GUIDE_HAND:"hand-guide/hand",GUIDE_ARROW_START:"hand-guide/arrow-start",GUIDE_ARROW_END:"hand-guide/arrow-end",GUIDE_ARROW_MIDDLE:"hand-guide/arrow-middle",HP_BAR_BG:"hp-bar/bg",TOOL_RESET:"dev-tool/reset",TOOL_EDIT:"dev-tool/edit",TOOL_ATTACK:"dev-tool/attack",TOOL_UNIT:"dev-tool/unit",ROCK:"projectiles/rock",JAVELIN:"projectiles/javelin",BOOMERANG:"projectiles/boomerang",MACE:"projectiles/mace",ARROW_1:"projectiles/arrow-1",ARROW_2:"projectiles/arrow-2",BOLT_1:"projectiles/bolt-1",BOLT_2:"projectiles/bolt-2",FIRE_RING:"projectiles/fire-ring",BLUE_FIRE:"projectiles/blue-fire",GREEN_FIRE:"projectiles/level11/green-fire-1",GREEN_FIRE_PREFIX:"projectiles/level11/green-fire-",DASHBOARD_AD_ICON:"dashboard/ad-icon",DASHBOARD_FREE_GOLD:"dashboard/btn-free-gold",DASHBOARD_FREE_GOLD_OFF:"dashboard/btn-free-gold-off",DASHBOARD_FREE_GOLD_GLOW:"dashboard/btn-free-gold-glow",DASHBOARD_COINBAR_COIN:"dashboard/coin-bar-coin",DASHBOARD_COINBAR_BG:"dashboard/coin-bar-bg",DASHBOARD_MINI_COIN:"dashboard/coin-mini",DASHBOARD_UNIT_LIST:"dashboard/btn-unit-list",DASHBOARD_UNITBAR_BG:"dashboard/unitbar-bg",DASHBOARD_UNITBAR_STAMPS:"dashboard/unitbar-stamps",DASHBOARD_UNITBAR_ARCHER:"dashboard/unitbar-archer",DASHBOARD_UNITBAR_DINO:"dashboard/unitbar-dino",DASHBOARD_START_BTN:"dashboard/btn-start",DASHBOARD_SETTINGS_BTN:"dashboard/btn-settings",DASHBOARD_LEADERBOARD_BTN:"dashboard/btn-leaderboard",DASHBOARD_BATTLE_BTN:"dashboard/btn-battle",DASHBOARD_SPEED_BTN_OFF:"dashboard/btn-speed-off",DASHBOARD_SPEED_BTN_ON:"dashboard/btn-speed-on",DASHBOARD_HPBAR_BG:"dashboard/bar/bg",DASHBOARD_HPBAR_FRONT:"dashboard/bar/bg-front",DASHBOARD_HPBAR_RED_LEFT:"dashboard/bar/red-bar/bar-left",DASHBOARD_HPBAR_RED_RIGHT:"dashboard/bar/red-bar/bar-right",DASHBOARD_HPBAR_RED_MID:"dashboard/bar/red-bar/bar-mid",DASHBOARD_HPBAR_RED:"dashboard/bar/red-bar/full-bar",DASHBOARD_HPBAR_RED_HEART:"dashboard/bar/red-bar/icon-heart-red",DASHBOARD_HPBAR_BLUE_LEFT:"dashboard/bar/blue-bar/bar-left",DASHBOARD_HPBAR_BLUE_RIGHT:"dashboard/bar/blue-bar/bar-right",DASHBOARD_HPBAR_BLUE_MID:"dashboard/bar/blue-bar/bar-mid",DASHBOARD_HPBAR_BLUE:"dashboard/bar/blue-bar/full-bar",DASHBOARD_HPBAR_BLUE_HEART:"dashboard/bar/blue-bar/icon-heart-blue",DASHBOARD_BATTLE_BUTTON_GREEN:"dashboard/btn-battle-green",DASHBOARD_BATTLE_ICON:"dashboard/icon-battle",DASHBOARD_MESSAGE_ICON:"dashboard/icon-message",DASHBOARD_AVATAR_FRAME_BLUE:"dashboard/avatar-frame-blue",DASHBOARD_AVATAR_FRAME_RED:"dashboard/avatar-frame-red",DASHBOARD_VS:"dashboard/vs",DASHBOARD_UNITBAR_BG_LANDSCAPE:"dashboard/unitbar-bg-landscape",DASHBOARD_AD_ICON_LANDSCAPE:"dashboard/ad-icon-landscape",DASHBOARD_START_BTN_LANDSCAPE:"dashboard/btn-start-landscape",PURPLE_EFFECT:"effect-text/purple-effect",EFFECT_WIN_GLOW:"effect-text/win/glow",EFFECT_WIN_SHAPE_ABOVE:"effect-text/win/shape-above",EFFECT_WIN_SHAPE_BELOW:"effect-text/win/shape-below",EFFECT_LOSE_GLOW:"effect-text/lose/glow",EFFECT_LOSE_SHAPE_ABOVE:"effect-text/lose/shape-above",EFFECT_LOSE_SHAPE_BELOW:"effect-text/lose/shape-below"}},UNITS:{KEY:"units-resources",PATH:`./assets/textures/${he}x/`,JSON:`./assets/textures/${he}x/units-resources.json`,FRAME:{DINO_MALE_DOUX_PREFIX:"dino/male/doux/doux-",DINO_MALE_KIRA_PREFIX:"dino/male/kira/kira-",DINO_MALE_LOKI_PREFIX:"dino/male/loki/loki-",DINO_MALE_MORT_PREFIX:"dino/male/mort/mort-",DINO_MALE_NICO_PREFIX:"dino/male/nico/nico-",DINO_MALE_OLAF_PREFIX:"dino/male/olaf/olaf-",DINO_MALE_TARD_PREFIX:"dino/male/tard/tard-",DINO_MALE_VITA_PREFIX:"dino/male/vita/vita-",DINO_FEMALE_DOUX_PREFIX:"dino/female/doux/doux-",DINO_FEMALE_KIRA_PREFIX:"dino/female/kira/kira-",DINO_FEMALE_LOKI_PREFIX:"dino/female/loki/loki-",DINO_FEMALE_MORT_PREFIX:"dino/female/mort/mort-",DINO_FEMALE_NICO_PREFIX:"dino/female/nico/nico-",DINO_FEMALE_OLAF_PREFIX:"dino/female/olaf/olaf-",DINO_FEMALE_TARD_PREFIX:"dino/female/tard/tard-",DINO_FEMALE_VITA_PREFIX:"dino/female/vita/vita-",LOCKED:{MELEE:{1:"dino-locked/lv01-velociraptor",2:"dino-locked/lv02-saurolophus",3:"dino-locked/lv03-pachysaurus",4:"dino-locked/lv04-triceratops",5:"dino-locked/lv05-stegosaurus",6:"dino-locked/lv06-ankylosaurus",7:"dino-locked/lv07-baroptiloraptor",8:"dino-locked/lv08-tyrannosaurus",9:"dino-locked/lv09-dilophosaurus",10:"dino-locked/lv10-triceradonosaurus",11:"dino-locked/lv11-spinosaurus-rex"},RANGED:{1:"warriors-locked/lv01-rockthrower",2:"warriors-locked/lv02-javelineer",3:"warriors-locked/lv03-boomeranger",4:"warriors-locked/lv04-macer",5:"warriors-locked/lv05-artemis",6:"warriors-locked/lv06-william",7:"warriors-locked/lv07-blanchette",8:"warriors-locked/lv08-phantom",9:"warriors-locked/lv09-oracle",10:"warriors-locked/lv10-shaman",11:"warriors-locked/lv11-seraph"}},UNLOCKED:{MELEE:{1:"dino-unlocked/lv01-velociraptor",2:"dino-unlocked/lv02-saurolophus",3:"dino-unlocked/lv03-pachysaurus",4:"dino-unlocked/lv04-triceratops",5:"dino-unlocked/lv05-stegosaurus",6:"dino-unlocked/lv06-ankylosaurus",7:"dino-unlocked/lv07-baroptiloraptor",8:"dino-unlocked/lv08-tyrannosaurus",9:"dino-unlocked/lv09-dilophosaurus",10:"dino-unlocked/lv10-triceradonosaurus",11:"dino-unlocked/lv11-spinosaurus-rex"},RANGED:{1:"warriors-unlocked/lv01-rockthrower",2:"warriors-unlocked/lv02-javelineer",3:"warriors-unlocked/lv03-boomeranger",4:"warriors-unlocked/lv04-macer",5:"warriors-unlocked/lv05-artemis",6:"warriors-unlocked/lv06-william",7:"warriors-unlocked/lv07-blanchette",8:"warriors-unlocked/lv08-phantom",9:"warriors-unlocked/lv09-oracle",10:"warriors-unlocked/lv10-shaman",11:"warriors-unlocked/lv11-seraph"}}}},UNITS_SPRITES:{KEY:"units-sprite-resources",PATH:`./assets/textures/${he}x/`,JSON:`./assets/textures/${he}x/units-sprite-resources.json`,FRAME:{MELEE:{1:{MAIN_TEXTURE:"melee-1/idle/idle-00",ATTACK_PREFIX:"melee-1/attack/attack-",DIE_PREFIX:"melee-1/die/die-",IDLE_PREFIX:"melee-1/idle/idle-",RUN_PREFIX:"melee-1/run/run-"}},RANGED:{1:{MAIN_TEXTURE:"ranged-1/idle/idle-00",ATTACK_PREFIX:"ranged-1/attack/attack-",DIE_PREFIX:"ranged-1/die/die-",IDLE_PREFIX:"ranged-1/idle/idle-"}}}},UNITS_SPINES:{MELEE:{1:{KEY:"velociraptor-spine",jsonPATH:"./assets/spines/units/melee-1/velociraptor.json",atlasPATH:"./assets/spines/units/melee-1/velociraptor.atlas"},2:{KEY:"saurolophus-spine",jsonPATH:"./assets/spines/units/melee-2/saurolophus.json",atlasPATH:"./assets/spines/units/melee-2/saurolophus.atlas"},3:{KEY:"pachysaurus-spine",jsonPATH:"./assets/spines/units/melee-3/pachysaurus.json",atlasPATH:"./assets/spines/units/melee-3/pachysaurus.atlas"},4:{KEY:"triceratops-spine",jsonPATH:"./assets/spines/units/melee-4/triceratops.json",atlasPATH:"./assets/spines/units/melee-4/triceratops.atlas"},5:{KEY:"stegosaurus-spine",jsonPATH:"./assets/spines/units/melee-5/stegosaurus.json",atlasPATH:"./assets/spines/units/melee-5/stegosaurus.atlas"},6:{KEY:"ankyntrosaurus-spine",jsonPATH:"./assets/spines/units/melee-6/ankyntrosaurus.json",atlasPATH:"./assets/spines/units/melee-6/ankyntrosaurus.atlas"},7:{KEY:"baroptiloraptor-spine",jsonPATH:"./assets/spines/units/melee-7/baroptiloraptor.json",atlasPATH:"./assets/spines/units/melee-7/baroptiloraptor.atlas"},8:{KEY:"tyrannosaurus-spine",jsonPATH:"./assets/spines/units/melee-8/tyrannosaurus.json",atlasPATH:"./assets/spines/units/melee-8/tyrannosaurus.atlas"},9:{KEY:"dilophosaurus-spine",jsonPATH:"./assets/spines/units/melee-9/dilophosaurus.json",atlasPATH:"./assets/spines/units/melee-9/dilophosaurus.atlas"},10:{KEY:"triceradonosaurus-spine",jsonPATH:"./assets/spines/units/melee-10/triceradonosaurus.json",atlasPATH:"./assets/spines/units/melee-10/triceradonosaurus.atlas"},11:{KEY:"spinosaurus-rex-spine",jsonPATH:"./assets/spines/units/melee-11/spinosaurus-rex.json",atlasPATH:"./assets/spines/units/melee-11/spinosaurus-rex.atlas"}},RANGED:{1:{KEY:"rockthrower-spine",jsonPATH:"./assets/spines/units/ranged-1/rockthrower.json",atlasPATH:"./assets/spines/units/ranged-1/rockthrower.atlas"},2:{KEY:"javelineer-spine",jsonPATH:"./assets/spines/units/ranged-2/javelineer.json",atlasPATH:"./assets/spines/units/ranged-2/javelineer.atlas"},3:{KEY:"boomeranger-spine",jsonPATH:"./assets/spines/units/ranged-3/boomeranger.json",atlasPATH:"./assets/spines/units/ranged-3/boomeranger.atlas"},4:{KEY:"macer-spine",jsonPATH:"./assets/spines/units/ranged-4/macer.json",atlasPATH:"./assets/spines/units/ranged-4/macer.atlas"},5:{KEY:"artemis-spine",jsonPATH:"./assets/spines/units/ranged-5/artemis.json",atlasPATH:"./assets/spines/units/ranged-5/artemis.atlas"},6:{KEY:"william-spine",jsonPATH:"./assets/spines/units/ranged-6/william.json",atlasPATH:"./assets/spines/units/ranged-6/william.atlas"},7:{KEY:"blanchette-spine",jsonPATH:"./assets/spines/units/ranged-7/blanchette.json",atlasPATH:"./assets/spines/units/ranged-7/blanchette.atlas"},8:{KEY:"phantom-spine",jsonPATH:"./assets/spines/units/ranged-8/phantom.json",atlasPATH:"./assets/spines/units/ranged-8/phantom.atlas"},9:{KEY:"oracle-spine",jsonPATH:"./assets/spines/units/ranged-9/oracle.json",atlasPATH:"./assets/spines/units/ranged-9/oracle.atlas"},10:{KEY:"shaman-spine",jsonPATH:"./assets/spines/units/ranged-10/shaman.json",atlasPATH:"./assets/spines/units/ranged-10/shaman.atlas"},11:{KEY:"seraph-spine",jsonPATH:"./assets/spines/units/ranged-11/seraph.json",atlasPATH:"./assets/spines/units/ranged-11/seraph.atlas"}}},SPINE_EFFECTS:{FX_MERGE:{KEY:"fx-merge-spine",jsonPATH:"./assets/spines/effects/merge/fx_merge.json",atlasPATH:"./assets/spines/effects/merge/fx_merge.atlas"}}};GameCore.Utils.Valid.isDebugger()&&(y.EFFECTS.FRAME={...y.ANIMATION_SCENE.FRAME,...y.EFFECTS.FRAME});const M={FIELD_BACKGROUND:0,BACKGROUND:1,FIREWORKS:5,FIELD_SQUARE:10,FIELD_SQUARE_RECT:11,MANAGER_BASE_DEPTH:20,ENCOURAGING:31,MESSAGE:33,POPUP:40,DEPTH_ON_DRAG:70,UNIT_HP_BAR:71,DMG_POPUP_NUMBER:80,BUTTON:90,ITEM:91,EFFECT:95,PRIORITY:100,TUTORIAL_OBJECT:101,DEBUG:110,ON_TOP:1e4},{KEY:ci,FRAME:li}=y.GAMEPLAY;class BE extends Phaser.GameObjects.Container{arrowStart;arrowEnd;arrowMiddle;expandTween;constructor(e){super(e),this.name="AdjustableArrow",this.addArrowStart(),this.addArrowEnd(),this.addArrowMiddle(),this.setDepth(M.EFFECT),this.scene.add.existing(this)}addArrowStart(){this.arrowStart=this.scene.make.image({key:ci,frame:li.GUIDE_ARROW_START,origin:{x:0,y:.5}}),this.arrowStart.setWorldSize(20,26),this.add(this.arrowStart)}addArrowEnd(){this.arrowEnd=this.scene.make.image({key:ci,frame:li.GUIDE_ARROW_END,origin:{x:1,y:.5}}),this.arrowEnd.setWorldSize(4,13),this.add(this.arrowEnd)}addArrowMiddle(){this.arrowMiddle=this.scene.make.image({key:ci,frame:li.GUIDE_ARROW_MIDDLE,origin:{x:.5,y:.5}}),this.arrowMiddle.setWorldSize(1,13),this.add(this.arrowMiddle)}changeArrowLength(e){const t=e-this.arrowStart.width-this.arrowEnd.width;this.arrowMiddle.setWorldSize(t,this.arrowMiddle.height),this.arrowEnd.setPosition(-t/2,0),this.arrowStart.setPosition(t/2,0)}runArrowExpandTween(e,t,s){const i=s-this.arrowStart.width-this.arrowEnd.width;this.arrowEnd.setPosition(-i/2,0),this.arrowStart.setPosition(-i/2,0),this.arrowMiddle.setWorldSize(0,this.arrowMiddle.height),this.expandTween=this.scene.tweens.addCounter({from:0,to:100,duration:e,completeDelay:t,ease:Phaser.Math.Easing.Cubic.Out,onUpdate:a=>{const r=a.getValue(),o=i*r/100;this.arrowMiddle.setWorldSize(o,this.arrowMiddle.height);const c=-i/2+o/2;this.arrowMiddle.setPosition(c,0);const l=-i/2+o;this.arrowStart.setPosition(l,0)},onComplete:()=>{this.setAlpha(0)},onStop:()=>{this.setAlpha(0)}})}killExpandTween(){this.expandTween?.stop()}}const{KEY:xE,FRAME:FE}=y.GAMEPLAY;class Cc extends Phaser.GameObjects.Container{hand;arrow;toGlobalX=0;toGlobalY=0;constructor(e){super(e),this.name="DragTutorialHand",this.addHand(),this.addArrow(),this.bringToTop(this.hand),this.scene.add.existing(this)}addHand(){this.hand=this.scene.make.image({key:xE,frame:FE.GUIDE_HAND,origin:{x:0,y:0}}),this.hand.setWorldSize(65.5,55.5),this.add(this.hand)}addArrow(){this.arrow=new BE(this.scene),this.arrow.setAlpha(0)}setTarget(e,t){this.toGlobalX=e,this.toGlobalY=t}playAnimation(e=0,t=800){const s=1/this.scene.world.getPixelRatio();this.hand.angle=0;const i=this.toGlobalX-this.x,a=this.toGlobalY-this.y,r=this.x+i/2,o=this.y+a/2,c=Math.sqrt(i*i+a*a)*.8;this.arrow.setPosition(r,o),this.arrow.rotation=Math.atan2(a,i),this.arrow.setAlpha(0),this.arrow.killExpandTween(),this.hand.setPosition(0,0),this.hand.setAlpha(1),this.scene?.tweens.add({delay:e,targets:this.arrow,ease:Phaser.Math.Easing.Cubic.Out,onStart:()=>{this.arrow.runArrowExpandTween(1200,200,c)},props:{alpha:{start:0,value:.5,duration:200}}}),this.scene?.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,value:1,duration:200},x:{from:0,to:i,duration:1200},y:{from:0,to:a,duration:1200}},onComplete:()=>{this.scene?.tweens.add({targets:[this.hand],delay:200,duration:200,completeDelay:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:0},onComplete:()=>{this.hand.x=0,this.hand.y=0,this.hand.scale=s,this.playAnimation(e,t)}})}})}stopAnimation(){this.scene.tweens.killTweensOf(this.hand),this.scene.tweens.killTweensOf(this.arrow)}kill(){this.arrow.kill(),super.kill()}revive(){this.arrow.revive(),super.revive()}destroy(e){this.arrow.destroy(e),super.destroy(e)}preDestroy(){this.scene.tweens.killTweensOf(this.hand),this.scene.tweens.killTweensOf(this.arrow)}}const nt={STATUS:{READY:"ready",RUNNING:"running",STOPPED:"stopped"}},{STATUS:wt}=nt;class le{state;scene;constructor(e){this.scene=e}init(){this.setState(wt.READY)}start(){this.isRunning()||this.setState(wt.RUNNING)}stop(){this.isRunning()&&this.setState(wt.STOPPED)}setState(e){this.state=e}isReady(){return this.state===wt.READY}isRunning(){return this.state===wt.RUNNING}isStopped(){return this.state===wt.STOPPED}}const{HintWaitTime:GE}=GameCore.Configs.Gameplay;class HE extends le{scene;hand;autoTimeEvent;isDragging=!1;constructor(e){super(e),this.scene=e,this.createHand()}init(){super.init()}start(){this.isRunning()||(super.start(),this.listenEvent(),this.startAutoHint())}stop(){this.isRunning()&&(super.stop(),this.isDragging=!1,this.stopListenEvent(),this.stopAutoHint())}createHand(){this.hand=new Cc(this.scene),this.hand.kill(),this.hand.setDepth(M.PRIORITY)}startAutoHint(){this.autoTimeEvent=this.scene.time.delayedCall(GE,this.handleAutomaticallyHint)}handleAutomaticallyHint=()=>{const{unitManager:e}=this.scene,t=e.getSameCoupleUnits();if(!t){this.startAutoHint();return}this.hand.stopAnimation(),this.hand.revive(),this.hand.setPosition(t.unit1.x,t.unit1.y),this.hand.setTarget(t.unit2.x,t.unit2.y),this.hand.playAnimation(500)};listenEvent(){this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.handlePlayerInteract),this.scene.input.on(Phaser.Input.Events.DRAG_START,this.handlePlayerDragging),this.scene.input.on(Phaser.Input.Events.DRAG_END,this.handlePlayerEndDrag)}stopListenEvent(){this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.handlePlayerInteract),this.scene.input.off(Phaser.Input.Events.DRAG_START,this.handlePlayerDragging),this.scene.input.off(Phaser.Input.Events.DRAG_END,this.handlePlayerEndDrag)}handlePlayerDragging=()=>{this.isDragging||(this.isDragging=!0,this.stopAutoHint())};handlePlayerEndDrag=()=>{this.isDragging=!1,this.startAutoHint()};handlePlayerInteract=()=>{this.stopAutoHint(),!this.isDragging&&this.startAutoHint()};stopAutoHint(){this.hand.kill(),this.hand.stopAnimation(),this.autoTimeEvent?.remove()}}const{KEY:Te,FRAME:ye}=y.UNITS_SPRITES,{KEY:YE,FRAME:KE}=y.GAMEPLAY,be={END:2,START:0,EVENT:5,DISPOSE:3,COMPLETE:4,INTERRUPT:1},W={MELEE:{RUN:"run",DIE:"die",IDLE:"idle",ATTACK:"attack",CUSTOM_EVENTS:{FINISHED_ATTACKING:"finished_attacking"}},RANGED:{DIE:"die",IDLE:"idle",ATTACK:"attack",ATTACK_ABOVE:"attack_above",ATTACK_BELOW:"attack_below",CUSTOM_EVENTS:{FINISHED_ATTACKING:"finished_attacking"}}},Fs={GREEN_FIRE:{KEY:"confetti-hexagon-animation",TEXTURE:YE,PREFIX:KE.GREEN_FIRE_PREFIX,FRAME_RATE:30,START:1,END:3,ZERO_PAD:0}},ne={MELEE:{1:{ATTACK:{KEY:"velociraptor-attack",TEXTURE:Te,PREFIX:ye.MELEE[1].ATTACK_PREFIX,FRAME_RATE:30,EVENT_FRAME:9,START:0,END:20,ZERO_PAD:2},DIE:{KEY:"velociraptor-die",TEXTURE:Te,PREFIX:ye.MELEE[1].DIE_PREFIX,FRAME_RATE:20,START:0,END:19,ZERO_PAD:2},IDLE:{KEY:"velociraptor-idle",TEXTURE:Te,PREFIX:ye.MELEE[1].IDLE_PREFIX,FRAME_RATE:30,START:0,END:39,ZERO_PAD:2},RUN:{KEY:"velociraptor-move",TEXTURE:Te,PREFIX:ye.MELEE[1].RUN_PREFIX,FRAME_RATE:40,START:0,END:20,ZERO_PAD:2}}},RANGED:{1:{ATTACK_ABOVE:{KEY:"rockthrower-attack",TEXTURE:Te,PREFIX:ye.RANGED[1].ATTACK_PREFIX,FRAME_RATE:30,EVENT_FRAME:16,START:0,END:29,ZERO_PAD:2},ATTACK_BELOW:{KEY:"rockthrower-attack",TEXTURE:Te,PREFIX:ye.RANGED[1].ATTACK_PREFIX,FRAME_RATE:30,EVENT_FRAME:16,START:0,END:29,ZERO_PAD:2},DIE:{KEY:"rockthrower-die",TEXTURE:Te,PREFIX:ye.RANGED[1].DIE_PREFIX,FRAME_RATE:24,START:0,END:23,ZERO_PAD:2},IDLE:{KEY:"rockthrower-idle",TEXTURE:Te,PREFIX:ye.RANGED[1].IDLE_PREFIX,FRAME_RATE:24,START:0,END:23,ZERO_PAD:2}}},ALIEN:{1:{ATTACK:{KEY:"velociraptor-attack",TEXTURE:Te,PREFIX:ye.MELEE[1].ATTACK_PREFIX,FRAME_RATE:30,START:0,END:29,ZERO_PAD:2},DIE:{KEY:"velociraptor-die",TEXTURE:Te,PREFIX:ye.MELEE[1].DIE_PREFIX,FRAME_RATE:20,START:0,END:19,ZERO_PAD:2},IDLE:{KEY:"velociraptor-idle",TEXTURE:Te,PREFIX:ye.MELEE[1].IDLE_PREFIX,FRAME_RATE:40,START:0,END:39,ZERO_PAD:2},RUN:{KEY:"velociraptor-move",TEXTURE:Te,PREFIX:ye.MELEE[1].RUN_PREFIX,FRAME_RATE:25,START:0,END:24,ZERO_PAD:2}}}},{KEY:VE,TEXTURE:WE,FRAME_RATE:$E,START:jE,END:zE,PREFIX:XE,ZERO_PAD:ZE}=ne.ALIEN[1].ATTACK;class qE extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:$E,frames:e.generateFrameNames(WE,{prefix:XE,start:jE,end:zE,zeroPad:ZE}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,VE,t)}}const{KEY:QE,TEXTURE:JE,FRAME_RATE:ef,START:tf,END:sf,PREFIX:nf,ZERO_PAD:af}=ne.ALIEN[1].DIE;class rf extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:ef,frames:e.generateFrameNames(JE,{prefix:nf,start:tf,end:sf,zeroPad:af}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,QE,t)}}const{KEY:of,TEXTURE:cf,FRAME_RATE:lf,START:hf,END:uf,PREFIX:df,ZERO_PAD:pf}=ne.ALIEN[1].IDLE;class gf extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:lf,frames:e.generateFrameNames(cf,{prefix:df,start:hf,end:uf,zeroPad:pf}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,of,t)}}const{KEY:Ef,TEXTURE:ff,FRAME_RATE:mf,START:Af,END:Sf,PREFIX:Tf,ZERO_PAD:yf}=ne.ALIEN[1].RUN;class Cf extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:mf,frames:e.generateFrameNames(ff,{prefix:Tf,start:Af,end:Sf,zeroPad:yf}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,Ef,t)}}const{KEY:If,TEXTURE:Rf,FRAME_RATE:_f,START:Lf,END:wf,PREFIX:Pf,ZERO_PAD:Of}=ne.MELEE[1].ATTACK;class Df extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:_f,frames:e.generateFrameNames(Rf,{prefix:Pf,start:Lf,end:wf,zeroPad:Of}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,If,t)}}const{KEY:vf,TEXTURE:Nf,FRAME_RATE:bf,START:Mf,END:Uf,PREFIX:kf,ZERO_PAD:Bf}=ne.MELEE[1].DIE;class xf extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:bf,frames:e.generateFrameNames(Nf,{prefix:kf,start:Mf,end:Uf,zeroPad:Bf}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,vf,t)}}const{KEY:Ff,TEXTURE:Gf,FRAME_RATE:Hf,START:Yf,END:Kf,PREFIX:Vf,ZERO_PAD:Wf}=ne.MELEE[1].IDLE;class $f extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:Hf,frames:e.generateFrameNames(Gf,{prefix:Vf,start:Yf,end:Kf,zeroPad:Wf}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,Ff,t)}}const{KEY:jf,TEXTURE:zf,FRAME_RATE:Xf,START:Zf,END:qf,PREFIX:Qf,ZERO_PAD:Jf}=ne.MELEE[1].RUN;class em extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:Xf,frames:e.generateFrameNames(zf,{prefix:Qf,start:Zf,end:qf,zeroPad:Jf}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,jf,t)}}const{KEY:tm,TEXTURE:sm,FRAME_RATE:im,START:nm,END:am,PREFIX:rm,ZERO_PAD:om}=Fs.GREEN_FIRE;class cm extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:im,frames:e.generateFrameNames(sm,{prefix:rm,start:nm,end:am,zeroPad:om}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,tm,t)}}const{KEY:lm,TEXTURE:hm,FRAME_RATE:um,START:dm,END:pm,PREFIX:gm,ZERO_PAD:Em}=ne.RANGED[1].ATTACK_ABOVE;class fm extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:um,frames:e.generateFrameNames(hm,{prefix:gm,start:dm,end:pm,zeroPad:Em}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,lm,t)}}const{KEY:mm,TEXTURE:Am,FRAME_RATE:Sm,START:Tm,END:ym,PREFIX:Cm,ZERO_PAD:Im}=ne.RANGED[1].DIE;class Rm extends Phaser.Animations.Animation{constructor(e){const t={repeat:0,frameRate:Sm,frames:e.generateFrameNames(Am,{prefix:Cm,start:Tm,end:ym,zeroPad:Im}),showOnStart:!0,hideOnComplete:!1,skipMissedFrames:!0};super(e,mm,t)}}const{KEY:_m,TEXTURE:Lm,FRAME_RATE:wm,START:Pm,END:Om,PREFIX:Dm,ZERO_PAD:vm}=ne.RANGED[1].IDLE;class Nm extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:wm,frames:e.generateFrameNames(Lm,{prefix:Dm,start:Pm,end:Om,zeroPad:vm}),showOnStart:!0,hideOnComplete:!0,skipMissedFrames:!0};super(e,_m,t)}}class bm extends le{scene;constructor(e){super(e),this.scene=e}addLevel11ProjectileAnimation(){if(!this.scene.anims.exists(Fs.GREEN_FIRE.KEY)){const e=new cm(this.scene.anims);this.scene.anims.add(Fs.GREEN_FIRE.KEY,e)}}addAlienAnimation(){const{ATTACK:e,DIE:t,IDLE:s}=ne.ALIEN[1];if(!this.scene.anims.exists(s.KEY)){const i=new gf(this.scene.anims);this.scene.anims.add(s.KEY,i)}if(!this.scene.anims.exists(e.KEY)){const i=new Cf(this.scene.anims);this.scene.anims.add(e.KEY,i)}if(!this.scene.anims.exists(s.KEY)){const i=new qE(this.scene.anims);this.scene.anims.add(s.KEY,i)}if(!this.scene.anims.exists(t.KEY)){const i=new rf(this.scene.anims);this.scene.anims.add(t.KEY,i)}}addMeleeLevel1Animation(){const{ATTACK:e,DIE:t,IDLE:s,RUN:i}=ne.MELEE[1];if(!this.scene.anims.exists(e.KEY)){const a=new Df(this.scene.anims);this.scene.anims.add(e.KEY,a)}if(!this.scene.anims.exists(t.KEY)){const a=new xf(this.scene.anims);this.scene.anims.add(t.KEY,a)}if(!this.scene.anims.exists(s.KEY)){const a=new $f(this.scene.anims);this.scene.anims.add(s.KEY,a)}if(!this.scene.anims.exists(i.KEY)){const a=new em(this.scene.anims);this.scene.anims.add(i.KEY,a)}}addRangedLevel1Animation(){const{ATTACK_ABOVE:e,DIE:t,IDLE:s}=ne.RANGED[1];if(!this.scene.anims.exists(e.KEY)){const i=new fm(this.scene.anims);this.scene.anims.add(e.KEY,i)}if(!this.scene.anims.exists(t.KEY)){const i=new Rm(this.scene.anims);this.scene.anims.add(t.KEY,i)}if(!this.scene.anims.exists(s.KEY)){const i=new Nm(this.scene.anims);this.scene.anims.add(s.KEY,i)}}checkIfAnimationIsAdded(e){return this.scene.anims.exists(e)}addMeleeUnitAnimationBasedOnLevel(e){switch(e){case 1:this.addMeleeLevel1Animation();break;default:this.addAlienAnimation()}}addRangedUnitAnimationBasedOnLevel(e){switch(e){case 1:this.addRangedLevel1Animation();break;default:this.addAlienAnimation()}}}const D={MELEE_UNIT_TYPE:"melee",RANGED_UNIT_TYPE:"ranged",ALIEN_UNIT_TYPE:"alien",MELEE_ATTACK_RANGE:40,MELEE_MOVEMENT_SPEED:100,MELEE_ATTACK_INTERVAL:800,RANGED_ATTACK_INTERVAL:1100,RANGED_PROJECTILE_SPEED:600,BASE_UNIT_COIN:2,UNIT_COIN_SCALE:1.6,COINS_PER_ATTACK:1,ATTACK_COIN_SCALE:1.6,MULTIPLY_REWARD_ROUND:6,MULTIPLY_REWARD_BATTLE:2,UNIT_SIZE_SCALE:1,UNIT_PRICE_CUSTOM_MODIFIER:[[1,1],[3,5],[10,2],[25,1.5],[40,1.5]],ATTACK_CUSTOM_MODIFIER:[[1,1],[9,2],[30,1.2]],AD_WATCH_REQUIREMENT:[0,1,2,3,4,5,7,9,12,15,20],BUYING_UNIT_LEVEL:[1,51,151,251]},{MULTIPLY_REWARD_ROUND:Mm,UNIT_COIN_SCALE:hi,BASE_UNIT_COIN:Um,COINS_PER_ATTACK:km,ATTACK_COIN_SCALE:ui,MULTIPLY_REWARD_BATTLE:Bm}=D;class xm extends le{scene;unitModifier;currentUnitModifier;attackModifier;currentAttackModifier;totalCoinsByAttack;constructor(e){super(e),this.scene=e,this.initModifier()}initModifier(){this.unitModifier=new F(1),this.attackModifier=new F(1),this.currentUnitModifier=new F(1)}init(){super.init(),this.totalCoinsByAttack=new F(0)}getUnitPrice(e){const t=e||0,s=new F(Um),i=s.clone();return i.multiply(t),i.multiply(this.unitModifier),i.biggerThan(s)?i:s}getAttackCoinByUnit(e,t){const s=(e.level-1)*.75+km,i=this.attackModifier.clone();i.multiply(s);const a=t.currentHp,r=e.attackPower;return a<r&&(i.multiply(a),i.divide(r)),i.biggerThan(new F(1))?i:new F(1)}setUnitModifier(e,t=1){if(e<=50){const s=Math.pow(hi,e);this.currentUnitModifier=new F(1),this.currentUnitModifier.multiply(s)}else{const s=Math.pow(hi,50),i=Math.floor(e/50),a=e%50;this.currentUnitModifier=new F(1);for(let o=0;o<i;o++)this.currentUnitModifier.multiply(s);const r=Math.pow(hi,a);this.currentUnitModifier.multiply(r)}this.currentUnitModifier.multiply(t),this.unitModifier=this.currentUnitModifier}getUnitModifier(){return this.unitModifier}setAttackModifier(e,t=1){if(e<=50){const s=Math.pow(ui,e);this.currentAttackModifier=new F(1),this.currentAttackModifier.multiply(s)}else{const s=Math.pow(ui,50),i=Math.floor(e/50),a=e%50;this.currentAttackModifier=new F(1);for(let o=0;o<i;o++)console.log("Attack modifier: ",this.attackModifier.toString()),this.currentAttackModifier.multiply(s),this.currentAttackModifier.multiply(1.5),console.log("Attack modifier: ",this.attackModifier.toString());const r=Math.pow(ui,a);this.currentAttackModifier.multiply(r)}this.currentAttackModifier.multiply(t),this.attackModifier=this.currentAttackModifier}getAttackModifier(){return this.attackModifier}addCoinsByAttack(e){this.totalCoinsByAttack.add(e)}getTotalCoinsByAttack(){return this.totalCoinsByAttack.clone()}getRewardCoinsByAttackCoins(){const{gameMode:e}=this.scene,t=this.totalCoinsByAttack.clone();return t.multiply(Mm),e===V.BATTLE&&t.multiply(Bm),t}}const{UNIT_PRICE_CUSTOM_MODIFIER:di,ATTACK_CUSTOM_MODIFIER:pi}=D;class Fm extends le{scene;currentGameMode;unitLevelsUpdated;customUnitModifier;attackLevelsUpdated;customAttackModifier;constructor(e){super(e),this.scene=e,this.intData()}intData(){this.currentGameMode=V.NORMAL,this.unitLevelsUpdated=[!1],this.customUnitModifier=0,this.attackLevelsUpdated=[!1],this.customAttackModifier=0,GameCore.Utils.Valid.isDebugger()&&localStorage.clear(),this.initDataToolDev()}init(){const{levelManager:e}=this.scene;(this.scene.gameMode!==this.currentGameMode||e.isInLevelBuilderLevel())&&(this.currentGameMode=this.scene.gameMode,this.unitLevelsUpdated=[!1],this.customUnitModifier=0,this.attackLevelsUpdated=[!1],this.customAttackModifier=0)}initDataToolDev(){if(!GameCore.Utils.Valid.isDebugger())return;if(!ft("DevCustomUnitMod")){const s={};di.forEach(i=>{s[i[0]]=i[1]}),mt("DevCustomUnitMod",s)}if(!ft("DevCustomAttackMod")){const s={};pi.forEach(i=>{s[i[0]]=i[1]}),mt("DevCustomAttackMod",s)}}addCustomUnitModifier(e){this.customUnitModifier+=e}updateCustomUnitModifierByLevel(e){if(this.updateCustomUnitModSuccessByDevTool(e))return;for(let s=0;s<di.length;s++){const i=di[s],a=i[0],r=i[1];if(a>e)break;this.unitLevelsUpdated[a]||(this.addCustomUnitModifier(r),this.unitLevelsUpdated[a]=!0)}const{coinManager:t}=this.scene;t.setUnitModifier(e,this.customUnitModifier)}updateCustomUnitModSuccessByDevTool(e){if(!GameCore.Utils.Valid.isDebugger())return!1;const t=ft("DevCustomUnitMod");if(!GameCore.Utils.Valid.isObject(t))return!1;let s=0;for(const[r,o]of Object.entries(t)){const c=parseInt(r),l=o;if(c>e)break;c===e&&(s=l),this.unitLevelsUpdated[c]||(this.addCustomUnitModifier(l),this.unitLevelsUpdated[c]=!0)}const{coinManager:i,devToolManager:a}=this.scene;return i.setUnitModifier(e,this.customUnitModifier),a.setCurrentUnitModText(s,i.getUnitModifier()),!0}editCurrentLevelUnitMod(e){const{levelManager:t}=this.scene,s=t.getCurrentLevelId(),i=ft("DevCustomUnitMod");if(GameCore.Utils.Valid.isObject(i)){const r=i[s];this.customUnitModifier=this.customUnitModifier-r+e,mt("DevCustomUnitMod",{[s]:e})}else this.addCustomUnitModifier(e),this.unitLevelsUpdated[s]=!0,mt("DevCustomUnitMod",{[s]:e});const{coinManager:a}=this.scene;return a.setUnitModifier(s,this.customUnitModifier),a.getUnitModifier()}addCustomAttackModifier(e){this.customAttackModifier+=e}updateCustomAttackModifierByLevel(e){if(this.updateCustomAttackModSuccessByDevTool(e))return;for(let s=0;s<pi.length;s++){const i=pi[s],a=i[0],r=i[1];if(a>e)break;this.attackLevelsUpdated[a]||(this.addCustomAttackModifier(r),this.attackLevelsUpdated[a]=!0)}const{coinManager:t}=this.scene;t.setAttackModifier(e,this.customAttackModifier)}updateCustomAttackModSuccessByDevTool(e){if(!GameCore.Utils.Valid.isDebugger())return!1;const t=ft("DevCustomAttackMod");if(!GameCore.Utils.Valid.isObject(t))return!1;let s=0;for(const[r,o]of Object.entries(t)){const c=parseInt(r),l=o;if(c>e)break;c===e&&(s=l),this.attackLevelsUpdated[c]||(this.addCustomAttackModifier(l),this.attackLevelsUpdated[c]=!0)}const{coinManager:i,devToolManager:a}=this.scene;return i.setAttackModifier(e,this.customAttackModifier),a.setCurrentAttackModText(s,i.getAttackModifier()),!0}editCurrentLevelAttackMod(e){const{levelManager:t}=this.scene,s=t.getCurrentLevelId(),i=ft("DevCustomAttackMod");if(GameCore.Utils.Valid.isObject(i)){const r=i[s];this.customAttackModifier=this.customAttackModifier-r+e,mt("DevCustomAttackMod",{[s]:e})}else this.addCustomAttackModifier(e),this.attackLevelsUpdated[s]=!0,mt("DevCustomAttackMod",{[s]:e});const{coinManager:a}=this.scene;return a.setAttackModifier(s,this.customAttackModifier),a.getAttackModifier()}}class me{scene;config;isStarted;tween;constructor(e,t){if(t.targets.length<1)return;this.buildConfig(e,t);const{scene:s}=this.config.targets[0];s instanceof Phaser.Scene&&(this.scene=s,this.isStarted=!1,this.tween=s.tweens.create(this.config))}buildConfig(e,t){this.config=Ie(e,t)}play(){if(this.tween){if(this.isStarted&&this.tween.hasStarted){this.restart();return}this.tween.play(!0),this.isStarted=!0}}restart(){this.tween?.restart()}stop(){this.tween?.stop()}remove(){this.tween?.remove()}next(e){return this.tween?(this.tween.off(Phaser.Tweens.Events.TWEEN_COMPLETE,e),this.tween.once(Phaser.Tweens.Events.TWEEN_COMPLETE,e),this.tween):null}}const Gm={targets:[],props:{alpha:{duration:500,value:{start:0,from:0,to:1},ease:Phaser.Math.Easing.Cubic.Out},scale:{duration:1e3,value:{start:.8,from:.8,to:1},ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}}};class Ic extends me{baseScales;constructor(e){super(Gm,e)}}const Hm={targets:[],duration:1e3,ease:Phaser.Math.Easing.Quadratic.InOut,props:{scale:.2}};class Xi extends me{spline;constructor(e){super(Hm,e);const{curve:t}=this.config;t&&(this.spline=new Phaser.Curves.Spline(t),this.tween?.on(Phaser.Tweens.Events.TWEEN_START,this.createCounter))}createCounter=(e,t)=>{const{onCurveUpdate:s}=this.config,i=typeof s=="function"?s:null;t.forEach((a,r)=>{if(!this.scene)return;const{duration:o,delay:c}=e.data[r],l=new Phaser.Math.Vector2;this.scene.tweens.addCounter({delay:c,duration:o,ease:Phaser.Math.Easing.Quadratic.InOut,onUpdate:h=>{this.spline.getPoint(h.getValue(),l),a.x=l.x,a.y=l.y,i&&i(a)}})})}}const w={PRIMARY:{KEY:"LilitaOne-ru",TEXTURE:"./assets/fonts/LilitaOne-ru.png",DATA:"./assets/fonts/LilitaOne-ru.xml"},SYSTEM_FAMILY_FONT:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',FONT_FAMILY:"LilitaOne"},G={CONGRATULATION:"congratulation",DAILY_REWARD:"daily_reward",DIAMONDS_DROP:"diamonds_drop",DIAMONDS_EAT:"diamonds_eat",FIREWORKS_BIG:"fireworks_big",FIREWORKS_SOAR:"fireworks_soar",FIREWORKS_SMALL:"fireworks_small",GEM_DROP:"gem_drop",GAME_OVER_SCENE:"game_over_scene",MISSION_COMPLETED:"mission_completed",MISSION_REWARD:"mission_reward",MOVE_WRONG:"move_wrong",START_LEVEL:"start_level",POPUP_OFF:"popup_off",POPUP_SHOW:"popup_show",SCORE_COUNTER:"score_counter",START_GAME:"start_game",YOU_LOSE:"you_lose",YOU_WIN:"you_win",NEXT_ROUND_EFFECT:"next-round-effect",LOSE_SOUND:"lose-sound",THUNDER_SOUND:"thunder-sound",CLOSE_CLICK:"close-click",BUTTON_CLICK:"button-click",UNIT_DRAG_END:"drag-unit-end",UNIT_DRAG_START:"drag-unit-start",START_BATTLE:"start-battle",MELEE_ATTACK:"melee-attack",ARROW_SHOOT:"arrow-shoot",UNIT_DAMAGED:"unit-damaged",UNIT_MERGE:"unit-merge",WIN_BATTLE:"win-battle",TURN_SWITCH:"turn-switch",UNIT_UNLOCK:"unit-unlock",COIN_SPAWN_SOUND:"coin-spawn",COIN_INCREASE_REPEATEDLY_SOUND:"coin-increase-repeatedly",GIFT_CHARGE:"gift-charge",GIFT_EXPLODE:"gift-explode",GIFT_REVEAL:"gift-reveal"},{KEY:Ym,FRAME:ua}=y.EFFECTS;class Rc extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,Ym,ua.FX_STAR_YELLOW),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:ua.FX_COMET,emitZone:{source:this.emitZone,type:"random"},speed:20,timeScale:1,frequency:100,alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*2,end:e*.1,ease:Phaser.Math.Easing.Expo.Out},lifespan:2666})}run(e,t,s,i,a){this.stop(),this.reset(),this.emitZone.setSize(i,a),this.emitZone.setPosition(t-i/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}explode(e,t,s){this.emitter||this.reset(),this.emitter.explode(e,t,s)}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:Km,FRAME:da}=y.EFFECTS;class _c extends Phaser.GameObjects.Particles.ParticleEmitterManager{deathZone;emitter;constructor(e){super(e,Km,da.FX_SPARK),this.createDeathZone(),this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createDeathZone(){this.deathZone=new Phaser.Geom.Circle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:da.FX_SPARK,speed:{min:10,max:1200},scale:{start:e*1.33,end:0},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},deathZone:{source:this.deathZone,type:"onLeave"},lifespan:3e3})}explode(e,t,s,i){this.setActive(!0),this.setVisible(!0),this.deathZone.radius=i,this.deathZone.setPosition(t,s),this.emitter.explode(e,t,s)}stop(){this.emitter.forEachAlive(e=>{e.lifeCurrent=0},this)}}const{FX_MERGE:Vm}=y.SPINE_EFFECTS,{KEY:Xe,FRAME:Ze}=y.GAMEPLAY;class Wm extends le{scene;textObjects;activeTextObjects;mergeEffect;curveAnimation;rewardUnitCurveAnimation;sample;starTail;fullTextTween;resultWinAnimation;resultLoseAnimation;sparkExplosive;constructor(e){super(e),this.scene=e,this.createMergeEffect(),this.createTextObjects(),this.createCurveAnimation(),this.createFullText(),this.createResultWinEffect(),this.createResultLoseEffect()}stop(){this.isRunning()&&(super.stop(),this.stopMergeEffect(),this.stopTextEffect(),this.resetFullFloatText())}playMergeEffect(e){const{x:t,y:s}=e.getWorldPosition();this.mergeEffect.setActive(!0),this.mergeEffect.setVisible(!0),this.mergeEffect.setPosition(t,s);const i=this.mergeEffect.getAnimationList();this.mergeEffect.play(i[0],!1,!1),this.scene.audio.playSound(G.UNIT_MERGE,{volume:.5})}createMergeEffect(){this.mergeEffect=this.scene.add.spine(0,0,Vm.KEY,"animation"),this.mergeEffect.setName("MergeEffect"),this.mergeEffect.setDepth(M.EFFECT),this.mergeEffect.setScale(.5,.5),this.mergeEffect.setActive(!1),this.mergeEffect.setVisible(!1)}stopMergeEffect(){this.mergeEffect.setActive(!1),this.mergeEffect.setVisible(!1)}createTextObjects(){this.textObjects=this.scene.add.group({runChildUpdate:!1}),this.activeTextObjects=this.scene.add.group({runChildUpdate:!1})}getTextEffectObject(){const e=this.textObjects.getMatching("active",!1)[0];return e||this.createTextEffect()}createTextEffect(){const e=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}});return e.setDepth(M.DMG_POPUP_NUMBER),this.textObjects.add(e),e}hideAllTextEffects(){this.textObjects.getChildren().forEach(e=>{e instanceof Phaser.GameObjects.BitmapText&&e.active&&e.visible&&(this.activeTextObjects.add(e),e.kill())})}showAllTextEffects(){this.activeTextObjects.getChildren().forEach(e=>{e instanceof Phaser.GameObjects.BitmapText&&e.revive()}),this.activeTextObjects.clear()}stopTextEffect(){this.textObjects.getChildren().forEach(e=>{e instanceof Phaser.GameObjects.Text&&(e.kill(),e.setAlpha(1),this.scene.tweens.killTweensOf(e))})}createCurveAnimation(){this.sample=this.scene.make.image({key:Xe,frame:Ze.BLANK}),this.sample.setVisible(!1);const e=new Rc(this.scene);e.setDepth(M.EFFECT),this.starTail=e}runCurveAnimation(e,t,s,i){const a={x:e,y:t},r={x:s,y:i},o=100;this.curveAnimation=new Xi({targets:[this.sample],delay:this.scene.tweens.stagger(80,{}),duration:1e3,curve:[[a.x,a.y],[a.x-Phaser.Math.RND.between(-o,o),a.y+Phaser.Math.RND.between(-140,-100)],[r.x,r.y]],onComplete:()=>{this.runSparksExplosive(s,i)},onCurveUpdate:c=>{const h=c.x+Phaser.Math.RND.between(-16,16),u=c.y+Phaser.Math.RND.between(-16,16);this.starTail.explode(1,h,u)}}),this.curveAnimation.play()}runCurveAnimationRewardUnit(e,t,s,i,a){const r={x:e,y:t},o={x:s.x,y:s.y},c=a||1,l=100;this.rewardUnitCurveAnimation=new Xi({targets:[this.sample],delay:this.scene.tweens.stagger(80,{}),duration:1e3,curve:[[r.x,r.y],[r.x-Phaser.Math.RND.between(-l,l),r.y+Phaser.Math.RND.between(-140,-100)],[o.x,o.y]],onComplete:()=>{this.runSparksExplosive(o.x,o.y);const{unitManager:h}=this.scene;i==="MELEE"&&h.createPlayerMelee(s.rowId,s.colId,c),i==="RANGED"&&h.createPlayerArcher(s.rowId,s.colId,c),this.scene.updateUI()},onStop:()=>{const{unitManager:h}=this.scene;i==="MELEE"&&h.createPlayerMelee(s.rowId,s.colId,c),i==="RANGED"&&h.createPlayerArcher(s.rowId,s.colId,c),this.scene.updateUI()},onCurveUpdate:h=>{const p=h.x+Phaser.Math.RND.between(-16,16),g=h.y+Phaser.Math.RND.between(-16,16);this.isRewardCurveAnimationRunning()&&this.starTail.explode(1,p,g)}}),this.rewardUnitCurveAnimation.play()}runSparksExplosive=(e,t)=>{const s=this.scene;this.sparkExplosive=new _c(s),this.sparkExplosive.setDepth(M.EFFECT),this.sparkExplosive.explode(100,e,t,50)};createFullText(){const e=this.scene.add.container(0,0);e.setDepth(M.EFFECT);const t=this.scene.make.image({key:Xe,frame:Ze.PURPLE_EFFECT});t.setOrigin(.5,.5),t.setWorldSize(263.5,79.5),e.add(t);const s=this.scene.make.text({text:this.scene.lang.Text.FULL,style:{fontSize:"25px",color:"#FFFFFF",fontFamily:w.FONT_FAMILY}});s.setHighQuality(),Phaser.Display.Align.In.Center(s,t,-3,-5),e.add(s),e.kill(),Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,30),this.fullTextTween=new Ic({targets:[e],onStart:()=>{e.revive()},onComplete:()=>{this.scene.tweens.add({targets:[e],duration:300,delay:200,alpha:0})}})}playFullFloatText(){this.fullTextTween.play()}resetFullFloatText(){this.fullTextTween.stop()}createResultWinEffect(){const e=this.scene.add.container(0,0);e.setDepth(M.EFFECT);const t=this.scene.make.image({key:Xe,frame:Ze.EFFECT_WIN_GLOW});t.setWorldSize(276.5,58.5),e.add(t);const s=this.scene.make.text({text:this.scene.lang.Text.WIN,style:{fontSize:"25px",color:"#FFFFFF",fontFamily:w.FONT_FAMILY}});s.setHighQuality(),Phaser.Display.Align.In.Center(s,t),e.add(s);const i=this.scene.make.image({key:Xe,frame:Ze.EFFECT_WIN_SHAPE_ABOVE});i.setWorldSize(87.5,18.5),e.add(i),Phaser.Display.Align.In.TopCenter(i,t,0,5);const a=this.scene.make.image({key:Xe,frame:Ze.EFFECT_WIN_SHAPE_BELOW});a.setWorldSize(147,23.5),e.add(a),Phaser.Display.Align.In.BottomCenter(a,t,0,8),e.kill(),this.scene.world.isLandscape()?Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,-20):Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,-80),this.resultWinAnimation=this.scene.tweens.add({paused:!0,targets:[e],onActive:()=>{e.revive(),e.setAlpha(1),e.setScale(1),t.setAlpha(0),s.setAlpha(0),i.setAlpha(0),a.setAlpha(0),this.scene.add.tween({targets:[t,s],duration:400,alpha:{start:0,to:1},ease:Phaser.Math.Easing.Quadratic.In}),this.scene.add.tween({targets:[i,a],duration:300,alpha:{start:0,to:1}}),this.scene.add.tween({targets:[i],duration:300,delay:200,y:{start:-10,to:-25},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.add.tween({targets:[a],duration:300,delay:200,y:{start:10,to:25},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.add.tween({targets:[e],duration:600,delay:1e3,scale:{from:1,to:1.2},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.tweens.add({targets:[e],duration:300,delay:1300,alpha:0})}})}playResultWinAnimation(){this.resultWinAnimation.play()}createResultLoseEffect(){const e=this.scene.add.container(0,0);e.setDepth(M.EFFECT);const t=this.scene.make.image({key:Xe,frame:Ze.EFFECT_LOSE_GLOW});t.setWorldSize(253.5,55),e.add(t);const s=this.scene.make.text({text:this.scene.lang.Text.LOSE,style:{fontSize:"25px",color:"#FFFFFF",fontFamily:w.FONT_FAMILY}});s.setHighQuality(),Phaser.Display.Align.In.Center(s,t),e.add(s);const i=this.scene.make.image({key:Xe,frame:Ze.EFFECT_LOSE_SHAPE_ABOVE});i.setWorldSize(86,22.5),e.add(i),Phaser.Display.Align.In.TopCenter(i,t,0,5);const a=this.scene.make.image({key:Xe,frame:Ze.EFFECT_LOSE_SHAPE_BELOW});a.setWorldSize(126.5,25.5),e.add(a),Phaser.Display.Align.In.BottomCenter(a,t,0,8),e.kill(),this.scene.world.isLandscape()?Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,-20):Phaser.Display.Align.In.Center(e,this.scene.gameZone,0,-80),this.resultLoseAnimation=this.scene.tweens.add({paused:!0,targets:[e],onActive:()=>{e.revive(),e.setAlpha(1),e.setScale(1),t.setAlpha(0),s.setAlpha(0),i.setAlpha(0),a.setAlpha(0),this.scene.add.tween({targets:[t,s],duration:400,alpha:{start:0,to:1},ease:Phaser.Math.Easing.Quadratic.In}),this.scene.add.tween({targets:[i,a],duration:300,alpha:{start:0,to:1}}),this.scene.add.tween({targets:[i],duration:300,delay:200,y:{start:-10,to:-25},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.add.tween({targets:[a],duration:300,delay:200,y:{start:10,to:25},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.add.tween({targets:[e],duration:600,delay:1e3,scale:{from:1,to:.8},ease:Phaser.Math.Easing.Cubic.InOut}),this.scene.tweens.add({targets:[e],duration:300,delay:1300,alpha:0})}})}playResultLoseAnimation(){this.resultLoseAnimation.play()}isRewardCurveAnimationRunning(){return!this.rewardUnitCurveAnimation||!this.rewardUnitCurveAnimation.tween?!1:this.rewardUnitCurveAnimation&&this.rewardUnitCurveAnimation.tween.isPlaying()}stopRewardCurveAnimation(){this.isRewardCurveAnimationRunning()&&(this.rewardUnitCurveAnimation.stop(),this.starTail?.stop(),this.sparkExplosive?.stop())}}class pa extends Phaser.GameObjects.Container{placementArea;areaRect;scene;rowId;colId;isTaken;constructor(e,t,s,i){super(e,t,s),this.scene=e,this.createAreaRect(i),this.createPlacementArea(i),this.addEventListener(),this.scene.add.existing(this),this.setDepth(M.FIELD_SQUARE)}createPlacementArea(e){this.placementArea=this.scene.add.zone(0,0,e,e),this.add(this.placementArea)}createAreaRect(e){this.areaRect=this.scene.add.rectangle(0,0,e,e,16368767,1),this.add(this.areaRect),this.areaRect.setDepth(M.FIELD_SQUARE_RECT)}updateAreaRect(e){this.areaRect.setFillStyle(e)}setSquarePosition(e,t){this.rowId=e,this.colId=t,this.isTaken=!1}setTaken(e){this.isTaken=e}addEventListener(){this.placementArea.setInteractive({useHandCursor:!0}),this.placementArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{console.log(this.rowId,this.colId)})}}const gi=[{KEY_PORTRAIT:L.BG_TREE.KEY,KEY_LANDSCAPE:L.BG_LANDSCAPE_TREE.KEY,BG_EXTENSION_COLOR:8102725,SQUARE_COLOR:11452994,SQUARE_HIGHT_LIGHT_COLOR:9692964,SQUARE_HIGHT_LIGHT_BORDER_COLOR:14089889},{KEY_PORTRAIT:L.BG_DESERT.KEY,KEY_LANDSCAPE:L.BG_LANDSCAPE_DESERT.KEY,BG_EXTENSION_COLOR:16761714,SQUARE_COLOR:16368767,SQUARE_HIGHT_LIGHT_COLOR:16766227,SQUARE_HIGHT_LIGHT_BORDER_COLOR:16773290},{KEY_PORTRAIT:L.BG_ICE.KEY,KEY_LANDSCAPE:L.BG_LANDSCAPE_ICE.KEY,BG_EXTENSION_COLOR:15330021,SQUARE_COLOR:13952244,SQUARE_HIGHT_LIGHT_COLOR:6402815,SQUARE_HIGHT_LIGHT_BORDER_COLOR:16777215},{KEY_PORTRAIT:L.BG_CRYSTAL.KEY,KEY_LANDSCAPE:L.BG_LANDSCAPE_CRYSTAL.KEY,BG_EXTENSION_COLOR:3224690,SQUARE_COLOR:5792413,SQUARE_HIGHT_LIGHT_COLOR:6195962,SQUARE_HIGHT_LIGHT_BORDER_COLOR:11848191},{KEY_PORTRAIT:L.BG_VOLCANO.KEY,KEY_LANDSCAPE:L.BG_LANDSCAPE_VOLCANO.KEY,BG_EXTENSION_COLOR:13383207,SQUARE_COLOR:7886462,SQUARE_HIGHT_LIGHT_COLOR:12016072,SQUARE_HIGHT_LIGHT_BORDER_COLOR:15310583}],{STATUS:$m}=nt,{LEVEL_PROGRESS:ga}=ce,Fe={x:30.5,y:158},Pt={x:30.5,y:-246},jm=50;class zm extends le{scene;fieldBackground;playerPlacementSquares;enemyPlacementSquares;firstHightLineZone;secondHightLineZone;fieldBackgroundExtension;constructor(e){super(e),this.scene=e,this.enemyPlacementSquares=[],this.playerPlacementSquares=[],this.scene.world.isUsingLandscapeBackground()&&(Fe.x=323,Fe.y=55,Pt.x=323,Pt.y=-77),this.createBattlefield(),this.createHightLineZone()}init(){super.init(),this.updateField(),this.resetPlacementSquareStatus()}start(){this.isRunning()||(this.showPlacementSquares(),this.setState($m.RUNNING))}updateField(){const e=this.getCurrentLevel(),t=this.getBgData(e);if(this.scene.world.isUsingLandscapeBackground()){this.updateBackgroundElement(t);return}this.updateFieldBackground(t),this.updatePlacementSquares(t),this.updateHightLightSquares(t)}getCurrentLevel(){const{currentLevelData:e=null}=this.scene.levelManager;let t=e?e.level_id:1;if(!e){const s=this.scene.player.getCustomData(ga);s&&(t=s>0?s+1:1)}return t}getBgData(e){const t=Math.floor(e/10)%Object.keys(gi).length,s=gi[t],a=this.scene.world.isUsingLandscapeBackground()?s.KEY_LANDSCAPE:s.KEY_PORTRAIT;return this.scene.textures.exists(a)?s:gi[0]}updateFieldBackground(e){const s=this.scene.world.isUsingLandscapeBackground()?e.KEY_LANDSCAPE:e.KEY_PORTRAIT;this.fieldBackground.setTexture(s),this.fieldBackgroundExtension.setFillStyle(e.BG_EXTENSION_COLOR)}updatePlacementSquares(e){this.playerPlacementSquares.forEach(t=>{t.updateAreaRect(e.SQUARE_COLOR)}),this.enemyPlacementSquares.forEach(t=>{t.updateAreaRect(e.SQUARE_COLOR)})}updateHightLightSquares(e){this.firstHightLineZone.setFillStyle(e.SQUARE_HIGHT_LIGHT_COLOR),this.firstHightLineZone.setStrokeStyle(2,e.SQUARE_HIGHT_LIGHT_BORDER_COLOR),this.secondHightLineZone.setFillStyle(e.SQUARE_HIGHT_LIGHT_COLOR),this.secondHightLineZone.setStrokeStyle(2,e.SQUARE_HIGHT_LIGHT_BORDER_COLOR)}createHightLineZone(){const{displayWidth:e,scale:t}=this.fieldBackground,s=t*this.scene.world.getPixelRatio(),i={x:Fe.x*s,y:Fe.y*s},a=e-i.x*2;this.firstHightLineZone=this.scene.add.rectangle(0,0,a/5,a/5,16777215,1),this.firstHightLineZone.setStrokeStyle(2,16776960),this.firstHightLineZone.setDepth(M.FIELD_SQUARE_RECT),this.firstHightLineZone.kill(),this.secondHightLineZone=this.scene.add.rectangle(0,0,a/5,a/5,16777215,1),this.secondHightLineZone.setStrokeStyle(2,16776960),this.secondHightLineZone.setDepth(M.FIELD_SQUARE),this.secondHightLineZone.kill()}createBattlefield(){const e=this.getCurrentLevel(),t=this.getBgData(e);this.createFieldBackground(t),this.createPlacementSquares(t)}createFieldBackground(e){const s=this.scene.world.isUsingLandscapeBackground()?e.KEY_LANDSCAPE:e.KEY_PORTRAIT;this.createBackground(s),this.handleBackgroundTopOffset(),this.createBackgroundExtension(e.BG_EXTENSION_COLOR)}createBackground(e){const{displayWidth:t}=this.scene.gameZone;this.fieldBackground=this.scene.make.image({key:e}),this.fieldBackground.setOrigin(0,1),this.fieldBackground.setScale(t/this.fieldBackground.width),this.fieldBackground.setDepth(M.FIELD_BACKGROUND)}handleBackgroundTopOffset(){const{displayHeight:e}=this.scene.gameZone,t=Fe.y-(this.fieldBackground.displayHeight-e);let s=jm-t;if(s<0&&(s=0),this.scene.world.isUsingLandscapeBackground()){this.fieldBackground.setOrigin(.275,0),this.fieldBackground.setWorldSize(1920/2,1080/2);return}this.fieldBackground.setPosition(0,e+s)}createBackgroundExtension(e){const{displayWidth:t,displayHeight:s}=this.scene.gameZone,i=this.fieldBackground.getBottomLeft();this.fieldBackgroundExtension=this.scene.add.rectangle(i.x,i.y,t,s,e),this.fieldBackgroundExtension.setOrigin(0,0)}createPlacementSquares(e){this.createPlayerPlacementSquares(e.SQUARE_COLOR),this.createEnemyPlacementSquares(e.SQUARE_COLOR)}createEnemyPlacementSquares(e){const{displayWidth:t,scaleX:s,scaleY:i}=this.fieldBackground,a=s*this.scene.world.getPixelRatio(),r=i*this.scene.world.getPixelRatio(),o={x:Fe.x*a,y:Fe.y*a},c={x:Fe.x*r,y:Fe.y*r},{x:l,y:h}=o,{x:u,y:p}=c,g=t-l*2,S=t-u*2,f=g<S?g:S,T={x:g<S?o.x:c.x,y:Math.abs(h)<Math.abs(p)?h:p},A=this.fieldBackground.getTopLeft();A.x+=T.x,A.y+=T.y;let m=1;for(let C=0;C<3;C++)for(let O=0;O<5;O++){const U=new pa(this.scene,A.x+O*f/5+f/10,A.y+C*f/5+f/10,f/5);U.updateAreaRect(e),U.setSquarePosition(C+1,O+1),U.setAlpha(m),m=m===1?0:1,this.enemyPlacementSquares.push(U)}}createPlayerPlacementSquares(e){const{displayWidth:t,scaleX:s,scaleY:i}=this.fieldBackground,a=s*this.scene.world.getPixelRatio(),r=i*this.scene.world.getPixelRatio(),o={x:Pt.x*a,y:Pt.y*a},c={x:Pt.x*r,y:Pt.y*r},{x:l,y:h}=o,{x:u,y:p}=c,g=t-l*2,S=t-u*2,f=g<S?g:S,T={x:g<S?o.x:c.x,y:Math.abs(h)<Math.abs(p)?h:p},A=this.fieldBackground.getBottomLeft();A.x+=T.x,A.y+=T.y;let m=1;for(let C=0;C<3;C++)for(let O=0;O<5;O++){const U=new pa(this.scene,A.x+O*f/5+f/10,A.y-C*f/5-f/10,f/5);U.updateAreaRect(e),U.setSquarePosition(3-C,O+1),U.setAlpha(m),m=m===1?0:1,this.playerPlacementSquares.push(U)}}hidePlacementSquares(){this.playerPlacementSquares.forEach(e=>e.kill()),this.enemyPlacementSquares.forEach(e=>e.kill())}showPlacementSquares(){this.playerPlacementSquares.forEach(e=>e.revive()),this.enemyPlacementSquares.forEach(e=>e.revive())}getPlayerPlacementSquare(e,t){return this.playerPlacementSquares.filter(i=>i.rowId===e&&i.colId===t)[0]}getEnemyPlacementSquare(e,t){return this.enemyPlacementSquares.filter(i=>i.rowId===e&&i.colId===t)[0]}getSquareBasedOnPosition(e,t){for(let s=0;s<this.playerPlacementSquares.length;s++){const i=this.playerPlacementSquares[s];if(i.placementArea.getBounds().contains(e,t))return i}return null}getSquareBasedOnIndex(e,t){for(let s=0;s<this.playerPlacementSquares.length;s++){const i=this.playerPlacementSquares[s];if(i.rowId===e&&i.colId===t)return i}return null}tryGettingAvailablePlacement(e,t){const s=this.getSquareBasedOnIndex(e,t);return s&&!s.isTaken?s:null}getAvailablePlacement(){let e=null;for(let t=0;t<this.playerPlacementSquares.length;t++){const s=this.playerPlacementSquares[t];if(!s.isTaken)return e=s,e}return e}resetPlacementSquareStatus(){this.playerPlacementSquares.forEach(e=>e.isTaken=!1)}getRemainingAvailablePlacement(){return this.playerPlacementSquares.filter(t=>!t.isTaken).length}updateBackgroundElement(e){if(!this.scene.world.isUsingLandscapeBackground())return;const s=document.getElementById("background-image");if(!s)return;const i=this.scene.player.getCustomData(ga);if(typeof i!="number"||i<0){s.src=L.BG_LANDSCAPE_TREE.FILE;return}let a=L.BG_LANDSCAPE_TREE.FILE;switch(Math.floor((i+1)/10)%5){case 0:a=L.BG_LANDSCAPE_TREE.FILE;break;case 1:a=L.BG_LANDSCAPE_DESERT.FILE;break;case 2:a=L.BG_LANDSCAPE_ICE.FILE;break;case 3:a=L.BG_LANDSCAPE_CRYSTAL.FILE;break;case 4:a=L.BG_LANDSCAPE_VOLCANO.FILE;break}s.onload=()=>{this.updateFieldBackground(e),this.updatePlacementSquares(e),this.updateHightLightSquares(e),s.onload=()=>{}},s.src=a}}const{STATUS:Xm}=nt,{MELEE_UNIT_TYPE:ot,RANGED_UNIT_TYPE:ct}=D,{LEVEL_PROGRESS:As}=ce;class Zm extends le{scene;playerLevel;currentLevelId;currentLevelData;enemyData;playerData;constructor(e){super(e),this.scene=e}init(){const{gameMode:e}=this.scene;this.enemyData=[],e===V.NORMAL&&(this.updatePlayerLevel(),this.loadLevel()),e===V.BATTLE&&(this.createBattleOpponentData(),this.setBattleOpponentLevel())}start(){this.isRunning()||this.setState(Xm.RUNNING)}setCurrentLevelId(e){this.currentLevelId=e}updatePlayerLevel(){const e=this.scene.player.getCustomData(As),t=e&&GameCore.Utils.Valid.isNumber(e)&&e>0;this.playerLevel=t?e:0}loadLevel(){try{if(this.scene.game.cache.json.exists("level-builder-json")){this.loadLevelBuilderLevel();return}this.setCurrentLevelId(this.playerLevel?this.playerLevel+1:1),console.log("🤖 ? this.playerLevel",this.playerLevel);const e=this.playerLevel?this.playerLevel:0,t=Math.floor(e/100)*100+1,s=t+99,i=(1e4+t).toString().substring(1),a=(1e4+s).toString().substring(1),r=this.scene.cache.json.get(`levels-${i}-${a}`),o=this.currentLevelId-t;o>=r.levels.length&&this.setCurrentLevelId(r.levels.length-1),this.currentLevelData=r.levels[o],console.log(this.currentLevelData),this.createEnemyData()}catch(e){console.warn(e)}}createEnemyData(){this.currentLevelData.enemy_row1.split("-").forEach((e,t)=>{if(e!=="0"){const s=e.charAt(0)==="m"?ot:ct,i=parseInt(e.substring(1)),a=1,r=t+1;this.enemyData.push({type:s,level:i,positionRow:a,positionColumn:r})}}),this.currentLevelData.enemy_row2.split("-").forEach((e,t)=>{if(e!=="0"){const s=e.charAt(0)==="m"?ot:ct,i=parseInt(e.substring(1)),a=2,r=t+1;this.enemyData.push({type:s,level:i,positionRow:a,positionColumn:r})}}),this.currentLevelData.enemy_row3.split("-").forEach((e,t)=>{if(e!=="0"){const s=e.charAt(0)==="m"?ot:ct,i=parseInt(e.substring(1)),a=3,r=t+1;this.enemyData.push({type:s,level:i,positionRow:a,positionColumn:r})}})}createBattleOpponentData(){const e=this.scene.game.battle.getOpponentInfo();if(console.log(e),!e)return;const{unitData:t}=e;this.enemyData=[],t.split("/").reverse().forEach((i,a)=>{i.split("-").forEach((r,o)=>{if(r!=="0"){const c=r.charAt(0)==="m"?ot:ct,l=parseInt(r.substring(1)),h=a+1,u=o+1;this.enemyData.push({type:c,level:l,positionRow:h,positionColumn:u})}})})}setBattleOpponentLevel(){const e=this.scene.game.battle.getOpponentInfo();if(!e){this.currentLevelId=1;return}const{playerLevel:t}=e;this.currentLevelId=t}loadLevelBuilderLevel(){const e=this.scene.cache.json.get("level-builder-json");this.currentLevelId=e.level_id;try{this.currentLevelData=e}catch(t){console.log(t)}this.createData()}createData(){this.createEnemyData(),this.createPlayerData()}createPlayerData(){this.playerData=[];const e=this.currentLevelData;if(!e)return;const t=new F(e.coins.baseValue,e.coins.suffix,!0);this.scene.coin.receiveCoins(t.baseValue,t.suffix),e.player_row1.split("-").forEach((s,i)=>{if(s!=="0"){const a=s.charAt(0)==="m"?ot:ct,r=parseInt(s.substring(1)),o=1,c=i+1;this.playerData.push({type:a,level:r,positionRow:o,positionColumn:c})}}),e.player_row2.split("-").forEach((s,i)=>{if(s!=="0"){const a=s.charAt(0)==="m"?ot:ct,r=parseInt(s.substring(1)),o=2,c=i+1;this.playerData.push({type:a,level:r,positionRow:o,positionColumn:c})}}),e.player_row3.split("-").forEach((s,i)=>{if(s!=="0"){const a=s.charAt(0)==="m"?ot:ct,r=parseInt(s.substring(1)),o=3,c=i+1;this.playerData.push({type:a,level:r,positionRow:o,positionColumn:c})}})}isInLevelBuilderLevel(){return this.scene.gameMode!==V.NORMAL?!1:GameCore.Utils.Object.hasOwn(this.currentLevelData,"player_row1")}updateHighestCurrentLevel(){this.isInLevelBuilderLevel()||this.playerLevel<this.currentLevelId&&this.scene.player.setCustomData(As,this.currentLevelId)}getCurrentLevelId(){return this.currentLevelId}getModifierLevel(){const{gameMode:e}=this.scene;if(e===V.NORMAL)return this.currentLevelId;if(e===V.BATTLE){const t=this.scene.player.getCustomData(As);return GameCore.Utils.Valid.isNumber(t)?Math.min(this.currentLevelId,t+1):1}throw new Error("Case not implemented.")}getPlayerLevel(){if(this.isInLevelBuilderLevel())return this.currentLevelId;const e=this.scene.player.getCustomData(As);return GameCore.Utils.Valid.isNumber(e)?e+1:1}loadAllLevels(){this.scene.cache.json.get("levels").levels.forEach((t,s)=>{this.currentLevelData=t,console.log(s),this.createEnemyData()})}}const Gs={FREE_COINS:{ID:"free-coins"},SPEED_UP:{ID:"speed-up"}},{STATUS:Ea}=nt,{enable:qm}=GameCore.Configs.Gameplay.Powers.FreeCoins,{enable:Qm}=GameCore.Configs.Gameplay.Powers.SpeedUp;class Jm extends le{scene;items={};readyStateItems={};playingStateItems={};itemActive;isSpeedUp;constructor(e){super(e),this.scene=e,this.isSpeedUp=!1,this.createItems()}init(){this.setState(Ea.READY),this.deactivateItems();const{objects:e}=this.scene.layoutManager;e.freeCoinsItem.startCountdown()}stop(){this.isRunning()&&(this.deactivateItems(),this.setState(Ea.STOPPED))}activeItem=e=>{this.isRunning()&&this.items[e]&&(this.deactivateItems(),this.itemActive=e,this.items[e].activeItem())};deactivateItem=e=>{this.items[e]&&(this.itemActive="",this.items[e].deactivateItem())};deactivateItems(){for(const e in this.items)this.deactivateItem(e)}createItems(){this.createFreeCoinsButton(),this.createSpeedUpButton()}createFreeCoinsButton(){if(!qm)return;const{objects:e}=this.scene.layoutManager;this.items[Gs.FREE_COINS.ID]=e.freeCoinsItem}createSpeedUpButton(){if(!Qm)return;const{objects:e}=this.scene.layoutManager;this.items[Gs.SPEED_UP.ID]=e.speedUpItem}getAllItems(){return Object.values(this.items)}getItemsForReadyState(){return Object.values(this.readyStateItems)}getItemsForPlayingState(){return Object.values(this.playingStateItems)}isGameSpeedUp(){return this.isSpeedUp||!1}forceReturnToNormalSpeed(){this.scene.unitManager.resetSpeedAllUnits()}checkForSpeedSetting(){const{objects:e}=this.scene.layoutManager,t=!!this.scene.player.getPlayerSetting("speedUp");e.speedUpItem.visible&&(t?this.scene.unitManager.speedUpAllUnits():this.scene.unitManager.resetSpeedAllUnits())}syncSpeedSetting(){const{objects:e}=this.scene.layoutManager,t=!!this.scene.player.getPlayerSetting("speedUp");e.speedUpItem.visible&&(t?e.speedUpItem.speedUpGameplay():e.speedUpItem.returnToNormalSpeed())}}const{UNIT_SIZE_SCALE:fa}=D;class eA extends le{scene;isDirtyDepth;spineUnits=[];spineContainer;constructor(e){super(e),this.scene=e,this.isDirtyDepth=!1,this.spineUnits=[],this.spineContainer=this.scene.add.spineContainer(0,0),this.spineContainer.setDepth(M.MANAGER_BASE_DEPTH)}init(){super.init(),this.spineUnits=[],this.spineContainer.removeAll()}update(e){this.isRunning()&&(this.spineUnits.forEach(t=>{const s=t.getSpineDisplay();if(!s)return;s.depth!==t.depth&&(s.setDepth(t.depth),this.isDirtyDepth=!0);const{x:i,y:a}=t.getWorldPosition();s.setPosition(i,a+25)}),e&&this.isDirtyDepth&&this.sortSpineContainerByDepth())}sortSpineContainerByDepth(){this.spineContainer.sort("depth",(e,t)=>e.depth-t.depth)}sortSpineContainerByName(){this.spineContainer.sort("name",(e,t)=>e.name.localeCompare(t.name))}sortSpineContainerByLevel(){this.spineContainer.sort("level",(e,t)=>e.level-t.level)}addSpines(e){this.isRunning()&&e.forEach(t=>{if(this.spineUnits.some(i=>i===t))return;const s=t.getSpineDisplay();s&&(s instanceof Phaser.GameObjects.Sprite||(s.level=t.level,t.display.setSpineScale(fa*.5,fa*.5),this.spineUnits.push(t),this.spineContainer.add(s)))})}removeSpine(e){const t=e.getSpineDisplay();t&&(this.spineUnits=this.spineUnits.filter(s=>s!==e),this.spineContainer.remove(t,!1))}bringToTopOnDrag(e){const t=e.getSpineDisplay();t&&this.spineContainer.bringToTop(t)}hideAllSpines(){this.spineContainer.setActive(!1),this.spineContainer.setVisible(!1)}showAllSpines(){this.spineContainer.setActive(!0),this.spineContainer.setVisible(!0)}}class Vt{scene;constructor(e){this.scene=e}}const{LEVEL_PROGRESS:Lc,SELECTED_LEVEL:ma}=ce,tA=()=>async(n,e)=>{const{player:t,rollbar:s,analytics:i,globalScene:a}=window.game;try{const r=e(),o=ls(r),c=gn(r),l=t.getPlayer(),{entryPointData:h}=o,{type:u}=h||{};l.isUserNew&&i.event(v.NEW_USER);const p=t.getCustomData(ma),g=t.getCustomData(Lc),S=typeof g=="number"&&g>=0;if(!p){let f=1;S&&(f=g+1),t.setCustomData(ma,f)}c===Ut&&(a.screen.open(I.NOTIFY_SCREEN,{message:a.lang.Text.LOADING,loading:!0}),S&&g>=2?u===Ks?await n(await wc()):u===wo&&await n(await sA()):(await n(await Bg(!0)),console.info("🚀 > setRequestDetectGameMode",!0)))}catch(r){s.sendException(r)}finally{a.screen.close(I.NOTIFY_SCREEN),a.events.emit(Ds.SWITCH,N.GAME_SCENE)}},wc=()=>async(n,e)=>{try{const t=e(),s=ls(t),{player:i,battle:a}=window.game,r=i.getPlayer(),{entryPointData:o}=s,{matchId:c,opponentId:l,playerId:h}=o||{},u=i.getCustomData(Lc);if(typeof u!="number"||u<2||!([l,h].indexOf(r.playerId)>=0))return;r.playerId===h?await a.continueBattle(c,l):await a.continueBattle(c,h)}catch(t){console.error(t)}},sA=()=>async(n,e)=>{try{const t=e(),s=ls(t),{player:i,battle:a}=window.game,r=i.getPlayer(),{entryPointData:o}=s,{playerId:c}=o||{};if(r.playerId===c||!c)return;await a.createBattle(c,!1)}catch(t){console.error(t)}};class hs extends Vt{constructor(e){super(e),this.scene.stopManager(),this.scene.audio.setMusicVolume(0,3e3)}ready(){}play(){}levelComplete(){}levelFail(){}levelLoading(){const e=new Gt(this.scene);this.scene.stateManager.changeStateTo(e)}quit(){}update(){}}const Aa="offlineRewardLastCheck",En=n=>n[Ec],iA=n=>En(n).checked,nA=n=>En(n).valueReceived,aA=n=>En(n).hasShowReward,rA=k([iA],n=>n),oA=k([nA],n=>n),cA=k([aA],n=>n),{Enable:Pc,MinimumTimeToActive:lA}=GameCore.Configs.OfflineReward,{LEVEL_PROGRESS:hA}=ce,uA=()=>(n,e)=>{if(!Pc)return;const t=e();if(rA(t))return;n({type:fc,payload:{}});const{player:i}=window.game,a=Date.now(),r=i.getCustomData(Aa);if(i.setCustomData(Aa,a),!r)return;const o=i.getCustomData(hA);let c=0;if(o&&typeof o=="number"&&(c=o),c<3)return;const l=a-r;if(l<lA)return;const h=Math.floor(l/6e4);//! DEBUG 1HR offline coin
n(dA(h))},dA=n=>({type:mc,payload:{value:n}}),pA=()=>n=>{Pc&&n({type:Ac,payload:{}})},{DelayFinishGame:Ei}=GameCore.Configs.Gameplay;class Oc extends Vt{constructor(e){super(e);const{gameMode:t,levelManager:s,tutorialManager:i,powerManager:a}=this.scene;a.forceReturnToNormalSpeed(),t===V.BATTLE&&this.scene.game.battle.finishBattle("lose"),this.scene.audio.playSound(G.LOSE_SOUND);const r=s.getCurrentLevelId();this.scene.analytics.levelFail(r),this.scene.effectManger.playResultLoseAnimation(),i.isRunning()?this.handleTutorialCase():this.openResultScreen()}openResultScreen(){const{screenManager:e,gameMode:t}=this.scene,s=this.scene.coinManager.getTotalCoinsByAttack();this.scene.time.delayedCall(Ei,async()=>{this.scene.stopManager();const{audio:i,globalScene:a,lang:r}=this.scene.game;if(this.scene.game.ads.canbeShowInterstitialAd()){let o=null;try{i.muteAll(),this.scene.scene.pause(),o=this.scene.game.globalScene.time.delayedCall(200,()=>{a.screen.open(I.NOTIFY_SCREEN,{message:r.Text.LOADING_ADS,duration:0,loading:!0})}),i.muteAll(),await this.scene.game.ads.showInterstitialAdAsync()}catch(c){console.info("🚀 > showInterstitialAdAsync",c)}finally{i.unmuteAll(),this.scene.game.ads.preloadInterstitialAdAsync().catch(()=>{}),o?.remove(),a.screen.close(I.NOTIFY_SCREEN)}}e.showResultScreen("lose",t,s)})}handleTutorialCase(){const{levelManager:e,screenManager:t,coinManager:s,gameMode:i}=this.scene,a=e.getCurrentLevelId(),r=s.getTotalCoinsByAttack(),o=a===1?Ei*1.5:Ei;this.scene.time.delayedCall(o,async()=>{if(this.scene.stopManager(),a===1){this.scene.coin.plusCoins(r.baseValue,r.suffix),this.scene.prepareRound();return}t.showResultScreen("lose",i,r)})}ready(){const e=new zs(this.scene);this.scene.stateManager.changeStateTo(e)}play(){}levelFail(){}levelComplete(){}levelLoading(){const e=new Gt(this.scene);this.scene.stateManager.changeStateTo(e)}quit(){const e=new hs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){}}class Dc extends Vt{isLevelOver;constructor(e){super(e),this.isLevelOver=!1;const{fieldManager:t,unitManager:s,uiManager:i,spineManager:a,effectManger:r,powerManager:o}=this.scene;this.scene.accessibilityManager.stop(),t.hidePlacementSquares(),a.sortSpineContainerByName(),r.stopRewardCurveAnimation(),s.savePlayerUnits(),s.setReadyAllUnits(),s.runChildUpdateGroups(!0),s.disableDragOnPlayerUnits(),i.showUIForPlayingState(),o.checkForSpeedSetting(),this.scene.audio.setMusicVolume(.04,1e3)}ready(){const e=new zs(this.scene);this.scene.stateManager.changeStateTo(e)}play(){}levelFail(){const e=new Oc(this.scene);this.scene.stateManager.changeStateTo(e)}levelComplete(){const e=new fn(this.scene);this.scene.stateManager.changeStateTo(e)}levelLoading(){}quit(){const e=new hs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){if(this.isLevelOver)return;const{uiManager:e,spineManager:t}=this.scene,s=e.getCurrentEnemyHp()<=0,i=e.getCurrentPlayerHp()<=0;if(s){this.scene.gameOver("win"),this.isLevelOver=!0;return}if(i&&!s){this.scene.gameOver("lose"),this.isLevelOver=!0;return}t.update(!1)}}class gA extends Vt{constructor(e){super(e);const{uiManager:t,unitManager:s,coinManager:i,spineManager:a,levelManager:r,screenManager:o,tutorialManager:c,difficultyManager:l,powerManager:h}=this.scene;this.scene.initManager(),this.scene.startManager();const u=s.getPlayerUnits(),p=s.getEnemyUnits();a.addSpines([...p,...u]),s.enableDragOnPlayerUnits(),s.runChildUpdateGroups(!0);const g=r.getCurrentLevelId(),S=r.getModifierLevel(),f=r.getPlayerLevel();console.log("🤖 ? currentLevelId",g),console.log("🤖 ? modifierLevel",S),console.log("🤖 ? playerLevel",f),i.setUnitModifier(f),i.setAttackModifier(S),l.updateCustomUnitModifierByLevel(f),l.updateCustomAttackModifierByLevel(S),this.scene.storage.dispatch(uA()),o.closeLoadingScreen(),this.scene.gameMode===V.BATTLE?(s.hideAllUnits(),this.scene.time.delayedCall(450,()=>{o.showChallengeSplashScreen(),t.showUIForReadyState(),this.scene.updateUI()})):(this.scene.audio.setMusicVolume(.4,3e3),t.showUIForReadyState(),this.scene.updateUI()),c.showTutorial(),h.syncSpeedSetting(),this.scene.audio.playMusic(),this.logLevelStart()}logLevelStart(){const{battle:e,storage:t,levelManager:s}=this.scene,i=this.scene.gameMode===V.BATTLE,a=this.scene.isContextChallenge(),r=s.getCurrentLevelId();if(i&&a){const o=e.getOpponentInfo(),c=t.getState(),{entryPointData:l}=ls(c),{playerId:h,opponentId:u=xs.playerId}=l||{},p=[u,h].indexOf(o?.playerId)>-1;if(console.info("🚀 > isOwnerContext",p),p){this.scene.analytics.levelStart(r);return}}this.scene.analytics.levelStart(r)}ready(){}play(){const e=new Dc(this.scene);this.scene.stateManager.changeStateTo(e)}levelFail(){}levelComplete(){}levelLoading(){if(!this.scene.levelManager.isInLevelBuilderLevel())return;const e=new Gt(this.scene);this.scene.stateManager.changeStateTo(e)}quit(){const e=new hs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){this.scene.spineManager.update(!0)}}const zs=gA,{LEVEL_PROGRESS:EA,PLAYER_UNIT_DATA:Sa}=ce;class fA extends Vt{isRequesting=!1;constructor(e){super(e),this.run()}async run(){const{uiManager:e,screenManager:t,layoutManager:s}=this.scene;this.scene.initGameMode(),s.layout.alignUI(),e.showUIForLevelLoadingState(),this.autoUpgradeUnitData();const i=this.getCurrentLevel();if(console.info("🚀 > currentLevel",i),i>1){const a=this.scene.gameMode===V.BATTLE,r=await this.scene.isChallengeMode();if(!a&&r&&(await this.scene.storage.dispatch(await wc()),this.scene.initGameMode(),this.scene.gameMode===V.BATTLE)){this.scene.quit(),this.scene.restartScene();return}}if(this.loadLevelsJson(),this.scene.gameMode===V.BATTLE){const a=this.scene.game.globalScene;a.screen.close(I.LEADER_BOARD_SCREEN),a.screen.close(I.BATTLE_SCREEN),this.loadOpponentUnits()}if(this.isRequesting){t.showLoadingScreen();const a=this.scene.scene.get(N.LOAD_SCENE);a.scene.wake(),a.load.once(Phaser.Loader.Events.COMPLETE,this.handleLoadComplete),a.load.start()}else this.scene.time.delayedCall(0,this.handleLoadComplete)}autoUpgradeUnitData(){const e=this.scene.player.getCustomData(Sa);if(!e||typeof e!="string")return;const s=this.scene.scene.get(N.LOAD_SCENE).upgradePlayerUnits(e);s!==e&&this.scene.player.setCustomData(Sa,s)}handleLoadComplete=()=>{this.scene.prepareRound();const e=this.scene.scene.get(N.LOAD_SCENE);e.scene.sleep(),e.lazyLoadResource()};loadOpponentUnits(){const e=this.scene.game.battle.getOpponentInfo();if(!e)return;const{unitData:t}=e;console.info("🚀 > OpponentUnitData",t);const s=this.scene.scene.get(N.LOAD_SCENE);this.isRequesting=!0,s.loadUnits("spine",t)}getCurrentLevel(){const e=this.scene.player.getCustomData(EA),t=GameCore.Utils.Valid.isNumber(e)?e:1;return t>0?t:0}loadLevelsJson(){const e=this.getCurrentLevel();this.loadLevelJsonByLevel(e),this.reloadNextLevelJson(e)}reloadNextLevelJson(e){const t=e+1;t%100===0&&this.loadLevelJsonByLevel(t,!1)}loadLevelJsonByLevel(e,t=!0){const s=this.getJsonKey(e);if(this.scene.cache.json.exists(s))return;t&&(this.isRequesting=!0),this.scene.scene.get(N.LOAD_SCENE).load.json(s,`assets/json/${s}.json`)}getJsonKey(e){const t=Math.floor(e/100)*100+1,s=t+99,i=(1e4+t).toString().substring(1),a=(1e4+s).toString().substring(1);return`levels-${i}-${a}`}ready(){const e=new zs(this.scene);this.scene.stateManager.changeStateTo(e)}play(){}levelFail(){}levelComplete(){}levelLoading(){}quit(){const e=new hs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){}}const Gt=fA,{DelayFinishGame:Ta}=GameCore.Configs.Gameplay;class mA extends Vt{constructor(e){super(e);const{gameMode:t,levelManager:s,tutorialManager:i,powerManager:a}=this.scene;a.forceReturnToNormalSpeed();const r=s.getCurrentLevelId(),o=r>=1598;t===V.NORMAL&&!o&&s.updateHighestCurrentLevel(),t===V.BATTLE&&this.scene.game.battle.finishBattle("win"),o||(this.scene.audio.playSound(G.WIN_BATTLE),this.scene.effectManger.playResultWinAnimation()),this.scene.analytics.levelComplete(r),this.scene.analytics.gameMilestone("reach_milestone",{milestone:r},0,0),i.isRunning()?this.handleTutorialCase():this.openResultScreen()}openResultScreen(){const{screenManager:e,coinManager:t,gameMode:s,levelManager:i}=this.scene,a=t.getRewardCoinsByAttackCoins(),r=i.currentLevelId>=1598?0:Ta;this.scene.time.delayedCall(r,async()=>{this.scene.stopManager();const{audio:o,globalScene:c,lang:l}=this.scene.game;if(this.scene.game.ads.canbeShowInterstitialAd()){let h=null;try{o.muteAll(),this.scene.scene.pause(),h=this.scene.game.globalScene.time.delayedCall(200,()=>{c.screen.open(I.NOTIFY_SCREEN,{message:l.Text.LOADING_ADS,duration:0,loading:!0})}),o.muteAll(),await this.scene.game.ads.showInterstitialAdAsync()}catch(u){console.info("🚀 > showInterstitialAdAsync",u)}finally{o.unmuteAll(),this.scene.game.ads.preloadInterstitialAdAsync().catch(()=>{}),h?.remove(),c.screen.close(I.NOTIFY_SCREEN)}}e.showResultScreen("win",s,a)})}handleTutorialCase(){const{levelManager:e,coinManager:t,screenManager:s,gameMode:i}=this.scene;e.getCurrentLevelId()===1&&this.scene.analytics.event(v.TUTORIAL_STEP,{step:5});const r=t.getRewardCoinsByAttackCoins();this.scene.time.delayedCall(Ta,async()=>{this.scene.stopManager(),s.showResultScreen("win",i,r)})}ready(){}play(){}levelFail(){}levelComplete(){}levelLoading(){const e=new Gt(this.scene);this.scene.stateManager.changeStateTo(e)}quit(){const e=new hs(this.scene);this.scene.stateManager.changeStateTo(e)}update(){}}const fn=mA;class AA{scene;currentState;constructor(e){this.scene=e}init(){this.currentState||(this.currentState=new Gt(this.scene)),this.currentState.levelLoading()}changeStateTo(e){this.currentState=e}isInReadyState(){return this.currentState instanceof zs}isInPlayingState(){return this.currentState instanceof Dc}isInLevelLoadingState(){return this.currentState instanceof Gt}isInLevelFailState(){return this.currentState instanceof Oc}isInLevelCompleteState(){return this.currentState instanceof fn}ready(){this.currentState.ready()}play(){this.currentState.play()}levelFail(){this.currentState.levelFail()}levelComplete(){this.currentState.levelComplete()}levelLoading(){this.currentState.levelLoading()}quit(){this.currentState.quit()}update(){this.currentState.update()}}const SA={targets:[],duration:600,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:{start:1,from:1,to:0}}};class ve extends me{constructor(e){super(SA,e)}}class vc extends Phaser.GameObjects.Container{scene;id;isActive;isDisabled;zone;icon;parentName;constructor(e,t,s,i,a,r){super(e),this.id=t,this.scene=e,this.createIcon(s,i,a,r),this.setSize(a,r),this.createInput(),this.setDepth(M.ITEM),this.scene.add.existing(this)}activeItem=()=>{if(this.isActive===!0||this.isDisabled===!0)return;this.isActive=!0,this.icon.setTint(2927998);const{powerManager:e}=this.scene;e.isStopped()||(this.scene.audio.playSound(G.BUTTON_CLICK),this.activeLogic())};deactivateItem=()=>{if(this.isActive===!1)return;this.isActive=!1,this.icon.setTint(3487029);const{powerManager:e}=this.scene;e.isStopped()||this.deactivateLogic()};enableItem(){this.isDisabled!==!1&&(this.icon.setAlpha(1),this.isDisabled=!1)}disableItem(){this.isDisabled!==!0&&(this.deactivateItem(),this.icon.setAlpha(.4),this.isDisabled=!0)}createIcon(e,t,s,i){this.icon=this.scene.make.image({key:e,frame:t},!1),this.icon.setWorldSize(s,i),this.add(this.icon)}createInput(){const{displayWidth:e,displayHeight:t}=this.icon;this.zone=this.scene.make.zone({width:e,height:t}),this.add(this.zone),Phaser.Display.Align.In.Center(this.zone,this.icon),this.zone.setInteractive({useHandCursor:!0}),this.zone.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnClick)}handleOnClick=()=>{this.logItemEvent();const{powerManager:e}=this.scene;e.activeItem(this.id)};logItemEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(v.BUTTON_CLICK,{button_name:t,screen_name:e}),this.scene.game.analytics.event(v.USE_ITEM,{active:!this.isActive,item_name:this.id})}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}}const{KEY:fi,FRAME:mi}=y.GAMEPLAY,{ID:TA}=Gs.SPEED_UP;class Zi extends vc{scene;isSpeedUp;speedText;glowSpinTween;whiteGlow;constructor(e){super(e,TA,fi,mi.DASHBOARD_SPEED_BTN_OFF,34,38.5),this.scene=e,this.isSpeedUp=!1,this.setName("SpeedUpItem"),this.createSpeedText()}enableItem(){this.isDisabled!==!1&&(this.isDisabled=!1,this.zone.setInteractive())}activeItem=()=>{if(this.isActive===!0||this.isDisabled===!0)return;this.isActive=!0;const{powerManager:e}=this.scene;e.isStopped()||(this.scene.audio.playSound(G.BUTTON_CLICK),this.activeLogic())};activeLogic(){const{stateManager:e}=this.scene;!e.isInPlayingState()&&!e.isInReadyState()||(this.isSpeedUp?this.returnToNormalSpeed():this.speedUpGameplay())}disableItem(){this.isDisabled!==!0&&(this.zone.disableInteractive(),this.isDisabled=!0)}deactivateItem=()=>{if(this.isActive===!1)return;this.isActive=!1;const{powerManager:e}=this.scene;e.isStopped()||this.deactivateLogic()};deactivateLogic(){}speedUpGameplay(){this.icon.setTexture(fi,mi.DASHBOARD_SPEED_BTN_ON),this.isSpeedUp=!0,this.scene.player.setSetting("speedUp",!0);const{stateManager:e}=this.scene;e.isInPlayingState()&&this.scene.unitManager.speedUpAllUnits()}returnToNormalSpeed(){this.icon.setTexture(fi,mi.DASHBOARD_SPEED_BTN_OFF),this.isSpeedUp=!1,this.scene.player.setSetting("speedUp",!1);const{stateManager:e}=this.scene;e.isInPlayingState()&&this.scene.unitManager.resetSpeedAllUnits()}createSpeedText(){const e=this.scene.lang.getCurrentLanguage();let t=10;if(!this.scene.world.isLandscape())switch(e){case"ru":case"ja":t=7;break;case"pt":case"es":case"it":t=9;break}this.speedText=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(t),origin:{x:.5,y:1},text:this.scene.lang.Text.SPEED}),this.add(this.speedText),this.bringToTop(this.speedText);const s=this.scene.world.isLandscape()?12:-5;Phaser.Display.Align.In.BottomCenter(this.speedText,this.icon,0,s)}logItemEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(v.BUTTON_CLICK,{button_name:t,screen_name:e}),this.scene.game.analytics.event(v.USE_ITEM,{value:this.isSpeedUp?"off":"on",item_name:this.id})}}const{MaximumMeleeLevel:ya,MaximumRangedLevel:Ca}=GameCore.Configs.Gameplay;class yA extends le{scene;hideUIAnimation;constructor(e){super(e),this.scene=e,this.initUILogic()}start(){this.isRunning()||(super.start(),this.updateUIData())}updateUIData=()=>{this.updateCoinBar(),this.updateUnitBarUI(),this.updateTotalHpBar()};initUILogic(){const{layoutManager:e,screenManager:t,devToolManager:s}=this.scene,{objects:i}=e;i.startButton.onClick=this.startFight,i.showUnitButton.onClick=t.showUnitsScreen,i.settingsButton.onClick=t.showSettingsScreen,GameCore.Utils.Valid.isDebugger()&&(i.resetLevelButton.onClick=this.scene.resetLevel,i.selectLevelButton.onClick=s.handleShowLoadMapInput,i.currentUnitModButton.onClick=s.handleShowModUnitInput,i.currentAttackModButton.onClick=s.handleShowModAttackInput),this.scene.coin.events.on(xo.RECEIVED,this.updateWhenReceivedCoin)}updateWhenReceivedCoin=e=>{const{tutorialManager:t,layoutManager:s}=this.scene;s.objects.coinBar.setCoins(e),t.isRunning()?t.reupdateGuideUI():this.updateUnitBarUI()};updateCoinBar(){const{coin:e,layoutManager:t}=this.scene,{objects:s}=t,i=e.getCurrentCoins();i instanceof F&&s.coinBar.setCoins(i)}updateUnitBarUI(){const{coin:e,unitManager:t,coinManager:s,layoutManager:i}=this.scene,a=e.getCurrentCoins();if(!(a instanceof F))return;const{objects:r}=i,o=t.getPlayerMeleeSpawnedUnitsCount(),c=s.getUnitPrice(o);r.unitBar.setMeleePrice(c);const l=a.toString(),h=c.toString();r.unitBar.enableMeleeBlock();const u=c.biggerThan(a)&&l!==h;r.unitBar.setMeleeAdsMode(u);const p=t.getPlayerRangedSpawnedUnitsCount(),g=s.getUnitPrice(p);r.unitBar.setRangedPrice(g);const S=g.toString();r.unitBar.enableRangedBlock();const f=g.biggerThan(a)&&l!==S;r.unitBar.setRangedAdsMode(f),this.handleLastSquareCase()}handleLastSquareCase(){const{fieldManager:e,unitManager:t,layoutManager:s}=this.scene;if(e.getRemainingAvailablePlacement()!==1)return;const{objects:i}=s,a=t.getLowestLevelPlayerMeleeUnit(),r=t.getLowestLevelPlayerRangedUnit();a===ya&&r!==Ca&&i.unitBar.disableMeleeBlock(),r===Ca&&a!==ya&&i.unitBar.disableRangedBlock()}updateTotalHpBar(){const{layoutManager:e}=this.scene,{objects:t}=e;t.totalHpBar.setAlpha(1),t.totalHpBar.updateCurrentHp()}setTotalHpBar(e,t){const{objects:s}=this.scene.layoutManager;t?s.totalHpBar.updatePlayerHpUIByMinus(e):s.totalHpBar.updateEnemyHpUIByMinus(e)}startFight=()=>{if(!this.hideUIAnimation){const{objects:e}=this.scene.layoutManager,t=this.getAllPowerItems(),s=[...t,e.unitBar,e.levelBar,e.startButton,e.showUnitButton,e.battleLevelBar],i=t.findIndex(a=>a instanceof Zi);i!==-1&&s.splice(i,1),this.hideUIAnimation=new ve({targets:s,duration:300,onActive:()=>{this.scene.input.enabled=!1},ease:Phaser.Math.Easing.Circular.Out,onComplete:()=>{s.forEach(a=>a.setAlpha(1)),t.forEach(a=>{a instanceof Zi||a.disableItem()}),this.scene.startRound(),this.scene.input.enabled=!0}})}this.hideUIAnimation.play()};getCurrentEnemyHp(){const{objects:e}=this.scene.layoutManager;return e.totalHpBar.getCurrentEnemyHp()}getCurrentPlayerHp(){const{objects:e}=this.scene.layoutManager;return e.totalHpBar.getCurrentPlayerHp()}getAllPowerItems(){return this.scene.powerManager.getAllItems()}disableUnitBlocks(){const{objects:e}=this.scene.layoutManager;e.unitBar.disableUnitBlocks()}disableAdsUnitBlocks(){const{objects:e}=this.scene.layoutManager;e.unitBar.disableAdsForBlocks()}enableStartButton(){const{objects:e}=this.scene.layoutManager;e.startButton.setDisabled(!1)}isStartButtonDisabled(){const{objects:e}=this.scene.layoutManager;return e.startButton.isDisabled()}runUnitBtnAnim(){const{objects:e}=this.scene.layoutManager;e.showUnitButton.runAnimation()}getUnitBtnPos(){const{objects:e}=this.scene.layoutManager;return new Phaser.Math.Vector2(e.showUnitButton.x,e.showUnitButton.y)}showUIForLevelLoadingState(){const{groups:e}=this.scene.layoutManager;e.allUI.killGroup(),e.levelLoadingStateUI.reviveGroup()}showUIForReadyState(){const{gameMode:e,gameZone:t}=this.scene,{levelManager:s,layoutManager:i}=this.scene,{groups:a,objects:r}=i;if(a.allUI.killGroup(),e===V.NORMAL){const o=s.getCurrentLevelId();r.levelBar.setLevel(o),a.normalPlayingStateUI.killGroup(),a.normalReadyStateUI.reviveGroup()}if(e===V.BATTLE){const o=this.scene.battle.getPlayerInfo(),c=this.scene.battle.getOpponentInfo();o&&c&&r.battleLevelBar.updateData(o,c),a.battlePlayingStateUI.killGroup(),a.battleReadyStateUI.reviveGroup(),r.startButton.setX(t.width/2)}this.updateUIData()}showUIForPlayingState(){const{gameMode:e,layoutManager:t}=this.scene,{groups:s}=t;e===V.NORMAL&&(s.normalReadyStateUI.killGroup(),s.normalPlayingStateUI.reviveGroup()),e===V.BATTLE&&(s.battleReadyStateUI.killGroup(),s.battlePlayingStateUI.reviveGroup()),this.scene.tutorialManager.isRunning()&&this.scene.layoutManager.objects.speedUpItem.kill(),this.updateUIData()}showUIForGuide1(){const{layoutManager:e}=this.scene,{groups:t,objects:s}=e;t.allUI.killGroup(),t.guideStateUI.reviveGroup(),s.unitBar.kill()}showUIForGuide2(e){const{layoutManager:t}=this.scene,{groups:s,objects:i}=t;i.unitBar.killBg(),e===1?(s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.startButton.kill(),this.updateCoinBar(),this.updateUnitBarUI(),i.unitBar.killMeleeBlock(),i.unitBar.setDepth(M.TUTORIAL_OBJECT)):e===2?(i.unitBar.reviveMeleeBlock(),i.unitBar.kill(),i.unitBar.setDepth(M.BUTTON)):e===3&&(s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.unitBar.kill(),i.startButton.revive())}showUIForGuidePrevent(){const{layoutManager:e}=this.scene,{groups:t,objects:s}=e;t.allUI.killGroup(),t.guideStateUI.reviveGroup(),s.unitBar.kill()}showUIForGuide3(e){const{layoutManager:t}=this.scene,{groups:s,objects:i}=t;if(i.unitBar.killBg(),e===1){const{accessibilityManager:a}=this.scene;a.stop(),s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.startButton.kill(),this.updateCoinBar(),this.updateUnitBarUI(),i.unitBar.killRangedBlock(),i.unitBar.setDepth(M.TUTORIAL_OBJECT)}else if(e===2){const{accessibilityManager:a}=this.scene;a.stop(),s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.startButton.kill(),i.showUnitButton.revive(),i.unitBar.reviveRangedBlock(),i.unitBar.kill(),i.unitBar.setDepth(M.BUTTON)}else e===3&&(s.allUI.killGroup(),s.guideStateUI.reviveGroup(),i.unitBar.kill(),i.startButton.revive(),i.showUnitButton.revive())}addOnceCallbackForMeleeBlock(e){const{objects:t}=this.scene.layoutManager;t.unitBar.addOnceClickEventForMeleeBlock(e)}addOnceCallbackForRangedBlock(e){const{objects:t}=this.scene.layoutManager;t.unitBar.addOnceClickEventForRangedBlock(e)}addOnceCallbackForStartBtn(e){const{objects:t}=this.scene.layoutManager;t.startButton.setOnceCallback(e)}getMeleeBlockWorldPosition(){const e=this.getMeleeBlockConfig();return{x:e.worldX,y:e.worldY}}getRangedBlockWorldPosition(){const e=this.getRangedBlockConfig();return{x:e.worldX,y:e.worldY}}getMeleeBlockConfig(){const{objects:e}=this.scene.layoutManager;return e.unitBar.getMeleeBlockConfig()}getRangedBlockConfig(){const{objects:e}=this.scene.layoutManager;return e.unitBar.getRangedBlockConfig()}getStartBtnWorldPosition(){const{objects:e}=this.scene.layoutManager;return e.startButton.getWorldPosition()}}class ae extends Error{constructor(e,t){super(e,t),this.name="NoUnitFound",this.message=e||"No Unit Found",this.payload=t}}const Q={PREPARE:"prepare",READY:"ready",MOVING_TO_TARGET:"movingToTarget",PREPARE_TO_ATTACK:"prepareToAttack",ATTACKING:"attacking",FINISHED_ATTACKING:"finishedAttacking",KILLED:"killed"};class CA{unit;attackSpots;attackTarget;beingAttackedByMelee;beingAttackedByRanged;attackSpotPairings;constructor(e){this.unit=e,this.attackSpots=[],this.attackSpotPairings=[]}reset(){this.resetAttackSpots(),this.resetAttackTarget(),this.beingAttackedByMelee=null,this.beingAttackedByRanged=null}createAttackSpots(){const{x:e,y:t}=this.unit,{MELEE_ATTACK_RANGE:s}=D;for(let i=0;i<=8;i++)if(i===0){const a=new Phaser.Math.Vector2(e+s,t),r=new Phaser.Math.Vector2(e-s,t);this.attackSpots.push({location:a,occupiedUnit:null}),this.attackSpots.push({location:r,occupiedUnit:null});const o=this.attackSpots.length-1;this.attackSpotPairings.push({a:o-1,b:o})}else{const a=Phaser.Math.DegToRad(i*20/4),r=new Phaser.Math.Vector2(e+s*Math.cos(a),t+s*Math.sin(a)),o=new Phaser.Math.Vector2(e-s*Math.cos(a),t+s*Math.sin(a)),c=new Phaser.Math.Vector2(e+s*Math.cos(a),t-s*Math.sin(a)),l=new Phaser.Math.Vector2(e-s*Math.cos(a),t-s*Math.sin(a));this.attackSpots.push({location:r,occupiedUnit:null}),this.attackSpots.push({location:o,occupiedUnit:null}),this.attackSpots.push({location:c,occupiedUnit:null}),this.attackSpots.push({location:l,occupiedUnit:null});const h=this.attackSpots.length-1;this.attackSpotPairings.push({a:h-3,b:h}),this.attackSpotPairings.push({a:h-2,b:h-1})}}assignAttackingUnit(e){if(this.attackTarget===e){let o=-1;if(e.attackController.attackSpots.find((c,l)=>c.occupiedUnit===this.unit&&o===-1?(o=l,!0):!1),o!==-1){const c=this.attackSpotPairings.find(l=>l.a===o||l.b===o);if(c){const l=c.a===o?c.b:c.a;return this.attackSpots[l]}}}let t;const s=this.attackSpots.filter(o=>{const c=o.occupiedUnit===null||o.occupiedUnit===e;let l=!0;o.occupiedUnit===e&&(t=o);const{gameZone:h}=this.unit.scene;return this.unit.x<h.displayWidth/5&&(l=o.location.x>this.unit.x),this.unit.x>h.displayWidth-h.displayWidth/5&&(l=o.location.x<this.unit.x),c&&l});if(s.length===0)return null;const{x:i,y:a}=e,r=s.reduce((o,c)=>{const{x:l,y:h}=c.location,{x:u,y:p}=o.location,g=Math.sqrt(Math.pow(l-i,2)+Math.pow(h-a,2)),S=Math.sqrt(Math.pow(u-i,2)+Math.pow(p-a,2));return g<S?c:o},s[0]);return t&&t!==r&&(t.occupiedUnit=null),r.occupiedUnit=e,r}clearAttackingUnit(e){this.attackSpots.forEach(t=>{t.occupiedUnit===e&&(t.occupiedUnit=null)})}moveAttackSpotMelee(e,t){this.attackSpots.forEach(s=>{const{x:i,y:a}=s.location;s.location.set(i+e,a+t)})}checkForInvalidOccupiedUnits(){this.attackSpots.forEach(e=>{e.occupiedUnit&&e.occupiedUnit.isKilled()&&(e.occupiedUnit=null)})}resetAttackSpots(){this.attackSpots=[],this.createAttackSpots()}resetAttackSpotOfUnit(e){this.attackSpots.forEach(t=>{t.occupiedUnit===e&&(t.occupiedUnit=null)})}getAttackTarget(){return this.attackTarget}setAttackTarget(e){this.attackTarget=e}notifyTargetAttacked(e){e.unitType===D.MELEE_UNIT_TYPE?this.beingAttackedByMelee=e:e.unitType===D.RANGED_UNIT_TYPE&&(this.beingAttackedByRanged=e)}resetAttackTarget(){this.attackTarget=null}}const{MANAGER_BASE_DEPTH:Ia}=M;class IA{unit;scene;constructor(e){this.unit=e,this.scene=e.scene}calculateDepth(){const{y:e,currentLocation:t=null}=this.unit,{height:s}=this.scene.fieldManager.firstHightLineZone,i=e+s/4;let a=0;t&&this.unit.isInPrepareMode()&&(a=t.colId);const{fieldBackground:r}=this.scene.fieldManager,o=r.getTopLeft().y,c=r.displayHeight/100,l=-a;return Ia+(Math.floor((i-o)/c)+l)*.4}setDepthOnDeath(){this.unit.isDepthDirty=!1;const e=this.calculateDepth()-.2;this.unit.setDepth(e)}getProjectileDepth(){return Ia+41}}class RA{unit;scene;constructor(e){this.unit=e,this.scene=e.scene}getAttackTarget(){const{unitType:e}=this.unit;switch(e){case D.MELEE_UNIT_TYPE:return this.getAttackTargetForMeleeUnit();case D.RANGED_UNIT_TYPE:return this.getAttackTargetForRangedUnit();default:return null}}getAttackTargetForMeleeUnit(){const{x:e,y:t,isPlayer:s}=this.unit;if(this.unit.isKilled())return null;const{enemyUnits:i,playerUnits:a}=this.scene.unitManager,o=(s?i:a).getChildren().filter(f=>f instanceof B?!f.isKilled():!1);switch(o.length){case 0:return null;case 1:return o[0]}let c=1e4;const l=o.sort((f,T)=>{const{x:A,y:m}=f,{x:C,y:O}=T,U=Math.sqrt(Math.pow(A-e,2)+Math.pow(m-t,2)),Y=Math.sqrt(Math.pow(C-e,2)+Math.pow(O-t,2));return c=Math.min(c,U),c=Math.min(c,Y),U-Y}),h=[l[0]];for(let f=1;f<l.length;f++){const T=l[f],{x:A,y:m}=T;if(Math.sqrt(Math.pow(A-e,2)+Math.pow(m-t,2))!==c)break;h.push(T)}switch(h.length){case 1:return h[0]}let u=h[0].currentHp;const p=h.sort((f,T)=>(u=Math.min(u,f.currentHp),u=Math.min(u,T.currentHp),f.currentHp-T.currentHp)),g=[p[0]];for(let f=1;f<p.length;f++){const T=p[f];if(T.currentHp!==u)break;g.push(T)}switch(g.length){case 1:return g[0]}return g.sort((f,T)=>T.attackPower-f.attackPower)[0]}getAttackTargetForRangedUnit(){const{x:e,y:t,isPlayer:s}=this.unit;if(this.unit.isKilled())return null;const{enemyUnits:i,playerUnits:a}=this.scene.unitManager,o=(s?i:a).getChildren().filter(f=>f instanceof B?!f.isKilled():!1);switch(o.length){case 0:return null;case 1:return o[0]}let c=1e4;const l=o.sort((f,T)=>{const{x:A,y:m}=f,{x:C,y:O}=T,U=Math.sqrt(Math.pow(A-e,2)+Math.pow(m-t,2)),Y=Math.sqrt(Math.pow(C-e,2)+Math.pow(O-t,2));return c=Math.min(c,U),c=Math.min(c,Y),U-Y}),h=[l[0]];for(let f=1;f<l.length;f++){const T=l[f],{x:A,y:m}=T;if(Math.sqrt(Math.pow(A-e,2)+Math.pow(m-t,2))!==c)break;h.push(T)}switch(h.length){case 1:return h[0]}let u=h[0].currentHp;const p=h.sort((f,T)=>(u=Math.min(u,f.currentHp),u=Math.min(u,T.currentHp),f.currentHp-T.currentHp)),g=[p[0]];for(let f=1;f<p.length;f++){const T=p[f];if(T.currentHp!==u)break;g.push(T)}switch(g.length){case 1:return g[0]}return g.sort((f,T)=>f.attackPower-T.attackPower)[0]}}class _A{unit;scene;tween;constructor(e){this.unit=e,this.scene=e.scene}createTween(){this.tween?.remove(),this.tween=this.scene.tweens.addCounter({from:0,to:100,duration:200,onStart:()=>{this.unit.display.clearTint()},onUpdate:e=>{const t=e.getValue(),s=Math.floor(255/100*t),i=Math.floor(255/100*t),a=Phaser.Display.Color.GetColor(255,i,s);this.unit.display.setTint(a)},onComplete:()=>{this.unit.display.clearTint()}})}run(){this.createTween()}stop(){this.tween?.remove(),this.unit.display.clearTint()}}var LA=4,wA=.001,PA=1e-7,OA=10,es=11,Ss=1/(es-1),DA=typeof Float32Array=="function";function Nc(n,e){return 1-3*e+3*n}function bc(n,e){return 3*e-6*n}function Mc(n){return 3*n}function Hs(n,e,t){return((Nc(e,t)*n+bc(e,t))*n+Mc(e))*n}function Uc(n,e,t){return 3*Nc(e,t)*n*n+2*bc(e,t)*n+Mc(e)}function vA(n,e,t,s,i){var a,r,o=0;do r=e+(t-e)/2,a=Hs(r,s,i)-n,a>0?t=r:e=r;while(Math.abs(a)>PA&&++o<OA);return r}function NA(n,e,t,s){for(var i=0;i<LA;++i){var a=Uc(e,t,s);if(a===0)return e;var r=Hs(e,t,s)-n;e-=r/a}return e}function bA(n){return n}var MA=function(e,t,s,i){if(!(0<=e&&e<=1&&0<=s&&s<=1))throw new Error("bezier x values must be in [0, 1] range");if(e===t&&s===i)return bA;for(var a=DA?new Float32Array(es):new Array(es),r=0;r<es;++r)a[r]=Hs(r*Ss,e,s);function o(c){for(var l=0,h=1,u=es-1;h!==u&&a[h]<=c;++h)l+=Ss;--h;var p=(c-a[h])/(a[h+1]-a[h]),g=l+p*Ss,S=Uc(g,e,s);return S>=wA?NA(c,g,e,s):S===0?g:vA(c,l,l+Ss,e,s)}return function(l){return l===0?0:l===1?1:Hs(o(l),t,i)}};const mn=MA,UA=mn(0,1.9,.42,1.9);class kA{unit;scene;currentTotalNumber;constructor(e){this.unit=e,this.scene=e.scene,this.currentTotalNumber=new F(0)}increaseNumberStack(e){this.currentTotalNumber.baseValue===0&&this.scene.time.delayedCall(150,this.handleShowEffect),this.currentTotalNumber.add(e)}handleShowEffect=()=>{this.createFloatingText(this.currentTotalNumber),this.currentTotalNumber=new F(0)};createFloatingText(e){const s=this.getText(e),{effectManger:i}=this.scene,a=i.getTextEffectObject();a.revive(),a.setText(s),a.setFontSize(14),a.setPosition(this.unit.x,this.unit.y),this.scene.add.tween({targets:a,props:{alpha:{from:0,duration:100,ease:Phaser.Math.Easing.Expo.Out,to:1}},onComplete:()=>{const{displayHeight:r}=this.unit.display,o=16753920;a.setTint(o);const c=this.unit.display.isSpine()?this.unit.y-r/2:this.unit.y,l=Phaser.Math.Between(-1,1)<0?this.unit.x-50:this.unit.x+50;this.scene.add.tween({targets:a,props:{alpha:{from:1,duration:300,ease:Phaser.Math.Easing.Expo.Out,to:0,delay:700},x:{from:this.unit.x,duration:1e3,ease:Phaser.Math.Easing.Linear,to:l},y:{from:c,duration:1e3,ease:UA,to:c-15}},onComplete:()=>{a.setAlpha(1),a.kill()}})}})}getText(e){return`${e.toString()}`}}class BA extends kA{handleShowEffect=()=>{this.createFloatingText(this.currentTotalNumber),this.scene.coin.plusCoins(this.currentTotalNumber.baseValue,this.currentTotalNumber.suffix);const e=this.scene.coin.getCurrentCoins(),{objects:t}=this.scene.layoutManager;t.coinBar.setCoins(e),this.currentTotalNumber=new F(0)};getText(e){return`$${e.toString()}`}}class xA{unit;scene;tween;constructor(e){this.unit=e,this.scene=e.scene}createTween(){if(this.tween?.remove(),!this.unit.isKilled())return;const e=this.unit.getCurrentDisplay();e&&(this.tween=this.scene.tweens.add({targets:[e],delay:200,duration:300,ease:Phaser.Math.Easing.Quintic.InOut,props:{alpha:{start:1,from:1,to:0}},onStart:()=>{this.unit.active||this.stop()},onComplete:()=>{this.unit.kill()}}))}play(){this.createTween()}stop(){this.tween?.remove();const e=this.unit.getCurrentDisplay();this.scene.tweens.killTweensOf(e),e.setAlpha(1),this.unit.revive()}}class FA{unit;coinsEffect;damagedEffect;dieEffect;constructor(e){this.unit=e,this.createCoinsEffect(),this.createDamagedEffect(),this.createDieEffect()}createCoinsEffect(){this.coinsEffect=new BA(this.unit)}createDamagedEffect(){this.damagedEffect=new _A(this.unit)}createDieEffect(){this.dieEffect=new xA(this.unit)}runDamagedEffect(){this.damagedEffect.run()}stopDamageEffect(){this.damagedEffect.stop()}runDieEffect(){this.dieEffect.play()}stopDieEffect(){this.dieEffect.stop()}increaseCoinEffectStack(e){this.coinsEffect.increaseNumberStack(e)}}const{KEY:Ra,FRAME:_a}=y.GAMEPLAY;class kc extends Phaser.GameObjects.Container{bg;frame;defaultHp;currentHp;color;hpLength;hpHeight;constructor(e,t){super(e),this.defaultHp=100,this.currentHp=100,this.hpLength=30,this.hpHeight=4,this.color=t,this.createHealthBar(),this.scene.add.existing(this)}createHealthBar(){const e=this.scene.make.image({key:Ra,frame:_a.HP_BAR_BG}),t=.5,s=this.hpLength+t*2,i=this.hpHeight+t*2;e.setOrigin(0,.5),e.setWorldSize(s,i),e.setX(-s/2),this.add(e),this.bg=e;const a=this.scene.make.image({key:Ra,frame:_a.HP_BAR_BG});a.setOrigin(0,.5),a.setWorldSize(this.hpLength,this.hpHeight),a.setX(-this.hpLength/2),this.add(a),this.frame=a}setInitHp(e){this.defaultHp=e,this.currentHp=e,this.updateFrameUI()}getCurrentHp(){return this.currentHp}updateCurrentHpUI(e){e<0&&(e=0),this.currentHp=e,this.updateFrameUI()}updateHpUIByMinus(e){this.currentHp-=e,this.currentHp<0&&(this.currentHp=0),this.updateFrameUI()}updateFrameUI(){this.frame.setWorldSize(this.currentHp/this.defaultHp*this.hpLength,this.hpHeight),this.frame.setTintFill(this.color)}changeHpColor(e){const t=e?39423:15466524;this.frame.setTintFill(t),this.color=t}}class GA{unit;hpBar;spineOffset;constructor(e){this.unit=e,this.createHpBar()}createHpBar(){const{scene:e,isPlayer:t}=this.unit,s=t?39423:15466524;this.hpBar=new kc(e,s),this.updatePositionHpBar(),this.hpBar.setDepth(M.UNIT_HP_BAR)}destroyHpBar(){this.hpBar.destroy()}updatePositionHpBar(){this.spineOffset||(this.spineOffset=this.unit.display.displayHeight-20);const{x:e,y:t}=this.unit.getWorldPosition();this.hpBar.setPosition(e,t-this.spineOffset)}setInitHp(e){this.hpBar.setInitHp(e)}updateCurrentHpUI(e){this.hpBar.updateCurrentHpUI(e)}reviveHpBar(){this.hpBar.revive()}killHpBar(){this.hpBar.kill()}changeHpColor(e){this.hpBar.changeHpColor(e)}update(){this.updatePositionHpBar()}}const{UNIT_SIZE_SCALE:Ts}=D,{modifier:HA}=GameCore.Configs.Gameplay.Powers.SpeedUp,YA={end:()=>{},start:()=>{},event:(n,e)=>{},dispose:()=>{},complete:()=>{},interrupt:()=>{}};class KA extends Phaser.GameObjects.Container{scene;unit;config;spine;spineScale;isUseSpine;sprite;spriteEvent;isFlipX;constructor(e,t){super(e.scene),this.unit=e,this.scene=e.scene,this.config=t,this.isUseSpine=t.useSpine,this.isFlipX=!1,this.initDisplay(),this.scaleDisplay(),this.y+=20}initDisplay(){const{spine:e,sprite:t,useSpine:s}=this.config;s?(this.createSpine(e.key,e.spineConfig),this.spine.setVisible(!0),this.spine.setActive(!0)):t&&(this.createSprite(t.key,t.frame,t.displayWidth,t.displayHeight),this.sprite.revive())}scaleDisplay(){if(this.spine){const{displayWidth:e,displayHeight:t}=this.spine;this.setSize(e,t)}else if(this.sprite){const{displayWidth:e,displayHeight:t}=this.sprite;this.setSize(e,t)}}createSprite(e,t,s,i){this.sprite=this.scene.add.sprite(0,0,e,t),this.sprite.setOrigin(.5,1),this.sprite.setDisplaySize(s*Ts,i*Ts),this.add(this.sprite),this.sprite.kill()}createSpine(e,t,s=!1){if(this.spine=this.scene.add.spine(0,0,e,t.animation,t.loop),this.setSpineScale(.5*Ts,.5*Ts),this.spine.setName(e),this.add(this.spine),s){const{spineManager:i}=this.scene;i.addSpines([this.unit])}this.spine.setVisible(!1),this.spine.setActive(!1)}setSpineScale(e,t){this.spine&&(this.spine.scaleX===e&&this.spine.scaleY===t||(this.spineScale=t,this.spine.setScale(e,t)))}getSpineScale(){return this.spineScale}isSpine(){return this.isUseSpine}getCurrentDisplay(){return this.isUseSpine?this.spine:this.sprite}getSpineDisplay(){return this.spine}getSpriteDisplay(){return this.sprite}play(e,t,s=!1,i=!0,a=!0){if(this.setUseSpine(a),this.isUseSpine)this.spine.play(t,s,i);else{const r=this.sprite.visible;this.sprite.play({key:e,repeat:s?-1:0},i),this.sprite.setVisible(r)}}setUseSpine(e){if(this.isUseSpine!==e){if(this.isUseSpine=e,e){if(!this.spine){const{key:t,spineConfig:s}=this.config.spine;this.createSpine(t,s,!0)}}else if(!this.sprite&&this.config.sprite){const{key:t,frame:s,displayWidth:i,displayHeight:a}=this.config.sprite;this.createSprite(t,s,i,a)}e?(this.sprite.removeAllListeners(),this.spriteEvent?.remove()):this.spine.state.clearListeners(),this.setFlipX(this.isFlipX),e?(this.spine.setVisible(!0),this.spine.setActive(!0),this.sprite.kill()):(this.spine.setVisible(!1),this.spine.setActive(!1),this.sprite.revive())}}setAnimationTimeScale(e){const s=this.unit.scene.powerManager.isGameSpeedUp()?HA:1;this.isUseSpine?this.spine.timeScale=e*s:this.sprite.anims.timeScale=e*s}getAnimationTimeScale(){return this.isUseSpine?this.spine.timeScale:this.sprite.anims.timeScale}setFlipX(e){if(this.isUseSpine){if(e&&this.spine.scaleX<0||!e&&this.spine.scaleX>0)return;this.setSpineScale(e?-this.spineScale:this.spineScale,this.spineScale)}else this.sprite.setFlipX(e);this.isFlipX=e}isFaceLeft(){return this.isUseSpine?this.spine.scaleX<0:this.sprite.flipX}setTint(e){try{this.isUseSpine?this.spine.setColor(e):this.sprite.setTint(e)}catch(t){console.warn(t)}}clearTint(){try{this.spine&&this.spine.setColor(),this.sprite&&this.sprite.clearTint()}catch(e){console.warn(e)}}getSpineAnimationAttackingTime(){if(!this.spine)return 0;let e;const{unitType:t,isPlayer:s}=this.unit,{MELEE:i,RANGED:a}=W;switch(t){case D.MELEE_UNIT_TYPE:e=this.spine.findAnimation(i.ATTACK);break;case D.RANGED_UNIT_TYPE:e=this.spine.findAnimation(s?a.ATTACK_BELOW:a.ATTACK_ABOVE),e||(e=this.spine.findAnimation(a.ATTACK));break;default:return 0}return e.duration*1e3}addAnimEventListener(e,t,s=!0){if(this.isUseSpine){s&&this.spine.state.clearListeners();const i=this.getEventNameForSpine(e);this.addSpineEventListener(i,t)}else{const i=this.getEventNameForSprite(e);if(typeof i=="string")s&&this.sprite.off(i),this.sprite.on(i,t);else{if(!s)return;const{timeScale:a,msPerFrame:r}=this.sprite.anims;this.spriteEvent?.remove();const o=i*r/a;this.spriteEvent=this.scene.time.delayedCall(o,t)}}}changeCurrentSpriteEventTime(e){return this.isUseSpine||!this.spriteEvent?!1:(this.spriteEvent.timeScale=3,!0)}getEventNameForSprite(e){const{START:t,DISPOSE:s,INTERRUPT:i}=be,{ANIMATION_COMPLETE:a,ANIMATION_START:r,ANIMATION_STOP:o}=Phaser.Animations.Events,{unitType:c,level:l}=this.unit;switch(e){case s:case i:return o;case t:return r;case W[c.toUpperCase()].CUSTOM_EVENTS.FINISHED_ATTACKING:{let h=ne[c.toUpperCase()][l].ATTACK.EVENT_FRAME;return h||(h=0),h}default:return a}}getEventNameForSpine(e){const{ANIMATION_COMPLETE:t,ANIMATION_START:s,ANIMATION_STOP:i}=Phaser.Animations.Events;switch(e){case s:return be.START;case i:return be.DISPOSE;case t:return be.COMPLETE;default:return e}}addSpineEventListener(e,t){const s={...YA};switch(e){case be.END:s.end=()=>{t()};break;case be.START:s.start=()=>{t()};break;case be.EVENT:s.event=()=>{t()};break;case be.DISPOSE:s.dispose=()=>{t()};break;case be.COMPLETE:s.complete=()=>{this.spine.state.removeListener(s),t()};break;case be.INTERRUPT:s.interrupt=()=>{t()};break;default:s.event=(i,a)=>{a.data.name===e&&t()};break}this.spine.state.addListener(s)}}const{DEPTH_ON_DRAG:VA}=M;class WA extends Phaser.GameObjects.Container{isDebug=!1;scene;display;dragZone;attackEvent;status;unitName;level;actions;hp;attackPower;attackInterval;unitType;uiController;depthController;attackController;targetController;effectController;currentLocation;isPlayer;lastDragPosition;lastWorldPosition;originalUnitData;isDepthDirty;constructor(e,t,s,i,a,r){super(e,t,s),this.scene=e,this.createDragZone(),this.createDisplay(r),this.hp=0,this.level=0,this.attackPower=0,this.isDepthDirty=!1,this.unitType="base",this.isPlayer=i,this.uiController=new GA(this),this.depthController=new IA(this),this.attackController=new CA(this),this.targetController=new RA(this),this.effectController=new FA(this),this.setUnitData(a),this.isPlayer&&this.addEventListener(),this.createActions(),this.actions.prepare(),this.scene.add.existing(this)}createDisplay(e){this.display=new KA(this,e),this.add(this.display)}createDragZone(){const{fieldManager:e}=this.scene;if(!e)return;const{displayWidth:t,displayHeight:s}=e.getPlayerPlacementSquare(1,1).areaRect;this.dragZone=this.scene.add.zone(0,0,t,s),this.add(this.dragZone)}addEventListener(){this.dragZone.setInteractive({draggable:!0,useHandCursor:!0}),this.dragZone.on(Phaser.Input.Events.GAMEOBJECT_DRAG_START,this.onDragStart),this.dragZone.on(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.onDragEnd),this.dragZone.on(Phaser.Input.Events.GAMEOBJECT_DRAG,this.onDrag)}addOnceEvent(e,t){this.dragZone.once(e,t)}removeOnceEvent(e,t){this.dragZone.off(e,t)}updatePositionHpBar(){this.uiController.updatePositionHpBar()}removeEventListener(){this.dragZone.off(Phaser.Input.Events.GAMEOBJECT_DRAG_START,this.onDragStart),this.dragZone.off(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.onDragEnd),this.dragZone.off(Phaser.Input.Events.GAMEOBJECT_DRAG,this.onDrag),this.dragZone.disableInteractive()}startEventListener(){this.removeEventListener(),this.addEventListener()}setDefaultHp(e){const{playerIsCheater:t,opponentIsCheater:s}=window.clientInformation||{};let i=e;this.level>1&&(t&&this.isPlayer&&(i/=2),s&&!this.isPlayer&&(i/=2)),this.hp=i,this.uiController.setInitHp(i)}get currentHp(){return this.hp}canbeAttacked(){if(this.isFinishedAttacking())throw new Error("Unit is finished attacking");if(this.isKilled())throw new Error("Unit is killed");const e=this.attackController.getAttackTarget();if(!e||e?.isKilled())throw new Error("No attack target")}attack=()=>{try{if(this.canbeAttacked(),!this.isPreparingToAttack()&&!this.isAttacking())return;this.actions.attack();const e=this.attackController.getAttackTarget();if(!e)throw new Error("No attack target");if(e.isKilled())throw new Error("Attack target is killed");const t=this.scene.powerManager.isGameSpeedUp()?.5:1;this.attackEvent=this.scene.time.delayedCall(this.attackInterval*t,this.attack)}catch{this.attackEvent?.destroy(),this.actions.ready()}};modifyCurrentAttackEvent(){if(!this.attackEvent||this.attackEvent.getProgress()===1||this.isKilled())return;const e=this.attackEvent.getRemaining();if(e===0)return;const t=this.scene.powerManager.isGameSpeedUp()?.5:2;this.attackEvent.reset({delay:e*t,callback:this.attack})}takeDamage(e){if(this.hp<=0)return;const{coinManager:t,uiManager:s}=this.scene;if(!this.isPlayer){const r=t.getAttackCoinByUnit(e,this);t.addCoinsByAttack(r),this.effectController.increaseCoinEffectStack(r)}const i=this.hp,a=this.getCorrectAttackPower(e);if(this.hp-=a,this.hp<0&&(this.hp=0),this.uiController.updateCurrentHpUI(this.hp),s.setTotalHpBar(i-this.hp,this.isPlayer),this.scene.audio.playSound(G.UNIT_DAMAGED,{volume:.2+Math.random()*.8}),it(50),this.hp<=0){this.actions.die();return}this.effectController.runDamagedEffect()}getCorrectAttackPower(e){const{playerIsCheater:t,opponentIsCheater:s}=window.clientInformation||{};let{attackPower:i}=e;return t&&this.level>1&&(this.isPlayer?i*=1*e.level:i/=2*this.level),s&&(this.isPlayer?i/=10*this.level:i*=20*e.level),i}onDragStart=()=>{const{firstHightLineZone:e}=this.scene.fieldManager;e.revive(),e.setPosition(this.x,this.y),this.lastDragPosition=new Phaser.Math.Vector2(this.x,this.y),this.setDepthOnDrag();const{spineManager:t}=this.scene;t.bringToTopOnDrag(this),this.scene.audio.playSound(G.UNIT_DRAG_START)};onDragEnd=()=>{const{unitManager:e,fieldManager:t}=this.scene,{firstHightLineZone:s,secondHightLineZone:i}=t;s.kill(),i.kill(),this.isDepthDirty=!0;const a=t.getSquareBasedOnPosition(this.lastDragPosition.x,this.lastDragPosition.y);if(!a||a===this.currentLocation){this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer),e.resetAttackSpots(this),this.scene.audio.playSound(G.UNIT_DRAG_END);return}const r=e.getUnitBasedOnPosition(a.rowId,a.colId);if(!r){this.assignUnitToSquare(a.rowId,a.colId,this.isPlayer),e.resetAttackSpots(this),this.scene.audio.playSound(G.UNIT_DRAG_END);return}const o=r.unitType===this.unitType,c=r.level===this.level;if(!o||!c){this.swapUnitPosition(r),this.isDepthDirty=!0,r.isDepthDirty=!0,this.scene.audio.playSound(G.UNIT_DRAG_END);return}e.mergeUnits(this,r)?this.currentLocation&&this.currentLocation.setTaken(!1):(this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer),this.scene.audio.playSound(G.UNIT_DRAG_END))};getLastDragPos(){return this.lastDragPosition}dragUnitOnto(e,t){const{unitManager:s,fieldManager:i}=this.scene;this.isDepthDirty=!0;const a=i.getSquareBasedOnIndex(e,t);if(!a||a===this.currentLocation){this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer),s.resetAttackSpots(this);return}const r=s.getUnitBasedOnPosition(a.rowId,a.colId);if(!r){this.assignUnitToSquare(a.rowId,a.colId,this.isPlayer),s.resetAttackSpots(this);return}const o=r.unitType===this.unitType,c=r.level===this.level;if(!o||!c){this.swapUnitPosition(r),this.isDepthDirty=!0,r.isDepthDirty=!0;return}s.mergeUnits(this,r)?this.currentLocation&&this.currentLocation.setTaken(!1):this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer)}onDrag=e=>{const{worldX:t,worldY:s,wasTouch:i}=e,{height:a}=this.scene.fieldManager.firstHightLineZone,r=i?a*.8:a/4,o=i?a*.55:0;this.setPosition(t,s-r),this.lastDragPosition.x=t,this.lastDragPosition.y=s-o;const{fieldManager:c}=this.scene,l=c.getSquareBasedOnPosition(this.lastDragPosition.x,this.lastDragPosition.y),{secondHightLineZone:h}=this.scene.fieldManager;if(!l||l===this.currentLocation){h.kill();return}h.revive(),h.setPosition(l.x,l.y),h.isStroked=!1;const u=this.scene.unitManager.getUnitBasedOnPosition(l.rowId,l.colId);u&&u.unitName===this.unitName&&(h.isStroked=!0)};findTarget(){if(this.isKilled())return;const e=this.targetController.getAttackTarget();e&&this.attackController.setAttackTarget(e)}setUnitData(e){const{health:t,attackSpeed:s,damage:i,name:a,level:r}=e;this.setDefaultHp(t),this.attackInterval=s,this.attackPower=i,this.unitName=a,this.level=r,this.originalUnitData=e}assignUnitToSquare(e,t,s){e===0&&t===0&&!this.isPlayer&&(this.isDebug=!0,console.log(`%c turn on debug for: row ${e} col ${t} isPlayer ${s}`,"font-size:12px;background-color: #9E9689;color:#fff;"));const{fieldManager:i}=this.scene,a=s?i.getPlayerPlacementSquare(e,t):i.getEnemyPlacementSquare(e,t);this.currentLocation&&this.currentLocation.setTaken(!1),this.setPosition(a.x,a.y),a.setTaken(!0),this.currentLocation=a,this.attackController.resetAttackSpots()}spawnUnitOnSquare(e,t,s){const{fieldManager:i}=this.scene,a=s?i.getPlayerPlacementSquare(e,t):i.getEnemyPlacementSquare(e,t);this.setPosition(a.x,a.y),a.setTaken(!0),this.currentLocation=a,this.attackController.resetAttackSpots()}swapUnitPosition(e){const t=e.currentLocation,s=this.currentLocation;e.setPosition(s.x,s.y),this.setPosition(t.x,t.y);const{unitManager:i}=this.scene;i.resetAttackSpots(this),i.resetAttackSpots(e),e.currentLocation=s,this.currentLocation=t}setDepthOnDrag(){this.setDepth(VA)}calcDepth(){if(this.isKilled())return;const e=this.depthController.calculateDepth();e&&this.depth!==e&&this.setDepth(e)}requestAttackPosition(e){return this.attackController.assignAttackingUnit(e)}getCurrentDisplay(){return this.display.getCurrentDisplay()}getSpineDisplay(){return this.display.getSpineDisplay()}reuseUnitOnReady(){this.setActive(!0),this.isDepthDirty=!0,this.assignUnitToSquare(this.currentLocation.rowId,this.currentLocation.colId,this.isPlayer),this.setDefaultHp(this.originalUnitData.health),this.uiController.updateCurrentHpUI(this.hp),this.actions.prepare(),this.setVisible(!0)}reuseUnitFromPool(e){this.setActive(!0),this.isDepthDirty=!0,this.isPlayer!==e&&(this.uiController.changeHpColor(e),this.isPlayer=e),this.uiController.reviveHpBar();const t=this.getSpineDisplay();e?this.startEventListener():this.removeEventListener(),this.setDefaultHp(this.originalUnitData.health),this.uiController.updateCurrentHpUI(this.hp),this.actions.prepare(),t&&t.setVisible(!0),this.setVisible(!0)}handleRemoveFromScene(){this.uiController.killHpBar(),this.attackController.resetAttackSpots(),this.effectController.stopDamageEffect(),this.effectController.stopDieEffect(),this.removeEventListener(),this.setStatus(Q.KILLED),this.attackEvent?.remove(),this.currentLocation&&this.currentLocation.setTaken(!1);const e=this.getSpineDisplay();if(e){const{spineManager:t}=this.scene;t.removeSpine(this),e.setVisible(!1)}this.kill()}setStatus(e){this.status=e}getStatus(){return this.status}getWorldPosition(){return this.lastWorldPosition=super.getWorldPosition(),this.lastWorldPosition}setPosition(e,t,s,i){return super.setPosition(e,t,s,i),this}isInPrepareMode(){return this.status===Q.PREPARE}isReady(){return this.status===Q.READY}isMovingToTarget(){return this.status===Q.MOVING_TO_TARGET}isPreparingToAttack(){return this.status===Q.PREPARE_TO_ATTACK}isAttacking(){return this.status===Q.ATTACKING}isKilled(){return this.status===Q.KILLED}isFinishedAttacking(){return this.status===Q.FINISHED_ATTACKING}update(e,t){this.isDepthDirty&&(this.calcDepth(),this.isDepthDirty=!1),this.scene.stateManager.isInPlayingState()&&this.uiController.update()}}const B=WA,{KEY:$A,FRAME:jA}=y.UNITS_SPRITES,{KEY:zA}=y.UNITS_SPINES.MELEE[1];class xt extends B{constructor(e,t){super(e,0,0,t,{level:100,id:"alien",name:"Warlock",health:1,damage:1,attackSpeed:1},{spine:{key:zA,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},sprite:{key:$A,frame:jA.MELEE[1].MAIN_TEXTURE,displayWidth:86.5,displayHeight:68},useSpine:!0}),this.level=1,this.unitName="Alien Lv.100",this.attackPower=1,this.setDefaultHp(999999)}createActions(){throw new Error("Method not implemented.")}findTarget(){throw new Error("Method not implemented.")}}class Bc{unit;dieCommand;moveCommand;readyCommand;attackCommand;prepareCommand;constructor(e){this.unit=e,this.addDieCommand(),this.addMoveCommand(),this.addReadyCommand(),this.addAttackCommand(),this.addPrepareCommand()}prepare(){this.prepareCommand.execute()}ready(){this.unit.isKilled()||this.readyCommand.execute()}move(){this.unit.isKilled()||this.moveCommand.execute()}attack(){this.unit.isKilled()||this.attackCommand.execute()}die(){this.unit.isKilled()||this.dieCommand.execute()}}class XA{unit;constructor(e){this.unit=e}}class xe extends XA{payload;constructor(e,t){super(e),this.payload=t}execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random())}}let ZA=class extends xe{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.display.play(e,t,!1),this.unit.display.setAnimationTimeScale(1),this.unit.display.addAnimEventListener(W.MELEE.CUSTOM_EVENTS.FINISHED_ATTACKING,this.handleAttacked),this.unit.scene.audio.playSound(G.MELEE_ATTACK,{volume:.5,detune:Math.random()*-1e3});const i=this.unit.attackController.getAttackTarget();i&&this.unit.display.setFlipX(i.x<=this.unit.x)}handleAttacked=()=>{if(this.unit.isKilled())return;const e=this.unit.attackController.getAttackTarget();if(e){if(e.isKilled()){this.unit.display.addAnimEventListener(Phaser.Animations.Events.ANIMATION_COMPLETE,this.handleFinishedAttacking);return}e.takeDamage(this.unit),e.attackController.notifyTargetAttacked(this.unit)}};handleFinishedAttacking=()=>{this.unit.setStatus(Q.FINISHED_ATTACKING)}},qA=class extends xe{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.attackEvent?.remove(),this.unit.uiController.killHpBar(),this.unit.depthController.setDepthOnDeath(),this.unit.effectController.stopDamageEffect(),this.unit.display.play(e,t,!1,!0),this.unit.display.setAnimationTimeScale(1),this.unit.display.addAnimEventListener(Phaser.Animations.Events.ANIMATION_COMPLETE,this.handleAnimationComplete)}handleAnimationComplete=()=>{this.unit.effectController.runDieEffect()}};class QA extends xe{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload,i=this.unit.attackController.getAttackTarget();i&&(this.unit.isDepthDirty=!0,this.unit.getStatus()!==s&&(this.unit.setStatus(s),this.unit.display.play(e,t,!0),this.unit.display.setAnimationTimeScale(.5+Math.random())),this.unit.display.setFlipX(i.x<this.unit.x))}}let JA=class extends xe{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.revive(),this.unit.setStatus(s),this.unit.isDepthDirty=!0,this.unit.uiController.killHpBar(),this.unit.effectController.stopDieEffect(),this.unit.display.setFlipX(!1),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random()),this.unit.attackController.reset()}},eS=class extends xe{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.uiController.reviveHpBar(),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random())}};class tS extends Bc{addAttackCommand(){this.attackCommand=new ZA(this.unit,{status:Q.ATTACKING,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("ATTACK"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("ATTACK")})}addReadyCommand(){this.readyCommand=new eS(this.unit,{status:Q.READY,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}addMoveCommand(){this.moveCommand=new QA(this.unit,{status:Q.MOVING_TO_TARGET,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("RUN"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("RUN")})}addDieCommand(){this.dieCommand=new qA(this.unit,{status:Q.KILLED,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("DIE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("DIE")})}addPrepareCommand(){this.prepareCommand=new JA(this.unit,{status:Q.PREPARE,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}getSpriteAnimKeyByUnitLevel(e){try{const{level:t}=this.unit;let s=t;//! lack of sprite of higher units level
return s>=2&&(s=1),ne.MELEE[s][e].KEY}catch(t){return console.warn(t),ne.ALIEN[1].IDLE.KEY}}getSpineAnimKeyByUnitLevel(e){const t=W.MELEE[e];if(!t)throw new Error(`Can't find spine animation ${e}`);return t}}const{modifier:sS}=GameCore.Configs.Gameplay.Powers.SpeedUp;class Ee extends B{movementSpeed;savedApproachXOffset;savedApproachYOffset;constructor(e,t,s,i,a,r){super(e,t,s,i,a,r),this.unitType=D.MELEE_UNIT_TYPE,this.movementSpeed=D.MELEE_MOVEMENT_SPEED,this.attackInterval=D.MELEE_ATTACK_INTERVAL;const o=this.display.getSpineAnimationAttackingTime();this.attackInterval<o&&(this.attackInterval=o),this.savedApproachXOffset=null,this.savedApproachYOffset=null}createActions(){this.actions=new tS(this)}moveToAttackPosition(e){if(this.isKilled())return;const t=this.attackController.getAttackTarget();if(!t||t?.isKilled())return;const s=t.requestAttackPosition(this);s&&(this.isDepthDirty=!0,this.executeMovement(e,s.location))}executeMovement(e,t){const{x:s,y:i}=this,r=this.scene.powerManager.isGameSpeedUp()?this.movementSpeed*sS:this.movementSpeed,o=r/1e3*e,c=Phaser.Math.Distance.Between(s,i,t.x,t.y),l=t.x-s,h=t.y-i,u=l!==0?l/c*r/1e3*e:0,p=h!==0?h/c*r/1e3*e:0;if(Phaser.Math.Distance.Between(s+u,i+p,t.x,t.y)<=o){this.setPosition(s+u,i+p),this.setStatus(Q.PREPARE_TO_ATTACK),this.attackController.moveAttackSpotMelee(t.x-s,t.y-i);return}this.display.setFlipX(u<0),this.setPosition(s+u,i+p),this.attackController.moveAttackSpotMelee(u,p)}moveToTarget(e){this.moveToAttackPosition(e)}determineCounteringEnemy(){const{beingAttackedByMelee:e,beingAttackedByRanged:t}=this.attackController;let s=this.attackController.getAttackTarget();if(s?.isKilled()&&(s=null),e&&!e.isKilled())return this.attackController.setAttackTarget(e),s?.attackController.resetAttackSpotOfUnit(this),!0;if(t&&!t.isKilled()){const i=Phaser.Math.Distance.Between(this.x,this.y,t.x,t.y),a=s?Phaser.Math.Distance.Between(this.x,this.y,s.x,s.y):1e4;if(i<a)return this.attackController.setAttackTarget(t),s?.attackController.resetAttackSpotOfUnit(this),!0}return!1}setUnitData(e){super.setUnitData(e),this.unitType=D.MELEE_UNIT_TYPE}update(e,t){if(super.update(e,t),this.isKilled()||!this.scene.stateManager.isInPlayingState())return;const s=this.attackController.getAttackTarget();if(this.isReady()){(!s||s.isKilled())&&this.findTarget(),s&&this.actions.move();return}if(this.isMovingToTarget()){const i=this.determineCounteringEnemy();if(this.moveToTarget(t),i)return;if(s?.isKilled()){this.attackController.resetAttackTarget(),this.actions.ready();return}return}if(this.isPreparingToAttack()){if(s?.isKilled()){this.actions.ready();return}this.attack();return}this.isFinishedAttacking()&&(this.savedApproachXOffset=null,this.savedApproachYOffset=null,this.actions.ready())}}const{KEY:iS}=y.UNITS_SPINES.MELEE[10],{listLevelsUseSprite:nS}=GameCore.Configs.UnitsConfig.MELEE;class La extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:iS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!nS.includes(s.level)})}}const{KEY:aS}=y.UNITS_SPINES.MELEE[11],{listLevelsUseSprite:rS}=GameCore.Configs.UnitsConfig.MELEE;class wa extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:aS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!rS.includes(s.level)})}}const{KEY:oS,FRAME:cS}=y.UNITS_SPRITES,{KEY:lS}=y.UNITS_SPINES.MELEE[1],{listLevelsUseSprite:hS}=GameCore.Configs.UnitsConfig.MELEE;class Pa extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:lS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},sprite:{key:oS,frame:cS.MELEE[1].MAIN_TEXTURE,displayWidth:86.5,displayHeight:68},useSpine:!hS.includes(s.level)})}}const{KEY:uS}=y.UNITS_SPINES.MELEE[2],{listLevelsUseSprite:dS}=GameCore.Configs.UnitsConfig.MELEE;class Oa extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:uS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!dS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:pS}=y.UNITS_SPINES.MELEE[3],{listLevelsUseSprite:gS}=GameCore.Configs.UnitsConfig.MELEE;class Da extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:pS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!gS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:ES}=y.UNITS_SPINES.MELEE[4],{listLevelsUseSprite:fS}=GameCore.Configs.UnitsConfig.MELEE;class va extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:ES,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!fS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:mS}=y.UNITS_SPINES.MELEE[5],{listLevelsUseSprite:AS}=GameCore.Configs.UnitsConfig.MELEE;class Na extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:mS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!AS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:SS}=y.UNITS_SPINES.MELEE[6],{listLevelsUseSprite:TS}=GameCore.Configs.UnitsConfig.MELEE;class ba extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:SS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!TS.includes(s.level)}),this.updatePositionHpBar()}}const{KEY:yS}=y.UNITS_SPINES.MELEE[7],{listLevelsUseSprite:CS}=GameCore.Configs.UnitsConfig.MELEE;class Ma extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:yS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!CS.includes(s.level)})}}const{KEY:IS}=y.UNITS_SPINES.MELEE[8],{listLevelsUseSprite:RS}=GameCore.Configs.UnitsConfig.MELEE;class Ua extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:IS,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!RS.includes(s.level)})}}const{KEY:_S}=y.UNITS_SPINES.MELEE[9],{listLevelsUseSprite:LS}=GameCore.Configs.UnitsConfig.MELEE;class ka extends Ee{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:_S,spineConfig:{animation:W.MELEE.IDLE,loop:!0}},useSpine:!LS.includes(s.level)})}}class xc{scene;numOfPlayerSpawnedUnits;resourcePool;constructor(e){this.scene=e,this.resourcePool=new Phaser.GameObjects.Group(this.scene,{runChildUpdate:!1})}init(){this.numOfPlayerSpawnedUnits=0}returnToPool(e){this.resourcePool.add(e)}getPlayerSpawnedUnitsCount(){return this.numOfPlayerSpawnedUnits}setSpawnedUnits(e){this.numOfPlayerSpawnedUnits=e}}class wS extends xc{requestUnitByLevel(e,t,s=!1){let i=this.getUnitFromResourcePoolByLevel(e);return i?(t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,e-1)),i.reuseUnitFromPool(t),this.scene.add.existing(i),i):(i=this.createUnitByLevel(e,t,s),i)}requestUnitById(e,t,s=!1){let i=this.getUnitFromResourcePoolById(e);return i?(t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,i.level-1)),i.reuseUnitFromPool(t),this.scene.add.existing(i),i):(i=this.createUnitById(e,t,s),i)}createUnitByLevel(e,t,s=!1){let i;const a=this.getUnitDataByLevel(e);switch(a||this.scene.rollbar.sendException(new Error(`No unit data found for melee level ${e}`)),e){case 1:i=new Pa(this.scene,t,a);break;case 2:i=new Oa(this.scene,t,a);break;case 3:i=new Da(this.scene,t,a);break;case 4:i=new va(this.scene,t,a);break;case 5:i=new Na(this.scene,t,a);break;case 6:i=new ba(this.scene,t,a);break;case 7:i=new Ma(this.scene,t,a);break;case 8:i=new Ua(this.scene,t,a);break;case 9:i=new ka(this.scene,t,a);break;case 10:i=new La(this.scene,t,a);break;case 11:i=new wa(this.scene,t,a);break;default:return new xt(this.scene,t)}return t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,e-1)),i}createUnitById(e,t,s=!1){let i;const a=this.getUnitDataById(e);if(!a)return new xt(this.scene,t);switch(e){case"velociraptor":i=new Pa(this.scene,t,a);break;case"saurolophus":i=new Oa(this.scene,t,a);break;case"pachysaurus":i=new Da(this.scene,t,a);break;case"triceratops":i=new va(this.scene,t,a);break;case"stegosaurus":i=new Na(this.scene,t,a);break;case"ankylosaurus":i=new ba(this.scene,t,a);break;case"baroptiloraptor":i=new Ma(this.scene,t,a);break;case"tyrannosaurus":i=new Ua(this.scene,t,a);break;case"dilophosaurus":i=new ka(this.scene,t,a);break;case"triceradonosaurus":i=new La(this.scene,t,a);break;case"spinosaurus-rex":i=new wa(this.scene,t,a);break;default:return new xt(this.scene,t)}return t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,a.level-1)),i}getUnitDataByLevel(e){return this.scene.cache.json.get("unitData").melee[e-1]}getUnitDataById(e){return this.scene.cache.json.get("unitData").melee.find(s=>s.id===e)}getUnitFromResourcePoolByLevel(e){const s=this.resourcePool.getChildren().find(i=>i instanceof Ee?i.level===e:!1);if(s instanceof B)return this.resourcePool.remove(s),s}getUnitFromResourcePoolById(e){const s=this.resourcePool.getChildren().find(i=>{if(!(i instanceof Ee))return!1;const{originalUnitData:a}=i;return a.id===e});if(s instanceof B)return this.resourcePool.remove(s),s}}const{KEY:PS,FRAME:OS}=y.GAMEPLAY,{modifier:DS}=GameCore.Configs.Gameplay.Powers.SpeedUp;class _e extends Phaser.GameObjects.Sprite{scene;target;attacker;speed;heightOffset;upwardDirectionOffset;downwardDirectionOffset;constructor(e,t){const{attacker:s,target:i,speed:a,frame:r}=t,o=r||OS.BLANK;super(e,s.x,s.y,PS,o),this.setDisplaySize(5,5),this.scene=e,this.speed=a||D.RANGED_PROJECTILE_SPEED,this.target=i,this.attacker=s,this.heightOffset=0;const c=this.target.display;c instanceof Phaser.GameObjects.Sprite||(this.heightOffset=c.displayHeight*.4),this.rotation=Phaser.Math.Angle.Between(this.x,this.y,i.x,i.y-this.heightOffset);const{depthController:l}=this.attacker;this.setDepth(l.getProjectileDepth()),this.scene.add.existing(this)}update(e,t){const i=this.scene.powerManager.isGameSpeedUp()?this.speed*DS:this.speed,a=i/1e3*t,r=Phaser.Math.Distance.Between(this.x,this.y,this.target.x,this.target.y-this.heightOffset);if(r<a){this.target.takeDamage(this.attacker),this.scene.unitManager.rangedProjectiles.remove(this,!0);return}const o=this.target.x-this.x,c=this.target.y-this.heightOffset-this.y,l=o/r*i/1e3*t,h=c/r*i/1e3*t;this.setPosition(this.x+l,this.y+h)}}const{FRAME:vS}=y.GAMEPLAY,{UNIT_SIZE_SCALE:NS}=D;class bS extends _e{constructor(e,t){t.frame=vS.ROCK,super(e,t),this.setOrigin(.5,.5);const s=NS;this.setDisplaySize(7.5*s,6.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(0,-10),this.downwardDirectionOffset=new Phaser.Math.Vector2(0,-10);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.setPosition(this.attacker.x+i,this.attacker.y+a)}}const{FRAME:MS}=y.GAMEPLAY,{UNIT_SIZE_SCALE:US}=D;class kS extends _e{constructor(e,t){t.frame=MS.JAVELIN,super(e,t),this.setOrigin(1,.5);const s=US;this.setDisplaySize(67*s,3.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(0,-20),this.downwardDirectionOffset=new Phaser.Math.Vector2(10,0);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,o=this.attacker.y+a;this.rotation=Phaser.Math.Angle.Between(r,o,this.target.x,this.target.y-this.heightOffset);const c=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+c,o+l)}}const{FRAME:BS}=y.GAMEPLAY,{UNIT_SIZE_SCALE:xS}=D;class FS extends _e{isGoToLeft;constructor(e,t){t.frame=BS.BOOMERANG,super(e,t),this.setOrigin(.5,.5);const s=xS;this.setDisplaySize(12*s,27.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(0,-20),this.downwardDirectionOffset=new Phaser.Math.Vector2(0,-20);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.setPosition(this.attacker.x+i,this.attacker.y+a),this.isGoToLeft=this.attacker.display.isFaceLeft()}update(e,t){this.isGoToLeft?this.angle-=t*1.5:this.angle+=t*1.5,super.update(e,t)}}const{FRAME:GS}=y.GAMEPLAY,{UNIT_SIZE_SCALE:HS}=D;class YS extends _e{isGoToLeft;constructor(e,t){t.frame=GS.MACE,super(e,t),this.setOrigin(.4,.4);const s=HS;this.setDisplaySize(36.5*s,14.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(20,-40),this.downwardDirectionOffset=new Phaser.Math.Vector2(10,0);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i),this.setPosition(this.attacker.x+i,this.attacker.y+a),this.isGoToLeft=this.attacker.display.isFaceLeft()}update(e,t){this.isGoToLeft?this.angle-=t*.9:this.angle+=t*.9,super.update(e,t)}}const{FRAME:KS}=y.GAMEPLAY,{UNIT_SIZE_SCALE:VS}=D;class WS extends _e{constructor(e,t){t.frame=KS.ARROW_1,super(e,t),this.setOrigin(1,.5);const s=VS;this.setDisplaySize(38.5*s,10*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(5,-10),this.downwardDirectionOffset=new Phaser.Math.Vector2(5,-8);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,o=this.attacker.y+a;this.rotation=Phaser.Math.Angle.Between(r,o,this.target.x,this.target.y-this.heightOffset);const c=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+c,o+l)}}const{FRAME:$S}=y.GAMEPLAY,{UNIT_SIZE_SCALE:jS}=D;class zS extends _e{constructor(e,t){t.frame=$S.ARROW_2,super(e,t),this.setOrigin(1,.5);const s=jS;this.setDisplaySize(37*s,11*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(15,-15),this.downwardDirectionOffset=new Phaser.Math.Vector2(15,-15);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,o=this.attacker.y+a;this.rotation=Phaser.Math.Angle.Between(r,o,this.target.x,this.target.y-this.heightOffset);const c=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+c,o+l)}}const{FRAME:XS}=y.GAMEPLAY,{UNIT_SIZE_SCALE:ZS}=D;class qS extends _e{constructor(e,t){t.frame=XS.BOLT_1,super(e,t),this.setOrigin(1,.5);const s=ZS;this.setDisplaySize(38*s,6*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(20,-30),this.downwardDirectionOffset=new Phaser.Math.Vector2(20,12);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,o=this.attacker.y+a;this.rotation=Phaser.Math.Angle.Between(r,o,this.target.x,this.target.y-this.heightOffset);const c=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+c,o+l)}}const{FRAME:QS}=y.GAMEPLAY,{UNIT_SIZE_SCALE:JS}=D;class eT extends _e{constructor(e,t){t.frame=QS.BOLT_2,super(e,t),this.setOrigin(1,.5);const s=JS;this.setDisplaySize(46*s,9.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(20,-40),this.downwardDirectionOffset=new Phaser.Math.Vector2(20,10);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,o=this.attacker.y+a;this.rotation=Phaser.Math.Angle.Between(r,o,this.target.x,this.target.y-this.heightOffset);const c=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+c,o+l)}}const{FRAME:tT}=y.GAMEPLAY,{UNIT_SIZE_SCALE:sT}=D;class iT extends _e{isGoToLeft;constructor(e,t){t.frame=tT.FIRE_RING,super(e,t),this.setOrigin(.5,.5);const s=sT;this.setDisplaySize(34.5*s,36*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(20,-40),this.downwardDirectionOffset=new Phaser.Math.Vector2(20,0);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i),this.setPosition(this.attacker.x+i,this.attacker.y+a),this.isGoToLeft=this.attacker.display.isFaceLeft()}update(e,t){this.isGoToLeft?this.angle-=t*.9:this.angle+=t*.9,super.update(e,t)}}const{FRAME:nT}=y.GAMEPLAY,{UNIT_SIZE_SCALE:aT}=D;class rT extends _e{constructor(e,t){t.frame=nT.BLUE_FIRE,super(e,t),this.setOrigin(1,.5);const s=aT;this.setDisplaySize(70.5*s,33.5*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(40,-60),this.downwardDirectionOffset=new Phaser.Math.Vector2(50,35);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i);const r=this.attacker.x+i,o=this.attacker.y+a;this.rotation=Phaser.Math.Angle.Between(r,o,this.target.x,this.target.y-this.heightOffset);const c=this.displayWidth*Math.cos(this.rotation),l=this.displayWidth*Math.sin(this.rotation);this.setPosition(r+c,o+l)}}const{FRAME:oT}=y.GAMEPLAY,{UNIT_SIZE_SCALE:cT}=D;class lT extends _e{constructor(e,t){t.frame=oT.GREEN_FIRE,super(e,t),this.setOrigin(1,.5);const s=cT;this.setDisplaySize(50*s,50*s),this.upwardDirectionOffset=new Phaser.Math.Vector2(30,-70),this.downwardDirectionOffset=new Phaser.Math.Vector2(40,0);let i=this.downwardDirectionOffset.x,a=this.downwardDirectionOffset.y;this.attacker.y>this.target.y&&(i=this.upwardDirectionOffset.x,a=this.upwardDirectionOffset.y),this.attacker.display.isFaceLeft()&&(i=-i),this.setPosition(this.attacker.x+i,this.attacker.y+a);const{animationManager:r}=this.scene;r.addLevel11ProjectileAnimation(),this.play(Fs.GREEN_FIRE.KEY,!0)}}class hT{unit;scene;constructor(e){this.unit=e,this.scene=e.scene}createProjectile(e){const{level:t,speed:s,target:i}=e,a={attacker:this.unit,target:i,speed:s};let r;switch(t){case 1:r=new bS(this.unit.scene,a);break;case 2:r=new kS(this.unit.scene,a);break;case 3:r=new FS(this.unit.scene,a);break;case 4:r=new YS(this.unit.scene,a);break;case 5:r=new WS(this.unit.scene,a);break;case 6:r=new zS(this.unit.scene,a);break;case 7:r=new qS(this.unit.scene,a);break;case 8:r=new eT(this.unit.scene,a);break;case 9:r=new iT(this.unit.scene,a);break;case 10:r=new rT(this.unit.scene,a);break;case 11:r=new lT(this.unit.scene,a);break;default:r=new _e(this.unit.scene,a)}const{unitManager:o}=this.scene;o.rangedProjectiles.add(r)}}class uT extends xe{unit;spriteBelowAnimKey;spineBelowAnimKey;constructor(e,t){super(e,{spineAnimKey:t.spineAboveAnimKey,spriteAnimKey:t.spriteAboveAnimKey,status:t.status}),this.spriteBelowAnimKey=t.spriteBelowAnimKey,this.spineBelowAnimKey=t.spineBelowAnimKey,this.unit=e}execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload,i=this.unit.attackController.getAttackTarget();if(!i){this.unit.setStatus(Q.FINISHED_ATTACKING);return}this.unit.setStatus(s),this.unit.display.setAnimationTimeScale(1),this.unit.y>i.y?this.unit.display.play(this.spriteBelowAnimKey,this.spineBelowAnimKey,!1):this.unit.display.play(e,t,!1),this.unit.display.addAnimEventListener(W.RANGED.CUSTOM_EVENTS.FINISHED_ATTACKING,this.handleAttacked),this.unit.display.setFlipX(i.x<=this.unit.x)}handleAttacked=()=>{if(this.unit.isKilled())return;const e=this.unit.attackController.getAttackTarget();e&&(e.isKilled()&&this.unit.display.addAnimEventListener(Phaser.Animations.Events.ANIMATION_COMPLETE,this.handleFinishedAttacking),this.unit.projectileController.createProjectile({level:this.unit.level,target:e}),this.unit.scene.audio.playSound(G.ARROW_SHOOT,{volume:.5,detune:Math.random()*-1e3}))};handleFinishedAttacking=()=>{this.unit.setStatus(Q.FINISHED_ATTACKING)}}class dT extends xe{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.attackEvent?.remove(),this.unit.uiController.killHpBar(),this.unit.depthController.setDepthOnDeath(),this.unit.effectController.stopDamageEffect(),this.unit.display.setAnimationTimeScale(1),this.unit.display.play(e,t,!1,!0),this.unit.display.addAnimEventListener(Phaser.Animations.Events.ANIMATION_COMPLETE,this.handleAnimationComplete)}handleAnimationComplete=()=>{this.unit.effectController.runDieEffect()}}class pT extends xe{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.revive(),this.unit.setStatus(s),this.unit.isDepthDirty=!0,this.unit.uiController.killHpBar(),this.unit.effectController.stopDieEffect(),this.unit.display.setFlipX(!1),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random()),this.unit.attackController.reset()}}class gT extends xe{execute(){const{spriteAnimKey:e,spineAnimKey:t,status:s}=this.payload;this.unit.setStatus(s),this.unit.uiController.reviveHpBar(),this.unit.display.play(e,t,!0,!0),this.unit.display.setAnimationTimeScale(.5+Math.random())}}class Ba extends Bc{unit;constructor(e){super(e),this.unit=e}addAttackCommand(){this.attackCommand=new uT(this.unit,{status:Q.ATTACKING,spriteAboveAnimKey:this.getSpriteAnimKeyByUnitLevel("ATTACK_ABOVE"),spriteBelowAnimKey:this.getSpriteAnimKeyByUnitLevel("ATTACK_BELOW"),spineAboveAnimKey:this.getSpineAnimKeyByUnitLevel("ATTACK_ABOVE"),spineBelowAnimKey:this.getSpineAnimKeyByUnitLevel("ATTACK_BELOW")})}addReadyCommand(){this.readyCommand=new gT(this.unit,{status:Q.READY,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}addMoveCommand(){this.moveCommand=new xe(this.unit,{status:Q.MOVING_TO_TARGET,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}addDieCommand(){this.dieCommand=new dT(this.unit,{status:Q.KILLED,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("DIE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("DIE")})}addPrepareCommand(){this.prepareCommand=new pT(this.unit,{status:Q.PREPARE,spriteAnimKey:this.getSpriteAnimKeyByUnitLevel("IDLE"),spineAnimKey:this.getSpineAnimKeyByUnitLevel("IDLE")})}resetRangedAttackAnimation(){this.addAttackCommand()}getSpriteAnimKeyByUnitLevel(e){try{const{level:t}=this.unit;let s=t;//! lack of sprite of higher units level
return s>=2&&(s=1),ne.RANGED[s][e].KEY}catch(t){return console.warn(t),ne.ALIEN[1].IDLE.KEY}}getSpineAnimKeyByUnitLevel(e){const t=W.RANGED[e];if(!t)throw new Error(`Can't find spine animation ${e}`);return t}}const{FINISHED_ATTACKING:ET}=W.RANGED.CUSTOM_EVENTS;class fe extends B{projectileColor;projectileSpeed;projectileController;constructor(e,t,s,i,a,r){super(e,t,s,i,a,r),this.projectileController=new hT(this),this.unitType=D.RANGED_UNIT_TYPE,this.attackInterval=D.RANGED_ATTACK_INTERVAL;const o=this.display.getSpineAnimationAttackingTime();this.attackInterval<o&&(this.attackInterval=o),this.projectileSpeed=D.RANGED_PROJECTILE_SPEED}createActions(){this.actions=new Ba(this)}determineCounteringEnemy(){const{beingAttackedByMelee:e,beingAttackedByRanged:t}=this.attackController;let s=this.attackController.getAttackTarget();return s?.isKilled()&&(s=null),e&&!e.isKilled()?(this.attackController.setAttackTarget(e),!0):t&&!t.isKilled()?(this.attackController.setAttackTarget(t),!0):!1}setUnitData(e){super.setUnitData(e),this.unitType=D.RANGED_UNIT_TYPE}update(e,t){if(super.update(e,t),this.isKilled()||!this.scene.stateManager.isInPlayingState())return;const s=this.attackController.getAttackTarget();if(this.isReady()){!this.determineCounteringEnemy()&&(!s||s.isKilled())&&this.findTarget(),s&&this.setStatus(Q.PREPARE_TO_ATTACK);return}if(this.isPreparingToAttack()){if(s?.isKilled()){this.actions.ready();return}this.attack();return}this.isAttacking()&&s?.isKilled()&&this.display.getAnimationTimeScale()!==3&&(this.display.setAnimationTimeScale(3),this.display.changeCurrentSpriteEventTime(ET)),this.isFinishedAttacking()&&this.actions.ready()}reuseUnitFromPool(e){super.reuseUnitFromPool(e);const t=this.actions;t instanceof Ba&&t.resetRangedAttackAnimation()}}const{KEY:fT}=y.UNITS_SPINES.RANGED[10],{listLevelsUseSprite:mT}=GameCore.Configs.UnitsConfig.RANGED;class xa extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:fT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!mT.includes(s.level)})}}const{KEY:AT}=y.UNITS_SPINES.RANGED[11],{listLevelsUseSprite:ST}=GameCore.Configs.UnitsConfig.RANGED;class Fa extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:AT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!ST.includes(s.level)})}}const{KEY:TT,FRAME:yT}=y.UNITS_SPRITES,{KEY:CT}=y.UNITS_SPINES.RANGED[1],{listLevelsUseSprite:IT}=GameCore.Configs.UnitsConfig.RANGED;class Ga extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:CT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},sprite:{key:TT,frame:yT.RANGED[1].MAIN_TEXTURE,displayWidth:55,displayHeight:73},useSpine:!IT.includes(s.level)})}}const{KEY:RT}=y.UNITS_SPINES.RANGED[2],{listLevelsUseSprite:_T}=GameCore.Configs.UnitsConfig.RANGED;class Ha extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:RT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!_T.includes(s.level)})}}const{KEY:LT}=y.UNITS_SPINES.RANGED[3],{listLevelsUseSprite:wT}=GameCore.Configs.UnitsConfig.RANGED;class Ya extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:LT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!wT.includes(s.level)})}}const{KEY:PT}=y.UNITS_SPINES.RANGED[4],{listLevelsUseSprite:OT}=GameCore.Configs.UnitsConfig.RANGED;class Ka extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:PT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!OT.includes(s.level)})}}const{KEY:DT}=y.UNITS_SPINES.RANGED[5],{listLevelsUseSprite:vT}=GameCore.Configs.UnitsConfig.RANGED;class Va extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:DT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!vT.includes(s.level)})}}const{KEY:NT}=y.UNITS_SPINES.RANGED[6],{listLevelsUseSprite:bT}=GameCore.Configs.UnitsConfig.RANGED;class Wa extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:NT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!bT.includes(s.level)})}}const{KEY:MT}=y.UNITS_SPINES.RANGED[7],{listLevelsUseSprite:UT}=GameCore.Configs.UnitsConfig.RANGED;class $a extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:MT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!UT.includes(s.level)})}}const{KEY:kT}=y.UNITS_SPINES.RANGED[8],{listLevelsUseSprite:BT}=GameCore.Configs.UnitsConfig.RANGED;class ja extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:kT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!BT.includes(s.level)})}}const{KEY:xT}=y.UNITS_SPINES.RANGED[9],{listLevelsUseSprite:FT}=GameCore.Configs.UnitsConfig.RANGED;class za extends fe{constructor(e,t,s){super(e,0,0,t,s,{spine:{key:xT,spineConfig:{animation:W.RANGED.IDLE,loop:!0}},useSpine:!FT.includes(s.level)})}}class GT extends xc{requestUnitByLevel(e,t,s=!1){let i=this.getUnitFromResourcePoolByLevel(e);return i?(t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,e-1)),i.reuseUnitFromPool(t),this.scene.add.existing(i),i):(i=this.createUnitByLevel(e,t,s),i)}requestUnitById(e,t,s=!1){let i=this.getUnitFromResourcePoolById(e);return i?(t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,i.level-1)),i.reuseUnitFromPool(t),this.scene.add.existing(i),i):(i=this.createUnitById(e,t,s),i)}createUnitByLevel(e,t,s=!1){let i;const a=this.getUnitDataByLevel(e);switch(a||this.scene.rollbar.sendException(new Error(`No unit data found for ranged level ${e}`)),e){case 1:i=new Ga(this.scene,t,a);break;case 2:i=new Ha(this.scene,t,a);break;case 3:i=new Ya(this.scene,t,a);break;case 4:i=new Ka(this.scene,t,a);break;case 5:i=new Va(this.scene,t,a);break;case 6:i=new Wa(this.scene,t,a);break;case 7:i=new $a(this.scene,t,a);break;case 8:i=new ja(this.scene,t,a);break;case 9:i=new za(this.scene,t,a);break;case 10:i=new xa(this.scene,t,a);break;case 11:i=new Fa(this.scene,t,a);break;default:return new xt(this.scene,t)}return t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,e-1)),i}createUnitById(e,t,s=!1){let i;const a=this.getUnitDataById(e);if(!a)return new xt(this.scene,t);switch(e){case"rockthrower":i=new Ga(this.scene,t,a);break;case"javelineer":i=new Ha(this.scene,t,a);break;case"boomeranger":i=new Ya(this.scene,t,a);break;case"macer":i=new Ka(this.scene,t,a);break;case"artemis":i=new Va(this.scene,t,a);break;case"william":i=new Wa(this.scene,t,a);break;case"blanchette":i=new $a(this.scene,t,a);break;case"phantom":i=new ja(this.scene,t,a);break;case"oracle":i=new za(this.scene,t,a);break;case"shaman":i=new xa(this.scene,t,a);break;case"seraph":i=new Fa(this.scene,t,a);break;default:return new xt(this.scene,t)}return t&&!s&&(this.numOfPlayerSpawnedUnits+=Math.pow(2,a.level-1)),i}getUnitDataByLevel(e){return this.scene.cache.json.get("unitData").ranged[e-1]}getUnitDataById(e){return this.scene.cache.json.get("unitData").ranged.find(s=>s.id===e)}getUnitFromResourcePoolByLevel(e){const s=this.resourcePool.getChildren().find(i=>i instanceof fe?i.level===e:!1);if(s instanceof B)return this.resourcePool.remove(s),s}getUnitFromResourcePoolById(e){const s=this.resourcePool.getChildren().find(i=>{if(!(i instanceof fe))return!1;const{originalUnitData:a}=i;return a.id===e});if(s instanceof B)return this.resourcePool.remove(s),s}}const{STATUS:Xa}=nt,{MELEE_UNIT_TYPE:Ce,RANGED_UNIT_TYPE:Me,ALIEN_UNIT_TYPE:Za}=D,{MaximumMeleeLevel:Ai,MaximumRangedLevel:Si}=GameCore.Configs.Gameplay,{MELEE_UNLOCKED:HT,RANGED_UNLOCKED:YT,PLAYER_UNIT_DATA:KT}=ce,{modifier:qa}=GameCore.Configs.Gameplay.Powers.SpeedUp;class VT extends le{scene;meleeSpawnPool;rangedSpawnPool;playerUnits;enemyUnits;rangedProjectiles;latestUnitMergePayload;constructor(e){super(e),this.scene=e,this.createFactories(),this.createUnitGroups()}init(){super.init(),this.initSpawnPools(),this.emptyEnemyUnits(),this.emptyPlayerUnits(),this.emptyProjectiles()}start(){this.isRunning()||(this.createEnemyUnits(),this.createPlayerUnitsNormal(),this.calculatePlayerTotalUnitsUsed(),this.setState(Xa.RUNNING))}stop(){this.isRunning()&&(this.stopDieEffectOfAllUnits(),this.setReadyAllUnits(),this.removeAttackEventsOfAllUnits(),this.hideAllUnits(),this.disableDragOnPlayerUnits(),this.runChildUpdateGroups(!1),this.setState(Xa.STOPPED))}createFactories(){this.meleeSpawnPool=new wS(this.scene),this.rangedSpawnPool=new GT(this.scene)}createUnitGroups(){this.enemyUnits=this.scene.add.group(),this.playerUnits=this.scene.add.group(),this.rangedProjectiles=this.scene.add.group()}runChildUpdateGroups(e){this.enemyUnits.runChildUpdate=e,this.playerUnits.runChildUpdate=e,this.rangedProjectiles.runChildUpdate=e}initSpawnPools(){this.meleeSpawnPool.init(),this.rangedSpawnPool.init()}emptyEnemyUnits(){this.enemyUnits.getChildren().forEach(t=>{if(!(t instanceof B))return;t.handleRemoveFromScene();const{unitType:s}=t;s===Ce&&this.meleeSpawnPool.returnToPool(t),s===Me&&this.rangedSpawnPool.returnToPool(t)}),this.enemyUnits.clear(!0,!1)}emptyPlayerUnits(){this.playerUnits.getChildren().forEach(t=>{if(!(t instanceof B))return;t.handleRemoveFromScene();const{unitType:s}=t;s===Ce&&this.meleeSpawnPool.returnToPool(t),s===Me&&this.rangedSpawnPool.returnToPool(t)}),this.playerUnits.clear(!0,!1)}emptyProjectiles(){this.rangedProjectiles.clear(!0,!0)}getPlayerUnits(){return this.playerUnits.getChildren()}getEnemyUnits(){return this.enemyUnits.getChildren()}getTotalPlayerUnitsHp(){let e=0;return this.playerUnits.getChildren().forEach(t=>{t instanceof B&&(e+=t.currentHp)}),e}getTotalEnemyUnitsHp(){let e=0;return this.enemyUnits.getChildren().forEach(t=>{t instanceof B&&(e+=t.currentHp)}),e}getPlayerMeleeSpawnedUnitsCount(){return this.meleeSpawnPool.getPlayerSpawnedUnitsCount()}getPlayerRangedSpawnedUnitsCount(){return this.rangedSpawnPool.getPlayerSpawnedUnitsCount()}createPlayerArcher(e,t,s=1){if(!this.isRunning())return;const{fieldManager:i,spineManager:a}=this.scene,r=i.getRemainingAvailablePlacement()===1,o=this.checkIfBoardCanBeMerged(),c=this.getLowestLevelPlayerRangedUnit(),l=r&&!o&&c>s?c:s,h=this.createUnit({level:l,isPlayer:!0,unitType:Me});h.spawnUnitOnSquare(e,t,!0),a.addSpines([h]),this.resetAttackSpots(h),this.playerUnits.add(h)}createPlayerMelee(e,t,s=1){if(!this.isRunning())return;const{fieldManager:i,spineManager:a}=this.scene,r=i.getRemainingAvailablePlacement()===1,o=this.checkIfBoardCanBeMerged(),c=this.getLowestLevelPlayerMeleeUnit(),l=r&&!o&&c>s?c:s,h=this.createUnit({level:l,isPlayer:!0,unitType:Ce});h.spawnUnitOnSquare(e,t,!0),a.addSpines([h]),this.resetAttackSpots(h),this.playerUnits.add(h)}createEnemyUnits(){const{levelManager:e}=this.scene;e.enemyData.forEach(s=>{const i=this.createUnit({level:s.level,isPlayer:!1,unitType:s.type==="melee"?Ce:Me});i.spawnUnitOnSquare(s.positionRow,s.positionColumn,!1),i.actions.prepare(),this.resetAttackSpots(i),this.enemyUnits.add(i)})}createPlayerUnitsNormal(){this.playerUnits.getLength()===0?this.loadPlayerUnits():this.reusePlayerUnits();const{uiManager:e}=this.scene;this.playerUnits.getLength()>0&&e.enableStartButton()}stopDieEffectOfAllUnits(){this.enemyUnits.getChildren().forEach(e=>{e instanceof B&&e.effectController.stopDieEffect()}),this.playerUnits.getChildren().forEach(e=>{e instanceof B&&e.effectController.stopDieEffect()})}setReadyAllUnits(){const e=this.playerUnits.getChildren();e.sort((s,i)=>{if(!(s instanceof B)||!(i instanceof B))throw new ae;const{currentLocation:{rowId:a,colId:r}}=s,{currentLocation:{rowId:o,colId:c}}=i;return a===o?r-c:a-o}),e.forEach(s=>{if(!(s instanceof B))throw new ae;s.isDepthDirty=!0,s.actions.ready()});const t=this.enemyUnits.getChildren();t.sort((s,i)=>{if(!(s instanceof B)||!(i instanceof B))throw new ae;const{currentLocation:{rowId:a,colId:r}}=s,{currentLocation:{rowId:o,colId:c}}=i;return a===o?r-c:o-a}),t.forEach(s=>{if(!(s instanceof B))throw new ae;s.isDepthDirty=!0,s.actions.ready()})}removeAttackEventsOfAllUnits(){this.enemyUnits.getChildren().forEach(e=>{e instanceof B&&e.attackEvent?.remove()}),this.playerUnits.getChildren().forEach(e=>{e instanceof B&&e.attackEvent?.remove()})}getUnitBasedOnPosition(e,t){let s=null;return this.playerUnits.getChildren().forEach(i=>{if(!(i instanceof B))throw new ae;i.currentLocation.rowId===e&&i.currentLocation.colId===t&&(s=i)}),s}mergeUnits(e,t){const{effectManger:s}=this.scene,i=e.level+1,a=e.unitType,r=t.currentLocation;if(i>(a===Ce?Ai:Si))return!1;const c=this.createUnit({level:i,unitType:a,isPlayer:!0,isMerged:!0});if(!c)return this.scene.rollbar.sendException(new Error("newUnit is null")),!1;s.playMergeEffect(t),it(50),e.handleRemoveFromScene(),t.handleRemoveFromScene(),a===Ce&&(this.meleeSpawnPool.returnToPool(e),this.meleeSpawnPool.returnToPool(t),this.playerUnits.remove(e,!0,!1),this.playerUnits.remove(t,!0,!1)),a===Me&&(this.rangedSpawnPool.returnToPool(e),this.rangedSpawnPool.returnToPool(t),this.playerUnits.remove(e,!0,!1),this.playerUnits.remove(t,!0,!1)),this.latestUnitMergePayload={type:a,level:i},c.spawnUnitOnSquare(r.rowId,r.colId,!0),this.playerUnits.add(c),this.resetAttackSpots(c);const{uiManager:l,screenManager:h,spineManager:u}=this.scene;return u.addSpines([c]),l.updateUIData(),this.savePlayerUnits(),this.checkIfNewUnitIsUnlocked(i,a)&&(this.disableDragOnPlayerUnits(),this.scene.time.delayedCall(400,h.showUnitUnlockScreen)),!0}checkIfNewUnitIsUnlocked(e,t){if(t===D.MELEE_UNIT_TYPE){const s=HT,i=this.scene.player.getCustomData(s);if(!i||typeof i!="number")return this.scene.player.setCustomData(s,e),!0;if(e>i)return this.scene.player.setCustomData(s,e),!0}if(t===D.RANGED_UNIT_TYPE){const s=YT,i=this.scene.player.getCustomData(s);if(!i||typeof i!="number")return this.scene.player.setCustomData(s,e),!0;if(e>i)return this.scene.player.setCustomData(s,e),!0}return!1}reusePlayerUnits(){this.playerUnits.getChildren().forEach(t=>{if(!(t instanceof B))throw new ae;t.reuseUnitOnReady(),this.resetAttackSpots(t)})}loadPlayerUnits(){const e=this.scene.player.getCustomData(KT);if(console.log(e),!e||typeof e!="string")return;e.split("/").forEach((s,i)=>{s.split("-").forEach((r,o)=>{if(r==="0")return;let c=Za;if(r[0]==="m"?c=Ce:r[0]==="r"&&(c=Me),c===Za)return;const l=this.createUnit({level:parseInt(r.substring(1)),isPlayer:!0,unitType:r[0]==="m"?Ce:Me});l.spawnUnitOnSquare(i+1,o+1,!0),this.resetAttackSpots(l),this.playerUnits.add(l)})})}checkIfBoardCanBeMerged(){const e=this.playerUnits.getChildren(),t=new Map,s=new Map;e.forEach(c=>{if(!(c instanceof B))return;const{level:l,unitType:h}=c;switch(h){case Ce:{const u=t.get(l);u?t.set(l,u+1):t.set(l,1);break}case Me:{const u=s.get(l);u?s.set(l,u+1):s.set(l,1);break}}});const a=Array.from(t,([c,l])=>({key:c,value:l})).some(c=>{const{key:l,value:h}=c;return h>1&&l+1<=Ai}),o=Array.from(s,([c,l])=>({key:c,value:l})).some(c=>{const{key:l,value:h}=c;return h>1&&l+1<=Si});return a||o}createUnit(e){const{id:t,level:s,unitType:i,isPlayer:a,isMerged:r}=e;!t&&!s&&this.scene.rollbar.sendException(new Error("Unit id and level is not defined"));const{fieldBackground:o}=this.scene.fieldManager,c=o.scale*this.scene.world.getPixelRatio();switch(i){case D.MELEE_UNIT_TYPE:if(t){const l=this.meleeSpawnPool.requestUnitById(t,a,r);return l.setScale(c),l}if(s){const l=this.meleeSpawnPool.requestUnitByLevel(s,a,r);return l.setScale(c),l}return this.meleeSpawnPool.requestUnitByLevel(-1,a,r);case D.RANGED_UNIT_TYPE:if(t){const l=this.rangedSpawnPool.requestUnitById(t,a,r);return l.setScale(c),l}if(s){const l=this.rangedSpawnPool.requestUnitByLevel(s,a,r);return l.setScale(c),l}return this.rangedSpawnPool.requestUnitByLevel(-1,a,r);default:return this.meleeSpawnPool.requestUnitByLevel(-1,a,r)}}preparePlayerUnits(){this.playerUnits.getChildren().forEach(t=>{if(!(t instanceof B))throw new ae;t.actions.prepare()})}enableDragOnPlayerUnits(){this.playerUnits.getChildren().forEach(e=>{e instanceof B&&e.startEventListener()})}disableDragOnPlayerUnits(){this.playerUnits.getChildren().forEach(e=>{e instanceof B&&e.removeEventListener()})}serializePlayerUnitData(){const e=this.playerUnits.getChildren();e.sort((i,a)=>{if(!(i instanceof B)||!(a instanceof B))throw new ae;const{currentLocation:{rowId:r,colId:o}}=i,{currentLocation:{rowId:c,colId:l}}=a;return r===c?o-l:r-c});let t="",s=0;for(let i=0;i<3;i++){let a="";for(let r=0;r<5;r++){const o=s>=e.length?null:e[s];if(o instanceof B){const{rowId:c,colId:l}=o.currentLocation;if(c===i+1&&l===r+1){const h=this.createUnitDataForSaving(o);a+=h,s++}else a+="0"}else a+="0";r!==4&&(a+="-")}t+=a,i!==2&&(t+="/")}return t}createUnitDataForSaving(e){if(!e)return"0";const{unitType:t,level:s}=e;return`${t===Ce?"m":"r"}${s}`}savePlayerUnits(){this.scene.levelManager.isInLevelBuilderLevel()||this.scene.updateUnitData()}calculatePlayerTotalUnitsUsed(){const e=this.playerUnits.getChildren();let t=0,s=0;e.forEach(i=>{if(!(i instanceof B))throw new ae;if(i.unitType===Ce){const a=Math.pow(2,i.level-1);t+=a}if(i.unitType===Me){const a=Math.pow(2,i.level-1);s+=a}}),this.meleeSpawnPool.setSpawnedUnits(t),this.rangedSpawnPool.setSpawnedUnits(s)}getLowestLevelPlayerMeleeUnit(){const t=this.playerUnits.getChildren().filter(i=>{if(!(i instanceof B))throw new ae;return i.unitType===Ce});return t.length===0?1:t.reduce((i,a)=>{if(!(a instanceof B))throw new ae;return!i||!(i instanceof B)||a.level<i.level?a:i}).level}getLowestLevelPlayerRangedUnit(){const t=this.playerUnits.getChildren().filter(i=>{if(!(i instanceof B))throw new ae;return i.unitType===Me});return t.length===0?1:t.reduce((i,a)=>{if(!(a instanceof B))throw new ae;return!i||!(i instanceof B)||a.level<i.level?a:i}).level}getUnitDataForUnlockingScreen(){const{level:e,type:t}=this.latestUnitMergePayload;return t===D.MELEE_UNIT_TYPE?this.meleeSpawnPool.getUnitDataByLevel(e):this.rangedSpawnPool.getUnitDataByLevel(e)}resetAttackSpots(e){e.attackController.resetAttackSpots()}hideAllUnits(){this.enemyUnits.children.each(e=>{e instanceof B&&(e.kill(),e.uiController.killHpBar())}),this.playerUnits.children.each(e=>{e instanceof B&&(e.kill(),e.uiController.killHpBar())})}hideAllProjectiles(){this.rangedProjectiles.killGroup()}showAllProjectiles(){this.rangedProjectiles.reviveGroup()}showAllAliveUnits(){this.enemyUnits.children.each(e=>{e instanceof B&&(e.isKilled()||e.revive())}),this.playerUnits.children.each(e=>{e instanceof B&&(e.isKilled()||e.revive())})}showAllHpBarUnits(){this.enemyUnits.children.each(e=>{e instanceof B&&(e.isKilled()||e.uiController.reviveHpBar())}),this.playerUnits.children.each(e=>{e instanceof B&&(e.isKilled()||e.uiController.reviveHpBar())})}getSameCoupleUnits(){const e=new Map,t=this.playerUnits.getChildren();for(let s=0;s<t.length;s++){const i=t[s];if(!(i instanceof B))throw new ae;const{level:a,unitType:r}=i;if(r===D.MELEE_UNIT_TYPE&&a>=Ai||r===D.RANGED_UNIT_TYPE&&a>=Si)continue;const o=`${a}${r}`,c=e.get(o);if(c)return{unit1:c,unit2:i};e.set(o,i)}return null}getFirstMeleeUnit(){const e=this.playerUnits.getChildren();for(let t=0;t<e.length;t++){const s=e[t];if(!(s instanceof B))throw new ae;const{unitType:i}=s;if(i===D.MELEE_UNIT_TYPE)return s}return null}getFirstRangedUnit(){const e=this.playerUnits.getChildren();for(let t=0;t<e.length;t++){const s=e[t];if(!(s instanceof B))throw new ae;const{unitType:i}=s;if(i===D.RANGED_UNIT_TYPE)return s}return null}speedUpAllUnits(){this.scene.powerManager.isSpeedUp=!0,this.enemyUnits.children.each(e=>{e instanceof B&&(e.display.setAnimationTimeScale(qa),e.modifyCurrentAttackEvent())}),this.playerUnits.children.each(e=>{e instanceof B&&(e.display.setAnimationTimeScale(qa),e.modifyCurrentAttackEvent())})}resetSpeedAllUnits(){this.scene.powerManager.isSpeedUp=!1,this.enemyUnits.children.each(e=>{e instanceof B&&(e.display.setAnimationTimeScale(1),e.modifyCurrentAttackEvent())}),this.playerUnits.children.each(e=>{e instanceof B&&(e.display.setAnimationTimeScale(1),e.modifyCurrentAttackEvent())})}}const WT="global",$T="friend",{ApiHost:eL,OtherHost:jT,LeadersBoard:zT}=GameCore.Configs,{Prefix:tL,LeaderboardId:Fc,Name:XT}=zT,ZT=async(n,e,t)=>Fc!=""?qT(n,e):QT(e),qT=async(n,e)=>(await Yt(`leaderboards/${Fc}/players/${n}`,{score:e},{},jT))?.data||{},QT=async n=>await(await window.GameSDK.getLeaderboardAsync(XT)).setScoreAsync(n);class JT extends Error{constructor(e,t){super(e,t),this.name="NewScoreIsBad",this.message=e||"The new score is bad",this.payload=t}}const An=(n,e)=>e.playerId,ey=(n,e)=>e.opponentId,ty=n=>j(n).match.isRequesting,sy=n=>j(n).match.single,iy=n=>j(n).match.single._id,ny=n=>j(n).match.single.score,ay=n=>j(n).match.single.level,ry=n=>j(n).match.single.data?.fen,oy=n=>j(n).match.single.data?.diamond,cy=n=>j(n).match.single.status,ly=n=>j(n).match.single.playerId,hy=n=>j(n).match.challenge,uy=n=>j(n).match.challenge._id,dy=n=>j(n).match.challenge.status,py=n=>j(n).match.challenge.opponentInfo,gy=n=>j(n).match.challenge.whitePlayerId,Ey=n=>j(n).match.challenge.blackPlayerId,fy=n=>j(n).match.group.opponentInfo,my=n=>j(n).match.online.players;k([ty],n=>n);k([sy],n=>n);k([iy],n=>n);k([ny],n=>n||0);k([ay],n=>n||0);k([oy],n=>n||0);k([ry],n=>n||null);k([cy],n=>n);k([ly],n=>n);const Xs=k([hy],n=>n);k([uy],n=>n);k([dy],n=>n);k([py],n=>n);k([gy],n=>n);k([Ey],n=>n);k([Xs,An],(n,e)=>{const{whitePlayerId:t,blackPlayerId:s}=n;return t!==e&&s===e?t:s!==e&&t===e?s:""});k([Xs,An],(n,e)=>{const{whitePlayerId:t,blackPlayerId:s}=n;return t===e?t:s===e?s:xs.playerId});k([Xs,An],(n,e)=>{const{whitePlayerId:t,blackPlayerId:s,whitePlayerFinish:i,blackPlayerFinish:a}=n;return e&&t===e?i:e&&s===e?a:!1});k([Xs,ey],(n,e)=>{const{whitePlayerId:t,blackPlayerId:s,whitePlayerFinish:i,blackPlayerFinish:a}=n;return e&&t===e?i:e&&s===e?a:!1});k([fy],n=>n);k([my],n=>n);const Ay=n=>j(n).stats.data,Sy=n=>j(n).stats.current,Ty=n=>j(n).stats.isRequesting;k([Ay],n=>n);k([Sy],n=>n);k([Ty],n=>n);const{ApiHost:sL}=GameCore.Configs,{Match:iL}=GameCore.Configs,yy=(n,e)=>({type:uc,payload:{playerId:n,stats:e}}),Cy=n=>({type:dc,payload:{stats:n}}),Iy=(n,e)=>t=>{try{const{player:s,notification:i}=window.game,a=s.getPlayerId();ZT(a,n,e).catch(u=>{console.warn(u)}),window.leaderboard_callback=async()=>{const u=window.game.scene.getScene(N.GAME_SCENE);u instanceof H&&await u.handleShowAdWhenNextLevel().catch(p=>{}),window.replayGameEvent()};const r=s.getDiamond(),o=s.getPlayerData(),{score:c=0,level:l}=o;c<n&&s.setScore(n),i.updateData({gameProgress:{currentLevel:l},gameStatistics:{highScore:c<n?n:c},currencyBalance:{diamond:r}}),i.sendRequest();const h={score:n,level:l};t(yy(a,h)),t(Cy(h``))}catch(s){if(s instanceof JT)return;console.warn(s)}},{KEY:Ry,FRAME:_y}=y.GAMEPLAY;class Gc extends Phaser.GameObjects.Container{hand;constructor(e){super(e),this.name="TapTutorialHand",this.addHand(),this.scene.add.existing(this)}addHand(){this.hand=this.scene.make.image({key:Ry,frame:_y.GUIDE_HAND,origin:{x:.5,y:.5}}),this.hand.setWorldSize(65.5,55.5),this.setSize(65.5,55.5),this.add(this.hand)}playAnimation(e=0,t=800){const s=1/this.scene.world.getPixelRatio();this.hand.angle=30,this.scene?.tweens.add({delay:e,targets:[this.hand],ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,value:1,duration:200},scale:{duration:400,start:s*1.6,to:s*1.2},angle:{from:30,value:0,duration:400}},onComplete:()=>{this.scene?.tweens.add({targets:[this.hand],delay:200,duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:0},onComplete:()=>{this.hand.x=0,this.hand.y=0,this.hand.scale=s,this.playAnimation(t)}})}})}stopAnimation(){this.scene.tweens.killTweensOf(this.hand)}preDestroy(){this.scene.tweens.killTweensOf(this.hand)}}const de={GUIDE_ONE:"GuideOne",GUIDE_TWO:"GuideTwo",GUIDE_PREVENT:"GuidePrevent",GUIDE_THREE:"GuideThree"};class Ly{manager;constructor(e){this.manager=e}setup(){this.startGuide()}startGuide=()=>{const{uiManager:e}=this.manager.scene;this.manager.scene.time.delayedCall(500,()=>{this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:1})}),e.showUIForGuide1();const t=e.getStartBtnWorldPosition();this.showTapHand(t.x,t.y),e.addOnceCallbackForStartBtn(this.closeTutorial)};showTapHand(e,t){const{tapHand:s}=this.manager;s.setDepth(M.ON_TOP),s.setPosition(e+s.width/2,t+s.height/2),s.revive(),s.stopAnimation(),s.playAnimation(300)}closeTutorial=()=>{this.manager.stopTutorial()}}class wy{manager;currentStep;targetUnit1;targetUnit2;wrongUnit;constructor(e){this.manager=e,this.currentStep=0}setup(){this.startGuide()}startGuide=()=>{const{uiManager:e,unitManager:t}=this.manager.scene,s=t.getPlayerUnits(),i=s.length;let a=!1;if(s.forEach(o=>{o.level===2&&(a=!0)}),i===2&&a){this.showStep3();return}if(i>=3){this.handleOnClick();return}this.currentStep=1,this.manager.scene.giveEnoughCoins("MELEE"),e.showUIForGuide3(1);const r=e.getMeleeBlockConfig();this.createHighlightItem(r),this.showTapHand(r.worldX,r.worldY),this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:6}),e.addOnceCallbackForMeleeBlock(this.handleOnClick),this.manager.scene.input.setTopOnly(!0)};createHighlightItem(e){const{worldX:t,worldY:s,width:i,height:a}=e,r=20;this.manager.createMask(t-i/2-r,s-a/2-r,i+r*2,a+r*2)}handleOnClick=()=>{const{uiManager:e,unitManager:t}=this.manager.scene;this.currentStep=2,this.manager.scene.input.setTopOnly(!1),this.manager.background.kill(),this.manager.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),e.showUIForGuide3(2),this.manager.tapHand.stopAnimation(),this.manager.tapHand.kill(),this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:7});const i=t.getSameCoupleUnits(),a=t.getFirstRangedUnit();if(!i||!a){this.showStep3();return}//! Suppose on the board only have 2 melee and 1 ranged
this.targetUnit1=i.unit2,this.targetUnit2=i.unit1,this.wrongUnit=a,this.createHint()};createHint(){const{x:e,y:t}=this.targetUnit1.getWorldPosition(),{x:s,y:i}=this.targetUnit2.getWorldPosition();this.createHandAt(e,t,s,i),this.createEvents()}createEvents(){this.targetUnit1.addOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.targetUnit2.addOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.wrongUnit.addOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd)}createHandAt(e,t,s,i){this.manager.hand.setDepth(M.ON_TOP),this.manager.hand.setPosition(e,t),this.manager.hand.revive(),this.manager.hand.setTarget(s,i),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}handleOnDragEnd=()=>{//! can be call before real onDragEnd call
if(this.manager.hand.kill(),this.targetUnit1.removeOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.targetUnit2.removeOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.wrongUnit.removeOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd),this.targetUnit1.isKilled()||this.targetUnit2.isKilled()){this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:8}),this.showStep3();return}this.createHint()};showStep3(){const{uiManager:e}=this.manager.scene;this.currentStep=3,e.showUIForGuide3(3);const t=e.getStartBtnWorldPosition();this.showTapHand(t.x,t.y),this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:9}),e.addOnceCallbackForStartBtn(this.closeTutorial)}showTapHand(e,t){const{tapHand:s}=this.manager;s.setDepth(M.ON_TOP),s.setPosition(e+s.width/2,t+s.height/2),s.revive(),s.stopAnimation(),s.playAnimation(300)}closeTutorial=()=>{this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:10}),this.manager.scene.time.delayedCall(500,()=>{this.manager.scene.analytics.event(v.TUTORIAL_COMPLETE),this.manager.scene.player.incUserGuideDisplays()}),this.currentStep=0,this.manager.stopTutorial()};reupdateUI(){const{uiManager:e}=this.manager.scene;this.currentStep!==0&&e.showUIForGuide3(this.currentStep)}}class Py{manager;currentStep;guideUnit;targetSquare;constructor(e){this.manager=e,this.currentStep=0}setup(){this.startGuide()}startGuide=()=>{const{uiManager:e,unitManager:t}=this.manager.scene;if(t.getPlayerUnits().length===2){this.showStep3();return}this.currentStep=1,this.manager.scene.giveEnoughCoins("RANGED"),e.showUIForGuide2(1);const i=e.getRangedBlockConfig();this.createHighlightItem(i),this.showTapHand(i.worldX,i.worldY),this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:2}),e.addOnceCallbackForRangedBlock(this.handleOnClickRangedBlock),this.manager.scene.input.setTopOnly(!0)};createHighlightItem(e){const{worldX:t,worldY:s,width:i,height:a}=e,r=20;this.manager.createMask(t-i/2-r,s-a/2-r,i+r*2,a+r*2)}handleOnClickRangedBlock=()=>{const{uiManager:e,unitManager:t,fieldManager:s}=this.manager.scene;this.currentStep=2,this.manager.scene.input.setTopOnly(!1),this.manager.background.kill(),this.manager.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),e.showUIForGuide2(2),this.manager.tapHand.stopAnimation(),this.manager.tapHand.kill(),this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:3});const a=t.getFirstMeleeUnit(),r=s.getSquareBasedOnIndex(1,3);if(!r||!a)throw new Error("Guide fail due to target square or unit null");if(this.guideUnit=a,this.targetSquare=r,this.guideUnit.currentLocation===this.targetSquare){this.showStep3();return}this.createHint()};handleOnDragEnd=()=>{const{unitManager:e}=this.manager.scene;this.manager.hand.kill(),e.getPlayerUnits().forEach(i=>{i.removeOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd)});const s=this.guideUnit.getLastDragPos();s&&(s.y<268||s.y>458||s.x<29||s.x>346)&&this.guideUnit.dragUnitOnto(1,3),this.showStep3()};showStep3(){const{uiManager:e}=this.manager.scene;this.currentStep=3,e.showUIForGuide2(3);const t=e.getStartBtnWorldPosition();this.showTapHand(t.x,t.y),this.manager.scene.analytics.event(v.TUTORIAL_STEP,{step:4}),e.addOnceCallbackForStartBtn(this.closeTutorial)}createHint(){const{unitManager:e}=this.manager.scene,{x:t,y:s}=this.guideUnit.getWorldPosition(),{x:i,y:a}=this.targetSquare.getWorldPosition();this.createHandAt(t,s,i,a),e.getPlayerUnits().forEach(o=>{o.addOnceEvent(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.handleOnDragEnd)})}createHandAt(e,t,s,i){this.manager.hand.setDepth(M.ON_TOP),this.manager.hand.setPosition(e,t),this.manager.hand.revive(),this.manager.hand.setTarget(s,i),this.manager.hand.stopAnimation(),this.manager.hand.playAnimation(300)}showTapHand(e,t){const{tapHand:s}=this.manager;s.setDepth(M.ON_TOP),s.setPosition(e+s.width/2,t+s.height/2),s.revive(),s.stopAnimation(),s.playAnimation(300)}closeTutorial=()=>{this.currentStep=0,this.manager.stopTutorial()};reupdateUI(){const{uiManager:e}=this.manager.scene;this.currentStep!==0&&e.showUIForGuide2(this.currentStep)}}class Oy{manager;constructor(e){this.manager=e}setup(){this.startGuide()}startGuide=()=>{const{uiManager:e}=this.manager.scene;e.showUIForGuidePrevent();const t=e.getStartBtnWorldPosition();this.showTapHand(t.x,t.y),e.addOnceCallbackForStartBtn(this.closeTutorial)};showTapHand(e,t){const{tapHand:s}=this.manager;s.setDepth(M.ON_TOP),s.setPosition(e+s.width/2,t+s.height/2),s.revive(),s.stopAnimation(),s.playAnimation(300)}closeTutorial=()=>{this.manager.stopTutorial()};reupdateUI(){const{uiManager:e}=this.manager.scene;e.showUIForGuidePrevent()}}const{STATUS:Ti}=nt,{Tutorial:yi}=GameCore.Configs,{KEY:Dy,FRAME:vy}=y.DEFAULT;class Ny extends le{scene;tutorialId;lastTutorialId;tutorialsDisplayed;isAnalyticFirstSent=!0;hand;tapHand;background;maskGraphics;tutOne;tutTwo;tutPrevent;tutThree;constructor(e){super(e),this.scene=e,this.createHand(),this.createTapHand(),this.createBackground(),this.initTutorialData()}getLastTutorialId(){return this.lastTutorialId}initTutorialData(){this.tutorialId="",this.lastTutorialId="",this.tutorialsDisplayed=[]}init(){this.hand.kill(),this.tapHand.kill(),this.background.kill(),this.setState(Ti.READY)}start(){if(!this.isRunning()){if(this.isNothingToDisplay()){this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0);return}this.setState(Ti.RUNNING)}}stop(){if(!this.isRunning())return;this.scene.tweens.killTweensOf([this.hand,this.tapHand,this.background]),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),this.setState(Ti.STOPPED)}displayCount(e){return this.tutorialsDisplayed.filter(s=>s===e).length}hasDisplayedEnough(e){if(!Object.prototype.hasOwnProperty.call(yi.NumberOfTutorial,e))return!0;const t=yi.NumberOfTutorial[e];return GameCore.Utils.Valid.isNumber(t)?t===-1?!1:this.displayCount(e)>=t:!0}isNothingToDisplay(){const e=this.scene.levelManager.getCurrentLevelId();return this.scene.gameMode===V.BATTLE||e>=3?!0:Object.keys(yi.NumberOfTutorial).filter(s=>!this.hasDisplayedEnough(s)).length<1}showTutorial(){if(!this.isRunning())return;this.isAnalyticFirstSent&&(this.scene.analytics.event(v.TUTORIAL_BEGIN),this.isAnalyticFirstSent=!1);const{unitManager:e}=this.scene,t=this.scene.levelManager.getCurrentLevelId();if(t===1){if(e.getPlayerUnits().length===1&&!this.hasDisplayedEnough(de.GUIDE_ONE)){this.startTutorial(de.GUIDE_ONE);return}if(!this.hasDisplayedEnough(de.GUIDE_TWO)){this.startTutorial(de.GUIDE_TWO);return}this.startTutorial(de.GUIDE_PREVENT)}else t===2&&this.startTutorial(de.GUIDE_THREE)}startTutorial=e=>{if(!this.isRunning())return!1;if(this.isNothingToDisplay())return this.stop(),!1;if(this.hasDisplayedEnough(e))return!1;switch(this.background.kill(),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),console.log(e),e){case de.GUIDE_ONE:this.tutOne=new Ly(this),this.tutOne.setup();break;case de.GUIDE_TWO:this.tutTwo=new Py(this),this.tutTwo.setup();break;case de.GUIDE_PREVENT:this.tutPrevent=new Oy(this),this.tutPrevent.setup();break;case de.GUIDE_THREE:this.tutThree=new wy(this),this.tutThree.setup();break;default:return!1}return this.isRunning()?(this.tutorialId=e,this.lastTutorialId=e,this.tutorialsDisplayed.push(this.tutorialId),!0):!1};reupdateGuideUI(){this.tutorialId!==""&&(this.tutorialId===de.GUIDE_TWO?this.tutTwo.reupdateUI():this.tutorialId===de.GUIDE_PREVENT?this.tutPrevent.reupdateUI():this.tutorialId===de.GUIDE_THREE&&this.tutThree.reupdateUI())}stopTutorial(){this.tutorialId="",this.hand.kill(),this.tapHand.kill(),this.background.kill(),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0)}createHand(){this.hand=new Cc(this.scene),this.hand.kill(),this.hand.setDepth(M.PRIORITY)}createTapHand(){this.tapHand=new Gc(this.scene),this.tapHand.kill(),this.tapHand.setDepth(M.PRIORITY)}createBackground(){this.background=this.scene.make.image({key:Dy,frame:vy.BLANK}),this.background.setInteractive({}),this.scene.input.setTopOnly(!1),this.background.setTint(0),this.background.setAlpha(.8),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",.8),this.background.setDepth(M.PRIORITY);const{displayWidth:t,displayHeight:s}=this.scene.gameZone,i=t+100,a=s+100;this.background.setDisplaySize(i,a),Phaser.Display.Align.In.Center(this.background,this.scene.gameZone)}createMask(e,t,s,i,a=10){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}}),this.maskGraphics.setName("MaskGraphics"),this.maskGraphics.fillRoundedRect(e,t,s,i,a),this.background.setActive(!0),this.background.setVisible(!0),this.background.clearMask(!0),this.background.setMask(this.maskGraphics.createGeometryMask()),this.background.mask.invertAlpha=!0,this.runShowMaskAnimation()}createMultiMask(e){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}}),this.maskGraphics.setName("MaskGraphics"),e.forEach(t=>{this.maskGraphics.fillRoundedRect(t.x,t.y,t.width,t.height,t.radius)}),this.background.setVisible(!0),this.background.setActive(!0),this.background.clearMask(!0),this.background.setMask(this.maskGraphics.createGeometryMask()),this.background.mask.invertAlpha=!0,this.runShowMaskAnimation()}runShowMaskAnimation(){const e=[this.background];this.background.setAlpha(0),this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",0),this.scene.tweens.killTweensOf(e),this.scene.tweens.add({targets:e,duration:300,ease:Phaser.Math.Easing.Quadratic.Out,props:{alpha:{from:0,to:.8}},onUpdate:(s,i)=>{this.scene.game.globalScene.requestBackgroundMaskUpdate("TutorialManager",i.alpha)}})}}class by extends Phaser.GameObjects.Zone{constructor(e,t,s){super(e,0,0,t,s),this.setOrigin(0,0)}}class Hc extends Phaser.Scene{unsubscribeList;gameZone;background;handleOpenScene=()=>{this.logPageviewOnOpen(),this.logEventOpen()};constructor(){super({visible:!1})}create(){this.events.on("wake",this.handleOpenScene),this.events.on("resume",this.handleOpenScene),this.events.on("create",this.handleOpenScene),this.scaleGame(),this.createGameZone()}scaleGame(){const e=this.getCamera("main"),t=this.world.getZoomRatio(),{width:s,height:i}=this.world.getWorldSize();e.setZoom(t),e.centerOn(s/2,i/2)}createGameZone(){const{width:e,height:t}=this.world.getWorldSize();this.gameZone=new by(this,e,t)}getCamera(e){return e==="main"?this.cameras.main:this.cameras.getCamera(e)}createMask(e=1){this.getCamera("main").setBackgroundColor(`rgba(0, 0, 0, ${e})`)}fontSize(e){return e/1}createBackground(e,t,s,i){this.background?(this.background.setTexture(e),t&&this.background.setFrame(t)):this.background=this.make.image({key:e,frame:t}),this.background.setName(e);const{displayWidth:a,displayHeight:r}=this.gameZone;this.background.setDisplaySize(a,r),GameCore.Utils.Valid.isNumber(s)&&this.background.setAlpha(s),GameCore.Utils.Valid.isNumber(i)&&this.background.setTint(i),Phaser.Display.Align.In.Center(this.background,this.gameZone)}handleStateChange(e){this.unsubscribeList=[],e.forEach(t=>{const{selector:s,callback:i}=t,a=this.storage.watch(s,i);this.unsubscribeList.push(a)}),this.events.once("sleep",this.removeStateChange),this.events.once("destroy",this.removeStateChange),this.events.once("shutdown",this.removeStateChange)}removeStateChange=()=>{this.unsubscribeList.forEach(e=>e())};logPageviewOnOpen(){this.analytics.pageview(this.scene.key)}logEventOpen(){this.analytics.event(v.SCREEN_OPEN,{screen_name:this.getSceneName()})}getSceneName(){return GameCore.Utils.String.toUpperCamelCase(this.scene.key.toLowerCase())}}class My{scene;objects;allUI;groups;constructor(e){this.scene=e,this.objects=null,this.createGroups()}setUIObjects(e){this.objects=e,this.allUI.addMultiple(this.objects.getAll())}createGroups(){this.groups={},this.allUI=this.scene.add.group(),this.groups.allUI=this.allUI}}class Yc extends My{scene;guideStateUI;battleReadyStateUI;normalReadyStateUI;levelLoadingStateUI;battlePlayingStateUI;normalPlayingStateUI;constructor(e){super(e),this.scene=e}setUIObjects(e){super.setUIObjects(e),this.updateDepthGroups(),this.addUIObjectsToGroups()}alignUI(){this.alignMainUI(),this.alignItems(),this.alignDevTools()}alignMainUI(){if(this.objects===null)return;const{gameZone:e,fieldManager:t}=this.scene,{coinBar:s,levelBar:i,battleLevelBar:a,showUnitButton:r,settingsButton:o,unitBar:c,totalHpBar:l,startButton:h}=this.objects;Phaser.Display.Align.In.TopRight(s,e,-60,-25),Phaser.Display.Align.In.TopCenter(i,e,0,-22),Phaser.Display.Align.In.TopCenter(a,e,10,-27),Phaser.Display.Align.In.TopLeft(r,e,-5,-45),Phaser.Display.Align.In.TopLeft(o,e,-5,-2);const{y:u,displayHeight:p,scaleY:g}=t.fieldBackground,S=this.scene.world.getPixelRatio(),f=e.width/2;this.scene.world.isLandscape()||c.createStampsBanner(),c.reviveBg(),c.x=f,l.x=f,h.x=f;const T=u-p/2;l.y=T;const A=255;if(c.y=T+A*g*S,c.isBgHigherBottom()){const m=c.getGapFromContainerCenterToBottomBg();c.y=this.scene.gameZone.displayHeight-m}h.y=c.y-72}alignItems(){if(this.objects===null)return;const{gameZone:e}=this.scene,{freeCoinsItem:t,speedUpItem:s,startButton:i}=this.objects;s.setScale(1.3),Phaser.Display.Align.In.TopRight(t,e,-15,-45),Phaser.Display.Align.In.RightCenter(s,i,80,0)}alignDevTools(){if(this.objects===null||!GameCore.Utils.Valid.isDebugger())return;const{gameZone:e}=this.scene,{selectLevelButton:t,resetLevelButton:s,currentUnitModButton:i,currentAttackModButton:a}=this.objects;Phaser.Display.Align.In.BottomRight(t,e,0,-80),Phaser.Display.Align.In.BottomRight(s,e,-50,-80),Phaser.Display.Align.In.BottomLeft(i,e,0,-150),Phaser.Display.Align.In.BottomLeft(a,e,0,-100)}createGroups(){super.createGroups(),this.guideStateUI=this.scene.add.group(),this.battleReadyStateUI=this.scene.add.group(),this.normalReadyStateUI=this.scene.add.group(),this.levelLoadingStateUI=this.scene.add.group(),this.battlePlayingStateUI=this.scene.add.group(),this.normalPlayingStateUI=this.scene.add.group(),this.groups.guideStateUI=this.guideStateUI,this.groups.battleReadyStateUI=this.battleReadyStateUI,this.groups.normalReadyStateUI=this.normalReadyStateUI,this.groups.levelLoadingStateUI=this.levelLoadingStateUI,this.groups.battlePlayingStateUI=this.battlePlayingStateUI,this.groups.normalPlayingStateUI=this.normalPlayingStateUI}updateDepthGroups(){this.allUI.setDepth(M.BUTTON),this.groups.guideStateUI.setDepth(M.BUTTON),this.groups.levelLoadingStateUI.setDepth(M.BUTTON),this.groups.normalReadyStateUI.setDepth(M.BUTTON),this.groups.battleReadyStateUI.setDepth(M.BUTTON),this.groups.normalPlayingStateUI.setDepth(M.BUTTON),this.groups.battlePlayingStateUI.setDepth(M.BUTTON)}addUIObjectsToGroups(){this.objects!==null&&(this.addObjectForGuideState(),this.addObjectsToLoadingState(),this.addObjectsForReadyState(),this.addObjectsForPlayingState())}addObjectForGuideState(){this.objects!==null&&this.groups.guideStateUI.addMultiple([this.objects.unitBar,this.objects.coinBar,this.objects.levelBar,this.objects.totalHpBar,this.objects.startButton,this.objects.settingsButton])}addObjectsToLoadingState(){this.objects!==null&&this.groups.levelLoadingStateUI.addMultiple([this.objects.coinBar,this.objects.totalHpBar,this.objects.freeCoinsItem,this.objects.settingsButton,this.objects.showUnitButton])}addObjectsForReadyState(){this.objects!==null&&(this.groups.normalReadyStateUI.addMultiple([this.objects.coinBar,this.objects.unitBar,this.objects.levelBar,this.objects.totalHpBar,this.objects.startButton,this.objects.speedUpItem,this.objects.freeCoinsItem,this.objects.settingsButton,this.objects.showUnitButton]),GameCore.Utils.Valid.isDebugger()&&this.groups.normalReadyStateUI.addMultiple([this.objects.resetLevelButton,this.objects.selectLevelButton,this.objects.currentUnitModButton,this.objects.currentAttackModButton]),this.groups.battleReadyStateUI.addMultiple([this.objects.coinBar,this.objects.totalHpBar,this.objects.startButton,this.objects.speedUpItem,this.objects.freeCoinsItem,this.objects.battleLevelBar,this.objects.settingsButton,this.objects.showUnitButton]))}addObjectsForPlayingState(){this.objects!==null&&(this.groups.normalPlayingStateUI.addMultiple([this.objects.coinBar,this.objects.totalHpBar,this.objects.speedUpItem,this.objects.settingsButton]),this.groups.battlePlayingStateUI.addMultiple([this.objects.coinBar,this.objects.totalHpBar,this.objects.speedUpItem,this.objects.settingsButton]))}}class Uy extends Yc{uiZone;constructor(e){super(e);const{gameZone:t}=this.scene;this.uiZone=this.scene.add.zone(0,0,400,t.height),Phaser.Display.Align.In.Center(this.uiZone,t)}alignUI(){super.alignUI()}alignMainUI(){if(this.objects===null)return;const{coinBar:e,levelBar:t,showUnitButton:s,settingsButton:i,unitBar:a,startButton:r,totalHpBar:o}=this.objects,{tutorialManager:c}=this.scene;e.setScale(.75),Phaser.Display.Align.In.TopRight(e,this.uiZone,-80,-18),t.setScale(.75),Phaser.Display.Align.In.TopCenter(t,this.uiZone,0,-18),i.setScale(.75),Phaser.Display.Align.In.TopLeft(i,this.uiZone,-40,3),s.setScale(.75),a.changeToDesktopFrame(),Phaser.Display.Align.In.BottomCenter(a,this.uiZone,-90,-30),r.changeToDesktopFrame(),c.isNothingToDisplay()?Phaser.Display.Align.In.BottomCenter(r,this.uiZone,55,-7):Phaser.Display.Align.In.BottomCenter(r,this.uiZone,0,-7),o.playerHpBar.setScale(.75),o.playerHpBar.setPosition(190,125),o.enemyHpBar.setScale(.75),o.enemyHpBar.setPosition(-190,-160),Phaser.Display.Align.In.Center(o,this.uiZone,0,0)}alignItems(){if(this.objects===null)return;const{freeCoinsItem:e,speedUpItem:t,startButton:s,showUnitButton:i}=this.objects;t.setScale(.75),e.setScale(.75),Phaser.Display.Align.In.RightCenter(e,s,e.width,-2),Phaser.Display.Align.In.BottomCenter(t,i,0,42)}alignDevTools(){if(this.objects===null||!GameCore.Utils.Valid.isDebugger())return;const{selectLevelButton:e,resetLevelButton:t,currentUnitModButton:s,currentAttackModButton:i}=this.objects;Phaser.Display.Align.In.LeftCenter(e,this.uiZone,150,-50),Phaser.Display.Align.In.LeftCenter(t,this.uiZone,150,10),Phaser.Display.Align.In.LeftCenter(s,this.uiZone,150,60),Phaser.Display.Align.In.LeftCenter(i,this.uiZone,150,120)}}const Kc=mn(.48,1.57,.6,.83),ky={targets:[],duration:400,ease:Kc,props:{scale:"-=0.1"}};class Ys extends me{constructor(e){super(ky,e)}}class te extends Phaser.GameObjects.Container{useSound=!0;isClicked=!1;isDisable=!1;scaleUp=-1;scaleDown=-1;button;upAnimation;downAnimation;isUsePixelPerfect=!1;hitArea;hitZone;scaleDownPress;parentName;onceCallbacks;isLogEvent;constructor(e,t,s,i,a,r=!1){super(e),this.isUsePixelPerfect=r,this.onceCallbacks=[],this.isLogEvent=!0,this.setDepth(M.BUTTON),this.createButton(t,s,i,a),this.updateSize(),this.listenEvents(),this.scene.add.existing(this)}listenEvents(){this.scene.events.on(Phaser.Scenes.Events.SLEEP,this.handleSceneSleep),this.once(Phaser.GameObjects.Events.DESTROY,this.handelObjectDestroy)}handelObjectDestroy=()=>{this.scene&&this.scene.events.off(Phaser.Scenes.Events.SLEEP,this.handleSceneSleep)};handleSceneSleep=()=>{this.scene&&this.scene.tweens.killTweensOf(this)};set onClick(e){this.isUsePixelPerfect?(this.hitArea=this.button,this.hitArea.setInteractive({useHandCursor:!0,pixelPerfect:!0})):(this.hitArea=this.hitZone,this.updateSize(),this.hitArea.setInteractive({useHandCursor:!0})),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handlePointerDown),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.handleOnClick(e)),this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,this.handlePointerOut)}set onDown(e){this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,e)}set onOut(e){this.hitArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,e)}setOnceCallback(e){this.onceCallbacks.push(e)}get isUsePixelPerFect(){return this.isUsePixelPerfect}handlePointerDown=()=>{this.isClicked||this.upAnimation?.tween?.isPlaying()||(this.isClicked=!0,this.runDownAnimation())};handleOnClick=e=>()=>{this.isClicked&&(this.upAnimation?.tween?.isPlaying()||(this.isClicked=!1,this.runUpAnimation(),this.upAnimation?.tween?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.logButtonEvent(),this.processCallback(e),it(50)})))};handlePointerOut=()=>{this.isClicked&&(this.upAnimation?.tween?.isPlaying()||(this.isClicked=!1,this.runUpAnimation()))};processCallback(e){this.upAnimation?.stop(),this.downAnimation?.stop(),this.scene?.tweens.killTweensOf(this),this.scaleUp!==-1&&this.setScale(this.scaleUp),e(),this.onceCallbacks.length>0&&(this.onceCallbacks.forEach(t=>t()),this.onceCallbacks=[])}setDisabled(e){this.isDisable!==e&&(e?(this.setAlpha(.5),this.hitArea?.disableInteractive()):(this.setAlpha(1),this.hitArea?.setInteractive()),this.isDisable=e)}isDisabled(){return this.isDisable}createButton(e,t,s,i){this.button=this.scene.add.image(0,0,e,t),s&&i&&this.button.setWorldSize(s,i),this.updateScaleDown();const{displayWidth:a,displayHeight:r}=this.button;this.hitZone=this.scene.make.zone({displayWidth:a,displayHeight:r}),this.add([this.button,this.hitZone])}updateSize(){const{displayWidth:e,displayHeight:t}=this.button,s=10,i=e/100*10,a=t/100*10,r=i<s?i:s,o=a<s?a:s;this.setSize(e+r,t+o),this.hitZone.setSize(e+r,t+o)}updateScaleDown(){this.scaleUp=this.scale,this.scaleDown=-1,this.scaleDownPress=this.scale-.1}runDownAnimation=()=>{this.scaleDown===-1&&(this.scaleUp=this.scale,this.scaleDown=this.scaleDownPress),this.useSound&&this.playSound(),this.downAnimation?.remove(),this.downAnimation=new Ys({targets:[this],duration:150,props:{scale:this.scaleDown},onUpdate:()=>{this.hitZone.scale=this.scaleUp/this.scale}}),this.downAnimation.play()};playSound(){this.scene.audio.playSound(G.BUTTON_CLICK)}runUpAnimation(){this.scaleUp!==-1&&(this.upAnimation?.remove(),this.upAnimation=new Ys({targets:[this],duration:150,props:{scale:this.scaleUp},onUpdate:()=>{this.hitZone.scale=this.scaleUp/this.scale}}),this.upAnimation.play())}logButtonEvent(){if(!this.isLogEvent)return;const e=this.getParentName(),t=this.name;this.scene.analytics.event(v.BUTTON_CLICK,{button_name:t,screen_name:e})}disableLogEvent(e){this.isLogEvent=!e}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}}const By={targets:[],repeat:3,duration:33,ease:Phaser.Math.Easing.Linear,props:{angle:5},yoyo:!0};class xy extends me{targetAngle;shakeAmount;constructor(e){super(By,e),this.config?.props&&(this.targetAngle=this.config.targets[0].angle,this.shakeAmount=this.config.props.angle-this.targetAngle,this.tween?.on(Phaser.Tweens.Events.TWEEN_REPEAT,this.handleSwitchPosition))}handleSwitchPosition=()=>{this.shakeAmount*=-.7,this.tween?.updateTo("angle",this.targetAngle+this.shakeAmount)}}class Fy extends te{shakeAnim;constructor(e,t,s,i,a){super(e,t,s,i,a)}createShakeAnim(){this.shakeAnim?.remove(),this.shakeAnim=new xy({targets:[this],repeat:6,duration:50,ease:Phaser.Math.Easing.Cubic.Out,props:{angle:-20}})}runAnimation(){this.createShakeAnim(),this.shakeAnim.play(),it(50)}stopAnimation(){this.shakeAnim&&this.shakeAnim.remove(),this.angle=0}}const Gy={targets:[],yoyo:!0,repeat:-1,duration:120,ease:Phaser.Math.Easing.Circular.Out,props:{scale:{from:1,to:1.3}}};class Hy extends me{constructor(e){super(Gy,e)}}class se extends Phaser.GameObjects.Container{payload;mainText;shadowText;constructor(e,t){super(e),this.payload=t,this.createMainText(),this.createShadowText(),this.updateSize(),this.moveDown(this.shadowText),this.scene.add.existing(this)}setText(e){this.mainText.setText(e),this.shadowText.setText(e),this.updateSize()}setTintText(e,t,s,i){this.mainText.setTint(e,t,s,i)}setDropShadow(e,t,s,i=1){this.shadowText.setVisible(!0),this.shadowText.setTint(s),this.shadowText.setAlpha(i),Phaser.Display.Align.In.Center(this.shadowText,this.mainText,e,t)}updateSize(){const{width:e,height:t}=this.mainText;this.setSize(e,t)}createMainText(){const{origin:e}=this.payload;this.mainText=this.scene.make.bitmapText({font:this.payload.font,size:this.payload.size,origin:e||{x:.5,y:.5}}),this.add(this.mainText)}createShadowText(){const{origin:e}=this.payload;this.shadowText=this.scene.make.bitmapText({font:this.payload.font,size:this.payload.size,origin:e||{x:.5,y:.5},visible:!1}),this.add(this.shadowText)}setFontSize(e){this.mainText.setFontSize(e),this.shadowText.setFontSize(e),this.updateSize()}}const{KEY:Qa,FRAME:Ci}=y.GAMEPLAY;class Yy extends te{heartAnim;text;constructor(e){super(e,Qa,Ci.DASHBOARD_START_BTN,159,63),this.setName("StartFight"),this.createText(),this.runHeartAnimation()}createText(){const e=this.scene.lang.getCurrentLanguage();let t=22,s=-6;switch(e){case"pt":case"es":case"de":case"id":t=20;break;case"ja":t=20,s=-8;break;case"tr":t=20,s=-8;break;case"it":t=18}const i=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(t)});i.setText(this.scene.lang.Text.START_FIGHT),i.setDropShadow(0,2.5,0),this.add(i),Phaser.Display.Align.In.Center(i,this,0,s),this.text=i}changeToDesktopFrame(){const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"pt":case"ja":case"de":case"id":case"tr":t=13;break;case"es":case"it":t=12;break}this.button.setFrame(Ci.DASHBOARD_START_BTN_LANDSCAPE),this.updateSize(),this.text.setFontSize(this.scene.fontSize(t)),this.text.setX(15);const s=this.scene.make.image({key:Qa,frame:Ci.DASHBOARD_BATTLE_ICON});s.setWorldSize(26.5,23.5),s.setPosition(-45,-3),this.add(s)}runHeartAnimation(){this.heartAnim?.remove(),this.heartAnim=new Hy({targets:[this],duration:180,ease:Phaser.Math.Easing.Sine.InOut,props:{scale:{from:1,to:.95}}}),this.heartAnim.play()}setDisabled(e){super.setDisabled(e),e?this.heartAnim?.stop():this.runHeartAnimation()}runUpAnimation(){this.scaleUp!==-1&&(this.upAnimation?.remove(),this.upAnimation=new Ys({targets:[this],duration:150,props:{scale:this.scaleUp},onStart:()=>{this.scene.input.enabled=!1,this.heartAnim?.stop()},onUpdate:()=>{this.hitZone.scale=1/this.scale}}),this.upAnimation?.tween?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{this.scene.input.enabled=!0,this.runHeartAnimation()}),this.upAnimation.play())}}const{KEY:Ky,FRAME:Ja}=y.EFFECTS;class Vy extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,Ky,Ja.FX_STAR_YELLOW),this.scene=e,this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Ja.FX_STAR_YELLOW,alpha:{start:1,end:.8},speed:{min:50,max:150},scale:{start:e*.4,end:e*1},lifespan:{min:600,max:1500}})}explode(e,t,s){this.setActive(!0),this.setVisible(!0),this.emitter.explode(e,t,s)}}const{KEY:Wy,FRAME:er}=y.EFFECTS;class $y extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,Wy,er.FX_COMET),this.scene=e,this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:er.FX_COMET,alpha:{start:1,end:.8},speed:{min:40,max:80},scale:{start:e*.4,end:e*.7},lifespan:{min:400,max:600}})}explode(e,t,s){this.revive(),this.emitter.explode(e,t,s)}}const{KEY:jy,FRAME:zy}=y.GAMEPLAY;class Xy extends Phaser.GameObjects.Container{coinGroup;containerGroup;startsExplosive;startsExplosiveSmall;startsExplosiveSmallTimer;gravity=300;constructor(e){super(e),this.setVisible(!0),this.coinGroup=this.scene.add.group({defaultKey:jy,defaultFrame:zy.DASHBOARD_COINBAR_COIN}),this.containerGroup=this.scene.add.group({classType:Phaser.GameObjects.Container}),this.startsExplosive=new Vy(e),this.startsExplosive.setDepth(M.ON_TOP+1),this.startsExplosiveSmall=new $y(e),this.startsExplosiveSmall.setDepth(M.ON_TOP+1),this.scene.add.existing(this)}createConfigOne(e,t,s){const i=e/300,a=new Phaser.Math.Vector2(0,0),r=new Phaser.Math.Vector2(0,-e),o=s?-1:1,c=Phaser.Math.RND.between(-90,90),l=c<0?1:(300-Math.abs(c))/300,h=(c+90)/180*180*l*i,u=Phaser.Math.RND.between(20,h+20),p=new Phaser.Math.Vector2(1,0);p.setAngle(c*Math.PI/180);const g=Phaser.Math.RND.between(-Math.abs(c)-15,-Math.abs(c)+15),S=u*(100-Math.abs(c))/100*i,f=Phaser.Math.RND.between(S*.2,S),T=new Phaser.Math.Vector2(1,0);T.setAngle(g*Math.PI/180);const A=o*p.x*u,m=p.y*u,C=o*T.x*f,O=T.y*f-e,U=new Phaser.Math.Vector2(A,m),Y=new Phaser.Math.Vector2(C,O),z=new Phaser.Curves.CubicBezier(a,U,Y,r),Ae=Phaser.Math.RND.between(1500+u*3,2e3+u*3),ie=this.coinGroup.get(0,0);return ie.revive(),ie.setRotation(-t.rotation),ie.setWorldSize(24,22),t.add(ie),{from:0,to:1,duration:Ae,ease:"Sine.In",onUpdate:Le=>{const ue=z.getPointAt(Le.getValue());ie.setPosition(ue.x,ue.y)},onComplete:Le=>{if(ie.kill(),Le.totalProgress<1||(this.scene.audio.playSound(G.DIAMONDS_EAT),this.startsExplosiveSmallTimer&&!this.startsExplosiveSmallTimer.hasDispatched))return;this.startsExplosiveSmallTimer=this.scene.time.delayedCall(100,()=>null);const ue=ie.getWorldPosition();this.startsExplosiveSmall.explode(10,ue.x,ue.y)}}}explode(e,t,s,i,a){if(e<=0)return[];this.startsExplosive.explode(30,t,s);const r=new Phaser.Math.Vector2(i-t,a-s),o=r.length(),c=this.containerGroup.get(t,s);c.setRotation(r.angle()+Math.PI/2),c.revive(),this.add(c);let l,h=0;const u=[];for(let g=0;g<e;g++){const S=this.createConfigOne(o,c,g%2===0),f=this.scene.tweens.addCounter(S);u.push(f),S.duration>h&&(h=S.duration,l=f)}const p=()=>{u.forEach(g=>{g.complete()}),this.startsExplosive.emitters.getAt(0)?.killAll(),this.startsExplosiveSmall.emitters.getAt(0)?.killAll(),c.kill()};return l?.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{c.kill(),this.scene.events.off("sleep",p)}),this.scene.events.once("sleep",p),u}}class Zy extends Xy{constructor(e){super(e)}createConfigOne(e,t,s){const i=e/300,a=new Phaser.Math.Vector2(0,0),r=new Phaser.Math.Vector2(0,-e),o=s?-1:1,c=Phaser.Math.RND.between(-90,90),l=c<0?1:(300-Math.abs(c))/300,h=(c+90)/180*180*l*i,u=Phaser.Math.RND.between(20,h+20),p=new Phaser.Math.Vector2(1,0);p.setAngle(c*Math.PI/180);const g=Phaser.Math.RND.between(-Math.abs(c)-15,-Math.abs(c)+15),S=u*(100-Math.abs(c))/100*i,f=Phaser.Math.RND.between(S*.2,S),T=new Phaser.Math.Vector2(1,0);T.setAngle(g*Math.PI/180);const A=o*p.x*u,m=p.y*u,C=o*T.x*f,O=T.y*f-e,U=new Phaser.Math.Vector2(A,m),Y=new Phaser.Math.Vector2(C,O),z=new Phaser.Curves.CubicBezier(a,U,Y,r),Ae=Phaser.Math.RND.between(750+u*3,1e3+u*3),ie=this.coinGroup.get(0,0);return ie.revive(),ie.setRotation(-t.rotation),ie.setWorldSize(24,22),t.add(ie),{from:0,to:1,duration:Ae,ease:"Sine.In",onUpdate:Le=>{const ue=z.getPointAt(Le.getValue());ie.setPosition(ue.x,ue.y)},onComplete:Le=>{if(ie.kill(),Le.totalProgress<1||(this.scene.audio.playSound(G.DIAMONDS_EAT),this.startsExplosiveSmallTimer&&!this.startsExplosiveSmallTimer.hasDispatched))return;this.startsExplosiveSmallTimer=this.scene.time.delayedCall(100,()=>null);const ue=ie.getWorldPosition();this.startsExplosiveSmall.explode(10,ue.x,ue.y)}}}}class qy extends Phaser.GameObjects.Particles.Particle{scale;constructor(e){super(e)}update(e,t,s){const i=super.update(e,t,s);return this.updateScale(),this.updateVelocity(),i}setScale(e){this.scale=Phaser.Math.FloatBetween(e.min,e.max)}easeInCubic(e){return e*e*e}updateScale(){const e=this.easeInCubic(1-this.lifeT);this.scaleX=this.scale*Math.sin(e*Math.PI),this.scaleY=this.scale*Math.sin(e*Math.PI)}updateVelocity(){this.velocityX+=Math.random()*2-1}}const{KEY:Qy,FRAME:Jy}=y.EFFECTS,tr=Jy;class eC extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,Qy,tr.FX_STAR_YELLOW),this.createEmitZone(),this.createEmitters(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({frame:tr.FX_STAR_YELLOW,emitZone:{source:this.emitZone,type:"random"},deathZone:{source:this.emitZone,type:"onLeave"},frequency:200,speedX:{min:-1,max:1},speedY:{min:-9,max:-13},lifespan:{min:1e3,max:1500},scale:{min:.01,max:.015},emitCallback:t=>{t.setScale({min:e/4,max:e})},particleClass:qy})}run(e,t,s,i,a){this.stop(),this.emitZone.setSize(i,a),this.emitZone.setPosition(t-i/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}}const{KEY:sr,FRAME:ys}=y.GAMEPLAY,{ID:tC}=Gs.FREE_COINS,{duration:sC}=GameCore.Configs.Gameplay.Powers.FreeCoins,{FREE_GOLD_LAST_USED:ir}=ce;class iC extends vc{scene;lastUsedTime;collectText;remainingTimeText;glowEffect;timer;moveTween;sparkleEffect;remainingTime;constructor(e){super(e,tC,sr,ys.DASHBOARD_FREE_GOLD,47,50),this.scene=e,this.setName("FreeCoinsItem"),this.createGlowEffect(),this.createCollectText(),this.createRemainingTimeText(),this.createSparkleEffect()}playSound(){this.scene.audio.playSound(G.COIN_SPAWN_SOUND)}createRemainingTimeText(){this.remainingTimeText=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(13),origin:{x:.5,y:1}}),this.remainingTimeText.setVisible(!1),this.add(this.remainingTimeText),this.bringToTop(this.remainingTimeText),Phaser.Display.Align.In.BottomCenter(this.remainingTimeText,this.icon,0,-5)}createCollectText(){let e=11;switch(this.scene.lang.getCurrentLanguage()){case"es":case"pt":e=10;break;case"de":case"it":e=9;break}this.collectText=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(e),origin:{x:.5,y:1},text:this.scene.lang.Text.COLLECT}),this.collectText.setVisible(!1),this.add(this.collectText),this.bringToTop(this.collectText),Phaser.Display.Align.In.BottomCenter(this.collectText,this.icon,0,-5)}createGlowEffect(){this.glowEffect=this.scene.add.image(0,0,sr,ys.DASHBOARD_FREE_GOLD_GLOW),this.glowEffect.setOrigin(.5,.5),this.glowEffect.setVisible(!1),this.glowEffect.setWorldSize(107.5,104.8),this.add(this.glowEffect),this.moveDown(this.glowEffect),this.moveUp(this.icon),Phaser.Display.Align.In.Center(this.glowEffect,this,1,0)}createSparkleEffect(){this.sparkleEffect=new eC(this.scene),this.sparkleEffect.setDepth(M.ON_TOP)}enableItem(){this.visible&&this.isDisabled!==!1&&(this.isDisabled=!1,this.zone.setInteractive(),this.setAvailable(!0))}activeItem=()=>{if(this.isActive===!0||this.isDisabled===!0)return;this.isActive=!0;const{powerManager:e}=this.scene;e.isStopped()||(this.scene.audio.playSound(G.BUTTON_CLICK),this.activeLogic())};activeLogic(){this.rewardCoins()}disableItem(){this.isDisabled!==!0&&(this.zone.disableInteractive(),this.setAvailable(!1),this.isDisabled=!0)}deactivateItem=()=>{if(this.isActive===!1)return;this.isActive=!1;const{powerManager:e}=this.scene;e.isStopped()||this.deactivateLogic()};deactivateLogic(){this.stopTimer()}startCountdown(){if(this.stopTimer(),this.initRemainingWaitTime(),this.remainingTime==0){this.enableItem();return}this.startTimer()}startTimer(){this.setRemainingTime(this.remainingTime),this.disableItem(),this.timer=this.scene.time.addEvent({delay:1e3,callback:()=>{this.remainingTime<1e3?(this.remainingTime=0,this.setRemainingTime(0),this.enableItem(),this.stopTimer()):(this.remainingTime-=1e3,this.setRemainingTime(this.remainingTime),this.disableItem())},loop:!0})}stopTimer(){this.timer?.remove()}initRemainingWaitTime(){if(!this.lastUsedTime){const s=this.scene.player.getCustomData(ir);this.lastUsedTime=typeof s=="number"?s:-1}if(this.lastUsedTime<0){this.remainingTime=0;return}const e=Date.now(),t=sC-(e-this.lastUsedTime);this.remainingTime=t>0?t:0}rewardCoins=()=>{const e=Date.now();this.scene.player.setCustomData(ir,e),this.lastUsedTime=e;const{unitManager:t,coinManager:s,layoutManager:i}=this.scene,a=t.getPlayerMeleeSpawnedUnitsCount(),r=t.getPlayerRangedSpawnedUnitsCount(),o=s.getUnitPrice(a),c=s.getUnitPrice(r),l=Math.floor(Math.random()*2+3),h=c.biggerThan(o)?c:o;h.multiply(l);const u=new Zy(this.scene),{x:p,y:g}=i.objects.coinBar;u.setDepth(M.ON_TOP),u.explode(10,this.x,this.y,p,g).forEach(f=>{f.once(Phaser.Tweens.Events.TWEEN_COMPLETE,()=>{const T=h.clone();T.divide(10),this.scene.coin.plusCoins(T.baseValue,T.suffix),this.scene.updateUI()})}),this.scene.time.delayedCall(600,()=>{this.scene.audio.playSound(G.COIN_INCREASE_REPEATEDLY_SOUND)}),this.disableItem(),this.startCountdown()};setAvailable(e){this.collectText.setVisible(e),this.remainingTimeText.setVisible(!e),this.glowEffect.setVisible(e),this.icon.setFrame(e?ys.DASHBOARD_FREE_GOLD:ys.DASHBOARD_FREE_GOLD_OFF),e?(this.setVisible(!0),this.runMoveTween()):(this.stopMoveTween(),this.sparkleEffect.stop())}setRemainingTime(e){const t=Math.floor(e/1e3),s=Math.floor(t/60),i=t%60,a=i<10?`0${i}`:i.toString();this.remainingTimeText.setText(`${s}:${a}`)}runMoveTween(){this.stopMoveTween();let e=0,t=0,s=-2;this.moveTween=this.scene.tweens.add({targets:[this],duration:500,repeat:-1,ease:Phaser.Math.Easing.Sine.InOut,props:{y:"-=2"},onStart:()=>{e=this.x,t=this.y},onStop:()=>{this.setPosition(e,t)},onRepeat:()=>{s=-s,this.moveTween.updateTo("y",t+s,!0),this.moveTween.data[0].duration=1e3}})}stopMoveTween(){this.moveTween?.stop(),this.moveTween?.remove()}setVisible(e){return e||this.sparkleEffect.stop(),e&&this.remainingTime<1e3&&this.sparkleEffect.run(1,this.x,this.y-2.5,this.width,this.height+5),super.setVisible(e)}}const nC={targets:[],duration:600,ease:Phaser.Math.Easing.Linear,props:{angle:{from:0,to:360}}};class aC extends me{constructor(e){super(nC,e)}}const{KEY:rC,FRAME:oC}=y.DEFAULT_8_BIT;class us extends Phaser.GameObjects.Image{anim;constructor(e){super(e,0,0,rC,oC.PRELOADER),this.runAnimation(),this.setWorldSize(113,113),this.scene.add.existing(this)}runAnimation(){this.anim?.remove(),this.anim=new aC({targets:[this],repeat:-1,duration:1200}),this.anim.play()}setVisible(e){return super.setVisible(e),e?this.runAnimation():this.anim.stop(),this}}const{KEY:cC,FRAME:lC}=y.DEFAULT_8_BIT;class Sn extends Phaser.GameObjects.Container{payload;loading;photo;avtFrame;loadPhotoTimer;constructor(e,t){super(e),this.scene.add.existing(this),this.payload=t;const{size:s}=this.payload;this.setSize(s,s),this.createLoading(),this.createPhoto(),this.createFrame(),this.addDefaultListeners()}loadPhoto(e,t){if(this.payload.id=e,this.payload.url=t,this.loadPhotoTimer?.remove(),!e||!t){this.setPhoto(L.AVATAR.KEY);return}const s=this.scene.textures.get(e);if(s&&s.key===e){this.handleLoadComplete(e);return}this.showLoading(!0);const{loadDelay:i=0}=this.payload||{};this.loadPhotoTimer=this.scene.time.delayedCall(i,this.handleLoadPhotoAfterDelay(e,t))}handleLoadPhotoAfterDelay=(e,t)=>()=>{const s=this.scene.textures.get(e);if(s&&s.key===e){this.handleLoadComplete(e);return}this.scene.load.once(`filecomplete-image-${e}`,this.handleLoadComplete),this.scene.load.image(e,t),this.scene.load.start()};addDefaultListeners(){this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,this.handleLoadPhotoFailed),this.on(Phaser.GameObjects.Events.DESTROY,()=>{this.loadPhotoTimer?.remove(),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.handleLoadPhotoFailed)})}handleLoadComplete=e=>{if(!this.scene)return;const{id:t}=this.payload;if(!t||t!==e)return;const s=`${t}_bordered_100`,i=this.scene.textures.get(s);if(i&&i.key===s){this.setPhoto(i.key);return}if(!GameCore.Utils.Image.drawCircle({scene:this.scene,key:t,newKey:s})){this.showLoading(!1);return}this.setPhoto(s)};handleLoadPhotoFailed=e=>{e.key===this.payload.id&&this.setDefaultAvatar(e.key)};setDefaultAvatar(e){this.loadPhoto(e,L.AVATAR.FILE)}createLoading(){this.loading=new us(this.scene),this.loading.setWorldSize(this.width*.75,this.height*.75),this.loading.setVisible(!1),this.add(this.loading)}createPhoto(){this.photo=this.scene.make.image({x:0,y:0,origin:{x:.5,y:.5},visible:!1}),this.add(this.photo)}createFrame(){this.avtFrame=this.scene.make.image({key:cC,frame:lC.LEADERBOARD_AVATAR}),this.avtFrame.setWorldSize(34,38),this.add(this.avtFrame)}showLoading(e){this.photo.setVisible(!e),this.loading.setVisible(e)}setPhoto(e){this.showLoading(!1),this.photo.setTexture(e),this.photo.setFrame(0);const{size:t}=this.payload,s=t-10;this.photo.setWorldSize(s,s),Phaser.Display.Align.In.Center(this.photo,this.avtFrame,0,-2)}}let hC=class extends Sn{constructor(e){super(e,{size:38}),this.avtFrame.kill()}handleLoadComplete=e=>{if(!this.scene)return;const{id:t}=this.payload;if(!t||t!==e)return;const s=t,i=this.scene.textures.get(s);if(i&&i.key===s){this.setPhoto(i.key);return}this.setPhoto(L.AVATAR.KEY)}};const{KEY:uC,FRAME:nr}=y.GAMEPLAY;let ar=class extends Phaser.GameObjects.Container{bg;avatar;level;constructor(e,t){super(e),this.setName("PlayerCard"),this.createAvatar(),this.createFrame(t),this.updateSize(),this.createLevelText(),this.scene.add.existing(this)}updateData(e){const{playerId:t,playerPhoto:s,playerLevel:i}=e;this.level.setText(`Lv. ${i}`),this.avatar.loadPhoto(t,s)}createFrame(e){const t=e?nr.DASHBOARD_AVATAR_FRAME_BLUE:nr.DASHBOARD_AVATAR_FRAME_RED,s=this.scene.make.image({key:uC,frame:t});s.setName("bg"),s.setWorldSize(35.5,48.5),this.add(s),this.bg=s}updateSize(){this.setSize(this.bg.displayWidth,this.bg.displayHeight)}createAvatar(){const e=new hC(this.scene);e.setName("avatar"),e.setPosition(0,-4),this.add(e),this.avatar=e}createLevelText(){const e=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(8),text:"Lv. 1",origin:{x:.5,y:.5}});e.setPosition(0,14),this.add(e),this.level=e}};const{KEY:dC,FRAME:pC}=y.GAMEPLAY;class gC extends Phaser.GameObjects.Container{playerFrame;opponentFrame;VS;constructor(e){super(e),this.createPlayerFrame(),this.createOpponentFrame(),this.createVS(),this.setDepth(M.BUTTON),this.scene.add.existing(this)}createPlayerFrame(){this.playerFrame=new ar(this.scene,!0),this.playerFrame.setName("playerFrame"),this.add(this.playerFrame),this.playerFrame.setPosition(28,0)}createOpponentFrame(){this.opponentFrame=new ar(this.scene,!1),this.opponentFrame.setName("opponentFrame"),this.add(this.opponentFrame),this.opponentFrame.setPosition(-28,0)}createVS(){this.VS=this.scene.make.image({key:dC,frame:pC.DASHBOARD_VS}),this.VS.setWorldSize(17,14),this.VS.setName("VS"),this.add(this.VS)}updateData(e,t){e&&this.playerFrame.updateData(e),t&&this.opponentFrame.updateData(t)}changeToDesktopFrame(){this.playerFrame.setPosition(200/this.scale,60/this.scale),this.opponentFrame.setPosition(-200/this.scale,-225/this.scale),this.VS.kill()}}const{KEY:rr,FRAME:or}=y.GAMEPLAY;class EC extends Phaser.GameObjects.Container{bar;coinText;constructor(e){super(e),this.createBar(),this.createText(),this.createCoinIcon(),this.setDepth(M.BUTTON),this.scene.add.existing(this)}createBar(){this.bar=this.scene.make.image({key:rr,frame:or.DASHBOARD_COINBAR_BG}),this.bar.setWorldSize(75,24.5),this.add(this.bar)}createCoinIcon(){const e=this.scene.make.image({key:rr,frame:or.DASHBOARD_COINBAR_COIN});this.add(e),e.setWorldSize(30.5,31.5),Phaser.Display.Align.In.RightCenter(e,this,55,0)}createText(){const e=this.scene.lang.getCurrentLanguage();let t=-10,s=17;switch(e){case"tr":s=19,t=-14;break;case"ja":s=15,t=-10;break}this.coinText=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(s),origin:{x:.5,y:0}}),this.add(this.coinText),Phaser.Display.Align.In.Center(this.coinText,this.bar,-5,t)}setCoins(e){this.coinText.setText(`${e.toString()}`)}}class fC extends Phaser.GameObjects.Container{text;constructor(e){super(e),this.createText(),this.setDepth(M.BUTTON),this.scene.add.existing(this)}createText(){this.text=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(20)}),this.text.setText(""),this.text.setDropShadow(0,1.5,0),this.add(this.text)}setLevel(e){this.text.setText(`${this.scene.lang.Text.LEVEL} ${e}`)}}const{KEY:Cs,FRAME:Is}=y.GAMEPLAY;class Vc extends kc{front;iconImage;constructor(e){super(e,0),this.updateHealthBar(),this.setFrameSize(94.5,11.5),this.createIconImage()}updateHealthBar(){this.bg.setTexture(Cs),this.bg.setFrame(Is.DASHBOARD_HPBAR_BG),this.frame.setTexture(Cs),this.frame.setFrame(Is.DASHBOARD_HPBAR_RED),this.frame.setOrigin(1,.5),this.frame.setX(0);const e=this.scene.make.image({key:Cs,frame:Is.DASHBOARD_HPBAR_FRONT});e.setOrigin(0,.5),e.setWorldSize(this.hpLength,this.hpHeight),e.setX(-this.hpLength/2),this.add(e),this.front=e}createIconImage(){this.iconImage=this.scene.add.image(0,0,Cs,Is.DASHBOARD_HPBAR_RED_HEART),this.iconImage.setWorldSize(20,19),this.iconImage.setX(-this.hpLength/2-this.iconImage.displayWidth/2+8),this.iconImage.setAngle(90),this.add(this.iconImage)}setFrameSize(e,t){this.hpLength=e,this.hpHeight=t,this.bg.setWorldSize(this.hpLength,this.hpHeight),this.bg.setX(-this.hpLength/2),this.front.setWorldSize(this.hpLength,this.hpHeight),this.front.setX(-this.hpLength/2),this.updateFrameUI(),this.frame.setX((-this.hpLength+2)/2)}updateFrameUI(){this.frame.setWorldSize(this.currentHp/this.defaultHp*(-this.hpLength+2),this.hpHeight-1)}}const{FRAME:cr}=y.GAMEPLAY;class mC extends Vc{updateHealthBar(){super.updateHealthBar(),this.frame.setFrame(cr.DASHBOARD_HPBAR_BLUE)}createIconImage(){super.createIconImage(),this.iconImage.setFrame(cr.DASHBOARD_HPBAR_BLUE_HEART)}}class AC extends Phaser.GameObjects.Container{scene;playerHpBar;enemyHpBar;constructor(e){super(e),this.scene=e,this.setDepth(M.BUTTON),this.createPlayerHpBar(),this.createEnemyHpBar(),this.setSize(300,200),this.init(),this.scene.add.existing(this)}init(){this.enemyHpBar.setInitHp(1),this.playerHpBar.setInitHp(1)}createPlayerHpBar(){this.playerHpBar=new mC(this.scene),this.playerHpBar.setAngle(-90),this.playerHpBar.setPosition(175,50),this.add(this.playerHpBar)}createEnemyHpBar(){this.enemyHpBar=new Vc(this.scene),this.enemyHpBar.setAngle(-90),this.enemyHpBar.setPosition(-175,-160),this.add(this.enemyHpBar)}updateCurrentHp(){this.updateCurrentEnemyHp(),this.updateCurrentPlayerHp()}updateCurrentPlayerHp(){const e=this.scene.unitManager.getTotalPlayerUnitsHp();this.playerHpBar.setInitHp(e)}updatePlayerHpUIByMinus(e){this.playerHpBar.updateHpUIByMinus(e)}getCurrentPlayerHp(){return this.playerHpBar.getCurrentHp()}updateCurrentEnemyHp(){const e=this.scene.unitManager.getTotalEnemyUnitsHp();this.enemyHpBar.setInitHp(e)}updateEnemyHpUIByMinus(e){this.enemyHpBar.updateHpUIByMinus(e)}getCurrentEnemyHp(){return this.enemyHpBar.getCurrentHp()}}const{KEY:$t,FRAME:qe}=y.GAMEPLAY;class lr extends Phaser.GameObjects.Container{isDisable=!1;block;clickZone;adsBanner;unitImage;priceText;coinIcon;stampText;adsMode=!1;parentName;constructor(e,t,s){super(e),this.createBlock(),this.createZone(),this.updateSize(),this.createUnitImage(t),this.createPriceText(s),this.createMiniCoinIcon(),this.createAdsBanner()}updateSize(){const{displayWidth:e,displayHeight:t}=this.block;this.setSize(e,t)}createBlock(){this.block=this.scene.add.image(0,0,$t,qe.DASHBOARD_UNITBAR_BG),this.block.setWorldSize(71,77),this.add(this.block)}createZone(){const e=this.block.displayWidth,t=39/1.7,s=this.scene.world.isLandscape()?0:t,i=this.block.displayHeight+s,a=.5-s/i/2;this.clickZone=this.scene.add.zone(0,0,e,i),this.clickZone.setOrigin(.5,a),this.add(this.clickZone)}getStampTextFontSize(){switch(this.scene.lang.getCurrentLanguage()){case"pt":case"es":case"ja":case"zh":case"fr":case"id":case"de":case"it":return 12;case"tr":return 14;default:return 16}}getAdsTextFontSize(){switch(this.scene.lang.getCurrentLanguage()){case"pt":case"es":case"tr":case"ja":case"zh":case"fr":case"id":case"it":return 12;case"de":default:return 11}}createStampsBanner(){if(this.stampText)return;const e=this.scene.make.container({}),t=this.scene.make.image({key:$t,frame:qe.DASHBOARD_UNITBAR_STAMPS});t.setWorldSize(64,39),e.setSize(64,39),e.add(t);const s=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(this.getStampTextFontSize())});s.setDropShadow(0,2,0),s.setY(-2),e.add(s),s.setText(this.scene.lang.Text.BUY),this.stampText=s,Phaser.Display.Align.In.BottomCenter(e,this.block,0,26),this.add(e)}createAdsBanner(){const e=this.scene.make.image({key:$t,frame:qe.DASHBOARD_AD_ICON});e.setOrigin(1,0),e.setDisplaySize(33,33),e.setPosition(this.block.x+this.block.displayWidth/2,this.block.y-this.block.displayHeight/2),this.add(e),e.kill(),this.adsBanner=e}createUnitImage(e){if(this.unitImage=this.scene.add.image(0,0,$t),e===D.MELEE_UNIT_TYPE){const t=qe.DASHBOARD_UNITBAR_DINO;this.unitImage.setFrame(t),this.unitImage.setDisplaySize(49,37.5)}else{const t=qe.DASHBOARD_UNITBAR_ARCHER;this.unitImage.setFrame(t),this.unitImage.setDisplaySize(35,43)}Phaser.Display.Align.In.Center(this.unitImage,this.block,0,-10),this.add(this.unitImage)}createPriceText(e){const t=this.scene.lang.getCurrentLanguage();let s=18,i=15;switch(t){case"tr":s=16;break;case"ja":s=16,i=13;break}this.priceText=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(i),origin:{x:.5,y:0}}),this.priceText.setText(`${e}`),Phaser.Display.Align.In.Center(this.priceText,this.block,8,s),this.add(this.priceText)}createMiniCoinIcon(){const e=this.scene.make.image({key:$t,frame:qe.DASHBOARD_MINI_COIN});this.add(e),e.setDisplaySize(12.5,13.5),Phaser.Display.Align.In.Center(e,this,-22,20),this.coinIcon=e}setImage(e){this.unitImage.setTexture(e)}setPrice(e){const t=e.toString();this.priceText.setText(`${t}`)}set onClick(e){this.clickZone.setInteractive({useHandCursor:!0}),this.clickZone.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.logButtonEvent(),e(),it(50)})}set onceClick(e){this.clickZone.setInteractive({useHandCursor:!0}),this.clickZone.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{this.logButtonEvent(),e()})}setAdsMode(e){if(this.adsMode=e,this.adsBanner.setVisible(e),this.priceText.setVisible(!e),this.coinIcon.setVisible(!e),e)this.stampText&&(this.stampText.setFontSize(this.scene.fontSize(this.getAdsTextFontSize())),this.stampText.setText(this.scene.lang.Text.FREE)),Phaser.Display.Align.In.Center(this.unitImage,this.block,0,0);else{this.stampText&&(this.stampText.setFontSize(this.scene.fontSize(this.getStampTextFontSize())),this.stampText.setText(this.scene.lang.Text.BUY));const t=this.scene.world.isLandscape()?-6:-10;Phaser.Display.Align.In.Center(this.unitImage,this.block,0,t)}}setDisabled(e){e!==this.isDisable&&(this.setAlpha(e?.5:1),this.isDisable=e)}isDisabled(){return this.isDisable}logButtonEvent(){const e=this.getParentName(),t=this.name;this.scene.analytics.event(v.BUTTON_CLICK,{button_name:t,screen_name:e})}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}changeToDesktopFrame(){const e=this.scene.lang.getCurrentLanguage();let t=2;switch(e){case"tr":t=0;break}this.block.setFrame(qe.DASHBOARD_UNITBAR_BG_LANDSCAPE),this.clickZone.setSize(this.block.displayWidth,this.block.displayHeight),this.adsBanner.setFrame(qe.DASHBOARD_AD_ICON_LANDSCAPE),this.adsBanner.setPosition(this.block.x+this.block.displayWidth/2,this.block.y-this.block.displayHeight/2);const s=1/this.scene.game.world.getPixelRatio();this.unitImage.setOrigin(.5,.45),this.unitImage.setScale(s/2),this.priceText.setFontSize(this.scene.fontSize(10)),this.priceText.setPosition(8,t),this.coinIcon.setPosition(-15,8),this.coinIcon.setScale(s/1.2),this.updateSize()}}const{Ads:hr}=GameCore.Configs;class SC extends Phaser.GameObjects.Container{scene;bg;meleeBlock;rangedBlock;adChangeMeleeTimer;adChangeRangedTimer;constructor(e){super(e),this.scene=e,this.createBg(),this.createMeleeBlock(),this.createRangedBlock(),this.setDepth(M.BUTTON),this.scene.add.existing(this)}createStampsBanner(){this.meleeBlock.createStampsBanner(),this.rangedBlock.createStampsBanner()}setMeleePrice(e){this.meleeBlock.setPrice(e)}setRangedPrice(e){this.rangedBlock.setPrice(e)}createBg(){this.bg=this.scene.make.image({key:y.DEFAULT.KEY,frame:y.DEFAULT.FRAME.DASHBOARD_UNITBAR_BOTTOM_BG}),this.bg.setWorldSize(375,195),this.bg.setY(52),this.add(this.bg)}getGapFromContainerCenterToBottomBg(){return this.bg.y+this.bg.displayHeight/2}isBgHigherBottom(){return this.bg.getWorldPosition().y+this.bg.displayHeight/2<this.scene.gameZone.displayHeight}createMeleeBlock(){this.meleeBlock=new lr(this.scene,D.MELEE_UNIT_TYPE,999),this.meleeBlock.setName("BuyMeleeUnit"),this.meleeBlock.setPosition(39,0),this.add(this.meleeBlock),this.meleeBlock.onClick=this.buyMeleeUnit}buyMeleeUnit=()=>{const{effectManger:e}=this.scene;this.checkIfFullBoard()&&e.playFullFloatText(),!e.isRewardCurveAnimationRunning()&&(this.meleeBlock.isDisable||this.scene.handleSpawnMelee())};buyRangedUnit=()=>{const{effectManger:e}=this.scene;this.checkIfFullBoard()&&(e.playFullFloatText(),this.rangedBlock.setName("BuyRangedUnit"),this.rangedBlock.setAdsMode(!1)),!e.isRewardCurveAnimationRunning()&&(this.rangedBlock.isDisable||this.scene.handleSpawnRanged())};createRangedBlock(){this.rangedBlock=new lr(this.scene,D.RANGED_UNIT_TYPE,999),this.meleeBlock.setName("BuyRangedUnit"),this.rangedBlock.setPosition(-39,0),this.add(this.rangedBlock),this.rangedBlock.onClick=this.buyRangedUnit}setMeleeAdsMode(e){if(e&&(this.scene.tutorialManager.isRunning()||!hr.Enabled)){this.disableMeleeBlock();return}const t=this.adChangeMeleeTimer&&this.adChangeMeleeTimer.getProgress()<1,{adsMode:s}=this.meleeBlock;if(e){if(e===s){this.scene.ads.canbeShowRewardAd()||this.disableMeleeBlock();return}if(this.disableMeleeBlock(),t)return;this.adChangeMeleeTimer=this.scene.time.delayedCall(2e3,()=>{if(this.meleeBlock){const i=this.scene.ads.canbeShowRewardAd(),a=this.delayedAdMeleePriceCheck();if(this.checkIfFullBoard()||!i){this.disableMeleeBlock(),this.meleeBlock.setName("BuyMeleeUnit"),this.meleeBlock.setAdsMode(!1);return}else this.enableMeleeBlock();if(!a){this.meleeBlock.setAdsMode(!1);return}this.meleeBlock.setName("ViewAdMeleeUnit"),this.meleeBlock.setAdsMode(!0)}});return}this.adChangeMeleeTimer?.destroy(),this.enableMeleeBlock(),this.meleeBlock.setName("BuyMeleeUnit"),this.meleeBlock.setAdsMode(e)}disableMeleeBlock(){this.meleeBlock.setDisabled(!0)}enableMeleeBlock(){this.meleeBlock.setDisabled(!1)}killMeleeBlock(){this.meleeBlock.kill()}reviveMeleeBlock(){this.meleeBlock.revive()}setRangedAdsMode(e){if(e&&(this.scene.tutorialManager.isRunning()||!hr.Enabled)){this.disableRangedBlock();return}const t=this.adChangeRangedTimer&&this.adChangeRangedTimer.getProgress()<1,{adsMode:s}=this.rangedBlock;if(e){if(e===s){this.scene.ads.canbeShowRewardAd()||this.disableRangedBlock();return}if(this.disableRangedBlock(),e&&t)return;this.adChangeRangedTimer=this.scene.time.delayedCall(2e3,()=>{if(this.rangedBlock){const i=this.scene.ads.canbeShowRewardAd(),a=this.delayedAdRangedPriceCheck();if(this.checkIfFullBoard()||!i){this.disableRangedBlock(),this.rangedBlock.setName("BuyRangedUnit"),this.rangedBlock.setAdsMode(!1);return}else this.enableRangedBlock();if(!a){this.rangedBlock.setAdsMode(!1);return}this.rangedBlock.setName("ViewAdRangedUnit"),this.rangedBlock.setAdsMode(!0)}});return}this.adChangeRangedTimer?.destroy(),this.enableRangedBlock(),this.rangedBlock.setName("BuyRangedUnit"),this.rangedBlock.setAdsMode(e)}checkIfFullBoard(){const{fieldManager:e}=this.scene;return e.getRemainingAvailablePlacement()===0}delayedAdMeleePriceCheck(){const{unitManager:e,coinManager:t}=this.scene,s=this.scene.coin.getCurrentCoins(),i=e.getPlayerMeleeSpawnedUnitsCount(),a=t.getUnitPrice(i),r=s.toString(),o=a.toString();return a.biggerThan(s)&&r!==o}delayedAdRangedPriceCheck(){const{unitManager:e,coinManager:t}=this.scene,s=this.scene.coin.getCurrentCoins(),i=e.getPlayerRangedSpawnedUnitsCount(),a=t.getUnitPrice(i),r=s.toString(),o=a.toString();return a.biggerThan(s)&&r!==o}disableRangedBlock(){this.rangedBlock.setDisabled(!0)}enableRangedBlock(){this.rangedBlock.setDisabled(!1)}killRangedBlock(){this.rangedBlock.kill()}reviveRangedBlock(){this.rangedBlock.revive()}disableUnitBlocks(){this.meleeBlock.setDisabled(!0),this.rangedBlock.setDisabled(!0)}disableAdsForBlocks(){this.meleeBlock.setName("BuyMeleeUnit"),this.rangedBlock.setName("BuyRangedUnit"),this.meleeBlock.setAdsMode(!1),this.rangedBlock.setAdsMode(!1)}addOnceClickEventForMeleeBlock(e){this.meleeBlock.onceClick=e}addOnceClickEventForRangedBlock(e){this.rangedBlock.onceClick=e}getMeleeBlockConfig(){const{x:e,y:t}=this.meleeBlock.getWorldPosition(),{width:s,height:i}=this.meleeBlock,a=this.scene.world.isLandscape()?0:10;return{worldX:e,worldY:t+a,width:s*this.scaleX,height:i*this.scaleY}}getRangedBlockConfig(){const{x:e,y:t}=this.rangedBlock.getWorldPosition(),{width:s,height:i}=this.rangedBlock,a=this.scene.world.isLandscape()?0:10;return{worldX:e,worldY:t+a,width:s*this.scaleX,height:i*this.scaleY}}killBg(){this.bg.kill()}reviveBg(){this.bg.revive()}changeToDesktopFrame(){this.bg.kill(),this.rangedBlock.changeToDesktopFrame(),this.meleeBlock.changeToDesktopFrame(),this.meleeBlock.setPosition(36,0),this.rangedBlock.setPosition(-36,0)}}const{KEY:Ot,FRAME:Dt}=y.GAMEPLAY;class TC{scene;coinBar;unitBar;levelBar;totalHpBar;startButton;settingsButton;battleLevelBar;showUnitButton;leaderboardButton;freeCoinsItem;speedUpItem;unitModButton;resetLevelButton;selectLevelButton;currentUnitModText;currentUnitModButton;currentAttackModText;currentAttackModButton;group;constructor(e){this.scene=e,this.createGroup(),this.createObjects()}getAll(){return this.group.getChildren()}createGroup(){this.group=this.scene.add.group()}createObjects(){this.createCoinBar(),this.createUnitBar(),this.createLevelBar(),this.createTotalHpBar(),this.createStartButton(),this.createBattleLevelBar(),this.createShowUnitButton(),this.createSettingsButton(),this.createFreeCoinsItem(),this.createSpeedUpItem(),this.createDevTools()}createCoinBar(){this.coinBar=new EC(this.scene),this.group.add(this.coinBar)}createUnitBar(){this.unitBar=new SC(this.scene),this.group.add(this.unitBar)}createLevelBar(){this.levelBar=new fC(this.scene),this.group.add(this.levelBar)}createTotalHpBar(){this.totalHpBar=new AC(this.scene),this.group.add(this.totalHpBar)}createStartButton(){this.startButton=new Yy(this.scene),this.group.add(this.startButton)}createBattleLevelBar(){this.battleLevelBar=new gC(this.scene),this.group.add(this.battleLevelBar)}createShowUnitButton(){this.showUnitButton=new Fy(this.scene,Ot,Dt.DASHBOARD_UNIT_LIST,31.5,36),this.group.add(this.showUnitButton),this.showUnitButton.setName("ShowUnitList")}createSettingsButton(){this.settingsButton=new te(this.scene,Ot,Dt.DASHBOARD_SETTINGS_BTN,32.5,39),this.group.add(this.settingsButton),this.settingsButton.setName("Settings")}createFreeCoinsItem(){this.freeCoinsItem=new iC(this.scene),this.group.add(this.freeCoinsItem)}createSpeedUpItem(){this.speedUpItem=new Zi(this.scene),this.group.add(this.speedUpItem)}createDevTools(){GameCore.Utils.Valid.isDebugger()&&(this.createResetLevelButton(),this.createSelectLevelButton(),this.createUnitModButton(),this.createAttackModButton())}createResetLevelButton(){this.resetLevelButton=new te(this.scene,Ot,Dt.TOOL_RESET,40,35),this.group.add(this.resetLevelButton),this.resetLevelButton.setName("Reset")}createSelectLevelButton(){this.selectLevelButton=new te(this.scene,Ot,Dt.TOOL_EDIT,40,40),this.group.add(this.selectLevelButton),this.selectLevelButton.setName("Select"),this.selectLevelButton.setAngle(90)}createUnitModButton(){this.currentUnitModButton=new te(this.scene,Ot,Dt.TOOL_UNIT,40,38.5),this.group.add(this.currentUnitModButton),this.currentUnitModButton.setName("UnitMod"),this.currentUnitModText=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(18),text:"0",origin:{x:0,y:.5}}),this.currentUnitModText.x=20,this.currentUnitModButton.add(this.currentUnitModText)}createAttackModButton(){this.currentAttackModButton=new te(this.scene,Ot,Dt.TOOL_ATTACK,40,40),this.group.add(this.currentAttackModButton),this.currentAttackModButton.setName("UnitMod"),this.currentAttackModText=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(18),text:"0",origin:{x:0,y:.5}}),this.currentAttackModText.x=20,this.currentAttackModButton.add(this.currentAttackModText)}}const{STATUS:yC}=nt;class CC extends le{scene;layout;objects;groups;constructor(e){super(e),this.scene=e,this.createObjects(),this.createLayouts(),this.createGroups()}createObjects(){this.objects=new TC(this.scene)}createLayouts(){this.scene.world.isLandscape()?this.layout=new Uy(this.scene):this.layout=new Yc(this.scene),this.layout.setUIObjects(this.objects)}createGroups(){this.groups=this.layout.groups}init(){this.layout.alignUI(),this.setState(yC.READY)}}const{STATUS:IC}=nt,{MaxLevel:ur}=GameCore.Configs.Gameplay;class RC extends le{scene;loadMapInput;unitModifierInput;attackModifierInput;constructor(e){super(e),this.scene=e,this.createDevTools()}start(){this.isRunning()||GameCore.Utils.Valid.isDebugger()&&this.setState(IC.RUNNING)}createDevTools(){GameCore.Utils.Valid.isDebugger()&&(this.createLoadMapInput(),this.createUnitModifierInput(),this.createAttackModifierInput())}createLoadMapInput(){this.loadMapInput=this.createInput("input-level","level-id","load-level-id","Load level",this.handleStartLoadMapById)}createUnitModifierInput(){this.unitModifierInput=this.createInput("input-level","unit-mod","edit-unit-mod","Set Unit Price Modifier",this.handleEditUnitModifier)}createAttackModifierInput(){this.attackModifierInput=this.createInput("input-level","attack-mod","edit-attack-mod","Set Attack Coin Modifier",this.handleEditAttackModifier)}createInput(e,t,s,i,a){const r=document.createElement("div");return r.id=e,r.style.height="100vh",r.style.width="calc(100vw - 100px)",r.style.padding="50px",r.style.display="flex",r.style.flexFlow="column",r.style.position="absolute",r.style.justifyContent="center",r.style.backgroundColor="#000000cc",r.innerHTML=`<input id=${t} style="height: 50px;text-align: center;font-size: 30px;"></input><input type="button" id=${s} value=${i} style="height:40px">`,document.body.appendChild(r),document.getElementById(s)?.addEventListener("click",a),r.style.display="none",r}handleStartLoadMapById=()=>{try{this.loadMapInput.style.display="none";const e=document.getElementById("level-id");if(!e)return;const t=JSON.parse(e.value),s=parseInt(t)>ur?ur:parseInt(t);this.scene.selectLevel(s)}catch(e){console.warn(e)}};handleEditUnitModifier=()=>{try{this.unitModifierInput.style.display="none";const e=document.getElementById("unit-mod");if(!e)return;const t=JSON.parse(e.value),s=parseInt(t),{difficultyManager:i,uiManager:a}=this.scene,r=i.editCurrentLevelUnitMod(s);this.setCurrentUnitModText(t,r),a.updateUIData()}catch(e){console.warn(e)}};setCurrentUnitModText(e,t){const{objects:s}=this.scene.layoutManager;s.currentUnitModText.setText(`C: ${e*100}%
T: ${t.toString()}%`)}handleEditAttackModifier=()=>{try{this.attackModifierInput.style.display="none";const e=document.getElementById("attack-mod");if(!e)return;const t=JSON.parse(e.value),s=parseInt(t),{difficultyManager:i,uiManager:a}=this.scene,r=i.editCurrentLevelAttackMod(s);this.setCurrentAttackModText(t,r),a.updateUIData()}catch(e){console.warn(e)}};setCurrentAttackModText(e,t){const{objects:s}=this.scene.layoutManager;s.currentAttackModText.setText(`C: ${e}%
T: ${t.toString()}%`)}handleShowLoadMapInput=()=>{this.loadMapInput.style.display="flex"};handleShowModUnitInput=()=>{this.unitModifierInput.style.display="flex"};handleShowModAttackInput=()=>{this.attackModifierInput.style.display="flex"}}const _C={targets:[],duration:600,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:0,from:0,to:1}}};class Zs extends me{constructor(e){super(_C,e)}}class LC extends Sn{constructor(e){super(e,{size:120}),this.avtFrame.kill()}handleLoadComplete=e=>{if(!this.scene)return;const{id:t}=this.payload;if(!t||t!==e)return;const s=t,i=this.scene.textures.get(s);if(i&&i.key===s){this.setPhoto(i.key);return}this.setPhoto(L.AVATAR.KEY)}}const{KEY:wC,FRAME:dr}=y.DEFAULT_8_BIT;class pr extends Phaser.GameObjects.Container{bg;avatar;playerName;level;tween;constructor(e,t){super(e),this.setName("PlayerCard"),this.createAvatar(),this.createFrame(t),this.updateSize(),this.createNameText(),this.createLevelText(),this.createAnimation(),this.scene.add.existing(this)}updateData(e){const{playerId:t,playerName:s,playerPhoto:i,playerLevel:a}=e;this.playerName.setText(s||"Player"),this.level.setText(`Lv. ${a}`),this.avatar.loadPhoto(t,i||L.AVATAR.FILE)}createFrame(e){const t=e?dr.CHALLENGE_GRADE_BLUE:dr.CHALLENGE_GRADE_RED,s=this.scene.make.image({key:wC,frame:t});s.setName("bg"),s.setWorldSize(119,153.5),this.add(s),this.bg=s}updateSize(){this.setSize(this.bg.displayWidth,this.bg.displayHeight)}createAvatar(){const e=new LC(this.scene);e.setName("avatar"),e.setPosition(1,-18),this.add(e),this.avatar=e}createNameText(){const e=this.scene.make.text({text:"Player1",style:{fontSize:"13px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:169,align:"center",fontFamily:w.SYSTEM_FAMILY_FONT},origin:{x:.5,y:.5}});e.setHighQuality(),e.setShadow(0,8,"#000000",0,!0),e.setPosition(0,45),this.add(e),this.playerName=e}createLevelText(){const e=this.scene.make.text({text:"Lv. 1",style:{fontSize:"9px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:117,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),e.setShadow(0,8,"#000000",0,!0),e.setPosition(0,60),this.add(e),this.level=e}createAnimation(){this.tween=this.scene.add.tween({paused:!0,targets:[this.avatar,this.playerName,this.level],duration:800,ease:Phaser.Math.Easing.Cubic.Out,delay:this.scene.tweens.stagger(50,{start:Math.random()*50+50}),props:{alpha:{from:0,to:1}}})}runAnimation(e){this.playerName.setAlpha(0),this.level.setAlpha(0),this.avatar.setAlpha(0),this.scene.time.delayedCall(e,()=>{this.tween.play()})}}const PC={targets:[],repeat:3,duration:33,ease:Phaser.Math.Easing.Expo.InOut,props:{y:5},yoyo:!0};class OC extends me{targetY;shakeAmount;constructor(e){super(PC,e),this.config?.props&&(this.targetY=this.config.targets[0].y,this.shakeAmount=this.config.props.y-this.targetY,this.tween?.on(Phaser.Tweens.Events.TWEEN_REPEAT,this.handleSwitchPosition))}handleSwitchPosition=()=>{this.shakeAmount*=.7,this.tween?.updateTo("y",this.targetY+this.shakeAmount)}}const{KEY:lt,FRAME:ht}=y.DEFAULT_8_BIT;class DC extends Phaser.GameObjects.Container{glow;backEffect;energy;vs;fx1;fx2;mainTween;energyTween;fx1Tween;fx2Tween;glowTween1;glowTween2;onCompleteAnim;constructor(e){super(e),this.setName("VSComponent"),this.createShape(),this.createGlow(),this.createBackEffect(),this.createEnergy(),this.createVS(),this.createFx(),this.createAnimation(),this.scene.add.existing(this)}createShape(){const e=this.scene.make.image({key:lt,frame:ht.CHALLENGE_SHAPE});e.setName("shape"),e.setWorldSize(204,123.5),this.add(e)}createGlow(){const e=this.scene.make.image({key:lt,frame:ht.CHALLENGE_GLOW});e.setName("glow"),e.setWorldSize(518,88.5),this.add(e),this.glow=e}createBackEffect(){const e=this.scene.make.image({key:lt,frame:ht.CHALLENGE_BACK_EFFECT});e.setName("backEffect"),e.setWorldSize(230,230),this.add(e),this.backEffect=e}createEnergy(){const e=this.scene.make.image({key:lt,frame:ht.CHALLENGE_ICON_ENERGY});e.setName("energy"),e.setWorldSize(96,106.5),e.setPosition(10,5),this.add(e),this.energy=e}createVS(){const e=this.scene.make.image({key:lt,frame:ht.CHALLENGE_VS});e.setName("vs"),e.setWorldSize(40.5,37.5),this.add(e),this.vs=e}createFx(){const e=this.scene.make.image({key:lt,frame:ht.CHALLENGE_FX});e.setName("fx1"),e.setWorldSize(371.5,59),e.setPosition(0,-31),this.add(e),this.fx1=e;const t=this.scene.make.image({key:lt,frame:ht.CHALLENGE_FX});t.setName("fx2"),t.setWorldSize(371.5,59),t.setPosition(0,26),this.add(t),this.fx2=t}createAnimation(){this.createMainTween(),this.createEnergyTween(),this.createFxTween(),this.createGlowTween()}createMainTween(){const e=this.vs.scale;this.mainTween=this.scene.add.tween({paused:!0,targets:this.vs,duration:500,ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.vs.setTintFill(16777215),this.vs.setVisible(!0),this.vs.setAlpha(0),this.energyTween.resume()},props:{scale:{from:e*10,to:e},alpha:{from:0,to:1}},onComplete:()=>{this.scene.audio.playSound(G.THUNDER_SOUND),it(50),this.vs.clearTint(),this.fx1Tween.resume(),this.fx2Tween.resume(),this.glowTween1.resume()}})}createEnergyTween(){const{x:e,y:t}=this.energy;this.energyTween=this.scene.add.tween({paused:!0,targets:this.energy,duration:500,ease:Phaser.Math.Easing.Expo.In,onActive:()=>{this.energy.setVisible(!0),this.energy.setAlpha(0)},props:{x:{from:e+50,to:e},y:{from:t-50,to:t},alpha:{from:0,to:1}},onComplete:()=>{new OC({targets:[this],repeat:5,duration:60,props:{y:this.y+5}}).play()}})}createFxTween(){const e=this.fx1.x;this.fx1Tween=this.scene.add.tween({paused:!0,targets:this.fx1,duration:500,ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.fx1.setVisible(!0)},props:{x:{from:e-100,to:e},alpha:{from:0,to:1}}});const t=this.fx2.x;this.fx2Tween=this.scene.add.tween({paused:!0,targets:this.fx2,duration:500,ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.fx2.setVisible(!0)},props:{x:{from:t+100,to:t},alpha:{from:0,to:1}}})}createGlowTween(){this.glowTween1=this.scene.add.tween({paused:!0,targets:[this.backEffect,this.glow],duration:500,ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.backEffect.setVisible(!0),this.glow.setVisible(!0)},props:{alpha:{from:0,to:1}},onComplete:()=>{this.glowTween2.resume(),this.onCompleteAnim&&this.onCompleteAnim()}}),this.glowTween2=this.scene.add.tween({paused:!0,targets:this.backEffect,duration:1e6,ease:Phaser.Math.Easing.Linear,repeat:-1,props:{rotation:{start:0,to:180}}})}runAnimation(e){this.vs.setVisible(!1),this.energy.setVisible(!1),this.fx1.setVisible(!1),this.fx2.setVisible(!1),this.glow.setVisible(!1),this.backEffect.setVisible(!1),this.scene.time.delayedCall(e,()=>{this.mainTween.resume()})}stopAnimation(){this.glowTween2.pause()}}class vC extends GameCore.Screen{playerFrame;opponentFrame;vsComponent;backgroundFadeInAnimation;bgFadeOutAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.background.setAlpha(.8),this.setDepth(Be.SPLASH),this.createPlayerFrame(),this.createOpponentFrame(),this.createVsComponent()}createPlayerFrame(){this.playerFrame=new pr(this.scene,!0),this.playerFrame.setName("playerFrame"),this.add(this.playerFrame),Phaser.Display.Align.In.Center(this.playerFrame,this,0,-this.playerFrame.height+10)}createOpponentFrame(){this.opponentFrame=new pr(this.scene,!1),this.opponentFrame.setName("opponentFrame"),this.add(this.opponentFrame),Phaser.Display.Align.In.Center(this.opponentFrame,this,0,this.opponentFrame.height-10)}createVsComponent(){this.vsComponent=new DC(this.scene),this.add(this.vsComponent),this.vsComponent.onCompleteAnim=()=>{this.scene.scene.resume(N.GAME_SCENE),this.scene.time.delayedCall(1e3,()=>{this.close()})}}open(){super.open(),this.scene.requestBackgroundMaskUpdate(I.CHALLENGE_SPLASH_SCREEN,this.background.alpha),this.updateData(),this.runOpenAnimation()}close(){this.setBlockInputOutsideEnabled(!1),this.visible&&(this.vsComponent.stopAnimation(),this.runExitsAnimation(100,1e3))}updateData(){const e=this.scene.battle.getPlayerInfo();console.log("🤖 ? playerInfo",e),e&&this.playerFrame.updateData(e);const t=this.scene.battle.getOpponentInfo();console.log("🤖 ? opponentInfo",t),t&&this.opponentFrame.updateData(t)}runOpenAnimation(){this.runBackgroundEntrancesAnimation(0,200),this.runPopupContentEntrancesAnimation(500,400)}runBackgroundEntrancesAnimation(e,t){this.backgroundFadeInAnimation||(this.backgroundFadeInAnimation=new Zs({targets:[this.background],delay:e,duration:t,props:{alpha:{start:0,from:0,to:.8}},onUpdate:(s,i)=>{const a=this.scene,r=this.scene.screen.get(I.LOADING_SCREEN);if(r&&r.visible){this.background.setAlpha(0),a.requestBackgroundMaskUpdate(I.CHALLENGE_SPLASH_SCREEN,0);return}a.requestBackgroundMaskUpdate(I.CHALLENGE_SPLASH_SCREEN,i.alpha)}})),this.backgroundFadeInAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.playerFrame.setAlpha(.8);const{scale:s}=this.playerFrame;this.scene.add.tween({targets:[this.playerFrame],props:{scale:{start:s-.05,to:s,duration:500},alpha:{start:.8,from:.8,to:1,duration:t}},ease:Phaser.Math.Easing.Expo.In}),this.playerFrame.runAnimation(e),this.opponentFrame.setAlpha(.1),this.opponentFrame.setX(this.opponentFrame.x+100),this.scene.add.tween({targets:[this.opponentFrame],props:{alpha:{start:.1,from:.1,to:1,duration:t},x:{start:this.opponentFrame.x,to:this.opponentFrame.x-100,duration:t}},ease:Phaser.Math.Easing.Expo.In}),this.opponentFrame.runAnimation(e),this.vsComponent.runAnimation(1e3)}runExitsAnimation(e,t){this.fadeOutAnimation||(this.fadeOutAnimation=new ve({targets:[this.vsComponent,this.playerFrame,this.opponentFrame],delay:e,duration:t,props:{alpha:{from:1,to:0}},onComplete:()=>{super.close(),this.vsComponent.setAlpha(1),this.playerFrame.setAlpha(1),this.opponentFrame.setAlpha(1)}}),this.bgFadeOutAnimation=new ve({targets:[this.background],delay:e,duration:t,props:{alpha:{start:.8,from:.8,to:0}},onUpdate:(s,i)=>{this.scene.requestBackgroundMaskUpdate(I.CHALLENGE_SPLASH_SCREEN,i.alpha)}})),this.fadeOutAnimation.play(),this.bgFadeOutAnimation.play()}}const NC={targets:[],repeat:-1,yoyo:!0,duration:33,ease:Phaser.Math.Easing.Sine.InOut,props:{x:5}};class Wc extends me{posX;constructor(e){super(NC,e),this.config?.props&&(this.posX=this.config.props.x,this.tween?.on(Phaser.Tweens.Events.TWEEN_REPEAT,this.handleSwitchPosition))}handleSwitchPosition=()=>{this.posX=-this.posX,this.tween?.updateTo("x",-this.posX)}}const{KEY:bC,FRAME:MC}=y.DEFAULT_8_BIT;class It extends te{constructor(e){super(e,bC,MC.BUTTON_CLOSE,31.5,31.5),this.scene=e,this.setName("Close")}playSound(){this.scene.audio.playSound(G.CLOSE_CLICK,{volume:.3})}}const UC=`
precision mediump float;

uniform sampler2D uMainSampler;
// uniform vec2 uResolution; //khong co
uniform float uCameraZoom;

uniform vec2 iResolution;

uniform vec4 lightPosition;
uniform vec4 lightColor;
uniform float lightRadius;
uniform float lightAttenuation;

varying vec2 outTexCoord;
varying float outTintEffect;
varying vec4 outTint;

void main (void)
{
    vec4 pos = vec4(0.2, 0.3, 1.0, 200);

    // vec2 center = (lightPosition.xy + 1.0) * (iResolution.xy * 0.5);
    // vec2 center = lightPosition.xy
    float distToSurf = length(lightPosition.xy / uCameraZoom - gl_FragCoord.xy / uCameraZoom);
    float radius = 1.0 - distToSurf / lightRadius;
    /* if (distToSurf > 50.0) {
        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
        return; 
    } */
    /* if (radius > 0.5) {
        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
        return; 
    } */
    
    float intensity = smoothstep(0.0, 1.0, radius * lightAttenuation);
    /* if (intensity == 0.0) {
        gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
        return;
    } */

    vec4 color = vec4(intensity, intensity, intensity, 0.0) * lightColor;
    gl_FragColor = vec4(color.rgb * lightColor.a, color.a);
}
`;class Rs extends Phaser.Renderer.WebGL.Pipelines.SinglePipeline{static KEY="GlowLightPipeLine";constructor(e){super({game:e,fragShader:UC})}onRender(e,t){this.set1f("uCameraZoom",t.zoom)}}const{KEY:kC,FRAME:BC}=y.DEFAULT_8_BIT;class Rt extends Phaser.GameObjects.Container{config;shaderSprite;isWebGl=!0;lightRadius=0;constructor(e,t){super(e),this.config={background:0,bottomRightCorner:221341,rightEdge:423092,bottomEdge:83583,mainTopColorGradient:732242,mainBotColorGradient:155294,shadowHeight:7,bgCornerStrokeWidth:2,topInnerCornerStrokeWidth:4,botInnerCornerStrokeWidth:4,rightInnerCornerStrokeWidth:4,lightX:0,lightY:0,...t},this.scene.game.canvas.getContext("webgl")||(this.isWebGl=!1),this.isWebGl&&!this.scene.game.renderer.pipelines.pipelines.has(Rs.KEY)&&this.scene.game.renderer.pipelines.add(Rs.KEY,new Rs(this.scene.game)),this.setDepth(M.POPUP),this.createGraphicsPopup(),this.createShaderSprite(),this.createLightEffect(),this.updateSize(),this.scene.add.existing(this)}updateSize(){const{width:e,height:t}=this.config;this.setSize(e,t)}createGraphicsPopup(){const{x:e,y:t,width:s,height:i,background:a,bottomRightCorner:r,rightEdge:o,bottomEdge:c,mainBotColorGradient:l,mainTopColorGradient:h,shadowHeight:u,bgCornerStrokeWidth:p,topInnerCornerStrokeWidth:g,botInnerCornerStrokeWidth:S,rightInnerCornerStrokeWidth:f}=this.config,T=this.scene.make.graphics({}),A=new Phaser.Geom.Rectangle(e-s/2,t-i/2,s,i);T.fillStyle(0,.3),T.fillRoundedRect(A.left,A.bottom-10,A.width,10+u,{tl:0,tr:0,bl:12,br:12}),T.fillStyle(a),T.fillRoundedRect(A.left,A.top,A.width,A.height,{tl:8,tr:8,bl:12,br:12}),T.fillStyle(r),T.fillRoundedRect(A.left+p,A.bottom-50,A.width-p*2,50-p,{tl:0,tr:0,bl:30,br:8}),T.fillStyle(o),T.fillRoundedRect(A.left+p,A.top+p,A.width-p*2,A.height-p*2-S,{tl:8,tr:8,bl:30,br:12}),T.fillStyle(c),T.fillRoundedRect(A.left+p,A.bottom-50,A.width-p*2-f,50-p,{tl:8,tr:0,bl:8,br:3}),T.fillGradientStyle(h,h,l,l),T.fillRect(A.left+p,A.top+p+g+10,A.width-p*2-f,A.height-p*2-S-g-20),T.fillStyle(h),T.fillRoundedRect(A.left+p,A.top+p+g,A.width-p*2-f,10,{tl:8,tr:8,bl:0,br:0}),T.fillStyle(l),T.fillRoundedRect(A.left+p,A.bottom-p-S-10,A.width-p*2-f,7,{tl:0,tr:0,bl:3,br:0}),this.add(T)}createShaderSprite(){const{width:e,height:t}=this.config,s=this.scene.make.image({key:kC,frame:BC.BLANK});s.setWorldSize(e,t),this.add(s),this.shaderSprite=s,this.shaderSprite.kill()}createLightEffect(){if(!this.isWebGl)return;const{width:e,mainTopColorGradient:t}=this.config;this.shaderSprite.revive(),this.shaderSprite.setPipeline(Rs.KEY);const s=Phaser.Display.Color.ColorToRGBA(t),i=new Phaser.Display.Color(s.r,s.g,s.b,s.a);i.lighten(90);const a=Phaser.Display.Color.ColorToRGBA(i.color),r=this.scene.game.canvas.getContext("webgl")?.drawingBufferWidth,o=this.scene.game.canvas.getContext("webgl")?.drawingBufferHeight;if(!r||typeof r!="number"||!o||typeof o!="number")return;this.lightRadius=e/1.2,this.recalculateLightPosition();const c=1,l=1,h=.4;this.shaderSprite.pipeline.set2f("iResolution",r,o),this.shaderSprite.pipeline.set4f("lightColor",a.r/255*c,a.g/255*c,a.b/255*c,h),this.shaderSprite.pipeline.set1f("lightRadius",this.lightRadius),this.shaderSprite.pipeline.set1f("lightAttenuation",l)}turnOffLight(){this.shaderSprite.kill(),this.shaderSprite.resetPipeline()}recalculateLightPosition(){if(!this.isWebGl||!this.shaderSprite.active)return;const{lightX:e,lightY:t}=this.config,{displayWidth:s,displayHeight:i}=this.scene.gameZone,a=this.scene.game.canvas.getContext("webgl")?.drawingBufferWidth,r=this.scene.game.canvas.getContext("webgl")?.drawingBufferHeight;if(!a||typeof a!="number"||!r||typeof r!="number")return;const o=this.shaderSprite.getWorldPosition();//! if 0, 0 is center of screen, need to be adjust
const c=a*(o.x+e)/s,l=r*(i-(o.y+t))/i;this.shaderSprite.pipeline.set4f("lightPosition",c,l,1e3,this.lightRadius),this.shaderSprite.pipeline.set1f("lightRadius",this.lightRadius)}}class xC extends Phaser.GameObjects.Container{config;isEnable;maxHeight;isScrolling;boundTop;boundBottom;maskGraphics;objects;_value=0;velocity=0;isScrollingSmooth;lastScrollY;isScrollingBack;scrollingBackTo;lastScrollYCount=0;onScrollEvents=[];get marginTop(){return this.config.marginTop}get marginBottom(){return this.config.marginBottom}get acceleration(){return this.config.acceleration}get maxScrollOver(){return this.config.maxScrollOver}get scrollSmooth(){return this.config.scrollSmooth}get scrollingBackRate(){return this.config.scrollingBackRate}constructor(e,t){super(e),this.config={marginTop:0,marginBottom:0,acceleration:1400,maxScrollOver:.15,scrollSmooth:40,scrollingBackRate:5,...t};const{width:s,height:i}=t;this.isEnable=!1,this.maxHeight=0,this.lastScrollY=new Array(3).fill(0),this.setSize(s,i),this.createGroup(),this.createInput(),this.createEvents(),this.scene.add.existing(this)}onScroll(e){this.onScrollEvents.push(e)}get value(){return this._value}set value(e){const t=e-this._value;this._value=e,this.updateObject(t)}gotoTop(){this.value=this.config.marginTop}reset(){this.maxHeight=0,this.isScrolling=!1,this.isScrollingBack=!1,this.isScrollingSmooth=!1,this.gotoTop(),this.setEnable(!1)}createDebug(){const e=this.drawDebugBox(16711680,.8);console.log(e?.x,e?.y,e?.displayWidth,e?.displayHeight)}setEnable(e){this.isEnable=e,e?this.setInteractive({draggable:!0,useHandCursor:!0}):this.disableInteractive()}addItem(e){this.addAt(e),this.objects.add(e);const{y:t,height:s}=e,i=t+s+this.marginBottom-this.height/2;this.maxHeight=Math.max(this.maxHeight,i,0),this.updateObjectVisible()}addItems(e){this.addAt(e),this.objects.addMultiple(e);const t=e.map(s=>s.y+s.height+this.marginBottom-this.height/2);this.maxHeight=Math.max(this.maxHeight,Math.max(...t),0),this.updateObjectVisible()}clearItem(){this.objects.clear(!0,!0),this.reset()}getChildren(){return this.objects.getChildren().filter(e=>e.active)}createBound(e,t,s,i){this.boundTop=this.scene.make.image({key:e,frame:t}),this.boundBottom=this.scene.make.image({key:e,frame:t}),this.boundTop.setTint(i),this.boundBottom.setTint(i),this.boundTop.setAlpha(1,1,0,0),this.boundBottom.setAlpha(0,0,1,1),this.boundTop.setDepth(M.PRIORITY),this.boundBottom.setDepth(M.PRIORITY);const a=this.width,r=s,{x:o,y:c}=this.getWorldPosition();this.boundTop.setDisplaySize(a,r),this.boundBottom.setDisplaySize(a,r),this.boundTop.setY(-this.displayHeight/2+r/2+c-this.y-1),this.boundBottom.setY(this.displayHeight/2-r/2+c-this.y+1),this.boundTop.setX(o-this.x),this.boundBottom.setX(o-this.x),this.add([this.boundTop,this.boundBottom])}createMask(){this.maskGraphics?.destroy(),this.maskGraphics=this.scene.make.graphics({fillStyle:{color:255,alpha:1}}),this.maskGraphics.setName("MaskGraphics");const e=this.width,t=this.height;this.maskGraphics.fillRoundedRect(0-e/2,0-t/2,e,t,0),this.setMask(this.maskGraphics.createGeometryMask()),this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.updateMask,this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.updateMask,this)}updateMask(){const{x:e,y:t}=this.getWorldPosition();this.maskGraphics.setPosition(e,t)}createGroup(){this.objects=this.scene.make.group({})}updateObject(e){this.objects.incY(e),this.updateObjectVisible()}updateObjectVisible(){const e=this.objects.getChildren();for(let t=0;t<e.length;t++){const s=e[t];s.y+s.height<-this.height/2||s.y-s.height>this.height/2?s.setVisible(!1):s.setVisible(!0)}}createInput(){this.setInteractive({draggable:!0,useHandCursor:!0}),this.on(Phaser.Input.Events.POINTER_WHEEL,this.onMouseScroll),this.on(Phaser.Input.Events.GAMEOBJECT_DRAG,this.onTouchScroll),this.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onTouchDown),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onTouchEnd,this)}createEvents(){this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=(e,t)=>{this.isScrollingSmooth&&this.velocity&&this.scrollingSmooth(t),this.isScrollingBack&&this.scrollingBack(t)};callOnScrollEvents(e,t){for(const s of this.onScrollEvents)s(this,e,t)}scrollingBack(e){const t=(this.scrollingBackTo-this.value)*e*this.scrollingBackRate/1e3;this.value+=t,Math.abs(this.scrollingBackTo-this.value)<.5&&(this.value=this.scrollingBackTo,this.stopScrollingBack()),this.callOnScrollEvents(this.value,t)}startScrollingBack(e){this.isScrollingBack=!0,this.scrollingBackTo=e}stopScrollingBack(){this.isScrollingBack=!1}scrollingSmooth(e){const t=this.velocity*e/1e3;this.value+=t;const s=Math.abs(this.velocity)/this.velocity;this.velocity-=s*this.acceleration*e/1e3,Math.abs(this.velocity)<this.acceleration*e/1e3&&this.stopScrollSmooth(),this.isReachTop()&&(this.startScrollingBack(this.marginTop),this.stopScrollSmooth()),this.isReachBottom()&&(this.startScrollingBack(-this.maxHeight),this.stopScrollSmooth()),this.callOnScrollEvents(this.value,t)}startScrollSmooth(e){this.isScrollingSmooth=!0,e&&(e*this.velocity>0?this.velocity+=e:this.velocity=e)}stopScrollSmooth(){this.isScrollingSmooth=!1,this.isScrolling=!1,this.velocity=0}isReachTop(){return this.value>this.marginTop}isReachBottom(){return-this.value>this.maxHeight}checkReachBound=()=>this.isReachTop()||this.isReachBottom();onMouseScroll=os((e,t,s)=>{if(!this.isEnable)return;if(this.isScrolling=!0,this.checkReachBound()){this.lastScrollY=this.lastScrollY.map(()=>0),this.isScrolling=!1;return}this.stopScrollingBack(),this.startScrollSmooth(-s*this.scrollSmooth/15)},100,{isImmediate:!0,maxWait:100});onTouchScroll=e=>{if(!this.isEnable)return;this.velocity&&this.stopScrollSmooth(),this.stopScrollingBack(),this.isScrolling=!0;const t=this.scene.game.world.getZoomRatio(),{position:s,prevPosition:i}=e,a=(s.y-i.y)/t,r=this.height*this.maxScrollOver;let o=1;if(this.lastScrollY[++this.lastScrollYCount%this.lastScrollY.length]=a,this.isReachTop()&&a>=0){const h=(r-(this.value-this.marginTop))/r;o=Math.min(o,h)}if(this.isReachBottom()&&a<=0){const h=(r-(-this.maxHeight-this.value))/r;o=Math.min(o,h)}const c=a*o,l=this.maxScrollOver*this.height;this.value+c>this.marginTop+l?this.value=this.marginTop+l:this.value+c<-this.maxHeight-l?this.value=-this.maxHeight-l:this.value+=c,this.callOnScrollEvents(this.value,c)};onTouchDown=()=>{this.isEnable&&(this.velocity&&this.stopScrollSmooth(),this.stopScrollingBack())};onTouchEnd=()=>{if(this.isReachTop()&&(this.startScrollingBack(this.marginTop),this.stopScrollSmooth()),this.isReachBottom()&&(this.startScrollingBack(-this.maxHeight),this.stopScrollSmooth()),!this.isScrolling)return;const e=this.lastScrollY.reduce((t,s)=>t+s)/this.lastScrollY.length;this.startScrollSmooth(e*this.scrollSmooth),this.lastScrollY=this.lastScrollY.map(()=>0)}}class rL extends Phaser.GameObjects.GameObject{constructor(e){super(e,"UpdateAbleObject")}updateInfo}class $c extends xC{classType;listConfigs;padding;startObjectIndex;endObjectIndex;listObjects;constructor(e,t){super(e,t),this.classType=t.classType,this.listConfigs=t.listConfigs,this.padding=t.padding?t.padding:0,this.objects.classType=this.classType,this.updateConfig(this.listConfigs)}reset(){super.reset(),this.killAndHideAll()}getChildren(){return this.listObjects.filter(e=>e!=null&&e.active)}get objHeight(){const e=this.objects.getChildren();return e.length==0?this.maxHeight=0:e[0].height}updateConfig(e){this.reset(),this.listConfigs=e,this.listObjects=new Array(e.length).fill(void 0),this.addObjectIndex(0,0);const t=this.getEndObjectIndex();this.addObjectIndex(1,t),this.startObjectIndex=this.getStartObjectIndex(),this.endObjectIndex=this.getEndObjectIndex(),this.updateMaxHeight(),this.value=this.marginTop}getConfig(){return this.listConfigs}killAndHideAll(){this.listObjects instanceof Array&&this.listObjects.map(e=>{e!==void 0&&this.objects.killAndHide(e)})}setItemPosition(e,t){const s=e.height;e.setPosition(0,s/2+(s+this.padding)*t-this.height/2)}updateMaxHeight(){return this.maxHeight=Math.max(this.listConfigs.length*(this.objHeight+this.padding)-this.padding+this.marginBottom-this.height,0)}updateObject(e){this.objects.incY(e);const t=this.getStartObjectIndex(),s=this.getEndObjectIndex();t!=this.startObjectIndex&&(t>this.startObjectIndex?this.killObjectIndex(this.startObjectIndex,t-1):this.addObjectIndex(t,this.startObjectIndex-1),this.startObjectIndex=t),s!=this.endObjectIndex&&(s<this.endObjectIndex?this.killObjectIndex(s+1,this.endObjectIndex):this.addObjectIndex(this.endObjectIndex+1,s),this.endObjectIndex=s)}killObjectIndex(e,t){for(let s=e;s<=t;s++){const i=this.listObjects[s];i&&(this.objects.killAndHide(i),this.listObjects[s]=void 0)}}addObjectIndex(e,t){for(let s=e;s<=t;s++){const{padding:i,listConfigs:a}=this;if(s>=a.length)return;const r=this.objects.getFirstDead(!0),o=r.height,c=o/2+(o+i)*s+this.value-this.height/2;r.updateInfo(a[s]),r.setPosition(0,c),r.setActive(!0),r.setVisible(!0),this.addAt(r),this.listObjects[s]=r}}getStartObjectIndex(){const{objHeight:e,padding:t}=this;return Math.max(Math.floor((0-this.value)/(e+t)),0)}getEndObjectIndex(){const{objHeight:e,padding:t,listConfigs:s}=this,i=e+t;return Math.min(Math.floor((this.height-this.value)/i),s.length)}}const FC={targets:[],props:{alpha:{start:0,to:1,duration:500,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:.8,to:1,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}},delay:0};class We extends me{constructor(e){super(FC,e)}}const{KEY:gr,FRAME:Ge}=y.DEFAULT_8_BIT;class GC extends Phaser.GameObjects.Container{avatar;rankIcon;rankText;username;score;scoreText;background;showPopUp;showItems;payload;constructor(e,t){super(e),this.createBackground(),this.updateSize(),this.createRank(),this.createAvatar(),this.createUsername(),this.createScore(),t&&this.updateInfo(t),this.scene.add.existing(this)}updateInfo(e){this.payload={extraData:"",isHighlight:!1,...e},this.updateBackground(),this.updateAvatar(),this.updateRank(),this.updateUsername(),this.updateScore()}createBackground(){this.background=this.scene.make.image({key:gr,frame:Ge.LEADERBOARD_BG_DARK}),this.add(this.background),this.updateBackground()}updateBackground(){const{isHighlight:e=!1}=this.payload||{};e?(this.background.setFrame(Ge.LEADERBOARD_BG_LIGHT),this.background.setWorldSize(313.5,41)):(this.background.setFrame(Ge.LEADERBOARD_BG_DARK),this.background.setWorldSize(314.5,42))}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}createAvatar(){this.avatar=new Sn(this.scene,{size:42,loadDelay:300}),this.add(this.avatar),Phaser.Display.Align.In.LeftCenter(this.avatar,this.rankIcon,-40)}updateAvatar(){const{playerId:e,photo:t}=this.payload;this.avatar.loadPhoto(e,t)}createRank(){this.createRankIcon(),this.createRankText()}updateRank(){const{rank:e=99}=this.payload||{};this.updateRankIcon(e),this.updateRankText(e)}getRankIconFrame(e){let t=null;switch(e){case 1:t=Ge.LEADERBOARD_RANK_GOLD;break;case 2:t=Ge.LEADERBOARD_RANK_SILVER;break;case 3:t=Ge.LEADERBOARD_RANK_COPPER;break}return t}createRankIcon(){this.rankIcon=this.scene.make.image({key:gr}),this.updateRankIcon(1),this.kill(),this.add(this.rankIcon),Phaser.Display.Align.In.LeftCenter(this.rankIcon,this)}updateRankIcon(e){const t=this.getRankIconFrame(e);if(!t){this.rankIcon.kill();return}this.rankIcon.revive(),this.rankIcon.setFrame(t),t==Ge.LEADERBOARD_RANK_GOLD&&this.rankIcon.setWorldSize(39,34.5),t==Ge.LEADERBOARD_RANK_SILVER&&this.rankIcon.setWorldSize(32.5,32),t==Ge.LEADERBOARD_RANK_COPPER&&this.rankIcon.setWorldSize(27,35.5)}createRankText(){this.rankText=this.scene.make.text({text:"0",style:{fontFamily:w.FONT_FAMILY,fontSize:"16px",color:"#ffffff",stroke:"#000000",strokeThickness:3}}),this.rankText.setHighQuality(),this.rankText.kill(),this.add(this.rankText),Phaser.Display.Align.In.Center(this.rankText,this.rankIcon,0,-1)}updateRankText(e){this.rankText.kill(),e>3&&this.rankText.revive(),this.rankText?.setText(`${e}`)}getShortName(e){const t=e.substring(0,7);return t.split(" ")[0]||t}createUsername(){this.username=this.scene.make.text({text:"Player",style:{fontFamily:w.SYSTEM_FAMILY_FONT,fontSize:"16px",fontStyle:"bold",color:"#ffffff"}}),this.username.setHighQuality(),Phaser.Display.Align.In.LeftCenter(this.username,this.avatar,-53),this.add(this.username)}updateUsername(){const e=this.payload.name;this.username.setText(this.getShortName(e))}createScore(){this.score=this.scene.add.container(),this.scoreText=this.scene.make.text({text:"99999",style:{fontFamily:w.FONT_FAMILY,fontSize:"16px",color:"#ffffff",stroke:"#000000",strokeThickness:2}}),this.scoreText.setOrigin(1,.5),this.scoreText.setHighQuality(),this.score.add(this.scoreText),this.add(this.score),Phaser.Display.Align.In.RightCenter(this.score,this,-10)}updateScore(){const{score:e="0"}=this.payload||{};this.scoreText.setText(`${e}`)}runShowPopUpAnimation(e,t){this.scene.tweens.killTweensOf(this),this.showPopUp=new We({targets:[this],delay:e,duration:t,props:{y:{start:this.y+70,to:this.y}}}),this.showPopUp.play()}runShowItemAnimation(e,t){const s=this.getAll();this.scene.tweens.killTweensOf(s),this.showItems=new Ic({targets:s,duration:t,delay:this.scene.tweens.stagger(50,{start:e+50}),props:{scale:{duration:1e3,getStart:i=>i.scale*.8,getEnd:i=>i.scale,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]}},onStart:()=>{this.showItems.baseScales=s.map(i=>i.scale)},onStop:()=>{s.forEach((i,a)=>{i.scale=this.showItems.baseScales[a]})}}),this.showItems.play()}runShowUpAnimation(e=0,t=300){const s=e*100;this.runShowPopUpAnimation(s,t),this.runShowItemAnimation(s,t)}}const{Limit:HC}=GameCore.Configs.LeadersBoard;class YC extends Phaser.GameObjects.Container{currentPlayerId;isUpdating;scroller;constructor(e){super(e),this.scene=e;const{player:t}=this.scene;this.currentPlayerId=t.getPlayerId(),this.isUpdating=!1,this.createReuseScroller(),this.scene.add.existing(this)}createReuseScroller(){this.scroller=new $c(this.scene,{classType:GC,listConfigs:[],width:320,height:290,padding:10,marginTop:10,marginBottom:10}),this.scroller.createMask(),this.scroller.setPosition(0,0),this.add(this.scroller)}updateData(e){if(this.isUpdating)return;this.isUpdating=!0;const t=Object.values(e)||[];if(t.length<1){this.showLeaderboardIsEmpty();return}const s=t.sort((r,o)=>+o.score-+r.score),i=[];let a=1;for(const r of s){if(i.length>=HC)break;const{playerId:o,photo:c,score:l,name:h}=r;if(!o||!h)continue;const u=this.currentPlayerId===o,p={playerId:o,photo:c||L.AVATAR.FILE,name:h,rank:a,score:l,isHighlight:u};i.push(p),a++}this.scroller.updateConfig(i),this.showLeaders()}removeLeaders(){this.scroller.updateConfig([])}getLeaders(){return this.scroller.getChildren()}showLeaders(){const e=this.getLeaders(),t=Math.min(e.length,6),s=300;for(let a=0;a<t;a++){const r=e[a];r&&(r.setVisible(!0),r.runShowUpAnimation(a,s))}const i=s+t*100+50*5;this.scene.time.delayedCall(i,()=>{const a=this.scene.screen.get(I.LEADER_BOARD_SCREEN);this.isUpdating=!1,a.isSwitchable=!0,this.scroller.setEnable(!0)})}showLeaderboardIsEmpty(){const e=this.scene.screen.get(I.LEADER_BOARD_SCREEN);this.isUpdating=!1,e.isSwitchable=!0,e.board.showMessage(!0,this.scene.lang.Text.LEADERBOARD_IS_EMPTY)}}class KC extends Phaser.GameObjects.Container{constructor(e){super(e),this.createRankText(),this.createPhotoText(),this.createNameText(),this.createLevelText()}createRankText(){const e=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(14),text:this.scene.lang.Text.RANK,origin:{x:.2,y:.5}});this.add(e),Phaser.Display.Align.In.Center(e,this,-138)}createPhotoText(){const e=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(14),text:this.scene.lang.Text.PHOTO,origin:{x:.2,y:.5}});this.add(e),Phaser.Display.Align.In.Center(e,this,-94)}createNameText(){const e=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(14),text:this.scene.lang.Text.NAME,origin:{x:.2,y:.5}});this.add(e),Phaser.Display.Align.In.Center(e,this,-45)}createLevelText(){const e=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(14),text:this.scene.lang.Text.LEVEL,origin:{x:.2,y:.5}});this.add(e),Phaser.Display.Align.In.Center(e,this,135)}}const{KEY:VC,FRAME:WC}=y.DEFAULT_8_BIT,{KEY:$C,FRAME:jC}=y.DEFAULT;let zC=class extends Phaser.GameObjects.Container{background;titleText;titleRibbon;header;leaders;loading;message;messageAnimation;onClose;constructor(e){super(e),this.setName("Board"),this.createBackground(),this.createLoading(),this.createMessage(),this.createContents(),this.createCloseButton(),this.createAnimation(),this.updateSize(),this.scene.add.existing(this)}updateSize(){const{width:e,height:t}=this.background;this.setSize(e,t)}showLoading(e){this.loading.setVisible(e),this.showMessage(!1)}showMessage(e,t){this.message.setVisible(e),t&&(this.message.setText(t),this.messageAnimation.play())}createBackground(){this.background=new Rt(this.scene,{x:0,y:0,width:332,height:404.5,topInnerCornerStrokeWidth:1,rightInnerCornerStrokeWidth:3,lightY:-80}),this.add(this.background),this.setSize(this.background.width,this.background.height)}recalculateLightPosition(){this.background&&this.background.recalculateLightPosition()}createLoading(){this.loading=new us(this.scene),this.loading.setTint(16777215),this.loading.setWorldSize(113,113),this.add(this.loading),Phaser.Display.Align.In.Center(this.loading,this.background)}createMessage(){this.message=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(18),origin:{x:.5,y:.5}}),this.message.setTint(16777215),this.add(this.message),Phaser.Display.Align.In.Center(this.message,this.background)}createContents(){this.createLeaders(),this.createTitle(),this.createHeader()}createLeaders(){this.leaders=new YC(this.scene),this.add(this.leaders),Phaser.Display.Align.In.Center(this.leaders,this.background,0,30)}createTitle(){const e=this.scene.add.container();e.setName("title");const t=this.scene.make.image({key:$C,frame:jC.RIBBON_BLUE});t.setWorldSize(239,67);const s=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(22),text:this.scene.lang.Text.LEADERBOARD});Phaser.Display.Align.In.Center(s,t,0,-10),e.add([t,s]),Phaser.Display.Align.In.TopCenter(e,this.background,0,-25),this.add(e),this.titleText=s,this.titleRibbon=t}createHeader(){const e=this.scene.add.container(),t=this.scene.make.image({key:VC,frame:WC.LEADERBOARD_TAB_BG});t.setX(1),t.setWorldSize(329,29),this.header=new KC(this.scene),e.add([t,this.header]),this.add(e),Phaser.Display.Align.In.TopCenter(this.header,e),Phaser.Display.Align.In.Center(e,this.background,-1,-125)}createCloseButton(){const e=new It(this.scene);Phaser.Display.Align.In.TopRight(e,this,10,10),this.add(e),e.onClick=this.handleOnCloseClick}handleOnCloseClick=()=>{this.onClose&&this.onClose()};createAnimation(){this.messageAnimation=new Wc({targets:[this.message],duration:60,repeat:2})}};const{Name:Er,Limit:fr}=GameCore.Configs.LeadersBoard;class mr extends GameCore.Screen{scene;board;tabId;offset;isSwitchable;showPopupAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.7),this.setDepth(Be.POPUP),this.createBoard()}open(){super.open();const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.listenResizeEventForCalculateLight(this),this.scene.requestBackgroundMaskUpdate(I.LEADER_BOARD_SCREEN,this.background.alpha),this.runPopupAnimation(),this.isSwitchable=!1,this.selectWorldTab()}close(){super.close(),this.scene.requestBackgroundMaskUpdate(I.LEADER_BOARD_SCREEN,0)}selectFriendTab(){this.tabId=$T,this.offset=0,this.board.showLoading(!0),this.board.header.kill(),this.board.leaders.removeLeaders(),this.fetchLeaderboardData("friends")}selectWorldTab(){this.tabId=WT,this.offset=0,this.board.showLoading(!0),this.board.header.kill(),this.board.leaders.removeLeaders(),this.fetchLeaderboardData("world")}createBoard(){this.board=new zC(this.scene),this.board.onClose=this.handleCloseClick,Phaser.Display.Align.In.Center(this.board,this,0,-20),this.add(this.board);const e=this.scene.lang.getCurrentLanguage();let t=22;switch(e){case"es":t=19;break}this.board.titleText.setFontSize(t),Phaser.Display.Align.In.Center(this.board.titleText,this.board.titleRibbon,0,-10)}recalculateLightPosition(){this.board&&this.board.recalculateLightPosition()}handleCloseClick=()=>{this.runFadeOutAnimation()};async fetchLeaderboardData(e){console.info("🚀 > fetchLeaderboardData",e);const t={};try{if(!Er)return;const s=await GameSDK.getLeaderboardAsync(Er);let i=[];e==="world"?i=await s.getEntriesAsync(fr,0):i=await s.getConnectedPlayerEntriesAsync(fr,0),i.forEach(a=>{const{playerId:r,score:o,rank:c}=a,l=a.getPlayer(),h=l.getName(),u=l.getPhoto();t[r]={playerId:r,name:h,photo:u,score:o,rank:c}})}catch(s){console.warn(s)}finally{this.isSwitchable=!0,this.board.showLoading(!1),this.board.leaders.updateData(t),this.board.header.revive()}}runPopupAnimation(){this.showPopupAnimation||(this.showPopupAnimation=new We({targets:[this.board]})),this.showPopupAnimation.play()}runFadeOutAnimation(){this.visible&&(this.fadeOutAnimation||(this.fadeOutAnimation=new ve({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.board.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(I.LEADER_BOARD_SCREEN,t.alpha)},onComplete:()=>{this.board.revive();const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.removeResizeEventForCalculateLight(this),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play())}}class XC extends Phaser.GameObjects.Container{payload;process;minProcess;maxProcess;progressBoxLeft;progressBoxBg;progressBoxRight;progressBarLeft;progressBarBg;progressBarRight;progressAnimation;constructor(e,t){super(e),this.payload=t;const s=t.width,i=39;this.setSize(s,i),this.process=0,this.minProcess=0,this.maxProcess=1,this.createProgressBox(),this.createProgressBar(),this.createContainer()}setProcess(e,t=!1){if(this.process=this.getCorrectValue(e),!this.scene||t){this.updateProcess();return}this.runProcessAnimation(e)}updateProcess(){const{displayHeight:e}=this.progressBarBg,t=this.getDisplayWidthByProcess(this.process);this.progressBarBg.setWorldSize(t,e);const{x:s}=this.progressBarBg;this.progressBarRight.setX(s+t)}getCorrectValue(e){let t=e;return isFinite(t)||(t=0),t<this.minProcess&&(t=this.minProcess),t>this.maxProcess&&(t=this.maxProcess),t}getDisplayWidthByProcess(e){const{width:t}=this;return(t-17)*e}getProcessByDisplayWidth(e){const{width:t}=this;return e/(t-17)}runProcessAnimation(e){this.progressAnimation?.remove(),this.progressAnimation=this.scene.add.tween({targets:[this.progressBarBg],duration:1e3,ease:Phaser.Math.Easing.Quadratic.InOut,props:{displayWidth:()=>{const t=this.getCorrectValue(e);return this.getDisplayWidthByProcess(t)}},onUpdate:()=>{const{x:t,displayWidth:s}=this.progressBarBg;this.progressBarRight.setX(t+s)},onComplete:()=>{this.updateProcess()}})}createProgressBox(){const{key:e,frames:t}=this.payload;this.progressBoxLeft=this.scene.make.image({key:e,frame:t.PROGRESS_BG_LEFT}),this.progressBoxLeft.setOrigin(0,.5),this.progressBoxLeft.setWorldSize(9,39),this.progressBoxRight=this.scene.make.image({key:e,frame:t.PROGRESS_BG_RIGHT}),this.progressBoxRight.setOrigin(0,.5),this.progressBoxRight.setWorldSize(9,39),this.progressBoxBg=this.scene.make.image({key:e,frame:t.PROGRESS_BG_MID}),this.progressBoxBg.setOrigin(0,.5),this.progressBoxBg.setWorldSize(9,39);const{displayHeight:s}=this.progressBoxBg,{displayWidth:i}=this,{displayWidth:a}=this.progressBoxLeft,{displayWidth:r}=this.progressBoxRight;this.progressBoxLeft.setWorldSize(a,s),this.progressBoxRight.setWorldSize(r,s),this.progressBoxBg.setWorldSize(i-(a+r),s),Phaser.Display.Align.In.Center(this.progressBoxBg,this,0,0),Phaser.Display.Align.In.LeftCenter(this.progressBoxLeft,this,0,0),Phaser.Display.Align.In.RightCenter(this.progressBoxRight,this,0,0)}createProgressBar(){const{key:e,frames:t}=this.payload;this.progressBarLeft=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_LEFT}),this.progressBarLeft.setOrigin(0,.5),this.progressBarLeft.setWorldSize(8.5,32),this.progressBarRight=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_RIGHT}),this.progressBarRight.setOrigin(0,.5),this.progressBarRight.setWorldSize(8.5,32),this.progressBarBg=this.scene.make.image({key:e,frame:t.PROGRESS_BAR_MID}),this.progressBarBg.setOrigin(0,.5),this.progressBarBg.setWorldSize(8.5,32);const s=-2,i=-1.6,a=-7;Phaser.Display.Align.In.LeftCenter(this.progressBarBg,this,a,i),Phaser.Display.Align.In.LeftCenter(this.progressBarLeft,this,s,i),Phaser.Display.Align.In.LeftCenter(this.progressBarRight,this,s,i),this.setProcess(0,!0)}createContainer(){this.add([this.progressBoxBg,this.progressBoxLeft,this.progressBoxRight,this.progressBarBg,this.progressBarLeft,this.progressBarRight]),this.scene.add.existing(this)}}const{KEY:ZC,FRAME:qC}=y.DEFAULT;class QC extends XC{loadingText;constructor(e,t){super(e,{key:ZC,frames:qC,width:t}),this.createLoadingText()}createLoadingText(){this.loadingText=this.scene.add.text(0,0,`${this.scene.lang.Text.LOADING}0%`,{fontFamily:w.FONT_FAMILY,fontSize:"20px",color:"#ffffff",stroke:"#000000",strokeThickness:3,fixedWidth:13*20,align:"center"}),this.loadingText.setHighQuality(),this.loadingText.setShadow(0,12,"#000000",0,!0),this.add(this.loadingText),Phaser.Display.Align.In.Center(this.loadingText,this,0,-2)}updateProcess(){const{displayHeight:e}=this.progressBarBg,t=this.getDisplayWidthByProcess(this.process);this.progressBarBg.setWorldSize(t,e);const{x:s}=this.progressBarBg;if(this.progressBarRight.setX(s+t),this.loadingText){const i=Math.floor(this.getProcessByDisplayWidth(t)*100);this.loadingText.setText(`${this.scene.lang.Text.LOADING}${i}%`)}}runProcessAnimation(e){this.progressAnimation?.stop(),this.progressAnimation?.remove(),this.progressAnimation=this.scene.add.tween({targets:[this.progressBarBg],duration:600,ease:Phaser.Math.Easing.Circular.InOut,props:{displayWidth:()=>{const t=this.getCorrectValue(e);return this.getDisplayWidthByProcess(t)}},onUpdate:()=>{const{x:t,displayWidth:s}=this.progressBarBg;this.progressBarRight.setX(t+s);const i=Math.floor(this.getProcessByDisplayWidth(s)*100);this.loadingText.setText(`${this.scene.lang.Text.LOADING}${i}%`)},onComplete:()=>{this.updateProcess()}})}}const{KEY:JC}=y.DEFAULT_8_BIT;class eI extends GameCore.Screen{progressBar;constructor(e,t,s,i){super(e,t,s,i),this.background.setAlpha(.8),this.setDepth(Be.SPLASH),this.createTitleIcon(),this.createProgressBar(),this.scene.game.scene.getScene(N.LOAD_SCENE).load.on(Phaser.Loader.Events.PROGRESS,r=>{this.progressBar.setProcess(r)})}open(e){super.open(e),this.progressBar.setProcess(0,!0),this.scene.requestBackgroundMaskUpdate(I.LOADING_SCREEN,.8),this.scene.time.delayedCall(200,()=>{this.progressBar.setProcess(.2)})}close(){this.scene.scene.resume(N.GAME_SCENE),this.scene.time.delayedCall(600,()=>{const e=this.scene;e.requestBackgroundMaskUpdate(I.LOADING_SCREEN,0);const t=this.scene.screen.get(I.BATTLE_SCREEN);t&&!t.visible&&e.requestBackgroundMaskUpdate(I.BATTLE_SCREEN,0);const s=this.scene.screen.get(I.LEADER_BOARD_SCREEN);s&&!s.visible&&e.requestBackgroundMaskUpdate(I.LEADER_BOARD_SCREEN,0),this.progressBar.setProcess(1),super.close()})}createTitleIcon(){const e=this.scene.make.image({key:JC,frame:this.scene.lang.Texture.TITLE}),t=this.scene.lang.getCurrentLanguage();let s=213.5,i=157.5;switch(t){case"ja":s=149,i=157.5}e.setWorldSize(s,i),Phaser.Display.Align.In.Center(e,this,0,-150),this.add(e)}createProgressBar(){this.progressBar=new QC(this.scene,450),this.progressBar.setScale(.6),Phaser.Display.Align.In.Center(this.progressBar,this),this.add(this.progressBar)}}const tI={targets:[],duration:300,ease:Kc,props:{scale:{from:1.2,to:1}}};class Wt extends me{constructor(e){super(tI,e)}}const{KEY:Ar,FRAME:Sr}=y.DEFAULT_8_BIT;class sI extends te{constructor(e){super(e,Ar,Sr.OFFLINE_REWARD_GREEN_BTN,128.5,45.5),this.createCoinIcon(),this.createText()}createCoinIcon(){const e=this.scene.make.image({key:Ar,frame:Sr.OFFLINE_REWARD_GOLD});e.setWorldSize(32.5,30.5),e.setPosition(-35,0),this.add(e)}createText(){const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"de":case"it":t=13;break}const s=this.scene.make.text({text:this.scene.lang.Text.COLLECT,style:{fontSize:`${t}px`,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:13*15,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.65}});s.setHighQuality(),s.setShadow(-8,8,"#000000",0,!0),Phaser.Display.Align.In.RightCenter(s,this.button,0,0),s.setPosition(15,0),this.add(s)}}const{KEY:iI,FRAME:nI}=y.DEFAULT_8_BIT;class aI extends Phaser.GameObjects.Container{text;constructor(e){super(e),this.createIcon(),this.createCoinText(),this.scene.add.existing(this)}createIcon(){const e=this.scene.make.image({key:iI,frame:nI.OFFLINE_REWARD_GOLDS});e.setWorldSize(55,39.5),e.setPosition(50,0),this.add(e)}createCoinText(){const e=this.scene.make.text({text:"+100 coins",style:{fontSize:"35px",stroke:"#000000",strokeThickness:1,color:"#F0DB0F",fixedWidth:455,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),e.setPosition(-30,0),this.add(e),this.text=e}setText(e){this.text.setText(`+${e}`)}}const{KEY:rI,FRAME:oI}=y.DEFAULT_8_BIT;class cI extends Phaser.GameObjects.Container{constructor(e){super(e),this.createRibbon(),this.createTitle(),this.scene.add.existing(this)}createRibbon(){const e=this.scene.make.image({key:rI,frame:oI.OFFLINE_REWARD_RIBBON});e.setWorldSize(247,43.5),this.add(e)}createTitle(){const e=this.scene.make.text({text:this.scene.lang.Text.OFFLINE_COINS_REWARDS,style:{fontSize:"15px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:195,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),e.setPosition(0,-4),this.add(e)}}class jc extends Phaser.GameObjects.Container{payload;constructor(e,t){super(e),this.payload=t,this.createGraphics(),this.scene.add.existing(this)}createGraphics(){const{lineNumber:e=16}=this.payload;for(let t=0;t<e;t++){const s=this.drawCardinalTriangle(),i=Phaser.Math.DegToRad(t*(360/e));s.setPosition(0,0),s.setRotation(i),this.scene.add.existing(s),this.add(s)}}drawCardinalTriangle(){const{color:e,radius:t,width:s}=this.payload,i=Phaser.Math.Between(t.min,t.max),a=new Phaser.GameObjects.Graphics(this.scene);a.clear();const r=[{x:0,y:0}],o=Phaser.Math.Between(s.min,s.max),c=Phaser.Math.DegToRad(o),l={x:i,y:i*Math.tan(c)};r.push(l);const h={x:i,y:i*Math.tan(c)*-1};r.push(h),a.lineStyle(1,16777215,0),a.beginPath(),a.moveTo(r[0].x,r[0].y);for(let u=1;u<r.length;u++)a.lineTo(r[u].x,r[u].y);return a.closePath(),a.strokePath(),a.fillGradientStyle(e,e,e,e,0,1,0,1),a.fillPath(),a}}const{KEY:jt,FRAME:zt}=y.DEFAULT_8_BIT;class lI extends Phaser.GameObjects.Container{listParticle=[];backEffect;tween;backEffectTween;constructor(e){super(e),this.createBackEffect(),this.createTicketCoin(),this.createParticle(),this.createAnimation(),this.scene.add.existing(this)}createBackEffect(){const e=new jc(this.scene,{color:234748,width:{min:4,max:8},radius:{min:180,max:170},lineNumber:18});e.setPosition(0,110),this.add(e),this.backEffect=e}createTicketCoin(){const e=this.scene.make.image({key:jt,frame:zt.OFFLINE_REWARD_TICKET});e.setWorldSize(155.5,124.5),e.setPosition(0,110),this.add(e)}createParticle(){let e=this.scene.make.image({key:jt,frame:zt.OFFLINE_REWARD_PARTICLE_1});e.setWorldSize(23,23),e.setPosition(-102,110-10),this.add(e),this.listParticle.push(e),e=this.scene.make.image({key:jt,frame:zt.OFFLINE_REWARD_PARTICLE_1}),e.setWorldSize(23,23),e.setPosition(78,110+46),this.add(e),this.listParticle.push(e),e=this.scene.make.image({key:jt,frame:zt.OFFLINE_REWARD_PARTICLE_2}),e.setWorldSize(14.5,15),e.setPosition(-90,110+19),this.add(e),this.listParticle.push(e),e=this.scene.make.image({key:jt,frame:zt.OFFLINE_REWARD_PARTICLE_2}),e.setWorldSize(14.5,15),e.setPosition(100,110),this.add(e),this.listParticle.push(e),this.listParticle.push(e)}createAnimation(){const e=this.listParticle[0].scale;this.tween=this.scene.add.tween({paused:!0,targets:this.listParticle,duration:800,ease:Phaser.Math.Easing.Cubic.Out,repeat:-1,yoyo:!0,delay:this.scene.tweens.stagger(50,{start:Math.random()*50+50}),props:{scale:{from:e,to:e*Phaser.Math.FloatBetween(.7,.9)}}}),this.backEffectTween=this.scene.add.tween({paused:!0,targets:this.backEffect,duration:1e6,ease:Phaser.Math.Easing.Linear,repeat:-1,props:{rotation:{start:0,to:180}}})}runAnimation(){this.tween.resume(),this.backEffectTween.resume()}stopAnimation(){this.tween.pause(),this.backEffectTween.pause()}}const{KEY:Tr,FRAME:yr}=y.DEFAULT_8_BIT;let hI=class extends te{constructor(e){super(e,Tr,yr.OFFLINE_REWARD_YELLOW_BTN,128.5,45.5),this.createCoinIcon(),this.createText()}createCoinIcon(){const e=this.scene.make.image({key:Tr,frame:yr.OFFLINE_REWARD_ADS});e.setWorldSize(32,30),e.setPosition(-40,-3),this.add(e)}createText(){const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"pt":case"es":t=12;break;case"de":case"it":t=13;break}const s=this.scene.make.text({text:this.scene.lang.Text.X2_COINS,style:{fontSize:`${t}px`,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:13*15,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.65}});s.setHighQuality(),s.setShadow(-8,8,"#000000",0,!0),Phaser.Display.Align.In.RightCenter(s,this.button,0,0),s.setPosition(15,0),this.add(s)}};const{LEVEL_PROGRESS:uI,PLAYER_UNIT_DATA:dI}=ce,{Ads:Ii}=GameCore.Configs;class Cr extends GameCore.Screen{rewardValue;collectButton;viewAdButton;coinIcon;contents;title;popup;popupFadeOutAnimation;showUpAnimation;contentShowUpAnimation;adsTimer;constructor(e,t,s,i){super(e,t,s,i),this.setName(t),this.setDepth(Be.POPUP),this.background.setAlpha(.7),this.createPopup(),this.createTicketCoinIcon(),this.createCloseBtn(),this.createContents(),this.createTitle(),this.createCollectButton(),this.createViewAdsButton()}open=e=>{super.open(e);const t=this.scene.scene.get(N.GAME_SCENE);t instanceof H&&t.screenManager.listenResizeEventForCalculateLight(this),this.scene.ads.canbeShowRewardAd()?this.viewAdButton.setDisabled(!1):this.viewAdButton.setDisabled(!0);const s=this.getData("rewardValue");this.setRewardValue(this.calculateRewardCoins(s)),this.runOpenAnimation(),this.scene.storage.dispatch(pA())};createPopup(){this.popup=new Rt(this.scene,{x:0,y:0,width:332,height:404.5,rightEdge:870778,bottomRightCorner:221341,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-80}),this.add(this.popup)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createTicketCoinIcon(){const e=new lI(this.scene);Phaser.Display.Align.In.TopCenter(e,this.popup,0,-30),this.add(e),this.coinIcon=e}createCloseBtn(){const e=new It(this.scene);e.onClick=this.handleClosePopup,Phaser.Display.Align.In.TopRight(e,this.popup,10,10),this.popup.add(e)}createContents(){const e=new aI(this.scene);Phaser.Display.Align.In.Center(e,this.popup,0,60),this.add(e),this.contents=e}createTitle(){const e=new cI(this.scene);Phaser.Display.Align.In.TopCenter(e,this.popup,0,-10),this.add(e),this.title=e}createCollectButton(){const e=new sI(this.scene);e.setName("Collect"),e.onClick=this.handleClosePopup,Phaser.Display.Align.In.BottomCenter(e,this.popup,-70,-20),Ii.Enabled||Phaser.Display.Align.In.BottomCenter(e,this.popup,0,-20),this.add(e),this.collectButton=e}createViewAdsButton(){const e=new hI(this.scene);e.setName("CollectX2"),e.onClick=this.handleShowRewardedVideoAd,Phaser.Display.Align.In.BottomCenter(e,this.popup,70,-20),this.add(e),this.viewAdButton=e,Ii.Enabled||e.kill()}handleClosePopup=()=>{this.runCloseAnimation(),this.rewardCoins(this.rewardValue)};handleShowRewardedVideoAd=async()=>{let e=null;const{audio:t,game:s}=this.scene;try{this.viewAdButton.setDisabled(!0),e=s.globalScene.time.delayedCall(200,()=>{s.globalScene.screen.open(I.NOTIFY_SCREEN,{message:s.lang.Text.LOADING_ADS,duration:0,loading:!0})}),t.muteAll(),await this.scene.ads.showRewardedVideoAsync(),this.scene.audio.playSound(G.DAILY_REWARD);const i=this.rewardValue.clone();i.multiply(2),this.rewardCoins(i),this.runCloseAnimation()}catch(i){if(console.info("🚀 > showRewardedAdAsync",i),i instanceof Object&&GameCore.Utils.Object.hasOwn(i,"code")&&i.code==="USER_INPUT"){this.showNotifySkipAds();return}this.showNotifyNoAds()}finally{this.adsTimer?.destroy(),t.unmuteAll(),this.viewAdButton.setDisabled(!1),e?.remove(),s.globalScene.screen.close(I.NOTIFY_SCREEN),this.scene.ads.preloadRewardedVideoAsync().catch(i=>{})}};showNotifyNoAds=e=>{if(e&&e.name!==I.CLOSEABLE_NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(I.CLOSEABLE_NOTIFY_SCREEN,{message:t.lang.Text.NO_ADS_TO_DISPLAY,duration:1500,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.scene.game;e.screen.open(I.CLOSEABLE_NOTIFY_SCREEN,{message:e.lang.Text.SORRY_NO_REWARDS,duration:1500,loading:!1})};runOpenAnimation(){this.scene.requestBackgroundMaskUpdate(I.OFFLINE_REWARD_SCREEN,this.background.alpha),this.runPopupEntrancesAnimation(),this.runPopupContentEntrancesAnimation(100,400)}runCloseAnimation=()=>{this.runExitsAnimation(0,200)};runPopupEntrancesAnimation(){this.showUpAnimation||(this.showUpAnimation=new We({targets:[this.popup,this.title]})),this.showUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove(),this.coinIcon.runAnimation();const s=[this.collectButton,this.viewAdButton,this.contents],i=s.map(a=>a.alpha);s.forEach(a=>a.setAlpha(0)),this.contentShowUpAnimation=new Wt({targets:s,duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:a=>a.scale-.3,getEnd:a=>a.scale},alpha:{getStart:()=>0,getEnd:(a,r,o,c)=>i[c]}}}),this.contentShowUpAnimation.play()}rewardCoins(e){const t=e;this.scene.coin.plusCoins(t.baseValue,t.suffix);const s=this.scene.scene.get(N.GAME_SCENE);s instanceof H&&s.updateUI()}calculateRewardCoins(e){let t=new F(e);const s=new F(D.BASE_UNIT_COIN),i=this.calculateRewardModifier();return t.multiply(i),t.divide(60),t.smallerThan(s)&&(t=s),t}calculateRewardModifier(){const e=this.calculateLevelModifier(),t=this.calculateUsedUnit();return e.multiply(t),e.multiply(D.BASE_UNIT_COIN),e}calculateLevelModifier(){let t=this.scene.player.getCustomData(uI);t<0&&(t=0),t++;const{UNIT_COIN_SCALE:s}=D;if(t<=50){const i=Math.pow(s,t),a=new F(1);return a.multiply(i),a}else{const i=Math.pow(s,50),a=Math.floor(t/50),r=t%50,o=new F(1);for(let l=0;l<a;l++)o.multiply(i);const c=Math.pow(s,r);return o.multiply(c),o}}calculateUsedUnit(){const e=this.scene.player.getCustomData(dI);if(!e||typeof e!="string")return 1;const t=e.split("/");let s=0,i=0;return t.forEach(a=>{a.split("-").forEach(o=>{if(o==="0")return;const c=o[0],l=parseInt(o.substring(1));c==="m"&&(s+=Math.pow(2,l-1)),c==="r"&&(i+=Math.pow(2,l-1))})}),s>i?s:i}runExitsAnimation(e,t){this.collectButton.setDisabled(!0),this.popupFadeOutAnimation||(this.popupFadeOutAnimation=new ve({targets:[this.background],delay:e,duration:t,props:{alpha:{start:.7,from:.7,to:0}},ease:Phaser.Math.Easing.Cubic.Out,onActive:()=>{this.coinIcon.kill(),this.contents.kill(),this.title.kill(),this.popup.kill(),this.collectButton.kill(),this.viewAdButton.kill()},onUpdate:(s,i)=>{this.scene.requestBackgroundMaskUpdate(I.OFFLINE_REWARD_SCREEN,i.alpha)},onComplete:()=>{this.coinIcon.revive(),this.contents.revive(),this.title.revive(),this.popup.revive(),this.collectButton.revive(),Ii.Enabled&&this.viewAdButton.revive();const s=this.scene.scene.get(N.GAME_SCENE);s instanceof H&&s.screenManager.removeResizeEventForCalculateLight(this),this.scene.screen.close(this.name),this.collectButton.setDisabled(!1),this.coinIcon.stopAnimation(),this.background.setAlpha(.7)}})),this.popupFadeOutAnimation.play()}setRewardValue(e){this.rewardValue=e,this.contents.setText(e.toString())}}const{KEY:pI,FRAME:Ir}=y.DEFAULT;class Ri extends Phaser.GameObjects.Container{icon;label;switch;hitZone;isSwitchOn;payload;parentName;constructor(e,t){super(e),this.payload=t,this.setName("SettingSwitch"),this.createHitZone(),this.createIcon(),this.createLabel(),this.createSwitch()}set onClick(e){this.hitZone.removeAllListeners(),this.hitZone.setInteractive({useHandCursor:!0}),this.hitZone.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,()=>{const t=!this.isSwitchOn;this.logButtonEvent(t),this.setSwitch(t),e(t),it(50)})}setSwitch(e){e?(this.switch.setFrame(Ir.SETTINGS_SWITCH_ON),this.switch.setWorldSize(37.5,22)):(this.switch.setFrame(Ir.SETTINGS_SWITCH_OFF),this.switch.setWorldSize(37,21.5)),this.isSwitchOn=e}createIcon(){this.icon=this.scene.make.image({key:this.payload.iconKey,frame:this.payload.icon}),this.icon.setWorldSize(this.payload.iconWidth,this.payload.iconHeight),this.add(this.icon),Phaser.Display.Align.In.LeftCenter(this.icon,this.hitZone,this.payload.iconLeftOffset)}createLabel(){const e=this.scene.make.text({text:this.payload.label,style:{fontSize:"15px",color:"#FFFFFF",fontFamily:w.FONT_FAMILY,fixedWidth:100},origin:{x:0,y:.5}});e.setName("label"),e.setHighQuality(),this.add(e),e.setX(this.payload.localTextX),this.label=e}createSwitch(){this.switch=this.scene.make.image({key:pI}),this.setSwitch(!1),Phaser.Display.Align.In.RightCenter(this.switch,this.hitZone),this.add(this.switch)}createHitZone(){this.hitZone=this.scene.add.zone(0,0,180,45),this.add(this.hitZone)}logButtonEvent(e){const t=this.getParentName(),s=this.name;this.scene.analytics.event(v.BUTTON_CLICK,{button_name:s,value:e?"on":"off",screen_name:t})}getParentName(){if(this.parentName)return this.parentName;let e=this.parentContainer;for(;e;){if(e instanceof GameCore.Screen){const t=e;return this.parentName=t.getScreenName(),this.parentName}e=e.parentContainer}return this.parentName=this.scene.getSceneName(),this.parentName}setDisabled(e){e?(this.hitZone?.disableInteractive(),this.setAlpha(.5)):(this.hitZone?.setInteractive(),this.setAlpha(1))}}const{KEY:gI,FRAME:EI}=y.DEFAULT,{KEY:_i,FRAME:Li}=y.DEFAULT_8_BIT;class qi extends GameCore.Screen{popup;sound;music;speedUp;title;showUpAnimation;contentShowUpAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.7),this.setSize(this.scene.gameZone.displayWidth,this.scene.gameZone.displayHeight),this.createPopup(),this.createCloseButton(),this.createTitle(),this.createContent()}open(){super.open();const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.listenResizeEventForCalculateLight(this),this.scene.requestBackgroundMaskUpdate(I.SETTINGS_SCREEN,this.background.alpha),this.runOpenAnimation();const s=!!this.scene.player.getPlayerSetting("sound");this.sound.setSwitch(s);const i=!!this.scene.player.getPlayerSetting("music");this.music.setSwitch(i);const a=!!this.scene.player.getPlayerSetting("speedUp");this.speedUp.setSwitch(a)}handleChangeSound=e=>{this.scene.audio.playSound(G.TURN_SWITCH),this.scene.player.setSetting("sound",e)};handleChangeMusic=e=>{this.scene.audio.playSound(G.TURN_SWITCH),this.scene.player.setSetting("music",e),e?this.scene.audio.playMusic():this.scene.audio.pauseMusic()};handleChangeSpeedUp=e=>{this.scene.audio.playSound(G.TURN_SWITCH),this.scene.player.setSetting("speedUp",e)};handleClosePopup=()=>{this.runFadeOutAnimation()};createPopup(){this.popup=new Rt(this.scene,{x:0,y:0,width:261.5,height:323,rightEdge:870778,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-40}),this.add(this.popup)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createCloseButton(){const e=new It(this.scene);e.setName("button"),Phaser.Display.Align.In.TopRight(e,this.popup,10,10),this.popup.add(e),e.onClick=this.handleClosePopup}createTitle(){const e=this.scene.make.text({text:this.scene.lang.Text.SETTINGS,style:{fontSize:"22px",stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:325,align:"center",fontFamily:w.FONT_FAMILY}});e.setName("title"),e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),this.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-13);const t=this.scene.make.image({key:gI,frame:EI.TITLE_LINE});t.setWorldSize(235,23),this.popup.add(t),Phaser.Display.Align.In.BottomCenter(t,e,0,30),this.title=e}createContent(){this.createSoundSetting(),this.createMusicSetting(),this.createSpeedUpSetting()}createSoundSetting(){this.sound=new Ri(this.scene,{iconKey:_i,icon:Li.ICON_SOUND,iconWidth:26,iconHeight:24,iconLeftOffset:6,localTextX:-60,label:`${this.scene.lang.Text.SOUND_FX}  `});const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"pt":t=13;break;case"es":t=11;break}this.sound.label.setFontSize(t),this.sound.setName("SettingSound"),this.add(this.sound),Phaser.Display.Align.In.Center(this.sound,this.popup,0,-55),this.sound.onClick=this.handleChangeSound;const s=this.scene.make.graphics({});s.fillStyle(16777215,.1),s.fillRect(-104.5,-.5,209,1),s.setPosition(0,-19.5),this.popup.add(s)}createMusicSetting(){this.music=new Ri(this.scene,{iconKey:_i,icon:Li.ICON_MUSIC,iconWidth:20,iconHeight:20,iconLeftOffset:3,localTextX:-60,label:`${this.scene.lang.Text.MUSIC}      `}),this.music.setName("SettingMusic"),this.add(this.music),Phaser.Display.Align.In.Center(this.music,this.popup,0,15),this.music.onClick=this.handleChangeMusic;const e=this.scene.make.graphics({});e.fillStyle(16777215,.1),e.fillRect(-104.5,-.5,209,1),e.setPosition(0,45.5),this.popup.add(e)}createSpeedUpSetting(){this.speedUp=new Ri(this.scene,{iconKey:_i,icon:Li.ICON_QUICK_FIGHT,iconWidth:19,iconHeight:24,iconLeftOffset:4,localTextX:-60,label:`${this.scene.lang.Text.QUICK_FIGHT}`});const e=this.scene.lang.getCurrentLanguage();let t=15;switch(e){case"ja":case"fr":t=13;break;case"de":t=11;break}this.speedUp.label.setFontSize(t),this.speedUp.setName("SettingSpeed"),this.add(this.speedUp),Phaser.Display.Align.In.Center(this.speedUp,this.popup,0,85),this.speedUp.onClick=this.handleChangeSpeedUp}runOpenAnimation(){this.runPopupEntrancesAnimation(),this.runPopupContentEntrancesAnimation(100,400)}runPopupEntrancesAnimation(){this.showUpAnimation||(this.showUpAnimation=new We({targets:[this.popup]})),this.showUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove();const s=[this.title,this.sound,this.music];this.speedUp&&s.push(this.speedUp);const i=s.map(a=>a.alpha);this.contentShowUpAnimation=new Wt({targets:s,duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:a=>a.scale-.3,getEnd:a=>a.scale},alpha:{getStart:a=>(a.setAlpha(0),0),getEnd:(a,r,o,c)=>i[c]}}}),this.contentShowUpAnimation.play()}runFadeOutAnimation(){this.fadeOutAnimation||(this.fadeOutAnimation=new ve({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.popup.kill(),this.title.kill(),this.sound.kill(),this.music.kill(),this.speedUp?.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(I.SETTINGS_SCREEN,t.alpha)},onComplete:()=>{this.popup.revive(),this.title.revive(),this.sound.revive(),this.music.revive(),this.speedUp?.revive();const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.removeResizeEventForCalculateLight(this),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play()}}const{KEY:fI,FRAME:mI}=y.DEFAULT,{KEY:Rr,FRAME:_r}=y.DEFAULT_8_BIT;class Lr extends GameCore.Screen{popup;title;confirmBtn;cancelBtn;description;showUpAnimation;contentShowUpAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.7),this.setSize(this.scene.gameZone.displayWidth,this.scene.gameZone.displayHeight),this.createPopup(),this.createCloseButton(),this.createTitle(),this.createContent()}open(){super.open();const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.listenResizeEventForCalculateLight(this),this.scene.requestBackgroundMaskUpdate(I.RESET_DATA_SCREEN,this.background.alpha),this.runOpenAnimation()}handleClosePopup=()=>{this.runFadeOutAnimation()};createPopup(){this.popup=new Rt(this.scene,{x:0,y:0,width:300,height:200,rightEdge:870778,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-40}),this.add(this.popup)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createCloseButton(){const e=new It(this.scene);e.setName("button"),Phaser.Display.Align.In.TopRight(e,this.popup,10,10),this.popup.add(e),e.onClick=this.handleClosePopup}createTitle(){const e=this.scene.make.text({text:this.scene.lang.Text.RESET_DATA,style:{fontSize:"22px",stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:325,align:"center",fontFamily:w.FONT_FAMILY}});e.setName("title"),e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),this.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-13);const t=this.scene.make.image({key:fI,frame:mI.TITLE_LINE});t.setWorldSize(235,23),this.popup.add(t),Phaser.Display.Align.In.BottomCenter(t,e,0,30),this.title=e}createContent(){this.createDescription(),this.createConfirmButton(),this.createCancelButton()}createDescription(){const e=this.scene.lang.getCurrentLanguage();let t=17;switch(e){case"id":case"de":t=15;break}this.description=this.scene.make.bitmapText({text:this.scene.lang.Text.RESET_DESC,font:w.PRIMARY.KEY,size:this.scene.fontSize(t),origin:{x:.5,y:.5}}),this.description.setCenterAlign(),this.add(this.description),this.description.setPosition(0,-10)}createConfirmButton(){this.confirmBtn=new te(this.scene,Rr,_r.BUTTON_RED,108,43),this.confirmBtn.setName("confirmBtn");const e=this.scene.lang.getCurrentLanguage();let t=-5;switch(e){case"tr":t=-8;break}const s=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.YES),s.setDropShadow(-1,1.5,0),this.confirmBtn.add(s),s.setPosition(0,t),this.add(this.confirmBtn),Phaser.Display.Align.In.Center(this.confirmBtn,this.popup,-70,60),this.confirmBtn.onClick=()=>{const i=this.scene.scene.get(N.GAME_SCENE);i instanceof H&&i.resetLevel();const a=this.scene.screen.get(I.SETTINGS_SCREEN);a instanceof qi&&a.handleClosePopup(),this.handleClosePopup()}}createCancelButton(){this.cancelBtn=new te(this.scene,Rr,_r.BUTTON_GREEN,108,43),this.cancelBtn.setName("cancelBtn");const e=this.scene.lang.getCurrentLanguage();let t=-5;switch(e){case"tr":t=-8;break}const s=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.NO),s.setDropShadow(-1,1.5,0),this.cancelBtn.add(s),s.setPosition(0,t),this.add(this.cancelBtn),Phaser.Display.Align.In.Center(this.cancelBtn,this.popup,70,60),this.cancelBtn.onClick=this.handleClosePopup}runOpenAnimation(){this.runPopupEntrancesAnimation(),this.runPopupContentEntrancesAnimation(100,400)}runPopupEntrancesAnimation(){this.showUpAnimation||(this.showUpAnimation=new We({targets:[this.popup]})),this.showUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove();const s=[this.title,this.description,this.confirmBtn,this.cancelBtn],i=s.map(a=>a.alpha);this.contentShowUpAnimation=new Wt({targets:s,duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:a=>a.scale-.3,getEnd:a=>a.scale},alpha:{getStart:a=>(a.setAlpha(0),0),getEnd:(a,r,o,c)=>i[c]}}}),this.contentShowUpAnimation.play()}runFadeOutAnimation(){this.fadeOutAnimation||(this.fadeOutAnimation=new ve({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.popup.kill(),this.title.kill(),this.description.kill(),this.confirmBtn.kill(),this.cancelBtn.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(I.RESET_DATA_SCREEN,t.alpha)},onComplete:()=>{this.popup.revive(),this.title.revive(),this.description.revive(),this.confirmBtn.revive(),this.cancelBtn.revive();const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.removeResizeEventForCalculateLight(this),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play()}}const{KEY:AI,FRAME:wr}=y.GAMEPLAY;class SI extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitter;constructor(e){super(e,AI,wr.DASHBOARD_COINBAR_COIN),this.createEmitters(),this.setActive(!1),this.setVisible(!1),this.scene.add.existing(this)}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:wr.DASHBOARD_COINBAR_COIN,gravityY:160,angle:{min:-180,max:0},speed:{min:50,max:200},scale:{min:e*.8,max:e*.8},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.In},lifespan:1500})}explode(e,t,s){this.setActive(!0),this.setVisible(!0),this.emitter.explode(e,t,s)}}const{KEY:ut,FRAME:TI}=y.EFFECTS,dt=TI,X={CONFETTI_HEXAGON:{KEY:"confetti-hexagon-animation",TEXTURE:ut,PREFIX:dt.FX_CONFETTI_HEXAGON,FRAME_RATE:8,END:5,ZERO_PAD:0},CONFETTI_STAR_X:{KEY:"confetti-star-x",TEXTURE:ut,PREFIX:dt.ANIMATION_STAR_X,FRAME_RATE:4,END:4,ZERO_PAD:0},CONFETTI_STAR_Y:{KEY:"confetti-star-y",TEXTURE:ut,PREFIX:dt.ANIMATION_STAR_Y,FRAME_RATE:4,END:4,ZERO_PAD:0},RIBBON_A:{KEY:"animation-ribbon-a",TEXTURE:ut,PREFIX:dt.PREFIX_ANIMATION_RIBBON_CONFETTI_A,FRAME_RATE:16,END:3,ZERO_PAD:0},RIBBON_B:{KEY:"animation-ribbon-b",TEXTURE:ut,PREFIX:dt.PREFIX_ANIMATION_RIBBON_CONFETTI_B,FRAME_RATE:16,END:4,ZERO_PAD:0},RIBBON_C:{KEY:"animation-ribbon-c",TEXTURE:ut,PREFIX:dt.PREFIX_ANIMATION_RIBBON_CONFETTI_C,FRAME_RATE:16,END:4,ZERO_PAD:0},RIBBON_D:{KEY:"animation-ribbon-d",TEXTURE:ut,PREFIX:dt.PREFIX_ANIMATION_RIBBON_CONFETTI_D,FRAME_RATE:16,END:4,ZERO_PAD:0}},{KEY:yI,TEXTURE:CI,FRAME_RATE:II,END:RI,PREFIX:_I,ZERO_PAD:LI}=X.RIBBON_A;class wI extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:II,frames:e.generateFrameNames(CI,{prefix:_I,end:RI,zeroPad:LI,start:1}),yoyo:!0,showOnStart:!0};super(e,yI,t)}}const{KEY:PI,TEXTURE:OI,FRAME_RATE:DI,END:vI,PREFIX:NI,ZERO_PAD:bI}=X.RIBBON_B;class MI extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:DI,frames:e.generateFrameNames(OI,{prefix:NI,end:vI,zeroPad:bI,start:1}),yoyo:!0,showOnStart:!0};super(e,PI,t)}}const{KEY:UI,TEXTURE:kI,FRAME_RATE:BI,END:xI,PREFIX:FI,ZERO_PAD:GI}=X.RIBBON_C;class HI extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:BI,frames:e.generateFrameNames(kI,{prefix:FI,end:xI,zeroPad:GI,start:1}),yoyo:!0,showOnStart:!0};super(e,UI,t)}}const{KEY:YI,TEXTURE:KI,FRAME_RATE:VI,END:WI,PREFIX:$I,ZERO_PAD:jI}=X.RIBBON_D;class zI extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:VI,frames:e.generateFrameNames(KI,{prefix:$I,end:WI,zeroPad:jI,start:1}),yoyo:!0,showOnStart:!0};super(e,YI,t)}}const{KEY:XI,TEXTURE:ZI,FRAME_RATE:qI,END:QI,PREFIX:JI,ZERO_PAD:eR}=X.CONFETTI_STAR_X;class tR extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:qI,frames:e.generateFrameNames(ZI,{prefix:JI,end:QI,zeroPad:eR,start:1}),yoyo:!0,showOnStart:!0};super(e,XI,t)}}const{KEY:sR,TEXTURE:iR,FRAME_RATE:nR,END:aR,PREFIX:rR,ZERO_PAD:oR}=X.CONFETTI_STAR_Y;class cR extends Phaser.Animations.Animation{constructor(e){const t={repeat:-1,frameRate:nR,frames:e.generateFrameNames(iR,{prefix:rR,end:aR,zeroPad:oR,start:1}),showOnStart:!0};super(e,sR,t)}}class lR extends Phaser.GameObjects.Particles.Particle{scene;ribbon;graphics;colorUse;lastChange;currentFrame;isYoyo;isGravityChanged;points;constructor(e){super(e),this.scene=e.manager.scene,this.points=new Array(10).fill(null).map(()=>({x:0,y:0})),this.isYoyo=!1,this.isGravityChanged=!1,this.lastChange=0,this.currentFrame=-1,this.createGraphics(),this.randomRibbonUsedWhenFall()}randomRibbonUsedWhenFall(){switch(Phaser.Math.Between(0,3)){case 0:this.ribbon=this.scene.anims.get(X.RIBBON_A.KEY);break;case 1:this.ribbon=this.scene.anims.get(X.RIBBON_B.KEY);break;case 2:this.ribbon=this.scene.anims.get(X.RIBBON_C.KEY);break;case 3:this.ribbon=this.scene.anims.get(X.RIBBON_D.KEY);break;default:this.ribbon=this.scene.anims.get(X.RIBBON_A.KEY);break}}setRibbonPosition(e,t){this.points.map(s=>{s.x=e,s.y=t})}createGraphics(){const e=[8443204,2928867,12013036,16376097,15285798];this.colorUse=e[Phaser.Math.Between(0,e.length-1)],this.graphics=this.scene.add.graphics({lineStyle:{width:3,color:this.colorUse}});const{x:t,y:s,depth:i}=this.emitter.manager;this.graphics.setDepth(i),this.graphics.setPosition(t,s)}update(e,t,s){const i=super.update(e,t,s);return this.updateFrames(e),this.updatePoints(),this.updateGraphics(),this.updateGravity(),this.updateVelocity(),this.updateColor(),i}updateFrames(e){this.lastChange+=e,this.lastChange>=this.ribbon.msPerFrame&&(this.isYoyo?this.currentFrame--:this.currentFrame++,this.currentFrame<0&&(this.isYoyo=!1,this.currentFrame=1),this.currentFrame>=this.ribbon.frames.length&&(this.isYoyo=!0,this.currentFrame-=1),this.frame=this.ribbon.frames[this.currentFrame].frame,this.lastChange-=this.ribbon.msPerFrame)}updatePoints(){this.graphics.visible&&(this.points.shift(),this.points.push({x:this.x,y:this.y}))}updateGraphics(){if(this.graphics.visible){for(const e of this.points)if(e.y===0)return;this.graphics.clear(),this.graphics.strokePoints(this.points)}}updateGravity(){this.lifeCurrent>this.life-2e3||this.isGravityChanged||(this.isGravityChanged=!0,this.graphics.destroy(),this.emitter.setVisible(!0),this.emitter.setGravityY(45))}updateVelocity(){if(this.graphics.visible){if(this.lifeCurrent>this.life-1800){this.velocityX+=Phaser.Math.Between(-12,12);return}this.velocityX>0?this.velocityX+=Phaser.Math.Between(-10,6):this.velocityX+=Phaser.Math.Between(-6,10)}}updateColor(){this.graphics.visible||(this.tint=this.colorUse)}}class hR extends Phaser.GameObjects.Particles.Particle{scene;isYoyo;isGravityChanged;lastChange;currentFrame;star;starX;starY;constructor(e){super(e),this.isYoyo=!1,this.isGravityChanged=!1,this.lastChange=0,this.currentFrame=-1,this.scene=e.manager.scene,this.starX=this.scene.anims.get(X.CONFETTI_STAR_X.KEY),this.starY=this.scene.anims.get(X.CONFETTI_STAR_Y.KEY),this.star=this.starX}update(e,t,s){const i=super.update(e,t,s);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),i}updateGravity(){this.lifeCurrent>this.life-2e3||this.isGravityChanged||(this.isGravityChanged=!0,this.emitter.setGravityY(15),this.emitter.setSpeedX(0))}updateVelocity(){this.lifeCurrent>this.life-2e3||(this.velocityX>0?this.velocityX+=Phaser.Math.Between(-6,3):this.velocityX+=Phaser.Math.Between(-3,6))}updateFrames(e){if(this.lastChange+=e,this.lastChange>=this.star.msPerFrame){const t=Phaser.Math.RND.between(0,1);this.star=t>0?this.starX:this.starY,this.isYoyo?this.currentFrame--:this.currentFrame++,this.currentFrame<0&&(this.isYoyo=!1,this.currentFrame=1,this.emitter.setAlpha(1)),this.currentFrame>=this.star.frames.length&&(this.isYoyo=!0,this.currentFrame-=1,this.emitter.setAlpha(.8)),this.frame=this.star.frames[this.currentFrame].frame,this.lastChange-=this.star.msPerFrame}}updateFrameRate(){this.lifeCurrent<this.life-2e3?this.star.msPerFrame=150:this.star.msPerFrame=Phaser.Math.RND.between(300,600)}}const{KEY:uR,FRAME:dR}=y.EFFECTS,wi=dR;class pR extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitterConfetti;emitterRibbons;ribbonConfig;confettiConfig;width;height;constructor(e){super(e,uR,wi.BLANK),this.emitterRibbons=[],this.emitterConfetti=[],this.createConfigs(),this.createAnimations(),this.scene.add.existing(this)}createConfigs(){const e=[8443204,2928867,12013036,16376097,15285798],t=1/this.scene.world.getPixelRatio();this.ribbonConfig={on:!1,visible:!1,timeScale:1.5,frame:wi.BLANK,particleBringToTop:!0,speedY:{min:-480,max:-560},gravityY:290,lifespan:{min:4e3,max:6e3},rotate:{start:0,end:360*5,random:!0},scale:{min:t*.6,max:t},particleClass:lR},this.confettiConfig={on:!1,delay:200,timeScale:2,tint:e,particleBringToTop:!0,frame:wi.PREFIX_ANIMATION_RIBBON_CONFETTI_A+"1",speedY:{min:-460,max:-580},gravityY:280,lifespan:{min:5e3,max:8e3},rotate:{start:0,end:360*3},scale:{min:t*.6,max:t},particleClass:hR}}createAnimations(){if(!this.scene.anims.get(X.CONFETTI_STAR_X.KEY)){const e=new tR(this.scene.anims);this.scene.anims.add(X.CONFETTI_STAR_X.KEY,e)}if(!this.scene.anims.get(X.CONFETTI_STAR_Y.KEY)){const e=new cR(this.scene.anims);this.scene.anims.add(X.CONFETTI_STAR_Y.KEY,e)}if(!this.scene.anims.get(X.RIBBON_A.KEY)){const e=new wI(this.scene.anims);this.scene.anims.add(X.RIBBON_A.KEY,e)}if(!this.scene.anims.get(X.RIBBON_B.KEY)){const e=new MI(this.scene.anims);this.scene.anims.add(X.RIBBON_B.KEY,e)}if(!this.scene.anims.get(X.RIBBON_C.KEY)){const e=new HI(this.scene.anims);this.scene.anims.add(X.RIBBON_C.KEY,e)}if(!this.scene.anims.get(X.RIBBON_D.KEY)){const e=new zI(this.scene.anims);this.scene.anims.add(X.RIBBON_D.KEY,e)}}run(e,t,s,i){this.setPosition(e,t),this.width=s,this.height=i,this.createEmitters(),this.emitterConfetti.forEach(a=>{a.emitParticle(25)}),this.emitterRibbons.forEach(a=>{a.emitParticle(20)})}stop(){this.emitterConfetti.forEach(e=>{e.killAll()}),this.emitterRibbons.forEach(e=>{e.killAll()}),this.kill()}createEmitters(){this.emitterRibbons=[],this.emitterConfetti=[],this.createConfettiLeftEmitter(),this.createConfettiRightEmitter(),this.createRibbonLeftEmitter(),this.createRibbonRightEmitter()}createConfettiLeftEmitter(){const e={...this.confettiConfig,speedX:{min:5,max:90}},t=this.createEmitter(e);this.emitterConfetti.push(t)}createConfettiRightEmitter(){const{width:e}=this,t={...this.confettiConfig,x:e,speedX:{min:-5,max:-90}},s=this.createEmitter(t);this.emitterConfetti.push(s)}createRibbonLeftEmitter(){const e={...this.ribbonConfig,speedX:{min:20,max:80},emitCallback:s=>{s.setRibbonPosition(0,0)}},t=this.createEmitter(e);this.emitterRibbons.push(t)}createRibbonRightEmitter(){const{width:e}=this,t={...this.ribbonConfig,x:e,speedX:{min:-20,max:-80},emitCallback:i=>{i.setRibbonPosition(e,0)}},s=this.createEmitter(t);this.emitterRibbons.push(s)}killAllParticles(){this.emitterConfetti.forEach(e=>{e.forEachAlive(t=>{t.lifeCurrent=0},this)}),this.emitterRibbons.forEach(e=>{e.forEachAlive(t=>{t.lifeCurrent=0},this)})}}class zc extends te{paddingZone;showDebugZone;debugZone;constructor(e,t){const{key:s,frame:i,width:a,height:r,usePixelPerfect:o}=t;super(e,s,i,a,r,o);const{paddingZone:c=0,showDebugZone:l=!1}=t;this.paddingZone=c,this.showDebugZone=l}updateSize(){super.updateSize();const{width:e,height:t}=this,s=e+this.paddingZone,i=t+this.paddingZone;this.setSize(s,i),this.hitZone.setSize(s,i),this.showDebugZone&&(this.debugZone?.destroy(),this.debugZone=this.hitZone.drawDebugBox(10699282,.5),this.add(this.debugZone))}}const{KEY:vt,FRAME:Nt}=y.DEFAULT_8_BIT,{Ads:Pi}=GameCore.Configs;class gR extends Phaser.GameObjects.Container{continueButton;coinText;getText;winContainer;loseContainer;postAdContinueAnimation;replayButton;postAdReplayAnimation;returnButton;postAdReturnAnimation;openAnimation;mode="NORMAL";constructor(e){super(e),this.setName("Footer"),this.createContinueButton(),this.createReplayButton(),this.createReturnButton(),this.scene.add.existing(this)}createContinueButton(){this.continueButton=new zc(this.scene,{key:vt,frame:Nt.RESULT_SCREEN_YELLOW_BUTTON,width:129,height:46}),this.continueButton.setName("Continue"),this.add(this.continueButton),this.createContinueWinContainer(),this.createContinueLoseContainer()}createContinueWinContainer(){const e=this.scene.make.container({});e.setSize(this.continueButton.width,this.continueButton.height),this.winContainer=e,this.continueButton.add(this.winContainer);const t=this.scene.lang.getCurrentLanguage();let s=18,i=18,a=-14,r=5;switch(t){case"ja":s=16,i=15,r=3,a=-15;break;case"zh":s=16,a=-12;break}this.getText=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(s)}),this.getText.setText(this.scene.lang.Text.GET),this.getText.setDropShadow(-.5,1.5,0),this.getText.setPosition(0,a),e.add(this.getText);const o=this.scene.make.image({key:vt,frame:Nt.RESULT_SCREEN_SINGLE_COIN_ICON});o.setWorldSize(16,16),e.add(o),o.setPosition(-40,7);const c=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(i)});c.setText("0"),c.setTintText(15650560),c.setDropShadow(-1,1,0),c.setPosition(0,r),e.add(c),this.coinText=c}createContinueLoseContainer(){const e=this.scene.make.container({});e.setSize(this.continueButton.width,this.continueButton.height),this.loseContainer=e,this.continueButton.add(this.loseContainer);const t=this.scene.lang.getCurrentLanguage();let s=20;switch(t){case"pt":s=18;break;case"de":s=18;break}const i=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(s)});i.setText(this.scene.lang.Text.CLAIM),i.setDropShadow(-1,1,0),i.setPosition(0,-5),e.add(i)}createReplayButton(){this.replayButton=new te(this.scene,vt,Nt.RESULT_SCREEN_GREEN_BUTTON,129,46),this.replayButton.setName("BattleReplay");const e=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(15)});e.setText(this.scene.lang.Text.REPLAY),e.setDropShadow(-1,1,0),e.setPosition(15,-5),this.replayButton.add(e);const t=this.scene.make.image({key:vt,frame:Nt.ICON_REPLAY});t.setWorldSize(23.5,27.5),t.setPosition(-40,-3),this.replayButton.add(t),this.replayButton.setX(-70),this.add(this.replayButton)}createReturnButton(){this.returnButton=new te(this.scene,vt,Nt.RESULT_SCREEN_YELLOW_BUTTON,129,46),this.returnButton.setName("BackToSinglePlay");const e=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(15)});e.setText(`      ${this.scene.lang.Text.BACK_TO_SINGLEPLAY}`),e.setDropShadow(-1,1,0),e.setPosition(15,-5),this.returnButton.add(e);const t=this.scene.make.image({key:vt,frame:Nt.ICON_BACK_TO});t.setWorldSize(28.5,20.5),t.setPosition(-45,-2),this.returnButton.add(t),this.returnButton.setX(70),this.add(this.returnButton)}set onClickContinueBtn(e){this.continueButton.onClick=e}set onClickReplayBtn(e){this.replayButton.onClick=e}set onClickReturnBtn(e){this.returnButton.onClick=e}setMode(e,t,s){this.continueButton.setY(0),this.continueButton.setScale(1),this.continueButton.updateScaleDown(),this.replayButton.setPosition(-70,0),this.replayButton.setScale(1),this.returnButton.setPosition(70,0),this.returnButton.setScale(1),e==="BATTLE"?(this.replayButton.revive(),this.returnButton.revive(),this.continueButton.kill()):(this.replayButton.kill(),this.returnButton.kill(),this.continueButton.revive(),s==="win"?(this.winContainer.revive(),this.loseContainer.kill(),this.coinText.setText(t.toString()),this.getText.setText(this.scene.lang.Text.GET)):(this.winContainer.kill(),this.loseContainer.revive(),this.getText.setText(this.scene.lang.Text.CLAIM))),this.mode=e}setCoinText(e){this.winContainer.revive(),this.loseContainer.kill(),this.coinText.setText(e)}runAnimation(e){Pi.Enabled&&this.mode==="BATTLE"&&(this.openAnimation?.stop(),this.openAnimation?.remove(),this.returnButton.setAlpha(0),this.replayButton.setAlpha(0),this.openAnimation=new Zs({targets:[this.replayButton,this.returnButton],delay:e,duration:400,props:{alpha:{from:0,to:1}},onComplete:()=>{this.returnButton.setAlpha(1),this.replayButton.setAlpha(1)}}),this.openAnimation.play())}runPostAnimation(e){if(this.mode==="BATTLE"){this.openAnimation?.stop(),this.openAnimation?.remove(),this.postAdReplayAnimation?.stop(),this.postAdReplayAnimation?.remove(),this.postAdReturnAnimation?.stop(),this.postAdReturnAnimation?.remove(),this.replayButton.setDisabled(!0),this.replayButton.setAlpha(1);const t=this.replayButton.x;this.returnButton.setDisabled(!0),this.returnButton.setAlpha(1);const s=this.returnButton.x;if(!Pi.Enabled){const{scale:i}=this.replayButton,{scale:a}=this.returnButton;this.replayButton.setScale(i*1.2),this.replayButton.setPosition(t-15,-125),this.replayButton.setDisabled(!1),this.returnButton.setScale(a*1.2),this.returnButton.setPosition(s+15,-125),this.returnButton.setDisabled(!1);return}this.postAdReplayAnimation=this.scene.tweens.add({targets:this.replayButton,duration:500,delay:e,y:{from:0,to:-70},x:{from:t,to:t-15},scale:{from:this.replayButton.scale,to:this.replayButton.scale*1.2},ease:Phaser.Math.Easing.Quintic.Out,onComplete:()=>{this.replayButton.setDisabled(!1)}}),this.postAdReturnAnimation=this.scene.tweens.add({targets:this.returnButton,duration:500,delay:e,y:{from:0,to:-70},x:{from:s,to:s+15},scale:{from:this.returnButton.scale,to:this.returnButton.scale*1.2},ease:Phaser.Math.Easing.Quintic.Out,onComplete:()=>{this.returnButton.setDisabled(!1)}})}else{this.postAdContinueAnimation?.stop(),this.postAdContinueAnimation?.remove(),this.continueButton.setDisabled(!0),this.continueButton.setAlpha(1);const{scale:t}=this.continueButton;if(!Pi.Enabled){this.continueButton.setScale(t*1.5),this.continueButton.setPosition(0,-125),this.continueButton.setDisabled(!1);return}this.postAdContinueAnimation=this.scene.tweens.add({targets:this.continueButton,duration:500,delay:e,y:{from:0,to:-70},scale:{from:t,to:t*2},ease:Phaser.Math.Easing.Quintic.Out,onComplete:()=>{this.continueButton.updateScaleDown(),this.continueButton.setDisabled(!1)}})}}}const{KEY:Pr,FRAME:Or}=y.DEFAULT_8_BIT;class ER extends Phaser.GameObjects.Container{wheelArrow;luckSpinMilestones;luckSpinRewards;spinningTween;constructor(e){super(e,0,0),this.createWheelBackground(),this.createWheelArrow(),this.scene.add.existing(this)}createWheelBackground(){const e=this.scene.make.image({key:Pr,frame:Or.WHEEL_LUCKY_SPIN});this.scene.add.existing(e),this.add(e),e.setOrigin(.5,.5),e.setWorldSize(178.5,114.5),e.setY(-34),this.createText("x2",-63,-35),this.createText("x3",-18,-70),this.createText("x4",22,-60),this.createText("x5",45,-27)}createText(e,t,s){const i=this.scene.lang.getCurrentLanguage();let a=22;switch(i){case"ja":a=20;break}const r=this.scene.make.bitmapText({text:e,font:w.PRIMARY.KEY,size:this.scene.fontSize(a)});r.setDropShadow(-1,1),this.add(r),r.setPosition(t,s)}createWheelArrow(){this.wheelArrow=this.scene.make.image({key:Pr,frame:Or.WHEEL_ARROW}),this.wheelArrow.setWorldSize(17,26),this.add(this.wheelArrow),Phaser.Display.Align.In.Center(this.wheelArrow,this,0,-25),this.luckSpinMilestones=[-30,16,59],this.luckSpinRewards=[2,3,4,5]}startWheelSpinning(){this.spinningTween?.stop(),this.spinningTween?.remove();const e=this.scene.screen.get(I.RESULT_SCREEN);e instanceof Xc&&(this.spinningTween=this.scene.tweens.addCounter({from:Phaser.Math.DegToRad(-90),to:Phaser.Math.DegToRad(90),onUpdate:t=>{const s=t.getValue();this.wheelArrow.setRotation(s);const i=Math.sin(s)*29,a=Math.cos(s)*-29;this.wheelArrow.setPosition(i,a),e?.updateCoinText(this.getCurrentMultiplierResult())},yoyo:!0,duration:625,repeat:-1}))}stopWheelSpinning(){this.spinningTween?.stop()}getCurrentMultiplierResult(){for(let e=0;e<this.luckSpinMilestones.length;e++){const t=this.luckSpinMilestones[e];if(this.wheelArrow.angle<=t)return this.luckSpinRewards[e]}return this.luckSpinRewards[this.luckSpinRewards.length-1]}handleOnOpen(){this.startWheelSpinning()}handleOnClose(){this.stopWheelSpinning()}}const{KEY:fR,FRAME:mR}=y.DEFAULT_8_BIT,{KEY:Xt,FRAME:He}=y.DEFAULT_8_BIT,{MULTIPLY_REWARD_BATTLE:AR,MULTIPLY_REWARD_ROUND:SR}=D,{Ads:Oi}=GameCore.Configs;class TR extends GameCore.Screen{baseValue;rewardWheel;coinText;coinIcon;claimCoinText;claimText;resultText;levelCompletedText;ribbon;shineFx;collectButton;footerContainer;openAnimation;postAdCollectAnimation;fxSpinAnimation;fxScaleAnimation;coinTextAnimation;confettiAnimation;adsTimer;isRewardCollected;coinExplodeEffect;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.9),this.setDepth(Be.SCREEN),this.createContent(),this.createEffect()}createEffect(){this.coinExplodeEffect=new SI(this.scene),this.add(this.coinExplodeEffect),this.confettiAnimation=new pR(this.scene),this.confettiAnimation.setDepth(Be.SCREEN+1)}open(e){super.open(e),this.scene.requestBackgroundMaskUpdate(I.RESULT_SCREEN,this.background.alpha);const s=this.getData("coinRewarded");this.baseValue=s,this.updateScreen(),this.collectButton.setDisabled(!1),this.collectButton.setAlpha(1),this.scene.ads.canbeShowRewardAd()?(this.collectButton.setDisabled(!1),this.collectButton.setAlpha(1)):(this.collectButton.setDisabled(!0),this.collectButton.setAlpha(.5)),this.rewardWheel.handleOnOpen(),this.runOpenAnimation()}closeScreen=()=>{this.stopShineFxTween(),this.rewardWheel.stopWheelSpinning(),this.confettiAnimation.killAllParticles();const e=this.getData("result");if(!this.isRewardCollected){const s=this.scene.scene.get(N.GAME_SCENE);s instanceof H&&e==="win"&&s.rewardWinCoin(1)}this.scene.requestBackgroundMaskUpdate(I.RESULT_SCREEN,0),this.scene.screen.close(this.name),this.scene.audio.playSound(G.NEXT_ROUND_EFFECT)};updateScreen(){const e=this.baseValue.toString();this.coinText.setText(`+${e}`),this.isRewardCollected=!1,this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y);const t=this.getData("mode"),s=this.getData("result");if(this.footerContainer.setMode(t,this.baseValue,s),Oi.Enabled||this.footerContainer.runPostAnimation(0),s==="lose")this.resultText.setText(this.scene.lang.Text.FAILED),this.ribbon.setFrame(He.RESULT_SCREEN_RIBBON_LOSE),this.shineFx.setFrame(He.RESULT_SCREEN_FX_LOSE),this.levelCompletedText.setText("");else if(s==="win"){this.runConfetti(),this.resultText.setText(this.scene.lang.Text.VICTORY),this.ribbon.setFrame(He.RESULT_SCREEN_RIBBON_WIN),this.shineFx.setFrame(He.RESULT_SCREEN_FX_WIN);let i=SR;if(this.scene instanceof H){const{gameMode:a}=this.scene;a===V.BATTLE&&(i=AR)}this.levelCompletedText.setText(`${this.scene.lang.Text.LEVEL_COMPLETED_BONUS_X}${i}`)}}runConfetti(){const{displayWidth:e,displayHeight:t}=this.scene.gameZone;this.confettiAnimation.run(0,t,e,t*.75)}handleOnCollect=()=>{this.viewAdsReward()};viewAdsReward=async()=>{let e=null;const{audio:t}=this.scene;try{this.rewardWheel.stopWheelSpinning(),e=this.scene.game.globalScene.time.delayedCall(200,()=>{this.scene.screen.open(I.NOTIFY_SCREEN,{message:this.scene.lang.Text.LOADING,duration:0,loading:!0})}),t.muteAll(),await this.scene.ads.showRewardedVideoAsync(),this.scene.screen.close(I.NOTIFY_SCREEN),this.handleLuckyReward()}catch(s){console.info("🚀 > showInterstitialAdAsync",s),this.handleFailedAdsReward()}finally{this.adsTimer?.destroy(),t.unmuteAll(),this.runPostAdAnimation(),e?.remove(),this.scene.game.globalScene.screen.close(I.NOTIFY_SCREEN),this.scene.ads.preloadRewardedVideoAsync().catch(s=>{})}};handleFailedAdsReward=()=>{this.scene.screen.open(I.CLOSEABLE_NOTIFY_SCREEN,{title:this.scene.lang.Text.DISPLAY_ADS_FAILED,message:this.scene.lang.Text.UNABLE_TO_DISPLAY_ADS,duration:1500,loading:!1})};handleLuckyReward=()=>{this.onWheelEnding()};onWheelEnding=()=>{this.runCoinTextAnimation();const e=this.rewardWheel.getCurrentMultiplierResult(),t=this.getData("result"),s=this.scene.scene.get(N.GAME_SCENE);t==="lose"?s.rewardLostCoin(e):t==="win"&&s.rewardWinCoin(e);const i=this.baseValue.clone();i.multiply(e),this.footerContainer.setCoinText(i.toString()),this.isRewardCollected=!0};createContent(){this.createCollectButton(),this.createFx(),this.createFooter(),this.createLevelCompleteText(),this.createGoldText(),this.createGoldIcon(),this.createEarnText(),this.createRibbon(),this.createRewardWheel()}createCollectButton(){const e=this.scene.lang.getCurrentLanguage();this.collectButton=new te(this.scene,Xt,He.RESULT_SCREEN_GREEN_BUTTON_RESULT,181,71),this.collectButton.setName("ClaimWithAds"),this.add(this.collectButton);let t=30,s=-20,i=-30,a=10;switch(e){case"ru":t=20,s=-17,i=-40;break;case"es":t=21;break;case"pt":t=25;break;case"ja":t=25,s=-22,a=8;break;case"zh":t=25,i=-18,s=-15;break;case"tr":t=22,i=-32;break;case"fr":t=20;break;case"id":t=25;break;case"de":t=18,i=-37;break;case"it":t=23,i=-35;break}const r=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(t),origin:{x:0,y:.5}});r.setText(this.scene.lang.Text.GET+" x5"),r.setDropShadow(-1,1,0),this.claimText=r,this.collectButton.add(r),Phaser.Display.Align.In.Center(r,this.collectButton,i,s);const o=this.scene.make.image({key:fR,frame:mR.ICON_AD});o.setWorldSize(25.5,27),this.collectButton.add(o),Phaser.Display.Align.In.Center(o,this.collectButton,-60,-5);const c=this.scene.make.image({key:Xt,frame:He.RESULT_SCREEN_SINGLE_COIN_ICON});c.setWorldSize(16,16),this.collectButton.add(c),Phaser.Display.Align.In.Center(c,this.collectButton,-15,13),this.claimCoinText=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(17)}),this.claimCoinText.setText("0"),this.claimCoinText.setTintText(14993153),this.claimCoinText.setDropShadow(-1.5,1,0),this.collectButton.add(this.claimCoinText),Phaser.Display.Align.In.Center(this.claimCoinText,this.collectButton,22,a),Phaser.Display.Align.In.Center(this.collectButton,this,0,100),this.collectButton.onClick=this.handleOnCollect,Oi.Enabled||this.collectButton.kill()}createFooter(){this.footerContainer=new gR(this.scene),this.add(this.footerContainer),this.footerContainer.onClickContinueBtn=this.handleClickContinueBtn,this.footerContainer.onClickReplayBtn=this.handleClickReplayBtn,this.footerContainer.onClickReturnBtn=this.handleClickContinueBtn,Phaser.Display.Align.In.Center(this.footerContainer,this.collectButton,0,130)}handleClickContinueBtn=()=>{const e=this.scene.scene.get(N.GAME_SCENE),t=this.getData("result"),s=this.getData("mode");e.events.once(Phaser.Scenes.Events.RESUME,()=>{e instanceof H&&(s===V.NORMAL&&t==="lose"?e.replayRound():e.nextRound())}),this.closeScreen()};handleClickReplayBtn=()=>{const e=this.scene.scene.get(N.GAME_SCENE);e.events.once(Phaser.Scenes.Events.RESUME,()=>{e instanceof H&&e.replayRound()}),this.closeScreen()};createLevelCompleteText(){this.levelCompletedText=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(18)}),this.levelCompletedText.setTintText(15650560),this.levelCompletedText.setDropShadow(-1,1,0),this.add(this.levelCompletedText),Phaser.Display.Align.In.Center(this.levelCompletedText,this,0,-80),this.levelCompletedText.setScale(this.collectButton.scaleX,this.collectButton.scaleY)}createGoldIcon(){this.coinIcon=this.scene.make.image({key:Xt,frame:He.RESULT_SCREEN_GOLD_ICON}),this.coinIcon.setWorldSize(55,39.5),this.add(this.coinIcon),Phaser.Display.Align.In.Center(this.coinIcon,this,this.coinText.displayWidth/2,-120)}createGoldText(){this.coinText=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(32)}),this.coinText.setDropShadow(-1,1,0),this.add(this.coinText),Phaser.Display.Align.In.Center(this.coinText,this,-20,-125)}createEarnText(){const e=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(18)});e.setText(this.scene.lang.Text.YOU_EARNED),e.setDropShadow(-2,1,0),this.add(e),Phaser.Display.Align.In.Center(e,this,0,-180),e.setScale(this.collectButton.scaleX,this.collectButton.scaleY)}createFx(){this.shineFx=this.scene.make.image({key:Xt,frame:He.RESULT_SCREEN_FX_WIN}),this.add(this.shineFx),this.shineFx.setWorldSize(375,407),Phaser.Display.Align.In.Center(this.shineFx,this,0,-120)}createRibbon(){const e=this.scene.lang.getCurrentLanguage();let t=-7;switch(e){case"ja":t=-10;break}this.ribbon=this.scene.make.image({key:Xt,frame:He.RESULT_SCREEN_RIBBON_WIN}),this.add(this.ribbon),this.ribbon.setWorldSize(280,50),Phaser.Display.Align.In.Center(this.ribbon,this,2,-240),this.resultText=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(24)}),this.resultText.setDropShadow(-1,1,0),this.add(this.resultText),Phaser.Display.Align.In.Center(this.resultText,this.ribbon,3,t)}createRewardWheel(){this.rewardWheel=new ER(this.scene),this.add(this.rewardWheel),Phaser.Display.Align.In.Center(this.rewardWheel,this,0,40),Oi.Enabled||this.rewardWheel.kill()}runOpenAnimation(){this.openAnimation?.stop(),this.openAnimation?.remove(),this.collectButton.setAlpha(1);const e=this.list.filter(s=>s!==this.background&&s!==this.footerContainer),t=e.map(s=>s.alpha);e.forEach(s=>s.setAlpha(0)),this.openAnimation=new Zs({targets:e,delay:0,duration:400,props:{alpha:{getStart:()=>0,getEnd:(s,i,a,r)=>t[r]}},onComplete:()=>{this.runShineFxTween()}}),this.footerContainer.runAnimation(2500),this.openAnimation.play()}runShineFxTween(){const e=this.getData("result");this.fxSpinAnimation=this.scene.tweens.add({targets:this.shineFx,duration:e==="win"?2e4:4e4,ease:"Linear",repeat:-1,props:{rotation:{from:Phaser.Math.DegToRad(0),to:Phaser.Math.DegToRad(360)}},onStop:()=>{this.shineFx.rotation=Phaser.Math.DegToRad(0)}});const t=this.shineFx.scaleX,s=this.shineFx.scaleY;this.fxScaleAnimation=this.scene.tweens.add({targets:this.shineFx,duration:2e3,ease:Phaser.Math.Easing.Quadratic.Out,repeat:-1,yoyo:!0,props:{scaleX:{from:t,to:t*1.2},scaleY:{from:s,to:s*1.2}},onStop:()=>{this.shineFx.setScale(t,s)}})}stopShineFxTween(){this.fxSpinAnimation?.stop(),this.fxSpinAnimation?.remove(),this.fxScaleAnimation?.stop(),this.fxScaleAnimation?.remove()}runPostAdAnimation(){this.postAdCollectAnimation?.stop(),this.postAdCollectAnimation?.remove(),this.postAdCollectAnimation=this.scene.tweens.add({targets:this.collectButton,duration:500,alpha:{from:.5,to:0},ease:Phaser.Math.Easing.Quadratic.In}),this.footerContainer.runPostAnimation(500)}runCoinTextAnimation(){this.coinTextAnimation?.stop(),this.coinTextAnimation?.remove();const e=this.rewardWheel.getCurrentMultiplierResult(),t=this.baseValue.clone(),s=this.baseValue.clone();s.multiply(e);const i=s.clone();i.subtract(t),i.divide(10);const a=this.coinText.scaleX,r=this.coinText.scaleY;this.coinExplodeEffect.explode(12,this.coinIcon.x,this.coinIcon.y),this.coinTextAnimation=this.scene.tweens.addCounter({from:1,to:10,duration:150,onRepeat:()=>{t.add(i),this.coinText.setText(`+${t.toString()}`),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y)},onStart:()=>{this.scene.audio.playSound(G.COIN_INCREASE_REPEATEDLY_SOUND),this.coinText.setScale(a*1.1,r*1.1),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y),t.add(i),this.coinText.setText(`+${t.toString()}`),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y)},onComplete:()=>{this.coinText.setScale(a,r),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y)},onStop:()=>{this.coinText.setScale(a,r),this.coinIcon.setPosition(this.coinText.displayWidth/2+10,this.coinIcon.y)},repeat:9})}updateCoinText(e){const t=this.baseValue.clone();t.multiply(e),this.claimCoinText.setText(`${t.toString()}`),this.claimText.setText(`${this.scene.lang.Text.GET} x${e}`)}}const Xc=TR,{KEY:yR,FRAME:CR}=y.DEFAULT,{KEY:Dr,FRAME:vr}=y.DEFAULT_8_BIT;class Nr extends GameCore.Screen{popup;title;confirmBtn;cancelBtn;description;showUpAnimation;contentShowUpAnimation;fadeOutAnimation;constructor(e,t,s,i){super(e,t,s,i),this.scene=e,this.background.setAlpha(.7),this.setSize(this.scene.gameZone.displayWidth,this.scene.gameZone.displayHeight),this.createPopup(),this.createCloseButton(),this.createTitle(),this.createContent()}open(){super.open();const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.listenResizeEventForCalculateLight(this),this.scene.requestBackgroundMaskUpdate(I.START_OVER_POPUP,this.background.alpha),this.runOpenAnimation()}handleClosePopup=()=>{this.runFadeOutAnimation()};createPopup(){this.popup=new Rt(this.scene,{x:0,y:0,width:300,height:200,rightEdge:870778,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-40}),this.add(this.popup)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createCloseButton(){const e=new It(this.scene);e.setName("button"),Phaser.Display.Align.In.TopRight(e,this.popup,10,10),this.popup.add(e),e.onClick=()=>{const t=this.scene.scene.get(N.GAME_SCENE);t instanceof H&&t.stateManager.levelComplete(),this.handleClosePopup()}}createTitle(){const e=this.scene.make.text({text:this.scene.lang.Text.START_OVER_TITLE,style:{fontSize:"22px",stroke:"#000000",strokeThickness:2,color:"#FFFFFF",fixedWidth:325,align:"center",fontFamily:w.FONT_FAMILY}});e.setName("title"),e.setHighQuality(),e.setShadow(-8,8,"#000000",0,!0),this.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-13);const t=this.scene.make.image({key:yR,frame:CR.TITLE_LINE});t.setWorldSize(235,23),this.popup.add(t),Phaser.Display.Align.In.BottomCenter(t,e,0,30),this.title=e}createContent(){this.createDescription(),this.createConfirmButton(),this.createCancelButton()}createDescription(){this.description=this.scene.make.bitmapText({text:this.scene.lang.Text.START_OVER_DESC,font:w.PRIMARY.KEY,size:this.scene.fontSize(17),origin:{x:.5,y:.5}}),this.description.setMaxWidth(275),this.description.setCenterAlign(),this.add(this.description),this.description.setPosition(0,-10)}createConfirmButton(){this.confirmBtn=new te(this.scene,Dr,vr.BUTTON_RED,108,43),this.confirmBtn.setName("confirmBtn");const e=this.scene.lang.getCurrentLanguage();let t=-5;switch(e){case"tr":t=-8;break}const s=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.YES),s.setDropShadow(-1,1.5,0),this.confirmBtn.add(s),s.setPosition(0,t),this.add(this.confirmBtn),Phaser.Display.Align.In.Center(this.confirmBtn,this.popup,-70,60),this.confirmBtn.onClick=()=>{const i=this.scene.scene.get(N.GAME_SCENE);i instanceof H&&i.resetLevel(),this.handleClosePopup()}}createCancelButton(){this.cancelBtn=new te(this.scene,Dr,vr.BUTTON_GREEN,108,43),this.cancelBtn.setName("cancelBtn");const e=this.scene.lang.getCurrentLanguage();let t=-5;switch(e){case"tr":t=-8;break}const s=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.NO),s.setDropShadow(-1,1.5,0),this.cancelBtn.add(s),s.setPosition(0,t),this.add(this.cancelBtn),Phaser.Display.Align.In.Center(this.cancelBtn,this.popup,70,60),this.cancelBtn.onClick=()=>{const i=this.scene.scene.get(N.GAME_SCENE);i instanceof H&&i.stateManager.levelComplete(),this.handleClosePopup()}}runOpenAnimation(){this.runPopupEntrancesAnimation(),this.runPopupContentEntrancesAnimation(100,400)}runPopupEntrancesAnimation(){this.showUpAnimation||(this.showUpAnimation=new We({targets:[this.popup]})),this.showUpAnimation.play()}runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove();const s=[this.title,this.description,this.confirmBtn,this.cancelBtn],i=s.map(a=>a.alpha);this.contentShowUpAnimation=new Wt({targets:s,duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:a=>a.scale-.3,getEnd:a=>a.scale},alpha:{getStart:a=>(a.setAlpha(0),0),getEnd:(a,r,o,c)=>i[c]}}}),this.contentShowUpAnimation.play()}runFadeOutAnimation(){this.fadeOutAnimation||(this.fadeOutAnimation=new ve({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.popup.kill(),this.title.kill(),this.description.kill(),this.confirmBtn.kill(),this.cancelBtn.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(I.START_OVER_POPUP,t.alpha)},onComplete:()=>{this.popup.revive(),this.title.revive(),this.description.revive(),this.confirmBtn.revive(),this.cancelBtn.revive();const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.removeResizeEventForCalculateLight(this),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play()}}const IR=mn(.55,.47,.43,.91),RR={targets:[],yoyo:!0,repeat:-1,duration:600,repeatDelay:50,ease:IR,easeParams:[0,.9],props:{scale:{from:1,to:1.2}}};class Zc extends me{constructor(e){super(RR,e)}}const{KEY:_R,FRAME:br}=y.EFFECTS;class LR extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,_R,br.FX_COMET),this.createEmitZone(),this.createEmitters(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:br.FX_COMET,emitZone:{source:this.emitZone,type:"random"},deathZone:{source:this.emitZone,type:"onLeave"},timeScale:1,frequency:150,speedY:{min:-20,max:-60},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Cubic.Out},lifespan:{min:1500,max:2500}})}run(e,t,s,i,a){this.stop(),this.emitZone.setSize(i,a),this.emitZone.setPosition(t-i/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}}const{KEY:wR,FRAME:Mr}=y.DEFAULT_8_BIT;class PR extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,wR,Mr.UNIT_REWARD_PARTICLE),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Mr.UNIT_REWARD_PARTICLE,emitZone:{source:this.emitZone,type:"random"},timeScale:1,frequency:100,rotate:{min:0,max:90},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Expo.Out},lifespan:{min:3e3,max:4500}})}run(e,t,s,i,a,r=100){this.stop(),this.reset(),this.emitZone.setSize(i,a),this.emitZone.setPosition(t-i/2,s-a/2),this.emitter.setQuantity(e),this.emitter.setFrequency(r),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:OR,FRAME:Ur}=y.DEFAULT_8_BIT;class DR extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,OR,Ur.UNIT_REWARD_ELLIPSE_FX),this.createEmitZone(),this.createEmitters(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:Ur.UNIT_REWARD_ELLIPSE_FX,emitZone:{source:this.emitZone,type:"random"},deathZone:{source:this.emitZone,type:"onLeave"},timeScale:1,frequency:150,speedY:{min:-20,max:-60},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Cubic.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Cubic.Out},lifespan:{min:1500,max:2500}})}run(e,t,s,i,a){this.stop(),this.emitZone.setSize(i,a),this.emitZone.setPosition(t-i/2,s-a/2),this.emitter.setQuantity(e),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}}const{KEY:Di,FRAME:vi}=y.DEFAULT_8_BIT;class vR extends Phaser.GameObjects.Container{giftAdIcon;particleTweens=[];bubbleTwinkleUp;iconAttentionAnimation;constructor(e){super(e),this.createGlow(),this.createFx(),this.createCurrencyIcon(),this.updateSize(),this.createEllipses(),this.createParticles(),this.scene.add.existing(this)}createGlow(){const e=this.scene.make.image({key:Di,frame:vi.UNIT_REWARD_GLOW});e.setWorldSize(372.5,372.5),this.add(e)}createFx(){const e=this.scene.make.image({key:Di,frame:vi.UNIT_REWARD_FX});e.setWorldSize(375,234.5),this.add(e)}createCurrencyIcon(){this.giftAdIcon=this.scene.add.image(0,0,Di,vi.UNIT_REWARD_GIFT_AD),this.giftAdIcon.setWorldSize(168.5,168),this.giftAdIcon.setY(0),this.add(this.giftAdIcon)}updateSize(){const{displayWidth:e,displayHeight:t}=this.giftAdIcon;this.setSize(e,t)}createEllipses(){this.bubbleTwinkleUp=new DR(this.scene),this.bubbleTwinkleUp.setScale(1.5),this.add(this.bubbleTwinkleUp)}createParticles(){for(let e=0;e<4;e++){const t=new PR(this.scene);this.add(t),this.particleTweens.push(t)}}runLogoAttentionAnimation(e){this.iconAttentionAnimation||(this.iconAttentionAnimation=new Zc({targets:[this.giftAdIcon],delay:e,props:{scale:"+=0.05"}})),this.iconAttentionAnimation.play();const{x:t,y:s,width:i,height:a}=this.giftAdIcon;this.bubbleTwinkleUp.run(1,t,s,i,a),this.particleTweens.forEach(r=>{const o=Phaser.Math.Between(1e3,2e3);r.run(1,0,0,i,a,o)})}stopAnimation(){this.particleTweens.forEach(e=>{e.stop()}),this.iconAttentionAnimation.stop()}}const{KEY:kr,FRAME:Br}=y.DEFAULT_8_BIT;class NR extends te{constructor(e){super(e,kr,Br.BUTTON_GREEN_LONG,200,64),this.setName("ViewAd"),this.createIcon(),this.createViewText()}createIcon(){const e=this.scene.add.image(0,0,kr,Br.ICON_AD);e.setWorldSize(43.5,45.5),Phaser.Display.Align.In.Center(e,this,-60,-5),this.add(e)}createViewText(){const e=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(22)});e.setText(this.scene.lang.Text.GET_NOW),e.setDropShadow(-1.5,1.5,0),Phaser.Display.Align.In.Center(e,this,25,-5),this.add(e)}}const{KEY:Ni,FRAME:bi}=y.DEFAULT_8_BIT,{LEVEL_PROGRESS:bR}=ce;class MR extends GameCore.Screen{rewardValue;hand;viewAdButton;skipButton;giftIcon;giftIconWhite;currencyText;giftAdComponent;popupContents;cometTwinkle;starTwinkleUp;sparksExplosive;contentFadeOutAnimation;contentShowUpAnimation;giftEntrancesAnimation;giftAttentionAnimation;giftShakeAnimation;giftOpenAnimation;adsTimer;constructor(e,t,s,i){super(e,t,s,i),this.setDepth(Be.POPUP),this.background.setAlpha(0),this.createViewAdsButton(),this.createSkipButton(),this.createGiftAdIcon(),this.createCurrencyText(),this.createEffects(),this.createGiftIcon(),this.createHand(),this.createContentsGroup()}open=e=>{super.open(e),this.background.setAlpha(0),this.scene.requestBackgroundMaskUpdate(I.UNIT_REWARD_SCREEN,this.background.alpha),this.setRewardValue(e.unitType),this.runOpenAnimation(),this.handleShowRewardedVideoAd()};handleClosePopup=()=>{this.runCloseAnimation()};handleShowRewardedVideoAd=async()=>{let e=null;const{audio:t,game:s}=this.scene;try{this.viewAdButton.setDisabled(!0),e=this.scene.game.globalScene.time.delayedCall(200,()=>{s.globalScene.screen.open(I.NOTIFY_SCREEN,{message:s.lang.Text.LOADING_ADS,duration:0,loading:!0})}),t.muteAll(),await this.scene.ads.showRewardedVideoAsync(),this.background.setAlpha(.8),this.scene.requestBackgroundMaskUpdate(I.UNIT_REWARD_SCREEN,this.background.alpha),this.starTwinkleUp.stop(),this.scene.audio.playSound(G.DAILY_REWARD),this.popupContents.killGroup(),this.runTheGiftEntrancesAnimation(0,1500)}catch(i){if(i instanceof Object&&GameCore.Utils.Object.hasOwn(i,"code")&&i.code==="USER_INPUT"){this.handleClosePopup(),this.showNotifySkipAds();return}this.handleClosePopup(),this.showNotifyNoAds()}finally{this.adsTimer?.destroy(),t.unmuteAll(),e?.remove(),this.scene.game.globalScene.screen.close(I.NOTIFY_SCREEN),this.scene.ads.preloadRewardedVideoAsync().catch(i=>{})}};setTheGiftClickable(e){e?this.giftIcon.setInteractive():this.giftIcon.disableInteractive()}handleTheGiftClick=()=>{this.setTheGiftClickable(!1),this.logButtonEvent("OpenGift"),this.hand.stopAnimation(),this.hand.kill(),this.giftIconWhite.revive(),this.scene.tweens.killTweensOf(this.giftIcon),Phaser.Display.Align.In.Center(this.giftIconWhite,this.giftIcon),this.scene.audio.playSound(G.GIFT_CHARGE),it(50),this.runShakeTheGift(),this.runOpenTheGift()};logButtonEvent(e){const t=this.getScreenName();this.scene.analytics.event(v.BUTTON_CLICK,{button_name:e,screen_name:t})}showNotifyNoAds=e=>{if(e&&e.name!==I.CLOSEABLE_NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(I.CLOSEABLE_NOTIFY_SCREEN,{message:t.lang.Text.NO_ADS_TO_DISPLAY,duration:1500,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.scene.game;e.screen.open(I.CLOSEABLE_NOTIFY_SCREEN,{message:e.lang.Text.SORRY_NO_REWARDS,duration:1500,loading:!1})};runOpenAnimation(){this.revive(),this.hand.stopAnimation(),this.hand.kill(),this.popupContents.reviveGroup(),this.starTwinkleUp.stop(),this.runPopupContentEntrancesAnimation(100,400),this.runLogoAttentionAnimation(500)}runCloseAnimation=()=>{this.runExitsAnimation(0,200)};runPopupContentEntrancesAnimation(e,t){this.contentShowUpAnimation?.remove(),this.contentShowUpAnimation=new Wt({targets:this.popupContents.getChildren(),duration:t,delay:this.scene.tweens.stagger(100,{start:e}),props:{scale:{getStart:s=>s.scale-.3,getEnd:s=>s.scale},alpha:{start:0,from:0,to:1}}}),this.contentShowUpAnimation.play()}runLogoAttentionAnimation(e){const{x:t,y:s,width:i,height:a}=this.giftAdComponent;this.starTwinkleUp.run(1,t,s,i,a),this.giftAdComponent.runLogoAttentionAnimation(e)}runTheGiftEntrancesAnimation(e,t){this.giftIcon.revive(),this.giftIcon.setAlpha(1),Phaser.Display.Align.In.TopRight(this.giftIcon,this.zone),this.giftEntrancesAnimation?.remove();const{x:s,y:i}=this.giftIcon,{x:a,y:r}=this.currencyText,o={x:s,y:i},c={x:a,y:r},l=1/this.scene.world.getPixelRatio();this.giftEntrancesAnimation=new Xi({targets:[this.giftIcon],delay:e,duration:t,curve:[[o.x,o.y],[o.x-80,o.y+80],[c.x,c.y]],props:{scale:{start:l*.5,to:l},angle:{start:20,to:0}},onCurveUpdate:h=>{const p=h.x+Phaser.Math.RND.between(-40,40),g=h.y+Phaser.Math.RND.between(-40,40);this.cometTwinkle.explode(1,p,g)},onComplete:()=>{this.scene.audio.playSound(G.GIFT_REVEAL);const h=1.5;this.starTwinkleUp.setScale(h);const{x:u,y:p,width:g,height:S}=this.giftIcon;this.starTwinkleUp.run(1,u,p,g/h,S/h),this.moveTo(this.starTwinkleUp,this.length-1),this.runTheGiftAttentionAnimation()}}),this.giftEntrancesAnimation.play()}runTheGiftAttentionAnimation(){this.giftAttentionAnimation||(this.giftAttentionAnimation=new Zc({targets:[this.giftIcon],props:{scale:"+=0.05"}})),this.hand.revive(),this.hand.playAnimation(),Phaser.Display.Align.In.Center(this.hand,this.giftIcon,20,20),this.setTheGiftClickable(!0),this.giftAttentionAnimation.play()}runShakeTheGift(){this.giftShakeAnimation||(this.giftShakeAnimation=new Wc({targets:[this.giftIcon,this.giftIconWhite],duration:22})),this.giftShakeAnimation.play()}runOpenTheGift(){if(!this.giftOpenAnimation){const e=1/this.scene.world.getPixelRatio();this.giftOpenAnimation=new Ys({targets:[this.giftIcon,this.giftIconWhite],duration:1500,props:{alpha:0,scale:e},onUpdate:()=>{this.giftIconWhite.setAlpha(1)},onComplete:()=>{this.giftShakeAnimation.stop(),this.giftIcon.kill(),this.giftIconWhite.kill(),this.sparksExplosive.explode(100,this.giftIcon.x,this.giftIcon.y,230),this.scene.audio.playSound(G.GIFT_EXPLODE),this.rewardUnit(),this.scene.time.delayedCall(500,this.runCloseAnimation)}})}this.giftOpenAnimation.play()}rewardUnit(){this.scene.analytics.event(v.EARN_UNIT,{value:`${this.rewardValue.toLowerCase()}-lv${this.getRewardedUnitLevel()}`});const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.spawnUnit(this.rewardValue,!0,this.getRewardedUnitLevel())}getRewardedUnitLevel(){const e=this.scene.player.getCustomData(bR),t=GameCore.Utils.Valid.isNumber(e)?e+1:1,{BUYING_UNIT_LEVEL:s}=D;let i=1;return s.forEach((a,r)=>{a<=t&&(i=r+1)}),i}runExitsAnimation(e,t){this.contentFadeOutAnimation||(this.contentFadeOutAnimation=new ve({targets:this.popupContents.getChildren(),delay:e,duration:t,props:{alpha:{start:.8,to:0}},onComplete:()=>{this.scene.requestBackgroundMaskUpdate(I.UNIT_REWARD_SCREEN,0),this.scene.screen.close(this.name),this.viewAdButton.setDisabled(!1),this.skipButton.setDisabled(!1)}})),this.contentFadeOutAnimation.play()}createHand(){this.hand=new Gc(this.scene),this.add(this.hand)}createContentsGroup(){this.popupContents=this.scene.make.group({}),this.popupContents.addMultiple([this.giftAdComponent,this.currencyText])}createCurrencyText(){this.currencyText=this.scene.make.bitmapText({size:this.scene.fontSize(22),font:w.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.currencyText.setCenterAlign(),this.setRewardValue("MELEE"),this.add(this.currencyText)}setRewardValue(e){this.rewardValue=e,this.currencyText.setText(this.scene.lang.Text.WATCH_A_VIDEO),Phaser.Display.Align.In.BottomCenter(this.currencyText,this.giftAdComponent,0,20)}createViewAdsButton(){this.viewAdButton=new NR(this.scene),this.viewAdButton.onClick=this.handleShowRewardedVideoAd,this.viewAdButton.onDown=()=>{this.skipButton.setDisabled(!0)},this.viewAdButton.onOut=()=>{this.skipButton.setDisabled(!1)},Phaser.Display.Align.In.Center(this.viewAdButton,this.zone,0,100),this.viewAdButton.kill()}createSkipButton(){this.skipButton=new zc(this.scene,{key:Ni,frame:bi.UNIT_REWARD_NO_THANKS_TEXT,width:123.5,height:18.5,paddingZone:50}),this.skipButton.setName("NoThanks"),this.skipButton.onClick=this.handleClosePopup,this.skipButton.onDown=()=>{this.viewAdButton.setDisabled(!0)},this.skipButton.onOut=()=>{this.viewAdButton.setDisabled(!1)},Phaser.Display.Align.In.BottomCenter(this.skipButton,this.viewAdButton,0,80),this.skipButton.kill()}createGiftAdIcon(){this.giftAdComponent=new vR(this.scene),Phaser.Display.Align.In.Center(this.giftAdComponent,this.zone,0,-80),this.add(this.giftAdComponent)}createGiftIcon(){this.giftIconWhite=this.scene.make.image({key:Ni,frame:bi.UNIT_REWARD_GIFT_GLOW,visible:!1}),this.giftIconWhite.setWorldSize(168.5,168),this.giftIconWhite.setDepth(M.PRIORITY),this.add(this.giftIconWhite),this.giftIcon=this.scene.make.image({key:Ni,frame:bi.UNIT_REWARD_GIFT,visible:!1}),this.giftIcon.setInteractive({useHandCursor:!0}),this.giftIcon.setWorldSize(168.5,168),this.giftIcon.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.handleTheGiftClick),this.setTheGiftClickable(!1),this.add(this.giftIcon)}createEffects(){this.cometTwinkle=new Rc(this.scene),this.starTwinkleUp=new LR(this.scene),this.sparksExplosive=new _c(this.scene),this.add([this.cometTwinkle,this.starTwinkleUp,this.sparksExplosive])}}const{KEY:UR,FRAME:xr}=y.EFFECTS;class kR extends Phaser.GameObjects.Particles.ParticleEmitterManager{emitZone;emitter;constructor(e){super(e,UR,xr.FX_STAR_YELLOW),this.createEmitZone(),this.scene.add.existing(this)}createEmitZone(){this.emitZone=new Phaser.Geom.Rectangle}createEmitters(){const e=1/this.scene.world.getPixelRatio();this.emitter=this.createEmitter({on:!1,frame:xr.FX_STAR_YELLOW,emitZone:{source:this.emitZone,type:"random"},timeScale:1,frequency:100,alpha:{start:1,end:0,ease:Phaser.Math.Easing.Expo.Out},scale:{start:e*1,end:0,ease:Phaser.Math.Easing.Expo.Out},lifespan:{min:1500,max:3e3}})}run(e,t,s,i,a,r=100){this.stop(),this.reset(),this.emitZone.setSize(i,a),this.emitZone.setPosition(t-i/2,s-a/2),this.emitter.setQuantity(e),this.emitter.setFrequency(r),this.emitter.start()}stop(){this.emitter?.killAll(),this.emitter?.stop()}reset(){this.createEmitters()}}const{KEY:Mi}=y.UNITS,{KEY:Qe,FRAME:Je}=y.DEFAULT_8_BIT;let BR=class extends Phaser.GameObjects.Container{glow;backEffect;bg;ribbon;healthContainer;healthText;atkContainer;atkText;unitName;unitFrame;particleTween=[];backEffectTween;exitTween;onExitComplete;loading;payload;constructor(e){super(e),this.scene=e,this.setName("UnitCard"),this.createGlow(),this.createBackEffect(),this.createBg(),this.updateSize(),this.createRibbon(),this.createHealthContainer(),this.createAtkContainer(),this.createUnitName(),this.createUnitFrame(),this.createAnimation(),this.scene.add.existing(this)}createGlow(){const e=this.scene.make.image({key:Qe,frame:Je.UNIT_UNLOCK_GLOW});e.setName("glow"),e.setWorldSize(340.5,349.5),this.add(e),this.glow=e}createBackEffect(){const e=new jc(this.scene,{color:234748,width:{min:4,max:8},radius:{min:180,max:170},lineNumber:18});e.setName("backEffect"),e.setPosition(0,0),this.add(e),this.backEffect=e}createBg(){const e=this.scene.make.image({key:Qe,frame:Je.UNIT_UNLOCK_FRAME});e.setName("frame"),e.setWorldSize(207.5,292),this.add(e),this.bg=e}createRibbon(){const e=this.scene.make.image({key:Qe,frame:Je.UNIT_UNLOCK_BG});e.setName("ribbon"),e.setWorldSize(204,34.5),this.add(e),Phaser.Display.Align.In.TopCenter(e,this,-1,-4),this.ribbon=e}updateSize(){const{width:e,height:t}=this.bg;this.setSize(e,t)}createHealthContainer(){this.healthContainer=this.scene.make.container({}),this.healthContainer.setName("healthContainer");const e=this.scene.make.image({key:Qe,frame:Je.UNIT_UNLOCK_BG_1});e.setName("health-bg"),e.setWorldSize(79.5,25),this.healthContainer.setSize(e.width,e.height);const t=this.scene.make.image({key:Qe,frame:Je.UNIT_UNLOCK_ICON_HEART});t.setName("health-icon"),t.setWorldSize(21.5,19),Phaser.Display.Align.In.LeftCenter(t,e,-10);const s=this.scene.make.text({text:"0",style:{fontSize:"22px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:13*22,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(15,0),this.healthText=s,this.healthContainer.add([e,t,s]),this.add(this.healthContainer),Phaser.Display.Align.In.TopLeft(this.healthContainer,this,-15,-8)}createAtkContainer(){this.atkContainer=this.scene.make.container({}),this.atkContainer.setName("atkContainer");const e=this.scene.make.image({key:Qe,frame:Je.UNIT_UNLOCK_BG_1});e.setName("atk-bg"),e.setWorldSize(79.5,25),this.atkContainer.setSize(e.width,e.height);const t=this.scene.make.image({key:Qe,frame:Je.UNIT_UNLOCK_ICON_BATTLE});t.setName("atk-icon"),t.setWorldSize(20.5,18),Phaser.Display.Align.In.LeftCenter(t,e,-10);const s=this.scene.make.text({text:"0",style:{fontSize:"22px",color:"#ffffff",stroke:"#000000",strokeThickness:2,fixedWidth:13*22,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(15,0),this.atkText=s,this.atkContainer.add([e,t,s]),this.add(this.atkContainer),Phaser.Display.Align.In.TopRight(this.atkContainer,this.ribbon,-15,-4)}createUnitName(){const e=this.scene.make.text({text:"Abcdefghjklmnopx",style:{fontSize:"22px",color:"#ffffff",fixedWidth:286,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),this.unitName=e,this.add(e),Phaser.Display.Align.In.BottomCenter(e,this,0,-21)}createUnitFrame(){this.loading=new us(this.scene),this.loading.setY(-10),this.add(this.loading);const e=this.scene.make.image({key:Qe,frame:Je.BLANK});e.setName("unitFrame"),e.setWorldSize(200,200),e.setY(-9),this.add(e),e.kill(),this.unitFrame=e}createAnimation(){for(let e=0;e<4;e++){const t=new kR(this.scene);this.add(t),this.particleTween.push(t)}this.backEffectTween=this.scene.add.tween({paused:!0,targets:this.backEffect,duration:1e6,ease:Phaser.Math.Easing.Linear,repeat:-1,props:{rotation:{start:0,to:180}}})}runAnimation(){this.glow.revive(),this.backEffect.revive();const{width:e,height:t}=this;this.particleTween.forEach(s=>{const i=Phaser.Math.Between(1e3,2e3);s.run(1,0,0,e/2,t/2.5,i)}),this.backEffectTween.resume()}stopAnimation(){this.particleTween.forEach(e=>{e.stop()}),this.backEffectTween.pause()}runExitAnimation(){this.glow.kill(),this.backEffect.kill(),this.createExitAnimation(),this.exitTween.play()}createExitAnimation(){if(this.exitTween)return;const{scale:e,x:t,y:s}=this;let i=t-160.5,a=s-300;const r=this.scene.game.scene.getScene(N.GAME_SCENE);if(r instanceof H){const{x:o,y:c}=r.uiManager.getUnitBtnPos(),{x:l,y:h}=this.parentContainer.getLocalPoint(o,c);i=l,a=h}this.exitTween=this.scene.add.tween({paused:!0,targets:this,duration:800,ease:Phaser.Math.Easing.Cubic.Out,props:{scale:{from:e,to:e/10},x:{delay:600,from:t,to:i},y:{delay:600,from:s,to:a},alpha:{delay:1300,duration:200,from:1,to:0}},onComplete:()=>{this.onExitComplete&&this.onExitComplete(),this.setPosition(t,s),this.setScale(e),this.setAlpha(1)}})}updateInfo(e){this.payload=e;const{name:t,health:s,atk:i,frame:a}=e;this.unitFrame.kill(),this.loading.revive(),this.unitName.setText(t);const r=GameCore.Utils.Number.toAbbreviatedString(s);this.healthText.setText(r);const o=GameCore.Utils.Number.toAbbreviatedString(i);this.atkText.setText(o),this.scene.textures.get(Mi).has(a)?this.setUnitFrame():this.scene.textures.on(Phaser.Textures.Events.ADD,this.handleWaitAddTexture),this.unitFrame.setFrame(a)}handleWaitAddTexture=e=>{e===Mi&&(this.scene.textures.off(Phaser.Textures.Events.ADD,this.handleWaitAddTexture),!(!this.visible&&!this.active)&&this.setUnitFrame())};setUnitFrame(){const{frame:e}=this.payload;this.unitFrame.revive(),this.loading.kill(),this.unitFrame.setTexture(Mi,e),this.unitFrame.setWorldSize(200,200)}};const{FRAME:Fr}=y.UNITS,{KEY:xR,FRAME:FR}=y.DEFAULT_8_BIT;class Gr extends GameCore.Screen{frameBg;popup;title;unitCard;closeBtn;isShowingAdBanner;showPopupAnimation;constructor(e,t,s,i){super(e,t,s,i),this.background.setAlpha(.7),this.setDepth(Be.POPUP),this.createPopup(),this.createUnitCard(),this.createPopupTitle(),this.createPopupAnimation()}createPopup(){this.popup=this.scene.make.container({}),this.add(this.popup),this.popup.setName("popup");const e=new Rt(this.scene,{x:0,y:0,width:307,height:386,rightEdge:292019,topInnerCornerStrokeWidth:2,rightInnerCornerStrokeWidth:3,lightY:-80});e.setName("frame"),this.frameBg=e,this.popup.add(e);const{width:t,height:s}=e;this.popup.setSize(t,s),this.createCloseButton();const i=this.isShowingAdBanner?-50:0;Phaser.Display.Align.In.Center(this.popup,this,0,i)}recalculateLightPosition(){this.frameBg&&this.frameBg.recalculateLightPosition()}createPopupTitle(){const e=this.scene.make.container({});e.setName("title");const t=this.scene.make.image({key:xR,frame:FR.RIBBON_GREEN});t.setWorldSize(239,65),e.add(t);const s=this.scene.make.text({text:this.scene.lang.Text.NEW_CHARACTER,style:{fontSize:"23px",color:"#FFFFFF",fixedWidth:13*23,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(0,-5),e.add(s),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-28),this.add(e),this.title=e}createUnitCard(){this.unitCard=new BR(this.scene),this.add(this.unitCard);const e=this.isShowingAdBanner?-25:25;this.unitCard.setY(e)}updateInfo(){const e=this.scene.scene.get(N.GAME_SCENE);if(!(e instanceof H))return;const{unitManager:t}=e;if(!t)return;const{latestUnitMergePayload:s}=t,{level:i,type:a}=s,r=t.getUnitDataForUnlockingScreen();let o="";if(a===D.MELEE_UNIT_TYPE&&(o=Fr.UNLOCKED.MELEE[i]),a===D.RANGED_UNIT_TYPE&&(o=Fr.UNLOCKED.RANGED[i]),o==="")return;this.unitCard.updateInfo({frame:o,atk:r.damage,health:r.health,name:r.name});const c=this.isShowingAdBanner?-50:0;this.popup.setY(c),Phaser.Display.Align.In.TopCenter(this.title,this.popup,0,-28);const l=this.isShowingAdBanner?-25:25;this.unitCard.setY(l)}createCloseButton(){const e=new It(this.scene);e.setName("Close"),this.popup.add(e),Phaser.Display.Align.In.TopRight(e,this.popup,10,10),e.onClick=this.handleCloseScreen,this.closeBtn=e}open(){super.open(),this.scene.requestBackgroundMaskUpdate(I.UNIT_UNLOCK_SCREEN,this.background.alpha);const t=this.scene.scene.get(N.GAME_SCENE);t instanceof H&&t.screenManager.listenResizeEventForCalculateLight(this),this.isShowingAdBanner=t?t.isBannerAdShowed:!0,this.showPopupAnimation.play(),this.updateInfo(),this.popup.revive(),this.title.revive(),this.background.revive(),this.unitCard.runAnimation()}close(){this.setBlockInputOutsideEnabled(!1),this.visible&&(this.popup.kill(),this.title.kill(),this.background.kill(),this.unitCard.onExitComplete=()=>{const e=this.scene.scene.get(N.GAME_SCENE);e instanceof H&&e.screenManager.removeResizeEventForCalculateLight(this),this.scene.screen.close(this.name),this.scene.scene.resume(N.GAME_SCENE);const t=this.scene.game.scene.getScene(N.GAME_SCENE);t instanceof H&&t.uiManager.runUnitBtnAnim(),this.scene.audio.playSound(G.COIN_SPAWN_SOUND),super.close()},this.unitCard.runExitAnimation(),this.scene.scene.resume(N.GAME_SCENE))}handleCloseScreen=()=>{this.unitCard.stopAnimation(),this.scene.requestBackgroundMaskUpdate(I.UNIT_UNLOCK_SCREEN,0),this.close()};createPopupAnimation(){this.showPopupAnimation=new We({targets:[this.popup,this.title,this.unitCard,this.closeBtn]})}}const{KEY:Hr,FRAME:Yr}=y.DEFAULT_8_BIT;class GR extends $c{numOfCols;colPadding;sliderBg;sliderBar;minSliderY;maxSliderY;constructor(e,t){super(e,t),this.numOfCols=t.numOfCols?t.numOfCols:2,this.colPadding=t.colPadding?t.colPadding:0,this.createSlider(),this.updateConfig(t.listConfigs)}createSlider(){const e=this.scene.make.image({key:Hr,frame:Yr.UNIT_SCREEN_SLIDEBAR_BG});e.setName("sliderBg"),e.setWorldSize(6.5,255),Phaser.Display.Align.In.RightCenter(e,this,-3,5),this.add(e),this.sliderBg=e;const t=this.scene.make.image({key:Hr,frame:Yr.UNIT_SCREEN_BAR});t.setName("sliderBar"),t.setWorldSize(3.5,41.5),Phaser.Display.Align.In.TopCenter(t,this.sliderBg),this.add(t),this.sliderBar=t;const{y:s,displayHeight:i}=this.sliderBg;this.minSliderY=s-i/2+this.sliderBar.displayHeight/2+1.5,this.maxSliderY=this.minSliderY+this.sliderBg.displayHeight-this.sliderBar.displayHeight-1.5}createEvents(){super.createEvents(),this.scene.events.on(Phaser.Scenes.Events.UPDATE,()=>{let e=this.value-this.marginTop;this.value<-this.maxHeight?e=-this.maxHeight:this.value>0&&(e=0),e=-e;const t=e/(this.maxHeight+this.marginTop);this.sliderBar.setY(this.minSliderY+t*(this.maxSliderY-this.minSliderY))})}updateMaxHeight(){const e=Math.ceil(this.listConfigs.length/this.numOfCols);return this.maxHeight=Math.max(e*(this.objHeight+this.padding)-this.padding+this.marginBottom-this.height,0)}addObjectIndex(e,t){for(let s=e;s<=t;s++){const{padding:i,listConfigs:a}=this;if(s>=a.length)return;const r=this.objects.getFirstDead(!0),o=r.height,c=Math.floor(s/this.numOfCols),l=s%this.numOfCols,h=o/2,u=(o+i)*c,p=this.height/2,g=h+u+this.value-p,S=r.width,f=S/2,A=-(this.numOfCols*(S+this.colPadding)-this.colPadding)/2+f+(S+this.colPadding)*l;r.updateInfo(a[s]),r.setPosition(A,g),r.setActive(!0),r.setVisible(!0),this.addAt(r),this.listObjects[s]=r}}getEndObjectIndex(){const{objHeight:e,padding:t,listConfigs:s}=this,i=e+t;return Math.min(this.numOfCols*Math.floor((this.height-this.value)/i)+(this.numOfCols-1),s.length)}updateListConfigMember(e,t,s){for(let a=0;a<this.listObjects.length;a++){const r=this.listConfigs[a],{unitType:o,originData:c,currentAdWatched:l}=r;if(!o||!c||l===void 0)continue;const{level:h}=c;if(h&&o===e&&h===t){r.currentAdWatched=s;break}}if(this.scene.ads.canbeShowRewardAd())return;this.objects.getMatching("active",!0).forEach(a=>{a.disableAds()})}}const{KEY:_s,FRAME:Ls}=y.DEFAULT_8_BIT;class HR extends te{countText;adContainer;btnText;iconAd;iconCoin;constructor(e){super(e,_s,Ls.UNIT_SCREEN_AD_BUTTON,145,41),this.createText(),this.createAdCount()}createText(){const e=this.scene.lang.getCurrentLanguage();let t=-7;switch(e){case"ja":t=-9}const s=new se(this.scene,{font:w.PRIMARY.KEY,size:this.scene.fontSize(20)});s.setText(this.scene.lang.Text.FREE),s.setDropShadow(-1.5,1.5,0),s.setY(t),this.add(s),this.btnText=s}getBtnTextFontSize(e){const t=this.scene.lang.getCurrentLanguage();let s=20;switch(e){case"notAvailable":switch(t){case"pt":s=17;break;case"id":case"ja":s=18;break;case"de":case"it":case"tr":s=16;break}break;case"buy":switch(t){case"ja":s=18;break}break;case"collect":switch(t){case"ja":s=18;break}break;case"watch":switch(t){case"ja":s=18;break}break}return t==="ja"&&(s=16),s}createAdCount(){const e=this.scene.make.container({}),t=this.scene.make.image({key:_s,frame:Ls.UNIT_SCREEN_AD_COUNT_BG});t.setWorldSize(68.5,17.5),e.setSize(68.5,17.5),e.add(t);const s=this.scene.make.image({key:_s,frame:Ls.UNIT_SCREEN_AD_ICON});s.setWorldSize(9,7.5),s.setX(-25),e.add(s),this.iconAd=s;const i=this.scene.make.image({key:_s,frame:Ls.UNIT_SCREEN_COIN_ICON});i.setWorldSize(12,11.5),i.setX(-25),e.add(i),this.iconCoin=i;const a=this.scene.make.bitmapText({font:w.PRIMARY.KEY,size:this.scene.fontSize(10),origin:{x:.5,y:.6}});a.setText("0/999"),e.add(a),this.countText=a,Phaser.Display.Align.In.BottomCenter(e,this),this.add(e),this.adContainer=e}setCountText(e,t){t===0?this.countText.setText(`${e.toString()}`):t===-1?this.countText.setText(""):this.countText.setText(`${e.toString()}/${t}`),t===0?this.setMode("buy"):t===-1?this.setMode("notAvailable"):e>=t?this.setMode("collect"):this.setMode("watch")}setMode(e){e==="watch"?(this.adContainer.revive(),this.iconAd.revive(),this.iconCoin.kill(),this.btnText.setText(this.scene.lang.Text.FREE)):e==="collect"?(this.adContainer.kill(),this.btnText.setText(this.scene.lang.Text.COLLECT)):e==="notAvailable"?(this.adContainer.kill(),this.btnText.setText(this.scene.lang.Text.UNAVAILABLE)):(this.adContainer.revive(),this.iconAd.kill(),this.iconCoin.revive(),this.btnText.setText(this.scene.lang.Text.BUY)),this.btnText.setFontSize(this.getBtnTextFontSize(e))}}const{KEY:Ui,FRAME:Kr}=y.UNITS,{KEY:pt,FRAME:Ye}=y.DEFAULT_8_BIT,{MaximumMeleeLevel:YR,MaximumRangedLevel:KR}=GameCore.Configs.Gameplay,{MELEE_UNIT_TYPE:VR,RANGED_UNIT_TYPE:WR}=D,{Ads:ki}=GameCore.Configs;class $R extends Phaser.GameObjects.Container{background;watchAdButton;titleText;lock;healthContainer;healthText;atkContainer;atkText;unitIcon;payload;loading;constructor(e,t){super(e),this.scene=e,this.createBackground(),this.createWatchAdButton(),this.updateSize(),this.createUnitIcon(),this.createTitleText(),this.createLock(),this.createHealthContainer(),this.createAtkContainer(),t&&this.updateInfo(t),this.scene.add.existing(this)}updateInfo(e){this.payload={isUnlock:!1,isCanBuy:!1,coinNeed:new F(0),...e},this.updateFrame(),this.updateTitle(),this.updateAdButton(),this.updateLock(),this.updateUnitIcon(),this.updateHealthContainer(),this.updateAtkContainer()}disableAds(){const{currentAdWatched:e,targetAdWatched:t}=this.payload;t>0&&e<t&&this.watchAdButton.setDisabled(!0)}runShowUpAnimation(e=0,t=300){const s=e*100;this.runShowPopUpAnimation(s,t),this.runShowItemAnimation(s,t)}runShowPopUpAnimation(e,t){this.scene.tweens.killTweensOf(this),new We({targets:[this],delay:e,duration:t,props:{y:{start:this.y+70,to:this.y}}}).play()}runShowItemAnimation(e,t){const s=[this.background,this.watchAdButton,this.titleText,this.lock,this.healthContainer,this.atkContainer];this.unitIcon.visible&&this.unitIcon.active&&s.push(this.unitIcon);const i=s.map(r=>r.alpha);s.forEach(r=>r.setAlpha(0));const a=s.map(r=>r.scale);this.scene.tweens.killTweensOf(s),this.scene.add.tween({targets:s,duration:t,delay:this.scene.tweens.stagger(50,{start:e+50}),props:{scale:{duration:1e3,getStart:(r,o,c,l)=>a[l]*.8,getEnd:(r,o,c,l)=>a[l],ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45]},alpha:{duration:500,getStart:r=>(r.setAlpha(0),0),getEnd:(r,o,c,l)=>i[l],ease:Phaser.Math.Easing.Cubic.Out}},onStop:()=>{s.forEach((r,o)=>{r.setScale(a[o])})},onComplete:()=>{s.forEach((r,o)=>{r.setScale(a[o])})}})}createBackground(){this.background=this.scene.make.image({key:pt,frame:Ye.UNIT_SCREEN_FRAME_1}),this.background.setWorldSize(145,205),this.background.setY(-20.5),this.add(this.background)}createWatchAdButton(){const e=new HR(this.scene);e.onClick=this.handleClickWatchAd,this.add(e),Phaser.Display.Align.In.BottomCenter(e,this.background,0,41),this.watchAdButton=e,ki.Enabled||e.kill()}handleClickWatchAd=async()=>{const{currentAdWatched:e,targetAdWatched:t,updateDataCallback:s,unitType:i,originData:a,showAdsCallback:r,collectCallback:o}=this.payload,{level:c}=a;if(e>=t){const l=t===0;if(l||this.scene.analytics.event(v.BUTTON_CLICK,{button_name:this.watchAdButton.name,unit:`${i}-lv${c}`,watchCount:e}),!o(i,c,l))return;this.scene.analytics.event(v.EARN_UNIT,{value:`${i}-lv${c}`}),this.payload.currentAdWatched=0,s(i,c,this.payload.currentAdWatched),this.updateAdButton();return}this.scene.analytics.event(v.BUTTON_CLICK,{button_name:this.watchAdButton.name,unit:`${i}-lv${c}`,watchCount:e});try{if(!await r())return}catch{return}this.payload.currentAdWatched++,s(i,c,this.payload.currentAdWatched),this.updateAdButton()};updateSize(){const{width:e,height:t}=this.background;ki.Enabled?this.setSize(e,t+41):this.setSize(e,t+15)}createTitleText(){const e=this.scene.make.text({text:"Locked",style:{fontSize:"15px",color:"#FFFFFF",fixedWidth:195,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});e.setHighQuality(),this.add(e),this.titleText=e}createLock(){const e=this.scene.make.image({key:pt,frame:Ye.UNIT_SCREEN_ICON_LOCK});e.setWorldSize(21,28),this.add(e),this.lock=e}createHealthContainer(){this.healthContainer=this.scene.make.container({});const e=this.scene.make.image({key:pt,frame:Ye.UNIT_SCREEN_BG});e.setWorldSize(56.5,18),this.add(e);const t=this.scene.make.image({key:pt,frame:Ye.UNIT_SCREEN_ICON_HEART});t.setWorldSize(15,13.5),Phaser.Display.Align.In.LeftCenter(t,e,-5);const s=this.scene.make.text({text:"0",style:{fontSize:"13px",color:"#FFFFFF",fixedWidth:13*13,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(10,0),this.healthText=s,this.healthContainer.add([e,t,s]),this.add(this.healthContainer),Phaser.Display.Align.In.TopLeft(this.healthContainer,this.background,-35,-12)}createAtkContainer(){this.atkContainer=this.scene.make.container({});const e=this.scene.make.image({key:pt,frame:Ye.UNIT_SCREEN_BG});this.add(e),e.setWorldSize(56.5,18);const t=this.scene.make.image({key:pt,frame:Ye.UNIT_SCREEN_ICON_BATTLE});t.setWorldSize(14,13),Phaser.Display.Align.In.LeftCenter(t,e,-5);const s=this.scene.make.text({text:"0",style:{fontSize:"13px",color:"#FFFFFF",fixedWidth:13*13,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),s.setPosition(10,0),this.atkText=s,this.atkContainer.add([e,t,s]),this.add(this.atkContainer),Phaser.Display.Align.In.TopRight(this.atkContainer,this.background,-35,-12)}createUnitIcon(){this.loading=new us(this.scene),this.loading.setY(-30),this.add(this.loading);const e=this.scene.make.image({key:pt,frame:Ye.BLANK});e.setWorldSize(142,142),this.add(e),Phaser.Display.Align.In.Center(e,this.background,0,-8),e.kill(),this.unitIcon=e}updateFrame(){const{isUnlock:e}=this.payload;e?(this.background.setFrame(Ye.UNIT_SCREEN_FRAME_1),this.background.setWorldSize(145,205)):(this.background.setFrame(Ye.UNIT_SCREEN_FRAME_LOCKED),this.background.setWorldSize(145,202.5))}updateTitle(){const{isUnlock:e}=this.payload;if(e){const{name:t}=this.payload.originData;this.titleText.setText(t),this.titleText.setColor("#FFFFFF"),this.titleText.setPosition(0,58)}else{let t;this.isUnitComingSoon()?(t="Coming Soon",this.titleText.setPosition(0,58)):(t=this.scene.lang.Text.LOCKED,this.titleText.setPosition(0,58)),this.titleText.setText(t),this.titleText.setColor("#9AACBF")}}isUnitComingSoon(){const{originData:e,unitType:t}=this.payload,{level:s}=e;switch(t){case VR:return s>YR;case WR:return s>KR;default:return!0}}updateAdButton(){if(!ki.Enabled)return;const{isUnlock:e,currentAdWatched:t,targetAdWatched:s,isUnitBoardFull:i,coinNeed:a,isCanBuy:r,unitType:o,originData:c}=this.payload,{level:l}=c;let h=!1;const u=this.scene.scene.get(N.GAME_SCENE);if(u instanceof H&&(h=u.gameMode===V.BATTLE),this.watchAdButton.setDisabled(!1),e)if(this.watchAdButton.setVisible(!0),s===0){const p=GameCore.Utils.String.toCamelCase(o);this.watchAdButton.setName(`Buy${p}Unit`),this.watchAdButton.disableLogEvent(!1),this.watchAdButton.setCountText(a,s),(!r||i||h)&&this.watchAdButton.setDisabled(!0)}else if(s===-1)this.watchAdButton.setName(`NotAvailable${o}${l}Unit`),this.watchAdButton.disableLogEvent(!0),this.watchAdButton.setCountText(0,s),this.watchAdButton.setDisabled(!0);else{let p="BuyUnitByRewardedVideo";t>=s&&(p="CollectUnitByRewardedVideo"),this.watchAdButton.setName(p),this.watchAdButton.disableLogEvent(!0),this.watchAdButton.setCountText(t,s),t>=s&&(i||h)&&this.watchAdButton.setDisabled(!0),t<s&&!this.scene.ads.canbeShowRewardAd()&&this.watchAdButton.setDisabled(!0)}else this.watchAdButton.setVisible(!1)}updateLock(){const{isUnlock:e}=this.payload;e?this.lock.setVisible(!1):(this.isUnitComingSoon()?this.lock.setPosition(-45,53):this.lock.setPosition(-57,25),this.lock.setVisible(!0))}updateUnitIcon(){const e=this.getUnitFrame();e!==""&&(this.scene.textures.get(Ui).has(e)?this.setUnitFrame(e):this.scene.textures.on(Phaser.Textures.Events.ADD,this.handleWaitAddTexture))}getUnitFrame(){const{isUnlock:e,unitType:t}=this.payload,{level:s}=this.payload.originData;let i="UNLOCKED";e||(i="LOCKED");let a="";return t===D.MELEE_UNIT_TYPE&&(a=Kr[i].MELEE[s]),t===D.RANGED_UNIT_TYPE&&(a=Kr[i].RANGED[s]),a}handleWaitAddTexture=e=>{if(e!==Ui||(this.scene.textures.off(Phaser.Textures.Events.ADD,this.handleWaitAddTexture),!this.visible&&!this.active))return;const t=this.getUnitFrame();t!==""&&this.setUnitFrame(t)};setUnitFrame(e){this.unitIcon.revive(),this.loading.kill(),this.unitIcon.setTexture(Ui,e),this.unitIcon.setWorldSize(142,142)}updateHealthContainer(){const{health:e}=this.payload.originData,t=GameCore.Utils.Number.toAbbreviatedString(e);this.healthText.setText(t)}updateAtkContainer(){const{damage:e}=this.payload.originData,t=GameCore.Utils.Number.toAbbreviatedString(e);this.atkText.setText(t)}}const{Ads:jR}=GameCore.Configs;class zR extends Phaser.GameObjects.Container{scroller;constructor(e){super(e),this.createScroller(),this.scene.add.existing(this)}createScroller(){const e=jR.Enabled?10:20;this.scroller=new GR(this.scene,{classType:$R,listConfigs:[],width:332-10,height:423.5-158,padding:10,marginTop:e,marginBottom:10,numOfCols:2,colPadding:5}),this.scroller.setName("scroller"),this.scroller.createMask(),this.scroller.setPosition(0,40),this.add(this.scroller)}updateData(e){e.length<1||(this.scroller.updateConfig(e),this.runAnimations())}updateListConfigMember(e,t,s){this.scroller.updateListConfigMember(e,t,s)}runAnimations(){const e=this.scroller.getChildren();if(e.length<1){const a=this.scene.screen.get(I.UNITS_SCREEN);if(!(a instanceof Qi))return;a.isSwitchable=!0;return}const t=Math.min(e.length,this.scroller.numOfCols*3),s=300;for(let a=0;a<t;a++){const r=e[a];r&&(r.setVisible(!0),r.runShowUpAnimation(a,s))}const i=s+t*100+50*5;this.scene.time.delayedCall(i,()=>{const a=this.scene.screen.get(I.UNITS_SCREEN);a instanceof Qi&&(a.isSwitchable=!0,this.scroller.setEnable(!0))})}}const{KEY:XR,FRAME:ZR}=y.DEFAULT_8_BIT;class Vr extends te{focusFrame;text;constructor(e,t,s,i){super(e,t,s),this.createText(i),this.createFocus()}createText(e){const t=this.scene.make.text({text:e,style:{stroke:"#000000",strokeThickness:2,fontSize:"13px",color:"#FFFFFF",fixedWidth:169,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});t.setHighQuality(),t.setShadow(0,4,"#000000",0,!0),this.add(t),this.text=t}createFocus(){const e=this.scene.make.image({key:XR,frame:ZR.UNIT_SCREEN_TAB_FOCUS});e.setName("focus"),e.setWorldSize(57,3.5),e.setVisible(!1),Phaser.Display.Align.In.Center(e,this,0,this.button.height),e.setPosition(0,13),this.add(e),this.focusFrame=e}turnOnFocus(){this.focusFrame.setVisible(!0),this.text.setColor("#FFFFFF")}turnOffFocus(){this.focusFrame.setVisible(!1),this.text.setColor("#72ABFA")}}const{KEY:Bi,FRAME:xi}=y.DEFAULT_8_BIT;class qR extends Phaser.GameObjects.Container{ribbon;dinosaursBtn;warriorsBtn;constructor(e){super(e),this.createRibbon(),this.createDinosaursBtn(),this.createWarriorsBtn()}selectTabDinosaurs(){this.dinosaursBtn.turnOnFocus(),this.warriorsBtn.turnOffFocus()}selectTabWarriors(){this.dinosaursBtn.turnOffFocus(),this.warriorsBtn.turnOnFocus()}createRibbon(){const e=this.scene.make.image({key:Bi,frame:xi.UNIT_SCREEN_TAB_BG});e.setWorldSize(329,29),e.setName("ribbon"),Phaser.Display.Align.In.Center(e,this),this.add(e),this.ribbon=e}createDinosaursBtn(){const e=new Vr(this.scene,Bi,xi.BLANK,this.scene.lang.Text.DINOSAURS);e.button.setWorldSize(85,29),e.button.setVisible(!1),e.setName("DinosaursTab"),Phaser.Display.Align.In.Center(e,this.ribbon,-100,0),this.add(e),this.dinosaursBtn=e}createWarriorsBtn(){const e=new Vr(this.scene,Bi,xi.BLANK,this.scene.lang.Text.WARRIORS);e.button.setWorldSize(85,29),e.button.setVisible(!1),e.setName("WarriorsTab"),Phaser.Display.Align.In.Center(e,this.ribbon,0,0),this.add(e),this.warriorsBtn=e}}const{KEY:QR,FRAME:JR}=y.DEFAULT;class e_ extends Phaser.GameObjects.Container{popup;tabs;scrollerController;closeBtn;onClose;constructor(e){super(e),this.createPopup(),this.createPopupContents(),this.updateSize(),this.createCloseButton()}updateSize(){const{width:e,height:t}=this.popup;this.setSize(e,t)}createPopup(){this.popup=new Rt(this.scene,{x:0,y:0,width:332,height:399,rightEdge:283798,bottomRightCorner:215172,bottomEdge:76382,mainTopColorGradient:145525,mainBotColorGradient:145525,topInnerCornerStrokeWidth:1.3,rightInnerCornerStrokeWidth:3}),this.popup.turnOffLight(),this.add(this.popup),Phaser.Display.Align.In.Center(this.popup,this)}recalculateLightPosition(){this.popup&&this.popup.recalculateLightPosition()}createPopupContents(){this.createTitle(),this.createScrollerController(),this.createNonInteractiveArea(),this.createTabs()}createTitle(){const e=this.scene.add.container();e.setName("title");const t=this.scene.make.image({key:QR,frame:JR.RIBBON_BLUE});t.setWorldSize(239,67);const s=this.scene.make.text({text:`${this.scene.lang.Text.CHARACTER_LIST}`,style:{fontSize:"21px",color:"#FFFFFF",fixedWidth:13*22,align:"center",fontFamily:w.FONT_FAMILY},origin:{x:.5,y:.5}});s.setHighQuality(),Phaser.Display.Align.In.Center(s,t,0,-10),e.add([t,s]),this.add(e),Phaser.Display.Align.In.TopCenter(e,this.popup,0,-28)}createTabs(){this.tabs=new qR(this.scene),this.tabs.setName("tabs"),this.add(this.tabs),Phaser.Display.Align.In.TopCenter(this.tabs,this.popup,0,-85)}createScrollerController(){this.scrollerController=new zR(this.scene),this.add(this.scrollerController),Phaser.Display.Align.In.Center(this.scrollerController,this.popup)}createNonInteractiveArea(){let e=0;this.scene.world.isLandscape()&&(e=15);const t=40,s=332-10,i=423.5-158,a=this.scrollerController.y+t,r=i+50,o=this.scene.add.zone(0,0,s,r);o.setPosition(0,a-e-(i+(r-i)/2)),o.setInteractive(),this.add(o);const c=this.scene.add.zone(0,0,s,r);c.setPosition(0,a+e+(i+(r-i)/2)),c.setInteractive(),this.add(c)}createCloseButton(){this.closeBtn=new It(this.scene),Phaser.Display.Align.In.TopRight(this.closeBtn,this,10,10),this.add(this.closeBtn),this.closeBtn.onClick=this.handleOnCloseClick}handleOnCloseClick=()=>{this.onClose&&this.onClose()};updateData(e){this.scrollerController.updateData(e)}updateListConfigMember(e,t,s){this.scrollerController.updateListConfigMember(e,t,s)}removeAllBlocks(){this.scrollerController.updateData([])}}const{MELEE_UNLOCKED:t_,RANGED_UNLOCKED:s_,UNIT_SCREEN_AD_WATCHED_COUNT:Wr}=ce,{AD_WATCH_REQUIREMENT:$r}=D,{MaximumMeleeLevel:jr,MaximumRangedLevel:i_}=GameCore.Configs.Gameplay;class n_ extends GameCore.Screen{unitPopup;isSwitchable;showPopupAnimation;fadeOutAnimation;adsTimer;isShowingAds;constructor(e,t,s,i){super(e,t,s,i),this.background.setAlpha(.7),this.setDepth(Be.POPUP),this.createUnitPopup()}open(){super.open(),this.isShowingAds=!1,this.scene.requestBackgroundMaskUpdate(I.UNITS_SCREEN,this.background.alpha),this.runPopupAnimation(),this.isSwitchable=!1,this.selectDinosaursTab()}selectDinosaursTab(){this.unitPopup.tabs.selectTabDinosaurs(),this.unitPopup.removeAllBlocks();const e=this.getDataOf(D.MELEE_UNIT_TYPE);this.unitPopup.updateData(e)}selectWarriorsTab(){this.unitPopup.tabs.selectTabWarriors(),this.unitPopup.removeAllBlocks();const e=this.getDataOf(D.RANGED_UNIT_TYPE);this.unitPopup.updateData(e)}recalculateLightPosition(){this.unitPopup&&this.unitPopup.recalculateLightPosition()}getDataOf(e){const t=[],s=this.scene.scene.get(N.GAME_SCENE),i=this.getAdWatchedCount(e);let a=!0,r=1,o=!1;if(s instanceof H&&(a=!(s.fieldManager.getRemainingAvailablePlacement()>0),r=s.getBuyingUnitLevel(),o=s.tutorialManager.isRunning()),e===D.MELEE_UNIT_TYPE){let c=this.scene.player.getCustomData(t_);(!c||typeof c!="number")&&(c=1);const l=this.scene.coin.getCurrentCoins();let h=new F(0),u=!0;if(s instanceof H){const g=s.unitManager.getPlayerMeleeSpawnedUnitsCount();h=s.coinManager.getUnitPrice(g)}if(l.smallerThan(h)){const g=l.toString(),S=h.toString();g!==S&&(u=!1)}this.scene.cache.json.get("unitData").melee.forEach(g=>{t.push({originData:g,unitType:D.MELEE_UNIT_TYPE,isUnlock:g.level<=c,currentAdWatched:i[g.level-1],targetAdWatched:!o&&g.level>=r?$r[g.level-1]:-1,isUnitBoardFull:a,isCanBuy:g.level===1&&u,coinNeed:h,updateDataCallback:this.updateListConfig,showAdsCallback:this.handleShowRewardedVideoAd,collectCallback:this.handleCollectUnit})})}else if(e===D.RANGED_UNIT_TYPE){let c=this.scene.player.getCustomData(s_);(!c||typeof c!="number")&&(c=1);const l=this.scene.coin.getCurrentCoins();let h=new F(0),u=!0;if(s instanceof H){const g=s.unitManager.getPlayerRangedSpawnedUnitsCount();h=s.coinManager.getUnitPrice(g)}if(l.smallerThan(h)){const g=l.toString(),S=h.toString();g!==S&&(u=!1)}this.scene.cache.json.get("unitData").ranged.forEach(g=>{t.push({originData:g,unitType:D.RANGED_UNIT_TYPE,isUnlock:g.level<=c,currentAdWatched:i[g.level-1],targetAdWatched:!o&&g.level>=r?$r[g.level-1]:-1,isUnitBoardFull:a,isCanBuy:g.level===1&&u,coinNeed:h,updateDataCallback:this.updateListConfig,showAdsCallback:this.handleShowRewardedVideoAd,collectCallback:this.handleCollectUnit})})}else console.error("Unknown type: ",e);return t}getAdWatchedCount(e){const t=this.scene.player.getCustomData(Wr);let s={},i=0;if(e===D.MELEE_UNIT_TYPE)s=t.MELEE,i=jr;else if(e===D.RANGED_UNIT_TYPE)s=t.RANGED,i=i_;else{console.error("Unknown type: ",e);const r=[];for(let o=0;o<i;o++)r.push(0);return r}const a=[];for(const[r,o]of Object.entries(s)){const c=parseInt(r);if(c>i||c<1)break;a[c-1]=o}return a.forEach((r,o)=>{r===void 0&&(console.error("Undefined ad watched count for level: ",o+1),a[o]=0)}),a}createUnitPopup(){this.unitPopup=new e_(this.scene),this.unitPopup.setName("UnitPopup"),this.unitPopup.onClose=this.handleCloseScreen,Phaser.Display.Align.In.Center(this.unitPopup,this,0,-20),this.add(this.unitPopup),this.unitPopup.tabs.dinosaursBtn.onClick=this.handleSelectDinosaursTab,this.unitPopup.tabs.warriorsBtn.onClick=this.handleSelectWarriorsTab}handleSelectDinosaursTab=()=>{this.isSwitchable&&(this.isSwitchable=!1,this.selectDinosaursTab())};handleSelectWarriorsTab=()=>{this.isSwitchable&&(this.isSwitchable=!1,this.selectWarriorsTab())};handleCloseScreen=()=>{this.runFadeOutAnimation()};runPopupAnimation(){this.showPopupAnimation||(this.showPopupAnimation=new We({targets:[this.unitPopup]})),this.showPopupAnimation.play()}runFadeOutAnimation(){this.fadeOutAnimation||(this.fadeOutAnimation=new ve({targets:[this.background],duration:200,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.7,from:.7,to:0}},onActive:()=>{this.unitPopup.kill()},onUpdate:(e,t)=>{this.scene.requestBackgroundMaskUpdate(I.UNITS_SCREEN,t.alpha)},onComplete:()=>{this.unitPopup.revive(),this.background.setAlpha(.7),this.scene.screen.close(this.name)}})),this.fadeOutAnimation.play()}updateListConfig=(e,t,s)=>{let i={MELEE:{},RANGED:{}};try{i=this.mergeAndGetAdWatchedCountConfig(e,t,s)}catch(a){console.error(a)}this.scene.player.setCustomData(Wr,i),this.unitPopup.updateListConfigMember(e,t,s)};mergeAndGetAdWatchedCountConfig(e,t,s){if(t===void 0||s===void 0)return{MELEE:{},RANGED:{}};if(e===D.MELEE_UNIT_TYPE&&t<=jr&&t>0)return{MELEE:{[t]:s},RANGED:{}};if(e===D.RANGED_UNIT_TYPE)return{MELEE:{},RANGED:{[t]:s}};throw Error(`Unknown type in Get Ad Watched Config: ${e}`)}handleShowRewardedVideoAd=async()=>{if(this.isShowingAds)return!1;let e=!1,t=null;const{audio:s,game:i}=this.scene;try{this.isShowingAds=!0,t=i.globalScene.time.delayedCall(200,()=>{i.globalScene.screen.open(I.NOTIFY_SCREEN,{message:i.lang.Text.LOADING_ADS,duration:0,loading:!0})}),s.muteAll(),await this.scene.ads.showRewardedVideoAsync(),i.globalScene.screen.close(I.NOTIFY_SCREEN),this.scene.audio.playSound(G.DAILY_REWARD),e=!0}catch(a){e=!1,console.info("🚀 > showRewardedAdAsync",a),a instanceof Object&&GameCore.Utils.Object.hasOwn(a,"code")&&a.code==="USER_INPUT"?this.showNotifySkipAds():this.showNotifyNoAds()}finally{this.isShowingAds=!1,this.adsTimer?.destroy(),s.unmuteAll(),t?.remove(),i.globalScene.screen.close(I.NOTIFY_SCREEN),this.scene.ads.preloadRewardedVideoAsync().catch(a=>{})}return e};showNotifyNoAds=e=>{if(e&&e.name!==I.CLOSEABLE_NOTIFY_SCREEN)return;const{globalScene:t}=this.scene.game;t.screen.open(I.CLOSEABLE_NOTIFY_SCREEN,{message:t.lang.Text.NO_ADS_TO_DISPLAY,duration:1500,loading:!1})};showNotifySkipAds=()=>{const{globalScene:e}=this.scene.game;e.screen.open(I.CLOSEABLE_NOTIFY_SCREEN,{message:e.lang.Text.SORRY_NO_REWARDS,duration:1500,loading:!1})};handleCollectUnit=(e,t,s=!1)=>{const i=this.scene.scene.get(N.GAME_SCENE);let a=!1;return i instanceof H&&(e===D.MELEE_UNIT_TYPE?a=i.spawnUnit("MELEE",!0,t,s):a=i.spawnUnit("RANGED",!0,t,s)),this.handleCloseScreen(),a}}const Qi=n_;class a_ extends le{scene;isLandscape;constructor(e){super(e),this.scene=e,this.isLandscape=this.scene.world.isLandscape()}start(){this.isRunning()||super.start()}showSettingsScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(I.SETTINGS_SCREEN);t||(t=e.add(I.SETTINGS_SCREEN,qi),this.isLandscape?(t.incY(-10),t.incScale(-.15)):t.incY(-40)),t instanceof qi&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume()}),e.open(I.SETTINGS_SCREEN)};showLeaderboardScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(I.LEADER_BOARD_SCREEN);t||(t=e.add(I.LEADER_BOARD_SCREEN,mr)),t instanceof mr&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume()}),e.open(I.LEADER_BOARD_SCREEN)};showUnitsScreen=()=>{const{effectManger:e,layoutManager:t}=this.scene;e.stopRewardCurveAnimation(),t.objects.showUnitButton.stopAnimation();const{screen:s}=this.scene.game.globalScene;let i=s.get(I.UNITS_SCREEN);i||(i=s.add(I.UNITS_SCREEN,Qi),this.isLandscape&&i.incScale(-.1)),i.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),i.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume()}),s.open(I.UNITS_SCREEN)};showUnitUnlockScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(I.UNIT_UNLOCK_SCREEN);t||(t=e.add(I.UNIT_UNLOCK_SCREEN,Gr),this.isLandscape&&(t.incY(-10),t.incScale(-.1))),t instanceof Gr&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,s=>{s.off(GameCore.Screens.Events.OPEN),this.scene.unitManager.enableDragOnPlayerUnits(),this.scene.scene.resume()}),e.open(I.UNIT_UNLOCK_SCREEN),this.scene.audio.playSound(G.UNIT_UNLOCK)};showResultScreen=(e,t,s)=>{const{screen:i}=this.scene.game.globalScene;let a=i.get(I.RESULT_SCREEN);a||(a=i.add(I.RESULT_SCREEN,Xc),this.isLandscape&&a.incScale(-.18)),a.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),a.once(GameCore.Screens.Events.CLOSE,r=>{r.off(GameCore.Screens.Events.OPEN),this.scene.scene.resume()}),t===V.NORMAL||t===V.BATTLE?i.open(I.RESULT_SCREEN,{result:e,coinRewarded:s,mode:t}):i.open(I.RESULT_SCREEN,{result:e,coinRewarded:s,mode:V.NORMAL})};showOfflineScreen=()=>{const e=this.scene.storage.getState(),t=oA(e);if(t<=-1||cA(e))return;const{screen:i}=this.scene.game.globalScene;let a=i.get(I.OFFLINE_REWARD_SCREEN);a||(a=i.add(I.OFFLINE_REWARD_SCREEN,Cr)),a instanceof Cr&&a.recalculateLightPosition(),a.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),a.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume()}),i.open(I.OFFLINE_REWARD_SCREEN,{rewardValue:t})};showLoadingScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(I.LOADING_SCREEN);t||(t=e.add(I.LOADING_SCREEN,eI)),e.open(I.LOADING_SCREEN)};closeLoadingScreen=()=>{const{globalScene:e}=this.scene.game;e.screen.close(I.LOADING_SCREEN)};showChallengeSplashScreen=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(I.CHALLENGE_SPLASH_SCREEN);t||(t=e.add(I.CHALLENGE_SPLASH_SCREEN,vC)),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,()=>{this.scene.scene.resume(),this.scene.audio.setMusicVolume(.4,2e3)}),e.open(I.CHALLENGE_SPLASH_SCREEN)};showUnitRewardScreen=e=>{const{screen:t}=this.scene.game.globalScene;this.scene.effectManger.stopRewardCurveAnimation();let s=t.get(I.UNIT_REWARD_SCREEN);s||(s=t.add(I.UNIT_REWARD_SCREEN,MR)),s.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),s.once(GameCore.Screens.Events.CLOSE,i=>{i.off(GameCore.Screens.Events.OPEN),this.scene.scene.resume()}),t.open(I.UNIT_REWARD_SCREEN,{unitType:e})};showResetDataPopup=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(I.RESET_DATA_SCREEN);t||(t=e.add(I.RESET_DATA_SCREEN,Lr)),t instanceof Lr&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,s=>{s.off(GameCore.Screens.Events.OPEN),this.scene.scene.resume()}),e.open(I.RESET_DATA_SCREEN)};showStartOverPopup=()=>{const{screen:e}=this.scene.game.globalScene;let t=e.get(I.START_OVER_POPUP);t||(t=e.add(I.START_OVER_POPUP,Nr)),t instanceof Nr&&t.recalculateLightPosition(),t.once(GameCore.Screens.Events.OPEN,()=>{this.scene.scene.pause()}),t.once(GameCore.Screens.Events.CLOSE,s=>{s.off(GameCore.Screens.Events.OPEN),this.scene.scene.resume()}),e.open(I.START_OVER_POPUP)};listenResizeEventForCalculateLight(e){window.addEventListener("resize",this.updateLightPosition(e))}removeResizeEventForCalculateLight(e){window.removeEventListener("resize",this.updateLightPosition(e))}timeOutEvent;updateLightPosition=e=>()=>{this.timeOutEvent&&clearTimeout(this.timeOutEvent),this.timeOutEvent=setTimeout(()=>{e.recalculateLightPosition()},500)}}const{LEVEL_PROGRESS:r_}=ce,{DelayFinishGame:o_}=GameCore.Configs.Gameplay;class c_ extends Hc{uiManager;unitManager;coinManager;fieldManager;levelManager;powerManager;stateManager;spineManager;effectManger;layoutManager;screenManager;devToolManager;tutorialManager;animationManager;difficultyManager;accessibilityManager;gameMode;levelStartAt;levelEndAt;isBannerAdShowed;isStartOverPopupShowed;preload(){this.events.on(Phaser.Scenes.Events.WAKE,this.run),this.events.on(Phaser.Scenes.Events.CREATE,this.run),this.events.on(Phaser.Scenes.Events.SLEEP,this.quit),this.events.on(Phaser.Scenes.Events.PAUSE,this.handlePauseScene),this.events.on(Phaser.Scenes.Events.RESUME,this.handleResumeScene)}handlePauseScene=()=>{this.unitManager.hideAllUnits(),this.unitManager.hideAllProjectiles(),this.spineManager.hideAllSpines(),this.effectManger.hideAllTextEffects()};handleResumeScene=()=>{this.stateManager.isInLevelLoadingState()||this.unitManager.showAllAliveUnits(),this.stateManager.isInPlayingState()&&this.unitManager.showAllHpBarUnits(),this.unitManager.showAllProjectiles(),this.spineManager.showAllSpines(),this.effectManger.showAllTextEffects(),this.powerManager.syncSpeedSetting()};create(){super.create(),this.createManager(),this.addGlobalMethodsForGlance(),this.levelStartAt=0,this.levelEndAt=0,this.isBannerAdShowed=!1,this.isStartOverPopupShowed=!1,this.facebook.attemptToAddShortcut()}addGlobalMethodsForGlance=()=>{window.pauseEvent=()=>{this.game.globalScene.screen.get(I.SETTINGS_SCREEN)?.visible||this.screenManager.showSettingsScreen()};const e=()=>{for(const t of Object.values(I)){const s=this.game.globalScene.screen.get(t);s&&s.visible&&this.game.globalScene.screen.close(t)}};window.resumeEvent=()=>{e()},window.replayGameEvent=async()=>{e();const t=this.levelManager.currentLevelId;this.selectLevel(t)},window.enableSound=t=>{this.player.setSetting("sound",t),this.player.setSetting("music",t),t?this.audio.playMusic():this.audio.pauseMusic()},window.gotoLevel=t=>{t<1||(e(),this.time.delayedCall(100,()=>{this.selectLevel(t)}))},window.nextLevelEvent=()=>{e(),this.stateManager.changeStateTo(new fn(this))},window.gotoHomeEvent=()=>{e()}};createManager(){this.layoutManager=new CC(this),this.coinManager=new xm(this),this.unitManager=new VT(this),this.levelManager=new Zm(this),this.fieldManager=new zm(this),this.powerManager=new Jm(this),this.stateManager=new AA(this),this.spineManager=new eA(this),this.effectManger=new Wm(this),this.screenManager=new a_(this),this.devToolManager=new RC(this),this.tutorialManager=new Ny(this),this.animationManager=new bm(this),this.difficultyManager=new Fm(this),this.accessibilityManager=new HE(this),this.uiManager=new yA(this)}initManager(){this.uiManager.init(),this.unitManager.init(),this.coinManager.init(),this.levelManager.init(),this.fieldManager.init(),this.spineManager.init(),this.effectManger.init(),this.powerManager.init(),this.screenManager.init(),this.devToolManager.init(),this.tutorialManager.init(),this.difficultyManager.init(),this.accessibilityManager.init(),this.layoutManager.init()}startManager(){this.coinManager.start(),this.unitManager.start(),this.levelManager.start(),this.fieldManager.start(),this.effectManger.start(),this.powerManager.start(),this.screenManager.start(),this.devToolManager.start(),this.tutorialManager.start(),this.difficultyManager.start(),this.accessibilityManager.start(),this.uiManager.start(),this.layoutManager.start()}stopManager(){this.uiManager.stop(),this.levelManager.stop(),this.coinManager.stop(),this.fieldManager.stop(),this.unitManager.stop(),this.spineManager.stop(),this.effectManger.stop(),this.powerManager.stop(),this.screenManager.stop(),this.devToolManager.stop(),this.tutorialManager.stop(),this.difficultyManager.stop(),this.accessibilityManager.stop(),this.layoutManager.stop()}handleSpawnRanged=()=>{if(!this.stateManager.isInReadyState())return;const e=this.coin.getCurrentCoins();if(!(e instanceof F))return;const t=this.unitManager.getPlayerRangedSpawnedUnitsCount();let s=this.coinManager.getUnitPrice(t);console.log("🤖 ? rangedPrice",s);const i=this.getBuyingUnitLevel();if(e.smallerThan(s)){const r=e.toString(),o=s.toString();if(r!==o){this.screenManager.showUnitRewardScreen("RANGED"),this.audio.playSound(G.BUTTON_CLICK);return}s=e}const a=this.fieldManager.getAvailablePlacement();a&&(this.coin.minusCoins(s.baseValue,s.suffix),this.unitManager.createPlayerArcher(a.rowId,a.colId,i),this.fieldManager.getRemainingAvailablePlacement()===0&&this.effectManger.playFullFloatText(),this.updateUI(),this.unitManager.savePlayerUnits(),this.audio.playSound(G.BUTTON_CLICK))};handleSpawnMelee=()=>{if(!this.stateManager.isInReadyState())return;const e=this.unitManager.getPlayerMeleeSpawnedUnitsCount();let t=this.coinManager.getUnitPrice(e);console.log("🤖 ? meleePrice",t);const s=this.getBuyingUnitLevel(),i=this.coin.getCurrentCoins();if(!(i instanceof F))return;if(i.smallerThan(t)){const r=i.toString(),o=t.toString();if(r!==o){this.screenManager.showUnitRewardScreen("MELEE"),this.audio.playSound(G.BUTTON_CLICK);return}t=i}const a=this.fieldManager.getAvailablePlacement();a&&(this.coin.minusCoins(t.baseValue,t.suffix),this.unitManager.createPlayerMelee(a.rowId,a.colId,s),this.fieldManager.getRemainingAvailablePlacement()===0&&this.effectManger.playFullFloatText(),this.updateUI(),this.unitManager.savePlayerUnits(),this.audio.playSound(G.BUTTON_CLICK))};spawnUnit(e,t=!0,s=1,i=!1){if(!this.stateManager.isInReadyState())return!1;const a=this.fieldManager.getAvailablePlacement();if(!a)return!1;if(i){const o=this.coin.getCurrentCoins();if(!(o instanceof F))return!1;let c=0;e==="MELEE"?c=this.unitManager.getPlayerMeleeSpawnedUnitsCount():c=this.unitManager.getPlayerRangedSpawnedUnitsCount();let l=this.coinManager.getUnitPrice(c);if(console.log(`🤖 ? ${e} unit price`,l),o.smallerThan(l)){const h=o.toString(),u=l.toString();if(h!==u)return!1;l=o}this.coin.minusCoins(l.baseValue,l.suffix)}let r;return t?(e=="MELEE"?r=this.uiManager.getMeleeBlockWorldPosition():r=this.uiManager.getRangedBlockWorldPosition(),this.effectManger.runCurveAnimationRewardUnit(r.x,r.y,a,e,s)):e=="MELEE"?this.unitManager.createPlayerMelee(a.rowId,a.colId,s):this.unitManager.createPlayerArcher(a.rowId,a.colId,s),this.updateUI(),this.unitManager.savePlayerUnits(),!0}getBuyingUnitLevel(){const{currentLevelId:e}=this.levelManager,{BUYING_UNIT_LEVEL:t}=D;let s=1;return t.forEach((i,a)=>{i<=e&&(s=a+1)}),s}giveEnoughCoins(e){let t=0,s;e=="MELEE"?(t=this.unitManager.getPlayerMeleeSpawnedUnitsCount(),s=this.coinManager.getUnitPrice(t)):(t=this.unitManager.getPlayerRangedSpawnedUnitsCount(),s=this.coinManager.getUnitPrice(t));const i=this.coin.getCurrentCoins();i instanceof F&&i.smallerThan(s)&&(s.subtract(i),this.coin.plusCoins(s.baseValue,s.suffix))}updateUI(){this.uiManager.updateUIData(),this.fieldManager.getRemainingAvailablePlacement()===0&&(this.uiManager.disableUnitBlocks(),this.uiManager.disableAdsUnitBlocks()),this.uiManager.isStartButtonDisabled()&&this.uiManager.enableStartButton()}run=()=>{this.stateManager.init()};quit=()=>{this.stateManager.quit()};prepareRound=()=>{this.levelStartAt=Date.now(),this.gameMode===V.NORMAL&&this.time.delayedCall(1e3,this.screenManager.showOfflineScreen),this.stateManager.ready()};restartScene=()=>{this.stateManager.init()};startRound=()=>{this.stateManager.play(),this.audio.playSound(G.START_BATTLE)};replayRound=async()=>{if(this.unitManager.hideAllUnits(),this.gameMode===V.BATTLE){const e=this.game.battle.getReplayOpponentId();if(!e){this.stateManager.levelLoading();return}await this.game.battle.createBattle(e),this.layoutManager.objects.freeCoinsItem.revive();return}else this.layoutManager.objects.freeCoinsItem.revive(),this.stateManager.ready()};nextRound=()=>{this.unitManager.hideAllUnits(),this.stateManager.levelLoading()};gameOver(e){this.unitManager.setReadyAllUnits(),this.levelEndAt=Date.now(),e==="win"?this.handleStartOverFlow():this.stateManager.levelFail()}handleStartOverFlow(){this.levelManager.currentLevelId>=1598&&this.gameMode===V.NORMAL&&!this.isStartOverPopupShowed?(this.audio.playSound(G.WIN_BATTLE),this.effectManger.playResultWinAnimation(),this.isStartOverPopupShowed=!0,this.time.delayedCall(o_,this.screenManager.showStartOverPopup)):this.stateManager.levelComplete()}rewardLostCoin(e){const t=this.coinManager.getTotalCoinsByAttack();t.multiply(e),console.log("🤖 ? rewardLostCoin",t,{rewardCoins:t,multiply:e}),this.coin.plusCoins(t.baseValue,t.suffix)}rewardWinCoin(e){const t=this.coinManager.getRewardCoinsByAttackCoins();t.multiply(e),console.log("🤖 ? rewardWinCoin",t,{rewardCoins:t,multiply:e}),this.coin.plusCoins(t.baseValue,t.suffix)}updateLevelToLeaderboard(e){const{dispatch:t}=this.storage,s=this.player.getCustomData("playerLevelProgress"),i=this.player.getCustomData("playerUnitData");t(Iy(e,{playerLevel:s,playerUnitData:i}))}update(){this.stateManager.update()}resetLevel=async()=>{const e=new nn({}).toObject(),{coins:t,gameData:s}=e;await this.player.setMultiCustomData({coinBaseValue:t.baseValue,coinSuffixValue:t.suffix,playerUnitData:s.playerUnitData,playerLevelProgress:s.playerLevelProgress,meleeUnlockedUnitLevel:s.meleeUnlockedUnitLevel,rangedUnlockedUnitLevel:s.rangedUnlockedUnitLevel}),this.coin.receiveCoins(t.baseValue,t.suffix),this.coinManager.initModifier(),this.difficultyManager.intData(),this.levelManager.setCurrentLevelId(1),this.tutorialManager.initTutorialData(),this.resetGameplay()};selectLevel=e=>{this.player.setCustomData(r_,e-1),this.coinManager.initModifier(),this.difficultyManager.intData(),this.levelManager.setCurrentLevelId(e-1),this.resetGameplay()};resetGameplay(){this.unitManager.initSpawnPools(),this.unitManager.emptyPlayerUnits(),this.uiManager.updateUIData(),this.stateManager.quit(),this.stateManager.levelLoading()}initGameMode(){this.gameMode=V.NORMAL,this.battle.getStatus()===Ve.STARTED&&(this.gameMode=V.BATTLE),console.log("🤖 ? initGameMode",this.gameMode)}updateUnitData=os(()=>{this.player.setMultiCustomData({playerUnitData:this.unitManager.serializePlayerUnitData()})},2e3);async isChallengeMode(){try{const e=this.storage.getState(),t=Mg(e);return console.info("🚀 > isRequestingDetectGameMode",t),t?(await this.storage.dispatch(await Sc()),this.isContextChallenge()):!1}catch(e){console.warn("isChallengeMode",e)}return!1}isContextChallenge(){try{const e=this.storage.getState();return gn(e)===Ut}catch(e){return console.warn(e),!1}}getPlayedTimeSeconds(){return Math.floor((this.levelEndAt-this.levelStartAt)/1e3)}}const H=c_,zr=(n,e,t)=>{if(e&&t){const a=window.game.globalScene.children.getAll();let r=!0;if(a.forEach(o=>{!(o instanceof GameCore.Screen)||o===t||o.visible&&(r=!1)}),!r)return}const s=document.getElementById("background-mask");s&&(s.style.backgroundColor=`rgba(0, 0, 0, ${n})`)};class l_{backgroundAlphaList;constructor(){this.backgroundAlphaList=[]}requestBackgroundMaskUpdate(e,t){const s=this.backgroundAlphaList.findIndex(i=>i.screenName===e);if(e===I.CHALLENGE_SPLASH_SCREEN){const i=this.backgroundAlphaList.find(a=>a.screenName===I.LOADING_SCREEN);if(i&&i.alpha!==0){this.handleChallengeSplashScreenCase();return}}s===-1?this.backgroundAlphaList.push({alpha:t,screenName:e}):this.backgroundAlphaList[s].alpha=t,this.updateBackgroundMask()}handleChallengeSplashScreenCase(){const e=this.backgroundAlphaList.findIndex(s=>s.screenName===I.CHALLENGE_SPLASH_SCREEN),t=this.backgroundAlphaList.find(s=>s.screenName===I.LOADING_SCREEN);t&&t.alpha!==0&&(e===-1?this.backgroundAlphaList.push({alpha:0,screenName:I.CHALLENGE_SPLASH_SCREEN}):this.backgroundAlphaList[e].alpha=0)}updateBackgroundMask(){if(this.backgroundAlphaList.length===0){zr(0);return}let e=1;this.backgroundAlphaList.forEach(t=>{e*=1-t.alpha}),zr(1-e)}}const qc=n=>({type:Lo,payload:{sceneKey:n}}),h_=n=>n.scene.currentSceneKey,u_=k([h_],n=>n),{KEY:d_,FRAME:p_}=y.DEFAULT;class g_ extends Phaser.GameObjects.Container{fps=0;fpsString="FPS: %1";fpsText;background;lastUpdate;constructor(e){super(e,0,0),this.createFps(),this.setDepth(M.DEBUG),this.scene.add.existing(this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=e=>{if(e-this.lastUpdate<800)return;this.lastUpdate=e;const t=Math.floor(this.scene.game.loop.actualFps);this.setFps(t)};setFps(e){this.fps=e;const t=Phaser.Utils.String.Format(this.fpsString,[e]);this.fpsText.setText(t)}createFps(){this.background=this.scene.make.image({key:d_,frame:p_.BLANK}),this.background.setName("BG"),this.background.setTint(13801480),this.background.setWorldSize(65,20),this.fpsText=this.scene.make.bitmapText({size:this.scene.fontSize(14),text:this.fpsString,font:w.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.fpsText.setName("FPS Meter"),Phaser.Display.Align.In.Center(this.fpsText,this.background,5,-1),this.add([this.background,this.fpsText]),this.setFps(0)}}class E_ extends Phaser.GameObjects.Container{performance;memory=0;maxMemoryLimit;maxPercentThreshold;normalColor=3459162;warningColor=16768343;alarmColor=15812200;memoryString="Memory: %1MB / %2MB";memoryText;lastUpdate;constructor(e){if(super(e,0,0),this.performance=window.performance,this.createMemory(),this.setDepth(M.DEBUG),this.scene.add.existing(this),!this.isSupport()){this.memoryText.setText("Memory: not supported!");return}const{jsHeapSizeLimit:t}=this.performance.memory;this.maxPercentThreshold=90,this.setMaxMemory(t/1048576),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update)}update=e=>{if(e-this.lastUpdate<1e3)return;this.lastUpdate=e;const{usedJSHeapSize:t}=this.performance.memory,s=this.maxMemoryLimit*1048576,i=Math.round(t/1048576);this.setMemory(i),this.memoryText.setTint(this.normalColor),t>this.maxPercentThreshold/100*s&&this.memoryText.setTint(this.warningColor),t>s&&this.memoryText.setTint(this.alarmColor)};isSupport(){return this.performance&&!!this.performance?.memory}setMaxMemory(e){this.maxMemoryLimit=Math.round(e)}setMemory(e){this.memory=e;const t=Phaser.Utils.String.Format(this.memoryString,[e,this.maxMemoryLimit]);this.memoryText.setText(t)}createMemory(){this.memoryText=this.scene.make.bitmapText({size:this.scene.fontSize(14),text:this.memoryString,font:w.PRIMARY.KEY,depth:2e3}),this.memoryText.setName("Memory Meter"),this.add(this.memoryText),this.setMemory(0)}}class f_ extends Phaser.GameObjects.Container{payload;background;shadow;constructor(e,t){super(e),this.payload=t,this.createBackground(),this.createShadow()}createBackground(){const{width:e,height:t}=this.payload,s=-e/2,i=-t/2;this.background=this.scene.add.graphics(),this.background.fillStyle(657688,1),this.background.fillRect(s,i,e,t),this.background.lineStyle(2,65794),this.background.strokeRect(s,i,e,t),this.add(this.background)}createShadow(){const{width:e,height:t}=this.payload,s=-e/2,i=-t/2+t;this.shadow=this.scene.add.graphics(),this.shadow.fillStyle(397608,.8),this.shadow.fillRect(s,i,e,5),this.add(this.shadow)}}const{KEY:m_,FRAME:A_}=y.DEFAULT_8_BIT;class Qc extends GameCore.Screen{board;notifyIcon;loadingIcon;titleText;messageText;openAnimation;closeTimerEvent;constructor(e,t,s,i){super(e,t,s,i),this.addBoard(),this.addNotifyIcon(),this.addLoadingIcon(),this.addTitleText(),this.addMessageText(),this.setDepth(Be.PRIORITY),this.background.setAlpha(.8)}open(e){super.open(e),this.scene.requestBackgroundMaskUpdate(I.NOTIFY_SCREEN,this.background.alpha);const[s="",i="",a=0,r=!1]=this.getData(["title","message","duration","loading"]);this.setTitle(s),this.setMessage(i),this.showLoading(r),this.closeTimerEvent?.remove(),a>0&&(this.closeTimerEvent=this.scene.time.addEvent({delay:a,callback:()=>{this.visible&&this.scene.screen.close(this.name)}})),this.runOpenAnimation()}addBoard(){this.board=new f_(this.scene,{width:this.zone.width,height:300}),Phaser.Display.Align.In.Center(this.board,this.zone),this.add(this.board),this.board.kill()}close(){super.close(),this.scene.requestBackgroundMaskUpdate(I.NOTIFY_SCREEN,0)}addNotifyIcon(){this.notifyIcon=this.scene.make.image({key:m_,frame:A_.ICON_ALERT}),this.notifyIcon.setWorldSize(125.5,106),this.add(this.notifyIcon),Phaser.Display.Align.In.Center(this.notifyIcon,this.zone,0,-90)}addLoadingIcon(){this.loadingIcon=new us(this.scene),this.add(this.loadingIcon),Phaser.Display.Align.In.Center(this.loadingIcon,this.zone,0,-30)}addTitleText(){this.titleText=this.scene.make.bitmapText({size:this.scene.fontSize(26),font:w.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.titleText.setTint(11482972),this.titleText.setCenterAlign(),this.titleText.setMaxWidth(this.width),Phaser.Display.Align.In.Center(this.titleText,this.zone,0,10),this.add(this.titleText)}addMessageText(){this.messageText=this.scene.make.bitmapText({size:this.scene.fontSize(22),font:w.PRIMARY.KEY,origin:{x:.5,y:.5}}),this.messageText.setCenterAlign(),Phaser.Display.Align.In.Center(this.messageText,this.zone,0,90),this.add(this.messageText)}setTitle(e){this.titleText.setText(e)}setMessage(e){this.messageText.setText(e)}showLoading(e){this.titleText.setVisible(!e),this.notifyIcon.setVisible(!e),this.loadingIcon.setVisible(e)}runOpenAnimation(){this.openAnimation?.stop(),this.openAnimation?.remove(),this.openAnimation=new Wt({targets:[this.notifyIcon],props:{scale:{getStart:e=>e.scale-.3,getEnd:e=>e.scale}}}),this.openAnimation.play()}logPageviewOnOpen(){}logPageviewOnClose(){}}class S_ extends Qc{constructor(e,t,s,i){super(e,t,s,i)}open(e){super.open(e),this.scene.requestBackgroundMaskUpdate(I.CLOSEABLE_NOTIFY_SCREEN,this.background.alpha),this.addOneTimeCloseEvent()}addOneTimeCloseEvent(){this.scene.input.once(Phaser.Input.Events.POINTER_DOWN,()=>{this.scene.screen.close(this.name)})}close(){super.close(),this.scene.requestBackgroundMaskUpdate(I.CLOSEABLE_NOTIFY_SCREEN,0),this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,void 0,this,!0)}}const{KEY:T_,FRAME:y_}=y.DEFAULT_8_BIT;class Tn extends Hc{mask;fadeInAnim;fadeOutAnim;fpsMeter;memoryMeter;backgroundMaskManager;init(){this.listenScenesEvents(),this.game.globalScene=this,this.backgroundMaskManager=new l_}setup(){this.scaleGame(),this.addMask(),this.addNotifyScreen(),this.addCloseableNotifyScreen(),this.addFPS(),this.addMemory()}addNotifyScreen(){this.screen.add(I.NOTIFY_SCREEN,Qc)}addCloseableNotifyScreen(){this.screen.add(I.CLOSEABLE_NOTIFY_SCREEN,S_)}addMask(){this.mask=this.make.image({key:T_,frame:y_.BLANK});const{width:e,height:t}=this.gameZone;this.mask.setAlpha(0),this.mask.setOrigin(0,0),this.mask.setTint(0),this.mask.setWorldSize(e,t)}addFPS(){const{ShowFPSInGame:e}=GameCore.Configs.Statistics;e&&(this.fpsMeter=new g_(this),this.fpsMeter.setDepth(M.ON_TOP),Phaser.Display.Align.In.TopLeft(this.fpsMeter,this.gameZone,-20,-10))}addMemory(){const{ShowMemoryInGame:e}=GameCore.Configs.Statistics;e&&(this.memoryMeter=new E_(this),Phaser.Display.Align.In.TopLeft(this.memoryMeter,this.gameZone,-45,-3))}updateSceneState(){this.setGlobalSceneOnTop()}setGlobalSceneOnTop(){this.scene.bringToTop(this)}runMaskFadeInAnimation(){this.mask&&GameCore.Configs.EnableEffectSceneTransition&&(this.fadeInAnim?.remove(),this.fadeOutAnim?.remove(),this.fadeInAnim=new Zs({targets:[this.mask],duration:400,ease:Phaser.Math.Easing.Cubic.In,props:{alpha:{start:0,from:0,to:.6}}}),this.mask.setAlpha(0),this.fadeInAnim.play())}runMaskFadeOutAnimation(){this.mask&&GameCore.Configs.EnableEffectSceneTransition&&(this.fadeInAnim?.remove(),this.fadeOutAnim?.remove(),this.fadeOutAnim=new ve({targets:[this.mask],duration:400,ease:Phaser.Math.Easing.Cubic.Out,props:{alpha:{start:.6,from:.6,to:0}}}),this.mask.setAlpha(1),this.fadeOutAnim.play())}listenScenesEvents(){this.scene.manager.getScenes(!1).forEach(t=>{t.events.on(Phaser.Scenes.Events.CREATE,this.emitGameEventStartScene),t.events.on(Phaser.Scenes.Events.SLEEP,this.emitGameEventSleepScene),t.events.on(Phaser.Scenes.Events.WAKE,this.emitGameEventWakeScene),t.events.on(Phaser.Scenes.Events.PAUSE,this.emitGameEventPauseScene),t.events.on(Phaser.Scenes.Events.RESUME,this.emitGameEventResumeScene),t.events.on(Phaser.Scenes.Events.SHUTDOWN,this.emitGameEventShutdownScene)}),this.events.on(Ds.RUN,this.runScene),this.events.on(Ds.SLEEP,this.sleepScene),this.events.on(Ds.SWITCH,this.switchScene)}getActiveScene(){return this.scene.manager.getScenes(!0)[0]}getCurrentScene(){return this.currentScene}requestBackgroundMaskUpdate(e,t){this.backgroundMaskManager.requestBackgroundMaskUpdate(e,t)}recalculateBackgroundMask(){this.backgroundMaskManager.updateBackgroundMask()}get currentScene(){const e=this.storage.getState(),t=u_(e);let s;return t?s=this.scene.manager.getScene(t):s=this.getActiveScene(),s.scene}runScene=e=>{this.currentScene.run(e)};sleepScene=e=>{this.currentScene.sleep(e)};switchScene=e=>{this.currentScene.switch(e)};updateActiveSceneKey(e){e!==N.GLOBAL_SCENE&&this.storage.dispatch(qc(e))}emitGameEventStartScene=e=>{const{key:t}=e.scene;console.info("%cScene start","color: #D27D2D",t),this.updateSceneState(),this.runMaskFadeOutAnimation(),this.updateActiveSceneKey(t),this.game.events.emit(Phaser.Scenes.Events.START,t)};emitGameEventSleepScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene sleep","color: #D27D2D",t),t!==N.LOAD_SCENE&&(this.runMaskFadeInAnimation(),this.game.events.emit(Phaser.Scenes.Events.SLEEP,t))};emitGameEventWakeScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene wake","color: #D27D2D",t),t!==N.LOAD_SCENE&&(this.updateSceneState(),this.runMaskFadeOutAnimation(),this.updateActiveSceneKey(t),this.game.events.emit(Phaser.Scenes.Events.WAKE,t))};emitGameEventPauseScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene pause","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.PAUSE,t)};emitGameEventResumeScene=e=>{const{key:t}=e.scene;console.info("%cScene resume","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.RESUME,t)};emitGameEventShutdownScene=e=>{const{key:t}=e.scene.scene;console.info("%cScene shutdown","color: #D27D2D",t),this.game.events.emit(Phaser.Scenes.Events.SHUTDOWN,t)};logEventOpen(){}logPageviewOnOpen(){}}class C_ extends Error{constructor(e,t){super(e,t),this.name="LoadResourceFail",this.message=e||"Load resource fail",this.payload=t}}const{MELEE_UNIT_TYPE:ws,RANGED_UNIT_TYPE:Ps,ALIEN_UNIT_TYPE:Xr}=D,{UNITS_SPINES:I_}=y,{PLAYER_UNIT_DATA:Zr,LEVEL_PROGRESS:Zt}=ce,{UnitsConfig:qr}=GameCore.Configs,{MaximumMeleeLevel:R_,MaximumRangedLevel:__}=GameCore.Configs.Gameplay;class L_ extends Phaser.Scene{requestingSpines=[];requestingSprites=[];isLazyLoadRequesting;loadingPercent=0;preload(){window.getLoadingPerc=()=>this.loadingPercent,this.facebook.progressLoading.loadingProgressFbLoadScene(),this.analytics.event(v.SCREEN_OPEN,{screen_name:"LoadScene"});const e=s=>{this.loadingPercent=Math.max(this.loadingPercent,s*100),s===1&&this.load.off("progress",e),this.facebook.progressLoading.onProgress(s)};this.load.on("progress",e),this.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,s=>{const i=new C_("Load resources at LoadScene failed.");console.error(i)});const t=this.getLevelJsonName();this.load.on(`filecomplete-json-${t}`,()=>{this.scene.wake(),this.loadEnemyUnits(t)}),this.load.json(t,`assets/json/${t}.json`),this.loadDefaultUnits(),this.loadPlayerUnits(),this.load.json("unitData","assets/json/unit-data.json"),this.loadFonts(),this.textStyler.addFont({type:"local",fontType:"truetype",fontName:w.FONT_FAMILY}),this.load.multiatlas({key:y.DEFAULT_8_BIT.KEY,atlasURL:y.DEFAULT_8_BIT.JSON,path:y.DEFAULT_8_BIT.PATH}),this.load.atlas({key:y.DEFAULT.KEY,atlasURL:y.DEFAULT.JSON,textureURL:y.DEFAULT.TEXTURE}),this.load.atlas({key:y.GAMEPLAY.KEY,atlasURL:y.GAMEPLAY.JSON,textureURL:y.GAMEPLAY.TEXTURE}),this.loadBackgroundByCurrentLevel(),this.load.multiatlas({key:y.EFFECTS.KEY,path:y.EFFECTS.PATH,atlasURL:y.EFFECTS.JSON}),this.load.spine(y.SPINE_EFFECTS.FX_MERGE.KEY,y.SPINE_EFFECTS.FX_MERGE.jsonPATH,y.SPINE_EFFECTS.FX_MERGE.atlasPATH),this.player.updateData().then(this.handleUpdateNotificationData).catch(s=>{console.warn("LoadScene: player.updateData() failed",s)})}create(){this.audio.initSound(),this.analytics.event(v.LOAD_COMPLETE),this.facebook.on("startgame",this.handleFBInstantGameStarted),this.facebook.gameStarted(),this.setupGlobalScene(),this.startGame()}handleFBInstantGameStarted=()=>{window.__fbGameReady=!0,this.updateBackgroundElement(),this.player.updateData().catch(e=>{console.warn(e)}),this.player.requestConnectedPlayers()};updateBackgroundElement(){if(!this.world.isUsingLandscapeBackground())return;const t=document.getElementById("background-image");if(!t)return;const s=this.player.getCustomData(Zt);if(typeof s!="number"||s<0){t.src=L.BG_LANDSCAPE_TREE.FILE;return}let i=L.BG_LANDSCAPE_TREE.FILE;switch(Math.floor((s+1)/10)%5){case 0:i=L.BG_LANDSCAPE_TREE.FILE;break;case 1:i=L.BG_LANDSCAPE_DESERT.FILE;break;case 2:i=L.BG_LANDSCAPE_ICE.FILE;break;case 3:i=L.BG_LANDSCAPE_CRYSTAL.FILE;break;case 4:i=L.BG_LANDSCAPE_VOLCANO.FILE;break}t.src=i}handleUpdateNotificationData=()=>{const e=this.player.getPlayer(),{playerId:t,name:s,locale:i,data:a}=e,r=this.player.getCustomData("levelProgress");this.notification.updateData({playerId:t,name:s,photo:"",locale:i,friendIds:this.player.getConnectedPlayerIds(10,0),gameSettings:this.player.getPlayerSettings(),gameProgress:{currentLevel:r},gameStatistics:{highScore:a.score}}),this.notification.sendRequest()};setupGlobalScene(){const e=this.scene.get(N.GLOBAL_SCENE);e instanceof Tn&&e.setup()}startGame=()=>{this.showStickyBannerAd(),this.preloadAds(),this.analytics.event(v.APP_READY),this.storage.dispatch(qc(N.LOAD_SCENE)),this.storage.dispatch(tA())};showStickyBannerAd=()=>{this.ads.showBannerAdAsync().catch(e=>{console.warn(e)})};preloadAds=()=>{this.ads.preloadRewardedVideoAsync().catch(e=>{}),this.ads.preloadInterstitialAdAsync().catch(e=>{})};loadBackgroundByCurrentLevel(){const e=this.player.getCustomData(Zt);if(typeof e!="number"||e<0){this.loadAllBackgrounds();return}const t=Math.floor((e+1)/10)%5;this.world.isUsingLandscapeBackground()?(this.loadBackgroundImage(L.BG_LANDSCAPE_TREE.FILE,L.BG_LANDSCAPE_TREE.KEY),t===1?this.loadBackgroundImage(L.BG_LANDSCAPE_DESERT.FILE,L.BG_LANDSCAPE_DESERT.KEY):t===2?this.loadBackgroundImage(L.BG_LANDSCAPE_ICE.FILE,L.BG_LANDSCAPE_ICE.KEY):t===3?this.loadBackgroundImage(L.BG_LANDSCAPE_CRYSTAL.FILE,L.BG_LANDSCAPE_CRYSTAL.KEY):t===4&&this.loadBackgroundImage(L.BG_LANDSCAPE_VOLCANO.FILE,L.BG_LANDSCAPE_VOLCANO.KEY)):(this.load.image(L.BG_TREE.KEY,L.BG_TREE.FILE),t===1?this.load.image(L.BG_DESERT.KEY,L.BG_DESERT.FILE):t===2?this.load.image(L.BG_ICE.KEY,L.BG_ICE.FILE):t===3?this.load.image(L.BG_CRYSTAL.KEY,L.BG_CRYSTAL.FILE):t===4&&this.load.image(L.BG_VOLCANO.KEY,L.BG_VOLCANO.FILE))}loadFonts(){const e=this.lang.getCurrentLanguage();switch(e){case"tr":w.PRIMARY={KEY:"BalooTr",TEXTURE:"./assets/fonts/BalooTr.png",DATA:"./assets/fonts/BalooTr.xml"},w.FONT_FAMILY="BalooTr";break;case"ja":w.PRIMARY={KEY:"MPlusJa",TEXTURE:"./assets/fonts/MPlusJa.png",DATA:"./assets/fonts/MPlusJa.xml"},w.FONT_FAMILY="MPlusJa";break;case"id":w.PRIMARY={KEY:"LilitaOne-en",TEXTURE:"./assets/fonts/LilitaOne-en.png",DATA:"./assets/fonts/LilitaOne-en.xml"};break;default:w.PRIMARY={KEY:`LilitaOne-${e}`,TEXTURE:`./assets/fonts/LilitaOne-${e}.png`,DATA:`./assets/fonts/LilitaOne-${e}.xml`};break}this.load.bitmapFont(w.PRIMARY.KEY,w.PRIMARY.TEXTURE,w.PRIMARY.DATA)}getLevelJsonName(){const e=this.player.getCustomData(Zt),s=Math.floor((e||0)/100)*100+1,i=s+99,a=(1e4+s).toString().substring(1),r=(1e4+i).toString().substring(1);return`levels-${a}-${r}`}loadDefaultUnits(){const e=this.getBuyingUnitLevel(),t=`m1-r1-m${e}-r${e}-0/0-0-0-0-0/0-0-0-0-0`;this.loadUnits("spine",t)}getBuyingUnitLevel(){const e=this.player.getCustomData(Zt),t=GameCore.Utils.Valid.isNumber(e)?e+1:1,{BUYING_UNIT_LEVEL:s}=D;let i=1;return s.forEach((a,r)=>{a<=t&&(i=r+1)}),i}loadPlayerUnits(){const e=this.player.getCustomData(Zr);if(!e||typeof e!="string"){this.loadAllUnits();return}const t=this.upgradePlayerUnits(e);this.player.setCustomData(Zr,t),this.loadUnits("spine",t)}upgradePlayerUnits(e){const t=this.getPlayerUnitList(e),s=this.getBuyingUnitLevel(),i=[],a=[];for(let o=0;o<15;o++){const c=t[o],l=c[0];l!=="m"&&l!=="r"||parseInt(c.substring(1))>=s||(l==="m"?i.push(o):a.push(o))}for(let o=0;o<i.length;o++)t[i[o]]=`m${s-1}`,t[a[o]]=`r${s-1}`;if(i.length%2===1){const o=i[0];t[o]=`m${s}`}if(a.length%2===1){const o=a[0];t[o]=`r${s}`}const r=this.handleCannotMergeCase(t);return this.serializePlayerUnitData(r)}handleCannotMergeCase(e){if(this.isBoardCanBeMerged(e))return e;const t=this.getBuyingUnitLevel();let s=Number.MAX_SAFE_INTEGER,i=-1,a=Number.MAX_SAFE_INTEGER,r=-1,o=Number.MAX_SAFE_INTEGER,c=-1,l=Number.MAX_SAFE_INTEGER,h=-1,u=0;for(let p=0;p<e.length;p++){const g=e[p],S=g[0];if(S!=="m"&&S!=="r")continue;u++;const f=parseInt(g.substring(1));S==="m"?f<s?(a=s,r=i,s=f,i=p):f<a&&(a=f,r=p):f<o?(l=o,h=c,o=f,c=p):f<l&&(l=f,h=p)}return u===15&&t===s&&i!==-1&&r!==-1?e[i]=e[r]:u===15&&t===o&&c!==-1&&h!==-1&&(e[c]=e[h]),e}isBoardCanBeMerged(e){const t=new Map,s=new Map;e.forEach(c=>{const l=c[0];if(l!=="m"&&l!=="r")return;const h=parseInt(c.substring(1));switch(l){case ws:{const u=t.get(h);u?t.set(h,u+1):t.set(h,1);break}case Ps:{const u=s.get(h);u?s.set(h,u+1):s.set(h,1);break}}});const a=Array.from(t,([c,l])=>({key:c,value:l})).some(c=>{const{key:l,value:h}=c;return h>1&&l+1<=R_}),o=Array.from(s,([c,l])=>({key:c,value:l})).some(c=>{const{key:l,value:h}=c;return h>1&&l+1<=__});return a||o}getPlayerUnitList(e){const t=e.split("/"),s=[];return t.forEach(i=>{i.split("-").forEach(r=>{s.push(r)})}),s}serializePlayerUnitData(e){let t="",s=0;for(let i=0;i<3;i++){let a="";for(let r=0;r<5;r++)a+=e[s],s++,r!==4&&(a+="-");t+=a,i!==2&&(t+="/")}return t}loadEnemyUnits(e){const t=this.player.getCustomData(Zt),s=typeof t=="number"?t:0,i=Math.floor(s/100)*100+1,a=s-i+1,o=this.cache.json.get(e).levels[a],c=`${o.enemy_row1}/${o.enemy_row2}/${o.enemy_row3}`;this.loadUnits("spine",c)}loadUnits(e,t){const s=t.split("/"),i=[];s.forEach(a=>{a.split("-").forEach(o=>{if(o==="0"||i.includes(o))return;let c=Xr;if(o[0]==="m"?c=ws:o[0]==="r"&&(c=Ps),c===Xr)return;const l=parseInt(o.substring(1));if(c===ws){if(qr.MELEE.listLevelsUseSprite.includes(l)){if(e==="spine")return}else if(e==="sprite")return}if(c===Ps){if(qr.RANGED.listLevelsUseSprite.includes(l)){if(e==="spine")return}else if(e==="sprite")return}i.push(o),this.loadUnit(e,l,c)})})}loadUnit(e,t,s){const{MELEE:i,RANGED:a}=I_;let r=null;switch(s){case ws:t>0&&t<=Object.keys(i).length&&(r=i[t]);break;case Ps:t>0&&t<=Object.keys(a).length&&(r=a[t]);break}if(r){if(e==="spine"){if(this.requestingSpines.includes(r.KEY))return;this.requestingSpines.push(r.KEY),this.load.spine(r.KEY,r.jsonPATH,r.atlasPATH),this.isLazyLoadRequesting=!0}if(e==="sprite"){if(this.textures.exists(r.KEY)||this.requestingSprites.includes(r.KEY))return;this.requestingSprites.push(r.KEY),console.log("load sprite unit",r.KEY),this.load.multiatlas({key:r.KEY,atlasURL:r.JSON,path:r.PATH}),this.isLazyLoadRequesting=!0}}}lazyLoadResource(){this.isLazyLoadRequesting=!1,this.loadSounds(),this.loadAllUnits(),this.loadAvatarUnits(),this.loadAllBackgrounds(),this.isLazyLoadRequesting&&(this.scene.wake(),this.load.once(Phaser.Loader.Events.COMPLETE,()=>{this.scene.sleep()}),this.load.start())}loadSounds(){const{FILE_KEY_COMPLETE:e}=Phaser.Loader.Events;this.cache.audio.exists(St.BACKGROUND.KEY)||(this.load.once(`${e}audio-${St.BACKGROUND.KEY}`,this.handleLoadMusicCompleted),this.load.audio(St.BACKGROUND.KEY,St.BACKGROUND.FILE),this.isLazyLoadRequesting=!0)}handleLoadMusicCompleted=()=>{this.audio.initMusic(St.BACKGROUND.KEY),this.audio.playMusic(),this.audio.setMusicVolume(.4,3e3)};loadAllUnits(){this.loadUnits("spine","m1-m2-m3-m4-m5/m6-m7-m8-m9-m10/m11-r1-r2-r3-r4-r5"),this.loadUnits("spine","r6-r7-r8-r9-r10/r11-0-0-0-0/0-0-0-0-0")}loadAvatarUnits(){this.textures.exists(y.UNITS.KEY)||(this.load.multiatlas({key:y.UNITS.KEY,atlasURL:y.UNITS.JSON,path:y.UNITS.PATH}),this.isLazyLoadRequesting=!0)}loadAllBackgrounds(){this.world.isUsingLandscapeBackground()?(this.textures.exists(L.BG_LANDSCAPE_TREE.KEY)||(this.loadBackgroundImage(L.BG_LANDSCAPE_TREE.FILE,L.BG_LANDSCAPE_TREE.KEY),this.isLazyLoadRequesting=!0),this.textures.exists(L.BG_LANDSCAPE_DESERT.KEY)||(this.loadBackgroundImage(L.BG_LANDSCAPE_DESERT.FILE,L.BG_LANDSCAPE_DESERT.KEY),this.isLazyLoadRequesting=!0),this.textures.exists(L.BG_LANDSCAPE_ICE.KEY)||(this.loadBackgroundImage(L.BG_LANDSCAPE_ICE.FILE,L.BG_LANDSCAPE_ICE.KEY),this.isLazyLoadRequesting=!0),this.textures.exists(L.BG_LANDSCAPE_VOLCANO.KEY)||(this.loadBackgroundImage(L.BG_LANDSCAPE_VOLCANO.FILE,L.BG_LANDSCAPE_VOLCANO.KEY),this.isLazyLoadRequesting=!0),this.textures.exists(L.BG_LANDSCAPE_CRYSTAL.KEY)||(this.loadBackgroundImage(L.BG_LANDSCAPE_CRYSTAL.FILE,L.BG_LANDSCAPE_CRYSTAL.KEY),this.isLazyLoadRequesting=!0)):(this.textures.exists(L.BG_TREE.KEY)||(this.load.image(L.BG_TREE.KEY,L.BG_TREE.FILE),this.isLazyLoadRequesting=!0),this.textures.exists(L.BG_DESERT.KEY)||(this.load.image(L.BG_DESERT.KEY,L.BG_DESERT.FILE),this.isLazyLoadRequesting=!0),this.textures.exists(L.BG_ICE.KEY)||(this.load.image(L.BG_ICE.KEY,L.BG_ICE.FILE),this.isLazyLoadRequesting=!0),this.textures.exists(L.BG_VOLCANO.KEY)||(this.load.image(L.BG_VOLCANO.KEY,L.BG_VOLCANO.FILE),this.isLazyLoadRequesting=!0),this.textures.exists(L.BG_CRYSTAL.KEY)||(this.load.image(L.BG_CRYSTAL.KEY,L.BG_CRYSTAL.FILE),this.isLazyLoadRequesting=!0))}async loadBackgroundImage(e,t){return new Promise((s,i)=>{const a=new Image;a.crossOrigin="use-credentials",a.onload=()=>{this.load.image(t,e),s()},a.onerror=()=>{console.error("Load image failed",e),i()},a.src=e})}}const{Valid:Qr}=GameCore.Utils;class w_{currencies;constructor(e){this.initDefaultValues(),Qr.isObject(e)&&Object.keys(e).forEach(t=>{Object.hasOwn(e,t)&&Qr.isNumber(e[t])&&(this.currencies[t]=e[t])})}initDefaultValues(){this.currencies={}}toObject(){return{...this.currencies}}}const{Object:gt,Valid:et}=GameCore.Utils;class P_{currentLevel;itemsCollected;levelsCompleted;constructor(e){this.initDefaultValues(),et.isObject(e)&&(gt.hasOwn(e,"currentLevel")&&et.isNumber(e.currentLevel)&&(this.currentLevel=e.currentLevel),gt.hasOwn(e,"itemsCollected")&&Array.isArray(e.itemsCollected)&&(this.itemsCollected=e.itemsCollected.filter(t=>!(!et.isObject(t)||!gt.hasOwn(t,"itemId")||!et.isString(t.itemId)||!gt.hasOwn(t,"quantity")||!et.isNumber(t.quantity)))),gt.hasOwn(e,"levelsCompleted")&&Array.isArray(e.levelsCompleted)&&(this.levelsCompleted=e.levelsCompleted.filter(t=>!(!et.isObject(t)||!gt.hasOwn(t,"score")||!et.isNumber(t.score)||!gt.hasOwn(t,"levelId")||!et.isString(t.levelId)))))}initDefaultValues(){this.currentLevel=0,this.levelsCompleted=[],this.itemsCollected=[]}toObject(){return{currentLevel:this.currentLevel,itemsCollected:this.itemsCollected,levelsCompleted:this.levelsCompleted}}}const{Object:Os,Valid:qt}=GameCore.Utils;class O_{highScore;timePlayed;totalGamesWon;totalGamesLose;constructor(e){this.initDefaultValues(),qt.isObject(e)&&(Os.hasOwn(e,"highScore")&&qt.isNumber(e.highScore)&&(this.highScore=e.highScore),Os.hasOwn(e,"timePlayed")&&qt.isNumber(e.timePlayed)&&(this.timePlayed=e.timePlayed),Os.hasOwn(e,"totalGamesWon")&&qt.isNumber(e.totalGamesWon)&&(this.totalGamesWon=e.totalGamesWon),Os.hasOwn(e,"totalGamesLose")&&qt.isNumber(e.totalGamesLose)&&(this.totalGamesLose=e.totalGamesLose))}initDefaultValues(){this.highScore=0,this.timePlayed=0,this.totalGamesWon=0,this.totalGamesLose=0}toObject(){return{highScore:this.highScore,timePlayed:this.timePlayed,totalGamesWon:this.totalGamesWon,totalGamesLose:this.totalGamesLose}}}const{sound:D_,music:v_,vibrate:N_,speedUp:b_}=Ft;class M_{sound;music;vibrate;speedUp;constructor(e){const{sound:t,music:s,vibrate:i,speedUp:a}=e||{};this.sound=GameCore.Utils.Valid.isBoolean(t)?t:D_,this.music=GameCore.Utils.Valid.isBoolean(s)?s:v_,this.vibrate=GameCore.Utils.Valid.isBoolean(i)?i:N_,this.speedUp=GameCore.Utils.Valid.isBoolean(a)?a:b_}toObject(){return{sound:this.sound,music:this.music,vibrate:this.vibrate,speedUp:this.speedUp}}}const{settings:U_}=lc,{Object:pe,Valid:Ke}=GameCore.Utils;class k_{score;gpId;appId;glanceId;playerId;name;photo;locale;friendIds;gameProgress;gameSettings;gameStatistics;currencyBalance;constructor(e){this.initDefaultValues(),Ke.isObject(e)&&(pe.hasOwn(e,"score")&&Ke.isNumber(e.score)&&(this.score=e.score),pe.hasOwn(e,"gpId")&&Ke.isString(e.gpId)&&(this.gpId=e.gpId),pe.hasOwn(e,"appId")&&Ke.isString(e.appId)&&(this.appId=e.appId),pe.hasOwn(e,"glanceId")&&Ke.isString(e.glanceId)&&(this.glanceId=e.glanceId),pe.hasOwn(e,"playerId")&&Ke.isString(e.playerId)&&(this.playerId=e.playerId),pe.hasOwn(e,"name")&&Ke.isString(e.name)&&(this.name=e.name),pe.hasOwn(e,"photo")&&Ke.isString(e.photo)&&(this.photo=e.photo),pe.hasOwn(e,"locale")&&Ke.isString(e.locale)&&(this.locale=e.locale),pe.hasOwn(e,"friendIds")&&Array.isArray(e.friendIds)&&(this.friendIds=e.friendIds),pe.hasOwn(e,"gameProgress")&&(this.gameProgress=new P_(e.gameProgress).toObject()),pe.hasOwn(e,"gameStatistics")&&(this.gameStatistics=new O_(e.gameStatistics).toObject()),pe.hasOwn(e,"currencyBalance")&&(this.currencyBalance=new w_(e.currencyBalance).toObject()),pe.hasOwn(e,"gameSettings")&&(this.gameSettings=new M_(e.gameSettings).toObject()))}initDefaultValues(){this.score=0,this.gpId="",this.appId="",this.glanceId="",this.playerId="",this.name="",this.photo="",this.locale="en_US",this.friendIds=[],this.gameProgress={currentLevel:0,itemsCollected:[],levelsCompleted:[]},this.gameSettings={...U_},this.gameStatistics={highScore:0,timePlayed:0,totalGamesWon:0,totalGamesLose:0},this.currencyBalance={}}toObject(){return{score:this.score,gpId:this.gpId,appId:this.appId,glanceId:this.glanceId,playerId:this.playerId,name:this.name,photo:this.photo,locale:this.locale,friendIds:this.friendIds,gameProgress:this.gameProgress,gameSettings:this.gameSettings,gameStatistics:this.gameStatistics,currencyBalance:this.currencyBalance}}}class B_ extends Phaser.Plugins.BasePlugin{data;endpoint;enabled;async setup(e,t){this.enabled=!0,this.endpoint=e,console.log("NotificationPlugin: configure",e,t),this.updateData(t)}updateData=async e=>{if(!this.enabled)return;const t=Ie(this.data,e);this.data=new k_(t).toObject(),console.log("NotificationPlugin: updatePayload",this.data)};sendRequest=async()=>{try{if(!this.enabled)return;const{playerId:e}=this.data,t={...this.data};console.log("NotificationPlugin: sendRequest",t);const i=(await Yt(`players/${e}`,t,{},this.endpoint,10))?.data||{};this.updateData(i)}catch(e){console.warn("NotificationPlugin: sendRequest",e)}}}class Jr extends GameCore.Ads.AdInstance{instance;placementId;constructor(e,t){super(e),this.instance=null,this.placementId=t}static setGame(e){self.game=e}async loadAsync(){if(console.log("loadAsync",this.type,this.status),this.status===GameCore.Ads.Status.IDLE)try{if(this.status=GameCore.Ads.Status.LOADING,this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");await this.instance.loadAsync(),this.status=GameCore.Ads.Status.FILLED}catch(e){throw this.status=GameCore.Ads.Status.IDLE,this.instance=null,e}}async showAsync(){const e=this.getSceneName();try{if(console.log("showAsync",this.type,this.status),this.status===GameCore.Ads.Status.LOADING)throw new GameCore.Ads.AdError("AD_ARE_LOADING","Ads are loading.");if(this.status!==GameCore.Ads.Status.FILLED)throw new GameCore.Ads.AdError("AD_NOT_FILLED","Ads no fill.");if(this.status=GameCore.Ads.Status.SHOWING,this.instance===null)throw new GameCore.Ads.AdError("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.type===GameCore.Ads.Types.REWARDED&&window.sendCustomAnalyticsEvent(v.GLANCE_REWARDED_AD,{failureCB:()=>window.handleRewardedFail(),successCB:()=>window.handleRewardedSuccess()}),await this.instance.showAsync(),this.type===GameCore.Ads.Types.INTERSTITIAL&&self.game.analytics.showInterstitialAd(e),this.type===GameCore.Ads.Types.REWARDED&&self.game.analytics.showRewardedVideoAd(e),this.status=GameCore.Ads.Status.IDLE,this.instance=null}catch(t){if(console.warn("showAsync error",t),this.status=GameCore.Ads.Status.IDLE,this.instance=null,t instanceof Object&&GameCore.Utils.Object.hasOwn(t,"code")){if(t.code==="AD_ARE_LOADING"&&this.type===GameCore.Ads.Types.REWARDED){self.game.analytics.showAdFail(this.type,e,t);return}if(t.code==="AD_NOT_FILLED"&&this.type===GameCore.Ads.Types.REWARDED){self.game.analytics.showAdFail(this.type,e,t);return}}throw self.game.analytics.showAdFail(this.type,e,t),t}}getStatus(){return this.status}async createInstanceByType(e){const{facebook:t}=self.game;switch(e){case GameCore.Ads.Types.REWARDED:return await t.getRewardedVideoAsync(this.placementId);case GameCore.Ads.Types.INTERSTITIAL:return await t.getInterstitialAdAsync(this.placementId);default:return null}}getSceneName(){try{const{globalScene:e}=self.game;return e instanceof Tn?e.getCurrentScene().scene.getSceneName():"unknown"}catch{return"unknown"}}}const{Object:eo,Valid:tt}=GameCore.Utils;class x_ extends Phaser.Game{constructor(e){super(e)}async boot(){super.boot(),this.addExtraGameObjectMethods(),this.addExtraFBInstantFunctions(),this.addPlugins(),await this.addDevPlugins(),await this.initAdsAsync(),this.addScenes(),this.addDevScenes(),this.initWorld(),this.initStorage(),this.initLanguage(),this.initUtils(),this.initConsole(),this.initDebugger(),this.initStatistics(),this.initLevelBuilder(),this.initParticleEditor(),this.initNotificationPlugin(),this.initAdaptivePerformance(),this.initProfilerPlugin(),this.handleShowInterAdWhenStartGame(),this.handleShowBackgroundElement(),this.addGlanceGlobalMethods()}start(){super.start()}addExtraGameObjectMethods(){const e=new Qh;e.addKillRevive(),e.addKillReviveGroup(),e.addDrawDebugBox(),e.addSetWorldSize(),e.addSetWorldSizeForContainer(),e.addGetWorldPosition(),e.addHighQuality()}addExtraFBInstantFunctions(){const e=new Zh(this.facebook);this.facebook.getLocale=e.getLocale,this.facebook.shareAsync=e.shareAsync,this.facebook.inviteAsync=e.inviteAsync,this.facebook.switchAsync=e.switchAsync,this.facebook.chooseAsync=e.chooseAsync,this.facebook.createAsync=e.createAsync,this.facebook.sendMessage=e.sendMessage,this.facebook.isSupportAPI=e.isSupportAPI,this.facebook.getContextID=e.getContextID,this.facebook.getPlayerToken=e.getPlayerToken,this.facebook.matchPlayerAsync=e.matchPlayerAsync,this.facebook.getContextPlayers=e.getContextPlayers,this.facebook.setLoadingProgress=e.setLoadingProgress,this.facebook.attemptToAddShortcut=e.attemptToAddShortcut,this.facebook.attemptToSubscribeBot=e.attemptToSubscribeBot,this.facebook.postSessionScoreAsync=e.postSessionScoreAsync,this.facebook.getRewardedVideoAsync=e.getRewardedVideoAsync,this.facebook.sendNotificationAsync=e.sendNotificationAsync,this.facebook.getInterstitialAdAsync=e.getInterstitialAdAsync,e.injectTournament(),this.facebook.progressLoading=new qh(this)}addPlugins(){this.plugins.install("Storage",Ig,!0,"storage"),this.plugins.install("AdsManager",eu,!0,"ads"),this.plugins.install("AuthManager",Su,!0,"auth"),this.plugins.install("CoinManager",fd,!0,"coin"),this.plugins.install("AudioManager",ru,!0,"audio"),this.plugins.install("WorldManager",Pg,!0,"world"),this.plugins.install("BattleManager",od,!0,"battle"),this.plugins.install("PlayerManager",Bd,!0,"player"),this.plugins.install("LanguageManager",_E,!0,"lang"),this.plugins.install("ProfileManager",$d,!0,"profile"),this.plugins.install("AnalyticsManager",su,!0,"analytics"),this.plugins.install("NotificationPlugin",B_,!0,"notification"),this.plugins.install("AdaptivePerformance",Cd,!0,"performance"),this.plugins.installScenePlugin("textStyler",wg,"textStyler"),this.plugins.installScenePlugin("ScreenManager",Xd,"screen"),this.plugins.installScenePlugin("FrameCapture",Td,"frameCapture"),window.SpinePlugin&&this.plugins.installScenePlugin("SpinePlugin",SpinePlugin,"spine"),this.storage=this.plugins.get("Storage"),this.ads=this.plugins.get("AdsManager"),this.auth=this.plugins.get("AuthManager"),this.audio=this.plugins.get("AudioManager"),this.world=this.plugins.get("WorldManager"),this.battle=this.plugins.get("BattleManager"),this.player=this.plugins.get("PlayerManager"),this.lang=this.plugins.get("LanguageManager"),this.profile=this.plugins.get("ProfileManager"),this.analytics=this.plugins.get("AnalyticsManager"),this.notification=this.plugins.get("NotificationPlugin"),this.performance=this.plugins.get("AdaptivePerformance")}async addDevPlugins(){if(!tt.isDebugger())return;const e=(await je(()=>import("./devtool.js").then(r=>r.i),[],import.meta.url)).default,t=(await je(()=>import("./devtool.js").then(r=>r.a),[],import.meta.url)).default,s=(await je(()=>import("./devtool.js").then(r=>r.b),[],import.meta.url)).default,i=(await je(()=>import("./devtool.js").then(r=>r.c),[],import.meta.url)).default,a=(await je(()=>import("./devtool.js").then(r=>r.d),[],import.meta.url)).default;this.plugins.install("Console",e,!0,"console"),this.plugins.install("Debugger",t,!0,"debugger"),this.plugins.install("Profiler",s,!0,"profiler"),this.plugins.install("LevelBuilder",i,!0,"level-builder"),this.plugins.install("ParticleEditor",a,!0,"particle-editor"),this.eruda=this.plugins.get("Console"),this.debugger=this.plugins.get("Debugger"),this.profiler=this.plugins.get("Profiler"),this.statistics=this.plugins.get("Statistics"),this.profiler=this.plugins.get("Profiler"),this.levelBuilder=this.plugins.get("LevelBuilder"),this.particleEditor=this.plugins.get("ParticleEditor")}addScenes(){this.scene.add(N.BOOT_SCENE,kE,!0),this.scene.add(N.LOAD_SCENE,L_,!1),this.scene.add(N.GAME_SCENE,H,!1),this.scene.add(N.GLOBAL_SCENE,Tn,!1)}async addDevScenes(){if(!GameCore.Utils.Valid.isDebugger())return;const e=(await je(()=>import("./devscene.js").then(i=>i.T),[],import.meta.url)).default,t=(await je(()=>import("./devscene.js").then(i=>i.i),[],import.meta.url)).default,s=(await je(()=>import("./devscene.js").then(i=>i.L),[],import.meta.url)).default;this.scene.add(N.TEST_SCENE,e,!1),this.scene.add(N.ANIMATIONS_SCENE,t,!1),this.scene.add(N.LEVEL_BUILDER_SCENE,s,!1)}async initAdsAsync(){const{Ads:e}=GameCore.Configs;Jr.setGame(this);const t=Jr,s={...e.InterstitialAdOptions},i=window.GlanceGamingAdInterface!=null&&window.isAdSDKLoaded;s.showWhenStartGame&&(s.secondsFirstTime=0),this.ads.configure(t,{enabled:e.Enabled&&i,calculateSafeAreaBottom:e.CalculateSafeAreaBottom,enableRewardVideoResetInterstitial:e.EnableRewardVideoResetInterstitial,interstitialAdOptions:s,rewardAdOptions:e.RewardAdOptions,bannerAdOptions:e.BannerAdOptions})}initWorld(){const{Game:e}=GameCore.Configs,{AutoResize:t,PortraitRatio:s,PortraitWidth:i,PortraitHeight:a,LandscapeRatio:r,LandscapeWidth:o,LandscapeHeight:c,DisableLandscape:l,FullSizeOnLandscape:h}=e,u=t,p=l,g=h,S=s,f=i,T=a,A=r,m=o,C=c;this.world.configure({autoResize:u,portraitRatio:S,portraitWidth:f,portraitHeight:T,landscapeRatio:A,landscapeWidth:m,landscapeHeight:C,disableLandscape:p,fullSizeOnLandscape:g}),this.world.resize(e.ForcePixelRatio)}initStorage(){const e=new Kg(this);this.storage.setInitiator(e)}initLanguage(){const e=this.facebook.getLocale()||"en";this.lang.configure({locale:e,upperCaseText:!0})}initUtils(){this.handlePauseAudio(),this.removeUnusedPipelines(),Gg()}initConsole(){if(!tt.isDebugger())return;const{ShowConsole:e}=GameCore.Configs.Debugger;e&&this.eruda.configure({tool:["console","info"],defaults:{theme:"Dark"}})}initDebugger(){if(!tt.isDebugger())return;const{ShowInspector:e,ShowMonitoring:t}=GameCore.Configs.Debugger;!e&&!t||this.debugger.configure(GameCore.Configs.Debugger)}initStatistics(){if(!tt.isDebugger())return;const{Enable:e}=GameCore.Configs.Statistics;e&&this.statistics.configure(GameCore.Configs.Statistics)}initParticleEditor(){if(!tt.isDebugger())return;const{Enable:e}=GameCore.Configs.ParticleEditor;e&&this.particleEditor.configure(GameCore.Configs.ParticleEditor)}initLevelBuilder(){if(!GameCore.Utils.Valid.isDebugger())return;const{Enable:e}=GameCore.Configs.LevelBuilder;e&&this.levelBuilder.configure(GameCore.Configs.LevelBuilder)}initProfilerPlugin(){if(!tt.isDebugger())return;const{Enable:e}=GameCore.Configs.ProfilerPlugin;e&&this.profiler.configure()}initNotificationPlugin(){const{AppId:e}=GameCore.Configs,{Enable:t,ApiUrl:s}=GameCore.Configs.Notification;if(!t)return;let i=null;if(eo.hasOwn(window.__glancePlayerData,"glanceId")&&tt.isString(window.__glancePlayerData.glanceId)&&(i=window.__glancePlayerData.glanceId),!i)return;let a=null;if(eo.hasOwn(window.__glancePlayerData,"gpID")&&tt.isString(window.__glancePlayerData.gpID)&&(a=window.__glancePlayerData.gpID),!a)return;const r={gpId:a,appId:e,glanceId:i};this.notification.setup(s,r)}addGlanceGlobalMethods(){window.enableSound=e=>{this.player.setSetting("music",e),this.player.setSetting("sound",e),e?this.audio.playMusic():this.audio.pauseMusic()}}initAdaptivePerformance(){const{Enable:e,...t}=GameCore.Configs.Performance;if(!e)return;const s=this.world.getPixelRatio();this.performance.configure({pixelRatio:s,...t}),this.performance.active()}handlePauseAudio(){this.sound.pauseOnBlur=!1,document.addEventListener("visibilitychange",()=>{if(document.hidden){this.audio.pauseMusic(),this.audio.pauseAllSounds();return}this.audio.playMusic(),this.audio.resumeAllSounds()})}removeUnusedPipelines(){const e=this.renderer;if(!(e instanceof Phaser.Renderer.WebGL.WebGLRenderer))return;const{pipelines:t}=e,s=Phaser.Renderer.WebGL.Pipelines;if(!s)return;[s.ROPE_PIPELINE,s.LIGHT_PIPELINE,s.POINTLIGHT_PIPELINE,s.BITMAPMASK_PIPELINE].forEach(a=>{t.get(a)?.destroy(),t.remove(a)})}async handleShowInterAdWhenStartGame(){const{InterstitialAdOptions:e}=GameCore.Configs.Ads;if(e.showWhenStartGame)try{this.audio.muteAll(),await this.ads.preloadInterstitialAdAsync(),await this.ads.showInterstitialAdAsync()}catch(t){console.info("🚀 > showInterstitialAdAsync",t)}finally{this.audio.unmuteAll(),this.ads.preloadInterstitialAdAsync().catch(()=>{})}}handleShowBackgroundElement(){if(!this.world.isLandscape())return;const e=document.getElementById("background");e&&(e.style.display="block");const t=document.getElementById("app");t&&t.classList.remove("has-background")}}const{ShowInspector:F_}=GameCore.Configs.Debugger,G_={parent:"app",type:Phaser.AUTO,width:0,height:0,scale:{autoRound:!0},dom:{createContainer:!1},loader:{maxParallelDownloads:6,crossOrigin:"no-cros"},audio:{noAudio:!1,disableWebAudio:!1},input:{gamepad:!1,keyboard:F_,touch:{capture:!0},smoothFactor:1,activePointers:1,windowEvents:!1},disableContextMenu:!0,render:{pixelArt:!1,antialias:!0,antialiasGL:!0,transparent:!1,desynchronized:!1,powerPreference:"high-performance",clearBeforeRender:!1,roundPixels:!1},plugins:{global:[]}},H_=()=>{try{const n=new x_(G_);window.game=n}catch{}},Y_=()=>{const n=setInterval(()=>{if(!window.__analyticsInitiated||!window.FBInstant)return;//! temporarily fix for not use adapter
window.GameSDK=window.FBInstant,window.__fbGameReady=!1,clearInterval(n),clearInterval(window.__fbInstantLoadingTimer),GameSDK.setLoadingProgress(30),"gtag"in window&&gtag("event","app_initialize",{send_to:["GA"]}),H_()},50)};Y_();export{X as A,F as B,Rc as C,M as D,Kc as E,Xy as F,pR as G,$y as H,eC as I,te as J,w as K,lT as L,zc as M,xC as N,wS as O,Dc as P,GT as Q,zs as R,N as S,D as U,y as a,Hc as b,vu as c,_e as d,rT as e,iT as f,W_ as g,eT as h,qS as i,zS as j,WS as k,YS as l,FS as m,kS as n,bS as o,I as p,Xc as q,me as r,Ie as s,qy as t,kR as u,Vy as v,_c as w,LR as x,Wc as y,Xi as z};
