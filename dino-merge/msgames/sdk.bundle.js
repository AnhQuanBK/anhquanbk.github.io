"use strict";(self.webpackChunkgame_core=self.webpackChunkgame_core||[]).push([[249],{708:function(n,t,e){var r=e(247),i=e.n(r),s=e(17),o=e(1),a=e(16),c=e.n(a),u=e(42),d=e.n(u),f=function(){function n(){this.payments=void 0}var t=n.prototype;return t.getLocale=function(){return null},t.getPlatform=function(){return null},t.getSDKVersion=function(){return"0.0"},t.getSupportedAPIs=function(){return[]},t.getEntryPointData=function(){return null},t.getEntryPointAsync=function(){return new(d())((function(n){n("")}))},t.canCreateShortcutAsync=function(){return new(d())((function(n,t){t(new Error("Not implemented"))}))},t.quit=function(){},t.performHapticFeedbackAsync=function(){return d().resolve()},n}(),h=function(){function n(){}var t=n.prototype;return t.getID=function(){return null},t.getType=function(){return"SOLO"},n}(),l=function(n){function t(t){var e;return(e=n.call(this)||this).sdk=void 0,e.sdk=t,e}(0,o.A)(t,n);var e=t.prototype;return e.getID=function(){return this.sdk.getID()},e.getType=function(){return this.sdk.getType()},e.isSizeBetween=function(n,t){return this.sdk.isSizeBetween(n,t)},e.switchAsync=function(n){return this.sdk.switchAsync(n)},e.chooseAsync=function(n){return this.sdk.chooseAsync(n)},e.createAsync=function(n){return this.sdk.createAsync(n)},e.getPlayersAsync=function(){return this.sdk.getPlayersAsync()},t}(h),y=l,p=function(){},A=function(n){function t(t){var e;return(e=n.call(this)||this).sdk=void 0,e.sdk=t,e}(0,o.A)(t,n);var e=t.prototype;return e.getID=function(){return this.sdk.getID()},e.getASIDAsync=function(){return this.sdk.getASIDAsync()},e.getSignedASIDAsync=function(){return this.sdk.getSignedASIDAsync()},e.getName=function(){return this.sdk.getName()},e.getPhoto=function(){return this.sdk.getPhoto()},e.getDataAsync=function(n){return this.sdk.getDataAsync(n)},e.setDataAsync=function(n){return this.sdk.setDataAsync(n)},e.flushDataAsync=function(){return this.sdk.flushDataAsync()},e.getSignedPlayerInfoAsync=function(n){return this.sdk.getSignedPlayerInfoAsync(n)},e.canSubscribeBotAsync=function(){return this.sdk.canSubscribeBotAsync()},e.subscribeBotAsync=function(){return this.sdk.subscribeBotAsync()},e.getConnectedPlayersAsync=function(){return this.sdk.getConnectedPlayersAsync()},e.isGuest=function(){return!1},t}(p),g=A,v=function(n){function t(t){var e;return(e=n.call(this)||this).sdk=void 0,e.player=void 0,e.context=void 0,e.graphApi=void 0,e.tournament=void 0,e.sdk=t,e.player=new g(t.player),e.context=new y(t.context),e}(0,o.A)(t,n);var e=t.prototype;return e.getLocale=function(){return this.sdk.getLocale()},e.getPlatform=function(){return this.sdk.getPlatform()},e.getSDKVersion=function(){return this.sdk.getSDKVersion()},e.initializeAsync=function(){return this.sdk.initializeAsync()},e.setLoadingProgress=function(n){this.sdk.setLoadingProgress(n)},e.getSupportedAPIs=function(){return this.sdk.getSupportedAPIs()},e.getEntryPointData=function(){return this.sdk.getEntryPointData()},e.getEntryPointAsync=function(){return this.sdk.getEntryPointAsync()},e.setSessionData=function(n){this.sdk.setSessionData(n)},e.startGameAsync=function(){return this.sdk.startGameAsync()},e.shareAsync=function(n){return this.sdk.shareAsync(n)},e.updateAsync=function(n){return this.sdk.updateAsync(n)},e.switchGameAsync=function(n,t){return this.sdk.switchGameAsync(n,t)},e.canCreateShortcutAsync=function(){return this.sdk.canCreateShortcutAsync()},e.createShortcutAsync=function(){return this.sdk.createShortcutAsync()},e.quit=function(){this.sdk.quit()},e.logEvent=function(n,t,e){return this.sdk.logEvent(n,t,e)},e.onPause=function(n){this.sdk.onPause(n)},e.getInterstitialAdAsync=function(n){return this.sdk.getInterstitialAdAsync(n)},e.getRewardedVideoAsync=function(n){return this.sdk.getRewardedVideoAsync(n)},e.matchPlayerAsync=function(n,t,e){return this.sdk.matchPlayerAsync(n,t,e)},e.checkCanPlayerMatchAsync=function(){return this.sdk.checkCanPlayerMatchAsync()},e.getLeaderboardAsync=function(n){return this.sdk.getLeaderboardAsync(n)},e.postSessionScoreAsync=function(n){return this.sdk.postSessionScoreAsync(n)},e.loadBannerAdAsync=function(n){return this.sdk.loadBannerAdAsync(n)},e.hideBannerAdAsync=function(){return this.sdk.hideBannerAdAsync()},e.showGameRating=function(){var n=(0,s.A)(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",d().reject(new Error("CLIENT_UNSUPPORTED_OPERATION")));case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),e.getTournamentAsync=function(){return this.sdk.getTournamentAsync()},e.inviteAsync=function(n){return this.sdk.inviteAsync(n)},e.shareLinkAsync=function(n){return this.sdk.shareLinkAsync(n)},t}(f),w=v,S=e(34),m=function(){},k=function(n){function t(){var t;return(t=n.call(this)||this).code=void 0,t.name="USER_INPUT",t.code="USER_INPUT",t.message="User closed rewarded ad!",t}return(0,o.A)(t,n),t}((0,e(126).A)(Error)),I=function(n){function t(t,e){var r;return(r=n.call(this)||this).sdk=void 0,r.type=void 0,r.sdk=e,r.type=t,r}(0,o.A)(t,n);var e=t.prototype;return e.getPlacementID=function(){return"privateId"},e.loadAsync=function(){return new(d())((function(n){n()}))},e.showAsync=function(){var n=this;return new(d())((function(t,e){"interstitial"===n.type?n.sdk.send("VKWebAppShowNativeAds",{ad_format:"interstitial"}).then((function(n){n.result?t():e()})).catch(e):"rewarded"===n.type?n.sdk.send("VKWebAppShowNativeAds",{ad_format:"reward"}).then((function(n){n.result?t():e(new k)})).catch(e):e(new Error("Unknown ad type"))}))},t}(m),D=I,P=function(n){function t(t){var e;return(e=n.call(this)||this).sdk=void 0,e.sdk=t,e}(0,o.A)(t,n);var e=t.prototype;return e.getID=function(){return null},e.getType=function(){return"SOLO"},e.isSizeBetween=function(n,t){return null},e.switchAsync=function(n){return new(d())((function(n,t){t(new Error("Unsupported"))}))},e.chooseAsync=function(){return new(d())((function(n,t){t(new Error("Unsupported"))}))},e.createAsync=function(n){return new(d())((function(n,t){t(new Error("Unsupported"))}))},e.getPlayersAsync=function(){return new(d())((function(n,t){t(new Error("Unsupported"))}))},t}(h),_=P,b=e(404),E=e.n(b),L=e(72),B=e.n(L),K=e(28),G=e.n(K),T=e(74),U=e.n(T),V=e(43),x=e.n(V),N=e(104),C=e.n(N),W=e(136),q=e.n(W),z="GuestID",M="GuestData",R="GuestStats",O=function(){function n(n){this._personalInfo=void 0,this._uniqueId=void 0,this._name=void 0,this._photo=void 0,this._playerData=void 0,this._playerStats=void 0,n?(this._uniqueId=n.id,this._name=n.name,this._photo=n.photo):(this._uniqueId=this.checkAndGetIdFromLocalStorage(),this._name="GUEST"),this._personalInfo={id:this._uniqueId,avatarIdHash:"0",lang:"ru",publicName:this.getName(),uniqueID:this._uniqueId,scopePermissions:{avatar:"forbid",public_name:"forbid"}},this._playerData=this.getDataFromLocalStorage(),this._playerStats=this.getStatsFromLocalStorage()}var t=n.prototype;return t.getUniqueID=function(){return this._uniqueId},t.getName=function(){return this._name},t.getPhoto=function(){return this._photo||""},t.getMode=function(){return""},t.getData=function(n){var t=this;if(n){var e=C()(n).call(n,(function(n,e){var r;return(0,S.A)({},n,((r={})[e]=t._playerData[e],r))}),{});return d().resolve(e)}return d().resolve(this._playerData)},t.setData=function(n){return this._playerData=(0,S.A)({},this._playerData,n),this.writeDataToLocalStorage(this._playerData),d().resolve(!0)},t.setStats=function(n){return this._playerStats=(0,S.A)({},this._playerStats,n),this.writeStatsToLocalStorage(this._playerStats),d().resolve(!0)},t.incrementStats=function(n){for(var t=0,e=q()(n);t<e.length;t++){var r=e[t],i=r[0],s=r[1];this._playerStats[i]=(this._playerStats[i]||0)+s}return this.writeStatsToLocalStorage(this._playerStats),d().resolve(this._playerStats)},t.getStats=function(n){var t=this;if(n){var e=C()(n).call(n,(function(n,e){var r;return(0,S.A)({},n,((r={})[e]=t._playerStats[e],r))}),{});return d().resolve(e)}return d().resolve(this._playerStats)},t.getIDsPerGame=function(){return d().resolve([])},t.checkAndGetIdFromLocalStorage=function(){var n=localStorage.getItem(z);if(null!=n)return n;var t=this.getRandomID();return localStorage.setItem(z,t),t},t.getRandomID=function(){return"GUEST_"+Math.random().toString(36).substr(2,15)},t.getDataFromLocalStorage=function(){var n=localStorage.getItem(M);return n?JSON.parse(n):{}},t.writeDataToLocalStorage=function(n){return localStorage.setItem(M,U()(n))},t.getStatsFromLocalStorage=function(){var n=localStorage.getItem(R);return n?JSON.parse(n):{}},t.writeStatsToLocalStorage=function(n){return localStorage.setItem(R,U()(n))},n}(),F="_stats-",j=function(n){function t(t){var e;return(e=n.call(this)||this).sdk=void 0,e.player=void 0,e.sdk=t,e}(0,o.A)(t,n);var e=t.prototype;return e.initPlayerAsync=function(){var n=(0,s.A)(c().mark((function n(){var t=this;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new(d())((function(n){t.sdk.send("VKWebAppGetUserInfo",{}).then((function(n){t.player=new O({id:""+n.id,name:n.first_name+" "+n.last_name,photo:n.photo_100})})).catch((function(){t.player=new O})).finally(n)})));case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),e.getSignedASIDAsync=function(){throw new Error("Method not implemented.")},e.rejectPlayerNotInitialized=function(){return d().reject(new Error("Player is not initialized"))},e.getID=function(){var n,t;return null!=(n=null==(t=this.player)?void 0:t.getUniqueID())?n:null},e.getASIDAsync=function(){var n;return d().resolve(null!=(n=this.getID())?n:"")},e.getName=function(){var n,t,e=null!=(n=null==(t=this.player)?void 0:t.getName())?n:null;return""===e?"Anonymous":e},e.getPhoto=function(){var n,t;return null!=(n=null==(t=this.player)?void 0:t.getPhoto())?n:null},e.getDataAsync=function(n){var t=this;return new(d())((function(e,r){t.validateIsLogged(r),n?t.sdk.send("VKWebAppStorageGet",{keys:n}).then((function(n){var t={};E()(n).forEach((function(n){""!=n.value&&(t[n.key]=JSON.parse(n.value))})),e(t)})).catch(r):t.getStorageKeys().then((function(n){return e(t.getDataAsync(n))})).catch(r)}))},e.setDataAsync=function(n){var t=this;return new(d())((function(e,r){t.validateIsLogged(r);var i=B()(n),s=G()(i).call(i,(function(e){return t.sdk.send("VKWebAppStorageSet",{key:e,value:U()(n[e])})}));d().all(s).then((function(){e()})).catch(r)}))},e.flushDataAsync=function(){var n=this;return new(d())((function(t,e){n.getStorageKeys().then((function(e){var r={};e.forEach((function(n){return r[n]=""})),n.setDataAsync(r).then(t)})).catch(e)}))},e.getStorageKeys=function(){var n=this;return new(d())((function(t,e){n.sdk.send("VKWebAppStorageGetKeys",{count:100,offset:0}).then((function(n){t(E()(n))})).catch(e)}))},e.getSignedPlayerInfoAsync=function(){var n,t,e=this,r=null!=(n=null==(t=this.player)?void 0:t.getUniqueID())?n:this.rejectPlayerNotInitialized();return new(d())((function(n,t){"string"===typeof r?n({getPlayerID:function(){var n;return null!=(n=e.getID())?n:"10"},getSignature:function(){return r}}):t(new Error("Can't get player signed"))}))},e.canSubscribeBotAsync=function(){return new(d())((function(n){n(!1)}))},e.subscribeBotAsync=function(){return new(d())((function(n,t){t(new Error("Unsupported"))}))},e.getStatsAsync=function(n){var t=this;return void 0===n&&(n=[]),new(d())((function(e,r){t.validateIsLogged(r);var i=G()(n).call(n,(function(n){return F+n}));e(t.getDataAsync(i))}))},e.setStatsAsync=function(n){var t=this;return new(d())((function(e,r){t.validateIsLogged(r);for(var i=B()(n),s=G()(i).call(i,(function(n){return F+n})),o={},a=0;a<i.length;a++)o[s[a]]=n[i[a]];e(t.setDataAsync(o))}))},e.incrementStatsAsync=function(n){var t=this;return new(d())((function(e,r){t.validateIsLogged(r);var i=B()(n);t.getStatsAsync(i).then((function(r){var s={};i.forEach((function(t){s[t]=Number(r[F+t])+n[t]})),t.setStatsAsync(s).then((function(){return e(s)}))}))}))},e.getConnectedPlayersAsync=function(n){var t=this,e=GameCore.Configs.AppToken;return new(d())((function(r){n?t.sdk.send("VKWebAppCallAPIMethod",{method:"users.get",request_id:"connectedPlayers",params:{user_ids:n.join(","),fields:"photo",v:"5.131",access_token:e}}).then((function(n){var t=[];n.response.forEach((function(n){t.push({getID:function(){return n.id},getName:function(){return n.first_name+" "+n.last_name},getPhoto:function(){return n.photo||"./assets/images/others/avatar.png"}})})),r(t)})).catch((function(){r([])})):r([])}))},e.isGuest=function(){if(!this.player)return!0;var n=this.getID();return!n||"GUEST"==x()(n).call(n,0,5)},e.validateIsLogged=function(n){this.player||n(new Error("Player is not initialized"))},t}(p),H=j,J=function(n){function t(t){var e;return(e=n.call(this)||this).sdk=void 0,e.player=void 0,e.context=void 0,e.graphApi=void 0,e.tournament=void 0,e.rewardedAdInstance=void 0,e.interstitialAdInstance=void 0,e.currentPercentLoading=0,e.platform=void 0,e.initSDKAsync=function(){return new(d())((function(n){e.player=new H(e.sdk),e.context=new _(e.sdk),e.rewardedAdInstance=new D("rewarded",e.sdk),e.interstitialAdInstance=new D("interstitial",e.sdk);var t=e.sdk.send("VKWebAppGetClientVersion",{});d().all([t,e.player.initPlayerAsync()]).then((function(n){var t=n[0];n[1];e.platform=t.platform})).finally(n)}))},e.sdk=t,e}(0,o.A)(t,n);var e=t.prototype;return e.getLocale=function(){return"ru"},e.getSDKVersion=function(){return"1.0"},e.getSupportedAPIs=function(){return["getLocale","getSDKVersion","initializeAsync","startGameAsync","setLoadingProgress","getInterstitialAdAsync","getRewardedVideoAsync","getPlatform","loadBannerAdAsync","hideBannerAdAsync"]},e.initializeAsync=function(){var n=(0,s.A)(c().mark((function n(){var t;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,(t=document.getElementById("lds-content"))||((t=document.createElement("div")).id="lds-content",t.innerHTML='<div id="lds-content"><div id="loading-game-icon-blur"></div><div id="loading-game-icon"></div><div id="lds-text"><span id="lds-percent">0</span>% \u043d\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u044b\u0439</div></div>',"complete"===document.readyState?document.body.appendChild(t):window.addEventListener("load",(function(){t&&document.body.appendChild(t)}))),t.hidden=!1,n.next=6,this.sdk.send("VKWebAppInit",{});case 6:return n.next=8,this.initSDKAsync();case 8:n.next=14;break;case 10:throw n.prev=10,n.t0=n.catch(0),console.error("initializeAsync",n.t0),n.t0;case 14:case"end":return n.stop()}}),n,this,[[0,10]])})));return function(){return n.apply(this,arguments)}}(),e.startGameAsync=function(){var n;return this.setLoadingProgress(100),null==(n=document.getElementById("lds-content"))||n.remove(),d().resolve()},e.setLoadingProgress=function(n){var t=document.getElementById("lds-percent");t&&(this.currentPercentLoading=Math.round(Math.max(Math.min(n,100),this.currentPercentLoading)),t.innerHTML=""+this.currentPercentLoading,this.currentPercentLoading=n)},e.setSessionData=function(n){},e.shareAsync=function(n){return this.inviteAsync((0,S.A)({},n))},e.updateAsync=function(n){return new(d())((function(n,t){t(new Error("Unsupported"))}))},e.switchGameAsync=function(n){return new(d())((function(n,t){t(new Error("Unsupported"))}))},e.canCreateShortcutAsync=function(){var n=this;return new(d())((function(t){n.sdk.send("VKWebAppAddToHomeScreenInfo").then((function(n){t(n.is_feature_supported&&n.is_added_to_home_screen)}))}))},e.createShortcutAsync=function(){var n=this;return new(d())((function(t,e){n.sdk.send("VKWebAppAddToHomeScreen").then((function(n){n.result?t():e()}))}))},e.logEvent=function(){return null},e.onPause=function(n){},e.getInterstitialAdAsync=function(n){var t=this;return new(d())((function(n){n(t.interstitialAdInstance)}))},e.getRewardedVideoAsync=function(n){var t=this;return new(d())((function(n){n(t.rewardedAdInstance)}))},e.matchPlayerAsync=function(n){return new(d())((function(n,t){t(new Error("Unsupported"))}))},e.checkCanPlayerMatchAsync=function(){return new(d())((function(n,t){t(!1)}))},e.getLeaderboardAsync=function(n){return d().reject()},e.postSessionScoreAsync=function(n){return new(d())((function(n,t){t(new Error("Unsupported"))}))},e.getPlatform=function(){return"web"!==this.platform?"MOBILE_WEB":"WEB"},e.inviteAsync=function(n){var t=this;return new(d())((function(n,e){setTimeout(e,3e3),t.sdk.send("VKWebAppShowInviteBox",{}).then((function(){e()})).catch((function(){e()}))}))},e.getTournamentAsync=function(){return d().reject(new Error("Unsupported"))},e.loadBannerAdAsync=function(){var n=(0,s.A)(c().mark((function n(t){var e;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.sdk.send("VKWebAppShowBannerAd",{banner_location:t});case 3:e=n.sent,console.log("bannerInfo",e),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),console.warn("loadBannerAdAsync",n.t0);case 10:case"end":return n.stop()}}),n,this,[[0,7]])})));return function(t){return n.apply(this,arguments)}}(),e.setBannerAdSize=function(n,t){},e.hideBannerAdAsync=function(){var n=(0,s.A)(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.sdk.send("VKWebAppHideBannerAd");case 3:n.next=8;break;case 5:n.prev=5,n.t0=n.catch(0),console.warn("hideBannerAdAsync",n.t0);case 8:case"end":return n.stop()}}),n,this,[[0,5]])})));return function(){return n.apply(this,arguments)}}(),e.showGameRating=function(){var n=(0,s.A)(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",d().reject());case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),e.showLeaderboard=function(n){this.sdk.send("VKWebAppShowLeaderBoardBox",{user_result:n})},e.happyTime=function(){},e.shareLinkAsync=function(n){return d().reject(new Error("Unsupported"))},t}(f),Q=J;"FBInstant"in window&&(window.GameSDK=new w(window.FBInstant)),"vkBridge"in window&&(window.GameSDK=new Q(i())),window.FBInstant=window.GameSDK}}]);