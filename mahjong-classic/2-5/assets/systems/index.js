System.register("chunks:///systems.js",["./rollupPluginModLoBabelHelpers-0ce78aec.js","cc","./GeneralUtils-042f562d.js"],(function(e,t){var n,r,a,i,s,o,c,u,l,d,h,f,p,v,y,m,g,w,S,E,b,k,A,_,x,C,D,R,T,L,F,P,N,M,O,I,U,G,B,H,z,V,j,q,W,Y,Q,K,J,X,Z,$,ee,te,ne,re,ae,ie,se,oe,ce,ue,le,de,he;return{setters:[function(e){n=e._,r=e.f,a=e.g,i=e.h,s=e.c,o=e.d,c=e.i,u=e.j,l=e.k,d=e.l,h=e.m,f=e.a,p=e.b},function(e){v=e.cclegacy,y=e.game,m=e.settings,g=e.Settings,w=e.AssetManager,S=e.director,E=e.input,b=e.Input,k=e.sys,A=e.macro,_=e.DynamicAtlasManager,x=e.view,C=e.ResolutionPolicy,D=e.Size,R=e.screen,T=e.Director,L=e.Texture2D,F=e.assetManager,P=e.Layers,N=e.ImageAsset,M=e.instantiate,O=e.Prefab,I=e.Game,U=e.gfx,G=e._decorator,B=e.rendering,H=e.Component},function(e){z=e.G,V=e.A,j=e.a,q=e.C,W=e.P,Y=e.b,Q=e.c,K=e.I,J=e.E,X=e.d,Z=e.R,$=e.L,ee=e.e,te=e.f,ne=e.S,re=e.g,ae=e.D,ie=e.h,se=e.i,oe=e.M,ce=e.j,ue=e.k,le=e.l,de=e.m,he=e.n}],execute:function(){var e,t,fe,pe={text:{"core.nameless":"Nameless",BLANK:"",dh:"%{0}d %{1}h",dhm:"%{0}d %{1}h %{2}m",dhms:"%{0}d %{1}h %{2}m %{3}s",hms:"%{0}h %{1}m %{2}s",hm:"%{0}h %{1}m",ms:"%{0}m %{1}s",h:"%{0}h",m:"%{0}m",s:"%{0}s",vDays:"%{0} days",matches:"Matches",match:"Match",score:"Score",level:"Level",levelV:"Level %{0}",firstTutor1:"Match two of the same tile",firstTutor2:"Match the top tile to unlock other tiles",firstTutor3:"Match the tiles on the side to unlock other tiles",lockedByAboveTiles:"Locked by above tiles",lockedByLeftAndRight:"Locked by left and right",music:"Music",sound:"Sound",vibrate:"Vibrate",ON:"ON",OFF:"OFF",NO:"NO",YES:"YES",adsNotComplete:"Sorry, No Rewards! You have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",noAdsError:"No ads to display!",noReward:"Sorry, No Rewards!\nYou have cancelled the ad!",greatJob:"\nGreat job! Rest up for a bit...",settings:"Settings",highlightFreeTiles:"Highlight Free Tiles",theme:"Theme",joinFacebookGroup:"Join Facebook Group",restart:"Restart","version:V":"Version: %{0}",join:"Join",tiles:"Tiles",background:"Background",confirm:"Confirm",classic:"Classic",violet:"Violet",antique:"Antique",simple:"Simple",details:"Details",removedForVDays:"Popup Ads are removed for %{0} days",removedFor1Day:"Popup Ads are removed for 1 day",purchased:"Purchased",purchaseFailed:"Purchase failed",cancelPayment:"You have canceled payment!",paymentError:"There was an error\nduring the payment!\nPlease try again.",removeAdPolicy:"When you purchase the No Ads 30-Day, you will enjoy an ad-free experience in the game for 30 days from the date of purchase. This is a one-time purchase and does not automatically renew. After it expires, ads will be displayed again unless a new one is purchased. Please note that some in-game promotions, rewarded ads (such as optional ads for bonuses), or third-party content may still be displayed. By purchasing, you agree to these terms, and the developers reserve the right to modify this policy at any time without prior notice.",outOfMoves:"Out Of Moves!","shuffle -1":"Shuffle -1",shuffle:"Shuffle","useShuffle?":"Use shuffle?",watchVideoShuffle:"Watch a video to get a shuffle.",watchVideoUndo:"Watch a video to get an undo.",watchVideoHint:"Watch a video to get a hint.",getOne:"Get One",freeShuffle:"Free Shuffle",freeUndo:"Free Undo",freeHint:"Free Hint",collectx2:"Collect x2",collect:"Collect",WELLDONE:"WELL DONE!",wellDone:"Well done!","score:":"Score:",NailedLikeAChamp:"That level wasn't easy, but you nailed it like a champ!",reachLevelV:"Reach Level %{0}",noMatchableTiles:"No matchable tiles",matchableTilesHighlighted:"Matchable tiles highlighted","Can'tUndo":"Can't use the undo props now",findOpponent:"Find Opponent",back:"Back",youWin:"You Win!",youLose:"You Lose!",waitingForOpponent:"Waiting your opponent",newMatch:"New Match",Home:"Home",lanternChallenge:"Lantern Challenge",LANTERN_CHALLENGE:"LANTERN CHALLENGE",start:"Start",lanternChallengeStart:"Lantern Challenge has started! Collect golden tiles to level up and earn awesome rewards!",winLevels:"Win Levels!",collectLanternTiles:"Collect Lantern Tiles!",improveRanking:"Improve Ranking !",tapToContinue:"Tap To Continue","RANK_#V_REWARD":"RANK #%{0} REWARD",you:"You",continue:"Continue",tournamentCreateFail:"Oops!\n You are not able to create\ntournaments right now.\n\nPlease try again later.",cannotJoinTournament:"Sorry, you cannot join at this time.",creatingTournament:"Creating tournament...",failedToJoinTournament:"Failed to join tournament",noTournamentAvailable:"No tournament available",languages:"Languages",winXLevels:"Win %{0} levels",useXItems:"Use %{0} items",matchXTiles:"Match %{0} tiles",stageX:"Stage %{0}",DailyTask:"Daily Task",Play:"Play","youNeedToCompleteThePreviousStageFirst.":"You need to complete the previous stage first.",reachComboX:"Reach combo %{0}",flowerTutor:"These tiles are called Flower. Any two of them can be matched!",seasonTutor:"These tiles are called Season. Any two of them can be matched!",close:"Close",timeHms:"%{0}:%{1}:%{2}",customString:"%{0}",leaderboardEmpty:"Leaderboard is empty.",WELCOME_BACK:"Welcome Back",playWithFriend:"Play with friend",playWithFriendStart:"Challenge a mighty opponent","1day":"1 day",followPage:"Follow Page",dailyChallenge:"Daily Challenge",date:"Date",play:"Play",dailyReward:"Daily Reward",pickDailyGift:"Pick your daily gift!",congratulations:"Congratulations!",Badges:"Badges",Daily:"Daily",Journey:"Journey",failedToLoadBadge:"Failed to load badge. Please try again later!",Shop:"Shop",removeAdsFor30Days:"Remove Ads for 30 days",collection:"Collection","You have received":"You have received",free:"Free",exceptional:"Exceptional!",dailyQuestCompleted:"Daily Quest Completed!",unClaimedDailyQuestReward:"Unclaimed Daily Quest Reward",xAdsLeftToday:"%{0} ads left for this item today.",youHaveReachedTheDailyAdLimit:"You have reached the daily ad limit.",limitedToXPerDay:"Limited to %{0} per day","1AdLeftToday":"1 ad left for this item today.",nextLevel:"Next level",next:"Next",wonderful:"Wonderful!",observeCarefully:"You observed carefully and steadily earned a clear victory!",poker:"Poker",cherryBlossom:"Cherry Blossom Festival",springDolls:"Spring Dolls",teaCeremony:"Tea Ceremony",impressive:"Impressive!",yourJourneyRewardAreEmpty:"Your journey rewards are empty. Start playing to collect rewards!",unlockLvV:"Unlock Lv %{0}",completeJourneyText:"This journey has been completed. New journey coming soon.",return:"Return",megaBundle:"Mega Bundle",superBundle:"Super Bundle","50off":"50% Off",flower:"Flower",youDraw:"You Draw!",autoZoom:"Auto Scaling",halloween:"Halloween",eventStart:"The event has started!",joinAndEmbark:"Join us and embark on an enjoyable journey.",thanksgiving:"Thanksgiving"},texture:{image:"image",Combo:"Combo",Amazing:"Amazing",Awesome:"Awesome",Great:"Great",Good:"Good"}};v._RF.push({},"0b067Iz+iFJLJjNpsfblY7S","AdsManager",void 0);var ve=Ludex,ye=ve.Events,me=ve.Configs.Ads,ge=me.Enabled,we=me.PreloadAds,Se=me.ShowAdOnLoad,Ee=me.BannerDisplayAdOptions,be=ve.Utils,ke=be.Time,Ae=be.Decorator,_e=codex.event,xe=(e=Ae.tryCatch(),fe=n((t=function(){function e(){var t=this;s(this,e),this.currentLayout="",this.processShowBannerAds=function(){V.showBannerAds()},this.processPreloadAds=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(we){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ke.sleepAsync(3e3);case 4:V.preloadAds();case 5:case"end":return e.stop()}}),e)}))),o(this,"processShowFirstInterstitialAd",fe,this),this.handleLayoutChanged=function(e){t.currentLayout!==e&&(t.currentLayout=e,e!==j.Layout.Landscape?Ee.forEach((function(e){var t=e.PlacementId,n=e.Position;"bottom"===n||"top"===n?V.showBannerAd(t):V.hideBannerAd(t)})):t.processShowBannerAds())}}return r(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){y.on(z.LAYOUT_CHANGED,this.handleLayoutChanged),_e.catchUp(ye.GAME_READY,this.processPreloadAds),_e.catchUp(ye.GAME_READY,this.processShowBannerAds),_e.catchUp(ye.GAME_SDK_READY,this.processShowFirstInterstitialAd)}}]),e}()).prototype,"processShowFirstInterstitialAd",[e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return a(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ge){e.next=2;break}return e.abrupt("return");case 2:if(t=Se.Enabled,n=Se.DelaySeconds,t){e.next=5;break}return e.abrupt("return");case 5:if(!(n>0)){e.next=8;break}return e.next=8,ke.sleepAsync(1e3*n);case 8:return(r="Yandex"===GameSDK.getSDKName())&&y.pause(),e.next=12,V.showInterstitialAdAsync({forceLoad:!0,contextType:"preroll"});case 12:r&&y.resume();case 13:case"end":return e.stop()}}),e)})))}}),t);v._RF.pop(),v._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var Ce=Ludex.Events,De=codex.event,Re=function(){function e(){s(this,e)}return r(e,[{key:"init",value:function(){console.info("Core Manager: Initialized")}},{key:"requestStart",value:function(){De.emit(Ce.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(e){De.catchUp(Ce.CORE_BOOTING,e)}},{key:"onCoreStart",value:function(e){De.catchUp(Ce.CORE_STARTING,e)}},{key:"onCoreReady",value:function(e){De.catchUp(Ce.CORE_READY,e)}}]),e}();v._RF.pop(),v._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var Te=Ludex,Le=Te.Events,Fe=Te.Configs.GameEngine,Pe=Fe.DynamicAtlas,Ne=Fe.PreferredFPS,Me=Te.Utils,Oe=Me.Valid,Ie=Me.Device,Ue=codex.event,Ge=function(){function e(){var t=this;s(this,e),this.handlePauseEngine=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y.isPaused()){e.next=2;break}return e.abrupt("return");case 2:case"end":return e.stop()}}),e)}))),this.handleResumeEngine=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.restoreRequestAnimationFrame(),y.isPaused()){e.next=3;break}return e.abrupt("return");case 3:case"end":return e.stop()}}),e)})))}var t;return r(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),console.info("Engine Manager: Initialized")}},{key:"overrideSettings",value:function(){m.overrideSettings(g.Category.ENGINE,"debug",Oe.isDebugger()),Ie.isDesktop()?y.frameRate=Ne.Desktop:y.frameRate=Ne.Mobile}},{key:"setupAutoAtlas",value:function(){w.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var e=w.instance.downloader;e.maxConcurrency=30,e.maxRequestsPerFrame=30}},{key:"getPipelineFlows",value:function(){var e,t;return null!==(e=null===(t=S.root)||void 0===t||null===(t=t.pipeline)||void 0===t?void 0:t.flows)&&void 0!==e?e:[]}},{key:"getRenderQueues",value:function(e){var t=this.getPipelineFlows()[0];return null!=t&&t.stages?t.stages[e].renderQueues:[]}},{key:"setupOptimalPipelines",value:(t=a(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w.instance.transformPipeline.remove(1),e.abrupt("return");case 4:return e.next=6,Oe.isValueChangeAsync((function(){return!!S.root}),!0,{timeout:1e4});case 6:(t=this.getPipelineFlows()).shift(),t.shift(),(n=this.getRenderQueues(0)).shift(),n.shift();case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var e=this;E.on(b.EventType.TOUCH_START,this.handleResumeEngine),Ue.catchUp(Le.GAME_READY,(function(){Ue.on(Le.VISIBILITY_HIDDEN,e.handlePauseEngine),Ue.on(Le.VISIBILITY_VISIBLE,e.handleResumeEngine),e.restoreRequestAnimationFrame()}))}},{key:"restoreRequestAnimationFrame",value:function(){window.isCustomRequestAnimationFrame=!1}},{key:"setupDynamicAtlas",value:function(){switch(k.os){case k.OS.IOS:this.setupDynamicAtlasForIOS();break;case k.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(e){var t=e.Enabled,n=e.AutoAtlasSize,r=e.MaxAtlasCount,a=e.MaxAtlasSize,i=e.MaxFrameSize;if(A.CLEANUP_IMAGE_CACHE=!t,_.instance.enabled=t,_.instance.textureSize=a,_.instance.maxFrameSize=i,_.instance.maxAtlasCount=r,_.instance.textureBleeding=Pe.TextureBleeding,n){var s=this.getMaxTextureSize();if(!s)return;_.instance.textureSize=s}}},{key:"getMaxTextureSize",value:function(){if(!S.root)return-1;var e=S.root.device.capabilities.maxTextureSize;if(e>8192)return 7168;var t=_.instance.maxFrameSize,n=e-1024;return n<=(void 0===t?0:t)||n<=0?-1:n}},{key:"setupDynamicAtlasForIOS",value:function(){var e=Pe.IOS;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForAndroid",value:function(){var e=Pe.Android;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForDesktop",value:function(){var e=Pe.Desktop;this.setDynamicAtlas(e)}},{key:"setupBatcherLimit",value:function(){A.BATCHER2D_MEM_INCREMENT=288,A.MAX_LABEL_CANVAS_POOL_SIZE=125}}]),e}();v._RF.pop();var Be,He=new(function(){function e(){s(this,e),this._registry={},this._moduleCache={}}return r(e,[{key:"define",value:function(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function(e,t){throw new Error("Module '".concat(e,"' imported from '").concat(t,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(e,t){var n=this._moduleCache[e];if(n)return n.exports;var r={id:e,exports:{}};return this._moduleCache[e]=r,this._tryModuleLoad(r,e),r.exports}},{key:"_resolve",value:function(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function(e,t){var n,r;return e in cjsInfos?e:t&&null!==(n=null===(r=cjsInfos[t])||void 0===r?void 0:r.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function(e,t){var n=this._loadWrapper(t),r=n.factory,a=n.resolveMap,i=this._createRequire(e),s=a?this._createRequireWithResolveMap("function"==typeof a?a():a,i):i;r(e.exports,s,e)}},{key:"_loadWrapper",value:function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function(e){return{factory:function(t,n,r){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(e,"'."));try{r.exports=require(e)}catch(t){throw new Error("Exception thrown when calling host defined require('".concat(e,"')."),{cause:t})}}}}},{key:"_createRequire",value:function(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function(e,t){return function(n){var r=e[n];if(r)return t(r);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function(e,t){throw new Error("Unable to resolve ".concat(e," from ").concat(parent,"."))}}]),e}());function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Ve,je,qe,We="file:///Users/anhquan/Desktop/Repository/vita-mahjong/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";He.define(We,(function(e,t,n,r,a){!function(t,r){"object"===ze(e)&&void 0!==n?n.exports=r():"function"==typeof define&&define.amd?define(r):t.ResizeObserver=r()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,r){return e[0]===t&&(n=r,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),r=this.__entries__[n];return r&&r[1]},t.prototype.set=function(t,n){var r=e(this.__entries__,t);~r?this.__entries__[r][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,r=e(n,t);~r&&n.splice(r,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,r=this.__entries__;n<r.length;n++){var a=r[n];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),r="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],i="undefined"!=typeof MutationObserver,s=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,a=!1,i=0;function s(){n&&(n=!1,e()),a&&c()}function o(){r(s)}function c(){var e=Date.now();if(n){if(e-i<2)return;a=!0}else n=!0,a=!1,setTimeout(o,t);i=e}return c}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),i?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;a.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),o=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},c=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},u=v(0,0,0,0);function l(e){return parseFloat(e)||0}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+l(e["border-"+n+"-width"])}),0)}function h(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return u;var r=c(e).getComputedStyle(e),a=function(e){for(var t={},n=0,r=["top","right","bottom","left"];n<r.length;n++){var a=r[n],i=e["padding-"+a];t[a]=l(i)}return t}(r),i=a.left+a.right,s=a.top+a.bottom,o=l(r.width),h=l(r.height);if("border-box"===r.boxSizing&&(Math.round(o+i)!==t&&(o-=d(r,"left","right")+i),Math.round(h+s)!==n&&(h-=d(r,"top","bottom")+s)),!function(e){return e===c(e).document.documentElement}(e)){var f=Math.round(o+i)-t,p=Math.round(h+s)-n;1!==Math.abs(f)&&(o-=f),1!==Math.abs(p)&&(h-=p)}return v(a.left,a.top,o,h)}var f="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof c(e).SVGGraphicsElement}:function(e){return e instanceof c(e).SVGElement&&"function"==typeof e.getBBox};function p(e){return t?f(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):h(e):u}function v(e,t,n,r){return{x:e,y:t,width:n,height:r}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=p(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),m=function(e,t){var n,r,a,i,s,c,u,l=(r=(n=t).x,a=n.y,i=n.width,s=n.height,c="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(c.prototype),o(u,{x:r,y:a,width:i,height:s,top:a,right:r+i,bottom:s+a,left:r}),u);o(this,{target:e,contentRect:l})},g=function(){function t(t,n,r){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=r}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof c(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof c(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new m(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),w="undefined"!=typeof WeakMap?new WeakMap:new e,S=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=s.getInstance(),r=new g(t,n,this);w.set(this,r)};return["observe","unobserve","disconnect"].forEach((function(e){S.prototype[e]=function(){var t;return(t=w.get(this))[e].apply(t,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:S})),Be=n.exports}),{}),He.require(We),v._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var Ye=j.Layout,Qe=j.DesignSize,Ke=Qe.Portrait,Je=Qe.Landscape,Xe=j.AcceptPortraitRatio,Ze=Ludex,$e=Ze.Utils,et=$e.Device,tt=$e.Decorator,nt=Ze.Configs.GameEngine.AutoResizeCanvas,rt=(Ve=tt.debounce(100),qe=n((je=function(){function e(){var t=this;s(this,e),this.handleViewResizeBySystem=function(e){if(!t.isAdShowing()){var n=et.pixelRatio();console.debug("üì± View resize by system",{pixelRatio:e,dpr:n}),window.devicePixelRatio=null!=e?e:n,t.setupOrientationByCanvasSize()}},o(this,"handleBodyResize",qe,this)}return r(e,[{key:"init",value:function(){this.listenResizeEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){if(nt){var e,t=null!==(e=window.__listeners.resize)&&void 0!==e?e:[];if(t.length>0){var n,r=c(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;window.removeEventListener("resize",a)}}catch(e){r.e(e)}finally{r.f()}}new Be(this.handleBodyResize).observe(window.document.body)}y.on(z.REQUEST_VIEW_RESIZE,this.handleViewResizeBySystem)}},{key:"setupResolutionPolicy",value:function(){x.setOrientation(A.ORIENTATION_AUTO),this.resolutionPolicy=x.getResolutionPolicy(),this.resolutionPolicy.setContentStrategy(C.ContentStrategy.EXACT_FIT),this.resolutionPolicy.setContainerStrategy(C.ContainerStrategy.PROPORTION_TO_FRAME)}},{key:"isAdShowing",value:function(){return!!codex.ads.isAdFullSizeShowing()&&(console.error("‚ö†Ô∏è LayoutManager:handleViewResize skipped because ad is showing"),!0)}},{key:"setupOrientationByCanvasSize",value:function(){var e=this.getScreenRatio();switch(j.PRIMARY_LAYOUT){case"portrait":this.setPortraitView();break;case"landscape":this.setLandscapeView();break;case"auto":e<=Xe?this.setPortraitView():this.setLandscapeView()}}},{key:"setPortraitView",value:function(){var e=Ke.WIDTH,t=Ke.HEIGHT,n=j.PRIMARY_LAYOUT===Ye.Portrait;(this.currentLayout!==Ye.Portrait||n)&&(this.currentLayout=Ye.Portrait,this.setupLayoutStrategy(e,t)),this.resizeGameView(e,t)}},{key:"setLandscapeView",value:function(){var e=Je.WIDTH,t=Je.HEIGHT,n=j.PRIMARY_LAYOUT===Ye.Landscape;(this.currentLayout!==Ye.Landscape||n)&&(this.currentLayout=Ye.Landscape,this.setupLayoutStrategy(e,t)),this.resizeGameView(e,t)}},{key:"setupLayoutStrategy",value:function(e,t){var n=x.getDesignResolutionSize(),r=n.width,a=n.height,i=this.resolutionPolicy.getContentStrategy(),s=this.resolutionPolicy._containerStrategy.name,o=this.currentLayout===Ye.Portrait,c=this.currentLayout===Ye.Landscape;o&&this.resolutionPolicy.setContentStrategy(C.ContentStrategy.FIXED_WIDTH),c&&this.resolutionPolicy.setContentStrategy(C.ContentStrategy.FIXED_HEIGHT),o&&!j.FULL_PORTRAIT_SIZE&&(this.resolutionPolicy.setContentStrategy(C.ContentStrategy.SHOW_ALL),this.resolutionPolicy.setContainerStrategy(C.ContainerStrategy.PROPORTION_TO_FRAME)),c&&!j.FULL_LANDSCAPE_SIZE&&(this.resolutionPolicy.setContentStrategy(C.ContentStrategy.EXACT_FIT),this.resolutionPolicy.setContainerStrategy(C.ContainerStrategy.PROPORTION_TO_FRAME)),this.getScreenRatio()>j.AcceptPortraitRatio&&o&&this.resolutionPolicy.setContentStrategy(C.ContentStrategy.FIXED_HEIGHT),o&&this.resolutionPolicy.setContainerStrategy(C.ContainerStrategy.EQUAL_TO_FRAME),c&&this.resolutionPolicy.setContainerStrategy(C.ContainerStrategy.EQUAL_TO_FRAME),r===e&&a===t&&i===this.resolutionPolicy.getContentStrategy()&&s===this.resolutionPolicy._containerStrategy.name||x.setDesignResolutionSize(e,t,this.resolutionPolicy),console.debug("üî• Change layout to",this.currentLayout,this.resolutionPolicy),y.emit(z.LAYOUT_CHANGED,this.currentLayout)}},{key:"resizeGameView",value:function(e,t){var n=j.DesignSize.Resolution,r=new D(e/n,t/n),a=q.getScreenWidthCss(),i=q.getScreenHeightCss(),s=a/r.width,o=i/r.height,c=new D(r.width,r.height),u=this.currentLayout===Ye.Portrait,l=this.currentLayout===Ye.Landscape;if(u||l)c.width*=s,c.height*=o;else{var d=Math.min(s,o);c.width*=d,c.height*=d}var h=q.worldSizeToCssSize(c.width),f=q.worldSizeToCssSize(c.height),p=new D(h,f);R.windowSize=p,y.emit(z.VIEW_RESIZED,p),console.info("üî• View Resized",p)}},{key:"getScreenRatio",value:function(){return q.getScreenWidthCss()/q.getScreenHeightCss()}}]),e}()).prototype,"handleBodyResize",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){if(!e.isAdShowing()){var t=et.pixelRatio();console.debug("üì± View resize by body",{dpr:t}),window.devicePixelRatio=t,e.setupOrientationByCanvasSize()}}}}),je);v._RF.pop(),v._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var at=Ludex,it=at.Utils.Valid,st=at.Dtos.Player,ot=codex.player,ct=function(){function e(){s(this,e)}return r(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){st.Data.addDefaultData(W),st.Settings.addDefaultData(Y),st.GameData.addDefaultData(Q),st.GameData.addValidateFunction("totalLevel",(function(e){if(!it.isNumber(e)||e<1)throw new Error("totalLevel ".concat(e," is invalid"))})),st.GameData.addValidateFunction("passAllLevels",(function(e){if(!it.isBoolean(e))throw new Error("passAllLevels ".concat(e," is invalid"))})),st.GameData.addValidateFunction("levelProgress",(function(e){if(!it.isObject(e))throw new Error("levelProgress ".concat(e," is invalid"))})),st.GameData.addValidateFunction("endlessScore",(function(e){if(!it.isNumber(e)||e<0)throw new Error("endlessScore ".concat(e," is invalid"))})),st.GameData.addValidateFunction("items",(function(e){if(!it.isObject(e))throw new Error("items ".concat(e," is invalid"));var t=Object.keys(e);if(t.length!==Object.keys(K).length)throw new Error("items ".concat(e," is invalid"));for(var n=0,r=t;n<r.length;n++){var a=e[r[n]];if(!it.isObject(a))throw new Error("items ".concat(e," is invalid"));if(!it.isNumber(a.count)||a.count<0)throw new Error("items ".concat(e," is invalid"));if(!it.isBoolean(a.isFirstUse))throw new Error("items ".concat(e," is invalid"))}})),st.GameData.addValidateFunction("removeAdEndTime",(function(e){if(!it.isNumber(e)||e<0)throw new Error("removeAdEndTime ".concat(e," is invalid"))})),st.Settings.addValidateFunction("highLight",(function(e){if(!it.isBoolean(e))throw new Error("highLight ".concat(e," is invalid"))})),st.Settings.addValidateFunction("autoZoom",(function(e){if(!it.isBoolean(e))throw new Error("autoZoom ".concat(e," is invalid"))})),st.Settings.addValidateFunction("theme",(function(e){if(!it.isObject(e))throw new Error("theme ".concat(e," is invalid"))})),st.GameData.addValidateFunction("tournamentData",(function(e){if(!it.isObject(e))throw new Error("tournamentData ".concat(e," is invalid"));var t=e,n=t.tournamentId,r=t.leaderboardId,a=t.endTime,i=t.bestScore,s=t.lastTournamentRankReward,o=t.isPlayerJoined,c=t.isFirstTimeJoinedTournament;if(!it.isString(n))throw new Error("tournamentId ".concat(n," is invalid"));if(!it.isString(r))throw new Error("leaderboardId ".concat(r," is invalid"));if(!it.isNumber(a)||a<0)throw new Error("endTime ".concat(a," is invalid"));if(!it.isNumber(i)||i<0)throw new Error("bestScore ".concat(i," is invalid"));if(!it.isNumber(s)||s<0)throw new Error("lastTournamentRankReward ".concat(s," is invalid"));if(!it.isBoolean(o))throw new Error("isPlayerJoined ".concat(o," is invalid"));if(!it.isBoolean(c))throw new Error("isFirstTimeJoinedTournament ".concat(c," is invalid"))})),st.GameData.addValidateFunction("dailyQuest",(function(e){if(!it.isObject(e))throw new Error("dailyQuest ".concat(e," is invalid"));var t=e,n=t.currentStage,r=t.quests,a=t.rewarded;if(!it.isNumber(n)||n<1)throw new Error("currentStage ".concat(n," is invalid"));if(!Array.isArray(r))throw new Error("quests ".concat(r," is invalid"));if(!Array.isArray(a))throw new Error("rewarded ".concat(a," is invalid"))})),st.GameData.addValidateFunction("journeyData",(function(e){if(!it.isObject(e))throw new Error("journeyData ".concat(e," is invalid"));var t=e,n=t.currentLevel,r=t.lastSeason,a=t.claimBadges;if(!it.isNumber(n)||n<1)throw new Error("currentLevel ".concat(n," is invalid"));if(!it.isNumber(r))throw new Error("lastSeason ".concat(r," is invalid"));if(!Array.isArray(a))throw new Error("claimBadges ".concat(a," is invalid"))})),st.GameData.addValidateFunction("lastClaimDailyReward",(function(e){if(!it.isNumber(e)||e<0)throw new Error("lastClaimDailyReward ".concat(e," is invalid"))})),st.GameData.addValidateFunction("dailyChallenge",(function(e){if(!Array.isArray(e))throw new Error("dailyChallenge ".concat(e," is invalid"));var t,n=c(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!it.isString(r))throw new Error("dailyChallenge ".concat(r," is invalid"))}}catch(e){n.e(e)}finally{n.f()}})),st.GameData.addValidateFunction("limitAds",(function(e){if(!it.isObject(e))throw new Error("limitAds ".concat(e," is invalid"));var t=e,n=t.shuffleItem,r=t.hintItem,a=t.lastWatchedAdTime;if(!it.isNumber(n)||n<0)throw new Error("shuffleItem ".concat(n," is invalid"));if(!it.isNumber(r)||r<0)throw new Error("hintItem ".concat(r," is invalid"));if(!it.isNumber(a)||a<0)throw new Error("lastWatchedAdTime ".concat(a," is invalid"))})),st.GameData.addValidateFunction("social",(function(e){if(!it.isObject(e))throw new Error("social ".concat(e," is invalid"));var t=e,n=t.createPlayerTournament,r=t.playWithFriend,a=t.joinGlobalTournament;if(!it.isObject(n))throw new Error("createPlayerTournament ".concat(n," is invalid"));if(!it.isObject(r))throw new Error("playWithFriend ".concat(r," is invalid"));if(!it.isObject(a))throw new Error("joinGlobalTournament ".concat(a," is invalid"));var i=n.success,s=n.failed,o=r.success,c=r.failed,u=a.success,l=a.failed;if(!it.isNumber(i)||i<0)throw new Error("createPlayerTournament.success ".concat(i," is invalid"));if(!it.isNumber(s)||s<0)throw new Error("createPlayerTournament.failed ".concat(s," is invalid"));if(!it.isNumber(o)||o<0)throw new Error("playWithFriend.success ".concat(o," is invalid"));if(!it.isNumber(c)||c<0)throw new Error("playWithFriend.failed ".concat(c," is invalid"));if(!it.isNumber(u)||u<0)throw new Error("joinGlobalTournament.success ".concat(u," is invalid"));if(!it.isNumber(l)||l<0)throw new Error("joinGlobalTournament.failed ".concat(l," is invalid"))})),st.GameData.addValidateFunction("lastLoginTime",(function(e){if(!it.isNumber(e)||e<1)throw new Error("lastLoginTime ".concat(e," is invalid"))}))}},{key:"requestConnectedPlayers",value:function(){ot.requestConnectedPlayers().catch((function(e){console.warn("player.requestConnectedPlayers",e)}))}}]),e}();v._RF.pop(),v._RF.push({},"c510204p3JAXLCuogskxTkP","AdaptivePerformance",void 0);var ut=Ludex,lt=ut.Events,dt=ut.Utils.Valid,ht=codex,ft=ht.event,pt=ht.adaptivePerformance,vt=function(){function e(){var t=this;s(this,e),this.handleBeginFrame=function(){S.on(T.EVENT_AFTER_UPDATE,t.lateUpdate),S.on(T.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){pt&&pt.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;dt.isNumber(t)&&y.emit(z.REQUEST_VIEW_RESIZE,t)},this.lateUpdate=function(){var e=1e3*y.deltaTime;null==pt||pt.updatePostStepDeltaTime(e)},this.updateActualFPS=function(){var e,t=null===(e=S.root)||void 0===e?void 0:e.fps;dt.isNumber(t)&&(null==pt||pt.updateActualFPS(t))}}return r(e,[{key:"init",value:function(){pt&&this.listenEvents()}},{key:"listenEvents",value:function(){ft.on(lt.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),S.once(T.EVENT_BEGIN_FRAME,this.handleBeginFrame),S.on(T.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();v._RF.pop(),v._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var yt=codex.canvasRecorder,mt=function(){function e(){s(this,e)}return r(e,[{key:"init",value:function(){if(y.canvas&&yt){yt.setCanvas(y.canvas);var e=yt.getOptions(),t=function(){y.pause(),y.step()},n=yt.waitNextFrame;yt.waitNextFrame=function(){var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(a,i){r||yt.isCapturing()?e.syncFps?(S.once(T.EVENT_AFTER_RENDER,a),t()):n(r).then(a).catch(i):y.resume()}))}}}}]),e}();v._RF.pop(),v._RF.push({},"e8b3dVomjtKZ68ykoRs82vP","DailyRewards",void 0);var gt,wt,St,Et=codex.storage,bt=function(){function e(){s(this,e)}return r(e,[{key:"init",value:function(){this.initStorage()}},{key:"initStorage",value:function(){Et.addStorage("dashboardDailyRewards",{hasShownPopup:!1})}}]),e}();v._RF.pop(),v._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var kt,At,_t=Ludex,xt=_t.Configs.GameEngine.DynamicAssets,Ct=xt.Enabled,Dt=xt.Resolution,Rt=xt.IgnoreFiles,Tt=_t.Events,Lt=_t.Utils,Ft=Lt.Array,Pt=Lt.Function,Nt=Lt.Time,Mt=Lt.Decorator,Ot=codex,It=Ot.event,Ut=Ot.storage,Gt=Ot.getBuildVersion,Bt=[".png",".jpg",".jpeg",".webp"],Ht=(gt=Mt.debounce(1e3),St=n((wt=function(){function e(){var t=this;s(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradedAssets={},this.upgradableAssets={},o(this,"handleChangeQuality",St,this),this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.requestUpdateDynamicAssets=function(){y.emit(z.UPGRADE_DYNAMIC_ATLAS,{force:!0})},this.collectUpgradableAssets=function(e){var n,r=e.output=e.input,a=Dt.Adjust,i=Dt.Original,s=a<i?a:i,o=!1,u=c(r);try{for(u.s();!(n=u.n()).done;){var l=n.value;if(Ft.has(Bt,l.ext)&&(!Ft.has(Rt,l.uuid)&&!(window.dynamicAssetsIgnore&&Ft.has(window.dynamicAssetsIgnore,l.uuid)||(l.url=t.replaceAssetUrl(l.url),l.uuid in t.upgradableAssets)))){var d={ext:l.ext,url:l.url,uuid:l.uuid,options:l.options,resolution:s};t.upgradableAssets[l.uuid]=d,o=!0}}}catch(e){u.e(e)}finally{u.f()}o&&y.emit(z.REQUEST_UPGRADE_ASSET)}}var t,n,u,l;return r(e,[{key:"init",value:(l=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.info("DynamicAssets: init",{EDITOR:J,Enabled:Ct}),Ct){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.initStorage();case 5:this.checkCacheVersion(),F.transformPipeline.insert(this.collectUpgradableAssets,2),this.useHighQuality||this.injectTextureResolution(),this.listenEvents();case 10:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"initStorage",value:(u=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ut.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0);case 2:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"checkCacheVersion",value:function(){var e=Gt().toString(),t=Ut.getStorage("DynamicAssets"),n=null!=t?t:{},r=n.buildVersion,a=n.useHighQuality;"boolean"==typeof a&&(this.useHighQuality=a&&r===e),Ut.setStorageData("DynamicAssets","buildVersion",e),Ut.updateToWebStorage("DynamicAssets")}},{key:"listenEvents",value:function(){var e=this;this.useHighQuality||It.catchUp(Tt.GAME_READY,(function(){e.useHighQuality=!0,y.on(z.REQUEST_UPGRADE_ASSET,e.handleChangeQuality)}))}},{key:"injectTextureResolution",value:function(){var e=Dt.Adjust,t=Dt.Original;if(!(e>=t||t<=0)){var n=e/t;Object.defineProperty(L.prototype,"width",{get:function(){var e,t;return this.isValid?this.uuid?(null===(e=this.image.data)||void 0===e||null===(e=e.src)||void 0===e?void 0:e.indexOf("native32/"))>=0?this._width:(console.debug("DynamicAssets: Texture2D image",this),(null===(t=this.image)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.width)/n||this._width):this._width/n:this._width}}),Object.defineProperty(L.prototype,"height",{get:function(){var e,t;return this.isValid?this.uuid?(null===(e=this.image.data)||void 0===e||null===(e=e.src)||void 0===e?void 0:e.indexOf("native32/"))>=0?this._height:(null===(t=this.image)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.height)/n||this._height:this._height/n:this._height}})}}},{key:"saveStateToStorage",value:function(){Ut.setStorageData("DynamicAssets","useHighQuality",this.useHighQuality),Ut.updateToWebStorage("DynamicAssets")}},{key:"updateSpriteFrames",value:(n=a(i().mark((function e(){var t,n,r,a,s,o,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.getScene()){e.next=3;break}return e.abrupt("return");case 3:n=t.getComponentsInChildren("cc.Sprite"),r=c(n),e.prev=5,r.s();case 7:if((a=r.n()).done){e.next=21;break}if(o=a.value,null!=(u=o.spriteFrame)&&u.texture){e.next=12;break}return e.abrupt("continue",19);case 12:if(l=u.texture,this.upgradedAssets[null===(s=l.image)||void 0===s?void 0:s.uuid]){e.next=15;break}return e.abrupt("continue",19);case 15:return o.node.layer=P.Enum.UI_2D,l.updateImage(),e.next=19,Nt.sleepAsync(8);case 19:e.next=7;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(5),r.e(e.t0);case 26:return e.prev=26,r.f(),e.finish(26);case 29:case"end":return e.stop()}}),e,this,[[5,23,26,29]])}))),function(){return n.apply(this,arguments)})},{key:"processUpgradeQualityAsync",value:(t=a(i().mark((function e(t){var n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=F.assets.get(t.uuid))instanceof N){e.next=5;break}return console.warn("DynamicAssets: Asset not found",t.uuid,n),this.upgradedAssets[t.uuid]=!1,e.abrupt("return",!1);case 5:return t.url=this.replaceAssetUrl(t.url),e.abrupt("return",new Promise((function(e){F.loadAny(t,t.options,(function(a,i){if(a)return console.warn("DynamicAssets: Upgrade error",a),void e(!1);n.reset(i),n._nativeUrl=r.replaceAssetUrl(n.nativeUrl),r.upgradedAssets[t.uuid]=!0,y.emit(z.ASSET_QUALITY_CHANGE,{asset:n,item:t}),e(!0)}))})));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}()).prototype,"handleChangeQuality",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return a(i().mark((function t(){var n,r,a,s,o,c;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isProcessing){t.next=2;break}return t.abrupt("return");case 2:t.prev=2,e.isProcessing=!0,n=[],t.t0=i().keys(e.upgradableAssets);case 6:if((t.t1=t.t0()).done){t.next=15;break}if(r=t.t1.value,(a=e.upgradableAssets[r])&&!e.upgradedAssets[r]){t.next=11;break}return t.abrupt("continue",6);case 11:s=e.processUpgradeQualityAsync(a),n.push(s),t.next=6;break;case 15:if(!(n.length<1)){t.next=17;break}return t.abrupt("return");case 17:return t.next=19,Pt.allSettled(n);case 19:return o=t.sent,c=o.filter((function(e){return"fulfilled"===e.status})).length,console.debug("DynamicAssets: Upgradable Assets Info",{total:c,results:o}),e.saveStateToStorage(),t.next=25,e.updateSpriteFrames();case 25:e.requestUpdateDynamicAssets(),t.next=31;break;case 28:t.prev=28,t.t2=t.catch(2),console.warn("DynamicAssets: Handle change quality error",t.t2);case 31:return t.prev=31,e.isProcessing=!1,t.finish(31);case 34:case"end":return t.stop()}}),t,null,[[2,28,31,34]])})))}}),wt);v._RF.pop(),v._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var zt,Vt,jt,qt=Ludex,Wt=qt.Events,Yt=qt.Configs.GameEngine.DynamicAtlas,Qt=Yt.UsePowerOfTwo,Kt=Yt.TextureAtlasOptimize,Jt=Yt.AllowNonePackable,Xt=Yt.OnlyOptimizeWhenRenderTooLong,Zt=qt.Utils,$t=Zt.Array,en=Zt.Json,tn=Zt.Object,nn=Zt.Decorator,rn=codex.event,an=(kt=nn.debounce(2e3),n((At=function(){function e(){var t=this;s(this,e),this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.pendingTextures={},this.setupRenderListeners=function(){S.on(T.EVENT_BEFORE_RENDER,t.updateBeforeRenderTime),S.on(T.EVENT_AFTER_RENDER,t.updateAfterRenderTime),Xt&&rn.catchUp(Wt.SCENE_LAUNCHED,(function(){S.once(T.EVENT_AFTER_RENDER,t.checkRenderTimeHighers)}))},this.checkRenderTimeHighers=function(){var e=t.getMeanRenderTime();e>8&&t.handleLaggyFrame(e),S.once(T.EVENT_AFTER_RENDER,(function(){setTimeout(t.checkRenderTimeHighers,t.renderTimeInterval)}))},this.resetPendingInfo=function(){t.pendingSprites={},t.pendingTextures={}},this.updateBeforeRenderTime=function(){t.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){t.renderTimes.push(performance.now()-t.lastRenderTime)},this.tryInsertSpriteFrame=function(e){var n=t.getAtlas();if(!n)throw new Error("DynamicAtlas: Atlas not found");if($t.has(n._innerSpriteFrames,e))throw new Error("DynamicAtlas: Sprite frame already exists");var r=n.insertSpriteFrame(e);if(!1===r)throw new Error("DynamicAtlas: Failed to insert sprite frame");return r},this.requestUpdateDynamicAtlas=function(e){t.isProcessing||(t.forceUpdateDynamicAtlas||(t.forceUpdateDynamicAtlas=(null==e?void 0:e.force)||!1),t.updateDynamicAtlas())},this.generateDrawInfo=function(e){if(!(e.length<1)){var n=e.sort((function(e,t){return t.usageCount-e.usageCount})),r=_.instance.textureSize;if(t.calculateOptimizedAtlas(n,r),t.atlasInfo){var a,i=t.atlasInfo.textures,s=c(i);try{for(s.s();!(a=s.n()).done;){var o=a.value;t.drawInfo.push(o)}}catch(e){s.e(e)}finally{s.f()}var u=n.filter((function(e){return!i.some((function(t){return t.id===e.id}))}));u.length>0&&(console.warn("DynamicAtlas: Missing textures",u),t.generateDrawInfo(u))}else console.warn("DynamicAtlas: Atlas info not found",{textures:n})}},this.calculateOptimizedAtlas=function(e,n){var r=function(e){var t,n=0,r=0,a=c(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;n+=i.w*i.h,r=Math.max(r,i.w)}}catch(e){a.e(e)}finally{a.f()}e.sort((function(e,t){return t.h-e.h}));var s,o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),r),h:1/0}],u=0,l=0,d=c(e);try{for(d.s();!(s=d.n()).done;)for(var h=s.value,f=o.length-1;f>=0;f--){var p=o[f];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,l=Math.max(l,h.y+h.h),u=Math.max(u,h.x+h.w),h.w===p.w&&h.h===p.h){var v=o.pop();f<o.length&&(o[f]=v)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(o.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}}catch(e){d.e(e)}finally{d.f()}return{w:u,h:l,fill:n/(u*l)||0}}(e),a=r.w,i=r.h,s=r.fill;if(s<.6)console.warn("DynamicAtlas: Fill rate is too low",s,u(e));else{if(a>n||i>n)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",a,i,n),void(e.pop()?t.calculateOptimizedAtlas(e,n):console.warn("DynamicAtlas: Texture size is too big",a,i,n));t.atlasInfo={textures:e,atlasSize:n,packedInfo:{width:Math.round(a),height:Math.round(i),fillRate:s}}}},this.drawTexture=function(e,n,r){var a,i,s=n.texture,o=s.image,c=s.getId(),u=$t.search(t.drawInfo,(function(e){return e.id===c}))||{x:-1,y:-1},l=u.x,d=u.y;if(l<0||d<0)return t.pendingSprites[n.uuid]||(t.pendingSprites[n.uuid]=n),t.pendingTextures[c]||(t.pendingTextures[c]=s,Xt||t.requestUpdateDynamicAtlas()),!1;var h=r?2:0;l+=h,d+=h;var f=e._innerTextureInfos[c];f||(r&&((o.width<=8||o.height<=8)&&(e._texture.drawTextureAt(o,l-1,d-1),e._texture.drawTextureAt(o,l-1,d+1),e._texture.drawTextureAt(o,l+1,d-1),e._texture.drawTextureAt(o,l+1,d+1)),e._texture.drawTextureAt(o,l-1,d),e._texture.drawTextureAt(o,l+1,d),e._texture.drawTextureAt(o,l,d-1),e._texture.drawTextureAt(o,l,d+1)),e._texture.drawTextureAt(o,l,d),e._count++,e._innerTextureInfos[c]={texture:s,x:l,y:d});var p=n.rect,v=p.x,y=p.y;v+=null!==(a=null==f?void 0:f.x)&&void 0!==a?a:l,y+=null!==(i=null==f?void 0:f.y)&&void 0!==i?i:d;var m={texture:e._texture,x:v,y:y};return l-=h,d-=h,e._innerSpriteFrames.push(n),m},this.refreshComponents=function(e){var t,n=c(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.node.active&&(r.node.active=!1,r.node.active=!0)}}catch(e){n.e(e)}finally{n.f()}},this.isSameAtlas=function(e,t){if(!e||!t)return!1;var n=e.textures,r=t.textures;if(n.length!==r.length)return!1;var a=n.slice().sort((function(e,t){return e.id.localeCompare(t.id)})),i=r.slice().sort((function(e,t){return e.id.localeCompare(t.id)}));return a.every((function(e,t){var n=i[t];if(!n)return!1;var r=e.id,a=e.name,s=e.w,o=e.h,c=n.id,u=n.name,l=n.w,d=n.h;return!a||r===c&&(a===u&&s===l&&o===d)}))}}return r(e,[{key:"init",value:function(){Kt&&_.instance.enabled&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:Kt}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){y.on(z.UPGRADE_DYNAMIC_ATLAS,this.requestUpdateDynamicAtlas,this),rn.on(Wt.SWITCH_SCENE,this.resetPendingInfo),rn.on(Wt.SCENE_RENDERED,this.requestUpdateDynamicAtlas),rn.catchUp(Wt.GAME_READY,this.setupRenderListeners)}},{key:"handleLaggyFrame",value:function(e){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(e.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var e,t=0,n=c(this.renderTimes);try{for(n.s();!(e=n.n()).done;){t+=e.value}}catch(e){n.e(e)}finally{n.f()}return t/=this.renderTimes.length,this.renderTimes=[],t}},{key:"overrideDynamicAtlas",value:function(){var e=this,t=_.instance;t.insertSpriteFrame=function(n){if(!t.enabled)return null;var r=t.maxAtlasCount,a=(t._atlases,t._atlasIndex),i=void 0===a?-1:a;if(i>=r)return null;try{var s=e.tryInsertSpriteFrame(n);return s||i>=r?s:s=e.tryInsertSpriteFrame(n)}catch(e){return null}}}},{key:"createAtlas",value:function(){return _.instance.newAtlas()}},{key:"getAtlas",value:function(){var e=this,t=_.instance,n=t._atlases,r=void 0===n?[]:n,a=t._atlasIndex,i=t.textureBleeding,s=r[a];return s||(s=this.createAtlas()),s?(s.originalInsertSpriteFrame||(s.originalInsertSpriteFrame=s.insertSpriteFrame,s.insertSpriteFrame=function(t){return e.drawTexture(s,t,i)}),s):null}},{key:"updateDynamicAtlas",value:function(){try{var e=S.getScene();if(!e)return;var t=this.collectPackageInfo();if(Object.keys(t).length<1)return;if(this.drawInfo=[],this.atlasInfo=null,this.isProcessing=!0,this.generateDrawInfo(tn.vals(t)),!this.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!this.updateAtlasData()&&!this.forceUpdateDynamicAtlas)return;var n=e.getComponentsInChildren("cc.UIRenderer");this.refreshComponents(n)}catch(e){console.error("DynamicAtlas: Error updating dynamic atlas",e)}finally{this.isProcessing=!1,this.forceUpdateDynamicAtlas&&(this.forceUpdateDynamicAtlas=!1)}}},{key:"collectAllSpriteFrames",value:function(){var e=S.getScene();if(e){var t,n=e.getComponentsInChildren("cc.UIRenderer"),r=c(n);try{for(r.s();!(t=r.n()).done;){var a=t.value,i=a.spriteFrame;if(a.enabled&&i&&(i.packable&&i.texture)){var s=i.uuid;s&&(this.pendingSprites[s]||(a.node.layer=P.Enum.UI_2D,this.pendingSprites[s]=i))}}}catch(e){r.e(e)}finally{r.f()}}}},{key:"collectPackageInfo",value:function(){Jt&&this.collectAllSpriteFrames();var e,t=tn.vals(this.pendingSprites),n={},r=c(t);try{for(r.s();!(e=r.n()).done;){var a,i=e.value,s=i.texture,o=i.original,u=null==s?void 0:s.getId(),l=null==o||null===(a=o._texture)||void 0===a?void 0:a.getId();if(l&&(u=l),u){this.collectInfo[u]||this.initializeCollectInfo(u,i);var d=this.collectInfo[u];d&&(d.usageCount++,n[u]=d)}}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"initializeCollectInfo",value:function(e,t){var n=t.texture,r=t.original,a=t.uuid,i=n.width,s=n.height,o=(null==r?void 0:r._texture)||{width:0,height:0},c=o.width,u=o.height,l=Math.max(i,c)+2,d=Math.max(s,u)+2;l<=1||d<=1?console.warn("DynamicAtlas: Skip invalid texture size",a,{w:l,h:d}):this.collectInfo[e]={id:e,w:l,h:d,x:-1,y:-1,usageCount:0,name:a}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var e=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!e,e)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.debug("DynamicAtlas: atlas info",this.atlasInfo);var t=this.getAtlas();if(!t||!t._texture)return!1;var n=this.atlasInfo.packedInfo,r=t._texture,a={width:r.width,height:r.height},i=n.width+20,s=n.height+20,o=Math.max(i,s),c=Qt?o:i,u=a.width!==c||a.height!==c;return console.debug("DynamicAtlas: Update atlas data",{currentSize:a,newSize:c,needsResize:u}),!!u&&(_.instance.reset(),!(!(t=this.getAtlas())||!t._texture)&&(console.debug("DynamicAtlas: Update atlas data",{newSize:c,currentSize:a}),Qt?(t._texture.initWithSize(c,c),console.debug("DynamicAtlas: Resize atlas (PO2)",c,t)):(t._texture.initWithSize(i,s),console.debug("DynamicAtlas: Resize atlas",i,s,t)),this.lastAtlasInfo=en.clone(this.atlasInfo),!0))}}]),e}()).prototype,"updateDynamicAtlas",[kt],Object.getOwnPropertyDescriptor(At.prototype,"updateDynamicAtlas"),At.prototype),At);v._RF.pop(),v._RF.push({},"2f36c+IsKJAU5s61TqQdaJ6","HybridFileCache",void 0);var sn=Ludex,on=sn.Events,cn=sn.Configs.GameEngine.HybridFileCache,un=cn.Enabled,ln=cn.PreviewMode,dn=cn.BuildMode,hn=sn.Utils,fn=hn.Object,pn=hn.Function,vn=hn.Json,yn=hn.Decorator,mn=codex,gn=mn.event,wn=mn.storage,Sn=mn.getBuildVersion,En=v.internal.CCON,bn=w.instance,kn=bn.downloader,An=bn.pipeline,_n=bn.fetchPipeline,xn=(zt=yn.throttle(1e3),jt=n((Vt=function(){function e(){var t=this;s(this,e),this.supportTypes=[],this.bundledFiles={},this.originDownloaders={},this.nativeAssetDictionary={},this.downloadFile=function(e){return function(n,r,a){var i=t.getCache(e,n);if(i)return a(null,i);var s=t.getDownloader(e);if(!s)return a(new Error("Downloader not found"),null);s(n,r,(function(r,i){return!r&&t.setCache(e,n,i),a(r,i)}))}},o(this,"requestUpdateStorage",jt,this),this.clearCache=function(){wn.initStorageData("HybridFileCache","cachedFiles",{}),wn.initStorageData("HybridFileCache","cachedBundles",{}),wn.updateToWebStorage("HybridFileCache")}}var t,n,h,f,p;return r(e,[{key:"init",value:(p=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(un&&!J){e.next=3;break}return gn.emit(on.BUNDLE_READY),e.abrupt("return");case 3:return e.next=5,this.initStorage();case 5:return e.next=7,this.checkCacheVersion();case 7:this.initSupportedTypes(),this.injectOptimalLoadPipeline(),this.injectOptimalFetchPipeline(),this.injectCacheExtensionPipeline(),this.saveOriginDownloaders(),this.registerCustomDownloader(),this.setupBundledFiles(),this.listenEvents(),console.info("Hybrid File Cache: Initialized",{supportTypes:this.supportTypes});case 16:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"initStorage",value:(f=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",wn.addStorage("HybridFileCache",{buildVersion:"0",cachedFiles:{},cachedBundles:{},cachedExtensions:{}},!0));case 1:case"end":return e.stop()}}),e)}))),function(){return f.apply(this,arguments)})},{key:"checkCacheVersion",value:(h=a(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Sn().toString(),n=wn.getStorageData("HybridFileCache","buildVersion"),wn.setStorageData("HybridFileCache","buildVersion",t),n===t){e.next=6;break}return e.next=6,this.clearCache();case 6:this.requestUpdateStorage();case 7:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"initSupportedTypes",value:function(){this.supportTypes=dn.SupportedExtensions}},{key:"setupBundledFiles",value:(n=a(i().mark((function e(){var t,n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.next=3;break;case 3:if(dn.Enabled){e.next=5;break}return e.abrupt("return");case 5:t=[],n=c(this.supportTypes),e.prev=7,n.s();case 9:if((r=n.n()).done){e.next=17;break}if(a=r.value,!this.getCachedBundles(a)){e.next=14;break}return e.abrupt("continue",15);case 14:t.push(this.downloadBundledFile(a));case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),n.e(e.t0);case 22:return e.prev=22,n.f(),e.finish(22);case 25:if(!(t.length>0)){e.next=28;break}return e.next=28,pn.allSettled(t);case 28:return e.prev=28,gn.emit(on.BUNDLE_READY),e.finish(28);case 31:case"end":return e.stop()}}),e,this,[[0,,28,31],[7,19,22,25]])}))),function(){return n.apply(this,arguments)})},{key:"downloadBundledFile",value:(t=a(i().mark((function e(t){var n,r,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.replace(".",""),r="./cache/bundle".concat(n.toUpperCase(),".").concat(n),"bundle"===t&&(r="./cache/bundleBUNDLE.json"),e.next=6,fetch(r,{method:"GET",headers:{"Content-Type":"application/json"}});case 6:return a=e.sent,e.next=9,a.json();case 9:s=e.sent,this.setBundledCache(t,s),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Hybrid File Cache: Downloaded bundled file",{type:t,error:e.t0});case 16:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return t.apply(this,arguments)})},{key:"injectOptimalFetchPipeline",value:function(){if(ln.Enabled||dn.Enabled){var e=_n.pipes[2];if(e){_n.remove(2),_n.insert((function(t,n){try{e(t,n)}catch(e){console.error("Hybrid File Cache: optimized fetch pipeline",{error:e})}}),2)}}}},{key:"injectOptimalLoadPipeline",value:function(){if(ln.Enabled||dn.Enabled){var e=An.pipes[2];if(e){An.remove(2),An.insert((function(t,n){try{e(t,n)}catch(e){console.error("Hybrid File Cache: optimized load pipeline",{error:e})}}),2)}}}},{key:"injectCacheExtensionPipeline",value:function(){var e=this;if(ln.Enabled&&ln.CacheUuidExtension){var t={},n=function(n,r){n.output=n.input;for(var a=0;a<n.input.length;a++){var i=n.input[a];if(i.id){var s=e.getCacheExtension(i.id);s?(i.url=i.url.replace(i.ext,s),i.ext=s,t[i.id]=!0):t[i.id]=!1}}r(null,null)},r=function(n){return function(r,a){for(var i=u(r.input),s=0;s<i.length;s++){var o=i[s];if(o.id){var c,l=t[o.id];if(!fn.hasOwn(e.nativeAssetDictionary,o.id))e.nativeAssetDictionary[o.id]=null!==(c=o.isNative)&&void 0!==c&&c;l&&(o.isNative=!0)}}r.input.length,n(r,a)}},a=function(n,r){n.output=n.input;for(var a=0;a<n.output.length;a++){var i,s=n.output[a];if(s.id){var o=null!==(i=e.nativeAssetDictionary[s.id])&&void 0!==i&&i;s.isNative=o,t[s.id]||e.setCacheExtension(s.id,s.ext)}}r(null,null)};An.insert(n,1),_n.insert(n,1),An.insert(a,3),_n.insert(a,3);var i=u(An.pipes),s=u(_n.pipes),o=i[2];o&&(An.pipes[2]=r(o));var c=s[2];c&&(_n.pipes[2]=r(c));var l=u(An.pipes),d=u(_n.pipes);console.debug("Hybrid File Cache: inject cache extension pipelines",i,s,l,d)}}},{key:"saveOriginDownloaders",value:function(){var e,t=c(this.supportTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originDownloaders[n]=kn.handlers[n]}}catch(e){t.e(e)}finally{t.f()}}},{key:"registerCustomDownloader",value:function(){var e,t=c(this.supportTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;"bundle"!==n&&kn.register(n,this.downloadFile(n))}}catch(e){t.e(e)}finally{t.f()}}},{key:"listenEvents",value:function(){gn.on(on.SCENE_LOADED,this.requestUpdateStorage),y.on(z.CLEAR_HYBRID_FILE_CACHE,this.clearCache)}},{key:"getDownloader",value:function(e){var t;return null!==(t=this.originDownloaders[e])&&void 0!==t?t:null}},{key:"getCacheKey",value:function(e,t){var n=t.match(/.*\/([-a-z0-9@]+)\.([^\.]+)$/);if(!n)return null;var r=l(n,3),a=(r[0],r[1]),i=r[2];return!i||e.indexOf(i)<0?null:"".concat(a,":").concat(e)}},{key:"validateDataType",value:function(e,t){Array.isArray(t)&&fn.hasOwn(t[0],"__type__");return!(".cconb"===e&&fn.hasOwn(t,"chunks")&&!(Array.isArray(t.chunks)&&t instanceof En))||(console.warn("Hybrid File Cache: Invalid cconb",{type:e,data:t}),!1)}},{key:"encodeData",value:function(e,t){return".cconb"===e?fn.hasOwn(t,"_document")&&fn.hasOwn(t,"_chunks")?new En(t._document,t._chunks):null:vn.clone(t)}},{key:"decodeData",value:function(e,t){if(".cconb"===e){if(!fn.hasOwn(t,"_document")||!fn.hasOwn(t,"_chunks"))return null;if(!Array.isArray(t._chunks))return null;var n,r=[],a=c(t._chunks);try{for(a.s();!(n=a.n()).done;){var i=n.value;i instanceof Uint8Array?r.push(i):r.push(new Uint8Array(Object.values(i)))}}catch(e){a.e(e)}finally{a.f()}return new En(t._document,r)}return vn.clone(t)}},{key:"setCache",value:function(e,t,n){var r=this.getCacheKey(e,t);if(r&&this.validateDataType(e,n)){var a=this.encodeData(e,n);wn.setStorageData("HybridFileCache","cachedFiles",d({},r,a)),this.requestUpdateStorage()}}},{key:"getCache",value:function(e,t){var n=this.getCacheKey(e,t);if(!n)return null;var r=this.getFileCaches()[n];return r||(r=this.getBundledCache(e,n)),r?this.decodeData(e,r):null}},{key:"getFileCaches",value:function(){var e;return null!==(e=wn.getStorageData("HybridFileCache","cachedFiles"))&&void 0!==e?e:{}}},{key:"getCachedBundles",value:function(e){var t=wn.getStorageData("HybridFileCache","cachedBundles");if(!t)return null;var n=t[e];return n?(this.bundledFiles[e]=n,n):null}},{key:"getBundledCache",value:function(e,t){var n,r=this.bundledFiles[e];return r&&null!==(n=r[t.replace(":".concat(e),"")])&&void 0!==n?n:null}},{key:"setBundledCache",value:function(e,t){this.bundledFiles[e]=t,wn.setStorageData("HybridFileCache","cachedBundles",d({},e,t)),this.requestUpdateStorage()}},{key:"getCacheExtension",value:function(e){return this.getCachedExtensions()[e]}},{key:"setCacheExtension",value:function(e,t){wn.setStorageData("HybridFileCache","cachedExtensions",d({},e,t)),this.requestUpdateStorage()}},{key:"getCachedExtensions",value:function(){var e;return null!==(e=wn.getStorageData("HybridFileCache","cachedExtensions"))&&void 0!==e?e:{}}}]),e}()).prototype,"requestUpdateStorage",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(){wn.updateToWebStorage("HybridFileCache")}}}),Vt);v._RF.pop(),v._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var Cn=Ludex,Dn=Cn.Events,Rn=Cn.Utils.Array,Tn=codex,Ln=Tn.player,Fn=Tn.event,Pn=Tn.language,Nn=Tn.monitorError,Mn=function(){function e(){var t=this;s(this,e),this.handlePreloadLanguage=function(){var e=a(i().mark((function e(n){var r,a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.locale,a=n.onLoad,s=n.onError,t.isSupportedLocale(r)){e.next=5;break}return console.warn("Preload language ".concat(r," not found")),null==s||s(new Error("Language ".concat(r," not found"))),e.abrupt("return");case 5:return e.prev=5,e.next=8,t.addLanguage(r);case 8:null==a||a(r),e.next=17;break;case 11:e.prev=11,e.t0=e.catch(5),o=t.toError(e.t0,"handleLanguageRequested"),console.error(o),null==Nn||Nn.sendException(o),null==s||s(e.t0);case 17:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}(),this.handleChooseLanguage=function(e){var n=e.locale,r=e.saveToPlayerData,a=void 0!==r&&r;if(t.isSupportedLocale(n))try{t.setLanguage(n,a)}catch(e){var i=t.toError(e,"handleLanguageRequested");console.error(i),null==Nn||Nn.sendException(i)}else console.warn("Choose language ".concat(n," not found"))},this.handleLanguageRequested=function(){var e=a(i().mark((function e(n){var r,a,s,o,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.locale,a=n.saveToPlayerData,s=void 0!==a&&a,o=n.onLoad,c=n.onError,t.isSupportedLocale(r)){e.next=5;break}return console.warn("Request language ".concat(r," not found")),null==c||c(new Error("Language ".concat(r," not found"))),e.abrupt("return");case 5:return e.prev=5,e.next=8,t.addLanguage(r);case 8:null==o||o(r),t.setLanguage(r,s),e.next=18;break;case 12:e.prev=12,e.t0=e.catch(5),u=t.toError(e.t0,"handleLanguageRequested"),console.error(u),null==Nn||Nn.sendException(u),null==c||c(u);case 18:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()}var t,n,o,c,u;return r(e,[{key:"init",value:(u=a(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.initDefaultLanguage();case 3:return this.listenEvent(),e.next=6,this.initPlayerLanguage();case 6:e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),t=this.toError(e.t0,"handleLanguageRequested"),console.error(t),null==Nn||Nn.sendException(t);case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return u.apply(this,arguments)})},{key:"initDefaultLanguage",value:(c=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Pn.add("en",pe,!0),this.setLanguage("en");case 2:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"initPlayerLanguage",value:(o=a(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Pn.getPlayerLanguage())&&this.isSupportedLocale(n)){e.next=5;break}return console.warn("Language ".concat(n," not supported. Overriding with default language")),this.setLanguage("en",!0),e.abrupt("return");case 5:return e.next=7,this.addLanguage(n);case 7:r=null!==(t=Ln.getPlayerDataByKey("isFirstLogin"))&&void 0!==t&&t,this.setLanguage(n,r);case 9:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"isSupportedLocale",value:function(e){return Rn.has(X,e)}},{key:"listenEvent",value:function(){Fn.on(Dn.REQUEST_LANGUAGE,this.handleLanguageRequested),y.on(Dn.REQUEST_LANGUAGE,this.handleLanguageRequested),y.on(z.PRELOAD_LANGUAGE,this.handlePreloadLanguage),y.on(z.CHOOSE_LANGUAGE,this.handleChooseLanguage)}},{key:"addLanguage",value:(n=a(i().mark((function e(t){var n,r,a=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],e.next=3,this.getLangData(t);case 3:r=e.sent,Pn.add(t,r,n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setLanguage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Pn.choose(e),t){var n=Ln.getPlayerSettings(),r=h(h({},n),{},{language:e});Ln.setPlayerDataByName("settings",r)}}},{key:"getLangData",value:(t=a(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("en"!==t){e.next=2;break}return e.abrupt("return",pe);case 2:return e.next=4,Z.loadJsonAsync($[t]);case 4:if(null!==(n=e.sent)){e.next=7;break}throw new Error("Language ".concat(t," not found"));case 7:if(null!==n.json){e.next=9;break}throw new Error("Language ".concat(t," is empty"));case 9:return e.abrupt("return",n.json);case 10:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"toError",value:function(e,t){return e instanceof Error?e:"string"==typeof e?new Error("LanguagePlugin: ".concat(e)):new Error("LanguagePlugin: Unknown error in module: <".concat(t,">"))}}]),e}();v._RF.pop(),v._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var On=Ludex,In=On.Configs,Un=In.Mockup,Gn=Un.Leaderboards,Bn=Un.GameSDK.Player,Hn=In.Leaderboards,zn=On.Utils.Number,Vn=codex.leaderboard,jn=function(){function e(){var t=this;s(this,e),this.handleWhenGameSDKStarted=function(){Gn.Enabled?t.setupLeaderboardsMockup():t.setupLeaderboards()}}var t,n,o,u;return r(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(u=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupLeaderboardByConfigs();case 1:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var e,t=Hn.LeaderboardList,n=c(t);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=r.Id,i=r.Name;Vn.addLeaderboard({name:i,type:"global",autoSortRank:!0,leaderboardId:a})}}catch(e){n.e(e)}finally{n.f()}}},{key:"setupLeaderboardsMockup",value:(o=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupMockGlobalLeaderboards(),this.setupMockFriendsLeaderboard();case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"setupMockGlobalLeaderboards",value:(n=a(i().mark((function e(){var t,n,r,a,s,o,u,l,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Gn.NumOfLeaders,n=Hn.LeaderboardList,r=c(n),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=22;break}if(s=a.value,o=s.Name,u=s.Id,o){e.next=10;break}return e.abrupt("continue",20);case 10:return e.next=12,Vn.createLeaderboardAsync({_id:u,name:o,numberOfLeaders:zn.random(t.Max-t.Min)+t.Min});case 12:return l=e.sent,Vn.addLeaderboard({name:o,type:"global",autoSortRank:!0,leaderboardId:l}),e.next=16,Vn.requestLeaderboardAsync(o,10);case 16:d=Vn.getLeaderboard(o),console.info("setupGlobalLeaderboard fetch new",d,d&&Object.keys(d.leaders).length),d=Vn.getLeaderboard(o),console.info("setupGlobalLeaderboard load more",d,d&&Object.keys(d.leaders).length);case 20:e.next=5;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(3),r.e(e.t0);case 27:return e.prev=27,r.f(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[3,24,27,30]])}))),function(){return n.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(t=a(i().mark((function e(){var t,n,r,a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=ee.FRIENDS,n=te.FRIENDS,r=0,(a=Bn.ConnectedPlayers).Enabled&&(r=zn.random(a.NumOfPlayers-1)+1),e.next=7,Vn.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:r});case 7:return s=e.sent,Vn.addLeaderboard({name:t,type:"friends",autoSortRank:!0,leaderboardId:s}),e.next=11,Vn.requestLeaderboardAsync(t,10);case 11:o=Vn.getLeaderboard(t),console.info("setupFriendsLeaderboard done",o);case 13:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();v._RF.pop(),v._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var qn=Ludex,Wn=qn.Utils,Yn=qn.Events,Qn=qn.Configs.PerformanceMonitor.FpsTracking,Kn=codex.event,Jn=function(){function e(){var t=this;s(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps(),S.on(T.EVENT_AFTER_UPDATE,t.handleLateUpdate)},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=y.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=y.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return r(e,[{key:"mark",get:function(){return Qn.Enabled?Wn.Mark:null}},{key:"init",value:function(){var e=Qn.TrackingDuration,t=Qn.TrackingInterval;this.mark&&(this.fpsTraceDuration=null!=e?e:60,this.fpsTraceInterval=null!=t?t:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents())}},{key:"listenEvents",value:function(){Kn.catchUp(Yn.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){S.off(T.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var e,t;if(this.mark){var n=this.getFPS(),r=this.getDrawCalls(),a=this.getDeviceRender(),i=this.getTextureMemory();this.minFps=Math.min(null!==(e=this.minFps)&&void 0!==e?e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",a),this.mark.putAttr(this.markName,"Draw Calls",r.toString()),this.mark.putAttr(this.markName,"Texture Memory",i.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.debug("FPS: ".concat(n," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(r,", texture memory: ").concat(i.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!S.root)return 0;var e=S.root.fps;return Math.floor(e)||0}},{key:"getDrawCalls",value:function(){return S.root&&S.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return S.root&&S.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return S.root&&S.root.device.memoryStatus.textureSize/1048576||0}}]),e}();v._RF.pop(),v._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var Xn=Ludex.Events,Zn=codex.event,$n=function(){function e(){s(this,e),this.handleHotReload=function(){y.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){y.emit(z.GAMEPLAY_UPDATE_CONFIG,e.config);var t=e.id,n=e.type;Zn.emit(Xn.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return r(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){Zn.on(Xn.REQUEST_HOT_RELOAD,this.handleHotReload),Zn.on(Xn.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();v._RF.pop(),v._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var er=function(){function e(){s(this,e)}return r(e,[{key:"init",value:function(){this.initHybridFileCache(),console.info("Plugins Manager: Initialized")}},{key:"initLanguages",value:function(){(new Mn).init()}},{key:"initLeaderboards",value:function(){(new jn).init()}},{key:"initRemoteConfig",value:function(){(new $n).init()}},{key:"initDynamicAtlas",value:function(){(new an).init()}},{key:"initDynamicAssets",value:function(){(new Ht).init()}},{key:"initHybridFileCache",value:function(){(new xn).init()}},{key:"initCanvasRecorder",value:function(){(new mt).init()}},{key:"initPerformanceMonitor",value:function(){(new Jn).init()}},{key:"initAdaptivePerformance",value:function(){(new vt).init()}},{key:"initDailyRewards",value:function(){(new bt).init()}}]),e}();v._RF.pop(),v._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var tr=codex,nr=tr.event,rr=tr.monitorError,ar=Ludex,ir=ar.Events,sr=ar.Configs.PerformanceMonitor,or=ar.Utils,cr=or.Mark,ur=or.Function,lr=function(){function e(){var t=this;s(this,e),this.markName="Load Scene",this.testScene={},this.isClearedMark=!1,this.callbackSwitchScene=null,this.mutex=ur.mutex(),this.switchScene=function(){var e=a(i().mark((function e(n){var r,a,s,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.sceneName,s=n.sceneData,"ChallengeResultScene"===(o=t.correctSceneName(a))?(o=ue.DASHBOARD_SCENE,s=h(h({},s),{},{screen:le.CHALLENGE_FRIEND_COMPLETE_SCREEN})):"DailyChallengeGameScene"===o&&(o=ue.GAME_SCENE,t.switchToDailyChallengeGameScene(n)),console.debug("Switching",o,null!==(r=s)&&void 0!==r?r:{}),o){e.next=6;break}return e.abrupt("return");case 6:return ce.isSceneLoaded(o)||ne.showLoadingFullScreen(o),e.next=9,t.startSceneWithRetries({sceneName:o,sceneData:s});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.switchToDailyChallengeGameScene=function(e){var t,n=null===(t=e.sceneData)||void 0===t?void 0:t.dailyChallengeData,r=n||{},a=r.day,i=void 0===a?0:a,s=r.month,o=void 0===s?0:s,c=r.year;if(i>0&&o>0&&(void 0===c?0:c)>0){var u=n.day,l=n.month,d=n.year,h=ae.getRandomLevel(u,l,d);console.log("Daily Challenge Level: ".concat(h)),codex.analytics.event(ie.DAILY_CHALLENGE_START,{level:h}),se.setLevel(h),oe.switchToDailyChallenge(u,l,d)}oe.switchToSoloContext()},this.preloadSceneWithRetries=function(){var e=a(i().mark((function e(n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=function(){return t.preloadScene(n)},e.next=4,ur.retryAsync(r,r);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),null==rr||rr.sendException(ur.toError(e.t0));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),this.onSceneProgress=function(e,n,r){var a=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File","".concat(r.id," (").concat(r.ext,")"));var i=Math.floor(70*a+30);GameSDK.setLoadingProgress(i)},this.setTestScene=function(e){var n=e.sceneName;console.warn("SceneManager.setTestScene",n),t.testScene[n]=!0}}var t,n,o;return r(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){nr.catchUp(ir.MARK_IS_TEST_SCENE,this.setTestScene),nr.on(ir.SWITCH_SCENE,this.switchScene),nr.on(ir.PRELOAD_SCENE,this.preloadSceneWithRetries)}},{key:"correctSceneName",value:function(e){var t=S.getScene(),n=this.getTestScene();return n?n===(null==t?void 0:t.name)?null:n:null!=t&&t.isValid&&e===t.name?null:e}},{key:"startSceneWithRetries",value:(o=a(i().mark((function e(t){var n,r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=function(){return r.startScene(t)},e.next=4,ur.retryAsync(n,n);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),null==rr||rr.sendException(ur.toError(e.t0));case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),function(e){return o.apply(this,arguments)})},{key:"startScene",value:(n=a(i().mark((function e(t){var n,r,a,s,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sceneName,r=t.sceneData,e.next=3,this.mutex.use(n);case 3:return a=e.sent,e.prev=4,this.startMeasure("start",t),e.next=8,this.loadSceneAsync(n,this.onSceneProgress);case 8:return s=e.sent,e.next=11,this.runSceneAsync(s);case 11:o=e.sent,this.setSceneData(o,null!=r?r:{}),ce.markIsSceneLoaded(n),nr.emit(ir.SCENE_LOADED,{sceneName:o.name}),this.clearTestMark(),this.stopMeasure(),this.handleSceneLaunched(n,r),a.release(),e.next=27;break;case 21:throw e.prev=21,e.t0=e.catch(4),c=ur.toError(e.t0),this.stopMeasure(!1),a.release(),c;case 27:case"end":return e.stop()}}),e,this,[[4,21]])}))),function(e){return n.apply(this,arguments)})},{key:"preloadScene",value:(t=a(i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sceneName,e.next=3,this.mutex.use(n);case 3:return r=e.sent,e.prev=4,this.startMeasure("preload",t),e.next=8,this.loadSceneAsync(n,this.onSceneProgress);case 8:ce.markIsSceneLoaded(n),nr.emit(ir.SCENE_LOADED,{sceneName:n,isPreload:!0}),this.stopMeasure(),r.release(),e.next=20;break;case 14:throw e.prev=14,e.t0=e.catch(4),a=ur.toError(e.t0),this.stopMeasure(!1),r.release(),a;case 20:case"end":return e.stop()}}),e,this,[[4,14]])}))),function(e){return t.apply(this,arguments)})},{key:"loadSceneAsync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise((function(n,r){var a=F.main;if(!a)return r(new Error("Main bundle not found"));a.loadScene(e,null!=t?t:null,(function(e,t){if(e)return r(e);n(t)}))}))}},{key:"runSceneAsync",value:function(e){return new Promise((function(t,n){S.runScene(e,void 0,(function(e,r){return e?n(e):r?void t(r):n(new Error("Scene not found"))}))}))}},{key:"mark",get:function(){return sr.LoadResources?cr:null}},{key:"startMeasure",value:function(e,t){if(this.mark){var n=t.sceneName;console.groupCollapsed("üì¶ ".concat(n,": ").concat(e," progress")),this.mark.measure(this.markName),this.mark.putAttr(this.markName,"Cancel","false"),this.mark.putAttr(this.markName,"Success","false"),this.mark.putMetric(this.markName,n),this.mark.start(this.markName)}}},{key:"stopMeasure",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.mark&&(this.mark.rmAttr(this.markName,"File"),this.mark.putAttr(this.markName,"Success",e?"true":"false"),this.mark.stop(this.markName),console.groupEnd())}},{key:"clearTestMark",value:function(){this.isClearedMark||(nr.clear(ir.MARK_IS_TEST_SCENE),this.isClearedMark=!0)}},{key:"handleSceneLaunched",value:function(e,t){var n;ne.hideLoadingFullScreen(e),re.switchSceneTracking(),null==rr||rr.addMetadata({currentScene:e}),null===(n=this.callbackSwitchScene)||void 0===n||n.call(this,{sceneName:e,sceneData:t}),nr.emit(ir.SCENE_LAUNCHED,{sceneName:e}),S.once(T.EVENT_AFTER_RENDER,(function(){nr.emit(ir.SCENE_RENDERED,{sceneName:e})}))}},{key:"getTestScene",value:function(){var e;return null!==(e=Object.keys(this.testScene)[0])&&void 0!==e?e:null}},{key:"onSwitchScene",value:function(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:h(h({},n),t)}),console.debug("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();v._RF.pop(),v._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var dr=codex,hr=dr.event,fr=dr.monitorError,pr=Ludex,vr=pr.Events,yr=pr.Utils,mr=yr.Object,gr=yr.Valid,wr=[de[le.LOADING_SCREEN],de[le.NOTIFICATION_SCREEN],de[le.WINNING_SCREEN],de[le.REWARD_SCREEN],de[le.LOSE_SCREEN],de[le.DAILY_REWARD_SCREEN],de[le.ITEM_WARN_SCREEN],de[le.FREE_ITEM_SCREEN],de[le.SETTINGS_SCREEN]];function Sr(e){return"ready"===e.state?(e.screen.node.removeFromParent(),e.screen.node.destroy(),{state:"prefab",order:e.order,name:e.name,prefab:e.prefab,useCount:e.useCount}):"prefab"===e.state?h({},e):{state:"queued",order:e.order,name:e.name}}var Er=function(){function e(){var t=this;s(this,e),this.screens={},this.onPrefabReadyCallbacks={},this.handleOpenScreen=function(e){t.openScreen(e.screenName,e.screenData)},this.handleCloseScreen=function(e){t.closeScreen(e.screenName,!0)},this.handlePreloadScreen=function(e){var n=e.screenName;t.addScreenQueues([n]);var r=t.screens[n];"queued"===(null==r?void 0:r.state)&&t.loadScreen(r)},this.handlePreloadScreens=function(){var e=S.getScene();t.validateScene(e)&&(t.initScreens(e),t.preloadScreens())},this.handleSwitchScene=function(){t.resetAllScreenParents(),t.onPrefabReadyCallbacks={}}}var t,n,o,l,d;return r(e,[{key:"init",value:function(){this.bindEventHandlers(),console.info("Screen Manager: Initialized")}},{key:"bindEventHandlers",value:function(){hr.on(vr.OPEN_SCREEN,this.handleOpenScreen),hr.on(vr.CLOSE_SCREEN,this.handleCloseScreen),hr.on(vr.PRELOAD_SCREENS,this.handlePreloadScreens),hr.on(z.PRELOAD_SCREEN,this.handlePreloadScreen),hr.on(vr.SWITCH_SCENE,this.handleSwitchScene)}},{key:"resetAllScreenParents",value:function(){for(var e in this.screens){var t=this.screens[e];void 0!==t&&(this.screens[e]=Sr(t))}}},{key:"validateScene",value:function(e){return!!e||(console.warn("No scene found for preloading screens"),!1)}},{key:"initScreens",value:function(e){var t=e.getComponentsInChildren("BaseScreen");if(!gr.isEmpty(t)){var n=t.map((function(e){return null==e?void 0:e.node.name})).join(", ");console.info("üì∫ Active Screens in ".concat(e.name,": ").concat(n)),this.addScreens(t)}var r=this.getScreenHolder();if(r){var a=r.screenKeys.filter((function(e){return!t.some((function(t){return t.node.name===de[e]}))}));if(!gr.isEmpty(a)){var i=a.map((function(e){return de[e]}));console.info("üì∫ Lazy-loading Screens in ".concat(e.name,": ").concat(i.join(", "))),this.addScreenQueues(i)}}}},{key:"getScreenHolder",value:function(){var e,t=S.getScene();return null!==(e=null==t?void 0:t.getComponentInChildren("Screens"))&&void 0!==e?e:null}},{key:"addScreens",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n){var r=n.node.name;if(this.isScreenNameValid(r)){ne.markIsScreenLoaded(r);var a=this.screens[r];"ready"!==(null==a?void 0:a.state)?this.screens[r]={state:"ready",order:t,screen:n,prefab:n.node,name:r,useCount:0}:this.screens[r]=h(h({},a),{},{order:t,screen:n})}else console.warn("ScreenManager.addScreens: Invalid screen name ".concat(r))}else console.warn("ScreenManager.addScreens: Invalid screen ".concat(t))}}},{key:"isScreenNameValid",value:function(e){return gr.isString(e)&&mr.vals(de).includes(e)}},{key:"addScreenQueues",value:function(e){var t=this.getScreenHolder();if(null!=t&&t.isValid){for(var n=0;n<e.length;n++){var r=e[n];if(this.isScreenNameValid(r)){var a=this.screens[r];this.screens[r]=void 0===a?{state:"queued",order:n,name:r}:h(h({},a),{},{order:n})}else console.warn("ScreenManager.addScreenQueues: Invalid screen name ".concat(r))}console.debug("ScreenManager.addScreenQueues: Screens Info",h({},this.screens))}else console.warn("ScreenManager.addScreenQueues: No valid screen holder found")}},{key:"loadScreen",value:(d=a(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.screens[t.name]=h(h({},t),{},{state:"loading"}),e.next=4,Z.loadPrefabAsync("screens/".concat(t.name));case 4:if(null!==(n=e.sent)){e.next=7;break}throw new Error("ScreenManager.loadScreen: Failed to load prefab: ".concat(t.name));case 7:this.screens[t.name]=h(h({},t),{},{state:"prefab",prefab:n,useCount:0}),console.debug("ScreenManager.loadScreen: ".concat(t.name," loaded successfully")),ne.markIsScreenLoaded(t.name),this.emitPrefabReady(t.name),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.warn("ScreenManager.loadScreen: Failed to load ".concat(t.name),e.t0),this.screens[t.name]={state:"queued",order:t.order,name:t.name};case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return d.apply(this,arguments)})},{key:"preloadScreens",value:function(){for(var e in this.screens)if(wr.includes(e)){var t=this.screens[e];"queued"===(null==t?void 0:t.state)&&this.loadScreen(t)}}},{key:"getScreen",value:(l=a(i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=this.getScreenHolder())&&n.isValid){e.next=3;break}throw new Error("ScreenManager.getScreen: Invalid screen holder");case 3:if("ready"!==t.state){e.next=5;break}return e.abrupt("return",t.screen);case 5:if(t.prefab instanceof O){e.next=7;break}throw new Error("ScreenManager.getScreen: Invalid prefab ".concat(t.name));case 7:if((r=M(t.prefab)).name=t.name,a=r.getComponent("BaseScreen")){e.next=12;break}throw new Error("ScreenManager.getScreen: Invalid screen ".concat(t.name));case 12:return n.node.addChild(r),r.active=!1,this.screens[t.name]=h(h({},t),{},{state:"ready",screen:a}),this.reorderScreens(),console.debug("ScreenManager.getScreen: Retrieved ".concat(t.name),t),e.abrupt("return",a);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"reorderScreens",value:function(){var e=[];for(var t in this.screens){var n=this.screens[t];"ready"===(null==n?void 0:n.state)&&null!=n&&n.screen.isValid&&e.push(n)}e.sort((function(e,t){return e.order-t.order}));for(var r=0,a=e;r<a.length;r++){var i=a[r];i.screen.node.setSiblingIndex(i.order)}}},{key:"openScreen",value:(o=a(i().mark((function e(t,n){var r,a,s,o,c,u,l,d=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.length>2&&void 0!==d[2]&&d[2],this.isScreenNameValid(t)){e.next=3;break}return e.abrupt("return");case 3:if(void 0!==(a=this.getOrTryAddScreen(t))){e.next=7;break}return console.warn("ScreenManager.openScreen: Screen ".concat(t," not found")),e.abrupt("return");case 7:if("ready"===a.state||"prefab"===a.state){e.next=14;break}return ne.showLoadingScreen(),"queued"===a.state&&this.loadScreen(a),e.next=12,this.queueScreen(t,n);case 12:return ne.closeLoadingScreen(),e.abrupt("return");case 14:return e.prev=14,he.setBlockInput(!0),e.next=18,this.getScreen(a);case 18:if(null!=(s=e.sent)&&s.isValid){e.next=21;break}throw new Error("ScreenManager.performScreenOpen: Invalid screen ".concat(t));case 21:if(this.incrementUseCount(t),o=null==n?void 0:n.preloadCallback,c=void 0!==o||s.hasPreloadOpenPromises(),u=!r,!c){e.next=33;break}return u&&ne.showLoadingScreen(),l=[],s.hasPreloadOpenPromises()&&l.push(s.preloadOpen()),o&&l.push(o()),e.next=32,Promise.all(l);case 32:u&&ne.closeLoadingScreen();case 33:return e.next=35,this.showScreen(s,t,n);case 35:e.next=42;break;case 37:e.prev=37,e.t0=e.catch(14),console.error("ScreenManager.openScreen: Error opening ".concat(t),e.t0),hr.emit(z.ERROR_OPEN_SCREEN,{screenName:t,error:e.t0}),this.closeScreen(t);case 42:return e.prev=42,he.setBlockInput(!1),e.finish(42);case 45:case"end":return e.stop()}}),e,this,[[14,37,42,45]])}))),function(e,t){return o.apply(this,arguments)})},{key:"queueScreen",value:function(e,t){var n,r=this;console.debug("ScreenManager.queueScreen: Queuing ".concat(e));var s=null!==(n=this.onPrefabReadyCallbacks[e])&&void 0!==n?n:[];return new Promise((function(n){var o=function(){var s=a(i().mark((function a(){return i().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,r.openScreen(e,t,!0);case 2:n();case 3:case"end":return a.stop()}}),a)})));return function(){return s.apply(this,arguments)}}();r.onPrefabReadyCallbacks[e]=[].concat(u(s),[o])}))}},{key:"incrementUseCount",value:function(e){var t=this.screens[e];"ready"!==(null==t?void 0:t.state)&&"prefab"!==(null==t?void 0:t.state)||(this.screens[e]=h(h({},t),{},{useCount:t.useCount+1}))}},{key:"showScreen",value:(n=a(i().mark((function e(t,n,r){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.node.active=!0,a={screenName:n,screenData:r},hr.emit(vr.OPENING_SCREEN,a),e.next=5,new Promise((function(e){return S.once(T.EVENT_AFTER_RENDER,e)}));case 5:t.open(r),this.updateAnalytics(n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"closeScreen",value:(t=a(i().mark((function e(t){var n,r,a=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]&&a[1],this.isScreenNameValid(t)){e.next=3;break}return e.abrupt("return");case 3:if(void 0!==(r=this.screens[t])){e.next=7;break}return console.debug("ScreenManager.closeScreen: Screen ".concat(t," not found")),e.abrupt("return");case 7:if("ready"===r.state){e.next=11;break}return console.debug("ScreenManager.closeScreen: ".concat(t," is not ready")),delete this.onPrefabReadyCallbacks[t],e.abrupt("return");case 11:if(e.prev=11,r.screen.isValid&&r.screen.node.active){e.next=14;break}return e.abrupt("return");case 14:hr.emit(vr.CLOSING_SCREEN,{screenName:t}),r.screen.close(),n&&this.updateAnalytics(t,!1),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(11),console.error("ScreenManager.closeScreen: Error closing ".concat(t),e.t0);case 22:case"end":return e.stop()}}),e,this,[[11,19]])}))),function(e){return t.apply(this,arguments)})},{key:"updateAnalytics",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];re.trackCurrentPage(e,t),t?null==fr||fr.addMetadata({currentScreen:e}):null==fr||fr.removeMetadata("currentScreen")}},{key:"closeAllScreens",value:function(){for(var e in this.screens)this.closeScreen(e,false)}},{key:"getOrTryAddScreen",value:function(e){var t=this.screens[e];return void 0===t?(console.debug("ScreenManager.getOrTryAddScreen: Adding new screen (".concat(e,") to queue")),this.addScreenQueues([e]),this.screens[e]):t}},{key:"emitPrefabReady",value:function(e){var t,n,r=null!==(t=this.onPrefabReadyCallbacks[e])&&void 0!==t?t:[],a=c(r);try{for(a.s();!(n=a.n()).done;){(0,n.value)()}}catch(e){a.e(e)}finally{a.f()}delete this.onPrefabReadyCallbacks[e]}}]),e}();v._RF.pop(),v._RF.push({},"9d892ZsSyxHSITF2VHJ1zpy","LudosSystem",void 0);var br=Ludex,kr=br.Configs.Core,Ar=br.Events,_r=br.Plugins.Analytics.Events,xr=codex,Cr=xr.context,Dr=xr.event,Rr=xr.analytics,Tr=xr.monitorError;new(function(){function e(){var t=this;s(this,e),this.coreManager=new Re,this.adsManager=new xe,this.sceneManager=new lr,this.screenManager=new Er,this.engineManager=new Ge,this.layoutManager=new rt,this.playerManager=new ct,this.pluginsManager=new er,this.handleWhenCoreBoot=function(){console.warn("Ludos System: Core boot",{inited:y.inited,game:y}),y.inited?t.handleCocosInit():y.once(I.EVENT_GAME_INITED,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),console.groupEnd(),Rr.event(_r.LOAD_START),Dr.catchUp(Ar.BUNDLE_READY,t.processPreStartGame)},this.processPreStartGame=function(){Dr.catchUp(Ar.SCENE_LOADED,t.preloadScenes),Dr.catchUp(Ar.SCENE_LAUNCHED,t.processBootSceneLaunched),t.runBootScene()},this.processBootSceneLaunched=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!kr.StartSDKAfterLoadGame){e.next=3;break}return e.next=3,Dr.waitTo(Ar.SCENE_LOADED);case 3:if(!y.isPaused()){e.next=6;break}return e.next=6,t.waitGameResume();case 6:t.processStartGame();case 7:case"end":return e.stop()}}),e)}))),this.preloadScenes=function(){"solo"===Cr.getSessionContextType()?ce.preloadDashboardScene():ce.preloadGameScene()},this.handleSwitchScene=function(){Dr.emit(Ar.PRELOAD_SCREENS),console.groupEnd()},this.startProcessContextData=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Rr.event(_r.APP_READY),e.prev=1,t.playerManager.requestConnectedPlayers(),e.next=5,Cr.processContextData();case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("startProcessContextData",e.t0),e.t0 instanceof Error&&(null==Tr||Tr.sendException(e.t0));case 11:return e.prev=11,Dr.emit(Ar.GAME_READY),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,7,11,14]])}))),Dr.catchUp(Ar.CORE_READY,(function(){Rr.event(_r.ENGINE_READY)})),console.groupCollapsed("üì¶ Ludos System"),console.info("Ludos Initializing..."),this.initManagers(),this.listenEvents(),console.groupEnd()}var t,n,o;return r(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"waitGameResume",value:(o=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){y.once(I.EVENT_RESUME,e)})));case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"runBootScene",value:function(){ce.switchScene(ue.BOOT_SCENE)}},{key:"processStartGame",value:(n=a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.groupEnd(),Rr.event(_r.LOAD_COMPLETE),e.next=4,this.startGameAsync();case 4:Dr.catchUp(Ar.PLAYER_INFO_LOADED,this.startProcessContextData);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startGameAsync",value:(t=a(i().mark((function e(){var t,n=this,r=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:0,e.prev=1,e.next=4,GameSDK.startGameAsync();case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(1),console.warn("GameSDK.startGameAsync",e.t0),t<=3?setTimeout((function(){n.startGameAsync(t+1)}),1e3):null==Tr||Tr.sendException(e.t0 instanceof Error?e.t0:new Error(JSON.stringify(e.t0)));case 10:case"end":return e.stop()}}),e,null,[[1,6]])}))),function(){return t.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initLanguages(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAtlas(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance(),this.pluginsManager.initDailyRewards()}}]),e}()),v._RF.pop(),v._RF.push({},"826b3i39nhICrG3S59Y/cpR","PipelineData",void 0);var Lr,Fr=r((function e(t,n,r,a){s(this,e),this.id=4294967295,this.width=0,this.height=0,this.id=t,this.width=n,this.height=r,this.framebuffer=a}));v.user||(v.user={windowID:0,windows:new WeakMap}),v._RF.pop(),v._RF.push({},"c7df3pBHqRChZTjXMfWIy6H","Optimized2DPipeline",void 0);var Pr=G.ccclass,Nr=function(){function e(){s(this,e),this._viewport=new U.Viewport,this._clearColor=new U.Color(0,0,0,1),this.usesMask=!0}return r(e,[{key:"setup",value:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r&&null!==r.scene&&null!==r.window){var a=this.prepareCameraResources(t,r);this.buildForward(t,r,a.id,a.width,a.height)}}}},{key:"prepareCameraResources",value:function(e,t){var n=function(e){var t=v.user.windows.get(e.window);return void 0!==t||(t=new Fr(v.user.windowID,0,0,e.window.framebuffer),++v.user.windowID,v.user.windows.set(e.window,t)),t}(t);return 0===n.width&&0===n.height?(n.width=t.window.width,n.height=t.window.height,this.initCameraResources(e,t,n.id,n.width,n.height)):n.framebuffer===t.window.framebuffer&&n.width===t.window.width&&n.height===t.window.height||(n.framebuffer=t.window.framebuffer,n.width=t.window.width,n.height=t.window.height,this.initCameraResources(e,t,n.id,n.width,n.height)),n}},{key:"initCameraResources",value:function(e,t,n,r,a){e.addRenderWindow("Color".concat(n),U.Format.RGBA8,r,a,t.window),this.usesMask&&e.addDepthStencil("DepthStencil".concat(n),U.Format.DEPTH_STENCIL,r,a)}},{key:"buildForward",value:function(e,t,n,r,a){this._clearColor.x=t.clearColor.x,this._clearColor.y=t.clearColor.y,this._clearColor.z=t.clearColor.z,this._clearColor.w=t.clearColor.w,this._viewport.left=t.viewport.x*r,this._viewport.top=t.viewport.y*a,this._viewport.width=t.viewport.z*r,this._viewport.height=t.viewport.w*a;var i=e.addRenderPass(r,a,"default");i.setViewport(this._viewport),!function(e){return 0!=(e.clearFlag&U.ClearFlagBit.COLOR)}(t)?i.addRenderTarget("Color".concat(n),U.LoadOp.LOAD):i.addRenderTarget("Color".concat(n),U.LoadOp.CLEAR,U.StoreOp.STORE,this._clearColor),this.usesMask&&(t.clearFlag&U.ClearFlagBit.DEPTH_STENCIL?i.addDepthStencil("DepthStencil".concat(n),U.LoadOp.CLEAR,U.StoreOp.STORE,t.clearDepth,t.clearStencil,t.clearFlag&U.ClearFlagBit.DEPTH_STENCIL):i.addDepthStencil("DepthStencil".concat(n),U.LoadOp.LOAD))}}]),e}();B&&(console.log("register pipeline"),B.setCustomPipeline("Optimized2DPipeline",new Nr));Pr("Optimized2DPipeline")(Lr=function(e){f(n,e);var t=p(n);function n(){return s(this,n),t.apply(this,arguments)}return r(n,[{key:"start",value:function(){}},{key:"update",value:function(e){}}]),n}(H));v._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/systems', 'chunks:///systems.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});